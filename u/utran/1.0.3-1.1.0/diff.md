# Comparing `tmp/utran-1.0.3-py3-none-any.whl.zip` & `tmp/utran-1.1.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,25 @@
-Zip file size: 33949 bytes, number of entries: 23
--rw-rw-rw-  2.0 fat      119 b- defN 23-Apr-09 15:51 utran/__init__.py
+Zip file size: 33082 bytes, number of entries: 23
+-rw-rw-rw-  2.0 fat      119 b- defN 23-Apr-22 08:35 utran/__init__.py
 -rw-rw-rw-  2.0 fat       56 b- defN 23-Mar-29 06:22 utran/__main__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Mar-29 13:25 utran/application.py
--rw-rw-rw-  2.0 fat     9798 b- defN 23-Apr-07 11:51 utran/handler.py
+-rw-rw-rw-  2.0 fat     9882 b- defN 23-Apr-21 03:09 utran/handler.py
 -rw-rw-rw-  2.0 fat      540 b- defN 23-Apr-02 16:36 utran/log.py
--rw-rw-rw-  2.0 fat    15004 b- defN 23-Apr-06 07:10 utran/object.py
--rw-rw-rw-  2.0 fat    17630 b- defN 23-Apr-08 12:38 utran/register.py
--rw-rw-rw-  2.0 fat     1318 b- defN 23-Apr-04 18:39 utran/runner.py
--rw-rw-rw-  2.0 fat     5937 b- defN 23-Apr-05 16:38 utran/utils.py
+-rw-rw-rw-  2.0 fat    15718 b- defN 23-Apr-10 12:51 utran/object.py
+-rw-rw-rw-  2.0 fat    17541 b- defN 23-Apr-10 07:14 utran/register.py
+-rw-rw-rw-  2.0 fat     1557 b- defN 23-Apr-22 07:13 utran/runner.py
+-rw-rw-rw-  2.0 fat     5527 b- defN 23-Apr-10 08:38 utran/utils.py
 -rw-rw-rw-  2.0 fat       86 b- defN 23-Apr-04 18:45 utran/client/__init__.py
--rw-rw-rw-  2.0 fat    23021 b- defN 23-Apr-09 14:34 utran/client/baseclient.py
--rw-rw-rw-  2.0 fat    13091 b- defN 23-Apr-09 15:44 utran/client/client.py
+-rw-rw-rw-  2.0 fat    16050 b- defN 23-Apr-22 07:38 utran/client/baseclient.py
+-rw-rw-rw-  2.0 fat    14482 b- defN 23-Apr-22 07:41 utran/client/client.py
 -rw-rw-rw-  2.0 fat     1828 b- defN 23-Apr-06 17:14 utran/client/que.py
--rw-rw-rw-  2.0 fat      163 b- defN 23-Mar-29 16:26 utran/server/__init__.py
+-rw-rw-rw-  2.0 fat      117 b- defN 23-Apr-22 05:03 utran/server/__init__.py
 -rw-rw-rw-  2.0 fat     2668 b- defN 23-Apr-07 11:49 utran/server/baseServer.py
 -rw-rw-rw-  2.0 fat     4897 b- defN 23-Apr-07 11:49 utran/server/rpcServer.py
--rw-rw-rw-  2.0 fat     5522 b- defN 23-Apr-05 17:27 utran/server/server.py
--rw-rw-rw-  2.0 fat     5631 b- defN 23-Apr-07 11:48 utran/server/webserver.py
--rw-rw-rw-  2.0 fat     1062 b- defN 23-Apr-09 15:53 utran-1.0.3.dist-info/LICENSE
--rw-rw-rw-  2.0 fat      403 b- defN 23-Apr-09 15:53 utran-1.0.3.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Apr-09 15:53 utran-1.0.3.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        6 b- defN 23-Apr-09 15:53 utran-1.0.3.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     1750 b- defN 23-Apr-09 15:53 utran-1.0.3.dist-info/RECORD
-23 files, 110622 bytes uncompressed, 31169 bytes compressed:  71.8%
+-rw-rw-rw-  2.0 fat     4337 b- defN 23-Apr-22 06:52 utran/server/server.py
+-rw-rw-rw-  2.0 fat     6446 b- defN 23-Apr-21 17:05 utran/server/webserver.py
+-rw-rw-rw-  2.0 fat     1062 b- defN 23-Apr-22 08:36 utran-1.1.0.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat      403 b- defN 23-Apr-22 08:36 utran-1.1.0.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Apr-22 08:36 utran-1.1.0.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        6 b- defN 23-Apr-22 08:36 utran-1.1.0.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     1750 b- defN 23-Apr-22 08:36 utran-1.1.0.dist-info/RECORD
+23 files, 105164 bytes uncompressed, 30302 bytes compressed:  71.2%
```

## zipnote {}

```diff
@@ -48,23 +48,23 @@
 
 Filename: utran/server/server.py
 Comment: 
 
 Filename: utran/server/webserver.py
 Comment: 
 
-Filename: utran-1.0.3.dist-info/LICENSE
+Filename: utran-1.1.0.dist-info/LICENSE
 Comment: 
 
-Filename: utran-1.0.3.dist-info/METADATA
+Filename: utran-1.1.0.dist-info/METADATA
 Comment: 
 
-Filename: utran-1.0.3.dist-info/WHEEL
+Filename: utran-1.1.0.dist-info/WHEEL
 Comment: 
 
-Filename: utran-1.0.3.dist-info/top_level.txt
+Filename: utran-1.1.0.dist-info/top_level.txt
 Comment: 
 
-Filename: utran-1.0.3.dist-info/RECORD
+Filename: utran-1.1.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## utran/__init__.py

```diff
@@ -1,5 +1,5 @@
 from utran.runner import run
 from utran.server import Server
 from utran.client import Client
 
-__version__ = "1.0.3"
+__version__ = "1.1.0"
```

## utran/handler.py

```diff
@@ -19,38 +19,40 @@
         connection (ClientConnection): 客户端连接
         register (Register): 注册类实例
         sub_container (SubscriptionContainer): 存放订阅者的容器实例
 
     Returns:
         返回一个布尔值,是否结束连接
     """
-    
-    if UtType.RPC==request.requestType:
-        #  Rpc请求
-        t = asyncio.create_task(process_rpc_request(request,connection,register,pool=pool))
-        return await t
-    
-    elif UtType.UNSUBSCRIBE==request.requestType:
-        # 取消订阅 topic        
-        return await process_unsubscribe_request(request,connection,sub_container)
-
-    elif UtType.SUBSCRIBE==request.requestType:
-        # 订阅 topic
-        return await process_subscribe_request(request,connection,sub_container)
-
-    elif UtType.PUBLISH==request.requestType:
-        # 发布        
-        return await process_publish_request(request,sub_container)
+    try:
+        if UtType.RPC==request.requestType:
+            #  Rpc请求
+            t = asyncio.create_task(process_rpc_request(request,connection,register,pool=pool))
+            return await t
+        
+        elif UtType.UNSUBSCRIBE==request.requestType:
+            # 取消订阅 topic        
+            return await process_unsubscribe_request(request,connection,sub_container)
 
-    elif UtType.MULTICALL == request.requestType:
-        return await process_multicall_request(request,connection,register,sub_container,pool=pool)
+        elif UtType.SUBSCRIBE==request.requestType:
+            # 订阅 topic
+            return await process_subscribe_request(request,connection,sub_container)
 
-    else:
-        # logging.log(f"处理请求时,出现不受支持的请求,请求的内容：{request}")
-        return True
+        elif UtType.PUBLISH==request.requestType:
+            # 发布        
+            return await process_publish_request(request,sub_container)
+
+        elif UtType.MULTICALL == request.requestType:
+            return await process_multicall_request(request,connection,register,sub_container,pool=pool)
+
+        else:
+            # logging.log(f"处理请求时,出现不受支持的请求,请求的内容：{request}")
+            return True
+    except Exception as e:
+        raise e
 
 
 async def process_multicall_request(request:UtRequest,connection:ClientConnection,register:Register,sub_container:SubscriptionContainer,pool:ProcessPoolExecutor=None)->bool:
     """处理multicall请求"""
   
     tasks = []
     for _r in request.multiple:
@@ -214,15 +216,14 @@
     response =UtResponse(id=request.id,responseType=request.requestType,state=UtState.SUCCESS)
 
     isclose=False
 
     if sub_container.has_sub(connection.id):
         t_ = sub_container.remove_topic(connection.id,topics)
         response.result = dict(unSubTopics=t_,allTopics=connection.topics)
-        await connection.send(response)
     else:
         response.state = UtState.FAILED
         response.error = '非订阅者，无法执行该操作，服务器将关闭连接！'        
         isclose = True
 
     if to_send:
         await connection.send(response)
```

## utran/object.py

```diff
@@ -10,16 +10,16 @@
 import ujson
 
 from utran.utils import pack_data2_utran
 
 
 class HeartBeat(Enum):
     """心跳"""
-    PING: bytes = b'PING'
-    PONG: bytes = b'PONG'
+    PING: bytes = b'PING\n'
+    PONG: bytes = b'PONG\n'
 
 
 class UtType(Enum):
     """请求或响应的类型"""
     GET: str = 'get'
     RPC: str = 'rpc'
     POST: str = 'post'
@@ -131,14 +131,28 @@
         self.args = args
         self.dicts = dicts
         self.topics = tuple(topics) if type(topics) == list or type(topics) == tuple else (topics,)
         self.msg = msg
         self.encrypt = encrypt
         self.multiple = multiple
 
+    def __repr__(self) -> str:
+        return '<UtRequest>' + self.__str__
+        
+        
+    def __str__(self) -> str:
+        s = f' requestType:{self.requestType.value},id:{self.id},encrypt:{self.encrypt}'
+        if self.requestType == UtType.RPC:
+            return s+f',methodName:{self.methodName}'
+        if self.requestType == UtType.MULTICALL:
+            return s+f',nums:{len(self.multiple)}'
+        if self.requestType == UtType.UNSUBSCRIBE or self.requestType == UtType.SUBSCRIBE or self.requestType == UtType.PUBLISH:
+            return s+f',topics:{self.topics}'
+
+
     def to_dict(self):
         """转为字典"""
         if self.requestType == UtType.RPC:
             return dict(id=self.id,
                         requestType=self.requestType.value,
                         methodName=self.methodName,
                         args=self.args,
@@ -164,15 +178,15 @@
             return dict(id=self.id,
                         requestType=self.requestType.value,
                         multiple=self.multiple)
 
 
     def pick_utran_request(self):
         """生成符合utran协议的请求数据"""
-        return pack_data2_utran(self.requestType.value,self.to_dict(),self.encrypt)
+        return pack_data2_utran(self.id,self.requestType.value,self.to_dict(),self.encrypt)
 
 
 
 REQUEST_ID:int=0
 def gen_requestId()->int:
     """生成请求全局唯一的id"""
     global REQUEST_ID
@@ -191,14 +205,16 @@
         id = id or gen_requestId()
         if type(msg)==list:
             multiple = [gen_request_dict(m,id=id) for m in msg]
             msg = dict(id=id,requestType=UtType.MULTICALL.value,multiple=multiple)        
         elif type(msg)==dict:
             msg['id'] = id
             return msg
+        elif type(msg)==bytes:
+            msg = msg[:1]+f'"id":{id},'.encode()+msg[1:]
         else:
             raise ValueError('"msg" must be a dict type!')
         return msg
     res:dict = gen_request_dict(msg,id)
     res['encrypt'] = encrypt
     return UtRequest(**res)
 
@@ -287,15 +303,15 @@
     @property
     def id(self):
         return self.__id
 
     async def send(self,response:UtResponse):
         async with self._single_semaphore:     # 每次只允许一个协程调用send方法     
             if isinstance(self.sender,StreamWriter):
-                msg = pack_data2_utran(response.responseType.value,response.to_dict(),self._encrypt)
+                msg = pack_data2_utran(response.id,response.responseType.value,response.to_dict(),self._encrypt)
                 await self.__send_by_sw(msg)
             elif isinstance(self.sender,WebSocketResponse):
                 await self.__send_by_ws(response.to_dict())
             else:
                 raise RuntimeError('Invalid sender, it must be an instance of StreamWriter or WebSocketResponse')
     
     async def __send_by_sw(self,msg:bytes):
```

## utran/register.py

```diff
@@ -8,1095 +8,1090 @@
 00000070: 746f 720d 0a66 726f 6d20 7479 7069 6e67  tor..from typing
 00000080: 2069 6d70 6f72 7420 4361 6c6c 6162 6c65   import Callable
 00000090: 0d0a 0d0a 6672 6f6d 2075 7472 616e 2e6f  ....from utran.o
 000000a0: 626a 6563 7420 696d 706f 7274 2042 6173  bject import Bas
 000000b0: 6544 6174 614d 6f64 656c 2c20 5574 5374  eDataModel, UtSt
 000000c0: 6174 650d 0a66 726f 6d20 7574 7261 6e2e  ate..from utran.
 000000d0: 6c6f 6720 696d 706f 7274 206c 6f67 6765  log import logge
-000000e0: 720d 0a0d 0a64 6566 2061 6c6c 6f77 5479  r....def allowTy
-000000f0: 7065 2876 2c74 2c6e 293a 0d0a 2020 2020  pe(v,t,n):..    
-00000100: 2222 2220 0d0a 2020 2020 2320 e7b1 bbe5  """ ..    # ....
-00000110: 9e8b e8bd ace6 8da2 0d0a 2020 2020 2323  ..........    ##
-00000120: 2320 312e e5bd 93e8 87aa e8ba abe7 9a84  # 1.............
-00000130: e695 b0e6 8dae e7b1 bbe5 9e8b e4b8 8ee6  ................
-00000140: 8c87 e5ae 9ae7 9a84 e695 b0e6 8dae e4b8  ................
-00000150: 80e8 87b4 e697 b6ef bc8c e79b b4e6 8ea5  ................
-00000160: e8bf 94e5 9b9e e8af a5e6 95b0 e68d aeef  ................
-00000170: bc9b 0d0a 2020 2020 2323 2320 322e e5bd  ....    ### 2...
-00000180: 93e8 87aa e8ba abe7 9a84 e695 b0e6 8dae  ................
-00000190: e7b1 bbe5 9e8b e4b8 8ee6 8c87 e5ae 9ae7  ................
-000001a0: 9a84 e695 b0e6 8dae e4b8 8de4 b880 e887  ................
-000001b0: b4ef bc8c e9a6 96e5 8588 e5b0 9de8 af95  ................
-000001c0: e698 afe5 90a6 e58f afe4 bba5 e4b9 8be9  ................
-000001d0: 97b4 e8bd ace6 8da2 e4b8 bae8 afa5 e7b1  ................
-000001e0: bbe5 9e8b efbc 8ce5 90a6 e588 99ef bc8c  ................
-000001f0: e6a3 80e6 9fa5 e698 afe5 90a6 e4b8 bae5  ................
-00000200: 8581 e8ae b8e7 b1bb e59e 8bef bc8c e5a6  ................
-00000210: 82e6 9e9c e698 afe5 8899 e8bd ace6 8da2  ................
-00000220: e4b8 bae8 afa5 e7b1 bbe5 9e8b e79a 84e6  ................
-00000230: 95b0 e68d aeef bc8c e590 a6e5 8899 e68a  ................
-00000240: a5e9 9499 5479 7065 4572 726f 72e3 8082  ....TypeError...
-00000250: 0d0a 0d0a 2020 2020 4172 6773 3a0d 0a20  ....    Args:.. 
-00000260: 2020 2020 2020 2076 3a20 e695 b0e6 8dae         v: ......
-00000270: 0d0a 2020 2020 2020 2020 7420 2873 7472  ..        t (str
-00000280: 293a 20e6 95b0 e68d aee7 b1bb e59e 8b0d  ): .............
-00000290: 0a20 2020 2020 2020 206e 2028 7374 7229  .        n (str)
-000002a0: 3a20 e58f afe8 b083 e794 a8e5 afb9 e8b1  : ..............
-000002b0: a1e7 9a84 e590 8de7 a7b0 0d0a 2020 2020  ............    
-000002c0: 2222 220d 0a20 2020 2069 6620 7479 7065  """..    if type
-000002d0: 2876 293d 3d74 3a0d 0a20 2020 2020 2020  (v)==t:..       
-000002e0: 2072 6574 7572 6e20 760d 0a20 2020 2065   return v..    e
-000002f0: 6c73 653a 0d0a 2020 2020 2020 2020 7472  lse:..        tr
-00000300: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00000310: 7620 3d20 2074 2876 290d 0a20 2020 2020  v =  t(v)..     
-00000320: 2020 2020 2020 2072 6574 7572 6e20 760d         return v.
-00000330: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00000340: 5479 7065 4572 726f 723a 0d0a 2020 2020  TypeError:..    
-00000350: 2020 2020 2020 2020 7061 7373 0d0a 0d0a          pass....
-00000360: 2020 2020 2020 2020 636c 6173 735f 203d          class_ =
-00000370: 2074 0d0a 2020 2020 2020 2020 6966 2063   t..        if c
-00000380: 6c61 7373 5f20 616e 6420 6973 7375 6263  lass_ and issubc
-00000390: 6c61 7373 2863 6c61 7373 5f2c 4261 7365  lass(class_,Base
-000003a0: 4461 7461 4d6f 6465 6c29 3a0d 0a20 2020  DataModel):..   
-000003b0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-000003c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000003d0: 6574 7572 6e20 636c 6173 735f 282a 2a76  eturn class_(**v
-000003e0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-000003f0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00000400: 6173 2065 3a0d 0a20 2020 2020 2020 2020  as e:..         
-00000410: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00000420: 6545 7272 6f72 2827 4572 726f 7220 636f  eError('Error co
-00000430: 6e76 6572 7469 6e67 2064 6174 613a 272c  nverting data:',
-00000440: 6529 0d0a 2020 2020 2020 2020 656c 7365  e)..        else
-00000450: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00000460: 6169 7365 2054 7970 6545 7272 6f72 2866  aise TypeError(f
-00000470: 2254 7970 6520 6572 726f 722c 2076 616c  "Type error, val
-00000480: 7565 2027 7b6e 7d27 206d 7573 7420 6265  ue '{n}' must be
-00000490: 207b 747d 2074 7970 652e 2229 0d0a 0d0a   {t} type.")....
-000004a0: 0d0a 6465 6620 6368 6565 6b54 7970 6528  ..def cheekType(
-000004b0: 7061 7261 6d73 3a74 7570 6c65 2c61 6e6e  params:tuple,ann
-000004c0: 6f74 6174 696f 6e73 3a64 6963 742c 6172  otations:dict,ar
-000004d0: 6773 3a74 7570 6c65 2c64 6963 7473 3a64  gs:tuple,dicts:d
-000004e0: 6963 743d 7b7d 292d 3e74 7570 6c65 3a0d  ict={})->tuple:.
-000004f0: 0a20 2020 2022 2222 0d0a 2020 2020 2320  .    """..    # 
-00000500: e6a3 80e6 9fa5 e7b1 bbe5 9e8b 0d0a 2020  ..............  
-00000510: 2020 e5bd 93e6 8c87 e5ae 9ae7 9a84 e7b1    ..............
-00000520: bbe5 9e8b e5b1 9ee4 ba8e 4261 7365 4461  ..........BaseDa
-00000530: 7461 4d6f 6465 6ce7 9a84 e5ad 90e7 b1bb  taModel.........
-00000540: e697 b6ef bc8c e5b0 86e5 b09d e8af 95e8  ................
-00000550: bf9b e8a1 8ce8 87aa e58a a8e8 bdac e68d  ................
-00000560: a20d 0a20 2020 2022 2222 0d0a 2020 2020  ...    """..    
-00000570: 6172 6773 203d 206c 6973 7428 6172 6773  args = list(args
-00000580: 2920 2020 0d0a 2020 2020 0d0a 2020 2020  )   ..    ..    
-00000590: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-000005a0: 656e 2870 6172 616d 7329 293a 0d0a 2020  en(params)):..  
-000005b0: 2020 2020 2020 6e20 3d20 7061 7261 6d73        n = params
-000005c0: 5b69 5d0d 0a20 2020 2020 2020 2074 203d  [i]..        t =
-000005d0: 2061 6e6e 6f74 6174 696f 6e73 2e67 6574   annotations.get
-000005e0: 286e 290d 0a20 2020 2020 2020 2069 6620  (n)..        if 
-000005f0: 6e6f 7420 743a 0d0a 2020 2020 2020 2020  not t:..        
-00000600: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
-00000610: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00000620: 2020 2020 2020 2020 7620 3d20 6172 6773          v = args
-00000630: 5b69 5d0d 0a20 2020 2020 2020 2020 2020  [i]..           
-00000640: 2061 7267 735b 695d 203d 2061 6c6c 6f77   args[i] = allow
-00000650: 5479 7065 2876 2c74 2c6e 290d 0a20 2020  Type(v,t,n)..   
-00000660: 2020 2020 2065 7863 6570 7420 496e 6465       except Inde
-00000670: 7845 7272 6f72 3a0d 0a20 2020 2020 2020  xError:..       
-00000680: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00000690: 2020 2020 2020 2020 2020 2076 203d 2064             v = d
-000006a0: 6963 7473 5b6e 5d0d 0a20 2020 2020 2020  icts[n]..       
-000006b0: 2020 2020 2020 2020 2064 6963 7473 5b6e           dicts[n
-000006c0: 5d20 3d20 616c 6c6f 7754 7970 6528 762c  ] = allowType(v,
-000006d0: 742c 6e29 0d0a 2020 2020 2020 2020 2020  t,n)..          
-000006e0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-000006f0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-00000700: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
-00000710: 2020 7265 7475 726e 2074 7570 6c65 2861    return tuple(a
-00000720: 7267 7329 2c64 6963 7473 0d0a 0d0a 0d0a  rgs),dicts......
-00000730: 0d0a 6465 6620 6173 796e 6366 6e5f 7275  ..def asyncfn_ru
-00000740: 6e6e 6572 2866 6e3a 4361 6c6c 6162 6c65  nner(fn:Callable
-00000750: 2c2a 6172 6773 2c2a 2a6b 7764 7329 3a0d  ,*args,**kwds):.
-00000760: 0a20 2020 2022 2222 e5ad 90e8 bf9b e7a8  .    """........
-00000770: 8be4 b8ad e79a 84e5 bc82 e6ad a5e6 89a7  ................
-00000780: e8a1 8ce5 99a8 2222 220d 0a20 2020 2072  ......"""..    r
-00000790: 6574 7572 6e20 6173 796e 6369 6f2e 7275  eturn asyncio.ru
-000007a0: 6e28 666e 282a 6172 6773 2c2a 2a6b 7764  n(fn(*args,**kwd
-000007b0: 7329 290d 0a0d 0a63 6c61 7373 2052 4d65  s))....class RMe
-000007c0: 7468 6f64 3a0d 0a20 2020 2022 2222 0d0a  thod:..    """..
-000007d0: 2020 2020 23e5 ad98 e694 bee6 b3a8 e586      #...........
-000007e0: 8ce6 96b9 e6b3 95e7 9a84 e695 b0e6 8dae  ................
-000007f0: e7b1 bb0d 0a20 2020 2041 7474 7269 6275  .....    Attribu
-00000800: 7465 733a 0d0a 2020 2020 2020 2020 6e61  tes:..        na
-00000810: 6d65 2028 7374 7229 3a20 e590 8de7 a7b0  me (str): ......
-00000820: e688 96e8 b7af e5be 840d 0a20 2020 2020  ...........     
-00000830: 2020 206d 6574 686f 6454 7970 6520 2873     methodType (s
-00000840: 7472 293a 20e7 b1bb e59e 8b20 4745 5420  tr): ...... GET 
-00000850: 2f20 504f 5354 202f 2052 5043 0d0a 2020  / POST / RPC..  
-00000860: 2020 2020 2020 6361 6c6c 6162 6c65 2028        callable (
-00000870: 6361 6c6c 6162 6c65 293a 20e5 8faf e8b0  callable): .....
-00000880: 83e7 94a8 e79a 84e6 96b9 e6b3 952f e587  ............./..
-00000890: bde6 95b0 0d0a 2020 2020 2020 2020 6368  ......        ch
-000008a0: 6563 6b50 6172 616d 7320 2862 6f6f 6c29  eckParams (bool)
-000008b0: 3a20 e698 afe5 90a6 e6a3 80e6 9fa5 e58f  : ..............
-000008c0: 82e6 95b0 0d0a 2020 2020 2020 2020 6368  ......        ch
-000008d0: 6563 6b52 6574 7572 6e20 2862 6f6f 6c29  eckReturn (bool)
-000008e0: 3a20 e698 afe5 90a6 e6a3 80e6 9fa5 e8bf  : ..............
-000008f0: 94e5 9b9e e580 bc0d 0a20 2020 2020 2020  .........       
-00000900: 2063 6c73 2028 7374 7229 3a20 e7b1 bbe5   cls (str): ....
-00000910: 908d efbc 8ce7 b1bb e696 b9e6 b395 e689  ................
-00000920: 8de4 bc9a e69c 890d 0a20 2020 2020 2020  .........       
-00000930: 2064 6f63 2028 7374 7229 3a20 e68f 8fe8   doc (str): ....
-00000940: bfb0 0d0a 2020 2020 2020 2020 7061 7261  ....        para
-00000950: 6d73 2028 7475 706c 6529 3a20 e58f 82e6  ms (tuple): ....
-00000960: 95b0 0d0a 2020 2020 2020 2020 6465 6661  ....        defa
-00000970: 756c 745f 7661 6c75 6573 2028 7475 706c  ult_values (tupl
-00000980: 6529 3a20 e58f 82e6 95b0 e9bb 98e8 aea4  e): ............
-00000990: e580 bc0d 0a20 2020 2020 2020 2061 6e6e  .....        ann
-000009a0: 6f74 6174 696f 6e73 2028 6469 6374 293a  otations (dict):
-000009b0: 20e7 b1bb e59e 8be5 a3b0 e698 8e0d 0a20   .............. 
-000009c0: 2020 2020 2020 2076 6172 6172 6773 2028         varargs (
-000009d0: 7374 7229 3a20 e58f 82e6 95b0 e4b8 ad2a  str): .........*
-000009e0: 6172 6773 e79a 84e5 908d e7a7 b00d 0a20  args........... 
-000009f0: 2020 2020 2020 2076 6172 6b77 2028 7374         varkw (st
-00000a00: 7229 3a20 e58f 82e6 95b0 e4b8 ad2a 2a64  r): .........**d
-00000a10: 6963 7473 e79a 84e5 908d e7a7 b00d 0a20  icts........... 
-00000a20: 2020 2020 2020 2072 6574 7572 6e54 7970         returnTyp
-00000a30: 6520 2873 7472 293a 20e8 bf94 e59b 9ee5  e (str): .......
-00000a40: 80bc e79a 84e7 b1bb e59e 8b0d 0a20 2020  .............   
-00000a50: 2020 2020 2061 7379 6e63 6675 6e63 2028       asyncfunc (
-00000a60: 626f 6f6c 293a 20e6 98af e590 a6e4 b8ba  bool): .........
-00000a70: e5bc 82e6 ada5 e587 bde6 95b0 e688 96e6  ................
-00000a80: 96b9 e6b3 950d 0a20 2020 2022 2222 0d0a  .......    """..
-00000a90: 2020 0d0a 2020 2020 5f5f 736c 6f74 735f    ..    __slots_
-00000aa0: 5f20 3d20 2827 6e61 6d65 272c 0d0a 2020  _ = ('name',..  
-00000ab0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00000ac0: 6d65 7468 6f64 5479 7065 272c 0d0a 2020  methodType',..  
-00000ad0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00000ae0: 6361 6c6c 6162 6c65 272c 0d0a 2020 2020  callable',..    
-00000af0: 2020 2020 2020 2020 2020 2020 2027 6368               'ch
-00000b00: 6563 6b50 6172 616d 7327 2c0d 0a20 2020  eckParams',..   
-00000b10: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-00000b20: 6865 636b 5265 7475 726e 272c 0d0a 2020  heckReturn',..  
-00000b30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00000b40: 636c 7327 2c0d 0a20 2020 2020 2020 2020  cls',..         
-00000b50: 2020 2020 2020 2020 2764 6f63 272c 0d0a          'doc',..
-00000b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000b70: 2027 7061 7261 6d73 272c 0d0a 2020 2020   'params',..    
-00000b80: 2020 2020 2020 2020 2020 2020 2027 6465               'de
-00000b90: 6661 756c 745f 7661 6c75 6573 272c 0d0a  fault_values',..
+000000e0: 720d 0a66 726f 6d20 7574 7261 6e2e 7574  r..from utran.ut
+000000f0: 696c 7320 696d 706f 7274 2061 7379 6e63  ils import async
+00000100: 666e 5f72 756e 6e65 720d 0a0d 0a64 6566  fn_runner....def
+00000110: 2061 6c6c 6f77 5479 7065 2876 2c74 2c6e   allowType(v,t,n
+00000120: 293a 0d0a 2020 2020 2222 2220 0d0a 2020  ):..    """ ..  
+00000130: 2020 2320 e7b1 bbe5 9e8b e8bd ace6 8da2    # ............
+00000140: 0d0a 2020 2020 2323 2320 312e e5bd 93e8  ..    ### 1.....
+00000150: 87aa e8ba abe7 9a84 e695 b0e6 8dae e7b1  ................
+00000160: bbe5 9e8b e4b8 8ee6 8c87 e5ae 9ae7 9a84  ................
+00000170: e695 b0e6 8dae e4b8 80e8 87b4 e697 b6ef  ................
+00000180: bc8c e79b b4e6 8ea5 e8bf 94e5 9b9e e8af  ................
+00000190: a5e6 95b0 e68d aeef bc9b 0d0a 2020 2020  ............    
+000001a0: 2323 2320 322e e5bd 93e8 87aa e8ba abe7  ### 2...........
+000001b0: 9a84 e695 b0e6 8dae e7b1 bbe5 9e8b e4b8  ................
+000001c0: 8ee6 8c87 e5ae 9ae7 9a84 e695 b0e6 8dae  ................
+000001d0: e4b8 8de4 b880 e887 b4ef bc8c e9a6 96e5  ................
+000001e0: 8588 e5b0 9de8 af95 e698 afe5 90a6 e58f  ................
+000001f0: afe4 bba5 e4b9 8be9 97b4 e8bd ace6 8da2  ................
+00000200: e4b8 bae8 afa5 e7b1 bbe5 9e8b efbc 8ce5  ................
+00000210: 90a6 e588 99ef bc8c e6a3 80e6 9fa5 e698  ................
+00000220: afe5 90a6 e4b8 bae5 8581 e8ae b8e7 b1bb  ................
+00000230: e59e 8bef bc8c e5a6 82e6 9e9c e698 afe5  ................
+00000240: 8899 e8bd ace6 8da2 e4b8 bae8 afa5 e7b1  ................
+00000250: bbe5 9e8b e79a 84e6 95b0 e68d aeef bc8c  ................
+00000260: e590 a6e5 8899 e68a a5e9 9499 5479 7065  ............Type
+00000270: 4572 726f 72e3 8082 0d0a 0d0a 2020 2020  Error.......    
+00000280: 4172 6773 3a0d 0a20 2020 2020 2020 2076  Args:..        v
+00000290: 3a20 e695 b0e6 8dae 0d0a 2020 2020 2020  : ........      
+000002a0: 2020 7420 2873 7472 293a 20e6 95b0 e68d    t (str): .....
+000002b0: aee7 b1bb e59e 8b0d 0a20 2020 2020 2020  .........       
+000002c0: 206e 2028 7374 7229 3a20 e58f afe8 b083   n (str): ......
+000002d0: e794 a8e5 afb9 e8b1 a1e7 9a84 e590 8de7  ................
+000002e0: a7b0 0d0a 2020 2020 2222 220d 0a20 2020  ....    """..   
+000002f0: 2069 6620 7479 7065 2876 293d 3d74 3a0d   if type(v)==t:.
+00000300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00000310: 760d 0a20 2020 2065 6c73 653a 0d0a 2020  v..    else:..  
+00000320: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00000330: 2020 2020 2020 2020 7620 3d20 2074 2876          v =  t(v
+00000340: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00000350: 6574 7572 6e20 760d 0a20 2020 2020 2020  eturn v..       
+00000360: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
+00000370: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00000380: 7061 7373 0d0a 0d0a 2020 2020 2020 2020  pass....        
+00000390: 636c 6173 735f 203d 2074 0d0a 2020 2020  class_ = t..    
+000003a0: 2020 2020 6966 2063 6c61 7373 5f20 616e      if class_ an
+000003b0: 6420 6973 7375 6263 6c61 7373 2863 6c61  d issubclass(cla
+000003c0: 7373 5f2c 4261 7365 4461 7461 4d6f 6465  ss_,BaseDataMode
+000003d0: 6c29 3a0d 0a20 2020 2020 2020 2020 2020  l):..           
+000003e0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+000003f0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+00000400: 6173 735f 282a 2a76 290d 0a20 2020 2020  ass_(**v)..     
+00000410: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00000420: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
+00000430: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00000440: 6169 7365 2054 7970 6545 7272 6f72 2827  aise TypeError('
+00000450: 4572 726f 7220 636f 6e76 6572 7469 6e67  Error converting
+00000460: 2064 6174 613a 272c 6529 0d0a 2020 2020   data:',e)..    
+00000470: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00000480: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00000490: 6545 7272 6f72 2866 2254 7970 6520 6572  eError(f"Type er
+000004a0: 726f 722c 2076 616c 7565 2027 7b6e 7d27  ror, value '{n}'
+000004b0: 206d 7573 7420 6265 207b 747d 2074 7970   must be {t} typ
+000004c0: 652e 2229 0d0a 0d0a 0d0a 6465 6620 6368  e.")......def ch
+000004d0: 6565 6b54 7970 6528 7061 7261 6d73 3a74  eekType(params:t
+000004e0: 7570 6c65 2c61 6e6e 6f74 6174 696f 6e73  uple,annotations
+000004f0: 3a64 6963 742c 6172 6773 3a74 7570 6c65  :dict,args:tuple
+00000500: 2c64 6963 7473 3a64 6963 743d 7b7d 292d  ,dicts:dict={})-
+00000510: 3e74 7570 6c65 3a0d 0a20 2020 2022 2222  >tuple:..    """
+00000520: 0d0a 2020 2020 2320 e6a3 80e6 9fa5 e7b1  ..    # ........
+00000530: bbe5 9e8b 0d0a 2020 2020 e5bd 93e6 8c87  ......    ......
+00000540: e5ae 9ae7 9a84 e7b1 bbe5 9e8b e5b1 9ee4  ................
+00000550: ba8e 4261 7365 4461 7461 4d6f 6465 6ce7  ..BaseDataModel.
+00000560: 9a84 e5ad 90e7 b1bb e697 b6ef bc8c e5b0  ................
+00000570: 86e5 b09d e8af 95e8 bf9b e8a1 8ce8 87aa  ................
+00000580: e58a a8e8 bdac e68d a20d 0a20 2020 2022  ...........    "
+00000590: 2222 0d0a 2020 2020 6172 6773 203d 206c  ""..    args = l
+000005a0: 6973 7428 6172 6773 2920 2020 0d0a 2020  ist(args)   ..  
+000005b0: 2020 0d0a 2020 2020 666f 7220 6920 696e    ..    for i in
+000005c0: 2072 616e 6765 286c 656e 2870 6172 616d   range(len(param
+000005d0: 7329 293a 0d0a 2020 2020 2020 2020 6e20  s)):..        n 
+000005e0: 3d20 7061 7261 6d73 5b69 5d0d 0a20 2020  = params[i]..   
+000005f0: 2020 2020 2074 203d 2061 6e6e 6f74 6174       t = annotat
+00000600: 696f 6e73 2e67 6574 286e 290d 0a20 2020  ions.get(n)..   
+00000610: 2020 2020 2069 6620 6e6f 7420 743a 0d0a       if not t:..
+00000620: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00000630: 696e 7565 0d0a 2020 2020 2020 2020 7472  inue..        tr
+00000640: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00000650: 7620 3d20 6172 6773 5b69 5d0d 0a20 2020  v = args[i]..   
+00000660: 2020 2020 2020 2020 2061 7267 735b 695d           args[i]
+00000670: 203d 2061 6c6c 6f77 5479 7065 2876 2c74   = allowType(v,t
+00000680: 2c6e 290d 0a20 2020 2020 2020 2065 7863  ,n)..        exc
+00000690: 6570 7420 496e 6465 7845 7272 6f72 3a0d  ept IndexError:.
+000006a0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+000006b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000006c0: 2020 2076 203d 2064 6963 7473 5b6e 5d0d     v = dicts[n].
+000006d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000006e0: 2064 6963 7473 5b6e 5d20 3d20 616c 6c6f   dicts[n] = allo
+000006f0: 7754 7970 6528 762c 742c 6e29 0d0a 2020  wType(v,t,n)..  
+00000700: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00000710: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+00000720: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00000730: 696e 7565 0d0a 2020 2020 7265 7475 726e  inue..    return
+00000740: 2074 7570 6c65 2861 7267 7329 2c64 6963   tuple(args),dic
+00000750: 7473 0d0a 0d0a 0d0a 0d0a 0d0a 0d0a 636c  ts............cl
+00000760: 6173 7320 524d 6574 686f 643a 0d0a 2020  ass RMethod:..  
+00000770: 2020 2222 220d 0a20 2020 2023 e5ad 98e6    """..    #....
+00000780: 94be e6b3 a8e5 868c e696 b9e6 b395 e79a  ................
+00000790: 84e6 95b0 e68d aee7 b1bb 0d0a 2020 2020  ............    
+000007a0: 4174 7472 6962 7574 6573 3a0d 0a20 2020  Attributes:..   
+000007b0: 2020 2020 206e 616d 6520 2873 7472 293a       name (str):
+000007c0: 20e5 908d e7a7 b0e6 8896 e8b7 afe5 be84   ...............
+000007d0: 0d0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
+000007e0: 5479 7065 2028 7374 7229 3a20 e7b1 bbe5  Type (str): ....
+000007f0: 9e8b 2047 4554 202f 2050 4f53 5420 2f20  .. GET / POST / 
+00000800: 5250 430d 0a20 2020 2020 2020 2063 616c  RPC..        cal
+00000810: 6c61 626c 6520 2863 616c 6c61 626c 6529  lable (callable)
+00000820: 3a20 e58f afe8 b083 e794 a8e7 9a84 e696  : ..............
+00000830: b9e6 b395 2fe5 87bd e695 b00d 0a20 2020  ..../........   
+00000840: 2020 2020 2063 6865 636b 5061 7261 6d73       checkParams
+00000850: 2028 626f 6f6c 293a 20e6 98af e590 a6e6   (bool): .......
+00000860: a380 e69f a5e5 8f82 e695 b00d 0a20 2020  .............   
+00000870: 2020 2020 2063 6865 636b 5265 7475 726e       checkReturn
+00000880: 2028 626f 6f6c 293a 20e6 98af e590 a6e6   (bool): .......
+00000890: a380 e69f a5e8 bf94 e59b 9ee5 80bc 0d0a  ................
+000008a0: 2020 2020 2020 2020 636c 7320 2873 7472          cls (str
+000008b0: 293a 20e7 b1bb e590 8def bc8c e7b1 bbe6  ): .............
+000008c0: 96b9 e6b3 95e6 898d e4bc 9ae6 9c89 0d0a  ................
+000008d0: 2020 2020 2020 2020 646f 6320 2873 7472          doc (str
+000008e0: 293a 20e6 8f8f e8bf b00d 0a20 2020 2020  ): ........     
+000008f0: 2020 2070 6172 616d 7320 2874 7570 6c65     params (tuple
+00000900: 293a 20e5 8f82 e695 b00d 0a20 2020 2020  ): ........     
+00000910: 2020 2064 6566 6175 6c74 5f76 616c 7565     default_value
+00000920: 7320 2874 7570 6c65 293a 20e5 8f82 e695  s (tuple): .....
+00000930: b0e9 bb98 e8ae a4e5 80bc 0d0a 2020 2020  ............    
+00000940: 2020 2020 616e 6e6f 7461 7469 6f6e 7320      annotations 
+00000950: 2864 6963 7429 3a20 e7b1 bbe5 9e8b e5a3  (dict): ........
+00000960: b0e6 988e 0d0a 2020 2020 2020 2020 7661  ......        va
+00000970: 7261 7267 7320 2873 7472 293a 20e5 8f82  rargs (str): ...
+00000980: e695 b0e4 b8ad 2a61 7267 73e7 9a84 e590  ......*args.....
+00000990: 8de7 a7b0 0d0a 2020 2020 2020 2020 7661  ......        va
+000009a0: 726b 7720 2873 7472 293a 20e5 8f82 e695  rkw (str): .....
+000009b0: b0e4 b8ad 2a2a 6469 6374 73e7 9a84 e590  ....**dicts.....
+000009c0: 8de7 a7b0 0d0a 2020 2020 2020 2020 7265  ......        re
+000009d0: 7475 726e 5479 7065 2028 7374 7229 3a20  turnType (str): 
+000009e0: e8bf 94e5 9b9e e580 bce7 9a84 e7b1 bbe5  ................
+000009f0: 9e8b 0d0a 2020 2020 2020 2020 6173 796e  ....        asyn
+00000a00: 6366 756e 6320 2862 6f6f 6c29 3a20 e698  cfunc (bool): ..
+00000a10: afe5 90a6 e4b8 bae5 bc82 e6ad a5e5 87bd  ................
+00000a20: e695 b0e6 8896 e696 b9e6 b395 0d0a 2020  ..............  
+00000a30: 2020 2222 220d 0a20 200d 0a20 2020 205f    """..  ..    _
+00000a40: 5f73 6c6f 7473 5f5f 203d 2028 276e 616d  _slots__ = ('nam
+00000a50: 6527 2c0d 0a20 2020 2020 2020 2020 2020  e',..           
+00000a60: 2020 2020 2020 276d 6574 686f 6454 7970        'methodTyp
+00000a70: 6527 2c0d 0a20 2020 2020 2020 2020 2020  e',..           
+00000a80: 2020 2020 2020 2763 616c 6c61 626c 6527        'callable'
+00000a90: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00000aa0: 2020 2020 2763 6865 636b 5061 7261 6d73      'checkParams
+00000ab0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00000ac0: 2020 2020 2027 6368 6563 6b52 6574 7572       'checkRetur
+00000ad0: 6e27 2c0d 0a20 2020 2020 2020 2020 2020  n',..           
+00000ae0: 2020 2020 2020 2763 6c73 272c 0d0a 2020        'cls',..  
+00000af0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00000b00: 646f 6327 2c0d 0a20 2020 2020 2020 2020  doc',..         
+00000b10: 2020 2020 2020 2020 2770 6172 616d 7327          'params'
+00000b20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00000b30: 2020 2020 2764 6566 6175 6c74 5f76 616c      'default_val
+00000b40: 7565 7327 2c0d 0a20 2020 2020 2020 2020  ues',..         
+00000b50: 2020 2020 2020 2020 2761 6e6e 6f74 6174          'annotat
+00000b60: 696f 6e73 272c 0d0a 2020 2020 2020 2020  ions',..        
+00000b70: 2020 2020 2020 2020 2027 7661 7261 7267           'vararg
+00000b80: 7327 2c0d 0a20 2020 2020 2020 2020 2020  s',..           
+00000b90: 2020 2020 2020 2776 6172 6b77 272c 0d0a        'varkw',..
 00000ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000bb0: 2027 616e 6e6f 7461 7469 6f6e 7327 2c0d   'annotations',.
-00000bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000bd0: 2020 2776 6172 6172 6773 272c 0d0a 2020    'varargs',..  
-00000be0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00000bf0: 7661 726b 7727 2c0d 0a20 2020 2020 2020  varkw',..       
-00000c00: 2020 2020 2020 2020 2020 2772 6574 7572            'retur
-00000c10: 6e54 7970 6527 2c0d 0a20 2020 2020 2020  nType',..       
-00000c20: 2020 2020 2020 2020 2020 2761 7379 6e63            'async
-00000c30: 6675 6e63 272c 0d0a 2020 2020 2020 2020  func',..        
-00000c40: 2020 2020 2020 2020 2027 7573 6550 726f           'usePro
-00000c50: 6365 7373 2729 0d0a 0d0a 2020 2020 6465  cess')....    de
-00000c60: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00000c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00000c80: 2020 206e 616d 653a 7374 722c 0d0a 2020     name:str,..  
-00000c90: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00000ca0: 6574 686f 6454 7970 653a 7374 722c 0d0a  ethodType:str,..
-00000cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000cc0: 2063 616c 6c61 626c 653a 6361 6c6c 6162   callable:callab
-00000cd0: 6c65 2c0d 0a20 2020 2020 2020 2020 2020  le,..           
-00000ce0: 2020 2020 2020 6368 6563 6b50 6172 616d        checkParam
-00000cf0: 733a 626f 6f6c 2c0d 0a20 2020 2020 2020  s:bool,..       
-00000d00: 2020 2020 2020 2020 2020 6368 6563 6b52            checkR
-00000d10: 6574 7572 6e3a 626f 6f6c 2c0d 0a20 2020  eturn:bool,..   
-00000d20: 2020 2020 2020 2020 2020 2020 2020 7573                us
-00000d30: 6550 726f 6365 7373 3a62 6f6f 6c3d 4661  eProcess:bool=Fa
-00000d40: 6c73 6529 202d 3e20 4e6f 6e65 3a0d 0a20  lse) -> None:.. 
-00000d50: 2020 2020 2020 2022 2222 2222 220d 0a20         """""".. 
-00000d60: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-00000d70: 203d 206e 616d 650d 0a20 2020 2020 2020   = name..       
-00000d80: 2073 656c 662e 6d65 7468 6f64 5479 7065   self.methodType
-00000d90: 203d 206d 6574 686f 6454 7970 650d 0a20   = methodType.. 
-00000da0: 2020 2020 2020 2073 656c 662e 6361 6c6c         self.call
-00000db0: 6162 6c65 203d 2063 616c 6c61 626c 650d  able = callable.
-00000dc0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-00000dd0: 6563 6b50 6172 616d 7320 3d20 6368 6563  eckParams = chec
-00000de0: 6b50 6172 616d 730d 0a20 2020 2020 2020  kParams..       
-00000df0: 2073 656c 662e 6368 6563 6b52 6574 7572   self.checkRetur
-00000e00: 6e20 3d20 6368 6563 6b52 6574 7572 6e20  n = checkReturn 
-00000e10: 2020 2020 0d0a 2020 2020 2020 2020 7365      ..        se
-00000e20: 6c66 2e75 7365 5072 6f63 6573 7320 3d20  lf.useProcess = 
-00000e30: 7573 6550 726f 6365 7373 0d0a 2020 2020  useProcess..    
-00000e40: 2020 2020 7365 6c66 2e63 6c73 3a20 7374      self.cls: st
-00000e50: 7220 3d20 2727 2069 6620 6e6f 7420 696e  r = '' if not in
-00000e60: 7370 6563 742e 6973 6d65 7468 6f64 2873  spect.ismethod(s
-00000e70: 656c 662e 6361 6c6c 6162 6c65 2920 656c  elf.callable) el
-00000e80: 7365 2073 656c 662e 6361 6c6c 6162 6c65  se self.callable
-00000e90: 2e5f 5f73 656c 665f 5f2e 5f5f 636c 6173  .__self__.__clas
-00000ea0: 735f 5f2e 5f5f 6e61 6d65 5f5f 0d0a 2020  s__.__name__..  
-00000eb0: 2020 2020 2020 7365 6c66 2e70 6172 616d        self.param
-00000ec0: 733a 7475 706c 6520 3d20 7475 706c 6528  s:tuple = tuple(
-00000ed0: 696e 7370 6563 742e 7369 676e 6174 7572  inspect.signatur
-00000ee0: 6528 7365 6c66 2e63 616c 6c61 626c 6529  e(self.callable)
-00000ef0: 2e70 6172 616d 6574 6572 732e 6b65 7973  .parameters.keys
-00000f00: 2829 2920 2020 2020 2020 200d 0a20 2020  ())        ..   
-00000f10: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
-00000f20: 745f 7661 6c75 6573 3a74 7570 6c65 3d20  t_values:tuple= 
-00000f30: 7475 706c 6528 5b69 2e64 6566 6175 6c74  tuple([i.default
-00000f40: 2066 6f72 2069 2069 6e20 7475 706c 6528   for i in tuple(
-00000f50: 696e 7370 6563 742e 7369 676e 6174 7572  inspect.signatur
-00000f60: 6528 7365 6c66 2e63 616c 6c61 626c 6529  e(self.callable)
-00000f70: 2e70 6172 616d 6574 6572 732e 7661 6c75  .parameters.valu
-00000f80: 6573 2829 2920 6966 2069 2e64 6566 6175  es()) if i.defau
-00000f90: 6c74 2069 7320 6e6f 7420 696e 7370 6563  lt is not inspec
-00000fa0: 742e 5f65 6d70 7479 5d29 0d0a 2020 2020  t._empty])..    
-00000fb0: 2020 2020 7365 6c66 2e64 6f63 3a73 7472      self.doc:str
-00000fc0: 203d 2069 6e73 7065 6374 2e67 6574 646f   = inspect.getdo
-00000fd0: 6328 7365 6c66 2e63 616c 6c61 626c 6529  c(self.callable)
-00000fe0: 0d0a 2020 2020 2020 2020 616e 6e6f 7461  ..        annota
-00000ff0: 7469 6f6e 7320 3d20 6469 6374 285b 286b  tions = dict([(k
-00001000: 2c76 2e61 6e6e 6f74 6174 696f 6e29 2066  ,v.annotation) f
-00001010: 6f72 206b 2c76 2069 6e20 2069 6e73 7065  or k,v in  inspe
-00001020: 6374 2e73 6967 6e61 7475 7265 2873 656c  ct.signature(sel
-00001030: 662e 6361 6c6c 6162 6c65 292e 7061 7261  f.callable).para
-00001040: 6d65 7465 7273 2e69 7465 6d73 2829 2069  meters.items() i
-00001050: 6620 762e 616e 6e6f 7461 7469 6f6e 2069  f v.annotation i
-00001060: 7320 6e6f 7420 696e 7370 6563 742e 5f65  s not inspect._e
-00001070: 6d70 7479 5d29 0d0a 2020 2020 2020 2020  mpty])..        
-00001080: 666f 7220 616e 2069 6e20 616e 6e6f 7461  for an in annota
-00001090: 7469 6f6e 732e 6b65 7973 2829 3a0d 0a20  tions.keys():.. 
-000010a0: 2020 2020 2020 2020 2020 2061 6e6e 6f74             annot
-000010b0: 6174 696f 6e73 5b61 6e5d 203d 2061 6e6e  ations[an] = ann
-000010c0: 6f74 6174 696f 6e73 5b61 6e5d 0d0a 2020  otations[an]..  
-000010d0: 2020 2020 2020 7365 6c66 2e61 6e6e 6f74        self.annot
-000010e0: 6174 696f 6e73 3a64 6963 7420 3d20 616e  ations:dict = an
-000010f0: 6e6f 7461 7469 6f6e 730d 0a20 2020 2020  notations..     
-00001100: 2020 2073 7020 3d20 696e 7370 6563 742e     sp = inspect.
-00001110: 6765 7466 756c 6c61 7267 7370 6563 2873  getfullargspec(s
-00001120: 656c 662e 6361 6c6c 6162 6c65 290d 0a20  elf.callable).. 
-00001130: 2020 2020 2020 2073 656c 662e 7661 7261         self.vara
-00001140: 7267 733a 7374 7220 3d20 7370 2e76 6172  rgs:str = sp.var
-00001150: 6172 6773 0d0a 2020 2020 2020 2020 7365  args..        se
-00001160: 6c66 2e76 6172 6b77 3a73 7472 203d 2073  lf.varkw:str = s
-00001170: 702e 7661 726b 770d 0a20 2020 2020 2020  p.varkw..       
-00001180: 2073 656c 662e 7265 7475 726e 5479 7065   self.returnType
-00001190: 3a73 7472 203d 2073 702e 616e 6e6f 7461  :str = sp.annota
-000011a0: 7469 6f6e 732e 6765 7428 2772 6574 7572  tions.get('retur
-000011b0: 6e27 290d 0a20 2020 2020 2020 2073 656c  n')..        sel
-000011c0: 662e 6173 796e 6366 756e 633a 626f 6f6c  f.asyncfunc:bool
-000011d0: 203d 2069 6e73 7065 6374 2e69 7363 6f72   = inspect.iscor
-000011e0: 6f75 7469 6e65 6675 6e63 7469 6f6e 2873  outinefunction(s
-000011f0: 656c 662e 6361 6c6c 6162 6c65 290d 0a0d  elf.callable)...
-00001200: 0a0d 0a20 2020 2061 7379 6e63 2064 6566  ...    async def
-00001210: 2065 7865 6375 7465 2873 656c 662c 6172   execute(self,ar
-00001220: 6773 3a74 7570 6c65 2c64 6963 7473 3a64  gs:tuple,dicts:d
-00001230: 6963 742c 706f 6f6c 3a50 726f 6365 7373  ict,pool:Process
-00001240: 506f 6f6c 4578 6563 7574 6f72 3d4e 6f6e  PoolExecutor=Non
-00001250: 6529 2d3e 7475 706c 655b 5574 5374 6174  e)->tuple[UtStat
-00001260: 652c 616e 792c 7374 725d 3a0d 0a20 2020  e,any,str]:..   
-00001270: 2020 2020 2022 2222 20e6 89a7 e8a1 8ce6       """ .......
-00001280: b3a8 e586 8ce7 9a84 e587 bde6 95b0 e688  ................
-00001290: 96e6 96b9 e6b3 950d 0a20 2020 2020 2020  .........       
-000012a0: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-000012b0: 2020 2020 6172 6773 3a20 e588 97e8 a1a8      args: ......
-000012c0: e58f 82e6 95b0 0d0a 2020 2020 2020 2020  ........        
-000012d0: 2020 2020 6469 6374 733a 20e5 ad97 e585      dicts: .....
-000012e0: b8e5 8f82 e695 b00d 0a20 2020 2020 2020  .........       
-000012f0: 2020 2020 2070 6f6f 6c3a 20e8 bf9b e7a8       pool: .....
-00001300: 8be6 b1a0 0d0a 2020 2020 2020 2020 2020  ......          
-00001310: 2020 0d0a 2020 2020 2020 2020 5265 7475    ..        Retu
-00001320: 726e 733a 0d0a 2020 2020 2020 2020 2020  rns:..          
-00001330: 2020 e8bf 94e5 9b9e e580 bcef bc9a e78a    ..............
-00001340: b6e6 8081 efbc 8ce7 bb93 e69e 9cef bc8c  ................
-00001350: e994 99e8 afaf e4bf a1e6 81af 0d0a 2020  ..............  
-00001360: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00001370: 2020 2072 6573 756c 7420 3d20 4e6f 6e65     result = None
-00001380: 0d0a 2020 2020 2020 2020 7374 6174 6520  ..        state 
-00001390: 3d20 5574 5374 6174 652e 5355 4343 4553  = UtState.SUCCES
-000013a0: 530d 0a20 2020 2020 2020 2065 7272 6f72  S..        error
-000013b0: 203d 2027 270d 0a0d 0a20 2020 2020 2020   = ''....       
-000013c0: 2023 2031 2ee6 a380 e69f a5e5 8f82 e695   # 1............
-000013d0: b00d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-000013e0: 6c66 2e63 6865 636b 5061 7261 6d73 3a0d  lf.checkParams:.
-000013f0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00001400: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00001410: 2020 2061 7267 732c 6469 6374 7320 3d20     args,dicts = 
-00001420: 6368 6565 6b54 7970 6528 7365 6c66 2e70  cheekType(self.p
-00001430: 6172 616d 732c 7365 6c66 2e61 6e6e 6f74  arams,self.annot
-00001440: 6174 696f 6e73 2c61 7267 732c 6469 6374  ations,args,dict
-00001450: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-00001460: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00001470: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
-00001480: 2020 2020 2020 2020 7374 6174 6520 3d20          state = 
-00001490: 5574 5374 6174 652e 4641 494c 4544 0d0a  UtState.FAILED..
-000014a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014b0: 6572 726f 7220 3d20 7374 7228 6529 0d0a  error = str(e)..
-000014c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014d0: 7265 7475 726e 2073 7461 7465 2c72 6573  return state,res
-000014e0: 756c 742c 6572 726f 720d 0a20 2020 2020  ult,error..     
-000014f0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00001500: 2020 2020 2023 2032 2ee6 89a7 e8a1 8ce6       # 2........
-00001510: b3a8 e586 8ce5 87bd e695 b00d 0a20 2020  .............   
-00001520: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00001530: 2e75 7365 5072 6f63 6573 733a 0d0a 2020  .useProcess:..  
-00001540: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00001550: e8bf 9be7 a88b e4b8 ade6 89a7 e8a1 8c0d  ................
-00001560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001570: 2069 6620 706f 6f6c 2069 7320 4e6f 6e65   if pool is None
-00001580: 3a20 0d0a 2020 2020 2020 2020 2020 2020  : ..            
-00001590: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-000015a0: 7272 6f72 2866 2754 6865 2066 756e 6374  rror(f'The funct
-000015b0: 696f 6e20 227b 7365 6c66 2e6e 616d 657d  ion "{self.name}
-000015c0: 2220 7275 6e73 2069 6e20 6120 6368 696c  " runs in a chil
-000015d0: 6420 7072 6f63 6573 732c 2062 7574 2074  d process, but t
-000015e0: 6865 2073 6572 7665 7220 6861 7320 6e6f  he server has no
-000015f0: 2077 6f72 6b65 7220 7072 6f63 6573 7327   worker process'
-00001600: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00001610: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
-00001620: 7469 6d65 4572 726f 7228 6627 5468 6520  timeError(f'The 
-00001630: 6675 6e63 7469 6f6e 2022 7b73 656c 662e  function "{self.
-00001640: 6e61 6d65 7d22 2072 756e 7320 696e 2061  name}" runs in a
-00001650: 2063 6869 6c64 2070 726f 6365 7373 2c20   child process, 
-00001660: 6275 7420 7468 6520 7365 7276 6572 2068  but the server h
-00001670: 6173 206e 6f20 776f 726b 6572 2070 726f  as no worker pro
-00001680: 6365 7373 2729 0d0a 0d0a 2020 2020 2020  cess')....      
-00001690: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000016a0: 662e 6173 796e 6366 756e 633a 0d0a 2020  f.asyncfunc:..  
-000016b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016c0: 2020 666e 203d 2070 6172 7469 616c 2861    fn = partial(a
-000016d0: 7379 6e63 666e 5f72 756e 6e65 722c 7365  syncfn_runner,se
-000016e0: 6c66 2e63 616c 6c61 626c 652c 2a61 7267  lf.callable,*arg
-000016f0: 732c 2a2a 6469 6374 7329 0d0a 2020 2020  s,**dicts)..    
-00001700: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00001710: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00001720: 2020 2020 2020 2066 6e20 3d20 7061 7274         fn = part
-00001730: 6961 6c28 7365 6c66 2e63 616c 6c61 626c  ial(self.callabl
-00001740: 652c 2a61 7267 732c 2a2a 6469 6374 7329  e,*args,**dicts)
-00001750: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00001760: 2020 2020 6c6f 6f70 203d 2061 7379 6e63      loop = async
-00001770: 696f 2e67 6574 5f65 7665 6e74 5f6c 6f6f  io.get_event_loo
-00001780: 7028 290d 0a20 2020 2020 2020 2020 2020  p()..           
-00001790: 2020 2020 2072 6573 203d 2061 7761 6974       res = await
-000017a0: 206c 6f6f 702e 7275 6e5f 696e 5f65 7865   loop.run_in_exe
-000017b0: 6375 746f 7228 706f 6f6c 2c66 6e29 0d0a  cutor(pool,fn)..
-000017c0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000017d0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000017e0: 2020 2020 2069 6620 7365 6c66 2e61 7379       if self.asy
-000017f0: 6e63 6675 6e63 3a0d 0a20 2020 2020 2020  ncfunc:..       
-00001800: 2020 2020 2020 2020 2020 2020 2023 20e5               # .
-00001810: bc82 e6ad a5e6 89a7 e8a1 8c0d 0a20 2020  .............   
-00001820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001830: 2072 6573 203d 2061 7761 6974 2073 656c   res = await sel
-00001840: 662e 6361 6c6c 6162 6c65 282a 6172 6773  f.callable(*args
-00001850: 2c2a 2a64 6963 7473 290d 0a20 2020 2020  ,**dicts)..     
-00001860: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00001870: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001880: 2020 2020 2020 2320 e6ad a3e5 b8b8 e689        # ........
-00001890: a7e8 a18c 0d0a 2020 2020 2020 2020 2020  ......          
-000018a0: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
-000018b0: 7365 6c66 2e63 616c 6c61 626c 6528 2a61  self.callable(*a
-000018c0: 7267 732c 2a2a 6469 6374 7329 0d0a 0d0a  rgs,**dicts)....
-000018d0: 2020 2020 2020 2020 2020 2020 2320 332e              # 3.
-000018e0: e6a3 80e6 9fa5 e8bf 94e5 9b9e e580 bc0d  ................
-000018f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00001900: 7365 6c66 2e63 6865 636b 5265 7475 726e  self.checkReturn
-00001910: 2061 6e64 2073 656c 662e 7265 7475 726e   and self.return
-00001920: 5479 7065 3a0d 0a20 2020 2020 2020 2020  Type:..         
-00001930: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00001940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001950: 2072 6573 3d20 616c 6c6f 7754 7970 6528   res= allowType(
-00001960: 7265 732c 7365 6c66 2e72 6574 7572 6e54  res,self.returnT
-00001970: 7970 652c 7365 6c66 2e6e 616d 6529 0d0a  ype,self.name)..
-00001980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001990: 2020 2020 7265 7375 6c74 203d 2072 6573      result = res
-000019a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000019b0: 2020 6578 6365 7074 3a0d 0a20 2020 2020    except:..     
-000019c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000019d0: 7461 7465 203d 2055 7453 7461 7465 2e46  tate = UtState.F
-000019e0: 4149 4c45 440d 0a20 2020 2020 2020 2020  AILED..         
-000019f0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00001a00: 203d 2066 2252 6574 7572 6e20 7661 6c75   = f"Return valu
-00001a10: 6520 6572 726f 722e 277b 7479 7065 2872  e error.'{type(r
-00001a20: 6573 297d 2720 6973 206e 6f74 206f 6620  es)}' is not of 
-00001a30: 277b 7365 6c66 2e72 6574 7572 6e54 7970  '{self.returnTyp
-00001a40: 657d 2720 7479 7065 220d 0a20 2020 2020  e}' type"..     
-00001a50: 2020 2020 2020 2065 6c73 653a 2020 2020         else:    
-00001a60: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00001a70: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00001a80: 7375 6c74 203d 2072 6573 0d0a 2020 2020  sult = res..    
-00001a90: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00001aa0: 7469 6f6e 2061 7320 653a 0d0a 2020 2020  tion as e:..    
-00001ab0: 2020 2020 2020 2020 7374 6174 6520 3d20          state = 
-00001ac0: 5574 5374 6174 652e 4641 494c 4544 0d0a  UtState.FAILED..
-00001ad0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00001ae0: 7220 3d20 7374 7228 6529 0d0a 2020 2020  r = str(e)..    
-00001af0: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
-00001b00: 7475 726e 2073 7461 7465 2c72 6573 756c  turn state,resul
-00001b10: 742c 6572 726f 720d 0a0d 0a0d 0a63 6c61  t,error......cla
-00001b20: 7373 2052 6567 6973 7465 723a 0d0a 2020  ss Register:..  
-00001b30: 2020 2222 220d 0a20 2020 2023 20e6 b3a8    """..    # ...
-00001b40: e586 8ce7 b1bb efbc 8ce7 94a8 e4ba 8ee6  ................
-00001b50: b3a8 e586 8ce6 9cac e59c b0e7 9a84 e58f  ................
-00001b60: afe8 b083 e794 a8e5 87bd e695 b0ef bc8c  ................
-00001b70: 0d0a 2020 2020 e694 afe6 8c81 2872 7063  ..    ......(rpc
-00001b80: e380 8167 6574 e380 8170 6f73 7429 e6b3  ...get...post)..
-00001b90: a8e5 868c 0d0a 0d0a 2020 2020 4172 6773  ........    Args
-00001ba0: 3a0d 0a20 2020 2020 2020 2063 6865 636b  :..        check
-00001bb0: 5061 7261 6d73 2028 626f 6f6c 293a 20e8  Params (bool): .
-00001bc0: b083 e794 a8e6 b3a8 e586 8ce5 87bd e695  ................
-00001bd0: b0e6 8896 e696 b9e6 b395 e697 b6ef bc8c  ................
-00001be0: e698 afe5 90a6 e6a3 80e6 9fa5 e58f 82e6  ................
-00001bf0: 95b0 e7b1 bbe5 9e8b efbc 8ce5 bc80 e590  ................
-00001c00: afe5 908e e5bd 93e7 b1bb e59e 8be4 b8ba  ................
-00001c10: e695 b0e6 8dae e6a8 a1e5 9e8b e697 b6e5  ................
-00001c20: 8faf e4bb a5e8 87aa e58a a8e8 bdac e68d  ................
-00001c30: a20d 0a20 2020 2020 2020 2063 6865 636b  ...        check
-00001c40: 5265 7475 726e 2028 626f 6f6c 293a 20e8  Return (bool): .
-00001c50: b083 e794 a8e6 b3a8 e586 8ce5 87bd e695  ................
-00001c60: b0e6 8896 e696 b9e6 b395 e697 b6ef bc8c  ................
-00001c70: e698 afe5 90a6 e6a3 80e6 9fa5 e8bf 94e5  ................
-00001c80: 9b9e e580 bce7 b1bb e59e 8bef bc8c e5bc  ................
-00001c90: 80e5 90af e590 8ee5 bd93 e7b1 bbe5 9e8b  ................
-00001ca0: e4b8 bae6 95b0 e68d aee6 a8a1 e59e 8be6  ................
-00001cb0: 97b6 e58f afe4 bba5 e887 aae5 8aa8 e8bd  ................
-00001cc0: ace6 8da2 0d0a 2020 2020 2020 2020 706f  ......        po
-00001cd0: 6f6c 3a20 e8bf 9be7 a88b e6b1 a0e5 afb9  ol: ............
-00001ce0: e8b1 a10d 0a20 2020 20e6 b3a8 3ae5 8faa  .....    ...:...
-00001cf0: e69c 89e6 b3a8 e586 8ce5 87bd e695 b0e6  ................
-00001d00: 8896 e696 b9e6 b395 e68c 87e5 ae9a e4ba  ................
-00001d10: 86e7 b1bb e59e 8be6 97b6 e4bb a5e4 b88a  ................
-00001d20: e58f 82e6 95b0 e689 8de4 bc9a e8b5 b7e4  ................
-00001d30: bd9c e794 a80d 0a20 2020 2022 2222 0d0a  .......    """..
-00001d40: 2020 2020 5f5f 736c 6f74 735f 5f20 3d20      __slots__ = 
-00001d50: 2827 5f5f 7270 635f 6d65 7468 6f64 7327  ('__rpc_methods'
-00001d60: 2c27 5f5f 6765 745f 6d65 7468 6f64 7327  ,'__get_methods'
-00001d70: 2c27 5f5f 706f 7374 5f6d 6574 686f 6473  ,'__post_methods
-00001d80: 272c 275f 5f63 6865 636b 5061 7261 6d73  ','__checkParams
-00001d90: 272c 275f 5f63 6865 636b 5265 7475 726e  ','__checkReturn
-00001da0: 272c 275f 7465 6d70 5f6f 7074 7327 2c27  ','_temp_opts','
-00001db0: 5f77 6f72 6b65 7273 2729 0d0a 0d0a 2020  _workers')....  
-00001dc0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00001dd0: 656c 662c 6368 6563 6b50 6172 616d 733a  elf,checkParams:
-00001de0: 626f 6f6c 3d54 7275 652c 6368 6563 6b52  bool=True,checkR
-00001df0: 6574 7572 6e3a 626f 6f6c 3d54 7275 652c  eturn:bool=True,
-00001e00: 776f 726b 6572 733a 696e 743d 3029 202d  workers:int=0) -
-00001e10: 3e20 4e6f 6e65 3a0d 0a20 2020 2020 2020  > None:..       
-00001e20: 2073 656c 662e 5f5f 7270 635f 6d65 7468   self.__rpc_meth
-00001e30: 6f64 7320 3d20 6469 6374 2829 2020 2020  ods = dict()    
-00001e40: 2023 207b 6d65 7468 6f64 5f6e 616d 653a   # {method_name:
-00001e50: 7b63 616c 6c61 626c 653a 6361 6c6c 6162  {callable:callab
-00001e60: 6c65 2c7d 7d0d 0a20 2020 2020 2020 2073  le,}}..        s
-00001e70: 656c 662e 5f5f 6765 745f 6d65 7468 6f64  elf.__get_method
-00001e80: 7320 3d20 6469 6374 2829 2020 2020 2023  s = dict()     #
-00001e90: 207b 7061 7468 3a7b 6361 6c6c 6162 6c65   {path:{callable
-00001ea0: 3a63 616c 6c61 626c 652c 696e 666f 3a7b  :callable,info:{
-00001eb0: 7d7d 7d0d 0a20 2020 2020 2020 2073 656c  }}}..        sel
-00001ec0: 662e 5f5f 706f 7374 5f6d 6574 686f 6473  f.__post_methods
-00001ed0: 203d 2064 6963 7428 2920 2020 2023 207b   = dict()    # {
-00001ee0: 7061 7468 3a7b 6361 6c6c 6162 6c65 3a63  path:{callable:c
-00001ef0: 616c 6c61 626c 652c 696e 666f 3a7b 7d7d  allable,info:{}}
-00001f00: 7d0d 0a20 2020 2020 2020 2073 656c 662e  }..        self.
-00001f10: 5f5f 6368 6563 6b50 6172 616d 7320 3d20  __checkParams = 
-00001f20: 6368 6563 6b50 6172 616d 730d 0a20 2020  checkParams..   
-00001f30: 2020 2020 2073 656c 662e 5f5f 6368 6563       self.__chec
-00001f40: 6b52 6574 7572 6e20 3d20 6368 6563 6b52  kReturn = checkR
-00001f50: 6574 7572 6e0d 0a20 2020 2020 2020 2073  eturn..        s
-00001f60: 656c 662e 5f74 656d 705f 6f70 7473 203d  elf._temp_opts =
-00001f70: 2064 6963 7428 290d 0a20 2020 2020 2020   dict()..       
-00001f80: 2073 656c 662e 5f77 6f72 6b65 7273 203d   self._workers =
-00001f90: 2077 6f72 6b65 7273 0d0a 0d0a 2020 2020   workers....    
-00001fa0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-00001fb0: 6566 206d 6574 686f 6473 5f6f 665f 6765  ef methods_of_ge
-00001fc0: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
-00001fd0: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
-00001fe0: 6765 745f 6d65 7468 6f64 730d 0a20 2020  get_methods..   
-00001ff0: 200d 0a20 2020 2040 7072 6f70 6572 7479   ..    @property
-00002000: 0d0a 2020 2020 6465 6620 6d65 7468 6f64  ..    def method
-00002010: 735f 6f66 5f70 6f73 7428 7365 6c66 293a  s_of_post(self):
-00002020: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00002030: 2073 656c 662e 5f5f 706f 7374 5f6d 6574   self.__post_met
-00002040: 686f 6473 0d0a 0d0a 2020 2020 4070 726f  hods....    @pro
-00002050: 7065 7274 790d 0a20 2020 2064 6566 206d  perty..    def m
-00002060: 6574 686f 6473 5f6f 665f 7270 6328 7365  ethods_of_rpc(se
-00002070: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-00002080: 7475 726e 2073 656c 662e 5f5f 7270 635f  turn self.__rpc_
-00002090: 6d65 7468 6f64 730d 0a20 2020 200d 0a0d  methods..    ...
-000020a0: 0a20 2020 2064 6566 2072 7063 2873 656c  .    def rpc(sel
-000020b0: 662c 2a66 6e2c 6e61 6d65 3d4e 6f6e 652c  f,*fn,name=None,
-000020c0: 696e 735f 6172 6773 3a74 7570 6c65 3d74  ins_args:tuple=t
-000020d0: 7570 6c65 2829 2c69 6e73 5f6b 7764 733a  uple(),ins_kwds:
-000020e0: 6469 6374 3d64 6963 7428 292c 2a2a 6f70  dict=dict(),**op
-000020f0: 7473 293a 0d0a 2020 2020 2020 2020 2222  ts):..        ""
-00002100: 2223 2052 5043 e6b3 a8e5 868c 0d0a 2020  "# RPC........  
-00002110: 2020 2020 2020 e694 afe6 8c81 efbc 9ae7        ..........
-00002120: b1bb 2fe7 b1bb e696 b9e6 b395 2fe7 b1bb  ../........./...
-00002130: e5ae 9ee4 be8b 2fe5 87bd e695 b0e7 9a84  ....../.........
-00002140: e6b3 a8e5 868c 0d0a 0d0a 2020 2020 2020  ..........      
-00002150: 2020 2323 2031 2ee8 a385 e9a5 b0e5 99a8    ## 1..........
-00002160: e8b0 83e7 94a8 e697 b6e5 8f82 e695 b0e8  ................
-00002170: a7a3 e987 8a20 0d0a 2020 2020 2020 2020  ..... ..        
-00002180: 2020 6040 7265 6769 7374 6572 2e72 7063    `@register.rpc
-00002190: 286e 616d 653d 3f2c 696e 735f 6b77 6473  (name=?,ins_kwds
-000021a0: 3d3f 2c69 6e73 5f61 7267 733d 3f2c 2a2a  =?,ins_args=?,**
-000021b0: 6f70 7473 2960 0d0a 2020 2020 2020 2020  opts)`..        
-000021c0: 4174 7472 6962 7574 6573 3a0d 0a20 2020  Attributes:..   
-000021d0: 2020 2020 2020 2020 206e 616d 6520 2873           name (s
-000021e0: 7472 293a 20e8 a2ab e8bf 9ce7 a88b e8b0  tr): ...........
-000021f0: 83e7 94a8 e79a 84e6 96b9 e6b3 95e5 908d  ................
-00002200: e7a7 b0ef bc8c e99d 9e60 636c 6173 7360  .........`class`
-00002210: e4b8 bae5 8faf e980 89ef bc8c 6063 6c61  ............`cla
-00002220: 7373 60e4 b8ba e5bf 85e5 a1ab 0d0a 2020  ss`...........  
-00002230: 2020 2020 2020 2020 2020 696e 735f 6172            ins_ar
-00002240: 6773 2028 7475 706c 6529 3a20 e58f aae6  gs (tuple): ....
-00002250: 9c89 e6b3 a8e5 868c 6063 6c61 7373 60e6  ........`class`.
-00002260: 97b6 e689 8de6 9c89 e8bf 99e4 b8aa e980  ................
-00002270: 89e9 a1b9 efbc 8ce4 b8ba e7b1 bbe5 ae9e  ................
-00002280: e4be 8be5 8c96 e79a 84e5 8f82 e695 b00d  ................
-00002290: 0a20 2020 2020 2020 2020 2020 2069 6e73  .            ins
-000022a0: 5f6b 7764 7320 2864 6963 7429 3a20 e58f  _kwds (dict): ..
-000022b0: aae6 9c89 e6b3 a8e5 868c 6063 6c61 7373  ..........`class
-000022c0: 60e6 97b6 e689 8de6 9c89 e8bf 99e4 b8aa  `...............
-000022d0: e980 89e9 a1b9 efbc 8ce4 b8ba e7b1 bbe5  ................
-000022e0: ae9e e4be 8be5 8c96 e79a 84e5 85b3 e994  ................
-000022f0: aee5 ad97 e58f 82e6 95b0 0d0a 2020 2020  ............    
-00002300: 2020 2020 2020 2020 2a2a 6f70 7473 3a20          **opts: 
-00002310: e980 89e9 a1b9 e380 82e4 be8b e5a6 823a  ...............:
-00002320: 2075 7365 5072 6f63 6573 7320 3d20 5472   useProcess = Tr
-00002330: 7565 20e4 bdbf e794 a8e5 ad90 e8bf 9be7  ue .............
-00002340: a88b e689 a7e8 a18c efbc 8ce8 bf98 e69c  ................
-00002350: 8920 6368 6563 6b50 6172 616d 73e3 8081  . checkParams...
-00002360: 6368 6563 6b52 6574 7572 6ee7 ad89 0d0a  checkReturn.....
-00002370: 0d0a 2020 2020 2020 2020 e6b3 a83a 20e6  ..        ...: .
-00002380: b3a8 e586 8ce9 9d9e 6063 6c61 7373 60e6  ........`class`.
-00002390: 8896 6063 6c61 7373 60e5 ae9e e4be 8be6  ..`class`.......
-000023a0: 97b6 efbc 8ce5 8faf e694 afe6 8c81 e697  ................
-000023b0: a0e5 8f82 e8b0 83e7 94a8 2060 4072 6567  .......... `@reg
-000023c0: 6973 7465 722e 7270 6360 0d0a 2020 2020  ister.rpc`..    
-000023d0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-000023e0: 2020 2323 2032 2ee6 96b9 e6b3 95e8 b083    ## 2..........
-000023f0: e794 a8e6 97b6 e58f 82e6 95b0 e8a7 a3e9  ................
-00002400: 878a 200d 0a20 2020 2020 2020 2060 7265  .. ..        `re
-00002410: 6769 7374 6572 2e72 7063 2866 6e2c 6e61  gister.rpc(fn,na
-00002420: 6d65 3d3f 2c69 6e73 5f6b 7764 733d 3f2c  me=?,ins_kwds=?,
-00002430: 696e 735f 6172 6773 3d3f 2c2a 2a6f 7074  ins_args=?,**opt
-00002440: 7329 600d 0a20 2020 2020 2020 2041 7474  s)`..        Att
-00002450: 7269 6275 7465 733a 0d0a 2020 2020 2020  ributes:..      
-00002460: 2020 2020 2020 666e 3a20 e8a6 81e6 b3a8        fn: ......
-00002470: e586 8ce7 9a84 e587 bde6 95b0 e688 96e6  ................
-00002480: 96b9 e6b3 95ef bc8c e4b9 9fe5 8faf e4bb  ................
-00002490: a5e6 98af 6063 6c61 7373 60e6 8896 e880  ....`class`.....
-000024a0: 8560 636c 6173 7360 e5ae 9ee4 be8b 0d0a  .`class`........
-000024b0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000024c0: 2028 7374 7229 3a20 e8a2 abe8 bf9c e7a8   (str): ........
-000024d0: 8be8 b083 e794 a8e7 9a84 e696 b9e6 b395  ................
-000024e0: e590 8de7 a7b0 0d0a 2020 2020 2020 2020  ........        
-000024f0: 2020 2020 696e 735f 6172 6773 2028 7475      ins_args (tu
-00002500: 706c 6529 3a20 e58f aae6 9c89 e6b3 a8e5  ple): ..........
-00002510: 868c 6063 6c61 7373 60e6 97b6 e689 8de6  ..`class`.......
-00002520: 9c89 e8bf 99e4 b8aa e980 89e9 a1b9 efbc  ................
-00002530: 8ce4 b8ba e7b1 bbe5 ae9e e4be 8be5 8c96  ................
-00002540: e79a 84e5 8f82 e695 b00d 0a20 2020 2020  ...........     
-00002550: 2020 2020 2020 2069 6e73 5f6b 7764 7320         ins_kwds 
-00002560: 2864 6963 7429 3a20 e58f aae6 9c89 e6b3  (dict): ........
-00002570: a8e5 868c 6063 6c61 7373 60e6 97b6 e689  ....`class`.....
-00002580: 8de6 9c89 e8bf 99e4 b8aa e980 89e9 a1b9  ................
-00002590: efbc 8ce4 b8ba e7b1 bbe5 ae9e e4be 8be5  ................
-000025a0: 8c96 e79a 84e5 85b3 e994 aee5 ad97 e58f  ................
-000025b0: 82e6 95b0 0d0a 2020 2020 2020 2020 2020  ......          
-000025c0: 2020 2a2a 6f70 7473 3a20 e980 89e9 a1b9    **opts: ......
-000025d0: e380 82e4 be8b e5a6 823a 2075 7365 5072  .........: usePr
-000025e0: 6f63 6573 7320 3d20 5472 7565 20e4 bdbf  ocess = True ...
-000025f0: e794 a8e5 ad90 e8bf 9be7 a88b e689 a7e8  ................
-00002600: a18c efbc 8ce8 bf98 e69c 8920 6368 6563  ........... chec
-00002610: 6b50 6172 616d 73e3 8081 6368 6563 6b52  kParams...checkR
-00002620: 6574 7572 6ee7 ad89 0d0a 0d0a 2020 2020  eturn.......    
-00002630: 2020 2020 2222 2220 200d 0a20 2020 2020      """  ..     
-00002640: 2020 2066 6e20 3d20 666e 5b30 5d20 6966     fn = fn[0] if
-00002650: 2066 6e20 656c 7365 204e 6f6e 650d 0a20   fn else None.. 
-00002660: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00002670: 6c66 2e5f 7265 6769 7374 6572 2866 6e2c  lf._register(fn,
-00002680: 6e61 6d65 2c27 7270 6327 2c69 6e73 5f61  name,'rpc',ins_a
-00002690: 7267 733d 696e 735f 6172 6773 2c69 6e73  rgs=ins_args,ins
-000026a0: 5f6b 7764 733d 696e 735f 6b77 6473 2c6f  _kwds=ins_kwds,o
-000026b0: 7074 733d 6f70 7473 290d 0a0d 0a0d 0a0d  pts=opts).......
-000026c0: 0a20 2020 2064 6566 2067 6574 2873 656c  .    def get(sel
-000026d0: 662c 2a66 6e2c 7061 7468 3a73 7472 3d4e  f,*fn,path:str=N
-000026e0: 6f6e 652c 696e 735f 6172 6773 3a74 7570  one,ins_args:tup
-000026f0: 6c65 3d74 7570 6c65 2829 2c69 6e73 5f6b  le=tuple(),ins_k
-00002700: 7764 733a 6469 6374 3d64 6963 7428 292c  wds:dict=dict(),
-00002710: 2a2a 6f70 7473 293a 0d0a 2020 2020 2020  **opts):..      
-00002720: 2020 2222 2223 2047 4554 e6b3 a8e5 868c    """# GET......
-00002730: 0d0a 0d0a 2020 2020 2020 2020 e585 b3e4  ....        ....
-00002740: ba8e e590 8de7 a7b0 3a0d 0a20 2020 2020  ........:..     
-00002750: 2020 2020 2020 20e5 908d e7a7 b0e5 bf85         .........
-00002760: e9a1 bbe6 98af e5b0 8fe5 8699 2ce5 a682  ............,...
-00002770: e99d 9ee5 b08f e586 99e4 bc9a e887 aae5  ................
-00002780: 8aa8 e8bd ace4 b8ba e5b0 8fe5 8699 e380  ................
-00002790: 82e5 908d e7a7 b0e5 898d e4bc 9ae5 8aa0  ................
-000027a0: e4b8 8a60 2f60 e696 9ce6 9da0 efbc 8ce8  ...`/`..........
-000027b0: bdac e4b8 bae8 b7af e5be 840d 0a0d 0a20  ............... 
-000027c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000027d0: 20e6 94af e68c 81ef bc9a e7b1 bb2f e7b1   ............/..
-000027e0: bbe6 96b9 e6b3 952f e7b1 bbe5 ae9e e4be  ......./........
-000027f0: 8b2f e587 bde6 95b0 e79a 84e6 b3a8 e586  ./..............
-00002800: 8c0d 0a0d 0a20 2020 2020 2020 2023 2320  .....        ## 
-00002810: 312e e8a3 85e9 a5b0 e599 a8e8 b083 e794  1...............
-00002820: a8e6 97b6 e58f 82e6 95b0 e8a7 a3e9 878a  ................
-00002830: 200d 0a20 2020 2020 2020 2020 2060 4072   ..          `@r
-00002840: 6567 6973 7465 722e 6765 7428 7061 7468  egister.get(path
-00002850: 3d3f 2c69 6e73 5f6b 7764 733d 3f2c 696e  =?,ins_kwds=?,in
-00002860: 735f 6172 6773 3d3f 2c2a 2a6f 7074 7329  s_args=?,**opts)
-00002870: 600d 0a20 2020 2020 2020 2041 7474 7269  `..        Attri
-00002880: 6275 7465 733a 0d0a 2020 2020 2020 2020  butes:..        
-00002890: 2020 2020 7061 7468 2028 7374 7229 3a20      path (str): 
-000028a0: e6b3 a8e5 868c e79a 84e8 b7af e5be 84e5  ................
-000028b0: 908d e7a7 b0ef bc8c e99d 9e60 636c 6173  ...........`clas
-000028c0: 7360 e4b8 bae5 8faf e980 89ef bc8c 6063  s`............`c
-000028d0: 6c61 7373 60e4 b8ba e5bf 85e5 a1ab 0d0a  lass`...........
-000028e0: 2020 2020 2020 2020 2020 2020 696e 735f              ins_
-000028f0: 6172 6773 2028 7475 706c 6529 3a20 e58f  args (tuple): ..
-00002900: aae6 9c89 e6b3 a8e5 868c 6063 6c61 7373  ..........`class
-00002910: 60e6 97b6 e689 8de6 9c89 e8bf 99e4 b8aa  `...............
-00002920: e980 89e9 a1b9 efbc 8ce4 b8ba e7b1 bbe5  ................
-00002930: ae9e e4be 8be5 8c96 e79a 84e5 8f82 e695  ................
-00002940: b00d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00002950: 6e73 5f6b 7764 7320 2864 6963 7429 3a20  ns_kwds (dict): 
-00002960: e58f aae6 9c89 e6b3 a8e5 868c 6063 6c61  ............`cla
-00002970: 7373 60e6 97b6 e689 8de6 9c89 e8bf 99e4  ss`.............
-00002980: b8aa e980 89e9 a1b9 efbc 8ce4 b8ba e7b1  ................
-00002990: bbe5 ae9e e4be 8be5 8c96 e79a 84e5 85b3  ................
-000029a0: e994 aee5 ad97 e58f 82e6 95b0 0d0a 2020  ..............  
-000029b0: 2020 2020 2020 2020 2020 2a2a 6f70 7473            **opts
-000029c0: 3a20 e980 89e9 a1b9 e380 82e4 be8b e5a6  : ..............
-000029d0: 823a 2075 7365 5072 6f63 6573 7320 3d20  .: useProcess = 
-000029e0: 5472 7565 20e4 bdbf e794 a8e5 ad90 e8bf  True ...........
-000029f0: 9be7 a88b e689 a7e8 a18c efbc 8ce8 bf98  ................
-00002a00: e69c 8920 6368 6563 6b50 6172 616d 73e3  ... checkParams.
-00002a10: 8081 6368 6563 6b52 6574 7572 6ee7 ad89  ..checkReturn...
-00002a20: 0d0a 0d0a 0d0a 2020 2020 2020 2020 e6b3  ......        ..
-00002a30: a83a 20e6 b3a8 e586 8ce9 9d9e 6063 6c61  .: .........`cla
-00002a40: 7373 60e6 8896 6063 6c61 7373 60e5 ae9e  ss`...`class`...
-00002a50: e4be 8be6 97b6 efbc 8ce5 8faf e694 afe6  ................
-00002a60: 8c81 e697 a0e5 8f82 e8b0 83e7 94a8 2060  .............. `
-00002a70: 4072 6567 6973 7465 722e 6765 7460 0d0a  @register.get`..
-00002a80: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00002a90: 2020 2020 2020 2323 2032 2ee6 96b9 e6b3        ## 2......
-00002aa0: 95e8 b083 e794 a8e6 97b6 e58f 82e6 95b0  ................
-00002ab0: e8a7 a3e9 878a 200d 0a20 2020 2020 2020  ...... ..       
-00002ac0: 2060 7265 6769 7374 6572 2e67 6574 2866   `register.get(f
-00002ad0: 6e2c 7061 7468 3d3f 2c69 6e73 5f6b 7764  n,path=?,ins_kwd
-00002ae0: 733d 3f2c 696e 735f 6172 6773 3d3f 2c2a  s=?,ins_args=?,*
-00002af0: 2a6f 7074 7329 600d 0a20 2020 2020 2020  *opts)`..       
-00002b00: 2041 7474 7269 6275 7465 733a 0d0a 2020   Attributes:..  
-00002b10: 2020 2020 2020 2020 2020 666e 3a20 e8a6            fn: ..
-00002b20: 81e6 b3a8 e586 8ce7 9a84 e587 bde6 95b0  ................
-00002b30: e688 96e6 96b9 e6b3 95ef bc8c e4b9 9fe5  ................
-00002b40: 8faf e4bb a5e6 98af 6063 6c61 7373 60e6  ........`class`.
-00002b50: 8896 e880 8560 636c 6173 7360 e5ae 9ee4  .....`class`....
-00002b60: be8b 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00002b70: 7061 7468 2028 7374 7229 3a20 e6b3 a8e5  path (str): ....
-00002b80: 868c e79a 84e8 b7af e5be 84e5 908d e7a7  ................
-00002b90: b00d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00002ba0: 6e73 5f61 7267 7320 2874 7570 6c65 293a  ns_args (tuple):
-00002bb0: 20e5 8faa e69c 89e6 b3a8 e586 8c60 636c   ............`cl
-00002bc0: 6173 7360 e697 b6e6 898d e69c 89e8 bf99  ass`............
-00002bd0: e4b8 aae9 8089 e9a1 b9ef bc8c e4b8 bae7  ................
-00002be0: b1bb e5ae 9ee4 be8b e58c 96e7 9a84 e58f  ................
-00002bf0: 82e6 95b0 0d0a 2020 2020 2020 2020 2020  ......          
-00002c00: 2020 696e 735f 6b77 6473 2028 6469 6374    ins_kwds (dict
-00002c10: 293a 20e5 8faa e69c 89e6 b3a8 e586 8c60  ): ............`
-00002c20: 636c 6173 7360 e697 b6e6 898d e69c 89e8  class`..........
-00002c30: bf99 e4b8 aae9 8089 e9a1 b9ef bc8c e4b8  ................
-00002c40: bae7 b1bb e5ae 9ee4 be8b e58c 96e7 9a84  ................
-00002c50: e585 b3e9 94ae e5ad 97e5 8f82 e695 b00d  ................
-00002c60: 0a20 2020 2020 2020 2020 2020 202a 2a6f  .            **o
-00002c70: 7074 733a 20e9 8089 e9a1 b9e3 8082 e4be  pts: ...........
-00002c80: 8be5 a682 3a20 7573 6550 726f 6365 7373  ....: useProcess
-00002c90: 203d 2054 7275 6520 e4bd bfe7 94a8 e5ad   = True ........
-00002ca0: 90e8 bf9b e7a8 8be6 89a7 e8a1 8cef bc8c  ................
-00002cb0: e8bf 98e6 9c89 2063 6865 636b 5061 7261  ...... checkPara
-00002cc0: 6d73 e380 8163 6865 636b 5265 7475 726e  ms...checkReturn
-00002cd0: e7ad 890d 0a0d 0a20 2020 2020 2020 2022  .......        "
-00002ce0: 2222 0d0a 2020 2020 2020 2020 666e 203d  ""..        fn =
-00002cf0: 2066 6e5b 305d 2069 6620 666e 2065 6c73   fn[0] if fn els
-00002d00: 6520 4e6f 6e65 0d0a 2020 2020 2020 2020  e None..        
-00002d10: 7265 7475 726e 2073 656c 662e 5f72 6567  return self._reg
-00002d20: 6973 7465 7228 666e 2c70 6174 682c 2767  ister(fn,path,'g
-00002d30: 6574 272c 696e 735f 6172 6773 3d69 6e73  et',ins_args=ins
-00002d40: 5f61 7267 732c 696e 735f 6b77 6473 3d69  _args,ins_kwds=i
-00002d50: 6e73 5f6b 7764 732c 6f70 7473 3d6f 7074  ns_kwds,opts=opt
-00002d60: 7329 0d0a 0d0a 0d0a 0d0a 2020 2020 6465  s)........    de
-00002d70: 6620 706f 7374 2873 656c 662c 2a66 6e2c  f post(self,*fn,
-00002d80: 7061 7468 3a73 7472 3d4e 6f6e 652c 696e  path:str=None,in
-00002d90: 735f 6172 6773 3a74 7570 6c65 3d74 7570  s_args:tuple=tup
-00002da0: 6c65 2829 2c69 6e73 5f6b 7764 733a 6469  le(),ins_kwds:di
-00002db0: 6374 3d64 6963 7428 292c 2a2a 6f70 7473  ct=dict(),**opts
-00002dc0: 293a 2020 2020 2020 0d0a 2020 2020 2020  ):      ..      
-00002dd0: 2020 2222 2223 2050 4f53 54e6 b3a8 e586    """# POST.....
-00002de0: 8c0d 0a20 2020 2020 2020 20e5 85b3 e4ba  ...        .....
-00002df0: 8ee5 908d e7a7 b03a 0d0a 2020 2020 2020  .......:..      
-00002e00: 2020 2020 2020 e590 8de7 a7b0 e5bf 85e9        ..........
-00002e10: a1bb e698 afe5 b08f e586 992c e5a6 82e9  ...........,....
-00002e20: 9d9e e5b0 8fe5 8699 e4bc 9ae8 87aa e58a  ................
-00002e30: a8e8 bdac e4b8 bae5 b08f e586 99e3 8082  ................
-00002e40: e590 8de7 a7b0 e589 8de4 bc9a e58a a0e4  ................
-00002e50: b88a 602f 60e6 969c e69d a0ef bc8c e8bd  ..`/`...........
-00002e60: ace4 b8ba e8b7 afe5 be84 0d0a 0d0a 2020  ..............  
-00002e70: 2020 2020 2020 e694 afe6 8c81 efbc 9ae7        ..........
-00002e80: b1bb 2fe7 b1bb e696 b9e6 b395 2fe7 b1bb  ../........./...
-00002e90: e5ae 9ee4 be8b 2fe5 87bd e695 b0e7 9a84  ....../.........
-00002ea0: e6b3 a8e5 868c 0d0a 0d0a 2020 2020 2020  ..........      
-00002eb0: 2020 2323 2031 2ee8 a385 e9a5 b0e5 99a8    ## 1..........
-00002ec0: e8b0 83e7 94a8 e697 b6e5 8f82 e695 b0e8  ................
-00002ed0: a7a3 e987 8a20 0d0a 2020 2020 2020 2020  ..... ..        
-00002ee0: 2020 6040 7265 6769 7374 6572 2e70 6f73    `@register.pos
-00002ef0: 7428 7061 7468 3d3f 2c69 6e73 5f6b 7764  t(path=?,ins_kwd
-00002f00: 733d 3f2c 696e 735f 6172 6773 3d3f 2c2a  s=?,ins_args=?,*
-00002f10: 2a6f 7074 7329 600d 0a20 2020 2020 2020  *opts)`..       
-00002f20: 2041 7474 7269 6275 7465 733a 0d0a 2020   Attributes:..  
-00002f30: 2020 2020 2020 2020 2020 7061 7468 2028            path (
-00002f40: 7374 7229 3a20 e6b3 a8e5 868c e79a 84e8  str): ..........
-00002f50: b7af e5be 84e5 908d e7a7 b0ef bc8c e99d  ................
-00002f60: 9e60 636c 6173 7360 e4b8 bae5 8faf e980  .`class`........
-00002f70: 89ef bc8c 6063 6c61 7373 60e4 b8ba e5bf  ....`class`.....
-00002f80: 85e5 a1ab 0d0a 2020 2020 2020 2020 2020  ......          
-00002f90: 2020 696e 735f 6172 6773 2028 7475 706c    ins_args (tupl
-00002fa0: 6529 3a20 e58f aae6 9c89 e6b3 a8e5 868c  e): ............
-00002fb0: 6063 6c61 7373 60e6 97b6 e689 8de6 9c89  `class`.........
-00002fc0: e8bf 99e4 b8aa e980 89e9 a1b9 efbc 8ce4  ................
-00002fd0: b8ba e7b1 bbe5 ae9e e4be 8be5 8c96 e79a  ................
-00002fe0: 84e5 8f82 e695 b00d 0a20 2020 2020 2020  .........       
-00002ff0: 2020 2020 2069 6e73 5f6b 7764 7320 2864       ins_kwds (d
-00003000: 6963 7429 3a20 e58f aae6 9c89 e6b3 a8e5  ict): ..........
-00003010: 868c 6063 6c61 7373 60e6 97b6 e689 8de6  ..`class`.......
-00003020: 9c89 e8bf 99e4 b8aa e980 89e9 a1b9 efbc  ................
-00003030: 8ce4 b8ba e7b1 bbe5 ae9e e4be 8be5 8c96  ................
-00003040: e79a 84e5 85b3 e994 aee5 ad97 e58f 82e6  ................
-00003050: 95b0 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00003060: 2a2a 6f70 7473 3a20 e980 89e9 a1b9 e380  **opts: ........
-00003070: 82e4 be8b e5a6 823a 2075 7365 5072 6f63  .......: useProc
-00003080: 6573 7320 3d20 5472 7565 20e4 bdbf e794  ess = True .....
-00003090: a8e5 ad90 e8bf 9be7 a88b e689 a7e8 a18c  ................
-000030a0: efbc 8ce8 bf98 e69c 8920 6368 6563 6b50  ......... checkP
-000030b0: 6172 616d 73e3 8081 6368 6563 6b52 6574  arams...checkRet
-000030c0: 7572 6ee7 ad89 0d0a 0d0a 2020 2020 2020  urn.......      
-000030d0: 2020 e6b3 a83a 20e6 b3a8 e586 8ce9 9d9e    ...: .........
-000030e0: 6063 6c61 7373 60e6 8896 6063 6c61 7373  `class`...`class
-000030f0: 60e5 ae9e e4be 8be6 97b6 efbc 8ce5 8faf  `...............
-00003100: e694 afe6 8c81 e697 a0e5 8f82 e8b0 83e7  ................
-00003110: 94a8 2060 4072 6567 6973 7465 722e 706f  .. `@register.po
-00003120: 7374 600d 0a20 2020 2020 2020 2020 2020  st`..           
-00003130: 200d 0a20 2020 2020 2020 2023 2320 322e   ..        ## 2.
-00003140: e696 b9e6 b395 e8b0 83e7 94a8 e697 b6e5  ................
-00003150: 8f82 e695 b0e8 a7a3 e987 8a20 0d0a 2020  ........... ..  
-00003160: 2020 2020 2020 6072 6567 6973 7465 722e        `register.
-00003170: 706f 7374 2866 6e2c 7061 7468 3d3f 2c69  post(fn,path=?,i
-00003180: 6e73 5f6b 7764 733d 3f2c 696e 735f 6172  ns_kwds=?,ins_ar
-00003190: 6773 3d3f 2c2a 2a6f 7074 7329 600d 0a20  gs=?,**opts)`.. 
-000031a0: 2020 2020 2020 2041 7474 7269 6275 7465         Attribute
-000031b0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000031c0: 666e 3a20 e8a6 81e6 b3a8 e586 8ce7 9a84  fn: ............
-000031d0: e587 bde6 95b0 e688 96e6 96b9 e6b3 95ef  ................
-000031e0: bc8c e4b9 9fe5 8faf e4bb a5e6 98af 6063  ..............`c
-000031f0: 6c61 7373 60e6 8896 e880 8560 636c 6173  lass`......`clas
-00003200: 7360 e5ae 9ee4 be8b 0d0a 2020 2020 2020  s`........      
-00003210: 2020 2020 2020 7061 7468 2028 7374 7229        path (str)
-00003220: 3a20 e6b3 a8e5 868c e79a 84e8 b7af e5be  : ..............
-00003230: 84e5 908d e7a7 b00d 0a20 2020 2020 2020  .........       
-00003240: 2020 2020 2069 6e73 5f61 7267 7320 2874       ins_args (t
-00003250: 7570 6c65 293a 20e5 8faa e69c 89e6 b3a8  uple): .........
-00003260: e586 8c60 636c 6173 7360 e697 b6e6 898d  ...`class`......
-00003270: e69c 89e8 bf99 e4b8 aae9 8089 e9a1 b9ef  ................
-00003280: bc8c e4b8 bae7 b1bb e5ae 9ee4 be8b e58c  ................
-00003290: 96e7 9a84 e58f 82e6 95b0 0d0a 2020 2020  ............    
-000032a0: 2020 2020 2020 2020 696e 735f 6b77 6473          ins_kwds
-000032b0: 2028 6469 6374 293a 20e5 8faa e69c 89e6   (dict): .......
-000032c0: b3a8 e586 8c60 636c 6173 7360 e697 b6e6  .....`class`....
-000032d0: 898d e69c 89e8 bf99 e4b8 aae9 8089 e9a1  ................
-000032e0: b9ef bc8c e4b8 bae7 b1bb e5ae 9ee4 be8b  ................
-000032f0: e58c 96e7 9a84 e585 b3e9 94ae e5ad 97e5  ................
-00003300: 8f82 e695 b00d 0a20 2020 2020 2020 2020  .......         
-00003310: 2020 202a 2a6f 7074 733a 20e9 8089 e9a1     **opts: .....
-00003320: b9e3 8082 e4be 8be5 a682 3a20 7573 6550  ..........: useP
-00003330: 726f 6365 7373 203d 2054 7275 6520 e4bd  rocess = True ..
-00003340: bfe7 94a8 e5ad 90e8 bf9b e7a8 8be6 89a7  ................
-00003350: e8a1 8cef bc8c e8bf 98e6 9c89 2063 6865  ............ che
-00003360: 636b 5061 7261 6d73 e380 8163 6865 636b  ckParams...check
-00003370: 5265 7475 726e e7ad 890d 0a0d 0a20 2020  Return.......   
-00003380: 2020 2020 2022 2222 200d 0a20 2020 2020       """ ..     
-00003390: 2020 2066 6e20 3d20 666e 5b30 5d20 6966     fn = fn[0] if
-000033a0: 2066 6e20 656c 7365 204e 6f6e 650d 0a20   fn else None.. 
-000033b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000033c0: 6c66 2e5f 7265 6769 7374 6572 2866 6e2c  lf._register(fn,
-000033d0: 7061 7468 2c27 706f 7374 272c 696e 735f  path,'post',ins_
-000033e0: 6172 6773 3d69 6e73 5f61 7267 732c 696e  args=ins_args,in
-000033f0: 735f 6b77 6473 3d69 6e73 5f6b 7764 732c  s_kwds=ins_kwds,
-00003400: 6f70 7473 3d6f 7074 7329 0d0a 0d0a 0d0a  opts=opts)......
-00003410: 2020 2020 6465 6620 6372 6561 7452 4d65      def creatRMe
-00003420: 7468 6f64 2873 656c 662c 2a2a 6f70 7473  thod(self,**opts
-00003430: 293a 0d0a 2020 2020 2020 2020 2222 2223  ):..        """#
-00003440: 20e5 889b e5bb ba52 4d65 7468 6f64 e5ae   ......RMethod..
-00003450: 9ee4 be8b efbc 8ce5 b9b6 e4bf 9de5 ad98  ................
-00003460: e588 b0e5 afb9 e5ba 94e5 aeb9 e599 a8e4  ................
-00003470: b8ad e380 820d 0a20 2020 2020 2020 2023  .......        #
-00003480: 2320 6f70 7473 e58f 82e6 95b0 e5ad 97e6  # opts..........
-00003490: aeb5 0d0a 2020 2020 2020 2020 4174 7472  ....        Attr
-000034a0: 6962 7574 6573 3a0d 0a20 2020 2020 2020  ibutes:..       
-000034b0: 2020 2020 206e 616d 6520 2873 7472 293a       name (str):
-000034c0: 20e6 b3a8 e586 8ce7 9a84 e590 8de7 a7b0   ...............
-000034d0: e688 96e8 b7af e5be 840d 0a20 2020 2020  ...........     
-000034e0: 2020 2020 2020 206d 6574 686f 6454 7970         methodTyp
-000034f0: 6520 2873 7472 293a 20e6 b3a8 e586 8ce7  e (str): .......
-00003500: b1bb e59e 8b20 4745 5420 2f20 504f 5354  ..... GET / POST
-00003510: 202f 2052 5043 0d0a 2020 2020 2020 2020   / RPC..        
-00003520: 2020 2020 6361 6c6c 6162 6c65 2028 6361      callable (ca
-00003530: 6c6c 6162 6c65 293a 20e5 8faf e8b0 83e7  llable): .......
-00003540: 94a8 e79a 84e6 96b9 e6b3 952f e587 bde6  .........../....
-00003550: 95b0 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00003560: 6368 6563 6b50 6172 616d 733f 2028 626f  checkParams? (bo
-00003570: 6f6c 293a 20e5 8faf e980 89ef bc8c e698  ol): ...........
-00003580: afe5 90a6 e6a3 80e6 9fa5 e58f 82e6 95b0  ................
-00003590: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
-000035a0: 6563 6b52 6574 7572 6e3f 2028 626f 6f6c  eckReturn? (bool
-000035b0: 293a 20e5 8faf e980 89ef bc8c e698 afe5  ): .............
-000035c0: 90a6 e6a3 80e6 9fa5 e8bf 94e5 9b9e e580  ................
-000035d0: bc0d 0a20 2020 2020 2020 2020 2020 2075  ...            u
-000035e0: 7365 5072 6f63 6573 733f 2028 626f 6f6c  seProcess? (bool
-000035f0: 293a 2020 e58f afe9 8089 efbc 8ce6 98af  ):  ............
-00003600: e590 a6e4 bdbf e794 a8e5 ad90 e8bf 9be7  ................
-00003610: a88b e689 a7e8 a18c 0d0a 2020 2020 2020  ..........      
-00003620: 2020 2222 220d 0a20 2020 2020 2020 206e    """..        n
-00003630: 616d 653a 7374 7220 3d20 6f70 7473 2e67  ame:str = opts.g
-00003640: 6574 2827 6e61 6d65 2729 0d0a 2020 2020  et('name')..    
-00003650: 2020 2020 6d65 7468 6f64 5479 7065 3a73      methodType:s
-00003660: 7472 203d 206f 7074 732e 6765 7428 276d  tr = opts.get('m
-00003670: 6574 686f 6454 7970 6527 290d 0a0d 0a20  ethodType').... 
-00003680: 2020 2020 2020 206f 7074 735b 2775 7365         opts['use
-00003690: 5072 6f63 6573 7327 5d20 3d20 4661 6c73  Process'] = Fals
-000036a0: 6520 6966 206f 7074 732e 6765 7428 2775  e if opts.get('u
-000036b0: 7365 5072 6f63 6573 7327 2920 3d3d 204e  seProcess') == N
-000036c0: 6f6e 6520 656c 7365 206f 7074 732e 6765  one else opts.ge
-000036d0: 7428 2775 7365 5072 6f63 6573 7327 290d  t('useProcess').
-000036e0: 0a20 2020 2020 2020 206f 7074 735b 2763  .        opts['c
-000036f0: 6865 636b 5061 7261 6d73 275d 203d 2073  heckParams'] = s
-00003700: 656c 662e 5f5f 6368 6563 6b50 6172 616d  elf.__checkParam
-00003710: 7320 6966 206f 7074 732e 6765 7428 2763  s if opts.get('c
-00003720: 6865 636b 5061 7261 6d73 2729 203d 3d20  heckParams') == 
-00003730: 4e6f 6e65 2065 6c73 6520 6f70 7473 2e67  None else opts.g
-00003740: 6574 2827 6368 6563 6b50 6172 616d 7327  et('checkParams'
-00003750: 290d 0a20 2020 2020 2020 206f 7074 735b  )..        opts[
-00003760: 2763 6865 636b 5265 7475 726e 275d 203d  'checkReturn'] =
-00003770: 2073 656c 662e 5f5f 6368 6563 6b52 6574   self.__checkRet
-00003780: 7572 6e20 6966 206f 7074 732e 6765 7428  urn if opts.get(
-00003790: 2763 6865 636b 5265 7475 726e 2729 203d  'checkReturn') =
-000037a0: 3d20 4e6f 6e65 2065 6c73 6520 6f70 7473  = None else opts
-000037b0: 2e67 6574 2827 6368 6563 6b52 6574 7572  .get('checkRetur
-000037c0: 6e27 290d 0a0d 0a20 2020 2020 2020 2069  n')....        i
-000037d0: 6620 6d65 7468 6f64 5479 7065 3d3d 2772  f methodType=='r
-000037e0: 7063 273a 0d0a 2020 2020 2020 2020 2020  pc':..          
-000037f0: 2020 6e61 6d65 203d 206f 7074 732e 6765    name = opts.ge
-00003800: 7428 276e 616d 6527 290d 0a20 2020 2020  t('name')..     
-00003810: 2020 2020 2020 2069 6620 6e6f 7420 6e61         if not na
-00003820: 6d65 5b30 5d2e 6973 616c 7068 6128 293a  me[0].isalpha():
-00003830: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003840: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00003850: 6f72 2866 2252 6567 6973 7472 6174 696f  or(f"Registratio
-00003860: 6e20 6572 726f 722c 5468 6520 6e61 6d65  n error,The name
-00003870: 2027 7b6e 616d 657d 2720 6d75 7374 2073   '{name}' must s
-00003880: 7461 7274 2077 6974 6820 6120 6c65 7474  tart with a lett
-00003890: 6572 2229 0d0a 2020 2020 2020 2020 2020  er")..          
-000038a0: 2020 7365 6c66 2e5f 5f72 7063 5f6d 6574    self.__rpc_met
-000038b0: 686f 6473 5b6e 616d 655d 203d 2052 4d65  hods[name] = RMe
-000038c0: 7468 6f64 282a 2a6f 7074 7329 0d0a 2020  thod(**opts)..  
-000038d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000038e0: 0d0a 0d0a 2020 2020 2020 2020 6966 206d  ....        if m
-000038f0: 6574 686f 6454 7970 653d 3d27 6765 7427  ethodType=='get'
-00003900: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-00003910: 616d 6520 3d20 6e61 6d65 2e72 6570 6c61  ame = name.repla
-00003920: 6365 2827 2e27 2c27 2f27 290d 0a20 2020  ce('.','/')..   
-00003930: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00003940: 6e61 6d65 2e73 7461 7274 7377 6974 6828  name.startswith(
-00003950: 272f 2729 3a0d 0a20 2020 2020 2020 2020  '/'):..         
-00003960: 2020 2020 2020 206e 616d 653d 272f 272b         name='/'+
-00003970: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00003980: 2020 6e61 6d65 5f20 3d20 6e61 6d65 2e6c    name_ = name.l
-00003990: 6f77 6572 2829 0d0a 2020 2020 2020 2020  ower()..        
-000039a0: 2020 2020 6966 206e 616d 6520 213d 206e      if name != n
-000039b0: 616d 655f 3a0d 0a20 2020 2020 2020 2020  ame_:..         
-000039c0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-000039d0: 726e 696e 6728 6627 5061 7468 4e61 6d65  rning(f'PathName
-000039e0: 2063 6861 6e67 6564 2c54 6865 2070 6174   changed,The pat
-000039f0: 6820 227b 6e61 6d65 7d22 2063 6861 6e67  h "{name}" chang
-00003a00: 6573 2074 6f20 227b 6e61 6d65 5f7d 2227  es to "{name_}"'
-00003a10: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00003a20: 656c 662e 5f5f 6765 745f 6d65 7468 6f64  elf.__get_method
-00003a30: 735b 6e61 6d65 5f5d 203d 2052 4d65 7468  s[name_] = RMeth
-00003a40: 6f64 282a 2a6f 7074 7329 0d0a 2020 2020  od(**opts)..    
-00003a50: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-00003a60: 0d0a 2020 2020 2020 2020 6966 206d 6574  ..        if met
-00003a70: 686f 6454 7970 653d 3d27 706f 7374 273a  hodType=='post':
-00003a80: 0d0a 2020 2020 2020 2020 2020 2020 6e61  ..            na
-00003a90: 6d65 203d 206e 616d 652e 7265 706c 6163  me = name.replac
-00003aa0: 6528 272e 272c 272f 2729 0d0a 2020 2020  e('.','/')..    
-00003ab0: 2020 2020 2020 2020 6966 206e 6f74 206e          if not n
-00003ac0: 616d 652e 7374 6172 7473 7769 7468 2827  ame.startswith('
-00003ad0: 2f27 293a 0d0a 2020 2020 2020 2020 2020  /'):..          
-00003ae0: 2020 2020 2020 6e61 6d65 3d27 2f27 2b6e        name='/'+n
-00003af0: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-00003b00: 206e 616d 655f 203d 206e 616d 652e 6c6f   name_ = name.lo
-00003b10: 7765 7228 290d 0a20 2020 2020 2020 2020  wer()..         
-00003b20: 2020 2069 6620 6e61 6d65 2021 3d20 6e61     if name != na
-00003b30: 6d65 5f3a 0d0a 2020 2020 2020 2020 2020  me_:..          
-00003b40: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-00003b50: 6e69 6e67 2866 2750 6174 684e 616d 6520  ning(f'PathName 
-00003b60: 6368 616e 6765 642c 5468 6520 7061 7468  changed,The path
-00003b70: 2022 7b6e 616d 657d 2220 6368 616e 6765   "{name}" change
-00003b80: 7320 746f 2022 7b6e 616d 655f 7d22 2729  s to "{name_}"')
-00003b90: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00003ba0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00003bb0: 5f70 6f73 745f 6d65 7468 6f64 735b 6e61  _post_methods[na
-00003bc0: 6d65 5f5d 203d 2052 4d65 7468 6f64 282a  me_] = RMethod(*
-00003bd0: 2a6f 7074 7329 0d0a 2020 2020 2020 2020  *opts)..        
-00003be0: 2020 2020 7265 7475 726e 0d0a 0d0a 0d0a      return......
-00003bf0: 2020 2020 6465 6620 5f72 6567 6973 7465      def _registe
-00003c00: 7228 7365 6c66 2c5f 665f 3d4e 6f6e 652c  r(self,_f_=None,
-00003c10: 5f6e 5f3d 4e6f 6e65 2c5f 745f 3a73 7472  _n_=None,_t_:str
-00003c20: 3d4e 6f6e 652c 696e 735f 6172 6773 3a74  =None,ins_args:t
-00003c30: 7570 6c65 3d74 7570 6c65 2829 2c69 6e73  uple=tuple(),ins
-00003c40: 5f6b 7764 733a 6469 6374 3d64 6963 7428  _kwds:dict=dict(
-00003c50: 292c 6f70 7473 3a64 6963 743d 6469 6374  ),opts:dict=dict
-00003c60: 2829 293a 0d0a 2020 2020 2020 2020 2222  ()):..        ""
-00003c70: 22e9 809a e794 a8e6 b3a8 e586 8cef bc8c  "...............
-00003c80: e694 afe6 8c81 e6b3 a8e5 868c e587 bde6  ................
-00003c90: 95b0 efbc 8ce7 b1bb efbc 88e8 87aa e58a  ................
-00003ca0: a8e5 ae9e e4be 8be5 8c96 efbc 89ef bc8c  ................
-00003cb0: e7b1 bbe5 ae9e e4be 8bef bc8c 2222 220d  ............""".
-00003cc0: 0a20 2020 2020 2020 2069 6620 5f66 5f20  .        if _f_ 
-00003cd0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00003ce0: 2020 2020 2020 7265 7475 726e 2070 6172        return par
-00003cf0: 7469 616c 2873 656c 662e 5f72 6567 6973  tial(self._regis
-00003d00: 7465 722c 205f 6e5f 3d5f 6e5f 2c5f 745f  ter, _n_=_n_,_t_
-00003d10: 3d5f 745f 2c69 6e73 5f61 7267 733d 696e  =_t_,ins_args=in
-00003d20: 735f 6172 6773 2c69 6e73 5f6b 7764 733d  s_args,ins_kwds=
-00003d30: 696e 735f 6b77 6473 2c6f 7074 733d 6f70  ins_kwds,opts=op
-00003d40: 7473 290d 0a20 2020 2020 2020 200d 0a20  ts)..        .. 
-00003d50: 2020 2020 2020 2069 6620 7479 7065 285f         if type(_
-00003d60: 665f 293d 3d73 7472 3a0d 0a20 2020 2020  f_)==str:..     
-00003d70: 2020 2020 2020 205f 6e5f 203d 205f 665f         _n_ = _f_
-00003d80: 2e73 7472 6970 2829 0d0a 2020 2020 2020  .strip()..      
-00003d90: 2020 2020 2020 2320 6966 205f 6e5f 2061        # if _n_ a
-00003da0: 6e64 205f 6e5f 5b30 5d2e 6973 616c 7068  nd _n_[0].isalph
-00003db0: 6128 293a 0d0a 2020 2020 2020 2020 2020  a():..          
-00003dc0: 2020 6966 205f 6e5f 3a0d 0a20 2020 2020    if _n_:..     
-00003dd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00003de0: 6e20 7061 7274 6961 6c28 7365 6c66 2e5f  n partial(self._
-00003df0: 7265 6769 7374 6572 2c5f 6e5f 3d5f 6e5f  register,_n_=_n_
-00003e00: 2c5f 745f 3d5f 745f 2c69 6e73 5f61 7267  ,_t_=_t_,ins_arg
-00003e10: 733d 696e 735f 6172 6773 2c69 6e73 5f6b  s=ins_args,ins_k
-00003e20: 7764 733d 696e 735f 6b77 6473 2c6f 7074  wds=ins_kwds,opt
-00003e30: 733d 6f70 7473 290d 0a20 2020 2020 2020  s=opts)..       
-00003e40: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00003e50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00003e60: 6520 5661 6c75 6545 7272 6f72 2866 2252  e ValueError(f"R
-00003e70: 6567 6973 7472 6174 696f 6e20 6572 726f  egistration erro
-00003e80: 722c 277b 5f66 5f7d 2720 6361 6e6e 6f74  r,'{_f_}' cannot
-00003e90: 2062 6520 7573 6564 2061 7320 6120 7265   be used as a re
-00003ea0: 6769 7374 6572 6564 206e 616d 6521 2229  gistered name!")
-00003eb0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-00003ec0: 2020 2020 2020 2020 6966 2069 6e73 7065          if inspe
-00003ed0: 6374 2e69 7366 756e 6374 696f 6e28 5f66  ct.isfunction(_f
-00003ee0: 5f29 206f 7220 696e 7370 6563 742e 6973  _) or inspect.is
-00003ef0: 6d65 7468 6f64 285f 665f 293a 0d0a 2020  method(_f_):..  
-00003f00: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00003f10: 205f 6e5f 3a0d 0a20 2020 2020 2020 2020   _n_:..         
-00003f20: 2020 2020 2020 205f 6e5f 203d 205f 665f         _n_ = _f_
-00003f30: 2e5f 5f6e 616d 655f 5f0d 0a20 2020 2020  .__name__..     
-00003f40: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00003f50: 2020 2020 206f 7074 735f 3a64 6963 7420       opts_:dict 
-00003f60: 3d20 6469 6374 286e 616d 653d 5f6e 5f2c  = dict(name=_n_,
-00003f70: 6d65 7468 6f64 5479 7065 3d5f 745f 2c63  methodType=_t_,c
-00003f80: 616c 6c61 626c 653d 5f66 5f29 0d0a 2020  allable=_f_)..  
-00003f90: 2020 2020 2020 2020 2020 6f70 7473 5f2e            opts_.
-00003fa0: 7570 6461 7465 286f 7074 7329 0d0a 2020  update(opts)..  
-00003fb0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00003fc0: 7265 6174 524d 6574 686f 6428 2a2a 6f70  reatRMethod(**op
-00003fd0: 7473 5f29 0d0a 2020 2020 2020 2020 656c  ts_)..        el
-00003fe0: 6966 2069 6e73 7065 6374 2e69 736d 6f64  if inspect.ismod
-00003ff0: 756c 6528 5f66 5f29 3a0d 0a20 2020 2020  ule(_f_):..     
-00004000: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00004010: 7565 4572 726f 7228 6622 5265 6769 7374  ueError(f"Regist
-00004020: 7261 7469 6f6e 2065 7272 6f72 2c6d 6f64  ration error,mod
-00004030: 756c 6520 277b 5f66 5f2e 5f5f 6e61 6d65  ule '{_f_.__name
-00004040: 5f5f 7d27 2063 6f75 6c64 206e 6f74 2062  __}' could not b
-00004050: 6520 7265 6769 7374 6572 6564 2122 290d  e registered!").
-00004060: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00004070: 2020 2020 2020 2020 2020 2020 2320 e6b3              # ..
-00004080: a8e5 868c 636c 6173 730d 0a20 2020 2020  ....class..     
-00004090: 2020 2020 2020 2069 6620 6e6f 7420 5f6e         if not _n
-000040a0: 5f3a 0d0a 2020 2020 2020 2020 2020 2020  _:..            
-000040b0: 2020 2020 6966 2069 6e73 7065 6374 2e69      if inspect.i
-000040c0: 7363 6c61 7373 285f 665f 293a 0d0a 2020  sclass(_f_):..  
-000040d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000040e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000040f0: 6f72 2866 2252 6567 6973 7472 6174 696f  or(f"Registratio
-00004100: 6e20 6572 726f 722c 5468 6520 277b 5f66  n error,The '{_f
-00004110: 5f2e 5f5f 6e61 6d65 5f5f 7d27 2063 6c61  _.__name__}' cla
-00004120: 7373 2069 7320 6e6f 7420 6e61 6d65 6421  ss is not named!
-00004130: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00004140: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00004150: 2020 2020 2020 2020 2020 2020 2020 200d                 .
-00004160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004170: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00004180: 4572 726f 7228 6622 5265 6769 7374 7261  Error(f"Registra
-00004190: 7469 6f6e 2065 7272 6f72 2c54 6865 2027  tion error,The '
-000041a0: 7b74 7970 6528 5f66 5f29 2e5f 5f6e 616d  {type(_f_).__nam
-000041b0: 655f 5f7d 2720 696e 7374 616e 6365 2069  e__}' instance i
-000041c0: 7320 6e6f 7420 6e61 6d65 6421 2229 0d0a  s not named!")..
-000041d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041e0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000041f0: 2074 7970 6528 5f6e 5f29 213d 7374 723a   type(_n_)!=str:
-00004200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004210: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00004220: 6f72 2866 2252 6567 6973 7472 6174 696f  or(f"Registratio
-00004230: 6e20 6572 726f 722c 5468 6520 6e61 6d65  n error,The name
-00004240: 2027 7b5f 6e5f 7d27 2069 7320 6e6f 7420   '{_n_}' is not 
-00004250: 6120 7374 7269 6e67 2122 290d 0a20 2020  a string!")..   
-00004260: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00004270: 2020 2020 2020 2069 6620 696e 7370 6563         if inspec
-00004280: 742e 6973 636c 6173 7328 5f66 5f29 3a0d  t.isclass(_f_):.
-00004290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000042a0: 205f 696e 7374 616e 6365 203d 205f 665f   _instance = _f_
-000042b0: 282a 696e 735f 6172 6773 2c2a 2a69 6e73  (*ins_args,**ins
-000042c0: 5f6b 7764 7329 0d0a 2020 2020 2020 2020  _kwds)..        
-000042d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000042e0: 2020 2020 2020 2020 2020 205f 696e 7374             _inst
-000042f0: 616e 6365 203d 205f 665f 0d0a 0d0a 0d0a  ance = _f_......
-00004300: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004310: 6920 696e 2064 6972 285f 696e 7374 616e  i in dir(_instan
-00004320: 6365 293a 0d0a 2020 2020 2020 2020 2020  ce):..          
-00004330: 2020 2020 2020 6966 2069 2e73 7461 7274        if i.start
-00004340: 7377 6974 6828 225f 2229 3a0d 0a20 2020  swith("_"):..   
-00004350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004360: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
-00004370: 2020 2020 2020 2020 2020 205f 6620 3d20             _f = 
-00004380: 6765 7461 7474 7228 5f69 6e73 7461 6e63  getattr(_instanc
-00004390: 652c 6929 0d0a 2020 2020 2020 2020 2020  e,i)..          
-000043a0: 2020 2020 2020 6966 2069 6e73 7065 6374        if inspect
-000043b0: 2e69 736d 6574 686f 6428 5f66 2920 6f72  .ismethod(_f) or
-000043c0: 2069 6e73 7065 6374 2e69 7366 756e 6374   inspect.isfunct
-000043d0: 696f 6e28 5f66 293a 0d0a 2020 2020 2020  ion(_f):..      
-000043e0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-000043f0: 7468 6f64 5f6e 616d 6520 3d20 6627 7b5f  thod_name = f'{_
-00004400: 6e5f 7d2e 7b69 7d27 0d0a 2020 2020 2020  n_}.{i}'..      
-00004410: 2020 2020 2020 2020 2020 2020 2020 6f70                op
-00004420: 7473 5f3a 6469 6374 203d 2064 6963 7428  ts_:dict = dict(
-00004430: 6e61 6d65 3d6d 6574 686f 645f 6e61 6d65  name=method_name
-00004440: 2c6d 6574 686f 6454 7970 653d 5f74 5f2c  ,methodType=_t_,
-00004450: 6361 6c6c 6162 6c65 3d5f 6629 0d0a 2020  callable=_f)..  
+00000bb0: 2027 7265 7475 726e 5479 7065 272c 0d0a   'returnType',..
+00000bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000bd0: 2027 6173 796e 6366 756e 6327 2c0d 0a20   'asyncfunc',.. 
+00000be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000bf0: 2775 7365 5072 6f63 6573 7327 290d 0a0d  'useProcess')...
+00000c00: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00000c10: 5f28 7365 6c66 2c0d 0a20 2020 2020 2020  _(self,..       
+00000c20: 2020 2020 2020 2020 2020 6e61 6d65 3a73            name:s
+00000c30: 7472 2c0d 0a20 2020 2020 2020 2020 2020  tr,..           
+00000c40: 2020 2020 2020 6d65 7468 6f64 5479 7065        methodType
+00000c50: 3a73 7472 2c0d 0a20 2020 2020 2020 2020  :str,..         
+00000c60: 2020 2020 2020 2020 6361 6c6c 6162 6c65          callable
+00000c70: 3a63 616c 6c61 626c 652c 0d0a 2020 2020  :callable,..    
+00000c80: 2020 2020 2020 2020 2020 2020 2063 6865               che
+00000c90: 636b 5061 7261 6d73 3a62 6f6f 6c2c 0d0a  ckParams:bool,..
+00000ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000cb0: 2063 6865 636b 5265 7475 726e 3a62 6f6f   checkReturn:boo
+00000cc0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+00000cd0: 2020 2020 2075 7365 5072 6f63 6573 733a       useProcess:
+00000ce0: 626f 6f6c 3d46 616c 7365 2920 2d3e 204e  bool=False) -> N
+00000cf0: 6f6e 653a 0d0a 2020 2020 2020 2020 2222  one:..        ""
+00000d00: 2222 2222 0d0a 2020 2020 2020 2020 7365  """"..        se
+00000d10: 6c66 2e6e 616d 6520 3d20 6e61 6d65 0d0a  lf.name = name..
+00000d20: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00000d30: 686f 6454 7970 6520 3d20 6d65 7468 6f64  hodType = method
+00000d40: 5479 7065 0d0a 2020 2020 2020 2020 7365  Type..        se
+00000d50: 6c66 2e63 616c 6c61 626c 6520 3d20 6361  lf.callable = ca
+00000d60: 6c6c 6162 6c65 0d0a 2020 2020 2020 2020  llable..        
+00000d70: 7365 6c66 2e63 6865 636b 5061 7261 6d73  self.checkParams
+00000d80: 203d 2063 6865 636b 5061 7261 6d73 0d0a   = checkParams..
+00000d90: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+00000da0: 636b 5265 7475 726e 203d 2063 6865 636b  ckReturn = check
+00000db0: 5265 7475 726e 2020 2020 200d 0a20 2020  Return     ..   
+00000dc0: 2020 2020 2073 656c 662e 7573 6550 726f       self.usePro
+00000dd0: 6365 7373 203d 2075 7365 5072 6f63 6573  cess = useProces
+00000de0: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+00000df0: 636c 733a 2073 7472 203d 2027 2720 6966  cls: str = '' if
+00000e00: 206e 6f74 2069 6e73 7065 6374 2e69 736d   not inspect.ism
+00000e10: 6574 686f 6428 7365 6c66 2e63 616c 6c61  ethod(self.calla
+00000e20: 626c 6529 2065 6c73 6520 7365 6c66 2e63  ble) else self.c
+00000e30: 616c 6c61 626c 652e 5f5f 7365 6c66 5f5f  allable.__self__
+00000e40: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+00000e50: 655f 5f0d 0a20 2020 2020 2020 2073 656c  e__..        sel
+00000e60: 662e 7061 7261 6d73 3a74 7570 6c65 203d  f.params:tuple =
+00000e70: 2074 7570 6c65 2869 6e73 7065 6374 2e73   tuple(inspect.s
+00000e80: 6967 6e61 7475 7265 2873 656c 662e 6361  ignature(self.ca
+00000e90: 6c6c 6162 6c65 292e 7061 7261 6d65 7465  llable).paramete
+00000ea0: 7273 2e6b 6579 7328 2929 2020 2020 2020  rs.keys())      
+00000eb0: 2020 0d0a 2020 2020 2020 2020 7365 6c66    ..        self
+00000ec0: 2e64 6566 6175 6c74 5f76 616c 7565 733a  .default_values:
+00000ed0: 7475 706c 653d 2074 7570 6c65 285b 692e  tuple= tuple([i.
+00000ee0: 6465 6661 756c 7420 666f 7220 6920 696e  default for i in
+00000ef0: 2074 7570 6c65 2869 6e73 7065 6374 2e73   tuple(inspect.s
+00000f00: 6967 6e61 7475 7265 2873 656c 662e 6361  ignature(self.ca
+00000f10: 6c6c 6162 6c65 292e 7061 7261 6d65 7465  llable).paramete
+00000f20: 7273 2e76 616c 7565 7328 2929 2069 6620  rs.values()) if 
+00000f30: 692e 6465 6661 756c 7420 6973 206e 6f74  i.default is not
+00000f40: 2069 6e73 7065 6374 2e5f 656d 7074 795d   inspect._empty]
+00000f50: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00000f60: 646f 633a 7374 7220 3d20 696e 7370 6563  doc:str = inspec
+00000f70: 742e 6765 7464 6f63 2873 656c 662e 6361  t.getdoc(self.ca
+00000f80: 6c6c 6162 6c65 290d 0a20 2020 2020 2020  llable)..       
+00000f90: 2061 6e6e 6f74 6174 696f 6e73 203d 2064   annotations = d
+00000fa0: 6963 7428 5b28 6b2c 762e 616e 6e6f 7461  ict([(k,v.annota
+00000fb0: 7469 6f6e 2920 666f 7220 6b2c 7620 696e  tion) for k,v in
+00000fc0: 2020 696e 7370 6563 742e 7369 676e 6174    inspect.signat
+00000fd0: 7572 6528 7365 6c66 2e63 616c 6c61 626c  ure(self.callabl
+00000fe0: 6529 2e70 6172 616d 6574 6572 732e 6974  e).parameters.it
+00000ff0: 656d 7328 2920 6966 2076 2e61 6e6e 6f74  ems() if v.annot
+00001000: 6174 696f 6e20 6973 206e 6f74 2069 6e73  ation is not ins
+00001010: 7065 6374 2e5f 656d 7074 795d 290d 0a20  pect._empty]).. 
+00001020: 2020 2020 2020 2066 6f72 2061 6e20 696e         for an in
+00001030: 2061 6e6e 6f74 6174 696f 6e73 2e6b 6579   annotations.key
+00001040: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+00001050: 2020 616e 6e6f 7461 7469 6f6e 735b 616e    annotations[an
+00001060: 5d20 3d20 616e 6e6f 7461 7469 6f6e 735b  ] = annotations[
+00001070: 616e 5d0d 0a20 2020 2020 2020 2073 656c  an]..        sel
+00001080: 662e 616e 6e6f 7461 7469 6f6e 733a 6469  f.annotations:di
+00001090: 6374 203d 2061 6e6e 6f74 6174 696f 6e73  ct = annotations
+000010a0: 0d0a 2020 2020 2020 2020 7370 203d 2069  ..        sp = i
+000010b0: 6e73 7065 6374 2e67 6574 6675 6c6c 6172  nspect.getfullar
+000010c0: 6773 7065 6328 7365 6c66 2e63 616c 6c61  gspec(self.calla
+000010d0: 626c 6529 0d0a 2020 2020 2020 2020 7365  ble)..        se
+000010e0: 6c66 2e76 6172 6172 6773 3a73 7472 203d  lf.varargs:str =
+000010f0: 2073 702e 7661 7261 7267 730d 0a20 2020   sp.varargs..   
+00001100: 2020 2020 2073 656c 662e 7661 726b 773a       self.varkw:
+00001110: 7374 7220 3d20 7370 2e76 6172 6b77 0d0a  str = sp.varkw..
+00001120: 2020 2020 2020 2020 7365 6c66 2e72 6574          self.ret
+00001130: 7572 6e54 7970 653a 7374 7220 3d20 7370  urnType:str = sp
+00001140: 2e61 6e6e 6f74 6174 696f 6e73 2e67 6574  .annotations.get
+00001150: 2827 7265 7475 726e 2729 0d0a 2020 2020  ('return')..    
+00001160: 2020 2020 7365 6c66 2e61 7379 6e63 6675      self.asyncfu
+00001170: 6e63 3a62 6f6f 6c20 3d20 696e 7370 6563  nc:bool = inspec
+00001180: 742e 6973 636f 726f 7574 696e 6566 756e  t.iscoroutinefun
+00001190: 6374 696f 6e28 7365 6c66 2e63 616c 6c61  ction(self.calla
+000011a0: 626c 6529 0d0a 0d0a 0d0a 2020 2020 6173  ble)......    as
+000011b0: 796e 6320 6465 6620 6578 6563 7574 6528  ync def execute(
+000011c0: 7365 6c66 2c61 7267 733a 7475 706c 652c  self,args:tuple,
+000011d0: 6469 6374 733a 6469 6374 2c70 6f6f 6c3a  dicts:dict,pool:
+000011e0: 5072 6f63 6573 7350 6f6f 6c45 7865 6375  ProcessPoolExecu
+000011f0: 746f 723d 4e6f 6e65 292d 3e74 7570 6c65  tor=None)->tuple
+00001200: 5b55 7453 7461 7465 2c61 6e79 2c73 7472  [UtState,any,str
+00001210: 5d3a 0d0a 2020 2020 2020 2020 2222 2220  ]:..        """ 
+00001220: e689 a7e8 a18c e6b3 a8e5 868c e79a 84e5  ................
+00001230: 87bd e695 b0e6 8896 e696 b9e6 b395 0d0a  ................
+00001240: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
+00001250: 2020 2020 2020 2020 2020 2061 7267 733a             args:
+00001260: 20e5 8897 e8a1 a8e5 8f82 e695 b00d 0a20   .............. 
+00001270: 2020 2020 2020 2020 2020 2064 6963 7473             dicts
+00001280: 3a20 e5ad 97e5 85b8 e58f 82e6 95b0 0d0a  : ..............
+00001290: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+000012a0: 3a20 e8bf 9be7 a88b e6b1 a00d 0a20 2020  : ...........   
+000012b0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+000012c0: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
+000012d0: 2020 2020 2020 2020 20e8 bf94 e59b 9ee5           .......
+000012e0: 80bc efbc 9ae7 8ab6 e680 81ef bc8c e7bb  ................
+000012f0: 93e6 9e9c efbc 8ce9 9499 e8af afe4 bfa1  ................
+00001300: e681 af0d 0a20 2020 2020 2020 2022 2222  .....        """
+00001310: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00001320: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00001330: 2073 7461 7465 203d 2055 7453 7461 7465   state = UtState
+00001340: 2e53 5543 4345 5353 0d0a 2020 2020 2020  .SUCCESS..      
+00001350: 2020 6572 726f 7220 3d20 2727 0d0a 0d0a    error = ''....
+00001360: 2020 2020 2020 2020 2320 312e e6a3 80e6          # 1.....
+00001370: 9fa5 e58f 82e6 95b0 0d0a 2020 2020 2020  ..........      
+00001380: 2020 6966 2073 656c 662e 6368 6563 6b50    if self.checkP
+00001390: 6172 616d 733a 0d0a 2020 2020 2020 2020  arams:..        
+000013a0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+000013b0: 2020 2020 2020 2020 2020 6172 6773 2c64            args,d
+000013c0: 6963 7473 203d 2063 6865 656b 5479 7065  icts = cheekType
+000013d0: 2873 656c 662e 7061 7261 6d73 2c73 656c  (self.params,sel
+000013e0: 662e 616e 6e6f 7461 7469 6f6e 732c 6172  f.annotations,ar
+000013f0: 6773 2c64 6963 7473 290d 0a20 2020 2020  gs,dicts)..     
+00001400: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00001410: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
+00001420: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00001430: 7461 7465 203d 2055 7453 7461 7465 2e46  tate = UtState.F
+00001440: 4149 4c45 440d 0a20 2020 2020 2020 2020  AILED..         
+00001450: 2020 2020 2020 2065 7272 6f72 203d 2073         error = s
+00001460: 7472 2865 290d 0a20 2020 2020 2020 2020  tr(e)..         
+00001470: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00001480: 6174 652c 7265 7375 6c74 2c65 7272 6f72  ate,result,error
+00001490: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+000014a0: 2020 2020 2020 2020 2020 2020 2320 322e              # 2.
+000014b0: e689 a7e8 a18c e6b3 a8e5 868c e587 bde6  ................
+000014c0: 95b0 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000014d0: 6966 2073 656c 662e 7573 6550 726f 6365  if self.useProce
+000014e0: 7373 3a0d 0a20 2020 2020 2020 2020 2020  ss:..           
+000014f0: 2020 2020 2023 20e8 bf9b e7a8 8be4 b8ad       # .........
+00001500: e689 a7e8 a18c 0d0a 2020 2020 2020 2020  ........        
+00001510: 2020 2020 2020 2020 6966 2070 6f6f 6c20          if pool 
+00001520: 6973 204e 6f6e 653a 200d 0a20 2020 2020  is None: ..     
+00001530: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00001540: 6f67 6765 722e 6572 726f 7228 6627 5468  ogger.error(f'Th
+00001550: 6520 6675 6e63 7469 6f6e 2022 7b73 656c  e function "{sel
+00001560: 662e 6e61 6d65 7d22 2072 756e 7320 696e  f.name}" runs in
+00001570: 2061 2063 6869 6c64 2070 726f 6365 7373   a child process
+00001580: 2c20 6275 7420 7468 6520 7365 7276 6572  , but the server
+00001590: 2068 6173 206e 6f20 776f 726b 6572 2070   has no worker p
+000015a0: 726f 6365 7373 2729 0d0a 2020 2020 2020  rocess')..      
+000015b0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000015c0: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
+000015d0: 2866 2754 6865 2066 756e 6374 696f 6e20  (f'The function 
+000015e0: 227b 7365 6c66 2e6e 616d 657d 2220 7275  "{self.name}" ru
+000015f0: 6e73 2069 6e20 6120 6368 696c 6420 7072  ns in a child pr
+00001600: 6f63 6573 732c 2062 7574 2074 6865 2073  ocess, but the s
+00001610: 6572 7665 7220 6861 7320 6e6f 2077 6f72  erver has no wor
+00001620: 6b65 7220 7072 6f63 6573 7327 290d 0a0d  ker process')...
+00001630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001640: 2069 6620 7365 6c66 2e61 7379 6e63 6675   if self.asyncfu
+00001650: 6e63 3a0d 0a20 2020 2020 2020 2020 2020  nc:..           
+00001660: 2020 2020 2020 2020 2066 6e20 3d20 7061           fn = pa
+00001670: 7274 6961 6c28 6173 796e 6366 6e5f 7275  rtial(asyncfn_ru
+00001680: 6e6e 6572 2c73 656c 662e 6361 6c6c 6162  nner,self.callab
+00001690: 6c65 2c2a 6172 6773 2c2a 2a64 6963 7473  le,*args,**dicts
+000016a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000016b0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000016c0: 2020 2020 2020 2020 2020 2020 2020 666e                fn
+000016d0: 203d 2070 6172 7469 616c 2873 656c 662e   = partial(self.
+000016e0: 6361 6c6c 6162 6c65 2c2a 6172 6773 2c2a  callable,*args,*
+000016f0: 2a64 6963 7473 290d 0a0d 0a20 2020 2020  *dicts)....     
+00001700: 2020 2020 2020 2020 2020 206c 6f6f 7020             loop 
+00001710: 3d20 6173 796e 6369 6f2e 6765 745f 6576  = asyncio.get_ev
+00001720: 656e 745f 6c6f 6f70 2829 0d0a 2020 2020  ent_loop()..    
+00001730: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+00001740: 3d20 6177 6169 7420 6c6f 6f70 2e72 756e  = await loop.run
+00001750: 5f69 6e5f 6578 6563 7574 6f72 2870 6f6f  _in_executor(poo
+00001760: 6c2c 666e 290d 0a0d 0a20 2020 2020 2020  l,fn)....       
+00001770: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00001780: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00001790: 656c 662e 6173 796e 6366 756e 633a 0d0a  elf.asyncfunc:..
+000017a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017b0: 2020 2020 2320 e5bc 82e6 ada5 e689 a7e8      # ..........
+000017c0: a18c 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000017d0: 2020 2020 2020 2020 7265 7320 3d20 6177          res = aw
+000017e0: 6169 7420 7365 6c66 2e63 616c 6c61 626c  ait self.callabl
+000017f0: 6528 2a61 7267 732c 2a2a 6469 6374 7329  e(*args,**dicts)
+00001800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001810: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00001820: 2020 2020 2020 2020 2020 2020 2023 20e6               # .
+00001830: ada3 e5b8 b8e6 89a7 e8a1 8c0d 0a20 2020  .............   
+00001840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001850: 2072 6573 203d 2073 656c 662e 6361 6c6c   res = self.call
+00001860: 6162 6c65 282a 6172 6773 2c2a 2a64 6963  able(*args,**dic
+00001870: 7473 290d 0a0d 0a20 2020 2020 2020 2020  ts)....         
+00001880: 2020 2023 2033 2ee6 a380 e69f a5e8 bf94     # 3..........
+00001890: e59b 9ee5 80bc 0d0a 2020 2020 2020 2020  ........        
+000018a0: 2020 2020 6966 2073 656c 662e 6368 6563      if self.chec
+000018b0: 6b52 6574 7572 6e20 616e 6420 7365 6c66  kReturn and self
+000018c0: 2e72 6574 7572 6e54 7970 653a 0d0a 2020  .returnType:..  
+000018d0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000018e0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000018f0: 2020 2020 2020 2020 7265 733d 2061 6c6c          res= all
+00001900: 6f77 5479 7065 2872 6573 2c73 656c 662e  owType(res,self.
+00001910: 7265 7475 726e 5479 7065 2c73 656c 662e  returnType,self.
+00001920: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
+00001930: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00001940: 7420 3d20 7265 730d 0a20 2020 2020 2020  t = res..       
+00001950: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+00001960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001970: 2020 2020 2020 7374 6174 6520 3d20 5574        state = Ut
+00001980: 5374 6174 652e 4641 494c 4544 0d0a 2020  State.FAILED..  
+00001990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019a0: 2020 6572 726f 7220 3d20 6622 5265 7475    error = f"Retu
+000019b0: 726e 2076 616c 7565 2065 7272 6f72 2e27  rn value error.'
+000019c0: 7b74 7970 6528 7265 7329 7d27 2069 7320  {type(res)}' is 
+000019d0: 6e6f 7420 6f66 2027 7b73 656c 662e 7265  not of '{self.re
+000019e0: 7475 726e 5479 7065 7d27 2074 7970 6522  turnType}' type"
+000019f0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00001a00: 7365 3a20 2020 2020 2020 2020 2020 2020  se:             
+00001a10: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00001a20: 2020 2020 2072 6573 756c 7420 3d20 7265       result = re
+00001a30: 730d 0a20 2020 2020 2020 2065 7863 6570  s..        excep
+00001a40: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00001a50: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00001a60: 7461 7465 203d 2055 7453 7461 7465 2e46  tate = UtState.F
+00001a70: 4149 4c45 440d 0a20 2020 2020 2020 2020  AILED..         
+00001a80: 2020 2065 7272 6f72 203d 2073 7472 2865     error = str(e
+00001a90: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00001aa0: 2020 2020 2072 6574 7572 6e20 7374 6174       return stat
+00001ab0: 652c 7265 7375 6c74 2c65 7272 6f72 0d0a  e,result,error..
+00001ac0: 0d0a 0d0a 636c 6173 7320 5265 6769 7374  ....class Regist
+00001ad0: 6572 3a0d 0a20 2020 2022 2222 0d0a 2020  er:..    """..  
+00001ae0: 2020 2320 e6b3 a8e5 868c e7b1 bbef bc8c    # ............
+00001af0: e794 a8e4 ba8e e6b3 a8e5 868c e69c ace5  ................
+00001b00: 9cb0 e79a 84e5 8faf e8b0 83e7 94a8 e587  ................
+00001b10: bde6 95b0 efbc 8c0d 0a20 2020 20e6 94af  .........    ...
+00001b20: e68c 8128 7270 63e3 8081 6765 74e3 8081  ...(rpc...get...
+00001b30: 706f 7374 29e6 b3a8 e586 8c0d 0a0d 0a20  post).......... 
+00001b40: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
+00001b50: 2020 6368 6563 6b50 6172 616d 7320 2862    checkParams (b
+00001b60: 6f6f 6c29 3a20 e8b0 83e7 94a8 e6b3 a8e5  ool): ..........
+00001b70: 868c e587 bde6 95b0 e688 96e6 96b9 e6b3  ................
+00001b80: 95e6 97b6 efbc 8ce6 98af e590 a6e6 a380  ................
+00001b90: e69f a5e5 8f82 e695 b0e7 b1bb e59e 8bef  ................
+00001ba0: bc8c e5bc 80e5 90af e590 8ee5 bd93 e7b1  ................
+00001bb0: bbe5 9e8b e4b8 bae6 95b0 e68d aee6 a8a1  ................
+00001bc0: e59e 8be6 97b6 e58f afe4 bba5 e887 aae5  ................
+00001bd0: 8aa8 e8bd ace6 8da2 0d0a 2020 2020 2020  ..........      
+00001be0: 2020 6368 6563 6b52 6574 7572 6e20 2862    checkReturn (b
+00001bf0: 6f6f 6c29 3a20 e8b0 83e7 94a8 e6b3 a8e5  ool): ..........
+00001c00: 868c e587 bde6 95b0 e688 96e6 96b9 e6b3  ................
+00001c10: 95e6 97b6 efbc 8ce6 98af e590 a6e6 a380  ................
+00001c20: e69f a5e8 bf94 e59b 9ee5 80bc e7b1 bbe5  ................
+00001c30: 9e8b efbc 8ce5 bc80 e590 afe5 908e e5bd  ................
+00001c40: 93e7 b1bb e59e 8be4 b8ba e695 b0e6 8dae  ................
+00001c50: e6a8 a1e5 9e8b e697 b6e5 8faf e4bb a5e8  ................
+00001c60: 87aa e58a a8e8 bdac e68d a20d 0a20 2020  .............   
+00001c70: 2020 2020 2070 6f6f 6c3a 20e8 bf9b e7a8       pool: .....
+00001c80: 8be6 b1a0 e5af b9e8 b1a1 0d0a 2020 2020  ............    
+00001c90: e6b3 a83a e58f aae6 9c89 e6b3 a8e5 868c  ...:............
+00001ca0: e587 bde6 95b0 e688 96e6 96b9 e6b3 95e6  ................
+00001cb0: 8c87 e5ae 9ae4 ba86 e7b1 bbe5 9e8b e697  ................
+00001cc0: b6e4 bba5 e4b8 8ae5 8f82 e695 b0e6 898d  ................
+00001cd0: e4bc 9ae8 b5b7 e4bd 9ce7 94a8 0d0a 2020  ..............  
+00001ce0: 2020 2222 220d 0a20 2020 205f 5f73 6c6f    """..    __slo
+00001cf0: 7473 5f5f 203d 2028 275f 5f72 7063 5f6d  ts__ = ('__rpc_m
+00001d00: 6574 686f 6473 272c 275f 5f67 6574 5f6d  ethods','__get_m
+00001d10: 6574 686f 6473 272c 275f 5f70 6f73 745f  ethods','__post_
+00001d20: 6d65 7468 6f64 7327 2c27 5f5f 6368 6563  methods','__chec
+00001d30: 6b50 6172 616d 7327 2c27 5f5f 6368 6563  kParams','__chec
+00001d40: 6b52 6574 7572 6e27 2c27 5f74 656d 705f  kReturn','_temp_
+00001d50: 6f70 7473 272c 275f 776f 726b 6572 7327  opts','_workers'
+00001d60: 290d 0a0d 0a20 2020 2064 6566 205f 5f69  )....    def __i
+00001d70: 6e69 745f 5f28 7365 6c66 2c63 6865 636b  nit__(self,check
+00001d80: 5061 7261 6d73 3a62 6f6f 6c3d 5472 7565  Params:bool=True
+00001d90: 2c63 6865 636b 5265 7475 726e 3a62 6f6f  ,checkReturn:boo
+00001da0: 6c3d 5472 7565 2c77 6f72 6b65 7273 3a69  l=True,workers:i
+00001db0: 6e74 3d30 2920 2d3e 204e 6f6e 653a 0d0a  nt=0) -> None:..
+00001dc0: 2020 2020 2020 2020 7365 6c66 2e5f 5f72          self.__r
+00001dd0: 7063 5f6d 6574 686f 6473 203d 2064 6963  pc_methods = dic
+00001de0: 7428 2920 2020 2020 2320 7b6d 6574 686f  t()     # {metho
+00001df0: 645f 6e61 6d65 3a7b 6361 6c6c 6162 6c65  d_name:{callable
+00001e00: 3a63 616c 6c61 626c 652c 7d7d 0d0a 2020  :callable,}}..  
+00001e10: 2020 2020 2020 7365 6c66 2e5f 5f67 6574        self.__get
+00001e20: 5f6d 6574 686f 6473 203d 2064 6963 7428  _methods = dict(
+00001e30: 2920 2020 2020 2320 7b70 6174 683a 7b63  )     # {path:{c
+00001e40: 616c 6c61 626c 653a 6361 6c6c 6162 6c65  allable:callable
+00001e50: 2c69 6e66 6f3a 7b7d 7d7d 0d0a 2020 2020  ,info:{}}}..    
+00001e60: 2020 2020 7365 6c66 2e5f 5f70 6f73 745f      self.__post_
+00001e70: 6d65 7468 6f64 7320 3d20 6469 6374 2829  methods = dict()
+00001e80: 2020 2020 2320 7b70 6174 683a 7b63 616c      # {path:{cal
+00001e90: 6c61 626c 653a 6361 6c6c 6162 6c65 2c69  lable:callable,i
+00001ea0: 6e66 6f3a 7b7d 7d7d 0d0a 2020 2020 2020  nfo:{}}}..      
+00001eb0: 2020 7365 6c66 2e5f 5f63 6865 636b 5061    self.__checkPa
+00001ec0: 7261 6d73 203d 2063 6865 636b 5061 7261  rams = checkPara
+00001ed0: 6d73 0d0a 2020 2020 2020 2020 7365 6c66  ms..        self
+00001ee0: 2e5f 5f63 6865 636b 5265 7475 726e 203d  .__checkReturn =
+00001ef0: 2063 6865 636b 5265 7475 726e 0d0a 2020   checkReturn..  
+00001f00: 2020 2020 2020 7365 6c66 2e5f 7465 6d70        self._temp
+00001f10: 5f6f 7074 7320 3d20 6469 6374 2829 0d0a  _opts = dict()..
+00001f20: 2020 2020 2020 2020 7365 6c66 2e5f 776f          self._wo
+00001f30: 726b 6572 7320 3d20 776f 726b 6572 730d  rkers = workers.
+00001f40: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+00001f50: 0d0a 2020 2020 6465 6620 6d65 7468 6f64  ..    def method
+00001f60: 735f 6f66 5f67 6574 2873 656c 6629 3a0d  s_of_get(self):.
+00001f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00001f80: 7365 6c66 2e5f 5f67 6574 5f6d 6574 686f  self.__get_metho
+00001f90: 6473 0d0a 2020 2020 0d0a 2020 2020 4070  ds..    ..    @p
+00001fa0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+00001fb0: 206d 6574 686f 6473 5f6f 665f 706f 7374   methods_of_post
+00001fc0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00001fd0: 2072 6574 7572 6e20 7365 6c66 2e5f 5f70   return self.__p
+00001fe0: 6f73 745f 6d65 7468 6f64 730d 0a0d 0a20  ost_methods.... 
+00001ff0: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00002000: 2020 6465 6620 6d65 7468 6f64 735f 6f66    def methods_of
+00002010: 5f72 7063 2873 656c 6629 3a0d 0a20 2020  _rpc(self):..   
+00002020: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00002030: 2e5f 5f72 7063 5f6d 6574 686f 6473 0d0a  .__rpc_methods..
+00002040: 2020 2020 0d0a 0d0a 2020 2020 6465 6620      ....    def 
+00002050: 7270 6328 7365 6c66 2c2a 666e 2c6e 616d  rpc(self,*fn,nam
+00002060: 653d 4e6f 6e65 2c69 6e73 5f61 7267 733a  e=None,ins_args:
+00002070: 7475 706c 653d 7475 706c 6528 292c 696e  tuple=tuple(),in
+00002080: 735f 6b77 6473 3a64 6963 743d 6469 6374  s_kwds:dict=dict
+00002090: 2829 2c2a 2a6f 7074 7329 3a0d 0a20 2020  (),**opts):..   
+000020a0: 2020 2020 2022 2222 2320 5250 43e6 b3a8       """# RPC...
+000020b0: e586 8c0d 0a20 2020 2020 2020 20e6 94af  .....        ...
+000020c0: e68c 81ef bc9a e7b1 bb2f e7b1 bbe6 96b9  ........./......
+000020d0: e6b3 952f e7b1 bbe5 ae9e e4be 8b2f e587  .../........./..
+000020e0: bde6 95b0 e79a 84e6 b3a8 e586 8c0d 0a0d  ................
+000020f0: 0a20 2020 2020 2020 2023 2320 312e e8a3  .        ## 1...
+00002100: 85e9 a5b0 e599 a8e8 b083 e794 a8e6 97b6  ................
+00002110: e58f 82e6 95b0 e8a7 a3e9 878a 200d 0a20  ............ .. 
+00002120: 2020 2020 2020 2020 2060 4072 6567 6973           `@regis
+00002130: 7465 722e 7270 6328 6e61 6d65 3d3f 2c69  ter.rpc(name=?,i
+00002140: 6e73 5f6b 7764 733d 3f2c 696e 735f 6172  ns_kwds=?,ins_ar
+00002150: 6773 3d3f 2c2a 2a6f 7074 7329 600d 0a20  gs=?,**opts)`.. 
+00002160: 2020 2020 2020 2041 7474 7269 6275 7465         Attribute
+00002170: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00002180: 6e61 6d65 2028 7374 7229 3a20 e8a2 abe8  name (str): ....
+00002190: bf9c e7a8 8be8 b083 e794 a8e7 9a84 e696  ................
+000021a0: b9e6 b395 e590 8de7 a7b0 efbc 8ce9 9d9e  ................
+000021b0: 6063 6c61 7373 60e4 b8ba e58f afe9 8089  `class`.........
+000021c0: efbc 8c60 636c 6173 7360 e4b8 bae5 bf85  ...`class`......
+000021d0: e5a1 ab0d 0a20 2020 2020 2020 2020 2020  .....           
+000021e0: 2069 6e73 5f61 7267 7320 2874 7570 6c65   ins_args (tuple
+000021f0: 293a 20e5 8faa e69c 89e6 b3a8 e586 8c60  ): ............`
+00002200: 636c 6173 7360 e697 b6e6 898d e69c 89e8  class`..........
+00002210: bf99 e4b8 aae9 8089 e9a1 b9ef bc8c e4b8  ................
+00002220: bae7 b1bb e5ae 9ee4 be8b e58c 96e7 9a84  ................
+00002230: e58f 82e6 95b0 0d0a 2020 2020 2020 2020  ........        
+00002240: 2020 2020 696e 735f 6b77 6473 2028 6469      ins_kwds (di
+00002250: 6374 293a 20e5 8faa e69c 89e6 b3a8 e586  ct): ...........
+00002260: 8c60 636c 6173 7360 e697 b6e6 898d e69c  .`class`........
+00002270: 89e8 bf99 e4b8 aae9 8089 e9a1 b9ef bc8c  ................
+00002280: e4b8 bae7 b1bb e5ae 9ee4 be8b e58c 96e7  ................
+00002290: 9a84 e585 b3e9 94ae e5ad 97e5 8f82 e695  ................
+000022a0: b00d 0a20 2020 2020 2020 2020 2020 202a  ...            *
+000022b0: 2a6f 7074 733a 20e9 8089 e9a1 b9e3 8082  *opts: .........
+000022c0: e4be 8be5 a682 3a20 7573 6550 726f 6365  ......: useProce
+000022d0: 7373 203d 2054 7275 6520 e4bd bfe7 94a8  ss = True ......
+000022e0: e5ad 90e8 bf9b e7a8 8be6 89a7 e8a1 8cef  ................
+000022f0: bc8c e8bf 98e6 9c89 2063 6865 636b 5061  ........ checkPa
+00002300: 7261 6d73 e380 8163 6865 636b 5265 7475  rams...checkRetu
+00002310: 726e e7ad 890d 0a0d 0a20 2020 2020 2020  rn.......       
+00002320: 20e6 b3a8 3a20 e6b3 a8e5 868c e99d 9e60   ...: .........`
+00002330: 636c 6173 7360 e688 9660 636c 6173 7360  class`...`class`
+00002340: e5ae 9ee4 be8b e697 b6ef bc8c e58f afe6  ................
+00002350: 94af e68c 81e6 97a0 e58f 82e8 b083 e794  ................
+00002360: a820 6040 7265 6769 7374 6572 2e72 7063  . `@register.rpc
+00002370: 600d 0a20 2020 2020 2020 2020 2020 200d  `..            .
+00002380: 0a20 2020 2020 2020 2023 2320 322e e696  .        ## 2...
+00002390: b9e6 b395 e8b0 83e7 94a8 e697 b6e5 8f82  ................
+000023a0: e695 b0e8 a7a3 e987 8a20 0d0a 2020 2020  ......... ..    
+000023b0: 2020 2020 6072 6567 6973 7465 722e 7270      `register.rp
+000023c0: 6328 666e 2c6e 616d 653d 3f2c 696e 735f  c(fn,name=?,ins_
+000023d0: 6b77 6473 3d3f 2c69 6e73 5f61 7267 733d  kwds=?,ins_args=
+000023e0: 3f2c 2a2a 6f70 7473 2960 0d0a 2020 2020  ?,**opts)`..    
+000023f0: 2020 2020 4174 7472 6962 7574 6573 3a0d      Attributes:.
+00002400: 0a20 2020 2020 2020 2020 2020 2066 6e3a  .            fn:
+00002410: 20e8 a681 e6b3 a8e5 868c e79a 84e5 87bd   ...............
+00002420: e695 b0e6 8896 e696 b9e6 b395 efbc 8ce4  ................
+00002430: b99f e58f afe4 bba5 e698 af60 636c 6173  ...........`clas
+00002440: 7360 e688 96e8 8085 6063 6c61 7373 60e5  s`......`class`.
+00002450: ae9e e4be 8b0d 0a20 2020 2020 2020 2020  .......         
+00002460: 2020 206e 616d 6520 2873 7472 293a 20e8     name (str): .
+00002470: a2ab e8bf 9ce7 a88b e8b0 83e7 94a8 e79a  ................
+00002480: 84e6 96b9 e6b3 95e5 908d e7a7 b00d 0a20  ............... 
+00002490: 2020 2020 2020 2020 2020 2069 6e73 5f61             ins_a
+000024a0: 7267 7320 2874 7570 6c65 293a 20e5 8faa  rgs (tuple): ...
+000024b0: e69c 89e6 b3a8 e586 8c60 636c 6173 7360  .........`class`
+000024c0: e697 b6e6 898d e69c 89e8 bf99 e4b8 aae9  ................
+000024d0: 8089 e9a1 b9ef bc8c e4b8 bae7 b1bb e5ae  ................
+000024e0: 9ee4 be8b e58c 96e7 9a84 e58f 82e6 95b0  ................
+000024f0: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00002500: 735f 6b77 6473 2028 6469 6374 293a 20e5  s_kwds (dict): .
+00002510: 8faa e69c 89e6 b3a8 e586 8c60 636c 6173  ...........`clas
+00002520: 7360 e697 b6e6 898d e69c 89e8 bf99 e4b8  s`..............
+00002530: aae9 8089 e9a1 b9ef bc8c e4b8 bae7 b1bb  ................
+00002540: e5ae 9ee4 be8b e58c 96e7 9a84 e585 b3e9  ................
+00002550: 94ae e5ad 97e5 8f82 e695 b00d 0a20 2020  .............   
+00002560: 2020 2020 2020 2020 202a 2a6f 7074 733a           **opts:
+00002570: 20e9 8089 e9a1 b9e3 8082 e4be 8be5 a682   ...............
+00002580: 3a20 7573 6550 726f 6365 7373 203d 2054  : useProcess = T
+00002590: 7275 6520 e4bd bfe7 94a8 e5ad 90e8 bf9b  rue ............
+000025a0: e7a8 8be6 89a7 e8a1 8cef bc8c e8bf 98e6  ................
+000025b0: 9c89 2063 6865 636b 5061 7261 6d73 e380  .. checkParams..
+000025c0: 8163 6865 636b 5265 7475 726e e7ad 890d  .checkReturn....
+000025d0: 0a0d 0a20 2020 2020 2020 2022 2222 2020  ...        """  
+000025e0: 0d0a 2020 2020 2020 2020 666e 203d 2066  ..        fn = f
+000025f0: 6e5b 305d 2069 6620 666e 2065 6c73 6520  n[0] if fn else 
+00002600: 4e6f 6e65 0d0a 2020 2020 2020 2020 7265  None..        re
+00002610: 7475 726e 2073 656c 662e 5f72 6567 6973  turn self._regis
+00002620: 7465 7228 666e 2c6e 616d 652c 2772 7063  ter(fn,name,'rpc
+00002630: 272c 696e 735f 6172 6773 3d69 6e73 5f61  ',ins_args=ins_a
+00002640: 7267 732c 696e 735f 6b77 6473 3d69 6e73  rgs,ins_kwds=ins
+00002650: 5f6b 7764 732c 6f70 7473 3d6f 7074 7329  _kwds,opts=opts)
+00002660: 0d0a 0d0a 0d0a 0d0a 2020 2020 6465 6620  ........    def 
+00002670: 6765 7428 7365 6c66 2c2a 666e 2c70 6174  get(self,*fn,pat
+00002680: 683a 7374 723d 4e6f 6e65 2c69 6e73 5f61  h:str=None,ins_a
+00002690: 7267 733a 7475 706c 653d 7475 706c 6528  rgs:tuple=tuple(
+000026a0: 292c 696e 735f 6b77 6473 3a64 6963 743d  ),ins_kwds:dict=
+000026b0: 6469 6374 2829 2c2a 2a6f 7074 7329 3a0d  dict(),**opts):.
+000026c0: 0a20 2020 2020 2020 2022 2222 2320 4745  .        """# GE
+000026d0: 54e6 b3a8 e586 8c0d 0a0d 0a20 2020 2020  T..........     
+000026e0: 2020 20e5 85b3 e4ba 8ee5 908d e7a7 b03a     ............:
+000026f0: 0d0a 2020 2020 2020 2020 2020 2020 e590  ..            ..
+00002700: 8de7 a7b0 e5bf 85e9 a1bb e698 afe5 b08f  ................
+00002710: e586 992c e5a6 82e9 9d9e e5b0 8fe5 8699  ...,............
+00002720: e4bc 9ae8 87aa e58a a8e8 bdac e4b8 bae5  ................
+00002730: b08f e586 99e3 8082 e590 8de7 a7b0 e589  ................
+00002740: 8de4 bc9a e58a a0e4 b88a 602f 60e6 969c  ..........`/`...
+00002750: e69d a0ef bc8c e8bd ace4 b8ba e8b7 afe5  ................
+00002760: be84 0d0a 0d0a 2020 2020 2020 2020 0d0a  ......        ..
+00002770: 2020 2020 2020 2020 e694 afe6 8c81 efbc          ........
+00002780: 9ae7 b1bb 2fe7 b1bb e696 b9e6 b395 2fe7  ..../........./.
+00002790: b1bb e5ae 9ee4 be8b 2fe5 87bd e695 b0e7  ......../.......
+000027a0: 9a84 e6b3 a8e5 868c 0d0a 0d0a 2020 2020  ............    
+000027b0: 2020 2020 2323 2031 2ee8 a385 e9a5 b0e5      ## 1........
+000027c0: 99a8 e8b0 83e7 94a8 e697 b6e5 8f82 e695  ................
+000027d0: b0e8 a7a3 e987 8a20 0d0a 2020 2020 2020  ....... ..      
+000027e0: 2020 2020 6040 7265 6769 7374 6572 2e67      `@register.g
+000027f0: 6574 2870 6174 683d 3f2c 696e 735f 6b77  et(path=?,ins_kw
+00002800: 6473 3d3f 2c69 6e73 5f61 7267 733d 3f2c  ds=?,ins_args=?,
+00002810: 2a2a 6f70 7473 2960 0d0a 2020 2020 2020  **opts)`..      
+00002820: 2020 4174 7472 6962 7574 6573 3a0d 0a20    Attributes:.. 
+00002830: 2020 2020 2020 2020 2020 2070 6174 6820             path 
+00002840: 2873 7472 293a 20e6 b3a8 e586 8ce7 9a84  (str): .........
+00002850: e8b7 afe5 be84 e590 8de7 a7b0 efbc 8ce9  ................
+00002860: 9d9e 6063 6c61 7373 60e4 b8ba e58f afe9  ..`class`.......
+00002870: 8089 efbc 8c60 636c 6173 7360 e4b8 bae5  .....`class`....
+00002880: bf85 e5a1 ab0d 0a20 2020 2020 2020 2020  .......         
+00002890: 2020 2069 6e73 5f61 7267 7320 2874 7570     ins_args (tup
+000028a0: 6c65 293a 20e5 8faa e69c 89e6 b3a8 e586  le): ...........
+000028b0: 8c60 636c 6173 7360 e697 b6e6 898d e69c  .`class`........
+000028c0: 89e8 bf99 e4b8 aae9 8089 e9a1 b9ef bc8c  ................
+000028d0: e4b8 bae7 b1bb e5ae 9ee4 be8b e58c 96e7  ................
+000028e0: 9a84 e58f 82e6 95b0 0d0a 2020 2020 2020  ..........      
+000028f0: 2020 2020 2020 696e 735f 6b77 6473 2028        ins_kwds (
+00002900: 6469 6374 293a 20e5 8faa e69c 89e6 b3a8  dict): .........
+00002910: e586 8c60 636c 6173 7360 e697 b6e6 898d  ...`class`......
+00002920: e69c 89e8 bf99 e4b8 aae9 8089 e9a1 b9ef  ................
+00002930: bc8c e4b8 bae7 b1bb e5ae 9ee4 be8b e58c  ................
+00002940: 96e7 9a84 e585 b3e9 94ae e5ad 97e5 8f82  ................
+00002950: e695 b00d 0a20 2020 2020 2020 2020 2020  .....           
+00002960: 202a 2a6f 7074 733a 20e9 8089 e9a1 b9e3   **opts: .......
+00002970: 8082 e4be 8be5 a682 3a20 7573 6550 726f  ........: usePro
+00002980: 6365 7373 203d 2054 7275 6520 e4bd bfe7  cess = True ....
+00002990: 94a8 e5ad 90e8 bf9b e7a8 8be6 89a7 e8a1  ................
+000029a0: 8cef bc8c e8bf 98e6 9c89 2063 6865 636b  .......... check
+000029b0: 5061 7261 6d73 e380 8163 6865 636b 5265  Params...checkRe
+000029c0: 7475 726e e7ad 890d 0a0d 0a0d 0a20 2020  turn.........   
+000029d0: 2020 2020 20e6 b3a8 3a20 e6b3 a8e5 868c       ...: ......
+000029e0: e99d 9e60 636c 6173 7360 e688 9660 636c  ...`class`...`cl
+000029f0: 6173 7360 e5ae 9ee4 be8b e697 b6ef bc8c  ass`............
+00002a00: e58f afe6 94af e68c 81e6 97a0 e58f 82e8  ................
+00002a10: b083 e794 a820 6040 7265 6769 7374 6572  ..... `@register
+00002a20: 2e67 6574 600d 0a20 2020 2020 2020 2020  .get`..         
+00002a30: 2020 200d 0a20 2020 2020 2020 2023 2320     ..        ## 
+00002a40: 322e e696 b9e6 b395 e8b0 83e7 94a8 e697  2...............
+00002a50: b6e5 8f82 e695 b0e8 a7a3 e987 8a20 0d0a  ............. ..
+00002a60: 2020 2020 2020 2020 6072 6567 6973 7465          `registe
+00002a70: 722e 6765 7428 666e 2c70 6174 683d 3f2c  r.get(fn,path=?,
+00002a80: 696e 735f 6b77 6473 3d3f 2c69 6e73 5f61  ins_kwds=?,ins_a
+00002a90: 7267 733d 3f2c 2a2a 6f70 7473 2960 0d0a  rgs=?,**opts)`..
+00002aa0: 2020 2020 2020 2020 4174 7472 6962 7574          Attribut
+00002ab0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00002ac0: 2066 6e3a 20e8 a681 e6b3 a8e5 868c e79a   fn: ...........
+00002ad0: 84e5 87bd e695 b0e6 8896 e696 b9e6 b395  ................
+00002ae0: efbc 8ce4 b99f e58f afe4 bba5 e698 af60  ...............`
+00002af0: 636c 6173 7360 e688 96e8 8085 6063 6c61  class`......`cla
+00002b00: 7373 60e5 ae9e e4be 8b0d 0a20 2020 2020  ss`........     
+00002b10: 2020 2020 2020 2070 6174 6820 2873 7472         path (str
+00002b20: 293a 20e6 b3a8 e586 8ce7 9a84 e8b7 afe5  ): .............
+00002b30: be84 e590 8de7 a7b0 0d0a 2020 2020 2020  ..........      
+00002b40: 2020 2020 2020 696e 735f 6172 6773 2028        ins_args (
+00002b50: 7475 706c 6529 3a20 e58f aae6 9c89 e6b3  tuple): ........
+00002b60: a8e5 868c 6063 6c61 7373 60e6 97b6 e689  ....`class`.....
+00002b70: 8de6 9c89 e8bf 99e4 b8aa e980 89e9 a1b9  ................
+00002b80: efbc 8ce4 b8ba e7b1 bbe5 ae9e e4be 8be5  ................
+00002b90: 8c96 e79a 84e5 8f82 e695 b00d 0a20 2020  .............   
+00002ba0: 2020 2020 2020 2020 2069 6e73 5f6b 7764           ins_kwd
+00002bb0: 7320 2864 6963 7429 3a20 e58f aae6 9c89  s (dict): ......
+00002bc0: e6b3 a8e5 868c 6063 6c61 7373 60e6 97b6  ......`class`...
+00002bd0: e689 8de6 9c89 e8bf 99e4 b8aa e980 89e9  ................
+00002be0: a1b9 efbc 8ce4 b8ba e7b1 bbe5 ae9e e4be  ................
+00002bf0: 8be5 8c96 e79a 84e5 85b3 e994 aee5 ad97  ................
+00002c00: e58f 82e6 95b0 0d0a 2020 2020 2020 2020  ........        
+00002c10: 2020 2020 2a2a 6f70 7473 3a20 e980 89e9      **opts: ....
+00002c20: a1b9 e380 82e4 be8b e5a6 823a 2075 7365  ...........: use
+00002c30: 5072 6f63 6573 7320 3d20 5472 7565 20e4  Process = True .
+00002c40: bdbf e794 a8e5 ad90 e8bf 9be7 a88b e689  ................
+00002c50: a7e8 a18c efbc 8ce8 bf98 e69c 8920 6368  ............. ch
+00002c60: 6563 6b50 6172 616d 73e3 8081 6368 6563  eckParams...chec
+00002c70: 6b52 6574 7572 6ee7 ad89 0d0a 0d0a 2020  kReturn.......  
+00002c80: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00002c90: 2020 2066 6e20 3d20 666e 5b30 5d20 6966     fn = fn[0] if
+00002ca0: 2066 6e20 656c 7365 204e 6f6e 650d 0a20   fn else None.. 
+00002cb0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00002cc0: 6c66 2e5f 7265 6769 7374 6572 2866 6e2c  lf._register(fn,
+00002cd0: 7061 7468 2c27 6765 7427 2c69 6e73 5f61  path,'get',ins_a
+00002ce0: 7267 733d 696e 735f 6172 6773 2c69 6e73  rgs=ins_args,ins
+00002cf0: 5f6b 7764 733d 696e 735f 6b77 6473 2c6f  _kwds=ins_kwds,o
+00002d00: 7074 733d 6f70 7473 290d 0a0d 0a0d 0a0d  pts=opts).......
+00002d10: 0a20 2020 2064 6566 2070 6f73 7428 7365  .    def post(se
+00002d20: 6c66 2c2a 666e 2c70 6174 683a 7374 723d  lf,*fn,path:str=
+00002d30: 4e6f 6e65 2c69 6e73 5f61 7267 733a 7475  None,ins_args:tu
+00002d40: 706c 653d 7475 706c 6528 292c 696e 735f  ple=tuple(),ins_
+00002d50: 6b77 6473 3a64 6963 743d 6469 6374 2829  kwds:dict=dict()
+00002d60: 2c2a 2a6f 7074 7329 3a20 2020 2020 200d  ,**opts):      .
+00002d70: 0a20 2020 2020 2020 2022 2222 2320 504f  .        """# PO
+00002d80: 5354 e6b3 a8e5 868c 0d0a 2020 2020 2020  ST........      
+00002d90: 2020 e585 b3e4 ba8e e590 8de7 a7b0 3a0d    ............:.
+00002da0: 0a20 2020 2020 2020 2020 2020 20e5 908d  .            ...
+00002db0: e7a7 b0e5 bf85 e9a1 bbe6 98af e5b0 8fe5  ................
+00002dc0: 8699 2ce5 a682 e99d 9ee5 b08f e586 99e4  ..,.............
+00002dd0: bc9a e887 aae5 8aa8 e8bd ace4 b8ba e5b0  ................
+00002de0: 8fe5 8699 e380 82e5 908d e7a7 b0e5 898d  ................
+00002df0: e4bc 9ae5 8aa0 e4b8 8a60 2f60 e696 9ce6  .........`/`....
+00002e00: 9da0 efbc 8ce8 bdac e4b8 bae8 b7af e5be  ................
+00002e10: 840d 0a0d 0a20 2020 2020 2020 20e6 94af  .....        ...
+00002e20: e68c 81ef bc9a e7b1 bb2f e7b1 bbe6 96b9  ........./......
+00002e30: e6b3 952f e7b1 bbe5 ae9e e4be 8b2f e587  .../........./..
+00002e40: bde6 95b0 e79a 84e6 b3a8 e586 8c0d 0a0d  ................
+00002e50: 0a20 2020 2020 2020 2023 2320 312e e8a3  .        ## 1...
+00002e60: 85e9 a5b0 e599 a8e8 b083 e794 a8e6 97b6  ................
+00002e70: e58f 82e6 95b0 e8a7 a3e9 878a 200d 0a20  ............ .. 
+00002e80: 2020 2020 2020 2020 2060 4072 6567 6973           `@regis
+00002e90: 7465 722e 706f 7374 2870 6174 683d 3f2c  ter.post(path=?,
+00002ea0: 696e 735f 6b77 6473 3d3f 2c69 6e73 5f61  ins_kwds=?,ins_a
+00002eb0: 7267 733d 3f2c 2a2a 6f70 7473 2960 0d0a  rgs=?,**opts)`..
+00002ec0: 2020 2020 2020 2020 4174 7472 6962 7574          Attribut
+00002ed0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00002ee0: 2070 6174 6820 2873 7472 293a 20e6 b3a8   path (str): ...
+00002ef0: e586 8ce7 9a84 e8b7 afe5 be84 e590 8de7  ................
+00002f00: a7b0 efbc 8ce9 9d9e 6063 6c61 7373 60e4  ........`class`.
+00002f10: b8ba e58f afe9 8089 efbc 8c60 636c 6173  ...........`clas
+00002f20: 7360 e4b8 bae5 bf85 e5a1 ab0d 0a20 2020  s`...........   
+00002f30: 2020 2020 2020 2020 2069 6e73 5f61 7267           ins_arg
+00002f40: 7320 2874 7570 6c65 293a 20e5 8faa e69c  s (tuple): .....
+00002f50: 89e6 b3a8 e586 8c60 636c 6173 7360 e697  .......`class`..
+00002f60: b6e6 898d e69c 89e8 bf99 e4b8 aae9 8089  ................
+00002f70: e9a1 b9ef bc8c e4b8 bae7 b1bb e5ae 9ee4  ................
+00002f80: be8b e58c 96e7 9a84 e58f 82e6 95b0 0d0a  ................
+00002f90: 2020 2020 2020 2020 2020 2020 696e 735f              ins_
+00002fa0: 6b77 6473 2028 6469 6374 293a 20e5 8faa  kwds (dict): ...
+00002fb0: e69c 89e6 b3a8 e586 8c60 636c 6173 7360  .........`class`
+00002fc0: e697 b6e6 898d e69c 89e8 bf99 e4b8 aae9  ................
+00002fd0: 8089 e9a1 b9ef bc8c e4b8 bae7 b1bb e5ae  ................
+00002fe0: 9ee4 be8b e58c 96e7 9a84 e585 b3e9 94ae  ................
+00002ff0: e5ad 97e5 8f82 e695 b00d 0a20 2020 2020  ...........     
+00003000: 2020 2020 2020 202a 2a6f 7074 733a 20e9         **opts: .
+00003010: 8089 e9a1 b9e3 8082 e4be 8be5 a682 3a20  ..............: 
+00003020: 7573 6550 726f 6365 7373 203d 2054 7275  useProcess = Tru
+00003030: 6520 e4bd bfe7 94a8 e5ad 90e8 bf9b e7a8  e ..............
+00003040: 8be6 89a7 e8a1 8cef bc8c e8bf 98e6 9c89  ................
+00003050: 2063 6865 636b 5061 7261 6d73 e380 8163   checkParams...c
+00003060: 6865 636b 5265 7475 726e e7ad 890d 0a0d  heckReturn......
+00003070: 0a20 2020 2020 2020 20e6 b3a8 3a20 e6b3  .        ...: ..
+00003080: a8e5 868c e99d 9e60 636c 6173 7360 e688  .......`class`..
+00003090: 9660 636c 6173 7360 e5ae 9ee4 be8b e697  .`class`........
+000030a0: b6ef bc8c e58f afe6 94af e68c 81e6 97a0  ................
+000030b0: e58f 82e8 b083 e794 a820 6040 7265 6769  ......... `@regi
+000030c0: 7374 6572 2e70 6f73 7460 0d0a 2020 2020  ster.post`..    
+000030d0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000030e0: 2020 2323 2032 2ee6 96b9 e6b3 95e8 b083    ## 2..........
+000030f0: e794 a8e6 97b6 e58f 82e6 95b0 e8a7 a3e9  ................
+00003100: 878a 200d 0a20 2020 2020 2020 2060 7265  .. ..        `re
+00003110: 6769 7374 6572 2e70 6f73 7428 666e 2c70  gister.post(fn,p
+00003120: 6174 683d 3f2c 696e 735f 6b77 6473 3d3f  ath=?,ins_kwds=?
+00003130: 2c69 6e73 5f61 7267 733d 3f2c 2a2a 6f70  ,ins_args=?,**op
+00003140: 7473 2960 0d0a 2020 2020 2020 2020 4174  ts)`..        At
+00003150: 7472 6962 7574 6573 3a0d 0a20 2020 2020  tributes:..     
+00003160: 2020 2020 2020 2066 6e3a 20e8 a681 e6b3         fn: .....
+00003170: a8e5 868c e79a 84e5 87bd e695 b0e6 8896  ................
+00003180: e696 b9e6 b395 efbc 8ce4 b99f e58f afe4  ................
+00003190: bba5 e698 af60 636c 6173 7360 e688 96e8  .....`class`....
+000031a0: 8085 6063 6c61 7373 60e5 ae9e e4be 8b0d  ..`class`.......
+000031b0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+000031c0: 6820 2873 7472 293a 20e6 b3a8 e586 8ce7  h (str): .......
+000031d0: 9a84 e8b7 afe5 be84 e590 8de7 a7b0 0d0a  ................
+000031e0: 2020 2020 2020 2020 2020 2020 696e 735f              ins_
+000031f0: 6172 6773 2028 7475 706c 6529 3a20 e58f  args (tuple): ..
+00003200: aae6 9c89 e6b3 a8e5 868c 6063 6c61 7373  ..........`class
+00003210: 60e6 97b6 e689 8de6 9c89 e8bf 99e4 b8aa  `...............
+00003220: e980 89e9 a1b9 efbc 8ce4 b8ba e7b1 bbe5  ................
+00003230: ae9e e4be 8be5 8c96 e79a 84e5 8f82 e695  ................
+00003240: b00d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00003250: 6e73 5f6b 7764 7320 2864 6963 7429 3a20  ns_kwds (dict): 
+00003260: e58f aae6 9c89 e6b3 a8e5 868c 6063 6c61  ............`cla
+00003270: 7373 60e6 97b6 e689 8de6 9c89 e8bf 99e4  ss`.............
+00003280: b8aa e980 89e9 a1b9 efbc 8ce4 b8ba e7b1  ................
+00003290: bbe5 ae9e e4be 8be5 8c96 e79a 84e5 85b3  ................
+000032a0: e994 aee5 ad97 e58f 82e6 95b0 0d0a 2020  ..............  
+000032b0: 2020 2020 2020 2020 2020 2a2a 6f70 7473            **opts
+000032c0: 3a20 e980 89e9 a1b9 e380 82e4 be8b e5a6  : ..............
+000032d0: 823a 2075 7365 5072 6f63 6573 7320 3d20  .: useProcess = 
+000032e0: 5472 7565 20e4 bdbf e794 a8e5 ad90 e8bf  True ...........
+000032f0: 9be7 a88b e689 a7e8 a18c efbc 8ce8 bf98  ................
+00003300: e69c 8920 6368 6563 6b50 6172 616d 73e3  ... checkParams.
+00003310: 8081 6368 6563 6b52 6574 7572 6ee7 ad89  ..checkReturn...
+00003320: 0d0a 0d0a 2020 2020 2020 2020 2222 2220  ....        """ 
+00003330: 0d0a 2020 2020 2020 2020 666e 203d 2066  ..        fn = f
+00003340: 6e5b 305d 2069 6620 666e 2065 6c73 6520  n[0] if fn else 
+00003350: 4e6f 6e65 0d0a 2020 2020 2020 2020 7265  None..        re
+00003360: 7475 726e 2073 656c 662e 5f72 6567 6973  turn self._regis
+00003370: 7465 7228 666e 2c70 6174 682c 2770 6f73  ter(fn,path,'pos
+00003380: 7427 2c69 6e73 5f61 7267 733d 696e 735f  t',ins_args=ins_
+00003390: 6172 6773 2c69 6e73 5f6b 7764 733d 696e  args,ins_kwds=in
+000033a0: 735f 6b77 6473 2c6f 7074 733d 6f70 7473  s_kwds,opts=opts
+000033b0: 290d 0a0d 0a0d 0a20 2020 2064 6566 2063  )......    def c
+000033c0: 7265 6174 524d 6574 686f 6428 7365 6c66  reatRMethod(self
+000033d0: 2c2a 2a6f 7074 7329 3a0d 0a20 2020 2020  ,**opts):..     
+000033e0: 2020 2022 2222 2320 e588 9be5 bbba 524d     """# ......RM
+000033f0: 6574 686f 64e5 ae9e e4be 8bef bc8c e5b9  ethod...........
+00003400: b6e4 bf9d e5ad 98e5 88b0 e5af b9e5 ba94  ................
+00003410: e5ae b9e5 99a8 e4b8 ade3 8082 0d0a 2020  ..............  
+00003420: 2020 2020 2020 2323 206f 7074 73e5 8f82        ## opts...
+00003430: e695 b0e5 ad97 e6ae b50d 0a20 2020 2020  ...........     
+00003440: 2020 2041 7474 7269 6275 7465 733a 0d0a     Attributes:..
+00003450: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00003460: 2028 7374 7229 3a20 e6b3 a8e5 868c e79a   (str): ........
+00003470: 84e5 908d e7a7 b0e6 8896 e8b7 afe5 be84  ................
+00003480: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00003490: 7468 6f64 5479 7065 2028 7374 7229 3a20  thodType (str): 
+000034a0: e6b3 a8e5 868c e7b1 bbe5 9e8b 2047 4554  ............ GET
+000034b0: 202f 2050 4f53 5420 2f20 5250 430d 0a20   / POST / RPC.. 
+000034c0: 2020 2020 2020 2020 2020 2063 616c 6c61             calla
+000034d0: 626c 6520 2863 616c 6c61 626c 6529 3a20  ble (callable): 
+000034e0: e58f afe8 b083 e794 a8e7 9a84 e696 b9e6  ................
+000034f0: b395 2fe5 87bd e695 b00d 0a20 2020 2020  ../........     
+00003500: 2020 2020 2020 2063 6865 636b 5061 7261         checkPara
+00003510: 6d73 3f20 2862 6f6f 6c29 3a20 e58f afe9  ms? (bool): ....
+00003520: 8089 efbc 8ce6 98af e590 a6e6 a380 e69f  ................
+00003530: a5e5 8f82 e695 b00d 0a20 2020 2020 2020  .........       
+00003540: 2020 2020 2063 6865 636b 5265 7475 726e       checkReturn
+00003550: 3f20 2862 6f6f 6c29 3a20 e58f afe9 8089  ? (bool): ......
+00003560: efbc 8ce6 98af e590 a6e6 a380 e69f a5e8  ................
+00003570: bf94 e59b 9ee5 80bc 0d0a 2020 2020 2020  ..........      
+00003580: 2020 2020 2020 7573 6550 726f 6365 7373        useProcess
+00003590: 3f20 2862 6f6f 6c29 3a20 20e5 8faf e980  ? (bool):  .....
+000035a0: 89ef bc8c e698 afe5 90a6 e4bd bfe7 94a8  ................
+000035b0: e5ad 90e8 bf9b e7a8 8be6 89a7 e8a1 8c0d  ................
+000035c0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+000035d0: 2020 2020 2020 6e61 6d65 3a73 7472 203d        name:str =
+000035e0: 206f 7074 732e 6765 7428 276e 616d 6527   opts.get('name'
+000035f0: 290d 0a20 2020 2020 2020 206d 6574 686f  )..        metho
+00003600: 6454 7970 653a 7374 7220 3d20 6f70 7473  dType:str = opts
+00003610: 2e67 6574 2827 6d65 7468 6f64 5479 7065  .get('methodType
+00003620: 2729 0d0a 0d0a 2020 2020 2020 2020 6f70  ')....        op
+00003630: 7473 5b27 7573 6550 726f 6365 7373 275d  ts['useProcess']
+00003640: 203d 2046 616c 7365 2069 6620 6f70 7473   = False if opts
+00003650: 2e67 6574 2827 7573 6550 726f 6365 7373  .get('useProcess
+00003660: 2729 203d 3d20 4e6f 6e65 2065 6c73 6520  ') == None else 
+00003670: 6f70 7473 2e67 6574 2827 7573 6550 726f  opts.get('usePro
+00003680: 6365 7373 2729 0d0a 2020 2020 2020 2020  cess')..        
+00003690: 6f70 7473 5b27 6368 6563 6b50 6172 616d  opts['checkParam
+000036a0: 7327 5d20 3d20 7365 6c66 2e5f 5f63 6865  s'] = self.__che
+000036b0: 636b 5061 7261 6d73 2069 6620 6f70 7473  ckParams if opts
+000036c0: 2e67 6574 2827 6368 6563 6b50 6172 616d  .get('checkParam
+000036d0: 7327 2920 3d3d 204e 6f6e 6520 656c 7365  s') == None else
+000036e0: 206f 7074 732e 6765 7428 2763 6865 636b   opts.get('check
+000036f0: 5061 7261 6d73 2729 0d0a 2020 2020 2020  Params')..      
+00003700: 2020 6f70 7473 5b27 6368 6563 6b52 6574    opts['checkRet
+00003710: 7572 6e27 5d20 3d20 7365 6c66 2e5f 5f63  urn'] = self.__c
+00003720: 6865 636b 5265 7475 726e 2069 6620 6f70  heckReturn if op
+00003730: 7473 2e67 6574 2827 6368 6563 6b52 6574  ts.get('checkRet
+00003740: 7572 6e27 2920 3d3d 204e 6f6e 6520 656c  urn') == None el
+00003750: 7365 206f 7074 732e 6765 7428 2763 6865  se opts.get('che
+00003760: 636b 5265 7475 726e 2729 0d0a 0d0a 2020  ckReturn')....  
+00003770: 2020 2020 2020 6966 206d 6574 686f 6454        if methodT
+00003780: 7970 653d 3d27 7270 6327 3a0d 0a20 2020  ype=='rpc':..   
+00003790: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+000037a0: 6f70 7473 2e67 6574 2827 6e61 6d65 2729  opts.get('name')
+000037b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000037c0: 206e 6f74 206e 616d 655b 305d 2e69 7361   not name[0].isa
+000037d0: 6c70 6861 2829 3a0d 0a20 2020 2020 2020  lpha():..       
+000037e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000037f0: 616c 7565 4572 726f 7228 6622 5265 6769  alueError(f"Regi
+00003800: 7374 7261 7469 6f6e 2065 7272 6f72 2c54  stration error,T
+00003810: 6865 206e 616d 6520 277b 6e61 6d65 7d27  he name '{name}'
+00003820: 206d 7573 7420 7374 6172 7420 7769 7468   must start with
+00003830: 2061 206c 6574 7465 7222 290d 0a20 2020   a letter")..   
+00003840: 2020 2020 2020 2020 2073 656c 662e 5f5f           self.__
+00003850: 7270 635f 6d65 7468 6f64 735b 6e61 6d65  rpc_methods[name
+00003860: 5d20 3d20 524d 6574 686f 6428 2a2a 6f70  ] = RMethod(**op
+00003870: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
+00003880: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
+00003890: 2020 2069 6620 6d65 7468 6f64 5479 7065     if methodType
+000038a0: 3d3d 2767 6574 273a 0d0a 2020 2020 2020  =='get':..      
+000038b0: 2020 2020 2020 6e61 6d65 203d 206e 616d        name = nam
+000038c0: 652e 7265 706c 6163 6528 272e 272c 272f  e.replace('.','/
+000038d0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+000038e0: 6966 206e 6f74 206e 616d 652e 7374 6172  if not name.star
+000038f0: 7473 7769 7468 2827 2f27 293a 0d0a 2020  tswith('/'):..  
+00003900: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00003910: 6d65 3d27 2f27 2b6e 616d 650d 0a20 2020  me='/'+name..   
+00003920: 2020 2020 2020 2020 206e 616d 655f 203d           name_ =
+00003930: 206e 616d 652e 6c6f 7765 7228 290d 0a20   name.lower().. 
+00003940: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
+00003950: 6d65 2021 3d20 6e61 6d65 5f3a 0d0a 2020  me != name_:..  
+00003960: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00003970: 6767 6572 2e77 6172 6e69 6e67 2866 2750  gger.warning(f'P
+00003980: 6174 684e 616d 6520 6368 616e 6765 642c  athName changed,
+00003990: 5468 6520 7061 7468 2022 7b6e 616d 657d  The path "{name}
+000039a0: 2220 6368 616e 6765 7320 746f 2022 7b6e  " changes to "{n
+000039b0: 616d 655f 7d22 2729 0d0a 2020 2020 2020  ame_}"')..      
+000039c0: 2020 2020 2020 7365 6c66 2e5f 5f67 6574        self.__get
+000039d0: 5f6d 6574 686f 6473 5b6e 616d 655f 5d20  _methods[name_] 
+000039e0: 3d20 524d 6574 686f 6428 2a2a 6f70 7473  = RMethod(**opts
+000039f0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00003a00: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+00003a10: 2069 6620 6d65 7468 6f64 5479 7065 3d3d   if methodType==
+00003a20: 2770 6f73 7427 3a0d 0a20 2020 2020 2020  'post':..       
+00003a30: 2020 2020 206e 616d 6520 3d20 6e61 6d65       name = name
+00003a40: 2e72 6570 6c61 6365 2827 2e27 2c27 2f27  .replace('.','/'
+00003a50: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00003a60: 6620 6e6f 7420 6e61 6d65 2e73 7461 7274  f not name.start
+00003a70: 7377 6974 6828 272f 2729 3a0d 0a20 2020  swith('/'):..   
+00003a80: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00003a90: 653d 272f 272b 6e61 6d65 0d0a 2020 2020  e='/'+name..    
+00003aa0: 2020 2020 2020 2020 6e61 6d65 5f20 3d20          name_ = 
+00003ab0: 6e61 6d65 2e6c 6f77 6572 2829 0d0a 2020  name.lower()..  
+00003ac0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00003ad0: 6520 213d 206e 616d 655f 3a0d 0a20 2020  e != name_:..   
+00003ae0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+00003af0: 6765 722e 7761 726e 696e 6728 6627 5061  ger.warning(f'Pa
+00003b00: 7468 4e61 6d65 2063 6861 6e67 6564 2c54  thName changed,T
+00003b10: 6865 2070 6174 6820 227b 6e61 6d65 7d22  he path "{name}"
+00003b20: 2063 6861 6e67 6573 2074 6f20 227b 6e61   changes to "{na
+00003b30: 6d65 5f7d 2227 2920 2020 2020 2020 2020  me_}"')         
+00003b40: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00003b50: 2073 656c 662e 5f5f 706f 7374 5f6d 6574   self.__post_met
+00003b60: 686f 6473 5b6e 616d 655f 5d20 3d20 524d  hods[name_] = RM
+00003b70: 6574 686f 6428 2a2a 6f70 7473 290d 0a20  ethod(**opts).. 
+00003b80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003b90: 6e0d 0a0d 0a0d 0a20 2020 2064 6566 205f  n......    def _
+00003ba0: 7265 6769 7374 6572 2873 656c 662c 5f66  register(self,_f
+00003bb0: 5f3d 4e6f 6e65 2c5f 6e5f 3d4e 6f6e 652c  _=None,_n_=None,
+00003bc0: 5f74 5f3a 7374 723d 4e6f 6e65 2c69 6e73  _t_:str=None,ins
+00003bd0: 5f61 7267 733a 7475 706c 653d 7475 706c  _args:tuple=tupl
+00003be0: 6528 292c 696e 735f 6b77 6473 3a64 6963  e(),ins_kwds:dic
+00003bf0: 743d 6469 6374 2829 2c6f 7074 733a 6469  t=dict(),opts:di
+00003c00: 6374 3d64 6963 7428 2929 3a0d 0a20 2020  ct=dict()):..   
+00003c10: 2020 2020 2022 2222 e980 9ae7 94a8 e6b3       """........
+00003c20: a8e5 868c efbc 8ce6 94af e68c 81e6 b3a8  ................
+00003c30: e586 8ce5 87bd e695 b0ef bc8c e7b1 bbef  ................
+00003c40: bc88 e887 aae5 8aa8 e5ae 9ee4 be8b e58c  ................
+00003c50: 96ef bc89 efbc 8ce7 b1bb e5ae 9ee4 be8b  ................
+00003c60: efbc 8c22 2222 0d0a 2020 2020 2020 2020  ..."""..        
+00003c70: 6966 205f 665f 2069 7320 4e6f 6e65 3a0d  if _f_ is None:.
+00003c80: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00003c90: 7572 6e20 7061 7274 6961 6c28 7365 6c66  urn partial(self
+00003ca0: 2e5f 7265 6769 7374 6572 2c20 5f6e 5f3d  ._register, _n_=
+00003cb0: 5f6e 5f2c 5f74 5f3d 5f74 5f2c 696e 735f  _n_,_t_=_t_,ins_
+00003cc0: 6172 6773 3d69 6e73 5f61 7267 732c 696e  args=ins_args,in
+00003cd0: 735f 6b77 6473 3d69 6e73 5f6b 7764 732c  s_kwds=ins_kwds,
+00003ce0: 6f70 7473 3d6f 7074 7329 0d0a 2020 2020  opts=opts)..    
+00003cf0: 2020 2020 0d0a 2020 2020 2020 2020 6966      ..        if
+00003d00: 2074 7970 6528 5f66 5f29 3d3d 7374 723a   type(_f_)==str:
+00003d10: 0d0a 2020 2020 2020 2020 2020 2020 5f6e  ..            _n
+00003d20: 5f20 3d20 5f66 5f2e 7374 7269 7028 290d  _ = _f_.strip().
+00003d30: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
+00003d40: 6620 5f6e 5f20 616e 6420 5f6e 5f5b 305d  f _n_ and _n_[0]
+00003d50: 2e69 7361 6c70 6861 2829 3a0d 0a20 2020  .isalpha():..   
+00003d60: 2020 2020 2020 2020 2069 6620 5f6e 5f3a           if _n_:
+00003d70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003d80: 2020 7265 7475 726e 2070 6172 7469 616c    return partial
+00003d90: 2873 656c 662e 5f72 6567 6973 7465 722c  (self._register,
+00003da0: 5f6e 5f3d 5f6e 5f2c 5f74 5f3d 5f74 5f2c  _n_=_n_,_t_=_t_,
+00003db0: 696e 735f 6172 6773 3d69 6e73 5f61 7267  ins_args=ins_arg
+00003dc0: 732c 696e 735f 6b77 6473 3d69 6e73 5f6b  s,ins_kwds=ins_k
+00003dd0: 7764 732c 6f70 7473 3d6f 7074 7329 0d0a  wds,opts=opts)..
+00003de0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00003df0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003e00: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00003e10: 726f 7228 6622 5265 6769 7374 7261 7469  ror(f"Registrati
+00003e20: 6f6e 2065 7272 6f72 2c27 7b5f 665f 7d27  on error,'{_f_}'
+00003e30: 2063 616e 6e6f 7420 6265 2075 7365 6420   cannot be used 
+00003e40: 6173 2061 2072 6567 6973 7465 7265 6420  as a registered 
+00003e50: 6e61 6d65 2122 290d 0a20 2020 2020 2020  name!")..       
+00003e60: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
+00003e70: 6620 696e 7370 6563 742e 6973 6675 6e63  f inspect.isfunc
+00003e80: 7469 6f6e 285f 665f 2920 6f72 2069 6e73  tion(_f_) or ins
+00003e90: 7065 6374 2e69 736d 6574 686f 6428 5f66  pect.ismethod(_f
+00003ea0: 5f29 3a0d 0a20 2020 2020 2020 2020 2020  _):..           
+00003eb0: 2069 6620 6e6f 7420 5f6e 5f3a 0d0a 2020   if not _n_:..  
+00003ec0: 2020 2020 2020 2020 2020 2020 2020 5f6e                _n
+00003ed0: 5f20 3d20 5f66 5f2e 5f5f 6e61 6d65 5f5f  _ = _f_.__name__
+00003ee0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+00003ef0: 2020 2020 2020 2020 2020 2020 6f70 7473              opts
+00003f00: 5f3a 6469 6374 203d 2064 6963 7428 6e61  _:dict = dict(na
+00003f10: 6d65 3d5f 6e5f 2c6d 6574 686f 6454 7970  me=_n_,methodTyp
+00003f20: 653d 5f74 5f2c 6361 6c6c 6162 6c65 3d5f  e=_t_,callable=_
+00003f30: 665f 290d 0a20 2020 2020 2020 2020 2020  f_)..           
+00003f40: 206f 7074 735f 2e75 7064 6174 6528 6f70   opts_.update(op
+00003f50: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
+00003f60: 2073 656c 662e 6372 6561 7452 4d65 7468   self.creatRMeth
+00003f70: 6f64 282a 2a6f 7074 735f 290d 0a20 2020  od(**opts_)..   
+00003f80: 2020 2020 2065 6c69 6620 696e 7370 6563       elif inspec
+00003f90: 742e 6973 6d6f 6475 6c65 285f 665f 293a  t.ismodule(_f_):
+00003fa0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00003fb0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00003fc0: 2252 6567 6973 7472 6174 696f 6e20 6572  "Registration er
+00003fd0: 726f 722c 6d6f 6475 6c65 2027 7b5f 665f  ror,module '{_f_
+00003fe0: 2e5f 5f6e 616d 655f 5f7d 2720 636f 756c  .__name__}' coul
+00003ff0: 6420 6e6f 7420 6265 2072 6567 6973 7465  d not be registe
+00004000: 7265 6421 2229 0d0a 2020 2020 2020 2020  red!")..        
+00004010: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00004020: 2020 2023 20e6 b3a8 e586 8c63 6c61 7373     # ......class
+00004030: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00004040: 206e 6f74 205f 6e5f 3a0d 0a20 2020 2020   not _n_:..     
+00004050: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00004060: 7370 6563 742e 6973 636c 6173 7328 5f66  spect.isclass(_f
+00004070: 5f29 3a0d 0a20 2020 2020 2020 2020 2020  _):..           
+00004080: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00004090: 616c 7565 4572 726f 7228 6622 5265 6769  alueError(f"Regi
+000040a0: 7374 7261 7469 6f6e 2065 7272 6f72 2c54  stration error,T
+000040b0: 6865 2027 7b5f 665f 2e5f 5f6e 616d 655f  he '{_f_.__name_
+000040c0: 5f7d 2720 636c 6173 7320 6973 206e 6f74  _}' class is not
+000040d0: 206e 616d 6564 2122 290d 0a20 2020 2020   named!")..     
+000040e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000040f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004100: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00004110: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00004120: 6520 5661 6c75 6545 7272 6f72 2866 2252  e ValueError(f"R
+00004130: 6567 6973 7472 6174 696f 6e20 6572 726f  egistration erro
+00004140: 722c 5468 6520 277b 7479 7065 285f 665f  r,The '{type(_f_
+00004150: 292e 5f5f 6e61 6d65 5f5f 7d27 2069 6e73  ).__name__}' ins
+00004160: 7461 6e63 6520 6973 206e 6f74 206e 616d  tance is not nam
+00004170: 6564 2122 290d 0a20 2020 2020 2020 2020  ed!")..         
+00004180: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00004190: 2020 2020 2069 6620 7479 7065 285f 6e5f       if type(_n_
+000041a0: 2921 3d73 7472 3a0d 0a20 2020 2020 2020  )!=str:..       
+000041b0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000041c0: 616c 7565 4572 726f 7228 6622 5265 6769  alueError(f"Regi
+000041d0: 7374 7261 7469 6f6e 2065 7272 6f72 2c54  stration error,T
+000041e0: 6865 206e 616d 6520 277b 5f6e 5f7d 2720  he name '{_n_}' 
+000041f0: 6973 206e 6f74 2061 2073 7472 696e 6721  is not a string!
+00004200: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00004210: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00004220: 2069 6e73 7065 6374 2e69 7363 6c61 7373   inspect.isclass
+00004230: 285f 665f 293a 0d0a 2020 2020 2020 2020  (_f_):..        
+00004240: 2020 2020 2020 2020 5f69 6e73 7461 6e63          _instanc
+00004250: 6520 3d20 5f66 5f28 2a69 6e73 5f61 7267  e = _f_(*ins_arg
+00004260: 732c 2a2a 696e 735f 6b77 6473 290d 0a20  s,**ins_kwds).. 
+00004270: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00004280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004290: 2020 5f69 6e73 7461 6e63 6520 3d20 5f66    _instance = _f
+000042a0: 5f0d 0a0d 0a0d 0a20 2020 2020 2020 2020  _......         
+000042b0: 2020 2066 6f72 2069 2069 6e20 6469 7228     for i in dir(
+000042c0: 5f69 6e73 7461 6e63 6529 3a0d 0a20 2020  _instance):..   
+000042d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000042e0: 692e 7374 6172 7473 7769 7468 2822 5f22  i.startswith("_"
+000042f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00004300: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00004310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004320: 2020 5f66 203d 2067 6574 6174 7472 285f    _f = getattr(_
+00004330: 696e 7374 616e 6365 2c69 290d 0a20 2020  instance,i)..   
+00004340: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004350: 696e 7370 6563 742e 6973 6d65 7468 6f64  inspect.ismethod
+00004360: 285f 6629 206f 7220 696e 7370 6563 742e  (_f) or inspect.
+00004370: 6973 6675 6e63 7469 6f6e 285f 6629 3a0d  isfunction(_f):.
+00004380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004390: 2020 2020 206d 6574 686f 645f 6e61 6d65       method_name
+000043a0: 203d 2066 277b 5f6e 5f7d 2e7b 697d 270d   = f'{_n_}.{i}'.
+000043b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000043c0: 2020 2020 206f 7074 735f 3a64 6963 7420       opts_:dict 
+000043d0: 3d20 6469 6374 286e 616d 653d 6d65 7468  = dict(name=meth
+000043e0: 6f64 5f6e 616d 652c 6d65 7468 6f64 5479  od_name,methodTy
+000043f0: 7065 3d5f 745f 2c63 616c 6c61 626c 653d  pe=_t_,callable=
+00004400: 5f66 290d 0a20 2020 2020 2020 2020 2020  _f)..           
+00004410: 2020 2020 2020 2020 206f 7074 735f 2e75           opts_.u
+00004420: 7064 6174 6528 6f70 7473 290d 0a20 2020  pdate(opts)..   
+00004430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004440: 2073 656c 662e 6372 6561 7452 4d65 7468   self.creatRMeth
+00004450: 6f64 282a 2a6f 7074 735f 290d 0a20 2020  od(**opts_)..   
 00004460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004470: 2020 6f70 7473 5f2e 7570 6461 7465 286f    opts_.update(o
-00004480: 7074 7329 0d0a 2020 2020 2020 2020 2020  pts)..          
-00004490: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-000044a0: 7265 6174 524d 6574 686f 6428 2a2a 6f70  reatRMethod(**op
-000044b0: 7473 5f29 0d0a 2020 2020 2020 2020 2020  ts_)..          
-000044c0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-000044d0: 2020 2020 7265 7475 726e 205f 665f           return _f_
+00004470: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
+00004480: 6e20 5f66 5f                             n _f_
```

## utran/runner.py

```diff
@@ -1,35 +1,57 @@
 import asyncio
 from typing import Union
 
 
 from utran.client.baseclient import BaseClient
 from utran.client.client import Client
-from utran.server.rpcServer import RpcServer
 from utran.server.server import Server
 from utran.server.webserver import WebServer
 
-from utran.utils import parse_utran_uri
 
-def run(app:Union[Server,RpcServer,WebServer,BaseClient,Client],host:str='127.0.0.1',port:int=8081,web_port:int=8080,uri:str=None):
+def run(app:Union[Server,WebServer,BaseClient,Client],
+        *,
+        host:str='127.0.0.1',
+        port:int=8080,
+        url:str=None,
+        entry:callable=None,
+        loop:asyncio.AbstractEventLoop=None,
+        username: str = None,
+        password: str = None):
     """# 通用的运行器
     Args:
         app: 需要运行的服务
         host: 主机
         port: RPC端口
         web_port: WEB端口
-        uri: 远程服务地址    
+        url: 远程服务地址    
+        loop: 指定事件循环
     """
-    if isinstance(app,Server):asyncio.run(app.start(host=host,
-                                                    web_port=web_port,
-                                                    rpc_port=port))
-        
-    if isinstance(app,RpcServer):asyncio.run(app.start(host=host,
-                                                       port=port))
+
+    if isinstance(app,Server):        
+        coro= app.start(host=host,
+                port=port,
+                username=username,
+                password=password)
+        if loop:
+            loop.run_until_complete(coro)
+        else:
+            asyncio.run(coro)
         
-    if isinstance(app,WebServer):asyncio.run(app.start(host=host,
-                                                       port=web_port))
+
+    if isinstance(app,WebServer):
+        coro= app.start(host=host,
+                port=port,
+                username=username,
+                password=password)
+        if loop:
+            loop.run_until_complete(coro)
+        else:
+            asyncio.run(coro)
     
-    if uri: 
-        host,port = parse_utran_uri(uri)
-    if isinstance(app,BaseClient) or isinstance(app,Client):
-        asyncio.run(app.start(host=host,port=port))
+
+    if isinstance(app,Client):
+        if callable(entry):
+            app(entry,url=url,username=username,password=password,loop=loop)
+        else:
+            raise RuntimeError('Run Error,未指定有效的entry')
+
```

## utran/utils.py

```diff
@@ -1,141 +1,109 @@
 
 import asyncio
 import inspect
 import re
 import ujson
-from typing import Union
+from typing import Callable, Coroutine, Union
 
 
-def unpack_data2_utran(data:bytes, buffer:bytes=b'',maxsize:int=102400)->tuple[Union[bytes,None],Union[bytes,None],bytes]:
+def unpack_data2_utran(buffer:bytes=b'')->tuple[str,dict,int,bytes]:
     """
     根据utran协议从接收到的字节流中解析出完整的消息
     Args:
-        data: 接收到的字节流
-        buffer: 缓冲区中未处理完的数据
-        maxsize: 支持数据的最大长度
+        buffer: 字节数据
 
     Returns: 
-        如果解析成功完整消息，则返回请求类型的名称，消息和剩余字节流；否则返回None和原始字节流
+        msgType (str):消息类型
+        header (dict):头部
+        residual_datasize (int):未读取字节数
+        msg:剩余字节
 
     Utran协议:
         ```
-        rpc/subscribe/unsubscribe/publish
+        rpc/subscribe/unsubscribe/publish/multicall
         length:xx
         encrypt:0/1
         message_json
         ```
     """
-    buffer += data
-    
-    if len(buffer) < 4:
-        return None, None, buffer
-    
-    # 解析名称
-    name_end = buffer.find(b'\n')
-    if name_end == -1:
-        return None, None, buffer
-    
-    
-    # 解析length
-    length_start = name_end + 1
-    length_end = buffer.find(b'\n', length_start)
-    
-    if length_end == -1:
-        return None, None, buffer      
+    if b'length' not in buffer or b'id' not in buffer:
+        raise ValueError('The utran protocol is invalid')
 
-    length_str = buffer[length_start:length_end]
-    
-    if not length_str.startswith(b'length:'):
-        raise Exception('Error: Invalid message format. Missing "length" keyword in second line.')
-    
     try:
-        message_length = int(length_str.split(b':')[1])
+        head,msg = buffer.split(b'\r\n')
+        head = head.split(b'\n')[:-1]
+        msgType,header = (head[0],head[1:])
     except:
-        raise Exception('Error: Value error. "length" value error in second line.')
-    
-    if message_length > maxsize:
-        raise Exception('Message too long')
-    
-    
-    # 解析是否加密
-    encrypt_start = length_end + 1
-    encrypt_end = buffer.find(b'\n', encrypt_start)
+        raise ValueError('The utran protocol is invalid')
     
-    if encrypt_end == -1:
-        return None, None, buffer
+    if msgType not in [b'rpc',b'subscribe',b'unsubscribe',b'publish',b'multicall']:
+        raise ValueError('The utran protocol is invalid')
     
-    encrypt_str = buffer[encrypt_start:encrypt_end]
-    
-    if not encrypt_str.startswith(b'encrypt:'):
-        raise Exception('Error: Invalid message format. Missing "encrypt" keyword in third line.')
-
     try:
-        encrypt = int(encrypt_str.split(b':')[1])
+        msgType = msgType.decode('utf-8')
+        header = dict([i.decode('utf-8').split(':') for i in header])
+        header['encrypt'] = bool(int(header.get('encrypt')))
+        header['length'] = int(header.get('length'))
+        header['id'] = int(header.get('id'))        
     except:
-        raise Exception('Error: Value error. "encrypt" value error in third line.')
-
-
-    # 解析数据内容
-    data_start = encrypt_end + 1
-    data_end = data_start + message_length
-    
-    if len(buffer) < data_end:
-        return None, None, buffer
+        raise ValueError('The utran protocol is invalid')
     
-    name = buffer[:name_end]
-    message_data = buffer[data_start:data_end]        
-    remaining_data = buffer[data_end:]
+    residual_datasize = header['length'] - len(msg)
+       
+    return msgType,header,residual_datasize,msg
     
-    if encrypt:
-        # 加密算法还未实现
-        pass
 
-    return name, message_data, remaining_data
-    
 
-def pack_data2_utran(name:str,message:dict,encrypt:bool=False)->bytes:
+def pack_data2_utran(id:int,name:str,message:Union[dict,bytes],encrypt:bool=False)->bytes:
     """
     根据utran协议将要发送的消息打包成二进制格式
 
     Utran协议:
         ```
         rpc/subscribe/unsubscribe/publish
         length:xx
         encrypt:0/1
+        id:1
+        
         message_json
         ```
 
     Args:
+        id: 整数类型的值
         name: 请求类型的名称
-        message: 要发送的消息（dict类型）
+        message: 要发送的消息（dict类型） 或者 bytes
         encrypt: 是否加密数据
 
     Returns:
         打包后的二进制数据
     """
-    message_json = ujson.dumps(message).encode('utf-8')
-    
+    if type(message) == dict:
+        message_json = ujson.dumps(message).encode('utf-8')
+    elif type(message) != bytes:
+        raise ValueError('Packaging error,The message must be a dict or bytes ')
+
     if encrypt:
         # 加密算法还未实现
         pass
             
     message_length = len(message_json)
     
     # 打包数据
     data = b''
     data += name.encode('utf-8') + b'\n'
     data += f'length:{message_length}\n'.encode('utf-8')
     data += f'encrypt:{int(encrypt)}\n'.encode('utf-8')
+    data += f'id:{id}\n'.encode('utf-8')
+    data += b'\r\n'
     data += message_json
     
     return data
 
 
-
 def parse_utran_uri(uri:str)->tuple[str, int]:
     """#解析uri
     Returns:
         返回host和port
     """
     result = re.search(r"//([^:/]+):(\d+)", uri)
     if result:
@@ -212,8 +180,19 @@
         raise TypeError(f'{fun.__name__}() got an unexpected keyword argument "{keys}".')
 
     res = res_+_res
     if len(params)!=len(res):
         # 参数数量不正确
         raise TypeError(f'{fun.__name__}() The number of parameters is incorrect.')
 
-    return res_+_res
+    return res_+_res
+
+
+def asyncfn_runner(fn:Union[Callable,Coroutine],*args,**kwds):
+    """子进程或线程中的异步执行器"""
+    if asyncio.iscoroutinefunction(fn):
+        return asyncio.run(fn(*args,**kwds))
+    elif asyncio.iscoroutine(fn):
+        return asyncio.run(fn)
+    
+
+
```

## utran/client/baseclient.py

```diff
@@ -1,317 +1,168 @@
-
+from typing import Any,Union
+import aiohttp
 import asyncio
-from asyncio import Future
-from functools import partial
-import inspect
-import time
 
-from typing import Any, Union,Callable,Coroutine
-import ujson
+from utran.object import UtType, gen_requestId
 from utran.log import logger
-from utran.client.que import ResultQueue
-from utran.object import UtRequest, UtResponse, UtState, UtType, create_UtRequest,HeartBeat
-from utran.utils import parse_utran_uri, unpack_data2_utran
 
 
-class HeartBeatTimer:
-    """# 心跳类
-    
+
+class BaseClient:
+    """
     Args:
-        ping_sender: 向服务器发ping的执行函数，可以是同步或异步函数
-        timeout_callback: 服务器响应超时的回调函数，可以是同步或异步函数
-        ping_freq: 发ping的频率(单位：秒)
-        pong_timeout: 服务器超时设置，服务器超过设定值没有回应时执行timeout_callback
+        url: 服务器地址
+        maxReconnectNum: 断线后最大重连次数
+        ignore: 全局设置，是否忽略远程执行结果的错误，忽略错误则值用None填充
+        compress: 是否压缩数据
+        max_msg_size: 表示接收消息的最大大小（以字节为单位）。如果接收到的消息大小超过该值，则会引发异常。
+        username: 用户名
+        password: 密码
     """
-    __slots__=('_ping_freq','_pong_timeout','_pingTask','_timeoutTask','_ping_sender','_timeout_callback','_loop','_lastsendTime')
-
+    __slots__ = ('_url','_session','_ws','_rpc_requests','_isclosed','_maxReconnectNum','_reconnect_attempts','_topics_handler','_ignore',
+                 '_exitEvent','_compress','_max_msg_size','_receive_task','__auth')
     def __init__(self,
-                 ping_sender:Callable,
-                 timeout_callback:Callable,
-                 ping_freq:int=2,
-                 pong_timeout:int=2,
-                 ) -> None:
-        self._loop = asyncio.get_event_loop()
-        self._ping_freq = ping_freq
-        self._pong_timeout = pong_timeout
-        self._pingTask:asyncio.TimerHandle = None
-        self._timeoutTask:asyncio.TimerHandle = None
-        self._ping_sender =ping_sender
-        self._timeout_callback = timeout_callback
-
-        self._lastsendTime:float = self._loop.time()
-        self.alive()
-
-        
-    def alive(self):
-        """# 服务器确认存活
-
-        步骤:
-            > 1.撤销超时任务
-            > 2.撤销上次的执行的发ping操作
-            > 2.创建新的延迟发ping操作
-        """
-
-        if self._timeoutTask:
-            self._timeoutTask.cancel()
-
-        if self._pingTask:
-            self._pingTask.cancel()
-
-        self._pingTask = self._loop.call_later(self._ping_freq,self.__ping)
-
-    
-    def stop(self):
-        """停止"""
-        if self._timeoutTask:
-            self._timeoutTask.cancel()
-
-        if self._pingTask:
-            self._pingTask.cancel()
-
-
-    def getResponseDelay(self)->float:
-        """# 获取响应延迟时间，
-        需要在收到服务器Pong响应时调用
-
-        Returns:
-            返回毫秒数，保留小数点后三位        
-        """
-        t = (time.time() - self._lastsendTime)*1000
-        return round(t,3)
+                 url:str='ws://localhost:8080',
+                 maxReconnectNum:int=10,
+                 ignore:bool=True,
+                 compress: int = 0,
+                 max_msg_size: int = 4 * 1024 * 1024,
+                 username:str=None,
+                 password:str=None) -> None:
+        self._url = url
+        self._session:aiohttp.ClientSession = None
+        self._ws:aiohttp.ClientWebSocketResponse = None
+        self._rpc_requests = dict()
+        self._isclosed:int = -1       # -1表示还未初始化，0表示已连接，1表示断开连接
+        self._maxReconnectNum = maxReconnectNum
+        self._reconnect_attempts = 0
+        self._topics_handler = dict()
+        self._ignore = ignore
+        self._exitEvent = asyncio.Event()                               # 用于等待退出
+        self._compress = compress
+        self._max_msg_size = max_msg_size
+        self._receive_task = None
 
-    def __timeout(self):
-        if inspect.iscoroutinefunction(self._timeout_callback):
-            asyncio.create_task(self._timeout_callback())
-        else:
-            self._timeout_callback()
 
-    def __ping(self):
-        if inspect.iscoroutinefunction(self._ping_sender):
-            asyncio.create_task(self._ping_sender())
+        if username!=None or password!=None:
+            assert username!=None,'username is None.'
+            assert password!=None,'password is None.'
+            self.__auth:aiohttp.BasicAuth = aiohttp.BasicAuth(username,password)
         else:
-            self._ping_sender()
-        self._lastsendTime:float = time.time()
-        self._timeoutTask = self._loop.call_later(self._pong_timeout, self.__timeout)
+            self.__auth:aiohttp.BasicAuth = aiohttp.BasicAuth('utranhost','utranhost')
+        
 
+    async def start(self,url:str=None,username:str=None,password:str=None):
+        self._url = url or self._url
+        self._session = aiohttp.ClientSession() if self._session==None or self._session.closed else self._session
+        
+        if username!=None or password!=None:
+            assert username!=None,'username is None.'
+            assert password!=None,'password is None.'
+            self.__auth:aiohttp.BasicAuth = aiohttp.BasicAuth(username,password)
 
 
-class BaseClient:
-    """# 基础客户端
-    Args:
-        heartbeatFreq: 心跳频率
-        serverTimeout: 服务器心跳响应超时时间，用于判断是否断线，超过此值会进行重连 (单位:秒)
-        localTimeout: 本地调用超时 (单位:秒)
-        reconnectNum: 断线重连的次数
-        ignore: 是否忽略远程调用异常
-        encrypt: 是否加密传输
-        reslutqueue: 结果队列类
-    """
-    __slots__=('_reader',
-               '_writer',
-               '_reslutqueue',
-               '_encrypt',
-               '_buffer',
-               '_lock',
-               '_topics_handler',
-               '_exitEvent',
-               '_heartbeatFreq',
-               '_serverTimeout',
-               '_localTimeout',
-               '_heartbeatTimer',
-               '_receive_task',
-               '_reconnectTask',
-               '_reconnectNum',
-               '_serveHost',
-               '_servePort',
-               '_reconnectingEvent',
-               '_lastReconectTime',
-               '_main_task',
-               '_main',
-               '_ignore',
-               '_isRuning',
-               '_curSendTask')
-    
-    def __init__(self,
-                 *,
-                 host:str=None,
-                 port:int=None,
-                 heartbeatFreq:int=2,
-                 serverTimeout:int=2,
-                 localTimeout:int=10,
-                 reconnectNum:int=32,
-                 ignore:bool = False,
-                 encrypt: bool = False,
-                 reslutqueue:ResultQueue=None) -> None:
-        self._reader = None
-        self._writer = None
-        self._reslutqueue:ResultQueue = reslutqueue or ResultQueue()
-        self._encrypt:bool = encrypt                                    # 是否加密
-        self._buffer = b''                                              # buffer
-        self._lock = asyncio.Lock()                                     # 异步协程锁
-        self._topics_handler = dict()                                   # 存放话题和回调函数
-        self._exitEvent = asyncio.Event()                               # 用于等待退出
-        self._heartbeatFreq:int = heartbeatFreq                         # 心跳频率（单位：秒）
-        self._serverTimeout:int = serverTimeout                         # 服务器响应超时时间 （单位：秒）
-        self._localTimeout:int = localTimeout                           # 本地调用超时
-        self._heartbeatTimer:HeartBeatTimer = None                      # 心跳类
-        self._receive_task:asyncio.Task = None                          # 接收服务器消息的任务
-        self._reconnectTask:asyncio.Task = None                         # 断线重连任务
-        self._reconnectNum:int = reconnectNum                           # 断线重连的次数
-        self._serveHost:str = host                                      # 服务器host 
-        self._servePort:int = port                                      # 服务器端口号
-        self._reconnectingEvent:asyncio.Event = asyncio.Event()         # 用于等待重连
-        self._reconnectingEvent.set()               # 默认关闭等待
-        self._lastReconectTime:float = None                             # 最后一次重连时间
-        self._main_task:asyncio.Task = None
-        self._main:Union[Future,Coroutine,Callable] = None
-        self._ignore = ignore                                           # 是否忽略远程调用异常
-        self._isRuning = False                                          # 是否运行中
-        self._curSendTask:asyncio.Task = None
+        await self.connect()
+        self._reconnect_attempts = 0
 
-    async def start(self,main:Union[Future,Coroutine,Callable]=None,uri:str=None,host:str=None,port:int=None,runforever:bool=False):
-        """# 启动连接
-        存在订阅的话题时，程序会一直等待话题的推送，无订阅话题时程序在执行完入口函数`main`后自动退出
-        Args:            
-            main:入口函数，这是一个可等待对象，它可以是协程函数、协程对象或Future对象,
-            uri: 服务器地址 例：`utran://127.0.0.1:8081`
-            host: 不使用uri时可以直接指定服务器的host和port
-            port: 不使用uri时可以直接指定服务器的host和port
-            runforever: 是否一直运行,默认入口函数执行完毕且无任何订阅时会自动退出
-        """
-        self._main = main or self._main
-        self._serveHost = host or self._serveHost
-        self._servePort = port or self._servePort
-        if uri:
-            self._serveHost,self._servePort = parse_utran_uri(uri)
         
-        assert self._serveHost and self._servePort,ValueError('Specify the correct host and port.')
-
-        self._reader, self._writer = await asyncio.open_connection(self._serveHost, self._servePort)
-        logger.debug(f"启动连接，{self._serveHost}:{self._servePort}")
+        if self._topics_handler:
+            items = self._topics_handler.items()
+            topics = [k for k,v in items]
+            callbacks = [v for k,v in items]
+            await self.subscribe(topics,callbacks,ignore=True)
+            logger.success(f"已重新订阅话题: {topics}.")
+            self._exitEvent.clear()
+
+        for v in self._rpc_requests.values():
+            futrue:asyncio.Future = v[0]
+            futrue.set_exception(Exception('disconnection'))
+
+        return self
+
+
+    async def connect(self):
+        self._ws = await self._session.ws_connect(self._url,compress=self._compress,max_msg_size=self._max_msg_size,auth=self.__auth)        
+        msg = await self._ws.receive()
+        if msg.data != 'ok':
+            await self.exit()
+            raise ConnectionError(msg.data)
+            
+        logger.success(f"连接成功.")
         self._receive_task = asyncio.create_task(self.__receive())  
-        self._heartbeatTimer = self._heartbeatTimer or HeartBeatTimer(self._ping,self._ping_timeout,self._heartbeatFreq,self._serverTimeout)
-        self._exitEvent.clear()
+        self._isclosed = 0
 
-        self._isRuning = True
-
-        result = None
-        try:
-            if self._main:
-                if asyncio.iscoroutine(self._main) or asyncio.isfuture(self._main):
-                    # 同步单次调用模式
-                    self._main_task = asyncio.create_task(main)
-                    result = await self._main_task
-                elif asyncio.iscoroutinefunction(self._main):
-                    # 异步服务模式
-                    self._main_task = asyncio.create_task(self._main())
-                    result = await self._main_task
-                else:
-                    raise ValueError(f'The "{type(self._main)}" cannot be an entry object ,must be coroutinefunction,Coroutine or Future')        
-                logger.debug('主函数执行完毕.')
 
-            if runforever:
-                # __enter__进入
-                await self._exitEvent.wait()
-            else:
-                if self._topics_handler:
-                    logger.debug('持续等待订阅推送..')
-                    self._heartbeatTimer.alive()
-                    await self._exitEvent.wait()
-                else:
-                    logger.debug('无订阅,程序即将退出')
+    async def _reconnecting(self):
+        """断线重连"""
+        if self._isclosed==0:
+            logger.error(f"断线重连..")
+            for i in range(self._maxReconnectNum):
+                try:
+                    logger.error(f'Reconnecting... (attempt {i+1}/{self._maxReconnectNum})')
+                    await asyncio.sleep(0.5 * (min(i, 10)))
+                    await self.start()
+                    return
+                except Exception as e:
+                    logger.error(f'WebSocket connection error: {e}')                    
+                    continue
 
-        finally:
             await self.exit()
-            return result
-    
+            for v in self._rpc_requests.values():
+                futrue:asyncio.Future = v[0]
+                futrue.set_exception(ConnectionResetError('Max reconnect attempts reached. Aborting.'))
 
-    def hasSubscribe(self,returnTopics:bool=True)->Union[tuple,bool]:
-        """# 是否有订阅话题
-        Args:
-            returnTopics: 是否返回已订阅的话题
-        
-        Returns:
-            当returnTopics为True时返回值为tuple，否则返回 bool值            
-        """
-        if returnTopics:
-            return tuple(self._topics_handler.keys())
-        if self._topics_handler:
-            return True
         else:
-            return False
-
-
-    def __call__(self, *args: any, **opts: any) -> callable:
-        """# 指定入口函数，可以使用装饰器方式指定入口函数
-        opts 选项参数暂时未设置功能，待开发..
-        """
-        if len(args)==0:
-            return partial(self.__call__,**opts)
-        if inspect.iscoroutinefunction(args[0]):
-            self._main = args[0]
-            return args[0]
-        raise ValueError('Must be a coroutine function!')
-    
-
-    async def _ping(self):
-        """向服务器发送ping"""
-        try:
-            await self._send(None,heartbeat=True)
-        except ConnectionResetError as e:
-            logger.error('发送PING时服务器错误，'+str(e))
+            await self.exit()
 
 
-    async def _ping_timeout(self):
-        """服务器响应超时，该方法会被执行"""
-        logger.error("服务器响应超时，启动断线重连..")
-        self._reconnectTask = asyncio.create_task(self._reconnecting())
+    async def __receive(self):
+        # print('接收开启')
+        while True:
+            msg = await self._ws.receive()
+            if msg.type == aiohttp.WSMsgType.TEXT:
+                response:dict = msg.json()
+                if response['responseType'] == UtType.PUBLISH.value:
+                    asyncio.create_task(self._handler_publish(**response.get('result')))
+                elif response['responseType'] in [UtType.RPC.value,UtType.SUBSCRIBE.value,UtType.UNSUBSCRIBE.value]:
+                    request_id = response['id']
+                    future,request = self._rpc_requests.pop(request_id)
+                    future.set_result(response)
 
+            elif msg.type == aiohttp.WSMsgType.CLOSED:
+                break
+        
+        if self._isclosed==0:
+            asyncio.create_task(self._reconnecting())
+        # print('接收关闭')
 
-    async def _reconnecting(self):
-        """断线重连"""
-        n = self._reconnectNum
-        logger.error(f"开始尝试重连,将在{self._reconnectNum}次后停止...")
-        self._reconnectingEvent.clear()
-        while n>0:
-            if n<=12:logger.error(f"剩余{n}次重连..")
-            await self._close()
-            try:                
-                self._reader, self._writer = await asyncio.open_connection(self._serveHost, self._servePort)
-                logger.success(f"重连成功")
-                self._lastReconectTime = time.time()
-                if self._curSendTask and not self._curSendTask.done():
-                    self._curSendTask.cancel()
-                    self._curSendTask = None
-
-                self._reconnectingEvent.set()
-                self._receive_task = asyncio.create_task(self.__receive())
-
-                await asyncio.sleep(0.3)
-                self._heartbeatTimer.alive()
-                if self._topics_handler:
-                    topics = list(self._topics_handler.keys())
-                    request:UtRequest = create_UtRequest(dict(requestType=UtType.SUBSCRIBE.value,topics=topics))               
-                    await self._send(request,timeout=10,ignore=True)
-                    logger.success(f"已重新订阅话题: {topics}.")
-                    
 
-                # await self._ping()
-                return True
+    async def _send(self,request:dict,timeout:int=None)->dict:
+        try:
+            await self._ws.send_json(request)
+        except Exception as e:
+            # logger.error(e)
+            pass
+        futrue = asyncio.Future()
+        self._rpc_requests[request['id']] = (futrue,request)
+        response = await asyncio.wait_for(futrue,timeout)
+        return response
+    
 
-            except Exception as e:
-                logger.error(f"重连失败:{e}")
-                await asyncio.sleep(1)
-            n-=1
-
-        self._receive_task.cancel()    
-        self._main_task.cancel()
-        logger.error("服务器无响应重连结束，程序退出！")      
-        await self.exit()
 
+    async def _handler_publish(self,topic:str,msg:any):
+        """处理话题推流"""
+        callback =  self._topics_handler.get(topic)
+        if not callable:            
+            # print(f"推送【{topic}】话题:",msg)
+            return
+        if asyncio.iscoroutinefunction(callback):
+            await callback(msg,topic)                
+        else:
+            callback(msg,topic)
 
 
     async def subscribe(self,
                         topic:Union[str,tuple[str]],
                         callback:callable,
                         *,
                         timeout:int=None,
@@ -327,223 +178,227 @@
         Returns:
             {'allTopics': ['topic1','topic2'], 'subTopics': ['topic2']}
         
         |allTopics|subTopics|
         |---------|-----------|
         |所有已订阅的话题 `list`|本次订阅的话题 `list`|
         """
+        if type(topic) not in (tuple,list):
+            topic = [topic]
 
-        if type(topic) in [list,tuple]:
-            for t in topic:
-                if type(t)==str: self._topics_handler[t] = callback
-                else: raise ValueError(f'"{t}" must be a string!')
-        elif type(topic)==str:
-            self._topics_handler[topic] = callback
-        else:
-            raise ValueError(f'"{topic}" must be a str or List[str] !')
+        if type(callback) not in (tuple,list):
+            callback = [callback]
 
-        msg = dict(requestType=UtType.SUBSCRIBE.value,topics=topic)
-        request:UtRequest = create_UtRequest(msg)
+        if len(topic) != len(callback):
+            raise ValueError('The topic must correspond to the callback one by one')
+
+        for t,c in zip(topic,callback):
+            if type(t)!=str:                 
+                raise ValueError(f'Subscribe Error "{type(t)}" is not a string!')
+            if not callable(c):
+                raise ValueError(f'Subscribe Error "{type(c)}" is not callable!')
+            
+            self._topics_handler[t] = c
 
-        return await self._send(request,timeout=timeout,ignore=ignore)
+        request = dict(id=gen_requestId(),requestType=UtType.SUBSCRIBE.value,topics=topic)
+        try:
+            response:dict = await self._send(request,timeout=timeout)
+        except Exception as e:
+            if str(e)=='disconnection':
+                return await self.subscribe(topic,callback,timeout=timeout,ignore=ignore)
+            else:
+                raise e
         
+        ignore = self._ignore if ignore== None else ignore
+        if response.get('state') or ignore:
+            self._exitEvent.clear()
+            result:dict = response.get('result')    
+            logger.success(f'成功订阅:{result.get("subTopics")}')
+            return result
+        else:
+            raise RuntimeError(f"Response '{response.get('responseType')}' Error，"+response.get('error'))
+
 
     async def unsubscribe(self,
                           *topic:str,
                           timeout:int=None,
                           ignore:bool=None)->dict:
         """# 取消订阅话题
         存在订阅的话题时，程序会一直等待话题的推送，无订阅话题时程序在执行完入口函数`main`后自动退出
         Args:
             topic: 话题
             timeout: 本地等待响应超时，抛出TimeoutError错误（单位：秒）
-            ignore: 是否忽略远程执行结果的错误，忽略错误则值用None填充
 
         Returns:
             {'allTopics': ['topic1'], 'unSubTopics': ['topic2']}   
 
         |allTopics|unSubTopics|
         |---------|-----------|
         |所有已订阅的话题 `list`|本次取消订阅的话题 `list`|
         """
         if topic:
             [self._topics_handler.pop(t) for t in topic if t in self._topics_handler]              
 
-        msg = dict(requestType=UtType.UNSUBSCRIBE.value,topics=topic)
-        request:UtRequest = create_UtRequest(msg)
-        res = await self._send(request,timeout=timeout,ignore=ignore)
-        if not self._topics_handler:
-            logger.debug('已无任何订阅,程序即将退出..')
-            self._exitEvent.set()
+        request = dict(id=gen_requestId(),requestType=UtType.UNSUBSCRIBE.value,topics=topic)
 
-        return res
-        
+        try:
+            response:dict = await self._send(request,timeout=timeout)        
+        except Exception as e:
+            if str(e)=='disconnection':
+                return await self.unsubscribe(*topic,timeout=timeout,ignore=ignore)
+            else:
+                raise e
+            
+        ignore = self._ignore if ignore== None else ignore
+        if response.get('state') or ignore:
+            result:dict = response.get('result')
+            if result!=None:logger.success(f'取消订阅:{result.get("unSubTopics")}')
+            if not self._topics_handler:
+                logger.debug('已无任何订阅')               
+            return result
+        else:
+            raise RuntimeError(f"Response '{response.get('responseType')}' Error，"+response.get('error'))
+
+    
 
     async def call(self,
                    methodName:str,
                    args:list=tuple(),
                    dicts:dict=dict(),
                    *,
                    timeout:int=None,
                    multicall:bool=False,
-                   encrypt:bool=None,
                    ignore:bool=None)->Union[Any,dict]:
         """# 调用远程方法或函数
         Args:
             methodName: 远程的方法或函数的名称
             args: 列表参数
             dicts: 字典参数
             timeout: 本地等待响应超时，抛出TimeoutError错误（单位：秒）
             multicall: 是否标记为合并调用
-            encrypt: 是否加密
             ignore: 是否忽略远程执行结果的错误，忽略错误则值用None填充
         """
-        msg = dict(requestType=UtType.RPC.value,methodName=methodName,args=args,dicts=dicts)
+        request = dict(id=gen_requestId(),requestType=UtType.RPC.value,methodName=methodName,args=args,dicts=dicts)
         if multicall:
-            return msg
+            return request,timeout
         else:
-            encrypt = self._encrypt if encrypt==None else encrypt
-            request:UtRequest = create_UtRequest(msg,encrypt=encrypt)
-            return await self._send(request,timeout=timeout,ignore=ignore)
-        
+            try:
+                response:dict = await self._send(request,timeout=timeout)
+            except Exception as e:
+                if str(e)=='disconnection':
+                    return await self.call(methodName,args,dicts,timeout=timeout,ignore=ignore)
+                else:
+                    raise e
+                
+            ignore = self._ignore if ignore== None else ignore
+            if response.get('state') or ignore:
+                return response.get('result')
+            else:
+                raise RuntimeError(f"Response '{response.get('responseType')}' Error，"+response.get('error'))
+
+
 
-    async def multicall(self,*calls:Coroutine,encrypt:bool = False,timeout:int=None,ignore:bool=None)->list:
+    async def multicall(self,*calls,ignore:bool=None,retransmitFull:bool=False)->list:
         """# 合并多次调用远程方法或函数
         Args:
             *calls: 需要远程调用协程对象
-            encrypt: 是否加密
-            timeout: 本地等待响应超时，抛出TimeoutError错误（单位：秒）
             ignore: 是否忽略远程执行结果的错误，忽略错误则值用None填充
-        
+            retransmitFull: 于服务器失联后，默认只重发未收到响应的请求，如果为True则重发全部请求
+
         Returns:
             执行结果按顺序放在列表中返回
         """
-        msgs = await asyncio.gather(*calls)
-        encrypt = self._encrypt if encrypt==None else encrypt
-        request:UtRequest = create_UtRequest(dict(requestType=UtType.MULTICALL,multiple=msgs),encrypt=encrypt)
-        res = await self._send(request,timeout=timeout)
-
         ignore = self._ignore if ignore== None else ignore
-        if ignore:
-            return [r.get('result') for r in res]
+        success = []
+        faild_calls = []
+        faild_indexs = []
+        if asyncio.iscoroutine(calls[0]):            
+            requests = [await c for c in calls]
         else:
-            result = []
-            for r in res:
-                if r.get('state')==UtState.SUCCESS.value:
-                    result.append(r.get('result'))
-                else:
-                    raise RuntimeError(r.get('error'))
-            return result
-            
+            requests = calls
+        
 
+        res = await asyncio.gather(*[self._send(request,timeout=timeout) for request,timeout in requests],return_exceptions=True)
+        for i in range(len(res)):
+            response:dict = res[i]
+            if isinstance(response, Exception):
+                # 处理连接错误
+                if str(response)=='disconnection':
+                    if retransmitFull:
+                        faild_calls = requests
+                        success = []
+                        break
+                    else:
+                        faild_calls.append(requests[i])
+                        faild_indexs.append(i)
+                else:
+                    raise response
+            else:
+                # 处理成功响应
+                if response.get('state') or ignore:
+                    success.append(response.get('result'))
+                else:
+                    raise RuntimeError(f"Response '{response.get('responseType')}' Error，"+response.get('error'))
+        
+        if faild_calls:
+            res = await self.multicall(*faild_calls,ignore=ignore,retransmitFull=retransmitFull)
+            if retransmitFull:
+                return res
+            else:
+                [success.insert(faild_indexs[i],res[i]) for i in range(len(faild_calls))]
+        return success
+  
+
+    async def exit(self):        
+        self._isclosed = 1
+        await self._ws.close()
+        await self._session.close()
+        self._exitEvent.set()
+        self._exitEvent = asyncio.Event()  # 便于下次使用
 
-    async def _send(self,request:UtRequest,*,timeout:int=None,ignore:bool=None,heartbeat:bool=False):
-        timeout = self._localTimeout if timeout==None else timeout
-        ignore = self._ignore if ignore== None else ignore            
-        # if heartbeat :print("执行发送心跳任务")
-        # else: print("执行发送请求任务",request.id)
-        try:
-            async with self._lock:     # 每次只允许一个协程调用call方法
-                if heartbeat:
-                    self._writer.write(HeartBeat.PING.value)
-                    await self._writer.drain()
-                    # print("PING")
-                    return
+    async def __aenter__(self):
+        await self.start()        
+        return self
 
-                self._writer.write(request.pick_utran_request())
-                await self._writer.drain()
 
-                self._curSendTask = asyncio.ensure_future(self._reslutqueue.wait_response(request,timeout=timeout))
-                try:
-                    response:UtResponse = await self._curSendTask
-                except asyncio.exceptions.CancelledError:
-                    raise asyncio.exceptions.TimeoutError('服务器断线，尝试重新执行请求')
-                
-                if response.state == UtState.FAILED:
-                    if ignore:return response.result
-                    else:
-                        raise asyncio.exceptions.TimeoutError(response.error)
-                else:
-                    return response.result
-                
-        except asyncio.exceptions.TimeoutError as e:
-            await self._reconnectingEvent.wait()
-            if self._lastReconectTime is not None:
-                # 刚断线重连成功
-                async with self._lock:
-                    self._reslutqueue.pop_cache_request(request.id)
-                    if not self._reslutqueue.has_request_cache():   # 如果没有其他被中断的请求，清除本次断线记录
-                        self._lastReconectTime = None
-                logger.success(f"接续被中断的请求: ID:{request.id}, {request.requestType.value}.")
-                return await self._send(request=request,timeout=timeout,ignore=ignore)
+    async def __aexit__(self, exc_type=None, exc_val=None, exc_tb=None):
+        try:
+            if exc_type:
+                # print(exc_tb)
+                raise exc_type(exc_val)
+            
+            topics = list(self._topics_handler.keys())
+            if topics:
+                logger.info(f'继续等待订阅推送:{topics}')
+                self._exitEvent.clear()
+                await self._exitEvent.wait()
+                logger.success(f'退出程序')
             else:
-                # 本地等待超时，非断线原因
-                logger.warning(f'Local call timeout ({timeout}s):{request.to_dict()}')
                 await self.exit()
-                raise e
-                
+        except:
+            if self._isclosed==0:
+                await self.exit()
 
-    async def __receive(self):
-        # print("启动接收任务")
-        while True:
-            chunk = await self._reader.read(1024)
-            if not chunk:
-                raise ConnectionError('Connection closed by server')
-            
-            self._heartbeatTimer.alive()
-            # 心跳检测                      
-            if chunk == HeartBeat.PONG.value:
-                # print(f"-PONG: {self._heartbeatTimer.getResponseDelay()}ms")
-                continue
 
-            name,message,self._buffer = unpack_data2_utran(chunk, self._buffer)
-            if message is not None:
-                try:
-                    # name:str = name.decode('utf-8')
-                    response:UtResponse = UtResponse(**ujson.loads(message.decode('utf-8').strip()))
-                except Exception as e:
-                    logger.warning(f'服务器消息异常: {e}')
-                    continue
 
-                if response.responseType == UtType.PUBLISH:
-                    asyncio.create_task(self._handler_publish(**response.result))
-                else:
-                    self._reslutqueue.cache_response(response)
-   
 
-    async def _handler_publish(self,topic:str,msg:any):
-        """处理话题推流"""
-        callback =  self._topics_handler.get(topic)
-        if not callable:            
-            # print(f"推送【{topic}】话题:",msg)
-            return
-        if inspect.iscoroutinefunction(callback):
-            await callback(msg,topic)                
-        else:
-            callback(msg,topic)
+if __name__ == '__main__':
+    async def main():
+        client = BaseClient(maxReconnectNum=3)
+        await client.start()
+        await client._ws.ping(b'ping')
+        res = await client.call({'id':1,"requestType":"rpc","methodName":"add0","args":[],"dicts":{"a":1,"b":2}})
+        print("ok:",res)
+        res= await client.multicall(*[client.call({'id':i,"requestType":"rpc","methodName":"add","args":[],"dicts":{"a":1,"b":i}},multicall=True) for i in range(2,50002)],retransmitFull=False)    
+        x = res[0]-1
+        for i in res:
+            if i == x+1:
+                x += 1
+            else:
+                raise Exception("错误")
+            
+        print("ok:",res)
+        print('总：',len(client._rpc_requests.keys()))
+        # await client.exit()
 
 
-    async def _close(self):
-        """# 关闭连接"""
-        self._receive_task.cancel()
-        self._heartbeatTimer.stop()
-
-        if self._writer is not None:
-            try:            
-                self._writer.write(b'')
-                await self._writer.drain()
-            except ConnectionResetError as e:
-                pass
-            self._writer.close()
-
-        self._reader = None
-        self._writer = None
-
-
-    async def exit(self):
-        """# 退出程序
-        调用退出时，并不会立即退出，需要等run方法中指定的`main`入口函数执行完毕才会退出。
-        """
-        self._isRuning = False
-        self._topics_handler = None        
-        await self._close()
-        self._exitEvent.set()
+    asyncio.run(main())
```

## utran/client/client.py

```diff
@@ -1,16 +1,15 @@
 import asyncio
-from asyncio import Future
 from functools import partial
 import threading
 import time
-from typing import Callable, Coroutine, Union
+from typing import Coroutine, Union
 from utran.client.baseclient import BaseClient
-from utran.utils import parse_utran_uri
 import inspect
+from utran.log import logger
 
 class ExeProxy:
     """远程执行代理"""
     __slots__ = ('_accessProxy_',)
     def __init__(self,accessProxy:'AccessProxy'):
         self._accessProxy_ = accessProxy
 
@@ -23,152 +22,149 @@
         """# 执行远程函数
 
         Returns:
             返回值 (dict): 当选项标记为multicall时: `client.call(multicall=True).add(1,2)`         
             返回值 (asyncio.Task): 当baseclient已经运行时，`client.call.add(1,2)` 返回Task。可使用await拿到调用结果，例: `await client.call.add(1,2)`
             返回值 (any): 当baseclient未运行时，`client.call.add(1,2)`返回最终的调用结果
         """
-        f:Union[Coroutine,dict] = self._accessProxy_._client_._bsclient.call(methodName=self._accessProxy_._temp_name_,args=args,dicts=dicts,**self._accessProxy_._temp_opts_)
-        
-        if self._accessProxy_._client_._enterLoop:
-            # self._accessProxy_._client_._enterLoop.run_until_complete
-            futrue = asyncio.run_coroutine_threadsafe(f,self._accessProxy_._client_._enterLoop)
-            return futrue.result()
-
-        if self._accessProxy_._client_._bsclient._isRuning:
-            # f is coroutine
-            return asyncio.create_task(f)
-        else: 
-            if self._accessProxy_._temp_opts_.get('multicall'):
-                # f is dict
-                return f
-            else:
-                # f is coroutine
-                loop = asyncio.get_event_loop()
-                res = loop.run_until_complete(self._accessProxy_._client_._bsclient.start(main=f))
-                return res
+        coro:Coroutine = self._accessProxy_._client_._base_call(methodName=self._accessProxy_._temp_name_,args=args,dicts=dicts,**self._accessProxy_._temp_opts_)
+        if self._accessProxy_._client_._loop:
+            return self._accessProxy_._client_._use_sync(coro)
+        else:
+            return coro
 
 class AccessProxy:
     """访问代理"""
     __slots__ = ('_temp_opts_','_temp_name_','_client_','_exeProxy_')
     def __init__(self,client:'Client'):
         self._temp_opts_ = dict()
         self._temp_name_:str = ''
         self._client_ = client
         self._exeProxy_ = ExeProxy(self)
 
     def __getattr__(self, methodName):
         self._temp_name_ = methodName
         return self._exeProxy_
 
-    def __call__(self,*,timeout:int=None,encrypt:bool=None, ignore:bool=None,multicall:bool=False):
+    def __call__(self,*,timeout:int=None,ignore:bool=None,multicall:bool=False):
         """# 设置调用选项
         Args:
             timeout: 本地等待响应超时，抛出TimeoutError错误（单位：秒） ，默认为为client实例化的值
             encrypt: 是否加密， 默认为为client实例化的值
             ignore: 是否忽略远程执行结果的错误，忽略错误则值用None填充，默认为为client实例化的值
             multicall: 是否标记为合并调用
         """
-        self._temp_opts_ = dict(timeout= self._client_._localTimeout if timeout==None else timeout,
-                          encrypt= self._client_._encrypt if timeout==None else encrypt,
-                          ignore = self._client_._ignore if ignore==None else ignore,
-                          multicall = multicall)
+        self._temp_opts_ = dict(timeout= timeout,
+                                ignore = self._client_._bsclient._ignore if ignore==None else ignore,
+                                multicall = multicall)
         return self
 
 
 class Client:
     """# 客户端
-    支持代理调用
     Args:
-        heartbeatFreq: 心跳频率
-        serverTimeout: 服务器心跳响应超时时间，用于判断是否断线，超过此值会进行重连 (单位:秒)
-        localTimeout: 本地调用超时 (单位:秒)
-        reconnectNum: 断线重连的次数
-        ignore: 是否忽略远程调用异常
-        encrypt: 是否加密传输
+        url: 服务器地址
+        maxReconnectNum: 断线后最大重连次数
+        ignore: 全局设置，是否忽略远程执行结果的错误，忽略错误则值用None填充
+        compress: 是否压缩数据
+        max_msg_size: 表示接收消息的最大大小（以字节为单位）。如果接收到的消息大小超过该值，则会引发异常。
+        username: 用户名
+        password: 密码
+        loop: 指定事件循环
     """
-    __slots__ = ('_localTimeout','_ignore','_encrypt','_heartbeatFreq','_serverTimeout','_reconnectNum','_bsclient','_proxy','_serveHost','_servePort','_enterLoop','_thread')
-    def __init__(self,
-                 *,
-                 host:str=None,
-                 port:int=None,
-                 uri:str = None,
-                 heartbeatFreq:int=2,
-                 serverTimeout:int=2,
-                 localTimeout:int=5,
-                 reconnectNum:int=32,
-                 ignore:bool = False,
-                 encrypt: bool = False) -> None:
-        
-        self._ignore = ignore
-        self._localTimeout:int= localTimeout
-        self._encrypt:bool = encrypt                                    # 是否加密
-        self._heartbeatFreq:int = heartbeatFreq                         # 心跳频率（单位：秒）
-        self._serverTimeout:int = serverTimeout                         # 服务器响应超时时间 （单位：秒）
-        self._reconnectNum:int = reconnectNum                           # 断线重连的次数
-
-        self._serveHost:str = host                                      # 服务器host 
-        self._servePort:int = port                                      # 服务器端口号
-        self._bsclient:BaseClient = None
-
-        self._enterLoop:asyncio.AbstractEventLoop = None                # 使用__enter__时创建的loop
-
-        if uri:
-            self._serveHost,self._servePort = parse_utran_uri(uri)
-
-
-        self._bsclient:BaseClient = BaseClient(heartbeatFreq=self._heartbeatFreq,
-                                                serverTimeout=self._serverTimeout,
-                                                reconnectNum=self._reconnectNum,
-                                                encrypt=self._encrypt,
-                                                host=self._serveHost,
-                                                port=self._servePort)
-        self._proxy = AccessProxy(self)
+    __slots__ = ('_loop','_thread','_bsclient','_is_loop_autogen')
+    
+    def __init__(self, 
+                 url: str = 'ws://localhost:8080', 
+                 maxReconnectNum: int = 10, 
+                 ignore: bool = True, 
+                 compress: int = 0, 
+                 max_msg_size: int = 4 * 1024 * 1024, 
+                 username: str = None, 
+                 password: str = None,
+                 loop:asyncio.AbstractEventLoop = None) -> None:
+        
+        self._bsclient = BaseClient(url, maxReconnectNum, ignore, compress, max_msg_size, username, password)
+        self._loop:asyncio.AbstractEventLoop = loop
+        self._is_loop_autogen = False
 
 
-    def __call__(self, *args: any,**opts: any) -> callable:
+    def __call__(self, *args: any,
+                 url:str=None,
+                 username:str=None,
+                 password:str=None,
+                 loop:asyncio.AbstractEventLoop = None) -> callable:
         """指定入口函数，可以使用装饰器方式指定入口函数"""
         if len(args)==0:
-            return partial(self.__call__,**opts)
+            return partial(self.__call__,url=url,username=username,password=password,loop=loop)
+        
+        main=args[0]        
+        loop = loop or self._get_event_loop()
+        if inspect.iscoroutinefunction(main):            
+            try:
+                async def run():                    
+                    await self._bsclient.start(url=url,username=username,password=password)
+                    if inspect.signature(main).parameters.values():
+                        await main(self)
+                    else:
+                        await main()
+                    await self._bsclient.__aexit__()
+                loop.run_until_complete(run())
+            finally:
+                if self._is_loop_autogen:
+                    loop.stop()
+                    loop.close()
         
-        if inspect.iscoroutinefunction(args[0]):
-            asyncio.run(self._bsclient.start(main=args[0](),host=self._serveHost,port=self._servePort))
-  
-        elif inspect.isfunction(args[0]) or inspect.ismethod(args[0]):
-            self.__enter__()
+
+        elif inspect.isfunction(main) or inspect.ismethod(main):            
             try:
-                args[0]()
+                self.start(url=url,username=username,password=password,loop=loop)
+                if inspect.signature(main).parameters.values():
+                    main(self)
+                else:
+                    main()
             finally:
-                while True:
-                    if not self._bsclient._isRuning:
-                        break
-                    if not self._bsclient.hasSubscribe(returnTopics=False):
-                        _ = asyncio.run_coroutine_threadsafe(self._bsclient.exit(),self._enterLoop)
-                        _.result()
-                        break
-                    time.sleep(1)
+                self.__exit__()
 
-                self.__exit__(None,None,None)
+        return main
 
 
-    async def start(self,main:Union[Future,Coroutine,Callable]=None,uri:str=None,host:str=None,port:int=None,runforever:bool=False):
+    def start(self,url:str=None,username:str=None,password:str=None,loop:asyncio.AbstractEventLoop = None):
         """# 启动连接
         存在订阅的话题时，程序会一直等待话题的推送，无订阅话题时程序在执行完入口函数`main`后自动退出
         Args:            
             main:入口函数，它是一个可等待对象，可以是协程函数、协程对象或Future对象。为指定时默认为
             uri: 服务器地址 例：`utran://127.0.0.1:8081`
             host: 不使用uri时可以直接指定服务器的host和port
             port: 不使用uri时可以直接指定服务器的host和port
             runforever: 是否一直运行,默认入口函数执行完毕且无任何订阅时会自动退出
         """
-        host = host or self._serveHost
-        port = port or self._servePort
-        # 基础客户端
+        self._loop = loop or self._get_event_loop()
+        coro = self._bsclient.start(url=url,username=username,password=password)
+
+        if self._loop==None:
+            return coro
+        
+        def worker():
+            logger.debug("ws线程运行")
+            async def waitExit():
+                await self._bsclient._exitEvent.wait()
+                
+            self._loop.run_until_complete(coro)
+            self._loop.run_until_complete(waitExit())
+            logger.debug("ws线程退出")
+
+        self._thread = threading.Thread(target=worker)
+        self._thread.start()
+
         
-        await self._bsclient.start(main=main,uri=uri,host=host,port=port,runforever=runforever)
+        while True:
+            if self._bsclient._isclosed==0: # 等待连接成功
+                break
+            time.sleep(0.5)
 
 
     def subscribe(self,
                 topic:Union[str,tuple[str]],
                 callback:callable,
                 *,
                 timeout:int=None,
@@ -186,19 +182,20 @@
         Returns:
             {'allTopics': ['topic1','topic2'], 'subTopics': ['topic2']}
         
         |allTopics|subTopics|
         |---------|-----------|
         |所有已订阅的话题 `list`|本次订阅的话题 `list`|
         """
+        if not self._has_start():
+            logger.warning(f'程序已经关闭,无法执行:"subscribe"方法')
+            return
         coro = self._bsclient.subscribe(topic=topic,callback=callback,timeout=timeout,ignore=ignore)
-        if self._enterLoop:
-            futrue = asyncio.run_coroutine_threadsafe(coro,self._enterLoop)
-            return futrue.result()
-
+        if self._loop:
+            return self._use_sync(coro)
         else:
             return coro
     
 
     def unsubscribe(self,
                     *topic:str,
                     timeout:int=None,
@@ -214,90 +211,159 @@
         Returns:
             {'allTopics': ['topic1'], 'unSubTopics': ['topic2']}   
 
         |allTopics|unSubTopics|
         |---------|-----------|
         |所有已订阅的话题 `list`|本次取消订阅的话题 `list`|
         """
+        if not self._has_start(): 
+            logger.warning(f'程序已经关闭,无法执行:"unsubscribe"方法')
+            return
         coro = self._bsclient.unsubscribe(*topic,timeout=timeout,ignore=ignore)
-        if self._enterLoop:
-            futrue = asyncio.run_coroutine_threadsafe(coro,self._enterLoop)
-            return futrue.result()
+        if self._loop:            
+            return self._use_sync(coro)
         else:
             return coro
     
 
 
-    def multicall(self,*calls:Coroutine,encrypt:bool = False,timeout:int=None,ignore:bool=None)->list:
+    def multicall(self,*calls:Coroutine,ignore:bool=None,retransmitFull:bool=False)->Union[list,Coroutine]:
         """# 合并多次调用远程方法或函数
         支持同步和异步的调用，
                 同步调用方式会：1自动建立连接 -- 2任务执行完毕 --3自动关闭连接，适用于未建立连接时使用。
                 异步调用方式会：1使用现有的连接-- 2任务执行完毕。适用于已建立连接时。
         Args:
             *calls: 需要远程调用协程对象
-            encrypt: 是否加密
-            timeout: 本地等待响应超时，抛出TimeoutError错误（单位：秒）
             ignore: 是否忽略远程执行结果的错误，忽略错误则值用None填充
+            retransmitFull: 于服务器失联后，默认只重发未收到响应的请求，如果为True则重发全部请求
         
         Returns:
             执行结果按顺序放在列表中返回
         """
-        f = self._bsclient.multicall(*calls,encrypt=encrypt,timeout=timeout,ignore=ignore)        
-        if self._bsclient._isRuning:
-            return f
+        if not self._has_start():
+            logger.warning(f'程序已经关闭,无法执行:"multicall"方法')
+            return
+        coro = self._bsclient.multicall(*calls,ignore=ignore,retransmitFull=retransmitFull)
+
+        if self._loop:
+            # with关键字调用、同步指定入口
+            return self._use_sync(coro)
         else:
-            _loop = asyncio.get_event_loop()
-            return _loop.run_until_complete(self._bsclient.start(main=f))
+            # 异步指定入口
+            return coro
+
+
+    def _get_event_loop(self):
+        """# 获取可用的事件循环
+
+        Returns:
+            1.当前存在没有被关闭的loop，则返回该loop，当程序退出时不会关闭该loop
+            2.否者生成新的loop并标记未自动生成的，当退出程序时会自动关闭该loop
+        
+        """
+        if self._loop and not self._loop.is_closed():
+            return self._loop
+        else:
+            self._is_loop_autogen = True
+            return asyncio.new_event_loop()
+
+
+    def _has_start(self):
+        """# 是否调用了start
+        未运行start时，进行自启动,当执行exit过后，不会自动
+        """
+        if self._bsclient._isclosed == -1:
+            logger.debug('自启动..')
+            self.start(loop=self._get_event_loop())            
+        elif self._bsclient._isclosed == 1:             
+             return False        
+        return True
+
+    def _use_sync(self,coro:Coroutine):
+        futrue = asyncio.run_coroutine_threadsafe(coro,self._loop)
+        return futrue.result()
 
 
     def exit(self):
         """# 退出程序
         支持同步和异步的调用，
         """
+        if not self._has_start():
+            logger.warning(f'程序已经关闭,无法执行:"exit"方法')
+            return
         coro = self._bsclient.exit()
-        if self._enterLoop:
-            futrue = asyncio.run_coroutine_threadsafe(coro,self._enterLoop)
-            return futrue.result()
+        if self._loop:            
+            self._use_sync(coro)
+            if self._is_loop_autogen:
+                self._loop.stop()
+                self._loop.close()
+                self._loop = None
         else:
             return coro
         
+    
+    def without_sub_exit(self):
+        """无订阅时退出"""
+        if not self._has_start():
+            logger.warning(f'程序已经关闭,无法执行:"without_sub_exit"方法')
+            return
+        coro = self._bsclient.__aexit__(None,None,None)
+        if self._loop:
+            try:
+                self._use_sync(coro)
+                if self._is_loop_autogen:
+                    self._loop.stop()
+                    self._loop.close()
+                    self._loop = None
+            except Exception as e:
+                logger.warning(e)
+        else:
+            return coro
+
 
     @property
     def call(self)->AccessProxy:
         """远程调用
         支持同步和异步的调用，
                 同步调用方式会：1自动建立连接 -- 2任务执行完毕 --3自动关闭连接，适用于未建立连接时使用。
                 异步调用方式会：1使用现有的连接-- 2任务执行完毕。适用于已建立连接时。
 
         Returns:
             返回远程调用的代理类
         """
-        
-        return self._proxy
+        if not self._has_start():
+            logger.warning(f'程序已经关闭,无法执行:"call"方法')
+            return
+        return AccessProxy(self)
     
 
-    def __enter__(self):        
-        self._enterLoop = asyncio.new_event_loop()
-        def worker(loop:asyncio.AbstractEventLoop):
-            loop.run_until_complete(self._bsclient.start(runforever=True))
-
-        self._thread = threading.Thread(target=worker, args=(self._enterLoop,))
-        self._thread.start()
+    @property
+    def _base_call(self):
+        return self._bsclient.call
 
-        while True:
-            if self._bsclient._isRuning:
-                break
-            time.sleep(0.1)
+    def __enter__(self):
+        self._loop = self._get_event_loop()
+        self.start()
         return self
     
-
-    def __exit__(self, exc_type, exc_value, traceback):
+    def __exit__(self, exc_type=None, exc_value=None, traceback=None):
         try:
             if exc_type:
                 raise exc_type(exc_value)
-        finally:
-            self._thread.join()
-            self._enterLoop.close()
-            self._enterLoop = None
+            if self._loop:
+                self.without_sub_exit()
+                return
+        except:
+            if self._loop:
+                self.exit()
+
+    async def __aenter__(self):
+        await self._bsclient.__aenter__()
+        return self
+
+
+    async def __aexit__(self, exc_type, exc_val, exc_tb):
+        await self._bsclient.__aexit__(exc_type, exc_val, exc_tb)
+
```

## utran/server/__init__.py

```diff
@@ -1,3 +1,2 @@
 from utran.server.server import Server
 from utran.server.webserver import WebServer,HttpResponse,WebSocketResponse
-from utran.server.rpcServer import RpcServer
```

## utran/server/server.py

```diff
@@ -2,15 +2,14 @@
 from concurrent.futures import ProcessPoolExecutor
 
 from multiprocessing import Pool
 from utran.handler import process_publish_request
 from utran.object import UtRequest, UtType
 from utran.register import Register
 from utran.server.webserver import WebServer
-from utran.server.rpcServer import RpcServer
 
 from utran.object import SubscriptionContainer
 
 
 
 class Server:
     """包含了web服务和Rpc服务端，支持 RPC、GET、POST、SUB/PUB
@@ -21,18 +20,15 @@
         checkParams (bool): 调用注册函数或方法时，是否检查参数类型，开启后当类型为数据模型时可以自动转换
         checkReturn (bool): 调用注册函数或方法时，是否检查返回值类型，开启后当类型为数据模型时可以自动转换
         dataMaxsize (int):  支持最大数据字节数
         limitHeartbeatInterval (int): 心跳检测的极限值，为了防止心跳攻击，默认为1s,两次心跳的间隔小于该值则会断开连接。
     """
     __slots__=(
         '_host',
-        '_web_port',
-        '_rpc_port',
-        '_without_webserver',
-        '_without_rpcserver',
+        '_port',
         '_checkParams',
         '_checkReturn',
         '_register',
         '_sub_container',
         '_severName',
         '_dataMaxsize',
         '_dataEncrypt',
@@ -42,31 +38,24 @@
         '__isruning',
         '_workers',
         '_pool')
     
     def __init__(
             self,
             *,
-            without_webserver:bool =False,
-            without_rpcserver:bool =False,
             checkParams:bool = True,
             checkReturn:bool = True,
             register: Register = None,
             sub_container: SubscriptionContainer = None,
             severName: str = 'UtranServer',
-            dataMaxsize: int = 102400,
+            dataMaxsize: int = 1024**10,
             limitHeartbeatInterval: int = 1,
             dataEncrypt: bool = False,
             workers:int = 1) -> None:
 
-
-        assert not without_rpcserver or not without_webserver,"There must be a service running."
-
-        self._without_webserver = without_webserver
-        self._without_rpcserver = without_rpcserver
         self._checkParams = checkParams
         self._checkReturn = checkReturn
         
         self._workers = workers                             # 进程池数量        
         self._register = register or Register(checkParams=checkParams,checkReturn=checkReturn,workers=workers)
         self._sub_container = sub_container or SubscriptionContainer()
         
@@ -74,18 +63,20 @@
         self._dataMaxsize = dataMaxsize        
         self._limitHeartbeatInterval = limitHeartbeatInterval
         self._dataEncrypt = dataEncrypt
 
         self.__isruning=False
         self._pool = None
 
+
     async def start(self,
                     host: str = '127.0.0.1',
-                    web_port:int=8080,
-                    rpc_port: int=8081)->None:
+                    port:int=8080,
+                    username: str = None,
+                    password: str = None)->None:
         """
         # 运行服务
         示例:
             ### server = Server()
             ### asyncio.run(server.start())
         """
 
@@ -93,42 +84,28 @@
         else: self.__isruning = True
 
         # 创建进程池
         if self._workers>0 and self._pool is None:
             self._pool = ProcessPoolExecutor(self._workers)
 
         self._host = host
-        self._web_port= web_port
-        self._rpc_port = rpc_port
+        self._port= port
         self._webServer = WebServer(
             register= self._register, 
+            severName= self._severName,
             sub_container= self._sub_container,
             checkParams=self._checkParams,
             checkReturn=self._checkReturn,
             dataMaxsize= self._dataMaxsize, 
             limitHeartbeatInterval= self._limitHeartbeatInterval, 
             dataEncrypt= self._dataEncrypt,
             workers=self._workers,
-            pool=self._pool) if not self._without_webserver else None
+            pool=self._pool)
 
-        self._rpcServer = RpcServer(
-            register= self._register, 
-            sub_container= self._sub_container,
-            checkParams=self._checkParams,
-            checkReturn=self._checkReturn,
-            dataMaxsize= self._dataMaxsize, 
-            limitHeartbeatInterval= self._limitHeartbeatInterval, 
-            dataEncrypt= self._dataEncrypt,
-            workers=self._workers,
-            pool=self._pool) if not self._without_rpcserver else None
-        
-        t = []
-        if not self._without_rpcserver: t.append(self._rpcServer.start(host,rpc_port))
-        if not self._without_webserver: t.append(self._webServer.start(host,web_port))
-        await asyncio.gather(*t)
+        await self._webServer.start(host,port,username=username,password=password)
 
 
     @property
     def register(self)->Register:
         """# 注册
         Returns:
             返回一个Register类的实例
@@ -146,12 +123,8 @@
         """ 
         await process_publish_request(UtRequest(id,requestType=UtType.PUBLISH,topics=topics,msg=msg),self._sub_container)
 
 
 
     def exit(self):
         """退出程序"""
-        if not self._without_rpcserver:
-            self._rpcServer.exit()
-
-        if not self._without_webserver:
-            self._webServer.exit()
+        self._webServer.exit()
```

## utran/server/webserver.py

```diff
@@ -1,11 +1,12 @@
 
 import asyncio
 from concurrent.futures import ProcessPoolExecutor
 import time
+import aiohttp
 import ujson
 import re
 from aiohttp import web
 from aiohttp.web import Response as HttpResponse
 from aiohttp.web_ws import WebSocketResponse
 from aiohttp import WSMsgType,web_request
 from utran.handler import process_request
@@ -15,24 +16,24 @@
 from utran.object import ClientConnection, SubscriptionContainer
 from utran.server.baseServer import BaseServer
 from utran.log import logger
 
 
 
 class WebServer(BaseServer):
-    __slots__=tuple()
+    __slots__=('__auth',)
 
     def __init__(self, 
                  *, 
                  register: Register = None, 
                  sub_container: SubscriptionContainer = None, 
                  severName: str = 'WebServer', 
                  checkParams: bool = True, 
                  checkReturn: bool = True, 
-                 dataMaxsize: int = 102400, 
+                 dataMaxsize: int = 1024*1024, 
                  limitHeartbeatInterval: int = 1, 
                  dataEncrypt: bool = False, 
                  workers: int = 0, 
                  pool:ProcessPoolExecutor=None) -> None:
         super().__init__(
             register=register, 
             sub_container=sub_container, 
@@ -40,20 +41,27 @@
             checkParams=checkParams, 
             checkReturn=checkReturn, 
             dataMaxsize=dataMaxsize, 
             limitHeartbeatInterval=limitHeartbeatInterval, 
             dataEncrypt=dataEncrypt, 
             workers=workers, 
             pool=pool)
+        
+        self.__auth:aiohttp.BasicAuth = aiohttp.BasicAuth('utranhost','utranhost')
 
 
-    async def start(self,host: str,port: int,) -> None:
+    async def start(self,host: str,port: int,username:str=None,password:str=None) -> None:
         self._host = host
         self._port = port
 
+        if username!=None or password!=None:
+            assert username!=None,'username is None.'
+            assert password!=None,'password is None.'
+            self.__auth:aiohttp.BasicAuth = aiohttp.BasicAuth(username,password)
+
         # 创建进程池
         if self._workers>0 and self._pool is None:
             self._pool = ProcessPoolExecutor(self._workers)
             
         server = web.Server(self.handle_request)
         runner = web.ServerRunner(server)
         await runner.setup()
@@ -61,19 +69,34 @@
         await site.start()
         logger.success(f"\n{'='*6} {self._severName} on http://{site._host}:{site._port}/ {'='*6}")
         await self._exitEvent.wait()
         
 
     async def handle_request(self,request:web_request.BaseRequest):
         """处理web请求,分发http请求和websocket请求"""
+
+        # 验证身份验证信息
+        auth_header = request.headers.get('Authorization')
+        if auth_header:
+            auth = self.__auth.decode(auth_header)
+        else:
+            auth = None
+            
         wname = request.headers.get('Upgrade')
         if wname and wname.lower() == 'websocket':
-            ws = WebSocketResponse()            
-            print(type(ws))
+            ws = WebSocketResponse(max_msg_size=self._dataMaxsize)            
             await ws.prepare(request)
+            if auth != self.__auth:
+                # 身份验证失败
+                await ws.send_str('身份验证失败!')
+                return
+            else:
+                #  身份验证成功
+                await ws.send_str('ok')
+
             await self.websocket_handler(ws)
         else:
             return await self.http_handler(request)
 
 
 
     async def http_handler(self,request:web_request.BaseRequest):
@@ -117,33 +140,31 @@
         else:
             return HttpResponse(status=status,text=ujson.dumps(execute_res),content_type='application/json')
 
 
     async def websocket_handler(self,ws:WebSocketResponse):
         """处理websocket请求"""
         connection = ClientConnection(ws,self._dataEncrypt)
-        t = float('-inf')
+        t = float('-inf')        
         async for msg in ws:
-
             # 心跳检测
-            if msg.type == WSMsgType.PING or msg.type == WSMsgType.TEXT and msg.data == HeartBeat.PING.value.decode():
+            # print(msg.type)
+            if msg.type == WSMsgType.PING:
                 if time.time() - t < self._limitHeartbeatInterval: break
                 t = time.time()
                 await ws.send_str(HeartBeat.PONG.value.decode())                
                 continue
 
             if msg.type == WSMsgType.TEXT:
                 try:
                     if msg.data:
                         res:dict = ujson.loads(msg.data)
                         if type(res)!=dict:break
-
                         # 处理请求
-                        if await process_request(create_UtRequest(res,res.get('id'),res.get('encrypt')),connection,self._register,self._sub_container,pool=self._pool):
-                            break
+                        asyncio.create_task(process_request(create_UtRequest(res,res.get('id'),res.get('encrypt')),connection,self._register,self._sub_container,pool=self._pool))
                         continue
                 except:
                     break
 
         self._sub_container.del_sub(connection.id)
         await ws.close()
         # print('websocket connection closed.')
```

## Comparing `utran-1.0.3.dist-info/LICENSE` & `utran-1.1.0.dist-info/LICENSE`

 * *Files identical despite different names*

