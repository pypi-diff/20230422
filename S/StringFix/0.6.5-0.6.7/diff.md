# Comparing `tmp/StringFix-0.6.5.tar.gz` & `tmp/StringFix-0.6.7.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "StringFix-0.6.5.tar", last modified: Sat Apr 22 02:43:19 2023, max compression
+gzip compressed data, was "StringFix-0.6.7.tar", last modified: Sat Apr 22 03:59:17 2023, max compression
```

## Comparing `StringFix-0.6.5.tar` & `StringFix-0.6.7.tar`

### file list

```diff
@@ -1,19 +1,19 @@
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 02:43:19.411800 StringFix-0.6.5/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.6.5/LICENSE
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.6.5/MANIFEST.in
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 02:43:19.411800 StringFix-0.6.5/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.6.5/README.md
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 02:43:19.411800 StringFix-0.6.5/StringFix/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.6.5/StringFix/__init__.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)   598163 2023-04-22 02:40:46.000000 StringFix-0.6.5/StringFix/core.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)    53685 2023-04-22 02:22:03.000000 StringFix-0.6.5/StringFix/pybam.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     7641 2023-04-22 02:41:50.000000 StringFix-0.6.5/StringFix/run_sfix.py
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 02:43:19.411800 StringFix-0.6.5/StringFix.egg-info/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 02:43:19.000000 StringFix-0.6.5/StringFix.egg-info/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-22 02:43:19.000000 StringFix-0.6.5/StringFix.egg-info/SOURCES.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 02:43:19.000000 StringFix-0.6.5/StringFix.egg-info/dependency_links.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 02:43:19.000000 StringFix-0.6.5/StringFix.egg-info/not-zip-safe
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-22 02:43:19.000000 StringFix-0.6.5/StringFix.egg-info/requires.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       10 2023-04-22 02:43:19.000000 StringFix-0.6.5/StringFix.egg-info/top_level.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-22 02:43:19.411800 StringFix-0.6.5/setup.cfg
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-22 02:42:59.000000 StringFix-0.6.5/setup.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 03:59:17.490205 StringFix-0.6.7/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.6.7/LICENSE
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.6.7/MANIFEST.in
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 03:59:17.490205 StringFix-0.6.7/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.6.7/README.md
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 03:59:17.490205 StringFix-0.6.7/StringFix/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.6.7/StringFix/__init__.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)   598115 2023-04-22 03:59:03.000000 StringFix-0.6.7/StringFix/core.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    53685 2023-04-22 02:22:03.000000 StringFix-0.6.7/StringFix/pybam.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     7641 2023-04-22 03:48:29.000000 StringFix-0.6.7/StringFix/run_sfix.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 03:59:17.490205 StringFix-0.6.7/StringFix.egg-info/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/SOURCES.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/dependency_links.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/not-zip-safe
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/requires.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       10 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/top_level.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-22 03:59:17.490205 StringFix-0.6.7/setup.cfg
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-22 03:59:12.000000 StringFix-0.6.7/setup.py
```

### Comparing `StringFix-0.6.5/LICENSE` & `StringFix-0.6.7/LICENSE`

 * *Files identical despite different names*

### Comparing `StringFix-0.6.5/PKG-INFO` & `StringFix-0.6.7/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.6.5
+Version: 0.6.7
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.6.5/StringFix/core.py` & `StringFix-0.6.7/StringFix/core.py`

 * *Files 0% similar despite different names*

```diff
@@ -18018,19369 +18018,19366 @@
 00046610: 765f 696e 666f 0a0a 636c 6173 7320 7472  v_info..class tr
 00046620: 616e 7363 7269 7074 5f64 6573 6372 6970  anscript_descrip
 00046630: 746f 723a 0a0a 2020 2020 2320 6966 2073  tor:..    # if s
 00046640: 656c 662e 6973 7472 616e 6420 213d 2030  elf.istrand != 0
 00046650: 0a20 2020 2064 6566 2067 6574 5f63 6473  .    def get_cds
 00046660: 5f6e 765f 696e 666f 2820 7365 6c66 2c20  _nv_info( self, 
 00046670: 6e76 5f69 6e66 6f5f 6c73 745f 6672 6f6d  nv_info_lst_from
-00046680: 5f67 656e 652c 2063 6473 5f72 676e 7320  _gene, cds_rgns 
-00046690: 293a 0a0a 2020 2020 2020 2020 6e76 5f69  ):..        nv_i
-000466a0: 6e66 6f5f 6c73 7420 3d20 5b5d 0a0a 2020  nfo_lst = []..  
-000466b0: 2020 2020 2020 7072 6f63 203d 206e 702e        proc = np.
-000466c0: 6675 6c6c 286c 656e 286e 765f 696e 666f  full(len(nv_info
-000466d0: 5f6c 7374 5f66 726f 6d5f 6765 6e65 292c  _lst_from_gene),
-000466e0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
-000466f0: 666f 7220 6b2c 206e 7620 696e 2065 6e75  for k, nv in enu
-00046700: 6d65 7261 7465 286e 765f 696e 666f 5f6c  merate(nv_info_l
-00046710: 7374 5f66 726f 6d5f 6765 6e65 293a 0a20  st_from_gene):. 
-00046720: 2020 2020 2020 2020 2020 2076 5f74 7970             v_typ
-00046730: 6520 3d20 6e76 2e76 5f74 7970 650a 2020  e = nv.v_type.  
-00046740: 2020 2020 2020 2020 2020 6966 206e 762e            if nv.
-00046750: 7265 665f 7365 7120 3d3d 2027 2d27 3a0a  ref_seq == '-':.
-00046760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046770: 7220 3d20 7265 6769 6f6e 2820 6e76 2e63  r = region( nv.c
-00046780: 6872 2c20 6e76 2e70 6f73 5f72 6566 2c20  hr, nv.pos_ref, 
-00046790: 6e76 2e70 6f73 5f72 6566 2c20 2763 6473  nv.pos_ref, 'cds
-000467a0: 272c 2027 272c 2063 7667 5f64 6570 203d  ', '', cvg_dep =
-000467b0: 2031 2029 0a20 2020 2020 2020 2020 2020   1 ).           
-000467c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000467d0: 2020 2020 2020 2072 203d 2072 6567 696f         r = regio
-000467e0: 6e28 206e 762e 6368 722c 206e 762e 706f  n( nv.chr, nv.po
-000467f0: 735f 7265 662c 206e 762e 706f 735f 7265  s_ref, nv.pos_re
-00046800: 662b 6e76 2e76 5f6c 656e 2d31 2c20 2763  f+nv.v_len-1, 'c
-00046810: 6473 272c 206e 762e 7265 665f 7365 712c  ds', nv.ref_seq,
-00046820: 2063 7667 5f64 6570 203d 2031 2029 0a0a   cvg_dep = 1 )..
-00046830: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-00046840: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00046850: 2020 636e 745f 6520 3d20 300a 2020 2020    cnt_e = 0.    
-00046860: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00046870: 2073 656c 662e 7463 5f74 6f5f 6763 5f6d   self.tc_to_gc_m
-00046880: 6170 3a0a 2020 2020 2020 2020 2020 2020  ap:.            
-00046890: 2020 2020 6966 2028 6364 735f 7267 6e73      if (cds_rgns
-000468a0: 5b69 5d2e 7479 7065 2e6c 6f77 6572 2829  [i].type.lower()
-000468b0: 203d 3d20 2763 6473 2729 207c 2028 6364   == 'cds') | (cd
-000468c0: 735f 7267 6e73 5b69 5d2e 7479 7065 2e6c  s_rgns[i].type.l
-000468d0: 6f77 6572 2829 203d 3d20 2773 746f 705f  ower() == 'stop_
-000468e0: 636f 646f 6e27 293a 0a20 2020 2020 2020  codon'):.       
-000468f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00046900: 6364 735f 7267 6e73 5b69 5d2e 6861 735f  cds_rgns[i].has_
-00046910: 6578 745f 696e 7465 7273 6563 7469 6f6e  ext_intersection
-00046920: 5f77 6974 6828 7229 3a0a 2020 2020 2020  _with(r):.      
-00046930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046940: 2020 6220 3d20 5472 7565 0a20 2020 2020    b = True.     
-00046950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046960: 2020 2072 656c 5f70 6f73 203d 2073 656c     rel_pos = sel
-00046970: 662e 6c6f 662e 7265 6c5f 706f 7328 206e  f.lof.rel_pos( n
-00046980: 762e 706f 735f 7265 6620 290a 2020 2020  v.pos_ref ).    
-00046990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000469a0: 2020 2020 6966 2072 656c 5f70 6f73 203e      if rel_pos >
-000469b0: 206c 656e 2873 656c 662e 7073 6571 293a   len(self.pseq):
-000469c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000469d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000469e0: 636e 745f 6520 3d3d 2030 3a0a 2020 2020  cnt_e == 0:.    
-000469f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046a00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00046a10: 7428 2720 2020 506f 7373 6962 6c65 2045  t('   Possible E
-00046a20: 5252 4f52 2069 6e20 6765 745f 6364 735f  RROR in get_cds_
-00046a30: 6e76 5f69 6e66 6f20 2e27 2c20 656e 6420  nv_info .', end 
-00046a40: 3d20 2727 290a 2020 2020 2020 2020 2020  = '').          
-00046a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046a60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00046a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046a80: 2020 2020 2020 2020 7072 696e 7428 272e          print('.
-00046a90: 272c 2065 6e64 203d 2027 2729 0a20 2020  ', end = '').   
-00046aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046ab0: 2020 2020 2020 2020 2063 6e74 5f65 202b           cnt_e +
-00046ac0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00046ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046ae0: 2320 7072 696e 7428 275c 6e45 5252 4f52  # print('\nERROR
-00046af0: 2069 6e20 7472 616e 7363 7269 7074 5f64   in transcript_d
-00046b00: 6573 6372 6970 746f 723a 6765 745f 6364  escriptor:get_cd
-00046b10: 735f 6e76 5f69 6e66 6f3a 2025 6920 3e20  s_nv_info: %i > 
-00046b20: 2569 2720 2520 2872 656c 5f70 6f73 2c20  %i' % (rel_pos, 
-00046b30: 6c65 6e28 7365 6c66 2e70 7365 7129 292c  len(self.pseq)),
-00046b40: 2065 6e64 203d 2027 2729 0a20 2020 2020   end = '').     
+00046680: 5f67 656e 652c 2063 6473 5f72 676e 732c  _gene, cds_rgns,
+00046690: 2063 6e74 5f65 2029 3a0a 0a20 2020 2020   cnt_e ):..     
+000466a0: 2020 206e 765f 696e 666f 5f6c 7374 203d     nv_info_lst =
+000466b0: 205b 5d0a 0a20 2020 2020 2020 2070 726f   []..        pro
+000466c0: 6320 3d20 6e70 2e66 756c 6c28 6c65 6e28  c = np.full(len(
+000466d0: 6e76 5f69 6e66 6f5f 6c73 745f 6672 6f6d  nv_info_lst_from
+000466e0: 5f67 656e 6529 2c20 4661 6c73 6529 0a20  _gene), False). 
+000466f0: 2020 2020 2020 2066 6f72 206b 2c20 6e76         for k, nv
+00046700: 2069 6e20 656e 756d 6572 6174 6528 6e76   in enumerate(nv
+00046710: 5f69 6e66 6f5f 6c73 745f 6672 6f6d 5f67  _info_lst_from_g
+00046720: 656e 6529 3a0a 2020 2020 2020 2020 2020  ene):.          
+00046730: 2020 765f 7479 7065 203d 206e 762e 765f    v_type = nv.v_
+00046740: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
+00046750: 2069 6620 6e76 2e72 6566 5f73 6571 203d   if nv.ref_seq =
+00046760: 3d20 272d 273a 0a20 2020 2020 2020 2020  = '-':.         
+00046770: 2020 2020 2020 2072 203d 2072 6567 696f         r = regio
+00046780: 6e28 206e 762e 6368 722c 206e 762e 706f  n( nv.chr, nv.po
+00046790: 735f 7265 662c 206e 762e 706f 735f 7265  s_ref, nv.pos_re
+000467a0: 662c 2027 6364 7327 2c20 2727 2c20 6376  f, 'cds', '', cv
+000467b0: 675f 6465 7020 3d20 3120 290a 2020 2020  g_dep = 1 ).    
+000467c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000467d0: 2020 2020 2020 2020 2020 2020 2020 7220                r 
+000467e0: 3d20 7265 6769 6f6e 2820 6e76 2e63 6872  = region( nv.chr
+000467f0: 2c20 6e76 2e70 6f73 5f72 6566 2c20 6e76  , nv.pos_ref, nv
+00046800: 2e70 6f73 5f72 6566 2b6e 762e 765f 6c65  .pos_ref+nv.v_le
+00046810: 6e2d 312c 2027 6364 7327 2c20 6e76 2e72  n-1, 'cds', nv.r
+00046820: 6566 5f73 6571 2c20 6376 675f 6465 7020  ef_seq, cvg_dep 
+00046830: 3d20 3120 290a 0a20 2020 2020 2020 2020  = 1 )..         
+00046840: 2020 2062 203d 2046 616c 7365 0a20 2020     b = False.   
+00046850: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00046860: 6e20 7365 6c66 2e74 635f 746f 5f67 635f  n self.tc_to_gc_
+00046870: 6d61 703a 0a20 2020 2020 2020 2020 2020  map:.           
+00046880: 2020 2020 2069 6620 2863 6473 5f72 676e       if (cds_rgn
+00046890: 735b 695d 2e74 7970 652e 6c6f 7765 7228  s[i].type.lower(
+000468a0: 2920 3d3d 2027 6364 7327 2920 7c20 2863  ) == 'cds') | (c
+000468b0: 6473 5f72 676e 735b 695d 2e74 7970 652e  ds_rgns[i].type.
+000468c0: 6c6f 7765 7228 2920 3d3d 2027 7374 6f70  lower() == 'stop
+000468d0: 5f63 6f64 6f6e 2729 3a0a 2020 2020 2020  _codon'):.      
+000468e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000468f0: 2063 6473 5f72 676e 735b 695d 2e68 6173   cds_rgns[i].has
+00046900: 5f65 7874 5f69 6e74 6572 7365 6374 696f  _ext_intersectio
+00046910: 6e5f 7769 7468 2872 293a 0a20 2020 2020  n_with(r):.     
+00046920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046930: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
+00046940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046950: 2020 2020 7265 6c5f 706f 7320 3d20 7365      rel_pos = se
+00046960: 6c66 2e6c 6f66 2e72 656c 5f70 6f73 2820  lf.lof.rel_pos( 
+00046970: 6e76 2e70 6f73 5f72 6566 2029 0a20 2020  nv.pos_ref ).   
+00046980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046990: 2020 2020 2069 6620 7265 6c5f 706f 7320       if rel_pos 
+000469a0: 3e20 6c65 6e28 7365 6c66 2e70 7365 7129  > len(self.pseq)
+000469b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000469c0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+000469d0: 745f 6520 2b3d 2031 0a20 2020 2020 2020  t_e += 1.       
+000469e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000469f0: 2020 2020 2023 2070 7269 6e74 2827 5c6e       # print('\n
+00046a00: 4552 524f 5220 696e 2074 7261 6e73 6372  ERROR in transcr
+00046a10: 6970 745f 6465 7363 7269 7074 6f72 3a67  ipt_descriptor:g
+00046a20: 6574 5f63 6473 5f6e 765f 696e 666f 3a20  et_cds_nv_info: 
+00046a30: 2569 203e 2025 6927 2025 2028 7265 6c5f  %i > %i' % (rel_
+00046a40: 706f 732c 206c 656e 2873 656c 662e 7073  pos, len(self.ps
+00046a50: 6571 2929 2c20 656e 6420 3d20 2727 290a  eq)), end = '').
+00046a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046a70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00046a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046a90: 2020 2020 2020 2020 2020 6e76 5f74 7220            nv_tr 
+00046aa0: 3d20 6765 745f 6e76 5f69 6e66 6f5f 7472  = get_nv_info_tr
+00046ab0: 2820 7365 6c66 2e70 7365 712c 2073 656c  ( self.pseq, sel
+00046ac0: 662e 6973 7472 616e 642c 2072 656c 5f70  f.istrand, rel_p
+00046ad0: 6f73 2c20 6e76 2c20 7365 6c66 2e74 6964  os, nv, self.tid
+00046ae0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00046af0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00046b00: 6620 6e76 5f74 7220 6973 206e 6f74 204e  f nv_tr is not N
+00046b10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00046b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046b30: 2020 2020 206e 765f 696e 666f 5f6c 7374       nv_info_lst
+00046b40: 2e61 7070 656e 6428 6e76 5f74 7229 0a20  .append(nv_tr). 
 00046b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046b60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00046b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046b80: 2020 2020 206e 765f 7472 203d 2067 6574       nv_tr = get
-00046b90: 5f6e 765f 696e 666f 5f74 7228 2073 656c  _nv_info_tr( sel
-00046ba0: 662e 7073 6571 2c20 7365 6c66 2e69 7374  f.pseq, self.ist
-00046bb0: 7261 6e64 2c20 7265 6c5f 706f 732c 206e  rand, rel_pos, n
-00046bc0: 762c 2073 656c 662e 7469 6420 290a 2020  v, self.tid ).  
-00046bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046be0: 2020 2020 2020 2020 2020 6966 206e 765f            if nv_
-00046bf0: 7472 2069 7320 6e6f 7420 4e6f 6e65 3a0a  tr is not None:.
-00046c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c20: 6e76 5f69 6e66 6f5f 6c73 742e 6170 7065  nv_info_lst.appe
-00046c30: 6e64 286e 765f 7472 290a 2020 2020 2020  nd(nv_tr).      
-00046c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c50: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00046c60: 2020 2020 2020 2020 6966 2063 6e74 5f65          if cnt_e
-00046c70: 203e 2030 3a20 7072 696e 7428 2720 2729   > 0: print(' ')
-00046c80: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-00046c90: 635b 6b5d 203d 2062 0a0a 2020 2020 2020  c[k] = b..      
-00046ca0: 2020 7265 7475 726e 2020 6e76 5f69 6e66    return  nv_inf
-00046cb0: 6f5f 6c73 742c 2070 726f 630a 2020 2020  o_lst, proc.    
-00046cc0: 0a0a 2020 2020 6465 6620 6765 745f 6f72  ..    def get_or
-00046cd0: 675f 636f 6469 6e67 5f73 6571 2873 656c  g_coding_seq(sel
-00046ce0: 662c 2063 6473 5f72 676e 732c 2067 656e  f, cds_rgns, gen
-00046cf0: 6f6d 655f 7365 7129 3a0a 0a20 2020 2020  ome_seq):..     
-00046d00: 2020 2070 7365 7120 3d20 2727 0a20 2020     pseq = ''.   
-00046d10: 2020 2020 206c 6f66 203d 206c 6f63 6174       lof = locat
-00046d20: 696f 6e5f 6669 6e64 6572 2829 0a20 2020  ion_finder().   
-00046d30: 2020 2020 200a 2020 2020 2020 2020 666f       .        fo
-00046d40: 7220 6920 696e 2073 656c 662e 7463 5f74  r i in self.tc_t
-00046d50: 6f5f 6763 5f6d 6170 3a0a 2020 2020 2020  o_gc_map:.      
-00046d60: 2020 2020 2020 6966 2028 6364 735f 7267        if (cds_rg
-00046d70: 6e73 5b69 5d2e 7479 7065 2e6c 6f77 6572  ns[i].type.lower
-00046d80: 2829 203d 3d20 2763 6473 2729 207c 2028  () == 'cds') | (
-00046d90: 6364 735f 7267 6e73 5b69 5d2e 7479 7065  cds_rgns[i].type
-00046da0: 2e6c 6f77 6572 2829 203d 3d20 2773 746f  .lower() == 'sto
-00046db0: 705f 636f 646f 6e27 293a 0a20 2020 2020  p_codon'):.     
-00046dc0: 2020 2020 2020 2020 2020 206c 6f66 2e61             lof.a
-00046dd0: 6464 2820 6364 735f 7267 6e73 5b69 5d2e  dd( cds_rgns[i].
-00046de0: 7374 6172 742c 2063 6473 5f72 676e 735b  start, cds_rgns[
-00046df0: 695d 2e65 6e64 2c20 6c65 6e28 7073 6571  i].end, len(pseq
-00046e00: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00046e10: 2020 2070 7365 7120 3d20 7073 6571 202b     pseq = pseq +
-00046e20: 2067 656e 6f6d 655f 7365 715b 2028 6364   genome_seq[ (cd
-00046e30: 735f 7267 6e73 5b69 5d2e 7374 6172 742d  s_rgns[i].start-
-00046e40: 3129 3a63 6473 5f72 676e 735b 695d 2e65  1):cds_rgns[i].e
-00046e50: 6e64 205d 0a20 2020 2020 2020 2020 2020  nd ].           
-00046e60: 2020 2020 200a 2020 2020 2020 2020 7365       .        se
-00046e70: 6c66 2e70 7365 7120 3d20 7073 6571 0a20  lf.pseq = pseq. 
-00046e80: 2020 2020 2020 2073 656c 662e 6c6f 6620         self.lof 
-00046e90: 3d20 6c6f 660a 0a20 2020 200a 2020 2020  = lof..    .    
-00046ea0: 6465 6620 6765 745f 7472 616e 7363 7269  def get_transcri
-00046eb0: 7074 5f74 7570 6c65 2873 656c 6629 3a0a  pt_tuple(self):.
-00046ec0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00046ed0: 2072 6574 7572 6e20 5472 616e 7363 7269   return Transcri
-00046ee0: 7074 2873 656c 662e 7072 6566 6978 2c20  pt(self.prefix, 
-00046ef0: 7365 6c66 2e67 6964 2c20 7365 6c66 2e67  self.gid, self.g
-00046f00: 7270 5f73 697a 652c 2073 656c 662e 6963  rp_size, self.ic
-00046f10: 6e74 2c20 7365 6c66 2e63 6872 2c20 7365  nt, self.chr, se
-00046f20: 6c66 2e62 6567 696e 2c20 7365 6c66 2e65  lf.begin, self.e
-00046f30: 6e64 2c20 5c0a 2020 2020 2020 2020 2020  nd, \.          
-00046f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046f50: 6765 745f 635f 6672 6f6d 5f69 7374 7261  get_c_from_istra
-00046f60: 6e64 2873 656c 662e 6973 7472 616e 6429  nd(self.istrand)
-00046f70: 2c20 6765 745f 7374 725f 6672 6f6d 5f69  , get_str_from_i
-00046f80: 6364 6e67 2873 656c 662e 6963 6473 292c  cdng(self.icds),
-00046f90: 2073 656c 662e 7473 6571 2c20 5c0a 2020   self.tseq, \.  
-00046fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046fb0: 2020 2020 2020 2020 7365 6c66 2e61 626e          self.abn
-00046fc0: 2c20 7365 6c66 2e74 706d 2c20 7365 6c66  , self.tpm, self
-00046fd0: 2e69 736f 5f66 7261 632c 2073 656c 662e  .iso_frac, self.
-00046fe0: 7072 6f62 2c20 7365 6c66 2e6e 6578 6f6e  prob, self.nexon
-00046ff0: 732c 2073 656c 662e 6776 6f6c 290a 0a20  s, self.gvol).. 
-00047000: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00047010: 7365 6c66 2c20 6774 665f 6c69 6e65 735f  self, gtf_lines_
-00047020: 6f66 5f61 5f74 7220 3d20 4e6f 6e65 2c20  of_a_tr = None, 
-00047030: 6578 6f6e 5f72 676e 7320 3d20 4e6f 6e65  exon_rgns = None
-00047040: 2c20 6364 735f 7267 6e73 203d 204e 6f6e  , cds_rgns = Non
-00047050: 652c 2067 656e 6f6d 6520 3d20 4e6f 6e65  e, genome = None
-00047060: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00047070: 2020 2020 2063 6473 203d 202d 312c 2066       cds = -1, f
-00047080: 696c 6c20 3d20 4661 6c73 652c 2076 6572  ill = False, ver
-00047090: 626f 7365 203d 2046 616c 7365 293a 0a20  bose = False):. 
-000470a0: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
-000470b0: 6774 665f 6c69 6e65 7320 3d20 6774 665f  gtf_lines = gtf_
-000470c0: 6c69 6e65 735f 6f66 5f61 5f74 720a 2020  lines_of_a_tr.  
-000470d0: 2020 2020 2020 7365 6c66 2e63 6872 203d        self.chr =
-000470e0: 2027 270a 2020 2020 2020 2020 7365 6c66   ''.        self
-000470f0: 2e62 6567 696e 203d 202d 3120 2020 2020  .begin = -1     
-00047100: 2023 2320 312d 6261 7365 0a20 2020 2020   ## 1-base.     
-00047110: 2020 2073 656c 662e 656e 6420 3d20 2d31     self.end = -1
-00047120: 2020 2020 2020 2020 2323 2031 2d62 6173          ## 1-bas
-00047130: 650a 2020 2020 2020 2020 0a20 2020 2020  e.        .     
-00047140: 2020 2073 656c 662e 6769 6420 3d20 2727     self.gid = ''
-00047150: 0a20 2020 2020 2020 2073 656c 662e 676e  .        self.gn
-00047160: 616d 6520 3d20 2727 0a20 2020 2020 2020  ame = ''.       
-00047170: 2073 656c 662e 7469 6420 3d20 2727 0a20   self.tid = ''. 
-00047180: 2020 2020 2020 2073 656c 662e 746e 616d         self.tnam
-00047190: 6520 3d20 2727 0a20 2020 2020 2020 2073  e = ''.        s
-000471a0: 656c 662e 6269 6f74 7970 6520 3d20 2727  elf.biotype = ''
-000471b0: 0a20 2020 2020 2020 2073 656c 662e 6973  .        self.is
-000471c0: 7472 616e 6420 3d20 300a 2020 2020 2020  trand = 0.      
-000471d0: 2020 7365 6c66 2e69 6364 7320 3d20 6364    self.icds = cd
-000471e0: 7320 2020 2020 2020 2323 202d 313a 2075  s       ## -1: u
-000471f0: 6e73 7065 6369 6669 6564 2c20 303a 206e  nspecified, 0: n
-00047200: 6f6e 2d63 6f64 696e 672c 2031 3a20 636f  on-coding, 1: co
-00047210: 6469 6e67 0a20 2020 2020 2020 200a 2020  ding.        .  
-00047220: 2020 2020 2020 2323 2075 7365 6420 696e        ## used in
-00047230: 2074 645f 616e 645f 6165 0a20 2020 2020   td_and_ae.     
-00047240: 2020 2073 656c 662e 7465 5f74 6f5f 6765     self.te_to_ge
-00047250: 5f6d 6170 203d 205b 5d0a 2020 2020 2020  _map = [].      
-00047260: 2020 7365 6c66 2e74 635f 746f 5f67 635f    self.tc_to_gc_
-00047270: 6d61 7020 3d20 5b5d 0a20 2020 2020 2020  map = [].       
-00047280: 2073 656c 662e 7472 5f74 6f5f 6772 5f6d   self.tr_to_gr_m
-00047290: 6170 203d 205b 5d0a 2020 2020 2020 2020  ap = [].        
-000472a0: 7365 6c66 2e61 626e 203d 2030 0a20 2020  self.abn = 0.   
-000472b0: 2020 2020 2073 656c 662e 636f 7620 3d20       self.cov = 
-000472c0: 300a 2020 2020 2020 2020 7365 6c66 2e74  0.        self.t
-000472d0: 6c65 6e20 3d20 2d31 0a20 2020 2020 2020  len = -1.       
-000472e0: 2073 656c 662e 706c 656e 203d 202d 310a   self.plen = -1.
-000472f0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00047300: 2073 656c 662e 636f 765f 6c65 6e20 3d20   self.cov_len = 
-00047310: 300a 2020 2020 2020 2020 7365 6c66 2e63  0.        self.c
-00047320: 6f76 5f72 6174 696f 203d 2030 0a0a 2020  ov_ratio = 0..  
-00047330: 2020 2020 2020 2323 2054 656d 706f 7261        ## Tempora
-00047340: 7279 2076 6172 6961 626c 6573 0a20 2020  ry variables.   
-00047350: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
-00047360: 203d 2027 5827 0a20 2020 2020 2020 2073   = 'X'.        s
-00047370: 656c 662e 7072 6f62 203d 2030 0a20 2020  elf.prob = 0.   
-00047380: 2020 2020 2073 656c 662e 6776 6f6c 203d       self.gvol =
-00047390: 2030 0a20 2020 2020 2020 2073 656c 662e   0.        self.
-000473a0: 6e65 786f 6e73 203d 2030 0a20 2020 2020  nexons = 0.     
-000473b0: 2020 2073 656c 662e 6c65 6e5f 6f73 203d     self.len_os =
-000473c0: 202d 310a 2020 2020 2020 2020 7365 6c66   -1.        self
-000473d0: 2e70 6f73 5f73 7461 7274 203d 202d 3120  .pos_start = -1 
-000473e0: 2023 2320 302d 6261 7365 0a20 2020 2020   ## 0-base.     
-000473f0: 2020 2073 656c 662e 706f 735f 7374 6f70     self.pos_stop
-00047400: 203d 202d 3120 2020 2323 2030 2d62 6173   = -1   ## 0-bas
-00047410: 650a 2020 2020 2020 2020 0a20 2020 2020  e.        .     
-00047420: 2020 2023 2320 5472 2069 6e66 6f0a 2020     ## Tr info.  
-00047430: 2020 2020 2020 7365 6c66 2e74 706d 203d        self.tpm =
-00047440: 202d 310a 2020 2020 2020 2020 7365 6c66   -1.        self
-00047450: 2e69 636e 7420 3d20 2d31 0a20 2020 2020  .icnt = -1.     
-00047460: 2020 2073 656c 662e 6772 705f 7369 7a65     self.grp_size
-00047470: 203d 202d 310a 2020 2020 2020 2020 7365   = -1.        se
-00047480: 6c66 2e69 736f 5f66 7261 6320 3d20 2d31  lf.iso_frac = -1
-00047490: 0a0a 2020 2020 2020 2020 2323 2043 6f64  ..        ## Cod
-000474a0: 6f6e 2070 6f73 2061 6e64 2073 7461 7475  on pos and statu
-000474b0: 730a 2020 2020 2020 2020 7365 6c66 2e73  s.        self.s
-000474c0: 7461 7274 5f63 6f64 6f6e 5f70 6f73 5f6f  tart_codon_pos_o
-000474d0: 7267 203d 2028 2d31 2c2d 3129 0a20 2020  rg = (-1,-1).   
-000474e0: 2020 2020 2073 656c 662e 7374 6f70 5f63       self.stop_c
-000474f0: 6f64 6f6e 5f70 6f73 5f6f 7267 203d 2028  odon_pos_org = (
-00047500: 2d31 2c2d 3129 0a20 2020 2020 2020 200a  -1,-1).        .
-00047510: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-00047520: 7274 5f63 6f64 6f6e 5f65 7665 6e74 203d  rt_codon_event =
-00047530: 202d 310a 2020 2020 2020 2020 7365 6c66   -1.        self
-00047540: 2e73 746f 705f 636f 646f 6e5f 6576 656e  .stop_codon_even
-00047550: 7420 3d20 2d31 0a20 2020 2020 2020 200a  t = -1.        .
-00047560: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-00047570: 7274 5f63 6f64 6f6e 5f70 6f73 203d 2028  rt_codon_pos = (
-00047580: 2d31 2c2d 3129 0a20 2020 2020 2020 2073  -1,-1).        s
-00047590: 656c 662e 7374 6f70 5f63 6f64 6f6e 5f70  elf.stop_codon_p
-000475a0: 6f73 203d 2028 2d31 2c2d 3129 0a0a 2020  os = (-1,-1)..  
-000475b0: 2020 2020 2020 7365 6c66 2e73 7461 7274        self.start
-000475c0: 5f63 6f64 6f6e 5f73 7461 7475 7320 3d20  _codon_status = 
-000475d0: 2d31 0a20 2020 2020 2020 2073 656c 662e  -1.        self.
-000475e0: 7374 6f70 5f63 6f64 6f6e 5f73 7461 7475  stop_codon_statu
-000475f0: 7320 3d20 2d31 0a20 2020 2020 2020 200a  s = -1.        .
-00047600: 2020 2020 2020 2020 2323 2066 696c 6c65          ## fille
-00047610: 6420 7769 7468 2067 6574 5f73 6571 5f66  d with get_seq_f
-00047620: 726f 6d5f 6578 6f6e 7328 290a 2020 2020  rom_exons().    
-00047630: 2020 2020 7365 6c66 2e6c 6f66 203d 204e      self.lof = N
-00047640: 6f6e 650a 2020 2020 2020 2020 6966 2067  one.        if g
-00047650: 656e 6f6d 6520 6973 206e 6f74 204e 6f6e  enome is not Non
-00047660: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00047670: 656c 662e 6c6f 6620 3d20 6c6f 6361 7469  elf.lof = locati
-00047680: 6f6e 5f66 696e 6465 7228 290a 2020 2020  on_finder().    
-00047690: 2020 2020 7365 6c66 2e74 7365 7120 3d20      self.tseq = 
-000476a0: 2727 0a20 2020 2020 2020 2073 656c 662e  ''.        self.
-000476b0: 7073 6571 203d 2027 270a 2020 2020 2020  pseq = ''.      
-000476c0: 2020 7365 6c66 2e61 7365 7120 3d20 2727    self.aseq = ''
-000476d0: 0a0a 2020 2020 2020 2020 6966 2028 6774  ..        if (gt
-000476e0: 665f 6c69 6e65 735f 6f66 5f61 5f74 7220  f_lines_of_a_tr 
-000476f0: 6973 206e 6f74 204e 6f6e 6529 3a0a 2020  is not None):.  
-00047700: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00047710: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00047720: 2323 2323 230a 2020 2020 2020 2020 2020  #####.          
-00047730: 2020 2323 2320 5573 696e 6720 4754 4620    ### Using GTF 
-00047740: 6f6e 6c79 0a20 2020 2020 2020 2020 2020  only.           
-00047750: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
-00047760: 6466 203d 2070 642e 4461 7461 4672 616d  df = pd.DataFram
-00047770: 6528 6774 665f 6c69 6e65 735f 6f66 5f61  e(gtf_lines_of_a
-00047780: 5f74 7229 0a20 2020 2020 2020 2020 2020  _tr).           
-00047790: 2074 6e61 6d65 7320 3d20 6e70 2e61 7272   tnames = np.arr
-000477a0: 6179 2867 6574 5f63 6f6c 2867 7466 5f6c  ay(get_col(gtf_l
-000477b0: 696e 6573 5f6f 665f 615f 7472 2c20 5449  ines_of_a_tr, TI
-000477c0: 4429 290a 2020 2020 2020 2020 2020 2020  D)).            
-000477d0: 6269 6f74 7970 6573 203d 206e 702e 6172  biotypes = np.ar
-000477e0: 7261 7928 6765 745f 636f 6c28 6774 665f  ray(get_col(gtf_
-000477f0: 6c69 6e65 735f 6f66 5f61 5f74 722c 2042  lines_of_a_tr, B
-00047800: 494f 5459 5045 2929 0a20 2020 2020 2020  IOTYPE)).       
-00047810: 2020 2020 2066 6561 7475 7265 5f6c 7374       feature_lst
-00047820: 203d 2067 6574 5f63 6f6c 2867 7466 5f6c   = get_col(gtf_l
-00047830: 696e 6573 5f6f 665f 615f 7472 2c20 4645  ines_of_a_tr, FE
-00047840: 4154 5552 4529 0a20 2020 2020 2020 2020  ATURE).         
-00047850: 2020 2066 6561 7475 7265 7320 3d20 6e70     features = np
-00047860: 2e61 7272 6179 2866 6561 7475 7265 5f6c  .array(feature_l
-00047870: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
-00047880: 6368 726d 7320 3d20 6e70 2e61 7272 6179  chrms = np.array
-00047890: 2867 6574 5f63 6f6c 2867 7466 5f6c 696e  (get_col(gtf_lin
-000478a0: 6573 5f6f 665f 615f 7472 2c20 4348 5229  es_of_a_tr, CHR)
-000478b0: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
-000478c0: 7261 6e64 7320 3d20 6e70 2e61 7272 6179  rands = np.array
-000478d0: 2867 6574 5f63 6f6c 2867 7466 5f6c 696e  (get_col(gtf_lin
-000478e0: 6573 5f6f 665f 615f 7472 2c20 5354 5241  es_of_a_tr, STRA
-000478f0: 4e44 2929 0a20 2020 2020 2020 2020 2020  ND)).           
-00047900: 200a 2020 2020 2020 2020 2020 2020 2323   .            ##
-00047910: 2063 6865 636b 2069 6620 616c 6c20 7468   check if all th
-00047920: 6520 6c69 6e65 7320 6861 7665 2074 6865  e lines have the
-00047930: 2073 616d 6520 7469 640a 2020 2020 2020   same tid.      
-00047940: 2020 2020 2020 7472 5f6e 616d 6573 203d        tr_names =
-00047950: 206c 6973 7428 7365 7428 746e 616d 6573   list(set(tnames
-00047960: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00047970: 6966 206c 656e 2874 725f 6e61 6d65 7329  if len(tr_names)
-00047980: 2021 3d20 313a 0a20 2020 2020 2020 2020   != 1:.         
-00047990: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-000479a0: 2045 5252 4f52 2074 7261 6e73 6372 6970   ERROR transcrip
-000479b0: 745f 6465 7363 7269 7074 6f72 3a69 6e69  t_descriptor:ini
-000479c0: 743a 2025 6920 7472 5f69 6473 2720 2520  t: %i tr_ids' % 
-000479d0: 6c65 6e28 7472 5f6e 616d 6573 2929 0a20  len(tr_names)). 
-000479e0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-000479f0: 2020 2020 2020 2020 7365 6c66 2e67 6964          self.gid
-00047a00: 203d 2067 7466 5f6c 696e 6573 5f6f 665f   = gtf_lines_of_
-00047a10: 615f 7472 5b30 5d2e 6769 640a 2020 2020  a_tr[0].gid.    
-00047a20: 2020 2020 2020 2020 7365 6c66 2e67 6e61          self.gna
-00047a30: 6d65 203d 2067 7466 5f6c 696e 6573 5f6f  me = gtf_lines_o
-00047a40: 665f 615f 7472 5b30 5d2e 676e 616d 650a  f_a_tr[0].gname.
-00047a50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00047a60: 2e74 6964 203d 2067 7466 5f6c 696e 6573  .tid = gtf_lines
-00047a70: 5f6f 665f 615f 7472 5b30 5d2e 7469 640a  _of_a_tr[0].tid.
-00047a80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00047a90: 2e74 6e61 6d65 203d 2067 7466 5f6c 696e  .tname = gtf_lin
-00047aa0: 6573 5f6f 665f 615f 7472 5b30 5d2e 746e  es_of_a_tr[0].tn
-00047ab0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00047ac0: 7365 6c66 2e62 696f 7479 7065 203d 2067  self.biotype = g
-00047ad0: 7466 5f6c 696e 6573 5f6f 665f 615f 7472  tf_lines_of_a_tr
-00047ae0: 5b30 5d2e 6269 6f74 7970 650a 2020 2020  [0].biotype.    
-00047af0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00047b00: 2020 2020 2023 2320 6368 6563 6b20 6966       ## check if
-00047b10: 2061 6c6c 2074 6865 206c 696e 6573 2068   all the lines h
-00047b20: 6176 6520 7468 6520 7361 6d65 2074 6964  ave the same tid
-00047b30: 0a20 2020 2020 2020 2020 2020 2063 6872  .            chr
-00047b40: 7320 3d20 6c69 7374 2873 6574 2863 6872  s = list(set(chr
-00047b50: 6d73 2929 0a20 2020 2020 2020 2020 2020  ms)).           
-00047b60: 2069 6620 6c65 6e28 6368 7273 2920 213d   if len(chrs) !=
-00047b70: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00047b80: 2020 2020 7072 696e 7428 2720 2020 5741      print('   WA
-00047b90: 524e 494e 4720 7472 616e 7363 7269 7074  RNING transcript
-00047ba0: 5f64 6573 6372 6970 746f 723a 696e 6974  _descriptor:init
-00047bb0: 3a20 2569 2063 6872 7320 666f 756e 6420  : %i chrs found 
-00047bc0: 696e 2025 7327 2025 2028 6c65 6e28 6368  in %s' % (len(ch
-00047bd0: 7273 292c 2073 656c 662e 7469 6429 290a  rs), self.tid)).
-00047be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047bf0: 2320 7072 696e 7428 2720 2020 5468 6973  # print('   This
-00047c00: 206d 6179 2063 6175 7365 2075 6e65 7870   may cause unexp
-00047c10: 6563 7465 6420 7265 7375 6c74 7327 290a  ected results').
-00047c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047c30: 2320 7072 696e 7428 2720 2020 4675 7369  # print('   Fusi
-00047c40: 6f6e 2067 656e 6573 2061 7265 206e 6f74  on genes are not
-00047c50: 2063 6f6e 7369 6465 7265 6420 696e 2074   considered in t
-00047c60: 6865 2063 7572 7265 6e74 2076 6572 7369  he current versi
-00047c70: 6f6e 206f 6620 7374 7269 6e67 6669 7827  on of stringfix'
-00047c80: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00047c90: 656c 662e 6368 7220 3d20 6368 7273 5b30  elf.chr = chrs[0
-00047ca0: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
-00047cb0: 2020 2020 2020 2020 2020 2023 2320 6368             ## ch
-00047cc0: 6563 6b20 6966 2061 6c6c 2074 6865 206c  eck if all the l
-00047cd0: 696e 6573 2068 6176 6520 7468 6520 7361  ines have the sa
-00047ce0: 6d65 2074 6964 0a20 2020 2020 2020 2020  me tid.         
-00047cf0: 2020 2073 7472 6e64 7320 3d20 6c69 7374     strnds = list
-00047d00: 2873 6574 2873 7472 616e 6473 2929 0a20  (set(strands)). 
-00047d10: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00047d20: 6e28 7374 726e 6473 2920 213d 2031 3a0a  n(strnds) != 1:.
-00047d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047d40: 7072 696e 7428 2720 2020 4552 524f 5220  print('   ERROR 
-00047d50: 7472 616e 7363 7269 7074 5f64 6573 6372  transcript_descr
-00047d60: 6970 746f 723a 696e 6974 3a20 2569 2073  iptor:init: %i s
-00047d70: 7472 616e 6473 2720 2520 6c65 6e28 7374  trands' % len(st
-00047d80: 726e 6473 2929 0a20 2020 2020 2020 2020  rnds)).         
-00047d90: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00047da0: 6966 2073 7472 616e 6473 5b30 5d20 3d3d  if strands[0] ==
-00047db0: 2027 2b27 3a20 7365 6c66 2e69 7374 7261   '+': self.istra
-00047dc0: 6e64 203d 202b 310a 2020 2020 2020 2020  nd = +1.        
-00047dd0: 2020 2020 656c 6966 2073 7472 616e 6473      elif strands
-00047de0: 5b30 5d20 3d3d 2027 2d27 3a20 7365 6c66  [0] == '-': self
-00047df0: 2e69 7374 7261 6e64 203d 202d 310a 2020  .istrand = -1.  
-00047e00: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-00047e10: 7365 6c66 2e69 7374 7261 6e64 203d 2030  self.istrand = 0
-00047e20: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00047e30: 2020 2020 2020 2020 2020 2323 2043 6865            ## Che
-00047e40: 636b 2073 7461 7274 2f73 746f 7020 636f  ck start/stop co
-00047e50: 646f 6e0a 2020 2020 2020 2020 2020 2020  don.            
-00047e60: 0a20 2020 2020 2020 2020 2020 2077 6820  .            wh 
-00047e70: 3d20 7768 6963 6828 2866 6561 7475 7265  = which((feature
-00047e80: 7320 3d3d 2027 7374 6172 745f 636f 646f  s == 'start_codo
-00047e90: 6e27 2920 7c20 2866 6561 7475 7265 7320  n') | (features 
-00047ea0: 3d3d 2027 5354 4152 545f 434f 444f 4e27  == 'START_CODON'
-00047eb0: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
-00047ec0: 6620 6c65 6e28 7768 2920 3e20 303a 0a20  f len(wh) > 0:. 
-00047ed0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00047ee0: 203d 2077 685b 305d 0a20 2020 2020 2020   = wh[0].       
-00047ef0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00047f00: 6172 745f 636f 646f 6e5f 706f 735f 6f72  art_codon_pos_or
-00047f10: 6720 3d20 2867 7466 5f6c 696e 6573 5f6f  g = (gtf_lines_o
-00047f20: 665f 615f 7472 5b77 5d2e 7374 6172 742c  f_a_tr[w].start,
-00047f30: 2067 7466 5f6c 696e 6573 5f6f 665f 615f   gtf_lines_of_a_
-00047f40: 7472 5b77 5d2e 656e 6429 0a20 2020 2020  tr[w].end).     
-00047f50: 2020 2020 2020 2069 6620 6c65 6e28 7768         if len(wh
-00047f60: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
-00047f70: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-00047f80: 653a 2070 7269 6e74 2827 2020 2057 4152  e: print('   WAR
-00047f90: 4e49 4e47 2074 7261 6e73 6372 6970 745f  NING transcript_
-00047fa0: 6465 7363 7269 7074 6f72 3a69 6e69 743a  descriptor:init:
-00047fb0: 2025 6920 7374 6172 7420 636f 646f 6e73   %i start codons
-00047fc0: 2720 2520 6c65 6e28 7768 2929 0a20 2020  ' % len(wh)).   
-00047fd0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00047fe0: 2020 2020 2020 7768 203d 2077 6869 6368        wh = which
-00047ff0: 2828 6665 6174 7572 6573 203d 3d20 2773  ((features == 's
-00048000: 746f 705f 636f 646f 6e27 2920 7c20 2866  top_codon') | (f
-00048010: 6561 7475 7265 7320 3d3d 2027 5354 4f50  eatures == 'STOP
-00048020: 5f43 4f44 4f4e 2729 290a 2020 2020 2020  _CODON')).      
-00048030: 2020 2020 2020 6966 206c 656e 2877 6829        if len(wh)
-00048040: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-00048050: 2020 2020 2020 7720 3d20 7768 5b30 5d0a        w = wh[0].
-00048060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048070: 7365 6c66 2e73 746f 705f 636f 646f 6e5f  self.stop_codon_
-00048080: 706f 735f 6f72 6720 3d20 2867 7466 5f6c  pos_org = (gtf_l
-00048090: 696e 6573 5f6f 665f 615f 7472 5b77 5d2e  ines_of_a_tr[w].
-000480a0: 7374 6172 742c 2067 7466 5f6c 696e 6573  start, gtf_lines
-000480b0: 5f6f 665f 615f 7472 5b77 5d2e 656e 6429  _of_a_tr[w].end)
-000480c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000480d0: 6c65 6e28 7768 2920 3e20 313a 0a20 2020  len(wh) > 1:.   
-000480e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000480f0: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-00048100: 2020 2057 4152 4e49 4e47 2074 7261 6e73     WARNING trans
-00048110: 6372 6970 745f 6465 7363 7269 7074 6f72  cript_descriptor
-00048120: 3a69 6e69 743a 2025 6920 7374 6f70 2063  :init: %i stop c
-00048130: 6f64 6f6e 7327 2025 206c 656e 2877 6829  odons' % len(wh)
-00048140: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
-00048150: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00048160: 2020 2020 2020 2020 2020 2020 2323 2069              ## i
-00048170: 6e69 7469 616c 2073 7461 7274 2f73 746f  nitial start/sto
-00048180: 7020 706f 7369 7469 6f6e 2075 7369 6e67  p position using
-00048190: 2073 7461 7274 2f73 746f 7020 636f 646f   start/stop codo
-000481a0: 6e20 696e 666f 2e0a 2020 2020 2020 2020  n info..        
-000481b0: 2020 2020 7073 7461 7274 203d 202d 310a      pstart = -1.
-000481c0: 2020 2020 2020 2020 2020 2020 7073 746f              psto
-000481d0: 7020 3d20 2d31 0a20 2020 2020 2020 2020  p = -1.         
-000481e0: 2020 2066 6f72 2067 7466 6c20 696e 2067     for gtfl in g
-000481f0: 7466 5f6c 696e 6573 5f6f 665f 615f 7472  tf_lines_of_a_tr
-00048200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00048210: 2020 6966 2028 6774 666c 2e66 6561 7475    if (gtfl.featu
-00048220: 7265 203d 3d20 2773 7461 7274 5f63 6f64  re == 'start_cod
-00048230: 6f6e 2729 207c 2028 6774 666c 2e66 6561  on') | (gtfl.fea
-00048240: 7475 7265 203d 3d20 2753 5441 5254 5f43  ture == 'START_C
-00048250: 4f44 4f4e 2729 3a20 0a20 2020 2020 2020  ODON'): .       
-00048260: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00048270: 662e 7374 6172 745f 636f 646f 6e5f 706f  f.start_codon_po
-00048280: 735f 6f72 6720 3d20 2867 7466 6c2e 7374  s_org = (gtfl.st
-00048290: 6172 742c 2067 7466 6c2e 656e 6429 0a20  art, gtfl.end). 
-000482a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000482b0: 2020 2069 6620 7365 6c66 2e69 7374 7261     if self.istra
-000482c0: 6e64 203e 3d20 303a 0a20 2020 2020 2020  nd >= 0:.       
+00046b60: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00046b70: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00046b80: 635b 6b5d 203d 2062 0a0a 2020 2020 2020  c[k] = b..      
+00046b90: 2020 7265 7475 726e 2020 6e76 5f69 6e66    return  nv_inf
+00046ba0: 6f5f 6c73 742c 2070 726f 632c 2063 6e74  o_lst, proc, cnt
+00046bb0: 5f65 0a20 2020 200a 0a20 2020 2064 6566  _e.    ..    def
+00046bc0: 2067 6574 5f6f 7267 5f63 6f64 696e 675f   get_org_coding_
+00046bd0: 7365 7128 7365 6c66 2c20 6364 735f 7267  seq(self, cds_rg
+00046be0: 6e73 2c20 6765 6e6f 6d65 5f73 6571 293a  ns, genome_seq):
+00046bf0: 0a0a 2020 2020 2020 2020 7073 6571 203d  ..        pseq =
+00046c00: 2027 270a 2020 2020 2020 2020 6c6f 6620   ''.        lof 
+00046c10: 3d20 6c6f 6361 7469 6f6e 5f66 696e 6465  = location_finde
+00046c20: 7228 290a 2020 2020 2020 2020 0a20 2020  r().        .   
+00046c30: 2020 2020 2066 6f72 2069 2069 6e20 7365       for i in se
+00046c40: 6c66 2e74 635f 746f 5f67 635f 6d61 703a  lf.tc_to_gc_map:
+00046c50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00046c60: 2863 6473 5f72 676e 735b 695d 2e74 7970  (cds_rgns[i].typ
+00046c70: 652e 6c6f 7765 7228 2920 3d3d 2027 6364  e.lower() == 'cd
+00046c80: 7327 2920 7c20 2863 6473 5f72 676e 735b  s') | (cds_rgns[
+00046c90: 695d 2e74 7970 652e 6c6f 7765 7228 2920  i].type.lower() 
+00046ca0: 3d3d 2027 7374 6f70 5f63 6f64 6f6e 2729  == 'stop_codon')
+00046cb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00046cc0: 2020 6c6f 662e 6164 6428 2063 6473 5f72    lof.add( cds_r
+00046cd0: 676e 735b 695d 2e73 7461 7274 2c20 6364  gns[i].start, cd
+00046ce0: 735f 7267 6e73 5b69 5d2e 656e 642c 206c  s_rgns[i].end, l
+00046cf0: 656e 2870 7365 7129 290a 2020 2020 2020  en(pseq)).      
+00046d00: 2020 2020 2020 2020 2020 7073 6571 203d            pseq =
+00046d10: 2070 7365 7120 2b20 6765 6e6f 6d65 5f73   pseq + genome_s
+00046d20: 6571 5b20 2863 6473 5f72 676e 735b 695d  eq[ (cds_rgns[i]
+00046d30: 2e73 7461 7274 2d31 293a 6364 735f 7267  .start-1):cds_rg
+00046d40: 6e73 5b69 5d2e 656e 6420 5d0a 2020 2020  ns[i].end ].    
+00046d50: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00046d60: 2020 2020 2073 656c 662e 7073 6571 203d       self.pseq =
+00046d70: 2070 7365 710a 2020 2020 2020 2020 7365   pseq.        se
+00046d80: 6c66 2e6c 6f66 203d 206c 6f66 0a0a 2020  lf.lof = lof..  
+00046d90: 2020 0a20 2020 2064 6566 2067 6574 5f74    .    def get_t
+00046da0: 7261 6e73 6372 6970 745f 7475 706c 6528  ranscript_tuple(
+00046db0: 7365 6c66 293a 0a20 2020 2020 2020 200a  self):.        .
+00046dc0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00046dd0: 7261 6e73 6372 6970 7428 7365 6c66 2e70  ranscript(self.p
+00046de0: 7265 6669 782c 2073 656c 662e 6769 642c  refix, self.gid,
+00046df0: 2073 656c 662e 6772 705f 7369 7a65 2c20   self.grp_size, 
+00046e00: 7365 6c66 2e69 636e 742c 2073 656c 662e  self.icnt, self.
+00046e10: 6368 722c 2073 656c 662e 6265 6769 6e2c  chr, self.begin,
+00046e20: 2073 656c 662e 656e 642c 205c 0a20 2020   self.end, \.   
+00046e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046e40: 2020 2020 2020 2067 6574 5f63 5f66 726f         get_c_fro
+00046e50: 6d5f 6973 7472 616e 6428 7365 6c66 2e69  m_istrand(self.i
+00046e60: 7374 7261 6e64 292c 2067 6574 5f73 7472  strand), get_str
+00046e70: 5f66 726f 6d5f 6963 646e 6728 7365 6c66  _from_icdng(self
+00046e80: 2e69 6364 7329 2c20 7365 6c66 2e74 7365  .icds), self.tse
+00046e90: 712c 205c 0a20 2020 2020 2020 2020 2020  q, \.           
+00046ea0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00046eb0: 656c 662e 6162 6e2c 2073 656c 662e 7470  elf.abn, self.tp
+00046ec0: 6d2c 2073 656c 662e 6973 6f5f 6672 6163  m, self.iso_frac
+00046ed0: 2c20 7365 6c66 2e70 726f 622c 2073 656c  , self.prob, sel
+00046ee0: 662e 6e65 786f 6e73 2c20 7365 6c66 2e67  f.nexons, self.g
+00046ef0: 766f 6c29 0a0a 2020 2020 6465 6620 5f5f  vol)..    def __
+00046f00: 696e 6974 5f5f 2873 656c 662c 2067 7466  init__(self, gtf
+00046f10: 5f6c 696e 6573 5f6f 665f 615f 7472 203d  _lines_of_a_tr =
+00046f20: 204e 6f6e 652c 2065 786f 6e5f 7267 6e73   None, exon_rgns
+00046f30: 203d 204e 6f6e 652c 2063 6473 5f72 676e   = None, cds_rgn
+00046f40: 7320 3d20 4e6f 6e65 2c20 6765 6e6f 6d65  s = None, genome
+00046f50: 203d 204e 6f6e 652c 205c 0a20 2020 2020   = None, \.     
+00046f60: 2020 2020 2020 2020 2020 2020 6364 7320              cds 
+00046f70: 3d20 2d31 2c20 6669 6c6c 203d 2046 616c  = -1, fill = Fal
+00046f80: 7365 2c20 7665 7262 6f73 6520 3d20 4661  se, verbose = Fa
+00046f90: 6c73 6529 3a0a 200a 2020 2020 2020 2020  lse):. .        
+00046fa0: 2320 7365 6c66 2e67 7466 5f6c 696e 6573  # self.gtf_lines
+00046fb0: 203d 2067 7466 5f6c 696e 6573 5f6f 665f   = gtf_lines_of_
+00046fc0: 615f 7472 0a20 2020 2020 2020 2073 656c  a_tr.        sel
+00046fd0: 662e 6368 7220 3d20 2727 0a20 2020 2020  f.chr = ''.     
+00046fe0: 2020 2073 656c 662e 6265 6769 6e20 3d20     self.begin = 
+00046ff0: 2d31 2020 2020 2020 2323 2031 2d62 6173  -1      ## 1-bas
+00047000: 650a 2020 2020 2020 2020 7365 6c66 2e65  e.        self.e
+00047010: 6e64 203d 202d 3120 2020 2020 2020 2023  nd = -1        #
+00047020: 2320 312d 6261 7365 0a20 2020 2020 2020  # 1-base.       
+00047030: 200a 2020 2020 2020 2020 7365 6c66 2e67   .        self.g
+00047040: 6964 203d 2027 270a 2020 2020 2020 2020  id = ''.        
+00047050: 7365 6c66 2e67 6e61 6d65 203d 2027 270a  self.gname = ''.
+00047060: 2020 2020 2020 2020 7365 6c66 2e74 6964          self.tid
+00047070: 203d 2027 270a 2020 2020 2020 2020 7365   = ''.        se
+00047080: 6c66 2e74 6e61 6d65 203d 2027 270a 2020  lf.tname = ''.  
+00047090: 2020 2020 2020 7365 6c66 2e62 696f 7479        self.bioty
+000470a0: 7065 203d 2027 270a 2020 2020 2020 2020  pe = ''.        
+000470b0: 7365 6c66 2e69 7374 7261 6e64 203d 2030  self.istrand = 0
+000470c0: 0a20 2020 2020 2020 2073 656c 662e 6963  .        self.ic
+000470d0: 6473 203d 2063 6473 2020 2020 2020 2023  ds = cds       #
+000470e0: 2320 2d31 3a20 756e 7370 6563 6966 6965  # -1: unspecifie
+000470f0: 642c 2030 3a20 6e6f 6e2d 636f 6469 6e67  d, 0: non-coding
+00047100: 2c20 313a 2063 6f64 696e 670a 2020 2020  , 1: coding.    
+00047110: 2020 2020 0a20 2020 2020 2020 2023 2320      .        ## 
+00047120: 7573 6564 2069 6e20 7464 5f61 6e64 5f61  used in td_and_a
+00047130: 650a 2020 2020 2020 2020 7365 6c66 2e74  e.        self.t
+00047140: 655f 746f 5f67 655f 6d61 7020 3d20 5b5d  e_to_ge_map = []
+00047150: 0a20 2020 2020 2020 2073 656c 662e 7463  .        self.tc
+00047160: 5f74 6f5f 6763 5f6d 6170 203d 205b 5d0a  _to_gc_map = [].
+00047170: 2020 2020 2020 2020 7365 6c66 2e74 725f          self.tr_
+00047180: 746f 5f67 725f 6d61 7020 3d20 5b5d 0a20  to_gr_map = []. 
+00047190: 2020 2020 2020 2073 656c 662e 6162 6e20         self.abn 
+000471a0: 3d20 300a 2020 2020 2020 2020 7365 6c66  = 0.        self
+000471b0: 2e63 6f76 203d 2030 0a20 2020 2020 2020  .cov = 0.       
+000471c0: 2073 656c 662e 746c 656e 203d 202d 310a   self.tlen = -1.
+000471d0: 2020 2020 2020 2020 7365 6c66 2e70 6c65          self.ple
+000471e0: 6e20 3d20 2d31 0a20 2020 2020 2020 200a  n = -1.        .
+000471f0: 2020 2020 2020 2020 7365 6c66 2e63 6f76          self.cov
+00047200: 5f6c 656e 203d 2030 0a20 2020 2020 2020  _len = 0.       
+00047210: 2073 656c 662e 636f 765f 7261 7469 6f20   self.cov_ratio 
+00047220: 3d20 300a 0a20 2020 2020 2020 2023 2320  = 0..        ## 
+00047230: 5465 6d70 6f72 6172 7920 7661 7269 6162  Temporary variab
+00047240: 6c65 730a 2020 2020 2020 2020 7365 6c66  les.        self
+00047250: 2e70 7265 6669 7820 3d20 2758 270a 2020  .prefix = 'X'.  
+00047260: 2020 2020 2020 7365 6c66 2e70 726f 6220        self.prob 
+00047270: 3d20 300a 2020 2020 2020 2020 7365 6c66  = 0.        self
+00047280: 2e67 766f 6c20 3d20 300a 2020 2020 2020  .gvol = 0.      
+00047290: 2020 7365 6c66 2e6e 6578 6f6e 7320 3d20    self.nexons = 
+000472a0: 300a 2020 2020 2020 2020 7365 6c66 2e6c  0.        self.l
+000472b0: 656e 5f6f 7320 3d20 2d31 0a20 2020 2020  en_os = -1.     
+000472c0: 2020 2073 656c 662e 706f 735f 7374 6172     self.pos_star
+000472d0: 7420 3d20 2d31 2020 2323 2030 2d62 6173  t = -1  ## 0-bas
+000472e0: 650a 2020 2020 2020 2020 7365 6c66 2e70  e.        self.p
+000472f0: 6f73 5f73 746f 7020 3d20 2d31 2020 2023  os_stop = -1   #
+00047300: 2320 302d 6261 7365 0a20 2020 2020 2020  # 0-base.       
+00047310: 200a 2020 2020 2020 2020 2323 2054 7220   .        ## Tr 
+00047320: 696e 666f 0a20 2020 2020 2020 2073 656c  info.        sel
+00047330: 662e 7470 6d20 3d20 2d31 0a20 2020 2020  f.tpm = -1.     
+00047340: 2020 2073 656c 662e 6963 6e74 203d 202d     self.icnt = -
+00047350: 310a 2020 2020 2020 2020 7365 6c66 2e67  1.        self.g
+00047360: 7270 5f73 697a 6520 3d20 2d31 0a20 2020  rp_size = -1.   
+00047370: 2020 2020 2073 656c 662e 6973 6f5f 6672       self.iso_fr
+00047380: 6163 203d 202d 310a 0a20 2020 2020 2020  ac = -1..       
+00047390: 2023 2320 436f 646f 6e20 706f 7320 616e   ## Codon pos an
+000473a0: 6420 7374 6174 7573 0a20 2020 2020 2020  d status.       
+000473b0: 2073 656c 662e 7374 6172 745f 636f 646f   self.start_codo
+000473c0: 6e5f 706f 735f 6f72 6720 3d20 282d 312c  n_pos_org = (-1,
+000473d0: 2d31 290a 2020 2020 2020 2020 7365 6c66  -1).        self
+000473e0: 2e73 746f 705f 636f 646f 6e5f 706f 735f  .stop_codon_pos_
+000473f0: 6f72 6720 3d20 282d 312c 2d31 290a 2020  org = (-1,-1).  
+00047400: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
+00047410: 656c 662e 7374 6172 745f 636f 646f 6e5f  elf.start_codon_
+00047420: 6576 656e 7420 3d20 2d31 0a20 2020 2020  event = -1.     
+00047430: 2020 2073 656c 662e 7374 6f70 5f63 6f64     self.stop_cod
+00047440: 6f6e 5f65 7665 6e74 203d 202d 310a 2020  on_event = -1.  
+00047450: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
+00047460: 656c 662e 7374 6172 745f 636f 646f 6e5f  elf.start_codon_
+00047470: 706f 7320 3d20 282d 312c 2d31 290a 2020  pos = (-1,-1).  
+00047480: 2020 2020 2020 7365 6c66 2e73 746f 705f        self.stop_
+00047490: 636f 646f 6e5f 706f 7320 3d20 282d 312c  codon_pos = (-1,
+000474a0: 2d31 290a 0a20 2020 2020 2020 2073 656c  -1)..        sel
+000474b0: 662e 7374 6172 745f 636f 646f 6e5f 7374  f.start_codon_st
+000474c0: 6174 7573 203d 202d 310a 2020 2020 2020  atus = -1.      
+000474d0: 2020 7365 6c66 2e73 746f 705f 636f 646f    self.stop_codo
+000474e0: 6e5f 7374 6174 7573 203d 202d 310a 2020  n_status = -1.  
+000474f0: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00047500: 2320 6669 6c6c 6564 2077 6974 6820 6765  # filled with ge
+00047510: 745f 7365 715f 6672 6f6d 5f65 786f 6e73  t_seq_from_exons
+00047520: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00047530: 6c6f 6620 3d20 4e6f 6e65 0a20 2020 2020  lof = None.     
+00047540: 2020 2069 6620 6765 6e6f 6d65 2069 7320     if genome is 
+00047550: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00047560: 2020 2020 2020 7365 6c66 2e6c 6f66 203d        self.lof =
+00047570: 206c 6f63 6174 696f 6e5f 6669 6e64 6572   location_finder
+00047580: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00047590: 7473 6571 203d 2027 270a 2020 2020 2020  tseq = ''.      
+000475a0: 2020 7365 6c66 2e70 7365 7120 3d20 2727    self.pseq = ''
+000475b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000475c0: 6571 203d 2027 270a 0a20 2020 2020 2020  eq = ''..       
+000475d0: 2069 6620 2867 7466 5f6c 696e 6573 5f6f   if (gtf_lines_o
+000475e0: 665f 615f 7472 2069 7320 6e6f 7420 4e6f  f_a_tr is not No
+000475f0: 6e65 293a 0a20 2020 2020 2020 200a 2020  ne):.        .  
+00047600: 2020 2020 2020 2020 2020 2323 2323 2323            ######
+00047610: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00047620: 2020 2020 2020 2020 2023 2323 2055 7369           ### Usi
+00047630: 6e67 2047 5446 206f 6e6c 790a 2020 2020  ng GTF only.    
+00047640: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00047650: 2020 2020 2023 2064 6620 3d20 7064 2e44       # df = pd.D
+00047660: 6174 6146 7261 6d65 2867 7466 5f6c 696e  ataFrame(gtf_lin
+00047670: 6573 5f6f 665f 615f 7472 290a 2020 2020  es_of_a_tr).    
+00047680: 2020 2020 2020 2020 746e 616d 6573 203d          tnames =
+00047690: 206e 702e 6172 7261 7928 6765 745f 636f   np.array(get_co
+000476a0: 6c28 6774 665f 6c69 6e65 735f 6f66 5f61  l(gtf_lines_of_a
+000476b0: 5f74 722c 2054 4944 2929 0a20 2020 2020  _tr, TID)).     
+000476c0: 2020 2020 2020 2062 696f 7479 7065 7320         biotypes 
+000476d0: 3d20 6e70 2e61 7272 6179 2867 6574 5f63  = np.array(get_c
+000476e0: 6f6c 2867 7466 5f6c 696e 6573 5f6f 665f  ol(gtf_lines_of_
+000476f0: 615f 7472 2c20 4249 4f54 5950 4529 290a  a_tr, BIOTYPE)).
+00047700: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+00047710: 7572 655f 6c73 7420 3d20 6765 745f 636f  ure_lst = get_co
+00047720: 6c28 6774 665f 6c69 6e65 735f 6f66 5f61  l(gtf_lines_of_a
+00047730: 5f74 722c 2046 4541 5455 5245 290a 2020  _tr, FEATURE).  
+00047740: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+00047750: 6573 203d 206e 702e 6172 7261 7928 6665  es = np.array(fe
+00047760: 6174 7572 655f 6c73 7429 0a20 2020 2020  ature_lst).     
+00047770: 2020 2020 2020 2063 6872 6d73 203d 206e         chrms = n
+00047780: 702e 6172 7261 7928 6765 745f 636f 6c28  p.array(get_col(
+00047790: 6774 665f 6c69 6e65 735f 6f66 5f61 5f74  gtf_lines_of_a_t
+000477a0: 722c 2043 4852 2929 0a20 2020 2020 2020  r, CHR)).       
+000477b0: 2020 2020 2073 7472 616e 6473 203d 206e       strands = n
+000477c0: 702e 6172 7261 7928 6765 745f 636f 6c28  p.array(get_col(
+000477d0: 6774 665f 6c69 6e65 735f 6f66 5f61 5f74  gtf_lines_of_a_t
+000477e0: 722c 2053 5452 414e 4429 290a 2020 2020  r, STRAND)).    
+000477f0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00047800: 2020 2020 2023 2320 6368 6563 6b20 6966       ## check if
+00047810: 2061 6c6c 2074 6865 206c 696e 6573 2068   all the lines h
+00047820: 6176 6520 7468 6520 7361 6d65 2074 6964  ave the same tid
+00047830: 0a20 2020 2020 2020 2020 2020 2074 725f  .            tr_
+00047840: 6e61 6d65 7320 3d20 6c69 7374 2873 6574  names = list(set
+00047850: 2874 6e61 6d65 7329 290a 0a20 2020 2020  (tnames))..     
+00047860: 2020 2020 2020 2069 6620 6c65 6e28 7472         if len(tr
+00047870: 5f6e 616d 6573 2920 213d 2031 3a0a 2020  _names) != 1:.  
+00047880: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00047890: 696e 7428 2720 2020 4552 524f 5220 7472  int('   ERROR tr
+000478a0: 616e 7363 7269 7074 5f64 6573 6372 6970  anscript_descrip
+000478b0: 746f 723a 696e 6974 3a20 2569 2074 725f  tor:init: %i tr_
+000478c0: 6964 7327 2025 206c 656e 2874 725f 6e61  ids' % len(tr_na
+000478d0: 6d65 7329 290a 2020 2020 2020 2020 2020  mes)).          
+000478e0: 2020 0a20 2020 2020 2020 2020 2020 2073    .            s
+000478f0: 656c 662e 6769 6420 3d20 6774 665f 6c69  elf.gid = gtf_li
+00047900: 6e65 735f 6f66 5f61 5f74 725b 305d 2e67  nes_of_a_tr[0].g
+00047910: 6964 0a20 2020 2020 2020 2020 2020 2073  id.            s
+00047920: 656c 662e 676e 616d 6520 3d20 6774 665f  elf.gname = gtf_
+00047930: 6c69 6e65 735f 6f66 5f61 5f74 725b 305d  lines_of_a_tr[0]
+00047940: 2e67 6e61 6d65 0a20 2020 2020 2020 2020  .gname.         
+00047950: 2020 2073 656c 662e 7469 6420 3d20 6774     self.tid = gt
+00047960: 665f 6c69 6e65 735f 6f66 5f61 5f74 725b  f_lines_of_a_tr[
+00047970: 305d 2e74 6964 0a20 2020 2020 2020 2020  0].tid.         
+00047980: 2020 2073 656c 662e 746e 616d 6520 3d20     self.tname = 
+00047990: 6774 665f 6c69 6e65 735f 6f66 5f61 5f74  gtf_lines_of_a_t
+000479a0: 725b 305d 2e74 6e61 6d65 0a20 2020 2020  r[0].tname.     
+000479b0: 2020 2020 2020 2073 656c 662e 6269 6f74         self.biot
+000479c0: 7970 6520 3d20 6774 665f 6c69 6e65 735f  ype = gtf_lines_
+000479d0: 6f66 5f61 5f74 725b 305d 2e62 696f 7479  of_a_tr[0].bioty
+000479e0: 7065 0a20 2020 2020 2020 2020 2020 200a  pe.            .
+000479f0: 2020 2020 2020 2020 2020 2020 2323 2063              ## c
+00047a00: 6865 636b 2069 6620 616c 6c20 7468 6520  heck if all the 
+00047a10: 6c69 6e65 7320 6861 7665 2074 6865 2073  lines have the s
+00047a20: 616d 6520 7469 640a 2020 2020 2020 2020  ame tid.        
+00047a30: 2020 2020 6368 7273 203d 206c 6973 7428      chrs = list(
+00047a40: 7365 7428 6368 726d 7329 290a 2020 2020  set(chrms)).    
+00047a50: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+00047a60: 6872 7329 2021 3d20 313a 0a20 2020 2020  hrs) != 1:.     
+00047a70: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00047a80: 2827 2020 2057 4152 4e49 4e47 2074 7261  ('   WARNING tra
+00047a90: 6e73 6372 6970 745f 6465 7363 7269 7074  nscript_descript
+00047aa0: 6f72 3a69 6e69 743a 2025 6920 6368 7273  or:init: %i chrs
+00047ab0: 2066 6f75 6e64 2069 6e20 2573 2720 2520   found in %s' % 
+00047ac0: 286c 656e 2863 6872 7329 2c20 7365 6c66  (len(chrs), self
+00047ad0: 2e74 6964 2929 0a20 2020 2020 2020 2020  .tid)).         
+00047ae0: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+00047af0: 2020 2054 6869 7320 6d61 7920 6361 7573     This may caus
+00047b00: 6520 756e 6578 7065 6374 6564 2072 6573  e unexpected res
+00047b10: 756c 7473 2729 0a20 2020 2020 2020 2020  ults').         
+00047b20: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+00047b30: 2020 2046 7573 696f 6e20 6765 6e65 7320     Fusion genes 
+00047b40: 6172 6520 6e6f 7420 636f 6e73 6964 6572  are not consider
+00047b50: 6564 2069 6e20 7468 6520 6375 7272 656e  ed in the curren
+00047b60: 7420 7665 7273 696f 6e20 6f66 2073 7472  t version of str
+00047b70: 696e 6766 6978 2729 0a0a 2020 2020 2020  ingfix')..      
+00047b80: 2020 2020 2020 7365 6c66 2e63 6872 203d        self.chr =
+00047b90: 2063 6872 735b 305d 0a20 2020 2020 2020   chrs[0].       
+00047ba0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00047bb0: 2020 2323 2063 6865 636b 2069 6620 616c    ## check if al
+00047bc0: 6c20 7468 6520 6c69 6e65 7320 6861 7665  l the lines have
+00047bd0: 2074 6865 2073 616d 6520 7469 640a 2020   the same tid.  
+00047be0: 2020 2020 2020 2020 2020 7374 726e 6473            strnds
+00047bf0: 203d 206c 6973 7428 7365 7428 7374 7261   = list(set(stra
+00047c00: 6e64 7329 290a 2020 2020 2020 2020 2020  nds)).          
+00047c10: 2020 6966 206c 656e 2873 7472 6e64 7329    if len(strnds)
+00047c20: 2021 3d20 313a 0a20 2020 2020 2020 2020   != 1:.         
+00047c30: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+00047c40: 2045 5252 4f52 2074 7261 6e73 6372 6970   ERROR transcrip
+00047c50: 745f 6465 7363 7269 7074 6f72 3a69 6e69  t_descriptor:ini
+00047c60: 743a 2025 6920 7374 7261 6e64 7327 2025  t: %i strands' %
+00047c70: 206c 656e 2873 7472 6e64 7329 290a 2020   len(strnds)).  
+00047c80: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00047c90: 2020 2020 2020 2069 6620 7374 7261 6e64         if strand
+00047ca0: 735b 305d 203d 3d20 272b 273a 2073 656c  s[0] == '+': sel
+00047cb0: 662e 6973 7472 616e 6420 3d20 2b31 0a20  f.istrand = +1. 
+00047cc0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00047cd0: 7374 7261 6e64 735b 305d 203d 3d20 272d  strands[0] == '-
+00047ce0: 273a 2073 656c 662e 6973 7472 616e 6420  ': self.istrand 
+00047cf0: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+00047d00: 2065 6c73 653a 2073 656c 662e 6973 7472   else: self.istr
+00047d10: 616e 6420 3d20 300a 2020 2020 2020 2020  and = 0.        
+00047d20: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00047d30: 2023 2320 4368 6563 6b20 7374 6172 742f   ## Check start/
+00047d40: 7374 6f70 2063 6f64 6f6e 0a20 2020 2020  stop codon.     
+00047d50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00047d60: 2020 2020 7768 203d 2077 6869 6368 2828      wh = which((
+00047d70: 6665 6174 7572 6573 203d 3d20 2773 7461  features == 'sta
+00047d80: 7274 5f63 6f64 6f6e 2729 207c 2028 6665  rt_codon') | (fe
+00047d90: 6174 7572 6573 203d 3d20 2753 5441 5254  atures == 'START
+00047da0: 5f43 4f44 4f4e 2729 290a 2020 2020 2020  _CODON')).      
+00047db0: 2020 2020 2020 6966 206c 656e 2877 6829        if len(wh)
+00047dc0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00047dd0: 2020 2020 2020 7720 3d20 7768 5b30 5d0a        w = wh[0].
+00047de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047df0: 7365 6c66 2e73 7461 7274 5f63 6f64 6f6e  self.start_codon
+00047e00: 5f70 6f73 5f6f 7267 203d 2028 6774 665f  _pos_org = (gtf_
+00047e10: 6c69 6e65 735f 6f66 5f61 5f74 725b 775d  lines_of_a_tr[w]
+00047e20: 2e73 7461 7274 2c20 6774 665f 6c69 6e65  .start, gtf_line
+00047e30: 735f 6f66 5f61 5f74 725b 775d 2e65 6e64  s_of_a_tr[w].end
+00047e40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00047e50: 206c 656e 2877 6829 203e 2031 3a0a 2020   len(wh) > 1:.  
+00047e60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00047e70: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
+00047e80: 2720 2020 5741 524e 494e 4720 7472 616e  '   WARNING tran
+00047e90: 7363 7269 7074 5f64 6573 6372 6970 746f  script_descripto
+00047ea0: 723a 696e 6974 3a20 2569 2073 7461 7274  r:init: %i start
+00047eb0: 2063 6f64 6f6e 7327 2025 206c 656e 2877   codons' % len(w
+00047ec0: 6829 290a 2020 2020 2020 2020 2020 2020  h)).            
+00047ed0: 0a20 2020 2020 2020 2020 2020 2077 6820  .            wh 
+00047ee0: 3d20 7768 6963 6828 2866 6561 7475 7265  = which((feature
+00047ef0: 7320 3d3d 2027 7374 6f70 5f63 6f64 6f6e  s == 'stop_codon
+00047f00: 2729 207c 2028 6665 6174 7572 6573 203d  ') | (features =
+00047f10: 3d20 2753 544f 505f 434f 444f 4e27 2929  = 'STOP_CODON'))
+00047f20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00047f30: 6c65 6e28 7768 2920 3e20 303a 0a20 2020  len(wh) > 0:.   
+00047f40: 2020 2020 2020 2020 2020 2020 2077 203d               w =
+00047f50: 2077 685b 305d 0a20 2020 2020 2020 2020   wh[0].         
+00047f60: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
+00047f70: 5f63 6f64 6f6e 5f70 6f73 5f6f 7267 203d  _codon_pos_org =
+00047f80: 2028 6774 665f 6c69 6e65 735f 6f66 5f61   (gtf_lines_of_a
+00047f90: 5f74 725b 775d 2e73 7461 7274 2c20 6774  _tr[w].start, gt
+00047fa0: 665f 6c69 6e65 735f 6f66 5f61 5f74 725b  f_lines_of_a_tr[
+00047fb0: 775d 2e65 6e64 290a 2020 2020 2020 2020  w].end).        
+00047fc0: 2020 2020 6966 206c 656e 2877 6829 203e      if len(wh) >
+00047fd0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00047fe0: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+00047ff0: 7072 696e 7428 2720 2020 5741 524e 494e  print('   WARNIN
+00048000: 4720 7472 616e 7363 7269 7074 5f64 6573  G transcript_des
+00048010: 6372 6970 746f 723a 696e 6974 3a20 2569  criptor:init: %i
+00048020: 2073 746f 7020 636f 646f 6e73 2720 2520   stop codons' % 
+00048030: 6c65 6e28 7768 2929 0a20 2020 2020 2020  len(wh)).       
+00048040: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00048050: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+00048060: 2020 2023 2320 696e 6974 6961 6c20 7374     ## initial st
+00048070: 6172 742f 7374 6f70 2070 6f73 6974 696f  art/stop positio
+00048080: 6e20 7573 696e 6720 7374 6172 742f 7374  n using start/st
+00048090: 6f70 2063 6f64 6f6e 2069 6e66 6f2e 0a20  op codon info.. 
+000480a0: 2020 2020 2020 2020 2020 2070 7374 6172             pstar
+000480b0: 7420 3d20 2d31 0a20 2020 2020 2020 2020  t = -1.         
+000480c0: 2020 2070 7374 6f70 203d 202d 310a 2020     pstop = -1.  
+000480d0: 2020 2020 2020 2020 2020 666f 7220 6774            for gt
+000480e0: 666c 2069 6e20 6774 665f 6c69 6e65 735f  fl in gtf_lines_
+000480f0: 6f66 5f61 5f74 723a 0a20 2020 2020 2020  of_a_tr:.       
+00048100: 2020 2020 2020 2020 2069 6620 2867 7466           if (gtf
+00048110: 6c2e 6665 6174 7572 6520 3d3d 2027 7374  l.feature == 'st
+00048120: 6172 745f 636f 646f 6e27 2920 7c20 2867  art_codon') | (g
+00048130: 7466 6c2e 6665 6174 7572 6520 3d3d 2027  tfl.feature == '
+00048140: 5354 4152 545f 434f 444f 4e27 293a 200a  START_CODON'): .
+00048150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048160: 2020 2020 7365 6c66 2e73 7461 7274 5f63      self.start_c
+00048170: 6f64 6f6e 5f70 6f73 5f6f 7267 203d 2028  odon_pos_org = (
+00048180: 6774 666c 2e73 7461 7274 2c20 6774 666c  gtfl.start, gtfl
+00048190: 2e65 6e64 290a 2020 2020 2020 2020 2020  .end).          
+000481a0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000481b0: 662e 6973 7472 616e 6420 3e3d 2030 3a0a  f.istrand >= 0:.
+000481c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000481d0: 2020 2020 2020 2020 7073 7461 7274 203d          pstart =
+000481e0: 2067 7466 6c2e 7374 6172 742d 310a 2020   gtfl.start-1.  
+000481f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048200: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00048210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048220: 7073 7461 7274 203d 2067 7466 6c2e 656e  pstart = gtfl.en
+00048230: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+00048240: 2020 656c 6966 2028 6774 666c 2e66 6561    elif (gtfl.fea
+00048250: 7475 7265 203d 3d20 2773 746f 705f 636f  ture == 'stop_co
+00048260: 646f 6e27 2920 7c20 2867 7466 6c2e 6665  don') | (gtfl.fe
+00048270: 6174 7572 6520 3d3d 2027 5354 4f50 5f43  ature == 'STOP_C
+00048280: 4f44 4f4e 2729 3a20 0a20 2020 2020 2020  ODON'): .       
+00048290: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000482a0: 662e 7374 6f70 5f63 6f64 6f6e 5f70 6f73  f.stop_codon_pos
+000482b0: 5f6f 7267 203d 2028 6774 666c 2e73 7461  _org = (gtfl.sta
+000482c0: 7274 2c20 6774 666c 2e65 6e64 290a 2020  rt, gtfl.end).  
 000482d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000482e0: 2070 7374 6172 7420 3d20 6774 666c 2e73   pstart = gtfl.s
-000482f0: 7461 7274 2d31 0a20 2020 2020 2020 2020  tart-1.         
-00048300: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00048310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048320: 2020 2020 2020 2020 2070 7374 6172 7420           pstart 
-00048330: 3d20 6774 666c 2e65 6e64 0a20 2020 2020  = gtfl.end.     
-00048340: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00048350: 2867 7466 6c2e 6665 6174 7572 6520 3d3d  (gtfl.feature ==
-00048360: 2027 7374 6f70 5f63 6f64 6f6e 2729 207c   'stop_codon') |
-00048370: 2028 6774 666c 2e66 6561 7475 7265 203d   (gtfl.feature =
-00048380: 3d20 2753 544f 505f 434f 444f 4e27 293a  = 'STOP_CODON'):
-00048390: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000483a0: 2020 2020 2020 7365 6c66 2e73 746f 705f        self.stop_
-000483b0: 636f 646f 6e5f 706f 735f 6f72 6720 3d20  codon_pos_org = 
-000483c0: 2867 7466 6c2e 7374 6172 742c 2067 7466  (gtfl.start, gtf
-000483d0: 6c2e 656e 6429 0a20 2020 2020 2020 2020  l.end).         
-000483e0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000483f0: 6c66 2e69 7374 7261 6e64 203e 3d20 303a  lf.istrand >= 0:
-00048400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048410: 2020 2020 2020 2020 2070 7374 6f70 203d           pstop =
-00048420: 2067 7466 6c2e 7374 6172 742d 310a 2020   gtfl.start-1.  
-00048430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048440: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00048450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048460: 7073 746f 7020 3d20 6774 666c 2e65 6e64  pstop = gtfl.end
-00048470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048480: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00048490: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-000484a0: 2020 2020 2020 2023 2320 7374 6172 742f         ## start/
-000484b0: 7374 6f70 2070 6f73 6974 696f 6e20 7573  stop position us
-000484c0: 696e 6720 7374 6172 742f 7374 6f70 2063  ing start/stop c
-000484d0: 6f64 6f6e 2069 6e66 6f2e 0a20 2020 2020  odon info..     
-000484e0: 2020 2020 2020 2023 2073 656c 662e 6578         # self.ex
-000484f0: 6f6e 7320 3d20 7265 6769 6f6e 7328 290a  ons = regions().
-00048500: 2020 2020 2020 2020 2020 2020 2320 7365              # se
-00048510: 6c66 2e63 6473 203d 2072 6567 696f 6e73  lf.cds = regions
-00048520: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
-00048530: 636e 7420 3d20 300a 2020 2020 2020 2020  cnt = 0.        
-00048540: 2020 2020 745f 6c65 6e20 3d20 300a 2020      t_len = 0.  
-00048550: 2020 2020 2020 2020 2020 705f 6c65 6e20            p_len 
-00048560: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00048570: 7374 6172 7420 3d20 2d31 0a20 2020 2020  start = -1.     
-00048580: 2020 2020 2020 2073 746f 7020 3d20 2d31         stop = -1
-00048590: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-000485a0: 745f 706f 7320 3d20 300a 2020 2020 2020  t_pos = 0.      
-000485b0: 2020 2020 2020 666f 7220 6774 666c 2069        for gtfl i
-000485c0: 6e20 6774 665f 6c69 6e65 735f 6f66 5f61  n gtf_lines_of_a
-000485d0: 5f74 723a 0a20 2020 2020 2020 2020 2020  _tr:.           
-000485e0: 2020 2020 2070 6f73 5f73 7461 7274 203d       pos_start =
-000485f0: 2067 7466 6c2e 7374 6172 742d 310a 2020   gtfl.start-1.  
-00048600: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00048610: 735f 656e 6420 3d20 6774 666c 2e65 6e64  s_end = gtfl.end
-00048620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048630: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00048640: 2020 6966 2073 656c 662e 7469 6420 213d    if self.tid !=
-00048650: 2067 7466 6c2e 7469 643a 0a20 2020 2020   gtfl.tid:.     
-00048660: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00048670: 7269 6e74 2827 2020 2045 5252 4f52 2069  rint('   ERROR i
-00048680: 6e20 7472 616e 7363 7269 7074 5f64 6573  n transcript_des
-00048690: 6372 6970 746f 723a 696e 6974 3a20 2573  criptor:init: %s
-000486a0: 2021 3d20 2573 2720 2520 2873 656c 662e   != %s' % (self.
-000486b0: 7469 642c 2067 7466 6c2e 7469 6429 2029  tid, gtfl.tid) )
-000486c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000486d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000486e0: 2020 2020 2020 2020 2020 2069 6620 2867             if (g
-000486f0: 7466 6c2e 6665 6174 7572 652e 6c6f 7765  tfl.feature.lowe
-00048700: 7228 2920 3d3d 2027 6578 6f6e 2729 207c  r() == 'exon') |
-00048710: 2028 6774 666c 2e66 6561 7475 7265 203d   (gtfl.feature =
-00048720: 3d20 2769 6e73 6572 7369 6f6e 2729 3a0a  = 'insersion'):.
-00048730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048740: 2020 2020 2020 2020 2023 2320 746f 2065           ## to e
-00048750: 7374 696d 6174 6520 7374 6172 742f 7374  stimate start/st
-00048760: 6f70 2063 6f64 6f6e 2070 6f73 0a20 2020  op codon pos.   
-00048770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048780: 2020 2020 2069 6620 2870 7374 6172 7420       if (pstart 
-00048790: 3e3d 2030 293a 0a20 2020 2020 2020 2020  >= 0):.         
+000482e0: 2020 6966 2073 656c 662e 6973 7472 616e    if self.istran
+000482f0: 6420 3e3d 2030 3a0a 2020 2020 2020 2020  d >= 0:.        
+00048300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048310: 7073 746f 7020 3d20 6774 666c 2e73 7461  pstop = gtfl.sta
+00048320: 7274 2d31 0a20 2020 2020 2020 2020 2020  rt-1.           
+00048330: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00048340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048350: 2020 2020 2020 2070 7374 6f70 203d 2067         pstop = g
+00048360: 7466 6c2e 656e 640a 2020 2020 2020 2020  tfl.end.        
+00048370: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00048380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048390: 200a 2020 2020 2020 2020 2020 2020 2323   .            ##
+000483a0: 2073 7461 7274 2f73 746f 7020 706f 7369   start/stop posi
+000483b0: 7469 6f6e 2075 7369 6e67 2073 7461 7274  tion using start
+000483c0: 2f73 746f 7020 636f 646f 6e20 696e 666f  /stop codon info
+000483d0: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000483e0: 7365 6c66 2e65 786f 6e73 203d 2072 6567  self.exons = reg
+000483f0: 696f 6e73 2829 0a20 2020 2020 2020 2020  ions().         
+00048400: 2020 2023 2073 656c 662e 6364 7320 3d20     # self.cds = 
+00048410: 7265 6769 6f6e 7328 290a 2020 2020 2020  regions().      
+00048420: 2020 2020 2020 6563 6e74 203d 2030 0a20        ecnt = 0. 
+00048430: 2020 2020 2020 2020 2020 2074 5f6c 656e             t_len
+00048440: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00048450: 2070 5f6c 656e 203d 2030 0a20 2020 2020   p_len = 0.     
+00048460: 2020 2020 2020 2073 7461 7274 203d 202d         start = -
+00048470: 310a 2020 2020 2020 2020 2020 2020 7374  1.            st
+00048480: 6f70 203d 202d 310a 2020 2020 2020 2020  op = -1.        
+00048490: 2020 2020 6c61 7374 5f70 6f73 203d 2030      last_pos = 0
+000484a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000484b0: 2067 7466 6c20 696e 2067 7466 5f6c 696e   gtfl in gtf_lin
+000484c0: 6573 5f6f 665f 615f 7472 3a0a 2020 2020  es_of_a_tr:.    
+000484d0: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
+000484e0: 7374 6172 7420 3d20 6774 666c 2e73 7461  start = gtfl.sta
+000484f0: 7274 2d31 0a20 2020 2020 2020 2020 2020  rt-1.           
+00048500: 2020 2020 2070 6f73 5f65 6e64 203d 2067       pos_end = g
+00048510: 7466 6c2e 656e 640a 2020 2020 2020 2020  tfl.end.        
+00048520: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00048530: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00048540: 2e74 6964 2021 3d20 6774 666c 2e74 6964  .tid != gtfl.tid
+00048550: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00048560: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+00048570: 4552 524f 5220 696e 2074 7261 6e73 6372  ERROR in transcr
+00048580: 6970 745f 6465 7363 7269 7074 6f72 3a69  ipt_descriptor:i
+00048590: 6e69 743a 2025 7320 213d 2025 7327 2025  nit: %s != %s' %
+000485a0: 2028 7365 6c66 2e74 6964 2c20 6774 666c   (self.tid, gtfl
+000485b0: 2e74 6964 2920 290a 2020 2020 2020 2020  .tid) ).        
+000485c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000485d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000485e0: 2020 6966 2028 6774 666c 2e66 6561 7475    if (gtfl.featu
+000485f0: 7265 2e6c 6f77 6572 2829 203d 3d20 2765  re.lower() == 'e
+00048600: 786f 6e27 2920 7c20 2867 7466 6c2e 6665  xon') | (gtfl.fe
+00048610: 6174 7572 6520 3d3d 2027 696e 7365 7273  ature == 'insers
+00048620: 696f 6e27 293a 0a0a 2020 2020 2020 2020  ion'):..        
+00048630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048640: 2323 2074 6f20 6573 7469 6d61 7465 2073  ## to estimate s
+00048650: 7461 7274 2f73 746f 7020 636f 646f 6e20  tart/stop codon 
+00048660: 706f 730a 2020 2020 2020 2020 2020 2020  pos.            
+00048670: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00048680: 7073 7461 7274 203e 3d20 3029 3a0a 2020  pstart >= 0):.  
+00048690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000486a0: 2020 2020 2020 2020 2020 6966 2028 7073            if (ps
+000486b0: 7461 7274 203e 3d20 706f 735f 7374 6172  tart >= pos_star
+000486c0: 7429 2026 2028 7073 7461 7274 203c 3d20  t) & (pstart <= 
+000486d0: 706f 735f 656e 6429 3a0a 2020 2020 2020  pos_end):.      
+000486e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000486f0: 2020 2020 2020 2020 2020 7374 6172 7420            start 
+00048700: 3d20 745f 6c65 6e20 2b20 2870 7374 6172  = t_len + (pstar
+00048710: 7420 2d20 706f 735f 7374 6172 7429 0a0a  t - pos_start)..
+00048720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048730: 2020 2020 2020 2020 6966 2028 2870 7374          if ((pst
+00048740: 6f70 203e 3d20 3029 293a 0a20 2020 2020  op >= 0)):.     
+00048750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048760: 2020 2020 2020 2069 6620 2870 7374 6f70         if (pstop
+00048770: 203e 3d20 706f 735f 7374 6172 7429 2026   >= pos_start) &
+00048780: 2028 7073 746f 7020 3c3d 2070 6f73 5f65   (pstop <= pos_e
+00048790: 6e64 293a 0a20 2020 2020 2020 2020 2020  nd):.           
 000487a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000487b0: 2020 2069 6620 2870 7374 6172 7420 3e3d     if (pstart >=
-000487c0: 2070 6f73 5f73 7461 7274 2920 2620 2870   pos_start) & (p
-000487d0: 7374 6172 7420 3c3d 2070 6f73 5f65 6e64  start <= pos_end
-000487e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000487f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048800: 2020 2073 7461 7274 203d 2074 5f6c 656e     start = t_len
-00048810: 202b 2028 7073 7461 7274 202d 2070 6f73   + (pstart - pos
-00048820: 5f73 7461 7274 290a 0a20 2020 2020 2020  _start)..       
-00048830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048840: 2069 6620 2828 7073 746f 7020 3e3d 2030   if ((pstop >= 0
-00048850: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00048860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048870: 6966 2028 7073 746f 7020 3e3d 2070 6f73  if (pstop >= pos
-00048880: 5f73 7461 7274 2920 2620 2870 7374 6f70  _start) & (pstop
-00048890: 203c 3d20 706f 735f 656e 6429 3a0a 2020   <= pos_end):.  
-000488a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000488b0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-000488c0: 6f70 203d 2074 5f6c 656e 202b 2028 7073  op = t_len + (ps
-000488d0: 746f 7020 2d20 706f 735f 7374 6172 7429  top - pos_start)
-000488e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000488f0: 2020 2020 2020 2020 2020 2323 2074 6f20            ## to 
-00048900: 696e 6974 6961 6c69 7a65 2073 656c 662e  initialize self.
-00048910: 6578 6f6e 730a 2020 2020 2020 2020 2020  exons.          
-00048920: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00048930: 7374 5f70 6f73 203d 2070 6f73 5f65 6e64  st_pos = pos_end
-00048940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048950: 2020 2020 2020 2020 204c 656e 203d 2070           Len = p
-00048960: 6f73 5f65 6e64 202d 2070 6f73 5f73 7461  os_end - pos_sta
-00048970: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-00048980: 2020 2020 2020 2020 2020 2074 5f6c 656e             t_len
-00048990: 203d 2074 5f6c 656e 202b 204c 656e 0a0a   = t_len + Len..
-000489a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000489b0: 2020 2020 2020 2020 6578 6f6e 5f6e 756d          exon_num
-000489c0: 2c20 636f 762c 2061 626e 2c20 7365 712c  , cov, abn, seq,
-000489d0: 2065 766e 742c 2073 7473 2c20 6366 203d   evnt, sts, cf =
-000489e0: 2067 6574 5f6f 7468 6572 5f61 7474 7273   get_other_attrs
-000489f0: 5f66 726f 6d5f 6774 665f 6174 7472 2867  _from_gtf_attr(g
-00048a00: 7466 6c2e 6174 7472 290a 2020 2020 2020  tfl.attr).      
+000487b0: 2020 2020 2073 746f 7020 3d20 745f 6c65       stop = t_le
+000487c0: 6e20 2b20 2870 7374 6f70 202d 2070 6f73  n + (pstop - pos
+000487d0: 5f73 7461 7274 290a 0a20 2020 2020 2020  _start)..       
+000487e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000487f0: 2023 2320 746f 2069 6e69 7469 616c 697a   ## to initializ
+00048800: 6520 7365 6c66 2e65 786f 6e73 0a20 2020  e self.exons.   
+00048810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048820: 2020 2020 206c 6173 745f 706f 7320 3d20       last_pos = 
+00048830: 706f 735f 656e 640a 2020 2020 2020 2020  pos_end.        
+00048840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048850: 4c65 6e20 3d20 706f 735f 656e 6420 2d20  Len = pos_end - 
+00048860: 706f 735f 7374 6172 740a 2020 2020 2020  pos_start.      
+00048870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048880: 2020 745f 6c65 6e20 3d20 745f 6c65 6e20    t_len = t_len 
+00048890: 2b20 4c65 6e0a 0a20 2020 2020 2020 2020  + Len..         
+000488a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000488b0: 786f 6e5f 6e75 6d2c 2063 6f76 2c20 6162  xon_num, cov, ab
+000488c0: 6e2c 2073 6571 2c20 6576 6e74 2c20 7374  n, seq, evnt, st
+000488d0: 732c 2063 6620 3d20 6765 745f 6f74 6865  s, cf = get_othe
+000488e0: 725f 6174 7472 735f 6672 6f6d 5f67 7466  r_attrs_from_gtf
+000488f0: 5f61 7474 7228 6774 666c 2e61 7474 7229  _attr(gtfl.attr)
+00048900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048910: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00048920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048930: 2020 6966 2028 636f 7620 3d3d 2030 2920    if (cov == 0) 
+00048940: 2620 2873 6571 2069 7320 6e6f 7420 4e6f  & (seq is not No
+00048950: 6e65 293a 0a20 2020 2020 2020 2020 2020  ne):.           
+00048960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048970: 2073 6571 203d 2027 4e27 2a28 706f 735f   seq = 'N'*(pos_
+00048980: 656e 642d 706f 735f 7374 6172 7429 0a20  end-pos_start). 
+00048990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000489a0: 2020 2020 2020 2063 6d20 3d20 5472 7565         cm = True
+000489b0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000489c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000489d0: 2066 696c 6c3a 0a20 2020 2020 2020 2020   fill:.         
+000489e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000489f0: 2020 2061 626e 2c20 636d 2c20 7365 7120     abn, cm, seq 
+00048a00: 3d20 302c 2046 616c 7365 2c20 2727 0a0a  = 0, False, ''..
 00048a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048a20: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-00048a30: 2020 2020 2020 2020 2020 2069 6620 2863             if (c
-00048a40: 6f76 203d 3d20 3029 2026 2028 7365 7120  ov == 0) & (seq 
-00048a50: 6973 206e 6f74 204e 6f6e 6529 3a0a 2020  is not None):.  
+00048a20: 2020 2020 2020 2020 2320 656c 6966 2066          # elif f
+00048a30: 696c 6c20 2620 2828 6162 6e20 3c20 3029  ill & ((abn < 0)
+00048a40: 207c 2028 636f 7620 3c20 3029 207c 2028   | (cov < 0) | (
+00048a50: 7365 7120 6973 204e 6f6e 6529 293a 0a20  seq is None)):. 
 00048a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048a70: 2020 2020 2020 2020 2020 7365 7120 3d20            seq = 
-00048a80: 274e 272a 2870 6f73 5f65 6e64 2d70 6f73  'N'*(pos_end-pos
-00048a90: 5f73 7461 7274 290a 2020 2020 2020 2020  _start).        
-00048aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ab0: 636d 203d 2054 7275 650a 0a20 2020 2020  cm = True..     
-00048ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ad0: 2020 2069 6620 6e6f 7420 6669 6c6c 3a0a     if not fill:.
-00048ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048af0: 2020 2020 2020 2020 2020 2020 6162 6e2c              abn,
-00048b00: 2063 6d2c 2073 6571 203d 2030 2c20 4661   cm, seq = 0, Fa
-00048b10: 6c73 652c 2027 270a 0a20 2020 2020 2020  lse, ''..       
-00048b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048b30: 2023 2065 6c69 6620 6669 6c6c 2026 2028   # elif fill & (
-00048b40: 2861 626e 203c 2030 2920 7c20 2863 6f76  (abn < 0) | (cov
-00048b50: 203c 2030 2920 7c20 2873 6571 2069 7320   < 0) | (seq is 
-00048b60: 4e6f 6e65 2929 3a0a 2020 2020 2020 2020  None)):.        
-00048b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048b80: 2320 2020 2063 6f76 2c20 6162 6e2c 2063  #    cov, abn, c
-00048b90: 6d2c 2073 6571 203d 2031 2c20 312c 2054  m, seq = 1, 1, T
-00048ba0: 7275 652c 2027 4e27 2a28 706f 735f 656e  rue, 'N'*(pos_en
-00048bb0: 642d 706f 735f 7374 6172 7429 0a0a 2020  d-pos_start)..  
-00048bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048bd0: 2020 2020 2020 7220 3d20 7265 6769 6f6e        r = region
-00048be0: 2820 6774 666c 2e63 6872 2c20 706f 735f  ( gtfl.chr, pos_
-00048bf0: 7374 6172 742b 312c 2070 6f73 5f65 6e64  start+1, pos_end
-00048c00: 2c20 6774 666c 2e66 6561 7475 7265 2c20  , gtfl.feature, 
-00048c10: 7365 712c 2063 7667 5f64 6570 203d 2061  seq, cvg_dep = a
-00048c20: 626e 2c20 636d 203d 2063 6d2c 2078 7320  bn, cm = cm, xs 
-00048c30: 3d20 7365 6c66 2e69 7374 7261 6e64 2029  = self.istrand )
-00048c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048c50: 2020 2020 2020 2020 2072 2e63 7667 5f66           r.cvg_f
-00048c60: 7261 6320 3d20 6366 0a20 2020 2020 2020  rac = cf.       
+00048a70: 2020 2020 2020 2023 2020 2020 636f 762c         #    cov,
+00048a80: 2061 626e 2c20 636d 2c20 7365 7120 3d20   abn, cm, seq = 
+00048a90: 312c 2031 2c20 5472 7565 2c20 274e 272a  1, 1, True, 'N'*
+00048aa0: 2870 6f73 5f65 6e64 2d70 6f73 5f73 7461  (pos_end-pos_sta
+00048ab0: 7274 290a 0a20 2020 2020 2020 2020 2020  rt)..           
+00048ac0: 2020 2020 2020 2020 2020 2020 2072 203d               r =
+00048ad0: 2072 6567 696f 6e28 2067 7466 6c2e 6368   region( gtfl.ch
+00048ae0: 722c 2070 6f73 5f73 7461 7274 2b31 2c20  r, pos_start+1, 
+00048af0: 706f 735f 656e 642c 2067 7466 6c2e 6665  pos_end, gtfl.fe
+00048b00: 6174 7572 652c 2073 6571 2c20 6376 675f  ature, seq, cvg_
+00048b10: 6465 7020 3d20 6162 6e2c 2063 6d20 3d20  dep = abn, cm = 
+00048b20: 636d 2c20 7873 203d 2073 656c 662e 6973  cm, xs = self.is
+00048b30: 7472 616e 6420 290a 2020 2020 2020 2020  trand ).        
+00048b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048b50: 722e 6376 675f 6672 6163 203d 2063 660a  r.cvg_frac = cf.
+00048b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048b70: 2020 2020 2020 2020 2320 725f 6d69 203d          # r_mi =
+00048b80: 2072 6567 696f 6e28 2067 7466 6c2e 6368   region( gtfl.ch
+00048b90: 722c 2070 6f73 5f73 7461 7274 2b31 2c20  r, pos_start+1, 
+00048ba0: 706f 735f 656e 642c 2067 7466 6c2e 6665  pos_end, gtfl.fe
+00048bb0: 6174 7572 652c 2073 6571 5f6f 725f 636d  ature, seq_or_cm
+00048bc0: 6174 203d 2073 6571 2c20 6376 675f 6465  at = seq, cvg_de
+00048bd0: 7020 3d20 302c 2078 7320 3d20 7365 6c66  p = 0, xs = self
+00048be0: 2e69 7374 7261 6e64 2029 0a20 2020 2020  .istrand ).     
+00048bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048c00: 2020 2023 2073 656c 662e 6578 6f6e 732e     # self.exons.
+00048c10: 7267 6e73 2e61 7070 656e 6428 2072 2029  rgns.append( r )
+00048c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048c30: 2020 2020 2020 2020 2023 2323 2323 2323           #######
+00048c40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00048c50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00048c60: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
 00048c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c80: 2023 2072 5f6d 6920 3d20 7265 6769 6f6e   # r_mi = region
-00048c90: 2820 6774 666c 2e63 6872 2c20 706f 735f  ( gtfl.chr, pos_
-00048ca0: 7374 6172 742b 312c 2070 6f73 5f65 6e64  start+1, pos_end
-00048cb0: 2c20 6774 666c 2e66 6561 7475 7265 2c20  , gtfl.feature, 
-00048cc0: 7365 715f 6f72 5f63 6d61 7420 3d20 7365  seq_or_cmat = se
-00048cd0: 712c 2063 7667 5f64 6570 203d 2030 2c20  q, cvg_dep = 0, 
-00048ce0: 7873 203d 2073 656c 662e 6973 7472 616e  xs = self.istran
-00048cf0: 6420 290a 2020 2020 2020 2020 2020 2020  d ).            
-00048d00: 2020 2020 2020 2020 2020 2020 2320 7365              # se
-00048d10: 6c66 2e65 786f 6e73 2e72 676e 732e 6170  lf.exons.rgns.ap
-00048d20: 7065 6e64 2820 7220 290a 2020 2020 2020  pend( r ).      
-00048d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d40: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-00048d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00048d60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00048d70: 2323 2323 0a20 2020 2020 2020 2020 2020  ####.           
-00048d80: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-00048d90: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00048da0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00048db0: 7220 6d2c 7320 696e 2065 6e75 6d65 7261  r m,s in enumera
-00048dc0: 7465 2865 786f 6e5f 7267 6e73 293a 0a20  te(exon_rgns):. 
-00048dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048de0: 2020 2020 2020 2020 2020 2069 6620 722e             if r.
-00048df0: 6973 5f74 6865 5f73 616d 655f 6173 2873  is_the_same_as(s
-00048e00: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00048c80: 2020 2020 6220 3d20 5472 7565 0a20 2020      b = True.   
+00048c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ca0: 2020 2020 2066 6f72 206d 2c73 2069 6e20       for m,s in 
+00048cb0: 656e 756d 6572 6174 6528 6578 6f6e 5f72  enumerate(exon_r
+00048cc0: 676e 7329 3a0a 2020 2020 2020 2020 2020  gns):.          
+00048cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ce0: 2020 6966 2072 2e69 735f 7468 655f 7361    if r.is_the_sa
+00048cf0: 6d65 5f61 7328 7329 3a0a 2020 2020 2020  me_as(s):.      
+00048d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d10: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+00048d20: 655f 746f 5f67 655f 6d61 702e 6170 7065  e_to_ge_map.appe
+00048d30: 6e64 286d 290a 2020 2020 2020 2020 2020  nd(m).          
+00048d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d50: 2020 2020 2020 6220 3d20 4661 6c73 650a        b = False.
+00048d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d80: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00048d90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00048da0: 2062 3a20 0a20 2020 2020 2020 2020 2020   b: .           
+00048db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048dc0: 206d 203d 206c 656e 2865 786f 6e5f 7267   m = len(exon_rg
+00048dd0: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
+00048de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048df0: 7365 6c66 2e74 655f 746f 5f67 655f 6d61  self.te_to_ge_ma
+00048e00: 702e 6170 7065 6e64 286d 290a 2020 2020  p.append(m).    
 00048e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e20: 2020 2073 656c 662e 7465 5f74 6f5f 6765     self.te_to_ge
-00048e30: 5f6d 6170 2e61 7070 656e 6428 6d29 0a20  _map.append(m). 
+00048e20: 2020 2020 2020 2020 6578 6f6e 5f72 676e          exon_rgn
+00048e30: 732e 6170 7065 6e64 2820 7220 290a 2020  s.append( r ).  
 00048e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e50: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00048e60: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00048e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e80: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00048e50: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+00048e60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00048e70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00048e80: 2323 2323 2323 2323 0a20 2020 2020 2020  ########.       
 00048e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ea0: 2020 2020 2020 2069 6620 623a 200a 2020         if b: .  
+00048ea0: 2065 636e 7420 2b3d 2031 0a0a 2020 2020   ecnt += 1..    
 00048eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ec0: 2020 2020 2020 2020 2020 6d20 3d20 6c65            m = le
-00048ed0: 6e28 6578 6f6e 5f72 676e 7329 0a20 2020  n(exon_rgns).   
-00048ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ef0: 2020 2020 2020 2020 2073 656c 662e 7465           self.te
-00048f00: 5f74 6f5f 6765 5f6d 6170 2e61 7070 656e  _to_ge_map.appen
-00048f10: 6428 6d29 0a20 2020 2020 2020 2020 2020  d(m).           
-00048f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048f30: 2065 786f 6e5f 7267 6e73 2e61 7070 656e   exon_rgns.appen
-00048f40: 6428 2072 2029 0a20 2020 2020 2020 2020  d( r ).         
-00048f50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00048f60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00048f70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00048f80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00048f90: 230a 2020 2020 2020 2020 2020 2020 2020  #.              
-00048fa0: 2020 2020 2020 2020 2020 6563 6e74 202b            ecnt +
-00048fb0: 3d20 310a 0a20 2020 2020 2020 2020 2020  = 1..           
-00048fc0: 2020 2020 2020 2020 2020 2020 2023 2320               ## 
-00048fd0: 746f 2065 7374 696d 6174 6520 7472 616e  to estimate tran
-00048fe0: 7363 7269 7074 2073 7061 6e0a 2020 2020  script span.    
-00048ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049000: 2020 2020 6966 2073 656c 662e 6265 6769      if self.begi
-00049010: 6e20 3c20 303a 200a 2020 2020 2020 2020  n < 0: .        
-00049020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049030: 2020 2020 7365 6c66 2e62 6567 696e 203d      self.begin =
-00049040: 2070 6f73 5f73 7461 7274 2b31 0a20 2020   pos_start+1.   
-00049050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049060: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00049070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049080: 2020 2020 2020 2073 656c 662e 6265 6769         self.begi
-00049090: 6e20 3d20 6d69 6e28 2073 656c 662e 6265  n = min( self.be
-000490a0: 6769 6e2c 2070 6f73 5f73 7461 7274 2b31  gin, pos_start+1
-000490b0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000490c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000490d0: 6c66 2e65 6e64 203c 2030 3a20 0a20 2020  lf.end < 0: .   
-000490e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000490f0: 2020 2020 2020 2020 2073 656c 662e 656e           self.en
-00049100: 6420 3d20 706f 735f 656e 640a 2020 2020  d = pos_end.    
-00049110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049120: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00048ec0: 2020 2020 2323 2074 6f20 6573 7469 6d61      ## to estima
+00048ed0: 7465 2074 7261 6e73 6372 6970 7420 7370  te transcript sp
+00048ee0: 616e 0a20 2020 2020 2020 2020 2020 2020  an.             
+00048ef0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00048f00: 6c66 2e62 6567 696e 203c 2030 3a20 0a20  lf.begin < 0: . 
+00048f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048f20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00048f30: 6265 6769 6e20 3d20 706f 735f 7374 6172  begin = pos_star
+00048f40: 742b 310a 2020 2020 2020 2020 2020 2020  t+1.            
+00048f50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00048f60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00048f70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00048f80: 6c66 2e62 6567 696e 203d 206d 696e 2820  lf.begin = min( 
+00048f90: 7365 6c66 2e62 6567 696e 2c20 706f 735f  self.begin, pos_
+00048fa0: 7374 6172 742b 3120 290a 2020 2020 2020  start+1 ).      
+00048fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048fc0: 2020 6966 2073 656c 662e 656e 6420 3c20    if self.end < 
+00048fd0: 303a 200a 2020 2020 2020 2020 2020 2020  0: .            
+00048fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ff0: 7365 6c66 2e65 6e64 203d 2070 6f73 5f65  self.end = pos_e
+00049000: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
+00049010: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00049020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049030: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00049040: 662e 656e 6420 3d20 6d61 7828 2073 656c  f.end = max( sel
+00049050: 662e 656e 642c 2070 6f73 5f65 6e64 2029  f.end, pos_end )
+00049060: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00049070: 2020 2020 2020 656c 6966 2028 6774 666c        elif (gtfl
+00049080: 2e66 6561 7475 7265 203d 3d20 2764 656c  .feature == 'del
+00049090: 6574 696f 6e27 293a 0a0a 2020 2020 2020  etion'):..      
+000490a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000490b0: 2020 6578 6f6e 5f6e 756d 2c20 636f 762c    exon_num, cov,
+000490c0: 2061 626e 2c20 7365 712c 2065 766e 742c   abn, seq, evnt,
+000490d0: 2073 7473 2c20 6366 203d 2067 6574 5f6f   sts, cf = get_o
+000490e0: 7468 6572 5f61 7474 7273 5f66 726f 6d5f  ther_attrs_from_
+000490f0: 6774 665f 6174 7472 2867 7466 6c2e 6174  gtf_attr(gtfl.at
+00049100: 7472 290a 0a20 2020 2020 2020 2020 2020  tr)..           
+00049110: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00049120: 6e6f 7420 6669 6c6c 3a20 0a20 2020 2020  not fill: .     
 00049130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049140: 2020 2020 2020 7365 6c66 2e65 6e64 203d        self.end =
-00049150: 206d 6178 2820 7365 6c66 2e65 6e64 2c20   max( self.end, 
-00049160: 706f 735f 656e 6420 290a 0a20 2020 2020  pos_end )..     
-00049170: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00049180: 6c69 6620 2867 7466 6c2e 6665 6174 7572  lif (gtfl.featur
-00049190: 6520 3d3d 2027 6465 6c65 7469 6f6e 2729  e == 'deletion')
-000491a0: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-000491b0: 2020 2020 2020 2020 2020 2065 786f 6e5f             exon_
-000491c0: 6e75 6d2c 2063 6f76 2c20 6162 6e2c 2073  num, cov, abn, s
-000491d0: 6571 2c20 6576 6e74 2c20 7374 732c 2063  eq, evnt, sts, c
-000491e0: 6620 3d20 6765 745f 6f74 6865 725f 6174  f = get_other_at
-000491f0: 7472 735f 6672 6f6d 5f67 7466 5f61 7474  trs_from_gtf_att
-00049200: 7228 6774 666c 2e61 7474 7229 0a0a 2020  r(gtfl.attr)..  
-00049210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049220: 2020 2020 2020 6966 206e 6f74 2066 696c        if not fil
-00049230: 6c3a 200a 2020 2020 2020 2020 2020 2020  l: .            
-00049240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049250: 6162 6e20 3d20 300a 0a20 2020 2020 2020  abn = 0..       
-00049260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049270: 2072 203d 2072 6567 696f 6e5f 6e64 2820   r = region_nd( 
-00049280: 6774 666c 2e63 6872 2c20 706f 735f 7374  gtfl.chr, pos_st
-00049290: 6172 742b 312c 2070 6f73 5f65 6e64 2c20  art+1, pos_end, 
-000492a0: 6774 666c 2e66 6561 7475 7265 2c20 6376  gtfl.feature, cv
-000492b0: 675f 6465 7020 3d20 6162 6e2c 2078 7320  g_dep = abn, xs 
-000492c0: 3d20 7365 6c66 2e69 7374 7261 6e64 2029  = self.istrand )
-000492d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000492e0: 2020 2020 2020 2020 2072 2e63 7667 5f66           r.cvg_f
-000492f0: 7261 6320 3d20 6366 0a20 2020 2020 2020  rac = cf.       
-00049300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049310: 2023 2072 5f64 203d 2072 6567 696f 6e5f   # r_d = region_
-00049320: 6e64 2820 6774 666c 2e63 6872 2c20 706f  nd( gtfl.chr, po
-00049330: 735f 7374 6172 742b 312c 2070 6f73 5f65  s_start+1, pos_e
-00049340: 6e64 2c20 6774 666c 2e66 6561 7475 7265  nd, gtfl.feature
-00049350: 2c20 6376 675f 6465 7020 3d20 6162 6e2c  , cvg_dep = abn,
-00049360: 2078 7320 3d20 7365 6c66 2e69 7374 7261   xs = self.istra
-00049370: 6e64 2029 0a20 2020 2020 2020 2020 2020  nd ).           
-00049380: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00049390: 656c 662e 6578 6f6e 732e 7267 6e73 2e61  elf.exons.rgns.a
-000493a0: 7070 656e 6428 2072 2029 0a20 2020 2020  ppend( r ).     
-000493b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000493c0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-000493d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000493e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000493f0: 2323 2323 230a 2020 2020 2020 2020 2020  #####.          
-00049400: 2020 2020 2020 2020 2020 2020 2020 6220                b 
-00049410: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00049420: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00049430: 6f72 206d 2c73 2069 6e20 656e 756d 6572  or m,s in enumer
-00049440: 6174 6528 6578 6f6e 5f72 676e 7329 3a0a  ate(exon_rgns):.
-00049450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049460: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00049470: 2e69 735f 7468 655f 7361 6d65 5f61 7328  .is_the_same_as(
-00049480: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00049140: 2020 2020 2020 2061 626e 203d 2030 0a0a         abn = 0..
+00049150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049160: 2020 2020 2020 2020 7220 3d20 7265 6769          r = regi
+00049170: 6f6e 5f6e 6428 2067 7466 6c2e 6368 722c  on_nd( gtfl.chr,
+00049180: 2070 6f73 5f73 7461 7274 2b31 2c20 706f   pos_start+1, po
+00049190: 735f 656e 642c 2067 7466 6c2e 6665 6174  s_end, gtfl.feat
+000491a0: 7572 652c 2063 7667 5f64 6570 203d 2061  ure, cvg_dep = a
+000491b0: 626e 2c20 7873 203d 2073 656c 662e 6973  bn, xs = self.is
+000491c0: 7472 616e 6420 290a 2020 2020 2020 2020  trand ).        
+000491d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000491e0: 722e 6376 675f 6672 6163 203d 2063 660a  r.cvg_frac = cf.
+000491f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049200: 2020 2020 2020 2020 2320 725f 6420 3d20          # r_d = 
+00049210: 7265 6769 6f6e 5f6e 6428 2067 7466 6c2e  region_nd( gtfl.
+00049220: 6368 722c 2070 6f73 5f73 7461 7274 2b31  chr, pos_start+1
+00049230: 2c20 706f 735f 656e 642c 2067 7466 6c2e  , pos_end, gtfl.
+00049240: 6665 6174 7572 652c 2063 7667 5f64 6570  feature, cvg_dep
+00049250: 203d 2061 626e 2c20 7873 203d 2073 656c   = abn, xs = sel
+00049260: 662e 6973 7472 616e 6420 290a 2020 2020  f.istrand ).    
+00049270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049280: 2020 2020 2320 7365 6c66 2e65 786f 6e73      # self.exons
+00049290: 2e72 676e 732e 6170 7065 6e64 2820 7220  .rgns.append( r 
+000492a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000492b0: 2020 2020 2020 2020 2020 2323 2323 2323            ######
+000492c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000492d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000492e0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+000492f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049300: 2020 2020 2062 203d 2054 7275 650a 2020       b = True.  
+00049310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049320: 2020 2020 2020 666f 7220 6d2c 7320 696e        for m,s in
+00049330: 2065 6e75 6d65 7261 7465 2865 786f 6e5f   enumerate(exon_
+00049340: 7267 6e73 293a 0a20 2020 2020 2020 2020  rgns):.         
+00049350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049360: 2020 2069 6620 722e 6973 5f74 6865 5f73     if r.is_the_s
+00049370: 616d 655f 6173 2873 293a 0a20 2020 2020  ame_as(s):.     
+00049380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049390: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000493a0: 7465 5f74 6f5f 6765 5f6d 6170 2e61 7070  te_to_ge_map.app
+000493b0: 656e 6428 6d29 0a20 2020 2020 2020 2020  end(m).         
+000493c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000493d0: 2020 2020 2020 2062 203d 2046 616c 7365         b = False
+000493e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000493f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049400: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00049410: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00049420: 6620 623a 200a 2020 2020 2020 2020 2020  f b: .          
+00049430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049440: 2020 6d20 3d20 6c65 6e28 6578 6f6e 5f72    m = len(exon_r
+00049450: 676e 7329 0a20 2020 2020 2020 2020 2020  gns).           
+00049460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049470: 2073 656c 662e 7465 5f74 6f5f 6765 5f6d   self.te_to_ge_m
+00049480: 6170 2e61 7070 656e 6428 6d29 0a20 2020  ap.append(m).   
 00049490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000494a0: 2020 2020 7365 6c66 2e74 655f 746f 5f67      self.te_to_g
-000494b0: 655f 6d61 702e 6170 7065 6e64 286d 290a  e_map.append(m).
+000494a0: 2020 2020 2020 2020 2065 786f 6e5f 7267           exon_rg
+000494b0: 6e73 2e61 7070 656e 6428 2072 2029 0a20  ns.append( r ). 
 000494c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000494d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000494e0: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
-000494f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049500: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+000494d0: 2020 2020 2020 2023 2323 2323 2323 2323         #########
+000494e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000494f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00049500: 2323 2323 2323 2323 230a 2020 2020 2020  #########.      
 00049510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049520: 2020 2020 2020 2020 6966 2062 3a20 0a20          if b: . 
+00049520: 2020 6563 6e74 202b 3d20 310a 0a20 2020    ecnt += 1..   
 00049530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049540: 2020 2020 2020 2020 2020 206d 203d 206c             m = l
-00049550: 656e 2865 786f 6e5f 7267 6e73 290a 2020  en(exon_rgns).  
-00049560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049570: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00049580: 655f 746f 5f67 655f 6d61 702e 6170 7065  e_to_ge_map.appe
-00049590: 6e64 286d 290a 2020 2020 2020 2020 2020  nd(m).          
-000495a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000495b0: 2020 6578 6f6e 5f72 676e 732e 6170 7065    exon_rgns.appe
-000495c0: 6e64 2820 7220 290a 2020 2020 2020 2020  nd( r ).        
-000495d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000495e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000495f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00049600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00049610: 2323 0a20 2020 2020 2020 2020 2020 2020  ##.             
-00049620: 2020 2020 2020 2020 2020 2065 636e 7420             ecnt 
-00049630: 2b3d 2031 0a0a 2020 2020 2020 2020 2020  += 1..          
-00049640: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
-00049650: 6774 666c 2e66 6561 7475 7265 2e6c 6f77  gtfl.feature.low
-00049660: 6572 2829 203d 3d20 2763 6473 2729 207c  er() == 'cds') |
-00049670: 2028 6774 666c 2e66 6561 7475 7265 2e6c   (gtfl.feature.l
-00049680: 6f77 6572 2829 203d 3d20 2773 7461 7274  ower() == 'start
-00049690: 5f63 6f64 6f6e 2729 207c 2028 6774 666c  _codon') | (gtfl
-000496a0: 2e66 6561 7475 7265 2e6c 6f77 6572 2829  .feature.lower()
-000496b0: 203d 3d20 2773 746f 705f 636f 646f 6e27   == 'stop_codon'
-000496c0: 2920 7c20 2028 6774 666c 2e66 6561 7475  ) |  (gtfl.featu
-000496d0: 7265 2e6c 6f77 6572 2829 203d 3d20 2775  re.lower() == 'u
-000496e0: 7472 2729 205c 0a20 2020 2020 2020 2020  tr') \.         
-000496f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049700: 7c20 2867 7466 6c2e 6665 6174 7572 652e  | (gtfl.feature.
-00049710: 6c6f 7765 7228 2920 3d3d 2027 6669 7665  lower() == 'five
-00049720: 5f70 7269 6d65 5f75 7472 2729 207c 2028  _prime_utr') | (
-00049730: 6774 666c 2e66 6561 7475 7265 2e6c 6f77  gtfl.feature.low
-00049740: 6572 2829 203d 3d20 2774 6872 6565 5f70  er() == 'three_p
-00049750: 7269 6d65 5f75 7472 2729 207c 2028 6774  rime_utr') | (gt
-00049760: 666c 2e66 6561 7475 7265 2e6c 6f77 6572  fl.feature.lower
-00049770: 2829 203d 3d20 2773 656c 656e 6f63 7973  () == 'selenocys
-00049780: 7465 696e 6527 293a 0a20 2020 2020 2020  teine'):.       
-00049790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000497a0: 2023 2320 746f 2069 6e69 7469 616c 697a   ## to initializ
-000497b0: 6520 7365 6c66 2e65 786f 6e73 0a20 2020  e self.exons.   
-000497c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000497d0: 2020 2020 204c 656e 203d 2070 6f73 5f65       Len = pos_e
-000497e0: 6e64 202d 2070 6f73 5f73 7461 7274 0a20  nd - pos_start. 
-000497f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049800: 2020 2020 2020 2070 5f6c 656e 203d 2070         p_len = p
-00049810: 5f6c 656e 202b 204c 656e 0a0a 2020 2020  _len + Len..    
-00049820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049830: 2020 2020 6578 6f6e 5f6e 756d 2c20 636f      exon_num, co
-00049840: 762c 2061 626e 2c20 7365 712c 2065 766e  v, abn, seq, evn
-00049850: 742c 2073 7473 2c20 6366 203d 2067 6574  t, sts, cf = get
-00049860: 5f6f 7468 6572 5f61 7474 7273 5f66 726f  _other_attrs_fro
-00049870: 6d5f 6774 665f 6174 7472 2867 7466 6c2e  m_gtf_attr(gtfl.
-00049880: 6174 7472 290a 0a20 2020 2020 2020 2020  attr)..         
-00049890: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000498a0: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
-000498b0: 2020 2020 2020 2020 2020 2069 6620 2867             if (g
-000498c0: 7466 6c2e 6665 6174 7572 652e 6c6f 7765  tfl.feature.lowe
-000498d0: 7228 2920 3d3d 2027 6364 7327 2920 7c20  r() == 'cds') | 
-000498e0: 2867 7466 6c2e 6665 6174 7572 652e 6c6f  (gtfl.feature.lo
-000498f0: 7765 7228 2920 3d3d 2027 7374 6f70 5f63  wer() == 'stop_c
-00049900: 6f64 6f6e 2729 3a0a 2020 2020 2020 2020  odon'):.        
-00049910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049920: 2020 2020 6966 2067 656e 6f6d 6520 6973      if genome is
-00049930: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00049940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049950: 2020 2020 2020 2020 2020 2069 6620 6774             if gt
-00049960: 666c 2e63 6872 2069 6e20 6765 6e6f 6d65  fl.chr in genome
-00049970: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
+00049540: 2065 6c69 6620 2867 7466 6c2e 6665 6174   elif (gtfl.feat
+00049550: 7572 652e 6c6f 7765 7228 2920 3d3d 2027  ure.lower() == '
+00049560: 6364 7327 2920 7c20 2867 7466 6c2e 6665  cds') | (gtfl.fe
+00049570: 6174 7572 652e 6c6f 7765 7228 2920 3d3d  ature.lower() ==
+00049580: 2027 7374 6172 745f 636f 646f 6e27 2920   'start_codon') 
+00049590: 7c20 2867 7466 6c2e 6665 6174 7572 652e  | (gtfl.feature.
+000495a0: 6c6f 7765 7228 2920 3d3d 2027 7374 6f70  lower() == 'stop
+000495b0: 5f63 6f64 6f6e 2729 207c 2020 2867 7466  _codon') |  (gtf
+000495c0: 6c2e 6665 6174 7572 652e 6c6f 7765 7228  l.feature.lower(
+000495d0: 2920 3d3d 2027 7574 7227 2920 5c0a 2020  ) == 'utr') \.  
+000495e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000495f0: 2020 2020 2020 207c 2028 6774 666c 2e66         | (gtfl.f
+00049600: 6561 7475 7265 2e6c 6f77 6572 2829 203d  eature.lower() =
+00049610: 3d20 2766 6976 655f 7072 696d 655f 7574  = 'five_prime_ut
+00049620: 7227 2920 7c20 2867 7466 6c2e 6665 6174  r') | (gtfl.feat
+00049630: 7572 652e 6c6f 7765 7228 2920 3d3d 2027  ure.lower() == '
+00049640: 7468 7265 655f 7072 696d 655f 7574 7227  three_prime_utr'
+00049650: 2920 7c20 2867 7466 6c2e 6665 6174 7572  ) | (gtfl.featur
+00049660: 652e 6c6f 7765 7228 2920 3d3d 2027 7365  e.lower() == 'se
+00049670: 6c65 6e6f 6379 7374 6569 6e65 2729 3a0a  lenocysteine'):.
+00049680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049690: 2020 2020 2020 2020 2323 2074 6f20 696e          ## to in
+000496a0: 6974 6961 6c69 7a65 2073 656c 662e 6578  itialize self.ex
+000496b0: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+000496c0: 2020 2020 2020 2020 2020 2020 4c65 6e20              Len 
+000496d0: 3d20 706f 735f 656e 6420 2d20 706f 735f  = pos_end - pos_
+000496e0: 7374 6172 740a 2020 2020 2020 2020 2020  start.          
+000496f0: 2020 2020 2020 2020 2020 2020 2020 705f                p_
+00049700: 6c65 6e20 3d20 705f 6c65 6e20 2b20 4c65  len = p_len + Le
+00049710: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+00049720: 2020 2020 2020 2020 2020 2065 786f 6e5f             exon_
+00049730: 6e75 6d2c 2063 6f76 2c20 6162 6e2c 2073  num, cov, abn, s
+00049740: 6571 2c20 6576 6e74 2c20 7374 732c 2063  eq, evnt, sts, c
+00049750: 6620 3d20 6765 745f 6f74 6865 725f 6174  f = get_other_at
+00049760: 7472 735f 6672 6f6d 5f67 7466 5f61 7474  trs_from_gtf_att
+00049770: 7228 6774 666c 2e61 7474 7229 0a0a 2020  r(gtfl.attr)..  
+00049780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049790: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+000497a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000497b0: 2020 6966 2028 6774 666c 2e66 6561 7475    if (gtfl.featu
+000497c0: 7265 2e6c 6f77 6572 2829 203d 3d20 2763  re.lower() == 'c
+000497d0: 6473 2729 207c 2028 6774 666c 2e66 6561  ds') | (gtfl.fea
+000497e0: 7475 7265 2e6c 6f77 6572 2829 203d 3d20  ture.lower() == 
+000497f0: 2773 746f 705f 636f 646f 6e27 293a 0a20  'stop_codon'):. 
+00049800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049810: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
+00049820: 6e6f 6d65 2069 7320 6e6f 7420 4e6f 6e65  nome is not None
+00049830: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00049840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049850: 2020 6966 2067 7466 6c2e 6368 7220 696e    if gtfl.chr in
+00049860: 2067 656e 6f6d 652e 6b65 7973 2829 3a0a   genome.keys():.
+00049870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049890: 2020 2020 7365 6c66 2e6c 6f66 2e61 6464      self.lof.add
+000498a0: 2820 6774 666c 2e73 7461 7274 2c20 6774  ( gtfl.start, gt
+000498b0: 666c 2e65 6e64 2c20 6c65 6e28 7365 6c66  fl.end, len(self
+000498c0: 2e70 7365 7129 290a 2020 2020 2020 2020  .pseq)).        
+000498d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000498e0: 2020 2020 2020 2020 2020 2020 7073 7120              psq 
+000498f0: 3d20 2067 656e 6f6d 655b 6774 666c 2e63  =  genome[gtfl.c
+00049900: 6872 5d2e 7365 715b 2867 7466 6c2e 7374  hr].seq[(gtfl.st
+00049910: 6172 742d 3129 3a67 7466 6c2e 656e 645d  art-1):gtfl.end]
+00049920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049940: 2020 2020 2073 656c 662e 7073 6571 203d       self.pseq =
+00049950: 2073 656c 662e 7073 6571 202b 2070 7371   self.pseq + psq
+00049960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049970: 2020 2020 2020 2020 2027 2727 0a20 2020           '''.   
 00049980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049990: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000499a0: 662e 6c6f 662e 6164 6428 2067 7466 6c2e  f.lof.add( gtfl.
-000499b0: 7374 6172 742c 2067 7466 6c2e 656e 642c  start, gtfl.end,
-000499c0: 206c 656e 2873 656c 662e 7073 6571 2929   len(self.pseq))
-000499d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049990: 2020 2020 2069 6620 2867 7466 6c2e 6665       if (gtfl.fe
+000499a0: 6174 7572 652e 6c6f 7765 7228 2920 3d3d  ature.lower() ==
+000499b0: 2027 7374 6172 745f 636f 646f 6e27 2920   'start_codon') 
+000499c0: 2620 2865 766e 7420 6973 206e 6f74 204e  & (evnt is not N
+000499d0: 6f6e 6529 3a20 0a20 2020 2020 2020 2020  one): .         
 000499e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000499f0: 2020 2020 2070 7371 203d 2020 6765 6e6f       psq =  geno
-00049a00: 6d65 5b67 7466 6c2e 6368 725d 2e73 6571  me[gtfl.chr].seq
-00049a10: 5b28 6774 666c 2e73 7461 7274 2d31 293a  [(gtfl.start-1):
-00049a20: 6774 666c 2e65 6e64 5d0a 2020 2020 2020  gtfl.end].      
-00049a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049a40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00049a50: 6c66 2e70 7365 7120 3d20 7365 6c66 2e70  lf.pseq = self.p
-00049a60: 7365 7120 2b20 7073 710a 2020 2020 2020  seq + psq.      
-00049a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049a80: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
-00049a90: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00049aa0: 2028 6774 666c 2e66 6561 7475 7265 2e6c   (gtfl.feature.l
-00049ab0: 6f77 6572 2829 203d 3d20 2773 7461 7274  ower() == 'start
-00049ac0: 5f63 6f64 6f6e 2729 2026 2028 6576 6e74  _codon') & (evnt
-00049ad0: 2069 7320 6e6f 7420 4e6f 6e65 293a 200a   is not None): .
-00049ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049af0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00049b00: 2e73 7461 7274 5f63 6f64 6f6e 5f65 7665  .start_codon_eve
-00049b10: 6e74 203d 2069 6e74 2865 766e 742e 7370  nt = int(evnt.sp
-00049b20: 6c69 7428 273a 2729 5b30 5d29 0a20 2020  lit(':')[0]).   
-00049b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049b40: 2020 2020 2065 6c69 6620 2867 7466 6c2e       elif (gtfl.
-00049b50: 6665 6174 7572 652e 6c6f 7765 7228 2920  feature.lower() 
-00049b60: 3d3d 2027 7374 6f70 5f63 6f64 6f6e 2729  == 'stop_codon')
-00049b70: 2026 2028 6576 6e74 2069 7320 6e6f 7420   & (evnt is not 
-00049b80: 4e6f 6e65 293a 200a 2020 2020 2020 2020  None): .        
-00049b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ba0: 2020 2020 7365 6c66 2e73 746f 705f 636f      self.stop_co
-00049bb0: 646f 6e5f 6576 656e 7420 3d20 696e 7428  don_event = int(
-00049bc0: 6576 6e74 2e73 706c 6974 2827 3a27 295b  evnt.split(':')[
-00049bd0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-00049be0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00049bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049c00: 2020 2020 2069 6620 7365 7120 6973 204e       if seq is N
-00049c10: 6f6e 653a 2073 6571 203d 2027 270a 2020  one: seq = ''.  
+000499f0: 2020 2073 656c 662e 7374 6172 745f 636f     self.start_co
+00049a00: 646f 6e5f 6576 656e 7420 3d20 696e 7428  don_event = int(
+00049a10: 6576 6e74 2e73 706c 6974 2827 3a27 295b  evnt.split(':')[
+00049a20: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+00049a30: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00049a40: 2028 6774 666c 2e66 6561 7475 7265 2e6c   (gtfl.feature.l
+00049a50: 6f77 6572 2829 203d 3d20 2773 746f 705f  ower() == 'stop_
+00049a60: 636f 646f 6e27 2920 2620 2865 766e 7420  codon') & (evnt 
+00049a70: 6973 206e 6f74 204e 6f6e 6529 3a20 0a20  is not None): . 
+00049a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049a90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00049aa0: 7374 6f70 5f63 6f64 6f6e 5f65 7665 6e74  stop_codon_event
+00049ab0: 203d 2069 6e74 2865 766e 742e 7370 6c69   = int(evnt.spli
+00049ac0: 7428 273a 2729 5b30 5d29 0a20 2020 2020  t(':')[0]).     
+00049ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ae0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00049af0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00049b00: 6571 2069 7320 4e6f 6e65 3a20 7365 7120  eq is None: seq 
+00049b10: 3d20 2727 0a20 2020 2020 2020 2020 2020  = ''.           
+00049b20: 2020 2020 2020 2020 2020 2020 2063 6d20               cm 
+00049b30: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00049b40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00049b50: 6620 6e6f 7420 6669 6c6c 3a20 0a20 2020  f not fill: .   
+00049b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049b70: 2020 2020 2020 2020 2061 626e 2c20 636d           abn, cm
+00049b80: 2c20 7365 7120 3d20 302c 2046 616c 7365  , seq = 0, False
+00049b90: 2c20 2727 0a0a 2020 2020 2020 2020 2020  , ''..          
+00049ba0: 2020 2020 2020 2020 2020 2020 2020 7220                r 
+00049bb0: 3d20 7265 6769 6f6e 2820 6774 666c 2e63  = region( gtfl.c
+00049bc0: 6872 2c20 706f 735f 7374 6172 742b 312c  hr, pos_start+1,
+00049bd0: 2070 6f73 5f65 6e64 2c20 6774 666c 2e66   pos_end, gtfl.f
+00049be0: 6561 7475 7265 2c20 7365 712c 2063 6d20  eature, seq, cm 
+00049bf0: 3d20 4661 6c73 652c 2063 7667 5f64 6570  = False, cvg_dep
+00049c00: 203d 2030 2c20 7873 203d 2073 656c 662e   = 0, xs = self.
+00049c10: 6973 7472 616e 6420 290a 2020 2020 2020  istrand ).      
 00049c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049c30: 2020 2020 2020 636d 203d 2054 7275 650a        cm = True.
-00049c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049c50: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
-00049c60: 696c 6c3a 200a 2020 2020 2020 2020 2020  ill: .          
-00049c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049c80: 2020 6162 6e2c 2063 6d2c 2073 6571 203d    abn, cm, seq =
-00049c90: 2030 2c20 4661 6c73 652c 2027 270a 0a20   0, False, ''.. 
+00049c30: 2020 2320 7365 6c66 2e63 6473 2e72 676e    # self.cds.rgn
+00049c40: 732e 6170 7065 6e64 2820 7220 290a 2020  s.append( r ).  
+00049c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049c60: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+00049c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00049c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00049c90: 2323 2323 2323 2323 0a20 2020 2020 2020  ########.       
 00049ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049cb0: 2020 2020 2020 2072 203d 2072 6567 696f         r = regio
-00049cc0: 6e28 2067 7466 6c2e 6368 722c 2070 6f73  n( gtfl.chr, pos
-00049cd0: 5f73 7461 7274 2b31 2c20 706f 735f 656e  _start+1, pos_en
-00049ce0: 642c 2067 7466 6c2e 6665 6174 7572 652c  d, gtfl.feature,
-00049cf0: 2073 6571 2c20 636d 203d 2046 616c 7365   seq, cm = False
-00049d00: 2c20 6376 675f 6465 7020 3d20 302c 2078  , cvg_dep = 0, x
-00049d10: 7320 3d20 7365 6c66 2e69 7374 7261 6e64  s = self.istrand
-00049d20: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00049d30: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
-00049d40: 662e 6364 732e 7267 6e73 2e61 7070 656e  f.cds.rgns.appen
-00049d50: 6428 2072 2029 0a20 2020 2020 2020 2020  d( r ).         
-00049d60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00049d70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00049d80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00049d90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00049da0: 230a 2020 2020 2020 2020 2020 2020 2020  #.              
-00049db0: 2020 2020 2020 2020 2020 6220 3d20 5472            b = Tr
-00049dc0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00049dd0: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-00049de0: 2c73 2069 6e20 656e 756d 6572 6174 6528  ,s in enumerate(
-00049df0: 6364 735f 7267 6e73 293a 0a20 2020 2020  cds_rgns):.     
+00049cb0: 2062 203d 2054 7275 650a 2020 2020 2020   b = True.      
+00049cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049cd0: 2020 666f 7220 6d2c 7320 696e 2065 6e75    for m,s in enu
+00049ce0: 6d65 7261 7465 2863 6473 5f72 676e 7329  merate(cds_rgns)
+00049cf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00049d00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00049d10: 2072 2e69 735f 7468 655f 7361 6d65 5f61   r.is_the_same_a
+00049d20: 7328 7329 3a0a 2020 2020 2020 2020 2020  s(s):.          
+00049d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049d40: 2020 2020 2020 7365 6c66 2e74 635f 746f        self.tc_to
+00049d50: 5f67 635f 6d61 702e 6170 7065 6e64 286d  _gc_map.append(m
+00049d60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00049d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049d80: 2020 6220 3d20 4661 6c73 650a 2020 2020    b = False.    
+00049d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049da0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00049db0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00049dc0: 2020 2020 2020 2020 2020 6966 2062 3a20            if b: 
+00049dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049de0: 2020 2020 2020 2020 2020 2020 206d 203d               m =
+00049df0: 206c 656e 2863 6473 5f72 676e 7329 0a20   len(cds_rgns). 
 00049e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e10: 2020 2020 2020 2069 6620 722e 6973 5f74         if r.is_t
-00049e20: 6865 5f73 616d 655f 6173 2873 293a 0a20  he_same_as(s):. 
-00049e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00049e50: 656c 662e 7463 5f74 6f5f 6763 5f6d 6170  elf.tc_to_gc_map
-00049e60: 2e61 7070 656e 6428 6d29 0a20 2020 2020  .append(m).     
+00049e10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00049e20: 7463 5f74 6f5f 6763 5f6d 6170 2e61 7070  tc_to_gc_map.app
+00049e30: 656e 6428 6d29 0a20 2020 2020 2020 2020  end(m).         
+00049e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049e50: 2020 2063 6473 5f72 676e 732e 6170 7065     cds_rgns.appe
+00049e60: 6e64 2820 7220 290a 2020 2020 2020 2020  nd( r ).        
 00049e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e80: 2020 2020 2020 2020 2020 2062 203d 2046             b = F
-00049e90: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00049ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049eb0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-00049ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ed0: 2020 2069 6620 623a 200a 2020 2020 2020     if b: .      
-00049ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ef0: 2020 2020 2020 6d20 3d20 6c65 6e28 6364        m = len(cd
-00049f00: 735f 7267 6e73 290a 2020 2020 2020 2020  s_rgns).        
-00049f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049f20: 2020 2020 7365 6c66 2e74 635f 746f 5f67      self.tc_to_g
-00049f30: 635f 6d61 702e 6170 7065 6e64 286d 290a  c_map.append(m).
-00049f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049f50: 2020 2020 2020 2020 2020 2020 6364 735f              cds_
-00049f60: 7267 6e73 2e61 7070 656e 6428 2072 2029  rgns.append( r )
-00049f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049f80: 2020 2020 2020 2020 2023 2323 2323 2323           #######
-00049f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00049fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00049fb0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00049fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049fd0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00049fe0: 2020 2020 2020 2020 2065 6c69 6620 2867           elif (g
-00049ff0: 7466 6c2e 6665 6174 7572 6520 3d3d 2027  tfl.feature == '
-0004a000: 7472 616e 7363 7269 7074 2729 3a0a 2020  transcript'):.  
-0004a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a020: 2020 2020 2020 6578 6f6e 5f6e 756d 2c20        exon_num, 
-0004a030: 636f 762c 2061 626e 2c20 7365 712c 2065  cov, abn, seq, e
-0004a040: 766e 742c 2073 7473 2c20 6366 203d 2067  vnt, sts, cf = g
-0004a050: 6574 5f6f 7468 6572 5f61 7474 7273 5f66  et_other_attrs_f
-0004a060: 726f 6d5f 6774 665f 6174 7472 2867 7466  rom_gtf_attr(gtf
-0004a070: 6c2e 6174 7472 290a 0a20 2020 2020 2020  l.attr)..       
-0004a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a090: 2069 6620 6162 6e20 3e3d 2030 3a20 7365   if abn >= 0: se
-0004a0a0: 6c66 2e61 626e 203d 2061 626e 0a20 2020  lf.abn = abn.   
-0004a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a0c0: 2020 2020 2069 6620 636f 7620 3e3d 2030       if cov >= 0
-0004a0d0: 3a20 7365 6c66 2e63 6f76 203d 2063 6f76  : self.cov = cov
-0004a0e0: 0a20 2020 2020 2020 2020 2020 2027 2727  .            '''
-0004a0f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0004a100: 6c65 6e28 7365 6c66 2e74 655f 746f 5f67  len(self.te_to_g
-0004a110: 655f 6d61 7029 203d 3d20 303a 0a20 2020  e_map) == 0:.   
-0004a120: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0004a130: 6e74 2827 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  nt('============
-0004a140: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d27 290a  =============').
-0004a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a160: 666f 7220 6774 666c 2069 6e20 6774 665f  for gtfl in gtf_
-0004a170: 6c69 6e65 735f 6f66 5f61 5f74 723a 0a20  lines_of_a_tr:. 
-0004a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a190: 2020 2070 7269 6e74 5f67 7466 2867 7466     print_gtf(gtf
-0004a1a0: 6c29 0a20 2020 2020 2020 2020 2020 2027  l).            '
-0004a1b0: 2727 200a 0a20 2020 2020 2020 2020 2020  '' ..           
-0004a1c0: 2069 6620 6c65 6e28 7365 6c66 2e74 635f   if len(self.tc_
-0004a1d0: 746f 5f67 635f 6d61 7029 203e 2030 3a20  to_gc_map) > 0: 
-0004a1e0: 7365 6c66 2e69 6364 7320 3d20 310a 2020  self.icds = 1.  
-0004a1f0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0004a200: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0004a210: 746c 656e 203d 2074 5f6c 656e 0a20 2020  tlen = t_len.   
-0004a220: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0004a230: 2e63 6f76 203e 3d20 303a 2073 656c 662e  .cov >= 0: self.
-0004a240: 636f 765f 6c65 6e20 3d20 696e 7428 7365  cov_len = int(se
-0004a250: 6c66 2e63 6f76 2a74 5f6c 656e 290a 2020  lf.cov*t_len).  
-0004a260: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0004a270: 6c65 6e20 3d20 705f 6c65 6e0a 2020 2020  len = p_len.    
-0004a280: 2020 2020 2020 2020 7365 6c66 2e6e 6578          self.nex
-0004a290: 6f6e 7320 3d20 6563 6e74 0a20 2020 2020  ons = ecnt.     
-0004a2a0: 2020 2020 2020 2023 2073 656c 662e 7465         # self.te
-0004a2b0: 5f74 6f5f 6765 5f6d 6170 203d 206e 702e  _to_ge_map = np.
-0004a2c0: 6675 6c6c 2865 636e 742c 2d31 2c20 6474  full(ecnt,-1, dt
-0004a2d0: 7970 6520 3d20 6e70 2e69 6e74 3332 290a  ype = np.int32).
-0004a2e0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0004a2f0: 2020 2020 2020 2020 2069 6620 705f 6c65           if p_le
-0004a300: 6e20 3d3d 2030 3a0a 2020 2020 2020 2020  n == 0:.        
-0004a310: 2020 2020 2020 2020 6966 2028 7374 6172          if (star
-0004a320: 7420 3e3d 2030 2920 2620 2873 746f 7020  t >= 0) & (stop 
-0004a330: 3e3d 2030 293a 0a20 2020 2020 2020 2020  >= 0):.         
-0004a340: 2020 2020 2020 2020 2020 2070 5f6c 656e             p_len
-0004a350: 203d 2073 746f 7020 2d20 7374 6172 740a   = stop - start.
-0004a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a370: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-0004a380: 2020 2020 2020 2020 2065 6c69 6620 2873           elif (s
-0004a390: 7461 7274 203e 3d20 3029 2026 2028 7374  tart >= 0) & (st
-0004a3a0: 6f70 203c 2030 293a 0a20 2020 2020 2020  op < 0):.       
-0004a3b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004a3c0: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-0004a3d0: 2020 2057 4152 4e49 4e47 2074 7261 6e73     WARNING trans
-0004a3e0: 6372 6970 745f 6465 7363 7269 7074 6f72  cript_descriptor
-0004a3f0: 3a69 6e69 743a 2028 4129 2073 7461 7274  :init: (A) start
-0004a400: 2025 692c 2073 746f 7020 2569 2c20 506c   %i, stop %i, Pl
-0004a410: 656e 203d 2025 6927 2025 2028 7374 6172  en = %i' % (star
-0004a420: 742c 2073 746f 702c 2070 5f6c 656e 2929  t, stop, p_len))
-0004a430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a440: 2020 2020 2070 5f6c 656e 203d 2074 5f6c       p_len = t_l
-0004a450: 656e 202d 2073 7461 7274 0a20 2020 2020  en - start.     
-0004a460: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004a470: 656c 662e 6c65 6e5f 6f73 203d 2070 5f6c  elf.len_os = p_l
-0004a480: 656e 2533 0a20 2020 2020 2020 2020 2020  en%3.           
-0004a490: 2020 2020 2020 2020 2073 746f 7020 3d20           stop = 
-0004a4a0: 7374 6172 7420 2b20 705f 6c65 6e20 2d20  start + p_len - 
-0004a4b0: 7365 6c66 2e6c 656e 5f6f 730a 2020 2020  self.len_os.    
-0004a4c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0004a4d0: 2028 7374 6172 7420 3c20 3029 2026 2028   (start < 0) & (
-0004a4e0: 7374 6f70 203e 3d20 3029 3a0a 2020 2020  stop >= 0):.    
-0004a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a500: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0004a510: 7428 2720 2020 5741 524e 494e 4720 7472  t('   WARNING tr
-0004a520: 616e 7363 7269 7074 5f64 6573 6372 6970  anscript_descrip
-0004a530: 746f 723a 696e 6974 3a20 2842 2920 7374  tor:init: (B) st
-0004a540: 6172 7420 2569 2c20 7374 6f70 2025 692c  art %i, stop %i,
-0004a550: 2050 6c65 6e20 3d20 2569 2720 2520 2873   Plen = %i' % (s
-0004a560: 7461 7274 2c20 7374 6f70 2c20 705f 6c65  tart, stop, p_le
-0004a570: 6e29 290a 2020 2020 2020 2020 2020 2020  n)).            
-0004a580: 2020 2020 2020 2020 705f 6c65 6e20 3d20          p_len = 
-0004a590: 7374 6f70 0a20 2020 2020 2020 2020 2020  stop.           
-0004a5a0: 2020 2020 2020 2020 2073 656c 662e 6c65           self.le
-0004a5b0: 6e5f 6f73 203d 2070 5f6c 656e 2533 0a20  n_os = p_len%3. 
-0004a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a5d0: 2020 2073 7461 7274 203d 2073 746f 7020     start = stop 
-0004a5e0: 2d20 2870 5f6c 656e 202d 2073 656c 662e  - (p_len - self.
-0004a5f0: 6c65 6e5f 6f73 290a 2020 2020 2020 2020  len_os).        
-0004a600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0004a610: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0004a620: 656e 5f6f 7320 3d20 705f 6c65 6e25 330a  en_os = p_len%3.
-0004a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a640: 6966 2028 7374 6172 7420 3e3d 2030 2920  if (start >= 0) 
-0004a650: 2620 2873 746f 7020 3e3d 2030 293a 0a20  & (stop >= 0):. 
-0004a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a670: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0004a680: 2020 2020 2020 2020 656c 6966 2028 7374          elif (st
-0004a690: 6172 7420 3e3d 2030 2920 2620 2873 746f  art >= 0) & (sto
-0004a6a0: 7020 3c20 3029 3a0a 2020 2020 2020 2020  p < 0):.        
-0004a6b0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0004a6c0: 6572 626f 7365 3a20 7072 696e 7428 2720  erbose: print(' 
-0004a6d0: 2020 5741 524e 494e 4720 7472 616e 7363    WARNING transc
-0004a6e0: 7269 7074 5f64 6573 6372 6970 746f 723a  ript_descriptor:
-0004a6f0: 696e 6974 3a20 2843 2920 7374 6172 7420  init: (C) start 
-0004a700: 2569 2c20 7374 6f70 2025 692c 2050 6c65  %i, stop %i, Ple
-0004a710: 6e20 3d20 2569 2720 2520 2873 7461 7274  n = %i' % (start
-0004a720: 2c20 7374 6f70 2c20 705f 6c65 6e29 290a  , stop, p_len)).
-0004a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a740: 2020 2020 7374 6f70 203d 2073 7461 7274      stop = start
-0004a750: 202b 2070 5f6c 656e 0a20 2020 2020 2020   + p_len.       
-0004a760: 2020 2020 2020 2020 2065 6c69 6620 2873           elif (s
-0004a770: 7461 7274 203c 2030 2920 2620 2873 746f  tart < 0) & (sto
-0004a780: 7020 3e3d 2030 293a 0a20 2020 2020 2020  p >= 0):.       
-0004a790: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004a7a0: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-0004a7b0: 2020 2057 4152 4e49 4e47 2074 7261 6e73     WARNING trans
-0004a7c0: 6372 6970 745f 6465 7363 7269 7074 6f72  cript_descriptor
-0004a7d0: 3a69 6e69 743a 2028 4429 2073 7461 7274  :init: (D) start
-0004a7e0: 2025 692c 2073 746f 7020 2569 2c20 506c   %i, stop %i, Pl
-0004a7f0: 656e 203d 2025 6927 2025 2028 7374 6172  en = %i' % (star
-0004a800: 742c 2073 746f 702c 2070 5f6c 656e 2929  t, stop, p_len))
-0004a810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a820: 2020 2020 2073 7461 7274 203d 2073 746f       start = sto
-0004a830: 7020 2d20 2870 5f6c 656e 202d 2073 656c  p - (p_len - sel
-0004a840: 662e 6c65 6e5f 6f73 290a 2020 2020 2020  f.len_os).      
-0004a850: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0004a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a870: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
-0004a880: 7072 696e 7428 2720 2020 5741 524e 494e  print('   WARNIN
-0004a890: 4720 7472 616e 7363 7269 7074 5f64 6573  G transcript_des
-0004a8a0: 6372 6970 746f 723a 696e 6974 3a20 2845  criptor:init: (E
-0004a8b0: 2920 7374 6172 7420 2569 2c20 7374 6f70  ) start %i, stop
-0004a8c0: 2025 692c 2050 6c65 6e20 3d20 2569 2720   %i, Plen = %i' 
-0004a8d0: 2520 2873 7461 7274 2c20 7374 6f70 2c20  % (start, stop, 
-0004a8e0: 705f 6c65 6e29 290a 2020 2020 2020 2020  p_len)).        
-0004a8f0: 2020 2020 0a0a 2020 2020 2020 2020 2020      ..          
-0004a900: 2020 6966 2028 705f 6c65 6e20 3e20 3029    if (p_len > 0)
-0004a910: 2026 2028 7374 6172 7420 3e3d 2030 2920   & (start >= 0) 
-0004a920: 2620 2873 746f 7020 3e3d 2030 293a 0a20  & (stop >= 0):. 
-0004a930: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004a940: 6620 7365 6c66 2e69 7374 7261 6e64 203e  f self.istrand >
-0004a950: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0004a960: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0004a970: 735f 7374 6172 7420 3d20 7374 6172 740a  s_start = start.
-0004a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a990: 2020 2020 6966 2028 7374 6172 7420 3e3d      if (start >=
-0004a9a0: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
-0004a9b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004a9c0: 7374 6f70 203c 2030 3a20 7374 6f70 203d  stop < 0: stop =
-0004a9d0: 2073 7461 7274 202b 2070 5f6c 656e 2023   start + p_len #
-0004a9e0: 2320 6f73 206d 6179 206e 6f74 2062 6520  # os may not be 
-0004a9f0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-0004aa00: 2020 2020 2020 7365 6c66 2e70 6f73 5f73        self.pos_s
-0004aa10: 746f 7020 3d20 7374 6f70 0a20 2020 2020  top = stop.     
-0004aa20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0004aa30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004aa40: 2020 2020 2073 656c 662e 706f 735f 7374       self.pos_st
-0004aa50: 6172 7420 3d20 745f 6c65 6e20 2d20 7374  art = t_len - st
-0004aa60: 6172 7420 2d20 330a 2020 2020 2020 2020  art - 3.        
-0004aa70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0004aa80: 2e70 6f73 5f73 746f 7020 3d20 745f 6c65  .pos_stop = t_le
-0004aa90: 6e20 2d20 7374 6f70 202d 2033 0a20 2020  n - stop - 3.   
-0004aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aab0: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-0004aac0: 206c 656e 2873 656c 662e 7073 6571 2920   len(self.pseq) 
-0004aad0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0004aae0: 2020 2020 2069 6620 7365 6c66 2e69 7374       if self.ist
-0004aaf0: 7261 6e64 203e 2030 3a0a 2020 2020 2020  rand > 0:.      
-0004ab00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004ab10: 6966 206c 656e 2873 656c 662e 7073 6571  if len(self.pseq
-0004ab20: 2925 3320 213d 2030 3a0a 2020 2020 2020  )%3 != 0:.      
-0004ab30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004ab40: 2020 2020 7072 696e 7428 2720 2020 5741      print('   WA
-0004ab50: 524e 494e 4720 7472 616e 7363 7269 7074  RNING transcript
-0004ab60: 5f64 6573 6372 6970 746f 723a 696e 6974  _descriptor:init
-0004ab70: 3a20 2845 2920 472f 5449 443a 2025 732c  : (E) G/TID: %s,
-0004ab80: 2025 732c 204c 656e 203d 2025 6927 2025   %s, Len = %i' %
-0004ab90: 2028 7365 6c66 2e67 6964 2c20 7365 6c66   (self.gid, self
-0004aba0: 2e74 6964 2c20 6c65 6e28 7365 6c66 2e70  .tid, len(self.p
-0004abb0: 7365 7129 2929 0a20 2020 2020 2020 2020  seq))).         
-0004abc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0004abd0: 6173 6571 203d 2074 7261 6e73 6c61 7465  aseq = translate
-0004abe0: 2873 656c 662e 7073 6571 290a 2020 2020  (self.pseq).    
-0004abf0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0004ac00: 2073 656c 662e 6973 7472 616e 6420 3c20   self.istrand < 
-0004ac10: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0004ac20: 2020 2020 2020 2023 2069 6620 6c65 6e28         # if len(
-0004ac30: 7365 6c66 2e70 7365 7129 2533 2021 3d20  self.pseq)%3 != 
-0004ac40: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0004ac50: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
-0004ac60: 6e74 2827 2020 2057 4152 4e49 4e47 2074  nt('   WARNING t
-0004ac70: 7261 6e73 6372 6970 745f 6465 7363 7269  ranscript_descri
-0004ac80: 7074 6f72 3a69 6e69 743a 2028 4529 2047  ptor:init: (E) G
-0004ac90: 2f54 4944 3a20 2573 2c20 2573 2c20 204c  /TID: %s, %s,  L
-0004aca0: 656e 203d 2025 6927 2025 2028 7365 6c66  en = %i' % (self
-0004acb0: 2e67 6964 2c20 7365 6c66 2e74 6964 2c20  .gid, self.tid, 
-0004acc0: 6c65 6e28 7365 6c66 2e70 7365 7129 2929  len(self.pseq)))
-0004acd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ace0: 2020 2020 2070 7365 7120 3d20 7265 7665       pseq = reve
-0004acf0: 7273 655f 636f 6d70 6c65 6d65 6e74 2873  rse_complement(s
-0004ad00: 656c 662e 7073 6571 290a 2020 2020 2020  elf.pseq).      
-0004ad10: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004ad20: 6c66 2e61 7365 7120 3d20 7472 616e 736c  lf.aseq = transl
-0004ad30: 6174 6528 7073 6571 290a 2020 2020 2020  ate(pseq).      
-0004ad40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0004ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ad60: 2020 2020 7072 696e 7428 2720 2020 5741      print('   WA
-0004ad70: 524e 494e 4720 7472 616e 7363 7269 7074  RNING transcript
-0004ad80: 5f64 6573 6372 6970 746f 723a 696e 6974  _descriptor:init
-0004ad90: 3a20 2845 2920 472f 5449 443a 2025 732c  : (E) G/TID: %s,
-0004ada0: 2025 732c 2053 7472 616e 6420 756e 7370   %s, Strand unsp
-0004adb0: 6563 6966 6965 6427 2025 2028 7365 6c66  ecified' % (self
-0004adc0: 2e67 6964 2c20 7365 6c66 2e74 6964 2920  .gid, self.tid) 
-0004add0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004ade0: 2020 0a20 2020 2020 2020 2072 6574 7572    .        retur
-0004adf0: 6e20 2320 7365 6c66 2e74 655f 746f 5f67  n # self.te_to_g
-0004ae00: 655f 6d61 700a 2020 2020 2020 2020 2020  e_map.          
-0004ae10: 2020 2020 2020 0a0a 2020 2020 2727 270a        ..    '''.
-0004ae20: 2020 2020 434f 444f 4e5f 4e4f 545f 5350      CODON_NOT_SP
-0004ae30: 4543 4946 4945 4420 3d20 2d31 0a20 2020  ECIFIED = -1.   
-0004ae40: 2043 4f44 4f4e 5f56 414c 4944 203d 2030   CODON_VALID = 0
-0004ae50: 0a20 2020 2043 4f44 4f4e 5f4e 4f54 5f43  .    CODON_NOT_C
-0004ae60: 4f56 4552 4544 203d 2031 0a20 2020 2043  OVERED = 1.    C
-0004ae70: 4f44 4f4e 5f57 4954 485f 5641 5249 414e  ODON_WITH_VARIAN
-0004ae80: 5420 3d20 320a 2020 2020 434f 444f 4e5f  T = 2.    CODON_
-0004ae90: 5749 5448 5f49 4e44 454c 203d 2033 0a20  WITH_INDEL = 3. 
-0004aea0: 2020 2043 4f44 4f4e 5f52 454c 4f43 4154     CODON_RELOCAT
-0004aeb0: 4544 203d 2034 0a20 2020 2043 4f44 4f4e  ED = 4.    CODON
-0004aec0: 5f4e 4f54 5f49 4445 4e54 4946 4945 4420  _NOT_IDENTIFIED 
-0004aed0: 3d20 350a 2020 2020 434f 444f 4e5f 504f  = 5.    CODON_PO
-0004aee0: 535f 4553 5449 4d41 5445 4420 3d20 360a  S_ESTIMATED = 6.
-0004aef0: 2020 2020 2727 270a 0a20 2020 2064 6566      '''..    def
-0004af00: 2063 6865 636b 5f73 7461 7274 5f73 746f   check_start_sto
-0004af10: 705f 636f 646f 6e5f 706f 7328 7365 6c66  p_codon_pos(self
-0004af20: 2c20 6578 6f6e 732c 2076 6572 626f 7365  , exons, verbose
-0004af30: 203d 2046 616c 7365 293a 0a20 2020 2020   = False):.     
-0004af40: 2020 200a 2020 2020 2020 2020 6966 2028     .        if (
-0004af50: 6578 6f6e 7320 6973 206e 6f74 204e 6f6e  exons is not Non
-0004af60: 6529 3a20 0a20 2020 2020 2020 2020 2020  e): .           
-0004af70: 2023 2065 786f 6e73 203d 2073 656c 662e   # exons = self.
-0004af80: 6578 6f6e 730a 2020 2020 2020 2020 2020  exons.          
-0004af90: 2020 0a20 2020 2020 2020 2020 2020 2023    .            #
-0004afa0: 2320 5570 6461 7465 2073 7461 7274 2f73  # Update start/s
-0004afb0: 746f 7020 636f 646f 6e0a 2020 2020 2020  top codon.      
-0004afc0: 2020 2020 2020 6966 2028 7365 6c66 2e73        if (self.s
-0004afd0: 7461 7274 5f63 6f64 6f6e 5f70 6f73 5f6f  tart_codon_pos_o
-0004afe0: 7267 5b30 5d20 3e20 3029 3a0a 2020 2020  rg[0] > 0):.    
-0004aff0: 2020 2020 2020 2020 2020 2020 2320 6669              # fi
-0004b000: 6e64 2065 786f 6e20 7468 6174 2063 6f6e  nd exon that con
-0004b010: 7461 696e 7320 7374 6172 7420 636f 646f  tains start codo
-0004b020: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-0004b030: 2020 7363 203d 2072 6567 696f 6e28 2073    sc = region( s
-0004b040: 656c 662e 6368 722c 2073 656c 662e 7374  elf.chr, self.st
-0004b050: 6172 745f 636f 646f 6e5f 706f 735f 6f72  art_codon_pos_or
-0004b060: 675b 305d 2c20 7365 6c66 2e73 7461 7274  g[0], self.start
-0004b070: 5f63 6f64 6f6e 5f70 6f73 5f6f 7267 5b31  _codon_pos_org[1
-0004b080: 5d2c 2027 4d27 290a 2020 2020 2020 2020  ], 'M').        
-0004b090: 2020 2020 2020 2020 6220 3d20 2d31 0a20          b = -1. 
-0004b0a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004b0b0: 656c 662e 7374 6172 745f 636f 646f 6e5f  elf.start_codon_
-0004b0c0: 6576 656e 7420 3d20 434f 444f 4e5f 4e4f  event = CODON_NO
-0004b0d0: 545f 434f 5645 5245 440a 2020 2020 2020  T_COVERED.      
-0004b0e0: 2020 2020 2020 2020 2020 666f 7220 6520            for e 
-0004b0f0: 696e 2065 786f 6e73 2e72 676e 733a 0a20  in exons.rgns:. 
+00049e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00049e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00049ea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00049eb0: 2323 0a20 2020 2020 2020 2020 2020 2020  ##.             
+00049ec0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00049ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ee0: 656c 6966 2028 6774 666c 2e66 6561 7475  elif (gtfl.featu
+00049ef0: 7265 203d 3d20 2774 7261 6e73 6372 6970  re == 'transcrip
+00049f00: 7427 293a 0a20 2020 2020 2020 2020 2020  t'):.           
+00049f10: 2020 2020 2020 2020 2020 2020 2065 786f               exo
+00049f20: 6e5f 6e75 6d2c 2063 6f76 2c20 6162 6e2c  n_num, cov, abn,
+00049f30: 2073 6571 2c20 6576 6e74 2c20 7374 732c   seq, evnt, sts,
+00049f40: 2063 6620 3d20 6765 745f 6f74 6865 725f   cf = get_other_
+00049f50: 6174 7472 735f 6672 6f6d 5f67 7466 5f61  attrs_from_gtf_a
+00049f60: 7474 7228 6774 666c 2e61 7474 7229 0a0a  ttr(gtfl.attr)..
+00049f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049f80: 2020 2020 2020 2020 6966 2061 626e 203e          if abn >
+00049f90: 3d20 303a 2073 656c 662e 6162 6e20 3d20  = 0: self.abn = 
+00049fa0: 6162 6e0a 2020 2020 2020 2020 2020 2020  abn.            
+00049fb0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00049fc0: 6f76 203e 3d20 303a 2073 656c 662e 636f  ov >= 0: self.co
+00049fd0: 7620 3d20 636f 760a 2020 2020 2020 2020  v = cov.        
+00049fe0: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
+00049ff0: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+0004a000: 7465 5f74 6f5f 6765 5f6d 6170 2920 3d3d  te_to_ge_map) ==
+0004a010: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0004a020: 2020 2020 7072 696e 7428 273d 3d3d 3d3d      print('=====
+0004a030: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0004a040: 3d3d 3d3d 2729 0a20 2020 2020 2020 2020  ====').         
+0004a050: 2020 2020 2020 2066 6f72 2067 7466 6c20         for gtfl 
+0004a060: 696e 2067 7466 5f6c 696e 6573 5f6f 665f  in gtf_lines_of_
+0004a070: 615f 7472 3a0a 2020 2020 2020 2020 2020  a_tr:.          
+0004a080: 2020 2020 2020 2020 2020 7072 696e 745f            print_
+0004a090: 6774 6628 6774 666c 290a 2020 2020 2020  gtf(gtfl).      
+0004a0a0: 2020 2020 2020 2727 2720 0a0a 2020 2020        ''' ..    
+0004a0b0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+0004a0c0: 656c 662e 7463 5f74 6f5f 6763 5f6d 6170  elf.tc_to_gc_map
+0004a0d0: 2920 3e20 303a 2073 656c 662e 6963 6473  ) > 0: self.icds
+0004a0e0: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
+0004a0f0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0004a100: 2020 7365 6c66 2e74 6c65 6e20 3d20 745f    self.tlen = t_
+0004a110: 6c65 6e0a 2020 2020 2020 2020 2020 2020  len.            
+0004a120: 6966 2073 656c 662e 636f 7620 3e3d 2030  if self.cov >= 0
+0004a130: 3a20 7365 6c66 2e63 6f76 5f6c 656e 203d  : self.cov_len =
+0004a140: 2069 6e74 2873 656c 662e 636f 762a 745f   int(self.cov*t_
+0004a150: 6c65 6e29 0a20 2020 2020 2020 2020 2020  len).           
+0004a160: 2073 656c 662e 706c 656e 203d 2070 5f6c   self.plen = p_l
+0004a170: 656e 0a20 2020 2020 2020 2020 2020 2073  en.            s
+0004a180: 656c 662e 6e65 786f 6e73 203d 2065 636e  elf.nexons = ecn
+0004a190: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+0004a1a0: 7365 6c66 2e74 655f 746f 5f67 655f 6d61  self.te_to_ge_ma
+0004a1b0: 7020 3d20 6e70 2e66 756c 6c28 6563 6e74  p = np.full(ecnt
+0004a1c0: 2c2d 312c 2064 7479 7065 203d 206e 702e  ,-1, dtype = np.
+0004a1d0: 696e 7433 3229 0a20 2020 2020 2020 2020  int32).         
+0004a1e0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0004a1f0: 6966 2070 5f6c 656e 203d 3d20 303a 0a20  if p_len == 0:. 
+0004a200: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004a210: 6620 2873 7461 7274 203e 3d20 3029 2026  f (start >= 0) &
+0004a220: 2028 7374 6f70 203e 3d20 3029 3a0a 2020   (stop >= 0):.  
+0004a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a240: 2020 705f 6c65 6e20 3d20 7374 6f70 202d    p_len = stop -
+0004a250: 2073 7461 7274 0a20 2020 2020 2020 2020   start.         
+0004a260: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+0004a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a280: 656c 6966 2028 7374 6172 7420 3e3d 2030  elif (start >= 0
+0004a290: 2920 2620 2873 746f 7020 3c20 3029 3a0a  ) & (stop < 0):.
+0004a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a2b0: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+0004a2c0: 7072 696e 7428 2720 2020 5741 524e 494e  print('   WARNIN
+0004a2d0: 4720 7472 616e 7363 7269 7074 5f64 6573  G transcript_des
+0004a2e0: 6372 6970 746f 723a 696e 6974 3a20 2841  criptor:init: (A
+0004a2f0: 2920 7374 6172 7420 2569 2c20 7374 6f70  ) start %i, stop
+0004a300: 2025 692c 2050 6c65 6e20 3d20 2569 2720   %i, Plen = %i' 
+0004a310: 2520 2873 7461 7274 2c20 7374 6f70 2c20  % (start, stop, 
+0004a320: 705f 6c65 6e29 290a 2020 2020 2020 2020  p_len)).        
+0004a330: 2020 2020 2020 2020 2020 2020 705f 6c65              p_le
+0004a340: 6e20 3d20 745f 6c65 6e20 2d20 7374 6172  n = t_len - star
+0004a350: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0004a360: 2020 2020 2020 7365 6c66 2e6c 656e 5f6f        self.len_o
+0004a370: 7320 3d20 705f 6c65 6e25 330a 2020 2020  s = p_len%3.    
+0004a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a390: 7374 6f70 203d 2073 7461 7274 202b 2070  stop = start + p
+0004a3a0: 5f6c 656e 202d 2073 656c 662e 6c65 6e5f  _len - self.len_
+0004a3b0: 6f73 0a20 2020 2020 2020 2020 2020 2020  os.             
+0004a3c0: 2020 2065 6c69 6620 2873 7461 7274 203c     elif (start <
+0004a3d0: 2030 2920 2620 2873 746f 7020 3e3d 2030   0) & (stop >= 0
+0004a3e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0004a3f0: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
+0004a400: 653a 2070 7269 6e74 2827 2020 2057 4152  e: print('   WAR
+0004a410: 4e49 4e47 2074 7261 6e73 6372 6970 745f  NING transcript_
+0004a420: 6465 7363 7269 7074 6f72 3a69 6e69 743a  descriptor:init:
+0004a430: 2028 4229 2073 7461 7274 2025 692c 2073   (B) start %i, s
+0004a440: 746f 7020 2569 2c20 506c 656e 203d 2025  top %i, Plen = %
+0004a450: 6927 2025 2028 7374 6172 742c 2073 746f  i' % (start, sto
+0004a460: 702c 2070 5f6c 656e 2929 0a20 2020 2020  p, p_len)).     
+0004a470: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0004a480: 5f6c 656e 203d 2073 746f 700a 2020 2020  _len = stop.    
+0004a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a4a0: 7365 6c66 2e6c 656e 5f6f 7320 3d20 705f  self.len_os = p_
+0004a4b0: 6c65 6e25 330a 2020 2020 2020 2020 2020  len%3.          
+0004a4c0: 2020 2020 2020 2020 2020 7374 6172 7420            start 
+0004a4d0: 3d20 7374 6f70 202d 2028 705f 6c65 6e20  = stop - (p_len 
+0004a4e0: 2d20 7365 6c66 2e6c 656e 5f6f 7329 0a20  - self.len_os). 
+0004a4f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0004a500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a510: 2073 656c 662e 6c65 6e5f 6f73 203d 2070   self.len_os = p
+0004a520: 5f6c 656e 2533 0a20 2020 2020 2020 2020  _len%3.         
+0004a530: 2020 2020 2020 2069 6620 2873 7461 7274         if (start
+0004a540: 203e 3d20 3029 2026 2028 7374 6f70 203e   >= 0) & (stop >
+0004a550: 3d20 3029 3a0a 2020 2020 2020 2020 2020  = 0):.          
+0004a560: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+0004a570: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004a580: 6c69 6620 2873 7461 7274 203e 3d20 3029  lif (start >= 0)
+0004a590: 2026 2028 7374 6f70 203c 2030 293a 0a20   & (stop < 0):. 
+0004a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a5b0: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
+0004a5c0: 7269 6e74 2827 2020 2057 4152 4e49 4e47  rint('   WARNING
+0004a5d0: 2074 7261 6e73 6372 6970 745f 6465 7363   transcript_desc
+0004a5e0: 7269 7074 6f72 3a69 6e69 743a 2028 4329  riptor:init: (C)
+0004a5f0: 2073 7461 7274 2025 692c 2073 746f 7020   start %i, stop 
+0004a600: 2569 2c20 506c 656e 203d 2025 6927 2025  %i, Plen = %i' %
+0004a610: 2028 7374 6172 742c 2073 746f 702c 2070   (start, stop, p
+0004a620: 5f6c 656e 2929 0a20 2020 2020 2020 2020  _len)).         
+0004a630: 2020 2020 2020 2020 2020 2073 746f 7020             stop 
+0004a640: 3d20 7374 6172 7420 2b20 705f 6c65 6e0a  = start + p_len.
+0004a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a660: 656c 6966 2028 7374 6172 7420 3c20 3029  elif (start < 0)
+0004a670: 2026 2028 7374 6f70 203e 3d20 3029 3a0a   & (stop >= 0):.
+0004a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a690: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+0004a6a0: 7072 696e 7428 2720 2020 5741 524e 494e  print('   WARNIN
+0004a6b0: 4720 7472 616e 7363 7269 7074 5f64 6573  G transcript_des
+0004a6c0: 6372 6970 746f 723a 696e 6974 3a20 2844  criptor:init: (D
+0004a6d0: 2920 7374 6172 7420 2569 2c20 7374 6f70  ) start %i, stop
+0004a6e0: 2025 692c 2050 6c65 6e20 3d20 2569 2720   %i, Plen = %i' 
+0004a6f0: 2520 2873 7461 7274 2c20 7374 6f70 2c20  % (start, stop, 
+0004a700: 705f 6c65 6e29 290a 2020 2020 2020 2020  p_len)).        
+0004a710: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0004a720: 7420 3d20 7374 6f70 202d 2028 705f 6c65  t = stop - (p_le
+0004a730: 6e20 2d20 7365 6c66 2e6c 656e 5f6f 7329  n - self.len_os)
+0004a740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a750: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0004a760: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+0004a770: 7262 6f73 653a 2070 7269 6e74 2827 2020  rbose: print('  
+0004a780: 2057 4152 4e49 4e47 2074 7261 6e73 6372   WARNING transcr
+0004a790: 6970 745f 6465 7363 7269 7074 6f72 3a69  ipt_descriptor:i
+0004a7a0: 6e69 743a 2028 4529 2073 7461 7274 2025  nit: (E) start %
+0004a7b0: 692c 2073 746f 7020 2569 2c20 506c 656e  i, stop %i, Plen
+0004a7c0: 203d 2025 6927 2025 2028 7374 6172 742c   = %i' % (start,
+0004a7d0: 2073 746f 702c 2070 5f6c 656e 2929 0a20   stop, p_len)). 
+0004a7e0: 2020 2020 2020 2020 2020 200a 0a20 2020             ..   
+0004a7f0: 2020 2020 2020 2020 2069 6620 2870 5f6c           if (p_l
+0004a800: 656e 203e 2030 2920 2620 2873 7461 7274  en > 0) & (start
+0004a810: 203e 3d20 3029 2026 2028 7374 6f70 203e   >= 0) & (stop >
+0004a820: 3d20 3029 3a0a 2020 2020 2020 2020 2020  = 0):.          
+0004a830: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+0004a840: 7472 616e 6420 3e3d 2030 3a0a 2020 2020  trand >= 0:.    
+0004a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a860: 7365 6c66 2e70 6f73 5f73 7461 7274 203d  self.pos_start =
+0004a870: 2073 7461 7274 0a20 2020 2020 2020 2020   start.         
+0004a880: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+0004a890: 7461 7274 203e 3d20 3029 3a0a 2020 2020  tart >= 0):.    
+0004a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a8b0: 2020 2020 6966 2073 746f 7020 3c20 303a      if stop < 0:
+0004a8c0: 2073 746f 7020 3d20 7374 6172 7420 2b20   stop = start + 
+0004a8d0: 705f 6c65 6e20 2323 206f 7320 6d61 7920  p_len ## os may 
+0004a8e0: 6e6f 7420 6265 2030 0a20 2020 2020 2020  not be 0.       
+0004a8f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0004a900: 662e 706f 735f 7374 6f70 203d 2073 746f  f.pos_stop = sto
+0004a910: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
+0004a920: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0004a930: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004a940: 2e70 6f73 5f73 7461 7274 203d 2074 5f6c  .pos_start = t_l
+0004a950: 656e 202d 2073 7461 7274 202d 2033 0a20  en - start - 3. 
+0004a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a970: 2020 2073 656c 662e 706f 735f 7374 6f70     self.pos_stop
+0004a980: 203d 2074 5f6c 656e 202d 2073 746f 7020   = t_len - stop 
+0004a990: 2d20 330a 2020 2020 2020 2020 2020 2020  - 3.            
+0004a9a0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0004a9b0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+0004a9c0: 2e70 7365 7129 203e 2030 3a0a 2020 2020  .pseq) > 0:.    
+0004a9d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0004a9e0: 656c 662e 6973 7472 616e 6420 3e20 303a  elf.istrand > 0:
+0004a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004aa00: 2020 2020 2023 2069 6620 6c65 6e28 7365       # if len(se
+0004aa10: 6c66 2e70 7365 7129 2533 2021 3d20 303a  lf.pseq)%3 != 0:
+0004aa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004aa30: 2020 2020 2023 2020 2020 2070 7269 6e74       #     print
+0004aa40: 2827 2020 2057 4152 4e49 4e47 2074 7261  ('   WARNING tra
+0004aa50: 6e73 6372 6970 745f 6465 7363 7269 7074  nscript_descript
+0004aa60: 6f72 3a69 6e69 743a 2028 4529 2047 2f54  or:init: (E) G/T
+0004aa70: 4944 3a20 2573 2c20 2573 2c20 4c65 6e20  ID: %s, %s, Len 
+0004aa80: 3d20 2569 2720 2520 2873 656c 662e 6769  = %i' % (self.gi
+0004aa90: 642c 2073 656c 662e 7469 642c 206c 656e  d, self.tid, len
+0004aaa0: 2873 656c 662e 7073 6571 2929 290a 2020  (self.pseq))).  
+0004aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aac0: 2020 7365 6c66 2e61 7365 7120 3d20 7472    self.aseq = tr
+0004aad0: 616e 736c 6174 6528 7365 6c66 2e70 7365  anslate(self.pse
+0004aae0: 7129 0a20 2020 2020 2020 2020 2020 2020  q).             
+0004aaf0: 2020 2065 6c69 6620 7365 6c66 2e69 7374     elif self.ist
+0004ab00: 7261 6e64 203c 2030 3a0a 2020 2020 2020  rand < 0:.      
+0004ab10: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0004ab20: 6966 206c 656e 2873 656c 662e 7073 6571  if len(self.pseq
+0004ab30: 2925 3320 213d 2030 3a0a 2020 2020 2020  )%3 != 0:.      
+0004ab40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0004ab50: 2020 2020 7072 696e 7428 2720 2020 5741      print('   WA
+0004ab60: 524e 494e 4720 7472 616e 7363 7269 7074  RNING transcript
+0004ab70: 5f64 6573 6372 6970 746f 723a 696e 6974  _descriptor:init
+0004ab80: 3a20 2845 2920 472f 5449 443a 2025 732c  : (E) G/TID: %s,
+0004ab90: 2025 732c 2020 4c65 6e20 3d20 2569 2720   %s,  Len = %i' 
+0004aba0: 2520 2873 656c 662e 6769 642c 2073 656c  % (self.gid, sel
+0004abb0: 662e 7469 642c 206c 656e 2873 656c 662e  f.tid, len(self.
+0004abc0: 7073 6571 2929 290a 2020 2020 2020 2020  pseq))).        
+0004abd0: 2020 2020 2020 2020 2020 2020 7073 6571              pseq
+0004abe0: 203d 2072 6576 6572 7365 5f63 6f6d 706c   = reverse_compl
+0004abf0: 656d 656e 7428 7365 6c66 2e70 7365 7129  ement(self.pseq)
+0004ac00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ac10: 2020 2020 2073 656c 662e 6173 6571 203d       self.aseq =
+0004ac20: 2074 7261 6e73 6c61 7465 2870 7365 7129   translate(pseq)
+0004ac30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ac40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0004ac50: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0004ac60: 2827 2020 2057 4152 4e49 4e47 2074 7261  ('   WARNING tra
+0004ac70: 6e73 6372 6970 745f 6465 7363 7269 7074  nscript_descript
+0004ac80: 6f72 3a69 6e69 743a 2028 4529 2047 2f54  or:init: (E) G/T
+0004ac90: 4944 3a20 2573 2c20 2573 2c20 5374 7261  ID: %s, %s, Stra
+0004aca0: 6e64 2075 6e73 7065 6369 6669 6564 2720  nd unspecified' 
+0004acb0: 2520 2873 656c 662e 6769 642c 2073 656c  % (self.gid, sel
+0004acc0: 662e 7469 6429 2029 0a20 2020 2020 2020  f.tid) ).       
+0004acd0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0004ace0: 2020 7265 7475 726e 2023 2073 656c 662e    return # self.
+0004acf0: 7465 5f74 6f5f 6765 5f6d 6170 0a20 2020  te_to_ge_map.   
+0004ad00: 2020 2020 2020 2020 2020 2020 200a 0a20               .. 
+0004ad10: 2020 2027 2727 0a20 2020 2043 4f44 4f4e     '''.    CODON
+0004ad20: 5f4e 4f54 5f53 5045 4349 4649 4544 203d  _NOT_SPECIFIED =
+0004ad30: 202d 310a 2020 2020 434f 444f 4e5f 5641   -1.    CODON_VA
+0004ad40: 4c49 4420 3d20 300a 2020 2020 434f 444f  LID = 0.    CODO
+0004ad50: 4e5f 4e4f 545f 434f 5645 5245 4420 3d20  N_NOT_COVERED = 
+0004ad60: 310a 2020 2020 434f 444f 4e5f 5749 5448  1.    CODON_WITH
+0004ad70: 5f56 4152 4941 4e54 203d 2032 0a20 2020  _VARIANT = 2.   
+0004ad80: 2043 4f44 4f4e 5f57 4954 485f 494e 4445   CODON_WITH_INDE
+0004ad90: 4c20 3d20 330a 2020 2020 434f 444f 4e5f  L = 3.    CODON_
+0004ada0: 5245 4c4f 4341 5445 4420 3d20 340a 2020  RELOCATED = 4.  
+0004adb0: 2020 434f 444f 4e5f 4e4f 545f 4944 454e    CODON_NOT_IDEN
+0004adc0: 5449 4649 4544 203d 2035 0a20 2020 2043  TIFIED = 5.    C
+0004add0: 4f44 4f4e 5f50 4f53 5f45 5354 494d 4154  ODON_POS_ESTIMAT
+0004ade0: 4544 203d 2036 0a20 2020 2027 2727 0a0a  ED = 6.    '''..
+0004adf0: 2020 2020 6465 6620 6368 6563 6b5f 7374      def check_st
+0004ae00: 6172 745f 7374 6f70 5f63 6f64 6f6e 5f70  art_stop_codon_p
+0004ae10: 6f73 2873 656c 662c 2065 786f 6e73 2c20  os(self, exons, 
+0004ae20: 7665 7262 6f73 6520 3d20 4661 6c73 6529  verbose = False)
+0004ae30: 3a0a 2020 2020 2020 2020 0a20 2020 2020  :.        .     
+0004ae40: 2020 2069 6620 2865 786f 6e73 2069 7320     if (exons is 
+0004ae50: 6e6f 7420 4e6f 6e65 293a 200a 2020 2020  not None): .    
+0004ae60: 2020 2020 2020 2020 2320 6578 6f6e 7320          # exons 
+0004ae70: 3d20 7365 6c66 2e65 786f 6e73 0a20 2020  = self.exons.   
+0004ae80: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0004ae90: 2020 2020 2020 2323 2055 7064 6174 6520        ## Update 
+0004aea0: 7374 6172 742f 7374 6f70 2063 6f64 6f6e  start/stop codon
+0004aeb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0004aec0: 2873 656c 662e 7374 6172 745f 636f 646f  (self.start_codo
+0004aed0: 6e5f 706f 735f 6f72 675b 305d 203e 2030  n_pos_org[0] > 0
+0004aee0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0004aef0: 2020 2023 2066 696e 6420 6578 6f6e 2074     # find exon t
+0004af00: 6861 7420 636f 6e74 6169 6e73 2073 7461  hat contains sta
+0004af10: 7274 2063 6f64 6f6e 0a20 2020 2020 2020  rt codon.       
+0004af20: 2020 2020 2020 2020 2073 6320 3d20 7265           sc = re
+0004af30: 6769 6f6e 2820 7365 6c66 2e63 6872 2c20  gion( self.chr, 
+0004af40: 7365 6c66 2e73 7461 7274 5f63 6f64 6f6e  self.start_codon
+0004af50: 5f70 6f73 5f6f 7267 5b30 5d2c 2073 656c  _pos_org[0], sel
+0004af60: 662e 7374 6172 745f 636f 646f 6e5f 706f  f.start_codon_po
+0004af70: 735f 6f72 675b 315d 2c20 274d 2729 0a20  s_org[1], 'M'). 
+0004af80: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0004af90: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
+0004afa0: 2020 2020 2020 7365 6c66 2e73 7461 7274        self.start
+0004afb0: 5f63 6f64 6f6e 5f65 7665 6e74 203d 2043  _codon_event = C
+0004afc0: 4f44 4f4e 5f4e 4f54 5f43 4f56 4552 4544  ODON_NOT_COVERED
+0004afd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004afe0: 2066 6f72 2065 2069 6e20 6578 6f6e 732e   for e in exons.
+0004aff0: 7267 6e73 3a0a 2020 2020 2020 2020 2020  rgns:.          
+0004b000: 2020 2020 2020 2020 2020 6966 2065 2e68            if e.h
+0004b010: 6173 5f65 7874 5f69 6e74 6572 7365 6374  as_ext_intersect
+0004b020: 696f 6e5f 7769 7468 2873 6329 3a0a 2020  ion_with(sc):.  
+0004b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b040: 2020 2020 2020 2320 6368 6563 6b20 636f        # check co
+0004b050: 6465 0a20 2020 2020 2020 2020 2020 2020  de.             
+0004b060: 2020 2020 2020 2020 2020 206c 6f63 203d             loc =
+0004b070: 2073 632e 7374 6172 7420 2d20 652e 7374   sc.start - e.st
+0004b080: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
+0004b090: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0004b0a0: 656c 662e 6973 7472 616e 6420 3e20 303a  elf.istrand > 0:
+0004b0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b0c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004b0d0: 286c 6f63 203e 3d20 3029 2026 2028 6c6f  (loc >= 0) & (lo
+0004b0e0: 6320 3c3d 2028 652e 6765 745f 6c65 6e28  c <= (e.get_len(
+0004b0f0: 292d 3329 293a 0a20 2020 2020 2020 2020  )-3)):.         
 0004b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b110: 2020 2069 6620 652e 6861 735f 6578 745f     if e.has_ext_
-0004b120: 696e 7465 7273 6563 7469 6f6e 5f77 6974  intersection_wit
-0004b130: 6828 7363 293a 0a20 2020 2020 2020 2020  h(sc):.         
-0004b140: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0004b150: 2063 6865 636b 2063 6f64 650a 2020 2020   check code.    
-0004b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b170: 2020 2020 6c6f 6320 3d20 7363 2e73 7461      loc = sc.sta
-0004b180: 7274 202d 2065 2e73 7461 7274 0a20 2020  rt - e.start.   
-0004b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b1a0: 2020 2020 2069 6620 7365 6c66 2e69 7374       if self.ist
-0004b1b0: 7261 6e64 203e 2030 3a0a 2020 2020 2020  rand > 0:.      
-0004b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b1d0: 2020 2020 2020 6966 2028 6c6f 6320 3e3d        if (loc >=
-0004b1e0: 2030 2920 2620 286c 6f63 203c 3d20 2865   0) & (loc <= (e
-0004b1f0: 2e67 6574 5f6c 656e 2829 2d33 2929 3a0a  .get_len()-3)):.
-0004b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b220: 7365 7120 3d20 652e 6765 745f 7365 7128  seq = e.get_seq(
-0004b230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b250: 2020 6966 2073 6571 5b6c 6f63 3a28 6c6f    if seq[loc:(lo
-0004b260: 632b 3329 5d20 3d3d 2053 5441 5254 5f43  c+3)] == START_C
-0004b270: 4f44 4f4e 3a0a 2020 2020 2020 2020 2020  ODON:.          
-0004b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b290: 2020 2020 2020 2020 2020 6220 3d20 300a            b = 0.
+0004b110: 2020 2020 2020 2073 6571 203d 2065 2e67         seq = e.g
+0004b120: 6574 5f73 6571 2829 0a20 2020 2020 2020  et_seq().       
+0004b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b140: 2020 2020 2020 2020 2069 6620 7365 715b           if seq[
+0004b150: 6c6f 633a 286c 6f63 2b33 295d 203d 3d20  loc:(loc+3)] == 
+0004b160: 5354 4152 545f 434f 444f 4e3a 0a20 2020  START_CODON:.   
+0004b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b190: 2062 203d 2030 0a20 2020 2020 2020 2020   b = 0.         
+0004b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b1b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004b1c0: 7374 6172 745f 636f 646f 6e5f 6576 656e  start_codon_even
+0004b1d0: 7420 3d20 434f 444f 4e5f 5641 4c49 440a  t = CODON_VALID.
+0004b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b200: 656c 6966 2073 6571 5b6c 6f63 3a28 6c6f  elif seq[loc:(lo
+0004b210: 632b 3329 5d2e 636f 756e 7428 274e 2729  c+3)].count('N')
+0004b220: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0004b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b240: 2020 2020 2020 2020 2020 6220 3d20 300a            b = 0.
+0004b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b270: 2020 2020 7365 6c66 2e73 7461 7274 5f63      self.start_c
+0004b280: 6f64 6f6e 5f65 7665 6e74 203d 2043 4f44  odon_event = COD
+0004b290: 4f4e 5f4e 4f54 5f43 4f56 4552 4544 0a20  ON_NOT_COVERED. 
 0004b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b2c0: 2020 2020 7365 6c66 2e73 7461 7274 5f63      self.start_c
-0004b2d0: 6f64 6f6e 5f65 7665 6e74 203d 2043 4f44  odon_event = COD
-0004b2e0: 4f4e 5f56 414c 4944 0a20 2020 2020 2020  ON_VALID.       
+0004b2b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004b2c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0004b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b2e0: 2020 2020 2020 2020 2062 203d 2031 0a20           b = 1. 
 0004b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b300: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-0004b310: 715b 6c6f 633a 286c 6f63 2b33 295d 2e63  q[loc:(loc+3)].c
-0004b320: 6f75 6e74 2827 4e27 2920 3e20 303a 0a20  ount('N') > 0:. 
+0004b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b310: 2020 2069 6620 6c65 6e28 7365 6c66 2e74     if len(self.t
+0004b320: 7365 7129 203e 2030 3a0a 2020 2020 2020  seq) > 0:.      
 0004b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b350: 2020 2062 203d 2030 0a20 2020 2020 2020     b = 0.       
-0004b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b370: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0004b380: 662e 7374 6172 745f 636f 646f 6e5f 6576  f.start_codon_ev
-0004b390: 656e 7420 3d20 434f 444f 4e5f 4e4f 545f  ent = CODON_NOT_
-0004b3a0: 434f 5645 5245 440a 2020 2020 2020 2020  COVERED.        
-0004b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b3c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0004b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b3f0: 2020 6220 3d20 310a 2020 2020 2020 2020    b = 1.        
+0004b350: 2020 7363 6f64 6f6e 5f6f 7267 203d 2073    scodon_org = s
+0004b360: 656c 662e 7473 6571 5b73 656c 662e 706f  elf.tseq[self.po
+0004b370: 735f 7374 6172 743a 2873 656c 662e 706f  s_start:(self.po
+0004b380: 735f 7374 6172 742b 3329 5d0a 2020 2020  s_start+3)].    
+0004b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b3b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0004b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b3d0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0004b3e0: 6f64 6f6e 5f6f 7267 203d 2053 5441 5254  odon_org = START
+0004b3f0: 5f43 4f44 4f4e 0a20 2020 2020 2020 2020  _CODON.         
 0004b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b410: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0004b420: 656e 2873 656c 662e 7473 6571 2920 3e20  en(self.tseq) > 
-0004b430: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0004b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b450: 2020 2020 2020 2020 2020 2073 636f 646f             scodo
-0004b460: 6e5f 6f72 6720 3d20 7365 6c66 2e74 7365  n_org = self.tse
-0004b470: 715b 7365 6c66 2e70 6f73 5f73 7461 7274  q[self.pos_start
-0004b480: 3a28 7365 6c66 2e70 6f73 5f73 7461 7274  :(self.pos_start
-0004b490: 2b33 295d 0a20 2020 2020 2020 2020 2020  +3)].           
-0004b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0004b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4e0: 2020 2020 2020 2073 636f 646f 6e5f 6f72         scodon_or
-0004b4f0: 6720 3d20 5354 4152 545f 434f 444f 4e0a  g = START_CODON.
-0004b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b520: 2020 2020 7365 6c66 2e73 7461 7274 5f63      self.start_c
-0004b530: 6f64 6f6e 5f65 7665 6e74 203d 2043 4f44  odon_event = COD
-0004b540: 4f4e 5f57 4954 485f 5641 5249 414e 540a  ON_WITH_VARIANT.
+0004b410: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004b420: 7374 6172 745f 636f 646f 6e5f 6576 656e  start_codon_even
+0004b430: 7420 3d20 434f 444f 4e5f 5749 5448 5f56  t = CODON_WITH_V
+0004b440: 4152 4941 4e54 0a20 2020 2020 2020 2020  ARIANT.         
+0004b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b460: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+0004b470: 7262 6f73 653a 2070 7269 6e74 2827 2020  rbose: print('  
+0004b480: 2053 4e50 2064 6574 6563 7465 6420 696e   SNP detected in
+0004b490: 2053 7461 7274 2063 6f64 6f6e 206f 6620   Start codon of 
+0004b4a0: 2573 3a20 2573 202d 3e20 2573 2720 2520  %s: %s -> %s' % 
+0004b4b0: 2873 656c 662e 7469 642c 2073 636f 646f  (self.tid, scodo
+0004b4c0: 6e5f 6f72 672c 2073 6571 5b6c 6f63 3a28  n_org, seq[loc:(
+0004b4d0: 6c6f 632b 3329 5d29 2029 0a20 2020 2020  loc+3)]) ).     
+0004b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b4f0: 2020 2020 2020 2065 6c69 6620 286c 6f63         elif (loc
+0004b500: 203e 2028 652e 6765 745f 6c65 6e28 292d   > (e.get_len()-
+0004b510: 3329 2920 7c20 286c 6f63 203c 2030 293a  3)) | (loc < 0):
+0004b520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b540: 2062 203d 2032 0a20 2020 2020 2020 2020   b = 2.         
 0004b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b570: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
-0004b580: 7072 696e 7428 2720 2020 534e 5020 6465  print('   SNP de
-0004b590: 7465 6374 6564 2069 6e20 5374 6172 7420  tected in Start 
-0004b5a0: 636f 646f 6e20 6f66 2025 733a 2025 7320  codon of %s: %s 
-0004b5b0: 2d3e 2025 7327 2025 2028 7365 6c66 2e74  -> %s' % (self.t
-0004b5c0: 6964 2c20 7363 6f64 6f6e 5f6f 7267 2c20  id, scodon_org, 
-0004b5d0: 7365 715b 6c6f 633a 286c 6f63 2b33 295d  seq[loc:(loc+3)]
-0004b5e0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0004b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b600: 656c 6966 2028 6c6f 6320 3e20 2865 2e67  elif (loc > (e.g
-0004b610: 6574 5f6c 656e 2829 2d33 2929 207c 2028  et_len()-3)) | (
-0004b620: 6c6f 6320 3c20 3029 3a0a 2020 2020 2020  loc < 0):.      
-0004b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b640: 2020 2020 2020 2020 2020 6220 3d20 320a            b = 2.
-0004b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b670: 7365 6c66 2e73 7461 7274 5f63 6f64 6f6e  self.start_codon
-0004b680: 5f65 7665 6e74 203d 2043 4f44 4f4e 5f57  _event = CODON_W
-0004b690: 4954 485f 494e 4445 4c0a 2020 2020 2020  ITH_INDEL.      
-0004b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b6b0: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-0004b6c0: 7428 2749 4e44 454c 206d 6967 6874 2068  t('INDEL might h
-0004b6d0: 6170 7065 6e27 290a 2020 2020 2020 2020  appen').        
-0004b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b6f0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-0004b700: 2749 4e46 4f20 696e 2075 7064 6174 655f  'INFO in update_
-0004b710: 696e 666f 3a20 2573 2073 7461 7274 2063  info: %s start c
-0004b720: 6f64 6f6e 2073 6565 6d73 2074 6f20 6265  odon seems to be
-0004b730: 206d 6f76 6564 2e20 2843 6f76 3a25 692c   moved. (Cov:%i,
-0004b740: 204c 3a25 6929 2720 2520 2873 656c 662e   L:%i)' % (self.
-0004b750: 7469 642c 2069 6e74 2831 3030 2a73 656c  tid, int(100*sel
-0004b760: 662e 636f 762f 7365 6c66 2e6c 656e 292c  f.cov/self.len),
-0004b770: 2073 656c 662e 6c65 6e29 290a 0a20 2020   self.len))..   
-0004b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b790: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
-0004b7a0: 7374 7261 6e64 203c 2030 3a0a 2020 2020  strand < 0:.    
-0004b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b7c0: 2020 2020 2020 2020 6966 2028 6c6f 6320          if (loc 
-0004b7d0: 3e3d 2030 2920 2620 286c 6f63 203c 3d20  >= 0) & (loc <= 
-0004b7e0: 2865 2e67 6574 5f6c 656e 2829 2d33 2929  (e.get_len()-3))
-0004b7f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b810: 2020 7365 7120 3d20 652e 6765 745f 7365    seq = e.get_se
-0004b820: 7128 290a 2020 2020 2020 2020 2020 2020  q().            
-0004b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b840: 2020 2020 6966 2073 6571 5b6c 6f63 3a28      if seq[loc:(
-0004b850: 6c6f 632b 3329 5d20 3d3d 2072 635f 5354  loc+3)] == rc_ST
-0004b860: 4152 545f 434f 444f 4e3a 0a20 2020 2020  ART_CODON:.     
-0004b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b880: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0004b890: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0004b560: 2020 2020 2020 2073 656c 662e 7374 6172         self.star
+0004b570: 745f 636f 646f 6e5f 6576 656e 7420 3d20  t_codon_event = 
+0004b580: 434f 444f 4e5f 5749 5448 5f49 4e44 454c  CODON_WITH_INDEL
+0004b590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b5b0: 2023 2070 7269 6e74 2827 494e 4445 4c20   # print('INDEL 
+0004b5c0: 6d69 6768 7420 6861 7070 656e 2729 0a20  might happen'). 
+0004b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b5e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0004b5f0: 2070 7269 6e74 2827 494e 464f 2069 6e20   print('INFO in 
+0004b600: 7570 6461 7465 5f69 6e66 6f3a 2025 7320  update_info: %s 
+0004b610: 7374 6172 7420 636f 646f 6e20 7365 656d  start codon seem
+0004b620: 7320 746f 2062 6520 6d6f 7665 642e 2028  s to be moved. (
+0004b630: 436f 763a 2569 2c20 4c3a 2569 2927 2025  Cov:%i, L:%i)' %
+0004b640: 2028 7365 6c66 2e74 6964 2c20 696e 7428   (self.tid, int(
+0004b650: 3130 302a 7365 6c66 2e63 6f76 2f73 656c  100*self.cov/sel
+0004b660: 662e 6c65 6e29 2c20 7365 6c66 2e6c 656e  f.len), self.len
+0004b670: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+0004b680: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0004b690: 2073 656c 662e 6973 7472 616e 6420 3c20   self.istrand < 
+0004b6a0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0004b6b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004b6c0: 6620 286c 6f63 203e 3d20 3029 2026 2028  f (loc >= 0) & (
+0004b6d0: 6c6f 6320 3c3d 2028 652e 6765 745f 6c65  loc <= (e.get_le
+0004b6e0: 6e28 292d 3329 293a 0a20 2020 2020 2020  n()-3)):.       
+0004b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b700: 2020 2020 2020 2020 2073 6571 203d 2065           seq = e
+0004b710: 2e67 6574 5f73 6571 2829 0a20 2020 2020  .get_seq().     
+0004b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b730: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0004b740: 715b 6c6f 633a 286c 6f63 2b33 295d 203d  q[loc:(loc+3)] =
+0004b750: 3d20 7263 5f53 5441 5254 5f43 4f44 4f4e  = rc_START_CODON
+0004b760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b780: 2020 2020 2020 6220 3d20 300a 2020 2020        b = 0.    
+0004b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b7b0: 7365 6c66 2e73 7461 7274 5f63 6f64 6f6e  self.start_codon
+0004b7c0: 5f65 7665 6e74 203d 2043 4f44 4f4e 5f56  _event = CODON_V
+0004b7d0: 414c 4944 0a20 2020 2020 2020 2020 2020  ALID.           
+0004b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b7f0: 2020 2020 2065 6c69 6620 7365 715b 6c6f       elif seq[lo
+0004b800: 633a 286c 6f63 2b33 295d 2e63 6f75 6e74  c:(loc+3)].count
+0004b810: 2827 4e27 2920 3e20 303a 0a20 2020 2020  ('N') > 0:.     
+0004b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b830: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0004b840: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0004b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b860: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0004b870: 6172 745f 636f 646f 6e5f 6576 656e 7420  art_codon_event 
+0004b880: 3d20 434f 444f 4e5f 4e4f 545f 434f 5645  = CODON_NOT_COVE
+0004b890: 5245 440a 2020 2020 2020 2020 2020 2020  RED.            
 0004b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b8b0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0004b8c0: 6172 745f 636f 646f 6e5f 6576 656e 7420  art_codon_event 
-0004b8d0: 3d20 434f 444f 4e5f 5641 4c49 440a 2020  = CODON_VALID.  
-0004b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b8f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0004b900: 6966 2073 6571 5b6c 6f63 3a28 6c6f 632b  if seq[loc:(loc+
-0004b910: 3329 5d2e 636f 756e 7428 274e 2729 203e  3)].count('N') >
-0004b920: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0004b8b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0004b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b8d0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+0004b8e0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0004b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b900: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+0004b910: 656c 662e 7473 6571 2920 3e20 303a 0a20  elf.tseq) > 0:. 
+0004b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b940: 2020 2020 2020 2020 6220 3d20 300a 2020          b = 0.  
-0004b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b970: 2020 7365 6c66 2e73 7461 7274 5f63 6f64    self.start_cod
-0004b980: 6f6e 5f65 7665 6e74 203d 2043 4f44 4f4e  on_event = CODON
-0004b990: 5f4e 4f54 5f43 4f56 4552 4544 0a20 2020  _NOT_COVERED.   
-0004b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b9b0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0004b9c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0004b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b9e0: 2020 2020 2020 2062 203d 2031 0a20 2020         b = 1.   
+0004b940: 2020 2020 2020 2070 7320 3d20 6c65 6e28         ps = len(
+0004b950: 7365 6c66 2e74 7365 7129 202d 2073 656c  self.tseq) - sel
+0004b960: 662e 706f 735f 7374 6172 7420 2d20 330a  f.pos_start - 3.
+0004b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b990: 2020 2020 2020 2020 7363 6f64 6f6e 5f6f          scodon_o
+0004b9a0: 7267 203d 2073 656c 662e 7473 6571 5b70  rg = self.tseq[p
+0004b9b0: 733a 2870 732b 3329 5d0a 2020 2020 2020  s:(ps+3)].      
+0004b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b9d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0004b9e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
 0004b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba10: 2069 6620 6c65 6e28 7365 6c66 2e74 7365   if len(self.tse
-0004ba20: 7129 203e 2030 3a0a 2020 2020 2020 2020  q) > 0:.        
+0004ba00: 2020 2020 2020 2020 2020 2020 7363 6f64              scod
+0004ba10: 6f6e 5f6f 7267 203d 2072 635f 5354 4152  on_org = rc_STAR
+0004ba20: 545f 434f 444f 4e0a 2020 2020 2020 2020  T_CODON.        
 0004ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba50: 7073 203d 206c 656e 2873 656c 662e 7473  ps = len(self.ts
-0004ba60: 6571 2920 2d20 7365 6c66 2e70 6f73 5f73  eq) - self.pos_s
-0004ba70: 7461 7274 202d 2033 0a20 2020 2020 2020  tart - 3.       
+0004ba40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004ba50: 2e73 7461 7274 5f63 6f64 6f6e 5f65 7665  .start_codon_eve
+0004ba60: 6e74 203d 2043 4f44 4f4e 5f57 4954 485f  nt = CODON_WITH_
+0004ba70: 5641 5249 414e 540a 2020 2020 2020 2020  VARIANT.        
 0004ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004baa0: 2073 636f 646f 6e5f 6f72 6720 3d20 7365   scodon_org = se
-0004bab0: 6c66 2e74 7365 715b 7073 3a28 7073 2b33  lf.tseq[ps:(ps+3
-0004bac0: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-0004bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bae0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0004baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb10: 2020 2020 2073 636f 646f 6e5f 6f72 6720       scodon_org 
-0004bb20: 3d20 7263 5f53 5441 5254 5f43 4f44 4f4e  = rc_START_CODON
-0004bb30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb50: 2020 2020 2073 656c 662e 7374 6172 745f       self.start_
-0004bb60: 636f 646f 6e5f 6576 656e 7420 3d20 434f  codon_event = CO
-0004bb70: 444f 4e5f 5749 5448 5f56 4152 4941 4e54  DON_WITH_VARIANT
-0004bb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bba0: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
-0004bbb0: 2070 7269 6e74 2827 2020 2053 4e50 2064   print('   SNP d
-0004bbc0: 6574 6563 7465 6420 696e 2053 7461 7274  etected in Start
-0004bbd0: 2063 6f64 6f6e 206f 6620 2573 3a20 2573   codon of %s: %s
-0004bbe0: 202d 3e20 2573 2720 2520 2873 656c 662e   -> %s' % (self.
-0004bbf0: 7469 642c 2073 636f 646f 6e5f 6f72 672c  tid, scodon_org,
-0004bc00: 2073 6571 5b6c 6f63 3a28 6c6f 632b 3329   seq[loc:(loc+3)
-0004bc10: 5d29 2029 0a20 2020 2020 2020 2020 2020  ]) ).           
-0004bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc30: 2065 6c69 6620 286c 6f63 203e 2028 652e   elif (loc > (e.
-0004bc40: 6765 745f 6c65 6e28 292d 3329 2920 7c20  get_len()-3)) | 
-0004bc50: 286c 6f63 203c 2030 293a 0a20 2020 2020  (loc < 0):.     
-0004bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc70: 2020 2020 2020 2020 2020 2062 203d 2032             b = 2
-0004bc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bca0: 2069 6620 6c6f 6320 3c20 303a 200a 2020   if loc < 0: .  
-0004bcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bcd0: 2020 7365 6c66 2e73 7461 7274 5f63 6f64    self.start_cod
-0004bce0: 6f6e 5f65 7665 6e74 203d 2043 4f44 4f4e  on_event = CODON
-0004bcf0: 5f57 4954 485f 494e 4445 4c0a 2020 2020  _WITH_INDEL.    
-0004bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bd20: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0004bd30: 7428 2720 2020 494e 4445 4c20 6465 7465  t('   INDEL dete
-0004bd40: 6374 6564 2069 6e20 5374 6172 7420 636f  cted in Start co
-0004bd50: 646f 6e20 6f66 2025 7327 2025 2028 7365  don of %s' % (se
-0004bd60: 6c66 2e74 6964 2920 290a 2020 2020 2020  lf.tid) ).      
-0004bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bd80: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-0004bd90: 7428 2749 4e46 4f20 696e 2075 7064 6174  t('INFO in updat
-0004bda0: 655f 696e 666f 3a20 2573 2073 7461 7274  e_info: %s start
-0004bdb0: 2063 6f64 6f6e 2073 6565 6d73 2074 6f20   codon seems to 
-0004bdc0: 6265 206d 6f76 6564 2e20 2843 6f76 3a25  be moved. (Cov:%
-0004bdd0: 692c 204c 3a25 6929 2720 2520 2873 656c  i, L:%i)' % (sel
-0004bde0: 662e 7469 642c 2069 6e74 2831 3030 2a73  f.tid, int(100*s
-0004bdf0: 656c 662e 636f 762f 7365 6c66 2e6c 656e  elf.cov/self.len
-0004be00: 292c 2073 656c 662e 6c65 6e29 290a 0a0a  ), self.len))...
-0004be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004be20: 2020 2020 2020 2020 6966 2062 203d 3d20          if b == 
-0004be30: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0004be40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004be50: 656c 662e 7374 6172 745f 636f 646f 6e5f  elf.start_codon_
-0004be60: 706f 7320 3d20 7365 6c66 2e73 7461 7274  pos = self.start
-0004be70: 5f63 6f64 6f6e 5f70 6f73 5f6f 7267 0a20  _codon_pos_org. 
+0004ba90: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0004baa0: 6572 626f 7365 3a20 7072 696e 7428 2720  erbose: print(' 
+0004bab0: 2020 534e 5020 6465 7465 6374 6564 2069    SNP detected i
+0004bac0: 6e20 5374 6172 7420 636f 646f 6e20 6f66  n Start codon of
+0004bad0: 2025 733a 2025 7320 2d3e 2025 7327 2025   %s: %s -> %s' %
+0004bae0: 2028 7365 6c66 2e74 6964 2c20 7363 6f64   (self.tid, scod
+0004baf0: 6f6e 5f6f 7267 2c20 7365 715b 6c6f 633a  on_org, seq[loc:
+0004bb00: 286c 6f63 2b33 295d 2920 290a 2020 2020  (loc+3)]) ).    
+0004bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb20: 2020 2020 2020 2020 656c 6966 2028 6c6f          elif (lo
+0004bb30: 6320 3e20 2865 2e67 6574 5f6c 656e 2829  c > (e.get_len()
+0004bb40: 2d33 2929 207c 2028 6c6f 6320 3c20 3029  -3)) | (loc < 0)
+0004bb50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb70: 2020 6220 3d20 320a 2020 2020 2020 2020    b = 2.        
+0004bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb90: 2020 2020 2020 2020 6966 206c 6f63 203c          if loc <
+0004bba0: 2030 3a20 0a20 2020 2020 2020 2020 2020   0: .           
+0004bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bbc0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0004bbd0: 6172 745f 636f 646f 6e5f 6576 656e 7420  art_codon_event 
+0004bbe0: 3d20 434f 444f 4e5f 5749 5448 5f49 4e44  = CODON_WITH_IND
+0004bbf0: 454c 0a20 2020 2020 2020 2020 2020 2020  EL.             
+0004bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bc10: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
+0004bc20: 653a 2070 7269 6e74 2827 2020 2049 4e44  e: print('   IND
+0004bc30: 454c 2064 6574 6563 7465 6420 696e 2053  EL detected in S
+0004bc40: 7461 7274 2063 6f64 6f6e 206f 6620 2573  tart codon of %s
+0004bc50: 2720 2520 2873 656c 662e 7469 6429 2029  ' % (self.tid) )
+0004bc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bc80: 2023 2070 7269 6e74 2827 494e 464f 2069   # print('INFO i
+0004bc90: 6e20 7570 6461 7465 5f69 6e66 6f3a 2025  n update_info: %
+0004bca0: 7320 7374 6172 7420 636f 646f 6e20 7365  s start codon se
+0004bcb0: 656d 7320 746f 2062 6520 6d6f 7665 642e  ems to be moved.
+0004bcc0: 2028 436f 763a 2569 2c20 4c3a 2569 2927   (Cov:%i, L:%i)'
+0004bcd0: 2025 2028 7365 6c66 2e74 6964 2c20 696e   % (self.tid, in
+0004bce0: 7428 3130 302a 7365 6c66 2e63 6f76 2f73  t(100*self.cov/s
+0004bcf0: 656c 662e 6c65 6e29 2c20 7365 6c66 2e6c  elf.len), self.l
+0004bd00: 656e 2929 0a0a 0a20 2020 2020 2020 2020  en))...         
+0004bd10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004bd20: 6620 6220 3d3d 2030 3a0a 2020 2020 2020  f b == 0:.      
+0004bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bd40: 2020 2020 2020 7365 6c66 2e73 7461 7274        self.start
+0004bd50: 5f63 6f64 6f6e 5f70 6f73 203d 2073 656c  _codon_pos = sel
+0004bd60: 662e 7374 6172 745f 636f 646f 6e5f 706f  f.start_codon_po
+0004bd70: 735f 6f72 670a 2020 2020 2020 2020 2020  s_org.          
+0004bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bd90: 2020 2320 7365 6c66 2e73 7461 7274 5f63    # self.start_c
+0004bda0: 6f64 6f6e 5f76 616c 6964 203d 2054 7275  odon_valid = Tru
+0004bdb0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0004bdc0: 2020 2020 2020 2020 2020 2327 2727 0a0a            #'''..
+0004bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bde0: 6966 2046 616c 7365 3a20 2320 6220 3c20  if False: # b < 
+0004bdf0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0004be00: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
+0004be10: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+0004be20: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0004be30: 7428 2749 4e46 4f20 696e 2075 7064 6174  t('INFO in updat
+0004be40: 655f 696e 666f 2028 2569 293a 2025 7320  e_info (%i): %s 
+0004be50: 7374 6172 7420 636f 646f 6e20 6e6f 7420  start codon not 
+0004be60: 636f 7665 7265 642e 2028 436f 763a 2569  covered. (Cov:%i
+0004be70: 2c20 4c3a 2569 2927 205c 0a20 2020 2020  , L:%i)' \.     
 0004be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004be90: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
-0004bea0: 662e 7374 6172 745f 636f 646f 6e5f 7661  f.start_codon_va
-0004beb0: 6c69 6420 3d20 5472 7565 0a20 2020 2020  lid = True.     
-0004bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bed0: 2020 2023 2727 270a 0a20 2020 2020 2020     #'''..       
-0004bee0: 2020 2020 2020 2020 2069 6620 4661 6c73           if Fals
-0004bef0: 653a 2023 2062 203c 2030 3a0a 2020 2020  e: # b < 0:.    
-0004bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bf10: 6966 2076 6572 626f 7365 3a20 0a20 2020  if verbose: .   
-0004bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bf30: 2020 2020 2070 7269 6e74 2827 494e 464f       print('INFO
-0004bf40: 2069 6e20 7570 6461 7465 5f69 6e66 6f20   in update_info 
-0004bf50: 2825 6929 3a20 2573 2073 7461 7274 2063  (%i): %s start c
-0004bf60: 6f64 6f6e 206e 6f74 2063 6f76 6572 6564  odon not covered
-0004bf70: 2e20 2843 6f76 3a25 692c 204c 3a25 6929  . (Cov:%i, L:%i)
-0004bf80: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-0004bf90: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-0004bfa0: 2862 2c20 7365 6c66 2e74 6964 2c20 696e  (b, self.tid, in
-0004bfb0: 7428 3130 302a 7365 6c66 2e63 6f76 2f73  t(100*self.cov/s
-0004bfc0: 656c 662e 6c65 6e29 2c20 7365 6c66 2e6c  elf.len), self.l
-0004bfd0: 656e 2929 0a0a 2020 2020 2020 2020 2020  en))..          
-0004bfe0: 2020 2323 2055 7064 6174 6520 7374 6172    ## Update star
-0004bff0: 742f 7374 6f70 2063 6f64 6f6e 0a20 2020  t/stop codon.   
-0004c000: 2020 2020 2020 2020 2069 6620 2873 656c           if (sel
-0004c010: 662e 7374 6f70 5f63 6f64 6f6e 5f70 6f73  f.stop_codon_pos
-0004c020: 5f6f 7267 5b30 5d20 3e20 3029 3a0a 2020  _org[0] > 0):.  
-0004c030: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004c040: 6669 6e64 2065 786f 6e20 7468 6174 2063  find exon that c
-0004c050: 6f6e 7461 696e 7320 7374 6f70 2063 6f64  ontains stop cod
-0004c060: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-0004c070: 2020 2073 6320 3d20 7265 6769 6f6e 2820     sc = region( 
-0004c080: 7365 6c66 2e63 6872 2c20 7365 6c66 2e73  self.chr, self.s
-0004c090: 746f 705f 636f 646f 6e5f 706f 735f 6f72  top_codon_pos_or
-0004c0a0: 675b 305d 2c20 7365 6c66 2e73 746f 705f  g[0], self.stop_
-0004c0b0: 636f 646f 6e5f 706f 735f 6f72 675b 315d  codon_pos_org[1]
-0004c0c0: 2c20 274d 2729 0a20 2020 2020 2020 2020  , 'M').         
-0004c0d0: 2020 2020 2020 2062 203d 202d 310a 2020         b = -1.  
-0004c0e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004c0f0: 6c66 2e73 746f 705f 636f 646f 6e5f 6576  lf.stop_codon_ev
-0004c100: 656e 7420 3d20 434f 444f 4e5f 4e4f 545f  ent = CODON_NOT_
-0004c110: 434f 5645 5245 440a 2020 2020 2020 2020  COVERED.        
-0004c120: 2020 2020 2020 2020 666f 7220 6520 696e          for e in
-0004c130: 2065 786f 6e73 2e72 676e 733a 0a20 2020   exons.rgns:.   
+0004be90: 2020 2020 2025 2028 622c 2073 656c 662e       % (b, self.
+0004bea0: 7469 642c 2069 6e74 2831 3030 2a73 656c  tid, int(100*sel
+0004beb0: 662e 636f 762f 7365 6c66 2e6c 656e 292c  f.cov/self.len),
+0004bec0: 2073 656c 662e 6c65 6e29 290a 0a20 2020   self.len))..   
+0004bed0: 2020 2020 2020 2020 2023 2320 5570 6461           ## Upda
+0004bee0: 7465 2073 7461 7274 2f73 746f 7020 636f  te start/stop co
+0004bef0: 646f 6e0a 2020 2020 2020 2020 2020 2020  don.            
+0004bf00: 6966 2028 7365 6c66 2e73 746f 705f 636f  if (self.stop_co
+0004bf10: 646f 6e5f 706f 735f 6f72 675b 305d 203e  don_pos_org[0] >
+0004bf20: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+0004bf30: 2020 2020 2023 2066 696e 6420 6578 6f6e       # find exon
+0004bf40: 2074 6861 7420 636f 6e74 6169 6e73 2073   that contains s
+0004bf50: 746f 7020 636f 646f 6e0a 2020 2020 2020  top codon.      
+0004bf60: 2020 2020 2020 2020 2020 7363 203d 2072            sc = r
+0004bf70: 6567 696f 6e28 2073 656c 662e 6368 722c  egion( self.chr,
+0004bf80: 2073 656c 662e 7374 6f70 5f63 6f64 6f6e   self.stop_codon
+0004bf90: 5f70 6f73 5f6f 7267 5b30 5d2c 2073 656c  _pos_org[0], sel
+0004bfa0: 662e 7374 6f70 5f63 6f64 6f6e 5f70 6f73  f.stop_codon_pos
+0004bfb0: 5f6f 7267 5b31 5d2c 2027 4d27 290a 2020  _org[1], 'M').  
+0004bfc0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+0004bfd0: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+0004bfe0: 2020 2020 2073 656c 662e 7374 6f70 5f63       self.stop_c
+0004bff0: 6f64 6f6e 5f65 7665 6e74 203d 2043 4f44  odon_event = COD
+0004c000: 4f4e 5f4e 4f54 5f43 4f56 4552 4544 0a20  ON_NOT_COVERED. 
+0004c010: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004c020: 6f72 2065 2069 6e20 6578 6f6e 732e 7267  or e in exons.rg
+0004c030: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0004c040: 2020 2020 2020 2020 6966 2065 2e68 6173          if e.has
+0004c050: 5f65 7874 5f69 6e74 6572 7365 6374 696f  _ext_intersectio
+0004c060: 6e5f 7769 7468 2873 6329 3a0a 2020 2020  n_with(sc):.    
+0004c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c080: 2020 2020 2320 6368 6563 6b20 636f 6465      # check code
+0004c090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c0a0: 2020 2020 2020 2020 206c 6f63 203d 2073           loc = s
+0004c0b0: 632e 7374 6172 7420 2d20 652e 7374 6172  c.start - e.star
+0004c0c0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0004c0d0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0004c0e0: 662e 6973 7472 616e 6420 3e20 303a 0a20  f.istrand > 0:. 
+0004c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c100: 2020 2020 2020 2020 2020 2069 6620 286c             if (l
+0004c110: 6f63 203e 3d20 3029 2026 2028 6c6f 6320  oc >= 0) & (loc 
+0004c120: 3c3d 2028 652e 6765 745f 6c65 6e28 292d  <= (e.get_len()-
+0004c130: 3329 293a 0a20 2020 2020 2020 2020 2020  3)):.           
 0004c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c150: 2069 6620 652e 6861 735f 6578 745f 696e   if e.has_ext_in
-0004c160: 7465 7273 6563 7469 6f6e 5f77 6974 6828  tersection_with(
-0004c170: 7363 293a 0a20 2020 2020 2020 2020 2020  sc):.           
-0004c180: 2020 2020 2020 2020 2020 2020 2023 2063               # c
-0004c190: 6865 636b 2063 6f64 650a 2020 2020 2020  heck code.      
+0004c150: 2020 2020 2073 6571 203d 2065 2e67 6574       seq = e.get
+0004c160: 5f73 6571 2829 0a20 2020 2020 2020 2020  _seq().         
+0004c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c180: 2020 2020 2020 2063 646e 203d 2073 6571         cdn = seq
+0004c190: 5b6c 6f63 3a28 6c6f 632b 3329 5d0a 2020  [loc:(loc+3)].  
 0004c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c1b0: 2020 6c6f 6320 3d20 7363 2e73 7461 7274    loc = sc.start
-0004c1c0: 202d 2065 2e73 7461 7274 0a20 2020 2020   - e.start.     
-0004c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c1e0: 2020 2069 6620 7365 6c66 2e69 7374 7261     if self.istra
-0004c1f0: 6e64 203e 2030 3a0a 2020 2020 2020 2020  nd > 0:.        
-0004c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c210: 2020 2020 6966 2028 6c6f 6320 3e3d 2030      if (loc >= 0
-0004c220: 2920 2620 286c 6f63 203c 3d20 2865 2e67  ) & (loc <= (e.g
-0004c230: 6574 5f6c 656e 2829 2d33 2929 3a0a 2020  et_len()-3)):.  
+0004c1b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004c1c0: 2028 6364 6e20 3d3d 2053 544f 505f 434f   (cdn == STOP_CO
+0004c1d0: 444f 4e53 5b30 5d29 207c 2028 6364 6e20  DONS[0]) | (cdn 
+0004c1e0: 3d3d 2053 544f 505f 434f 444f 4e53 5b31  == STOP_CODONS[1
+0004c1f0: 5d29 207c 2028 6364 6e20 3d3d 2053 544f  ]) | (cdn == STO
+0004c200: 505f 434f 444f 4e53 5b32 5d29 3a0a 2020  P_CODONS[2]):.  
+0004c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c230: 2020 6220 3d20 300a 2020 2020 2020 2020    b = 0.        
 0004c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c250: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004c260: 7120 3d20 652e 6765 745f 7365 7128 290a  q = e.get_seq().
-0004c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004c260: 2e73 746f 705f 636f 646f 6e5f 6576 656e  .stop_codon_even
+0004c270: 7420 3d20 434f 444f 4e5f 5641 4c49 440a  t = CODON_VALID.
 0004c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c290: 6364 6e20 3d20 7365 715b 6c6f 633a 286c  cdn = seq[loc:(l
-0004c2a0: 6f63 2b33 295d 0a20 2020 2020 2020 2020  oc+3)].         
-0004c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c2c0: 2020 2020 2020 2069 6620 2863 646e 203d         if (cdn =
-0004c2d0: 3d20 5354 4f50 5f43 4f44 4f4e 535b 305d  = STOP_CODONS[0]
-0004c2e0: 2920 7c20 2863 646e 203d 3d20 5354 4f50  ) | (cdn == STOP
-0004c2f0: 5f43 4f44 4f4e 535b 315d 2920 7c20 2863  _CODONS[1]) | (c
-0004c300: 646e 203d 3d20 5354 4f50 5f43 4f44 4f4e  dn == STOP_CODON
-0004c310: 535b 325d 293a 0a20 2020 2020 2020 2020  S[2]):.         
-0004c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c330: 2020 2020 2020 2020 2020 2062 203d 2030             b = 0
-0004c340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c360: 2020 2020 2073 656c 662e 7374 6f70 5f63       self.stop_c
-0004c370: 6f64 6f6e 5f65 7665 6e74 203d 2043 4f44  odon_event = COD
-0004c380: 4f4e 5f56 414c 4944 0a20 2020 2020 2020  ON_VALID.       
+0004c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c2a0: 656c 6966 2063 646e 2e63 6f75 6e74 2827  elif cdn.count('
+0004c2b0: 4e27 2920 3e20 303a 0a20 2020 2020 2020  N') > 0:.       
+0004c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c2d0: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+0004c2e0: 2033 0a20 2020 2020 2020 2020 2020 2020   3.             
+0004c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c300: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
+0004c310: 5f63 6f64 6f6e 5f65 7665 6e74 203d 2043  _codon_event = C
+0004c320: 4f44 4f4e 5f4e 4f54 5f43 4f56 4552 4544  ODON_NOT_COVERED
+0004c330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c350: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0004c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c370: 2020 2020 2020 2020 2020 2062 203d 2031             b = 1
+0004c380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0004c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c3a0: 2020 2020 2020 2020 2065 6c69 6620 6364           elif cd
-0004c3b0: 6e2e 636f 756e 7428 274e 2729 203e 2030  n.count('N') > 0
-0004c3c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004c3a0: 2020 2020 2073 656c 662e 7374 6f70 5f63       self.stop_c
+0004c3b0: 6f64 6f6e 5f65 7665 6e74 203d 2043 4f44  odon_event = COD
+0004c3c0: 4f4e 5f57 4954 485f 5641 5249 414e 540a  ON_WITH_VARIANT.
 0004c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c3e0: 2020 2020 2020 6220 3d20 330a 2020 2020        b = 3.    
-0004c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c410: 7365 6c66 2e73 746f 705f 636f 646f 6e5f  self.stop_codon_
-0004c420: 6576 656e 7420 3d20 434f 444f 4e5f 4e4f  event = CODON_NO
-0004c430: 545f 434f 5645 5245 440a 2020 2020 2020  T_COVERED.      
-0004c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c450: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0004c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c3f0: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+0004c400: 7473 6571 2920 3e20 303a 0a20 2020 2020  tseq) > 0:.     
+0004c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c430: 2020 2073 636f 646f 6e5f 6f72 6720 3d20     scodon_org = 
+0004c440: 7365 6c66 2e74 7365 715b 7365 6c66 2e70  self.tseq[self.p
+0004c450: 6f73 5f73 746f 703a 2873 656c 662e 706f  os_stop:(self.po
+0004c460: 735f 7374 6f70 2b33 295d 0a20 2020 2020  s_stop+3)].     
 0004c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c480: 2020 2020 6220 3d20 310a 2020 2020 2020      b = 1.      
-0004c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c4a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004c4b0: 6c66 2e73 746f 705f 636f 646f 6e5f 6576  lf.stop_codon_ev
-0004c4c0: 656e 7420 3d20 434f 444f 4e5f 5749 5448  ent = CODON_WITH
-0004c4d0: 5f56 4152 4941 4e54 0a20 2020 2020 2020  _VARIANT.       
-0004c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c4f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004c500: 6c65 6e28 7365 6c66 2e74 7365 7129 203e  len(self.tseq) >
-0004c510: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0004c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c530: 2020 2020 2020 2020 2020 2020 7363 6f64              scod
-0004c540: 6f6e 5f6f 7267 203d 2073 656c 662e 7473  on_org = self.ts
-0004c550: 6571 5b73 656c 662e 706f 735f 7374 6f70  eq[self.pos_stop
-0004c560: 3a28 7365 6c66 2e70 6f73 5f73 746f 702b  :(self.pos_stop+
-0004c570: 3329 5d0a 2020 2020 2020 2020 2020 2020  3)].            
-0004c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c590: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004c480: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004c490: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0004c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c4b0: 2020 2020 2020 2020 2020 2020 2073 636f               sco
+0004c4c0: 646f 6e5f 6f72 6720 3d20 2725 732c 2573  don_org = '%s,%s
+0004c4d0: 2c25 7327 2025 2028 5354 4f50 5f43 4f44  ,%s' % (STOP_COD
+0004c4e0: 4f4e 535b 305d 2c53 544f 505f 434f 444f  ONS[0],STOP_CODO
+0004c4f0: 4e53 5b31 5d2c 5354 4f50 5f43 4f44 4f4e  NS[1],STOP_CODON
+0004c500: 535b 325d 290a 2020 2020 2020 2020 2020  S[2]).          
+0004c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c520: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
+0004c530: 626f 7365 3a20 7072 696e 7428 2720 2020  bose: print('   
+0004c540: 534e 5020 6465 7465 6374 6564 2069 6e20  SNP detected in 
+0004c550: 5374 6f70 2063 6f64 6f6e 206f 6620 2573  Stop codon of %s
+0004c560: 3a20 2573 202d 3e20 2573 2720 2520 2873  : %s -> %s' % (s
+0004c570: 656c 662e 7469 642c 2073 636f 646f 6e5f  elf.tid, scodon_
+0004c580: 6f72 672c 2073 6571 5b6c 6f63 3a28 6c6f  org, seq[loc:(lo
+0004c590: 632b 3329 5d29 2029 0a20 2020 2020 2020  c+3)]) ).       
 0004c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c5c0: 2020 2020 2020 7363 6f64 6f6e 5f6f 7267        scodon_org
-0004c5d0: 203d 2027 2573 2c25 732c 2573 2720 2520   = '%s,%s,%s' % 
-0004c5e0: 2853 544f 505f 434f 444f 4e53 5b30 5d2c  (STOP_CODONS[0],
-0004c5f0: 5354 4f50 5f43 4f44 4f4e 535b 315d 2c53  STOP_CODONS[1],S
-0004c600: 544f 505f 434f 444f 4e53 5b32 5d29 0a20  TOP_CODONS[2]). 
+0004c5b0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0004c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c5d0: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
+0004c5e0: 6c6f 6320 3e20 2865 2e67 6574 5f6c 656e  loc > (e.get_len
+0004c5f0: 2829 2d33 2929 207c 2028 6c6f 6320 3c20  ()-3)) | (loc < 
+0004c600: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
 0004c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c630: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
-0004c640: 7269 6e74 2827 2020 2053 4e50 2064 6574  rint('   SNP det
-0004c650: 6563 7465 6420 696e 2053 746f 7020 636f  ected in Stop co
-0004c660: 646f 6e20 6f66 2025 733a 2025 7320 2d3e  don of %s: %s ->
-0004c670: 2025 7327 2025 2028 7365 6c66 2e74 6964   %s' % (self.tid
-0004c680: 2c20 7363 6f64 6f6e 5f6f 7267 2c20 7365  , scodon_org, se
-0004c690: 715b 6c6f 633a 286c 6f63 2b33 295d 2920  q[loc:(loc+3)]) 
-0004c6a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c6c0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0004c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c6e0: 2020 2065 6c69 6620 286c 6f63 203e 2028     elif (loc > (
-0004c6f0: 652e 6765 745f 6c65 6e28 292d 3329 2920  e.get_len()-3)) 
-0004c700: 7c20 286c 6f63 203c 2030 293a 0a20 2020  | (loc < 0):.   
-0004c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c720: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-0004c730: 2032 0a20 2020 2020 2020 2020 2020 2020   2.             
-0004c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c750: 2020 2073 656c 662e 7374 6f70 5f63 6f64     self.stop_cod
-0004c760: 6f6e 5f65 7665 6e74 203d 2043 4f44 4f4e  on_event = CODON
-0004c770: 5f57 4954 485f 494e 4445 4c0a 2020 2020  _WITH_INDEL.    
-0004c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c790: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-0004c7a0: 696e 7428 2749 4e44 454c 206d 6967 6874  int('INDEL might
-0004c7b0: 2068 6170 7065 6e27 290a 2020 2020 2020   happen').      
-0004c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c7d0: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-0004c7e0: 7428 2749 4e46 4f20 696e 2075 7064 6174  t('INFO in updat
-0004c7f0: 655f 696e 666f 3a20 2573 2073 746f 7020  e_info: %s stop 
-0004c800: 636f 646f 6e20 7365 656d 7320 746f 2062  codon seems to b
-0004c810: 6520 6d6f 7665 642e 2028 436f 763a 2569  e moved. (Cov:%i
-0004c820: 2c20 4c3a 2569 2927 2025 2028 7365 6c66  , L:%i)' % (self
-0004c830: 2e74 6964 2c20 696e 7428 3130 302a 7365  .tid, int(100*se
-0004c840: 6c66 2e63 6f76 2f73 656c 662e 6c65 6e29  lf.cov/self.len)
-0004c850: 2c20 7365 6c66 2e6c 656e 2929 0a0a 2020  , self.len))..  
-0004c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c870: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-0004c880: 6973 7472 616e 6420 3c20 303a 0a20 2020  istrand < 0:.   
+0004c620: 2020 2020 6220 3d20 320a 2020 2020 2020      b = 2.      
+0004c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c640: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0004c650: 746f 705f 636f 646f 6e5f 6576 656e 7420  top_codon_event 
+0004c660: 3d20 434f 444f 4e5f 5749 5448 5f49 4e44  = CODON_WITH_IND
+0004c670: 454c 0a20 2020 2020 2020 2020 2020 2020  EL.             
+0004c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c690: 2020 2023 2070 7269 6e74 2827 494e 4445     # print('INDE
+0004c6a0: 4c20 6d69 6768 7420 6861 7070 656e 2729  L might happen')
+0004c6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c6d0: 2023 2070 7269 6e74 2827 494e 464f 2069   # print('INFO i
+0004c6e0: 6e20 7570 6461 7465 5f69 6e66 6f3a 2025  n update_info: %
+0004c6f0: 7320 7374 6f70 2063 6f64 6f6e 2073 6565  s stop codon see
+0004c700: 6d73 2074 6f20 6265 206d 6f76 6564 2e20  ms to be moved. 
+0004c710: 2843 6f76 3a25 692c 204c 3a25 6929 2720  (Cov:%i, L:%i)' 
+0004c720: 2520 2873 656c 662e 7469 642c 2069 6e74  % (self.tid, int
+0004c730: 2831 3030 2a73 656c 662e 636f 762f 7365  (100*self.cov/se
+0004c740: 6c66 2e6c 656e 292c 2073 656c 662e 6c65  lf.len), self.le
+0004c750: 6e29 290a 0a20 2020 2020 2020 2020 2020  n))..           
+0004c760: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0004c770: 6620 7365 6c66 2e69 7374 7261 6e64 203c  f self.istrand <
+0004c780: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0004c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c7a0: 6966 2028 6c6f 6320 3e3d 2030 2920 2620  if (loc >= 0) & 
+0004c7b0: 286c 6f63 203c 3d20 2865 2e67 6574 5f6c  (loc <= (e.get_l
+0004c7c0: 656e 2829 2d33 2929 3a0a 2020 2020 2020  en()-3)):.      
+0004c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c7e0: 2020 2020 2020 2020 2020 7365 7120 3d20            seq = 
+0004c7f0: 652e 6765 745f 7365 7128 290a 2020 2020  e.get_seq().    
+0004c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c810: 2020 2020 2020 2020 2020 2020 6364 6e20              cdn 
+0004c820: 3d20 7365 715b 6c6f 633a 286c 6f63 2b33  = seq[loc:(loc+3
+0004c830: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+0004c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c850: 2020 2069 6620 2863 646e 203d 3d20 7265     if (cdn == re
+0004c860: 7665 7273 655f 636f 6d70 6c65 6d65 6e74  verse_complement
+0004c870: 2853 544f 505f 434f 444f 4e53 5b30 5d29  (STOP_CODONS[0])
+0004c880: 2920 7c20 5c0a 2020 2020 2020 2020 2020  ) | \.          
 0004c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c8a0: 2020 2020 2020 2020 2069 6620 286c 6f63           if (loc
-0004c8b0: 203e 3d20 3029 2026 2028 6c6f 6320 3c3d   >= 0) & (loc <=
-0004c8c0: 2028 652e 6765 745f 6c65 6e28 292d 3329   (e.get_len()-3)
-0004c8d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0004c8a0: 2020 2020 2020 2020 2028 6364 6e20 3d3d           (cdn ==
+0004c8b0: 2072 6576 6572 7365 5f63 6f6d 706c 656d   reverse_complem
+0004c8c0: 656e 7428 5354 4f50 5f43 4f44 4f4e 535b  ent(STOP_CODONS[
+0004c8d0: 315d 2929 207c 205c 0a20 2020 2020 2020  1])) | \.       
 0004c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c8f0: 2020 2073 6571 203d 2065 2e67 6574 5f73     seq = e.get_s
-0004c900: 6571 2829 0a20 2020 2020 2020 2020 2020  eq().           
-0004c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c920: 2020 2020 2063 646e 203d 2073 6571 5b6c       cdn = seq[l
-0004c930: 6f63 3a28 6c6f 632b 3329 5d0a 2020 2020  oc:(loc+3)].    
-0004c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c950: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0004c960: 6364 6e20 3d3d 2072 6576 6572 7365 5f63  cdn == reverse_c
-0004c970: 6f6d 706c 656d 656e 7428 5354 4f50 5f43  omplement(STOP_C
-0004c980: 4f44 4f4e 535b 305d 2929 207c 205c 0a20  ODONS[0])) | \. 
-0004c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c8f0: 2020 2020 2020 2020 2020 2020 2863 646e              (cdn
+0004c900: 203d 3d20 7265 7665 7273 655f 636f 6d70   == reverse_comp
+0004c910: 6c65 6d65 6e74 2853 544f 505f 434f 444f  lement(STOP_CODO
+0004c920: 4e53 5b32 5d29 293a 0a20 2020 2020 2020  NS[2])):.       
+0004c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c940: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+0004c950: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+0004c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c970: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
+0004c980: 5f63 6f64 6f6e 5f65 7665 6e74 203d 2043  _codon_event = C
+0004c990: 4f44 4f4e 5f56 414c 4944 0a20 2020 2020  ODON_VALID.     
 0004c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c9b0: 2020 2863 646e 203d 3d20 7265 7665 7273    (cdn == revers
-0004c9c0: 655f 636f 6d70 6c65 6d65 6e74 2853 544f  e_complement(STO
-0004c9d0: 505f 434f 444f 4e53 5b31 5d29 2920 7c20  P_CODONS[1])) | 
-0004c9e0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0004c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca00: 2020 2020 2028 6364 6e20 3d3d 2072 6576       (cdn == rev
-0004ca10: 6572 7365 5f63 6f6d 706c 656d 656e 7428  erse_complement(
-0004ca20: 5354 4f50 5f43 4f44 4f4e 535b 325d 2929  STOP_CODONS[2]))
-0004ca30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca50: 2020 2020 2020 6220 3d20 300a 2020 2020        b = 0.    
-0004ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca80: 7365 6c66 2e73 746f 705f 636f 646f 6e5f  self.stop_codon_
-0004ca90: 6576 656e 7420 3d20 434f 444f 4e5f 5641  event = CODON_VA
-0004caa0: 4c49 440a 2020 2020 2020 2020 2020 2020  LID.            
+0004c9b0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0004c9c0: 6364 6e2e 636f 756e 7428 274e 2729 203e  cdn.count('N') >
+0004c9d0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0004c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c9f0: 2020 2020 2020 2020 7365 6c66 2e73 746f          self.sto
+0004ca00: 705f 636f 646f 6e5f 6576 656e 7420 3d20  p_codon_event = 
+0004ca10: 434f 444f 4e5f 4e4f 545f 434f 5645 5245  CODON_NOT_COVERE
+0004ca20: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0004ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca40: 2020 2020 2020 6220 3d20 330a 2020 2020        b = 3.    
+0004ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca60: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0004ca70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca90: 2020 2020 2020 6220 3d20 310a 2020 2020        b = 1.    
+0004caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cac0: 2020 2020 656c 6966 2063 646e 2e63 6f75      elif cdn.cou
-0004cad0: 6e74 2827 4e27 2920 3e20 303a 0a20 2020  nt('N') > 0:.   
-0004cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cac0: 7365 6c66 2e73 746f 705f 636f 646f 6e5f  self.stop_codon_
+0004cad0: 6576 656e 7420 3d20 434f 444f 4e5f 5749  event = CODON_WI
+0004cae0: 5448 5f56 4152 4941 4e54 0a20 2020 2020  TH_VARIANT.     
 0004caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb00: 2073 656c 662e 7374 6f70 5f63 6f64 6f6e   self.stop_codon
-0004cb10: 5f65 7665 6e74 203d 2043 4f44 4f4e 5f4e  _event = CODON_N
-0004cb20: 4f54 5f43 4f56 4552 4544 0a20 2020 2020  OT_COVERED.     
+0004cb00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004cb10: 6620 6c65 6e28 7365 6c66 2e74 7365 7129  f len(self.tseq)
+0004cb20: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
 0004cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb40: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0004cb50: 203d 2033 0a20 2020 2020 2020 2020 2020   = 3.           
-0004cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0004cb40: 2020 2020 2020 2020 2020 2020 2020 7073                ps
+0004cb50: 203d 206c 656e 2873 656c 662e 7473 6571   = len(self.tseq
+0004cb60: 2920 2d20 7365 6c66 2e70 6f73 5f73 746f  ) - self.pos_sto
+0004cb70: 7020 2d20 330a 2020 2020 2020 2020 2020  p - 3.          
 0004cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0004cba0: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
-0004cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cbc0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0004cbd0: 6f70 5f63 6f64 6f6e 5f65 7665 6e74 203d  op_codon_event =
-0004cbe0: 2043 4f44 4f4e 5f57 4954 485f 5641 5249   CODON_WITH_VARI
-0004cbf0: 414e 540a 2020 2020 2020 2020 2020 2020  ANT.            
+0004cb90: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0004cba0: 6f64 6f6e 5f6f 7267 203d 2073 656c 662e  odon_org = self.
+0004cbb0: 7473 6571 5b70 733a 2870 732b 3329 5d0a  tseq[ps:(ps+3)].
+0004cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cbe0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0004cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cc10: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-0004cc20: 656c 662e 7473 6571 2920 3e20 303a 0a20  elf.tseq) > 0:. 
-0004cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cc50: 2020 2020 2020 2070 7320 3d20 6c65 6e28         ps = len(
-0004cc60: 7365 6c66 2e74 7365 7129 202d 2073 656c  self.tseq) - sel
-0004cc70: 662e 706f 735f 7374 6f70 202d 2033 0a20  f.pos_stop - 3. 
-0004cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cca0: 2020 2020 2020 2073 636f 646f 6e5f 6f72         scodon_or
-0004ccb0: 6720 3d20 7365 6c66 2e74 7365 715b 7073  g = self.tseq[ps
-0004ccc0: 3a28 7073 2b33 295d 0a20 2020 2020 2020  :(ps+3)].       
-0004ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cce0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0004ccf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0004cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cd10: 2020 2020 2020 2020 2020 2073 636f 646f             scodo
-0004cd20: 6e5f 6f72 6720 3d20 2725 732c 2573 2c25  n_org = '%s,%s,%
-0004cd30: 7327 2025 2028 7265 7665 7273 655f 636f  s' % (reverse_co
-0004cd40: 6d70 6c65 6d65 6e74 2853 544f 505f 434f  mplement(STOP_CO
-0004cd50: 444f 4e53 5b30 5d29 2c72 6576 6572 7365  DONS[0]),reverse
-0004cd60: 5f63 6f6d 706c 656d 656e 7428 5354 4f50  _complement(STOP
-0004cd70: 5f43 4f44 4f4e 535b 315d 292c 7265 7665  _CODONS[1]),reve
-0004cd80: 7273 655f 636f 6d70 6c65 6d65 6e74 2853  rse_complement(S
-0004cd90: 544f 505f 434f 444f 4e53 5b32 5d29 290a  TOP_CODONS[2])).
+0004cc10: 2020 7363 6f64 6f6e 5f6f 7267 203d 2027    scodon_org = '
+0004cc20: 2573 2c25 732c 2573 2720 2520 2872 6576  %s,%s,%s' % (rev
+0004cc30: 6572 7365 5f63 6f6d 706c 656d 656e 7428  erse_complement(
+0004cc40: 5354 4f50 5f43 4f44 4f4e 535b 305d 292c  STOP_CODONS[0]),
+0004cc50: 7265 7665 7273 655f 636f 6d70 6c65 6d65  reverse_compleme
+0004cc60: 6e74 2853 544f 505f 434f 444f 4e53 5b31  nt(STOP_CODONS[1
+0004cc70: 5d29 2c72 6576 6572 7365 5f63 6f6d 706c  ]),reverse_compl
+0004cc80: 656d 656e 7428 5354 4f50 5f43 4f44 4f4e  ement(STOP_CODON
+0004cc90: 535b 325d 2929 0a20 2020 2020 2020 2020  S[2])).         
+0004cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ccb0: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+0004ccc0: 7262 6f73 653a 2070 7269 6e74 2827 2020  rbose: print('  
+0004ccd0: 2053 4e50 2064 6574 6563 7465 6420 696e   SNP detected in
+0004cce0: 2053 746f 7020 636f 646f 6e20 6f66 2025   Stop codon of %
+0004ccf0: 733a 2025 7320 2d3e 2025 7327 2025 2028  s: %s -> %s' % (
+0004cd00: 7365 6c66 2e74 6964 2c20 7363 6f64 6f6e  self.tid, scodon
+0004cd10: 5f6f 7267 2c20 7365 715b 6c6f 633a 286c  _org, seq[loc:(l
+0004cd20: 6f63 2b33 295d 2920 290a 2020 2020 2020  oc+3)]) ).      
+0004cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cd40: 2020 2020 2020 656c 6966 2028 6c6f 6320        elif (loc 
+0004cd50: 3e20 2865 2e67 6574 5f6c 656e 2829 2d33  > (e.get_len()-3
+0004cd60: 2929 207c 2028 6c6f 6320 3c20 3029 3a0a  )) | (loc < 0):.
+0004cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cd90: 6220 3d20 320a 2020 2020 2020 2020 2020  b = 2.          
 0004cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cdc0: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
-0004cdd0: 7072 696e 7428 2720 2020 534e 5020 6465  print('   SNP de
-0004cde0: 7465 6374 6564 2069 6e20 5374 6f70 2063  tected in Stop c
-0004cdf0: 6f64 6f6e 206f 6620 2573 3a20 2573 202d  odon of %s: %s -
-0004ce00: 3e20 2573 2720 2520 2873 656c 662e 7469  > %s' % (self.ti
-0004ce10: 642c 2073 636f 646f 6e5f 6f72 672c 2073  d, scodon_org, s
-0004ce20: 6571 5b6c 6f63 3a28 6c6f 632b 3329 5d29  eq[loc:(loc+3)])
-0004ce30: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0004ce40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004ce50: 6c69 6620 286c 6f63 203e 2028 652e 6765  lif (loc > (e.ge
-0004ce60: 745f 6c65 6e28 292d 3329 2920 7c20 286c  t_len()-3)) | (l
-0004ce70: 6f63 203c 2030 293a 0a20 2020 2020 2020  oc < 0):.       
+0004cdb0: 2020 2020 2020 6966 206c 6f63 203c 2030        if loc < 0
+0004cdc0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0004cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cde0: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
+0004cdf0: 5f63 6f64 6f6e 5f65 7665 6e74 203d 2043  _codon_event = C
+0004ce00: 4f44 4f4e 5f57 4954 485f 494e 4445 4c0a  ODON_WITH_INDEL.
+0004ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ce30: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+0004ce40: 7072 696e 7428 2720 2020 494e 4445 4c20  print('   INDEL 
+0004ce50: 6465 7465 6374 6564 2069 6e20 5374 6f70  detected in Stop
+0004ce60: 2063 6f64 6f6e 206f 6620 2573 2720 2520   codon of %s' % 
+0004ce70: 2873 656c 662e 7469 6429 2029 0a20 2020  (self.tid) ).   
 0004ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ce90: 2020 2020 2020 2020 2062 203d 2032 0a20           b = 2. 
-0004cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ceb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004cec0: 6620 6c6f 6320 3c20 303a 200a 2020 2020  f loc < 0: .    
-0004ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cef0: 7365 6c66 2e73 746f 705f 636f 646f 6e5f  self.stop_codon_
-0004cf00: 6576 656e 7420 3d20 434f 444f 4e5f 5749  event = CODON_WI
-0004cf10: 5448 5f49 4e44 454c 0a20 2020 2020 2020  TH_INDEL.       
-0004cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cf30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004cf40: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-0004cf50: 2020 2049 4e44 454c 2064 6574 6563 7465     INDEL detecte
-0004cf60: 6420 696e 2053 746f 7020 636f 646f 6e20  d in Stop codon 
-0004cf70: 6f66 2025 7327 2025 2028 7365 6c66 2e74  of %s' % (self.t
-0004cf80: 6964 2920 290a 2020 2020 2020 2020 2020  id) ).          
+0004ce90: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+0004cea0: 7269 6e74 2827 494e 464f 2069 6e20 7570  rint('INFO in up
+0004ceb0: 6461 7465 5f69 6e66 6f3a 2025 7320 7374  date_info: %s st
+0004cec0: 6f70 2063 6f64 6f6e 2073 6565 6d73 2074  op codon seems t
+0004ced0: 6f20 6265 206d 6f76 6564 2e20 2843 6f76  o be moved. (Cov
+0004cee0: 3a25 692c 204c 3a25 6929 2720 2520 2873  :%i, L:%i)' % (s
+0004cef0: 656c 662e 7469 642c 2069 6e74 2831 3030  elf.tid, int(100
+0004cf00: 2a73 656c 662e 636f 762f 7365 6c66 2e6c  *self.cov/self.l
+0004cf10: 656e 292c 2073 656c 662e 6c65 6e29 290a  en), self.len)).
+0004cf20: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004cf30: 2020 2020 2020 2020 2020 6966 2062 203d            if b =
+0004cf40: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0004cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cf60: 2073 656c 662e 7374 6f70 5f63 6f64 6f6e   self.stop_codon
+0004cf70: 5f70 6f73 203d 2073 656c 662e 7374 6f70  _pos = self.stop
+0004cf80: 5f63 6f64 6f6e 5f70 6f73 5f6f 7267 0a20  _codon_pos_org. 
 0004cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cfa0: 2020 2020 2020 2320 7072 696e 7428 2749        # print('I
-0004cfb0: 4e46 4f20 696e 2075 7064 6174 655f 696e  NFO in update_in
-0004cfc0: 666f 3a20 2573 2073 746f 7020 636f 646f  fo: %s stop codo
-0004cfd0: 6e20 7365 656d 7320 746f 2062 6520 6d6f  n seems to be mo
-0004cfe0: 7665 642e 2028 436f 763a 2569 2c20 4c3a  ved. (Cov:%i, L:
-0004cff0: 2569 2927 2025 2028 7365 6c66 2e74 6964  %i)' % (self.tid
-0004d000: 2c20 696e 7428 3130 302a 7365 6c66 2e63  , int(100*self.c
-0004d010: 6f76 2f73 656c 662e 6c65 6e29 2c20 7365  ov/self.len), se
-0004d020: 6c66 2e6c 656e 2929 0a0a 0a20 2020 2020  lf.len))...     
+0004cfa0: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+0004cfb0: 662e 7374 6f70 5f63 6f64 6f6e 5f76 616c  f.stop_codon_val
+0004cfc0: 6964 203d 2054 7275 650a 2020 2020 2020  id = True.      
+0004cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cfe0: 2023 2727 270a 0a20 2020 2020 2020 2020   #'''..         
+0004cff0: 2020 2020 2020 2069 6620 4661 6c73 653a         if False:
+0004d000: 2023 2062 203c 2030 3a0a 2020 2020 2020   # b < 0:.      
+0004d010: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004d020: 2076 6572 626f 7365 3a20 0a20 2020 2020   verbose: .     
 0004d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d040: 2020 2069 6620 6220 3d3d 2030 3a0a 2020     if b == 0:.  
-0004d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d060: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0004d070: 746f 705f 636f 646f 6e5f 706f 7320 3d20  top_codon_pos = 
-0004d080: 7365 6c66 2e73 746f 705f 636f 646f 6e5f  self.stop_codon_
-0004d090: 706f 735f 6f72 670a 2020 2020 2020 2020  pos_org.        
-0004d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d0b0: 2020 2020 2320 7365 6c66 2e73 746f 705f      # self.stop_
-0004d0c0: 636f 646f 6e5f 7661 6c69 6420 3d20 5472  codon_valid = Tr
-0004d0d0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0004d0e0: 2020 2020 2020 2020 2020 2327 2727 0a0a            #'''..
-0004d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d100: 6966 2046 616c 7365 3a20 2320 6220 3c20  if False: # b < 
-0004d110: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0004d120: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-0004d130: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-0004d140: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0004d150: 7428 2749 4e46 4f20 696e 2075 7064 6174  t('INFO in updat
-0004d160: 655f 696e 666f 2028 2569 293a 2025 7320  e_info (%i): %s 
-0004d170: 7374 6f70 2063 6f64 6f6e 206e 6f74 2063  stop codon not c
-0004d180: 6f76 6572 6564 2e20 2843 6f76 3a25 692c  overed. (Cov:%i,
-0004d190: 204c 3a25 6929 2720 5c0a 2020 2020 2020   L:%i)' \.      
-0004d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d1b0: 2020 2020 2520 2862 2c20 7365 6c66 2e74      % (b, self.t
-0004d1c0: 6964 2c20 696e 7428 3130 302a 7365 6c66  id, int(100*self
-0004d1d0: 2e63 6f76 2f73 656c 662e 6c65 6e29 2c20  .cov/self.len), 
-0004d1e0: 7365 6c66 2e6c 656e 2929 0a20 2020 2020  self.len)).     
-0004d1f0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0004d200: 2020 2020 2323 2055 7064 6174 6520 4344      ## Update CD
-0004d210: 530a 2020 2020 2020 2020 7265 7475 726e  S.        return
-0004d220: 0a20 2020 200a 2020 2020 6465 6620 6765  .    .    def ge
-0004d230: 745f 7464 5f63 6f76 5f72 6174 696f 2873  t_td_cov_ratio(s
-0004d240: 656c 662c 2065 786f 6e73 2c20 7267 6e73  elf, exons, rgns
-0004d250: 2c20 7365 6c29 3a0a 2020 2020 2020 2020  , sel):.        
-0004d260: 0a20 2020 2020 2020 204c 656e 203d 2030  .        Len = 0
-0004d270: 0a20 2020 2020 2020 2043 6f76 203d 2030  .        Cov = 0
-0004d280: 0a20 2020 2020 2020 2069 6620 7365 6c20  .        if sel 
-0004d290: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0004d2a0: 2020 666f 7220 7220 696e 2072 676e 732e    for r in rgns.
-0004d2b0: 7267 6e73 3a0a 2020 2020 2020 2020 2020  rgns:.          
-0004d2c0: 2020 2020 2020 6966 2028 722e 7479 7065        if (r.type
-0004d2d0: 2021 3d20 2764 656c 6574 696f 6e27 2920   != 'deletion') 
-0004d2e0: 2620 2872 2e74 7970 6520 213d 2027 4427  & (r.type != 'D'
-0004d2f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0004d300: 2020 2020 2020 204c 656e 202b 3d20 6c65         Len += le
-0004d310: 6e28 722e 7365 7129 0a20 2020 2020 2020  n(r.seq).       
-0004d320: 2020 2020 2020 2020 2020 2020 2043 6f76               Cov
-0004d330: 202b 3d20 722e 636f 765f 6c65 6e0a 2020   += r.cov_len.  
-0004d340: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0004d350: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
-0004d360: 2065 786f 6e73 2e72 676e 733a 0a20 2020   exons.rgns:.   
-0004d370: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004d380: 2872 2e74 7970 6520 213d 2027 6465 6c65  (r.type != 'dele
-0004d390: 7469 6f6e 2729 2026 2028 722e 7479 7065  tion') & (r.type
-0004d3a0: 2021 3d20 2744 2729 3a0a 2020 2020 2020   != 'D'):.      
-0004d3b0: 2020 2020 2020 2020 2020 2020 2020 4c65                Le
-0004d3c0: 6e20 2b3d 206c 656e 2872 2e73 6571 290a  n += len(r.seq).
-0004d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d3e0: 2020 2020 436f 7620 2b3d 2072 2e63 6f76      Cov += r.cov
-0004d3f0: 5f6c 656e 0a20 2020 2020 2020 200a 2020  _len.        .  
-0004d400: 2020 2020 2020 6966 204c 656e 203d 3d20        if Len == 
-0004d410: 303a 200a 2020 2020 2020 2020 2020 2020  0: .            
-0004d420: 7265 7475 726e 2030 0a20 2020 2020 2020  return 0.       
-0004d430: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0004d440: 2020 2072 6574 7572 6e20 436f 762f 4c65     return Cov/Le
-0004d450: 6e0a 2020 2020 2020 2020 0a20 2020 2020  n.        .     
-0004d460: 2020 200a 2020 2020 6465 6620 6765 745f     .    def get_
-0004d470: 7464 5f63 6f76 2873 656c 662c 2065 786f  td_cov(self, exo
-0004d480: 6e73 2c20 7267 6e73 293a 0a20 2020 2020  ns, rgns):.     
-0004d490: 2020 200a 2020 2020 2020 2020 746c 656e     .        tlen
-0004d4a0: 203d 2073 656c 662e 746c 656e 2023 2065   = self.tlen # e
-0004d4b0: 786f 6e73 2e67 6574 5f6c 656e 6774 6828  xons.get_length(
-0004d4c0: 290a 2020 2020 2020 2020 6966 2074 6c65  ).        if tle
-0004d4d0: 6e20 3d3d 2030 3a0a 2020 2020 2020 2020  n == 0:.        
-0004d4e0: 2020 2020 7265 7475 726e 2030 0a20 2020      return 0.   
-0004d4f0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-0004d500: 206c 656e 2872 676e 732e 7267 6e73 2920   len(rgns.rgns) 
-0004d510: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0004d520: 2069 6620 7365 6c66 2e63 6f76 5f6c 656e   if self.cov_len
-0004d530: 203e 3d20 303a 0a20 2020 2020 2020 2020   >= 0:.         
-0004d540: 2020 2020 2020 206f 6c65 6e20 3d20 7365         olen = se
-0004d550: 6c66 2e63 6f76 5f6c 656e 0a20 2020 2020  lf.cov_len.     
-0004d560: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0004d570: 2020 2020 2020 2020 2020 2020 206f 6c65               ole
-0004d580: 6e20 3d20 300a 2020 2020 2020 2020 2020  n = 0.          
-0004d590: 2020 2020 2020 666f 7220 6d20 696e 2073        for m in s
-0004d5a0: 656c 662e 7472 5f74 6f5f 6772 5f6d 6170  elf.tr_to_gr_map
-0004d5b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004d5c0: 2020 2020 2020 6f6c 656e 202b 3d20 7267        olen += rg
-0004d5d0: 6e73 2e72 676e 735b 6d5d 2e67 6574 5f63  ns.rgns[m].get_c
-0004d5e0: 6f76 5f6c 656e 2829 0a20 2020 2020 2020  ov_len().       
-0004d5f0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0004d600: 2020 2020 2020 7265 7475 726e 206f 6c65        return ole
-0004d610: 6e2f 746c 656e 0a20 2020 2020 2020 2065  n/tlen.        e
-0004d620: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0004d630: 206f 6c65 6e20 3d20 6578 6f6e 732e 636f   olen = exons.co
-0004d640: 756e 745f 7661 6c69 645f 4e54 2829 0a20  unt_valid_NT(). 
-0004d650: 2020 2020 2020 2020 2020 2069 6620 746c             if tl
-0004d660: 656e 203d 3d20 303a 0a20 2020 2020 2020  en == 0:.       
-0004d670: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0004d680: 4552 524f 5220 2573 3a20 6c65 6e67 7468  ERROR %s: length
-0004d690: 2030 2720 2520 7365 6c66 2e74 6964 290a   0' % self.tid).
-0004d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6b0: 666f 7220 6d20 696e 2073 656c 662e 7472  for m in self.tr
-0004d6c0: 5f74 6f5f 6772 5f6d 6170 3a0a 2020 2020  _to_gr_map:.    
-0004d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6e0: 7267 6e73 2e72 676e 735b 6d5d 2e70 7269  rgns.rgns[m].pri
-0004d6f0: 6e74 5f73 686f 7274 2829 0a20 2020 2020  nt_short().     
-0004d700: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0004d710: 6e20 310a 2020 2020 2020 2020 2020 2020  n 1.            
-0004d720: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0004d730: 2020 2020 2020 7265 7475 726e 206f 6c65        return ole
-0004d740: 6e2f 746c 656e 0a20 2020 2020 2020 2020  n/tlen.         
-0004d750: 2020 2020 2020 200a 2020 2020 2727 270a         .    '''.
-0004d760: 2020 2020 5452 5f65 7870 5f69 6e66 6f20      TR_exp_info 
-0004d770: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
-0004d780: 6d65 6474 7570 6c65 2827 5452 5f69 6e66  medtuple('TR_inf
-0004d790: 6f27 2c20 2774 6964 2c20 746e 616d 652c  o', 'tid, tname,
-0004d7a0: 2067 6964 2c20 676e 616d 652c 2063 6f76   gid, gname, cov
-0004d7b0: 2c20 6162 6e2c 2074 706d 2729 2020 0a20  , abn, tpm')  . 
-0004d7c0: 2020 2027 2727 0a0a 2020 2020 6465 6620     '''..    def 
-0004d7d0: 6765 745f 7464 5f69 6e66 6f28 7365 6c66  get_td_info(self
-0004d7e0: 293a 0a20 2020 2020 2020 200a 2020 2020  ):.        .    
-0004d7f0: 2020 2020 6966 2028 7365 6c66 2e63 6f76      if (self.cov
-0004d800: 203c 3d20 3029 207c 2028 6c65 6e28 7365   <= 0) | (len(se
-0004d810: 6c66 2e74 725f 746f 5f67 725f 6d61 7029  lf.tr_to_gr_map)
-0004d820: 203d 3d20 3029 3a0a 2020 2020 2020 2020   == 0):.        
-0004d830: 2020 2020 636f 7620 3d20 300a 2020 2020      cov = 0.    
-0004d840: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0004d850: 2020 2020 2020 636f 7620 3d20 726f 756e        cov = roun
-0004d860: 6428 7365 6c66 2e63 6f76 2c20 3329 0a0a  d(self.cov, 3)..
-0004d870: 2020 2020 2020 2020 6162 6e20 3d20 726f          abn = ro
-0004d880: 756e 6428 7365 6c66 2e61 626e 2c20 3329  und(self.abn, 3)
-0004d890: 0a20 2020 2020 2020 2069 6620 6162 6e20  .        if abn 
-0004d8a0: 3c20 303a 2061 626e 203d 2030 2020 2020  < 0: abn = 0    
-0004d8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d8d0: 200a 2020 2020 2020 2020 0a20 2020 2020   .        .     
-0004d8e0: 2020 2074 6920 3d20 5452 5f65 7870 5f69     ti = TR_exp_i
-0004d8f0: 6e66 6f28 7365 6c66 2e74 6964 2c20 7365  nfo(self.tid, se
-0004d900: 6c66 2e74 6e61 6d65 2c20 7365 6c66 2e67  lf.tname, self.g
-0004d910: 6964 2c20 7365 6c66 2e67 6e61 6d65 2c20  id, self.gname, 
-0004d920: 636f 762c 2061 626e 2c20 6162 6e29 0a20  cov, abn, abn). 
-0004d930: 2020 2020 2020 2072 6574 7572 6e20 7469         return ti
-0004d940: 0a20 2020 200a 0a20 2020 2064 6566 2063  .    ..    def c
-0004d950: 6865 636b 5f69 665f 7374 6172 745f 7374  heck_if_start_st
-0004d960: 6f70 5f63 6f64 6f6e 5f69 735f 636f 7665  op_codon_is_cove
-0004d970: 7265 6428 7365 6c66 2c20 7267 6e73 2c20  red(self, rgns, 
-0004d980: 6364 732c 2074 6172 6765 7420 3d20 2773  cds, target = 's
-0004d990: 7461 7274 5f63 6f64 6f6e 2729 3a0a 2020  tart_codon'):.  
-0004d9a0: 2020 2020 2020 0a20 2020 2020 2020 2062        .        b
-0004d9b0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0004d9c0: 2066 6f72 2063 2069 6e20 6364 732e 7267   for c in cds.rg
-0004d9d0: 6e73 3a20 0a20 2020 2020 2020 2020 2020  ns: .           
-0004d9e0: 2069 6620 632e 7479 7065 2e6c 6f77 6572   if c.type.lower
-0004d9f0: 2829 203d 3d20 7461 7267 6574 3a0a 2020  () == target:.  
-0004da00: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-0004da10: 203d 2063 0a20 2020 2020 2020 2020 2020   = c.           
-0004da20: 2020 2020 2062 203d 2054 7275 650a 2020       b = True.  
-0004da30: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0004da40: 6561 6b0a 2020 2020 2020 2020 6966 2062  eak.        if b
-0004da50: 3a0a 2020 2020 2020 2020 2020 2020 6220  :.            b 
-0004da60: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0004da70: 2020 2020 666f 7220 7220 696e 2072 676e      for r in rgn
-0004da80: 732e 7267 6e73 3a0a 2020 2020 2020 2020  s.rgns:.        
-0004da90: 2020 2020 2020 2020 6966 2073 632e 6765          if sc.ge
-0004daa0: 745f 6f76 6572 6c61 705f 6c65 6e28 7229  t_overlap_len(r)
-0004dab0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0004dac0: 2020 2020 2020 2020 2020 6220 3d20 5472            b = Tr
-0004dad0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0004dae0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-0004daf0: 2020 2020 2020 2020 2069 6620 623a 0a20           if b:. 
-0004db00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004db10: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-0004db20: 2020 2020 2020 2065 6c73 653a 200a 2020         else: .  
-0004db30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0004db40: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-0004db50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0004db60: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0004db70: 650a 2020 2020 2020 2020 0a20 2020 2020  e.        .     
-0004db80: 2020 200a 2020 2020 6465 6620 6765 745f     .    def get_
-0004db90: 6774 665f 6c69 6e65 735f 6672 6f6d 5f65  gtf_lines_from_e
-0004dba0: 786f 6e73 2873 656c 662c 2065 786f 6e73  xons(self, exons
-0004dbb0: 5f72 676e 732c 2072 676e 735f 7267 6e73  _rgns, rgns_rgns
-0004dbc0: 2c20 6364 735f 7267 6e73 2c20 6765 6e6f  , cds_rgns, geno
-0004dbd0: 6d65 2c20 7365 6c2c 2061 6464 5f73 6571  me, sel, add_seq
-0004dbe0: 2c20 636f 6e6e 6563 7420 3d20 4661 6c73  , connect = Fals
-0004dbf0: 6529 3a0a 2020 2020 2020 2020 0a20 2020  e):.        .   
-0004dc00: 2020 2020 2067 7466 5f6c 696e 6573 203d       gtf_lines =
-0004dc10: 205b 5d0a 0a20 2020 2020 2020 2069 6620   []..        if 
-0004dc20: 2873 656c 203d 3d20 3029 2026 2028 6c65  (sel == 0) & (le
-0004dc30: 6e28 7365 6c66 2e74 725f 746f 5f67 725f  n(self.tr_to_gr_
-0004dc40: 6d61 7029 203e 2030 293a 0a20 2020 2020  map) > 0):.     
-0004dc50: 2020 2020 2020 2072 676e 7320 3d20 7267         rgns = rg
-0004dc60: 6e73 5f72 676e 730a 2020 2020 2020 2020  ns_rgns.        
-0004dc70: 2020 2020 7467 6d20 3d20 7365 6c66 2e74      tgm = self.t
-0004dc80: 725f 746f 5f67 725f 6d61 700a 2020 2020  r_to_gr_map.    
-0004dc90: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0004dca0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0004dcb0: 2020 2072 676e 7320 3d20 6578 6f6e 735f     rgns = exons_
-0004dcc0: 7267 6e73 0a20 2020 2020 2020 2020 2020  rgns.           
-0004dcd0: 2074 676d 203d 2073 656c 662e 7465 5f74   tgm = self.te_t
-0004dce0: 6f5f 6765 5f6d 6170 0a20 2020 2020 2020  o_ge_map.       
-0004dcf0: 2020 2020 200a 2020 2020 2020 2020 656e       .        en
-0004dd00: 7472 6965 7320 3d20 7265 6769 6f6e 7328  tries = regions(
-0004dd10: 290a 2020 2020 2020 2020 2320 7365 7173  ).        # seqs
-0004dd20: 203d 205b 5d0a 2020 2020 2020 2020 2320   = [].        # 
-0004dd30: 636e 7420 3d20 300a 2020 2020 2020 2020  cnt = 0.        
-0004dd40: 6966 206e 6f74 2063 6f6e 6e65 6374 3a0a  if not connect:.
-0004dd50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0004dd60: 6b2c 206d 2069 6e20 656e 756d 6572 6174  k, m in enumerat
-0004dd70: 6528 7467 6d29 3a0a 2020 2020 2020 2020  e(tgm):.        
-0004dd80: 2020 2020 2020 2020 6520 3d20 7267 6e73          e = rgns
-0004dd90: 5b6d 5d0a 2020 2020 2020 2020 2020 2020  [m].            
-0004dda0: 2020 2020 7220 3d20 7265 6769 6f6e 2865      r = region(e
-0004ddb0: 2e63 6872 2c20 652e 7374 6172 742c 2065  .chr, e.start, e
-0004ddc0: 2e65 6e64 2c20 652e 7479 7065 2c20 7873  .end, e.type, xs
-0004ddd0: 203d 2031 290a 2020 2020 2020 2020 2020   = 1).          
-0004dde0: 2020 2020 2020 6966 2028 652e 7479 7065        if (e.type
-0004ddf0: 2021 3d20 2764 656c 6574 696f 6e27 293a   != 'deletion'):
-0004de00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0004de10: 2020 2020 2020 722e 7365 7120 3d20 652e        r.seq = e.
-0004de20: 7365 710a 2020 2020 2020 2020 2020 2020  seq.            
-0004de30: 2020 2020 2020 2020 722e 636f 765f 6c65          r.cov_le
-0004de40: 6e20 3d20 652e 636f 765f 6c65 6e0a 0a20  n = e.cov_len.. 
-0004de50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004de60: 2e63 7667 5f66 7261 6320 3d20 652e 6376  .cvg_frac = e.cv
-0004de70: 675f 6672 6163 0a20 2020 2020 2020 2020  g_frac.         
-0004de80: 2020 2020 2020 2072 2e61 7665 5f63 7667         r.ave_cvg
-0004de90: 203d 2065 2e61 7665 5f63 7667 0a20 2020   = e.ave_cvg.   
-0004dea0: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-0004deb0: 7269 6573 2e72 676e 732e 6170 7065 6e64  ries.rgns.append
-0004dec0: 2820 7220 290a 2020 2020 2020 2020 656c  ( r ).        el
-0004ded0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0004dee0: 666f 7220 6b2c 206d 2069 6e20 656e 756d  for k, m in enum
-0004def0: 6572 6174 6528 7467 6d29 3a0a 2020 2020  erate(tgm):.    
-0004df00: 2020 2020 2020 2020 2020 2020 6520 3d20              e = 
-0004df10: 7267 6e73 5b6d 5d0a 2020 2020 2020 2020  rgns[m].        
-0004df20: 2020 2020 2020 2020 6966 206b 203d 3d20          if k == 
-0004df30: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0004df40: 2020 2020 2020 2072 203d 2072 6567 696f         r = regio
-0004df50: 6e28 652e 6368 722c 2065 2e73 7461 7274  n(e.chr, e.start
-0004df60: 2c20 652e 656e 642c 2065 2e74 7970 652c  , e.end, e.type,
-0004df70: 2078 7320 3d20 3129 0a20 2020 2020 2020   xs = 1).       
-0004df80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004df90: 2865 2e74 7970 6520 213d 2027 6465 6c65  (e.type != 'dele
-0004dfa0: 7469 6f6e 2729 3a20 0a20 2020 2020 2020  tion'): .       
-0004dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dfc0: 2072 2e73 6571 203d 2065 2e73 6571 0a20   r.seq = e.seq. 
-0004dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dfe0: 2020 2020 2020 2072 2e63 6f76 5f6c 656e         r.cov_len
-0004dff0: 203d 2065 2e63 6f76 5f6c 656e 0a0a 2020   = e.cov_len..  
-0004e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e010: 2020 722e 6376 675f 6672 6163 203d 2065    r.cvg_frac = e
-0004e020: 2e63 7667 5f66 7261 630a 2020 2020 2020  .cvg_frac.      
-0004e030: 2020 2020 2020 2020 2020 2020 2020 722e                r.
-0004e040: 6176 655f 6376 6720 3d20 652e 6176 655f  ave_cvg = e.ave_
-0004e050: 6376 670a 2020 2020 2020 2020 2020 2020  cvg.            
-0004e060: 2020 2020 2020 2020 656e 7472 6965 732e          entries.
-0004e070: 7267 6e73 2e61 7070 656e 6428 2072 2029  rgns.append( r )
-0004e080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e090: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0004e0a0: 2020 2020 2020 2020 2020 2062 203d 2054             b = T
-0004e0b0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0004e0c0: 2020 2020 2020 2020 6966 2065 6e74 7269          if entri
-0004e0d0: 6573 2e72 676e 735b 2d31 5d2e 656e 6420  es.rgns[-1].end 
-0004e0e0: 3d3d 2028 652e 7374 6172 742d 3129 3a0a  == (e.start-1):.
+0004d040: 2020 2070 7269 6e74 2827 494e 464f 2069     print('INFO i
+0004d050: 6e20 7570 6461 7465 5f69 6e66 6f20 2825  n update_info (%
+0004d060: 6929 3a20 2573 2073 746f 7020 636f 646f  i): %s stop codo
+0004d070: 6e20 6e6f 7420 636f 7665 7265 642e 2028  n not covered. (
+0004d080: 436f 763a 2569 2c20 4c3a 2569 2927 205c  Cov:%i, L:%i)' \
+0004d090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d0a0: 2020 2020 2020 2020 2020 2025 2028 622c             % (b,
+0004d0b0: 2073 656c 662e 7469 642c 2069 6e74 2831   self.tid, int(1
+0004d0c0: 3030 2a73 656c 662e 636f 762f 7365 6c66  00*self.cov/self
+0004d0d0: 2e6c 656e 292c 2073 656c 662e 6c65 6e29  .len), self.len)
+0004d0e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004d0f0: 2020 0a20 2020 2020 2020 2023 2320 5570    .        ## Up
+0004d100: 6461 7465 2043 4453 0a20 2020 2020 2020  date CDS.       
+0004d110: 2072 6574 7572 6e0a 2020 2020 0a20 2020   return.    .   
+0004d120: 2064 6566 2067 6574 5f74 645f 636f 765f   def get_td_cov_
+0004d130: 7261 7469 6f28 7365 6c66 2c20 6578 6f6e  ratio(self, exon
+0004d140: 732c 2072 676e 732c 2073 656c 293a 0a20  s, rgns, sel):. 
+0004d150: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0004d160: 4c65 6e20 3d20 300a 2020 2020 2020 2020  Len = 0.        
+0004d170: 436f 7620 3d20 300a 2020 2020 2020 2020  Cov = 0.        
+0004d180: 6966 2073 656c 203d 3d20 303a 0a20 2020  if sel == 0:.   
+0004d190: 2020 2020 2020 2020 2066 6f72 2072 2069           for r i
+0004d1a0: 6e20 7267 6e73 2e72 676e 733a 0a20 2020  n rgns.rgns:.   
+0004d1b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004d1c0: 2872 2e74 7970 6520 213d 2027 6465 6c65  (r.type != 'dele
+0004d1d0: 7469 6f6e 2729 2026 2028 722e 7479 7065  tion') & (r.type
+0004d1e0: 2021 3d20 2744 2729 3a0a 2020 2020 2020   != 'D'):.      
+0004d1f0: 2020 2020 2020 2020 2020 2020 2020 4c65                Le
+0004d200: 6e20 2b3d 206c 656e 2872 2e73 6571 290a  n += len(r.seq).
+0004d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d220: 2020 2020 436f 7620 2b3d 2072 2e63 6f76      Cov += r.cov
+0004d230: 5f6c 656e 0a20 2020 2020 2020 2065 6c73  _len.        els
+0004d240: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+0004d250: 6f72 2072 2069 6e20 6578 6f6e 732e 7267  or r in exons.rg
+0004d260: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0004d270: 2020 2020 6966 2028 722e 7479 7065 2021      if (r.type !
+0004d280: 3d20 2764 656c 6574 696f 6e27 2920 2620  = 'deletion') & 
+0004d290: 2872 2e74 7970 6520 213d 2027 4427 293a  (r.type != 'D'):
+0004d2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d2b0: 2020 2020 204c 656e 202b 3d20 6c65 6e28       Len += len(
+0004d2c0: 722e 7365 7129 0a20 2020 2020 2020 2020  r.seq).         
+0004d2d0: 2020 2020 2020 2020 2020 2043 6f76 202b             Cov +
+0004d2e0: 3d20 722e 636f 765f 6c65 6e0a 2020 2020  = r.cov_len.    
+0004d2f0: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+0004d300: 4c65 6e20 3d3d 2030 3a20 0a20 2020 2020  Len == 0: .     
+0004d310: 2020 2020 2020 2072 6574 7572 6e20 300a         return 0.
+0004d320: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004d330: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0004d340: 2043 6f76 2f4c 656e 0a20 2020 2020 2020   Cov/Len.       
+0004d350: 200a 2020 2020 2020 2020 0a20 2020 2064   .        .    d
+0004d360: 6566 2067 6574 5f74 645f 636f 7628 7365  ef get_td_cov(se
+0004d370: 6c66 2c20 6578 6f6e 732c 2072 676e 7329  lf, exons, rgns)
+0004d380: 3a0a 2020 2020 2020 2020 0a20 2020 2020  :.        .     
+0004d390: 2020 2074 6c65 6e20 3d20 7365 6c66 2e74     tlen = self.t
+0004d3a0: 6c65 6e20 2320 6578 6f6e 732e 6765 745f  len # exons.get_
+0004d3b0: 6c65 6e67 7468 2829 0a20 2020 2020 2020  length().       
+0004d3c0: 2069 6620 746c 656e 203d 3d20 303a 0a20   if tlen == 0:. 
+0004d3d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0004d3e0: 6e20 300a 2020 2020 2020 2020 0a20 2020  n 0.        .   
+0004d3f0: 2020 2020 2069 6620 6c65 6e28 7267 6e73       if len(rgns
+0004d400: 2e72 676e 7329 203e 2030 3a0a 2020 2020  .rgns) > 0:.    
+0004d410: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0004d420: 636f 765f 6c65 6e20 3e3d 2030 3a0a 2020  cov_len >= 0:.  
+0004d430: 2020 2020 2020 2020 2020 2020 2020 6f6c                ol
+0004d440: 656e 203d 2073 656c 662e 636f 765f 6c65  en = self.cov_le
+0004d450: 6e0a 2020 2020 2020 2020 2020 2020 656c  n.            el
+0004d460: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0004d470: 2020 2020 6f6c 656e 203d 2030 0a20 2020      olen = 0.   
+0004d480: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004d490: 206d 2069 6e20 7365 6c66 2e74 725f 746f   m in self.tr_to
+0004d4a0: 5f67 725f 6d61 703a 0a20 2020 2020 2020  _gr_map:.       
+0004d4b0: 2020 2020 2020 2020 2020 2020 206f 6c65               ole
+0004d4c0: 6e20 2b3d 2072 676e 732e 7267 6e73 5b6d  n += rgns.rgns[m
+0004d4d0: 5d2e 6765 745f 636f 765f 6c65 6e28 290a  ].get_cov_len().
+0004d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d4f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0004d500: 7572 6e20 6f6c 656e 2f74 6c65 6e0a 2020  urn olen/tlen.  
+0004d510: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0004d520: 2020 2020 2020 2020 6f6c 656e 203d 2065          olen = e
+0004d530: 786f 6e73 2e63 6f75 6e74 5f76 616c 6964  xons.count_valid
+0004d540: 5f4e 5428 290a 2020 2020 2020 2020 2020  _NT().          
+0004d550: 2020 6966 2074 6c65 6e20 3d3d 2030 3a0a    if tlen == 0:.
+0004d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d570: 7072 696e 7428 2745 5252 4f52 2025 733a  print('ERROR %s:
+0004d580: 206c 656e 6774 6820 3027 2025 2073 656c   length 0' % sel
+0004d590: 662e 7469 6429 0a20 2020 2020 2020 2020  f.tid).         
+0004d5a0: 2020 2020 2020 2066 6f72 206d 2069 6e20         for m in 
+0004d5b0: 7365 6c66 2e74 725f 746f 5f67 725f 6d61  self.tr_to_gr_ma
+0004d5c0: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
+0004d5d0: 2020 2020 2020 2072 676e 732e 7267 6e73         rgns.rgns
+0004d5e0: 5b6d 5d2e 7072 696e 745f 7368 6f72 7428  [m].print_short(
+0004d5f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004d600: 2020 7265 7475 726e 2031 0a20 2020 2020    return 1.     
+0004d610: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0004d620: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0004d630: 7572 6e20 6f6c 656e 2f74 6c65 6e0a 2020  urn olen/tlen.  
+0004d640: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0004d650: 2020 2027 2727 0a20 2020 2054 525f 6578     '''.    TR_ex
+0004d660: 705f 696e 666f 203d 2063 6f6c 6c65 6374  p_info = collect
+0004d670: 696f 6e73 2e6e 616d 6564 7475 706c 6528  ions.namedtuple(
+0004d680: 2754 525f 696e 666f 272c 2027 7469 642c  'TR_info', 'tid,
+0004d690: 2074 6e61 6d65 2c20 6769 642c 2067 6e61   tname, gid, gna
+0004d6a0: 6d65 2c20 636f 762c 2061 626e 2c20 7470  me, cov, abn, tp
+0004d6b0: 6d27 2920 200a 2020 2020 2727 270a 0a20  m')  .    '''.. 
+0004d6c0: 2020 2064 6566 2067 6574 5f74 645f 696e     def get_td_in
+0004d6d0: 666f 2873 656c 6629 3a0a 2020 2020 2020  fo(self):.      
+0004d6e0: 2020 0a20 2020 2020 2020 2069 6620 2873    .        if (s
+0004d6f0: 656c 662e 636f 7620 3c3d 2030 2920 7c20  elf.cov <= 0) | 
+0004d700: 286c 656e 2873 656c 662e 7472 5f74 6f5f  (len(self.tr_to_
+0004d710: 6772 5f6d 6170 2920 3d3d 2030 293a 0a20  gr_map) == 0):. 
+0004d720: 2020 2020 2020 2020 2020 2063 6f76 203d             cov =
+0004d730: 2030 0a20 2020 2020 2020 2065 6c73 653a   0.        else:
+0004d740: 0a20 2020 2020 2020 2020 2020 2063 6f76  .            cov
+0004d750: 203d 2072 6f75 6e64 2873 656c 662e 636f   = round(self.co
+0004d760: 762c 2033 290a 0a20 2020 2020 2020 2061  v, 3)..        a
+0004d770: 626e 203d 2072 6f75 6e64 2873 656c 662e  bn = round(self.
+0004d780: 6162 6e2c 2033 290a 2020 2020 2020 2020  abn, 3).        
+0004d790: 6966 2061 626e 203c 2030 3a20 6162 6e20  if abn < 0: abn 
+0004d7a0: 3d20 3020 2020 2020 2020 2020 2020 2020  = 0             
+0004d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d7c0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0004d7d0: 200a 2020 2020 2020 2020 7469 203d 2054   .        ti = T
+0004d7e0: 525f 6578 705f 696e 666f 2873 656c 662e  R_exp_info(self.
+0004d7f0: 7469 642c 2073 656c 662e 746e 616d 652c  tid, self.tname,
+0004d800: 2073 656c 662e 6769 642c 2073 656c 662e   self.gid, self.
+0004d810: 676e 616d 652c 2063 6f76 2c20 6162 6e2c  gname, cov, abn,
+0004d820: 2061 626e 290a 2020 2020 2020 2020 7265   abn).        re
+0004d830: 7475 726e 2074 690a 2020 2020 0a0a 2020  turn ti.    ..  
+0004d840: 2020 6465 6620 6368 6563 6b5f 6966 5f73    def check_if_s
+0004d850: 7461 7274 5f73 746f 705f 636f 646f 6e5f  tart_stop_codon_
+0004d860: 6973 5f63 6f76 6572 6564 2873 656c 662c  is_covered(self,
+0004d870: 2072 676e 732c 2063 6473 2c20 7461 7267   rgns, cds, targ
+0004d880: 6574 203d 2027 7374 6172 745f 636f 646f  et = 'start_codo
+0004d890: 6e27 293a 0a20 2020 2020 2020 200a 2020  n'):.        .  
+0004d8a0: 2020 2020 2020 6220 3d20 4661 6c73 650a        b = False.
+0004d8b0: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
+0004d8c0: 2063 6473 2e72 676e 733a 200a 2020 2020   cds.rgns: .    
+0004d8d0: 2020 2020 2020 2020 6966 2063 2e74 7970          if c.typ
+0004d8e0: 652e 6c6f 7765 7228 2920 3d3d 2074 6172  e.lower() == tar
+0004d8f0: 6765 743a 0a20 2020 2020 2020 2020 2020  get:.           
+0004d900: 2020 2020 2073 6320 3d20 630a 2020 2020       sc = c.    
+0004d910: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+0004d920: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0004d930: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+0004d940: 2020 2069 6620 623a 0a20 2020 2020 2020     if b:.       
+0004d950: 2020 2020 2062 203d 2046 616c 7365 0a20       b = False. 
+0004d960: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+0004d970: 2069 6e20 7267 6e73 2e72 676e 733a 0a20   in rgns.rgns:. 
+0004d980: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004d990: 6620 7363 2e67 6574 5f6f 7665 726c 6170  f sc.get_overlap
+0004d9a0: 5f6c 656e 2872 2920 3e20 303a 0a20 2020  _len(r) > 0:.   
+0004d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d9c0: 2062 203d 2054 7275 650a 2020 2020 2020   b = True.      
+0004d9d0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0004d9e0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0004d9f0: 6966 2062 3a0a 2020 2020 2020 2020 2020  if b:.          
+0004da00: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0004da10: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+0004da20: 7365 3a20 0a20 2020 2020 2020 2020 2020  se: .           
+0004da30: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0004da40: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+0004da50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0004da60: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0004da70: 200a 2020 2020 2020 2020 0a20 2020 2064   .        .    d
+0004da80: 6566 2067 6574 5f67 7466 5f6c 696e 6573  ef get_gtf_lines
+0004da90: 5f66 726f 6d5f 6578 6f6e 7328 7365 6c66  _from_exons(self
+0004daa0: 2c20 6578 6f6e 735f 7267 6e73 2c20 7267  , exons_rgns, rg
+0004dab0: 6e73 5f72 676e 732c 2063 6473 5f72 676e  ns_rgns, cds_rgn
+0004dac0: 732c 2067 656e 6f6d 652c 2073 656c 2c20  s, genome, sel, 
+0004dad0: 6164 645f 7365 712c 2063 6f6e 6e65 6374  add_seq, connect
+0004dae0: 203d 2046 616c 7365 293a 0a20 2020 2020   = False):.     
+0004daf0: 2020 200a 2020 2020 2020 2020 6774 665f     .        gtf_
+0004db00: 6c69 6e65 7320 3d20 5b5d 0a0a 2020 2020  lines = []..    
+0004db10: 2020 2020 6966 2028 7365 6c20 3d3d 2030      if (sel == 0
+0004db20: 2920 2620 286c 656e 2873 656c 662e 7472  ) & (len(self.tr
+0004db30: 5f74 6f5f 6772 5f6d 6170 2920 3e20 3029  _to_gr_map) > 0)
+0004db40: 3a0a 2020 2020 2020 2020 2020 2020 7267  :.            rg
+0004db50: 6e73 203d 2072 676e 735f 7267 6e73 0a20  ns = rgns_rgns. 
+0004db60: 2020 2020 2020 2020 2020 2074 676d 203d             tgm =
+0004db70: 2073 656c 662e 7472 5f74 6f5f 6772 5f6d   self.tr_to_gr_m
+0004db80: 6170 0a20 2020 2020 2020 2020 2020 200a  ap.            .
+0004db90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004dba0: 2020 2020 2020 2020 2020 7267 6e73 203d            rgns =
+0004dbb0: 2065 786f 6e73 5f72 676e 730a 2020 2020   exons_rgns.    
+0004dbc0: 2020 2020 2020 2020 7467 6d20 3d20 7365          tgm = se
+0004dbd0: 6c66 2e74 655f 746f 5f67 655f 6d61 700a  lf.te_to_ge_map.
+0004dbe0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0004dbf0: 2020 2020 2065 6e74 7269 6573 203d 2072       entries = r
+0004dc00: 6567 696f 6e73 2829 0a20 2020 2020 2020  egions().       
+0004dc10: 2023 2073 6571 7320 3d20 5b5d 0a20 2020   # seqs = [].   
+0004dc20: 2020 2020 2023 2063 6e74 203d 2030 0a20       # cnt = 0. 
+0004dc30: 2020 2020 2020 2069 6620 6e6f 7420 636f         if not co
+0004dc40: 6e6e 6563 743a 0a20 2020 2020 2020 2020  nnect:.         
+0004dc50: 2020 2066 6f72 206b 2c20 6d20 696e 2065     for k, m in e
+0004dc60: 6e75 6d65 7261 7465 2874 676d 293a 0a20  numerate(tgm):. 
+0004dc70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004dc80: 203d 2072 676e 735b 6d5d 0a20 2020 2020   = rgns[m].     
+0004dc90: 2020 2020 2020 2020 2020 2072 203d 2072             r = r
+0004dca0: 6567 696f 6e28 652e 6368 722c 2065 2e73  egion(e.chr, e.s
+0004dcb0: 7461 7274 2c20 652e 656e 642c 2065 2e74  tart, e.end, e.t
+0004dcc0: 7970 652c 2078 7320 3d20 3129 0a20 2020  ype, xs = 1).   
+0004dcd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004dce0: 2865 2e74 7970 6520 213d 2027 6465 6c65  (e.type != 'dele
+0004dcf0: 7469 6f6e 2729 3a20 0a20 2020 2020 2020  tion'): .       
+0004dd00: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
+0004dd10: 6571 203d 2065 2e73 6571 0a20 2020 2020  eq = e.seq.     
+0004dd20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0004dd30: 2e63 6f76 5f6c 656e 203d 2065 2e63 6f76  .cov_len = e.cov
+0004dd40: 5f6c 656e 0a0a 2020 2020 2020 2020 2020  _len..          
+0004dd50: 2020 2020 2020 722e 6376 675f 6672 6163        r.cvg_frac
+0004dd60: 203d 2065 2e63 7667 5f66 7261 630a 2020   = e.cvg_frac.  
+0004dd70: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+0004dd80: 6176 655f 6376 6720 3d20 652e 6176 655f  ave_cvg = e.ave_
+0004dd90: 6376 670a 2020 2020 2020 2020 2020 2020  cvg.            
+0004dda0: 2020 2020 656e 7472 6965 732e 7267 6e73      entries.rgns
+0004ddb0: 2e61 7070 656e 6428 2072 2029 0a20 2020  .append( r ).   
+0004ddc0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0004ddd0: 2020 2020 2020 2066 6f72 206b 2c20 6d20         for k, m 
+0004dde0: 696e 2065 6e75 6d65 7261 7465 2874 676d  in enumerate(tgm
+0004ddf0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0004de00: 2020 2065 203d 2072 676e 735b 6d5d 0a20     e = rgns[m]. 
+0004de10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004de20: 6620 6b20 3d3d 2030 3a0a 2020 2020 2020  f k == 0:.      
+0004de30: 2020 2020 2020 2020 2020 2020 2020 7220                r 
+0004de40: 3d20 7265 6769 6f6e 2865 2e63 6872 2c20  = region(e.chr, 
+0004de50: 652e 7374 6172 742c 2065 2e65 6e64 2c20  e.start, e.end, 
+0004de60: 652e 7479 7065 2c20 7873 203d 2031 290a  e.type, xs = 1).
+0004de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004de80: 2020 2020 6966 2028 652e 7479 7065 2021      if (e.type !
+0004de90: 3d20 2764 656c 6574 696f 6e27 293a 200a  = 'deletion'): .
+0004dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004deb0: 2020 2020 2020 2020 722e 7365 7120 3d20          r.seq = 
+0004dec0: 652e 7365 710a 2020 2020 2020 2020 2020  e.seq.          
+0004ded0: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+0004dee0: 636f 765f 6c65 6e20 3d20 652e 636f 765f  cov_len = e.cov_
+0004def0: 6c65 6e0a 0a20 2020 2020 2020 2020 2020  len..           
+0004df00: 2020 2020 2020 2020 2072 2e63 7667 5f66           r.cvg_f
+0004df10: 7261 6320 3d20 652e 6376 675f 6672 6163  rac = e.cvg_frac
+0004df20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004df30: 2020 2020 2072 2e61 7665 5f63 7667 203d       r.ave_cvg =
+0004df40: 2065 2e61 7665 5f63 7667 0a20 2020 2020   e.ave_cvg.     
+0004df50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004df60: 6e74 7269 6573 2e72 676e 732e 6170 7065  ntries.rgns.appe
+0004df70: 6e64 2820 7220 290a 2020 2020 2020 2020  nd( r ).        
+0004df80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dfa0: 2020 6220 3d20 5472 7565 0a20 2020 2020    b = True.     
+0004dfb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004dfc0: 6620 656e 7472 6965 732e 7267 6e73 5b2d  f entries.rgns[-
+0004dfd0: 315d 2e65 6e64 203d 3d20 2865 2e73 7461  1].end == (e.sta
+0004dfe0: 7274 2d31 293a 0a20 2020 2020 2020 2020  rt-1):.         
+0004dff0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004e000: 6620 652e 7479 7065 2e6c 6f77 6572 2829  f e.type.lower()
+0004e010: 203d 3d20 2765 786f 6e27 3a0a 2020 2020   == 'exon':.    
+0004e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e030: 2020 2020 2020 2020 6966 2065 6e74 7269          if entri
+0004e040: 6573 2e72 676e 735b 2d31 5d2e 7479 7065  es.rgns[-1].type
+0004e050: 203d 3d20 2765 786f 6e27 3a0a 2020 2020   == 'exon':.    
+0004e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e070: 2020 2020 2020 2020 2020 2020 656e 7472              entr
+0004e080: 6965 732e 7267 6e73 5b2d 315d 2e65 6e64  ies.rgns[-1].end
+0004e090: 203d 2065 2e65 6e64 0a20 2020 2020 2020   = e.end.       
+0004e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e0b0: 2020 2020 2020 2020 2065 6e74 7269 6573           entries
+0004e0c0: 2e72 676e 735b 2d31 5d2e 7365 7120 3d20  .rgns[-1].seq = 
+0004e0d0: 656e 7472 6965 732e 7267 6e73 5b2d 315d  entries.rgns[-1]
+0004e0e0: 2e73 6571 202b 2065 2e73 6571 0a20 2020  .seq + e.seq.   
 0004e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e100: 2020 2020 2020 2020 6966 2065 2e74 7970          if e.typ
-0004e110: 652e 6c6f 7765 7228 2920 3d3d 2027 6578  e.lower() == 'ex
-0004e120: 6f6e 273a 0a20 2020 2020 2020 2020 2020  on':.           
-0004e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e140: 2069 6620 656e 7472 6965 732e 7267 6e73   if entries.rgns
-0004e150: 5b2d 315d 2e74 7970 6520 3d3d 2027 6578  [-1].type == 'ex
-0004e160: 6f6e 273a 0a20 2020 2020 2020 2020 2020  on':.           
-0004e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e180: 2020 2020 2065 6e74 7269 6573 2e72 676e       entries.rgn
-0004e190: 735b 2d31 5d2e 656e 6420 3d20 652e 656e  s[-1].end = e.en
-0004e1a0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0004e100: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+0004e110: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0004e120: 2020 2020 2020 2020 2020 2069 6620 623a             if b:
+0004e130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e140: 2020 2020 2020 2020 2072 203d 2072 6567           r = reg
+0004e150: 696f 6e28 652e 6368 722c 2065 2e73 7461  ion(e.chr, e.sta
+0004e160: 7274 2c20 652e 656e 642c 2065 2e74 7970  rt, e.end, e.typ
+0004e170: 652c 2078 7320 3d20 3129 0a20 2020 2020  e, xs = 1).     
+0004e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e190: 2020 2069 6620 2865 2e74 7970 6520 213d     if (e.type !=
+0004e1a0: 2027 6465 6c65 7469 6f6e 2729 3a20 0a20   'deletion'): . 
 0004e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e1c0: 2020 656e 7472 6965 732e 7267 6e73 5b2d    entries.rgns[-
-0004e1d0: 315d 2e73 6571 203d 2065 6e74 7269 6573  1].seq = entries
-0004e1e0: 2e72 676e 735b 2d31 5d2e 7365 7120 2b20  .rgns[-1].seq + 
-0004e1f0: 652e 7365 710a 2020 2020 2020 2020 2020  e.seq.          
-0004e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e210: 2020 2020 2020 6220 3d20 4661 6c73 650a        b = False.
-0004e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e230: 2020 2020 6966 2062 3a0a 2020 2020 2020      if b:.      
+0004e1c0: 2020 2020 2020 2020 2020 2072 2e73 6571             r.seq
+0004e1d0: 203d 2065 2e73 6571 0a20 2020 2020 2020   = e.seq.       
+0004e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e1f0: 2020 2020 2072 2e63 6f76 5f6c 656e 203d       r.cov_len =
+0004e200: 2065 2e63 6f76 5f6c 656e 0a0a 2020 2020   e.cov_len..    
+0004e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e220: 2020 2020 722e 6376 675f 6672 6163 203d      r.cvg_frac =
+0004e230: 2065 2e63 7667 5f66 7261 630a 2020 2020   e.cvg_frac.    
 0004e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e250: 2020 7220 3d20 7265 6769 6f6e 2865 2e63    r = region(e.c
-0004e260: 6872 2c20 652e 7374 6172 742c 2065 2e65  hr, e.start, e.e
-0004e270: 6e64 2c20 652e 7479 7065 2c20 7873 203d  nd, e.type, xs =
-0004e280: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-0004e290: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0004e2a0: 652e 7479 7065 2021 3d20 2764 656c 6574  e.type != 'delet
-0004e2b0: 696f 6e27 293a 200a 2020 2020 2020 2020  ion'): .        
-0004e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e2d0: 2020 2020 722e 7365 7120 3d20 652e 7365      r.seq = e.se
-0004e2e0: 710a 2020 2020 2020 2020 2020 2020 2020  q.              
-0004e2f0: 2020 2020 2020 2020 2020 2020 2020 722e                r.
-0004e300: 636f 765f 6c65 6e20 3d20 652e 636f 765f  cov_len = e.cov_
-0004e310: 6c65 6e0a 0a20 2020 2020 2020 2020 2020  len..           
-0004e320: 2020 2020 2020 2020 2020 2020 2072 2e63               r.c
-0004e330: 7667 5f66 7261 6320 3d20 652e 6376 675f  vg_frac = e.cvg_
-0004e340: 6672 6163 0a20 2020 2020 2020 2020 2020  frac.           
-0004e350: 2020 2020 2020 2020 2020 2020 2072 2e61               r.a
-0004e360: 7665 5f63 7667 203d 2065 2e61 7665 5f63  ve_cvg = e.ave_c
-0004e370: 7667 0a20 2020 2020 2020 2020 2020 2020  vg.             
-0004e380: 2020 2020 2020 2020 2020 2065 6e74 7269             entri
-0004e390: 6573 2e72 676e 732e 6170 7065 6e64 2820  es.rgns.append( 
-0004e3a0: 7220 290a 2020 2020 2020 2020 2020 2020  r ).            
-0004e3b0: 2020 2020 2320 636e 7420 2b3d 2031 0a20      # cnt += 1. 
-0004e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e3d0: 2020 200a 2020 2020 2020 2020 6966 2028     .        if (
-0004e3e0: 6c65 6e28 6364 735f 7267 6e73 2920 3e20  len(cds_rgns) > 
-0004e3f0: 3029 2026 2028 6c65 6e28 7365 6c66 2e61  0) & (len(self.a
-0004e400: 7365 7129 203e 2030 293a 0a20 2020 2020  seq) > 0):.     
-0004e410: 2020 2020 2020 2074 676d 203d 2073 656c         tgm = sel
-0004e420: 662e 7463 5f74 6f5f 6763 5f6d 6170 0a20  f.tc_to_gc_map. 
-0004e430: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-0004e440: 2069 6e20 7467 6d3a 0a20 2020 2020 2020   in tgm:.       
-0004e450: 2020 2020 2020 2020 2065 203d 2063 6473           e = cds
-0004e460: 5f72 676e 735b 6d5d 0a20 2020 2020 2020  _rgns[m].       
-0004e470: 2020 2020 2020 2020 2072 203d 2072 6567           r = reg
-0004e480: 696f 6e28 652e 6368 722c 2065 2e73 7461  ion(e.chr, e.sta
-0004e490: 7274 2c20 652e 656e 642c 2065 2e74 7970  rt, e.end, e.typ
-0004e4a0: 652c 2078 7320 3d20 2d31 290a 2020 2020  e, xs = -1).    
-0004e4b0: 2020 2020 2020 2020 2020 2020 656e 7472              entr
-0004e4c0: 6965 732e 7267 6e73 2e61 7070 656e 6428  ies.rgns.append(
-0004e4d0: 2072 2029 0a0a 2020 2020 2020 2020 656e   r )..        en
-0004e4e0: 7472 6965 732e 6f72 6465 7228 290a 2020  tries.order().  
-0004e4f0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0004e500: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0004e510: 2020 2020 2020 2020 6174 7472 5f68 6472          attr_hdr
-0004e520: 203d 2027 6765 6e65 5f69 6420 2225 7322   = 'gene_id "%s"
-0004e530: 3b20 6765 6e65 5f6e 616d 6520 2225 7322  ; gene_name "%s"
-0004e540: 3b20 7472 616e 7363 7269 7074 5f69 6420  ; transcript_id 
-0004e550: 2225 7322 3b20 7472 616e 7363 7269 7074  "%s"; transcript
-0004e560: 5f6e 616d 6520 2225 7322 3b27 2025 5c0a  _name "%s";' %\.
-0004e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e580: 2020 2020 2873 656c 662e 6769 642c 2073      (self.gid, s
-0004e590: 656c 662e 676e 616d 652c 2073 656c 662e  elf.gname, self.
-0004e5a0: 7469 642c 2073 656c 662e 746e 616d 6529  tid, self.tname)
-0004e5b0: 0a20 2020 2020 2020 2061 7474 725f 7461  .        attr_ta
-0004e5c0: 696c 203d 2027 2063 7667 2022 2533 2e31  il = ' cvg "%3.1
-0004e5d0: 6622 3b20 6162 6e20 2225 332e 3166 223b  f"; abn "%3.1f";
-0004e5e0: 2720 2520 2873 656c 662e 636f 762c 2073  ' % (self.cov, s
-0004e5f0: 656c 662e 6162 6e20 290a 2020 2020 2020  elf.abn ).      
-0004e600: 2020 6174 7472 203d 2061 7474 725f 6864    attr = attr_hd
-0004e610: 7220 2b20 6174 7472 5f74 6169 6c0a 0a20  r + attr_tail.. 
-0004e620: 2020 2020 2020 2063 203d 2067 6574 5f63         c = get_c
-0004e630: 5f66 726f 6d5f 6973 7472 616e 6428 7365  _from_istrand(se
-0004e640: 6c66 2e69 7374 7261 6e64 290a 2020 2020  lf.istrand).    
-0004e650: 2020 2020 6774 665f 6c69 6e65 203d 2047      gtf_line = G
-0004e660: 5446 5f6c 696e 6528 7365 6c66 2e63 6872  TF_line(self.chr
-0004e670: 2c20 4754 465f 534f 5552 4345 2c20 2774  , GTF_SOURCE, 't
-0004e680: 7261 6e73 6372 6970 7427 2c20 7365 6c66  ranscript', self
-0004e690: 2e62 6567 696e 2c20 7365 6c66 2e65 6e64  .begin, self.end
-0004e6a0: 2c20 2730 272c 2063 2c20 2730 272c 2061  , '0', c, '0', a
-0004e6b0: 7474 722c 205c 0a20 2020 2020 2020 2020  ttr, \.         
-0004e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e6d0: 2020 2073 656c 662e 6769 642c 2073 656c     self.gid, sel
-0004e6e0: 662e 676e 616d 652c 2073 656c 662e 7469  f.gname, self.ti
-0004e6f0: 642c 2073 656c 662e 746e 616d 652c 2073  d, self.tname, s
-0004e700: 656c 662e 6269 6f74 7970 6520 290a 2020  elf.biotype ).  
-0004e710: 2020 2020 2020 6774 665f 6c69 6e65 732e        gtf_lines.
-0004e720: 6170 7065 6e64 2867 7466 5f6c 696e 6529  append(gtf_line)
-0004e730: 0a0a 2020 2020 2020 2020 6578 6f6e 5f63  ..        exon_c
-0004e740: 6e74 203d 2030 0a20 2020 2020 2020 2066  nt = 0.        f
-0004e750: 6f72 206b 2c20 6520 696e 2065 6e75 6d65  or k, e in enume
-0004e760: 7261 7465 2865 6e74 7269 6573 2e72 676e  rate(entries.rgn
-0004e770: 7329 3a0a 0a20 2020 2020 2020 2020 2020  s):..           
-0004e780: 2023 2320 7365 7420 6174 7472 0a20 2020   ## set attr.   
-0004e790: 2020 2020 2020 2020 2069 6620 2865 2e74           if (e.t
-0004e7a0: 7970 6520 3d3d 2027 6465 6c65 7469 6f6e  ype == 'deletion
-0004e7b0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0004e7c0: 2020 2020 6174 7472 5f74 6169 6c20 3d20      attr_tail = 
-0004e7d0: 2720 6376 6720 2225 6622 3b20 6162 6e20  ' cvg "%f"; abn 
-0004e7e0: 2225 332e 3166 223b 2063 6672 6163 2022  "%3.1f"; cfrac "
-0004e7f0: 2535 2e33 6622 3b27 2025 2028 312c 2065  %5.3f";' % (1, e
-0004e800: 2e61 7665 5f63 7667 2c20 652e 6376 675f  .ave_cvg, e.cvg_
-0004e810: 6672 6163 290a 2020 2020 2020 2020 2020  frac).          
-0004e820: 2020 656c 6966 2028 652e 7479 7065 203d    elif (e.type =
-0004e830: 3d20 2769 6e73 6572 7369 6f6e 2729 3a0a  = 'insersion'):.
-0004e840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e850: 2069 6620 6c65 6e28 652e 7365 7129 203e   if len(e.seq) >
-0004e860: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0004e870: 2020 2020 2020 2020 636f 7620 3d20 652e          cov = e.
-0004e880: 636f 765f 6c65 6e2f 6c65 6e28 652e 7365  cov_len/len(e.se
-0004e890: 7129 2023 2067 6574 5f63 6f76 2829 0a20  q) # get_cov(). 
-0004e8a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004e8b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0004e8c0: 2020 2020 2020 2020 2063 6f76 203d 2030           cov = 0
-0004e8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e8e0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0004e8f0: 2020 2020 2020 6966 2061 6464 5f73 6571        if add_seq
-0004e900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004e910: 2020 2020 2020 6966 2063 6f76 203d 3d20        if cov == 
-0004e920: 303a 2073 6571 203d 2027 270a 2020 2020  0: seq = ''.    
-0004e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e940: 656c 7365 3a20 7365 7120 3d20 652e 7365  else: seq = e.se
-0004e950: 7120 2320 6765 745f 7365 7128 290a 2020  q # get_seq().  
-0004e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e970: 2020 6174 7472 5f74 6169 6c20 3d20 2720    attr_tail = ' 
-0004e980: 6578 6f6e 5f6e 756d 6265 7220 2225 6922  exon_number "%i"
-0004e990: 3b20 6376 6720 2225 6622 3b20 6162 6e20  ; cvg "%f"; abn 
-0004e9a0: 2225 332e 3166 223b 2063 6672 6163 2022  "%3.1f"; cfrac "
-0004e9b0: 2535 2e33 6622 3b20 7365 7120 2225 7322  %5.3f"; seq "%s"
-0004e9c0: 3b27 2025 205c 0a20 2020 2020 2020 2020  ;' % \.         
-0004e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e9e0: 2020 2020 2020 2028 6578 6f6e 5f63 6e74         (exon_cnt
-0004e9f0: 2c20 636f 762c 2065 2e61 7665 5f63 7667  , cov, e.ave_cvg
-0004ea00: 2c20 652e 6376 675f 6672 6163 2c20 7365  , e.cvg_frac, se
-0004ea10: 7120 290a 2020 2020 2020 2020 2020 2020  q ).            
-0004ea20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0004ea30: 2020 2020 2020 2020 2020 2020 2020 6174                at
-0004ea40: 7472 5f74 6169 6c20 3d20 2720 6578 6f6e  tr_tail = ' exon
-0004ea50: 5f6e 756d 6265 7220 2225 6922 3b20 6376  _number "%i"; cv
-0004ea60: 6720 2225 6622 3b20 6162 6e20 2225 332e  g "%f"; abn "%3.
-0004ea70: 3166 223b 2063 6672 6163 2022 2535 2e33  1f"; cfrac "%5.3
-0004ea80: 6622 3b27 2025 205c 0a20 2020 2020 2020  f";' % \.       
-0004ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eaa0: 2020 2020 2020 2020 2028 6578 6f6e 5f63           (exon_c
-0004eab0: 6e74 2c20 636f 762c 2065 2e61 7665 5f63  nt, cov, e.ave_c
-0004eac0: 7667 2c20 652e 6376 675f 6672 6163 2029  vg, e.cvg_frac )
-0004ead0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004eae0: 2065 786f 6e5f 636e 7420 2b3d 2031 0a20   exon_cnt += 1. 
-0004eaf0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0004eb00: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0004eb10: 2028 652e 7479 7065 203d 3d20 2765 786f   (e.type == 'exo
-0004eb20: 6e27 293a 0a0a 2020 2020 2020 2020 2020  n'):..          
-0004eb30: 2020 2020 2020 6966 206c 656e 2865 2e73        if len(e.s
-0004eb40: 6571 2920 3e20 303a 0a20 2020 2020 2020  eq) > 0:.       
-0004eb50: 2020 2020 2020 2020 2020 2020 2063 6f76               cov
-0004eb60: 203d 2065 2e63 6f76 5f6c 656e 2f6c 656e   = e.cov_len/len
-0004eb70: 2865 2e73 6571 2920 2320 6765 745f 636f  (e.seq) # get_co
-0004eb80: 7628 290a 2020 2020 2020 2020 2020 2020  v().            
-0004eb90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0004eba0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0004ebb0: 7620 3d20 300a 2020 2020 2020 2020 2020  v = 0.          
-0004ebc0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0004ebd0: 2020 2020 2020 2020 2020 2069 6620 6164             if ad
-0004ebe0: 645f 7365 713a 0a20 2020 2020 2020 2020  d_seq:.         
-0004ebf0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0004ec00: 7620 3d3d 2030 3a20 7365 7120 3d20 2727  v == 0: seq = ''
-0004ec10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ec20: 2020 2020 2065 6c73 653a 2073 6571 203d       else: seq =
-0004ec30: 2065 2e73 6571 2023 2067 6574 5f73 6571   e.seq # get_seq
-0004ec40: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0004ec50: 2020 2020 2020 2061 7474 725f 7461 696c         attr_tail
-0004ec60: 203d 2027 2065 786f 6e5f 6e75 6d62 6572   = ' exon_number
-0004ec70: 2022 2569 223b 2063 7667 2022 2566 223b   "%i"; cvg "%f";
-0004ec80: 2061 626e 2022 2533 2e31 6622 3b20 7365   abn "%3.1f"; se
-0004ec90: 7120 2225 7322 3b27 2025 205c 0a20 2020  q "%s";' % \.   
-0004eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ecb0: 2020 2020 2020 2020 2020 2020 2028 6578               (ex
-0004ecc0: 6f6e 5f63 6e74 2c20 636f 762c 2065 2e61  on_cnt, cov, e.a
-0004ecd0: 7665 5f63 7667 2c20 7365 7120 290a 2020  ve_cvg, seq ).  
-0004ece0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0004ecf0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0004ed00: 2020 2020 2020 2020 6174 7472 5f74 6169          attr_tai
-0004ed10: 6c20 3d20 2720 6578 6f6e 5f6e 756d 6265  l = ' exon_numbe
-0004ed20: 7220 2225 6922 3b20 6376 6720 2225 6622  r "%i"; cvg "%f"
-0004ed30: 3b20 6162 6e20 2225 332e 3166 223b 2720  ; abn "%3.1f";' 
-0004ed40: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
-0004ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed60: 2020 2020 2865 786f 6e5f 636e 742c 2063      (exon_cnt, c
-0004ed70: 6f76 2c20 652e 6176 655f 6376 6720 290a  ov, e.ave_cvg ).
+0004e250: 2020 2020 722e 6176 655f 6376 6720 3d20      r.ave_cvg = 
+0004e260: 652e 6176 655f 6376 670a 2020 2020 2020  e.ave_cvg.      
+0004e270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e280: 2020 656e 7472 6965 732e 7267 6e73 2e61    entries.rgns.a
+0004e290: 7070 656e 6428 2072 2029 0a20 2020 2020  ppend( r ).     
+0004e2a0: 2020 2020 2020 2020 2020 2023 2063 6e74             # cnt
+0004e2b0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0004e2c0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0004e2d0: 2020 2069 6620 286c 656e 2863 6473 5f72     if (len(cds_r
+0004e2e0: 676e 7329 203e 2030 2920 2620 286c 656e  gns) > 0) & (len
+0004e2f0: 2873 656c 662e 6173 6571 2920 3e20 3029  (self.aseq) > 0)
+0004e300: 3a0a 2020 2020 2020 2020 2020 2020 7467  :.            tg
+0004e310: 6d20 3d20 7365 6c66 2e74 635f 746f 5f67  m = self.tc_to_g
+0004e320: 635f 6d61 700a 2020 2020 2020 2020 2020  c_map.          
+0004e330: 2020 666f 7220 6d20 696e 2074 676d 3a0a    for m in tgm:.
+0004e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e350: 6520 3d20 6364 735f 7267 6e73 5b6d 5d0a  e = cds_rgns[m].
+0004e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e370: 7220 3d20 7265 6769 6f6e 2865 2e63 6872  r = region(e.chr
+0004e380: 2c20 652e 7374 6172 742c 2065 2e65 6e64  , e.start, e.end
+0004e390: 2c20 652e 7479 7065 2c20 7873 203d 202d  , e.type, xs = -
+0004e3a0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+0004e3b0: 2020 2065 6e74 7269 6573 2e72 676e 732e     entries.rgns.
+0004e3c0: 6170 7065 6e64 2820 7220 290a 0a20 2020  append( r )..   
+0004e3d0: 2020 2020 2065 6e74 7269 6573 2e6f 7264       entries.ord
+0004e3e0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+0004e3f0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0004e400: 2020 2020 2020 0a20 2020 2020 2020 2061        .        a
+0004e410: 7474 725f 6864 7220 3d20 2767 656e 655f  ttr_hdr = 'gene_
+0004e420: 6964 2022 2573 223b 2067 656e 655f 6e61  id "%s"; gene_na
+0004e430: 6d65 2022 2573 223b 2074 7261 6e73 6372  me "%s"; transcr
+0004e440: 6970 745f 6964 2022 2573 223b 2074 7261  ipt_id "%s"; tra
+0004e450: 6e73 6372 6970 745f 6e61 6d65 2022 2573  nscript_name "%s
+0004e460: 223b 2720 255c 0a20 2020 2020 2020 2020  ";' %\.         
+0004e470: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
+0004e480: 2e67 6964 2c20 7365 6c66 2e67 6e61 6d65  .gid, self.gname
+0004e490: 2c20 7365 6c66 2e74 6964 2c20 7365 6c66  , self.tid, self
+0004e4a0: 2e74 6e61 6d65 290a 2020 2020 2020 2020  .tname).        
+0004e4b0: 6174 7472 5f74 6169 6c20 3d20 2720 6376  attr_tail = ' cv
+0004e4c0: 6720 2225 332e 3166 223b 2061 626e 2022  g "%3.1f"; abn "
+0004e4d0: 2533 2e31 6622 3b27 2025 2028 7365 6c66  %3.1f";' % (self
+0004e4e0: 2e63 6f76 2c20 7365 6c66 2e61 626e 2029  .cov, self.abn )
+0004e4f0: 0a20 2020 2020 2020 2061 7474 7220 3d20  .        attr = 
+0004e500: 6174 7472 5f68 6472 202b 2061 7474 725f  attr_hdr + attr_
+0004e510: 7461 696c 0a0a 2020 2020 2020 2020 6320  tail..        c 
+0004e520: 3d20 6765 745f 635f 6672 6f6d 5f69 7374  = get_c_from_ist
+0004e530: 7261 6e64 2873 656c 662e 6973 7472 616e  rand(self.istran
+0004e540: 6429 0a20 2020 2020 2020 2067 7466 5f6c  d).        gtf_l
+0004e550: 696e 6520 3d20 4754 465f 6c69 6e65 2873  ine = GTF_line(s
+0004e560: 656c 662e 6368 722c 2047 5446 5f53 4f55  elf.chr, GTF_SOU
+0004e570: 5243 452c 2027 7472 616e 7363 7269 7074  RCE, 'transcript
+0004e580: 272c 2073 656c 662e 6265 6769 6e2c 2073  ', self.begin, s
+0004e590: 656c 662e 656e 642c 2027 3027 2c20 632c  elf.end, '0', c,
+0004e5a0: 2027 3027 2c20 6174 7472 2c20 5c0a 2020   '0', attr, \.  
+0004e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e5c0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+0004e5d0: 6964 2c20 7365 6c66 2e67 6e61 6d65 2c20  id, self.gname, 
+0004e5e0: 7365 6c66 2e74 6964 2c20 7365 6c66 2e74  self.tid, self.t
+0004e5f0: 6e61 6d65 2c20 7365 6c66 2e62 696f 7479  name, self.bioty
+0004e600: 7065 2029 0a20 2020 2020 2020 2067 7466  pe ).        gtf
+0004e610: 5f6c 696e 6573 2e61 7070 656e 6428 6774  _lines.append(gt
+0004e620: 665f 6c69 6e65 290a 0a20 2020 2020 2020  f_line)..       
+0004e630: 2065 786f 6e5f 636e 7420 3d20 300a 2020   exon_cnt = 0.  
+0004e640: 2020 2020 2020 666f 7220 6b2c 2065 2069        for k, e i
+0004e650: 6e20 656e 756d 6572 6174 6528 656e 7472  n enumerate(entr
+0004e660: 6965 732e 7267 6e73 293a 0a0a 2020 2020  ies.rgns):..    
+0004e670: 2020 2020 2020 2020 2323 2073 6574 2061          ## set a
+0004e680: 7474 720a 2020 2020 2020 2020 2020 2020  ttr.            
+0004e690: 6966 2028 652e 7479 7065 203d 3d20 2764  if (e.type == 'd
+0004e6a0: 656c 6574 696f 6e27 293a 0a20 2020 2020  eletion'):.     
+0004e6b0: 2020 2020 2020 2020 2020 2061 7474 725f             attr_
+0004e6c0: 7461 696c 203d 2027 2063 7667 2022 2566  tail = ' cvg "%f
+0004e6d0: 223b 2061 626e 2022 2533 2e31 6622 3b20  "; abn "%3.1f"; 
+0004e6e0: 6366 7261 6320 2225 352e 3366 223b 2720  cfrac "%5.3f";' 
+0004e6f0: 2520 2831 2c20 652e 6176 655f 6376 672c  % (1, e.ave_cvg,
+0004e700: 2065 2e63 7667 5f66 7261 6329 0a20 2020   e.cvg_frac).   
+0004e710: 2020 2020 2020 2020 2065 6c69 6620 2865           elif (e
+0004e720: 2e74 7970 6520 3d3d 2027 696e 7365 7273  .type == 'insers
+0004e730: 696f 6e27 293a 0a0a 2020 2020 2020 2020  ion'):..        
+0004e740: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
+0004e750: 2e73 6571 2920 3e20 303a 0a20 2020 2020  .seq) > 0:.     
+0004e760: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004e770: 6f76 203d 2065 2e63 6f76 5f6c 656e 2f6c  ov = e.cov_len/l
+0004e780: 656e 2865 2e73 6571 2920 2320 6765 745f  en(e.seq) # get_
+0004e790: 636f 7628 290a 2020 2020 2020 2020 2020  cov().          
+0004e7a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0004e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e7c0: 636f 7620 3d20 300a 2020 2020 2020 2020  cov = 0.        
+0004e7d0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0004e7e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004e7f0: 6164 645f 7365 713a 0a20 2020 2020 2020  add_seq:.       
+0004e800: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004e810: 636f 7620 3d3d 2030 3a20 7365 7120 3d20  cov == 0: seq = 
+0004e820: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+0004e830: 2020 2020 2020 2065 6c73 653a 2073 6571         else: seq
+0004e840: 203d 2065 2e73 6571 2023 2067 6574 5f73   = e.seq # get_s
+0004e850: 6571 2829 0a20 2020 2020 2020 2020 2020  eq().           
+0004e860: 2020 2020 2020 2020 2061 7474 725f 7461           attr_ta
+0004e870: 696c 203d 2027 2065 786f 6e5f 6e75 6d62  il = ' exon_numb
+0004e880: 6572 2022 2569 223b 2063 7667 2022 2566  er "%i"; cvg "%f
+0004e890: 223b 2061 626e 2022 2533 2e31 6622 3b20  "; abn "%3.1f"; 
+0004e8a0: 6366 7261 6320 2225 352e 3366 223b 2073  cfrac "%5.3f"; s
+0004e8b0: 6571 2022 2573 223b 2720 2520 5c0a 2020  eq "%s";' % \.  
+0004e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e8d0: 2020 2020 2020 2020 2020 2020 2020 2865                (e
+0004e8e0: 786f 6e5f 636e 742c 2063 6f76 2c20 652e  xon_cnt, cov, e.
+0004e8f0: 6176 655f 6376 672c 2065 2e63 7667 5f66  ave_cvg, e.cvg_f
+0004e900: 7261 632c 2073 6571 2029 0a20 2020 2020  rac, seq ).     
+0004e910: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0004e920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e930: 2020 2020 2061 7474 725f 7461 696c 203d       attr_tail =
+0004e940: 2027 2065 786f 6e5f 6e75 6d62 6572 2022   ' exon_number "
+0004e950: 2569 223b 2063 7667 2022 2566 223b 2061  %i"; cvg "%f"; a
+0004e960: 626e 2022 2533 2e31 6622 3b20 6366 7261  bn "%3.1f"; cfra
+0004e970: 6320 2225 352e 3366 223b 2720 2520 5c0a  c "%5.3f";' % \.
+0004e980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e9a0: 2865 786f 6e5f 636e 742c 2063 6f76 2c20  (exon_cnt, cov, 
+0004e9b0: 652e 6176 655f 6376 672c 2065 2e63 7667  e.ave_cvg, e.cvg
+0004e9c0: 5f66 7261 6320 290a 2020 2020 2020 2020  _frac ).        
+0004e9d0: 2020 2020 2020 2020 6578 6f6e 5f63 6e74          exon_cnt
+0004e9e0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0004e9f0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0004ea00: 2020 2065 6c69 6620 2865 2e74 7970 6520     elif (e.type 
+0004ea10: 3d3d 2027 6578 6f6e 2729 3a0a 0a20 2020  == 'exon'):..   
+0004ea20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004ea30: 6c65 6e28 652e 7365 7129 203e 2030 3a0a  len(e.seq) > 0:.
+0004ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ea50: 2020 2020 636f 7620 3d20 652e 636f 765f      cov = e.cov_
+0004ea60: 6c65 6e2f 6c65 6e28 652e 7365 7129 2023  len/len(e.seq) #
+0004ea70: 2067 6574 5f63 6f76 2829 0a20 2020 2020   get_cov().     
+0004ea80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0004ea90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004eaa0: 2020 2020 2063 6f76 203d 2030 0a20 2020       cov = 0.   
+0004eab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eac0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0004ead0: 2020 6966 2061 6464 5f73 6571 3a0a 2020    if add_seq:.  
+0004eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eaf0: 2020 6966 2063 6f76 203d 3d20 303a 2073    if cov == 0: s
+0004eb00: 6571 203d 2027 270a 2020 2020 2020 2020  eq = ''.        
+0004eb10: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0004eb20: 3a20 7365 7120 3d20 652e 7365 7120 2320  : seq = e.seq # 
+0004eb30: 6765 745f 7365 7128 290a 2020 2020 2020  get_seq().      
+0004eb40: 2020 2020 2020 2020 2020 2020 2020 6174                at
+0004eb50: 7472 5f74 6169 6c20 3d20 2720 6578 6f6e  tr_tail = ' exon
+0004eb60: 5f6e 756d 6265 7220 2225 6922 3b20 6376  _number "%i"; cv
+0004eb70: 6720 2225 6622 3b20 6162 6e20 2225 332e  g "%f"; abn "%3.
+0004eb80: 3166 223b 2073 6571 2022 2573 223b 2720  1f"; seq "%s";' 
+0004eb90: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
+0004eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ebb0: 2020 2020 2865 786f 6e5f 636e 742c 2063      (exon_cnt, c
+0004ebc0: 6f76 2c20 652e 6176 655f 6376 672c 2073  ov, e.ave_cvg, s
+0004ebd0: 6571 2029 0a20 2020 2020 2020 2020 2020  eq ).           
+0004ebe0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0004ebf0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0004ec00: 7474 725f 7461 696c 203d 2027 2065 786f  ttr_tail = ' exo
+0004ec10: 6e5f 6e75 6d62 6572 2022 2569 223b 2063  n_number "%i"; c
+0004ec20: 7667 2022 2566 223b 2061 626e 2022 2533  vg "%f"; abn "%3
+0004ec30: 2e31 6622 3b27 2025 205c 0a20 2020 2020  .1f";' % \.     
+0004ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ec50: 2020 2020 2020 2020 2020 2028 6578 6f6e             (exon
+0004ec60: 5f63 6e74 2c20 636f 762c 2065 2e61 7665  _cnt, cov, e.ave
+0004ec70: 5f63 7667 2029 0a20 2020 2020 2020 2020  _cvg ).         
+0004ec80: 2020 2020 2020 2065 786f 6e5f 636e 7420         exon_cnt 
+0004ec90: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0004eca0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0004ecb0: 2020 656c 7365 3a20 2320 6672 6f6d 2063    else: # from c
+0004ecc0: 6473 0a20 2020 2020 2020 2020 2020 2020  ds.             
+0004ecd0: 2020 2061 7474 725f 7461 696c 203d 2027     attr_tail = '
+0004ece0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0004ecf0: 2020 6966 2028 652e 7479 7065 2e6c 6f77    if (e.type.low
+0004ed00: 6572 2829 203d 3d20 2773 7461 7274 5f63  er() == 'start_c
+0004ed10: 6f64 6f6e 2729 3a0a 2020 2020 2020 2020  odon'):.        
+0004ed20: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+0004ed30: 5f74 6169 6c20 3d20 2720 6576 656e 7420  _tail = ' event 
+0004ed40: 2225 693a 2573 223b 2073 7461 7475 7320  "%i:%s"; status 
+0004ed50: 2225 693a 2573 223b 2720 2520 2873 656c  "%i:%s";' % (sel
+0004ed60: 662e 7374 6172 745f 636f 646f 6e5f 6576  f.start_codon_ev
+0004ed70: 656e 742c 205c 0a20 2020 2020 2020 2020  ent, \.         
 0004ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed90: 6578 6f6e 5f63 6e74 202b 3d20 310a 2020  exon_cnt += 1.  
-0004eda0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0004edb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0004edc0: 2023 2066 726f 6d20 6364 730a 2020 2020   # from cds.    
-0004edd0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
-0004ede0: 5f74 6169 6c20 3d20 2727 0a20 2020 2020  _tail = ''.     
-0004edf0: 2020 2020 2020 2020 2020 2069 6620 2865             if (e
-0004ee00: 2e74 7970 652e 6c6f 7765 7228 2920 3d3d  .type.lower() ==
-0004ee10: 2027 7374 6172 745f 636f 646f 6e27 293a   'start_codon'):
-0004ee20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ee30: 2020 2020 2061 7474 725f 7461 696c 203d       attr_tail =
-0004ee40: 2027 2065 7665 6e74 2022 2569 3a25 7322   ' event "%i:%s"
-0004ee50: 3b20 7374 6174 7573 2022 2569 3a25 7322  ; status "%i:%s"
-0004ee60: 3b27 2025 2028 7365 6c66 2e73 7461 7274  ;' % (self.start
-0004ee70: 5f63 6f64 6f6e 5f65 7665 6e74 2c20 5c0a  _codon_event, \.
-0004ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eea0: 436f 646f 6e5f 5374 6174 7573 5b73 656c  Codon_Status[sel
-0004eeb0: 662e 7374 6172 745f 636f 646f 6e5f 6576  f.start_codon_ev
-0004eec0: 656e 745d 2c20 7365 6c66 2e73 7461 7274  ent], self.start
-0004eed0: 5f63 6f64 6f6e 5f73 7461 7475 732c 2043  _codon_status, C
-0004eee0: 6f64 6f6e 5f53 7461 7475 735b 7365 6c66  odon_Status[self
-0004eef0: 2e73 7461 7274 5f63 6f64 6f6e 5f73 7461  .start_codon_sta
-0004ef00: 7475 735d 290a 2020 2020 2020 2020 2020  tus]).          
-0004ef10: 2020 2020 2020 656c 6966 2028 652e 7479        elif (e.ty
-0004ef20: 7065 2e6c 6f77 6572 2829 203d 3d20 2773  pe.lower() == 's
-0004ef30: 746f 705f 636f 646f 6e27 293a 0a20 2020  top_codon'):.   
-0004ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ef50: 2061 7474 725f 7461 696c 203d 2027 2065   attr_tail = ' e
-0004ef60: 7665 6e74 2022 2569 3a25 7322 3b20 7374  vent "%i:%s"; st
-0004ef70: 6174 7573 2022 2569 3a25 7322 3b27 2025  atus "%i:%s";' %
-0004ef80: 2028 7365 6c66 2e73 746f 705f 636f 646f   (self.stop_codo
-0004ef90: 6e5f 6576 656e 742c 205c 0a20 2020 2020  n_event, \.     
-0004efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004efb0: 2020 2020 2020 2020 2020 2043 6f64 6f6e             Codon
-0004efc0: 5f53 7461 7475 735b 7365 6c66 2e73 746f  _Status[self.sto
-0004efd0: 705f 636f 646f 6e5f 6576 656e 745d 2c20  p_codon_event], 
-0004efe0: 7365 6c66 2e73 746f 705f 636f 646f 6e5f  self.stop_codon_
-0004eff0: 7374 6174 7573 2c20 436f 646f 6e5f 5374  status, Codon_St
-0004f000: 6174 7573 5b73 656c 662e 7374 6f70 5f63  atus[self.stop_c
-0004f010: 6f64 6f6e 5f73 7461 7475 735d 290a 0a20  odon_status]).. 
-0004f020: 2020 2020 2020 2020 2020 2061 7474 7220             attr 
-0004f030: 3d20 6174 7472 5f68 6472 202b 2061 7474  = attr_hdr + att
-0004f040: 725f 7461 696c 0a0a 2020 2020 2020 2020  r_tail..        
-0004f050: 2020 2020 2323 2053 6574 2047 5446 206c      ## Set GTF l
-0004f060: 696e 650a 2020 2020 2020 2020 2020 2020  ine.            
-0004f070: 6966 2065 2e73 7461 7274 203e 2030 3a0a  if e.start > 0:.
-0004f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f090: 676c 203d 2047 5446 5f6c 696e 6528 2065  gl = GTF_line( e
-0004f0a0: 2e63 6872 2c20 4754 465f 534f 5552 4345  .chr, GTF_SOURCE
-0004f0b0: 2c20 652e 7479 7065 2c20 652e 7374 6172  , e.type, e.star
-0004f0c0: 742c 2065 2e65 6e64 2c20 2731 3030 3027  t, e.end, '1000'
-0004f0d0: 2c20 632c 2027 2e27 2c20 6174 7472 2c20  , c, '.', attr, 
-0004f0e0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0004ed90: 2020 2020 2020 2043 6f64 6f6e 5f53 7461         Codon_Sta
+0004eda0: 7475 735b 7365 6c66 2e73 7461 7274 5f63  tus[self.start_c
+0004edb0: 6f64 6f6e 5f65 7665 6e74 5d2c 2073 656c  odon_event], sel
+0004edc0: 662e 7374 6172 745f 636f 646f 6e5f 7374  f.start_codon_st
+0004edd0: 6174 7573 2c20 436f 646f 6e5f 5374 6174  atus, Codon_Stat
+0004ede0: 7573 5b73 656c 662e 7374 6172 745f 636f  us[self.start_co
+0004edf0: 646f 6e5f 7374 6174 7573 5d29 0a20 2020  don_status]).   
+0004ee00: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0004ee10: 6620 2865 2e74 7970 652e 6c6f 7765 7228  f (e.type.lower(
+0004ee20: 2920 3d3d 2027 7374 6f70 5f63 6f64 6f6e  ) == 'stop_codon
+0004ee30: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+0004ee40: 2020 2020 2020 2020 6174 7472 5f74 6169          attr_tai
+0004ee50: 6c20 3d20 2720 6576 656e 7420 2225 693a  l = ' event "%i:
+0004ee60: 2573 223b 2073 7461 7475 7320 2225 693a  %s"; status "%i:
+0004ee70: 2573 223b 2720 2520 2873 656c 662e 7374  %s";' % (self.st
+0004ee80: 6f70 5f63 6f64 6f6e 5f65 7665 6e74 2c20  op_codon_event, 
+0004ee90: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0004eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eeb0: 2020 436f 646f 6e5f 5374 6174 7573 5b73    Codon_Status[s
+0004eec0: 656c 662e 7374 6f70 5f63 6f64 6f6e 5f65  elf.stop_codon_e
+0004eed0: 7665 6e74 5d2c 2073 656c 662e 7374 6f70  vent], self.stop
+0004eee0: 5f63 6f64 6f6e 5f73 7461 7475 732c 2043  _codon_status, C
+0004eef0: 6f64 6f6e 5f53 7461 7475 735b 7365 6c66  odon_Status[self
+0004ef00: 2e73 746f 705f 636f 646f 6e5f 7374 6174  .stop_codon_stat
+0004ef10: 7573 5d29 0a0a 2020 2020 2020 2020 2020  us])..          
+0004ef20: 2020 6174 7472 203d 2061 7474 725f 6864    attr = attr_hd
+0004ef30: 7220 2b20 6174 7472 5f74 6169 6c0a 0a20  r + attr_tail.. 
+0004ef40: 2020 2020 2020 2020 2020 2023 2320 5365             ## Se
+0004ef50: 7420 4754 4620 6c69 6e65 0a20 2020 2020  t GTF line.     
+0004ef60: 2020 2020 2020 2069 6620 652e 7374 6172         if e.star
+0004ef70: 7420 3e20 303a 0a20 2020 2020 2020 2020  t > 0:.         
+0004ef80: 2020 2020 2020 2067 6c20 3d20 4754 465f         gl = GTF_
+0004ef90: 6c69 6e65 2820 652e 6368 722c 2047 5446  line( e.chr, GTF
+0004efa0: 5f53 4f55 5243 452c 2065 2e74 7970 652c  _SOURCE, e.type,
+0004efb0: 2065 2e73 7461 7274 2c20 652e 656e 642c   e.start, e.end,
+0004efc0: 2027 3130 3030 272c 2063 2c20 272e 272c   '1000', c, '.',
+0004efd0: 2061 7474 722c 205c 0a20 2020 2020 2020   attr, \.       
+0004efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eff0: 2020 2020 2020 2020 7365 6c66 2e67 6964          self.gid
+0004f000: 2c20 7365 6c66 2e74 6964 2c20 7365 6c66  , self.tid, self
+0004f010: 2e67 6e61 6d65 2c20 7365 6c66 2e74 6e61  .gname, self.tna
+0004f020: 6d65 2c20 7365 6c66 2e62 696f 7479 7065  me, self.biotype
+0004f030: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0004f040: 2020 2067 7466 5f6c 696e 6573 2e61 7070     gtf_lines.app
+0004f050: 656e 6428 676c 290a 2020 2020 2020 2020  end(gl).        
+0004f060: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
+0004f070: 7572 6e20 6774 665f 6c69 6e65 730a 0a20  urn gtf_lines.. 
+0004f080: 2020 200a 2020 2020 6465 6620 6765 745f     .    def get_
+0004f090: 6661 7374 615f 6c69 6e65 735f 6672 6f6d  fasta_lines_from
+0004f0a0: 5f65 786f 6e73 2873 656c 662c 2065 786f  _exons(self, exo
+0004f0b0: 6e73 5f72 676e 732c 2072 676e 735f 7267  ns_rgns, rgns_rg
+0004f0c0: 6e73 2c20 6364 735f 7267 6e73 2c20 6765  ns, cds_rgns, ge
+0004f0d0: 6e6f 6d65 2c20 7365 6c2c 205c 0a20 2020  nome, sel, \.   
+0004f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f100: 2073 656c 662e 6769 642c 2073 656c 662e   self.gid, self.
-0004f110: 7469 642c 2073 656c 662e 676e 616d 652c  tid, self.gname,
-0004f120: 2073 656c 662e 746e 616d 652c 2073 656c   self.tname, sel
-0004f130: 662e 6269 6f74 7970 6520 290a 2020 2020  f.biotype ).    
-0004f140: 2020 2020 2020 2020 2020 2020 6774 665f              gtf_
-0004f150: 6c69 6e65 732e 6170 7065 6e64 2867 6c29  lines.append(gl)
-0004f160: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0004f170: 2020 2020 2020 7265 7475 726e 2067 7466        return gtf
-0004f180: 5f6c 696e 6573 0a0a 2020 2020 0a20 2020  _lines..    .   
-0004f190: 2064 6566 2067 6574 5f66 6173 7461 5f6c   def get_fasta_l
-0004f1a0: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
-0004f1b0: 7365 6c66 2c20 6578 6f6e 735f 7267 6e73  self, exons_rgns
-0004f1c0: 2c20 7267 6e73 5f72 676e 732c 2063 6473  , rgns_rgns, cds
-0004f1d0: 5f72 676e 732c 2067 656e 6f6d 652c 2073  _rgns, genome, s
-0004f1e0: 656c 2c20 5c0a 2020 2020 2020 2020 2020  el, \.          
-0004f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f200: 2020 2020 2020 2020 2070 6570 7469 6465           peptide
-0004f210: 203d 2046 616c 7365 2c20 4c5f 7468 5f74   = False, L_th_t
-0004f220: 203d 204d 494e 5f54 525f 4c45 4e47 5448   = MIN_TR_LENGTH
-0004f230: 2c20 4c5f 7468 5f70 203d 204d 494e 5f50  , L_th_p = MIN_P
-0004f240: 525f 4c45 4e47 5448 293a 0a0a 2020 2020  R_LENGTH):..    
-0004f250: 2020 2020 7072 6566 6978 203d 2027 5827      prefix = 'X'
-0004f260: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0004f270: 2e67 7270 5f73 697a 6520 3d3d 2031 3a20  .grp_size == 1: 
-0004f280: 7072 6566 6978 203d 2027 5427 0a20 2020  prefix = 'T'.   
-0004f290: 2020 2020 2065 6c69 6620 7365 6c66 2e67       elif self.g
-0004f2a0: 7270 5f73 697a 6520 3e20 313a 2070 7265  rp_size > 1: pre
-0004f2b0: 6669 7820 3d20 2749 270a 2020 2020 2020  fix = 'I'.      
-0004f2c0: 2020 2320 6320 3d20 6765 745f 635f 6672    # c = get_c_fr
-0004f2d0: 6f6d 5f69 7374 7261 6e64 2873 656c 662e  om_istrand(self.
-0004f2e0: 6973 7472 616e 6429 0a20 2020 2020 2020  istrand).       
-0004f2f0: 2023 2063 5f6f 725f 6e20 3d20 6765 745f   # c_or_n = get_
-0004f300: 7374 725f 6672 6f6d 5f69 6364 6e67 2820  str_from_icdng( 
-0004f310: 7365 6c66 2e69 6364 7320 290a 2020 2020  self.icds ).    
-0004f320: 2020 2020 0a20 2020 2020 2020 2073 6571      .        seq
-0004f330: 2c20 6173 6571 203d 2073 656c 662e 7473  , aseq = self.ts
-0004f340: 6571 2c20 7365 6c66 2e61 7365 7120 2320  eq, self.aseq # 
-0004f350: 7365 6c66 2e67 6574 5f73 6571 5f66 726f  self.get_seq_fro
-0004f360: 6d5f 6578 6f6e 7328 6578 6f6e 735f 7267  m_exons(exons_rg
-0004f370: 6e73 2c20 7267 6e73 5f72 676e 732c 2063  ns, rgns_rgns, c
-0004f380: 6473 5f72 676e 732c 2067 656e 6f6d 652c  ds_rgns, genome,
-0004f390: 2073 656c 2c20 7065 7074 6964 6529 0a20   sel, peptide). 
-0004f3a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0004f3b0: 2727 270a 2020 2020 2020 2020 7420 3d20  '''.        t = 
-0004f3c0: 5472 616e 7363 7269 7074 2870 7265 6669  Transcript(prefi
-0004f3d0: 782c 2073 656c 662e 7469 642c 2073 656c  x, self.tid, sel
-0004f3e0: 662e 6772 705f 7369 7a65 2c20 7365 6c66  f.grp_size, self
-0004f3f0: 2e69 636e 742c 2073 656c 662e 6368 722c  .icnt, self.chr,
-0004f400: 2073 656c 662e 6265 6769 6e2c 2073 656c   self.begin, sel
-0004f410: 662e 656e 642c 205c 0a20 2020 2020 2020  f.end, \.       
-0004f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f430: 7365 6c66 2e69 7374 7261 6e64 2c20 635f  self.istrand, c_
-0004f440: 6f72 5f6e 2c20 2727 2c20 7365 6c66 2e61  or_n, '', self.a
-0004f450: 626e 2c20 7365 6c66 2e74 706d 2c20 7365  bn, self.tpm, se
-0004f460: 6c66 2e69 736f 5f66 7261 632c 205c 0a20  lf.iso_frac, \. 
-0004f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f480: 2020 2020 2020 6c65 6e28 6578 6f6e 735f        len(exons_
-0004f490: 7267 6e73 292c 206c 656e 2873 6571 292a  rgns), len(seq)*
-0004f4a0: 7365 6c66 2e61 626e 2c20 3129 0a0a 2020  self.abn, 1)..  
-0004f4b0: 2020 2020 2020 746e 616d 6520 3d20 6765        tname = ge
-0004f4c0: 745f 7472 5f6e 616d 6528 5b74 5d29 5b30  t_tr_name([t])[0
-0004f4d0: 5d0a 2020 2020 2020 2020 6864 7220 3d20  ].        hdr = 
-0004f4e0: 273e 2720 2b20 746e 616d 6520 2b20 275c  '>' + tname + '\
-0004f4f0: 6e27 0a20 2020 2020 2020 2027 2727 0a20  n'.        '''. 
-0004f500: 2020 2020 2020 2023 2068 6472 203d 2027         # hdr = '
-0004f510: 3e27 202b 2073 656c 662e 7469 6420 2b20  >' + self.tid + 
-0004f520: 2720 6c65 6e67 7468 3a25 6920 6162 6e3a  ' length:%i abn:
-0004f530: 2566 2073 7472 616e 643a 2573 2025 735c  %f strand:%s %s\
-0004f540: 6e27 2025 2028 6c65 6e28 7365 7129 2c20  n' % (len(seq), 
-0004f550: 6e70 2e72 6f75 6e64 2873 656c 662e 6162  np.round(self.ab
-0004f560: 6e2c 2032 292c 2063 2c20 635f 6f72 5f6e  n, 2), c, c_or_n
-0004f570: 290a 2020 2020 2020 2020 6864 7220 3d20  ).        hdr = 
-0004f580: 7365 745f 6661 5f68 6561 6465 7228 2073  set_fa_header( s
-0004f590: 656c 662e 7469 642c 206c 656e 2873 6571  elf.tid, len(seq
-0004f5a0: 292c 206e 702e 726f 756e 6428 7365 6c66  ), np.round(self
-0004f5b0: 2e61 626e 2c20 3229 2c20 7365 6c66 2e69  .abn, 2), self.i
-0004f5c0: 7374 7261 6e64 2c20 7365 6c66 2e69 6364  strand, self.icd
-0004f5d0: 7320 290a 2020 2020 2020 2020 6864 7220  s ).        hdr 
-0004f5e0: 3d20 273e 2720 2b20 6864 7220 2b20 275c  = '>' + hdr + '\
-0004f5f0: 6e27 0a20 2020 2020 2020 2068 6472 5f70  n'.        hdr_p
-0004f600: 203d 2073 6574 5f66 615f 6865 6164 6572   = set_fa_header
-0004f610: 2820 7365 6c66 2e74 6964 2c20 6c65 6e28  ( self.tid, len(
-0004f620: 6173 6571 292c 206e 702e 726f 756e 6428  aseq), np.round(
-0004f630: 7365 6c66 2e61 626e 2c20 3229 2c20 7365  self.abn, 2), se
-0004f640: 6c66 2e69 7374 7261 6e64 2c20 7365 6c66  lf.istrand, self
-0004f650: 2e69 6364 7320 290a 2020 2020 2020 2020  .icds ).        
-0004f660: 6864 725f 7020 3d20 273e 2720 2b20 6864  hdr_p = '>' + hd
-0004f670: 725f 7020 2b20 275c 6e27 0a0a 2020 2020  r_p + '\n'..    
-0004f680: 2020 2020 6274 203d 2046 616c 7365 0a20      bt = False. 
-0004f690: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-0004f6a0: 7129 203e 3d20 4c5f 7468 5f74 3a20 6274  q) >= L_th_t: bt
-0004f6b0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0004f6c0: 6270 203d 2046 616c 7365 0a20 2020 2020  bp = False.     
-0004f6d0: 2020 2069 6620 6c65 6e28 6173 6571 2920     if len(aseq) 
-0004f6e0: 3e3d 204c 5f74 685f 703a 2062 7020 3d20  >= L_th_p: bp = 
-0004f6f0: 5472 7565 0a0a 2020 2020 2020 2020 6966  True..        if
-0004f700: 2062 7420 2620 6270 3a0a 2020 2020 2020   bt & bp:.      
-0004f710: 2020 2020 2020 7265 7475 726e 205b 6864        return [hd
-0004f720: 722c 2073 6571 2b27 5c6e 275d 2c20 5b68  r, seq+'\n'], [h
-0004f730: 6472 5f70 2c20 6173 6571 2b27 5c6e 275d  dr_p, aseq+'\n']
-0004f740: 0a20 2020 2020 2020 2065 6c69 6620 2862  .        elif (b
-0004f750: 7429 2026 2028 206e 6f74 2062 7029 3a0a  t) & ( not bp):.
-0004f760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0004f770: 726e 205b 6864 722c 2073 6571 2b27 5c6e  rn [hdr, seq+'\n
-0004f780: 275d 2c20 5b5d 0a20 2020 2020 2020 2065  '], [].        e
-0004f790: 6c69 6620 286e 6f74 2062 7429 2026 2028  lif (not bt) & (
-0004f7a0: 6270 293a 0a20 2020 2020 2020 2020 2020  bp):.           
-0004f7b0: 2072 6574 7572 6e20 5b5d 2c20 5b68 6472   return [], [hdr
-0004f7c0: 2c20 6173 6571 2b27 5c6e 275d 0a20 2020  , aseq+'\n'].   
-0004f7d0: 2020 2020 2065 6c73 653a 200a 2020 2020       else: .    
-0004f7e0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-0004f7f0: 5d2c 205b 5d0a 0a20 2020 2020 2020 2027  ], []..        '
-0004f800: 2727 0a20 2020 2020 2020 2069 6620 6c65  ''.        if le
-0004f810: 6e28 7365 7129 203e 3d20 4c5f 7468 5f74  n(seq) >= L_th_t
-0004f820: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0004f830: 206c 656e 2861 7365 7129 203e 3d20 4c5f   len(aseq) >= L_
-0004f840: 7468 5f70 3a0a 2020 2020 2020 2020 2020  th_p:.          
-0004f850: 2020 2020 2020 6966 2070 6570 7469 6465        if peptide
-0004f860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004f870: 2020 2020 2020 7265 7475 726e 205b 6864        return [hd
-0004f880: 722c 2073 6571 2b27 5c6e 275d 2c20 5b68  r, seq+'\n'], [h
-0004f890: 6472 2c20 6173 6571 2b27 5c6e 275d 0a20  dr, aseq+'\n']. 
-0004f8a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004f8b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0004f8c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0004f8d0: 5b68 6472 2c20 7365 712b 275c 6e27 5d2c  [hdr, seq+'\n'],
-0004f8e0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0004f8f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0004f900: 2020 2020 2020 7265 7475 726e 205b 6864        return [hd
-0004f910: 722c 2073 6571 2b27 5c6e 275d 2c20 5b5d  r, seq+'\n'], []
-0004f920: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0004f930: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0004f940: 6e20 5b5d 2c5b 5d0a 2020 2020 2020 2020  n [],[].        
-0004f950: 2727 270a 2020 2020 2020 2020 0a20 2020  '''.        .   
-0004f960: 2064 6566 2075 7064 6174 655f 696e 666f   def update_info
-0004f970: 2873 656c 662c 2065 786f 6e73 5f72 676e  (self, exons_rgn
-0004f980: 732c 2072 676e 735f 7267 6e73 2c20 6364  s, rgns_rgns, cd
-0004f990: 735f 7267 6e73 2c20 6765 6e6f 6d65 2c20  s_rgns, genome, 
-0004f9a0: 7365 6c2c 2070 6570 7469 6465 293a 0a20  sel, peptide):. 
-0004f9b0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0004f9c0: 7365 712c 2061 7365 712c 2063 6473 2c20  seq, aseq, cds, 
-0004f9d0: 6265 203d 2073 656c 662e 6765 745f 7365  be = self.get_se
-0004f9e0: 715f 6672 6f6d 5f65 786f 6e73 2865 786f  q_from_exons(exo
-0004f9f0: 6e73 5f72 676e 732c 2072 676e 735f 7267  ns_rgns, rgns_rg
-0004fa00: 6e73 2c20 6364 735f 7267 6e73 2c20 6765  ns, cds_rgns, ge
-0004fa10: 6e6f 6d65 2c20 7365 6c2c 2070 6570 7469  nome, sel, pepti
-0004fa20: 6465 290a 2020 2020 2020 2020 7265 7475  de).        retu
-0004fa30: 726e 2073 6571 2c20 6173 6571 2c20 6364  rn seq, aseq, cd
-0004fa40: 732c 2062 650a 2020 2020 2020 2020 0a20  s, be.        . 
-0004fa50: 2020 200a 2020 2020 6465 6620 6765 745f     .    def get_
-0004fa60: 7365 715f 6672 6f6d 5f65 786f 6e73 2873  seq_from_exons(s
-0004fa70: 656c 662c 2065 786f 6e73 5f72 676e 732c  elf, exons_rgns,
-0004fa80: 2072 676e 735f 7267 6e73 2c20 6364 735f   rgns_rgns, cds_
-0004fa90: 7267 6e73 2c20 6765 6e6f 6d65 2c20 7365  rgns, genome, se
-0004faa0: 6c2c 2070 6570 7469 6465 293a 0a20 2020  l, peptide):.   
-0004fab0: 2020 2020 200a 2020 2020 2020 2020 6665       .        fe
-0004fac0: 6174 7572 6573 5f6e 6f6e 5f65 786f 6e20  atures_non_exon 
-0004fad0: 3d20 5b27 6364 7327 2c20 2773 7461 7274  = ['cds', 'start
-0004fae0: 5f63 6f64 6f6e 272c 2027 7374 6f70 5f63  _codon', 'stop_c
-0004faf0: 6f64 6f6e 272c 2027 4344 5327 2c20 2753  odon', 'CDS', 'S
-0004fb00: 5441 5254 5f43 4f44 4f4e 272c 2027 5354  TART_CODON', 'ST
-0004fb10: 4f50 5f43 4f44 4f4e 275d 0a20 2020 2020  OP_CODON'].     
-0004fb20: 2020 200a 2020 2020 2020 2020 7365 7120     .        seq 
-0004fb30: 3d20 2727 0a20 2020 2020 2020 2061 7365  = ''.        ase
-0004fb40: 7120 3d20 2727 0a20 2020 2020 2020 2063  q = ''.        c
-0004fb50: 6473 203d 2072 6567 696f 6e73 2829 0a20  ds = regions(). 
-0004fb60: 2020 2020 2020 2062 6520 3d20 4661 6c73         be = Fals
-0004fb70: 650a 2020 2020 2020 2020 6c6f 6620 3d20  e.        lof = 
-0004fb80: 6c6f 6361 7469 6f6e 5f66 696e 6465 7228  location_finder(
-0004fb90: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-0004fba0: 2020 2069 6620 7365 6c20 3d3d 2030 3a0a     if sel == 0:.
-0004fbb0: 2020 2020 2020 2020 2020 2020 7267 6e73              rgns
-0004fbc0: 203d 2072 676e 735f 7267 6e73 0a20 2020   = rgns_rgns.   
-0004fbd0: 2020 2020 2020 2020 2074 676d 203d 2073           tgm = s
-0004fbe0: 656c 662e 7472 5f74 6f5f 6772 5f6d 6170  elf.tr_to_gr_map
-0004fbf0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0004fc00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0004fc10: 2020 2020 2020 2020 7267 6e73 203d 2065          rgns = e
-0004fc20: 786f 6e73 5f72 676e 730a 2020 2020 2020  xons_rgns.      
-0004fc30: 2020 2020 2020 7467 6d20 3d20 7365 6c66        tgm = self
-0004fc40: 2e74 655f 746f 5f67 655f 6d61 700a 2020  .te_to_ge_map.  
-0004fc50: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
-0004fc60: 6620 6c65 6e28 7267 6e73 2920 3d3d 2030  f len(rgns) == 0
-0004fc70: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0004fc80: 7475 726e 2073 6571 2c20 6173 6571 2c20  turn seq, aseq, 
-0004fc90: 6364 732c 2062 650a 2020 2020 2020 2020  cds, be.        
-0004fca0: 0a20 2020 2020 2020 2069 6620 6765 6e6f  .        if geno
-0004fcb0: 6d65 2069 7320 4e6f 6e65 3a0a 2020 2020  me is None:.    
-0004fcc0: 2020 2020 2020 2020 666f 7220 6b2c 206d          for k, m
-0004fcd0: 2069 6e20 656e 756d 6572 6174 6528 7467   in enumerate(tg
-0004fce0: 6d29 3a0a 2020 2020 2020 2020 2020 2020  m):.            
-0004fcf0: 2020 2020 6520 3d20 7267 6e73 5b6d 5d0a      e = rgns[m].
-0004fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd10: 6966 2065 2e74 7970 6520 213d 2027 696e  if e.type != 'in
-0004fd20: 7365 7273 696f 6e27 3a20 0a20 2020 2020  sersion': .     
-0004fd30: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0004fd40: 6f66 2e61 6464 2820 652e 7374 6172 742c  of.add( e.start,
-0004fd50: 2065 2e65 6e64 2c20 6c65 6e28 7365 7129   e.end, len(seq)
-0004fd60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004fd70: 2020 6966 2028 652e 7479 7065 2021 3d20    if (e.type != 
-0004fd80: 2764 656c 6574 696f 6e27 2920 2620 2865  'deletion') & (e
-0004fd90: 2e74 7970 6520 213d 2027 4427 293a 0a20  .type != 'D'):. 
-0004fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fdb0: 2020 2073 6571 203d 2073 6571 202b 2065     seq = seq + e
-0004fdc0: 2e73 6571 2023 2067 6574 5f73 6571 2829  .seq # get_seq()
-0004fdd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0004fde0: 7365 6c20 3d3d 2030 3a0a 2020 2020 2020  sel == 0:.      
-0004fdf0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0004fe00: 2873 6571 2920 3e20 303a 0a20 2020 2020  (seq) > 0:.     
-0004fe10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004fe20: 656c 662e 636f 7620 3d20 7365 6c66 2e63  elf.cov = self.c
-0004fe30: 6f76 5f6c 656e 2f6c 656e 2873 6571 290a  ov_len/len(seq).
-0004fe40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0004fe50: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0004fe60: 203c 2032 3a0a 2020 2020 2020 2020 2020   < 2:.          
-0004fe70: 2020 2020 2020 666f 7220 6b2c 206d 2069        for k, m i
-0004fe80: 6e20 656e 756d 6572 6174 6528 7467 6d29  n enumerate(tgm)
-0004fe90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004fea0: 2020 2020 2020 6520 3d20 7267 6e73 5b6d        e = rgns[m
-0004feb0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0004fec0: 2020 2020 2020 6c6f 662e 6164 6428 2065        lof.add( e
-0004fed0: 2e73 7461 7274 2c20 652e 656e 642c 206c  .start, e.end, l
-0004fee0: 656e 2873 6571 2929 0a20 2020 2020 2020  en(seq)).       
-0004fef0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004ff00: 652e 7479 7065 203d 3d20 2765 786f 6e27  e.type == 'exon'
-0004ff10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004ff20: 2020 2020 2020 2020 2020 6966 2028 652e            if (e.
-0004ff30: 636f 765f 6c65 6e20 3d3d 206c 656e 2865  cov_len == len(e
-0004ff40: 2e73 6571 2929 3a20 2320 7365 715f 6375  .seq)): # seq_cu
-0004ff50: 722e 636f 756e 7428 274e 2729 203d 3d20  r.count('N') == 
-0004ff60: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0004ff70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004ff80: 6571 203d 2073 6571 202b 2065 2e73 6571  eq = seq + e.seq
-0004ff90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ffa0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0004ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ffc0: 2020 2020 2020 2020 2020 2063 6872 6d20             chrm 
-0004ffd0: 3d20 652e 6368 720a 2020 2020 2020 2020  = e.chr.        
-0004ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fff0: 2020 2020 7374 6172 7420 3d20 652e 7374      start = e.st
-00050000: 6172 7420 2d31 0a20 2020 2020 2020 2020  art -1.         
-00050010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050020: 2020 2065 6e64 203d 2065 2e65 6e64 0a20     end = e.end. 
-00050030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050040: 2020 2020 2020 2020 2020 206f 7267 5f73             org_s
-00050050: 6571 203d 2067 656e 6f6d 655b 6368 726d  eq = genome[chrm
-00050060: 5d2e 7365 715b 7374 6172 743a 656e 645d  ].seq[start:end]
-00050070: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050080: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00050090: 2065 2e63 6f76 5f6c 656e 203c 3d20 303a   e.cov_len <= 0:
-000500a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000500b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000500c0: 2073 6571 203d 2073 6571 202b 206f 7267   seq = seq + org
-000500d0: 5f73 6571 0a20 2020 2020 2020 2020 2020  _seq.           
-000500e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000500f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00050100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050110: 2020 2020 2020 2073 6320 3d20 6c69 7374         sc = list
-00050120: 2865 2e73 6571 290a 2020 2020 2020 2020  (e.seq).        
-00050130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050140: 2020 2020 2020 2020 666f 7220 692c 206c          for i, l
-00050150: 7472 2069 6e20 656e 756d 6572 6174 6528  tr in enumerate(
-00050160: 652e 7365 7129 3a0a 2020 2020 2020 2020  e.seq):.        
-00050170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050180: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00050190: 7472 203d 3d20 274e 273a 0a20 2020 2020  tr == 'N':.     
-000501a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f100: 7065 7074 6964 6520 3d20 4661 6c73 652c  peptide = False,
+0004f110: 204c 5f74 685f 7420 3d20 4d49 4e5f 5452   L_th_t = MIN_TR
+0004f120: 5f4c 454e 4754 482c 204c 5f74 685f 7020  _LENGTH, L_th_p 
+0004f130: 3d20 4d49 4e5f 5052 5f4c 454e 4754 4829  = MIN_PR_LENGTH)
+0004f140: 3a0a 0a20 2020 2020 2020 2070 7265 6669  :..        prefi
+0004f150: 7820 3d20 2758 270a 2020 2020 2020 2020  x = 'X'.        
+0004f160: 6966 2073 656c 662e 6772 705f 7369 7a65  if self.grp_size
+0004f170: 203d 3d20 313a 2070 7265 6669 7820 3d20   == 1: prefix = 
+0004f180: 2754 270a 2020 2020 2020 2020 656c 6966  'T'.        elif
+0004f190: 2073 656c 662e 6772 705f 7369 7a65 203e   self.grp_size >
+0004f1a0: 2031 3a20 7072 6566 6978 203d 2027 4927   1: prefix = 'I'
+0004f1b0: 0a20 2020 2020 2020 2023 2063 203d 2067  .        # c = g
+0004f1c0: 6574 5f63 5f66 726f 6d5f 6973 7472 616e  et_c_from_istran
+0004f1d0: 6428 7365 6c66 2e69 7374 7261 6e64 290a  d(self.istrand).
+0004f1e0: 2020 2020 2020 2020 2320 635f 6f72 5f6e          # c_or_n
+0004f1f0: 203d 2067 6574 5f73 7472 5f66 726f 6d5f   = get_str_from_
+0004f200: 6963 646e 6728 2073 656c 662e 6963 6473  icdng( self.icds
+0004f210: 2029 0a20 2020 2020 2020 200a 2020 2020   ).        .    
+0004f220: 2020 2020 7365 712c 2061 7365 7120 3d20      seq, aseq = 
+0004f230: 7365 6c66 2e74 7365 712c 2073 656c 662e  self.tseq, self.
+0004f240: 6173 6571 2023 2073 656c 662e 6765 745f  aseq # self.get_
+0004f250: 7365 715f 6672 6f6d 5f65 786f 6e73 2865  seq_from_exons(e
+0004f260: 786f 6e73 5f72 676e 732c 2072 676e 735f  xons_rgns, rgns_
+0004f270: 7267 6e73 2c20 6364 735f 7267 6e73 2c20  rgns, cds_rgns, 
+0004f280: 6765 6e6f 6d65 2c20 7365 6c2c 2070 6570  genome, sel, pep
+0004f290: 7469 6465 290a 2020 2020 2020 2020 0a20  tide).        . 
+0004f2a0: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+0004f2b0: 2020 2074 203d 2054 7261 6e73 6372 6970     t = Transcrip
+0004f2c0: 7428 7072 6566 6978 2c20 7365 6c66 2e74  t(prefix, self.t
+0004f2d0: 6964 2c20 7365 6c66 2e67 7270 5f73 697a  id, self.grp_siz
+0004f2e0: 652c 2073 656c 662e 6963 6e74 2c20 7365  e, self.icnt, se
+0004f2f0: 6c66 2e63 6872 2c20 7365 6c66 2e62 6567  lf.chr, self.beg
+0004f300: 696e 2c20 7365 6c66 2e65 6e64 2c20 5c0a  in, self.end, \.
+0004f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f320: 2020 2020 2020 2073 656c 662e 6973 7472         self.istr
+0004f330: 616e 642c 2063 5f6f 725f 6e2c 2027 272c  and, c_or_n, '',
+0004f340: 2073 656c 662e 6162 6e2c 2073 656c 662e   self.abn, self.
+0004f350: 7470 6d2c 2073 656c 662e 6973 6f5f 6672  tpm, self.iso_fr
+0004f360: 6163 2c20 5c0a 2020 2020 2020 2020 2020  ac, \.          
+0004f370: 2020 2020 2020 2020 2020 2020 206c 656e               len
+0004f380: 2865 786f 6e73 5f72 676e 7329 2c20 6c65  (exons_rgns), le
+0004f390: 6e28 7365 7129 2a73 656c 662e 6162 6e2c  n(seq)*self.abn,
+0004f3a0: 2031 290a 0a20 2020 2020 2020 2074 6e61   1)..        tna
+0004f3b0: 6d65 203d 2067 6574 5f74 725f 6e61 6d65  me = get_tr_name
+0004f3c0: 285b 745d 295b 305d 0a20 2020 2020 2020  ([t])[0].       
+0004f3d0: 2068 6472 203d 2027 3e27 202b 2074 6e61   hdr = '>' + tna
+0004f3e0: 6d65 202b 2027 5c6e 270a 2020 2020 2020  me + '\n'.      
+0004f3f0: 2020 2727 270a 2020 2020 2020 2020 2320    '''.        # 
+0004f400: 6864 7220 3d20 273e 2720 2b20 7365 6c66  hdr = '>' + self
+0004f410: 2e74 6964 202b 2027 206c 656e 6774 683a  .tid + ' length:
+0004f420: 2569 2061 626e 3a25 6620 7374 7261 6e64  %i abn:%f strand
+0004f430: 3a25 7320 2573 5c6e 2720 2520 286c 656e  :%s %s\n' % (len
+0004f440: 2873 6571 292c 206e 702e 726f 756e 6428  (seq), np.round(
+0004f450: 7365 6c66 2e61 626e 2c20 3229 2c20 632c  self.abn, 2), c,
+0004f460: 2063 5f6f 725f 6e29 0a20 2020 2020 2020   c_or_n).       
+0004f470: 2068 6472 203d 2073 6574 5f66 615f 6865   hdr = set_fa_he
+0004f480: 6164 6572 2820 7365 6c66 2e74 6964 2c20  ader( self.tid, 
+0004f490: 6c65 6e28 7365 7129 2c20 6e70 2e72 6f75  len(seq), np.rou
+0004f4a0: 6e64 2873 656c 662e 6162 6e2c 2032 292c  nd(self.abn, 2),
+0004f4b0: 2073 656c 662e 6973 7472 616e 642c 2073   self.istrand, s
+0004f4c0: 656c 662e 6963 6473 2029 0a20 2020 2020  elf.icds ).     
+0004f4d0: 2020 2068 6472 203d 2027 3e27 202b 2068     hdr = '>' + h
+0004f4e0: 6472 202b 2027 5c6e 270a 2020 2020 2020  dr + '\n'.      
+0004f4f0: 2020 6864 725f 7020 3d20 7365 745f 6661    hdr_p = set_fa
+0004f500: 5f68 6561 6465 7228 2073 656c 662e 7469  _header( self.ti
+0004f510: 642c 206c 656e 2861 7365 7129 2c20 6e70  d, len(aseq), np
+0004f520: 2e72 6f75 6e64 2873 656c 662e 6162 6e2c  .round(self.abn,
+0004f530: 2032 292c 2073 656c 662e 6973 7472 616e   2), self.istran
+0004f540: 642c 2073 656c 662e 6963 6473 2029 0a20  d, self.icds ). 
+0004f550: 2020 2020 2020 2068 6472 5f70 203d 2027         hdr_p = '
+0004f560: 3e27 202b 2068 6472 5f70 202b 2027 5c6e  >' + hdr_p + '\n
+0004f570: 270a 0a20 2020 2020 2020 2062 7420 3d20  '..        bt = 
+0004f580: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+0004f590: 206c 656e 2873 6571 2920 3e3d 204c 5f74   len(seq) >= L_t
+0004f5a0: 685f 743a 2062 7420 3d20 5472 7565 0a20  h_t: bt = True. 
+0004f5b0: 2020 2020 2020 2062 7020 3d20 4661 6c73         bp = Fals
+0004f5c0: 650a 2020 2020 2020 2020 6966 206c 656e  e.        if len
+0004f5d0: 2861 7365 7129 203e 3d20 4c5f 7468 5f70  (aseq) >= L_th_p
+0004f5e0: 3a20 6270 203d 2054 7275 650a 0a20 2020  : bp = True..   
+0004f5f0: 2020 2020 2069 6620 6274 2026 2062 703a       if bt & bp:
+0004f600: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0004f610: 7572 6e20 5b68 6472 2c20 7365 712b 275c  urn [hdr, seq+'\
+0004f620: 6e27 5d2c 205b 6864 725f 702c 2061 7365  n'], [hdr_p, ase
+0004f630: 712b 275c 6e27 5d0a 2020 2020 2020 2020  q+'\n'].        
+0004f640: 656c 6966 2028 6274 2920 2620 2820 6e6f  elif (bt) & ( no
+0004f650: 7420 6270 293a 0a20 2020 2020 2020 2020  t bp):.         
+0004f660: 2020 2072 6574 7572 6e20 5b68 6472 2c20     return [hdr, 
+0004f670: 7365 712b 275c 6e27 5d2c 205b 5d0a 2020  seq+'\n'], [].  
+0004f680: 2020 2020 2020 656c 6966 2028 6e6f 7420        elif (not 
+0004f690: 6274 2920 2620 2862 7029 3a0a 2020 2020  bt) & (bp):.    
+0004f6a0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+0004f6b0: 5d2c 205b 6864 722c 2061 7365 712b 275c  ], [hdr, aseq+'\
+0004f6c0: 6e27 5d0a 2020 2020 2020 2020 656c 7365  n'].        else
+0004f6d0: 3a20 0a20 2020 2020 2020 2020 2020 2072  : .            r
+0004f6e0: 6574 7572 6e20 5b5d 2c20 5b5d 0a0a 2020  eturn [], []..  
+0004f6f0: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+0004f700: 2020 6966 206c 656e 2873 6571 2920 3e3d    if len(seq) >=
+0004f710: 204c 5f74 685f 743a 0a20 2020 2020 2020   L_th_t:.       
+0004f720: 2020 2020 2069 6620 6c65 6e28 6173 6571       if len(aseq
+0004f730: 2920 3e3d 204c 5f74 685f 703a 0a20 2020  ) >= L_th_p:.   
+0004f740: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004f750: 7065 7074 6964 653a 0a20 2020 2020 2020  peptide:.       
+0004f760: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0004f770: 7572 6e20 5b68 6472 2c20 7365 712b 275c  urn [hdr, seq+'\
+0004f780: 6e27 5d2c 205b 6864 722c 2061 7365 712b  n'], [hdr, aseq+
+0004f790: 275c 6e27 5d0a 2020 2020 2020 2020 2020  '\n'].          
+0004f7a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0004f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f7c0: 7265 7475 726e 205b 6864 722c 2073 6571  return [hdr, seq
+0004f7d0: 2b27 5c6e 275d 2c20 5b5d 0a20 2020 2020  +'\n'], [].     
+0004f7e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0004f7f0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0004f800: 7572 6e20 5b68 6472 2c20 7365 712b 275c  urn [hdr, seq+'\
+0004f810: 6e27 5d2c 205b 5d0a 2020 2020 2020 2020  n'], [].        
+0004f820: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0004f830: 2020 7265 7475 726e 205b 5d2c 5b5d 0a20    return [],[]. 
+0004f840: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+0004f850: 2020 200a 2020 2020 6465 6620 7570 6461     .    def upda
+0004f860: 7465 5f69 6e66 6f28 7365 6c66 2c20 6578  te_info(self, ex
+0004f870: 6f6e 735f 7267 6e73 2c20 7267 6e73 5f72  ons_rgns, rgns_r
+0004f880: 676e 732c 2063 6473 5f72 676e 732c 2067  gns, cds_rgns, g
+0004f890: 656e 6f6d 652c 2073 656c 2c20 7065 7074  enome, sel, pept
+0004f8a0: 6964 6529 3a0a 2020 2020 2020 2020 0a20  ide):.        . 
+0004f8b0: 2020 2020 2020 2073 6571 2c20 6173 6571         seq, aseq
+0004f8c0: 2c20 6364 732c 2062 6520 3d20 7365 6c66  , cds, be = self
+0004f8d0: 2e67 6574 5f73 6571 5f66 726f 6d5f 6578  .get_seq_from_ex
+0004f8e0: 6f6e 7328 6578 6f6e 735f 7267 6e73 2c20  ons(exons_rgns, 
+0004f8f0: 7267 6e73 5f72 676e 732c 2063 6473 5f72  rgns_rgns, cds_r
+0004f900: 676e 732c 2067 656e 6f6d 652c 2073 656c  gns, genome, sel
+0004f910: 2c20 7065 7074 6964 6529 0a20 2020 2020  , peptide).     
+0004f920: 2020 2072 6574 7572 6e20 7365 712c 2061     return seq, a
+0004f930: 7365 712c 2063 6473 2c20 6265 0a20 2020  seq, cds, be.   
+0004f940: 2020 2020 200a 2020 2020 0a20 2020 2064       .    .    d
+0004f950: 6566 2067 6574 5f73 6571 5f66 726f 6d5f  ef get_seq_from_
+0004f960: 6578 6f6e 7328 7365 6c66 2c20 6578 6f6e  exons(self, exon
+0004f970: 735f 7267 6e73 2c20 7267 6e73 5f72 676e  s_rgns, rgns_rgn
+0004f980: 732c 2063 6473 5f72 676e 732c 2067 656e  s, cds_rgns, gen
+0004f990: 6f6d 652c 2073 656c 2c20 7065 7074 6964  ome, sel, peptid
+0004f9a0: 6529 3a0a 2020 2020 2020 2020 0a20 2020  e):.        .   
+0004f9b0: 2020 2020 2066 6561 7475 7265 735f 6e6f       features_no
+0004f9c0: 6e5f 6578 6f6e 203d 205b 2763 6473 272c  n_exon = ['cds',
+0004f9d0: 2027 7374 6172 745f 636f 646f 6e27 2c20   'start_codon', 
+0004f9e0: 2773 746f 705f 636f 646f 6e27 2c20 2743  'stop_codon', 'C
+0004f9f0: 4453 272c 2027 5354 4152 545f 434f 444f  DS', 'START_CODO
+0004fa00: 4e27 2c20 2753 544f 505f 434f 444f 4e27  N', 'STOP_CODON'
+0004fa10: 5d0a 2020 2020 2020 2020 0a20 2020 2020  ].        .     
+0004fa20: 2020 2073 6571 203d 2027 270a 2020 2020     seq = ''.    
+0004fa30: 2020 2020 6173 6571 203d 2027 270a 2020      aseq = ''.  
+0004fa40: 2020 2020 2020 6364 7320 3d20 7265 6769        cds = regi
+0004fa50: 6f6e 7328 290a 2020 2020 2020 2020 6265  ons().        be
+0004fa60: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0004fa70: 206c 6f66 203d 206c 6f63 6174 696f 6e5f   lof = location_
+0004fa80: 6669 6e64 6572 2829 0a20 2020 2020 2020  finder().       
+0004fa90: 200a 2020 2020 2020 2020 6966 2073 656c   .        if sel
+0004faa0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0004fab0: 2020 2072 676e 7320 3d20 7267 6e73 5f72     rgns = rgns_r
+0004fac0: 676e 730a 2020 2020 2020 2020 2020 2020  gns.            
+0004fad0: 7467 6d20 3d20 7365 6c66 2e74 725f 746f  tgm = self.tr_to
+0004fae0: 5f67 725f 6d61 700a 2020 2020 2020 2020  _gr_map.        
+0004faf0: 2020 2020 0a20 2020 2020 2020 2065 6c73      .        els
+0004fb00: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0004fb10: 676e 7320 3d20 6578 6f6e 735f 7267 6e73  gns = exons_rgns
+0004fb20: 0a20 2020 2020 2020 2020 2020 2074 676d  .            tgm
+0004fb30: 203d 2073 656c 662e 7465 5f74 6f5f 6765   = self.te_to_ge
+0004fb40: 5f6d 6170 0a20 2020 2020 2020 200a 2020  _map.        .  
+0004fb50: 2020 2020 2020 6966 206c 656e 2872 676e        if len(rgn
+0004fb60: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+0004fb70: 2020 2020 2072 6574 7572 6e20 7365 712c       return seq,
+0004fb80: 2061 7365 712c 2063 6473 2c20 6265 0a20   aseq, cds, be. 
+0004fb90: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0004fba0: 6966 2067 656e 6f6d 6520 6973 204e 6f6e  if genome is Non
+0004fbb0: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+0004fbc0: 6f72 206b 2c20 6d20 696e 2065 6e75 6d65  or k, m in enume
+0004fbd0: 7261 7465 2874 676d 293a 0a20 2020 2020  rate(tgm):.     
+0004fbe0: 2020 2020 2020 2020 2020 2065 203d 2072             e = r
+0004fbf0: 676e 735b 6d5d 0a20 2020 2020 2020 2020  gns[m].         
+0004fc00: 2020 2020 2020 2069 6620 652e 7479 7065         if e.type
+0004fc10: 2021 3d20 2769 6e73 6572 7369 6f6e 273a   != 'insersion':
+0004fc20: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0004fc30: 2020 2020 2020 6c6f 662e 6164 6428 2065        lof.add( e
+0004fc40: 2e73 7461 7274 2c20 652e 656e 642c 206c  .start, e.end, l
+0004fc50: 656e 2873 6571 2929 0a20 2020 2020 2020  en(seq)).       
+0004fc60: 2020 2020 2020 2020 2069 6620 2865 2e74           if (e.t
+0004fc70: 7970 6520 213d 2027 6465 6c65 7469 6f6e  ype != 'deletion
+0004fc80: 2729 2026 2028 652e 7479 7065 2021 3d20  ') & (e.type != 
+0004fc90: 2744 2729 3a0a 2020 2020 2020 2020 2020  'D'):.          
+0004fca0: 2020 2020 2020 2020 2020 7365 7120 3d20            seq = 
+0004fcb0: 7365 7120 2b20 652e 7365 7120 2320 6765  seq + e.seq # ge
+0004fcc0: 745f 7365 7128 290a 2020 2020 2020 2020  t_seq().        
+0004fcd0: 2020 2020 6966 2073 656c 203d 3d20 303a      if sel == 0:
+0004fce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004fcf0: 2069 6620 6c65 6e28 7365 7129 203e 2030   if len(seq) > 0
+0004fd00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004fd10: 2020 2020 2020 7365 6c66 2e63 6f76 203d        self.cov =
+0004fd20: 2073 656c 662e 636f 765f 6c65 6e2f 6c65   self.cov_len/le
+0004fd30: 6e28 7365 7129 0a20 2020 2020 2020 2065  n(seq).        e
+0004fd40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0004fd50: 2069 6620 7365 6c20 3c20 323a 0a20 2020   if sel < 2:.   
+0004fd60: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004fd70: 206b 2c20 6d20 696e 2065 6e75 6d65 7261   k, m in enumera
+0004fd80: 7465 2874 676d 293a 0a20 2020 2020 2020  te(tgm):.       
+0004fd90: 2020 2020 2020 2020 2020 2020 2065 203d               e =
+0004fda0: 2072 676e 735b 6d5d 0a20 2020 2020 2020   rgns[m].       
+0004fdb0: 2020 2020 2020 2020 2020 2020 206c 6f66               lof
+0004fdc0: 2e61 6464 2820 652e 7374 6172 742c 2065  .add( e.start, e
+0004fdd0: 2e65 6e64 2c20 6c65 6e28 7365 7129 290a  .end, len(seq)).
+0004fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fdf0: 2020 2020 6966 2065 2e74 7970 6520 3d3d      if e.type ==
+0004fe00: 2027 6578 6f6e 273a 0a20 2020 2020 2020   'exon':.       
+0004fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fe20: 2069 6620 2865 2e63 6f76 5f6c 656e 203d   if (e.cov_len =
+0004fe30: 3d20 6c65 6e28 652e 7365 7129 293a 2023  = len(e.seq)): #
+0004fe40: 2073 6571 5f63 7572 2e63 6f75 6e74 2827   seq_cur.count('
+0004fe50: 4e27 2920 3d3d 2030 3a0a 2020 2020 2020  N') == 0:.      
+0004fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fe70: 2020 2020 2020 7365 7120 3d20 7365 7120        seq = seq 
+0004fe80: 2b20 652e 7365 710a 2020 2020 2020 2020  + e.seq.        
+0004fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fea0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0004feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fec0: 2020 6368 726d 203d 2065 2e63 6872 0a20    chrm = e.chr. 
+0004fed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fee0: 2020 2020 2020 2020 2020 2073 7461 7274             start
+0004fef0: 203d 2065 2e73 7461 7274 202d 310a 2020   = e.start -1.  
+0004ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ff10: 2020 2020 2020 2020 2020 656e 6420 3d20            end = 
+0004ff20: 652e 656e 640a 2020 2020 2020 2020 2020  e.end.          
+0004ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ff40: 2020 6f72 675f 7365 7120 3d20 6765 6e6f    org_seq = geno
+0004ff50: 6d65 5b63 6872 6d5d 2e73 6571 5b73 7461  me[chrm].seq[sta
+0004ff60: 7274 3a65 6e64 5d0a 0a20 2020 2020 2020  rt:end]..       
+0004ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ff80: 2020 2020 2069 6620 652e 636f 765f 6c65       if e.cov_le
+0004ff90: 6e20 3c3d 2030 3a0a 2020 2020 2020 2020  n <= 0:.        
+0004ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ffb0: 2020 2020 2020 2020 7365 7120 3d20 7365          seq = se
+0004ffc0: 7120 2b20 6f72 675f 7365 710a 2020 2020  q + org_seq.    
+0004ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ffe0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050000: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+00050010: 203d 206c 6973 7428 652e 7365 7129 0a20   = list(e.seq). 
+00050020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050030: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00050040: 6f72 2069 2c20 6c74 7220 696e 2065 6e75  or i, ltr in enu
+00050050: 6d65 7261 7465 2865 2e73 6571 293a 0a20  merate(e.seq):. 
+00050060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050080: 2020 2069 6620 6c74 7220 3d3d 2027 4e27     if ltr == 'N'
+00050090: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000500a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000500b0: 2020 2020 2020 2020 2020 7363 5b69 5d20            sc[i] 
+000500c0: 3d20 6f72 675f 7365 715b 695d 0a20 2020  = org_seq[i].   
+000500d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000500e0: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+000500f0: 203d 2073 6571 202b 2027 272e 6a6f 696e   = seq + ''.join
+00050100: 2873 6329 0a20 2020 2020 2020 2020 2020  (sc).           
+00050110: 2020 2020 2020 2020 2065 6c69 6620 2865           elif (e
+00050120: 2e74 7970 6520 3d3d 2027 6465 6c65 7469  .type == 'deleti
+00050130: 6f6e 2729 207c 2028 652e 7479 7065 203d  on') | (e.type =
+00050140: 3d20 2744 2729 3a0a 2020 2020 2020 2020  = 'D'):.        
+00050150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050160: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
+00050170: 2020 2020 2020 2020 2065 6c69 6620 2865           elif (e
+00050180: 2e74 7970 6520 3d3d 2027 696e 7365 7273  .type == 'insers
+00050190: 696f 6e27 2920 7c20 2865 2e74 7970 6520  ion') | (e.type 
+000501a0: 3d3d 2027 4927 293a 0a20 2020 2020 2020  == 'I'):.       
 000501b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000501c0: 2020 2073 635b 695d 203d 206f 7267 5f73     sc[i] = org_s
-000501d0: 6571 5b69 5d0a 2020 2020 2020 2020 2020  eq[i].          
-000501e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000501f0: 2020 2020 2020 7365 7120 3d20 7365 7120        seq = seq 
-00050200: 2b20 2727 2e6a 6f69 6e28 7363 290a 2020  + ''.join(sc).  
-00050210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050220: 2020 656c 6966 2028 652e 7479 7065 203d    elif (e.type =
-00050230: 3d20 2764 656c 6574 696f 6e27 2920 7c20  = 'deletion') | 
-00050240: 2865 2e74 7970 6520 3d3d 2027 4427 293a  (e.type == 'D'):
-00050250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050260: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00050270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050280: 2020 656c 6966 2028 652e 7479 7065 203d    elif (e.type =
-00050290: 3d20 2769 6e73 6572 7369 6f6e 2729 207c  = 'insersion') |
-000502a0: 2028 652e 7479 7065 203d 3d20 2749 2729   (e.type == 'I')
-000502b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000502c0: 2020 2020 2020 2020 2020 7365 7120 3d20            seq = 
-000502d0: 7365 7120 2b20 652e 7365 7120 2320 6765  seq + e.seq # ge
-000502e0: 745f 7365 7128 290a 2020 2020 2020 2020  t_seq().        
-000502f0: 2020 2020 2020 2020 6966 2073 656c 203d          if sel =
-00050300: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00050310: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00050320: 7365 7129 203e 2030 3a0a 2020 2020 2020  seq) > 0:.      
-00050330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050340: 2020 7365 6c66 2e63 6f76 203d 2073 656c    self.cov = sel
-00050350: 662e 636f 765f 6c65 6e2f 6c65 6e28 7365  f.cov_len/len(se
-00050360: 7129 0a20 2020 2020 2020 2020 2020 2065  q).            e
-00050370: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00050380: 2020 2020 2066 6f72 206b 2c20 6d20 696e       for k, m in
-00050390: 2065 6e75 6d65 7261 7465 2874 676d 293a   enumerate(tgm):
-000503a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000503b0: 2020 2020 2065 203d 2072 676e 735b 6d5d       e = rgns[m]
-000503c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000503d0: 2020 2020 206c 6f66 2e61 6464 2820 652e       lof.add( e.
-000503e0: 7374 6172 742c 2065 2e65 6e64 2c20 6c65  start, e.end, le
-000503f0: 6e28 7365 7129 290a 2020 2020 2020 2020  n(seq)).        
-00050400: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00050410: 2e74 7970 6520 3d3d 2027 6578 6f6e 273a  .type == 'exon':
-00050420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050430: 2020 2020 2020 2020 2063 6872 6d20 3d20           chrm = 
-00050440: 652e 6368 720a 2020 2020 2020 2020 2020  e.chr.          
-00050450: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00050460: 6172 7420 3d20 652e 7374 6172 7420 2d31  art = e.start -1
-00050470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050480: 2020 2020 2020 2020 2065 6e64 203d 2065           end = e
-00050490: 2e65 6e64 0a20 2020 2020 2020 2020 2020  .end.           
-000504a0: 2020 2020 2020 2020 2020 2020 2073 6571               seq
-000504b0: 203d 2067 656e 6f6d 655b 6368 726d 5d2e   = genome[chrm].
-000504c0: 7365 715b 7374 6172 743a 656e 645d 0a0a  seq[start:end]..
-000504d0: 2020 2020 2020 2020 7365 6c66 2e6c 6f66          self.lof
-000504e0: 203d 206c 6f66 0a20 2020 2020 2020 2073   = lof.        s
-000504f0: 656c 662e 7473 6571 203d 2073 6571 0a0a  elf.tseq = seq..
-00050500: 2020 2020 2020 2020 2320 6669 6e64 2070          # find p
-00050510: 6570 7469 6465 2073 6571 2e0a 2020 2020  eptide seq..    
-00050520: 2020 2020 6265 203d 2046 616c 7365 0a20      be = False. 
-00050530: 2020 2020 2020 2069 6620 2870 6570 7469         if (pepti
-00050540: 6465 293a 2023 2026 200a 2020 2020 2020  de): # & .      
-00050550: 2020 2020 2020 6966 2028 7365 6c66 2e69        if (self.i
-00050560: 6364 7320 3e20 3029 207c 2028 2873 656c  cds > 0) | ((sel
-00050570: 662e 6963 6473 203c 2030 2920 2620 2847  f.icds < 0) & (G
-00050580: 454e 5f41 4153 5f55 4e53 5045 4329 293a  EN_AAS_UNSPEC)):
-00050590: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-000505a0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-000505b0: 7472 6965 7320 3d20 7265 6769 6f6e 7328  tries = regions(
-000505c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000505d0: 2020 6966 2028 6c65 6e28 6364 735f 7267    if (len(cds_rg
-000505e0: 6e73 2920 3e20 3029 2026 2028 6c65 6e28  ns) > 0) & (len(
-000505f0: 7365 6c66 2e74 635f 746f 5f67 635f 6d61  self.tc_to_gc_ma
-00050600: 7029 203e 2030 293a 0a20 2020 2020 2020  p) > 0):.       
-00050610: 2020 2020 2020 2020 2020 2020 2074 676d               tgm
-00050620: 203d 2073 656c 662e 7463 5f74 6f5f 6763   = self.tc_to_gc
-00050630: 5f6d 6170 0a20 2020 2020 2020 2020 2020  _map.           
-00050640: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
-00050650: 6e20 7467 6d3a 0a20 2020 2020 2020 2020  n tgm:.         
-00050660: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00050670: 203d 2063 6473 5f72 676e 735b 6d5d 0a20   = cds_rgns[m]. 
-00050680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050690: 2020 2020 2020 2072 203d 2072 6567 696f         r = regio
-000506a0: 6e28 652e 6368 722c 2065 2e73 7461 7274  n(e.chr, e.start
-000506b0: 2c20 652e 656e 642c 2065 2e74 7970 652c  , e.end, e.type,
-000506c0: 2078 7320 3d20 2d31 290a 2020 2020 2020   xs = -1).      
-000506d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000506e0: 2020 656e 7472 6965 732e 7267 6e73 2e61    entries.rgns.a
-000506f0: 7070 656e 6428 2072 2029 0a0a 2020 2020  ppend( r )..    
-00050700: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00050710: 656c 662e 6973 7472 616e 6420 3d3d 2030  elf.istrand == 0
-00050720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00050730: 2020 2020 2020 6173 6571 312c 2070 7365        aseq1, pse
-00050740: 7131 2c20 6364 7331 2c20 6173 7431 2c20  q1, cds1, ast1, 
-00050750: 6173 7031 2c20 7374 7331 2c20 7370 7331  asp1, sts1, sps1
-00050760: 2c20 6265 3120 3d20 7365 6c66 2e67 6574  , be1 = self.get
-00050770: 5f63 6f64 696e 675f 7365 7128 7365 712c  _coding_seq(seq,
-00050780: 206c 6f66 2c20 656e 7472 6965 732e 7267   lof, entries.rg
-00050790: 6e73 2c20 312c 2073 656c 662e 6963 6473  ns, 1, self.icds
-000507a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000507b0: 2020 2020 2020 6173 6571 322c 2070 7365        aseq2, pse
-000507c0: 7132 2c20 6364 7332 2c20 6173 7432 2c20  q2, cds2, ast2, 
-000507d0: 6173 7032 2c20 7374 7332 2c20 7370 7332  asp2, sts2, sps2
-000507e0: 2c20 6265 3220 3d20 7365 6c66 2e67 6574  , be2 = self.get
-000507f0: 5f63 6f64 696e 675f 7365 7128 7365 712c  _coding_seq(seq,
-00050800: 206c 6f66 2c20 656e 7472 6965 732e 7267   lof, entries.rg
-00050810: 6e73 2c20 2d31 2c20 7365 6c66 2e69 6364  ns, -1, self.icd
-00050820: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00050830: 2020 2020 2020 2069 6620 6c65 6e28 6173         if len(as
-00050840: 6571 3129 203e 206c 656e 2861 7365 7132  eq1) > len(aseq2
-00050850: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00050860: 2020 2020 2020 2020 2020 2061 7365 7120             aseq 
-00050870: 3d20 6173 6571 310a 2020 2020 2020 2020  = aseq1.        
-00050880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050890: 7073 6571 203d 2070 7365 7131 0a20 2020  pseq = pseq1.   
-000508a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000508b0: 2020 2020 2063 6473 203d 2063 6473 310a       cds = cds1.
-000508c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000508d0: 2020 2020 2020 2020 6173 7420 3d20 6173          ast = as
-000508e0: 7431 0a20 2020 2020 2020 2020 2020 2020  t1.             
-000508f0: 2020 2020 2020 2020 2020 2061 7370 203d             asp =
-00050900: 2061 7370 310a 2020 2020 2020 2020 2020   asp1.          
-00050910: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00050920: 7320 3d20 7374 7331 0a20 2020 2020 2020  s = sts1.       
-00050930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050940: 2073 7073 203d 2073 7073 310a 2020 2020   sps = sps1.    
-00050950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050960: 2020 2020 7365 6c66 2e69 7374 7261 6e64      self.istrand
-00050970: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
-00050980: 2020 2020 2020 2020 2020 2020 2062 6520               be 
-00050990: 3d20 6265 310a 2020 2020 2020 2020 2020  = be1.          
-000509a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000509b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000509c0: 2020 2020 2020 2020 6173 6571 203d 2061          aseq = a
-000509d0: 7365 7132 0a20 2020 2020 2020 2020 2020  seq2.           
-000509e0: 2020 2020 2020 2020 2020 2020 2070 7365               pse
-000509f0: 7120 3d20 7073 6571 320a 2020 2020 2020  q = pseq2.      
-00050a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a10: 2020 6364 7320 3d20 6364 7332 0a20 2020    cds = cds2.   
-00050a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a30: 2020 2020 2061 7374 203d 2061 7374 320a       ast = ast2.
-00050a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a50: 2020 2020 2020 2020 6173 7020 3d20 6173          asp = as
-00050a60: 7032 0a20 2020 2020 2020 2020 2020 2020  p2.             
-00050a70: 2020 2020 2020 2020 2020 2073 7473 203d             sts =
-00050a80: 2073 7473 320a 2020 2020 2020 2020 2020   sts2.          
-00050a90: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00050aa0: 7320 3d20 7370 7332 0a20 2020 2020 2020  s = sps2.       
-00050ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050ac0: 2073 656c 662e 6973 7472 616e 6420 3d20   self.istrand = 
-00050ad0: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-00050ae0: 2020 2020 2020 2020 2020 2062 6520 3d20             be = 
-00050af0: 6265 320a 2020 2020 2020 2020 2020 2020  be2.            
-00050b00: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00050b10: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00050b20: 6571 2c20 7073 6571 2c20 6364 732c 2061  eq, pseq, cds, a
-00050b30: 7374 2c20 6173 702c 2073 7473 2c20 7370  st, asp, sts, sp
-00050b40: 732c 2062 6520 3d20 7365 6c66 2e67 6574  s, be = self.get
-00050b50: 5f63 6f64 696e 675f 7365 7128 7365 712c  _coding_seq(seq,
-00050b60: 206c 6f66 2c20 656e 7472 6965 732e 7267   lof, entries.rg
-00050b70: 6e73 2c20 7365 6c66 2e69 7374 7261 6e64  ns, self.istrand
-00050b80: 2c20 7365 6c66 2e69 6364 7329 0a20 2020  , self.icds).   
-00050b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050ba0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00050bb0: 2020 7365 6c66 2e70 7365 7120 3d20 7073    self.pseq = ps
-00050bc0: 6571 0a20 2020 2020 2020 2020 2020 2020  eq.             
-00050bd0: 2020 2073 656c 662e 6173 6571 203d 2061     self.aseq = a
-00050be0: 7365 710a 2020 2020 2020 2020 2020 2020  seq.            
-00050bf0: 2020 2020 6966 2061 7374 203e 3d20 303a      if ast >= 0:
-00050c00: 2073 656c 662e 7374 6172 745f 636f 646f   self.start_codo
-00050c10: 6e5f 706f 7320 3d20 2861 7374 2c20 6173  n_pos = (ast, as
-00050c20: 742b 3229 0a20 2020 2020 2020 2020 2020  t+2).           
-00050c30: 2020 2020 2069 6620 6173 7020 3e3d 2030       if asp >= 0
-00050c40: 3a20 7365 6c66 2e73 746f 705f 636f 646f  : self.stop_codo
-00050c50: 6e5f 706f 7320 3d20 2861 7370 2c20 6173  n_pos = (asp, as
-00050c60: 702b 3229 0a20 2020 2020 2020 2020 2020  p+2).           
-00050c70: 2020 2020 2073 656c 662e 7374 6172 745f       self.start_
-00050c80: 636f 646f 6e5f 7374 6174 7573 203d 2073  codon_status = s
-00050c90: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-00050ca0: 2020 2073 656c 662e 7374 6f70 5f63 6f64     self.stop_cod
-00050cb0: 6f6e 5f73 7461 7475 7320 3d20 7370 730a  on_status = sps.
-00050cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050cd0: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
-00050ce0: 7572 6e20 7365 712c 2061 7365 712c 2063  urn seq, aseq, c
-00050cf0: 6473 2c20 6265 0a0a 0a20 2020 2027 2727  ds, be...    '''
-00050d00: 0a20 2020 2043 4f44 4f4e 5f4e 4f54 5f53  .    CODON_NOT_S
-00050d10: 5045 4349 4649 4544 203d 202d 310a 2020  PECIFIED = -1.  
-00050d20: 2020 434f 444f 4e5f 5641 4c49 4420 3d20    CODON_VALID = 
-00050d30: 300a 2020 2020 434f 444f 4e5f 4e4f 545f  0.    CODON_NOT_
-00050d40: 434f 5645 5245 4420 3d20 310a 2020 2020  COVERED = 1.    
-00050d50: 434f 444f 4e5f 5749 5448 5f56 4152 4941  CODON_WITH_VARIA
-00050d60: 4e54 203d 2032 0a20 2020 2043 4f44 4f4e  NT = 2.    CODON
-00050d70: 5f57 4954 485f 494e 4445 4c20 3d20 330a  _WITH_INDEL = 3.
-00050d80: 2020 2020 434f 444f 4e5f 5245 4c4f 4341      CODON_RELOCA
-00050d90: 5445 4420 3d20 340a 2020 2020 434f 444f  TED = 4.    CODO
-00050da0: 4e5f 4e4f 545f 4944 454e 5449 4649 4544  N_NOT_IDENTIFIED
-00050db0: 203d 2035 0a20 2020 2043 4f44 4f4e 5f50   = 5.    CODON_P
-00050dc0: 4f53 5f45 5354 494d 4154 4544 203d 2036  OS_ESTIMATED = 6
-00050dd0: 0a20 2020 2027 2727 0a0a 2020 2020 6465  .    '''..    de
-00050de0: 6620 6765 745f 636f 6469 6e67 5f73 6571  f get_coding_seq
-00050df0: 2873 656c 662c 2073 6571 2c20 6c6f 662c  (self, seq, lof,
-00050e00: 2063 6473 5f72 676e 732c 2069 7374 7261   cds_rgns, istra
-00050e10: 6e64 2c20 6963 6473 293a 0a20 2020 2020  nd, icds):.     
-00050e20: 2020 200a 2020 2020 2020 2020 6173 6571     .        aseq
-00050e30: 203d 2027 270a 2020 2020 2020 2020 7374   = ''.        st
-00050e40: 6172 745f 636f 646f 6e5f 706f 735f 6f72  art_codon_pos_or
-00050e50: 6720 3d20 2d31 0a20 2020 2020 2020 2073  g = -1.        s
-00050e60: 746f 705f 636f 646f 6e5f 706f 735f 6f72  top_codon_pos_or
-00050e70: 6720 3d20 2d31 0a20 2020 2020 2020 2073  g = -1.        s
-00050e80: 7461 7274 5f63 6f64 6f6e 5f70 6f73 203d  tart_codon_pos =
-00050e90: 202d 310a 2020 2020 2020 2020 7374 6f70   -1.        stop
-00050ea0: 5f63 6f64 6f6e 5f70 6f73 203d 202d 310a  _codon_pos = -1.
-00050eb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00050ec0: 2073 7461 7274 5f63 6f64 6f6e 5f73 7461   start_codon_sta
-00050ed0: 7475 7320 3d20 2d31 0a20 2020 2020 2020  tus = -1.       
-00050ee0: 2073 746f 705f 636f 646f 6e5f 7374 6174   stop_codon_stat
-00050ef0: 7573 203d 202d 310a 2020 2020 2020 2020  us = -1.        
-00050f00: 6162 735f 7374 6172 7420 3d20 2d31 0a20  abs_start = -1. 
-00050f10: 2020 2020 2020 2061 6273 5f73 746f 7020         abs_stop 
-00050f20: 3d20 2d31 0a20 2020 2020 2020 200a 2020  = -1.        .  
-00050f30: 2020 2020 2020 2320 6973 7472 616e 6420        # istrand 
-00050f40: 3d20 7365 6c66 2e69 7374 7261 6e64 0a0a  = self.istrand..
-00050f50: 2020 2020 2020 2020 2323 2063 6865 636b          ## check
-00050f60: 2073 7461 7274 2f73 746f 7020 636f 646f   start/stop codo
-00050f70: 6e20 6176 6169 6c61 626c 650a 2020 2020  n available.    
-00050f80: 2020 2020 6966 2028 6c65 6e28 6364 735f      if (len(cds_
-00050f90: 7267 6e73 2920 3e20 3029 2026 2028 6c65  rgns) > 0) & (le
-00050fa0: 6e28 7365 6c66 2e74 635f 746f 5f67 635f  n(self.tc_to_gc_
-00050fb0: 6d61 7029 203e 2030 293a 0a20 2020 2020  map) > 0):.     
-00050fc0: 2020 2020 2020 2066 6f72 206d 2c20 6320         for m, c 
-00050fd0: 696e 2065 6e75 6d65 7261 7465 2863 6473  in enumerate(cds
-00050fe0: 5f72 676e 7329 3a0a 2020 2020 2020 2020  _rgns):.        
-00050ff0: 2020 2020 2020 2020 6966 2063 2e74 7970          if c.typ
-00051000: 652e 6c6f 7765 7228 2920 3d3d 2027 7374  e.lower() == 'st
-00051010: 6172 745f 636f 646f 6e27 3a0a 2020 2020  art_codon':.    
-00051020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051030: 7374 6172 745f 636f 646f 6e5f 706f 7320  start_codon_pos 
-00051040: 3d20 6c6f 662e 7265 6c5f 706f 7328 632e  = lof.rel_pos(c.
-00051050: 7374 6172 7429 0a20 2020 2020 2020 2020  start).         
-00051060: 2020 2020 2020 2020 2020 2069 6620 2869             if (i
-00051070: 7374 7261 6e64 203c 2030 2920 2620 2873  strand < 0) & (s
-00051080: 7461 7274 5f63 6f64 6f6e 5f70 6f73 203e  tart_codon_pos >
-00051090: 3d20 3029 3a0a 2020 2020 2020 2020 2020  = 0):.          
-000510a0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-000510b0: 6172 745f 636f 646f 6e5f 706f 7320 3d20  art_codon_pos = 
-000510c0: 6c65 6e28 7365 7129 202d 2028 7374 6172  len(seq) - (star
-000510d0: 745f 636f 646f 6e5f 706f 732b 3329 0a20  t_codon_pos+3). 
-000510e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000510f0: 2020 2073 7461 7274 5f63 6f64 6f6e 5f70     start_codon_p
-00051100: 6f73 5f6f 7267 203d 2073 7461 7274 5f63  os_org = start_c
-00051110: 6f64 6f6e 5f70 6f73 2020 2020 0a20 2020  odon_pos    .   
-00051120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051130: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00051140: 2020 6966 2063 2e74 7970 652e 6c6f 7765    if c.type.lowe
-00051150: 7228 2920 3d3d 2027 7374 6f70 5f63 6f64  r() == 'stop_cod
-00051160: 6f6e 273a 0a20 2020 2020 2020 2020 2020  on':.           
-00051170: 2020 2020 2020 2020 2073 746f 705f 636f           stop_co
-00051180: 646f 6e5f 706f 7320 3d20 6c6f 662e 7265  don_pos = lof.re
-00051190: 6c5f 706f 7328 632e 7374 6172 7429 0a20  l_pos(c.start). 
-000511a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000511b0: 2020 2069 6620 2869 7374 7261 6e64 203c     if (istrand <
-000511c0: 2030 2920 2620 2873 746f 705f 636f 646f   0) & (stop_codo
-000511d0: 6e5f 706f 7320 3e3d 2030 293a 0a20 2020  n_pos >= 0):.   
-000511e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000511f0: 2020 2020 2073 746f 705f 636f 646f 6e5f       stop_codon_
-00051200: 706f 7320 3d20 6c65 6e28 7365 7129 202d  pos = len(seq) -
-00051210: 2028 7374 6f70 5f63 6f64 6f6e 5f70 6f73   (stop_codon_pos
-00051220: 2b33 290a 2020 2020 2020 2020 2020 2020  +3).            
-00051230: 2020 2020 2020 2020 7374 6f70 5f63 6f64          stop_cod
-00051240: 6f6e 5f70 6f73 5f6f 7267 203d 2073 746f  on_pos_org = sto
-00051250: 705f 636f 646f 6e5f 706f 7320 2020 200a  p_codon_pos    .
-00051260: 0a20 2020 2020 2020 2023 2320 6669 6e64  .        ## find
-00051270: 2069 6e69 7469 616c 2063 616e 6469 6461   initial candida
-00051280: 7465 730a 2020 2020 2020 2020 7374 6172  tes.        star
-00051290: 7470 2c20 7374 6f70 702c 2073 735f 6c73  tp, stopp, ss_ls
-000512a0: 7420 3d20 6368 6563 6b5f 6f72 665f 636f  t = check_orf_co
-000512b0: 6e64 6974 696f 6e28 7365 712c 2073 7472  ndition(seq, str
-000512c0: 616e 6420 3d20 6973 7472 616e 6429 0a0a  and = istrand)..
-000512d0: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
-000512e0: 2020 2020 2069 6620 2873 7461 7274 5f63       if (start_c
-000512f0: 6f64 6f6e 5f70 6f73 203c 2030 2920 2620  odon_pos < 0) & 
-00051300: 2873 746f 705f 636f 646f 6e5f 706f 7320  (stop_codon_pos 
-00051310: 3c20 3029 3a0a 2020 2020 2020 2020 2020  < 0):.          
-00051320: 2020 7374 6172 745f 636f 646f 6e5f 706f    start_codon_po
-00051330: 7320 3d20 7374 6172 7470 0a20 2020 2020  s = startp.     
-00051340: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
-00051350: 6e5f 706f 7320 3d20 7374 6f70 700a 2020  n_pos = stopp.  
-00051360: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00051370: 2020 2020 2020 2069 6620 6963 6473 203e         if icds >
-00051380: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00051390: 2020 2020 6966 2073 7461 7274 5f63 6f64      if start_cod
-000513a0: 6f6e 5f70 6f73 203e 3d20 303a 200a 2020  on_pos >= 0: .  
-000513b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000513c0: 2020 7374 6172 745f 636f 646f 6e5f 7374    start_codon_st
-000513d0: 6174 7573 203d 2043 4f44 4f4e 5f52 454c  atus = CODON_REL
-000513e0: 4f43 4154 4544 0a20 2020 2020 2020 2020  OCATED.         
-000513f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000501c0: 2073 6571 203d 2073 6571 202b 2065 2e73   seq = seq + e.s
+000501d0: 6571 2023 2067 6574 5f73 6571 2829 0a20  eq # get_seq(). 
+000501e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000501f0: 6620 7365 6c20 3d3d 2030 3a0a 2020 2020  f sel == 0:.    
+00050200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050210: 6966 206c 656e 2873 6571 2920 3e20 303a  if len(seq) > 0:
+00050220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050230: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00050240: 7620 3d20 7365 6c66 2e63 6f76 5f6c 656e  v = self.cov_len
+00050250: 2f6c 656e 2873 6571 290a 2020 2020 2020  /len(seq).      
+00050260: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00050270: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00050280: 6b2c 206d 2069 6e20 656e 756d 6572 6174  k, m in enumerat
+00050290: 6528 7467 6d29 3a0a 2020 2020 2020 2020  e(tgm):.        
+000502a0: 2020 2020 2020 2020 2020 2020 6520 3d20              e = 
+000502b0: 7267 6e73 5b6d 5d0a 2020 2020 2020 2020  rgns[m].        
+000502c0: 2020 2020 2020 2020 2020 2020 6c6f 662e              lof.
+000502d0: 6164 6428 2065 2e73 7461 7274 2c20 652e  add( e.start, e.
+000502e0: 656e 642c 206c 656e 2873 6571 2929 0a20  end, len(seq)). 
+000502f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050300: 2020 2069 6620 652e 7479 7065 203d 3d20     if e.type == 
+00050310: 2765 786f 6e27 3a0a 2020 2020 2020 2020  'exon':.        
+00050320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050330: 6368 726d 203d 2065 2e63 6872 0a20 2020  chrm = e.chr.   
+00050340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050350: 2020 2020 2073 7461 7274 203d 2065 2e73       start = e.s
+00050360: 7461 7274 202d 310a 2020 2020 2020 2020  tart -1.        
+00050370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050380: 656e 6420 3d20 652e 656e 640a 2020 2020  end = e.end.    
+00050390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000503a0: 2020 2020 7365 7120 3d20 6765 6e6f 6d65      seq = genome
+000503b0: 5b63 6872 6d5d 2e73 6571 5b73 7461 7274  [chrm].seq[start
+000503c0: 3a65 6e64 5d0a 0a20 2020 2020 2020 2073  :end]..        s
+000503d0: 656c 662e 6c6f 6620 3d20 6c6f 660a 2020  elf.lof = lof.  
+000503e0: 2020 2020 2020 7365 6c66 2e74 7365 7120        self.tseq 
+000503f0: 3d20 7365 710a 0a20 2020 2020 2020 2023  = seq..        #
+00050400: 2066 696e 6420 7065 7074 6964 6520 7365   find peptide se
+00050410: 712e 0a20 2020 2020 2020 2062 6520 3d20  q..        be = 
+00050420: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+00050430: 2028 7065 7074 6964 6529 3a20 2320 2620   (peptide): # & 
+00050440: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00050450: 2873 656c 662e 6963 6473 203e 2030 2920  (self.icds > 0) 
+00050460: 7c20 2828 7365 6c66 2e69 6364 7320 3c20  | ((self.icds < 
+00050470: 3029 2026 2028 4745 4e5f 4141 535f 554e  0) & (GEN_AAS_UN
+00050480: 5350 4543 2929 3a0a 2020 2020 2020 2020  SPEC)):.        
+00050490: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+000504a0: 2020 2020 2065 6e74 7269 6573 203d 2072       entries = r
+000504b0: 6567 696f 6e73 2829 0a20 2020 2020 2020  egions().       
+000504c0: 2020 2020 2020 2020 2069 6620 286c 656e           if (len
+000504d0: 2863 6473 5f72 676e 7329 203e 2030 2920  (cds_rgns) > 0) 
+000504e0: 2620 286c 656e 2873 656c 662e 7463 5f74  & (len(self.tc_t
+000504f0: 6f5f 6763 5f6d 6170 2920 3e20 3029 3a0a  o_gc_map) > 0):.
+00050500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050510: 2020 2020 7467 6d20 3d20 7365 6c66 2e74      tgm = self.t
+00050520: 635f 746f 5f67 635f 6d61 700a 2020 2020  c_to_gc_map.    
+00050530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050540: 666f 7220 6d20 696e 2074 676d 3a0a 2020  for m in tgm:.  
+00050550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050560: 2020 2020 2020 6520 3d20 6364 735f 7267        e = cds_rg
+00050570: 6e73 5b6d 5d0a 2020 2020 2020 2020 2020  ns[m].          
+00050580: 2020 2020 2020 2020 2020 2020 2020 7220                r 
+00050590: 3d20 7265 6769 6f6e 2865 2e63 6872 2c20  = region(e.chr, 
+000505a0: 652e 7374 6172 742c 2065 2e65 6e64 2c20  e.start, e.end, 
+000505b0: 652e 7479 7065 2c20 7873 203d 202d 3129  e.type, xs = -1)
+000505c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000505d0: 2020 2020 2020 2020 2065 6e74 7269 6573           entries
+000505e0: 2e72 676e 732e 6170 7065 6e64 2820 7220  .rgns.append( r 
+000505f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00050600: 2020 2069 6620 7365 6c66 2e69 7374 7261     if self.istra
+00050610: 6e64 203d 3d20 303a 0a20 2020 2020 2020  nd == 0:.       
+00050620: 2020 2020 2020 2020 2020 2020 2061 7365               ase
+00050630: 7131 2c20 7073 6571 312c 2063 6473 312c  q1, pseq1, cds1,
+00050640: 2061 7374 312c 2061 7370 312c 2073 7473   ast1, asp1, sts
+00050650: 312c 2073 7073 312c 2062 6531 203d 2073  1, sps1, be1 = s
+00050660: 656c 662e 6765 745f 636f 6469 6e67 5f73  elf.get_coding_s
+00050670: 6571 2873 6571 2c20 6c6f 662c 2065 6e74  eq(seq, lof, ent
+00050680: 7269 6573 2e72 676e 732c 2031 2c20 7365  ries.rgns, 1, se
+00050690: 6c66 2e69 6364 7329 0a20 2020 2020 2020  lf.icds).       
+000506a0: 2020 2020 2020 2020 2020 2020 2061 7365               ase
+000506b0: 7132 2c20 7073 6571 322c 2063 6473 322c  q2, pseq2, cds2,
+000506c0: 2061 7374 322c 2061 7370 322c 2073 7473   ast2, asp2, sts
+000506d0: 322c 2073 7073 322c 2062 6532 203d 2073  2, sps2, be2 = s
+000506e0: 656c 662e 6765 745f 636f 6469 6e67 5f73  elf.get_coding_s
+000506f0: 6571 2873 6571 2c20 6c6f 662c 2065 6e74  eq(seq, lof, ent
+00050700: 7269 6573 2e72 676e 732c 202d 312c 2073  ries.rgns, -1, s
+00050710: 656c 662e 6963 6473 290a 2020 2020 2020  elf.icds).      
+00050720: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00050730: 206c 656e 2861 7365 7131 2920 3e20 6c65   len(aseq1) > le
+00050740: 6e28 6173 6571 3229 3a0a 2020 2020 2020  n(aseq2):.      
+00050750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050760: 2020 6173 6571 203d 2061 7365 7131 0a20    aseq = aseq1. 
+00050770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050780: 2020 2020 2020 2070 7365 7120 3d20 7073         pseq = ps
+00050790: 6571 310a 2020 2020 2020 2020 2020 2020  eq1.            
+000507a0: 2020 2020 2020 2020 2020 2020 6364 7320              cds 
+000507b0: 3d20 6364 7331 0a20 2020 2020 2020 2020  = cds1.         
+000507c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000507d0: 7374 203d 2061 7374 310a 2020 2020 2020  st = ast1.      
+000507e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000507f0: 2020 6173 7020 3d20 6173 7031 0a20 2020    asp = asp1.   
+00050800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050810: 2020 2020 2073 7473 203d 2073 7473 310a       sts = sts1.
+00050820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050830: 2020 2020 2020 2020 7370 7320 3d20 7370          sps = sp
+00050840: 7331 0a20 2020 2020 2020 2020 2020 2020  s1.             
+00050850: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00050860: 6973 7472 616e 6420 3d20 310a 2020 2020  istrand = 1.    
+00050870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050880: 2020 2020 6265 203d 2062 6531 0a20 2020      be = be1.   
+00050890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000508a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000508b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000508c0: 7365 7120 3d20 6173 6571 320a 2020 2020  seq = aseq2.    
+000508d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000508e0: 2020 2020 7073 6571 203d 2070 7365 7132      pseq = pseq2
+000508f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050900: 2020 2020 2020 2020 2063 6473 203d 2063           cds = c
+00050910: 6473 320a 2020 2020 2020 2020 2020 2020  ds2.            
+00050920: 2020 2020 2020 2020 2020 2020 6173 7420              ast 
+00050930: 3d20 6173 7432 0a20 2020 2020 2020 2020  = ast2.         
+00050940: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00050950: 7370 203d 2061 7370 320a 2020 2020 2020  sp = asp2.      
+00050960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050970: 2020 7374 7320 3d20 7374 7332 0a20 2020    sts = sts2.   
+00050980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050990: 2020 2020 2073 7073 203d 2073 7073 320a       sps = sps2.
+000509a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000509b0: 2020 2020 2020 2020 7365 6c66 2e69 7374          self.ist
+000509c0: 7261 6e64 203d 202d 310a 2020 2020 2020  rand = -1.      
+000509d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000509e0: 2020 6265 203d 2062 6532 0a20 2020 2020    be = be2.     
+000509f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00050a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050a10: 2020 2020 2061 7365 712c 2070 7365 712c       aseq, pseq,
+00050a20: 2063 6473 2c20 6173 742c 2061 7370 2c20   cds, ast, asp, 
+00050a30: 7374 732c 2073 7073 2c20 6265 203d 2073  sts, sps, be = s
+00050a40: 656c 662e 6765 745f 636f 6469 6e67 5f73  elf.get_coding_s
+00050a50: 6571 2873 6571 2c20 6c6f 662c 2065 6e74  eq(seq, lof, ent
+00050a60: 7269 6573 2e72 676e 732c 2073 656c 662e  ries.rgns, self.
+00050a70: 6973 7472 616e 642c 2073 656c 662e 6963  istrand, self.ic
+00050a80: 6473 290a 2020 2020 2020 2020 2020 2020  ds).            
+00050a90: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00050aa0: 2020 2020 2020 2020 2073 656c 662e 7073           self.ps
+00050ab0: 6571 203d 2070 7365 710a 2020 2020 2020  eq = pseq.      
+00050ac0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00050ad0: 7365 7120 3d20 6173 6571 0a20 2020 2020  seq = aseq.     
+00050ae0: 2020 2020 2020 2020 2020 2069 6620 6173             if as
+00050af0: 7420 3e3d 2030 3a20 7365 6c66 2e73 7461  t >= 0: self.sta
+00050b00: 7274 5f63 6f64 6f6e 5f70 6f73 203d 2028  rt_codon_pos = (
+00050b10: 6173 742c 2061 7374 2b32 290a 2020 2020  ast, ast+2).    
+00050b20: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00050b30: 7370 203e 3d20 303a 2073 656c 662e 7374  sp >= 0: self.st
+00050b40: 6f70 5f63 6f64 6f6e 5f70 6f73 203d 2028  op_codon_pos = (
+00050b50: 6173 702c 2061 7370 2b32 290a 2020 2020  asp, asp+2).    
+00050b60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00050b70: 2e73 7461 7274 5f63 6f64 6f6e 5f73 7461  .start_codon_sta
+00050b80: 7475 7320 3d20 7374 730a 2020 2020 2020  tus = sts.      
+00050b90: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00050ba0: 746f 705f 636f 646f 6e5f 7374 6174 7573  top_codon_status
+00050bb0: 203d 2073 7073 0a20 2020 2020 2020 2020   = sps.         
+00050bc0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00050bd0: 2020 2020 7265 7475 726e 2073 6571 2c20      return seq, 
+00050be0: 6173 6571 2c20 6364 732c 2062 650a 0a0a  aseq, cds, be...
+00050bf0: 2020 2020 2727 270a 2020 2020 434f 444f      '''.    CODO
+00050c00: 4e5f 4e4f 545f 5350 4543 4946 4945 4420  N_NOT_SPECIFIED 
+00050c10: 3d20 2d31 0a20 2020 2043 4f44 4f4e 5f56  = -1.    CODON_V
+00050c20: 414c 4944 203d 2030 0a20 2020 2043 4f44  ALID = 0.    COD
+00050c30: 4f4e 5f4e 4f54 5f43 4f56 4552 4544 203d  ON_NOT_COVERED =
+00050c40: 2031 0a20 2020 2043 4f44 4f4e 5f57 4954   1.    CODON_WIT
+00050c50: 485f 5641 5249 414e 5420 3d20 320a 2020  H_VARIANT = 2.  
+00050c60: 2020 434f 444f 4e5f 5749 5448 5f49 4e44    CODON_WITH_IND
+00050c70: 454c 203d 2033 0a20 2020 2043 4f44 4f4e  EL = 3.    CODON
+00050c80: 5f52 454c 4f43 4154 4544 203d 2034 0a20  _RELOCATED = 4. 
+00050c90: 2020 2043 4f44 4f4e 5f4e 4f54 5f49 4445     CODON_NOT_IDE
+00050ca0: 4e54 4946 4945 4420 3d20 350a 2020 2020  NTIFIED = 5.    
+00050cb0: 434f 444f 4e5f 504f 535f 4553 5449 4d41  CODON_POS_ESTIMA
+00050cc0: 5445 4420 3d20 360a 2020 2020 2727 270a  TED = 6.    '''.
+00050cd0: 0a20 2020 2064 6566 2067 6574 5f63 6f64  .    def get_cod
+00050ce0: 696e 675f 7365 7128 7365 6c66 2c20 7365  ing_seq(self, se
+00050cf0: 712c 206c 6f66 2c20 6364 735f 7267 6e73  q, lof, cds_rgns
+00050d00: 2c20 6973 7472 616e 642c 2069 6364 7329  , istrand, icds)
+00050d10: 3a0a 2020 2020 2020 2020 0a20 2020 2020  :.        .     
+00050d20: 2020 2061 7365 7120 3d20 2727 0a20 2020     aseq = ''.   
+00050d30: 2020 2020 2073 7461 7274 5f63 6f64 6f6e       start_codon
+00050d40: 5f70 6f73 5f6f 7267 203d 202d 310a 2020  _pos_org = -1.  
+00050d50: 2020 2020 2020 7374 6f70 5f63 6f64 6f6e        stop_codon
+00050d60: 5f70 6f73 5f6f 7267 203d 202d 310a 2020  _pos_org = -1.  
+00050d70: 2020 2020 2020 7374 6172 745f 636f 646f        start_codo
+00050d80: 6e5f 706f 7320 3d20 2d31 0a20 2020 2020  n_pos = -1.     
+00050d90: 2020 2073 746f 705f 636f 646f 6e5f 706f     stop_codon_po
+00050da0: 7320 3d20 2d31 0a20 2020 2020 2020 200a  s = -1.        .
+00050db0: 2020 2020 2020 2020 7374 6172 745f 636f          start_co
+00050dc0: 646f 6e5f 7374 6174 7573 203d 202d 310a  don_status = -1.
+00050dd0: 2020 2020 2020 2020 7374 6f70 5f63 6f64          stop_cod
+00050de0: 6f6e 5f73 7461 7475 7320 3d20 2d31 0a20  on_status = -1. 
+00050df0: 2020 2020 2020 2061 6273 5f73 7461 7274         abs_start
+00050e00: 203d 202d 310a 2020 2020 2020 2020 6162   = -1.        ab
+00050e10: 735f 7374 6f70 203d 202d 310a 2020 2020  s_stop = -1.    
+00050e20: 2020 2020 0a20 2020 2020 2020 2023 2069      .        # i
+00050e30: 7374 7261 6e64 203d 2073 656c 662e 6973  strand = self.is
+00050e40: 7472 616e 640a 0a20 2020 2020 2020 2023  trand..        #
+00050e50: 2320 6368 6563 6b20 7374 6172 742f 7374  # check start/st
+00050e60: 6f70 2063 6f64 6f6e 2061 7661 696c 6162  op codon availab
+00050e70: 6c65 0a20 2020 2020 2020 2069 6620 286c  le.        if (l
+00050e80: 656e 2863 6473 5f72 676e 7329 203e 2030  en(cds_rgns) > 0
+00050e90: 2920 2620 286c 656e 2873 656c 662e 7463  ) & (len(self.tc
+00050ea0: 5f74 6f5f 6763 5f6d 6170 2920 3e20 3029  _to_gc_map) > 0)
+00050eb0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00050ec0: 7220 6d2c 2063 2069 6e20 656e 756d 6572  r m, c in enumer
+00050ed0: 6174 6528 6364 735f 7267 6e73 293a 0a20  ate(cds_rgns):. 
+00050ee0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00050ef0: 6620 632e 7479 7065 2e6c 6f77 6572 2829  f c.type.lower()
+00050f00: 203d 3d20 2773 7461 7274 5f63 6f64 6f6e   == 'start_codon
+00050f10: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00050f20: 2020 2020 2020 2073 7461 7274 5f63 6f64         start_cod
+00050f30: 6f6e 5f70 6f73 203d 206c 6f66 2e72 656c  on_pos = lof.rel
+00050f40: 5f70 6f73 2863 2e73 7461 7274 290a 2020  _pos(c.start).  
+00050f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050f60: 2020 6966 2028 6973 7472 616e 6420 3c20    if (istrand < 
+00050f70: 3029 2026 2028 7374 6172 745f 636f 646f  0) & (start_codo
+00050f80: 6e5f 706f 7320 3e3d 2030 293a 0a20 2020  n_pos >= 0):.   
+00050f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050fa0: 2020 2020 2073 7461 7274 5f63 6f64 6f6e       start_codon
+00050fb0: 5f70 6f73 203d 206c 656e 2873 6571 2920  _pos = len(seq) 
+00050fc0: 2d20 2873 7461 7274 5f63 6f64 6f6e 5f70  - (start_codon_p
+00050fd0: 6f73 2b33 290a 2020 2020 2020 2020 2020  os+3).          
+00050fe0: 2020 2020 2020 2020 2020 7374 6172 745f            start_
+00050ff0: 636f 646f 6e5f 706f 735f 6f72 6720 3d20  codon_pos_org = 
+00051000: 7374 6172 745f 636f 646f 6e5f 706f 7320  start_codon_pos 
+00051010: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00051020: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00051030: 2020 2020 2020 2020 2069 6620 632e 7479           if c.ty
+00051040: 7065 2e6c 6f77 6572 2829 203d 3d20 2773  pe.lower() == 's
+00051050: 746f 705f 636f 646f 6e27 3a0a 2020 2020  top_codon':.    
+00051060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051070: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 203d  stop_codon_pos =
+00051080: 206c 6f66 2e72 656c 5f70 6f73 2863 2e73   lof.rel_pos(c.s
+00051090: 7461 7274 290a 2020 2020 2020 2020 2020  tart).          
+000510a0: 2020 2020 2020 2020 2020 6966 2028 6973            if (is
+000510b0: 7472 616e 6420 3c20 3029 2026 2028 7374  trand < 0) & (st
+000510c0: 6f70 5f63 6f64 6f6e 5f70 6f73 203e 3d20  op_codon_pos >= 
+000510d0: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+000510e0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+000510f0: 5f63 6f64 6f6e 5f70 6f73 203d 206c 656e  _codon_pos = len
+00051100: 2873 6571 2920 2d20 2873 746f 705f 636f  (seq) - (stop_co
+00051110: 646f 6e5f 706f 732b 3329 0a20 2020 2020  don_pos+3).     
+00051120: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00051130: 746f 705f 636f 646f 6e5f 706f 735f 6f72  top_codon_pos_or
+00051140: 6720 3d20 7374 6f70 5f63 6f64 6f6e 5f70  g = stop_codon_p
+00051150: 6f73 2020 2020 0a0a 2020 2020 2020 2020  os    ..        
+00051160: 2323 2066 696e 6420 696e 6974 6961 6c20  ## find initial 
+00051170: 6361 6e64 6964 6174 6573 0a20 2020 2020  candidates.     
+00051180: 2020 2073 7461 7274 702c 2073 746f 7070     startp, stopp
+00051190: 2c20 7373 5f6c 7374 203d 2063 6865 636b  , ss_lst = check
+000511a0: 5f6f 7266 5f63 6f6e 6469 7469 6f6e 2873  _orf_condition(s
+000511b0: 6571 2c20 7374 7261 6e64 203d 2069 7374  eq, strand = ist
+000511c0: 7261 6e64 290a 0a20 2020 2020 2020 2023  rand)..        #
+000511d0: 2727 270a 2020 2020 2020 2020 6966 2028  '''.        if (
+000511e0: 7374 6172 745f 636f 646f 6e5f 706f 7320  start_codon_pos 
+000511f0: 3c20 3029 2026 2028 7374 6f70 5f63 6f64  < 0) & (stop_cod
+00051200: 6f6e 5f70 6f73 203c 2030 293a 0a20 2020  on_pos < 0):.   
+00051210: 2020 2020 2020 2020 2073 7461 7274 5f63           start_c
+00051220: 6f64 6f6e 5f70 6f73 203d 2073 7461 7274  odon_pos = start
+00051230: 700a 2020 2020 2020 2020 2020 2020 7374  p.            st
+00051240: 6f70 5f63 6f64 6f6e 5f70 6f73 203d 2073  op_codon_pos = s
+00051250: 746f 7070 0a20 2020 2020 2020 2020 2020  topp.           
+00051260: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+00051270: 2069 6364 7320 3e20 303a 0a20 2020 2020   icds > 0:.     
+00051280: 2020 2020 2020 2020 2020 2069 6620 7374             if st
+00051290: 6172 745f 636f 646f 6e5f 706f 7320 3e3d  art_codon_pos >=
+000512a0: 2030 3a20 0a20 2020 2020 2020 2020 2020   0: .           
+000512b0: 2020 2020 2020 2020 2073 7461 7274 5f63           start_c
+000512c0: 6f64 6f6e 5f73 7461 7475 7320 3d20 434f  odon_status = CO
+000512d0: 444f 4e5f 5245 4c4f 4341 5445 440a 2020  DON_RELOCATED.  
+000512e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000512f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00051300: 2020 2020 2020 2020 7374 6172 745f 636f          start_co
+00051310: 646f 6e5f 7374 6174 7573 203d 2043 4f44  don_status = COD
+00051320: 4f4e 5f4e 4f54 5f49 4445 4e54 4946 4945  ON_NOT_IDENTIFIE
+00051330: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+00051340: 2020 6966 2073 746f 705f 636f 646f 6e5f    if stop_codon_
+00051350: 706f 7320 3e3d 2030 3a20 0a20 2020 2020  pos >= 0: .     
+00051360: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00051370: 746f 705f 636f 646f 6e5f 6576 656e 7420  top_codon_event 
+00051380: 3d20 434f 444f 4e5f 5245 4c4f 4341 5445  = CODON_RELOCATE
+00051390: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+000513a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000513b0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+000513c0: 5f63 6f64 6f6e 5f73 7461 7475 7320 3d20  _codon_status = 
+000513d0: 434f 444f 4e5f 4e4f 545f 4944 454e 5449  CODON_NOT_IDENTI
+000513e0: 4649 4544 0a20 2020 2020 2020 2020 2020  FIED.           
+000513f0: 2065 6c69 6620 6963 6473 203c 2030 3a0a   elif icds < 0:.
 00051400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051410: 2073 7461 7274 5f63 6f64 6f6e 5f73 7461   start_codon_sta
-00051420: 7475 7320 3d20 434f 444f 4e5f 4e4f 545f  tus = CODON_NOT_
-00051430: 4944 454e 5449 4649 4544 0a20 2020 2020  IDENTIFIED.     
-00051440: 2020 2020 2020 2020 2020 2069 6620 7374             if st
-00051450: 6f70 5f63 6f64 6f6e 5f70 6f73 203e 3d20  op_codon_pos >= 
-00051460: 303a 200a 2020 2020 2020 2020 2020 2020  0: .            
-00051470: 2020 2020 2020 2020 7374 6f70 5f63 6f64          stop_cod
-00051480: 6f6e 5f65 7665 6e74 203d 2043 4f44 4f4e  on_event = CODON
-00051490: 5f52 454c 4f43 4154 4544 0a20 2020 2020  _RELOCATED.     
-000514a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000514b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000514c0: 2020 2020 2073 746f 705f 636f 646f 6e5f       stop_codon_
-000514d0: 7374 6174 7573 203d 2043 4f44 4f4e 5f4e  status = CODON_N
-000514e0: 4f54 5f49 4445 4e54 4946 4945 440a 2020  OT_IDENTIFIED.  
-000514f0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00051500: 6364 7320 3c20 303a 0a20 2020 2020 2020  cds < 0:.       
-00051510: 2020 2020 2020 2020 2069 6620 7374 6172           if star
-00051520: 745f 636f 646f 6e5f 706f 7320 3e3d 2030  t_codon_pos >= 0
-00051530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00051540: 2020 2020 2020 7374 6172 745f 636f 646f        start_codo
-00051550: 6e5f 7374 6174 7573 203d 2043 4f44 4f4e  n_status = CODON
-00051560: 5f50 4f53 5f45 5354 494d 4154 4544 0a20  _POS_ESTIMATED. 
-00051570: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00051580: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00051590: 2020 2020 2020 2020 2073 7461 7274 5f63           start_c
-000515a0: 6f64 6f6e 5f73 7461 7475 7320 3d20 434f  odon_status = CO
-000515b0: 444f 4e5f 4e4f 545f 4944 454e 5449 4649  DON_NOT_IDENTIFI
-000515c0: 4544 0a20 2020 2020 2020 2020 2020 2020  ED.             
-000515d0: 2020 2069 6620 7374 6f70 5f63 6f64 6f6e     if stop_codon
-000515e0: 5f70 6f73 203e 3d20 303a 200a 2020 2020  _pos >= 0: .    
-000515f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051600: 7374 6f70 5f63 6f64 6f6e 5f73 7461 7475  stop_codon_statu
-00051610: 7320 3d20 434f 444f 4e5f 504f 535f 4553  s = CODON_POS_ES
-00051620: 5449 4d41 5445 440a 2020 2020 2020 2020  TIMATED.        
-00051630: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00051640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051650: 2020 7374 6f70 5f63 6f64 6f6e 5f73 7461    stop_codon_sta
-00051660: 7475 7320 3d20 434f 444f 4e5f 4e4f 545f  tus = CODON_NOT_
-00051670: 4944 454e 5449 4649 4544 0a20 2020 2020  IDENTIFIED.     
-00051680: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00051690: 656c 6966 2028 7374 6172 745f 636f 646f  elif (start_codo
-000516a0: 6e5f 706f 7320 3e3d 2030 2920 2620 2873  n_pos >= 0) & (s
-000516b0: 746f 705f 636f 646f 6e5f 706f 7320 3e3d  top_codon_pos >=
-000516c0: 2030 293a 2023 2026 2028 2873 746f 705f   0): # & ((stop_
-000516d0: 636f 646f 6e5f 706f 732d 7374 6172 745f  codon_pos-start_
-000516e0: 636f 646f 6e5f 706f 7329 2533 203d 3d20  codon_pos)%3 == 
-000516f0: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
-00051700: 2320 7061 7373 0a20 2020 2020 2020 2020  # pass.         
-00051710: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
-00051720: 2020 2020 2323 2063 6865 636b 2069 6620      ## check if 
-00051730: 7468 6579 2061 7265 2073 7469 6c6c 2074  they are still t
-00051740: 6865 7265 0a20 2020 2020 2020 2020 2020  here.           
-00051750: 2062 5f73 7461 7274 203d 202d 310a 2020   b_start = -1.  
-00051760: 2020 2020 2020 2020 2020 625f 7374 6f70            b_stop
-00051770: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
-00051780: 2020 666f 7220 6d2c 2073 7320 696e 2065    for m, ss in e
-00051790: 6e75 6d65 7261 7465 2873 735f 6c73 7429  numerate(ss_lst)
-000517a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000517b0: 2020 6966 2028 7373 5b30 5d20 3e3d 2030    if (ss[0] >= 0
-000517c0: 2920 2620 2873 735b 315d 203e 3d20 3029  ) & (ss[1] >= 0)
-000517d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000517e0: 2020 2020 2020 6966 2073 7461 7274 5f63        if start_c
-000517f0: 6f64 6f6e 5f70 6f73 203e 3d20 303a 0a20  odon_pos >= 0:. 
-00051800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051810: 2020 2020 2020 2069 6620 7373 5b30 5d20         if ss[0] 
-00051820: 3d3d 2073 7461 7274 5f63 6f64 6f6e 5f70  == start_codon_p
-00051830: 6f73 3a0a 2020 2020 2020 2020 2020 2020  os:.            
-00051840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051850: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 203d  stop_codon_pos =
-00051860: 2073 735b 315d 0a20 2020 2020 2020 2020   ss[1].         
-00051870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051880: 2020 2062 5f73 7461 7274 203d 206d 0a20     b_start = m. 
+00051410: 6966 2073 7461 7274 5f63 6f64 6f6e 5f70  if start_codon_p
+00051420: 6f73 203e 3d20 303a 0a20 2020 2020 2020  os >= 0:.       
+00051430: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00051440: 7274 5f63 6f64 6f6e 5f73 7461 7475 7320  rt_codon_status 
+00051450: 3d20 434f 444f 4e5f 504f 535f 4553 5449  = CODON_POS_ESTI
+00051460: 4d41 5445 440a 2020 2020 2020 2020 2020  MATED.          
+00051470: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00051480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051490: 7374 6172 745f 636f 646f 6e5f 7374 6174  start_codon_stat
+000514a0: 7573 203d 2043 4f44 4f4e 5f4e 4f54 5f49  us = CODON_NOT_I
+000514b0: 4445 4e54 4946 4945 440a 2020 2020 2020  DENTIFIED.      
+000514c0: 2020 2020 2020 2020 2020 6966 2073 746f            if sto
+000514d0: 705f 636f 646f 6e5f 706f 7320 3e3d 2030  p_codon_pos >= 0
+000514e0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+000514f0: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
+00051500: 6e5f 7374 6174 7573 203d 2043 4f44 4f4e  n_status = CODON
+00051510: 5f50 4f53 5f45 5354 494d 4154 4544 0a20  _POS_ESTIMATED. 
+00051520: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00051530: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00051540: 2020 2020 2020 2020 2073 746f 705f 636f           stop_co
+00051550: 646f 6e5f 7374 6174 7573 203d 2043 4f44  don_status = COD
+00051560: 4f4e 5f4e 4f54 5f49 4445 4e54 4946 4945  ON_NOT_IDENTIFIE
+00051570: 440a 2020 2020 2020 2020 2020 2020 0a20  D.            . 
+00051580: 2020 2020 2020 2065 6c69 6620 2873 7461         elif (sta
+00051590: 7274 5f63 6f64 6f6e 5f70 6f73 203e 3d20  rt_codon_pos >= 
+000515a0: 3029 2026 2028 7374 6f70 5f63 6f64 6f6e  0) & (stop_codon
+000515b0: 5f70 6f73 203e 3d20 3029 3a20 2320 2620  _pos >= 0): # & 
+000515c0: 2828 7374 6f70 5f63 6f64 6f6e 5f70 6f73  ((stop_codon_pos
+000515d0: 2d73 7461 7274 5f63 6f64 6f6e 5f70 6f73  -start_codon_pos
+000515e0: 2925 3320 3d3d 2030 293a 0a20 2020 2020  )%3 == 0):.     
+000515f0: 2020 2020 2020 2023 2070 6173 730a 2020         # pass.  
+00051600: 2020 2020 2020 2020 2020 2327 2727 0a20            #'''. 
+00051610: 2020 2020 2020 2020 2020 2023 2320 6368             ## ch
+00051620: 6563 6b20 6966 2074 6865 7920 6172 6520  eck if they are 
+00051630: 7374 696c 6c20 7468 6572 650a 2020 2020  still there.    
+00051640: 2020 2020 2020 2020 625f 7374 6172 7420          b_start 
+00051650: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+00051660: 2062 5f73 746f 7020 3d20 2d31 0a20 2020   b_stop = -1.   
+00051670: 2020 2020 2020 2020 2066 6f72 206d 2c20           for m, 
+00051680: 7373 2069 6e20 656e 756d 6572 6174 6528  ss in enumerate(
+00051690: 7373 5f6c 7374 293a 0a20 2020 2020 2020  ss_lst):.       
+000516a0: 2020 2020 2020 2020 2069 6620 2873 735b           if (ss[
+000516b0: 305d 203e 3d20 3029 2026 2028 7373 5b31  0] >= 0) & (ss[1
+000516c0: 5d20 3e3d 2030 293a 0a20 2020 2020 2020  ] >= 0):.       
+000516d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000516e0: 7374 6172 745f 636f 646f 6e5f 706f 7320  start_codon_pos 
+000516f0: 3e3d 2030 3a0a 2020 2020 2020 2020 2020  >= 0:.          
+00051700: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00051710: 2073 735b 305d 203d 3d20 7374 6172 745f   ss[0] == start_
+00051720: 636f 646f 6e5f 706f 733a 0a20 2020 2020  codon_pos:.     
+00051730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051740: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
+00051750: 6e5f 706f 7320 3d20 7373 5b31 5d0a 2020  n_pos = ss[1].  
+00051760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051770: 2020 2020 2020 2020 2020 625f 7374 6172            b_star
+00051780: 7420 3d20 6d0a 2020 2020 2020 2020 2020  t = m.          
+00051790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000517a0: 2020 7374 6172 745f 636f 646f 6e5f 7374    start_codon_st
+000517b0: 6174 7573 203d 2043 4f44 4f4e 5f56 414c  atus = CODON_VAL
+000517c0: 4944 0a20 2020 2020 2020 2020 2020 2020  ID.             
+000517d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000517e0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+000517f0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00051800: 2020 2020 2020 2323 206d 6179 206f 6363        ## may occ
+00051810: 7572 7265 7320 7768 656e 2073 7461 7274  urres when start
+00051820: 2063 6f64 6f6e 2069 7320 6e6f 7420 636f   codon is not co
+00051830: 7665 7265 6420 6f72 2072 656c 6f63 6174  vered or relocat
+00051840: 6564 0a20 2020 2020 2020 2020 2020 2069  ed.            i
+00051850: 6620 625f 7374 6172 7420 3c20 303a 0a20  f b_start < 0:. 
+00051860: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00051870: 6f72 206d 2c20 7373 2069 6e20 656e 756d  or m, ss in enum
+00051880: 6572 6174 6528 7373 5f6c 7374 293a 0a20  erate(ss_lst):. 
 00051890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000518a0: 2020 2020 2020 2020 2020 2073 7461 7274             start
-000518b0: 5f63 6f64 6f6e 5f73 7461 7475 7320 3d20  _codon_status = 
-000518c0: 434f 444f 4e5f 5641 4c49 440a 2020 2020  CODON_VALID.    
-000518d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000518e0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-000518f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051900: 2020 0a20 2020 2020 2020 2020 2020 2023    .            #
-00051910: 2320 6d61 7920 6f63 6375 7272 6573 2077  # may occurres w
-00051920: 6865 6e20 7374 6172 7420 636f 646f 6e20  hen start codon 
-00051930: 6973 206e 6f74 2063 6f76 6572 6564 206f  is not covered o
-00051940: 7220 7265 6c6f 6361 7465 640a 2020 2020  r relocated.    
-00051950: 2020 2020 2020 2020 6966 2062 5f73 7461          if b_sta
-00051960: 7274 203c 2030 3a0a 2020 2020 2020 2020  rt < 0:.        
-00051970: 2020 2020 2020 2020 666f 7220 6d2c 2073          for m, s
-00051980: 7320 696e 2065 6e75 6d65 7261 7465 2873  s in enumerate(s
-00051990: 735f 6c73 7429 3a0a 2020 2020 2020 2020  s_lst):.        
-000519a0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000519b0: 7373 5b30 5d20 3e3d 2030 2920 2620 2873  ss[0] >= 0) & (s
-000519c0: 735b 315d 203e 3d20 3029 3a0a 2020 2020  s[1] >= 0):.    
-000519d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000519e0: 2020 2020 6966 2073 746f 705f 636f 646f      if stop_codo
-000519f0: 6e5f 706f 7320 3e3d 2030 3a0a 2020 2020  n_pos >= 0:.    
-00051a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051a10: 2020 2020 2020 2020 6966 2073 735b 315d          if ss[1]
-00051a20: 203d 3d20 7374 6f70 5f63 6f64 6f6e 5f70   == stop_codon_p
-00051a30: 6f73 3a0a 2020 2020 2020 2020 2020 2020  os:.            
-00051a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051a50: 2020 2020 7374 6172 745f 636f 646f 6e5f      start_codon_
-00051a60: 706f 7320 3d20 7373 5b30 5d0a 2020 2020  pos = ss[0].    
+000518a0: 2020 2069 6620 2873 735b 305d 203e 3d20     if (ss[0] >= 
+000518b0: 3029 2026 2028 7373 5b31 5d20 3e3d 2030  0) & (ss[1] >= 0
+000518c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000518d0: 2020 2020 2020 2020 2020 2069 6620 7374             if st
+000518e0: 6f70 5f63 6f64 6f6e 5f70 6f73 203e 3d20  op_codon_pos >= 
+000518f0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00051900: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00051910: 6620 7373 5b31 5d20 3d3d 2073 746f 705f  f ss[1] == stop_
+00051920: 636f 646f 6e5f 706f 733a 0a20 2020 2020  codon_pos:.     
+00051930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051940: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00051950: 5f63 6f64 6f6e 5f70 6f73 203d 2073 735b  _codon_pos = ss[
+00051960: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+00051970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051980: 2020 2062 5f73 746f 7020 3d20 6d0a 2020     b_stop = m.  
+00051990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000519a0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+000519b0: 2020 2020 2020 2020 2020 2020 2323 206d              ## m
+000519c0: 6179 206f 6363 7572 7265 7320 7768 656e  ay occurres when
+000519d0: 2062 6f74 6820 7374 6172 7420 616e 6420   both start and 
+000519e0: 7374 6f70 2063 6f64 6f6e 2061 7265 206e  stop codon are n
+000519f0: 6f74 2063 6f76 6572 6564 206f 7220 7265  ot covered or re
+00051a00: 6c6f 6361 7465 640a 2020 2020 2020 2020  located.        
+00051a10: 2020 2020 6966 2062 5f73 746f 7020 3c20      if b_stop < 
+00051a20: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00051a30: 2020 2069 6620 2873 7461 7274 7020 3e3d     if (startp >=
+00051a40: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+00051a50: 2020 2020 2020 2020 2069 6620 2873 746f           if (sto
+00051a60: 7070 203e 3d20 3029 3a0a 2020 2020 2020  pp >= 0):.      
 00051a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051a80: 2020 2020 2020 2020 2020 2020 625f 7374              b_st
-00051a90: 6f70 203d 206d 0a20 2020 2020 2020 2020  op = m.         
+00051a80: 2020 7374 6172 745f 636f 646f 6e5f 706f    start_codon_po
+00051a90: 7320 3d20 7374 6172 7470 0a20 2020 2020  s = startp.     
 00051aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051ab0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00051ac0: 2020 2020 2023 2320 6d61 7920 6f63 6375       ## may occu
-00051ad0: 7272 6573 2077 6865 6e20 626f 7468 2073  rres when both s
-00051ae0: 7461 7274 2061 6e64 2073 746f 7020 636f  tart and stop co
-00051af0: 646f 6e20 6172 6520 6e6f 7420 636f 7665  don are not cove
-00051b00: 7265 6420 6f72 2072 656c 6f63 6174 6564  red or relocated
-00051b10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00051b20: 625f 7374 6f70 203c 2030 3a0a 2020 2020  b_stop < 0:.    
-00051b30: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00051b40: 7374 6172 7470 203e 3d20 3029 3a0a 2020  startp >= 0):.  
-00051b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051b60: 2020 6966 2028 7374 6f70 7020 3e3d 2030    if (stopp >= 0
-00051b70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00051b80: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00051b90: 5f63 6f64 6f6e 5f70 6f73 203d 2073 7461  _codon_pos = sta
-00051ba0: 7274 700a 2020 2020 2020 2020 2020 2020  rtp.            
-00051bb0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-00051bc0: 5f63 6f64 6f6e 5f70 6f73 203d 2073 746f  _codon_pos = sto
-00051bd0: 7070 0a20 2020 2020 2020 2020 2020 2020  pp.             
-00051be0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00051bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051c00: 2020 2020 2073 7461 7274 5f63 6f64 6f6e       start_codon
-00051c10: 5f70 6f73 203d 2073 7461 7274 700a 2020  _pos = startp.  
-00051c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051c30: 2020 2020 2020 7374 6f70 5f63 6f64 6f6e        stop_codon
-00051c40: 5f70 6f73 203d 206c 656e 2873 6571 2920  _pos = len(seq) 
-00051c50: 2d20 286c 656e 2873 6571 2920 2d20 7374  - (len(seq) - st
-00051c60: 6172 745f 636f 646f 6e5f 706f 7329 2533  art_codon_pos)%3
-00051c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051c80: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00051c90: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
-00051ca0: 7374 6f70 7020 3e3d 2030 293a 0a20 2020  stopp >= 0):.   
-00051cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051cc0: 2073 7461 7274 5f63 6f64 6f6e 5f70 6f73   start_codon_pos
-00051cd0: 203d 2073 746f 7070 2533 0a20 2020 2020   = stopp%3.     
-00051ce0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00051cf0: 746f 705f 636f 646f 6e5f 706f 7320 3d20  top_codon_pos = 
-00051d00: 7374 6f70 700a 2020 2020 2020 2020 2020  stopp.          
-00051d10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00051d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051d30: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00051d40: 2020 2020 2020 2020 2023 2320 426f 7468           ## Both
-00051d50: 2073 7461 7274 2061 6e64 2073 746f 7020   start and stop 
-00051d60: 636f 646f 6e20 7761 7320 616e 6e6f 7461  codon was annota
-00051d70: 7465 6420 696e 2047 5446 2f47 4646 0a20  ted in GTF/GFF. 
-00051d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051d90: 2020 2023 2320 6275 7420 7468 6579 2064     ## but they d
-00051da0: 6964 6e27 7420 6170 7065 6172 2069 6e20  idn't appear in 
-00051db0: 7468 6520 7265 636f 6e73 7472 7563 7465  the reconstructe
-00051dc0: 6420 7365 7175 656e 6365 0a20 2020 2020  d sequence.     
-00051dd0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00051de0: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
-00051df0: 2020 2020 2020 2070 7269 6e74 2827 4552         print('ER
-00051e00: 524f 523a 2063 616e 6e6f 7420 6669 6e64  ROR: cannot find
-00051e10: 2076 616c 6964 204f 5246 2028 4129 2066   valid ORF (A) f
-00051e20: 6f72 2025 7320 2825 6929 3a20 2569 2c25  or %s (%i): %i,%
-00051e30: 6920 2d20 2569 2c25 6920 2720 2520 5c0a  i - %i,%i ' % \.
-00051e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051e50: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
-00051e60: 2e74 6964 2c20 6973 7472 616e 642c 2062  .tid, istrand, b
-00051e70: 5f73 7461 7274 2c20 7374 6172 745f 636f  _start, start_co
-00051e80: 646f 6e5f 706f 732c 2062 5f73 746f 702c  don_pos, b_stop,
-00051e90: 2073 746f 705f 636f 646f 6e5f 706f 7329   stop_codon_pos)
-00051ea0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00051eb0: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
-00051ec0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00051ed0: 2020 2020 2327 2727 0a20 2020 2020 2020      #'''.       
-00051ee0: 2065 6c73 653a 2023 2320 6569 7468 6572   else: ## either
-00051ef0: 2073 7461 7274 5f63 6f64 6f6e 5f70 6f73   start_codon_pos
-00051f00: 203e 3d20 3020 6f72 2073 746f 705f 636f   >= 0 or stop_co
-00051f10: 646f 6e5f 706f 7320 3e3d 2030 0a20 2020  don_pos >= 0.   
-00051f20: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00051f30: 2020 2020 2020 625f 7374 6172 7420 3d20        b_start = 
-00051f40: 2d31 0a20 2020 2020 2020 2020 2020 2062  -1.            b
-00051f50: 5f73 746f 7020 3d20 2d31 0a20 2020 2020  _stop = -1.     
-00051f60: 2020 2020 2020 2069 6620 2873 7461 7274         if (start
-00051f70: 5f63 6f64 6f6e 5f70 6f73 203e 3d20 3029  _codon_pos >= 0)
-00051f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00051f90: 2020 666f 7220 6d2c 2073 7320 696e 2065    for m, ss in e
-00051fa0: 6e75 6d65 7261 7465 2873 735f 6c73 7429  numerate(ss_lst)
-00051fb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00051fc0: 2020 2020 2020 6966 2028 7373 5b30 5d20        if (ss[0] 
-00051fd0: 3e3d 2030 2920 2620 2873 735b 315d 203e  >= 0) & (ss[1] >
-00051fe0: 3d20 3029 3a0a 2020 2020 2020 2020 2020  = 0):.          
-00051ff0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00052000: 2073 7461 7274 5f63 6f64 6f6e 5f70 6f73   start_codon_pos
-00052010: 203e 3d20 303a 0a20 2020 2020 2020 2020   >= 0:.         
-00052020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052030: 2020 2069 6620 7373 5b30 5d20 3d3d 2073     if ss[0] == s
-00052040: 7461 7274 5f63 6f64 6f6e 5f70 6f73 3a0a  tart_codon_pos:.
-00052050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051ab0: 2020 2073 746f 705f 636f 646f 6e5f 706f     stop_codon_po
+00051ac0: 7320 3d20 7374 6f70 700a 2020 2020 2020  s = stopp.      
+00051ad0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00051ae0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00051af0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00051b00: 745f 636f 646f 6e5f 706f 7320 3d20 7374  t_codon_pos = st
+00051b10: 6172 7470 0a20 2020 2020 2020 2020 2020  artp.           
+00051b20: 2020 2020 2020 2020 2020 2020 2073 746f               sto
+00051b30: 705f 636f 646f 6e5f 706f 7320 3d20 6c65  p_codon_pos = le
+00051b40: 6e28 7365 7129 202d 2028 6c65 6e28 7365  n(seq) - (len(se
+00051b50: 7129 202d 2073 7461 7274 5f63 6f64 6f6e  q) - start_codon
+00051b60: 5f70 6f73 2925 330a 2020 2020 2020 2020  _pos)%3.        
+00051b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051b90: 2065 6c69 6620 2873 746f 7070 203e 3d20   elif (stopp >= 
+00051ba0: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+00051bb0: 2020 2020 2020 2020 7374 6172 745f 636f          start_co
+00051bc0: 646f 6e5f 706f 7320 3d20 7374 6f70 7025  don_pos = stopp%
+00051bd0: 330a 2020 2020 2020 2020 2020 2020 2020  3.              
+00051be0: 2020 2020 2020 7374 6f70 5f63 6f64 6f6e        stop_codon
+00051bf0: 5f70 6f73 203d 2073 746f 7070 0a20 2020  _pos = stopp.   
+00051c00: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00051c10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00051c20: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00051c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051c40: 2323 2042 6f74 6820 7374 6172 7420 616e  ## Both start an
+00051c50: 6420 7374 6f70 2063 6f64 6f6e 2077 6173  d stop codon was
+00051c60: 2061 6e6e 6f74 6174 6564 2069 6e20 4754   annotated in GT
+00051c70: 462f 4746 460a 2020 2020 2020 2020 2020  F/GFF.          
+00051c80: 2020 2020 2020 2020 2020 2323 2062 7574            ## but
+00051c90: 2074 6865 7920 6469 646e 2774 2061 7070   they didn't app
+00051ca0: 6561 7220 696e 2074 6865 2072 6563 6f6e  ear in the recon
+00051cb0: 7374 7275 6374 6564 2073 6571 7565 6e63  structed sequenc
+00051cc0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00051cd0: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+00051ce0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00051cf0: 696e 7428 2745 5252 4f52 3a20 6361 6e6e  int('ERROR: cann
+00051d00: 6f74 2066 696e 6420 7661 6c69 6420 4f52  ot find valid OR
+00051d10: 4620 2841 2920 666f 7220 2573 2028 2569  F (A) for %s (%i
+00051d20: 293a 2025 692c 2569 202d 2025 692c 2569  ): %i,%i - %i,%i
+00051d30: 2027 2025 205c 0a20 2020 2020 2020 2020   ' % \.         
+00051d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051d50: 2020 2873 656c 662e 7469 642c 2069 7374    (self.tid, ist
+00051d60: 7261 6e64 2c20 625f 7374 6172 742c 2073  rand, b_start, s
+00051d70: 7461 7274 5f63 6f64 6f6e 5f70 6f73 2c20  tart_codon_pos, 
+00051d80: 625f 7374 6f70 2c20 7374 6f70 5f63 6f64  b_stop, stop_cod
+00051d90: 6f6e 5f70 6f73 2929 0a20 2020 2020 2020  on_pos)).       
+00051da0: 2020 2020 2020 2020 2020 2020 2023 2727               #''
+00051db0: 270a 2020 2020 2020 2020 2020 2020 0a20  '.            . 
+00051dc0: 2020 2020 2020 2020 2020 2023 2727 270a             #'''.
+00051dd0: 2020 2020 2020 2020 656c 7365 3a20 2323          else: ##
+00051de0: 2065 6974 6865 7220 7374 6172 745f 636f   either start_co
+00051df0: 646f 6e5f 706f 7320 3e3d 2030 206f 7220  don_pos >= 0 or 
+00051e00: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 203e  stop_codon_pos >
+00051e10: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00051e20: 0a20 2020 2020 2020 2020 2020 2062 5f73  .            b_s
+00051e30: 7461 7274 203d 202d 310a 2020 2020 2020  tart = -1.      
+00051e40: 2020 2020 2020 625f 7374 6f70 203d 202d        b_stop = -
+00051e50: 310a 2020 2020 2020 2020 2020 2020 6966  1.            if
+00051e60: 2028 7374 6172 745f 636f 646f 6e5f 706f   (start_codon_po
+00051e70: 7320 3e3d 2030 293a 0a20 2020 2020 2020  s >= 0):.       
+00051e80: 2020 2020 2020 2020 2066 6f72 206d 2c20           for m, 
+00051e90: 7373 2069 6e20 656e 756d 6572 6174 6528  ss in enumerate(
+00051ea0: 7373 5f6c 7374 293a 0a20 2020 2020 2020  ss_lst):.       
+00051eb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00051ec0: 2873 735b 305d 203e 3d20 3029 2026 2028  (ss[0] >= 0) & (
+00051ed0: 7373 5b31 5d20 3e3d 2030 293a 0a20 2020  ss[1] >= 0):.   
+00051ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051ef0: 2020 2020 2069 6620 7374 6172 745f 636f       if start_co
+00051f00: 646f 6e5f 706f 7320 3e3d 2030 3a0a 2020  don_pos >= 0:.  
+00051f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051f20: 2020 2020 2020 2020 2020 6966 2073 735b            if ss[
+00051f30: 305d 203d 3d20 7374 6172 745f 636f 646f  0] == start_codo
+00051f40: 6e5f 706f 733a 0a20 2020 2020 2020 2020  n_pos:.         
+00051f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051f60: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
+00051f70: 6e5f 706f 7320 3d20 7373 5b31 5d0a 2020  n_pos = ss[1].  
+00051f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051f90: 2020 2020 2020 2020 2020 2020 2020 625f                b_
+00051fa0: 7374 6172 7420 3d20 6d0a 2020 2020 2020  start = m.      
+00051fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051fc0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00051fd0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00051fe0: 2028 7374 6f70 5f63 6f64 6f6e 5f70 6f73   (stop_codon_pos
+00051ff0: 203e 3d20 3029 3a0a 2020 2020 2020 2020   >= 0):.        
+00052000: 2020 2020 2020 2020 666f 7220 6d2c 2073          for m, s
+00052010: 7320 696e 2065 6e75 6d65 7261 7465 2873  s in enumerate(s
+00052020: 735f 6c73 7429 3a0a 2020 2020 2020 2020  s_lst):.        
+00052030: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00052040: 7373 5b30 5d20 3e3d 2030 2920 2620 2873  ss[0] >= 0) & (s
+00052050: 735b 315d 203e 3d20 3029 3a0a 2020 2020  s[1] >= 0):.    
 00052060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052070: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 203d  stop_codon_pos =
-00052080: 2073 735b 315d 0a20 2020 2020 2020 2020   ss[1].         
+00052070: 2020 2020 6966 2073 746f 705f 636f 646f      if stop_codo
+00052080: 6e5f 706f 7320 3e3d 2030 3a0a 2020 2020  n_pos >= 0:.    
 00052090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000520a0: 2020 2020 2020 2062 5f73 7461 7274 203d         b_start =
-000520b0: 206d 0a20 2020 2020 2020 2020 2020 2020   m.             
-000520c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000520d0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-000520e0: 2020 2020 2065 6c69 6620 2873 746f 705f       elif (stop_
-000520f0: 636f 646f 6e5f 706f 7320 3e3d 2030 293a  codon_pos >= 0):
-00052100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052110: 2066 6f72 206d 2c20 7373 2069 6e20 656e   for m, ss in en
-00052120: 756d 6572 6174 6528 7373 5f6c 7374 293a  umerate(ss_lst):
-00052130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052140: 2020 2020 2069 6620 2873 735b 305d 203e       if (ss[0] >
-00052150: 3d20 3029 2026 2028 7373 5b31 5d20 3e3d  = 0) & (ss[1] >=
-00052160: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
-00052170: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00052180: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 203e  stop_codon_pos >
-00052190: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-000521a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000521b0: 2069 6620 7373 5b31 5d20 3d3d 2073 746f   if ss[1] == sto
-000521c0: 705f 636f 646f 6e5f 706f 733a 0a20 2020  p_codon_pos:.   
-000521d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000521e0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-000521f0: 7274 5f63 6f64 6f6e 5f70 6f73 203d 2073  rt_codon_pos = s
-00052200: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+000520a0: 2020 2020 2020 2020 6966 2073 735b 315d          if ss[1]
+000520b0: 203d 3d20 7374 6f70 5f63 6f64 6f6e 5f70   == stop_codon_p
+000520c0: 6f73 3a0a 2020 2020 2020 2020 2020 2020  os:.            
+000520d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000520e0: 2020 2020 7374 6172 745f 636f 646f 6e5f      start_codon_
+000520f0: 706f 7320 3d20 7373 5b30 5d0a 2020 2020  pos = ss[0].    
+00052100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052110: 2020 2020 2020 2020 2020 2020 625f 7374              b_st
+00052120: 6f70 203d 206d 0a20 2020 2020 2020 2020  op = m.         
+00052130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052140: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00052150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052160: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00052170: 2020 6966 2028 625f 7374 6172 7420 3c20    if (b_start < 
+00052180: 3029 2026 2028 625f 7374 6f70 203c 2030  0) & (b_stop < 0
+00052190: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
+000521a0: 2020 2020 6966 2028 7374 6172 7470 203e      if (startp >
+000521b0: 3d20 3029 3a0a 2020 2020 2020 2020 2020  = 0):.          
+000521c0: 2020 2020 2020 2020 2020 6966 2028 7374            if (st
+000521d0: 6f70 7020 3e3d 2030 293a 0a20 2020 2020  opp >= 0):.     
+000521e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000521f0: 2020 2073 7461 7274 5f63 6f64 6f6e 5f70     start_codon_p
+00052200: 6f73 203d 2073 7461 7274 700a 2020 2020  os = startp.    
 00052210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052220: 2020 2020 2062 5f73 746f 7020 3d20 6d0a       b_stop = m.
-00052230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052240: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00052250: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00052260: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00052270: 2020 2020 2020 2020 2020 2069 6620 2862             if (b
-00052280: 5f73 7461 7274 203c 2030 2920 2620 2862  _start < 0) & (b
-00052290: 5f73 746f 7020 3c20 3029 3a20 0a20 2020  _stop < 0): .   
-000522a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000522b0: 2873 7461 7274 7020 3e3d 2030 293a 0a20  (startp >= 0):. 
-000522c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000522d0: 2020 2069 6620 2873 746f 7070 203e 3d20     if (stopp >= 
-000522e0: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
-000522f0: 2020 2020 2020 2020 2020 2020 7374 6172              star
-00052300: 745f 636f 646f 6e5f 706f 7320 3d20 7374  t_codon_pos = st
-00052310: 6172 7470 0a20 2020 2020 2020 2020 2020  artp.           
-00052320: 2020 2020 2020 2020 2020 2020 2073 746f               sto
-00052330: 705f 636f 646f 6e5f 706f 7320 3d20 7374  p_codon_pos = st
-00052340: 6f70 700a 2020 2020 2020 2020 2020 2020  opp.            
-00052350: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00052360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052370: 2020 2020 2020 7374 6172 745f 636f 646f        start_codo
-00052380: 6e5f 706f 7320 3d20 7374 6172 7470 0a20  n_pos = startp. 
-00052390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000523a0: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
-000523b0: 6e5f 706f 7320 3d20 6c65 6e28 7365 7129  n_pos = len(seq)
-000523c0: 202d 2028 6c65 6e28 7365 7129 202d 2073   - (len(seq) - s
-000523d0: 7461 7274 5f63 6f64 6f6e 5f70 6f73 2925  tart_codon_pos)%
-000523e0: 330a 2020 2020 2020 2020 2020 2020 2020  3.              
-000523f0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00052400: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00052410: 2873 746f 7070 203e 3d20 3029 3a0a 2020  (stopp >= 0):.  
-00052420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052430: 2020 7374 6172 745f 636f 646f 6e5f 706f    start_codon_po
-00052440: 7320 3d20 7374 6f70 7025 330a 2020 2020  s = stopp%3.    
+00052220: 2020 2020 7374 6f70 5f63 6f64 6f6e 5f70      stop_codon_p
+00052230: 6f73 203d 2073 746f 7070 0a20 2020 2020  os = stopp.     
+00052240: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00052250: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00052260: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00052270: 7274 5f63 6f64 6f6e 5f70 6f73 203d 2073  rt_codon_pos = s
+00052280: 7461 7274 700a 2020 2020 2020 2020 2020  tartp.          
+00052290: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000522a0: 6f70 5f63 6f64 6f6e 5f70 6f73 203d 206c  op_codon_pos = l
+000522b0: 656e 2873 6571 2920 2d20 286c 656e 2873  en(seq) - (len(s
+000522c0: 6571 2920 2d20 7374 6172 745f 636f 646f  eq) - start_codo
+000522d0: 6e5f 706f 7329 2533 0a20 2020 2020 2020  n_pos)%3.       
+000522e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000522f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00052300: 2020 656c 6966 2028 7374 6f70 7020 3e3d    elif (stopp >=
+00052310: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+00052320: 2020 2020 2020 2020 2073 7461 7274 5f63           start_c
+00052330: 6f64 6f6e 5f70 6f73 203d 2073 746f 7070  odon_pos = stopp
+00052340: 2533 0a20 2020 2020 2020 2020 2020 2020  %3.             
+00052350: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
+00052360: 6e5f 706f 7320 3d20 7374 6f70 700a 2020  n_pos = stopp.  
+00052370: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00052380: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00052390: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+000523a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000523b0: 2023 2320 4569 7468 6572 2073 7461 7274   ## Either start
+000523c0: 206f 7220 7374 6f70 2063 6f64 6f6e 2077   or stop codon w
+000523d0: 6173 2061 6e6e 6f74 6174 6564 2069 6e20  as annotated in 
+000523e0: 4754 462f 4746 460a 2020 2020 2020 2020  GTF/GFF.        
+000523f0: 2020 2020 2020 2020 2020 2020 2323 2062              ## b
+00052400: 7574 2074 6865 7920 6469 646e 2774 2061  ut they didn't a
+00052410: 7070 6561 7220 696e 2074 6865 2072 6563  ppear in the rec
+00052420: 6f6e 7374 7275 6374 6564 2073 6571 7565  onstructed seque
+00052430: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
+00052440: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
 00052450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052460: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 203d  stop_codon_pos =
-00052470: 2073 746f 7070 0a20 2020 2020 2020 2020   stopp.         
-00052480: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00052490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524a0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-000524b0: 2020 2020 2020 2020 2020 2323 2045 6974            ## Eit
-000524c0: 6865 7220 7374 6172 7420 6f72 2073 746f  her start or sto
-000524d0: 7020 636f 646f 6e20 7761 7320 616e 6e6f  p codon was anno
-000524e0: 7461 7465 6420 696e 2047 5446 2f47 4646  tated in GTF/GFF
-000524f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052500: 2020 2020 2023 2320 6275 7420 7468 6579       ## but they
-00052510: 2064 6964 6e27 7420 6170 7065 6172 2069   didn't appear i
-00052520: 6e20 7468 6520 7265 636f 6e73 7472 7563  n the reconstruc
-00052530: 7465 6420 7365 7175 656e 6365 0a20 2020  ted sequence.   
-00052540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052550: 2027 2727 0a20 2020 2020 2020 2020 2020   '''.           
-00052560: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00052570: 4552 524f 523a 2063 616e 6e6f 7420 6669  ERROR: cannot fi
-00052580: 6e64 2076 616c 6964 204f 5246 2028 4229  nd valid ORF (B)
-00052590: 2066 6f72 2025 7320 2825 6929 3a20 2569   for %s (%i): %i
-000525a0: 2c25 6920 2d20 2569 2c25 6920 2720 2520  ,%i - %i,%i ' % 
-000525b0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-000525c0: 2020 2020 2020 2020 2020 2020 2028 7365               (se
-000525d0: 6c66 2e74 6964 2c20 6973 7472 616e 642c  lf.tid, istrand,
-000525e0: 2062 5f73 7461 7274 2c20 7374 6172 745f   b_start, start_
-000525f0: 636f 646f 6e5f 706f 732c 2062 5f73 746f  codon_pos, b_sto
-00052600: 702c 2073 746f 705f 636f 646f 6e5f 706f  p, stop_codon_po
-00052610: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-00052620: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
-00052630: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00052640: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
-00052650: 6620 2873 7461 7274 5f63 6f64 6f6e 5f70  f (start_codon_p
-00052660: 6f73 203c 2030 2920 2620 2873 746f 705f  os < 0) & (stop_
-00052670: 636f 646f 6e5f 706f 7320 3e3d 2030 293a  codon_pos >= 0):
-00052680: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00052690: 7274 5f63 6f64 6f6e 5f70 6f73 203d 2073  rt_codon_pos = s
-000526a0: 746f 705f 636f 646f 6e5f 706f 7325 330a  top_codon_pos%3.
-000526b0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-000526c0: 2020 2020 2069 6620 2873 7461 7274 5f63       if (start_c
-000526d0: 6f64 6f6e 5f70 6f73 203e 3d20 3029 2026  odon_pos >= 0) &
-000526e0: 2028 7374 6f70 5f63 6f64 6f6e 5f70 6f73   (stop_codon_pos
-000526f0: 203e 3d20 3029 3a0a 2020 2020 2020 2020   >= 0):.        
-00052700: 2020 2020 6966 2069 7374 7261 6e64 203e      if istrand >
-00052710: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00052720: 2020 2020 7073 6571 203d 2073 6571 5b73      pseq = seq[s
-00052730: 7461 7274 5f63 6f64 6f6e 5f70 6f73 3a28  tart_codon_pos:(
-00052740: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 295d  stop_codon_pos)]
-00052750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052760: 2061 7365 7120 3d20 7472 616e 736c 6174   aseq = translat
-00052770: 6528 7073 6571 290a 2020 2020 2020 2020  e(pseq).        
-00052780: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00052790: 2020 2020 2020 2020 2061 6273 5f73 7461           abs_sta
-000527a0: 7274 203d 206c 6f66 2e61 6273 5f70 6f73  rt = lof.abs_pos
-000527b0: 2873 7461 7274 5f63 6f64 6f6e 5f70 6f73  (start_codon_pos
-000527c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000527d0: 2020 2320 7374 6172 745f 636f 646f 6e5f    # start_codon_
-000527e0: 706f 735f 6162 7320 3d20 2861 6273 5f73  pos_abs = (abs_s
-000527f0: 7461 7274 2c20 6162 735f 7374 6172 742b  tart, abs_start+
-00052800: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-00052810: 2020 2061 6273 5f73 746f 7020 3d20 6c6f     abs_stop = lo
-00052820: 662e 6162 735f 706f 7328 7374 6f70 5f63  f.abs_pos(stop_c
-00052830: 6f64 6f6e 5f70 6f73 290a 2020 2020 2020  odon_pos).      
-00052840: 2020 2020 2020 2020 2020 2320 7374 6f70            # stop
-00052850: 5f63 6f64 6f6e 5f70 6f73 5f61 6273 203d  _codon_pos_abs =
-00052860: 2028 6162 735f 7374 6f70 2c20 6162 735f   (abs_stop, abs_
-00052870: 7374 6f70 2b32 290a 2020 2020 2020 2020  stop+2).        
-00052880: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00052890: 2020 2020 2065 6c69 6620 6973 7472 616e       elif istran
-000528a0: 6420 3c20 303a 0a20 2020 2020 2020 2020  d < 0:.         
-000528b0: 2020 2020 2020 2073 7461 7274 203d 206c         start = l
-000528c0: 656e 2873 6571 2920 2d20 7374 6f70 5f63  en(seq) - stop_c
-000528d0: 6f64 6f6e 5f70 6f73 0a20 2020 2020 2020  odon_pos.       
-000528e0: 2020 2020 2020 2020 2073 746f 7020 3d20           stop = 
-000528f0: 6c65 6e28 7365 7129 202d 2073 7461 7274  len(seq) - start
-00052900: 5f63 6f64 6f6e 5f70 6f73 0a20 2020 2020  _codon_pos.     
-00052910: 2020 2020 2020 2020 2020 2023 2070 7365             # pse
-00052920: 7132 203d 2072 6576 6572 7365 5f63 6f6d  q2 = reverse_com
-00052930: 706c 656d 656e 7428 7073 6571 290a 2020  plement(pseq).  
-00052940: 2020 2020 2020 2020 2020 2020 2020 7073                ps
-00052950: 6571 203d 2072 6576 6572 7365 5f63 6f6d  eq = reverse_com
-00052960: 706c 656d 656e 7428 7365 715b 7374 6172  plement(seq[star
-00052970: 743a 7374 6f70 5d29 0a20 2020 2020 2020  t:stop]).       
-00052980: 2020 2020 2020 2020 2061 7365 7120 3d20           aseq = 
-00052990: 7472 616e 736c 6174 6528 7073 6571 290a  translate(pseq).
-000529a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000529b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000529c0: 2061 6273 5f73 7461 7274 203d 206c 6f66   abs_start = lof
-000529d0: 2e61 6273 5f70 6f73 286c 656e 2873 6571  .abs_pos(len(seq
-000529e0: 2920 2d20 2873 7461 7274 5f63 6f64 6f6e  ) - (start_codon
-000529f0: 5f70 6f73 2b33 2929 0a20 2020 2020 2020  _pos+3)).       
-00052a00: 2020 2020 2020 2020 2023 2073 7461 7274           # start
-00052a10: 5f63 6f64 6f6e 5f70 6f73 203d 2028 6162  _codon_pos = (ab
-00052a20: 735f 7374 6172 742c 2061 6273 5f73 7461  s_start, abs_sta
-00052a30: 7274 2b32 290a 2020 2020 2020 2020 2020  rt+2).          
-00052a40: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00052a50: 2020 2020 2020 2061 6273 5f73 746f 7020         abs_stop 
-00052a60: 3d20 6c6f 662e 6162 735f 706f 7328 6c65  = lof.abs_pos(le
-00052a70: 6e28 7365 7129 202d 2028 7374 6f70 5f63  n(seq) - (stop_c
-00052a80: 6f64 6f6e 5f70 6f73 2b33 2929 0a20 2020  odon_pos+3)).   
-00052a90: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00052aa0: 746f 705f 636f 646f 6e5f 706f 7320 3d20  top_codon_pos = 
-00052ab0: 2861 6273 5f73 746f 702c 2061 6273 5f73  (abs_stop, abs_s
-00052ac0: 746f 702b 3229 0a20 2020 2020 2020 2020  top+2).         
-00052ad0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00052ae0: 0a20 2020 2020 2020 2020 2020 2063 6473  .            cds
-00052af0: 5f6e 6577 2c20 6265 203d 206c 6f66 2e67  _new, be = lof.g
-00052b00: 6574 5f63 6473 5f72 6567 696f 6e73 2820  et_cds_regions( 
-00052b10: 7374 6172 745f 636f 646f 6e5f 706f 732c  start_codon_pos,
-00052b20: 2073 746f 705f 636f 646f 6e5f 706f 732c   stop_codon_pos,
-00052b30: 206c 656e 2873 6571 292c 2073 656c 662e   len(seq), self.
-00052b40: 6368 722c 2069 7374 7261 6e64 290a 2020  chr, istrand).  
-00052b50: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00052b60: 2020 2020 2020 2069 6620 7374 6172 745f         if start_
-00052b70: 636f 646f 6e5f 706f 7320 3d3d 2073 7461  codon_pos == sta
-00052b80: 7274 5f63 6f64 6f6e 5f70 6f73 5f6f 7267  rt_codon_pos_org
-00052b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00052ba0: 2020 6364 735f 6e65 772e 7267 6e73 2e61    cds_new.rgns.a
-00052bb0: 7070 656e 6428 2072 6567 696f 6e28 7365  ppend( region(se
-00052bc0: 6c66 2e63 6872 2c20 6162 735f 7374 6172  lf.chr, abs_star
-00052bd0: 742c 2061 6273 5f73 7461 7274 2b32 2c20  t, abs_start+2, 
-00052be0: 2773 7461 7274 5f63 6f64 6f6e 2729 2029  'start_codon') )
-00052bf0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00052c00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00052c10: 2020 2063 6473 5f6e 6577 2e72 676e 732e     cds_new.rgns.
-00052c20: 6170 7065 6e64 2820 7265 6769 6f6e 2873  append( region(s
-00052c30: 656c 662e 6368 722c 2061 6273 5f73 7461  elf.chr, abs_sta
-00052c40: 7274 2c20 6162 735f 7374 6172 742b 322c  rt, abs_start+2,
-00052c50: 2027 7374 6172 745f 636f 646f 6e27 2920   'start_codon') 
-00052c60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00052c70: 2020 2320 6364 735f 6e65 772e 7267 6e73    # cds_new.rgns
-00052c80: 2e61 7070 656e 6428 2072 6567 696f 6e28  .append( region(
-00052c90: 7365 6c66 2e63 6872 2c20 6162 735f 7374  self.chr, abs_st
-00052ca0: 6172 742c 2061 6273 5f73 7461 7274 2b32  art, abs_start+2
-00052cb0: 2c20 2753 5441 5254 5f43 4f44 4f4e 2729  , 'START_CODON')
-00052cc0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00052cd0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00052ce0: 6966 2073 746f 705f 636f 646f 6e5f 706f  if stop_codon_po
-00052cf0: 7320 3d3d 2073 746f 705f 636f 646f 6e5f  s == stop_codon_
-00052d00: 706f 735f 6f72 673a 0a20 2020 2020 2020  pos_org:.       
-00052d10: 2020 2020 2020 2020 2063 6473 5f6e 6577           cds_new
-00052d20: 2e72 676e 732e 6170 7065 6e64 2820 7265  .rgns.append( re
-00052d30: 6769 6f6e 2873 656c 662e 6368 722c 2061  gion(self.chr, a
-00052d40: 6273 5f73 746f 702c 2061 6273 5f73 746f  bs_stop, abs_sto
-00052d50: 702b 322c 2027 7374 6f70 5f63 6f64 6f6e  p+2, 'stop_codon
-00052d60: 2729 2029 0a20 2020 2020 2020 2020 2020  ') ).           
-00052d70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00052d80: 2020 2020 2020 2063 6473 5f6e 6577 2e72         cds_new.r
-00052d90: 676e 732e 6170 7065 6e64 2820 7265 6769  gns.append( regi
-00052da0: 6f6e 2873 656c 662e 6368 722c 2061 6273  on(self.chr, abs
-00052db0: 5f73 746f 702c 2061 6273 5f73 746f 702b  _stop, abs_stop+
-00052dc0: 322c 2027 7374 6f70 5f63 6f64 6f6e 2729  2, 'stop_codon')
-00052dd0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00052de0: 2020 2023 2063 6473 5f6e 6577 2e72 676e     # cds_new.rgn
-00052df0: 732e 6170 7065 6e64 2820 7265 6769 6f6e  s.append( region
-00052e00: 2873 656c 662e 6368 722c 2061 6273 5f73  (self.chr, abs_s
-00052e10: 746f 702c 2061 6273 5f73 746f 702b 322c  top, abs_stop+2,
-00052e20: 2027 5354 4f50 5f43 4f44 4f4e 2729 2029   'STOP_CODON') )
-00052e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052e40: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
-00052e50: 7072 696e 7428 272b 2b2b 2025 7320 2b2b  print('+++ %s ++
-00052e60: 2b27 2025 2073 656c 662e 7469 6420 290a  +' % self.tid ).
-00052e70: 2020 2020 2020 2020 2020 2020 2320 6364              # cd
-00052e80: 735f 6e65 772e 7072 696e 745f 7368 6f72  s_new.print_shor
-00052e90: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00052ea0: 2020 2020 0a20 2020 2020 2020 2065 6c73      .        els
-00052eb0: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
-00052ec0: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
-00052ed0: 2020 2020 2020 7073 6571 203d 2027 270a        pseq = ''.
-00052ee0: 2020 2020 2020 2020 2020 2020 6173 6571              aseq
-00052ef0: 203d 2027 270a 2020 2020 2020 2020 2020   = ''.          
-00052f00: 2020 6364 735f 6e65 7720 3d20 7265 6769    cds_new = regi
-00052f10: 6f6e 7328 290a 0a20 2020 2020 2020 2023  ons()..        #
-00052f20: 2727 270a 2020 2020 2020 2020 7265 7475  '''.        retu
-00052f30: 726e 2061 7365 712c 2070 7365 712c 2063  rn aseq, pseq, c
-00052f40: 6473 5f6e 6577 2c20 6162 735f 7374 6172  ds_new, abs_star
-00052f50: 742c 2061 6273 5f73 746f 702c 2073 7461  t, abs_stop, sta
-00052f60: 7274 5f63 6f64 6f6e 5f73 7461 7475 732c  rt_codon_status,
-00052f70: 2073 746f 705f 636f 646f 6e5f 7374 6174   stop_codon_stat
-00052f80: 7573 2c20 6265 0a20 2020 2020 2020 200a  us, be.        .
-00052f90: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
-00052fa0: 2067 6574 5f73 6571 5f66 726f 6d5f 6765   get_seq_from_ge
-00052fb0: 6e6f 6d65 2873 656c 662c 2065 786f 6e73  nome(self, exons
-00052fc0: 2c20 6364 732c 2067 656e 6f6d 6529 3a0a  , cds, genome):.
-00052fd0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00052fe0: 2074 7365 7120 3d20 2727 0a20 2020 2020   tseq = ''.     
-00052ff0: 2020 2070 7365 7120 3d20 2727 0a20 2020     pseq = ''.   
-00053000: 2020 2020 2073 7461 7274 5f73 6571 203d       start_seq =
-00053010: 2027 270a 2020 2020 2020 2020 7374 6f70   ''.        stop
-00053020: 5f73 6571 203d 2027 270a 2020 2020 2020  _seq = ''.      
-00053030: 2020 7374 6172 745f 636f 646f 6e5f 706f    start_codon_po
-00053040: 7320 3d20 2d31 0a20 2020 2020 2020 2073  s = -1.        s
-00053050: 7461 7274 5f63 6f64 6f6e 5f70 6f73 5f6f  tart_codon_pos_o
-00053060: 7267 203d 202d 310a 2020 2020 2020 2020  rg = -1.        
-00053070: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 203d  stop_codon_pos =
-00053080: 202d 310a 2020 2020 2020 2020 7374 6f70   -1.        stop
-00053090: 5f63 6f64 6f6e 5f70 6f73 5f6f 7267 203d  _codon_pos_org =
-000530a0: 202d 310a 2020 2020 2020 2020 0a20 2020   -1.        .   
-000530b0: 2020 2020 2069 6620 6364 7320 6973 206e       if cds is n
-000530c0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000530d0: 2020 2020 2066 6f72 206b 2c20 6520 696e       for k, e in
-000530e0: 2065 6e75 6d65 7261 7465 2863 6473 2e72   enumerate(cds.r
-000530f0: 676e 7329 3a0a 2020 2020 2020 2020 2020  gns):.          
-00053100: 2020 2020 2020 6368 726d 203d 2065 2e63        chrm = e.c
-00053110: 6872 0a20 2020 2020 2020 2020 2020 2020  hr.             
-00053120: 2020 2073 7461 7274 203d 2065 2e73 7461     start = e.sta
-00053130: 7274 202d 310a 2020 2020 2020 2020 2020  rt -1.          
-00053140: 2020 2020 2020 656e 6420 3d20 652e 656e        end = e.en
-00053150: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00053160: 2020 7365 7120 3d20 6765 6e6f 6d65 5b63    seq = genome[c
-00053170: 6872 6d5d 2e73 6571 5b73 7461 7274 3a65  hrm].seq[start:e
-00053180: 6e64 5d0a 0a20 2020 2020 2020 2020 2020  nd]..           
-00053190: 2020 2020 2069 6620 2865 2e74 7970 6520       if (e.type 
-000531a0: 3d3d 2027 4344 5327 293a 0a20 2020 2020  == 'CDS'):.     
-000531b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000531c0: 7365 7120 3d20 7073 6571 202b 2073 6571  seq = pseq + seq
-000531d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000531e0: 2020 656c 6966 2028 652e 7479 7065 203d    elif (e.type =
-000531f0: 3d20 2773 7461 7274 5f63 6f64 6f6e 2729  = 'start_codon')
-00053200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00053210: 2020 2020 2020 7374 6172 745f 7365 7120        start_seq 
-00053220: 3d20 7365 710a 2020 2020 2020 2020 2020  = seq.          
-00053230: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-00053240: 636f 646f 6e5f 706f 735f 6f72 6720 3d20  codon_pos_org = 
-00053250: 652e 7374 6172 740a 0a20 2020 2020 2020  e.start..       
-00053260: 2020 2020 2020 2020 2065 6c69 6620 2865           elif (e
-00053270: 2e74 7970 6520 3d3d 2027 7374 6f70 5f63  .type == 'stop_c
-00053280: 6f64 6f6e 2729 3a0a 2020 2020 2020 2020  odon'):.        
-00053290: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-000532a0: 5f73 6571 203d 2073 6571 0a20 2020 2020  _seq = seq.     
-000532b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000532c0: 746f 705f 636f 646f 6e5f 706f 735f 6f72  top_codon_pos_or
-000532d0: 6720 3d20 652e 7374 6172 740a 2020 2020  g = e.start.    
-000532e0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-000532f0: 2020 2020 2073 7461 7274 5f63 6f64 6f6e       start_codon
-00053300: 5f69 6e64 203d 2046 616c 7365 0a20 2020  _ind = False.   
-00053310: 2020 2020 2070 6f73 5f6c 7374 5f61 6c6c       pos_lst_all
-00053320: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00053330: 7220 6b2c 2065 2069 6e20 656e 756d 6572  r k, e in enumer
-00053340: 6174 6528 6578 6f6e 732e 7267 6e73 293a  ate(exons.rgns):
-00053350: 0a20 2020 2020 2020 2020 2020 2063 6872  .            chr
-00053360: 6d20 3d20 652e 6368 720a 2020 2020 2020  m = e.chr.      
-00053370: 2020 2020 2020 7374 6172 7420 3d20 652e        start = e.
-00053380: 7374 6172 7420 2d31 0a20 2020 2020 2020  start -1.       
-00053390: 2020 2020 2065 6e64 203d 2065 2e65 6e64       end = e.end
-000533a0: 0a20 2020 2020 2020 2020 2020 2073 6571  .            seq
-000533b0: 203d 2067 656e 6f6d 655b 6368 726d 5d2e   = genome[chrm].
-000533c0: 7365 715b 7374 6172 743a 656e 645d 0a20  seq[start:end]. 
-000533d0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-000533e0: 2020 2020 2020 2020 6966 2028 652e 7479          if (e.ty
-000533f0: 7065 203d 3d20 2765 786f 6e27 293a 0a20  pe == 'exon'):. 
-00053400: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00053410: 6620 2873 7461 7274 5f63 6f64 6f6e 5f70  f (start_codon_p
-00053420: 6f73 5f6f 7267 203e 3d20 652e 7374 6172  os_org >= e.star
-00053430: 7429 2026 2028 7374 6172 745f 636f 646f  t) & (start_codo
-00053440: 6e5f 706f 735f 6f72 6720 3c3d 2065 2e65  n_pos_org <= e.e
-00053450: 6e64 293a 0a20 2020 2020 2020 2020 2020  nd):.           
-00053460: 2020 2020 2020 2020 2073 7461 7274 5f63           start_c
-00053470: 6f64 6f6e 5f70 6f73 203d 206c 656e 2874  odon_pos = len(t
-00053480: 7365 7129 202b 2073 7461 7274 5f63 6f64  seq) + start_cod
-00053490: 6f6e 5f70 6f73 5f6f 7267 202d 2065 2e73  on_pos_org - e.s
-000534a0: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
-000534b0: 2020 2020 2069 6620 2873 746f 705f 636f       if (stop_co
-000534c0: 646f 6e5f 706f 735f 6f72 6720 3e3d 2065  don_pos_org >= e
-000534d0: 2e73 7461 7274 2920 2620 2873 746f 705f  .start) & (stop_
-000534e0: 636f 646f 6e5f 706f 735f 6f72 6720 3c3d  codon_pos_org <=
-000534f0: 2065 2e65 6e64 293a 0a20 2020 2020 2020   e.end):.       
-00053500: 2020 2020 2020 2020 2020 2020 2073 746f               sto
-00053510: 705f 636f 646f 6e5f 706f 7320 3d20 6c65  p_codon_pos = le
-00053520: 6e28 7473 6571 2920 2b20 7374 6f70 5f63  n(tseq) + stop_c
-00053530: 6f64 6f6e 5f70 6f73 5f6f 7267 202d 2065  odon_pos_org - e
-00053540: 2e73 7461 7274 0a20 2020 2020 2020 2020  .start.         
-00053550: 2020 2020 2020 2074 7365 7120 3d20 7473         tseq = ts
-00053560: 6571 202b 2073 6571 0a20 2020 2020 2020  eq + seq.       
-00053570: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00053580: 2020 6966 2073 656c 662e 6973 7472 616e    if self.istran
-00053590: 6420 3c20 303a 0a20 2020 2020 2020 2020  d < 0:.         
-000535a0: 2020 2074 7365 7120 3d20 7265 7665 7273     tseq = revers
-000535b0: 655f 636f 6d70 6c65 6d65 6e74 2874 7365  e_complement(tse
-000535c0: 7129 0a20 2020 2020 2020 2020 2020 2069  q).            i
-000535d0: 6620 6364 7320 6973 206e 6f74 204e 6f6e  f cds is not Non
-000535e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000535f0: 2020 2070 7365 7120 3d20 7265 7665 7273     pseq = revers
-00053600: 655f 636f 6d70 6c65 6d65 6e74 2870 7365  e_complement(pse
-00053610: 7129 0a20 2020 2020 2020 2020 2020 2020  q).             
-00053620: 2020 2073 7461 7274 5f73 6571 203d 2072     start_seq = r
-00053630: 6576 6572 7365 5f63 6f6d 706c 656d 656e  everse_complemen
-00053640: 7428 7374 6172 745f 7365 7129 0a20 2020  t(start_seq).   
-00053650: 2020 2020 2020 2020 2020 2020 2073 746f               sto
-00053660: 705f 7365 7120 3d20 7265 7665 7273 655f  p_seq = reverse_
-00053670: 636f 6d70 6c65 6d65 6e74 2873 746f 705f  complement(stop_
-00053680: 7365 7129 0a20 2020 2020 2020 2020 2020  seq).           
-00053690: 2020 2020 2069 6620 7374 6172 745f 636f       if start_co
-000536a0: 646f 6e5f 706f 735f 6f72 6720 3e3d 2030  don_pos_org >= 0
-000536b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000536c0: 2020 2020 2020 7374 6172 745f 636f 646f        start_codo
-000536d0: 6e5f 706f 7320 3d20 6c65 6e28 7473 6571  n_pos = len(tseq
-000536e0: 2920 2d20 7374 6172 745f 636f 646f 6e5f  ) - start_codon_
-000536f0: 706f 7320 2d33 0a20 2020 2020 2020 2020  pos -3.         
-00053700: 2020 2020 2020 2069 6620 7374 6f70 5f63         if stop_c
-00053710: 6f64 6f6e 5f70 6f73 5f6f 7267 203e 3d20  odon_pos_org >= 
-00053720: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00053730: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
-00053740: 6e5f 706f 7320 3d20 6c65 6e28 7473 6571  n_pos = len(tseq
-00053750: 2920 2d20 7374 6f70 5f63 6f64 6f6e 5f70  ) - stop_codon_p
-00053760: 6f73 202d 330a 2020 2020 2020 2020 2020  os -3.          
-00053770: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
-00053780: 6574 7572 6e20 7365 6c66 2e69 6364 732c  eturn self.icds,
-00053790: 2073 656c 662e 6973 7472 616e 642c 2074   self.istrand, t
-000537a0: 7365 712c 2070 7365 712c 2073 7461 7274  seq, pseq, start
-000537b0: 5f73 6571 2c20 7374 6f70 5f73 6571 2c20  _seq, stop_seq, 
-000537c0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-000537d0: 2020 2020 2020 7374 6172 745f 636f 646f        start_codo
-000537e0: 6e5f 706f 735f 6f72 672c 2073 7461 7274  n_pos_org, start
-000537f0: 5f63 6f64 6f6e 5f70 6f73 2c20 7374 6f70  _codon_pos, stop
-00053800: 5f63 6f64 6f6e 5f70 6f73 5f6f 7267 2c20  _codon_pos_org, 
-00053810: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 0a0a  stop_codon_pos..
-00053820: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00053830: 2064 6566 2067 6574 5f73 7061 6e28 7365   def get_span(se
-00053840: 6c66 293a 0a20 2020 2020 2020 200a 2020  lf):.        .  
-00053850: 2020 2020 2020 7370 616e 203d 2072 6567        span = reg
-00053860: 696f 6e28 7365 6c66 2e63 6872 2c20 7365  ion(self.chr, se
-00053870: 6c66 2e62 6567 696e 2c20 7365 6c66 2e65  lf.begin, self.e
-00053880: 6e64 2c20 274d 2729 0a20 2020 2020 2020  nd, 'M').       
-00053890: 2072 6574 7572 6e20 7370 616e 0a20 2020   return span.   
-000538a0: 200a 2020 2020 6465 6620 7072 696e 745f   .    def print_
-000538b0: 7368 6f72 7428 7365 6c66 293a 0a20 2020  short(self):.   
-000538c0: 2020 2020 200a 2020 2020 2020 2020 635f       .        c_
-000538d0: 6f72 5f6e 203d 2067 6574 5f73 7472 5f63  or_n = get_str_c
-000538e0: 6f64 696e 675f 7374 6174 7573 2873 656c  oding_status(sel
-000538f0: 662e 6963 6473 290a 2020 2020 2020 2020  f.icds).        
-00053900: 7373 203d 2067 6574 5f63 5f66 726f 6d5f  ss = get_c_from_
-00053910: 6973 7472 616e 6428 2073 656c 662e 6973  istrand( self.is
-00053920: 7472 616e 6420 290a 2020 2020 2020 2020  trand ).        
-00053930: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00053940: 2573 2c20 2573 2c20 2825 732c 2025 7329  %s, %s, (%s, %s)
-00053950: 2720 2520 2873 656c 662e 6964 2c20 7365  ' % (self.id, se
-00053960: 6c66 2e6e 616d 652c 2063 5f6f 725f 6e2c  lf.name, c_or_n,
-00053970: 2073 7329 2029 0a20 2020 2020 2020 2070   ss) ).        p
-00053980: 7269 6e74 2827 544c 656e 3a20 2569 2c20  rint('TLen: %i, 
-00053990: 504c 656e 3a20 2569 2028 2534 2e31 6629  PLen: %i (%4.1f)
-000539a0: 2720 2520 286c 656e 2873 656c 662e 7473  ' % (len(self.ts
-000539b0: 6571 292c 206c 656e 2873 656c 662e 7073  eq), len(self.ps
-000539c0: 6571 292c 206c 656e 2873 656c 662e 7073  eq), len(self.ps
-000539d0: 6571 292f 3329 2029 0a0a 2020 2020 2727  eq)/3) )..    ''
-000539e0: 270a 2020 2020 5472 616e 7363 7269 7074  '.    Transcript
-000539f0: 203d 2063 6f6c 6c65 6374 696f 6e73 2e6e   = collections.n
-00053a00: 616d 6564 7475 706c 6528 2754 7261 6e73  amedtuple('Trans
-00053a10: 6372 6970 7427 2c20 5c0a 2020 2020 2020  cript', \.      
-00053a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053a30: 2020 2020 2020 2020 2020 2020 2020 2770                'p
-00053a40: 7265 6669 782c 2067 6964 782c 2067 7270  refix, gidx, grp
-00053a50: 5f73 697a 652c 2069 636e 742c 2063 6872  _size, icnt, chr
-00053a60: 2c20 7374 6172 742c 2065 6e64 2c20 5c0a  , start, end, \.
-00053a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053a90: 2020 2020 2073 7472 616e 642c 2063 646e       strand, cdn
-00053aa0: 672c 2073 6571 2c20 6162 6e2c 2074 706d  g, seq, abn, tpm
-00053ab0: 2c20 6973 6f5f 6672 6163 2c20 7072 6f62  , iso_frac, prob
-00053ac0: 2c20 6e65 7873 2c20 6776 6f6c 2729 0a20  , nexs, gvol'). 
-00053ad0: 2020 2027 2727 0a20 2020 2064 6566 2073     '''.    def s
-00053ae0: 6574 2873 656c 662c 2072 676e 732c 2074  et(self, rgns, t
-00053af0: 725f 696e 666f 2c20 7665 7262 6f73 6520  r_info, verbose 
-00053b00: 3d20 4661 6c73 6529 3a0a 200a 2020 2020  = False):. .    
-00053b10: 2020 2020 2320 7365 6c66 2e67 7466 5f6c      # self.gtf_l
-00053b20: 696e 6573 203d 2067 7466 5f6c 696e 6573  ines = gtf_lines
-00053b30: 5f6f 665f 615f 7472 2020 2020 2020 2020  _of_a_tr        
-00053b40: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-00053b50: 7220 3d20 7472 5f69 6e66 6f2e 6368 720a  r = tr_info.chr.
-00053b60: 2020 2020 2020 2020 7365 6c66 2e62 6567          self.beg
-00053b70: 696e 203d 2074 725f 696e 666f 2e73 7461  in = tr_info.sta
-00053b80: 7274 2020 2020 2020 0a20 2020 2020 2020  rt      .       
-00053b90: 2073 656c 662e 656e 6420 3d20 7472 5f69   self.end = tr_i
-00053ba0: 6e66 6f2e 656e 6420 2020 2020 2020 200a  nfo.end        .
-00053bb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00053bc0: 2073 656c 662e 6769 6420 3d20 2753 4649   self.gid = 'SFI
-00053bd0: 582e 2569 2720 2520 2874 725f 696e 666f  X.%i' % (tr_info
-00053be0: 2e67 6964 7829 200a 2020 2020 2020 2020  .gidx) .        
-00053bf0: 7365 6c66 2e67 6e61 6d65 203d 2027 5346  self.gname = 'SF
-00053c00: 4958 2e25 6927 2025 2028 7472 5f69 6e66  IX.%i' % (tr_inf
-00053c10: 6f2e 6769 6478 290a 2020 2020 2020 2020  o.gidx).        
-00053c20: 7365 6c66 2e74 6964 203d 2027 5346 4958  self.tid = 'SFIX
-00053c30: 2e25 692e 2569 2720 2520 2874 725f 696e  .%i.%i' % (tr_in
-00053c40: 666f 2e67 6964 782c 2074 725f 696e 666f  fo.gidx, tr_info
-00053c50: 2e69 636e 7429 0a20 2020 2020 2020 2073  .icnt).        s
-00053c60: 656c 662e 746e 616d 6520 3d20 2753 4649  elf.tname = 'SFI
-00053c70: 582e 2569 2e25 6927 2025 2028 7472 5f69  X.%i.%i' % (tr_i
-00053c80: 6e66 6f2e 6769 6478 2c20 7472 5f69 6e66  nfo.gidx, tr_inf
-00053c90: 6f2e 6963 6e74 290a 2020 2020 2020 2020  o.icnt).        
-00053ca0: 7365 6c66 2e69 7374 7261 6e64 203d 2074  self.istrand = t
-00053cb0: 725f 696e 666f 2e73 7472 616e 640a 2020  r_info.strand.  
-00053cc0: 2020 2020 2020 7365 6c66 2e69 6364 7320        self.icds 
-00053cd0: 3d20 6765 745f 6963 646e 675f 6672 6f6d  = get_icdng_from
-00053ce0: 5f73 7472 2820 7472 5f69 6e66 6f2e 6364  _str( tr_info.cd
-00053cf0: 6e67 2029 2020 2020 2020 2023 2320 2d31  ng )       ## -1
-00053d00: 3a20 756e 7370 6563 6966 6965 642c 2030  : unspecified, 0
-00053d10: 3a20 6e6f 6e2d 636f 6469 6e67 2c20 313a  : non-coding, 1:
-00053d20: 2063 6f64 696e 670a 2020 2020 2020 2020   coding.        
-00053d30: 0a20 2020 2020 2020 2023 2320 7573 6564  .        ## used
-00053d40: 2069 6e20 7464 5f61 6e64 5f61 650a 2020   in td_and_ae.  
-00053d50: 2020 2020 2020 2320 7365 6c66 2e74 655f        # self.te_
-00053d60: 746f 5f67 655f 6d61 7020 3d20 5b5d 0a20  to_ge_map = []. 
-00053d70: 2020 2020 2020 2023 2073 656c 662e 7463         # self.tc
-00053d80: 5f74 6f5f 6763 5f6d 6170 203d 205b 5d0a  _to_gc_map = [].
-00053d90: 2020 2020 2020 2020 2320 7365 6c66 2e74          # self.t
-00053da0: 725f 746f 5f67 725f 6d61 7020 3d20 5b5d  r_to_gr_map = []
-00053db0: 0a20 2020 2020 2020 2073 656c 662e 6162  .        self.ab
-00053dc0: 6e20 3d20 7472 5f69 6e66 6f2e 6162 6e0a  n = tr_info.abn.
-00053dd0: 2020 2020 2020 2020 7365 6c66 2e63 6f76          self.cov
-00053de0: 203d 2031 0a20 2020 2020 2020 2073 656c   = 1.        sel
-00053df0: 662e 746c 656e 203d 206c 656e 2874 725f  f.tlen = len(tr_
-00053e00: 696e 666f 2e73 6571 290a 2020 2020 2020  info.seq).      
-00053e10: 2020 2320 7365 6c66 2e70 6c65 6e20 3d20    # self.plen = 
-00053e20: 2d31 0a20 2020 2020 2020 200a 2020 2020  -1.        .    
-00053e30: 2020 2020 2320 7365 6c66 2e63 6f76 5f6c      # self.cov_l
-00053e40: 656e 203d 2030 0a20 2020 2020 2020 2023  en = 0.        #
-00053e50: 2073 656c 662e 636f 765f 7261 7469 6f20   self.cov_ratio 
-00053e60: 3d20 300a 0a20 2020 2020 2020 2023 2320  = 0..        ## 
-00053e70: 5465 6d70 6f72 6172 7920 7661 7269 6162  Temporary variab
-00053e80: 6c65 730a 2020 2020 2020 2020 7365 6c66  les.        self
-00053e90: 2e70 7265 6669 7820 3d20 7472 5f69 6e66  .prefix = tr_inf
-00053ea0: 6f2e 7072 6566 6978 0a20 2020 2020 2020  o.prefix.       
-00053eb0: 2073 656c 662e 6776 6f6c 203d 2074 725f   self.gvol = tr_
-00053ec0: 696e 666f 2e67 766f 6c0a 2020 2020 2020  info.gvol.      
-00053ed0: 2020 7365 6c66 2e70 726f 6220 3d20 7472    self.prob = tr
-00053ee0: 5f69 6e66 6f2e 7072 6f62 0a20 2020 2020  _info.prob.     
-00053ef0: 2020 2073 656c 662e 6e65 786f 6e73 203d     self.nexons =
-00053f00: 2074 725f 696e 666f 2e6e 6578 730a 2020   tr_info.nexs.  
-00053f10: 2020 2020 2020 2320 7365 6c66 2e6c 656e        # self.len
-00053f20: 5f6f 7320 3d20 2d31 0a20 2020 2020 2020  _os = -1.       
-00053f30: 2023 2073 656c 662e 706f 735f 7374 6172   # self.pos_star
-00053f40: 7420 3d20 2d31 2020 2323 2030 2d62 6173  t = -1  ## 0-bas
-00053f50: 650a 2020 2020 2020 2020 2320 7365 6c66  e.        # self
-00053f60: 2e70 6f73 5f73 746f 7020 3d20 2d31 2020  .pos_stop = -1  
-00053f70: 2023 2320 302d 6261 7365 0a20 2020 2020   ## 0-base.     
-00053f80: 2020 200a 2020 2020 2020 2020 2323 2054     .        ## T
-00053f90: 7220 696e 666f 0a20 2020 2020 2020 2073  r info.        s
-00053fa0: 656c 662e 7470 6d20 3d20 7472 5f69 6e66  elf.tpm = tr_inf
-00053fb0: 6f2e 7470 6d0a 2020 2020 2020 2020 7365  o.tpm.        se
-00053fc0: 6c66 2e69 636e 7420 3d20 7472 5f69 6e66  lf.icnt = tr_inf
-00053fd0: 6f2e 6963 6e74 0a20 2020 2020 2020 2073  o.icnt.        s
-00053fe0: 656c 662e 6772 705f 7369 7a65 203d 2074  elf.grp_size = t
-00053ff0: 725f 696e 666f 2e67 7270 5f73 697a 650a  r_info.grp_size.
-00054000: 2020 2020 2020 2020 7365 6c66 2e69 736f          self.iso
-00054010: 5f66 7261 6320 3d20 7472 5f69 6e66 6f2e  _frac = tr_info.
-00054020: 6973 6f5f 6672 6163 0a0a 2020 2020 2020  iso_frac..      
-00054030: 2020 2323 2043 6f64 6f6e 2070 6f73 2061    ## Codon pos a
-00054040: 6e64 2073 7461 7475 730a 2020 2020 2020  nd status.      
-00054050: 2020 2320 7365 6c66 2e73 7461 7274 5f63    # self.start_c
-00054060: 6f64 6f6e 5f70 6f73 5f6f 7267 203d 2028  odon_pos_org = (
-00054070: 2d31 2c2d 3129 0a20 2020 2020 2020 2023  -1,-1).        #
-00054080: 2073 656c 662e 7374 6f70 5f63 6f64 6f6e   self.stop_codon
-00054090: 5f70 6f73 5f6f 7267 203d 2028 2d31 2c2d  _pos_org = (-1,-
-000540a0: 3129 0a20 2020 2020 2020 200a 2020 2020  1).        .    
-000540b0: 2020 2020 2320 7365 6c66 2e73 7461 7274      # self.start
-000540c0: 5f63 6f64 6f6e 5f65 7665 6e74 203d 202d  _codon_event = -
-000540d0: 310a 2020 2020 2020 2020 2320 7365 6c66  1.        # self
-000540e0: 2e73 746f 705f 636f 646f 6e5f 6576 656e  .stop_codon_even
-000540f0: 7420 3d20 2d31 0a20 2020 2020 2020 200a  t = -1.        .
-00054100: 2020 2020 2020 2020 2320 7365 6c66 2e73          # self.s
-00054110: 7461 7274 5f63 6f64 6f6e 5f70 6f73 203d  tart_codon_pos =
-00054120: 2028 2d31 2c2d 3129 0a20 2020 2020 2020   (-1,-1).       
-00054130: 2023 2073 656c 662e 7374 6f70 5f63 6f64   # self.stop_cod
-00054140: 6f6e 5f70 6f73 203d 2028 2d31 2c2d 3129  on_pos = (-1,-1)
-00054150: 0a0a 2020 2020 2020 2020 2320 7365 6c66  ..        # self
-00054160: 2e73 7461 7274 5f63 6f64 6f6e 5f73 7461  .start_codon_sta
-00054170: 7475 7320 3d20 2d31 0a20 2020 2020 2020  tus = -1.       
-00054180: 2023 2073 656c 662e 7374 6f70 5f63 6f64   # self.stop_cod
-00054190: 6f6e 5f73 7461 7475 7320 3d20 2d31 0a20  on_status = -1. 
-000541a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000541b0: 2323 2066 696c 6c65 6420 7769 7468 2067  ## filled with g
-000541c0: 6574 5f73 6571 5f66 726f 6d5f 6578 6f6e  et_seq_from_exon
-000541d0: 7328 290a 2020 2020 2020 2020 2320 7365  s().        # se
-000541e0: 6c66 2e6c 6f66 203d 204e 6f6e 650a 2020  lf.lof = None.  
-000541f0: 2020 2020 2020 7365 6c66 2e74 7365 7120        self.tseq 
-00054200: 3d20 7472 5f69 6e66 6f2e 7365 710a 2020  = tr_info.seq.  
-00054210: 2020 2020 2020 2320 7365 6c66 2e70 7365        # self.pse
-00054220: 7120 3d20 2727 0a20 2020 2020 2020 2023  q = ''.        #
-00054230: 2073 656c 662e 6173 6571 203d 2027 270a   self.aseq = ''.
-00054240: 2020 2020 2020 2020 0a0a 2020 2020 2020          ..      
-00054250: 2020 0a23 2323 2323 2323 2323 2323 2323    .#############
-00054260: 2323 2323 230a 2323 2047 656e 6520 6465  #####.## Gene de
-00054270: 7363 7269 7074 6f72 0a23 2323 2323 2323  scriptor.#######
-00054280: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-00054290: 2073 6f72 745f 6465 7363 7269 7074 6f72   sort_descriptor
-000542a0: 5f6c 7374 2864 5f6c 7374 2c20 7265 6620  _lst(d_lst, ref 
-000542b0: 3d20 2763 6872 2729 3a0a 2020 2020 0a20  = 'chr'):.    . 
-000542c0: 2020 2069 6620 7265 6620 3d3d 2027 6368     if ref == 'ch
-000542d0: 7227 3a0a 2020 2020 2020 2020 6368 7273  r':.        chrs
-000542e0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-000542f0: 7220 6420 696e 2064 5f6c 7374 3a0a 2020  r d in d_lst:.  
-00054300: 2020 2020 2020 2020 2020 6368 7273 2e61            chrs.a
-00054310: 7070 656e 6428 642e 6368 7229 0a0a 2020  ppend(d.chr)..  
-00054320: 2020 2020 2020 6368 725f 7365 7420 3d20        chr_set = 
-00054330: 6c69 7374 2873 6574 2863 6872 7329 290a  list(set(chrs)).
-00054340: 2020 2020 2020 2020 6368 725f 7365 742e          chr_set.
-00054350: 736f 7274 2829 0a20 2020 2020 2020 2063  sort().        c
-00054360: 6872 7320 3d20 6e70 2e61 7272 6179 2863  hrs = np.array(c
-00054370: 6872 7329 0a0a 2020 2020 2020 2020 645f  hrs)..        d_
-00054380: 6c73 745f 6e65 7720 3d20 5b5d 0a20 2020  lst_new = [].   
-00054390: 2020 2020 2066 6f72 2063 2069 6e20 6368       for c in ch
-000543a0: 725f 7365 743a 0a20 2020 2020 2020 2020  r_set:.         
-000543b0: 2020 2077 6820 3d20 7768 6963 6828 6368     wh = which(ch
-000543c0: 7273 203d 3d20 6329 0a20 2020 2020 2020  rs == c).       
-000543d0: 2020 2020 2070 7320 3d20 6e70 2e61 7272       ps = np.arr
-000543e0: 6179 2820 5b64 5f6c 7374 5b77 5d2e 6265  ay( [d_lst[w].be
-000543f0: 6769 6e20 666f 7220 7720 696e 2077 685d  gin for w in wh]
-00054400: 2029 0a20 2020 2020 2020 2020 2020 206f   ).            o
-00054410: 6472 3220 3d20 7073 2e61 7267 736f 7274  dr2 = ps.argsort
-00054420: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-00054430: 6f72 206f 2069 6e20 6f64 7232 3a0a 2020  or o in odr2:.  
-00054440: 2020 2020 2020 2020 2020 2020 2020 7720                w 
-00054450: 3d20 7768 5b6f 5d0a 2020 2020 2020 2020  = wh[o].        
-00054460: 2020 2020 2020 2020 645f 6c73 745f 6e65          d_lst_ne
-00054470: 772e 6170 7065 6e64 2864 5f6c 7374 5b77  w.append(d_lst[w
-00054480: 5d29 0a20 2020 2065 6c73 653a 0a20 2020  ]).    else:.   
-00054490: 2020 2020 2070 6f73 5f6c 7374 203d 206e       pos_lst = n
-000544a0: 702e 7a65 726f 7328 6c65 6e28 645f 6c73  p.zeros(len(d_ls
-000544b0: 7429 290a 2020 2020 2020 2020 666f 7220  t)).        for 
-000544c0: 6b2c 2064 2069 6e20 656e 756d 6572 6174  k, d in enumerat
-000544d0: 6528 645f 6c73 7429 3a0a 2020 2020 2020  e(d_lst):.      
-000544e0: 2020 2020 2020 706f 735f 6c73 745b 6b5d        pos_lst[k]
-000544f0: 203d 2064 2e62 6567 696e 0a20 2020 2020   = d.begin.     
-00054500: 2020 206f 6472 203d 2070 6f73 5f6c 7374     odr = pos_lst
-00054510: 2e61 7267 736f 7274 2829 0a20 2020 2020  .argsort().     
-00054520: 2020 2064 5f6c 7374 5f6e 6577 203d 205b     d_lst_new = [
-00054530: 5d0a 2020 2020 2020 2020 666f 7220 6b20  ].        for k 
-00054540: 696e 206f 6472 3a0a 2020 2020 2020 2020  in odr:.        
-00054550: 2020 2020 645f 6c73 745f 6e65 772e 6170      d_lst_new.ap
-00054560: 7065 6e64 2864 5f6c 7374 5b6b 5d29 0a20  pend(d_lst[k]). 
-00054570: 2020 2020 2020 200a 2020 2020 7265 7475         .    retu
-00054580: 726e 2064 5f6c 7374 5f6e 6577 0a0a 2727  rn d_lst_new..''
-00054590: 270a 636c 6173 7320 7370 6c69 6365 5f67  '.class splice_g
-000545a0: 7261 7068 3a0a 2020 2020 0a20 2020 2064  raph:.    .    d
-000545b0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-000545c0: 2c20 7265 6164 5f6c 656e 2c20 636e 7420  , read_len, cnt 
-000545d0: 3d20 3029 3a0a 2020 2020 2020 2020 0a20  = 0):.        . 
-000545e0: 2020 2020 2020 2073 656c 662e 7265 6164         self.read
-000545f0: 5f6c 656e 203d 2072 6561 645f 6c65 6e0a  _len = read_len.
-00054600: 2020 2020 2020 2020 7365 6c66 2e67 636e          self.gcn
-00054610: 7420 3d20 636e 740a 2020 2020 2020 2020  t = cnt.        
-00054620: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-00054630: 6e6f 6465 7320 3d20 300a 2020 2020 2020  nodes = 0.      
-00054640: 2020 7365 6c66 2e6e 6f64 6573 203d 2072    self.nodes = r
-00054650: 6567 696f 6e73 2829 0a20 2020 2020 2020  egions().       
-00054660: 2073 656c 662e 6772 6170 685f 6677 6420   self.graph_fwd 
-00054670: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
-00054680: 662e 6772 6170 685f 6277 6420 3d20 7b7d  f.graph_bwd = {}
-00054690: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-000546a0: 7061 7468 7320 3d20 300a 2020 2020 2020  paths = 0.      
-000546b0: 2020 7365 6c66 2e70 6174 685f 6c73 7420    self.path_lst 
-000546c0: 3d20 5b5d 0a0a 2020 2020 2020 2020 7365  = []..        se
-000546d0: 6c66 2e6e 5f65 6467 6573 203d 2030 0a20  lf.n_edges = 0. 
-000546e0: 2020 2020 2020 2073 656c 662e 6564 6765         self.edge
-000546f0: 7320 3d20 7265 6769 6f6e 735f 6e64 2829  s = regions_nd()
-00054700: 0a20 2020 2020 2020 2073 656c 662e 6772  .        self.gr
-00054710: 6170 685f 6620 3d20 7b7d 0a20 2020 2020  aph_f = {}.     
-00054720: 2020 2073 656c 662e 6772 6170 685f 6220     self.graph_b 
-00054730: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
-00054740: 662e 6e5f 7020 3d20 300a 2020 2020 2020  f.n_p = 0.      
-00054750: 2020 7365 6c66 2e70 5f6c 7374 203d 205b    self.p_lst = [
-00054760: 5d0a 2020 2020 2020 2020 7365 6c66 2e73  ].        self.s
-00054770: 5f6c 7374 203d 205b 5d0a 2020 2020 2020  _lst = [].      
-00054780: 2020 7365 6c66 2e63 5f6c 7374 203d 205b    self.c_lst = [
-00054790: 5d0a 2020 2020 2020 2020 7365 6c66 2e63  ].        self.c
-000547a0: 6f76 5f6c 7374 203d 205b 5d0a 2020 2020  ov_lst = [].    
-000547b0: 2020 2020 7365 6c66 2e73 7472 616e 6420      self.strand 
-000547c0: 3d20 300a 2020 2020 2020 2020 0a20 2020  = 0.        .   
-000547d0: 2020 2020 2073 656c 662e 6376 6773 203d       self.cvgs =
-000547e0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-000547f0: 6c66 2e6c 656e 7320 3d20 4e6f 6e65 0a20  lf.lens = None. 
-00054800: 2020 2020 2020 2073 656c 662e 6162 6e20         self.abn 
-00054810: 3d20 4e6f 6e65 0a20 2020 2020 2020 200a  = None.        .
-00054820: 2020 2020 2020 2020 7365 6c66 2e79 203d          self.y =
-00054830: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-00054840: 6c66 2e48 203d 204e 6f6e 650a 2020 2020  lf.H = None.    
-00054850: 2020 2020 7365 6c66 2e7a 203d 204e 6f6e      self.z = Non
-00054860: 650a 2020 2020 2020 2020 7365 6c66 2e47  e.        self.G
-00054870: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00054880: 0a20 2020 2020 2020 2023 2320 4f6e 6c79  .        ## Only
-00054890: 2046 5949 0a20 2020 2020 2020 2073 656c   FYI.        sel
-000548a0: 662e 6e6f 6465 735f 6d69 6e20 3d20 5b5d  f.nodes_min = []
-000548b0: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-000548c0: 6e6f 6465 735f 6d69 6e20 3d20 300a 2020  nodes_min = 0.  
-000548d0: 2020 2020 2020 7365 6c66 2e6e 5f65 6467        self.n_edg
-000548e0: 6573 5f6d 696e 203d 2030 0a20 2020 2020  es_min = 0.     
-000548f0: 2020 2073 656c 662e 6772 6170 685f 665f     self.graph_f_
-00054900: 6d69 6e20 3d20 7b7d 0a20 2020 2020 2020  min = {}.       
-00054910: 2073 656c 662e 6772 6170 685f 625f 6d69   self.graph_b_mi
-00054920: 6e20 3d20 7b7d 0a20 2020 2020 2020 2073  n = {}.        s
-00054930: 656c 662e 6e5f 705f 6d69 6e20 3d20 300a  elf.n_p_min = 0.
-00054940: 2020 2020 2020 2020 7365 6c66 2e70 5f6c          self.p_l
-00054950: 7374 5f6d 696e 203d 205b 5d0a 2020 2020  st_min = [].    
-00054960: 2020 2020 0a20 2020 2020 2020 2073 656c      .        sel
-00054970: 662e 6376 6773 5f6d 696e 203d 204e 6f6e  f.cvgs_min = Non
-00054980: 650a 2020 2020 2020 2020 7365 6c66 2e6c  e.        self.l
-00054990: 656e 735f 6d69 6e20 3d20 4e6f 6e65 0a20  ens_min = None. 
-000549a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000549b0: 7365 6c66 2e7a 5f6d 696e 203d 204e 6f6e  self.z_min = Non
-000549c0: 650a 2020 2020 2020 2020 7365 6c66 2e47  e.        self.G
-000549d0: 5f6d 696e 203d 204e 6f6e 650a 2020 2020  _min = None.    
-000549e0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-000549f0: 2020 2020 2073 656c 662e 6e5f 705f 6465       self.n_p_de
-00054a00: 7465 6374 6564 203d 2030 0a20 2020 2020  tected = 0.     
-00054a10: 2020 2073 656c 662e 705f 6c73 745f 6465     self.p_lst_de
-00054a20: 7465 6374 6564 203d 205b 5d0a 2020 2020  tected = [].    
-00054a30: 2020 2020 7365 6c66 2e6e 5f70 5f63 616e      self.n_p_can
-00054a40: 6469 6461 7465 203d 2030 0a20 2020 2020  didate = 0.     
-00054a50: 2020 2073 656c 662e 705f 6c73 745f 6361     self.p_lst_ca
-00054a60: 6e64 6964 6174 6520 3d20 5b5d 0a0a 2020  ndidate = []..  
-00054a70: 2020 2020 2020 7365 6c66 2e62 6973 7472        self.bistr
-00054a80: 616e 6465 6420 3d20 4661 6c73 650a 2020  anded = False.  
-00054a90: 2020 2020 2020 7365 6c66 2e6e 705f 696e        self.np_in
-00054aa0: 203d 2073 656c 662e 6e5f 700a 2020 2020   = self.n_p.    
-00054ab0: 2020 2020 7365 6c66 2e6e 705f 6f75 7420      self.np_out 
-00054ac0: 3d20 7365 6c66 2e6e 5f70 0a0a 534e 565f  = self.n_p..SNV_
-00054ad0: 696e 666f 203d 2063 6f6c 6c65 6374 696f  info = collectio
-00054ae0: 6e73 2e6e 616d 6564 7475 706c 6528 2753  ns.namedtuple('S
-00054af0: 4e56 5f69 6e66 6f27 2c20 2763 6872 2c20  NV_info', 'chr, 
-00054b00: 706f 735f 7265 662c 2070 6f73 5f6e 6577  pos_ref, pos_new
-00054b10: 2c20 6765 6e65 5f69 642c 2067 656e 655f  , gene_id, gene_
-00054b20: 6e61 6d65 2c20 765f 7479 7065 2c20 765f  name, v_type, v_
-00054b30: 6c65 6e2c 2063 7667 5f64 6570 7468 2c20  len, cvg_depth, 
-00054b40: 6376 675f 6672 6163 2c20 5c0a 2020 2020  cvg_frac, \.    
-00054b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054b60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00054b70: 6566 5f70 7265 762c 2072 6566 5f73 6571  ef_prev, ref_seq
-00054b80: 2c20 7265 665f 6e65 7874 2c20 616c 745f  , ref_next, alt_
-00054b90: 7072 6576 2c20 616c 745f 7365 712c 2061  prev, alt_seq, a
-00054ba0: 6c74 5f6e 6578 7427 2920 2320 6f6e 652d  lt_next') # one-
-00054bb0: 6261 7365 0a20 2020 2020 2020 200a 2727  base.        .''
-00054bc0: 270a 0a27 2727 0a76 5f63 6c61 7373 3a20  '..'''.v_class: 
-00054bd0: 0a20 2733 5f70 7269 6d65 5f55 5452 272c  . '3_prime_UTR',
-00054be0: 0a20 2735 5f70 7269 6d65 5f55 5452 272c  . '5_prime_UTR',
-00054bf0: 0a20 2746 7261 6d65 5f53 6869 6674 5f44  . 'Frame_Shift_D
-00054c00: 656c 272c 0a20 2746 7261 6d65 5f53 6869  el',. 'Frame_Shi
-00054c10: 6674 5f49 6e73 272c 0a20 2749 6e5f 4672  ft_Ins',. 'In_Fr
-00054c20: 616d 655f 4465 6c27 2c0a 2027 496e 5f46  ame_Del',. 'In_F
-00054c30: 7261 6d65 5f49 6e73 272c 0a20 274d 6973  rame_Ins',. 'Mis
-00054c40: 7365 6e73 655f 4d75 7461 7469 6f6e 272c  sense_Mutation',
-00054c50: 0a20 274e 6f6e 7365 6e73 655f 4d75 7461  . 'Nonsense_Muta
-00054c60: 7469 6f6e 272c 2023 2053 4e50 202d 3e20  tion', # SNP -> 
-00054c70: 7374 6f70 2065 6172 6c69 6572 0a20 274e  stop earlier. 'N
-00054c80: 6f6e 7374 6f70 5f4d 7574 6174 696f 6e27  onstop_Mutation'
-00054c90: 2c20 2023 2053 4e50 202d 3e20 7374 6f70  ,  # SNP -> stop
-00054ca0: 206c 6174 6572 0a20 2753 696c 656e 7427   later. 'Silent'
-00054cb0: 2c0a 2027 5374 6172 745f 436f 646f 6e5f  ,. 'Start_Codon_
-00054cc0: 4465 6c27 2c0a 2027 5374 6172 745f 436f  Del',. 'Start_Co
-00054cd0: 646f 6e5f 496e 7327 2c0a 2027 5374 6172  don_Ins',. 'Star
-00054ce0: 745f 436f 646f 6e5f 534e 5027 2c0a 2027  t_Codon_SNP',. '
-00054cf0: 5374 6f70 5f43 6f64 6f6e 5f44 656c 272c  Stop_Codon_Del',
-00054d00: 0a20 2753 746f 705f 436f 646f 6e5f 496e  . 'Stop_Codon_In
-00054d10: 7327 0a0a 2027 355f 7072 696d 655f 466c  s'.. '5_prime_Fl
-00054d20: 616e 6b27 2c0a 2027 5370 6c69 6365 5f53  ank',. 'Splice_S
-00054d30: 6974 6527 2c0a 2027 496e 7472 6f6e 272c  ite',. 'Intron',
-00054d40: 0a20 2744 655f 6e6f 766f 5f53 7461 7274  . 'De_novo_Start
-00054d50: 5f4f 7574 4f66 4672 616d 6527 2c0a 2027  _OutOfFrame',. '
-00054d60: 4947 5227 2c0a 2727 270a 0a64 6566 2073  IGR',.'''..def s
-00054d70: 6f72 745f 6774 665f 6c69 6e65 7328 6774  ort_gtf_lines(gt
-00054d80: 665f 6c69 6e65 7329 3a0a 0a20 2020 2070  f_lines):..    p
-00054d90: 6f73 5f6c 7374 203d 205b 5d0a 2020 2020  os_lst = [].    
-00054da0: 666f 7220 6774 666c 2069 6e20 6774 665f  for gtfl in gtf_
-00054db0: 6c69 6e65 733a 0a20 2020 2020 2020 2070  lines:.        p
-00054dc0: 6f73 5f6c 7374 2e61 7070 656e 6428 6774  os_lst.append(gt
-00054dd0: 666c 2e73 7461 7274 290a 2020 2020 706f  fl.start).    po
-00054de0: 735f 6c73 7420 3d20 6e70 2e61 7272 6179  s_lst = np.array
-00054df0: 2870 6f73 5f6c 7374 290a 2020 2020 6f64  (pos_lst).    od
-00054e00: 7220 3d20 706f 735f 6c73 742e 6172 6773  r = pos_lst.args
-00054e10: 6f72 7428 290a 2020 2020 6774 665f 6c69  ort().    gtf_li
-00054e20: 6e65 735f 736f 7274 6564 203d 205b 5d0a  nes_sorted = [].
-00054e30: 2020 2020 666f 7220 6f20 696e 206f 6472      for o in odr
-00054e40: 3a0a 2020 2020 2020 2020 6774 665f 6c69  :.        gtf_li
-00054e50: 6e65 735f 736f 7274 6564 2e61 7070 656e  nes_sorted.appen
-00054e60: 6428 6774 665f 6c69 6e65 735b 6f5d 290a  d(gtf_lines[o]).
-00054e70: 2020 2020 7265 7475 726e 2067 7466 5f6c      return gtf_l
-00054e80: 696e 6573 5f73 6f72 7465 640a 0a0a 4e56  ines_sorted...NV
-00054e90: 5f69 6e66 6f5f 6578 7420 3d20 636f 6c6c  _info_ext = coll
-00054ea0: 6563 7469 6f6e 732e 6e61 6d65 6474 7570  ections.namedtup
-00054eb0: 6c65 2827 4e56 5f69 6e66 6f5f 6578 7427  le('NV_info_ext'
-00054ec0: 2c20 2763 6872 2c20 706f 735f 7265 662c  , 'chr, pos_ref,
-00054ed0: 2070 6f73 5f6e 6577 2c20 6765 6e65 5f69   pos_new, gene_i
-00054ee0: 642c 2067 656e 655f 6e61 6d65 2c20 765f  d, gene_name, v_
-00054ef0: 7479 7065 2c20 765f 6c65 6e2c 2063 7667  type, v_len, cvg
-00054f00: 5f64 6570 7468 2c20 6376 675f 6672 6163  _depth, cvg_frac
-00054f10: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00054f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054f30: 2020 2020 2020 2020 2020 7265 665f 7072            ref_pr
-00054f40: 6576 2c20 7265 665f 7365 712c 2072 6566  ev, ref_seq, ref
-00054f50: 5f6e 6578 742c 2061 6c74 5f70 7265 762c  _next, alt_prev,
-00054f60: 2061 6c74 5f73 6571 2c20 616c 745f 6e65   alt_seq, alt_ne
-00054f70: 7874 2c20 765f 636c 6173 732c 2076 5f63  xt, v_class, v_c
-00054f80: 6c61 7373 5f74 7227 2920 2320 6f6e 652d  lass_tr') # one-
-00054f90: 6261 7365 0a0a 636c 6173 7320 6765 6e65  base..class gene
-00054fa0: 5f64 6573 6372 6970 746f 723a 0a0a 2020  _descriptor:..  
-00054fb0: 2020 6465 6620 696e 6974 2873 656c 662c    def init(self,
-00054fc0: 2067 7270 2c20 7665 7262 6f73 6520 3d20   grp, verbose = 
-00054fd0: 4661 6c73 6529 3a0a 0a20 2020 2020 2020  False):..       
-00054fe0: 2073 656c 662e 6763 6e74 203d 2067 7270   self.gcnt = grp
-00054ff0: 2e67 636e 740a 2020 2020 2020 2020 7365  .gcnt.        se
-00055000: 6c66 2e72 6561 645f 6c65 6e20 3d20 6772  lf.read_len = gr
-00055010: 702e 7265 6164 5f6c 656e 0a20 2020 2020  p.read_len.     
-00055020: 2020 200a 2020 2020 2020 2020 2727 270a     .        '''.
-00055030: 2020 2020 2020 2020 7365 6c66 2e69 6364          self.icd
-00055040: 7320 3d20 6963 6473 0a20 2020 2020 2020  s = icds.       
-00055050: 2073 656c 662e 6368 7220 3d20 2727 0a20   self.chr = ''. 
-00055060: 2020 2020 2020 2073 656c 662e 6265 6769         self.begi
-00055070: 6e20 3d20 2d31 0a20 2020 2020 2020 2073  n = -1.        s
-00055080: 656c 662e 656e 6420 3d20 2d31 0a0a 2020  elf.end = -1..  
-00055090: 2020 2020 2020 7365 6c66 2e65 786f 6e73        self.exons
-000550a0: 203d 2072 6567 696f 6e73 2829 0a20 2020   = regions().   
-000550b0: 2020 2020 2073 656c 662e 6364 7320 3d20       self.cds = 
-000550c0: 7265 6769 6f6e 7328 290a 2020 2020 2020  regions().      
-000550d0: 2020 7365 6c66 2e72 676e 7320 3d20 7265    self.rgns = re
-000550e0: 6769 6f6e 7328 290a 2020 2020 2020 2020  gions().        
-000550f0: 0a20 2020 2020 2020 2073 656c 662e 6e74  .        self.nt
-00055100: 7220 3d20 300a 2020 2020 2020 2020 7365  r = 0.        se
-00055110: 6c66 2e74 645f 6c73 7420 3d20 5b5d 0a20  lf.td_lst = []. 
-00055120: 2020 2020 2020 2073 656c 662e 7465 5f74         self.te_t
-00055130: 6f5f 6765 5f6d 6170 7320 3d20 5b5d 0a20  o_ge_maps = []. 
-00055140: 2020 2020 2020 2073 656c 662e 7463 5f74         self.tc_t
-00055150: 6f5f 6763 5f6d 6170 7320 3d20 5b5d 0a20  o_gc_maps = []. 
-00055160: 2020 2020 2020 2073 656c 662e 7472 5f74         self.tr_t
-00055170: 6f5f 6772 5f6d 6170 7320 3d20 5b5d 0a20  o_gr_maps = []. 
-00055180: 2020 2020 2020 2073 656c 662e 7472 5f69         self.tr_i
-00055190: 6e66 6f20 3d20 5b5d 0a20 2020 2020 2020  nfo = [].       
-000551a0: 2073 656c 662e 6e76 5f69 6e66 6f5f 6c73   self.nv_info_ls
-000551b0: 7420 3d20 5b5d 0a20 2020 2020 2020 200a  t = [].        .
-000551c0: 2020 2020 2020 2020 7365 6c66 2e74 5f61          self.t_a
-000551d0: 626e 203d 202d 310a 2020 2020 2020 2020  bn = -1.        
-000551e0: 7365 6c66 2e72 5f74 706d 203d 202d 310a  self.r_tpm = -1.
-000551f0: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-00055200: 2020 2020 0a20 2020 2020 2020 2023 2073      .        # s
-00055210: 6574 2063 6872 2c20 6265 6769 6e2c 2065  et chr, begin, e
-00055220: 6e64 0a20 2020 2020 2020 2066 6f72 206e  nd.        for n
-00055230: 6f64 6520 696e 2067 7270 2e6e 6f64 6573  ode in grp.nodes
-00055240: 2e72 676e 733a 0a20 2020 2020 2020 2020  .rgns:.         
-00055250: 2020 2069 6620 7365 6c66 2e62 6567 696e     if self.begin
-00055260: 203c 2030 3a20 7365 6c66 2e62 6567 696e   < 0: self.begin
-00055270: 203d 206e 6f64 652e 7374 6172 740a 2020   = node.start.  
-00055280: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-00055290: 7365 6c66 2e62 6567 696e 203d 206d 696e  self.begin = min
-000552a0: 2820 6e6f 6465 2e73 7461 7274 2c20 7365  ( node.start, se
-000552b0: 6c66 2e62 6567 696e 2029 0a20 2020 2020  lf.begin ).     
-000552c0: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
-000552d0: 6e64 203c 2030 3a20 7365 6c66 2e65 6e64  nd < 0: self.end
-000552e0: 203d 206e 6f64 652e 656e 640a 2020 2020   = node.end.    
-000552f0: 2020 2020 2020 2020 656c 7365 3a20 7365          else: se
-00055300: 6c66 2e65 6e64 203d 206d 6178 2820 6e6f  lf.end = max( no
-00055310: 6465 2e65 6e64 2c20 7365 6c66 2e65 6e64  de.end, self.end
-00055320: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
-00055330: 6620 7365 6c66 2e63 6872 203d 3d20 2727  f self.chr == ''
-00055340: 3a20 7365 6c66 2e63 6872 203d 206e 6f64  : self.chr = nod
-00055350: 652e 6368 720a 0a20 2020 2020 2020 2072  e.chr..        r
-00055360: 6574 7572 6e0a 0a0a 2020 2020 6465 6620  eturn...    def 
-00055370: 6164 645f 7472 2873 656c 662c 206e 6f64  add_tr(self, nod
-00055380: 6573 2c20 6564 6765 732c 2070 5f6c 7374  es, edges, p_lst
-00055390: 2c20 7472 5f69 6e66 6f5f 6c73 742c 2076  , tr_info_lst, v
-000553a0: 6572 626f 7365 203d 2046 616c 7365 293a  erbose = False):
-000553b0: 0a0a 2020 2020 2020 2020 6e5f 7020 3d20  ..        n_p = 
-000553c0: 6c65 6e28 705f 6c73 7429 0a20 2020 2020  len(p_lst).     
-000553d0: 2020 206e 5f6e 6f64 6573 203d 206c 656e     n_nodes = len
-000553e0: 286e 6f64 6573 2e72 676e 7329 0a0a 2020  (nodes.rgns)..  
-000553f0: 2020 2020 2020 6966 206e 5f70 2021 3d20        if n_p != 
-00055400: 6c65 6e28 7472 5f69 6e66 6f5f 6c73 7429  len(tr_info_lst)
-00055410: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00055420: 696e 7428 2725 6920 213d 2025 6927 2025  int('%i != %i' %
-00055430: 2028 6e5f 702c 206c 656e 2874 725f 696e   (n_p, len(tr_in
-00055440: 666f 5f6c 7374 2929 290a 2020 2020 2020  fo_lst))).      
-00055450: 2020 0a20 2020 2020 2020 2023 2073 6574    .        # set
-00055460: 2063 6872 2c20 6265 6769 6e2c 2065 6e64   chr, begin, end
-00055470: 0a20 2020 2020 2020 2066 6f72 206e 6f64  .        for nod
-00055480: 6520 696e 206e 6f64 6573 2e72 676e 733a  e in nodes.rgns:
-00055490: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000554a0: 7365 6c66 2e62 6567 696e 203c 2030 3a20  self.begin < 0: 
-000554b0: 7365 6c66 2e62 6567 696e 203d 206e 6f64  self.begin = nod
-000554c0: 652e 7374 6172 740a 2020 2020 2020 2020  e.start.        
-000554d0: 2020 2020 656c 7365 3a20 7365 6c66 2e62      else: self.b
-000554e0: 6567 696e 203d 206d 696e 2820 6e6f 6465  egin = min( node
-000554f0: 2e73 7461 7274 2c20 7365 6c66 2e62 6567  .start, self.beg
-00055500: 696e 2029 0a20 2020 2020 2020 2020 2020  in ).           
-00055510: 2069 6620 7365 6c66 2e65 6e64 203c 2030   if self.end < 0
-00055520: 3a20 7365 6c66 2e65 6e64 203d 206e 6f64  : self.end = nod
-00055530: 652e 656e 640a 2020 2020 2020 2020 2020  e.end.          
-00055540: 2020 656c 7365 3a20 7365 6c66 2e65 6e64    else: self.end
-00055550: 203d 206d 6178 2820 6e6f 6465 2e65 6e64   = max( node.end
-00055560: 2c20 7365 6c66 2e65 6e64 2029 0a20 2020  , self.end ).   
-00055570: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00055580: 2e63 6872 203d 3d20 2727 3a20 7365 6c66  .chr == '': self
-00055590: 2e63 6872 203d 206e 6f64 652e 6368 720a  .chr = node.chr.
-000555a0: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
-000555b0: 6e20 7261 6e67 6528 6e5f 7029 3a0a 2020  n range(n_p):.  
-000555c0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-000555d0: 655f 746f 5f67 655f 6d61 7073 2e61 7070  e_to_ge_maps.app
-000555e0: 656e 6428 5b5d 290a 2020 2020 2020 2020  end([]).        
-000555f0: 2020 2020 7365 6c66 2e74 635f 746f 5f67      self.tc_to_g
-00055600: 635f 6d61 7073 2e61 7070 656e 6428 5b5d  c_maps.append([]
-00055610: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00055620: 6c66 2e74 725f 746f 5f67 725f 6d61 7073  lf.tr_to_gr_maps
-00055630: 2e61 7070 656e 6428 5b5d 290a 0a20 2020  .append([])..   
-00055640: 2020 2020 2066 6f72 206b 2069 6e20 7261       for k in ra
-00055650: 6e67 6528 6e5f 7029 3a0a 0a20 2020 2020  nge(n_p):..     
-00055660: 2020 2020 2020 2069 6620 6e5f 7020 213d         if n_p !=
-00055670: 206c 656e 2874 725f 696e 666f 5f6c 7374   len(tr_info_lst
-00055680: 293a 2070 7269 6e74 2827 6b20 3d20 2569  ): print('k = %i
-00055690: 2720 2520 6b29 0a20 2020 2020 2020 200a  ' % k).        .
-000556a0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-000556b0: 203d 2070 5f6c 7374 5b6b 5d0a 2020 2020   = p_lst[k].    
-000556c0: 2020 2020 2020 2020 7267 6e73 203d 2072          rgns = r
-000556d0: 6567 696f 6e73 2829 0a20 2020 2020 2020  egions().       
-000556e0: 2020 2020 2072 676e 7332 203d 2072 6567       rgns2 = reg
-000556f0: 696f 6e73 5f6e 6428 290a 2020 2020 2020  ions_nd().      
-00055700: 2020 2020 2020 666c 6167 203d 2030 0a20        flag = 0. 
-00055710: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-00055720: 2069 6e20 7061 7468 3a0a 2020 2020 2020   in path:.      
-00055730: 2020 2020 2020 2020 2020 6966 206e 203c            if n <
-00055740: 206e 5f6e 6f64 6573 3a0a 2020 2020 2020   n_nodes:.      
-00055750: 2020 2020 2020 2020 2020 2020 2020 7267                rg
-00055760: 6e73 2e72 676e 732e 6170 7065 6e64 286e  ns.rgns.append(n
-00055770: 6f64 6573 2e72 676e 735b 6e5d 2e63 6f70  odes.rgns[n].cop
-00055780: 7928 7570 6461 7465 203d 2054 7275 6529  y(update = True)
-00055790: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000557a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000557b0: 2020 2020 2020 2020 2020 2020 6520 3d20              e = 
-000557c0: 6e20 2d20 6e5f 6e6f 6465 730a 2020 2020  n - n_nodes.    
-000557d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000557e0: 7267 6e73 322e 7267 6e73 2e61 7070 656e  rgns2.rgns.appen
-000557f0: 6428 6564 6765 732e 7267 6e73 5b65 5d2e  d(edges.rgns[e].
-00055800: 636f 7079 2875 7064 6174 6520 3d20 5472  copy(update = Tr
-00055810: 7565 2929 0a20 2020 2020 2020 2020 2020  ue)).           
-00055820: 2020 2020 2020 2020 2069 6620 6564 6765           if edge
-00055830: 732e 7267 6e73 5b65 5d2e 7479 7065 203d  s.rgns[e].type =
-00055840: 3d20 2744 273a 0a20 2020 2020 2020 2020  = 'D':.         
-00055850: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00055860: 676e 732e 7267 6e73 2e61 7070 656e 6428  gns.rgns.append(
-00055870: 6564 6765 732e 7267 6e73 5b65 5d2e 636f  edges.rgns[e].co
-00055880: 7079 2875 7064 6174 6520 3d20 5472 7565  py(update = True
-00055890: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-000558a0: 7464 203d 2074 7261 6e73 6372 6970 745f  td = transcript_
-000558b0: 6465 7363 7269 7074 6f72 2829 0a20 2020  descriptor().   
-000558c0: 2020 2020 2020 2020 2074 642e 7365 7428           td.set(
-000558d0: 2072 676e 732c 2074 725f 696e 666f 5f6c   rgns, tr_info_l
-000558e0: 7374 5b6b 5d20 290a 2020 2020 2020 2020  st[k] ).        
-000558f0: 2020 2020 7365 6c66 2e74 645f 6c73 742e      self.td_lst.
-00055900: 6170 7065 6e64 2874 6429 0a20 2020 2020  append(td).     
-00055910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055920: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00055930: 7365 6c66 2e61 6464 5f74 725f 7267 6e73  self.add_tr_rgns
-00055940: 2873 656c 662e 6e74 722b 6b2c 2072 676e  (self.ntr+k, rgn
-00055950: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-00055960: 656c 662e 7464 5f6c 7374 5b73 656c 662e  elf.td_lst[self.
-00055970: 6e74 722b 6b5d 2e63 6f76 5f6c 656e 203d  ntr+k].cov_len =
-00055980: 2072 676e 732e 636f 756e 745f 7661 6c69   rgns.count_vali
-00055990: 645f 4e54 2829 2023 2067 6574 5f63 6f76  d_NT() # get_cov
-000559a0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000559b0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000559c0: 7365 6c66 2e6e 7472 202b 3d20 6e5f 700a  self.ntr += n_p.
-000559d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000559e0: 2072 6574 7572 6e0a 0a0a 2020 2020 6465   return...    de
-000559f0: 6620 6368 6563 6b5f 6e76 5f70 6f73 2820  f check_nv_pos( 
-00055a00: 7365 6c66 2c20 6e76 5f73 7061 6e20 293a  self, nv_span ):
-00055a10: 0a20 2020 2020 2020 2072 6573 203d 2030  .        res = 0
-00055a20: 0a20 2020 2020 2020 2062 203d 2054 7275  .        b = Tru
-00055a30: 650a 2020 2020 2020 2020 666f 7220 6d2c  e.        for m,
-00055a40: 2063 7220 696e 2065 6e75 6d65 7261 7465   cr in enumerate
-00055a50: 2873 656c 662e 6364 732e 7267 6e73 293a  (self.cds.rgns):
-00055a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00055a70: 6372 2e68 6173 5f65 7874 5f69 6e74 6572  cr.has_ext_inter
-00055a80: 7365 6374 696f 6e5f 7769 7468 2820 6e76  section_with( nv
-00055a90: 5f73 7061 6e20 293a 0a20 2020 2020 2020  _span ):.       
-00055aa0: 2020 2020 2020 2020 2069 6620 6372 2e74           if cr.t
-00055ab0: 7970 652e 6c6f 7765 7228 2920 3d3d 2027  ype.lower() == '
-00055ac0: 7374 6172 745f 636f 646f 6e27 3a0a 2020  start_codon':.  
-00055ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055ae0: 2020 7265 7320 3d20 310a 2020 2020 2020    res = 1.      
-00055af0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
-00055b00: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00055b10: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00055b20: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00055b30: 2020 656c 6966 2063 722e 7479 7065 2e6c    elif cr.type.l
-00055b40: 6f77 6572 2829 203d 3d20 2773 746f 705f  ower() == 'stop_
-00055b50: 636f 646f 6e27 3a0a 2020 2020 2020 2020  codon':.        
-00055b60: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-00055b70: 3d20 320a 2020 2020 2020 2020 2020 2020  = 2.            
-00055b80: 2020 2020 2020 2020 6220 3d20 4661 6c73          b = Fals
-00055b90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00055ba0: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
-00055bb0: 2020 2020 2069 6620 623a 0a20 2020 2020       if b:.     
-00055bc0: 2020 2020 2020 2066 6f72 206d 2c20 6372         for m, cr
-00055bd0: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-00055be0: 6c66 2e63 6473 2e72 676e 7329 3a0a 2020  lf.cds.rgns):.  
-00055bf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00055c00: 2063 722e 6861 735f 6578 745f 696e 7465   cr.has_ext_inte
-00055c10: 7273 6563 7469 6f6e 5f77 6974 6828 206e  rsection_with( n
-00055c20: 765f 7370 616e 2029 3a0a 2020 2020 2020  v_span ):.      
-00055c30: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00055c40: 2063 722e 7479 7065 2e6c 6f77 6572 2829   cr.type.lower()
-00055c50: 203d 3d20 2763 6473 273a 0a20 2020 2020   == 'cds':.     
-00055c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055c70: 2020 2072 6573 203d 2033 0a20 2020 2020     res = 3.     
-00055c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055c90: 2020 2062 203d 2046 616c 7365 0a20 2020     b = False.   
-00055ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055cb0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-00055cc0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00055cd0: 2020 2020 2020 2020 6966 2062 3a0a 2020          if b:.  
-00055ce0: 2020 2020 2020 2020 2020 666f 7220 6d2c            for m,
-00055cf0: 2063 7220 696e 2065 6e75 6d65 7261 7465   cr in enumerate
-00055d00: 2873 656c 662e 6364 732e 7267 6e73 293a  (self.cds.rgns):
-00055d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00055d20: 2069 6620 6372 2e68 6173 5f65 7874 5f69   if cr.has_ext_i
-00055d30: 6e74 6572 7365 6374 696f 6e5f 7769 7468  ntersection_with
-00055d40: 2820 6e76 5f73 7061 6e20 293a 0a20 2020  ( nv_span ):.   
-00055d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055d60: 2072 6573 203d 2063 722e 7479 7065 0a20   res = cr.type. 
-00055d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055d80: 2020 2062 203d 2046 616c 7365 0a20 2020     b = False.   
-00055d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055da0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00055db0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00055dc0: 6966 2062 3a0a 2020 2020 2020 2020 2020  if b:.          
-00055dd0: 2020 6769 6420 3d20 276e 6f74 5f69 6465    gid = 'not_ide
-00055de0: 6e74 6966 6965 6427 0a20 2020 2020 2020  ntified'.       
-00055df0: 2020 2020 2067 6e61 6d65 203d 2027 6e6f       gname = 'no
-00055e00: 745f 6964 656e 7469 6669 6564 270a 2020  t_identified'.  
-00055e10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00055e20: 2020 2020 2020 2020 675f 6964 7320 3d20          g_ids = 
-00055e30: 5b5d 0a20 2020 2020 2020 2020 2020 2067  [].            g
-00055e40: 5f6e 616d 6573 203d 205b 5d0a 2020 2020  _names = [].    
-00055e50: 2020 2020 2020 2020 666f 7220 6b2c 2074          for k, t
-00055e60: 676d 2069 6e20 656e 756d 6572 6174 6528  gm in enumerate(
-00055e70: 7365 6c66 2e74 635f 746f 5f67 635f 6d61  self.tc_to_gc_ma
-00055e80: 7073 293a 0a20 2020 2020 2020 2020 2020  ps):.           
-00055e90: 2020 2020 2023 6966 206c 656e 2873 656c       #if len(sel
-00055ea0: 662e 7464 5f6c 7374 5b6b 5d2e 6173 6571  f.td_lst[k].aseq
-00055eb0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-00055ec0: 2020 2020 2020 2069 6620 6d20 696e 2074         if m in t
-00055ed0: 676d 3a0a 2020 2020 2020 2020 2020 2020  gm:.            
-00055ee0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00055ef0: 7464 5f6c 7374 5b6b 5d2e 6769 6420 6e6f  td_lst[k].gid no
-00055f00: 7420 696e 2067 5f69 6473 3a0a 2020 2020  t in g_ids:.    
-00055f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055f20: 2020 2020 675f 6964 732e 6170 7065 6e64      g_ids.append
-00055f30: 2873 656c 662e 7464 5f6c 7374 5b6b 5d2e  (self.td_lst[k].
-00055f40: 6769 6429 0a20 2020 2020 2020 2020 2020  gid).           
-00055f50: 2020 2020 2020 2020 2020 2020 2067 5f6e               g_n
-00055f60: 616d 6573 2e61 7070 656e 6428 7365 6c66  ames.append(self
-00055f70: 2e74 645f 6c73 745b 6b5d 2e67 6e61 6d65  .td_lst[k].gname
-00055f80: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00055f90: 6620 6c65 6e28 675f 6964 7329 203d 3d20  f len(g_ids) == 
-00055fa0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00055fb0: 2020 2067 6964 2c20 676e 616d 6520 3d20     gid, gname = 
-00055fc0: 2727 2c20 2727 0a20 2020 2020 2020 2020  '', ''.         
-00055fd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00055fe0: 2020 2020 2020 2020 2067 6964 203d 2067           gid = g
-00055ff0: 5f69 6473 5b30 5d0a 2020 2020 2020 2020  _ids[0].        
-00056000: 2020 2020 2020 2020 6966 206c 656e 2867          if len(g
-00056010: 5f69 6473 2920 3e20 313a 0a20 2020 2020  _ids) > 1:.     
-00056020: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00056030: 6f72 2061 2069 6e20 675f 6964 735b 313a  or a in g_ids[1:
-00056040: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00056050: 2020 2020 2020 2020 2020 2067 6964 203d             gid =
-00056060: 2067 6964 202b 2027 3b25 7327 2025 2061   gid + ';%s' % a
-00056070: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00056080: 2020 676e 616d 6520 3d20 675f 6e61 6d65    gname = g_name
-00056090: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
-000560a0: 2020 2020 2069 6620 6c65 6e28 675f 6e61       if len(g_na
-000560b0: 6d65 7329 203e 2031 3a0a 2020 2020 2020  mes) > 1:.      
-000560c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000560d0: 7220 6120 696e 2067 5f6e 616d 6573 5b31  r a in g_names[1
-000560e0: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
-000560f0: 2020 2020 2020 2020 2020 2020 676e 616d              gnam
-00056100: 6520 3d20 676e 616d 6520 2b20 273b 2573  e = gname + ';%s
-00056110: 2720 2520 610a 2020 2020 2020 2020 2020  ' % a.          
-00056120: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00056130: 2020 2072 6574 7572 6e20 7265 732c 2067     return res, g
-00056140: 6964 2c20 676e 616d 650a 0a20 2020 2064  id, gname..    d
-00056150: 6566 2063 6865 636b 5f6e 765f 706f 735f  ef check_nv_pos_
-00056160: 6578 6f6e 2820 7365 6c66 2c20 6e76 5f73  exon( self, nv_s
-00056170: 7061 6e20 293a 0a20 2020 2020 2020 2062  pan ):.        b
-00056180: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00056190: 7265 7320 3d20 2727 0a20 2020 2020 2020  res = ''.       
-000561a0: 2066 6f72 206d 2c20 6372 2069 6e20 656e   for m, cr in en
-000561b0: 756d 6572 6174 6528 7365 6c66 2e72 676e  umerate(self.rgn
-000561c0: 732e 7267 6e73 293a 0a20 2020 2020 2020  s.rgns):.       
-000561d0: 2020 2020 2069 6620 6372 2e68 6173 5f65       if cr.has_e
-000561e0: 7874 5f69 6e74 6572 7365 6374 696f 6e5f  xt_intersection_
-000561f0: 7769 7468 2820 6e76 5f73 7061 6e20 293a  with( nv_span ):
-00056200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00056210: 2072 6573 203d 2063 722e 7479 7065 0a20   res = cr.type. 
-00056220: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00056230: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00056240: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00056250: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00056260: 2020 2020 2020 2020 6966 2062 3a0a 2020          if b:.  
-00056270: 2020 2020 2020 2020 2020 6769 6420 3d20            gid = 
-00056280: 276e 6f74 5f69 6465 6e74 6966 6965 645f  'not_identified_
-00056290: 3227 0a20 2020 2020 2020 2020 2020 2067  2'.            g
-000562a0: 6e61 6d65 203d 2027 6e6f 745f 6964 656e  name = 'not_iden
-000562b0: 7469 6669 6564 5f32 270a 2020 2020 2020  tified_2'.      
-000562c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000562d0: 2020 2020 675f 6964 7320 3d20 5b5d 0a20      g_ids = []. 
-000562e0: 2020 2020 2020 2020 2020 2067 5f6e 616d             g_nam
-000562f0: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
-00056300: 2020 2020 666f 7220 6b2c 2074 676d 2069      for k, tgm i
-00056310: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-00056320: 2e74 725f 746f 5f67 725f 6d61 7073 293a  .tr_to_gr_maps):
-00056330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00056340: 2069 6620 6d20 696e 2074 676d 3a0a 2020   if m in tgm:.  
-00056350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056360: 2020 6966 2073 656c 662e 7464 5f6c 7374    if self.td_lst
-00056370: 5b6b 5d2e 6769 6420 6e6f 7420 696e 2067  [k].gid not in g
-00056380: 5f69 6473 3a0a 2020 2020 2020 2020 2020  _ids:.          
-00056390: 2020 2020 2020 2020 2020 2020 2020 675f                g_
-000563a0: 6964 732e 6170 7065 6e64 2873 656c 662e  ids.append(self.
-000563b0: 7464 5f6c 7374 5b6b 5d2e 6769 6429 0a20  td_lst[k].gid). 
+00052460: 7072 696e 7428 2745 5252 4f52 3a20 6361  print('ERROR: ca
+00052470: 6e6e 6f74 2066 696e 6420 7661 6c69 6420  nnot find valid 
+00052480: 4f52 4620 2842 2920 666f 7220 2573 2028  ORF (B) for %s (
+00052490: 2569 293a 2025 692c 2569 202d 2025 692c  %i): %i,%i - %i,
+000524a0: 2569 2027 2025 205c 0a20 2020 2020 2020  %i ' % \.       
+000524b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000524c0: 2020 2020 2873 656c 662e 7469 642c 2069      (self.tid, i
+000524d0: 7374 7261 6e64 2c20 625f 7374 6172 742c  strand, b_start,
+000524e0: 2073 7461 7274 5f63 6f64 6f6e 5f70 6f73   start_codon_pos
+000524f0: 2c20 625f 7374 6f70 2c20 7374 6f70 5f63  , b_stop, stop_c
+00052500: 6f64 6f6e 5f70 6f73 2929 0a20 2020 2020  odon_pos)).     
+00052510: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00052520: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+00052530: 2020 2020 0a20 2020 2020 2020 200a 2020      .        .  
+00052540: 2020 2020 2020 6966 2028 7374 6172 745f        if (start_
+00052550: 636f 646f 6e5f 706f 7320 3c20 3029 2026  codon_pos < 0) &
+00052560: 2028 7374 6f70 5f63 6f64 6f6e 5f70 6f73   (stop_codon_pos
+00052570: 203e 3d20 3029 3a0a 2020 2020 2020 2020   >= 0):.        
+00052580: 2020 2020 7374 6172 745f 636f 646f 6e5f      start_codon_
+00052590: 706f 7320 3d20 7374 6f70 5f63 6f64 6f6e  pos = stop_codon
+000525a0: 5f70 6f73 2533 0a20 2020 2020 2020 2020  _pos%3.         
+000525b0: 2020 200a 2020 2020 2020 2020 6966 2028     .        if (
+000525c0: 7374 6172 745f 636f 646f 6e5f 706f 7320  start_codon_pos 
+000525d0: 3e3d 2030 2920 2620 2873 746f 705f 636f  >= 0) & (stop_co
+000525e0: 646f 6e5f 706f 7320 3e3d 2030 293a 0a20  don_pos >= 0):. 
+000525f0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00052600: 7472 616e 6420 3e20 303a 0a20 2020 2020  trand > 0:.     
+00052610: 2020 2020 2020 2020 2020 2070 7365 7120             pseq 
+00052620: 3d20 7365 715b 7374 6172 745f 636f 646f  = seq[start_codo
+00052630: 6e5f 706f 733a 2873 746f 705f 636f 646f  n_pos:(stop_codo
+00052640: 6e5f 706f 7329 5d0a 2020 2020 2020 2020  n_pos)].        
+00052650: 2020 2020 2020 2020 6173 6571 203d 2074          aseq = t
+00052660: 7261 6e73 6c61 7465 2870 7365 7129 0a20  ranslate(pseq). 
+00052670: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00052680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052690: 6162 735f 7374 6172 7420 3d20 6c6f 662e  abs_start = lof.
+000526a0: 6162 735f 706f 7328 7374 6172 745f 636f  abs_pos(start_co
+000526b0: 646f 6e5f 706f 7329 0a20 2020 2020 2020  don_pos).       
+000526c0: 2020 2020 2020 2020 2023 2073 7461 7274           # start
+000526d0: 5f63 6f64 6f6e 5f70 6f73 5f61 6273 203d  _codon_pos_abs =
+000526e0: 2028 6162 735f 7374 6172 742c 2061 6273   (abs_start, abs
+000526f0: 5f73 7461 7274 2b32 290a 2020 2020 2020  _start+2).      
+00052700: 2020 2020 2020 2020 2020 6162 735f 7374            abs_st
+00052710: 6f70 203d 206c 6f66 2e61 6273 5f70 6f73  op = lof.abs_pos
+00052720: 2873 746f 705f 636f 646f 6e5f 706f 7329  (stop_codon_pos)
+00052730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00052740: 2023 2073 746f 705f 636f 646f 6e5f 706f   # stop_codon_po
+00052750: 735f 6162 7320 3d20 2861 6273 5f73 746f  s_abs = (abs_sto
+00052760: 702c 2061 6273 5f73 746f 702b 3229 0a20  p, abs_stop+2). 
+00052770: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00052780: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00052790: 2069 7374 7261 6e64 203c 2030 3a0a 2020   istrand < 0:.  
+000527a0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000527b0: 6172 7420 3d20 6c65 6e28 7365 7129 202d  art = len(seq) -
+000527c0: 2073 746f 705f 636f 646f 6e5f 706f 730a   stop_codon_pos.
+000527d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000527e0: 7374 6f70 203d 206c 656e 2873 6571 2920  stop = len(seq) 
+000527f0: 2d20 7374 6172 745f 636f 646f 6e5f 706f  - start_codon_po
+00052800: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00052810: 2020 2320 7073 6571 3220 3d20 7265 7665    # pseq2 = reve
+00052820: 7273 655f 636f 6d70 6c65 6d65 6e74 2870  rse_complement(p
+00052830: 7365 7129 0a20 2020 2020 2020 2020 2020  seq).           
+00052840: 2020 2020 2070 7365 7120 3d20 7265 7665       pseq = reve
+00052850: 7273 655f 636f 6d70 6c65 6d65 6e74 2873  rse_complement(s
+00052860: 6571 5b73 7461 7274 3a73 746f 705d 290a  eq[start:stop]).
+00052870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052880: 6173 6571 203d 2074 7261 6e73 6c61 7465  aseq = translate
+00052890: 2870 7365 7129 0a20 2020 2020 2020 2020  (pseq).         
+000528a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000528b0: 2020 2020 2020 2020 6162 735f 7374 6172          abs_star
+000528c0: 7420 3d20 6c6f 662e 6162 735f 706f 7328  t = lof.abs_pos(
+000528d0: 6c65 6e28 7365 7129 202d 2028 7374 6172  len(seq) - (star
+000528e0: 745f 636f 646f 6e5f 706f 732b 3329 290a  t_codon_pos+3)).
+000528f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052900: 2320 7374 6172 745f 636f 646f 6e5f 706f  # start_codon_po
+00052910: 7320 3d20 2861 6273 5f73 7461 7274 2c20  s = (abs_start, 
+00052920: 6162 735f 7374 6172 742b 3229 0a20 2020  abs_start+2).   
+00052930: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00052940: 2020 2020 2020 2020 2020 2020 2020 6162                ab
+00052950: 735f 7374 6f70 203d 206c 6f66 2e61 6273  s_stop = lof.abs
+00052960: 5f70 6f73 286c 656e 2873 6571 2920 2d20  _pos(len(seq) - 
+00052970: 2873 746f 705f 636f 646f 6e5f 706f 732b  (stop_codon_pos+
+00052980: 3329 290a 2020 2020 2020 2020 2020 2020  3)).            
+00052990: 2020 2020 2320 7374 6f70 5f63 6f64 6f6e      # stop_codon
+000529a0: 5f70 6f73 203d 2028 6162 735f 7374 6f70  _pos = (abs_stop
+000529b0: 2c20 6162 735f 7374 6f70 2b32 290a 2020  , abs_stop+2).  
+000529c0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000529d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000529e0: 2020 2020 6364 735f 6e65 772c 2062 6520      cds_new, be 
+000529f0: 3d20 6c6f 662e 6765 745f 6364 735f 7265  = lof.get_cds_re
+00052a00: 6769 6f6e 7328 2073 7461 7274 5f63 6f64  gions( start_cod
+00052a10: 6f6e 5f70 6f73 2c20 7374 6f70 5f63 6f64  on_pos, stop_cod
+00052a20: 6f6e 5f70 6f73 2c20 6c65 6e28 7365 7129  on_pos, len(seq)
+00052a30: 2c20 7365 6c66 2e63 6872 2c20 6973 7472  , self.chr, istr
+00052a40: 616e 6429 0a20 2020 2020 2020 2020 2020  and).           
+00052a50: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+00052a60: 2073 7461 7274 5f63 6f64 6f6e 5f70 6f73   start_codon_pos
+00052a70: 203d 3d20 7374 6172 745f 636f 646f 6e5f   == start_codon_
+00052a80: 706f 735f 6f72 673a 0a20 2020 2020 2020  pos_org:.       
+00052a90: 2020 2020 2020 2020 2063 6473 5f6e 6577           cds_new
+00052aa0: 2e72 676e 732e 6170 7065 6e64 2820 7265  .rgns.append( re
+00052ab0: 6769 6f6e 2873 656c 662e 6368 722c 2061  gion(self.chr, a
+00052ac0: 6273 5f73 7461 7274 2c20 6162 735f 7374  bs_start, abs_st
+00052ad0: 6172 742b 322c 2027 7374 6172 745f 636f  art+2, 'start_co
+00052ae0: 646f 6e27 2920 290a 2020 2020 2020 2020  don') ).        
+00052af0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00052b00: 2020 2020 2020 2020 2020 6364 735f 6e65            cds_ne
+00052b10: 772e 7267 6e73 2e61 7070 656e 6428 2072  w.rgns.append( r
+00052b20: 6567 696f 6e28 7365 6c66 2e63 6872 2c20  egion(self.chr, 
+00052b30: 6162 735f 7374 6172 742c 2061 6273 5f73  abs_start, abs_s
+00052b40: 7461 7274 2b32 2c20 2773 7461 7274 5f63  tart+2, 'start_c
+00052b50: 6f64 6f6e 2729 2029 0a20 2020 2020 2020  odon') ).       
+00052b60: 2020 2020 2020 2020 2023 2063 6473 5f6e           # cds_n
+00052b70: 6577 2e72 676e 732e 6170 7065 6e64 2820  ew.rgns.append( 
+00052b80: 7265 6769 6f6e 2873 656c 662e 6368 722c  region(self.chr,
+00052b90: 2061 6273 5f73 7461 7274 2c20 6162 735f   abs_start, abs_
+00052ba0: 7374 6172 742b 322c 2027 5354 4152 545f  start+2, 'START_
+00052bb0: 434f 444f 4e27 2920 290a 2020 2020 2020  CODON') ).      
+00052bc0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00052bd0: 2020 2020 2020 2069 6620 7374 6f70 5f63         if stop_c
+00052be0: 6f64 6f6e 5f70 6f73 203d 3d20 7374 6f70  odon_pos == stop
+00052bf0: 5f63 6f64 6f6e 5f70 6f73 5f6f 7267 3a0a  _codon_pos_org:.
+00052c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052c10: 6364 735f 6e65 772e 7267 6e73 2e61 7070  cds_new.rgns.app
+00052c20: 656e 6428 2072 6567 696f 6e28 7365 6c66  end( region(self
+00052c30: 2e63 6872 2c20 6162 735f 7374 6f70 2c20  .chr, abs_stop, 
+00052c40: 6162 735f 7374 6f70 2b32 2c20 2773 746f  abs_stop+2, 'sto
+00052c50: 705f 636f 646f 6e27 2920 290a 2020 2020  p_codon') ).    
+00052c60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00052c70: 2020 2020 2020 2020 2020 2020 2020 6364                cd
+00052c80: 735f 6e65 772e 7267 6e73 2e61 7070 656e  s_new.rgns.appen
+00052c90: 6428 2072 6567 696f 6e28 7365 6c66 2e63  d( region(self.c
+00052ca0: 6872 2c20 6162 735f 7374 6f70 2c20 6162  hr, abs_stop, ab
+00052cb0: 735f 7374 6f70 2b32 2c20 2773 746f 705f  s_stop+2, 'stop_
+00052cc0: 636f 646f 6e27 2920 290a 2020 2020 2020  codon') ).      
+00052cd0: 2020 2020 2020 2020 2020 2320 6364 735f            # cds_
+00052ce0: 6e65 772e 7267 6e73 2e61 7070 656e 6428  new.rgns.append(
+00052cf0: 2072 6567 696f 6e28 7365 6c66 2e63 6872   region(self.chr
+00052d00: 2c20 6162 735f 7374 6f70 2c20 6162 735f  , abs_stop, abs_
+00052d10: 7374 6f70 2b32 2c20 2753 544f 505f 434f  stop+2, 'STOP_CO
+00052d20: 444f 4e27 2920 290a 2020 2020 2020 2020  DON') ).        
+00052d30: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00052d40: 2020 2020 2023 2070 7269 6e74 2827 2b2b       # print('++
+00052d50: 2b20 2573 202b 2b2b 2720 2520 7365 6c66  + %s +++' % self
+00052d60: 2e74 6964 2029 0a20 2020 2020 2020 2020  .tid ).         
+00052d70: 2020 2023 2063 6473 5f6e 6577 2e70 7269     # cds_new.pri
+00052d80: 6e74 5f73 686f 7274 2829 0a20 2020 2020  nt_short().     
+00052d90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00052da0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00052db0: 2020 2020 2020 6265 203d 2046 616c 7365        be = False
+00052dc0: 0a20 2020 2020 2020 2020 2020 2070 7365  .            pse
+00052dd0: 7120 3d20 2727 0a20 2020 2020 2020 2020  q = ''.         
+00052de0: 2020 2061 7365 7120 3d20 2727 0a20 2020     aseq = ''.   
+00052df0: 2020 2020 2020 2020 2063 6473 5f6e 6577           cds_new
+00052e00: 203d 2072 6567 696f 6e73 2829 0a0a 2020   = regions()..  
+00052e10: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
+00052e20: 2020 2072 6574 7572 6e20 6173 6571 2c20     return aseq, 
+00052e30: 7073 6571 2c20 6364 735f 6e65 772c 2061  pseq, cds_new, a
+00052e40: 6273 5f73 7461 7274 2c20 6162 735f 7374  bs_start, abs_st
+00052e50: 6f70 2c20 7374 6172 745f 636f 646f 6e5f  op, start_codon_
+00052e60: 7374 6174 7573 2c20 7374 6f70 5f63 6f64  status, stop_cod
+00052e70: 6f6e 5f73 7461 7475 732c 2062 650a 2020  on_status, be.  
+00052e80: 2020 2020 2020 0a20 2020 2020 2020 200a        .        .
+00052e90: 2020 2020 6465 6620 6765 745f 7365 715f      def get_seq_
+00052ea0: 6672 6f6d 5f67 656e 6f6d 6528 7365 6c66  from_genome(self
+00052eb0: 2c20 6578 6f6e 732c 2063 6473 2c20 6765  , exons, cds, ge
+00052ec0: 6e6f 6d65 293a 0a20 2020 2020 2020 200a  nome):.        .
+00052ed0: 2020 2020 2020 2020 7473 6571 203d 2027          tseq = '
+00052ee0: 270a 2020 2020 2020 2020 7073 6571 203d  '.        pseq =
+00052ef0: 2027 270a 2020 2020 2020 2020 7374 6172   ''.        star
+00052f00: 745f 7365 7120 3d20 2727 0a20 2020 2020  t_seq = ''.     
+00052f10: 2020 2073 746f 705f 7365 7120 3d20 2727     stop_seq = ''
+00052f20: 0a20 2020 2020 2020 2073 7461 7274 5f63  .        start_c
+00052f30: 6f64 6f6e 5f70 6f73 203d 202d 310a 2020  odon_pos = -1.  
+00052f40: 2020 2020 2020 7374 6172 745f 636f 646f        start_codo
+00052f50: 6e5f 706f 735f 6f72 6720 3d20 2d31 0a20  n_pos_org = -1. 
+00052f60: 2020 2020 2020 2073 746f 705f 636f 646f         stop_codo
+00052f70: 6e5f 706f 7320 3d20 2d31 0a20 2020 2020  n_pos = -1.     
+00052f80: 2020 2073 746f 705f 636f 646f 6e5f 706f     stop_codon_po
+00052f90: 735f 6f72 6720 3d20 2d31 0a20 2020 2020  s_org = -1.     
+00052fa0: 2020 200a 2020 2020 2020 2020 6966 2063     .        if c
+00052fb0: 6473 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ds is not None:.
+00052fc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00052fd0: 6b2c 2065 2069 6e20 656e 756d 6572 6174  k, e in enumerat
+00052fe0: 6528 6364 732e 7267 6e73 293a 0a20 2020  e(cds.rgns):.   
+00052ff0: 2020 2020 2020 2020 2020 2020 2063 6872               chr
+00053000: 6d20 3d20 652e 6368 720a 2020 2020 2020  m = e.chr.      
+00053010: 2020 2020 2020 2020 2020 7374 6172 7420            start 
+00053020: 3d20 652e 7374 6172 7420 2d31 0a20 2020  = e.start -1.   
+00053030: 2020 2020 2020 2020 2020 2020 2065 6e64               end
+00053040: 203d 2065 2e65 6e64 0a20 2020 2020 2020   = e.end.       
+00053050: 2020 2020 2020 2020 2073 6571 203d 2067           seq = g
+00053060: 656e 6f6d 655b 6368 726d 5d2e 7365 715b  enome[chrm].seq[
+00053070: 7374 6172 743a 656e 645d 0a0a 2020 2020  start:end]..    
+00053080: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00053090: 652e 7479 7065 203d 3d20 2743 4453 2729  e.type == 'CDS')
+000530a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000530b0: 2020 2020 2020 7073 6571 203d 2070 7365        pseq = pse
+000530c0: 7120 2b20 7365 710a 0a20 2020 2020 2020  q + seq..       
+000530d0: 2020 2020 2020 2020 2065 6c69 6620 2865           elif (e
+000530e0: 2e74 7970 6520 3d3d 2027 7374 6172 745f  .type == 'start_
+000530f0: 636f 646f 6e27 293a 0a20 2020 2020 2020  codon'):.       
+00053100: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00053110: 7274 5f73 6571 203d 2073 6571 0a20 2020  rt_seq = seq.   
+00053120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053130: 2073 7461 7274 5f63 6f64 6f6e 5f70 6f73   start_codon_pos
+00053140: 5f6f 7267 203d 2065 2e73 7461 7274 0a0a  _org = e.start..
+00053150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053160: 656c 6966 2028 652e 7479 7065 203d 3d20  elif (e.type == 
+00053170: 2773 746f 705f 636f 646f 6e27 293a 0a20  'stop_codon'):. 
+00053180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053190: 2020 2073 746f 705f 7365 7120 3d20 7365     stop_seq = se
+000531a0: 710a 2020 2020 2020 2020 2020 2020 2020  q.              
+000531b0: 2020 2020 2020 7374 6f70 5f63 6f64 6f6e        stop_codon
+000531c0: 5f70 6f73 5f6f 7267 203d 2065 2e73 7461  _pos_org = e.sta
+000531d0: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
+000531e0: 2020 200a 2020 2020 2020 2020 7374 6172     .        star
+000531f0: 745f 636f 646f 6e5f 696e 6420 3d20 4661  t_codon_ind = Fa
+00053200: 6c73 650a 2020 2020 2020 2020 706f 735f  lse.        pos_
+00053210: 6c73 745f 616c 6c20 3d20 5b5d 0a20 2020  lst_all = [].   
+00053220: 2020 2020 2066 6f72 206b 2c20 6520 696e       for k, e in
+00053230: 2065 6e75 6d65 7261 7465 2865 786f 6e73   enumerate(exons
+00053240: 2e72 676e 7329 3a0a 2020 2020 2020 2020  .rgns):.        
+00053250: 2020 2020 6368 726d 203d 2065 2e63 6872      chrm = e.chr
+00053260: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00053270: 7274 203d 2065 2e73 7461 7274 202d 310a  rt = e.start -1.
+00053280: 2020 2020 2020 2020 2020 2020 656e 6420              end 
+00053290: 3d20 652e 656e 640a 2020 2020 2020 2020  = e.end.        
+000532a0: 2020 2020 7365 7120 3d20 6765 6e6f 6d65      seq = genome
+000532b0: 5b63 6872 6d5d 2e73 6571 5b73 7461 7274  [chrm].seq[start
+000532c0: 3a65 6e64 5d0a 2020 2020 2020 2020 2020  :end].          
+000532d0: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
+000532e0: 6620 2865 2e74 7970 6520 3d3d 2027 6578  f (e.type == 'ex
+000532f0: 6f6e 2729 3a0a 2020 2020 2020 2020 2020  on'):.          
+00053300: 2020 2020 2020 6966 2028 7374 6172 745f        if (start_
+00053310: 636f 646f 6e5f 706f 735f 6f72 6720 3e3d  codon_pos_org >=
+00053320: 2065 2e73 7461 7274 2920 2620 2873 7461   e.start) & (sta
+00053330: 7274 5f63 6f64 6f6e 5f70 6f73 5f6f 7267  rt_codon_pos_org
+00053340: 203c 3d20 652e 656e 6429 3a0a 2020 2020   <= e.end):.    
+00053350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053360: 7374 6172 745f 636f 646f 6e5f 706f 7320  start_codon_pos 
+00053370: 3d20 6c65 6e28 7473 6571 2920 2b20 7374  = len(tseq) + st
+00053380: 6172 745f 636f 646f 6e5f 706f 735f 6f72  art_codon_pos_or
+00053390: 6720 2d20 652e 7374 6172 740a 2020 2020  g - e.start.    
+000533a0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000533b0: 7374 6f70 5f63 6f64 6f6e 5f70 6f73 5f6f  stop_codon_pos_o
+000533c0: 7267 203e 3d20 652e 7374 6172 7429 2026  rg >= e.start) &
+000533d0: 2028 7374 6f70 5f63 6f64 6f6e 5f70 6f73   (stop_codon_pos
+000533e0: 5f6f 7267 203c 3d20 652e 656e 6429 3a0a  _org <= e.end):.
+000533f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053400: 2020 2020 7374 6f70 5f63 6f64 6f6e 5f70      stop_codon_p
+00053410: 6f73 203d 206c 656e 2874 7365 7129 202b  os = len(tseq) +
+00053420: 2073 746f 705f 636f 646f 6e5f 706f 735f   stop_codon_pos_
+00053430: 6f72 6720 2d20 652e 7374 6172 740a 2020  org - e.start.  
+00053440: 2020 2020 2020 2020 2020 2020 2020 7473                ts
+00053450: 6571 203d 2074 7365 7120 2b20 7365 710a  eq = tseq + seq.
+00053460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053470: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00053480: 2e69 7374 7261 6e64 203c 2030 3a0a 2020  .istrand < 0:.  
+00053490: 2020 2020 2020 2020 2020 7473 6571 203d            tseq =
+000534a0: 2072 6576 6572 7365 5f63 6f6d 706c 656d   reverse_complem
+000534b0: 656e 7428 7473 6571 290a 2020 2020 2020  ent(tseq).      
+000534c0: 2020 2020 2020 6966 2063 6473 2069 7320        if cds is 
+000534d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000534e0: 2020 2020 2020 2020 2020 7073 6571 203d            pseq =
+000534f0: 2072 6576 6572 7365 5f63 6f6d 706c 656d   reverse_complem
+00053500: 656e 7428 7073 6571 290a 2020 2020 2020  ent(pseq).      
+00053510: 2020 2020 2020 2020 2020 7374 6172 745f            start_
+00053520: 7365 7120 3d20 7265 7665 7273 655f 636f  seq = reverse_co
+00053530: 6d70 6c65 6d65 6e74 2873 7461 7274 5f73  mplement(start_s
+00053540: 6571 290a 2020 2020 2020 2020 2020 2020  eq).            
+00053550: 2020 2020 7374 6f70 5f73 6571 203d 2072      stop_seq = r
+00053560: 6576 6572 7365 5f63 6f6d 706c 656d 656e  everse_complemen
+00053570: 7428 7374 6f70 5f73 6571 290a 2020 2020  t(stop_seq).    
+00053580: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00053590: 7461 7274 5f63 6f64 6f6e 5f70 6f73 5f6f  tart_codon_pos_o
+000535a0: 7267 203e 3d20 303a 0a20 2020 2020 2020  rg >= 0:.       
+000535b0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+000535c0: 7274 5f63 6f64 6f6e 5f70 6f73 203d 206c  rt_codon_pos = l
+000535d0: 656e 2874 7365 7129 202d 2073 7461 7274  en(tseq) - start
+000535e0: 5f63 6f64 6f6e 5f70 6f73 202d 330a 2020  _codon_pos -3.  
+000535f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00053600: 2073 746f 705f 636f 646f 6e5f 706f 735f   stop_codon_pos_
+00053610: 6f72 6720 3e3d 2030 3a0a 2020 2020 2020  org >= 0:.      
+00053620: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00053630: 6f70 5f63 6f64 6f6e 5f70 6f73 203d 206c  op_codon_pos = l
+00053640: 656e 2874 7365 7129 202d 2073 746f 705f  en(tseq) - stop_
+00053650: 636f 646f 6e5f 706f 7320 2d33 0a20 2020  codon_pos -3.   
+00053660: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00053670: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00053680: 662e 6963 6473 2c20 7365 6c66 2e69 7374  f.icds, self.ist
+00053690: 7261 6e64 2c20 7473 6571 2c20 7073 6571  rand, tseq, pseq
+000536a0: 2c20 7374 6172 745f 7365 712c 2073 746f  , start_seq, sto
+000536b0: 705f 7365 712c 205c 0a20 2020 2020 2020  p_seq, \.       
+000536c0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+000536d0: 7274 5f63 6f64 6f6e 5f70 6f73 5f6f 7267  rt_codon_pos_org
+000536e0: 2c20 7374 6172 745f 636f 646f 6e5f 706f  , start_codon_po
+000536f0: 732c 2073 746f 705f 636f 646f 6e5f 706f  s, stop_codon_po
+00053700: 735f 6f72 672c 2073 746f 705f 636f 646f  s_org, stop_codo
+00053710: 6e5f 706f 730a 0a20 2020 2020 2020 2020  n_pos..         
+00053720: 2020 200a 2020 2020 6465 6620 6765 745f     .    def get_
+00053730: 7370 616e 2873 656c 6629 3a0a 2020 2020  span(self):.    
+00053740: 2020 2020 0a20 2020 2020 2020 2073 7061      .        spa
+00053750: 6e20 3d20 7265 6769 6f6e 2873 656c 662e  n = region(self.
+00053760: 6368 722c 2073 656c 662e 6265 6769 6e2c  chr, self.begin,
+00053770: 2073 656c 662e 656e 642c 2027 4d27 290a   self.end, 'M').
+00053780: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00053790: 7061 6e0a 2020 2020 0a20 2020 2064 6566  pan.    .    def
+000537a0: 2070 7269 6e74 5f73 686f 7274 2873 656c   print_short(sel
+000537b0: 6629 3a0a 2020 2020 2020 2020 0a20 2020  f):.        .   
+000537c0: 2020 2020 2063 5f6f 725f 6e20 3d20 6765       c_or_n = ge
+000537d0: 745f 7374 725f 636f 6469 6e67 5f73 7461  t_str_coding_sta
+000537e0: 7475 7328 7365 6c66 2e69 6364 7329 0a20  tus(self.icds). 
+000537f0: 2020 2020 2020 2073 7320 3d20 6765 745f         ss = get_
+00053800: 635f 6672 6f6d 5f69 7374 7261 6e64 2820  c_from_istrand( 
+00053810: 7365 6c66 2e69 7374 7261 6e64 2029 0a20  self.istrand ). 
+00053820: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00053830: 7072 696e 7428 2725 732c 2025 732c 2028  print('%s, %s, (
+00053840: 2573 2c20 2573 2927 2025 2028 7365 6c66  %s, %s)' % (self
+00053850: 2e69 642c 2073 656c 662e 6e61 6d65 2c20  .id, self.name, 
+00053860: 635f 6f72 5f6e 2c20 7373 2920 290a 2020  c_or_n, ss) ).  
+00053870: 2020 2020 2020 7072 696e 7428 2754 4c65        print('TLe
+00053880: 6e3a 2025 692c 2050 4c65 6e3a 2025 6920  n: %i, PLen: %i 
+00053890: 2825 342e 3166 2927 2025 2028 6c65 6e28  (%4.1f)' % (len(
+000538a0: 7365 6c66 2e74 7365 7129 2c20 6c65 6e28  self.tseq), len(
+000538b0: 7365 6c66 2e70 7365 7129 2c20 6c65 6e28  self.pseq), len(
+000538c0: 7365 6c66 2e70 7365 7129 2f33 2920 290a  self.pseq)/3) ).
+000538d0: 0a20 2020 2027 2727 0a20 2020 2054 7261  .    '''.    Tra
+000538e0: 6e73 6372 6970 7420 3d20 636f 6c6c 6563  nscript = collec
+000538f0: 7469 6f6e 732e 6e61 6d65 6474 7570 6c65  tions.namedtuple
+00053900: 2827 5472 616e 7363 7269 7074 272c 205c  ('Transcript', \
+00053910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053930: 2020 2020 2027 7072 6566 6978 2c20 6769       'prefix, gi
+00053940: 6478 2c20 6772 705f 7369 7a65 2c20 6963  dx, grp_size, ic
+00053950: 6e74 2c20 6368 722c 2073 7461 7274 2c20  nt, chr, start, 
+00053960: 656e 642c 205c 0a20 2020 2020 2020 2020  end, \.         
+00053970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053980: 2020 2020 2020 2020 2020 2020 7374 7261              stra
+00053990: 6e64 2c20 6364 6e67 2c20 7365 712c 2061  nd, cdng, seq, a
+000539a0: 626e 2c20 7470 6d2c 2069 736f 5f66 7261  bn, tpm, iso_fra
+000539b0: 632c 2070 726f 622c 206e 6578 732c 2067  c, prob, nexs, g
+000539c0: 766f 6c27 290a 2020 2020 2727 270a 2020  vol').    '''.  
+000539d0: 2020 6465 6620 7365 7428 7365 6c66 2c20    def set(self, 
+000539e0: 7267 6e73 2c20 7472 5f69 6e66 6f2c 2076  rgns, tr_info, v
+000539f0: 6572 626f 7365 203d 2046 616c 7365 293a  erbose = False):
+00053a00: 0a20 0a20 2020 2020 2020 2023 2073 656c  . .        # sel
+00053a10: 662e 6774 665f 6c69 6e65 7320 3d20 6774  f.gtf_lines = gt
+00053a20: 665f 6c69 6e65 735f 6f66 5f61 5f74 7220  f_lines_of_a_tr 
+00053a30: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00053a40: 7365 6c66 2e63 6872 203d 2074 725f 696e  self.chr = tr_in
+00053a50: 666f 2e63 6872 0a20 2020 2020 2020 2073  fo.chr.        s
+00053a60: 656c 662e 6265 6769 6e20 3d20 7472 5f69  elf.begin = tr_i
+00053a70: 6e66 6f2e 7374 6172 7420 2020 2020 200a  nfo.start      .
+00053a80: 2020 2020 2020 2020 7365 6c66 2e65 6e64          self.end
+00053a90: 203d 2074 725f 696e 666f 2e65 6e64 2020   = tr_info.end  
+00053aa0: 2020 2020 2020 0a20 2020 2020 2020 200a        .        .
+00053ab0: 2020 2020 2020 2020 7365 6c66 2e67 6964          self.gid
+00053ac0: 203d 2027 5346 4958 2e25 6927 2025 2028   = 'SFIX.%i' % (
+00053ad0: 7472 5f69 6e66 6f2e 6769 6478 2920 0a20  tr_info.gidx) . 
+00053ae0: 2020 2020 2020 2073 656c 662e 676e 616d         self.gnam
+00053af0: 6520 3d20 2753 4649 582e 2569 2720 2520  e = 'SFIX.%i' % 
+00053b00: 2874 725f 696e 666f 2e67 6964 7829 0a20  (tr_info.gidx). 
+00053b10: 2020 2020 2020 2073 656c 662e 7469 6420         self.tid 
+00053b20: 3d20 2753 4649 582e 2569 2e25 6927 2025  = 'SFIX.%i.%i' %
+00053b30: 2028 7472 5f69 6e66 6f2e 6769 6478 2c20   (tr_info.gidx, 
+00053b40: 7472 5f69 6e66 6f2e 6963 6e74 290a 2020  tr_info.icnt).  
+00053b50: 2020 2020 2020 7365 6c66 2e74 6e61 6d65        self.tname
+00053b60: 203d 2027 5346 4958 2e25 692e 2569 2720   = 'SFIX.%i.%i' 
+00053b70: 2520 2874 725f 696e 666f 2e67 6964 782c  % (tr_info.gidx,
+00053b80: 2074 725f 696e 666f 2e69 636e 7429 0a20   tr_info.icnt). 
+00053b90: 2020 2020 2020 2073 656c 662e 6973 7472         self.istr
+00053ba0: 616e 6420 3d20 7472 5f69 6e66 6f2e 7374  and = tr_info.st
+00053bb0: 7261 6e64 0a20 2020 2020 2020 2073 656c  rand.        sel
+00053bc0: 662e 6963 6473 203d 2067 6574 5f69 6364  f.icds = get_icd
+00053bd0: 6e67 5f66 726f 6d5f 7374 7228 2074 725f  ng_from_str( tr_
+00053be0: 696e 666f 2e63 646e 6720 2920 2020 2020  info.cdng )     
+00053bf0: 2020 2323 202d 313a 2075 6e73 7065 6369    ## -1: unspeci
+00053c00: 6669 6564 2c20 303a 206e 6f6e 2d63 6f64  fied, 0: non-cod
+00053c10: 696e 672c 2031 3a20 636f 6469 6e67 0a20  ing, 1: coding. 
+00053c20: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00053c30: 2323 2075 7365 6420 696e 2074 645f 616e  ## used in td_an
+00053c40: 645f 6165 0a20 2020 2020 2020 2023 2073  d_ae.        # s
+00053c50: 656c 662e 7465 5f74 6f5f 6765 5f6d 6170  elf.te_to_ge_map
+00053c60: 203d 205b 5d0a 2020 2020 2020 2020 2320   = [].        # 
+00053c70: 7365 6c66 2e74 635f 746f 5f67 635f 6d61  self.tc_to_gc_ma
+00053c80: 7020 3d20 5b5d 0a20 2020 2020 2020 2023  p = [].        #
+00053c90: 2073 656c 662e 7472 5f74 6f5f 6772 5f6d   self.tr_to_gr_m
+00053ca0: 6170 203d 205b 5d0a 2020 2020 2020 2020  ap = [].        
+00053cb0: 7365 6c66 2e61 626e 203d 2074 725f 696e  self.abn = tr_in
+00053cc0: 666f 2e61 626e 0a20 2020 2020 2020 2073  fo.abn.        s
+00053cd0: 656c 662e 636f 7620 3d20 310a 2020 2020  elf.cov = 1.    
+00053ce0: 2020 2020 7365 6c66 2e74 6c65 6e20 3d20      self.tlen = 
+00053cf0: 6c65 6e28 7472 5f69 6e66 6f2e 7365 7129  len(tr_info.seq)
+00053d00: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
+00053d10: 706c 656e 203d 202d 310a 2020 2020 2020  plen = -1.      
+00053d20: 2020 0a20 2020 2020 2020 2023 2073 656c    .        # sel
+00053d30: 662e 636f 765f 6c65 6e20 3d20 300a 2020  f.cov_len = 0.  
+00053d40: 2020 2020 2020 2320 7365 6c66 2e63 6f76        # self.cov
+00053d50: 5f72 6174 696f 203d 2030 0a0a 2020 2020  _ratio = 0..    
+00053d60: 2020 2020 2323 2054 656d 706f 7261 7279      ## Temporary
+00053d70: 2076 6172 6961 626c 6573 0a20 2020 2020   variables.     
+00053d80: 2020 2073 656c 662e 7072 6566 6978 203d     self.prefix =
+00053d90: 2074 725f 696e 666f 2e70 7265 6669 780a   tr_info.prefix.
+00053da0: 2020 2020 2020 2020 7365 6c66 2e67 766f          self.gvo
+00053db0: 6c20 3d20 7472 5f69 6e66 6f2e 6776 6f6c  l = tr_info.gvol
+00053dc0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00053dd0: 6f62 203d 2074 725f 696e 666f 2e70 726f  ob = tr_info.pro
+00053de0: 620a 2020 2020 2020 2020 7365 6c66 2e6e  b.        self.n
+00053df0: 6578 6f6e 7320 3d20 7472 5f69 6e66 6f2e  exons = tr_info.
+00053e00: 6e65 7873 0a20 2020 2020 2020 2023 2073  nexs.        # s
+00053e10: 656c 662e 6c65 6e5f 6f73 203d 202d 310a  elf.len_os = -1.
+00053e20: 2020 2020 2020 2020 2320 7365 6c66 2e70          # self.p
+00053e30: 6f73 5f73 7461 7274 203d 202d 3120 2023  os_start = -1  #
+00053e40: 2320 302d 6261 7365 0a20 2020 2020 2020  # 0-base.       
+00053e50: 2023 2073 656c 662e 706f 735f 7374 6f70   # self.pos_stop
+00053e60: 203d 202d 3120 2020 2323 2030 2d62 6173   = -1   ## 0-bas
+00053e70: 650a 2020 2020 2020 2020 0a20 2020 2020  e.        .     
+00053e80: 2020 2023 2320 5472 2069 6e66 6f0a 2020     ## Tr info.  
+00053e90: 2020 2020 2020 7365 6c66 2e74 706d 203d        self.tpm =
+00053ea0: 2074 725f 696e 666f 2e74 706d 0a20 2020   tr_info.tpm.   
+00053eb0: 2020 2020 2073 656c 662e 6963 6e74 203d       self.icnt =
+00053ec0: 2074 725f 696e 666f 2e69 636e 740a 2020   tr_info.icnt.  
+00053ed0: 2020 2020 2020 7365 6c66 2e67 7270 5f73        self.grp_s
+00053ee0: 697a 6520 3d20 7472 5f69 6e66 6f2e 6772  ize = tr_info.gr
+00053ef0: 705f 7369 7a65 0a20 2020 2020 2020 2073  p_size.        s
+00053f00: 656c 662e 6973 6f5f 6672 6163 203d 2074  elf.iso_frac = t
+00053f10: 725f 696e 666f 2e69 736f 5f66 7261 630a  r_info.iso_frac.
+00053f20: 0a20 2020 2020 2020 2023 2320 436f 646f  .        ## Codo
+00053f30: 6e20 706f 7320 616e 6420 7374 6174 7573  n pos and status
+00053f40: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
+00053f50: 7374 6172 745f 636f 646f 6e5f 706f 735f  start_codon_pos_
+00053f60: 6f72 6720 3d20 282d 312c 2d31 290a 2020  org = (-1,-1).  
+00053f70: 2020 2020 2020 2320 7365 6c66 2e73 746f        # self.sto
+00053f80: 705f 636f 646f 6e5f 706f 735f 6f72 6720  p_codon_pos_org 
+00053f90: 3d20 282d 312c 2d31 290a 2020 2020 2020  = (-1,-1).      
+00053fa0: 2020 0a20 2020 2020 2020 2023 2073 656c    .        # sel
+00053fb0: 662e 7374 6172 745f 636f 646f 6e5f 6576  f.start_codon_ev
+00053fc0: 656e 7420 3d20 2d31 0a20 2020 2020 2020  ent = -1.       
+00053fd0: 2023 2073 656c 662e 7374 6f70 5f63 6f64   # self.stop_cod
+00053fe0: 6f6e 5f65 7665 6e74 203d 202d 310a 2020  on_event = -1.  
+00053ff0: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00054000: 2073 656c 662e 7374 6172 745f 636f 646f   self.start_codo
+00054010: 6e5f 706f 7320 3d20 282d 312c 2d31 290a  n_pos = (-1,-1).
+00054020: 2020 2020 2020 2020 2320 7365 6c66 2e73          # self.s
+00054030: 746f 705f 636f 646f 6e5f 706f 7320 3d20  top_codon_pos = 
+00054040: 282d 312c 2d31 290a 0a20 2020 2020 2020  (-1,-1)..       
+00054050: 2023 2073 656c 662e 7374 6172 745f 636f   # self.start_co
+00054060: 646f 6e5f 7374 6174 7573 203d 202d 310a  don_status = -1.
+00054070: 2020 2020 2020 2020 2320 7365 6c66 2e73          # self.s
+00054080: 746f 705f 636f 646f 6e5f 7374 6174 7573  top_codon_status
+00054090: 203d 202d 310a 2020 2020 2020 2020 0a20   = -1.        . 
+000540a0: 2020 2020 2020 2023 2320 6669 6c6c 6564         ## filled
+000540b0: 2077 6974 6820 6765 745f 7365 715f 6672   with get_seq_fr
+000540c0: 6f6d 5f65 786f 6e73 2829 0a20 2020 2020  om_exons().     
+000540d0: 2020 2023 2073 656c 662e 6c6f 6620 3d20     # self.lof = 
+000540e0: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
+000540f0: 662e 7473 6571 203d 2074 725f 696e 666f  f.tseq = tr_info
+00054100: 2e73 6571 0a20 2020 2020 2020 2023 2073  .seq.        # s
+00054110: 656c 662e 7073 6571 203d 2027 270a 2020  elf.pseq = ''.  
+00054120: 2020 2020 2020 2320 7365 6c66 2e61 7365        # self.ase
+00054130: 7120 3d20 2727 0a20 2020 2020 2020 200a  q = ''.        .
+00054140: 0a20 2020 2020 2020 200a 2323 2323 2323  .        .######
+00054150: 2323 2323 2323 2323 2323 2323 0a23 2320  ############.## 
+00054160: 4765 6e65 2064 6573 6372 6970 746f 720a  Gene descriptor.
+00054170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00054180: 2323 0a0a 6465 6620 736f 7274 5f64 6573  ##..def sort_des
+00054190: 6372 6970 746f 725f 6c73 7428 645f 6c73  criptor_lst(d_ls
+000541a0: 742c 2072 6566 203d 2027 6368 7227 293a  t, ref = 'chr'):
+000541b0: 0a20 2020 200a 2020 2020 6966 2072 6566  .    .    if ref
+000541c0: 203d 3d20 2763 6872 273a 0a20 2020 2020   == 'chr':.     
+000541d0: 2020 2063 6872 7320 3d20 5b5d 0a20 2020     chrs = [].   
+000541e0: 2020 2020 2066 6f72 2064 2069 6e20 645f       for d in d_
+000541f0: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
+00054200: 2063 6872 732e 6170 7065 6e64 2864 2e63   chrs.append(d.c
+00054210: 6872 290a 0a20 2020 2020 2020 2063 6872  hr)..        chr
+00054220: 5f73 6574 203d 206c 6973 7428 7365 7428  _set = list(set(
+00054230: 6368 7273 2929 0a20 2020 2020 2020 2063  chrs)).        c
+00054240: 6872 5f73 6574 2e73 6f72 7428 290a 2020  hr_set.sort().  
+00054250: 2020 2020 2020 6368 7273 203d 206e 702e        chrs = np.
+00054260: 6172 7261 7928 6368 7273 290a 0a20 2020  array(chrs)..   
+00054270: 2020 2020 2064 5f6c 7374 5f6e 6577 203d       d_lst_new =
+00054280: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+00054290: 6320 696e 2063 6872 5f73 6574 3a0a 2020  c in chr_set:.  
+000542a0: 2020 2020 2020 2020 2020 7768 203d 2077            wh = w
+000542b0: 6869 6368 2863 6872 7320 3d3d 2063 290a  hich(chrs == c).
+000542c0: 2020 2020 2020 2020 2020 2020 7073 203d              ps =
+000542d0: 206e 702e 6172 7261 7928 205b 645f 6c73   np.array( [d_ls
+000542e0: 745b 775d 2e62 6567 696e 2066 6f72 2077  t[w].begin for w
+000542f0: 2069 6e20 7768 5d20 290a 2020 2020 2020   in wh] ).      
+00054300: 2020 2020 2020 6f64 7232 203d 2070 732e        odr2 = ps.
+00054310: 6172 6773 6f72 7428 290a 2020 2020 2020  argsort().      
+00054320: 2020 2020 2020 666f 7220 6f20 696e 206f        for o in o
+00054330: 6472 323a 0a20 2020 2020 2020 2020 2020  dr2:.           
+00054340: 2020 2020 2077 203d 2077 685b 6f5d 0a20       w = wh[o]. 
+00054350: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00054360: 5f6c 7374 5f6e 6577 2e61 7070 656e 6428  _lst_new.append(
+00054370: 645f 6c73 745b 775d 290a 2020 2020 656c  d_lst[w]).    el
+00054380: 7365 3a0a 2020 2020 2020 2020 706f 735f  se:.        pos_
+00054390: 6c73 7420 3d20 6e70 2e7a 6572 6f73 286c  lst = np.zeros(l
+000543a0: 656e 2864 5f6c 7374 2929 0a20 2020 2020  en(d_lst)).     
+000543b0: 2020 2066 6f72 206b 2c20 6420 696e 2065     for k, d in e
+000543c0: 6e75 6d65 7261 7465 2864 5f6c 7374 293a  numerate(d_lst):
+000543d0: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+000543e0: 5f6c 7374 5b6b 5d20 3d20 642e 6265 6769  _lst[k] = d.begi
+000543f0: 6e0a 2020 2020 2020 2020 6f64 7220 3d20  n.        odr = 
+00054400: 706f 735f 6c73 742e 6172 6773 6f72 7428  pos_lst.argsort(
+00054410: 290a 2020 2020 2020 2020 645f 6c73 745f  ).        d_lst_
+00054420: 6e65 7720 3d20 5b5d 0a20 2020 2020 2020  new = [].       
+00054430: 2066 6f72 206b 2069 6e20 6f64 723a 0a20   for k in odr:. 
+00054440: 2020 2020 2020 2020 2020 2064 5f6c 7374             d_lst
+00054450: 5f6e 6577 2e61 7070 656e 6428 645f 6c73  _new.append(d_ls
+00054460: 745b 6b5d 290a 2020 2020 2020 2020 0a20  t[k]).        . 
+00054470: 2020 2072 6574 7572 6e20 645f 6c73 745f     return d_lst_
+00054480: 6e65 770a 0a27 2727 0a63 6c61 7373 2073  new..'''.class s
+00054490: 706c 6963 655f 6772 6170 683a 0a20 2020  plice_graph:.   
+000544a0: 200a 2020 2020 6465 6620 5f5f 696e 6974   .    def __init
+000544b0: 5f5f 2873 656c 662c 2072 6561 645f 6c65  __(self, read_le
+000544c0: 6e2c 2063 6e74 203d 2030 293a 0a20 2020  n, cnt = 0):.   
+000544d0: 2020 2020 200a 2020 2020 2020 2020 7365       .        se
+000544e0: 6c66 2e72 6561 645f 6c65 6e20 3d20 7265  lf.read_len = re
+000544f0: 6164 5f6c 656e 0a20 2020 2020 2020 2073  ad_len.        s
+00054500: 656c 662e 6763 6e74 203d 2063 6e74 0a20  elf.gcnt = cnt. 
+00054510: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00054520: 7365 6c66 2e6e 5f6e 6f64 6573 203d 2030  self.n_nodes = 0
+00054530: 0a20 2020 2020 2020 2073 656c 662e 6e6f  .        self.no
+00054540: 6465 7320 3d20 7265 6769 6f6e 7328 290a  des = regions().
+00054550: 2020 2020 2020 2020 7365 6c66 2e67 7261          self.gra
+00054560: 7068 5f66 7764 203d 207b 7d0a 2020 2020  ph_fwd = {}.    
+00054570: 2020 2020 7365 6c66 2e67 7261 7068 5f62      self.graph_b
+00054580: 7764 203d 207b 7d0a 2020 2020 2020 2020  wd = {}.        
+00054590: 7365 6c66 2e6e 5f70 6174 6873 203d 2030  self.n_paths = 0
+000545a0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+000545b0: 7468 5f6c 7374 203d 205b 5d0a 0a20 2020  th_lst = []..   
+000545c0: 2020 2020 2073 656c 662e 6e5f 6564 6765       self.n_edge
+000545d0: 7320 3d20 300a 2020 2020 2020 2020 7365  s = 0.        se
+000545e0: 6c66 2e65 6467 6573 203d 2072 6567 696f  lf.edges = regio
+000545f0: 6e73 5f6e 6428 290a 2020 2020 2020 2020  ns_nd().        
+00054600: 7365 6c66 2e67 7261 7068 5f66 203d 207b  self.graph_f = {
+00054610: 7d0a 2020 2020 2020 2020 7365 6c66 2e67  }.        self.g
+00054620: 7261 7068 5f62 203d 207b 7d0a 2020 2020  raph_b = {}.    
+00054630: 2020 2020 7365 6c66 2e6e 5f70 203d 2030      self.n_p = 0
+00054640: 0a20 2020 2020 2020 2073 656c 662e 705f  .        self.p_
+00054650: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
+00054660: 2073 656c 662e 735f 6c73 7420 3d20 5b5d   self.s_lst = []
+00054670: 0a20 2020 2020 2020 2073 656c 662e 635f  .        self.c_
+00054680: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
+00054690: 2073 656c 662e 636f 765f 6c73 7420 3d20   self.cov_lst = 
+000546a0: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
+000546b0: 7374 7261 6e64 203d 2030 0a20 2020 2020  strand = 0.     
+000546c0: 2020 200a 2020 2020 2020 2020 7365 6c66     .        self
+000546d0: 2e63 7667 7320 3d20 4e6f 6e65 0a20 2020  .cvgs = None.   
+000546e0: 2020 2020 2073 656c 662e 6c65 6e73 203d       self.lens =
+000546f0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00054700: 6c66 2e61 626e 203d 204e 6f6e 650a 2020  lf.abn = None.  
+00054710: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
+00054720: 656c 662e 7920 3d20 4e6f 6e65 0a20 2020  elf.y = None.   
+00054730: 2020 2020 2073 656c 662e 4820 3d20 4e6f       self.H = No
+00054740: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00054750: 7a20 3d20 4e6f 6e65 0a20 2020 2020 2020  z = None.       
+00054760: 2073 656c 662e 4720 3d20 4e6f 6e65 0a20   self.G = None. 
+00054770: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00054780: 2323 204f 6e6c 7920 4659 490a 2020 2020  ## Only FYI.    
+00054790: 2020 2020 7365 6c66 2e6e 6f64 6573 5f6d      self.nodes_m
+000547a0: 696e 203d 205b 5d0a 2020 2020 2020 2020  in = [].        
+000547b0: 7365 6c66 2e6e 5f6e 6f64 6573 5f6d 696e  self.n_nodes_min
+000547c0: 203d 2030 0a20 2020 2020 2020 2073 656c   = 0.        sel
+000547d0: 662e 6e5f 6564 6765 735f 6d69 6e20 3d20  f.n_edges_min = 
+000547e0: 300a 2020 2020 2020 2020 7365 6c66 2e67  0.        self.g
+000547f0: 7261 7068 5f66 5f6d 696e 203d 207b 7d0a  raph_f_min = {}.
+00054800: 2020 2020 2020 2020 7365 6c66 2e67 7261          self.gra
+00054810: 7068 5f62 5f6d 696e 203d 207b 7d0a 2020  ph_b_min = {}.  
+00054820: 2020 2020 2020 7365 6c66 2e6e 5f70 5f6d        self.n_p_m
+00054830: 696e 203d 2030 0a20 2020 2020 2020 2073  in = 0.        s
+00054840: 656c 662e 705f 6c73 745f 6d69 6e20 3d20  elf.p_lst_min = 
+00054850: 5b5d 0a20 2020 2020 2020 200a 2020 2020  [].        .    
+00054860: 2020 2020 7365 6c66 2e63 7667 735f 6d69      self.cvgs_mi
+00054870: 6e20 3d20 4e6f 6e65 0a20 2020 2020 2020  n = None.       
+00054880: 2073 656c 662e 6c65 6e73 5f6d 696e 203d   self.lens_min =
+00054890: 204e 6f6e 650a 2020 2020 2020 2020 0a20   None.        . 
+000548a0: 2020 2020 2020 2073 656c 662e 7a5f 6d69         self.z_mi
+000548b0: 6e20 3d20 4e6f 6e65 0a20 2020 2020 2020  n = None.       
+000548c0: 2073 656c 662e 475f 6d69 6e20 3d20 4e6f   self.G_min = No
+000548d0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+000548e0: 2020 200a 2020 2020 2020 2020 7365 6c66     .        self
+000548f0: 2e6e 5f70 5f64 6574 6563 7465 6420 3d20  .n_p_detected = 
+00054900: 300a 2020 2020 2020 2020 7365 6c66 2e70  0.        self.p
+00054910: 5f6c 7374 5f64 6574 6563 7465 6420 3d20  _lst_detected = 
+00054920: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
+00054930: 6e5f 705f 6361 6e64 6964 6174 6520 3d20  n_p_candidate = 
+00054940: 300a 2020 2020 2020 2020 7365 6c66 2e70  0.        self.p
+00054950: 5f6c 7374 5f63 616e 6469 6461 7465 203d  _lst_candidate =
+00054960: 205b 5d0a 0a20 2020 2020 2020 2073 656c   []..        sel
+00054970: 662e 6269 7374 7261 6e64 6564 203d 2046  f.bistranded = F
+00054980: 616c 7365 0a20 2020 2020 2020 2073 656c  alse.        sel
+00054990: 662e 6e70 5f69 6e20 3d20 7365 6c66 2e6e  f.np_in = self.n
+000549a0: 5f70 0a20 2020 2020 2020 2073 656c 662e  _p.        self.
+000549b0: 6e70 5f6f 7574 203d 2073 656c 662e 6e5f  np_out = self.n_
+000549c0: 700a 0a53 4e56 5f69 6e66 6f20 3d20 636f  p..SNV_info = co
+000549d0: 6c6c 6563 7469 6f6e 732e 6e61 6d65 6474  llections.namedt
+000549e0: 7570 6c65 2827 534e 565f 696e 666f 272c  uple('SNV_info',
+000549f0: 2027 6368 722c 2070 6f73 5f72 6566 2c20   'chr, pos_ref, 
+00054a00: 706f 735f 6e65 772c 2067 656e 655f 6964  pos_new, gene_id
+00054a10: 2c20 6765 6e65 5f6e 616d 652c 2076 5f74  , gene_name, v_t
+00054a20: 7970 652c 2076 5f6c 656e 2c20 6376 675f  ype, v_len, cvg_
+00054a30: 6465 7074 682c 2063 7667 5f66 7261 632c  depth, cvg_frac,
+00054a40: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00054a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054a60: 2020 2020 2020 7265 665f 7072 6576 2c20        ref_prev, 
+00054a70: 7265 665f 7365 712c 2072 6566 5f6e 6578  ref_seq, ref_nex
+00054a80: 742c 2061 6c74 5f70 7265 762c 2061 6c74  t, alt_prev, alt
+00054a90: 5f73 6571 2c20 616c 745f 6e65 7874 2729  _seq, alt_next')
+00054aa0: 2023 206f 6e65 2d62 6173 650a 2020 2020   # one-base.    
+00054ab0: 2020 2020 0a27 2727 0a0a 2727 270a 765f      .'''..'''.v_
+00054ac0: 636c 6173 733a 200a 2027 335f 7072 696d  class: . '3_prim
+00054ad0: 655f 5554 5227 2c0a 2027 355f 7072 696d  e_UTR',. '5_prim
+00054ae0: 655f 5554 5227 2c0a 2027 4672 616d 655f  e_UTR',. 'Frame_
+00054af0: 5368 6966 745f 4465 6c27 2c0a 2027 4672  Shift_Del',. 'Fr
+00054b00: 616d 655f 5368 6966 745f 496e 7327 2c0a  ame_Shift_Ins',.
+00054b10: 2027 496e 5f46 7261 6d65 5f44 656c 272c   'In_Frame_Del',
+00054b20: 0a20 2749 6e5f 4672 616d 655f 496e 7327  . 'In_Frame_Ins'
+00054b30: 2c0a 2027 4d69 7373 656e 7365 5f4d 7574  ,. 'Missense_Mut
+00054b40: 6174 696f 6e27 2c0a 2027 4e6f 6e73 656e  ation',. 'Nonsen
+00054b50: 7365 5f4d 7574 6174 696f 6e27 2c20 2320  se_Mutation', # 
+00054b60: 534e 5020 2d3e 2073 746f 7020 6561 726c  SNP -> stop earl
+00054b70: 6965 720a 2027 4e6f 6e73 746f 705f 4d75  ier. 'Nonstop_Mu
+00054b80: 7461 7469 6f6e 272c 2020 2320 534e 5020  tation',  # SNP 
+00054b90: 2d3e 2073 746f 7020 6c61 7465 720a 2027  -> stop later. '
+00054ba0: 5369 6c65 6e74 272c 0a20 2753 7461 7274  Silent',. 'Start
+00054bb0: 5f43 6f64 6f6e 5f44 656c 272c 0a20 2753  _Codon_Del',. 'S
+00054bc0: 7461 7274 5f43 6f64 6f6e 5f49 6e73 272c  tart_Codon_Ins',
+00054bd0: 0a20 2753 7461 7274 5f43 6f64 6f6e 5f53  . 'Start_Codon_S
+00054be0: 4e50 272c 0a20 2753 746f 705f 436f 646f  NP',. 'Stop_Codo
+00054bf0: 6e5f 4465 6c27 2c0a 2027 5374 6f70 5f43  n_Del',. 'Stop_C
+00054c00: 6f64 6f6e 5f49 6e73 270a 0a20 2735 5f70  odon_Ins'.. '5_p
+00054c10: 7269 6d65 5f46 6c61 6e6b 272c 0a20 2753  rime_Flank',. 'S
+00054c20: 706c 6963 655f 5369 7465 272c 0a20 2749  plice_Site',. 'I
+00054c30: 6e74 726f 6e27 2c0a 2027 4465 5f6e 6f76  ntron',. 'De_nov
+00054c40: 6f5f 5374 6172 745f 4f75 744f 6646 7261  o_Start_OutOfFra
+00054c50: 6d65 272c 0a20 2749 4752 272c 0a27 2727  me',. 'IGR',.'''
+00054c60: 0a0a 6465 6620 736f 7274 5f67 7466 5f6c  ..def sort_gtf_l
+00054c70: 696e 6573 2867 7466 5f6c 696e 6573 293a  ines(gtf_lines):
+00054c80: 0a0a 2020 2020 706f 735f 6c73 7420 3d20  ..    pos_lst = 
+00054c90: 5b5d 0a20 2020 2066 6f72 2067 7466 6c20  [].    for gtfl 
+00054ca0: 696e 2067 7466 5f6c 696e 6573 3a0a 2020  in gtf_lines:.  
+00054cb0: 2020 2020 2020 706f 735f 6c73 742e 6170        pos_lst.ap
+00054cc0: 7065 6e64 2867 7466 6c2e 7374 6172 7429  pend(gtfl.start)
+00054cd0: 0a20 2020 2070 6f73 5f6c 7374 203d 206e  .    pos_lst = n
+00054ce0: 702e 6172 7261 7928 706f 735f 6c73 7429  p.array(pos_lst)
+00054cf0: 0a20 2020 206f 6472 203d 2070 6f73 5f6c  .    odr = pos_l
+00054d00: 7374 2e61 7267 736f 7274 2829 0a20 2020  st.argsort().   
+00054d10: 2067 7466 5f6c 696e 6573 5f73 6f72 7465   gtf_lines_sorte
+00054d20: 6420 3d20 5b5d 0a20 2020 2066 6f72 206f  d = [].    for o
+00054d30: 2069 6e20 6f64 723a 0a20 2020 2020 2020   in odr:.       
+00054d40: 2067 7466 5f6c 696e 6573 5f73 6f72 7465   gtf_lines_sorte
+00054d50: 642e 6170 7065 6e64 2867 7466 5f6c 696e  d.append(gtf_lin
+00054d60: 6573 5b6f 5d29 0a20 2020 2072 6574 7572  es[o]).    retur
+00054d70: 6e20 6774 665f 6c69 6e65 735f 736f 7274  n gtf_lines_sort
+00054d80: 6564 0a0a 0a4e 565f 696e 666f 5f65 7874  ed...NV_info_ext
+00054d90: 203d 2063 6f6c 6c65 6374 696f 6e73 2e6e   = collections.n
+00054da0: 616d 6564 7475 706c 6528 274e 565f 696e  amedtuple('NV_in
+00054db0: 666f 5f65 7874 272c 2027 6368 722c 2070  fo_ext', 'chr, p
+00054dc0: 6f73 5f72 6566 2c20 706f 735f 6e65 772c  os_ref, pos_new,
+00054dd0: 2067 656e 655f 6964 2c20 6765 6e65 5f6e   gene_id, gene_n
+00054de0: 616d 652c 2076 5f74 7970 652c 2076 5f6c  ame, v_type, v_l
+00054df0: 656e 2c20 6376 675f 6465 7074 682c 2063  en, cvg_depth, c
+00054e00: 7667 5f66 7261 632c 205c 0a20 2020 2020  vg_frac, \.     
+00054e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054e30: 2072 6566 5f70 7265 762c 2072 6566 5f73   ref_prev, ref_s
+00054e40: 6571 2c20 7265 665f 6e65 7874 2c20 616c  eq, ref_next, al
+00054e50: 745f 7072 6576 2c20 616c 745f 7365 712c  t_prev, alt_seq,
+00054e60: 2061 6c74 5f6e 6578 742c 2076 5f63 6c61   alt_next, v_cla
+00054e70: 7373 2c20 765f 636c 6173 735f 7472 2729  ss, v_class_tr')
+00054e80: 2023 206f 6e65 2d62 6173 650a 0a63 6c61   # one-base..cla
+00054e90: 7373 2067 656e 655f 6465 7363 7269 7074  ss gene_descript
+00054ea0: 6f72 3a0a 0a20 2020 2064 6566 2069 6e69  or:..    def ini
+00054eb0: 7428 7365 6c66 2c20 6772 702c 2076 6572  t(self, grp, ver
+00054ec0: 626f 7365 203d 2046 616c 7365 293a 0a0a  bose = False):..
+00054ed0: 2020 2020 2020 2020 7365 6c66 2e67 636e          self.gcn
+00054ee0: 7420 3d20 6772 702e 6763 6e74 0a20 2020  t = grp.gcnt.   
+00054ef0: 2020 2020 2073 656c 662e 7265 6164 5f6c       self.read_l
+00054f00: 656e 203d 2067 7270 2e72 6561 645f 6c65  en = grp.read_le
+00054f10: 6e0a 2020 2020 2020 2020 0a20 2020 2020  n.        .     
+00054f20: 2020 2027 2727 0a20 2020 2020 2020 2073     '''.        s
+00054f30: 656c 662e 6963 6473 203d 2069 6364 730a  elf.icds = icds.
+00054f40: 2020 2020 2020 2020 7365 6c66 2e63 6872          self.chr
+00054f50: 203d 2027 270a 2020 2020 2020 2020 7365   = ''.        se
+00054f60: 6c66 2e62 6567 696e 203d 202d 310a 2020  lf.begin = -1.  
+00054f70: 2020 2020 2020 7365 6c66 2e65 6e64 203d        self.end =
+00054f80: 202d 310a 0a20 2020 2020 2020 2073 656c   -1..        sel
+00054f90: 662e 6578 6f6e 7320 3d20 7265 6769 6f6e  f.exons = region
+00054fa0: 7328 290a 2020 2020 2020 2020 7365 6c66  s().        self
+00054fb0: 2e63 6473 203d 2072 6567 696f 6e73 2829  .cds = regions()
+00054fc0: 0a20 2020 2020 2020 2073 656c 662e 7267  .        self.rg
+00054fd0: 6e73 203d 2072 6567 696f 6e73 2829 0a20  ns = regions(). 
+00054fe0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00054ff0: 7365 6c66 2e6e 7472 203d 2030 0a20 2020  self.ntr = 0.   
+00055000: 2020 2020 2073 656c 662e 7464 5f6c 7374       self.td_lst
+00055010: 203d 205b 5d0a 2020 2020 2020 2020 7365   = [].        se
+00055020: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
+00055030: 203d 205b 5d0a 2020 2020 2020 2020 7365   = [].        se
+00055040: 6c66 2e74 635f 746f 5f67 635f 6d61 7073  lf.tc_to_gc_maps
+00055050: 203d 205b 5d0a 2020 2020 2020 2020 7365   = [].        se
+00055060: 6c66 2e74 725f 746f 5f67 725f 6d61 7073  lf.tr_to_gr_maps
+00055070: 203d 205b 5d0a 2020 2020 2020 2020 7365   = [].        se
+00055080: 6c66 2e74 725f 696e 666f 203d 205b 5d0a  lf.tr_info = [].
+00055090: 2020 2020 2020 2020 7365 6c66 2e6e 765f          self.nv_
+000550a0: 696e 666f 5f6c 7374 203d 205b 5d0a 2020  info_lst = [].  
+000550b0: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
+000550c0: 656c 662e 745f 6162 6e20 3d20 2d31 0a20  elf.t_abn = -1. 
+000550d0: 2020 2020 2020 2073 656c 662e 725f 7470         self.r_tp
+000550e0: 6d20 3d20 2d31 0a20 2020 2020 2020 2027  m = -1.        '
+000550f0: 2727 0a20 2020 2020 2020 200a 2020 2020  ''.        .    
+00055100: 2020 2020 2320 7365 7420 6368 722c 2062      # set chr, b
+00055110: 6567 696e 2c20 656e 640a 2020 2020 2020  egin, end.      
+00055120: 2020 666f 7220 6e6f 6465 2069 6e20 6772    for node in gr
+00055130: 702e 6e6f 6465 732e 7267 6e73 3a0a 2020  p.nodes.rgns:.  
+00055140: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00055150: 662e 6265 6769 6e20 3c20 303a 2073 656c  f.begin < 0: sel
+00055160: 662e 6265 6769 6e20 3d20 6e6f 6465 2e73  f.begin = node.s
+00055170: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
+00055180: 2065 6c73 653a 2073 656c 662e 6265 6769   else: self.begi
+00055190: 6e20 3d20 6d69 6e28 206e 6f64 652e 7374  n = min( node.st
+000551a0: 6172 742c 2073 656c 662e 6265 6769 6e20  art, self.begin 
+000551b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000551c0: 2073 656c 662e 656e 6420 3c20 303a 2073   self.end < 0: s
+000551d0: 656c 662e 656e 6420 3d20 6e6f 6465 2e65  elf.end = node.e
+000551e0: 6e64 0a20 2020 2020 2020 2020 2020 2065  nd.            e
+000551f0: 6c73 653a 2073 656c 662e 656e 6420 3d20  lse: self.end = 
+00055200: 6d61 7828 206e 6f64 652e 656e 642c 2073  max( node.end, s
+00055210: 656c 662e 656e 6420 290a 2020 2020 2020  elf.end ).      
+00055220: 2020 2020 2020 6966 2073 656c 662e 6368        if self.ch
+00055230: 7220 3d3d 2027 273a 2073 656c 662e 6368  r == '': self.ch
+00055240: 7220 3d20 6e6f 6465 2e63 6872 0a0a 2020  r = node.chr..  
+00055250: 2020 2020 2020 7265 7475 726e 0a0a 0a20        return... 
+00055260: 2020 2064 6566 2061 6464 5f74 7228 7365     def add_tr(se
+00055270: 6c66 2c20 6e6f 6465 732c 2065 6467 6573  lf, nodes, edges
+00055280: 2c20 705f 6c73 742c 2074 725f 696e 666f  , p_lst, tr_info
+00055290: 5f6c 7374 2c20 7665 7262 6f73 6520 3d20  _lst, verbose = 
+000552a0: 4661 6c73 6529 3a0a 0a20 2020 2020 2020  False):..       
+000552b0: 206e 5f70 203d 206c 656e 2870 5f6c 7374   n_p = len(p_lst
+000552c0: 290a 2020 2020 2020 2020 6e5f 6e6f 6465  ).        n_node
+000552d0: 7320 3d20 6c65 6e28 6e6f 6465 732e 7267  s = len(nodes.rg
+000552e0: 6e73 290a 0a20 2020 2020 2020 2069 6620  ns)..        if 
+000552f0: 6e5f 7020 213d 206c 656e 2874 725f 696e  n_p != len(tr_in
+00055300: 666f 5f6c 7374 293a 0a20 2020 2020 2020  fo_lst):.       
+00055310: 2020 2020 2070 7269 6e74 2827 2569 2021       print('%i !
+00055320: 3d20 2569 2720 2520 286e 5f70 2c20 6c65  = %i' % (n_p, le
+00055330: 6e28 7472 5f69 6e66 6f5f 6c73 7429 2929  n(tr_info_lst)))
+00055340: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00055350: 2020 2320 7365 7420 6368 722c 2062 6567    # set chr, beg
+00055360: 696e 2c20 656e 640a 2020 2020 2020 2020  in, end.        
+00055370: 666f 7220 6e6f 6465 2069 6e20 6e6f 6465  for node in node
+00055380: 732e 7267 6e73 3a0a 2020 2020 2020 2020  s.rgns:.        
+00055390: 2020 2020 6966 2073 656c 662e 6265 6769      if self.begi
+000553a0: 6e20 3c20 303a 2073 656c 662e 6265 6769  n < 0: self.begi
+000553b0: 6e20 3d20 6e6f 6465 2e73 7461 7274 0a20  n = node.start. 
+000553c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000553d0: 2073 656c 662e 6265 6769 6e20 3d20 6d69   self.begin = mi
+000553e0: 6e28 206e 6f64 652e 7374 6172 742c 2073  n( node.start, s
+000553f0: 656c 662e 6265 6769 6e20 290a 2020 2020  elf.begin ).    
+00055400: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00055410: 656e 6420 3c20 303a 2073 656c 662e 656e  end < 0: self.en
+00055420: 6420 3d20 6e6f 6465 2e65 6e64 0a20 2020  d = node.end.   
+00055430: 2020 2020 2020 2020 2065 6c73 653a 2073           else: s
+00055440: 656c 662e 656e 6420 3d20 6d61 7828 206e  elf.end = max( n
+00055450: 6f64 652e 656e 642c 2073 656c 662e 656e  ode.end, self.en
+00055460: 6420 290a 2020 2020 2020 2020 2020 2020  d ).            
+00055470: 6966 2073 656c 662e 6368 7220 3d3d 2027  if self.chr == '
+00055480: 273a 2073 656c 662e 6368 7220 3d20 6e6f  ': self.chr = no
+00055490: 6465 2e63 6872 0a0a 2020 2020 2020 2020  de.chr..        
+000554a0: 666f 7220 6b20 696e 2072 616e 6765 286e  for k in range(n
+000554b0: 5f70 293a 0a20 2020 2020 2020 2020 2020  _p):.           
+000554c0: 2073 656c 662e 7465 5f74 6f5f 6765 5f6d   self.te_to_ge_m
+000554d0: 6170 732e 6170 7065 6e64 285b 5d29 0a20  aps.append([]). 
+000554e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000554f0: 7463 5f74 6f5f 6763 5f6d 6170 732e 6170  tc_to_gc_maps.ap
+00055500: 7065 6e64 285b 5d29 0a20 2020 2020 2020  pend([]).       
+00055510: 2020 2020 2073 656c 662e 7472 5f74 6f5f       self.tr_to_
+00055520: 6772 5f6d 6170 732e 6170 7065 6e64 285b  gr_maps.append([
+00055530: 5d29 0a0a 2020 2020 2020 2020 666f 7220  ])..        for 
+00055540: 6b20 696e 2072 616e 6765 286e 5f70 293a  k in range(n_p):
+00055550: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00055560: 206e 5f70 2021 3d20 6c65 6e28 7472 5f69   n_p != len(tr_i
+00055570: 6e66 6f5f 6c73 7429 3a20 7072 696e 7428  nfo_lst): print(
+00055580: 276b 203d 2025 6927 2025 206b 290a 2020  'k = %i' % k).  
+00055590: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+000555a0: 2020 2070 6174 6820 3d20 705f 6c73 745b     path = p_lst[
+000555b0: 6b5d 0a20 2020 2020 2020 2020 2020 2072  k].            r
+000555c0: 676e 7320 3d20 7265 6769 6f6e 7328 290a  gns = regions().
+000555d0: 2020 2020 2020 2020 2020 2020 7267 6e73              rgns
+000555e0: 3220 3d20 7265 6769 6f6e 735f 6e64 2829  2 = regions_nd()
+000555f0: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+00055600: 6720 3d20 300a 2020 2020 2020 2020 2020  g = 0.          
+00055610: 2020 666f 7220 6e20 696e 2070 6174 683a    for n in path:
+00055620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055630: 2069 6620 6e20 3c20 6e5f 6e6f 6465 733a   if n < n_nodes:
+00055640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055650: 2020 2020 2072 676e 732e 7267 6e73 2e61       rgns.rgns.a
+00055660: 7070 656e 6428 6e6f 6465 732e 7267 6e73  ppend(nodes.rgns
+00055670: 5b6e 5d2e 636f 7079 2875 7064 6174 6520  [n].copy(update 
+00055680: 3d20 5472 7565 2929 0a20 2020 2020 2020  = True)).       
+00055690: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000556a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000556b0: 2020 2065 203d 206e 202d 206e 5f6e 6f64     e = n - n_nod
+000556c0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+000556d0: 2020 2020 2020 2072 676e 7332 2e72 676e         rgns2.rgn
+000556e0: 732e 6170 7065 6e64 2865 6467 6573 2e72  s.append(edges.r
+000556f0: 676e 735b 655d 2e63 6f70 7928 7570 6461  gns[e].copy(upda
+00055700: 7465 203d 2054 7275 6529 290a 2020 2020  te = True)).    
+00055710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055720: 6966 2065 6467 6573 2e72 676e 735b 655d  if edges.rgns[e]
+00055730: 2e74 7970 6520 3d3d 2027 4427 3a0a 2020  .type == 'D':.  
+00055740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055750: 2020 2020 2020 7267 6e73 2e72 676e 732e        rgns.rgns.
+00055760: 6170 7065 6e64 2865 6467 6573 2e72 676e  append(edges.rgn
+00055770: 735b 655d 2e63 6f70 7928 7570 6461 7465  s[e].copy(update
+00055780: 203d 2054 7275 6529 290a 0a20 2020 2020   = True))..     
+00055790: 2020 2020 2020 2074 6420 3d20 7472 616e         td = tran
+000557a0: 7363 7269 7074 5f64 6573 6372 6970 746f  script_descripto
+000557b0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+000557c0: 7464 2e73 6574 2820 7267 6e73 2c20 7472  td.set( rgns, tr
+000557d0: 5f69 6e66 6f5f 6c73 745b 6b5d 2029 0a20  _info_lst[k] ). 
+000557e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000557f0: 7464 5f6c 7374 2e61 7070 656e 6428 7464  td_lst.append(td
+00055800: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00055810: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00055820: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+00055830: 7472 5f72 676e 7328 7365 6c66 2e6e 7472  tr_rgns(self.ntr
+00055840: 2b6b 2c20 7267 6e73 290a 2020 2020 2020  +k, rgns).      
+00055850: 2020 2020 2020 7365 6c66 2e74 645f 6c73        self.td_ls
+00055860: 745b 7365 6c66 2e6e 7472 2b6b 5d2e 636f  t[self.ntr+k].co
+00055870: 765f 6c65 6e20 3d20 7267 6e73 2e63 6f75  v_len = rgns.cou
+00055880: 6e74 5f76 616c 6964 5f4e 5428 2920 2320  nt_valid_NT() # 
+00055890: 6765 745f 636f 7628 290a 2020 2020 2020  get_cov().      
+000558a0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+000558b0: 2020 2020 2020 2073 656c 662e 6e74 7220         self.ntr 
+000558c0: 2b3d 206e 5f70 0a20 2020 2020 2020 200a  += n_p.        .
+000558d0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+000558e0: 0a20 2020 2064 6566 2063 6865 636b 5f6e  .    def check_n
+000558f0: 765f 706f 7328 2073 656c 662c 206e 765f  v_pos( self, nv_
+00055900: 7370 616e 2029 3a0a 2020 2020 2020 2020  span ):.        
+00055910: 7265 7320 3d20 300a 2020 2020 2020 2020  res = 0.        
+00055920: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
+00055930: 2066 6f72 206d 2c20 6372 2069 6e20 656e   for m, cr in en
+00055940: 756d 6572 6174 6528 7365 6c66 2e63 6473  umerate(self.cds
+00055950: 2e72 676e 7329 3a0a 2020 2020 2020 2020  .rgns):.        
+00055960: 2020 2020 6966 2063 722e 6861 735f 6578      if cr.has_ex
+00055970: 745f 696e 7465 7273 6563 7469 6f6e 5f77  t_intersection_w
+00055980: 6974 6828 206e 765f 7370 616e 2029 3a0a  ith( nv_span ):.
+00055990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000559a0: 6966 2063 722e 7479 7065 2e6c 6f77 6572  if cr.type.lower
+000559b0: 2829 203d 3d20 2773 7461 7274 5f63 6f64  () == 'start_cod
+000559c0: 6f6e 273a 0a20 2020 2020 2020 2020 2020  on':.           
+000559d0: 2020 2020 2020 2020 2072 6573 203d 2031           res = 1
+000559e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000559f0: 2020 2020 2062 203d 2046 616c 7365 0a20       b = False. 
+00055a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055a10: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00055a20: 2020 2020 2020 2020 2065 6c69 6620 6372           elif cr
+00055a30: 2e74 7970 652e 6c6f 7765 7228 2920 3d3d  .type.lower() ==
+00055a40: 2027 7374 6f70 5f63 6f64 6f6e 273a 0a20   'stop_codon':. 
+00055a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055a60: 2020 2072 6573 203d 2032 0a20 2020 2020     res = 2.     
+00055a70: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00055a80: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00055a90: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00055aa0: 616b 0a0a 2020 2020 2020 2020 6966 2062  ak..        if b
+00055ab0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00055ac0: 7220 6d2c 2063 7220 696e 2065 6e75 6d65  r m, cr in enume
+00055ad0: 7261 7465 2873 656c 662e 6364 732e 7267  rate(self.cds.rg
+00055ae0: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
+00055af0: 2020 2020 2069 6620 6372 2e68 6173 5f65       if cr.has_e
+00055b00: 7874 5f69 6e74 6572 7365 6374 696f 6e5f  xt_intersection_
+00055b10: 7769 7468 2820 6e76 5f73 7061 6e20 293a  with( nv_span ):
+00055b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055b30: 2020 2020 2069 6620 6372 2e74 7970 652e       if cr.type.
+00055b40: 6c6f 7765 7228 2920 3d3d 2027 6364 7327  lower() == 'cds'
+00055b50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00055b60: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
+00055b70: 330a 2020 2020 2020 2020 2020 2020 2020  3.              
+00055b80: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
+00055b90: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00055ba0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00055bb0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00055bc0: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
+00055bd0: 6620 623a 0a20 2020 2020 2020 2020 2020  f b:.           
+00055be0: 2066 6f72 206d 2c20 6372 2069 6e20 656e   for m, cr in en
+00055bf0: 756d 6572 6174 6528 7365 6c66 2e63 6473  umerate(self.cds
+00055c00: 2e72 676e 7329 3a0a 2020 2020 2020 2020  .rgns):.        
+00055c10: 2020 2020 2020 2020 6966 2063 722e 6861          if cr.ha
+00055c20: 735f 6578 745f 696e 7465 7273 6563 7469  s_ext_intersecti
+00055c30: 6f6e 5f77 6974 6828 206e 765f 7370 616e  on_with( nv_span
+00055c40: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00055c50: 2020 2020 2020 2020 7265 7320 3d20 6372          res = cr
+00055c60: 2e74 7970 650a 2020 2020 2020 2020 2020  .type.          
+00055c70: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
+00055c80: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00055c90: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00055ca0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00055cb0: 2020 2020 2020 2069 6620 623a 0a20 2020         if b:.   
+00055cc0: 2020 2020 2020 2020 2067 6964 203d 2027           gid = '
+00055cd0: 6e6f 745f 6964 656e 7469 6669 6564 270a  not_identified'.
+00055ce0: 2020 2020 2020 2020 2020 2020 676e 616d              gnam
+00055cf0: 6520 3d20 276e 6f74 5f69 6465 6e74 6966  e = 'not_identif
+00055d00: 6965 6427 0a20 2020 2020 2020 2065 6c73  ied'.        els
+00055d10: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+00055d20: 5f69 6473 203d 205b 5d0a 2020 2020 2020  _ids = [].      
+00055d30: 2020 2020 2020 675f 6e61 6d65 7320 3d20        g_names = 
+00055d40: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+00055d50: 6f72 206b 2c20 7467 6d20 696e 2065 6e75  or k, tgm in enu
+00055d60: 6d65 7261 7465 2873 656c 662e 7463 5f74  merate(self.tc_t
+00055d70: 6f5f 6763 5f6d 6170 7329 3a0a 2020 2020  o_gc_maps):.    
+00055d80: 2020 2020 2020 2020 2020 2020 2369 6620              #if 
+00055d90: 6c65 6e28 7365 6c66 2e74 645f 6c73 745b  len(self.td_lst[
+00055da0: 6b5d 2e61 7365 7129 203e 2030 3a0a 2020  k].aseq) > 0:.  
+00055db0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00055dc0: 206d 2069 6e20 7467 6d3a 0a20 2020 2020   m in tgm:.     
+00055dd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00055de0: 6620 7365 6c66 2e74 645f 6c73 745b 6b5d  f self.td_lst[k]
+00055df0: 2e67 6964 206e 6f74 2069 6e20 675f 6964  .gid not in g_id
+00055e00: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00055e10: 2020 2020 2020 2020 2020 2067 5f69 6473             g_ids
+00055e20: 2e61 7070 656e 6428 7365 6c66 2e74 645f  .append(self.td_
+00055e30: 6c73 745b 6b5d 2e67 6964 290a 2020 2020  lst[k].gid).    
+00055e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055e50: 2020 2020 675f 6e61 6d65 732e 6170 7065      g_names.appe
+00055e60: 6e64 2873 656c 662e 7464 5f6c 7374 5b6b  nd(self.td_lst[k
+00055e70: 5d2e 676e 616d 6529 0a0a 2020 2020 2020  ].gname)..      
+00055e80: 2020 2020 2020 6966 206c 656e 2867 5f69        if len(g_i
+00055e90: 6473 2920 3d3d 2030 3a0a 2020 2020 2020  ds) == 0:.      
+00055ea0: 2020 2020 2020 2020 2020 6769 642c 2067            gid, g
+00055eb0: 6e61 6d65 203d 2027 272c 2027 270a 2020  name = '', ''.  
+00055ec0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00055ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055ee0: 6769 6420 3d20 675f 6964 735b 305d 0a20  gid = g_ids[0]. 
+00055ef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00055f00: 6620 6c65 6e28 675f 6964 7329 203e 2031  f len(g_ids) > 1
+00055f10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00055f20: 2020 2020 2020 666f 7220 6120 696e 2067        for a in g
+00055f30: 5f69 6473 5b31 3a5d 3a0a 2020 2020 2020  _ids[1:]:.      
+00055f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055f50: 2020 6769 6420 3d20 6769 6420 2b20 273b    gid = gid + ';
+00055f60: 2573 2720 2520 610a 0a20 2020 2020 2020  %s' % a..       
+00055f70: 2020 2020 2020 2020 2067 6e61 6d65 203d           gname =
+00055f80: 2067 5f6e 616d 6573 5b30 5d0a 2020 2020   g_names[0].    
+00055f90: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00055fa0: 656e 2867 5f6e 616d 6573 2920 3e20 313a  en(g_names) > 1:
+00055fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055fc0: 2020 2020 2066 6f72 2061 2069 6e20 675f       for a in g_
+00055fd0: 6e61 6d65 735b 313a 5d3a 0a20 2020 2020  names[1:]:.     
+00055fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055ff0: 2020 2067 6e61 6d65 203d 2067 6e61 6d65     gname = gname
+00056000: 202b 2027 3b25 7327 2025 2061 0a20 2020   + ';%s' % a.   
+00056010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056020: 200a 2020 2020 2020 2020 7265 7475 726e   .        return
+00056030: 2072 6573 2c20 6769 642c 2067 6e61 6d65   res, gid, gname
+00056040: 0a0a 2020 2020 6465 6620 6368 6563 6b5f  ..    def check_
+00056050: 6e76 5f70 6f73 5f65 786f 6e28 2073 656c  nv_pos_exon( sel
+00056060: 662c 206e 765f 7370 616e 2029 3a0a 2020  f, nv_span ):.  
+00056070: 2020 2020 2020 6220 3d20 5472 7565 0a20        b = True. 
+00056080: 2020 2020 2020 2072 6573 203d 2027 270a         res = ''.
+00056090: 2020 2020 2020 2020 666f 7220 6d2c 2063          for m, c
+000560a0: 7220 696e 2065 6e75 6d65 7261 7465 2873  r in enumerate(s
+000560b0: 656c 662e 7267 6e73 2e72 676e 7329 3a0a  elf.rgns.rgns):.
+000560c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000560d0: 722e 6861 735f 6578 745f 696e 7465 7273  r.has_ext_inters
+000560e0: 6563 7469 6f6e 5f77 6974 6828 206e 765f  ection_with( nv_
+000560f0: 7370 616e 2029 3a0a 2020 2020 2020 2020  span ):.        
+00056100: 2020 2020 2020 2020 7265 7320 3d20 6372          res = cr
+00056110: 2e74 7970 650a 2020 2020 2020 2020 2020  .type.          
+00056120: 2020 2020 2020 6220 3d20 4661 6c73 650a        b = False.
+00056130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056140: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00056150: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
+00056160: 6620 623a 0a20 2020 2020 2020 2020 2020  f b:.           
+00056170: 2067 6964 203d 2027 6e6f 745f 6964 656e   gid = 'not_iden
+00056180: 7469 6669 6564 5f32 270a 2020 2020 2020  tified_2'.      
+00056190: 2020 2020 2020 676e 616d 6520 3d20 276e        gname = 'n
+000561a0: 6f74 5f69 6465 6e74 6966 6965 645f 3227  ot_identified_2'
+000561b0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000561c0: 2020 2020 2020 2020 2020 2067 5f69 6473             g_ids
+000561d0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+000561e0: 2020 675f 6e61 6d65 7320 3d20 5b5d 0a20    g_names = []. 
+000561f0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00056200: 2c20 7467 6d20 696e 2065 6e75 6d65 7261  , tgm in enumera
+00056210: 7465 2873 656c 662e 7472 5f74 6f5f 6772  te(self.tr_to_gr
+00056220: 5f6d 6170 7329 3a0a 2020 2020 2020 2020  _maps):.        
+00056230: 2020 2020 2020 2020 6966 206d 2069 6e20          if m in 
+00056240: 7467 6d3a 0a20 2020 2020 2020 2020 2020  tgm:.           
+00056250: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00056260: 2e74 645f 6c73 745b 6b5d 2e67 6964 206e  .td_lst[k].gid n
+00056270: 6f74 2069 6e20 675f 6964 733a 0a20 2020  ot in g_ids:.   
+00056280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056290: 2020 2020 2067 5f69 6473 2e61 7070 656e       g_ids.appen
+000562a0: 6428 7365 6c66 2e74 645f 6c73 745b 6b5d  d(self.td_lst[k]
+000562b0: 2e67 6964 290a 2020 2020 2020 2020 2020  .gid).          
+000562c0: 2020 2020 2020 2020 2020 2020 2020 675f                g_
+000562d0: 6e61 6d65 732e 6170 7065 6e64 2873 656c  names.append(sel
+000562e0: 662e 7464 5f6c 7374 5b6b 5d2e 676e 616d  f.td_lst[k].gnam
+000562f0: 6529 0a20 2020 2020 2020 2020 2020 200a  e).            .
+00056300: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00056310: 656e 2867 5f69 6473 2920 3d3d 2030 3a0a  en(g_ids) == 0:.
+00056320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056330: 6769 642c 2067 6e61 6d65 203d 2027 272c  gid, gname = '',
+00056340: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
+00056350: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00056360: 2020 2020 2020 6769 6420 3d20 675f 6964        gid = g_id
+00056370: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+00056380: 2020 2020 2069 6620 6c65 6e28 675f 6964       if len(g_id
+00056390: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
+000563a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000563b0: 6120 696e 2067 5f69 6473 5b31 3a5d 3a0a  a in g_ids[1:]:.
 000563c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000563d0: 2020 2020 2020 2067 5f6e 616d 6573 2e61         g_names.a
-000563e0: 7070 656e 6428 7365 6c66 2e74 645f 6c73  ppend(self.td_ls
-000563f0: 745b 6b5d 2e67 6e61 6d65 290a 2020 2020  t[k].gname).    
-00056400: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00056410: 2020 2020 2069 6620 6c65 6e28 675f 6964       if len(g_id
-00056420: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
-00056430: 2020 2020 2020 2020 2067 6964 2c20 676e           gid, gn
-00056440: 616d 6520 3d20 2727 2c20 2727 0a20 2020  ame = '', ''.   
-00056450: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00056460: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00056470: 6964 203d 2067 5f69 6473 5b30 5d0a 2020  id = g_ids[0].  
-00056480: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00056490: 206c 656e 2867 5f69 6473 2920 3e20 313a   len(g_ids) > 1:
-000564a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000564b0: 2020 2020 2066 6f72 2061 2069 6e20 675f       for a in g_
-000564c0: 6964 735b 313a 5d3a 0a20 2020 2020 2020  ids[1:]:.       
-000564d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000564e0: 2067 6964 203d 2067 6964 202b 2027 3b25   gid = gid + ';%
-000564f0: 7327 2025 2061 0a0a 2020 2020 2020 2020  s' % a..        
-00056500: 2020 2020 2020 2020 676e 616d 6520 3d20          gname = 
-00056510: 675f 6e61 6d65 735b 305d 0a20 2020 2020  g_names[0].     
-00056520: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00056530: 6e28 675f 6e61 6d65 7329 203e 2031 3a0a  n(g_names) > 1:.
-00056540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056550: 2020 2020 666f 7220 6120 696e 2067 5f6e      for a in g_n
-00056560: 616d 6573 5b31 3a5d 3a0a 2020 2020 2020  ames[1:]:.      
-00056570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056580: 2020 676e 616d 6520 3d20 676e 616d 6520    gname = gname 
-00056590: 2b20 273b 2573 2720 2520 610a 2020 2020  + ';%s' % a.    
-000565a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000565b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000565c0: 7265 732c 2067 6964 2c20 676e 616d 650a  res, gid, gname.
-000565d0: 2020 2020 0a0a 2020 2020 6465 6620 6765      ..    def ge
-000565e0: 745f 6765 6e65 5f6c 6576 656c 5f6e 765f  t_gene_level_nv_
-000565f0: 696e 666f 2873 656c 6629 3a0a 2020 2020  info(self):.    
-00056600: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00056610: 2020 2020 2020 2020 6e76 5f69 6e66 6f5f          nv_info_
-00056620: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
-00056630: 2069 6620 286c 656e 2873 656c 662e 6e76   if (len(self.nv
-00056640: 5f69 6e66 6f5f 6c73 7429 203e 2030 293a  _info_lst) > 0):
-00056650: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00056660: 2020 2020 2020 2020 2020 675f 6964 7320            g_ids 
-00056670: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00056680: 2067 5f6e 616d 6573 203d 205b 5d0a 2020   g_names = [].  
-00056690: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
-000566a0: 2074 6420 696e 2065 6e75 6d65 7261 7465   td in enumerate
-000566b0: 2873 656c 662e 7464 5f6c 7374 293a 0a20  (self.td_lst):. 
-000566c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000566d0: 6620 7464 2e67 6964 206e 6f74 2069 6e20  f td.gid not in 
-000566e0: 675f 6964 733a 0a20 2020 2020 2020 2020  g_ids:.         
-000566f0: 2020 2020 2020 2020 2020 2067 5f69 6473             g_ids
-00056700: 2e61 7070 656e 6428 7464 2e67 6964 290a  .append(td.gid).
-00056710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056720: 6966 2074 642e 676e 616d 6520 6e6f 7420  if td.gname not 
-00056730: 696e 2067 5f6e 616d 6573 3a0a 2020 2020  in g_names:.    
-00056740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056750: 675f 6e61 6d65 732e 6170 7065 6e64 2874  g_names.append(t
-00056760: 642e 676e 616d 6529 0a20 2020 200a 2020  d.gname).    .  
-00056770: 2020 2020 2020 2020 2020 6769 6420 3d20            gid = 
-00056780: 675f 6964 735b 305d 0a20 2020 2020 2020  g_ids[0].       
-00056790: 2020 2020 2069 6620 6c65 6e28 675f 6964       if len(g_id
-000567a0: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
-000567b0: 2020 2020 2020 2020 666f 7220 6120 696e          for a in
-000567c0: 2067 5f69 6473 5b31 3a5d 3a0a 2020 2020   g_ids[1:]:.    
-000567d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000567e0: 6769 6420 3d20 6769 6420 2b20 273b 2573  gid = gid + ';%s
-000567f0: 2720 2520 610a 0a20 2020 2020 2020 2020  ' % a..         
-00056800: 2020 2067 6e61 6d65 203d 2067 5f6e 616d     gname = g_nam
-00056810: 6573 5b30 5d0a 2020 2020 2020 2020 2020  es[0].          
-00056820: 2020 6966 206c 656e 2867 5f6e 616d 6573    if len(g_names
-00056830: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
-00056840: 2020 2020 2020 2066 6f72 2061 2069 6e20         for a in 
-00056850: 675f 6e61 6d65 735b 313a 5d3a 0a20 2020  g_names[1:]:.   
-00056860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056870: 2067 6e61 6d65 203d 2067 6e61 6d65 202b   gname = gname +
-00056880: 2027 3b25 7327 2025 2061 0a20 2020 2020   ';%s' % a.     
-00056890: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-000568a0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000568b0: 6c65 6e28 7365 6c66 2e63 6473 2e72 676e  len(self.cds.rgn
-000568c0: 7329 203e 2030 293a 200a 0a20 2020 2020  s) > 0): ..     
-000568d0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-000568e0: 7620 696e 2073 656c 662e 6e76 5f69 6e66  v in self.nv_inf
-000568f0: 6f5f 6c73 743a 0a20 2020 2020 2020 2020  o_lst:.         
-00056900: 2020 2020 2020 2020 2020 2076 5f63 6c73             v_cls
-00056910: 203d 2027 6e6f 745f 636c 6173 7369 6669   = 'not_classifi
-00056920: 6564 270a 2020 2020 2020 2020 2020 2020  ed'.            
-00056930: 2020 2020 2020 2020 7370 616e 203d 2072          span = r
-00056940: 6567 696f 6e28 206e 762e 6368 722c 206e  egion( nv.chr, n
-00056950: 762e 706f 735f 7265 662c 206e 762e 706f  v.pos_ref, nv.po
-00056960: 735f 7265 6620 2b20 6e76 2e76 5f6c 656e  s_ref + nv.v_len
-00056970: 2d31 2c20 274d 2720 290a 2020 2020 2020  -1, 'M' ).      
-00056980: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00056990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000569a0: 2020 2072 6573 2c20 6769 642c 2067 6e61     res, gid, gna
-000569b0: 6d65 203d 2073 656c 662e 6368 6563 6b5f  me = self.check_
-000569c0: 6e76 5f70 6f73 2820 7370 616e 2029 0a0a  nv_pos( span )..
+000563d0: 2020 2020 2020 2020 6769 6420 3d20 6769          gid = gi
+000563e0: 6420 2b20 273b 2573 2720 2520 610a 0a20  d + ';%s' % a.. 
+000563f0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00056400: 6e61 6d65 203d 2067 5f6e 616d 6573 5b30  name = g_names[0
+00056410: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00056420: 2020 6966 206c 656e 2867 5f6e 616d 6573    if len(g_names
+00056430: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
+00056440: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+00056450: 2069 6e20 675f 6e61 6d65 735b 313a 5d3a   in g_names[1:]:
+00056460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00056470: 2020 2020 2020 2020 2067 6e61 6d65 203d           gname =
+00056480: 2067 6e61 6d65 202b 2027 3b25 7327 2025   gname + ';%s' %
+00056490: 2061 0a20 2020 2020 2020 2020 2020 2020   a.             
+000564a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000564b0: 7265 7475 726e 2072 6573 2c20 6769 642c  return res, gid,
+000564c0: 2067 6e61 6d65 0a20 2020 200a 0a20 2020   gname.    ..   
+000564d0: 2064 6566 2067 6574 5f67 656e 655f 6c65   def get_gene_le
+000564e0: 7665 6c5f 6e76 5f69 6e66 6f28 7365 6c66  vel_nv_info(self
+000564f0: 2c20 636e 745f 6529 3a0a 2020 2020 2020  , cnt_e):.      
+00056500: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00056510: 2020 2020 2020 6e76 5f69 6e66 6f5f 6c73        nv_info_ls
+00056520: 7420 3d20 5b5d 0a20 2020 2020 2020 2069  t = [].        i
+00056530: 6620 286c 656e 2873 656c 662e 6e76 5f69  f (len(self.nv_i
+00056540: 6e66 6f5f 6c73 7429 203e 2030 293a 0a20  nfo_lst) > 0):. 
+00056550: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00056560: 2020 2020 2020 2020 675f 6964 7320 3d20          g_ids = 
+00056570: 5b5d 0a20 2020 2020 2020 2020 2020 2067  [].            g
+00056580: 5f6e 616d 6573 203d 205b 5d0a 2020 2020  _names = [].    
+00056590: 2020 2020 2020 2020 666f 7220 6b2c 2074          for k, t
+000565a0: 6420 696e 2065 6e75 6d65 7261 7465 2873  d in enumerate(s
+000565b0: 656c 662e 7464 5f6c 7374 293a 0a20 2020  elf.td_lst):.   
+000565c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000565d0: 7464 2e67 6964 206e 6f74 2069 6e20 675f  td.gid not in g_
+000565e0: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
+000565f0: 2020 2020 2020 2020 2067 5f69 6473 2e61           g_ids.a
+00056600: 7070 656e 6428 7464 2e67 6964 290a 2020  ppend(td.gid).  
+00056610: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00056620: 2074 642e 676e 616d 6520 6e6f 7420 696e   td.gname not in
+00056630: 2067 5f6e 616d 6573 3a0a 2020 2020 2020   g_names:.      
+00056640: 2020 2020 2020 2020 2020 2020 2020 675f                g_
+00056650: 6e61 6d65 732e 6170 7065 6e64 2874 642e  names.append(td.
+00056660: 676e 616d 6529 0a20 2020 200a 2020 2020  gname).    .    
+00056670: 2020 2020 2020 2020 6769 6420 3d20 675f          gid = g_
+00056680: 6964 735b 305d 0a20 2020 2020 2020 2020  ids[0].         
+00056690: 2020 2069 6620 6c65 6e28 675f 6964 7329     if len(g_ids)
+000566a0: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
+000566b0: 2020 2020 2020 666f 7220 6120 696e 2067        for a in g
+000566c0: 5f69 6473 5b31 3a5d 3a0a 2020 2020 2020  _ids[1:]:.      
+000566d0: 2020 2020 2020 2020 2020 2020 2020 6769                gi
+000566e0: 6420 3d20 6769 6420 2b20 273b 2573 2720  d = gid + ';%s' 
+000566f0: 2520 610a 0a20 2020 2020 2020 2020 2020  % a..           
+00056700: 2067 6e61 6d65 203d 2067 5f6e 616d 6573   gname = g_names
+00056710: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00056720: 6966 206c 656e 2867 5f6e 616d 6573 2920  if len(g_names) 
+00056730: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+00056740: 2020 2020 2066 6f72 2061 2069 6e20 675f       for a in g_
+00056750: 6e61 6d65 735b 313a 5d3a 0a20 2020 2020  names[1:]:.     
+00056760: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00056770: 6e61 6d65 203d 2067 6e61 6d65 202b 2027  name = gname + '
+00056780: 3b25 7327 2025 2061 0a20 2020 2020 2020  ;%s' % a.       
+00056790: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+000567a0: 2020 2020 2020 2020 2020 6966 2028 6c65            if (le
+000567b0: 6e28 7365 6c66 2e63 6473 2e72 676e 7329  n(self.cds.rgns)
+000567c0: 203e 2030 293a 200a 0a20 2020 2020 2020   > 0): ..       
+000567d0: 2020 2020 2020 2020 2066 6f72 206e 7620           for nv 
+000567e0: 696e 2073 656c 662e 6e76 5f69 6e66 6f5f  in self.nv_info_
+000567f0: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
+00056800: 2020 2020 2020 2020 2076 5f63 6c73 203d           v_cls =
+00056810: 2027 6e6f 745f 636c 6173 7369 6669 6564   'not_classified
+00056820: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00056830: 2020 2020 2020 7370 616e 203d 2072 6567        span = reg
+00056840: 696f 6e28 206e 762e 6368 722c 206e 762e  ion( nv.chr, nv.
+00056850: 706f 735f 7265 662c 206e 762e 706f 735f  pos_ref, nv.pos_
+00056860: 7265 6620 2b20 6e76 2e76 5f6c 656e 2d31  ref + nv.v_len-1
+00056870: 2c20 274d 2720 290a 2020 2020 2020 2020  , 'M' ).        
+00056880: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00056890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000568a0: 2072 6573 2c20 6769 642c 2067 6e61 6d65   res, gid, gname
+000568b0: 203d 2073 656c 662e 6368 6563 6b5f 6e76   = self.check_nv
+000568c0: 5f70 6f73 2820 7370 616e 2029 0a0a 2020  _pos( span )..  
+000568d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000568e0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000568f0: 7265 732c 7374 7229 203d 3d20 5472 7565  res,str) == True
+00056900: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+00056910: 2020 2020 2020 2020 2020 2069 6620 6e76             if nv
+00056920: 2e76 5f74 7970 6520 3d3d 2027 4927 3a20  .v_type == 'I': 
+00056930: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00056940: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+00056950: 636c 7320 3d20 2769 6e73 5f69 6e5f 2720  cls = 'ins_in_' 
+00056960: 2b20 7265 730a 2020 2020 2020 2020 2020  + res.          
+00056970: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00056980: 6966 206e 762e 765f 7479 7065 203d 3d20  if nv.v_type == 
+00056990: 2744 273a 2020 0a20 2020 2020 2020 2020  'D':  .         
+000569a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000569b0: 2020 2076 5f63 6c73 203d 2027 6465 6c5f     v_cls = 'del_
+000569c0: 696e 5f27 202b 2072 6573 0a20 2020 2020  in_' + res.     
 000569d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000569e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000569f0: 6528 7265 732c 7374 7229 203d 3d20 5472  e(res,str) == Tr
-00056a00: 7565 3a0a 0a20 2020 2020 2020 2020 2020  ue:..           
-00056a10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00056a20: 6e76 2e76 5f74 7970 6520 3d3d 2027 4927  nv.v_type == 'I'
-00056a30: 3a20 200a 2020 2020 2020 2020 2020 2020  :  .            
+000569e0: 2020 2065 6c73 653a 2020 0a20 2020 2020     else:  .     
+000569f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056a00: 2020 2020 2020 2076 5f63 6c73 203d 2027         v_cls = '
+00056a10: 6e70 5f69 6e5f 2720 2b20 7265 730a 2020  np_in_' + res.  
+00056a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056a30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
 00056a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056a50: 765f 636c 7320 3d20 2769 6e73 5f69 6e5f  v_cls = 'ins_in_
-00056a60: 2720 2b20 7265 730a 2020 2020 2020 2020  ' + res.        
-00056a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056a80: 656c 6966 206e 762e 765f 7479 7065 203d  elif nv.v_type =
-00056a90: 3d20 2744 273a 2020 0a20 2020 2020 2020  = 'D':  .       
+00056a50: 6966 2072 6573 203d 3d20 313a 0a20 2020  if res == 1:.   
+00056a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056a70: 2020 2020 2020 2020 2069 6620 6e76 2e76           if nv.v
+00056a80: 5f74 7970 6520 3d3d 2027 5627 3a20 200a  _type == 'V':  .
+00056a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00056aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056ab0: 2020 2020 2076 5f63 6c73 203d 2027 6465       v_cls = 'de
-00056ac0: 6c5f 696e 5f27 202b 2072 6573 0a20 2020  l_in_' + res.   
+00056ab0: 765f 636c 7320 3d20 2773 7461 7274 5f63  v_cls = 'start_c
+00056ac0: 6f64 6f6e 5f73 6e70 270a 2020 2020 2020  odon_snp'.      
 00056ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056ae0: 2020 2020 2065 6c73 653a 2020 0a20 2020       else:  .   
-00056af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056b00: 2020 2020 2020 2020 2076 5f63 6c73 203d           v_cls =
-00056b10: 2027 6e70 5f69 6e5f 2720 2b20 7265 730a   'np_in_' + res.
-00056b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056b30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00056ae0: 2020 2020 2020 656c 6966 206e 762e 765f        elif nv.v_
+00056af0: 7479 7065 203d 3d20 2749 273a 2020 0a20  type == 'I':  . 
+00056b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056b10: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00056b20: 5f63 6c73 203d 2027 7374 6172 745f 636f  _cls = 'start_co
+00056b30: 646f 6e5f 696e 7327 0a20 2020 2020 2020  don_ins'.       
 00056b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056b50: 2020 6966 2072 6573 203d 3d20 313a 0a20    if res == 1:. 
-00056b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056b70: 2020 2020 2020 2020 2020 2069 6620 6e76             if nv
-00056b80: 2e76 5f74 7970 6520 3d3d 2027 5627 3a20  .v_type == 'V': 
-00056b90: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00056ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056bb0: 2020 765f 636c 7320 3d20 2773 7461 7274    v_cls = 'start
-00056bc0: 5f63 6f64 6f6e 5f73 6e70 270a 2020 2020  _codon_snp'.    
+00056b50: 2020 2020 2065 6c69 6620 6e76 2e76 5f74       elif nv.v_t
+00056b60: 7970 6520 3d3d 2027 4427 3a20 200a 2020  ype == 'D':  .  
+00056b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056b80: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+00056b90: 636c 7320 3d20 2773 7461 7274 5f63 6f64  cls = 'start_cod
+00056ba0: 6f6e 5f64 656c 270a 2020 2020 2020 2020  on_del'.        
+00056bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056bc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
 00056bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056be0: 2020 2020 2020 2020 656c 6966 206e 762e          elif nv.
-00056bf0: 765f 7479 7065 203d 3d20 2749 273a 2020  v_type == 'I':  
-00056c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00056c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056c20: 2076 5f63 6c73 203d 2027 7374 6172 745f   v_cls = 'start_
-00056c30: 636f 646f 6e5f 696e 7327 0a20 2020 2020  codon_ins'.     
-00056c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056c50: 2020 2020 2020 2065 6c69 6620 6e76 2e76         elif nv.v
-00056c60: 5f74 7970 6520 3d3d 2027 4427 3a20 200a  _type == 'D':  .
-00056c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056c90: 765f 636c 7320 3d20 2773 7461 7274 5f63  v_cls = 'start_c
-00056ca0: 6f64 6f6e 5f64 656c 270a 2020 2020 2020  odon_del'.      
-00056cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056cc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00056be0: 2020 2020 2020 2020 2020 7061 7373 2020            pass  
+00056bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056c00: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+00056c10: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00056c20: 7265 7320 3d3d 2032 3a0a 2020 2020 2020  res == 2:.      
+00056c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056c40: 2020 2020 2020 6966 206e 762e 765f 7479        if nv.v_ty
+00056c50: 7065 203d 3d20 2756 273a 2020 0a20 2020  pe == 'V':  .   
+00056c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056c70: 2020 2020 2020 2020 2020 2020 2076 5f63               v_c
+00056c80: 6c73 203d 2027 7374 6f70 5f63 6f64 6f6e  ls = 'stop_codon
+00056c90: 5f73 6e70 270a 2020 2020 2020 2020 2020  _snp'.          
+00056ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056cb0: 2020 656c 6966 206e 762e 765f 7479 7065    elif nv.v_type
+00056cc0: 203d 3d20 2749 273a 2020 0a20 2020 2020   == 'I':  .     
 00056cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056ce0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00056cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056d00: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00056d10: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00056d20: 6620 7265 7320 3d3d 2032 3a0a 2020 2020  f res == 2:.    
-00056d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056d40: 2020 2020 2020 2020 6966 206e 762e 765f          if nv.v_
-00056d50: 7479 7065 203d 3d20 2756 273a 2020 0a20  type == 'V':  . 
-00056d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056d70: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00056d80: 5f63 6c73 203d 2027 7374 6f70 5f63 6f64  _cls = 'stop_cod
-00056d90: 6f6e 5f73 6e70 270a 2020 2020 2020 2020  on_snp'.        
+00056ce0: 2020 2020 2020 2020 2020 2076 5f63 6c73             v_cls
+00056cf0: 203d 2027 7374 6f70 5f63 6f64 6f6e 5f69   = 'stop_codon_i
+00056d00: 6e73 270a 2020 2020 2020 2020 2020 2020  ns'.            
+00056d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056d20: 656c 6966 206e 762e 765f 7479 7065 203d  elif nv.v_type =
+00056d30: 3d20 2744 273a 2020 0a20 2020 2020 2020  = 'D':  .       
+00056d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056d50: 2020 2020 2020 2020 2076 5f63 6c73 203d           v_cls =
+00056d60: 2027 7374 6f70 5f63 6f64 6f6e 5f64 656c   'stop_codon_del
+00056d70: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00056d80: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00056d90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
 00056da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056db0: 2020 2020 656c 6966 206e 762e 765f 7479      elif nv.v_ty
-00056dc0: 7065 203d 3d20 2749 273a 2020 0a20 2020  pe == 'I':  .   
+00056db0: 2020 2020 7061 7373 2020 2020 2020 2020      pass        
+00056dc0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
 00056dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056de0: 2020 2020 2020 2020 2020 2020 2076 5f63               v_c
-00056df0: 6c73 203d 2027 7374 6f70 5f63 6f64 6f6e  ls = 'stop_codon
-00056e00: 5f69 6e73 270a 2020 2020 2020 2020 2020  _ins'.          
-00056e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056e20: 2020 656c 6966 206e 762e 765f 7479 7065    elif nv.v_type
-00056e30: 203d 3d20 2744 273a 2020 0a20 2020 2020   == 'D':  .     
-00056e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056e50: 2020 2020 2020 2020 2020 2076 5f63 6c73             v_cls
-00056e60: 203d 2027 7374 6f70 5f63 6f64 6f6e 5f64   = 'stop_codon_d
-00056e70: 656c 270a 2020 2020 2020 2020 2020 2020  el'.            
-00056e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056e90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00056ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056eb0: 2020 2020 2020 7061 7373 2020 2020 2020        pass      
-00056ec0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00056ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056ee0: 2020 2020 2020 2065 6c69 6620 7265 7320         elif res 
-00056ef0: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
-00056f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056f10: 2020 6966 206e 762e 765f 7479 7065 203d    if nv.v_type =
-00056f20: 3d20 2756 273a 2020 0a20 2020 2020 2020  = 'V':  .       
-00056f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056f40: 2020 2020 2020 2020 2076 5f63 6c73 203d           v_cls =
-00056f50: 2027 6d69 7373 656e 7365 5f6f 725f 7369   'missense_or_si
-00056f60: 6c65 6e74 5f6d 7574 6174 696f 6e27 0a20  lent_mutation'. 
-00056f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056f80: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00056f90: 6e76 2e76 5f74 7970 6520 3d3d 2027 4927  nv.v_type == 'I'
-00056fa0: 3a20 200a 2020 2020 2020 2020 2020 2020  :  .            
+00056de0: 2020 2020 2065 6c69 6620 7265 7320 3d3d       elif res ==
+00056df0: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+00056e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056e10: 6966 206e 762e 765f 7479 7065 203d 3d20  if nv.v_type == 
+00056e20: 2756 273a 2020 0a20 2020 2020 2020 2020  'V':  .         
+00056e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056e40: 2020 2020 2020 2076 5f63 6c73 203d 2027         v_cls = '
+00056e50: 6d69 7373 656e 7365 5f6f 725f 7369 6c65  missense_or_sile
+00056e60: 6e74 5f6d 7574 6174 696f 6e27 0a20 2020  nt_mutation'.   
+00056e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056e80: 2020 2020 2020 2020 2065 6c69 6620 6e76           elif nv
+00056e90: 2e76 5f74 7970 6520 3d3d 2027 4927 3a20  .v_type == 'I': 
+00056ea0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00056eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056ec0: 2020 6966 206e 762e 765f 6c65 6e25 3320    if nv.v_len%3 
+00056ed0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00056ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056ef0: 2020 2020 2020 2020 2020 765f 636c 7320            v_cls 
+00056f00: 3d20 2769 6e5f 6672 616d 655f 696e 7327  = 'in_frame_ins'
+00056f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00056f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056f30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00056f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056f50: 2020 2020 2020 2020 2020 2076 5f63 6c73             v_cls
+00056f60: 203d 2027 6672 616d 655f 7368 6966 745f   = 'frame_shift_
+00056f70: 696e 7327 0a20 2020 2020 2020 2020 2020  ins'.           
+00056f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056f90: 2065 6c69 6620 6e76 2e76 5f74 7970 6520   elif nv.v_type 
+00056fa0: 3d3d 2027 4427 3a20 200a 2020 2020 2020  == 'D':  .      
 00056fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056fc0: 2020 2020 6966 206e 762e 765f 6c65 6e25      if nv.v_len%
-00056fd0: 3320 3d3d 2030 3a0a 2020 2020 2020 2020  3 == 0:.        
+00056fc0: 2020 2020 2020 2020 2020 6966 206e 762e            if nv.
+00056fd0: 765f 6c65 6e25 3320 3d3d 2030 3a0a 2020  v_len%3 == 0:.  
 00056fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056ff0: 2020 2020 2020 2020 2020 2020 765f 636c              v_cl
-00057000: 7320 3d20 2769 6e5f 6672 616d 655f 696e  s = 'in_frame_in
-00057010: 7327 0a20 2020 2020 2020 2020 2020 2020  s'.             
+00056ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057000: 2020 765f 636c 7320 3d20 2769 6e5f 6672    v_cls = 'in_fr
+00057010: 616d 655f 6465 6c27 0a20 2020 2020 2020  ame_del'.       
 00057020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057030: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00057030: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
 00057040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057050: 2020 2020 2020 2020 2020 2020 2076 5f63               v_c
-00057060: 6c73 203d 2027 6672 616d 655f 7368 6966  ls = 'frame_shif
-00057070: 745f 696e 7327 0a20 2020 2020 2020 2020  t_ins'.         
+00057050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057060: 2020 2076 5f63 6c73 203d 2027 6672 616d     v_cls = 'fram
+00057070: 655f 7368 6966 745f 6465 6c27 0a20 2020  e_shift_del'.   
 00057080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057090: 2020 2065 6c69 6620 6e76 2e76 5f74 7970     elif nv.v_typ
-000570a0: 6520 3d3d 2027 4427 3a20 200a 2020 2020  e == 'D':  .    
-000570b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000570c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000570d0: 762e 765f 6c65 6e25 3320 3d3d 2030 3a0a  v.v_len%3 == 0:.
+00057090: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000570a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000570b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000570c0: 6173 7320 2020 2020 2020 2020 2020 2020  ass             
+000570d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
 000570e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000570f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057100: 2020 2020 765f 636c 7320 3d20 2769 6e5f      v_cls = 'in_
-00057110: 6672 616d 655f 6465 6c27 0a20 2020 2020  frame_del'.     
-00057120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057130: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00057140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000570f0: 656c 6966 2072 6573 203d 3d20 303a 0a20  elif res == 0:. 
+00057100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057110: 2020 2020 2020 2020 2020 2072 6573 2c20             res, 
+00057120: 6769 642c 2067 6e61 6d65 203d 2073 656c  gid, gname = sel
+00057130: 662e 6368 6563 6b5f 6e76 5f70 6f73 5f65  f.check_nv_pos_e
+00057140: 786f 6e28 2073 7061 6e20 290a 2020 2020  xon( span ).    
 00057150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057160: 2020 2020 2076 5f63 6c73 203d 2027 6672       v_cls = 'fr
-00057170: 616d 655f 7368 6966 745f 6465 6c27 0a20  ame_shift_del'. 
+00057160: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
+00057170: 6573 2920 3d3d 2030 3a0a 2020 2020 2020  es) == 0:.      
 00057180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057190: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000571a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000571b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000571c0: 2070 6173 7320 2020 2020 2020 2020 2020   pass           
-000571d0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00057190: 2020 2020 2020 2020 2020 765f 636c 7320            v_cls 
+000571a0: 3d20 276e 6f74 5f69 6465 6e74 6966 6965  = 'not_identifie
+000571b0: 6427 0a20 2020 2020 2020 2020 2020 2020  d'.             
+000571c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000571d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
 000571e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000571f0: 2020 656c 6966 2072 6573 203d 3d20 303a    elif res == 0:
-00057200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00057210: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00057220: 2c20 6769 642c 2067 6e61 6d65 203d 2073  , gid, gname = s
-00057230: 656c 662e 6368 6563 6b5f 6e76 5f70 6f73  elf.check_nv_pos
-00057240: 5f65 786f 6e28 2073 7061 6e20 290a 2020  _exon( span ).  
+000571f0: 2020 2020 2072 6573 203d 2072 6573 202b       res = res +
+00057200: 2027 2875 7472 2927 0a20 2020 2020 2020   '(utr)'.       
+00057210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057220: 2020 2020 2020 2020 2069 6620 6e76 2e76           if nv.v
+00057230: 5f74 7970 6520 3d3d 2027 4927 3a20 200a  _type == 'I':  .
+00057240: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00057250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057260: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00057270: 2872 6573 2920 3d3d 2030 3a0a 2020 2020  (res) == 0:.    
+00057260: 2020 2020 765f 636c 7320 3d20 2769 6e73      v_cls = 'ins
+00057270: 5f69 6e5f 2720 2b20 7265 730a 2020 2020  _in_' + res.    
 00057280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057290: 2020 2020 2020 2020 2020 2020 765f 636c              v_cl
-000572a0: 7320 3d20 276e 6f74 5f69 6465 6e74 6966  s = 'not_identif
-000572b0: 6965 6427 0a20 2020 2020 2020 2020 2020  ied'.           
+00057290: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000572a0: 206e 762e 765f 7479 7065 203d 3d20 2744   nv.v_type == 'D
+000572b0: 273a 2020 0a20 2020 2020 2020 2020 2020  ':  .           
 000572c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000572d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000572e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000572f0: 2020 2020 2020 2072 6573 203d 2072 6573         res = res
-00057300: 202b 2027 2875 7472 2927 0a20 2020 2020   + '(utr)'.     
-00057310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057320: 2020 2020 2020 2020 2020 2069 6620 6e76             if nv
-00057330: 2e76 5f74 7970 6520 3d3d 2027 4927 3a20  .v_type == 'I': 
-00057340: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00057350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057360: 2020 2020 2020 765f 636c 7320 3d20 2769        v_cls = 'i
-00057370: 6e73 5f69 6e5f 2720 2b20 7265 730a 2020  ns_in_' + res.  
-00057380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057390: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000573a0: 6966 206e 762e 765f 7479 7065 203d 3d20  if nv.v_type == 
-000573b0: 2744 273a 2020 0a20 2020 2020 2020 2020  'D':  .         
-000573c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000573d0: 2020 2020 2020 2020 2020 2076 5f63 6c73             v_cls
-000573e0: 203d 2027 6465 6c5f 696e 5f27 202b 2072   = 'del_in_' + r
-000573f0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+000572d0: 2020 2020 2020 2020 2076 5f63 6c73 203d           v_cls =
+000572e0: 2027 6465 6c5f 696e 5f27 202b 2072 6573   'del_in_' + res
+000572f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00057300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057310: 2065 6c73 653a 2020 0a20 2020 2020 2020   else:  .       
+00057320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057330: 2020 2020 2020 2020 2020 2020 2076 5f63               v_c
+00057340: 6c73 203d 2027 6e70 5f69 6e5f 2720 2b20  ls = 'np_in_' + 
+00057350: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
+00057360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057370: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00057380: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00057390: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000573a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000573b0: 6620 6e76 2e76 5f74 7970 6520 3d3d 2027  f nv.v_type == '
+000573c0: 4927 3a20 200a 2020 2020 2020 2020 2020  I':  .          
+000573d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000573e0: 2020 2020 2020 765f 636c 7320 3d20 2769        v_cls = 'i
+000573f0: 6e73 5f69 6e5f 2720 2b20 7265 730a 2020  ns_in_' + res.  
 00057400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057410: 2020 2065 6c73 653a 2020 0a20 2020 2020     else:  .     
-00057420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057430: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00057440: 5f63 6c73 203d 2027 6e70 5f69 6e5f 2720  _cls = 'np_in_' 
-00057450: 2b20 7265 730a 2020 2020 2020 2020 2020  + res.          
-00057460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057470: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00057480: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00057490: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000574a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000574b0: 2069 6620 6e76 2e76 5f74 7970 6520 3d3d   if nv.v_type ==
-000574c0: 2027 4927 3a20 200a 2020 2020 2020 2020   'I':  .        
-000574d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000574e0: 2020 2020 2020 2020 765f 636c 7320 3d20          v_cls = 
-000574f0: 2769 6e73 5f69 6e5f 2720 2b20 7265 730a  'ins_in_' + res.
-00057500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057510: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00057520: 206e 762e 765f 7479 7065 203d 3d20 2744   nv.v_type == 'D
-00057530: 273a 2020 0a20 2020 2020 2020 2020 2020  ':  .           
-00057540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057550: 2020 2020 2076 5f63 6c73 203d 2027 6465       v_cls = 'de
-00057560: 6c5f 696e 5f27 202b 2072 6573 0a20 2020  l_in_' + res.   
-00057570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057580: 2020 2020 2020 2020 2065 6c73 653a 2020           else:  
-00057590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000575a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000575b0: 2076 5f63 6c73 203d 2027 6e70 5f69 6e5f   v_cls = 'np_in_
-000575c0: 2720 2b20 7265 730a 0a20 2020 2020 2020  ' + res..       
-000575d0: 2020 2020 2020 2020 2020 2020 206e 765f               nv_
-000575e0: 696e 666f 5f6c 7374 2e61 7070 656e 6428  info_lst.append(
-000575f0: 204e 565f 696e 666f 5f65 7874 286e 762e   NV_info_ext(nv.
-00057600: 6368 722c 206e 762e 706f 735f 7265 662c  chr, nv.pos_ref,
-00057610: 206e 762e 706f 735f 6e65 772c 2067 6964   nv.pos_new, gid
-00057620: 2c20 676e 616d 652c 206e 762e 765f 7479  , gname, nv.v_ty
-00057630: 7065 2c20 6e76 2e76 5f6c 656e 2c20 6e76  pe, nv.v_len, nv
-00057640: 2e63 7667 5f64 6570 7468 2c20 5c0a 2020  .cvg_depth, \.  
-00057650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057670: 2020 2020 2020 2020 6e76 2e63 7667 5f66          nv.cvg_f
-00057680: 7261 632c 206e 762e 7265 665f 7072 6576  rac, nv.ref_prev
-00057690: 2c20 6e76 2e72 6566 5f73 6571 2c20 6e76  , nv.ref_seq, nv
-000576a0: 2e72 6566 5f6e 6578 742c 206e 762e 616c  .ref_next, nv.al
-000576b0: 745f 7072 6576 2c20 6e76 2e61 6c74 5f73  t_prev, nv.alt_s
-000576c0: 6571 2c20 6e76 2e61 6c74 5f6e 6578 742c  eq, nv.alt_next,
-000576d0: 2076 5f63 6c73 2c20 274e 4127 2920 290a   v_cls, 'NA') ).
-000576e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000576f0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00057700: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00057710: 2020 2020 2020 2063 6e74 203d 2030 0a20         cnt = 0. 
-00057720: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00057730: 6f72 2074 6420 696e 2073 656c 662e 7464  or td in self.td
-00057740: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
-00057750: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
-00057760: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00057770: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00057780: 6364 7320 3d20 7464 2e69 6364 730a 2020  cds = td.icds.  
-00057790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000577a0: 2020 2020 2020 6966 2074 642e 6963 6473        if td.icds
-000577b0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-000577c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000577d0: 2020 765f 636c 7320 3d20 2743 4453 5f75    v_cls = 'CDS_u
-000577e0: 6e6b 6e6f 776e 270a 2020 2020 2020 2020  nknown'.        
-000577f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057800: 656c 6966 2074 642e 6963 6473 203d 3d20  elif td.icds == 
-00057810: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00057820: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00057830: 5f63 6c73 203d 2027 6e6f 6e65 5f63 6f64  _cls = 'none_cod
-00057840: 696e 675f 6765 6e65 270a 2020 2020 2020  ing_gene'.      
-00057850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057860: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00057410: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
+00057420: 762e 765f 7479 7065 203d 3d20 2744 273a  v.v_type == 'D':
+00057430: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+00057440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057450: 2020 2076 5f63 6c73 203d 2027 6465 6c5f     v_cls = 'del_
+00057460: 696e 5f27 202b 2072 6573 0a20 2020 2020  in_' + res.     
+00057470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057480: 2020 2020 2020 2065 6c73 653a 2020 0a20         else:  . 
+00057490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000574a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000574b0: 5f63 6c73 203d 2027 6e70 5f69 6e5f 2720  _cls = 'np_in_' 
+000574c0: 2b20 7265 730a 0a20 2020 2020 2020 2020  + res..         
+000574d0: 2020 2020 2020 2020 2020 206e 765f 696e             nv_in
+000574e0: 666f 5f6c 7374 2e61 7070 656e 6428 204e  fo_lst.append( N
+000574f0: 565f 696e 666f 5f65 7874 286e 762e 6368  V_info_ext(nv.ch
+00057500: 722c 206e 762e 706f 735f 7265 662c 206e  r, nv.pos_ref, n
+00057510: 762e 706f 735f 6e65 772c 2067 6964 2c20  v.pos_new, gid, 
+00057520: 676e 616d 652c 206e 762e 765f 7479 7065  gname, nv.v_type
+00057530: 2c20 6e76 2e76 5f6c 656e 2c20 6e76 2e63  , nv.v_len, nv.c
+00057540: 7667 5f64 6570 7468 2c20 5c0a 2020 2020  vg_depth, \.    
+00057550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057570: 2020 2020 2020 6e76 2e63 7667 5f66 7261        nv.cvg_fra
+00057580: 632c 206e 762e 7265 665f 7072 6576 2c20  c, nv.ref_prev, 
+00057590: 6e76 2e72 6566 5f73 6571 2c20 6e76 2e72  nv.ref_seq, nv.r
+000575a0: 6566 5f6e 6578 742c 206e 762e 616c 745f  ef_next, nv.alt_
+000575b0: 7072 6576 2c20 6e76 2e61 6c74 5f73 6571  prev, nv.alt_seq
+000575c0: 2c20 6e76 2e61 6c74 5f6e 6578 742c 2076  , nv.alt_next, v
+000575d0: 5f63 6c73 2c20 274e 4127 2920 290a 2020  _cls, 'NA') ).  
+000575e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000575f0: 2020 0a20 2020 2020 2020 2020 2020 2065    .            e
+00057600: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00057610: 2020 2020 2063 6e74 203d 2030 0a20 2020       cnt = 0.   
+00057620: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00057630: 2074 6420 696e 2073 656c 662e 7464 5f6c   td in self.td_l
+00057640: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00057650: 2020 2020 2020 2020 6966 2063 6e74 203d          if cnt =
+00057660: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00057670: 2020 2020 2020 2020 2020 2020 2069 6364               icd
+00057680: 7320 3d20 7464 2e69 6364 730a 2020 2020  s = td.icds.    
+00057690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000576a0: 2020 2020 6966 2074 642e 6963 6473 203e      if td.icds >
+000576b0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000576c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000576d0: 765f 636c 7320 3d20 2743 4453 5f75 6e6b  v_cls = 'CDS_unk
+000576e0: 6e6f 776e 270a 2020 2020 2020 2020 2020  nown'.          
+000576f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00057700: 6966 2074 642e 6963 6473 203d 3d20 303a  if td.icds == 0:
+00057710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00057720: 2020 2020 2020 2020 2020 2020 2076 5f63               v_c
+00057730: 6c73 203d 2027 6e6f 6e65 5f63 6f64 696e  ls = 'none_codin
+00057740: 675f 6765 6e65 270a 2020 2020 2020 2020  g_gene'.        
+00057750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057760: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00057770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057780: 2020 765f 636c 7320 3d20 2743 4453 5f75    v_cls = 'CDS_u
+00057790: 6e73 7065 6369 6669 6564 270a 2020 2020  nspecified'.    
+000577a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000577b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000577c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000577d0: 2069 6364 7320 213d 2074 642e 6963 6473   icds != td.icds
+000577e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000577f0: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+00057800: 636c 7320 3d20 2743 4453 5f75 6e6b 6e6f  cls = 'CDS_unkno
+00057810: 776e 270a 2020 2020 2020 2020 2020 2020  wn'.            
+00057820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057830: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00057840: 2020 2020 2020 2020 2020 636e 7420 2b3d            cnt +=
+00057850: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00057860: 2020 2020 2020 2020 2020 2020 2020 200a                 .
 00057870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057880: 2020 2020 765f 636c 7320 3d20 2743 4453      v_cls = 'CDS
-00057890: 5f75 6e73 7065 6369 6669 6564 270a 2020  _unspecified'.  
+00057880: 666f 7220 6e76 2069 6e20 7365 6c66 2e6e  for nv in self.n
+00057890: 765f 696e 666f 5f6c 7374 3a0a 2020 2020  v_info_lst:.    
 000578a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000578b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000578c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000578d0: 6966 2069 6364 7320 213d 2074 642e 6963  if icds != td.ic
-000578e0: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-000578f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057900: 765f 636c 7320 3d20 2743 4453 5f75 6e6b  v_cls = 'CDS_unk
-00057910: 6e6f 776e 270a 2020 2020 2020 2020 2020  nown'.          
-00057920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057930: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-00057940: 2020 2020 2020 2020 2020 2020 636e 7420              cnt 
-00057950: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00057960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057970: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00057980: 2020 666f 7220 6e76 2069 6e20 7365 6c66    for nv in self
-00057990: 2e6e 765f 696e 666f 5f6c 7374 3a0a 2020  .nv_info_lst:.  
-000579a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000579b0: 2020 6e76 5f69 6e66 6f5f 6c73 742e 6170    nv_info_lst.ap
-000579c0: 7065 6e64 2820 4e56 5f69 6e66 6f5f 6578  pend( NV_info_ex
-000579d0: 7428 6e76 2e63 6872 2c20 6e76 2e70 6f73  t(nv.chr, nv.pos
-000579e0: 5f72 6566 2c20 6e76 2e70 6f73 5f6e 6577  _ref, nv.pos_new
-000579f0: 2c20 6e76 2e67 656e 655f 6964 2c20 6e76  , nv.gene_id, nv
-00057a00: 2e67 656e 655f 6e61 6d65 2c20 6e76 2e76  .gene_name, nv.v
-00057a10: 5f74 7970 652c 206e 762e 765f 6c65 6e2c  _type, nv.v_len,
-00057a20: 206e 762e 6376 675f 6465 7074 682c 205c   nv.cvg_depth, \
-00057a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00057a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057a50: 2020 2020 2020 2020 2020 206e 762e 6376             nv.cv
-00057a60: 675f 6672 6163 2c20 6e76 2e72 6566 5f70  g_frac, nv.ref_p
-00057a70: 7265 762c 206e 762e 7265 665f 7365 712c  rev, nv.ref_seq,
-00057a80: 206e 762e 7265 665f 6e65 7874 2c20 6e76   nv.ref_next, nv
-00057a90: 2e61 6c74 5f70 7265 762c 206e 762e 616c  .alt_prev, nv.al
-00057aa0: 745f 7365 712c 206e 762e 616c 745f 6e65  t_seq, nv.alt_ne
-00057ab0: 7874 2c20 765f 636c 732c 2027 4e41 2729  xt, v_cls, 'NA')
-00057ac0: 2029 0a0a 2020 2020 2020 2020 6e76 5f69   )..        nv_i
-00057ad0: 6e66 6f5f 7472 5f6c 7374 203d 205b 5d0a  nfo_tr_lst = [].
-00057ae0: 2020 2020 2020 2020 6966 206c 656e 286e          if len(n
-00057af0: 765f 696e 666f 5f6c 7374 2920 3e20 303a  v_info_lst) > 0:
-00057b00: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-00057b10: 656c 662e 6e76 5f69 6e66 6f5f 6c73 7420  elf.nv_info_lst 
-00057b20: 3d20 6e76 5f69 6e66 6f5f 6c73 740a 2020  = nv_info_lst.  
-00057b30: 2020 2020 2020 2020 2020 7072 6f63 203d            proc =
-00057b40: 206e 702e 6675 6c6c 2820 6c65 6e28 6e76   np.full( len(nv
-00057b50: 5f69 6e66 6f5f 6c73 7429 2c20 4661 6c73  _info_lst), Fals
-00057b60: 6520 290a 0a20 2020 2020 2020 2020 2020  e )..           
-00057b70: 2023 2320 4669 6e64 206d 7574 6174 696f   ## Find mutatio
-00057b80: 6e73 2069 6e20 636f 6469 6e67 2072 6567  ns in coding reg
-00057b90: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00057ba0: 666f 7220 6b2c 2074 6420 696e 2065 6e75  for k, td in enu
-00057bb0: 6d65 7261 7465 2873 656c 662e 7464 5f6c  merate(self.td_l
-00057bc0: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-00057bd0: 2020 2020 2023 2074 642e 7463 5f74 6f5f       # td.tc_to_
-00057be0: 6763 5f6d 6170 203d 2073 656c 662e 7463  gc_map = self.tc
-00057bf0: 5f74 6f5f 6763 5f6d 6170 735b 6b5d 0a20  _to_gc_maps[k]. 
-00057c00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00057c10: 765f 696e 666f 5f74 722c 2070 726f 6365  v_info_tr, proce
-00057c20: 7373 6564 203d 2074 642e 6765 745f 6364  ssed = td.get_cd
-00057c30: 735f 6e76 5f69 6e66 6f28 206e 765f 696e  s_nv_info( nv_in
-00057c40: 666f 5f6c 7374 2c20 7365 6c66 2e63 6473  fo_lst, self.cds
-00057c50: 2e72 676e 7320 290a 2020 2020 2020 2020  .rgns ).        
-00057c60: 2020 2020 2020 2020 7072 6f63 203d 2070          proc = p
-00057c70: 726f 6320 7c20 7072 6f63 6573 7365 640a  roc | processed.
-00057c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057c90: 6e76 5f69 6e66 6f5f 7472 5f6c 7374 203d  nv_info_tr_lst =
-00057ca0: 206e 765f 696e 666f 5f74 725f 6c73 7420   nv_info_tr_lst 
-00057cb0: 2b20 6e76 5f69 6e66 6f5f 7472 0a0a 2020  + nv_info_tr..  
-00057cc0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00057cd0: 2873 656c 662e 6364 732e 7267 6e73 2920  (self.cds.rgns) 
-00057ce0: 3d3d 2030 3a20 2320 7365 6c66 2e69 6364  == 0: # self.icd
-00057cf0: 7320 3c3d 2030 3a20 2320 6966 204e 6f6e  s <= 0: # if Non
-00057d00: 2d63 6f64 696e 6720 6f72 2055 6e73 7065  -coding or Unspe
-00057d10: 6369 6669 6564 0a20 2020 2020 2020 2020  cified.         
-00057d20: 2020 2020 2020 2066 6f72 206b 2c20 6e76         for k, nv
-00057d30: 2069 6e20 656e 756d 6572 6174 6528 6e76   in enumerate(nv
-00057d40: 5f69 6e66 6f5f 6c73 7429 3a0a 2020 2020  _info_lst):.    
-00057d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057d60: 6966 206e 6f74 2070 726f 635b 6b5d 3a0a  if not proc[k]:.
-00057d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057d80: 2020 2020 2020 2020 6e76 5f69 6e66 6f20          nv_info 
-00057d90: 3d20 4e56 5f69 6e66 6f5f 6578 745f 7472  = NV_info_ext_tr
-00057da0: 286e 762e 6368 722c 206e 762e 706f 735f  (nv.chr, nv.pos_
-00057db0: 7265 662c 206e 762e 706f 735f 6e65 772c  ref, nv.pos_new,
-00057dc0: 206e 762e 6765 6e65 5f69 642c 206e 762e   nv.gene_id, nv.
-00057dd0: 6765 6e65 5f6e 616d 652c 206e 762e 765f  gene_name, nv.v_
-00057de0: 7479 7065 2c20 5c0a 2020 2020 2020 2020  type, \.        
+000578b0: 6e76 5f69 6e66 6f5f 6c73 742e 6170 7065  nv_info_lst.appe
+000578c0: 6e64 2820 4e56 5f69 6e66 6f5f 6578 7428  nd( NV_info_ext(
+000578d0: 6e76 2e63 6872 2c20 6e76 2e70 6f73 5f72  nv.chr, nv.pos_r
+000578e0: 6566 2c20 6e76 2e70 6f73 5f6e 6577 2c20  ef, nv.pos_new, 
+000578f0: 6e76 2e67 656e 655f 6964 2c20 6e76 2e67  nv.gene_id, nv.g
+00057900: 656e 655f 6e61 6d65 2c20 6e76 2e76 5f74  ene_name, nv.v_t
+00057910: 7970 652c 206e 762e 765f 6c65 6e2c 206e  ype, nv.v_len, n
+00057920: 762e 6376 675f 6465 7074 682c 205c 0a20  v.cvg_depth, \. 
+00057930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057950: 2020 2020 2020 2020 206e 762e 6376 675f           nv.cvg_
+00057960: 6672 6163 2c20 6e76 2e72 6566 5f70 7265  frac, nv.ref_pre
+00057970: 762c 206e 762e 7265 665f 7365 712c 206e  v, nv.ref_seq, n
+00057980: 762e 7265 665f 6e65 7874 2c20 6e76 2e61  v.ref_next, nv.a
+00057990: 6c74 5f70 7265 762c 206e 762e 616c 745f  lt_prev, nv.alt_
+000579a0: 7365 712c 206e 762e 616c 745f 6e65 7874  seq, nv.alt_next
+000579b0: 2c20 765f 636c 732c 2027 4e41 2729 2029  , v_cls, 'NA') )
+000579c0: 0a0a 2020 2020 2020 2020 6e76 5f69 6e66  ..        nv_inf
+000579d0: 6f5f 7472 5f6c 7374 203d 205b 5d0a 2020  o_tr_lst = [].  
+000579e0: 2020 2020 2020 6966 206c 656e 286e 765f        if len(nv_
+000579f0: 696e 666f 5f6c 7374 2920 3e20 303a 0a20  info_lst) > 0:. 
+00057a00: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+00057a10: 662e 6e76 5f69 6e66 6f5f 6c73 7420 3d20  f.nv_info_lst = 
+00057a20: 6e76 5f69 6e66 6f5f 6c73 740a 2020 2020  nv_info_lst.    
+00057a30: 2020 2020 2020 2020 7072 6f63 203d 206e          proc = n
+00057a40: 702e 6675 6c6c 2820 6c65 6e28 6e76 5f69  p.full( len(nv_i
+00057a50: 6e66 6f5f 6c73 7429 2c20 4661 6c73 6520  nfo_lst), False 
+00057a60: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00057a70: 2320 4669 6e64 206d 7574 6174 696f 6e73  # Find mutations
+00057a80: 2069 6e20 636f 6469 6e67 2072 6567 696f   in coding regio
+00057a90: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
+00057aa0: 636e 745f 6520 3d20 300a 2020 2020 2020  cnt_e = 0.      
+00057ab0: 2020 2020 2020 666f 7220 6b2c 2074 6420        for k, td 
+00057ac0: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
+00057ad0: 662e 7464 5f6c 7374 293a 0a20 2020 2020  f.td_lst):.     
+00057ae0: 2020 2020 2020 2020 2020 2023 2074 642e             # td.
+00057af0: 7463 5f74 6f5f 6763 5f6d 6170 203d 2073  tc_to_gc_map = s
+00057b00: 656c 662e 7463 5f74 6f5f 6763 5f6d 6170  elf.tc_to_gc_map
+00057b10: 735b 6b5d 0a20 2020 2020 2020 2020 2020  s[k].           
+00057b20: 2020 2020 206e 765f 696e 666f 5f74 722c       nv_info_tr,
+00057b30: 2070 726f 6365 7373 6564 2c20 636e 745f   processed, cnt_
+00057b40: 6520 3d20 7464 2e67 6574 5f63 6473 5f6e  e = td.get_cds_n
+00057b50: 765f 696e 666f 2820 6e76 5f69 6e66 6f5f  v_info( nv_info_
+00057b60: 6c73 742c 2073 656c 662e 6364 732e 7267  lst, self.cds.rg
+00057b70: 6e73 2c20 636e 745f 6520 290a 2020 2020  ns, cnt_e ).    
+00057b80: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00057b90: 203d 2070 726f 6320 7c20 7072 6f63 6573   = proc | proces
+00057ba0: 7365 640a 2020 2020 2020 2020 2020 2020  sed.            
+00057bb0: 2020 2020 6e76 5f69 6e66 6f5f 7472 5f6c      nv_info_tr_l
+00057bc0: 7374 203d 206e 765f 696e 666f 5f74 725f  st = nv_info_tr_
+00057bd0: 6c73 7420 2b20 6e76 5f69 6e66 6f5f 7472  lst + nv_info_tr
+00057be0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00057bf0: 206c 656e 2873 656c 662e 6364 732e 7267   len(self.cds.rg
+00057c00: 6e73 2920 3d3d 2030 3a20 2320 7365 6c66  ns) == 0: # self
+00057c10: 2e69 6364 7320 3c3d 2030 3a20 2320 6966  .icds <= 0: # if
+00057c20: 204e 6f6e 2d63 6f64 696e 6720 6f72 2055   Non-coding or U
+00057c30: 6e73 7065 6369 6669 6564 0a20 2020 2020  nspecified.     
+00057c40: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00057c50: 2c20 6e76 2069 6e20 656e 756d 6572 6174  , nv in enumerat
+00057c60: 6528 6e76 5f69 6e66 6f5f 6c73 7429 3a0a  e(nv_info_lst):.
+00057c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057c80: 2020 2020 6966 206e 6f74 2070 726f 635b      if not proc[
+00057c90: 6b5d 3a0a 2020 2020 2020 2020 2020 2020  k]:.            
+00057ca0: 2020 2020 2020 2020 2020 2020 6e76 5f69              nv_i
+00057cb0: 6e66 6f20 3d20 4e56 5f69 6e66 6f5f 6578  nfo = NV_info_ex
+00057cc0: 745f 7472 286e 762e 6368 722c 206e 762e  t_tr(nv.chr, nv.
+00057cd0: 706f 735f 7265 662c 206e 762e 706f 735f  pos_ref, nv.pos_
+00057ce0: 6e65 772c 206e 762e 6765 6e65 5f69 642c  new, nv.gene_id,
+00057cf0: 206e 762e 6765 6e65 5f6e 616d 652c 206e   nv.gene_name, n
+00057d00: 762e 765f 7479 7065 2c20 5c0a 2020 2020  v.v_type, \.    
+00057d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057d30: 2020 2020 2020 2020 2020 2020 206e 762e               nv.
+00057d40: 765f 6c65 6e2c 206e 762e 6376 675f 6465  v_len, nv.cvg_de
+00057d50: 7074 682c 206e 762e 6376 675f 6672 6163  pth, nv.cvg_frac
+00057d60: 2c20 6e76 2e72 6566 5f70 7265 762c 206e  , nv.ref_prev, n
+00057d70: 762e 7265 665f 7365 712c 206e 762e 7265  v.ref_seq, nv.re
+00057d80: 665f 6e65 7874 2c20 5c0a 2020 2020 2020  f_next, \.      
+00057d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057db0: 2020 2020 2020 2020 2020 206e 762e 616c             nv.al
+00057dc0: 745f 7072 6576 2c20 6e76 2e61 6c74 5f73  t_prev, nv.alt_s
+00057dd0: 6571 2c20 6e76 2e61 6c74 5f6e 6578 742c  eq, nv.alt_next,
+00057de0: 206e 762e 765f 636c 6173 732c 205c 0a20   nv.v_class, \. 
 00057df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00057e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057e10: 2020 2020 2020 2020 206e 762e 765f 6c65           nv.v_le
-00057e20: 6e2c 206e 762e 6376 675f 6465 7074 682c  n, nv.cvg_depth,
-00057e30: 206e 762e 6376 675f 6672 6163 2c20 6e76   nv.cvg_frac, nv
-00057e40: 2e72 6566 5f70 7265 762c 206e 762e 7265  .ref_prev, nv.re
-00057e50: 665f 7365 712c 206e 762e 7265 665f 6e65  f_seq, nv.ref_ne
-00057e60: 7874 2c20 5c0a 2020 2020 2020 2020 2020  xt, \.          
-00057e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057e90: 2020 2020 2020 206e 762e 616c 745f 7072         nv.alt_pr
-00057ea0: 6576 2c20 6e76 2e61 6c74 5f73 6571 2c20  ev, nv.alt_seq, 
-00057eb0: 6e76 2e61 6c74 5f6e 6578 742c 206e 762e  nv.alt_next, nv.
-00057ec0: 765f 636c 6173 732c 205c 0a20 2020 2020  v_class, \.     
-00057ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057ef0: 2020 2020 2020 2020 2020 2020 6e76 2e76              nv.v
-00057f00: 5f63 6c61 7373 2c20 2727 2c20 2727 2c20  _class, '', '', 
-00057f10: 2727 2c20 2727 2c20 2727 2920 232c 2027  '', '', '') #, '
-00057f20: 2720 290a 2020 2020 2020 2020 2020 2020  ' ).            
-00057f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057f50: 2020 2020 2023 2027 272c 2067 6574 5f73       # '', get_s
-00057f60: 7472 5f66 726f 6d5f 6963 646e 6728 7365  tr_from_icdng(se
-00057f70: 6c66 2e69 6364 7329 2c20 2727 2c20 2727  lf.icds), '', ''
-00057f80: 2c20 2727 2c20 2727 2c20 2727 2029 0a20  , '', '', '' ). 
-00057f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057fa0: 2020 2020 2020 206e 765f 696e 666f 5f74         nv_info_t
-00057fb0: 725f 6c73 742e 6170 7065 6e64 286e 765f  r_lst.append(nv_
-00057fc0: 696e 666f 290a 2020 2020 2020 2020 2020  info).          
-00057fd0: 2020 0a20 2020 2020 2020 2020 2020 2073    .            s
-00057fe0: 656c 662e 6e76 5f69 6e66 6f5f 6c73 7420  elf.nv_info_lst 
-00057ff0: 3d20 6e76 5f69 6e66 6f5f 7472 5f6c 7374  = nv_info_tr_lst
-00058000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00058010: 200a 2020 2020 2020 2020 7265 7475 726e   .        return
-00058020: 206e 765f 696e 666f 5f74 725f 6c73 740a   nv_info_tr_lst.
-00058030: 0a20 2020 2027 2727 0a20 2020 2053 4e56  .    '''.    SNV
-00058040: 5f69 6e66 6f20 3d20 636f 6c6c 6563 7469  _info = collecti
-00058050: 6f6e 732e 6e61 6d65 6474 7570 6c65 2827  ons.namedtuple('
-00058060: 534e 565f 696e 666f 272c 2027 6368 722c  SNV_info', 'chr,
-00058070: 2070 6f73 5f72 6566 2c20 706f 735f 6e65   pos_ref, pos_ne
-00058080: 772c 2067 656e 655f 6964 2c20 6765 6e65  w, gene_id, gene
-00058090: 5f6e 616d 652c 2076 5f74 7970 652c 2076  _name, v_type, v
-000580a0: 5f6c 656e 2c20 6376 675f 6465 7074 682c  _len, cvg_depth,
-000580b0: 2063 7667 5f66 7261 632c 205c 0a20 2020   cvg_frac, \.   
-000580c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000580d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000580e0: 7265 665f 7072 6576 2c20 7265 665f 7365  ref_prev, ref_se
-000580f0: 712c 2072 6566 5f6e 6578 742c 2061 6c74  q, ref_next, alt
-00058100: 5f70 7265 762c 2061 6c74 5f73 6571 2c20  _prev, alt_seq, 
-00058110: 616c 745f 6e65 7874 2729 2023 206f 6e65  alt_next') # one
-00058120: 2d62 6173 650a 2020 2020 2727 270a 2020  -base.    '''.  
-00058130: 2020 6465 6620 6669 6e64 5f73 6e70 5f66    def find_snp_f
-00058140: 726f 6d5f 7267 6e73 2873 656c 6629 3a0a  rom_rgns(self):.
-00058150: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00058160: 2073 6e76 5f69 6e66 6f5f 6c73 7420 3d20   snv_info_lst = 
-00058170: 5b5d 0a20 2020 2020 2020 2067 696e 203d  [].        gin =
-00058180: 2028 274e 4127 2c20 274e 4127 290a 0a20   ('NA', 'NA').. 
-00058190: 2020 2020 2020 2066 6f72 2072 2069 6e20         for r in 
-000581a0: 7365 6c66 2e72 676e 732e 7267 6e73 3a0a  self.rgns.rgns:.
-000581b0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-000581c0: 2020 2020 2020 2020 2069 6620 2872 2e74           if (r.t
-000581d0: 7970 6520 3d3d 2027 4927 2920 7c20 2872  ype == 'I') | (r
-000581e0: 2e74 7970 6520 3d3d 2027 696e 7365 7273  .type == 'insers
-000581f0: 696f 6e27 293a 0a20 2020 2020 2020 2020  ion'):.         
-00058200: 2020 2020 2020 2073 6f70 203d 2027 2d27         sop = '-'
-00058210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00058220: 2073 6f63 203d 2027 2d27 0a20 2020 2020   soc = '-'.     
-00058230: 2020 2020 2020 2020 2020 2073 6f6e 203d             son =
-00058240: 2027 2d27 0a20 2020 2020 2020 2020 2020   '-'.           
-00058250: 2020 2020 2073 6e70 203d 2027 2d27 0a20       snp = '-'. 
-00058260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00058270: 6e63 203d 2072 2e73 6571 0a20 2020 2020  nc = r.seq.     
-00058280: 2020 2020 2020 2020 2020 2073 6e6e 203d             snn =
-00058290: 2027 2d27 0a20 2020 2020 2020 2020 2020   '-'.           
-000582a0: 2020 2020 2073 6920 3d20 534e 565f 696e       si = SNV_in
-000582b0: 666f 2872 2e63 6872 2c20 722e 7374 6172  fo(r.chr, r.star
-000582c0: 742c 2072 2e73 7461 7274 2c20 6769 6e5b  t, r.start, gin[
-000582d0: 305d 2c20 6769 6e5b 315d 2c20 2749 272c  0], gin[1], 'I',
-000582e0: 2072 2e67 6574 5f6c 656e 2829 2c20 5c0a   r.get_len(), \.
-000582f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058300: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-00058310: 2e72 6f75 6e64 2872 2e61 7665 5f63 7667  .round(r.ave_cvg
-00058320: 5f64 6570 7468 2829 2c33 292c 206e 702e  _depth(),3), np.
-00058330: 726f 756e 6428 722e 6376 675f 6672 6163  round(r.cvg_frac
-00058340: 2c33 292c 2073 6f70 2c20 736f 632c 2073  ,3), sop, soc, s
-00058350: 6f6e 2c20 736e 702c 2073 6e63 2c20 736e  on, snp, snc, sn
-00058360: 6e20 290a 2020 2020 2020 2020 2020 2020  n ).            
-00058370: 2020 2020 736e 765f 696e 666f 5f6c 7374      snv_info_lst
-00058380: 2e61 7070 656e 6428 7369 290a 2020 2020  .append(si).    
-00058390: 2020 2020 2020 2020 656c 6966 2028 722e          elif (r.
-000583a0: 7479 7065 203d 3d20 2744 2729 207c 2028  type == 'D') | (
-000583b0: 722e 7479 7065 203d 3d20 2764 656c 6574  r.type == 'delet
-000583c0: 696f 6e27 293a 0a20 2020 2020 2020 2020  ion'):.         
-000583d0: 2020 2020 2020 2073 6f70 203d 2027 2d27         sop = '-'
-000583e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000583f0: 2073 6f63 203d 2027 2d27 0a20 2020 2020   soc = '-'.     
-00058400: 2020 2020 2020 2020 2020 2073 6f6e 203d             son =
-00058410: 2027 2d27 0a20 2020 2020 2020 2020 2020   '-'.           
-00058420: 2020 2020 2073 6e70 203d 2027 2d27 0a20       snp = '-'. 
-00058430: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00058440: 6e63 203d 2027 2d27 0a20 2020 2020 2020  nc = '-'.       
-00058450: 2020 2020 2020 2020 2073 6e6e 203d 2027           snn = '
-00058460: 2d27 0a20 2020 2020 2020 2020 2020 2020  -'.             
-00058470: 2020 2073 6920 3d20 534e 565f 696e 666f     si = SNV_info
-00058480: 2872 2e63 6872 2c20 722e 7374 6172 742c  (r.chr, r.start,
-00058490: 2072 2e73 7461 7274 2c20 6769 6e5b 305d   r.start, gin[0]
-000584a0: 2c20 6769 6e5b 315d 2c20 2744 272c 2072  , gin[1], 'D', r
-000584b0: 2e67 6574 5f6c 656e 2829 2c20 5c0a 2020  .get_len(), \.  
-000584c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000584d0: 2020 2020 2020 2020 2020 2020 6e70 2e72              np.r
-000584e0: 6f75 6e64 2872 2e61 7665 5f63 7667 5f64  ound(r.ave_cvg_d
-000584f0: 6570 7468 2829 2c33 292c 206e 702e 726f  epth(),3), np.ro
-00058500: 756e 6428 722e 6376 675f 6672 6163 2c33  und(r.cvg_frac,3
-00058510: 292c 2073 6f70 2c20 736f 632c 2073 6f6e  ), sop, soc, son
-00058520: 2c20 736e 702c 2073 6e63 2c20 736e 6e20  , snp, snc, snn 
-00058530: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00058540: 2020 736e 765f 696e 666f 5f6c 7374 2e61    snv_info_lst.a
-00058550: 7070 656e 6428 7369 290a 0a20 2020 2020  ppend(si)..     
-00058560: 2020 2073 656c 662e 6e76 5f69 6e66 6f5f     self.nv_info_
-00058570: 6c73 7420 3d20 736e 765f 696e 666f 5f6c  lst = snv_info_l
-00058580: 7374 0a20 2020 2020 2020 2072 6574 7572  st.        retur
-00058590: 6e28 736e 765f 696e 666f 5f6c 7374 290a  n(snv_info_lst).
-000585a0: 0a0a 2020 2020 6465 6620 6765 745f 6769  ..    def get_gi
-000585b0: 645f 6e5f 676e 616d 655f 6c69 7374 2873  d_n_gname_list(s
-000585c0: 656c 6629 3a0a 0a20 2020 2020 2020 2067  elf):..        g
-000585d0: 5f69 645f 6e5f 6e61 6d65 203d 205b 5d0a  _id_n_name = [].
-000585e0: 2020 2020 2020 2020 676e 616d 6520 3d20          gname = 
-000585f0: 5b5d 0a0a 2020 2020 2020 2020 666f 7220  []..        for 
-00058600: 6d2c 2072 2069 6e20 656e 756d 6572 6174  m, r in enumerat
-00058610: 6528 7365 6c66 2e65 786f 6e73 2e72 676e  e(self.exons.rgn
-00058620: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00058630: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
-00058640: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
-00058650: 616e 6765 2873 656c 662e 6e74 7229 3a0a  ange(self.ntr):.
-00058660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058670: 6966 206d 2069 6e20 7365 6c66 2e74 655f  if m in self.te_
-00058680: 746f 5f67 655f 6d61 7073 5b6a 5d3a 0a20  to_ge_maps[j]:. 
-00058690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000586a0: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
-000586b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000586c0: 675f 6964 5f6e 5f6e 616d 652e 6170 7065  g_id_n_name.appe
-000586d0: 6e64 2828 7365 6c66 2e74 645f 6c73 745b  nd((self.td_lst[
-000586e0: 6a5d 2e67 6964 2c20 7365 6c66 2e74 645f  j].gid, self.td_
-000586f0: 6c73 745b 6a5d 2e67 6e61 6d65 2929 0a20  lst[j].gname)). 
-00058700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058710: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00058720: 2020 2020 2069 6620 6e6f 7420 623a 0a20       if not b:. 
-00058730: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00058740: 5f69 645f 6e5f 6e61 6d65 2e61 7070 656e  _id_n_name.appen
-00058750: 6428 2827 272c 2027 2729 290a 2020 2020  d(('', '')).    
-00058760: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00058770: 696e 7428 2745 5252 4f52 2069 6e20 6765  int('ERROR in ge
-00058780: 6e65 5f64 6573 6372 6970 746f 723a 3a67  ne_descriptor::g
-00058790: 6574 5f67 6964 5f6e 5f67 6e61 6d65 5f6c  et_gid_n_gname_l
-000587a0: 6973 7420 2729 0a20 2020 2020 2020 2072  ist ').        r
-000587b0: 6574 7572 6e20 675f 6964 5f6e 5f6e 616d  eturn g_id_n_nam
-000587c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000587d0: 2020 2020 2020 0a0a 2020 2020 6465 6620        ..    def 
-000587e0: 7365 745f 636f 765f 6e5f 6162 6e5f 7468  set_cov_n_abn_th
-000587f0: 2873 656c 662c 2043 6f76 5f74 682c 2041  (self, Cov_th, A
-00058800: 626e 5f74 6829 3a0a 2020 2020 2020 2020  bn_th):.        
-00058810: 7365 6c66 2e63 6f76 5f74 6820 3d20 436f  self.cov_th = Co
-00058820: 765f 7468 0a20 2020 2020 2020 2073 656c  v_th.        sel
-00058830: 662e 6162 6e5f 7468 203d 2041 626e 5f74  f.abn_th = Abn_t
-00058840: 680a 2020 2020 2020 2020 0a0a 2020 2020  h.        ..    
-00058850: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00058860: 662c 2067 7466 5f6c 696e 6573 5f6f 665f  f, gtf_lines_of_
-00058870: 615f 6765 6e65 203d 204e 6f6e 652c 2067  a_gene = None, g
-00058880: 656e 6f6d 6520 3d20 4e6f 6e65 2c20 6963  enome = None, ic
-00058890: 6473 203d 202d 312c 2066 696c 6c20 3d20  ds = -1, fill = 
-000588a0: 4661 6c73 652c 205c 0a20 2020 2020 2020  False, \.       
-000588b0: 2020 2020 2020 2020 2020 6763 6e74 203d            gcnt =
-000588c0: 2030 2c20 7665 7262 6f73 6520 3d20 4661   0, verbose = Fa
-000588d0: 6c73 652c 2043 6f76 5f74 6820 3d20 4d49  lse, Cov_th = MI
-000588e0: 4e5f 434f 565f 544f 5f53 454c 2c20 4162  N_COV_TO_SEL, Ab
-000588f0: 6e5f 7468 203d 204d 494e 5f41 424e 5f54  n_th = MIN_ABN_T
-00058900: 4f5f 5345 4c2c 2072 6561 645f 6c65 6e20  O_SEL, read_len 
-00058910: 3d20 3130 3029 3a0a 0a20 2020 2020 2020  = 100):..       
-00058920: 2023 2073 656c 662e 6774 665f 6c69 6e65   # self.gtf_line
-00058930: 7320 3d20 6774 665f 6c69 6e65 735f 6f66  s = gtf_lines_of
-00058940: 5f61 5f67 656e 6520 200a 2020 2020 2020  _a_gene  .      
-00058950: 2020 7365 6c66 2e67 7466 203d 2054 7275    self.gtf = Tru
-00058960: 650a 2020 2020 2020 2020 6966 2067 7466  e.        if gtf
-00058970: 5f6c 696e 6573 5f6f 665f 615f 6765 6e65  _lines_of_a_gene
-00058980: 2069 7320 4e6f 6e65 3a20 7365 6c66 2e67   is None: self.g
-00058990: 7466 203d 2046 616c 7365 0a20 2020 2020  tf = False.     
-000589a0: 200a 2020 2020 2020 2020 7365 6c66 2e67   .        self.g
-000589b0: 636e 7420 3d20 6763 6e74 0a20 2020 2020  cnt = gcnt.     
-000589c0: 2020 2073 656c 662e 7265 6164 5f6c 656e     self.read_len
-000589d0: 203d 2072 6561 645f 6c65 6e0a 2020 2020   = read_len.    
-000589e0: 2020 2020 0a20 2020 2020 2020 2023 2073      .        # s
-000589f0: 656c 662e 6963 6473 203d 2069 6364 730a  elf.icds = icds.
-00058a00: 2020 2020 2020 2020 7365 6c66 2e63 6872          self.chr
-00058a10: 203d 2027 270a 2020 2020 2020 2020 7365   = ''.        se
-00058a20: 6c66 2e62 6567 696e 203d 202d 310a 2020  lf.begin = -1.  
-00058a30: 2020 2020 2020 7365 6c66 2e65 6e64 203d        self.end =
-00058a40: 202d 310a 2020 2020 2020 2020 7365 6c66   -1.        self
-00058a50: 2e65 786f 6e73 203d 2072 6567 696f 6e73  .exons = regions
-00058a60: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00058a70: 6364 7320 3d20 7265 6769 6f6e 7328 290a  cds = regions().
-00058a80: 2020 2020 2020 2020 7365 6c66 2e72 676e          self.rgn
-00058a90: 7320 3d20 7265 6769 6f6e 7328 290a 2020  s = regions().  
-00058aa0: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
-00058ab0: 656c 662e 6e74 7220 3d20 300a 2020 2020  elf.ntr = 0.    
-00058ac0: 2020 2020 7365 6c66 2e74 645f 6c73 7420      self.td_lst 
-00058ad0: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
-00058ae0: 662e 7465 5f74 6f5f 6765 5f6d 6170 7320  f.te_to_ge_maps 
-00058af0: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
-00058b00: 662e 7463 5f74 6f5f 6763 5f6d 6170 7320  f.tc_to_gc_maps 
-00058b10: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
-00058b20: 662e 7472 5f74 6f5f 6772 5f6d 6170 7320  f.tr_to_gr_maps 
-00058b30: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
-00058b40: 662e 7472 5f69 6e66 6f20 3d20 5b5d 0a20  f.tr_info = []. 
-00058b50: 2020 2020 2020 2073 656c 662e 6e76 5f69         self.nv_i
-00058b60: 6e66 6f5f 6c73 7420 3d20 5b5d 0a20 2020  nfo_lst = [].   
-00058b70: 2020 2020 200a 2020 2020 2020 2020 7365       .        se
-00058b80: 6c66 2e74 5f61 626e 203d 202d 310a 2020  lf.t_abn = -1.  
-00058b90: 2020 2020 2020 7365 6c66 2e72 5f74 706d        self.r_tpm
-00058ba0: 203d 202d 310a 0a20 2020 2020 2020 2073   = -1..        s
-00058bb0: 656c 662e 636f 765f 7468 203d 2043 6f76  elf.cov_th = Cov
-00058bc0: 5f74 680a 2020 2020 2020 2020 7365 6c66  _th.        self
-00058bd0: 2e61 626e 5f74 6820 3d20 4162 6e5f 7468  .abn_th = Abn_th
-00058be0: 0a0a 2020 2020 2020 2020 6966 2067 7466  ..        if gtf
-00058bf0: 5f6c 696e 6573 5f6f 665f 615f 6765 6e65  _lines_of_a_gene
-00058c00: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 0a20   is not None:.. 
-00058c10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00058c20: 6265 6769 6e20 3d20 6d69 6e28 6765 745f  begin = min(get_
-00058c30: 636f 6c28 6774 665f 6c69 6e65 735f 6f66  col(gtf_lines_of
-00058c40: 5f61 5f67 656e 652c 2047 5354 4152 5429  _a_gene, GSTART)
-00058c50: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00058c60: 6c66 2e65 6e64 203d 206d 6178 2867 6574  lf.end = max(get
-00058c70: 5f63 6f6c 2867 7466 5f6c 696e 6573 5f6f  _col(gtf_lines_o
-00058c80: 665f 615f 6765 6e65 2c20 4745 4e44 2929  f_a_gene, GEND))
-00058c90: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00058ca0: 2020 2020 2020 2020 2020 6368 7273 203d            chrs =
-00058cb0: 2067 6574 5f63 6f6c 2867 7466 5f6c 696e   get_col(gtf_lin
-00058cc0: 6573 5f6f 665f 615f 6765 6e65 2c20 4348  es_of_a_gene, CH
-00058cd0: 5229 0a20 2020 2020 2020 2020 2020 2063  R).            c
-00058ce0: 6872 7320 3d20 6c69 7374 2873 6574 2863  hrs = list(set(c
-00058cf0: 6872 7329 290a 2020 2020 2020 2020 2020  hrs)).          
-00058d00: 2020 6966 206c 656e 2863 6872 7329 203e    if len(chrs) >
-00058d10: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00058d20: 2020 2020 7072 696e 7428 2720 2020 5741      print('   WA
-00058d30: 524e 494e 4720 696e 2067 656e 655f 6465  RNING in gene_de
-00058d40: 7363 7269 7074 6f72 3a3a 696e 6974 3a20  scriptor::init: 
-00058d50: 7370 616e 7320 6f76 6572 2025 6920 6368  spans over %i ch
-00058d60: 726f 6d6f 736f 6d65 732e 2720 2520 6c65  romosomes.' % le
-00058d70: 6e28 6368 7273 2920 290a 0a20 2020 2020  n(chrs) )..     
-00058d80: 2020 2020 2020 2073 656c 662e 6368 7220         self.chr 
-00058d90: 3d20 6368 7273 5b30 5d0a 2020 2020 2020  = chrs[0].      
-00058da0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00058db0: 2020 2020 2020 2020 2020 2074 725f 6774             tr_gt
-00058dc0: 665f 6c73 7420 3d20 7061 7273 655f 6774  f_lst = parse_gt
-00058dd0: 665f 6c69 6e65 735f 616e 645f 7370 6c69  f_lines_and_spli
-00058de0: 745f 696e 746f 5f67 656e 6573 2820 6774  t_into_genes( gt
-00058df0: 665f 6c69 6e65 735f 6f66 5f61 5f67 656e  f_lines_of_a_gen
-00058e00: 652c 2027 7472 616e 7363 7269 7074 2720  e, 'transcript' 
-00058e10: 290a 2020 2020 2020 2020 2020 2020 6e5f  ).            n_
-00058e20: 7661 6c69 645f 7472 7320 3d20 300a 2020  valid_trs = 0.  
-00058e30: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
-00058e40: 2067 6c73 5f6f 7267 2069 6e20 656e 756d   gls_org in enum
-00058e50: 6572 6174 6528 7472 5f67 7466 5f6c 7374  erate(tr_gtf_lst
-00058e60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00058e70: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00058e80: 2020 2020 676c 7320 3d20 736f 7274 5f67      gls = sort_g
-00058e90: 7466 5f6c 696e 6573 2867 6c73 5f6f 7267  tf_lines(gls_org
-00058ea0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00058eb0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-00058ec0: 2020 2074 6420 3d20 7472 616e 7363 7269     td = transcri
-00058ed0: 7074 5f64 6573 6372 6970 746f 7228 676c  pt_descriptor(gl
-00058ee0: 732c 2073 656c 662e 6578 6f6e 732e 7267  s, self.exons.rg
-00058ef0: 6e73 2c20 7365 6c66 2e63 6473 2e72 676e  ns, self.cds.rgn
-00058f00: 732c 2067 656e 6f6d 652c 2069 6364 732c  s, genome, icds,
-00058f10: 2066 696c 6c29 0a20 2020 2020 2020 2020   fill).         
-00058f20: 2020 2020 2020 2073 656c 662e 7464 5f6c         self.td_l
-00058f30: 7374 2e61 7070 656e 6428 7464 290a 2020  st.append(td).  
-00058f40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00058f50: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
-00058f60: 2e61 7070 656e 6428 7464 2e74 655f 746f  .append(td.te_to
-00058f70: 5f67 655f 6d61 7029 0a20 2020 2020 2020  _ge_map).       
-00058f80: 2020 2020 2020 2020 2073 656c 662e 7463           self.tc
-00058f90: 5f74 6f5f 6763 5f6d 6170 732e 6170 7065  _to_gc_maps.appe
-00058fa0: 6e64 2874 642e 7463 5f74 6f5f 6763 5f6d  nd(td.tc_to_gc_m
-00058fb0: 6170 290a 2020 2020 2020 2020 2020 2020  ap).            
-00058fc0: 2020 2020 6966 206c 656e 2874 642e 7465      if len(td.te
-00058fd0: 5f74 6f5f 6765 5f6d 6170 2920 3e20 303a  _to_ge_map) > 0:
-00058fe0: 206e 5f76 616c 6964 5f74 7273 202b 3d20   n_valid_trs += 
-00058ff0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00059000: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-00059010: 2054 7275 653a 2023 206e 6f74 2066 696c   True: # not fil
-00059020: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
-00059030: 2020 2065 786f 6e73 203d 2073 656c 662e     exons = self.
-00059040: 6578 6f6e 732e 636f 7079 2875 7064 6174  exons.copy(updat
-00059050: 6520 3d20 6669 6c6c 290a 0a20 2020 2020  e = fill)..     
-00059060: 2020 2020 2020 2020 2020 204e 203d 206c             N = l
-00059070: 656e 2865 786f 6e73 2e72 676e 7329 2a32  en(exons.rgns)*2
-00059080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059090: 206e 5f6c 6f6f 7020 3d20 300a 2020 2020   n_loop = 0.    
-000590a0: 2020 2020 2020 2020 2020 2020 2320 7768              # wh
-000590b0: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
-000590c0: 2020 2020 2020 2020 2020 666f 7220 6e20            for n 
-000590d0: 696e 2072 616e 6765 284e 293a 0a20 2020  in range(N):.   
-000590e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000590f0: 2065 6c65 6e20 3d20 6e70 2e7a 6572 6f73   elen = np.zeros
-00059100: 286c 656e 2865 786f 6e73 2e72 676e 7329  (len(exons.rgns)
-00059110: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
-00059120: 2020 2020 2020 2066 6f72 206b 2c20 6520         for k, e 
-00059130: 696e 2065 6e75 6d65 7261 7465 2865 786f  in enumerate(exo
-00059140: 6e73 2e72 676e 7329 3a20 656c 656e 5b6b  ns.rgns): elen[k
-00059150: 5d20 3d20 652e 7374 6172 740a 2020 2020  ] = e.start.    
-00059160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059170: 6f64 7220 3d20 656c 656e 2e61 7267 736f  odr = elen.argso
-00059180: 7274 2829 0a20 2020 2020 2020 2020 2020  rt().           
-00059190: 2020 2020 2020 2020 2063 6e74 5f6f 203d           cnt_o =
-000591a0: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-000591b0: 2020 2020 2020 2074 6f5f 6465 6c20 3d20         to_del = 
-000591c0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-000591d0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-000591e0: 7261 6e67 6528 6c65 6e28 6f64 7229 293a  range(len(odr)):
-000591f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059200: 2020 2020 2020 2020 2069 6620 6b20 3c20           if k < 
-00059210: 286c 656e 286f 6472 292d 3129 3a0a 2020  (len(odr)-1):.  
-00059220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059230: 2020 2020 2020 2020 2020 6570 203d 2065            ep = e
-00059240: 786f 6e73 2e72 676e 735b 6f64 725b 6b5d  xons.rgns[odr[k]
-00059250: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00059260: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00059270: 7220 6d20 696e 2072 616e 6765 286b 2b31  r m in range(k+1
-00059280: 2c6c 656e 286f 6472 2929 3a0a 2020 2020  ,len(odr)):.    
-00059290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000592a0: 2020 2020 2020 2020 2020 2020 656e 203d              en =
-000592b0: 2065 786f 6e73 2e72 676e 735b 6f64 725b   exons.rgns[odr[
-000592c0: 6d5d 5d0a 2020 2020 2020 2020 2020 2020  m]].            
-000592d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000592e0: 2020 2020 6966 2065 702e 7479 7065 203d      if ep.type =
-000592f0: 3d20 656e 2e74 7970 653a 2023 2028 6570  = en.type: # (ep
-00059300: 2e74 7970 6520 3d3d 2027 6578 6f6e 2729  .type == 'exon')
-00059310: 2026 2028 656e 2e74 7970 6520 3d3d 2027   & (en.type == '
-00059320: 6578 6f6e 2729 3a0a 2020 2020 2020 2020  exon'):.        
+00057e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057e20: 6e76 2e76 5f63 6c61 7373 2c20 2727 2c20  nv.v_class, '', 
+00057e30: 2727 2c20 2727 2c20 2727 2c20 2727 2920  '', '', '', '') 
+00057e40: 232c 2027 2720 290a 2020 2020 2020 2020  #, '' ).        
+00057e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057e70: 2020 2020 2020 2020 2023 2027 272c 2067           # '', g
+00057e80: 6574 5f73 7472 5f66 726f 6d5f 6963 646e  et_str_from_icdn
+00057e90: 6728 7365 6c66 2e69 6364 7329 2c20 2727  g(self.icds), ''
+00057ea0: 2c20 2727 2c20 2727 2c20 2727 2c20 2727  , '', '', '', ''
+00057eb0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00057ec0: 2020 2020 2020 2020 2020 206e 765f 696e             nv_in
+00057ed0: 666f 5f74 725f 6c73 742e 6170 7065 6e64  fo_tr_lst.append
+00057ee0: 286e 765f 696e 666f 290a 2020 2020 2020  (nv_info).      
+00057ef0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+00057f00: 2020 2073 656c 662e 6e76 5f69 6e66 6f5f     self.nv_info_
+00057f10: 6c73 7420 3d20 6e76 5f69 6e66 6f5f 7472  lst = nv_info_tr
+00057f20: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+00057f30: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
+00057f40: 7475 726e 206e 765f 696e 666f 5f74 725f  turn nv_info_tr_
+00057f50: 6c73 742c 2063 6e74 5f65 0a0a 2020 2020  lst, cnt_e..    
+00057f60: 2727 270a 2020 2020 534e 565f 696e 666f  '''.    SNV_info
+00057f70: 203d 2063 6f6c 6c65 6374 696f 6e73 2e6e   = collections.n
+00057f80: 616d 6564 7475 706c 6528 2753 4e56 5f69  amedtuple('SNV_i
+00057f90: 6e66 6f27 2c20 2763 6872 2c20 706f 735f  nfo', 'chr, pos_
+00057fa0: 7265 662c 2070 6f73 5f6e 6577 2c20 6765  ref, pos_new, ge
+00057fb0: 6e65 5f69 642c 2067 656e 655f 6e61 6d65  ne_id, gene_name
+00057fc0: 2c20 765f 7479 7065 2c20 765f 6c65 6e2c  , v_type, v_len,
+00057fd0: 2063 7667 5f64 6570 7468 2c20 6376 675f   cvg_depth, cvg_
+00057fe0: 6672 6163 2c20 5c0a 2020 2020 2020 2020  frac, \.        
+00057ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058000: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
+00058010: 7265 762c 2072 6566 5f73 6571 2c20 7265  rev, ref_seq, re
+00058020: 665f 6e65 7874 2c20 616c 745f 7072 6576  f_next, alt_prev
+00058030: 2c20 616c 745f 7365 712c 2061 6c74 5f6e  , alt_seq, alt_n
+00058040: 6578 7427 2920 2320 6f6e 652d 6261 7365  ext') # one-base
+00058050: 0a20 2020 2027 2727 0a20 2020 2064 6566  .    '''.    def
+00058060: 2066 696e 645f 736e 705f 6672 6f6d 5f72   find_snp_from_r
+00058070: 676e 7328 7365 6c66 293a 0a20 2020 2020  gns(self):.     
+00058080: 2020 200a 2020 2020 2020 2020 736e 765f     .        snv_
+00058090: 696e 666f 5f6c 7374 203d 205b 5d0a 2020  info_lst = [].  
+000580a0: 2020 2020 2020 6769 6e20 3d20 2827 4e41        gin = ('NA
+000580b0: 272c 2027 4e41 2729 0a0a 2020 2020 2020  ', 'NA')..      
+000580c0: 2020 666f 7220 7220 696e 2073 656c 662e    for r in self.
+000580d0: 7267 6e73 2e72 676e 733a 0a20 2020 2020  rgns.rgns:.     
+000580e0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000580f0: 2020 2020 6966 2028 722e 7479 7065 203d      if (r.type =
+00058100: 3d20 2749 2729 207c 2028 722e 7479 7065  = 'I') | (r.type
+00058110: 203d 3d20 2769 6e73 6572 7369 6f6e 2729   == 'insersion')
+00058120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00058130: 2020 736f 7020 3d20 272d 270a 2020 2020    sop = '-'.    
+00058140: 2020 2020 2020 2020 2020 2020 736f 6320              soc 
+00058150: 3d20 272d 270a 2020 2020 2020 2020 2020  = '-'.          
+00058160: 2020 2020 2020 736f 6e20 3d20 272d 270a        son = '-'.
+00058170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058180: 736e 7020 3d20 272d 270a 2020 2020 2020  snp = '-'.      
+00058190: 2020 2020 2020 2020 2020 736e 6320 3d20            snc = 
+000581a0: 722e 7365 710a 2020 2020 2020 2020 2020  r.seq.          
+000581b0: 2020 2020 2020 736e 6e20 3d20 272d 270a        snn = '-'.
+000581c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000581d0: 7369 203d 2053 4e56 5f69 6e66 6f28 722e  si = SNV_info(r.
+000581e0: 6368 722c 2072 2e73 7461 7274 2c20 722e  chr, r.start, r.
+000581f0: 7374 6172 742c 2067 696e 5b30 5d2c 2067  start, gin[0], g
+00058200: 696e 5b31 5d2c 2027 4927 2c20 722e 6765  in[1], 'I', r.ge
+00058210: 745f 6c65 6e28 292c 205c 0a20 2020 2020  t_len(), \.     
+00058220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058230: 2020 2020 2020 2020 206e 702e 726f 756e           np.roun
+00058240: 6428 722e 6176 655f 6376 675f 6465 7074  d(r.ave_cvg_dept
+00058250: 6828 292c 3329 2c20 6e70 2e72 6f75 6e64  h(),3), np.round
+00058260: 2872 2e63 7667 5f66 7261 632c 3329 2c20  (r.cvg_frac,3), 
+00058270: 736f 702c 2073 6f63 2c20 736f 6e2c 2073  sop, soc, son, s
+00058280: 6e70 2c20 736e 632c 2073 6e6e 2029 0a20  np, snc, snn ). 
+00058290: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000582a0: 6e76 5f69 6e66 6f5f 6c73 742e 6170 7065  nv_info_lst.appe
+000582b0: 6e64 2873 6929 0a20 2020 2020 2020 2020  nd(si).         
+000582c0: 2020 2065 6c69 6620 2872 2e74 7970 6520     elif (r.type 
+000582d0: 3d3d 2027 4427 2920 7c20 2872 2e74 7970  == 'D') | (r.typ
+000582e0: 6520 3d3d 2027 6465 6c65 7469 6f6e 2729  e == 'deletion')
+000582f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00058300: 2020 736f 7020 3d20 272d 270a 2020 2020    sop = '-'.    
+00058310: 2020 2020 2020 2020 2020 2020 736f 6320              soc 
+00058320: 3d20 272d 270a 2020 2020 2020 2020 2020  = '-'.          
+00058330: 2020 2020 2020 736f 6e20 3d20 272d 270a        son = '-'.
+00058340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058350: 736e 7020 3d20 272d 270a 2020 2020 2020  snp = '-'.      
+00058360: 2020 2020 2020 2020 2020 736e 6320 3d20            snc = 
+00058370: 272d 270a 2020 2020 2020 2020 2020 2020  '-'.            
+00058380: 2020 2020 736e 6e20 3d20 272d 270a 2020      snn = '-'.  
+00058390: 2020 2020 2020 2020 2020 2020 2020 7369                si
+000583a0: 203d 2053 4e56 5f69 6e66 6f28 722e 6368   = SNV_info(r.ch
+000583b0: 722c 2072 2e73 7461 7274 2c20 722e 7374  r, r.start, r.st
+000583c0: 6172 742c 2067 696e 5b30 5d2c 2067 696e  art, gin[0], gin
+000583d0: 5b31 5d2c 2027 4427 2c20 722e 6765 745f  [1], 'D', r.get_
+000583e0: 6c65 6e28 292c 205c 0a20 2020 2020 2020  len(), \.       
+000583f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058400: 2020 2020 2020 206e 702e 726f 756e 6428         np.round(
+00058410: 722e 6176 655f 6376 675f 6465 7074 6828  r.ave_cvg_depth(
+00058420: 292c 3329 2c20 6e70 2e72 6f75 6e64 2872  ),3), np.round(r
+00058430: 2e63 7667 5f66 7261 632c 3329 2c20 736f  .cvg_frac,3), so
+00058440: 702c 2073 6f63 2c20 736f 6e2c 2073 6e70  p, soc, son, snp
+00058450: 2c20 736e 632c 2073 6e6e 2029 0a20 2020  , snc, snn ).   
+00058460: 2020 2020 2020 2020 2020 2020 2073 6e76               snv
+00058470: 5f69 6e66 6f5f 6c73 742e 6170 7065 6e64  _info_lst.append
+00058480: 2873 6929 0a0a 2020 2020 2020 2020 7365  (si)..        se
+00058490: 6c66 2e6e 765f 696e 666f 5f6c 7374 203d  lf.nv_info_lst =
+000584a0: 2073 6e76 5f69 6e66 6f5f 6c73 740a 2020   snv_info_lst.  
+000584b0: 2020 2020 2020 7265 7475 726e 2873 6e76        return(snv
+000584c0: 5f69 6e66 6f5f 6c73 7429 0a0a 0a20 2020  _info_lst)...   
+000584d0: 2064 6566 2067 6574 5f67 6964 5f6e 5f67   def get_gid_n_g
+000584e0: 6e61 6d65 5f6c 6973 7428 7365 6c66 293a  name_list(self):
+000584f0: 0a0a 2020 2020 2020 2020 675f 6964 5f6e  ..        g_id_n
+00058500: 5f6e 616d 6520 3d20 5b5d 0a20 2020 2020  _name = [].     
+00058510: 2020 2067 6e61 6d65 203d 205b 5d0a 0a20     gname = [].. 
+00058520: 2020 2020 2020 2066 6f72 206d 2c20 7220         for m, r 
+00058530: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
+00058540: 662e 6578 6f6e 732e 7267 6e73 293a 0a20  f.exons.rgns):. 
+00058550: 2020 2020 2020 2020 2020 2062 203d 2046             b = F
+00058560: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00058570: 2066 6f72 206a 2069 6e20 7261 6e67 6528   for j in range(
+00058580: 7365 6c66 2e6e 7472 293a 0a20 2020 2020  self.ntr):.     
+00058590: 2020 2020 2020 2020 2020 2069 6620 6d20             if m 
+000585a0: 696e 2073 656c 662e 7465 5f74 6f5f 6765  in self.te_to_ge
+000585b0: 5f6d 6170 735b 6a5d 3a0a 2020 2020 2020  _maps[j]:.      
+000585c0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+000585d0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+000585e0: 2020 2020 2020 2020 2020 2067 5f69 645f             g_id_
+000585f0: 6e5f 6e61 6d65 2e61 7070 656e 6428 2873  n_name.append((s
+00058600: 656c 662e 7464 5f6c 7374 5b6a 5d2e 6769  elf.td_lst[j].gi
+00058610: 642c 2073 656c 662e 7464 5f6c 7374 5b6a  d, self.td_lst[j
+00058620: 5d2e 676e 616d 6529 290a 2020 2020 2020  ].gname)).      
+00058630: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00058640: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00058650: 6966 206e 6f74 2062 3a0a 2020 2020 2020  if not b:.      
+00058660: 2020 2020 2020 2020 2020 675f 6964 5f6e            g_id_n
+00058670: 5f6e 616d 652e 6170 7065 6e64 2828 2727  _name.append((''
+00058680: 2c20 2727 2929 0a20 2020 2020 2020 2020  , '')).         
+00058690: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+000586a0: 4552 524f 5220 696e 2067 656e 655f 6465  ERROR in gene_de
+000586b0: 7363 7269 7074 6f72 3a3a 6765 745f 6769  scriptor::get_gi
+000586c0: 645f 6e5f 676e 616d 655f 6c69 7374 2027  d_n_gname_list '
+000586d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000586e0: 2067 5f69 645f 6e5f 6e61 6d65 0a20 2020   g_id_n_name.   
+000586f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058700: 200a 0a20 2020 2064 6566 2073 6574 5f63   ..    def set_c
+00058710: 6f76 5f6e 5f61 626e 5f74 6828 7365 6c66  ov_n_abn_th(self
+00058720: 2c20 436f 765f 7468 2c20 4162 6e5f 7468  , Cov_th, Abn_th
+00058730: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00058740: 636f 765f 7468 203d 2043 6f76 5f74 680a  cov_th = Cov_th.
+00058750: 2020 2020 2020 2020 7365 6c66 2e61 626e          self.abn
+00058760: 5f74 6820 3d20 4162 6e5f 7468 0a20 2020  _th = Abn_th.   
+00058770: 2020 2020 200a 0a20 2020 2064 6566 205f       ..    def _
+00058780: 5f69 6e69 745f 5f28 7365 6c66 2c20 6774  _init__(self, gt
+00058790: 665f 6c69 6e65 735f 6f66 5f61 5f67 656e  f_lines_of_a_gen
+000587a0: 6520 3d20 4e6f 6e65 2c20 6765 6e6f 6d65  e = None, genome
+000587b0: 203d 204e 6f6e 652c 2069 6364 7320 3d20   = None, icds = 
+000587c0: 2d31 2c20 6669 6c6c 203d 2046 616c 7365  -1, fill = False
+000587d0: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+000587e0: 2020 2020 2067 636e 7420 3d20 302c 2076       gcnt = 0, v
+000587f0: 6572 626f 7365 203d 2046 616c 7365 2c20  erbose = False, 
+00058800: 436f 765f 7468 203d 204d 494e 5f43 4f56  Cov_th = MIN_COV
+00058810: 5f54 4f5f 5345 4c2c 2041 626e 5f74 6820  _TO_SEL, Abn_th 
+00058820: 3d20 4d49 4e5f 4142 4e5f 544f 5f53 454c  = MIN_ABN_TO_SEL
+00058830: 2c20 7265 6164 5f6c 656e 203d 2031 3030  , read_len = 100
+00058840: 293a 0a0a 2020 2020 2020 2020 2320 7365  ):..        # se
+00058850: 6c66 2e67 7466 5f6c 696e 6573 203d 2067  lf.gtf_lines = g
+00058860: 7466 5f6c 696e 6573 5f6f 665f 615f 6765  tf_lines_of_a_ge
+00058870: 6e65 2020 0a20 2020 2020 2020 2073 656c  ne  .        sel
+00058880: 662e 6774 6620 3d20 5472 7565 0a20 2020  f.gtf = True.   
+00058890: 2020 2020 2069 6620 6774 665f 6c69 6e65       if gtf_line
+000588a0: 735f 6f66 5f61 5f67 656e 6520 6973 204e  s_of_a_gene is N
+000588b0: 6f6e 653a 2073 656c 662e 6774 6620 3d20  one: self.gtf = 
+000588c0: 4661 6c73 650a 2020 2020 2020 0a20 2020  False.      .   
+000588d0: 2020 2020 2073 656c 662e 6763 6e74 203d       self.gcnt =
+000588e0: 2067 636e 740a 2020 2020 2020 2020 7365   gcnt.        se
+000588f0: 6c66 2e72 6561 645f 6c65 6e20 3d20 7265  lf.read_len = re
+00058900: 6164 5f6c 656e 0a20 2020 2020 2020 200a  ad_len.        .
+00058910: 2020 2020 2020 2020 2320 7365 6c66 2e69          # self.i
+00058920: 6364 7320 3d20 6963 6473 0a20 2020 2020  cds = icds.     
+00058930: 2020 2073 656c 662e 6368 7220 3d20 2727     self.chr = ''
+00058940: 0a20 2020 2020 2020 2073 656c 662e 6265  .        self.be
+00058950: 6769 6e20 3d20 2d31 0a20 2020 2020 2020  gin = -1.       
+00058960: 2073 656c 662e 656e 6420 3d20 2d31 0a20   self.end = -1. 
+00058970: 2020 2020 2020 2073 656c 662e 6578 6f6e         self.exon
+00058980: 7320 3d20 7265 6769 6f6e 7328 290a 2020  s = regions().  
+00058990: 2020 2020 2020 7365 6c66 2e63 6473 203d        self.cds =
+000589a0: 2072 6567 696f 6e73 2829 0a20 2020 2020   regions().     
+000589b0: 2020 2073 656c 662e 7267 6e73 203d 2072     self.rgns = r
+000589c0: 6567 696f 6e73 2829 0a20 2020 2020 2020  egions().       
+000589d0: 200a 2020 2020 2020 2020 7365 6c66 2e6e   .        self.n
+000589e0: 7472 203d 2030 0a20 2020 2020 2020 2073  tr = 0.        s
+000589f0: 656c 662e 7464 5f6c 7374 203d 205b 5d0a  elf.td_lst = [].
+00058a00: 2020 2020 2020 2020 7365 6c66 2e74 655f          self.te_
+00058a10: 746f 5f67 655f 6d61 7073 203d 205b 5d0a  to_ge_maps = [].
+00058a20: 2020 2020 2020 2020 7365 6c66 2e74 635f          self.tc_
+00058a30: 746f 5f67 635f 6d61 7073 203d 205b 5d0a  to_gc_maps = [].
+00058a40: 2020 2020 2020 2020 7365 6c66 2e74 725f          self.tr_
+00058a50: 746f 5f67 725f 6d61 7073 203d 205b 5d0a  to_gr_maps = [].
+00058a60: 2020 2020 2020 2020 7365 6c66 2e74 725f          self.tr_
+00058a70: 696e 666f 203d 205b 5d0a 2020 2020 2020  info = [].      
+00058a80: 2020 7365 6c66 2e6e 765f 696e 666f 5f6c    self.nv_info_l
+00058a90: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+00058aa0: 0a20 2020 2020 2020 2073 656c 662e 745f  .        self.t_
+00058ab0: 6162 6e20 3d20 2d31 0a20 2020 2020 2020  abn = -1.       
+00058ac0: 2073 656c 662e 725f 7470 6d20 3d20 2d31   self.r_tpm = -1
+00058ad0: 0a0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00058ae0: 6f76 5f74 6820 3d20 436f 765f 7468 0a20  ov_th = Cov_th. 
+00058af0: 2020 2020 2020 2073 656c 662e 6162 6e5f         self.abn_
+00058b00: 7468 203d 2041 626e 5f74 680a 0a20 2020  th = Abn_th..   
+00058b10: 2020 2020 2069 6620 6774 665f 6c69 6e65       if gtf_line
+00058b20: 735f 6f66 5f61 5f67 656e 6520 6973 206e  s_of_a_gene is n
+00058b30: 6f74 204e 6f6e 653a 0a0a 2020 2020 2020  ot None:..      
+00058b40: 2020 2020 2020 7365 6c66 2e62 6567 696e        self.begin
+00058b50: 203d 206d 696e 2867 6574 5f63 6f6c 2867   = min(get_col(g
+00058b60: 7466 5f6c 696e 6573 5f6f 665f 615f 6765  tf_lines_of_a_ge
+00058b70: 6e65 2c20 4753 5441 5254 2929 0a20 2020  ne, GSTART)).   
+00058b80: 2020 2020 2020 2020 2073 656c 662e 656e           self.en
+00058b90: 6420 3d20 6d61 7828 6765 745f 636f 6c28  d = max(get_col(
+00058ba0: 6774 665f 6c69 6e65 735f 6f66 5f61 5f67  gtf_lines_of_a_g
+00058bb0: 656e 652c 2047 454e 4429 290a 2020 2020  ene, GEND)).    
+00058bc0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00058bd0: 2020 2020 2063 6872 7320 3d20 6765 745f       chrs = get_
+00058be0: 636f 6c28 6774 665f 6c69 6e65 735f 6f66  col(gtf_lines_of
+00058bf0: 5f61 5f67 656e 652c 2043 4852 290a 2020  _a_gene, CHR).  
+00058c00: 2020 2020 2020 2020 2020 6368 7273 203d            chrs =
+00058c10: 206c 6973 7428 7365 7428 6368 7273 2929   list(set(chrs))
+00058c20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00058c30: 6c65 6e28 6368 7273 2920 3e20 313a 0a20  len(chrs) > 1:. 
+00058c40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00058c50: 7269 6e74 2827 2020 2057 4152 4e49 4e47  rint('   WARNING
+00058c60: 2069 6e20 6765 6e65 5f64 6573 6372 6970   in gene_descrip
+00058c70: 746f 723a 3a69 6e69 743a 2073 7061 6e73  tor::init: spans
+00058c80: 206f 7665 7220 2569 2063 6872 6f6d 6f73   over %i chromos
+00058c90: 6f6d 6573 2e27 2025 206c 656e 2863 6872  omes.' % len(chr
+00058ca0: 7329 2029 0a0a 2020 2020 2020 2020 2020  s) )..          
+00058cb0: 2020 7365 6c66 2e63 6872 203d 2063 6872    self.chr = chr
+00058cc0: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+00058cd0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00058ce0: 2020 2020 2020 7472 5f67 7466 5f6c 7374        tr_gtf_lst
+00058cf0: 203d 2070 6172 7365 5f67 7466 5f6c 696e   = parse_gtf_lin
+00058d00: 6573 5f61 6e64 5f73 706c 6974 5f69 6e74  es_and_split_int
+00058d10: 6f5f 6765 6e65 7328 2067 7466 5f6c 696e  o_genes( gtf_lin
+00058d20: 6573 5f6f 665f 615f 6765 6e65 2c20 2774  es_of_a_gene, 't
+00058d30: 7261 6e73 6372 6970 7427 2029 0a20 2020  ranscript' ).   
+00058d40: 2020 2020 2020 2020 206e 5f76 616c 6964           n_valid
+00058d50: 5f74 7273 203d 2030 0a20 2020 2020 2020  _trs = 0.       
+00058d60: 2020 2020 2066 6f72 206b 2c20 676c 735f       for k, gls_
+00058d70: 6f72 6720 696e 2065 6e75 6d65 7261 7465  org in enumerate
+00058d80: 2874 725f 6774 665f 6c73 7429 3a0a 2020  (tr_gtf_lst):.  
+00058d90: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00058da0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00058db0: 6c73 203d 2073 6f72 745f 6774 665f 6c69  ls = sort_gtf_li
+00058dc0: 6e65 7328 676c 735f 6f72 6729 0a20 2020  nes(gls_org).   
+00058dd0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00058de0: 2020 2020 2020 2020 2020 2020 2020 7464                td
+00058df0: 203d 2074 7261 6e73 6372 6970 745f 6465   = transcript_de
+00058e00: 7363 7269 7074 6f72 2867 6c73 2c20 7365  scriptor(gls, se
+00058e10: 6c66 2e65 786f 6e73 2e72 676e 732c 2073  lf.exons.rgns, s
+00058e20: 656c 662e 6364 732e 7267 6e73 2c20 6765  elf.cds.rgns, ge
+00058e30: 6e6f 6d65 2c20 6963 6473 2c20 6669 6c6c  nome, icds, fill
+00058e40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00058e50: 2020 7365 6c66 2e74 645f 6c73 742e 6170    self.td_lst.ap
+00058e60: 7065 6e64 2874 6429 0a20 2020 2020 2020  pend(td).       
+00058e70: 2020 2020 2020 2020 2073 656c 662e 7465           self.te
+00058e80: 5f74 6f5f 6765 5f6d 6170 732e 6170 7065  _to_ge_maps.appe
+00058e90: 6e64 2874 642e 7465 5f74 6f5f 6765 5f6d  nd(td.te_to_ge_m
+00058ea0: 6170 290a 2020 2020 2020 2020 2020 2020  ap).            
+00058eb0: 2020 2020 7365 6c66 2e74 635f 746f 5f67      self.tc_to_g
+00058ec0: 635f 6d61 7073 2e61 7070 656e 6428 7464  c_maps.append(td
+00058ed0: 2e74 635f 746f 5f67 635f 6d61 7029 0a20  .tc_to_gc_map). 
+00058ee0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00058ef0: 6620 6c65 6e28 7464 2e74 655f 746f 5f67  f len(td.te_to_g
+00058f00: 655f 6d61 7029 203e 2030 3a20 6e5f 7661  e_map) > 0: n_va
+00058f10: 6c69 645f 7472 7320 2b3d 2031 0a20 2020  lid_trs += 1.   
+00058f20: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00058f30: 2020 2020 2020 2020 2069 6620 5472 7565           if True
+00058f40: 3a20 2320 6e6f 7420 6669 6c6c 3a0a 2020  : # not fill:.  
+00058f50: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00058f60: 6f6e 7320 3d20 7365 6c66 2e65 786f 6e73  ons = self.exons
+00058f70: 2e63 6f70 7928 7570 6461 7465 203d 2066  .copy(update = f
+00058f80: 696c 6c29 0a0a 2020 2020 2020 2020 2020  ill)..          
+00058f90: 2020 2020 2020 4e20 3d20 6c65 6e28 6578        N = len(ex
+00058fa0: 6f6e 732e 7267 6e73 292a 320a 2020 2020  ons.rgns)*2.    
+00058fb0: 2020 2020 2020 2020 2020 2020 6e5f 6c6f              n_lo
+00058fc0: 6f70 203d 2030 0a20 2020 2020 2020 2020  op = 0.         
+00058fd0: 2020 2020 2020 2023 2077 6869 6c65 2054         # while T
+00058fe0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+00058ff0: 2020 2020 2066 6f72 206e 2069 6e20 7261       for n in ra
+00059000: 6e67 6528 4e29 3a0a 2020 2020 2020 2020  nge(N):.        
+00059010: 2020 2020 2020 2020 2020 2020 656c 656e              elen
+00059020: 203d 206e 702e 7a65 726f 7328 6c65 6e28   = np.zeros(len(
+00059030: 6578 6f6e 732e 7267 6e73 2929 200a 2020  exons.rgns)) .  
+00059040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059050: 2020 666f 7220 6b2c 2065 2069 6e20 656e    for k, e in en
+00059060: 756d 6572 6174 6528 6578 6f6e 732e 7267  umerate(exons.rg
+00059070: 6e73 293a 2065 6c65 6e5b 6b5d 203d 2065  ns): elen[k] = e
+00059080: 2e73 7461 7274 0a20 2020 2020 2020 2020  .start.         
+00059090: 2020 2020 2020 2020 2020 206f 6472 203d             odr =
+000590a0: 2065 6c65 6e2e 6172 6773 6f72 7428 290a   elen.argsort().
+000590b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000590c0: 2020 2020 636e 745f 6f20 3d20 300a 2020      cnt_o = 0.  
+000590d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000590e0: 2020 746f 5f64 656c 203d 205b 5d0a 2020    to_del = [].  
+000590f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059100: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
+00059110: 286c 656e 286f 6472 2929 3a0a 2020 2020  (len(odr)):.    
+00059120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059130: 2020 2020 6966 206b 203c 2028 6c65 6e28      if k < (len(
+00059140: 6f64 7229 2d31 293a 0a20 2020 2020 2020  odr)-1):.       
+00059150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059160: 2020 2020 2065 7020 3d20 6578 6f6e 732e       ep = exons.
+00059170: 7267 6e73 5b6f 6472 5b6b 5d5d 0a20 2020  rgns[odr[k]].   
+00059180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059190: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
+000591a0: 6e20 7261 6e67 6528 6b2b 312c 6c65 6e28  n range(k+1,len(
+000591b0: 6f64 7229 293a 0a20 2020 2020 2020 2020  odr)):.         
+000591c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000591d0: 2020 2020 2020 2065 6e20 3d20 6578 6f6e         en = exon
+000591e0: 732e 7267 6e73 5b6f 6472 5b6d 5d5d 0a20  s.rgns[odr[m]]. 
+000591f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059200: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00059210: 6620 6570 2e74 7970 6520 3d3d 2065 6e2e  f ep.type == en.
+00059220: 7479 7065 3a20 2320 2865 702e 7479 7065  type: # (ep.type
+00059230: 203d 3d20 2765 786f 6e27 2920 2620 2865   == 'exon') & (e
+00059240: 6e2e 7479 7065 203d 3d20 2765 786f 6e27  n.type == 'exon'
+00059250: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00059260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059270: 2020 2020 2020 2069 6620 6570 2e68 6173         if ep.has
+00059280: 5f65 7874 5f69 6e74 6572 7365 6374 696f  _ext_intersectio
+00059290: 6e5f 7769 7468 2865 6e29 3a0a 0a20 2020  n_with(en):..   
+000592a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000592b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000592c0: 2020 2020 2069 7374 6172 742c 2069 656e       istart, ien
+000592d0: 6420 3d20 6570 2e67 6574 5f69 6e74 6572  d = ep.get_inter
+000592e0: 7365 6374 696f 6e28 656e 290a 0a20 2020  section(en)..   
+000592f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059310: 2020 2020 2069 6620 6570 2e73 7461 7274       if ep.start
+00059320: 203c 2069 7374 6172 743a 0a20 2020 2020   < istart:.     
 00059330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059340: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00059350: 702e 6861 735f 6578 745f 696e 7465 7273  p.has_ext_inters
-00059360: 6563 7469 6f6e 5f77 6974 6828 656e 293a  ection_with(en):
-00059370: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00059340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059350: 2020 2020 2020 2069 6620 6570 2e65 6e64         if ep.end
+00059360: 203d 3d20 656e 2e65 6e64 3a0a 2020 2020   == en.end:.    
+00059370: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059390: 2020 2020 2020 2020 2020 6973 7461 7274            istart
-000593a0: 2c20 6965 6e64 203d 2065 702e 6765 745f  , iend = ep.get_
-000593b0: 696e 7465 7273 6563 7469 6f6e 2865 6e29  intersection(en)
-000593c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000593d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000593e0: 2020 2020 2020 2020 2020 6966 2065 702e            if ep.
-000593f0: 7374 6172 7420 3c20 6973 7461 7274 3a0a  start < istart:.
+00059390: 2020 2020 2020 2020 2020 2020 6570 2e65              ep.e
+000593a0: 6e64 203d 2069 7374 6172 742d 310a 2020  nd = istart-1.  
+000593b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000593c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000593d0: 2020 2020 2020 2020 2020 2020 2020 4c65                Le
+000593e0: 6e20 3d20 6570 2e65 6e64 202d 2065 702e  n = ep.end - ep.
+000593f0: 7374 6172 7420 2b20 310a 2020 2020 2020  start + 1.      
 00059400: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059420: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00059430: 702e 656e 6420 3d3d 2065 6e2e 656e 643a  p.end == en.end:
-00059440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059420: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00059430: 2865 702e 7365 7129 203e 2030 3a20 6570  (ep.seq) > 0: ep
+00059440: 2e73 6571 203d 2065 702e 7365 715b 3a4c  .seq = ep.seq[:L
+00059450: 656e 5d0a 2020 2020 2020 2020 2020 2020  en].            
 00059460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059470: 2065 702e 656e 6420 3d20 6973 7461 7274   ep.end = istart
-00059480: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-00059490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059480: 2020 2020 6966 2065 702e 636d 6174 2069      if ep.cmat i
+00059490: 7320 6e6f 7420 4e6f 6e65 3a20 0a20 2020  s not None: .   
 000594a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000594b0: 2020 204c 656e 203d 2065 702e 656e 6420     Len = ep.end 
-000594c0: 2d20 6570 2e73 7461 7274 202b 2031 0a20  - ep.start + 1. 
-000594d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000594e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000594f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00059500: 6620 6c65 6e28 6570 2e73 6571 2920 3e20  f len(ep.seq) > 
-00059510: 303a 2065 702e 7365 7120 3d20 6570 2e73  0: ep.seq = ep.s
-00059520: 6571 5b3a 4c65 6e5d 0a20 2020 2020 2020  eq[:Len].       
+000594b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000594c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000594d0: 2065 702e 636d 6174 203d 2065 702e 636d   ep.cmat = ep.cm
+000594e0: 6174 5b3a 2c3a 4c65 6e5d 0a20 2020 2020  at[:,:Len].     
+000594f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059510: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00059520: 702e 6765 745f 6376 6728 290a 2020 2020  p.get_cvg().    
 00059530: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059550: 2020 2020 2020 2020 2069 6620 6570 2e63           if ep.c
-00059560: 6d61 7420 6973 206e 6f74 204e 6f6e 653a  mat is not None:
-00059570: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00059550: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+00059560: 6f20 2b3d 2031 0a0a 2020 2020 2020 2020  o += 1..        
+00059570: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000595a0: 2020 2020 2020 6570 2e63 6d61 7420 3d20        ep.cmat = 
-000595b0: 6570 2e63 6d61 745b 3a2c 3a4c 656e 5d0a  ep.cmat[:,:Len].
+00059590: 2020 2020 656c 6966 2065 702e 656e 6420      elif ep.end 
+000595a0: 3e20 656e 2e65 6e64 3a0a 2020 2020 2020  > en.end:.      
+000595b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000595c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000595d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000595e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000595f0: 2020 2020 6570 2e67 6574 5f63 7667 2829      ep.get_cvg()
-00059600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000595d0: 2020 2020 2020 2020 2020 6531 203d 2072            e1 = r
+000595e0: 6567 696f 6e28 6570 2e63 6872 2c20 6965  egion(ep.chr, ie
+000595f0: 6e64 2b31 2c20 6570 2e65 6e64 2c20 6570  nd+1, ep.end, ep
+00059600: 2e74 7970 6529 0a20 2020 2020 2020 2020  .type).         
 00059610: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059630: 2063 6e74 5f6f 202b 3d20 310a 0a20 2020   cnt_o += 1..   
-00059640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059660: 2020 2020 2020 2020 2065 6c69 6620 6570           elif ep
-00059670: 2e65 6e64 203e 2065 6e2e 656e 643a 0a20  .end > en.end:. 
-00059680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000596a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000596b0: 3120 3d20 7265 6769 6f6e 2865 702e 6368  1 = region(ep.ch
-000596c0: 722c 2069 656e 642b 312c 2065 702e 656e  r, iend+1, ep.en
-000596d0: 642c 2065 702e 7479 7065 290a 2020 2020  d, ep.type).    
-000596e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000596f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059700: 2020 2020 2020 2020 2020 2020 4c65 6e20              Len 
-00059710: 3d20 6531 2e65 6e64 202d 2065 312e 7374  = e1.end - e1.st
-00059720: 6172 7420 2b20 310a 2020 2020 2020 2020  art + 1.        
-00059730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059750: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
-00059760: 702e 7365 7129 203e 2030 3a20 6531 2e73  p.seq) > 0: e1.s
-00059770: 6571 203d 2065 702e 7365 715b 2d4c 656e  eq = ep.seq[-Len
-00059780: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+00059630: 2020 2020 2020 204c 656e 203d 2065 312e         Len = e1.
+00059640: 656e 6420 2d20 6531 2e73 7461 7274 202b  end - e1.start +
+00059650: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00059660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059680: 2020 2069 6620 6c65 6e28 6570 2e73 6571     if len(ep.seq
+00059690: 2920 3e20 303a 2065 312e 7365 7120 3d20  ) > 0: e1.seq = 
+000596a0: 6570 2e73 6571 5b2d 4c65 6e3a 5d0a 2020  ep.seq[-Len:].  
+000596b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000596c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000596d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000596e0: 2065 702e 636d 6174 2069 7320 6e6f 7420   ep.cmat is not 
+000596f0: 4e6f 6e65 3a20 0a20 2020 2020 2020 2020  None: .         
+00059700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059720: 2020 2020 2020 2020 2020 2065 312e 636d             e1.cm
+00059730: 6174 203d 2065 702e 636d 6174 5b3a 2c2d  at = ep.cmat[:,-
+00059740: 4c65 6e3a 5d0a 2020 2020 2020 2020 2020  Len:].          
+00059750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059770: 2020 2020 2020 2020 2020 6531 2e67 6574            e1.get
+00059780: 5f63 7667 2829 0a20 2020 2020 2020 2020  _cvg().         
 00059790: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000597a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000597b0: 2020 2069 6620 6570 2e63 6d61 7420 6973     if ep.cmat is
-000597c0: 206e 6f74 204e 6f6e 653a 200a 2020 2020   not None: .    
+000597b0: 2020 2020 2020 2065 786f 6e73 2e72 676e         exons.rgn
+000597c0: 732e 6170 7065 6e64 2865 3129 0a0a 2020  s.append(e1)..  
 000597d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000597e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000597f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059800: 6531 2e63 6d61 7420 3d20 6570 2e63 6d61  e1.cmat = ep.cma
-00059810: 745b 3a2c 2d4c 656e 3a5d 0a20 2020 2020  t[:,-Len:].     
+000597f0: 2020 2020 2020 2020 2020 2020 2020 6570                ep
+00059800: 2e65 6e64 203d 2069 7374 6172 742d 310a  .end = istart-1.
+00059810: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059820: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059840: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00059850: 312e 6765 745f 6376 6728 290a 2020 2020  1.get_cvg().    
+00059840: 4c65 6e20 3d20 6570 2e65 6e64 202d 2065  Len = ep.end - e
+00059850: 702e 7374 6172 7420 2b20 310a 2020 2020  p.start + 1.    
 00059860: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059880: 2020 2020 2020 2020 2020 2020 6578 6f6e              exon
-00059890: 732e 7267 6e73 2e61 7070 656e 6428 6531  s.rgns.append(e1
-000598a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-000598b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059880: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00059890: 656e 2865 702e 7365 7129 203e 2030 3a20  en(ep.seq) > 0: 
+000598a0: 6570 2e73 6571 203d 2065 702e 7365 715b  ep.seq = ep.seq[
+000598b0: 3a4c 656e 5d0a 2020 2020 2020 2020 2020  :Len].          
 000598c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000598d0: 2020 2065 702e 656e 6420 3d20 6973 7461     ep.end = ista
-000598e0: 7274 2d31 0a20 2020 2020 2020 2020 2020  rt-1.           
-000598f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000598d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000598e0: 2020 2020 2020 6966 2065 702e 636d 6174        if ep.cmat
+000598f0: 2069 7320 6e6f 7420 4e6f 6e65 3a20 0a20   is not None: . 
 00059900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059910: 2020 2020 204c 656e 203d 2065 702e 656e       Len = ep.en
-00059920: 6420 2d20 6570 2e73 7461 7274 202b 2031  d - ep.start + 1
-00059930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059930: 2020 2065 702e 636d 6174 203d 2065 702e     ep.cmat = ep.
+00059940: 636d 6174 5b3a 2c3a 4c65 6e5d 0a20 2020  cmat[:,:Len].   
 00059950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059960: 2069 6620 6c65 6e28 6570 2e73 6571 2920   if len(ep.seq) 
-00059970: 3e20 303a 2065 702e 7365 7120 3d20 6570  > 0: ep.seq = ep
-00059980: 2e73 6571 5b3a 4c65 6e5d 0a20 2020 2020  .seq[:Len].     
+00059960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059980: 2065 702e 6765 745f 6376 6728 290a 2020   ep.get_cvg().  
 00059990: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000599a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000599b0: 2020 2020 2020 2020 2020 2069 6620 6570             if ep
-000599c0: 2e63 6d61 7420 6973 206e 6f74 204e 6f6e  .cmat is not Non
-000599d0: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+000599b0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+000599c0: 745f 6f20 2b3d 2031 0a0a 2020 2020 2020  t_o += 1..      
+000599d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000599e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000599f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059a00: 2020 2020 2020 2020 6570 2e63 6d61 7420          ep.cmat 
-00059a10: 3d20 6570 2e63 6d61 745b 3a2c 3a4c 656e  = ep.cmat[:,:Len
-00059a20: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00059a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059a50: 2020 2020 2020 6570 2e67 6574 5f63 7667        ep.get_cvg
-00059a60: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+000599f0: 2020 2020 2020 656c 6966 2065 702e 656e        elif ep.en
+00059a00: 6420 3c20 656e 2e65 6e64 3a0a 2020 2020  d < en.end:.    
+00059a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059a30: 2020 2020 2020 2020 2020 2020 6531 203d              e1 =
+00059a40: 2072 6567 696f 6e28 656e 2e63 6872 2c20   region(en.chr, 
+00059a50: 6965 6e64 2b31 2c20 656e 2e65 6e64 2c20  iend+1, en.end, 
+00059a60: 656e 2e74 7970 6529 0a20 2020 2020 2020  en.type).       
 00059a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059a90: 2020 2063 6e74 5f6f 202b 3d20 310a 0a20     cnt_o += 1.. 
-00059aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ac0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00059ad0: 6570 2e65 6e64 203c 2065 6e2e 656e 643a  ep.end < en.end:
-00059ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059b10: 2065 3120 3d20 7265 6769 6f6e 2865 6e2e   e1 = region(en.
-00059b20: 6368 722c 2069 656e 642b 312c 2065 6e2e  chr, iend+1, en.
-00059b30: 656e 642c 2065 6e2e 7479 7065 290a 2020  end, en.type).  
-00059b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059b60: 2020 2020 2020 2020 2020 2020 2020 4c65                Le
-00059b70: 6e20 3d20 6531 2e65 6e64 202d 2065 312e  n = e1.end - e1.
-00059b80: 7374 6172 7420 2b20 310a 2020 2020 2020  start + 1.      
-00059b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059bb0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00059bc0: 2865 6e2e 7365 7129 203e 2030 3a20 6531  (en.seq) > 0: e1
-00059bd0: 2e73 6571 203d 2065 6e2e 7365 715b 2d4c  .seq = en.seq[-L
-00059be0: 656e 3a5d 0a20 2020 2020 2020 2020 2020  en:].           
+00059a90: 2020 2020 2020 2020 204c 656e 203d 2065           Len = e
+00059aa0: 312e 656e 6420 2d20 6531 2e73 7461 7274  1.end - e1.start
+00059ab0: 202b 2031 0a20 2020 2020 2020 2020 2020   + 1.           
+00059ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059ae0: 2020 2020 2069 6620 6c65 6e28 656e 2e73       if len(en.s
+00059af0: 6571 2920 3e20 303a 2065 312e 7365 7120  eq) > 0: e1.seq 
+00059b00: 3d20 656e 2e73 6571 5b2d 4c65 6e3a 5d0a  = en.seq[-Len:].
+00059b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059b40: 6966 2065 6e2e 636d 6174 2069 7320 6e6f  if en.cmat is no
+00059b50: 7420 4e6f 6e65 3a20 0a20 2020 2020 2020  t None: .       
+00059b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059b80: 2020 2020 2020 2020 2020 2020 2065 312e               e1.
+00059b90: 636d 6174 203d 2065 6e2e 636d 6174 5b3a  cmat = en.cmat[:
+00059ba0: 2c2d 4c65 6e3a 5d0a 2020 2020 2020 2020  ,-Len:].        
+00059bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059bd0: 2020 2020 2020 2020 2020 2020 6531 2e67              e1.g
+00059be0: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
 00059bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059c10: 2020 2020 2069 6620 656e 2e63 6d61 7420       if en.cmat 
-00059c20: 6973 206e 6f74 204e 6f6e 653a 200a 2020  is not None: .  
+00059c10: 2020 2020 2020 2020 2065 786f 6e73 2e72           exons.r
+00059c20: 676e 732e 6170 7065 6e64 2865 3129 0a0a  gns.append(e1)..
 00059c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059c60: 2020 6531 2e63 6d61 7420 3d20 656e 2e63    e1.cmat = en.c
-00059c70: 6d61 745b 3a2c 2d4c 656e 3a5d 0a20 2020  mat[:,-Len:].   
-00059c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059cb0: 2065 312e 6765 745f 6376 6728 290a 2020   e1.get_cvg().  
+00059c60: 6966 2069 656e 6420 213d 2065 702e 656e  if iend != ep.en
+00059c70: 643a 2070 7269 6e74 2827 4552 524f 523a  d: print('ERROR:
+00059c80: 2025 692c 2025 692c 2025 6920 2720 2520   %i, %i, %i ' % 
+00059c90: 2865 702e 656e 642c 2069 656e 642c 2065  (ep.end, iend, e
+00059ca0: 6e2e 656e 6429 290a 2020 2020 2020 2020  n.end)).        
+00059cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ce0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00059cf0: 6f6e 732e 7267 6e73 2e61 7070 656e 6428  ons.rgns.append(
-00059d00: 6531 290a 0a20 2020 2020 2020 2020 2020  e1)..           
-00059d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059d30: 2020 2020 2069 6620 6965 6e64 2021 3d20       if iend != 
-00059d40: 6570 2e65 6e64 3a20 7072 696e 7428 2745  ep.end: print('E
-00059d50: 5252 4f52 3a20 2569 2c20 2569 2c20 2569  RROR: %i, %i, %i
-00059d60: 2027 2025 2028 6570 2e65 6e64 2c20 6965   ' % (ep.end, ie
-00059d70: 6e64 2c20 656e 2e65 6e64 2929 0a20 2020  nd, en.end)).   
-00059d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059cd0: 2020 2020 2020 2020 656e 2e65 6e64 203d          en.end =
+00059ce0: 2069 656e 640a 2020 2020 2020 2020 2020   iend.          
+00059cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059d10: 2020 2020 2020 4c65 6e20 3d20 656e 2e65        Len = en.e
+00059d20: 6e64 202d 2065 6e2e 7374 6172 7420 2b20  nd - en.start + 
+00059d30: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00059d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059d60: 2020 6966 206c 656e 2865 6e2e 7365 7129    if len(en.seq)
+00059d70: 203e 2030 3a20 656e 2e73 6571 203d 2065   > 0: en.seq = e
+00059d80: 6e2e 7365 715b 3a4c 656e 5d0a 2020 2020  n.seq[:Len].    
 00059d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059da0: 2020 2020 2020 2020 2020 2020 2065 6e2e               en.
-00059db0: 656e 6420 3d20 6965 6e64 0a20 2020 2020  end = iend.     
-00059dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059de0: 2020 2020 2020 2020 2020 204c 656e 203d             Len =
-00059df0: 2065 6e2e 656e 6420 2d20 656e 2e73 7461   en.end - en.sta
-00059e00: 7274 202b 2031 0a20 2020 2020 2020 2020  rt + 1.         
-00059e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059e30: 2020 2020 2020 2069 6620 6c65 6e28 656e         if len(en
-00059e40: 2e73 6571 2920 3e20 303a 2065 6e2e 7365  .seq) > 0: en.se
-00059e50: 7120 3d20 656e 2e73 6571 5b3a 4c65 6e5d  q = en.seq[:Len]
-00059e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00059da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059db0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00059dc0: 6e2e 636d 6174 2069 7320 6e6f 7420 4e6f  n.cmat is not No
+00059dd0: 6e65 3a20 0a20 2020 2020 2020 2020 2020  ne: .           
+00059de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059e00: 2020 2020 2020 2020 2065 6e2e 636d 6174           en.cmat
+00059e10: 203d 2065 6e2e 636d 6174 5b3a 2c3a 4c65   = en.cmat[:,:Le
+00059e20: 6e5d 0a20 2020 2020 2020 2020 2020 2020  n].             
+00059e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059e50: 2020 2020 2020 2065 6e2e 6765 745f 6376         en.get_cv
+00059e60: 6728 290a 0a20 2020 2020 2020 2020 2020  g()..           
 00059e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059e90: 2069 6620 656e 2e63 6d61 7420 6973 206e   if en.cmat is n
-00059ea0: 6f74 204e 6f6e 653a 200a 2020 2020 2020  ot None: .      
+00059e90: 2020 2020 2065 702e 656e 6420 3d20 6973       ep.end = is
+00059ea0: 7461 7274 2d31 0a20 2020 2020 2020 2020  tart-1.         
 00059eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ed0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00059ee0: 2e63 6d61 7420 3d20 656e 2e63 6d61 745b  .cmat = en.cmat[
-00059ef0: 3a2c 3a4c 656e 5d0a 2020 2020 2020 2020  :,:Len].        
+00059ed0: 2020 2020 2020 204c 656e 203d 2065 702e         Len = ep.
+00059ee0: 656e 6420 2d20 6570 2e73 7461 7274 202b  end - ep.start +
+00059ef0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
 00059f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00059f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059f20: 2020 2020 2020 2020 2020 2020 656e 2e67              en.g
-00059f30: 6574 5f63 7667 2829 0a0a 2020 2020 2020  et_cvg()..      
-00059f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059f20: 2020 2069 6620 6c65 6e28 6570 2e73 6571     if len(ep.seq
+00059f30: 2920 3e20 303a 2065 702e 7365 7120 3d20  ) > 0: ep.seq = 
+00059f40: 6570 2e73 6571 5b3a 4c65 6e5d 0a20 2020  ep.seq[:Len].   
 00059f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059f60: 2020 2020 2020 2020 2020 6570 2e65 6e64            ep.end
-00059f70: 203d 2069 7374 6172 742d 310a 2020 2020   = istart-1.    
-00059f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059fa0: 2020 2020 2020 2020 2020 2020 4c65 6e20              Len 
-00059fb0: 3d20 6570 2e65 6e64 202d 2065 702e 7374  = ep.end - ep.st
-00059fc0: 6172 7420 2b20 310a 2020 2020 2020 2020  art + 1.        
-00059fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ff0: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
-0005a000: 702e 7365 7129 203e 2030 3a20 6570 2e73  p.seq) > 0: ep.s
-0005a010: 6571 203d 2065 702e 7365 715b 3a4c 656e  eq = ep.seq[:Len
-0005a020: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00059f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059f70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00059f80: 6570 2e63 6d61 7420 6973 206e 6f74 204e  ep.cmat is not N
+00059f90: 6f6e 653a 200a 2020 2020 2020 2020 2020  one: .          
+00059fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059fc0: 2020 2020 2020 2020 2020 6570 2e63 6d61            ep.cma
+00059fd0: 7420 3d20 6570 2e63 6d61 745b 3a2c 3a4c  t = ep.cmat[:,:L
+00059fe0: 656e 5d0a 2020 2020 2020 2020 2020 2020  en].            
+00059ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a010: 2020 2020 2020 2020 6570 2e67 6574 5f63          ep.get_c
+0005a020: 7667 2829 0a20 2020 2020 2020 2020 2020  vg().           
 0005a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a050: 2020 6966 2065 702e 636d 6174 2069 7320    if ep.cmat is 
-0005a060: 6e6f 7420 4e6f 6e65 3a20 0a20 2020 2020  not None: .     
+0005a050: 2020 2020 2063 6e74 5f6f 202b 3d20 310a       cnt_o += 1.
+0005a060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0005a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a090: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0005a0a0: 702e 636d 6174 203d 2065 702e 636d 6174  p.cmat = ep.cmat
-0005a0b0: 5b3a 2c3a 4c65 6e5d 0a20 2020 2020 2020  [:,:Len].       
-0005a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a0e0: 2020 2020 2020 2020 2020 2020 2065 702e               ep.
-0005a0f0: 6765 745f 6376 6728 290a 2020 2020 2020  get_cvg().      
+0005a080: 2020 2020 2020 2020 2065 6c69 6620 6570           elif ep
+0005a090: 2e73 7461 7274 203d 3d20 6973 7461 7274  .start == istart
+0005a0a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a0c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0005a0d0: 2065 702e 656e 6420 3c20 656e 2e65 6e64   ep.end < en.end
+0005a0e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a120: 2020 2020 2020 2020 2020 636e 745f 6f20            cnt_o 
-0005a130: 2b3d 2031 0a0a 2020 2020 2020 2020 2020  += 1..          
+0005a110: 2020 656e 2e73 7461 7274 203d 2065 702e    en.start = ep.
+0005a120: 656e 642b 310a 2020 2020 2020 2020 2020  end+1.          
+0005a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a150: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0005a160: 6966 2065 702e 7374 6172 7420 3d3d 2069  if ep.start == i
-0005a170: 7374 6172 743a 0a20 2020 2020 2020 2020  start:.         
+0005a150: 2020 2020 2020 4c65 6e20 3d20 656e 2e65        Len = en.e
+0005a160: 6e64 202d 2065 6e2e 7374 6172 7420 2b20  nd - en.start + 
+0005a170: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
 0005a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a1a0: 2020 2069 6620 6570 2e65 6e64 203c 2065     if ep.end < e
-0005a1b0: 6e2e 656e 643a 0a20 2020 2020 2020 2020  n.end:.         
-0005a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a1a0: 2020 6966 206c 656e 2865 6e2e 7365 7129    if len(en.seq)
+0005a1b0: 203e 2030 3a20 656e 2e73 6571 203d 2065   > 0: en.seq = e
+0005a1c0: 6e2e 7365 715b 2d4c 656e 3a5d 0a20 2020  n.seq[-Len:].   
 0005a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a1e0: 2020 2020 2020 2065 6e2e 7374 6172 7420         en.start 
-0005a1f0: 3d20 6570 2e65 6e64 2b31 0a20 2020 2020  = ep.end+1.     
-0005a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a220: 2020 2020 2020 2020 2020 204c 656e 203d             Len =
-0005a230: 2065 6e2e 656e 6420 2d20 656e 2e73 7461   en.end - en.sta
-0005a240: 7274 202b 2031 0a20 2020 2020 2020 2020  rt + 1.         
-0005a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a270: 2020 2020 2020 2069 6620 6c65 6e28 656e         if len(en
-0005a280: 2e73 6571 2920 3e20 303a 2065 6e2e 7365  .seq) > 0: en.se
-0005a290: 7120 3d20 656e 2e73 6571 5b2d 4c65 6e3a  q = en.seq[-Len:
-0005a2a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0005a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a1f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0005a200: 656e 2e63 6d61 7420 6973 206e 6f74 204e  en.cmat is not N
+0005a210: 6f6e 653a 200a 2020 2020 2020 2020 2020  one: .          
+0005a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a240: 2020 2020 2020 2020 2020 656e 2e63 6d61            en.cma
+0005a250: 7420 3d20 656e 2e63 6d61 745b 3a2c 2d4c  t = en.cmat[:,-L
+0005a260: 656e 3a5d 0a20 2020 2020 2020 2020 2020  en:].           
+0005a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a290: 2020 2020 2020 2020 2065 6e2e 6765 745f           en.get_
+0005a2a0: 6376 6728 290a 2020 2020 2020 2020 2020  cvg().          
 0005a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a2d0: 2020 6966 2065 6e2e 636d 6174 2069 7320    if en.cmat is 
-0005a2e0: 6e6f 7420 4e6f 6e65 3a20 0a20 2020 2020  not None: .     
-0005a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a2d0: 2020 2020 2020 636e 745f 6f20 2b3d 2031        cnt_o += 1
+0005a2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005a2f0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
 0005a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a310: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0005a320: 6e2e 636d 6174 203d 2065 6e2e 636d 6174  n.cmat = en.cmat
-0005a330: 5b3a 2c2d 4c65 6e3a 5d0a 2020 2020 2020  [:,-Len:].      
+0005a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a320: 2020 2065 6c69 6620 6570 2e65 6e64 203d     elif ep.end =
+0005a330: 3d20 656e 2e65 6e64 3a0a 2020 2020 2020  = en.end:.      
 0005a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a360: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0005a370: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
-0005a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a3a0: 2020 2020 2020 2020 2020 2063 6e74 5f6f             cnt_o
-0005a3b0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0005a3c0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0005a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a360: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+0005a370: 7428 2745 5252 4f52 2041 3a20 2569 3a20  t('ERROR A: %i: 
+0005a380: 2569 2c25 6920 3d3d 2025 693a 2025 692c  %i,%i == %i: %i,
+0005a390: 2025 6920 696e 2025 6920 2720 2520 286b   %i in %i ' % (k
+0005a3a0: 2c20 6570 2e73 7461 7274 2c20 6570 2e65  , ep.start, ep.e
+0005a3b0: 6e64 2c20 6d2c 2065 6e2e 7374 6172 742c  nd, m, en.start,
+0005a3c0: 2065 6e2e 656e 642c 206e 5f6c 6f6f 7029   en.end, n_loop)
+0005a3d0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
 0005a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a3f0: 2020 2020 2020 2020 656c 6966 2065 702e          elif ep.
-0005a400: 656e 6420 3d3d 2065 6e2e 656e 643a 0a20  end == en.end:. 
-0005a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a400: 2020 2074 6f5f 6465 6c2e 6170 7065 6e64     to_del.append
+0005a410: 286f 6472 5b6d 5d29 0a20 2020 2020 2020  (odr[m]).       
 0005a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a430: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0005a440: 2070 7269 6e74 2827 4552 524f 5220 413a   print('ERROR A:
-0005a450: 2025 693a 2025 692c 2569 203d 3d20 2569   %i: %i,%i == %i
-0005a460: 3a20 2569 2c20 2569 2069 6e20 2569 2027  : %i, %i in %i '
-0005a470: 2025 2028 6b2c 2065 702e 7374 6172 742c   % (k, ep.start,
-0005a480: 2065 702e 656e 642c 206d 2c20 656e 2e73   ep.end, m, en.s
-0005a490: 7461 7274 2c20 656e 2e65 6e64 2c20 6e5f  tart, en.end, n_
-0005a4a0: 6c6f 6f70 2920 290a 2020 2020 2020 2020  loop) ).        
+0005a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a440: 2020 2020 2020 2020 2063 6e74 5f6f 202b           cnt_o +
+0005a450: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0005a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a480: 656c 6966 2065 702e 656e 6420 3e20 656e  elif ep.end > en
+0005a490: 2e65 6e64 3a0a 2020 2020 2020 2020 2020  .end:.          
+0005a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a4d0: 2020 2020 2020 2020 746f 5f64 656c 2e61          to_del.a
-0005a4e0: 7070 656e 6428 6f64 725b 6d5d 290a 2020  ppend(odr[m]).  
+0005a4c0: 2020 2020 2020 6570 2e73 7461 7274 203d        ep.start =
+0005a4d0: 2065 6e2e 656e 642b 310a 2020 2020 2020   en.end+1.      
+0005a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a510: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-0005a520: 745f 6f20 2b3d 2031 0a20 2020 2020 2020  t_o += 1.       
+0005a500: 2020 2020 2020 2020 2020 4c65 6e20 3d20            Len = 
+0005a510: 6570 2e65 6e64 202d 2065 702e 7374 6172  ep.end - ep.star
+0005a520: 7420 2b20 310a 2020 2020 2020 2020 2020  t + 1.          
 0005a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a550: 2020 2020 2065 6c69 6620 6570 2e65 6e64       elif ep.end
-0005a560: 203e 2065 6e2e 656e 643a 0a20 2020 2020   > en.end:.     
-0005a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a590: 2020 2020 2020 2020 2020 2065 702e 7374             ep.st
-0005a5a0: 6172 7420 3d20 656e 2e65 6e64 2b31 0a20  art = en.end+1. 
-0005a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a5d0: 2020 2020 2020 2020 2020 2020 2020 204c                 L
-0005a5e0: 656e 203d 2065 702e 656e 6420 2d20 6570  en = ep.end - ep
-0005a5f0: 2e73 7461 7274 202b 2031 0a20 2020 2020  .start + 1.     
-0005a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a620: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0005a630: 6e28 6570 2e73 6571 2920 3e20 303a 2065  n(ep.seq) > 0: e
-0005a640: 702e 7365 7120 3d20 6570 2e73 6571 5b2d  p.seq = ep.seq[-
-0005a650: 4c65 6e3a 5d0a 2020 2020 2020 2020 2020  Len:].          
+0005a550: 2020 2020 2020 6966 206c 656e 2865 702e        if len(ep.
+0005a560: 7365 7129 203e 2030 3a20 6570 2e73 6571  seq) > 0: ep.seq
+0005a570: 203d 2065 702e 7365 715b 2d4c 656e 3a5d   = ep.seq[-Len:]
+0005a580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a5b0: 2069 6620 6570 2e63 6d61 7420 6973 206e   if ep.cmat is n
+0005a5c0: 6f74 204e 6f6e 653a 200a 2020 2020 2020  ot None: .      
+0005a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a5f0: 2020 2020 2020 2020 2020 2020 2020 6570                ep
+0005a600: 2e63 6d61 7420 3d20 6570 2e63 6d61 745b  .cmat = ep.cmat[
+0005a610: 3a2c 2d4c 656e 3a5d 0a20 2020 2020 2020  :,-Len:].       
+0005a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a640: 2020 2020 2020 2020 2020 2020 2065 702e               ep.
+0005a650: 6765 745f 6376 6728 290a 2020 2020 2020  get_cvg().      
 0005a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a680: 2020 2020 2020 6966 2065 702e 636d 6174        if ep.cmat
-0005a690: 2069 7320 6e6f 7420 4e6f 6e65 3a20 0a20   is not None: . 
+0005a680: 2020 2020 2020 2020 2020 636e 745f 6f20            cnt_o 
+0005a690: 2b3d 2031 0a0a 2020 2020 2020 2020 2020  += 1..          
 0005a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a6d0: 2020 2065 702e 636d 6174 203d 2065 702e     ep.cmat = ep.
-0005a6e0: 636d 6174 5b3a 2c2d 4c65 6e3a 5d0a 2020  cmat[:,-Len:].  
-0005a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a720: 2020 6570 2e67 6574 5f63 7667 2829 0a20    ep.get_cvg(). 
+0005a6b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0005a6c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0005a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a6f0: 7072 696e 7428 2745 5252 4f52 2042 3a20  print('ERROR B: 
+0005a700: 2569 203e 2025 6920 2720 2520 2865 702e  %i > %i ' % (ep.
+0005a710: 7374 6172 742c 2069 7374 6172 7429 2029  start, istart) )
+0005a720: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0005a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a750: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0005a760: 6e74 5f6f 202b 3d20 310a 0a20 2020 2020  nt_o += 1..     
-0005a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a790: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0005a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a7c0: 2020 2020 2070 7269 6e74 2827 4552 524f       print('ERRO
-0005a7d0: 5220 423a 2025 6920 3e20 2569 2027 2025  R B: %i > %i ' %
-0005a7e0: 2028 6570 2e73 7461 7274 2c20 6973 7461   (ep.start, ista
-0005a7f0: 7274 2920 290a 0a20 2020 2020 2020 2020  rt) )..         
-0005a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a810: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005a820: 6620 636e 745f 6f20 3e20 303a 2062 7265  f cnt_o > 0: bre
-0005a830: 616b 0a0a 2020 2020 2020 2020 2020 2020  ak..            
-0005a840: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0005a850: 6e74 5f6f 203e 2030 3a20 6272 6561 6b0a  nt_o > 0: break.
-0005a860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005a870: 2020 2020 2069 6620 6c65 6e28 746f 5f64       if len(to_d
-0005a880: 656c 2920 3e20 303a 0a20 2020 2020 2020  el) > 0:.       
-0005a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a8a0: 2074 6f5f 6465 6c2e 736f 7274 2829 0a20   to_del.sort(). 
-0005a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a8c0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-0005a8d0: 7265 7665 7273 6564 2874 6f5f 6465 6c29  reversed(to_del)
-0005a8e0: 3a20 6465 6c20 6578 6f6e 732e 7267 6e73  : del exons.rgns
-0005a8f0: 5b6b 5d0a 0a20 2020 2020 2020 2020 2020  [k]..           
-0005a900: 2020 2020 2020 2020 2069 6620 636e 745f           if cnt_
-0005a910: 6f20 3d3d 2030 3a20 6272 6561 6b0a 2020  o == 0: break.  
-0005a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a930: 2020 6e5f 6c6f 6f70 202b 3d20 310a 0a20    n_loop += 1.. 
-0005a940: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0005a950: 786f 6e73 2e75 7064 6174 6528 290a 2020  xons.update().  
-0005a960: 2020 2020 2020 2020 2020 2020 2020 2727                ''
-0005a970: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0005a980: 2020 6966 206c 656e 2865 786f 6e73 2e72    if len(exons.r
-0005a990: 676e 7329 203e 206c 656e 2873 656c 662e  gns) > len(self.
-0005a9a0: 6578 6f6e 732e 7267 6e73 293a 0a20 2020  exons.rgns):.   
-0005a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a9c0: 2070 7269 6e74 2827 4578 6f6e 2063 6f72   print('Exon cor
-0005a9d0: 7265 6374 696f 6e3a 2025 6920 2d3e 2025  rection: %i -> %
-0005a9e0: 6920 696e 2025 6927 2025 2028 6c65 6e28  i in %i' % (len(
-0005a9f0: 7365 6c66 2e65 786f 6e73 2e72 676e 7329  self.exons.rgns)
-0005aa00: 2c20 6c65 6e28 6578 6f6e 732e 7267 6e73  , len(exons.rgns
-0005aa10: 292c 206e 5f6c 6f6f 7029 290a 2020 2020  ), n_loop)).    
-0005aa20: 2020 2020 2020 2020 2020 2020 2727 270a              '''.
-0005aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005aa40: 666f 7220 6b2c 2074 6420 696e 2065 6e75  for k, td in enu
-0005aa50: 6d65 7261 7465 2873 656c 662e 7464 5f6c  merate(self.td_l
-0005aa60: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-0005aa70: 2020 2020 2020 2020 2074 676d 203d 2073           tgm = s
-0005aa80: 656c 662e 7465 5f74 6f5f 6765 5f6d 6170  elf.te_to_ge_map
-0005aa90: 735b 6b5d 0a20 2020 2020 2020 2020 2020  s[k].           
-0005aaa0: 2020 2020 2020 2020 2074 676d 5f6e 6577           tgm_new
-0005aab0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0005aac0: 2020 2020 2020 2020 2020 666f 7220 6d20            for m 
-0005aad0: 696e 2074 676d 3a0a 2020 2020 2020 2020  in tgm:.        
+0005a740: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
+0005a750: 5f6f 203e 2030 3a20 6272 6561 6b0a 0a20  _o > 0: break.. 
+0005a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a770: 2020 2020 2020 2069 6620 636e 745f 6f20         if cnt_o 
+0005a780: 3e20 303a 2062 7265 616b 0a0a 2020 2020  > 0: break..    
+0005a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a7a0: 6966 206c 656e 2874 6f5f 6465 6c29 203e  if len(to_del) >
+0005a7b0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0005a7c0: 2020 2020 2020 2020 2020 2020 746f 5f64              to_d
+0005a7d0: 656c 2e73 6f72 7428 290a 2020 2020 2020  el.sort().      
+0005a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a7f0: 2020 666f 7220 6b20 696e 2072 6576 6572    for k in rever
+0005a800: 7365 6428 746f 5f64 656c 293a 2064 656c  sed(to_del): del
+0005a810: 2065 786f 6e73 2e72 676e 735b 6b5d 0a0a   exons.rgns[k]..
+0005a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a830: 2020 2020 6966 2063 6e74 5f6f 203d 3d20      if cnt_o == 
+0005a840: 303a 2062 7265 616b 0a20 2020 2020 2020  0: break.       
+0005a850: 2020 2020 2020 2020 2020 2020 206e 5f6c               n_l
+0005a860: 6f6f 7020 2b3d 2031 0a0a 2020 2020 2020  oop += 1..      
+0005a870: 2020 2020 2020 2020 2020 6578 6f6e 732e            exons.
+0005a880: 7570 6461 7465 2829 0a20 2020 2020 2020  update().       
+0005a890: 2020 2020 2020 2020 2027 2727 0a20 2020           '''.   
+0005a8a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0005a8b0: 6c65 6e28 6578 6f6e 732e 7267 6e73 2920  len(exons.rgns) 
+0005a8c0: 3e20 6c65 6e28 7365 6c66 2e65 786f 6e73  > len(self.exons
+0005a8d0: 2e72 676e 7329 3a0a 2020 2020 2020 2020  .rgns):.        
+0005a8e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0005a8f0: 7428 2745 786f 6e20 636f 7272 6563 7469  t('Exon correcti
+0005a900: 6f6e 3a20 2569 202d 3e20 2569 2069 6e20  on: %i -> %i in 
+0005a910: 2569 2720 2520 286c 656e 2873 656c 662e  %i' % (len(self.
+0005a920: 6578 6f6e 732e 7267 6e73 292c 206c 656e  exons.rgns), len
+0005a930: 2865 786f 6e73 2e72 676e 7329 2c20 6e5f  (exons.rgns), n_
+0005a940: 6c6f 6f70 2929 0a20 2020 2020 2020 2020  loop)).         
+0005a950: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+0005a960: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0005a970: 2c20 7464 2069 6e20 656e 756d 6572 6174  , td in enumerat
+0005a980: 6528 7365 6c66 2e74 645f 6c73 7429 3a0a  e(self.td_lst):.
+0005a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a9a0: 2020 2020 7467 6d20 3d20 7365 6c66 2e74      tgm = self.t
+0005a9b0: 655f 746f 5f67 655f 6d61 7073 5b6b 5d0a  e_to_ge_maps[k].
+0005a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a9d0: 2020 2020 7467 6d5f 6e65 7720 3d20 5b5d      tgm_new = []
+0005a9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005a9f0: 2020 2020 2066 6f72 206d 2069 6e20 7467       for m in tg
+0005aa00: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+0005aa10: 2020 2020 2020 2020 2020 206f 6520 3d20             oe = 
+0005aa20: 7365 6c66 2e65 786f 6e73 2e72 676e 735b  self.exons.rgns[
+0005aa30: 6d5d 0a20 2020 2020 2020 2020 2020 2020  m].             
+0005aa40: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0005aa50: 2c20 6e65 2069 6e20 656e 756d 6572 6174  , ne in enumerat
+0005aa60: 6528 6578 6f6e 732e 7267 6e73 293a 0a20  e(exons.rgns):. 
+0005aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005aa80: 2020 2020 2020 2020 2020 206e 6520 3d20             ne = 
+0005aa90: 6578 6f6e 732e 7267 6e73 5b69 5d0a 2020  exons.rgns[i].  
+0005aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005aab0: 2020 2020 2020 2020 2020 6966 206f 652e            if oe.
+0005aac0: 6861 735f 6578 745f 696e 7465 7273 6563  has_ext_intersec
+0005aad0: 7469 6f6e 5f77 6974 6828 6e65 293a 200a  tion_with(ne): .
 0005aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005aaf0: 6f65 203d 2073 656c 662e 6578 6f6e 732e  oe = self.exons.
-0005ab00: 7267 6e73 5b6d 5d0a 2020 2020 2020 2020  rgns[m].        
-0005ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ab20: 666f 7220 692c 206e 6520 696e 2065 6e75  for i, ne in enu
-0005ab30: 6d65 7261 7465 2865 786f 6e73 2e72 676e  merate(exons.rgn
-0005ab40: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0005aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ab00: 7467 6d5f 6e65 772e 6170 7065 6e64 2869  tgm_new.append(i
+0005ab10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0005ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ab30: 2020 6966 206f 652e 656e 6420 3d3d 206e    if oe.end == n
+0005ab40: 652e 656e 643a 2062 7265 616b 0a0a 2020  e.end: break..  
 0005ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ab60: 6e65 203d 2065 786f 6e73 2e72 676e 735b  ne = exons.rgns[
-0005ab70: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
-0005ab80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005ab90: 6620 6f65 2e68 6173 5f65 7874 5f69 6e74  f oe.has_ext_int
-0005aba0: 6572 7365 6374 696f 6e5f 7769 7468 286e  ersection_with(n
-0005abb0: 6529 3a20 0a20 2020 2020 2020 2020 2020  e): .           
-0005abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005abd0: 2020 2020 2074 676d 5f6e 6577 2e61 7070       tgm_new.app
-0005abe0: 656e 6428 6929 0a20 2020 2020 2020 2020  end(i).         
-0005abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ac00: 2020 2020 2020 2069 6620 6f65 2e65 6e64         if oe.end
-0005ac10: 203d 3d20 6e65 2e65 6e64 3a20 6272 6561   == ne.end: brea
-0005ac20: 6b0a 0a20 2020 2020 2020 2020 2020 2020  k..             
-0005ac30: 2020 2020 2020 2073 656c 662e 7465 5f74         self.te_t
-0005ac40: 6f5f 6765 5f6d 6170 735b 6b5d 203d 2063  o_ge_maps[k] = c
-0005ac50: 6f70 792e 6465 6570 636f 7079 2874 676d  opy.deepcopy(tgm
-0005ac60: 5f6e 6577 290a 2020 2020 2020 2020 2020  _new).          
-0005ac70: 2020 2020 2020 2020 2020 7464 2e74 655f            td.te_
-0005ac80: 746f 5f67 655f 6d61 7020 3d20 636f 7079  to_ge_map = copy
-0005ac90: 2e64 6565 7063 6f70 7928 7365 6c66 2e74  .deepcopy(self.t
-0005aca0: 655f 746f 5f67 655f 6d61 7073 5b6b 5d29  e_to_ge_maps[k])
-0005acb0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005acc0: 2020 7365 6c66 2e65 786f 6e73 203d 2065    self.exons = e
-0005acd0: 786f 6e73 2e63 6f70 7928 7570 6461 7465  xons.copy(update
-0005ace0: 203d 2066 696c 6c29 0a0a 2020 2020 2020   = fill)..      
-0005acf0: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
-0005ad00: 2020 2020 2020 2023 2320 7265 6f72 6465         ## reorde
-0005ad10: 7220 6578 6f6e 7320 616e 6420 6364 730a  r exons and cds.
-0005ad20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0005ad30: 6b2c 2074 6420 696e 2065 6e75 6d65 7261  k, td in enumera
-0005ad40: 7465 2873 656c 662e 7464 5f6c 7374 293a  te(self.td_lst):
-0005ad50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005ad60: 2074 676d 203d 2063 6f70 792e 6465 6570   tgm = copy.deep
-0005ad70: 636f 7079 2873 656c 662e 7465 5f74 6f5f  copy(self.te_to_
-0005ad80: 6765 5f6d 6170 735b 6b5d 290a 2020 2020  ge_maps[k]).    
-0005ad90: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0005ada0: 656e 2874 676d 2920 3e20 303a 0a20 2020  en(tgm) > 0:.   
-0005adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005adc0: 2070 6f73 203d 206e 702e 7a65 726f 7328   pos = np.zeros(
-0005add0: 6c65 6e28 7467 6d29 290a 2020 2020 2020  len(tgm)).      
-0005ade0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0005adf0: 7220 6d20 696e 2072 616e 6765 286c 656e  r m in range(len
-0005ae00: 2874 676d 2929 3a20 706f 735b 6d5d 203d  (tgm)): pos[m] =
-0005ae10: 2073 656c 662e 6578 6f6e 732e 7267 6e73   self.exons.rgns
-0005ae20: 5b74 676d 5b6d 5d5d 2e73 7461 7274 0a20  [tgm[m]].start. 
-0005ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ae40: 2020 206f 6472 203d 2070 6f73 2e61 7267     odr = pos.arg
-0005ae50: 736f 7274 2829 0a20 2020 2020 2020 2020  sort().         
-0005ae60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005ae70: 7465 5f74 6f5f 6765 5f6d 6170 735b 6b5d  te_to_ge_maps[k]
-0005ae80: 203d 205b 2074 676d 5b6d 5d20 666f 7220   = [ tgm[m] for 
-0005ae90: 6d20 696e 206f 6472 205d 0a20 2020 2020  m in odr ].     
-0005aea0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0005aeb0: 642e 7465 5f74 6f5f 6765 5f6d 6170 203d  d.te_to_ge_map =
-0005aec0: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
-0005aed0: 656c 662e 7465 5f74 6f5f 6765 5f6d 6170  elf.te_to_ge_map
-0005aee0: 735b 6b5d 290a 2020 2020 2020 2020 2020  s[k]).          
-0005aef0: 2020 0a20 2020 2020 2020 2020 2020 2066    .            f
-0005af00: 6f72 206b 2c20 7464 2069 6e20 656e 756d  or k, td in enum
-0005af10: 6572 6174 6528 7365 6c66 2e74 645f 6c73  erate(self.td_ls
-0005af20: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0005af30: 2020 2020 7467 6d20 3d20 636f 7079 2e64      tgm = copy.d
-0005af40: 6565 7063 6f70 7928 7365 6c66 2e74 635f  eepcopy(self.tc_
-0005af50: 746f 5f67 635f 6d61 7073 5b6b 5d29 0a20  to_gc_maps[k]). 
-0005af60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005af70: 6620 6c65 6e28 7467 6d29 203e 2030 3a0a  f len(tgm) > 0:.
-0005af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005af90: 2020 2020 706f 7320 3d20 6e70 2e7a 6572      pos = np.zer
-0005afa0: 6f73 286c 656e 2874 676d 2929 0a20 2020  os(len(tgm)).   
-0005afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005afc0: 2066 6f72 206d 2069 6e20 7261 6e67 6528   for m in range(
-0005afd0: 6c65 6e28 7467 6d29 293a 2070 6f73 5b6d  len(tgm)): pos[m
-0005afe0: 5d20 3d20 7365 6c66 2e63 6473 2e72 676e  ] = self.cds.rgn
-0005aff0: 735b 7467 6d5b 6d5d 5d2e 7374 6172 740a  s[tgm[m]].start.
-0005b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b010: 2020 2020 6f64 7220 3d20 706f 732e 6172      odr = pos.ar
-0005b020: 6773 6f72 7428 290a 2020 2020 2020 2020  gsort().        
-0005b030: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005b040: 2e74 635f 746f 5f67 635f 6d61 7073 5b6b  .tc_to_gc_maps[k
-0005b050: 5d20 3d20 5b20 7467 6d5b 6d5d 2066 6f72  ] = [ tgm[m] for
-0005b060: 206d 2069 6e20 6f64 7220 5d0a 2020 2020   m in odr ].    
-0005b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b080: 7464 2e74 635f 746f 5f67 635f 6d61 7020  td.tc_to_gc_map 
-0005b090: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-0005b0a0: 7365 6c66 2e74 635f 746f 5f67 635f 6d61  self.tc_to_gc_ma
-0005b0b0: 7073 5b6b 5d29 0a20 2020 2020 2020 2020  ps[k]).         
-0005b0c0: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
-0005b0d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0005b0e0: 2020 2020 7365 6c66 2e6e 7472 203d 206c      self.ntr = l
-0005b0f0: 656e 2873 656c 662e 7465 5f74 6f5f 6765  en(self.te_to_ge
-0005b100: 5f6d 6170 7329 0a20 2020 2020 2020 2020  _maps).         
-0005b110: 2020 2073 656c 662e 7472 5f74 6f5f 6772     self.tr_to_gr
-0005b120: 5f6d 6170 7320 3d20 5b5b 5d20 666f 7220  _maps = [[] for 
-0005b130: 6b20 696e 2072 616e 6765 2873 656c 662e  k in range(self.
-0005b140: 6e74 7229 5d0a 0a20 2020 2020 2020 2020  ntr)]..         
-0005b150: 2020 2069 6620 7365 6c66 2e6e 7472 203e     if self.ntr >
-0005b160: 206e 5f76 616c 6964 5f74 7273 3a0a 2020   n_valid_trs:.  
-0005b170: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0005b180: 696e 7428 2757 4152 4e49 4e47 3a20 4e74  int('WARNING: Nt
-0005b190: 7273 2025 6920 3e20 4e76 616c 6964 2025  rs %i > Nvalid %
-0005b1a0: 6927 2025 2028 7365 6c66 2e6e 7472 2c20  i' % (self.ntr, 
-0005b1b0: 6e5f 7661 6c69 645f 7472 7329 290a 2020  n_valid_trs)).  
-0005b1c0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0005b1d0: 7072 696e 745f 6774 665f 6c69 6e65 7328  print_gtf_lines(
-0005b1e0: 6774 665f 6c69 6e65 735f 6f66 5f61 5f67  gtf_lines_of_a_g
-0005b1f0: 656e 6529 0a20 2020 2020 2020 2020 2020  ene).           
-0005b200: 2020 2020 2066 6f72 2074 6420 696e 2073       for td in s
-0005b210: 656c 662e 7464 5f6c 7374 3a0a 2020 2020  elf.td_lst:.    
-0005b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b230: 6966 206c 656e 2874 642e 7465 5f74 6f5f  if len(td.te_to_
-0005b240: 6765 5f6d 6170 2920 3d3d 2030 3a0a 2020  ge_map) == 0:.  
-0005b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b260: 2020 2020 2020 7072 696e 745f 6774 665f        print_gtf_
-0005b270: 6c69 6e65 7328 7464 2e67 7466 5f6c 696e  lines(td.gtf_lin
-0005b280: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-0005b290: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
-0005b2a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005b2b0: 2d2d 2729 0a20 2020 2020 2020 2020 2020  --').           
-0005b2c0: 2020 2020 2070 7269 6e74 5f67 7466 5f6c       print_gtf_l
-0005b2d0: 696e 6573 2867 7466 5f6c 696e 6573 5f6f  ines(gtf_lines_o
-0005b2e0: 665f 615f 6765 6e65 290a 2020 2020 2020  f_a_gene).      
-0005b2f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0005b300: 273d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  '===============
-0005b310: 3d3d 3d3d 3d3d 3d3d 2729 0a0a 2020 2020  ========')..    
-0005b320: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-0005b330: 2020 2020 2020 2020 7365 6c66 2e72 676e          self.rgn
-0005b340: 7320 3d20 7365 6c66 2e65 786f 6e73 2e63  s = self.exons.c
-0005b350: 6f70 7928 7570 6461 7465 203d 2046 616c  opy(update = Fal
-0005b360: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-0005b370: 666f 7220 6b2c 2074 6420 696e 2065 6e75  for k, td in enu
-0005b380: 6d65 7261 7465 2873 656c 662e 7464 5f6c  merate(self.td_l
-0005b390: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-0005b3a0: 2020 2020 2073 656c 662e 7472 5f74 6f5f       self.tr_to_
-0005b3b0: 6772 5f6d 6170 735b 6b5d 203d 2063 6f70  gr_maps[k] = cop
-0005b3c0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-0005b3d0: 7465 5f74 6f5f 6765 5f6d 6170 735b 6b5d  te_to_ge_maps[k]
-0005b3e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0005b3f0: 2020 7464 2e74 725f 746f 5f67 725f 6d61    td.tr_to_gr_ma
-0005b400: 7020 3d20 7365 6c66 2e74 725f 746f 5f67  p = self.tr_to_g
-0005b410: 725f 6d61 7073 5b6b 5d0a 2020 2020 2020  r_maps[k].      
-0005b420: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
-0005b430: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0005b440: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-0005b450: 7370 616e 2829 0a0a 2020 2020 2020 2020  span()..        
-0005b460: 0a20 2020 2064 6566 2061 6464 5f74 725f  .    def add_tr_
-0005b470: 7267 6e73 2873 656c 662c 206b 692c 2072  rgns(self, ki, r
-0005b480: 676e 7329 3a0a 2020 2020 2020 2020 0a20  gns):.        . 
-0005b490: 2020 2020 2020 2074 725f 746f 5f67 725f         tr_to_gr_
-0005b4a0: 6d61 7020 3d20 5b5d 0a20 2020 2020 2020  map = [].       
-0005b4b0: 2066 6f72 206b 2c20 7220 696e 2065 6e75   for k, r in enu
-0005b4c0: 6d65 7261 7465 2872 676e 732e 7267 6e73  merate(rgns.rgns
-0005b4d0: 293a 0a20 2020 2020 2020 2020 2020 2062  ):.            b
-0005b4e0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0005b4f0: 2020 2020 666f 7220 6d2c 7320 696e 2065      for m,s in e
-0005b500: 6e75 6d65 7261 7465 2873 656c 662e 7267  numerate(self.rg
-0005b510: 6e73 2e72 676e 7329 3a0a 2020 2020 2020  ns.rgns):.      
-0005b520: 2020 2020 2020 2020 2020 6966 2072 2e69            if r.i
-0005b530: 735f 7468 655f 7361 6d65 5f61 7328 7329  s_the_same_as(s)
-0005b540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0005b550: 2020 2020 2020 7472 5f74 6f5f 6772 5f6d        tr_to_gr_m
-0005b560: 6170 2e61 7070 656e 6428 6d29 0a20 2020  ap.append(m).   
-0005b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b580: 2062 203d 2046 616c 7365 0a20 2020 2020   b = False.     
-0005b590: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0005b5a0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-0005b5b0: 2069 6620 623a 200a 2020 2020 2020 2020   if b: .        
-0005b5c0: 2020 2020 2020 2020 6d20 3d20 6c65 6e28          m = len(
-0005b5d0: 7365 6c66 2e72 676e 732e 7267 6e73 290a  self.rgns.rgns).
-0005b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b5f0: 7472 5f74 6f5f 6772 5f6d 6170 2e61 7070  tr_to_gr_map.app
-0005b600: 656e 6428 6d29 0a20 2020 2020 2020 2020  end(m).         
-0005b610: 2020 2020 2020 2073 656c 662e 7267 6e73         self.rgns
-0005b620: 2e72 676e 732e 6170 7065 6e64 2820 7220  .rgns.append( r 
-0005b630: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0005b640: 2020 0a20 2020 2020 2020 2073 656c 662e    .        self.
-0005b650: 7464 5f6c 7374 5b6b 695d 2e74 725f 746f  td_lst[ki].tr_to
-0005b660: 5f67 725f 6d61 7020 3d20 7472 5f74 6f5f  _gr_map = tr_to_
-0005b670: 6772 5f6d 6170 0a20 2020 2020 2020 2073  gr_map.        s
-0005b680: 656c 662e 7472 5f74 6f5f 6772 5f6d 6170  elf.tr_to_gr_map
-0005b690: 735b 6b69 5d20 3d20 636f 7079 2e64 6565  s[ki] = copy.dee
-0005b6a0: 7063 6f70 7928 2074 725f 746f 5f67 725f  pcopy( tr_to_gr_
-0005b6b0: 6d61 7020 290a 2020 2020 2020 2020 0a20  map ).        . 
-0005b6c0: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
-0005b6d0: 6765 745f 7464 5f65 7870 5f69 6e66 6f28  get_td_exp_info(
-0005b6e0: 7365 6c66 293a 0a0a 2020 2020 2020 2020  self):..        
-0005b6f0: 7469 5f6c 7374 203d 205b 5d0a 2020 2020  ti_lst = [].    
-0005b700: 2020 2020 666f 7220 7464 2069 6e20 7365      for td in se
-0005b710: 6c66 2e74 645f 6c73 743a 0a20 2020 2020  lf.td_lst:.     
-0005b720: 2020 2020 2020 2074 6920 3d20 7464 2e67         ti = td.g
-0005b730: 6574 5f74 645f 696e 666f 2829 0a20 2020  et_td_info().   
-0005b740: 2020 2020 2020 2020 2074 695f 6c73 742e           ti_lst.
-0005b750: 6170 7065 6e64 2874 6929 0a20 2020 2020  append(ti).     
-0005b760: 2020 2072 6574 7572 6e20 7469 5f6c 7374     return ti_lst
-0005b770: 0a20 2020 200a 0a20 2020 2064 6566 2067  .    ..    def g
-0005b780: 6574 5f73 7061 6e28 7365 6c66 293a 0a20  et_span(self):. 
-0005b790: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0005b7a0: 6966 206c 656e 2873 656c 662e 7465 5f74  if len(self.te_t
-0005b7b0: 6f5f 6765 5f6d 6170 7329 203e 2030 3a0a  o_ge_maps) > 0:.
-0005b7c0: 2020 2020 2020 2020 2020 2020 636e 7420              cnt 
-0005b7d0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0005b7e0: 666f 7220 6d20 696e 2072 616e 6765 286c  for m in range(l
-0005b7f0: 656e 2873 656c 662e 6578 6f6e 732e 7267  en(self.exons.rg
-0005b800: 6e73 2929 3a0a 2020 2020 2020 2020 2020  ns)):.          
-0005b810: 2020 2020 2020 6966 2063 6e74 203d 3d20        if cnt == 
-0005b820: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0005b830: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-0005b840: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
-0005b850: 5b6d 5d29 203e 2030 3a0a 2020 2020 2020  [m]) > 0:.      
+0005ab60: 2020 7365 6c66 2e74 655f 746f 5f67 655f    self.te_to_ge_
+0005ab70: 6d61 7073 5b6b 5d20 3d20 636f 7079 2e64  maps[k] = copy.d
+0005ab80: 6565 7063 6f70 7928 7467 6d5f 6e65 7729  eepcopy(tgm_new)
+0005ab90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005aba0: 2020 2020 2074 642e 7465 5f74 6f5f 6765       td.te_to_ge
+0005abb0: 5f6d 6170 203d 2063 6f70 792e 6465 6570  _map = copy.deep
+0005abc0: 636f 7079 2873 656c 662e 7465 5f74 6f5f  copy(self.te_to_
+0005abd0: 6765 5f6d 6170 735b 6b5d 290a 0a20 2020  ge_maps[k])..   
+0005abe0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005abf0: 662e 6578 6f6e 7320 3d20 6578 6f6e 732e  f.exons = exons.
+0005ac00: 636f 7079 2875 7064 6174 6520 3d20 6669  copy(update = fi
+0005ac10: 6c6c 290a 0a20 2020 2020 2020 2020 2020  ll)..           
+0005ac20: 2023 2727 270a 2020 2020 2020 2020 2020   #'''.          
+0005ac30: 2020 2323 2072 656f 7264 6572 2065 786f    ## reorder exo
+0005ac40: 6e73 2061 6e64 2063 6473 0a20 2020 2020  ns and cds.     
+0005ac50: 2020 2020 2020 2066 6f72 206b 2c20 7464         for k, td
+0005ac60: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
+0005ac70: 6c66 2e74 645f 6c73 7429 3a0a 2020 2020  lf.td_lst):.    
+0005ac80: 2020 2020 2020 2020 2020 2020 7467 6d20              tgm 
+0005ac90: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+0005aca0: 7365 6c66 2e74 655f 746f 5f67 655f 6d61  self.te_to_ge_ma
+0005acb0: 7073 5b6b 5d29 0a20 2020 2020 2020 2020  ps[k]).         
+0005acc0: 2020 2020 2020 2069 6620 6c65 6e28 7467         if len(tg
+0005acd0: 6d29 203e 2030 3a0a 2020 2020 2020 2020  m) > 0:.        
+0005ace0: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
+0005acf0: 3d20 6e70 2e7a 6572 6f73 286c 656e 2874  = np.zeros(len(t
+0005ad00: 676d 2929 0a20 2020 2020 2020 2020 2020  gm)).           
+0005ad10: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
+0005ad20: 6e20 7261 6e67 6528 6c65 6e28 7467 6d29  n range(len(tgm)
+0005ad30: 293a 2070 6f73 5b6d 5d20 3d20 7365 6c66  ): pos[m] = self
+0005ad40: 2e65 786f 6e73 2e72 676e 735b 7467 6d5b  .exons.rgns[tgm[
+0005ad50: 6d5d 5d2e 7374 6172 740a 2020 2020 2020  m]].start.      
+0005ad60: 2020 2020 2020 2020 2020 2020 2020 6f64                od
+0005ad70: 7220 3d20 706f 732e 6172 6773 6f72 7428  r = pos.argsort(
+0005ad80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0005ad90: 2020 2020 2020 7365 6c66 2e74 655f 746f        self.te_to
+0005ada0: 5f67 655f 6d61 7073 5b6b 5d20 3d20 5b20  _ge_maps[k] = [ 
+0005adb0: 7467 6d5b 6d5d 2066 6f72 206d 2069 6e20  tgm[m] for m in 
+0005adc0: 6f64 7220 5d0a 2020 2020 2020 2020 2020  odr ].          
+0005add0: 2020 2020 2020 2020 2020 7464 2e74 655f            td.te_
+0005ade0: 746f 5f67 655f 6d61 7020 3d20 636f 7079  to_ge_map = copy
+0005adf0: 2e64 6565 7063 6f70 7928 7365 6c66 2e74  .deepcopy(self.t
+0005ae00: 655f 746f 5f67 655f 6d61 7073 5b6b 5d29  e_to_ge_maps[k])
+0005ae10: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0005ae20: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
+0005ae30: 2074 6420 696e 2065 6e75 6d65 7261 7465   td in enumerate
+0005ae40: 2873 656c 662e 7464 5f6c 7374 293a 0a20  (self.td_lst):. 
+0005ae50: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0005ae60: 676d 203d 2063 6f70 792e 6465 6570 636f  gm = copy.deepco
+0005ae70: 7079 2873 656c 662e 7463 5f74 6f5f 6763  py(self.tc_to_gc
+0005ae80: 5f6d 6170 735b 6b5d 290a 2020 2020 2020  _maps[k]).      
+0005ae90: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0005aea0: 2874 676d 2920 3e20 303a 0a20 2020 2020  (tgm) > 0:.     
+0005aeb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0005aec0: 6f73 203d 206e 702e 7a65 726f 7328 6c65  os = np.zeros(le
+0005aed0: 6e28 7467 6d29 290a 2020 2020 2020 2020  n(tgm)).        
+0005aee0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005aef0: 6d20 696e 2072 616e 6765 286c 656e 2874  m in range(len(t
+0005af00: 676d 2929 3a20 706f 735b 6d5d 203d 2073  gm)): pos[m] = s
+0005af10: 656c 662e 6364 732e 7267 6e73 5b74 676d  elf.cds.rgns[tgm
+0005af20: 5b6d 5d5d 2e73 7461 7274 0a20 2020 2020  [m]].start.     
+0005af30: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0005af40: 6472 203d 2070 6f73 2e61 7267 736f 7274  dr = pos.argsort
+0005af50: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0005af60: 2020 2020 2020 2073 656c 662e 7463 5f74         self.tc_t
+0005af70: 6f5f 6763 5f6d 6170 735b 6b5d 203d 205b  o_gc_maps[k] = [
+0005af80: 2074 676d 5b6d 5d20 666f 7220 6d20 696e   tgm[m] for m in
+0005af90: 206f 6472 205d 0a20 2020 2020 2020 2020   odr ].         
+0005afa0: 2020 2020 2020 2020 2020 2074 642e 7463             td.tc
+0005afb0: 5f74 6f5f 6763 5f6d 6170 203d 2063 6f70  _to_gc_map = cop
+0005afc0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+0005afd0: 7463 5f74 6f5f 6763 5f6d 6170 735b 6b5d  tc_to_gc_maps[k]
+0005afe0: 290a 2020 2020 2020 2020 2020 2020 2327  ).            #'
+0005aff0: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+0005b000: 2020 0a20 2020 2020 2020 2020 2020 2073    .            s
+0005b010: 656c 662e 6e74 7220 3d20 6c65 6e28 7365  elf.ntr = len(se
+0005b020: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
+0005b030: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0005b040: 6c66 2e74 725f 746f 5f67 725f 6d61 7073  lf.tr_to_gr_maps
+0005b050: 203d 205b 5b5d 2066 6f72 206b 2069 6e20   = [[] for k in 
+0005b060: 7261 6e67 6528 7365 6c66 2e6e 7472 295d  range(self.ntr)]
+0005b070: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0005b080: 2073 656c 662e 6e74 7220 3e20 6e5f 7661   self.ntr > n_va
+0005b090: 6c69 645f 7472 733a 0a20 2020 2020 2020  lid_trs:.       
+0005b0a0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0005b0b0: 5741 524e 494e 473a 204e 7472 7320 2569  WARNING: Ntrs %i
+0005b0c0: 203e 204e 7661 6c69 6420 2569 2720 2520   > Nvalid %i' % 
+0005b0d0: 2873 656c 662e 6e74 722c 206e 5f76 616c  (self.ntr, n_val
+0005b0e0: 6964 5f74 7273 2929 0a20 2020 2020 2020  id_trs)).       
+0005b0f0: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
+0005b100: 5f67 7466 5f6c 696e 6573 2867 7466 5f6c  _gtf_lines(gtf_l
+0005b110: 696e 6573 5f6f 665f 615f 6765 6e65 290a  ines_of_a_gene).
+0005b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b130: 666f 7220 7464 2069 6e20 7365 6c66 2e74  for td in self.t
+0005b140: 645f 6c73 743a 0a20 2020 2020 2020 2020  d_lst:.         
+0005b150: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0005b160: 6e28 7464 2e74 655f 746f 5f67 655f 6d61  n(td.te_to_ge_ma
+0005b170: 7029 203d 3d20 303a 0a20 2020 2020 2020  p) == 0:.       
+0005b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b190: 2070 7269 6e74 5f67 7466 5f6c 696e 6573   print_gtf_lines
+0005b1a0: 2874 642e 6774 665f 6c69 6e65 7329 0a20  (td.gtf_lines). 
+0005b1b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0005b1c0: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
+0005b1d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
+0005b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b1f0: 7072 696e 745f 6774 665f 6c69 6e65 7328  print_gtf_lines(
+0005b200: 6774 665f 6c69 6e65 735f 6f66 5f61 5f67  gtf_lines_of_a_g
+0005b210: 656e 6529 0a20 2020 2020 2020 2020 2020  ene).           
+0005b220: 2020 2020 2070 7269 6e74 2827 3d3d 3d3d       print('====
+0005b230: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0005b240: 3d3d 3d27 290a 0a20 2020 2020 2020 2020  ===')..         
+0005b250: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+0005b260: 2020 2073 656c 662e 7267 6e73 203d 2073     self.rgns = s
+0005b270: 656c 662e 6578 6f6e 732e 636f 7079 2875  elf.exons.copy(u
+0005b280: 7064 6174 6520 3d20 4661 6c73 6529 0a20  pdate = False). 
+0005b290: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0005b2a0: 2c20 7464 2069 6e20 656e 756d 6572 6174  , td in enumerat
+0005b2b0: 6528 7365 6c66 2e74 645f 6c73 7429 3a0a  e(self.td_lst):.
+0005b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b2d0: 7365 6c66 2e74 725f 746f 5f67 725f 6d61  self.tr_to_gr_ma
+0005b2e0: 7073 5b6b 5d20 3d20 636f 7079 2e64 6565  ps[k] = copy.dee
+0005b2f0: 7063 6f70 7928 7365 6c66 2e74 655f 746f  pcopy(self.te_to
+0005b300: 5f67 655f 6d61 7073 5b6b 5d29 0a20 2020  _ge_maps[k]).   
+0005b310: 2020 2020 2020 2020 2020 2020 2074 642e               td.
+0005b320: 7472 5f74 6f5f 6772 5f6d 6170 203d 2073  tr_to_gr_map = s
+0005b330: 656c 662e 7472 5f74 6f5f 6772 5f6d 6170  elf.tr_to_gr_map
+0005b340: 735b 6b5d 0a20 2020 2020 2020 2020 2020  s[k].           
+0005b350: 2027 2727 0a20 2020 2020 2020 2020 2020   '''.           
+0005b360: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0005b370: 2020 7365 6c66 2e67 6574 5f73 7061 6e28    self.get_span(
+0005b380: 290a 0a20 2020 2020 2020 200a 2020 2020  )..        .    
+0005b390: 6465 6620 6164 645f 7472 5f72 676e 7328  def add_tr_rgns(
+0005b3a0: 7365 6c66 2c20 6b69 2c20 7267 6e73 293a  self, ki, rgns):
+0005b3b0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0005b3c0: 2020 7472 5f74 6f5f 6772 5f6d 6170 203d    tr_to_gr_map =
+0005b3d0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+0005b3e0: 6b2c 2072 2069 6e20 656e 756d 6572 6174  k, r in enumerat
+0005b3f0: 6528 7267 6e73 2e72 676e 7329 3a0a 2020  e(rgns.rgns):.  
+0005b400: 2020 2020 2020 2020 2020 6220 3d20 5472            b = Tr
+0005b410: 7565 0a20 2020 2020 2020 2020 2020 2066  ue.            f
+0005b420: 6f72 206d 2c73 2069 6e20 656e 756d 6572  or m,s in enumer
+0005b430: 6174 6528 7365 6c66 2e72 676e 732e 7267  ate(self.rgns.rg
+0005b440: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
+0005b450: 2020 2020 2069 6620 722e 6973 5f74 6865       if r.is_the
+0005b460: 5f73 616d 655f 6173 2873 293a 0a20 2020  _same_as(s):.   
+0005b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b480: 2074 725f 746f 5f67 725f 6d61 702e 6170   tr_to_gr_map.ap
+0005b490: 7065 6e64 286d 290a 2020 2020 2020 2020  pend(m).        
+0005b4a0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+0005b4b0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0005b4c0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0005b4d0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+0005b4e0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0005b4f0: 2020 206d 203d 206c 656e 2873 656c 662e     m = len(self.
+0005b500: 7267 6e73 2e72 676e 7329 0a20 2020 2020  rgns.rgns).     
+0005b510: 2020 2020 2020 2020 2020 2074 725f 746f             tr_to
+0005b520: 5f67 725f 6d61 702e 6170 7065 6e64 286d  _gr_map.append(m
+0005b530: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0005b540: 2020 7365 6c66 2e72 676e 732e 7267 6e73    self.rgns.rgns
+0005b550: 2e61 7070 656e 6428 2072 2029 0a20 2020  .append( r ).   
+0005b560: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0005b570: 2020 2020 2020 7365 6c66 2e74 645f 6c73        self.td_ls
+0005b580: 745b 6b69 5d2e 7472 5f74 6f5f 6772 5f6d  t[ki].tr_to_gr_m
+0005b590: 6170 203d 2074 725f 746f 5f67 725f 6d61  ap = tr_to_gr_ma
+0005b5a0: 700a 2020 2020 2020 2020 7365 6c66 2e74  p.        self.t
+0005b5b0: 725f 746f 5f67 725f 6d61 7073 5b6b 695d  r_to_gr_maps[ki]
+0005b5c0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0005b5d0: 2820 7472 5f74 6f5f 6772 5f6d 6170 2029  ( tr_to_gr_map )
+0005b5e0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0005b5f0: 2020 0a20 2020 2064 6566 2067 6574 5f74    .    def get_t
+0005b600: 645f 6578 705f 696e 666f 2873 656c 6629  d_exp_info(self)
+0005b610: 3a0a 0a20 2020 2020 2020 2074 695f 6c73  :..        ti_ls
+0005b620: 7420 3d20 5b5d 0a20 2020 2020 2020 2066  t = [].        f
+0005b630: 6f72 2074 6420 696e 2073 656c 662e 7464  or td in self.td
+0005b640: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
+0005b650: 2020 7469 203d 2074 642e 6765 745f 7464    ti = td.get_td
+0005b660: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
+0005b670: 2020 2020 7469 5f6c 7374 2e61 7070 656e      ti_lst.appen
+0005b680: 6428 7469 290a 2020 2020 2020 2020 7265  d(ti).        re
+0005b690: 7475 726e 2074 695f 6c73 740a 2020 2020  turn ti_lst.    
+0005b6a0: 0a0a 2020 2020 6465 6620 6765 745f 7370  ..    def get_sp
+0005b6b0: 616e 2873 656c 6629 3a0a 2020 2020 2020  an(self):.      
+0005b6c0: 2020 0a20 2020 2020 2020 2069 6620 6c65    .        if le
+0005b6d0: 6e28 7365 6c66 2e74 655f 746f 5f67 655f  n(self.te_to_ge_
+0005b6e0: 6d61 7073 2920 3e20 303a 0a20 2020 2020  maps) > 0:.     
+0005b6f0: 2020 2020 2020 2063 6e74 203d 2030 0a20         cnt = 0. 
+0005b700: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+0005b710: 2069 6e20 7261 6e67 6528 6c65 6e28 7365   in range(len(se
+0005b720: 6c66 2e65 786f 6e73 2e72 676e 7329 293a  lf.exons.rgns)):
+0005b730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005b740: 2069 6620 636e 7420 3d3d 2030 3a0a 2020   if cnt == 0:.  
+0005b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b760: 2020 6966 206c 656e 2873 656c 662e 7465    if len(self.te
+0005b770: 5f74 6f5f 6765 5f6d 6170 735b 6d5d 2920  _to_ge_maps[m]) 
+0005b780: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0005b790: 2020 2020 2020 2020 2020 2020 2073 203d               s =
+0005b7a0: 2073 656c 662e 6578 6f6e 732e 7267 6e73   self.exons.rgns
+0005b7b0: 5b6d 5d2e 7374 6172 740a 2020 2020 2020  [m].start.      
+0005b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b7d0: 2020 6520 3d20 7365 6c66 2e65 786f 6e73    e = self.exons
+0005b7e0: 2e72 676e 735b 6d5d 2e65 6e64 0a20 2020  .rgns[m].end.   
+0005b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b800: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
+0005b810: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0005b820: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0005b830: 2020 2020 2020 2020 7320 3d20 6d69 6e28          s = min(
+0005b840: 732c 2073 656c 662e 6578 6f6e 732e 7267  s, self.exons.rg
+0005b850: 6e73 5b6d 5d2e 7374 6172 7429 0a20 2020  ns[m].start).   
 0005b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b870: 2020 7320 3d20 7365 6c66 2e65 786f 6e73    s = self.exons
-0005b880: 2e72 676e 735b 6d5d 2e73 7461 7274 0a20  .rgns[m].start. 
-0005b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b8a0: 2020 2020 2020 2065 203d 2073 656c 662e         e = self.
-0005b8b0: 6578 6f6e 732e 7267 6e73 5b6d 5d2e 656e  exons.rgns[m].en
-0005b8c0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0005b8d0: 2020 2020 2020 2020 2020 636e 7420 2b3d            cnt +=
-0005b8e0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-0005b8f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0005b900: 2020 2020 2020 2020 2020 2020 2073 203d               s =
-0005b910: 206d 696e 2873 2c20 7365 6c66 2e65 786f   min(s, self.exo
-0005b920: 6e73 2e72 676e 735b 6d5d 2e73 7461 7274  ns.rgns[m].start
-0005b930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0005b940: 2020 2020 2020 6520 3d20 6d61 7828 652c        e = max(e,
-0005b950: 2073 656c 662e 6578 6f6e 732e 7267 6e73   self.exons.rgns
-0005b960: 5b6d 5d2e 656e 6429 0a20 2020 2020 2020  [m].end).       
-0005b970: 2020 2020 2069 6620 636e 7420 3d3d 2030       if cnt == 0
-0005b980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0005b990: 2020 7365 6c66 2e73 7061 6e20 3d20 7265    self.span = re
-0005b9a0: 6769 6f6e 2873 656c 662e 6368 722c 2030  gion(self.chr, 0
-0005b9b0: 2c20 302c 2027 4d27 290a 2020 2020 2020  , 0, 'M').      
-0005b9c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0005b9d0: 2073 656c 662e 7370 616e 0a20 2020 2020   self.span.     
-0005b9e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0005b9f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0005ba00: 662e 7370 616e 203d 2072 6567 696f 6e28  f.span = region(
-0005ba10: 7365 6c66 2e63 6872 2c20 732c 2065 2c20  self.chr, s, e, 
-0005ba20: 274d 2729 0a20 2020 2020 2020 2020 2020  'M').           
-0005ba30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0005ba40: 2e73 7061 6e20 2020 200a 2020 2020 2020  .span    .      
-0005ba50: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0005ba60: 2020 2066 6f72 206d 2c20 7464 2069 6e20     for m, td in 
-0005ba70: 656e 756d 6572 6174 6528 7365 6c66 2e74  enumerate(self.t
-0005ba80: 645f 6c73 7429 3a0a 2020 2020 2020 2020  d_lst):.        
-0005ba90: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-0005baa0: 656c 662e 7465 5f74 6f5f 6765 5f6d 6170  elf.te_to_ge_map
-0005bab0: 735b 6d5d 293a 0a20 2020 2020 2020 2020  s[m]):.         
-0005bac0: 2020 2020 2020 2020 2020 2063 6e74 203d             cnt =
-0005bad0: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-0005bae0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0005baf0: 7365 6c66 2e74 655f 746f 5f67 655f 6d61  self.te_to_ge_ma
-0005bb00: 7073 5b6d 5d3a 0a20 2020 2020 2020 2020  ps[m]:.         
-0005bb10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005bb20: 6620 636e 7420 3d3d 2030 3a0a 2020 2020  f cnt == 0:.    
+0005b870: 2065 203d 206d 6178 2865 2c20 7365 6c66   e = max(e, self
+0005b880: 2e65 786f 6e73 2e72 676e 735b 6d5d 2e65  .exons.rgns[m].e
+0005b890: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
+0005b8a0: 6966 2063 6e74 203d 3d20 303a 0a20 2020  if cnt == 0:.   
+0005b8b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005b8c0: 662e 7370 616e 203d 2072 6567 696f 6e28  f.span = region(
+0005b8d0: 7365 6c66 2e63 6872 2c20 302c 2030 2c20  self.chr, 0, 0, 
+0005b8e0: 274d 2729 0a20 2020 2020 2020 2020 2020  'M').           
+0005b8f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0005b900: 2e73 7061 6e0a 2020 2020 2020 2020 2020  .span.          
+0005b910: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0005b920: 2020 2020 2020 2020 7365 6c66 2e73 7061          self.spa
+0005b930: 6e20 3d20 7265 6769 6f6e 2873 656c 662e  n = region(self.
+0005b940: 6368 722c 2073 2c20 652c 2027 4d27 290a  chr, s, e, 'M').
+0005b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b960: 7265 7475 726e 2073 656c 662e 7370 616e  return self.span
+0005b970: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0005b980: 200a 2020 2020 2020 2020 2020 2020 666f   .            fo
+0005b990: 7220 6d2c 2074 6420 696e 2065 6e75 6d65  r m, td in enume
+0005b9a0: 7261 7465 2873 656c 662e 7464 5f6c 7374  rate(self.td_lst
+0005b9b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0005b9c0: 2020 2069 6620 6c65 6e28 7365 6c66 2e74     if len(self.t
+0005b9d0: 655f 746f 5f67 655f 6d61 7073 5b6d 5d29  e_to_ge_maps[m])
+0005b9e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005b9f0: 2020 2020 2020 636e 7420 3d20 300a 2020        cnt = 0.  
+0005ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ba10: 2020 666f 7220 6920 696e 2073 656c 662e    for i in self.
+0005ba20: 7465 5f74 6f5f 6765 5f6d 6170 735b 6d5d  te_to_ge_maps[m]
+0005ba30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005ba40: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
+0005ba50: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0005ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ba70: 2020 2073 203d 2073 656c 662e 6578 6f6e     s = self.exon
+0005ba80: 732e 7267 6e73 5b69 5d2e 7374 6172 740a  s.rgns[i].start.
+0005ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005baa0: 2020 2020 2020 2020 2020 2020 6520 3d20              e = 
+0005bab0: 7365 6c66 2e65 786f 6e73 2e72 676e 735b  self.exons.rgns[
+0005bac0: 695d 2e65 6e64 0a20 2020 2020 2020 2020  i].end.         
+0005bad0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0005bae0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0005baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bb00: 2073 203d 206d 696e 2873 2c20 7365 6c66   s = min(s, self
+0005bb10: 2e65 786f 6e73 2e72 676e 735b 695d 2e73  .exons.rgns[i].s
+0005bb20: 7461 7274 290a 2020 2020 2020 2020 2020  tart).          
 0005bb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bb40: 2020 2020 2020 2020 7320 3d20 7365 6c66          s = self
-0005bb50: 2e65 786f 6e73 2e72 676e 735b 695d 2e73  .exons.rgns[i].s
-0005bb60: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
-0005bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bb80: 2065 203d 2073 656c 662e 6578 6f6e 732e   e = self.exons.
-0005bb90: 7267 6e73 5b69 5d2e 656e 640a 2020 2020  rgns[i].end.    
-0005bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bbb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0005bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bbd0: 2020 2020 2020 7320 3d20 6d69 6e28 732c        s = min(s,
-0005bbe0: 2073 656c 662e 6578 6f6e 732e 7267 6e73   self.exons.rgns
-0005bbf0: 5b69 5d2e 7374 6172 7429 0a20 2020 2020  [i].start).     
+0005bb40: 2020 6520 3d20 6d61 7828 652c 2073 656c    e = max(e, sel
+0005bb50: 662e 6578 6f6e 732e 7267 6e73 5b69 5d2e  f.exons.rgns[i].
+0005bb60: 656e 6429 0a20 2020 2020 2020 2020 2020  end).           
+0005bb70: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
+0005bb80: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0005bb90: 2020 2020 2020 2020 2020 7464 2e62 6567            td.beg
+0005bba0: 696e 203d 2073 0a20 2020 2020 2020 2020  in = s.         
+0005bbb0: 2020 2020 2020 2020 2020 2074 642e 656e             td.en
+0005bbc0: 6420 3d20 650a 2020 2020 2020 2020 2020  d = e.          
+0005bbd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0005bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bbf0: 7464 2e62 6567 696e 203d 202d 310a 2020  td.begin = -1.  
 0005bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bc10: 2020 2020 2020 2065 203d 206d 6178 2865         e = max(e
-0005bc20: 2c20 7365 6c66 2e65 786f 6e73 2e72 676e  , self.exons.rgn
-0005bc30: 735b 695d 2e65 6e64 290a 2020 2020 2020  s[i].end).      
-0005bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bc50: 2020 636e 7420 2b3d 2031 0a20 2020 2020    cnt += 1.     
-0005bc60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0005bc70: 642e 6265 6769 6e20 3d20 730a 2020 2020  d.begin = s.    
-0005bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bc90: 7464 2e65 6e64 203d 2065 0a20 2020 2020  td.end = e.     
-0005bca0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0005bcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005bcc0: 2020 2020 2074 642e 6265 6769 6e20 3d20       td.begin = 
-0005bcd0: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-0005bce0: 2020 2020 2020 2074 642e 656e 6420 3d20         td.end = 
-0005bcf0: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-0005bd00: 2020 200a 2020 2020 2020 2020 656c 7365     .        else
-0005bd10: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0005bd20: 6c66 2e73 7061 6e20 3d20 7265 6769 6f6e  lf.span = region
-0005bd30: 2873 656c 662e 6368 722c 2030 2c20 302c  (self.chr, 0, 0,
-0005bd40: 2027 4d27 290a 2020 2020 2020 2020 2020   'M').          
-0005bd50: 2020 7265 7475 726e 2073 656c 662e 7370    return self.sp
-0005bd60: 616e 0a0a 2020 2020 2020 2020 0a20 2020  an..        .   
-0005bd70: 2064 6566 2067 6574 5f74 645f 7370 616e   def get_td_span
-0005bd80: 2873 656c 662c 6e29 3a0a 2020 2020 2020  (self,n):.      
-0005bd90: 2020 6966 206e 203c 206c 656e 2873 656c    if n < len(sel
-0005bda0: 662e 7465 5f74 6f5f 6765 5f6d 6170 7329  f.te_to_ge_maps)
-0005bdb0: 3a0a 2020 2020 2020 2020 2020 2020 7467  :.            tg
-0005bdc0: 6d20 3d20 7365 6c66 2e74 655f 746f 5f67  m = self.te_to_g
-0005bdd0: 655f 6d61 7073 5b6e 5d0a 2020 2020 2020  e_maps[n].      
-0005bde0: 2020 2020 2020 6966 206c 656e 2874 676d        if len(tgm
-0005bdf0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-0005be00: 2020 2020 2020 2063 6e74 203d 2030 0a20         cnt = 0. 
-0005be10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0005be20: 6f72 206d 2069 6e20 7467 6d3a 0a20 2020  or m in tgm:.   
-0005be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005be40: 2069 6620 636e 7420 3d3d 2030 3a0a 2020   if cnt == 0:.  
-0005be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005be60: 2020 2020 2020 7320 3d20 7365 6c66 2e65        s = self.e
-0005be70: 786f 6e73 2e72 676e 735b 6d5d 2e73 7461  xons.rgns[m].sta
-0005be80: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-0005be90: 2020 2020 2020 2020 2020 2065 203d 2073             e = s
-0005bea0: 656c 662e 6578 6f6e 732e 7267 6e73 5b6d  elf.exons.rgns[m
-0005beb0: 5d2e 656e 640a 2020 2020 2020 2020 2020  ].end.          
-0005bec0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-0005bed0: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-0005bee0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0005bef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005bf00: 2020 2020 2020 2020 2073 203d 206d 696e           s = min
-0005bf10: 2873 2c20 7365 6c66 2e65 786f 6e73 2e72  (s, self.exons.r
-0005bf20: 676e 735b 6d5d 2e73 7461 7274 290a 2020  gns[m].start).  
-0005bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bf40: 2020 2020 2020 6520 3d20 6d61 7828 652c        e = max(e,
-0005bf50: 2073 656c 662e 6578 6f6e 732e 7267 6e73   self.exons.rgns
-0005bf60: 5b6d 5d2e 656e 6429 0a20 2020 2020 2020  [m].end).       
-0005bf70: 2020 2020 2020 2020 2069 6620 636e 7420           if cnt 
-0005bf80: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0005bf90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0005bfa0: 2072 6567 696f 6e28 7365 6c66 2e63 6872   region(self.chr
-0005bfb0: 2c20 302c 2030 2c20 274d 2729 0a20 2020  , 0, 0, 'M').   
-0005bfc0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0005bfd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0005bfe0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0005bff0: 6769 6f6e 2873 656c 662e 6368 722c 2073  gion(self.chr, s
-0005c000: 2c20 652c 2027 4d27 2920 2020 200a 2020  , e, 'M')    .  
-0005c010: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0005c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c030: 7265 7475 726e 2072 6567 696f 6e28 7365  return region(se
-0005c040: 6c66 2e63 6872 2c20 302c 2030 2c20 274d  lf.chr, 0, 0, 'M
-0005c050: 2729 2020 2020 0a20 2020 2020 2020 2065  ')    .        e
-0005c060: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0005c070: 2072 6574 7572 6e20 7265 6769 6f6e 2873   return region(s
-0005c080: 656c 662e 6368 722c 2030 2c20 302c 2027  elf.chr, 0, 0, '
-0005c090: 4d27 290a 0a20 2020 2020 2020 200a 2020  M')..        .  
-0005c0a0: 2020 6465 6620 6d65 7267 6528 7365 6c66    def merge(self
-0005c0b0: 2c20 6764 293a 0a0a 2020 2020 2020 2020  , gd):..        
-0005c0c0: 6966 2028 6c65 6e28 6764 2e65 786f 6e73  if (len(gd.exons
-0005c0d0: 2e72 676e 7329 203e 2030 2920 2620 2867  .rgns) > 0) & (g
-0005c0e0: 642e 6e74 7220 3e20 3029 3a0a 2020 2020  d.ntr > 0):.    
-0005c0f0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0005c100: 2020 2020 2023 2320 6d65 7267 6520 6578       ## merge ex
-0005c110: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
-0005c120: 696d 6170 5f65 203d 207b 6b3a 202d 3120  imap_e = {k: -1 
-0005c130: 666f 7220 6b20 696e 2072 616e 6765 286c  for k in range(l
-0005c140: 656e 2867 642e 6578 6f6e 732e 7267 6e73  en(gd.exons.rgns
-0005c150: 2929 7d0a 0a20 2020 2020 2020 2020 2020  ))}..           
-0005c160: 206e 6520 3d20 6c65 6e28 7365 6c66 2e65   ne = len(self.e
-0005c170: 786f 6e73 2e72 676e 7329 0a20 2020 2020  xons.rgns).     
-0005c180: 2020 2020 2020 206e 6577 5f63 6e74 203d         new_cnt =
-0005c190: 2030 0a20 2020 2020 2020 2020 2020 2066   0.            f
-0005c1a0: 6f72 206b 2c20 7220 696e 2065 6e75 6d65  or k, r in enume
-0005c1b0: 7261 7465 2867 642e 6578 6f6e 732e 7267  rate(gd.exons.rg
-0005c1c0: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
-0005c1d0: 2020 2020 2069 6d61 705f 655b 6b5d 203d       imap_e[k] =
-0005c1e0: 206e 6520 2b20 6e65 775f 636e 740a 2020   ne + new_cnt.  
-0005c1f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0005c200: 7220 6d2c 2067 2069 6e20 656e 756d 6572  r m, g in enumer
-0005c210: 6174 6528 7365 6c66 2e65 786f 6e73 2e72  ate(self.exons.r
-0005c220: 676e 7329 3a0a 2020 2020 2020 2020 2020  gns):.          
-0005c230: 2020 2020 2020 2020 2020 6966 2072 2e69            if r.i
-0005c240: 735f 7468 655f 7361 6d65 5f61 7328 6729  s_the_same_as(g)
-0005c250: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0005c260: 2020 2020 2020 2020 2020 696d 6170 5f65            imap_e
-0005c270: 5b6b 5d20 3d20 6d0a 2020 2020 2020 2020  [k] = m.        
-0005c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c290: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0005c2a0: 2020 2020 2020 6966 2069 6d61 705f 655b        if imap_e[
-0005c2b0: 6b5d 203d 3d20 286e 6520 2b20 6e65 775f  k] == (ne + new_
-0005c2c0: 636e 7429 3a20 0a20 2020 2020 2020 2020  cnt): .         
-0005c2d0: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
-0005c2e0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0005c2f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005c300: 2e65 786f 6e73 2e72 676e 732e 6170 7065  .exons.rgns.appe
-0005c310: 6e64 2872 290a 0a20 2020 2020 2020 2020  nd(r)..         
-0005c320: 2020 2023 2320 6d65 7267 6520 6364 7373     ## merge cdss
-0005c330: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-0005c340: 705f 6320 3d20 7b6b 3a20 2d31 2066 6f72  p_c = {k: -1 for
-0005c350: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
-0005c360: 6764 2e63 6473 2e72 676e 7329 297d 0a0a  gd.cds.rgns))}..
-0005c370: 2020 2020 2020 2020 2020 2020 6e63 203d              nc =
-0005c380: 206c 656e 2873 656c 662e 6364 732e 7267   len(self.cds.rg
-0005c390: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
-0005c3a0: 6e65 775f 636e 7420 3d20 300a 2020 2020  new_cnt = 0.    
-0005c3b0: 2020 2020 2020 2020 666f 7220 6b2c 2072          for k, r
-0005c3c0: 2069 6e20 656e 756d 6572 6174 6528 6764   in enumerate(gd
-0005c3d0: 2e63 6473 2e72 676e 7329 3a0a 2020 2020  .cds.rgns):.    
-0005c3e0: 2020 2020 2020 2020 2020 2020 696d 6170              imap
-0005c3f0: 5f63 5b6b 5d20 3d20 6e63 202b 206e 6577  _c[k] = nc + new
-0005c400: 5f63 6e74 0a20 2020 2020 2020 2020 2020  _cnt.           
-0005c410: 2020 2020 2066 6f72 206d 2c20 6720 696e       for m, g in
-0005c420: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
-0005c430: 6364 732e 7267 6e73 293a 0a20 2020 2020  cds.rgns):.     
-0005c440: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005c450: 6620 722e 6973 5f74 6865 5f73 616d 655f  f r.is_the_same_
-0005c460: 6173 2867 293a 0a20 2020 2020 2020 2020  as(g):.         
-0005c470: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005c480: 6d61 705f 635b 6b5d 203d 206d 0a20 2020  map_c[k] = m.   
-0005c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c4a0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0005c4b0: 2020 2020 2020 2020 2020 2069 6620 696d             if im
-0005c4c0: 6170 5f63 5b6b 5d20 3d3d 2028 6e63 202b  ap_c[k] == (nc +
-0005c4d0: 206e 6577 5f63 6e74 293a 200a 2020 2020   new_cnt): .    
-0005c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c4f0: 6e65 775f 636e 7420 2b3d 2031 0a20 2020  new_cnt += 1.   
-0005c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c510: 2073 656c 662e 6364 732e 7267 6e73 2e61   self.cds.rgns.a
-0005c520: 7070 656e 6428 7229 0a0a 2020 2020 2020  ppend(r)..      
-0005c530: 2020 2020 2020 666f 7220 6b2c 2074 676d        for k, tgm
-0005c540: 5f65 2069 6e20 656e 756d 6572 6174 6528  _e in enumerate(
-0005c550: 6764 2e74 655f 746f 5f67 655f 6d61 7073  gd.te_to_ge_maps
-0005c560: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0005c570: 2020 2074 676d 5f6e 6577 5f65 203d 205b     tgm_new_e = [
-0005c580: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0005c590: 2020 666f 7220 6d20 696e 2072 616e 6765    for m in range
-0005c5a0: 286c 656e 2874 676d 5f65 2929 3a20 7467  (len(tgm_e)): tg
-0005c5b0: 6d5f 6e65 775f 652e 6170 7065 6e64 2869  m_new_e.append(i
-0005c5c0: 6d61 705f 655b 7467 6d5f 655b 6d5d 5d29  map_e[tgm_e[m]])
-0005c5d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005c5e0: 2020 7467 6d5f 6320 3d20 6764 2e74 635f    tgm_c = gd.tc_
-0005c5f0: 746f 5f67 635f 6d61 7073 5b6b 5d0a 2020  to_gc_maps[k].  
-0005c600: 2020 2020 2020 2020 2020 2020 2020 7467                tg
-0005c610: 6d5f 6e65 775f 6320 3d20 5b5d 0a20 2020  m_new_c = [].   
-0005c620: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0005c630: 206d 2069 6e20 7261 6e67 6528 6c65 6e28   m in range(len(
-0005c640: 7467 6d5f 6329 293a 2074 676d 5f6e 6577  tgm_c)): tgm_new
-0005c650: 5f63 2e61 7070 656e 6428 696d 6170 5f63  _c.append(imap_c
-0005c660: 5b74 676d 5f63 5b6d 5d5d 290a 0a20 2020  [tgm_c[m]])..   
-0005c670: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0005c680: 662e 7465 5f74 6f5f 6765 5f6d 6170 732e  f.te_to_ge_maps.
-0005c690: 6170 7065 6e64 2874 676d 5f6e 6577 5f65  append(tgm_new_e
-0005c6a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0005c6b0: 2020 7365 6c66 2e74 635f 746f 5f67 635f    self.tc_to_gc_
-0005c6c0: 6d61 7073 2e61 7070 656e 6428 7467 6d5f  maps.append(tgm_
-0005c6d0: 6e65 775f 6329 0a20 2020 2020 2020 2020  new_c).         
-0005c6e0: 2020 2020 2020 2067 642e 7464 5f6c 7374         gd.td_lst
-0005c6f0: 5b6b 5d2e 7465 5f74 6f5f 6765 5f6d 6170  [k].te_to_ge_map
-0005c700: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-0005c710: 2874 676d 5f6e 6577 5f65 290a 2020 2020  (tgm_new_e).    
-0005c720: 2020 2020 2020 2020 2020 2020 6764 2e74              gd.t
-0005c730: 645f 6c73 745b 6b5d 2e74 635f 746f 5f67  d_lst[k].tc_to_g
-0005c740: 635f 6d61 7020 3d20 636f 7079 2e64 6565  c_map = copy.dee
-0005c750: 7063 6f70 7928 7467 6d5f 6e65 775f 6329  pcopy(tgm_new_c)
-0005c760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005c770: 2073 656c 662e 7464 5f6c 7374 2e61 7070   self.td_lst.app
-0005c780: 656e 6428 6764 2e74 645f 6c73 745b 6b5d  end(gd.td_lst[k]
-0005c790: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0005c7a0: 2323 0a20 2020 2020 2020 2020 2020 2073  ##.            s
-0005c7b0: 656c 662e 6e74 7220 3d20 6c65 6e28 7365  elf.ntr = len(se
-0005c7c0: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
-0005c7d0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0005c7e0: 6c66 2e74 725f 746f 5f67 725f 6d61 7073  lf.tr_to_gr_maps
-0005c7f0: 203d 205b 5b5d 2066 6f72 206b 2069 6e20   = [[] for k in 
-0005c800: 7261 6e67 6528 7365 6c66 2e6e 7472 295d  range(self.ntr)]
-0005c810: 0a0a 2020 2020 2020 2020 2020 2020 6e5f  ..            n_
-0005c820: 6368 725f 6469 6666 203d 2030 0a20 2020  chr_diff = 0.   
-0005c830: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
-0005c840: 7464 2069 6e20 656e 756d 6572 6174 6528  td in enumerate(
-0005c850: 6764 2e74 645f 6c73 7429 3a0a 2020 2020  gd.td_lst):.    
-0005c860: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0005c870: 656c 662e 6368 7220 213d 2067 642e 6368  elf.chr != gd.ch
-0005c880: 723a 206e 5f63 6872 5f64 6966 6620 2b3d  r: n_chr_diff +=
-0005c890: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
-0005c8a0: 6966 206e 5f63 6872 5f64 6966 6620 3e20  if n_chr_diff > 
-0005c8b0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0005c8c0: 2020 2070 7269 6e74 2827 4552 524f 5220     print('ERROR 
-0005c8d0: 696e 2067 656e 655f 6465 7363 7269 7074  in gene_descript
-0005c8e0: 6f72 3a3a 6d65 7267 653a 206d 756c 7469  or::merge: multi
-0005c8f0: 706c 6520 6368 726d 2064 6574 6563 7465  ple chrm detecte
-0005c900: 6420 696e 2061 2063 6875 6e6b 2028 2569  d in a chunk (%i
-0005c910: 2927 2025 206e 5f63 6872 5f64 6966 6629  )' % n_chr_diff)
-0005c920: 0a0a 2020 2020 2727 270a 2020 2020 6465  ..    '''.    de
-0005c930: 6620 6f72 6465 7228 7365 6c66 293a 0a20  f order(self):. 
-0005c940: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0005c950: 7370 7320 3d20 6e70 2e7a 6572 6f73 2873  sps = np.zeros(s
-0005c960: 656c 662e 6e74 7229 0a20 2020 2020 2020  elf.ntr).       
-0005c970: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
-0005c980: 7365 6c66 2e6e 7472 293a 0a20 2020 2020  self.ntr):.     
-0005c990: 2020 2020 2020 2073 7061 6e20 3d20 7365         span = se
-0005c9a0: 6c66 2e67 6574 5f74 645f 7370 616e 286e  lf.get_td_span(n
-0005c9b0: 290a 2020 2020 2020 2020 2020 2020 7370  ).            sp
-0005c9c0: 735b 6e5d 203d 2073 7061 6e2e 7374 6172  s[n] = span.star
-0005c9d0: 740a 2020 2020 2020 2020 2020 2020 0a20  t.            . 
-0005c9e0: 2020 2020 2020 206f 6472 203d 2073 7073         odr = sps
-0005c9f0: 2e61 7267 736f 7274 2829 0a20 2020 2020  .argsort().     
-0005ca00: 2020 2073 656c 662e 7465 5f74 6f5f 6765     self.te_to_ge
-0005ca10: 5f6d 6170 7320 3d20 5b73 656c 662e 7465  _maps = [self.te
-0005ca20: 5f74 6f5f 6765 5f6d 6170 735b 6b5d 2066  _to_ge_maps[k] f
-0005ca30: 6f72 206b 2069 6e20 6f64 725d 0a20 2020  or k in odr].   
-0005ca40: 2020 2020 2073 656c 662e 7472 5f74 6f5f       self.tr_to_
-0005ca50: 6772 5f6d 6170 7320 3d20 5b73 656c 662e  gr_maps = [self.
-0005ca60: 7472 5f74 6f5f 6772 5f6d 6170 735b 6b5d  tr_to_gr_maps[k]
-0005ca70: 2066 6f72 206b 2069 6e20 6f64 725d 0a20   for k in odr]. 
-0005ca80: 2020 2020 2020 2073 656c 662e 7463 5f74         self.tc_t
-0005ca90: 6f5f 6763 5f6d 6170 7320 3d20 5b73 656c  o_gc_maps = [sel
-0005caa0: 662e 7463 5f74 6f5f 6763 5f6d 6170 735b  f.tc_to_gc_maps[
-0005cab0: 6b5d 2066 6f72 206b 2069 6e20 6f64 725d  k] for k in odr]
-0005cac0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0005cad0: 2020 7365 6c66 2e74 645f 6c73 7420 3d20    self.td_lst = 
-0005cae0: 736f 7274 5f64 6573 6372 6970 746f 725f  sort_descriptor_
-0005caf0: 6c73 7428 7365 6c66 2e74 645f 6c73 742c  lst(self.td_lst,
-0005cb00: 2072 6566 203d 2027 706f 7327 290a 2020   ref = 'pos').  
-0005cb10: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0005cb20: 2027 2727 0a0a 2020 2020 6465 6620 6765   '''..    def ge
-0005cb30: 745f 7469 6473 2873 656c 6629 3a0a 2020  t_tids(self):.  
-0005cb40: 2020 2020 2020 7469 6473 203d 205b 5d0a        tids = [].
-0005cb50: 2020 2020 2020 2020 666f 7220 7464 2069          for td i
-0005cb60: 6e20 7365 6c66 2e74 645f 6c73 743a 0a20  n self.td_lst:. 
-0005cb70: 2020 2020 2020 2020 2020 2074 6964 732e             tids.
-0005cb80: 6170 7065 6e64 2874 642e 7469 6429 0a20  append(td.tid). 
-0005cb90: 2020 2020 2020 2072 6574 7572 6e20 7469         return ti
-0005cba0: 6473 0a20 2020 2020 2020 200a 2020 2020  ds.        .    
-0005cbb0: 6465 6620 6765 745f 746f 7461 6c5f 6162  def get_total_ab
-0005cbc0: 6e28 2073 656c 6620 293a 0a20 2020 2020  n( self ):.     
-0005cbd0: 2020 200a 2020 2020 2020 2020 745f 6162     .        t_ab
-0005cbe0: 6e20 3d20 300a 2020 2020 2020 2020 666f  n = 0.        fo
-0005cbf0: 7220 7464 2069 6e20 7365 6c66 2e74 645f  r td in self.td_
-0005cc00: 6c73 743a 200a 2020 2020 2020 2020 2020  lst: .          
-0005cc10: 2020 6966 2074 642e 6162 6e20 3e20 303a    if td.abn > 0:
-0005cc20: 2074 5f61 626e 202b 3d20 7464 2e61 626e   t_abn += td.abn
-0005cc30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0005cc40: 745f 6162 6e0a 2020 2020 0a20 2020 2064  t_abn.    .    d
-0005cc50: 6566 2073 6574 5f74 725f 696e 666f 2820  ef set_tr_info( 
-0005cc60: 7365 6c66 2c20 6e66 2029 3a0a 2020 2020  self, nf ):.    
-0005cc70: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
-0005cc80: 6c65 6e28 7365 6c66 2e74 645f 6c73 7429  len(self.td_lst)
-0005cc90: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0005cca0: 2020 2320 6e66 203d 2031 3030 3030 3030    # nf = 1000000
-0005ccb0: 2f74 5f61 626e 0a20 2020 2020 2020 2020  /t_abn.         
-0005ccc0: 2020 2074 6964 7320 3d20 5b5d 0a20 2020     tids = [].   
-0005ccd0: 2020 2020 2020 2020 2066 6f72 2074 6420           for td 
-0005cce0: 696e 2073 656c 662e 7464 5f6c 7374 3a20  in self.td_lst: 
-0005ccf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005cd00: 2069 6620 7464 2e61 626e 203e 3d20 303a   if td.abn >= 0:
-0005cd10: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0005cd20: 2020 2020 2020 7464 2e74 706d 203d 2074        td.tpm = t
-0005cd30: 642e 6162 6e2a 6e66 0a20 2020 2020 2020  d.abn*nf.       
-0005cd40: 2020 2020 2020 2020 2020 2020 2074 6964               tid
-0005cd50: 732e 6170 7065 6e64 2874 642e 7469 6429  s.append(td.tid)
-0005cd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005cd70: 200a 2020 2020 2020 2020 2020 2020 7469   .            ti
-0005cd80: 6473 5f75 6e69 7175 6520 3d20 6c69 7374  ds_unique = list
-0005cd90: 2873 6574 2874 6964 7329 290a 2020 2020  (set(tids)).    
-0005cda0: 2020 2020 2020 2020 6966 2028 6c65 6e28          if (len(
-0005cdb0: 7469 6473 5f75 6e69 7175 6529 203d 3d20  tids_unique) == 
-0005cdc0: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-0005cdd0: 2020 2020 6966 2028 7469 6473 5f75 6e69      if (tids_uni
-0005cde0: 7175 655b 305d 203d 3d20 2727 293a 0a20  que[0] == ''):. 
-0005cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ce00: 2020 2074 6964 7320 3d20 5b5d 0a20 2020     tids = [].   
-0005ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ce20: 2066 6f72 2074 6420 696e 2073 656c 662e   for td in self.
-0005ce30: 7464 5f6c 7374 3a20 0a20 2020 2020 2020  td_lst: .       
+0005bc10: 2020 7464 2e65 6e64 203d 202d 310a 2020    td.end = -1.  
+0005bc20: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0005bc30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0005bc40: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
+0005bc50: 616e 203d 2072 6567 696f 6e28 7365 6c66  an = region(self
+0005bc60: 2e63 6872 2c20 302c 2030 2c20 274d 2729  .chr, 0, 0, 'M')
+0005bc70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0005bc80: 7572 6e20 7365 6c66 2e73 7061 6e0a 0a20  urn self.span.. 
+0005bc90: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
+0005bca0: 6765 745f 7464 5f73 7061 6e28 7365 6c66  get_td_span(self
+0005bcb0: 2c6e 293a 0a20 2020 2020 2020 2069 6620  ,n):.        if 
+0005bcc0: 6e20 3c20 6c65 6e28 7365 6c66 2e74 655f  n < len(self.te_
+0005bcd0: 746f 5f67 655f 6d61 7073 293a 0a20 2020  to_ge_maps):.   
+0005bce0: 2020 2020 2020 2020 2074 676d 203d 2073           tgm = s
+0005bcf0: 656c 662e 7465 5f74 6f5f 6765 5f6d 6170  elf.te_to_ge_map
+0005bd00: 735b 6e5d 0a20 2020 2020 2020 2020 2020  s[n].           
+0005bd10: 2069 6620 6c65 6e28 7467 6d29 203e 2030   if len(tgm) > 0
+0005bd20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005bd30: 2020 636e 7420 3d20 300a 2020 2020 2020    cnt = 0.      
+0005bd40: 2020 2020 2020 2020 2020 666f 7220 6d20            for m 
+0005bd50: 696e 2074 676d 3a0a 2020 2020 2020 2020  in tgm:.        
+0005bd60: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0005bd70: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
+0005bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bd90: 2073 203d 2073 656c 662e 6578 6f6e 732e   s = self.exons.
+0005bda0: 7267 6e73 5b6d 5d2e 7374 6172 740a 2020  rgns[m].start.  
+0005bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bdc0: 2020 2020 2020 6520 3d20 7365 6c66 2e65        e = self.e
+0005bdd0: 786f 6e73 2e72 676e 735b 6d5d 2e65 6e64  xons.rgns[m].end
+0005bde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005bdf0: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
+0005be00: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0005be10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0005be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005be30: 2020 2020 7320 3d20 6d69 6e28 732c 2073      s = min(s, s
+0005be40: 656c 662e 6578 6f6e 732e 7267 6e73 5b6d  elf.exons.rgns[m
+0005be50: 5d2e 7374 6172 7429 0a20 2020 2020 2020  ].start).       
+0005be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005be70: 2065 203d 206d 6178 2865 2c20 7365 6c66   e = max(e, self
+0005be80: 2e65 786f 6e73 2e72 676e 735b 6d5d 2e65  .exons.rgns[m].e
+0005be90: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
+0005bea0: 2020 2020 6966 2063 6e74 203d 3d20 303a      if cnt == 0:
+0005beb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005bec0: 2020 2020 2072 6574 7572 6e20 7265 6769       return regi
+0005bed0: 6f6e 2873 656c 662e 6368 722c 2030 2c20  on(self.chr, 0, 
+0005bee0: 302c 2027 4d27 290a 2020 2020 2020 2020  0, 'M').        
+0005bef0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0005bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bf10: 2020 7265 7475 726e 2072 6567 696f 6e28    return region(
+0005bf20: 7365 6c66 2e63 6872 2c20 732c 2065 2c20  self.chr, s, e, 
+0005bf30: 274d 2729 2020 2020 0a20 2020 2020 2020  'M')    .       
+0005bf40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0005bf50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0005bf60: 6e20 7265 6769 6f6e 2873 656c 662e 6368  n region(self.ch
+0005bf70: 722c 2030 2c20 302c 2027 4d27 2920 2020  r, 0, 0, 'M')   
+0005bf80: 200a 2020 2020 2020 2020 656c 7365 3a0a   .        else:.
+0005bf90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0005bfa0: 726e 2072 6567 696f 6e28 7365 6c66 2e63  rn region(self.c
+0005bfb0: 6872 2c20 302c 2030 2c20 274d 2729 0a0a  hr, 0, 0, 'M')..
+0005bfc0: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
+0005bfd0: 206d 6572 6765 2873 656c 662c 2067 6429   merge(self, gd)
+0005bfe0: 3a0a 0a20 2020 2020 2020 2069 6620 286c  :..        if (l
+0005bff0: 656e 2867 642e 6578 6f6e 732e 7267 6e73  en(gd.exons.rgns
+0005c000: 2920 3e20 3029 2026 2028 6764 2e6e 7472  ) > 0) & (gd.ntr
+0005c010: 203e 2030 293a 0a20 2020 2020 2020 2020   > 0):.         
+0005c020: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0005c030: 2323 206d 6572 6765 2065 786f 6e73 0a20  ## merge exons. 
+0005c040: 2020 2020 2020 2020 2020 2069 6d61 705f             imap_
+0005c050: 6520 3d20 7b6b 3a20 2d31 2066 6f72 206b  e = {k: -1 for k
+0005c060: 2069 6e20 7261 6e67 6528 6c65 6e28 6764   in range(len(gd
+0005c070: 2e65 786f 6e73 2e72 676e 7329 297d 0a0a  .exons.rgns))}..
+0005c080: 2020 2020 2020 2020 2020 2020 6e65 203d              ne =
+0005c090: 206c 656e 2873 656c 662e 6578 6f6e 732e   len(self.exons.
+0005c0a0: 7267 6e73 290a 2020 2020 2020 2020 2020  rgns).          
+0005c0b0: 2020 6e65 775f 636e 7420 3d20 300a 2020    new_cnt = 0.  
+0005c0c0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
+0005c0d0: 2072 2069 6e20 656e 756d 6572 6174 6528   r in enumerate(
+0005c0e0: 6764 2e65 786f 6e73 2e72 676e 7329 3a0a  gd.exons.rgns):.
+0005c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c100: 696d 6170 5f65 5b6b 5d20 3d20 6e65 202b  imap_e[k] = ne +
+0005c110: 206e 6577 5f63 6e74 0a20 2020 2020 2020   new_cnt.       
+0005c120: 2020 2020 2020 2020 2066 6f72 206d 2c20           for m, 
+0005c130: 6720 696e 2065 6e75 6d65 7261 7465 2873  g in enumerate(s
+0005c140: 656c 662e 6578 6f6e 732e 7267 6e73 293a  elf.exons.rgns):
+0005c150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005c160: 2020 2020 2069 6620 722e 6973 5f74 6865       if r.is_the
+0005c170: 5f73 616d 655f 6173 2867 293a 0a20 2020  _same_as(g):.   
+0005c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c190: 2020 2020 2069 6d61 705f 655b 6b5d 203d       imap_e[k] =
+0005c1a0: 206d 0a20 2020 2020 2020 2020 2020 2020   m.             
+0005c1b0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0005c1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005c1d0: 2069 6620 696d 6170 5f65 5b6b 5d20 3d3d   if imap_e[k] ==
+0005c1e0: 2028 6e65 202b 206e 6577 5f63 6e74 293a   (ne + new_cnt):
+0005c1f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0005c200: 2020 2020 2020 6e65 775f 636e 7420 2b3d        new_cnt +=
+0005c210: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0005c220: 2020 2020 2020 2073 656c 662e 6578 6f6e         self.exon
+0005c230: 732e 7267 6e73 2e61 7070 656e 6428 7229  s.rgns.append(r)
+0005c240: 0a0a 2020 2020 2020 2020 2020 2020 2323  ..            ##
+0005c250: 206d 6572 6765 2063 6473 730a 2020 2020   merge cdss.    
+0005c260: 2020 2020 2020 2020 696d 6170 5f63 203d          imap_c =
+0005c270: 207b 6b3a 202d 3120 666f 7220 6b20 696e   {k: -1 for k in
+0005c280: 2072 616e 6765 286c 656e 2867 642e 6364   range(len(gd.cd
+0005c290: 732e 7267 6e73 2929 7d0a 0a20 2020 2020  s.rgns))}..     
+0005c2a0: 2020 2020 2020 206e 6320 3d20 6c65 6e28         nc = len(
+0005c2b0: 7365 6c66 2e63 6473 2e72 676e 7329 0a20  self.cds.rgns). 
+0005c2c0: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
+0005c2d0: 6e74 203d 2030 0a20 2020 2020 2020 2020  nt = 0.         
+0005c2e0: 2020 2066 6f72 206b 2c20 7220 696e 2065     for k, r in e
+0005c2f0: 6e75 6d65 7261 7465 2867 642e 6364 732e  numerate(gd.cds.
+0005c300: 7267 6e73 293a 0a20 2020 2020 2020 2020  rgns):.         
+0005c310: 2020 2020 2020 2069 6d61 705f 635b 6b5d         imap_c[k]
+0005c320: 203d 206e 6320 2b20 6e65 775f 636e 740a   = nc + new_cnt.
+0005c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c340: 666f 7220 6d2c 2067 2069 6e20 656e 756d  for m, g in enum
+0005c350: 6572 6174 6528 7365 6c66 2e63 6473 2e72  erate(self.cds.r
+0005c360: 676e 7329 3a0a 2020 2020 2020 2020 2020  gns):.          
+0005c370: 2020 2020 2020 2020 2020 6966 2072 2e69            if r.i
+0005c380: 735f 7468 655f 7361 6d65 5f61 7328 6729  s_the_same_as(g)
+0005c390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005c3a0: 2020 2020 2020 2020 2020 696d 6170 5f63            imap_c
+0005c3b0: 5b6b 5d20 3d20 6d0a 2020 2020 2020 2020  [k] = m.        
+0005c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c3d0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0005c3e0: 2020 2020 2020 6966 2069 6d61 705f 635b        if imap_c[
+0005c3f0: 6b5d 203d 3d20 286e 6320 2b20 6e65 775f  k] == (nc + new_
+0005c400: 636e 7429 3a20 0a20 2020 2020 2020 2020  cnt): .         
+0005c410: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
+0005c420: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0005c430: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005c440: 2e63 6473 2e72 676e 732e 6170 7065 6e64  .cds.rgns.append
+0005c450: 2872 290a 0a20 2020 2020 2020 2020 2020  (r)..           
+0005c460: 2066 6f72 206b 2c20 7467 6d5f 6520 696e   for k, tgm_e in
+0005c470: 2065 6e75 6d65 7261 7465 2867 642e 7465   enumerate(gd.te
+0005c480: 5f74 6f5f 6765 5f6d 6170 7329 3a0a 2020  _to_ge_maps):.  
+0005c490: 2020 2020 2020 2020 2020 2020 2020 7467                tg
+0005c4a0: 6d5f 6e65 775f 6520 3d20 5b5d 0a20 2020  m_new_e = [].   
+0005c4b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0005c4c0: 206d 2069 6e20 7261 6e67 6528 6c65 6e28   m in range(len(
+0005c4d0: 7467 6d5f 6529 293a 2074 676d 5f6e 6577  tgm_e)): tgm_new
+0005c4e0: 5f65 2e61 7070 656e 6428 696d 6170 5f65  _e.append(imap_e
+0005c4f0: 5b74 676d 5f65 5b6d 5d5d 290a 0a20 2020  [tgm_e[m]])..   
+0005c500: 2020 2020 2020 2020 2020 2020 2074 676d               tgm
+0005c510: 5f63 203d 2067 642e 7463 5f74 6f5f 6763  _c = gd.tc_to_gc
+0005c520: 5f6d 6170 735b 6b5d 0a20 2020 2020 2020  _maps[k].       
+0005c530: 2020 2020 2020 2020 2074 676d 5f6e 6577           tgm_new
+0005c540: 5f63 203d 205b 5d0a 2020 2020 2020 2020  _c = [].        
+0005c550: 2020 2020 2020 2020 666f 7220 6d20 696e          for m in
+0005c560: 2072 616e 6765 286c 656e 2874 676d 5f63   range(len(tgm_c
+0005c570: 2929 3a20 7467 6d5f 6e65 775f 632e 6170  )): tgm_new_c.ap
+0005c580: 7065 6e64 2869 6d61 705f 635b 7467 6d5f  pend(imap_c[tgm_
+0005c590: 635b 6d5d 5d29 0a0a 2020 2020 2020 2020  c[m]])..        
+0005c5a0: 2020 2020 2020 2020 7365 6c66 2e74 655f          self.te_
+0005c5b0: 746f 5f67 655f 6d61 7073 2e61 7070 656e  to_ge_maps.appen
+0005c5c0: 6428 7467 6d5f 6e65 775f 6529 0a20 2020  d(tgm_new_e).   
+0005c5d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005c5e0: 662e 7463 5f74 6f5f 6763 5f6d 6170 732e  f.tc_to_gc_maps.
+0005c5f0: 6170 7065 6e64 2874 676d 5f6e 6577 5f63  append(tgm_new_c
+0005c600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0005c610: 2020 6764 2e74 645f 6c73 745b 6b5d 2e74    gd.td_lst[k].t
+0005c620: 655f 746f 5f67 655f 6d61 7020 3d20 636f  e_to_ge_map = co
+0005c630: 7079 2e64 6565 7063 6f70 7928 7467 6d5f  py.deepcopy(tgm_
+0005c640: 6e65 775f 6529 0a20 2020 2020 2020 2020  new_e).         
+0005c650: 2020 2020 2020 2067 642e 7464 5f6c 7374         gd.td_lst
+0005c660: 5b6b 5d2e 7463 5f74 6f5f 6763 5f6d 6170  [k].tc_to_gc_map
+0005c670: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0005c680: 2874 676d 5f6e 6577 5f63 290a 2020 2020  (tgm_new_c).    
+0005c690: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005c6a0: 2e74 645f 6c73 742e 6170 7065 6e64 2867  .td_lst.append(g
+0005c6b0: 642e 7464 5f6c 7374 5b6b 5d29 0a0a 2020  d.td_lst[k])..  
+0005c6c0: 2020 2020 2020 2020 2020 2323 230a 2020            ###.  
+0005c6d0: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
+0005c6e0: 7472 203d 206c 656e 2873 656c 662e 7465  tr = len(self.te
+0005c6f0: 5f74 6f5f 6765 5f6d 6170 7329 0a20 2020  _to_ge_maps).   
+0005c700: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
+0005c710: 5f74 6f5f 6772 5f6d 6170 7320 3d20 5b5b  _to_gr_maps = [[
+0005c720: 5d20 666f 7220 6b20 696e 2072 616e 6765  ] for k in range
+0005c730: 2873 656c 662e 6e74 7229 5d0a 0a20 2020  (self.ntr)]..   
+0005c740: 2020 2020 2020 2020 206e 5f63 6872 5f64           n_chr_d
+0005c750: 6966 6620 3d20 300a 2020 2020 2020 2020  iff = 0.        
+0005c760: 2020 2020 666f 7220 6b2c 2074 6420 696e      for k, td in
+0005c770: 2065 6e75 6d65 7261 7465 2867 642e 7464   enumerate(gd.td
+0005c780: 5f6c 7374 293a 0a20 2020 2020 2020 2020  _lst):.         
+0005c790: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+0005c7a0: 6872 2021 3d20 6764 2e63 6872 3a20 6e5f  hr != gd.chr: n_
+0005c7b0: 6368 725f 6469 6666 202b 3d20 310a 0a20  chr_diff += 1.. 
+0005c7c0: 2020 2020 2020 2020 2020 2069 6620 6e5f             if n_
+0005c7d0: 6368 725f 6469 6666 203e 2030 3a0a 2020  chr_diff > 0:.  
+0005c7e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0005c7f0: 696e 7428 2745 5252 4f52 2069 6e20 6765  int('ERROR in ge
+0005c800: 6e65 5f64 6573 6372 6970 746f 723a 3a6d  ne_descriptor::m
+0005c810: 6572 6765 3a20 6d75 6c74 6970 6c65 2063  erge: multiple c
+0005c820: 6872 6d20 6465 7465 6374 6564 2069 6e20  hrm detected in 
+0005c830: 6120 6368 756e 6b20 2825 6929 2720 2520  a chunk (%i)' % 
+0005c840: 6e5f 6368 725f 6469 6666 290a 0a20 2020  n_chr_diff)..   
+0005c850: 2027 2727 0a20 2020 2064 6566 206f 7264   '''.    def ord
+0005c860: 6572 2873 656c 6629 3a0a 2020 2020 2020  er(self):.      
+0005c870: 2020 0a20 2020 2020 2020 2073 7073 203d    .        sps =
+0005c880: 206e 702e 7a65 726f 7328 7365 6c66 2e6e   np.zeros(self.n
+0005c890: 7472 290a 2020 2020 2020 2020 666f 7220  tr).        for 
+0005c8a0: 6e20 696e 2072 616e 6765 2873 656c 662e  n in range(self.
+0005c8b0: 6e74 7229 3a0a 2020 2020 2020 2020 2020  ntr):.          
+0005c8c0: 2020 7370 616e 203d 2073 656c 662e 6765    span = self.ge
+0005c8d0: 745f 7464 5f73 7061 6e28 6e29 0a20 2020  t_td_span(n).   
+0005c8e0: 2020 2020 2020 2020 2073 7073 5b6e 5d20           sps[n] 
+0005c8f0: 3d20 7370 616e 2e73 7461 7274 0a20 2020  = span.start.   
+0005c900: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0005c910: 2020 6f64 7220 3d20 7370 732e 6172 6773    odr = sps.args
+0005c920: 6f72 7428 290a 2020 2020 2020 2020 7365  ort().        se
+0005c930: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
+0005c940: 203d 205b 7365 6c66 2e74 655f 746f 5f67   = [self.te_to_g
+0005c950: 655f 6d61 7073 5b6b 5d20 666f 7220 6b20  e_maps[k] for k 
+0005c960: 696e 206f 6472 5d0a 2020 2020 2020 2020  in odr].        
+0005c970: 7365 6c66 2e74 725f 746f 5f67 725f 6d61  self.tr_to_gr_ma
+0005c980: 7073 203d 205b 7365 6c66 2e74 725f 746f  ps = [self.tr_to
+0005c990: 5f67 725f 6d61 7073 5b6b 5d20 666f 7220  _gr_maps[k] for 
+0005c9a0: 6b20 696e 206f 6472 5d0a 2020 2020 2020  k in odr].      
+0005c9b0: 2020 7365 6c66 2e74 635f 746f 5f67 635f    self.tc_to_gc_
+0005c9c0: 6d61 7073 203d 205b 7365 6c66 2e74 635f  maps = [self.tc_
+0005c9d0: 746f 5f67 635f 6d61 7073 5b6b 5d20 666f  to_gc_maps[k] fo
+0005c9e0: 7220 6b20 696e 206f 6472 5d0a 2020 2020  r k in odr].    
+0005c9f0: 2020 2020 0a20 2020 2020 2020 2073 656c      .        sel
+0005ca00: 662e 7464 5f6c 7374 203d 2073 6f72 745f  f.td_lst = sort_
+0005ca10: 6465 7363 7269 7074 6f72 5f6c 7374 2873  descriptor_lst(s
+0005ca20: 656c 662e 7464 5f6c 7374 2c20 7265 6620  elf.td_lst, ref 
+0005ca30: 3d20 2770 6f73 2729 0a20 2020 2020 2020  = 'pos').       
+0005ca40: 2072 6574 7572 6e0a 2020 2020 2727 270a   return.    '''.
+0005ca50: 0a20 2020 2064 6566 2067 6574 5f74 6964  .    def get_tid
+0005ca60: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0005ca70: 2074 6964 7320 3d20 5b5d 0a20 2020 2020   tids = [].     
+0005ca80: 2020 2066 6f72 2074 6420 696e 2073 656c     for td in sel
+0005ca90: 662e 7464 5f6c 7374 3a0a 2020 2020 2020  f.td_lst:.      
+0005caa0: 2020 2020 2020 7469 6473 2e61 7070 656e        tids.appen
+0005cab0: 6428 7464 2e74 6964 290a 2020 2020 2020  d(td.tid).      
+0005cac0: 2020 7265 7475 726e 2074 6964 730a 2020    return tids.  
+0005cad0: 2020 2020 2020 0a20 2020 2064 6566 2067        .    def g
+0005cae0: 6574 5f74 6f74 616c 5f61 626e 2820 7365  et_total_abn( se
+0005caf0: 6c66 2029 3a0a 2020 2020 2020 2020 0a20  lf ):.        . 
+0005cb00: 2020 2020 2020 2074 5f61 626e 203d 2030         t_abn = 0
+0005cb10: 0a20 2020 2020 2020 2066 6f72 2074 6420  .        for td 
+0005cb20: 696e 2073 656c 662e 7464 5f6c 7374 3a20  in self.td_lst: 
+0005cb30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0005cb40: 7464 2e61 626e 203e 2030 3a20 745f 6162  td.abn > 0: t_ab
+0005cb50: 6e20 2b3d 2074 642e 6162 6e0a 2020 2020  n += td.abn.    
+0005cb60: 2020 2020 7265 7475 726e 2074 5f61 626e      return t_abn
+0005cb70: 0a20 2020 200a 2020 2020 6465 6620 7365  .    .    def se
+0005cb80: 745f 7472 5f69 6e66 6f28 2073 656c 662c  t_tr_info( self,
+0005cb90: 206e 6620 293a 0a20 2020 2020 2020 200a   nf ):.        .
+0005cba0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+0005cbb0: 656c 662e 7464 5f6c 7374 2920 3e20 303a  elf.td_lst) > 0:
+0005cbc0: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
+0005cbd0: 6620 3d20 3130 3030 3030 302f 745f 6162  f = 1000000/t_ab
+0005cbe0: 6e0a 2020 2020 2020 2020 2020 2020 7469  n.            ti
+0005cbf0: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
+0005cc00: 2020 2020 666f 7220 7464 2069 6e20 7365      for td in se
+0005cc10: 6c66 2e74 645f 6c73 743a 200a 2020 2020  lf.td_lst: .    
+0005cc20: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+0005cc30: 642e 6162 6e20 3e3d 2030 3a20 0a20 2020  d.abn >= 0: .   
+0005cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005cc50: 2074 642e 7470 6d20 3d20 7464 2e61 626e   td.tpm = td.abn
+0005cc60: 2a6e 660a 2020 2020 2020 2020 2020 2020  *nf.            
+0005cc70: 2020 2020 2020 2020 7469 6473 2e61 7070          tids.app
+0005cc80: 656e 6428 7464 2e74 6964 290a 2020 2020  end(td.tid).    
+0005cc90: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0005cca0: 2020 2020 2020 2020 2074 6964 735f 756e           tids_un
+0005ccb0: 6971 7565 203d 206c 6973 7428 7365 7428  ique = list(set(
+0005ccc0: 7469 6473 2929 0a20 2020 2020 2020 2020  tids)).         
+0005ccd0: 2020 2069 6620 286c 656e 2874 6964 735f     if (len(tids_
+0005cce0: 756e 6971 7565 2920 3d3d 2031 293a 0a20  unique) == 1):. 
+0005ccf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0005cd00: 6620 2874 6964 735f 756e 6971 7565 5b30  f (tids_unique[0
+0005cd10: 5d20 3d3d 2027 2729 3a0a 2020 2020 2020  ] == ''):.      
+0005cd20: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0005cd30: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
+0005cd40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005cd50: 7464 2069 6e20 7365 6c66 2e74 645f 6c73  td in self.td_ls
+0005cd60: 743a 200a 2020 2020 2020 2020 2020 2020  t: .            
+0005cd70: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+0005cd80: 642e 6162 6e20 3e3d 2030 3a20 0a20 2020  d.abn >= 0: .   
+0005cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005cda0: 2020 2020 2020 2020 2074 6964 732e 6170           tids.ap
+0005cdb0: 7065 6e64 2874 642e 746e 616d 6529 0a20  pend(td.tname). 
+0005cdc0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0005cdd0: 2020 2020 2020 2020 2020 2020 7469 6473              tids
+0005cde0: 203d 206e 702e 6172 7261 7928 7469 6473   = np.array(tids
+0005cdf0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0005ce00: 7220 7469 6420 696e 2074 6964 735f 756e  r tid in tids_un
+0005ce10: 6971 7565 3a0a 2020 2020 2020 2020 2020  ique:.          
+0005ce20: 2020 2020 2020 7768 203d 2077 6869 6368        wh = which
+0005ce30: 2820 7469 6473 203d 3d20 7469 6420 290a  ( tids == tid ).
 0005ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ce50: 2069 6620 7464 2e61 626e 203e 3d20 303a   if td.abn >= 0:
-0005ce60: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0005ce70: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0005ce80: 6473 2e61 7070 656e 6428 7464 2e74 6e61  ds.append(td.tna
-0005ce90: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0005cea0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0005ceb0: 2074 6964 7320 3d20 6e70 2e61 7272 6179   tids = np.array
-0005cec0: 2874 6964 7329 0a20 2020 2020 2020 2020  (tids).         
-0005ced0: 2020 2066 6f72 2074 6964 2069 6e20 7469     for tid in ti
-0005cee0: 6473 5f75 6e69 7175 653a 0a20 2020 2020  ds_unique:.     
-0005cef0: 2020 2020 2020 2020 2020 2077 6820 3d20             wh = 
-0005cf00: 7768 6963 6828 2074 6964 7320 3d3d 2074  which( tids == t
-0005cf10: 6964 2029 0a20 2020 2020 2020 2020 2020  id ).           
-0005cf20: 2020 2020 2074 706d 5f73 756d 203d 2030       tpm_sum = 0
-0005cf30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005cf40: 2066 6f72 2077 2069 6e20 7768 3a0a 2020   for w in wh:.  
-0005cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005cf60: 2020 6966 2073 656c 662e 7464 5f6c 7374    if self.td_lst
-0005cf70: 5b77 5d2e 6162 6e20 3e3d 2030 3a20 7470  [w].abn >= 0: tp
-0005cf80: 6d5f 7375 6d20 2b3d 2073 656c 662e 7464  m_sum += self.td
-0005cf90: 5f6c 7374 5b77 5d2e 7470 6d0a 2020 2020  _lst[w].tpm.    
-0005cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005cfb0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0005cfc0: 2020 2020 2069 6620 7470 6d5f 7375 6d20       if tpm_sum 
-0005cfd0: 3d3d 2030 3a20 7470 6d5f 7375 6d20 3d20  == 0: tpm_sum = 
-0005cfe0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-0005cff0: 2020 666f 7220 6d2c 2077 2069 6e20 656e    for m, w in en
-0005d000: 756d 6572 6174 6528 7768 293a 0a20 2020  umerate(wh):.   
-0005d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d020: 2069 6620 7365 6c66 2e74 645f 6c73 745b   if self.td_lst[
-0005d030: 775d 2e61 626e 203e 3d20 303a 200a 2020  w].abn >= 0: .  
-0005d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d050: 2020 2020 2020 7365 6c66 2e74 645f 6c73        self.td_ls
-0005d060: 745b 775d 2e69 736f 5f66 7261 6320 3d20  t[w].iso_frac = 
-0005d070: 7365 6c66 2e74 645f 6c73 745b 775d 2e74  self.td_lst[w].t
-0005d080: 706d 2f74 706d 5f73 756d 0a20 2020 2020  pm/tpm_sum.     
-0005d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d0a0: 2020 2073 656c 662e 7464 5f6c 7374 5b77     self.td_lst[w
-0005d0b0: 5d2e 6772 705f 7369 7a65 203d 206c 656e  ].grp_size = len
-0005d0c0: 2877 6829 0a20 2020 2020 2020 2020 2020  (wh).           
-0005d0d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0005d0e0: 662e 7464 5f6c 7374 5b77 5d2e 6963 6e74  f.td_lst[w].icnt
-0005d0f0: 203d 206d 0a20 2020 2020 2020 2020 2020   = m.           
-0005d100: 2020 2020 200a 2020 2020 0a20 2020 2064       .    .    d
-0005d110: 6566 2072 656d 6f76 655f 696e 6465 6c5f  ef remove_indel_
-0005d120: 616e 645f 636f 6d62 696e 655f 6672 6167  and_combine_frag
-0005d130: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0005d140: 200a 2020 2020 2020 2020 2323 2072 656d   .        ## rem
-0005d150: 6f76 6520 2764 656c 6574 696f 6e27 2061  ove 'deletion' a
-0005d160: 6e64 0a20 2020 2020 2020 2023 2320 7265  nd.        ## re
-0005d170: 6e61 6d65 2027 696e 7365 7273 696f 6e27  name 'insersion'
-0005d180: 2074 6f20 2765 786f 6e27 0a20 2020 2020   to 'exon'.     
-0005d190: 2020 2066 6f72 206b 2069 6e20 7265 7665     for k in reve
-0005d1a0: 7273 6564 2872 616e 6765 286c 656e 2873  rsed(range(len(s
-0005d1b0: 656c 662e 6578 6f6e 732e 7267 6e73 2929  elf.exons.rgns))
-0005d1c0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0005d1d0: 203d 2073 656c 662e 6578 6f6e 732e 7267   = self.exons.rg
-0005d1e0: 6e73 5b6b 5d0a 2020 2020 2020 2020 2020  ns[k].          
-0005d1f0: 2020 6966 2072 2e74 7970 6520 3d3d 2027    if r.type == '
-0005d200: 6465 6c65 7469 6f6e 273a 0a20 2020 2020  deletion':.     
-0005d210: 2020 2020 2020 2020 2020 2064 656c 2073             del s
-0005d220: 656c 662e 6578 6f6e 732e 7267 6e73 5b6b  elf.exons.rgns[k
-0005d230: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0005d240: 2020 666f 7220 6d2c 2074 676d 2069 6e20    for m, tgm in 
-0005d250: 656e 756d 6572 6174 6528 7365 6c66 2e74  enumerate(self.t
-0005d260: 655f 746f 5f67 655f 6d61 7073 293a 0a20  e_to_ge_maps):. 
-0005d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d280: 2020 2069 6620 6b20 696e 2074 676d 3a0a     if k in tgm:.
-0005d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d2a0: 2020 2020 2020 2020 7467 6d2e 7265 6d6f          tgm.remo
-0005d2b0: 7665 286b 290a 2020 2020 2020 2020 2020  ve(k).          
-0005d2c0: 2020 2020 2020 2020 2020 7467 6d20 3d20            tgm = 
-0005d2d0: 6e70 2e61 7272 6179 2874 676d 290a 2020  np.array(tgm).  
-0005d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d2f0: 2020 7467 6d5b 7467 6d20 3e20 6b5d 202d    tgm[tgm > k] -
-0005d300: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0005d310: 2020 2020 2020 2020 7365 6c66 2e74 655f          self.te_
-0005d320: 746f 5f67 655f 6d61 7073 5b6d 5d20 3d20  to_ge_maps[m] = 
-0005d330: 6c69 7374 2874 676d 290a 2020 2020 2020  list(tgm).      
-0005d340: 2020 2020 2020 656c 6966 2072 2e74 7970        elif r.typ
-0005d350: 6520 3d3d 2027 696e 7365 7273 696f 6e27  e == 'insersion'
-0005d360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0005d370: 2020 7365 6c66 2e65 786f 6e73 2e72 676e    self.exons.rgn
-0005d380: 735b 6b5d 2e74 7970 6520 3d20 2765 786f  s[k].type = 'exo
-0005d390: 6e27 2023 2027 4558 4f4e 270a 2020 2020  n' # 'EXON'.    
-0005d3a0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0005d3b0: 2020 2020 2023 2320 6f70 7469 6f6e 616c       ## optional
-0005d3c0: 6c79 2063 6f6d 6269 6e65 2066 7261 676d  ly combine fragm
-0005d3d0: 656e 7473 0a20 2020 2020 2020 200a 2020  ents.        .  
-0005d3e0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0005d3f0: 200a 2020 2020 6465 6620 7570 6461 7465   .    def update
-0005d400: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0005d410: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-0005d420: 6e20 7365 6c66 2e72 676e 732e 7267 6e73  n self.rgns.rgns
-0005d430: 3a0a 2020 2020 2020 2020 2020 2020 722e  :.            r.
-0005d440: 6765 745f 6376 6728 290a 2020 2020 2020  get_cvg().      
-0005d450: 2020 2020 2020 722e 6765 745f 636f 765f        r.get_cov_
-0005d460: 6c65 6e28 290a 2020 2020 2020 2020 0a20  len().        . 
-0005d470: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0005d480: 2020 2020 2727 270a 2020 2020 5472 616e      '''.    Tran
-0005d490: 7363 7269 7074 203d 2063 6f6c 6c65 6374  script = collect
-0005d4a0: 696f 6e73 2e6e 616d 6564 7475 706c 6528  ions.namedtuple(
-0005d4b0: 2754 7261 6e73 6372 6970 7427 2c20 5c0a  'Transcript', \.
-0005d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d4e0: 2020 2020 2020 2020 2770 7265 6669 782c          'prefix,
-0005d4f0: 2067 6964 782c 2067 7270 5f73 697a 652c   gidx, grp_size,
-0005d500: 2069 636e 742c 2063 6872 2c20 7374 6172   icnt, chr, star
-0005d510: 742c 2065 6e64 2c20 5c0a 2020 2020 2020  t, end, \.      
-0005d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d540: 2020 2073 7472 616e 642c 2063 646e 672c     strand, cdng,
-0005d550: 2073 6571 2c20 6162 6e2c 2074 706d 2c20   seq, abn, tpm, 
-0005d560: 6973 6f5f 6672 6163 2c20 7072 6f62 2c20  iso_frac, prob, 
-0005d570: 6e65 7873 2c20 6776 6f6c 2729 0a0a 2020  nexs, gvol')..  
-0005d580: 2020 6465 6620 6765 745f 7472 616e 7363    def get_transc
-0005d590: 7269 7074 5f74 7570 6c65 2873 656c 6629  ript_tuple(self)
-0005d5a0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0005d5b0: 2054 7261 6e73 6372 6970 7428 7365 6c66   Transcript(self
-0005d5c0: 2e70 7265 6669 782c 2073 656c 662e 6769  .prefix, self.gi
-0005d5d0: 642c 2073 656c 662e 6772 705f 7369 7a65  d, self.grp_size
-0005d5e0: 2c20 7365 6c66 2e69 636e 742c 2073 656c  , self.icnt, sel
-0005d5f0: 662e 6368 722c 2073 656c 662e 6265 6769  f.chr, self.begi
-0005d600: 6e2c 2073 656c 662e 656e 642c 205c 0a20  n, self.end, \. 
-0005d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d620: 2020 2020 2020 2020 2067 6574 5f63 5f66           get_c_f
-0005d630: 726f 6d5f 6973 7472 616e 6428 7365 6c66  rom_istrand(self
-0005d640: 2e69 7374 7261 6e64 292c 2067 6574 5f73  .istrand), get_s
-0005d650: 7472 5f66 726f 6d5f 6963 646e 6728 7365  tr_from_icdng(se
-0005d660: 6c66 2e69 6364 7329 2c20 7365 6c66 2e74  lf.icds), self.t
-0005d670: 7365 712c 205c 0a20 2020 2020 2020 2020  seq, \.         
-0005d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d690: 2073 656c 662e 6162 6e2c 2073 656c 662e   self.abn, self.
-0005d6a0: 7470 6d2c 2073 656c 662e 6973 6f5f 6672  tpm, self.iso_fr
-0005d6b0: 6163 2c20 7365 6c66 2e70 726f 622c 2073  ac, self.prob, s
-0005d6c0: 656c 662e 6e65 786f 6e73 2c20 7365 6c66  elf.nexons, self
-0005d6d0: 2e67 766f 6c29 0a0a 2020 2020 2727 270a  .gvol)..    '''.
-0005d6e0: 2020 2020 6465 6620 7570 6461 7465 5f74      def update_t
-0005d6f0: 645f 696e 666f 2873 656c 662c 2067 656e  d_info(self, gen
-0005d700: 6f6d 6520 3d20 4e6f 6e65 2c20 7365 6c20  ome = None, sel 
-0005d710: 3d20 302c 2070 6570 7469 6465 203d 2046  = 0, peptide = F
-0005d720: 616c 7365 293a 0a0a 2020 2020 2020 2020  alse):..        
-0005d730: 6966 206c 656e 2873 656c 662e 7464 5f6c  if len(self.td_l
-0005d740: 7374 2920 3e20 303a 0a20 2020 2020 2020  st) > 0:.       
-0005d750: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0005d760: 2020 6776 6f6c 203d 2030 0a20 2020 2020    gvol = 0.     
-0005d770: 2020 2020 2020 2069 6620 7365 6c20 3d3d         if sel ==
-0005d780: 2030 3a20 0a20 2020 2020 2020 2020 2020   0: .           
-0005d790: 2020 2020 2073 656c 662e 7267 6e73 2e73       self.rgns.s
-0005d7a0: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
-0005d7b0: 2020 2020 2020 2020 2066 6d20 3d20 7b27           fm = {'
-0005d7c0: 4d27 3a20 2765 786f 6e27 2c20 2749 273a  M': 'exon', 'I':
-0005d7d0: 2027 696e 7365 7273 696f 6e27 2c20 2744   'insersion', 'D
-0005d7e0: 273a 2027 6465 6c65 7469 6f6e 277d 0a20  ': 'deletion'}. 
-0005d7f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0005d800: 6f72 2072 2069 6e20 7365 6c66 2e72 676e  or r in self.rgn
-0005d810: 732e 7267 6e73 3a0a 2020 2020 2020 2020  s.rgns:.        
-0005d820: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0005d830: 2e74 7970 6520 696e 2066 6d2e 6b65 7973  .type in fm.keys
-0005d840: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0005d850: 2020 2020 2020 2020 2020 2020 722e 7479              r.ty
-0005d860: 7065 203d 2066 6d5b 722e 7479 7065 5d0a  pe = fm[r.type].
-0005d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d880: 7467 6d73 203d 2073 656c 662e 7472 5f74  tgms = self.tr_t
-0005d890: 6f5f 6772 5f6d 6170 730a 0a20 2020 2020  o_gr_maps..     
-0005d8a0: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-0005d8b0: 2069 6e20 7365 6c66 2e72 676e 732e 7267   in self.rgns.rg
-0005d8c0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0005d8d0: 2020 2020 2020 2020 6776 6f6c 202b 3d20          gvol += 
-0005d8e0: 6e70 2e73 756d 2872 2e63 7667 290a 2020  np.sum(r.cvg).  
-0005d8f0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0005d900: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0005d910: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0005d920: 2020 6966 2067 656e 6f6d 6520 6973 204e    if genome is N
-0005d930: 6f6e 653a 2073 656c 662e 6578 6f6e 732e  one: self.exons.
-0005d940: 7365 745f 6376 6728 290a 2020 2020 2020  set_cvg().      
-0005d950: 2020 2020 2020 2020 2020 7467 6d73 203d            tgms =
-0005d960: 2073 656c 662e 7465 5f74 6f5f 6765 5f6d   self.te_to_ge_m
-0005d970: 6170 730a 2020 2020 2020 2020 2020 2020  aps.            
-0005d980: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0005d990: 2020 2020 2074 635f 746f 5f67 635f 6d61       tc_to_gc_ma
-0005d9a0: 7073 5f6e 6577 203d 205b 5b5d 2066 6f72  ps_new = [[] for
-0005d9b0: 206b 2069 6e20 7261 6e67 6528 7365 6c66   k in range(self
-0005d9c0: 2e6e 7472 295d 0a20 2020 2020 2020 2020  .ntr)].         
-0005d9d0: 2020 2063 6473 5f6e 6577 203d 2072 6567     cds_new = reg
-0005d9e0: 696f 6e73 2829 0a20 2020 2020 2020 2020  ions().         
-0005d9f0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0005da00: 636e 745f 7420 3d20 300a 2020 2020 2020  cnt_t = 0.      
-0005da10: 2020 2020 2020 636e 745f 7020 3d20 300a        cnt_p = 0.
-0005da20: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-0005da30: 6520 3d20 300a 0a20 2020 2020 2020 2020  e = 0..         
-0005da40: 2020 2066 6f72 206b 2c20 7464 2069 6e20     for k, td in 
-0005da50: 656e 756d 6572 6174 6528 7365 6c66 2e74  enumerate(self.t
-0005da60: 645f 6c73 7429 3a0a 2020 2020 2020 2020  d_lst):.        
-0005da70: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
-0005da80: 676d 735b 6b5d 2920 3e20 303a 2020 0a20  gms[k]) > 0:  . 
-0005da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005daa0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0005dab0: 2020 2020 2020 2020 7464 2e74 725f 746f          td.tr_to
-0005dac0: 5f67 725f 6d61 7020 3d20 636f 7079 2e64  _gr_map = copy.d
-0005dad0: 6565 7063 6f70 7928 7365 6c66 2e74 725f  eepcopy(self.tr_
-0005dae0: 746f 5f67 725f 6d61 7073 5b6b 5d29 0a20  to_gr_maps[k]). 
-0005daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005db00: 2020 2074 642e 7465 5f74 6f5f 6765 5f6d     td.te_to_ge_m
-0005db10: 6170 203d 2063 6f70 792e 6465 6570 636f  ap = copy.deepco
-0005db20: 7079 2873 656c 662e 7465 5f74 6f5f 6765  py(self.te_to_ge
-0005db30: 5f6d 6170 735b 6b5d 290a 2020 2020 2020  _maps[k]).      
-0005db40: 2020 2020 2020 2020 2020 2020 2020 7464                td
-0005db50: 2e74 635f 746f 5f67 635f 6d61 7020 3d20  .tc_to_gc_map = 
-0005db60: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
-0005db70: 6c66 2e74 635f 746f 5f67 635f 6d61 7073  lf.tc_to_gc_maps
-0005db80: 5b6b 5d29 0a20 2020 2020 2020 2020 2020  [k]).           
-0005db90: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0005dba0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005dbb0: 206c 656e 2874 642e 7465 5f74 6f5f 6765   len(td.te_to_ge
-0005dbc0: 5f6d 6170 2920 3e20 303a 0a20 2020 2020  _map) > 0:.     
-0005dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dbe0: 2020 2074 7365 712c 2061 7365 712c 2063     tseq, aseq, c
-0005dbf0: 6473 2c20 6265 203d 2074 642e 7570 6461  ds, be = td.upda
-0005dc00: 7465 5f69 6e66 6f28 7365 6c66 2e65 786f  te_info(self.exo
-0005dc10: 6e73 2e72 676e 732c 2073 656c 662e 7267  ns.rgns, self.rg
-0005dc20: 6e73 2e72 676e 732c 2073 656c 662e 6364  ns.rgns, self.cd
-0005dc30: 732e 7267 6e73 2c20 5c0a 2020 2020 2020  s.rgns, \.      
-0005dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ce50: 7470 6d5f 7375 6d20 3d20 300a 2020 2020  tpm_sum = 0.    
+0005ce60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005ce70: 7720 696e 2077 683a 0a20 2020 2020 2020  w in wh:.       
+0005ce80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0005ce90: 7365 6c66 2e74 645f 6c73 745b 775d 2e61  self.td_lst[w].a
+0005cea0: 626e 203e 3d20 303a 2074 706d 5f73 756d  bn >= 0: tpm_sum
+0005ceb0: 202b 3d20 7365 6c66 2e74 645f 6c73 745b   += self.td_lst[
+0005cec0: 775d 2e74 706d 0a20 2020 2020 2020 2020  w].tpm.         
+0005ced0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0005cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005cef0: 6966 2074 706d 5f73 756d 203d 3d20 303a  if tpm_sum == 0:
+0005cf00: 2074 706d 5f73 756d 203d 2031 0a20 2020   tpm_sum = 1.   
+0005cf10: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0005cf20: 206d 2c20 7720 696e 2065 6e75 6d65 7261   m, w in enumera
+0005cf30: 7465 2877 6829 3a0a 2020 2020 2020 2020  te(wh):.        
+0005cf40: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0005cf50: 656c 662e 7464 5f6c 7374 5b77 5d2e 6162  elf.td_lst[w].ab
+0005cf60: 6e20 3e3d 2030 3a20 0a20 2020 2020 2020  n >= 0: .       
+0005cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005cf80: 2073 656c 662e 7464 5f6c 7374 5b77 5d2e   self.td_lst[w].
+0005cf90: 6973 6f5f 6672 6163 203d 2073 656c 662e  iso_frac = self.
+0005cfa0: 7464 5f6c 7374 5b77 5d2e 7470 6d2f 7470  td_lst[w].tpm/tp
+0005cfb0: 6d5f 7375 6d0a 2020 2020 2020 2020 2020  m_sum.          
+0005cfc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0005cfd0: 6c66 2e74 645f 6c73 745b 775d 2e67 7270  lf.td_lst[w].grp
+0005cfe0: 5f73 697a 6520 3d20 6c65 6e28 7768 290a  _size = len(wh).
+0005cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d000: 2020 2020 2020 2020 7365 6c66 2e74 645f          self.td_
+0005d010: 6c73 745b 775d 2e69 636e 7420 3d20 6d0a  lst[w].icnt = m.
+0005d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d030: 0a20 2020 200a 2020 2020 6465 6620 7265  .    .    def re
+0005d040: 6d6f 7665 5f69 6e64 656c 5f61 6e64 5f63  move_indel_and_c
+0005d050: 6f6d 6269 6e65 5f66 7261 6773 2873 656c  ombine_frags(sel
+0005d060: 6629 3a0a 2020 2020 2020 2020 0a20 2020  f):.        .   
+0005d070: 2020 2020 2023 2320 7265 6d6f 7665 2027       ## remove '
+0005d080: 6465 6c65 7469 6f6e 2720 616e 640a 2020  deletion' and.  
+0005d090: 2020 2020 2020 2323 2072 656e 616d 6520        ## rename 
+0005d0a0: 2769 6e73 6572 7369 6f6e 2720 746f 2027  'insersion' to '
+0005d0b0: 6578 6f6e 270a 2020 2020 2020 2020 666f  exon'.        fo
+0005d0c0: 7220 6b20 696e 2072 6576 6572 7365 6428  r k in reversed(
+0005d0d0: 7261 6e67 6528 6c65 6e28 7365 6c66 2e65  range(len(self.e
+0005d0e0: 786f 6e73 2e72 676e 7329 2929 3a0a 2020  xons.rgns))):.  
+0005d0f0: 2020 2020 2020 2020 2020 7220 3d20 7365            r = se
+0005d100: 6c66 2e65 786f 6e73 2e72 676e 735b 6b5d  lf.exons.rgns[k]
+0005d110: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0005d120: 722e 7479 7065 203d 3d20 2764 656c 6574  r.type == 'delet
+0005d130: 696f 6e27 3a0a 2020 2020 2020 2020 2020  ion':.          
+0005d140: 2020 2020 2020 6465 6c20 7365 6c66 2e65        del self.e
+0005d150: 786f 6e73 2e72 676e 735b 6b5d 0a20 2020  xons.rgns[k].   
+0005d160: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0005d170: 206d 2c20 7467 6d20 696e 2065 6e75 6d65   m, tgm in enume
+0005d180: 7261 7465 2873 656c 662e 7465 5f74 6f5f  rate(self.te_to_
+0005d190: 6765 5f6d 6170 7329 3a0a 2020 2020 2020  ge_maps):.      
+0005d1a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0005d1b0: 206b 2069 6e20 7467 6d3a 0a20 2020 2020   k in tgm:.     
+0005d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d1d0: 2020 2074 676d 2e72 656d 6f76 6528 6b29     tgm.remove(k)
+0005d1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005d1f0: 2020 2020 2074 676d 203d 206e 702e 6172       tgm = np.ar
+0005d200: 7261 7928 7467 6d29 0a20 2020 2020 2020  ray(tgm).       
+0005d210: 2020 2020 2020 2020 2020 2020 2074 676d               tgm
+0005d220: 5b74 676d 203e 206b 5d20 2d3d 2031 0a20  [tgm > k] -= 1. 
+0005d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d240: 2020 2073 656c 662e 7465 5f74 6f5f 6765     self.te_to_ge
+0005d250: 5f6d 6170 735b 6d5d 203d 206c 6973 7428  _maps[m] = list(
+0005d260: 7467 6d29 0a20 2020 2020 2020 2020 2020  tgm).           
+0005d270: 2065 6c69 6620 722e 7479 7065 203d 3d20   elif r.type == 
+0005d280: 2769 6e73 6572 7369 6f6e 273a 0a20 2020  'insersion':.   
+0005d290: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005d2a0: 662e 6578 6f6e 732e 7267 6e73 5b6b 5d2e  f.exons.rgns[k].
+0005d2b0: 7479 7065 203d 2027 6578 6f6e 2720 2320  type = 'exon' # 
+0005d2c0: 2745 584f 4e27 0a20 2020 2020 2020 2020  'EXON'.         
+0005d2d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0005d2e0: 2323 206f 7074 696f 6e61 6c6c 7920 636f  ## optionally co
+0005d2f0: 6d62 696e 6520 6672 6167 6d65 6e74 730a  mbine fragments.
+0005d300: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0005d310: 2072 6574 7572 6e0a 2020 2020 0a20 2020   return.    .   
+0005d320: 2064 6566 2075 7064 6174 6528 7365 6c66   def update(self
+0005d330: 293a 0a20 2020 2020 2020 200a 2020 2020  ):.        .    
+0005d340: 2020 2020 666f 7220 7220 696e 2073 656c      for r in sel
+0005d350: 662e 7267 6e73 2e72 676e 733a 0a20 2020  f.rgns.rgns:.   
+0005d360: 2020 2020 2020 2020 2072 2e67 6574 5f63           r.get_c
+0005d370: 7667 2829 0a20 2020 2020 2020 2020 2020  vg().           
+0005d380: 2072 2e67 6574 5f63 6f76 5f6c 656e 2829   r.get_cov_len()
+0005d390: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0005d3a0: 2020 2020 2020 2020 2020 0a20 2020 2027            .    '
+0005d3b0: 2727 0a20 2020 2054 7261 6e73 6372 6970  ''.    Transcrip
+0005d3c0: 7420 3d20 636f 6c6c 6563 7469 6f6e 732e  t = collections.
+0005d3d0: 6e61 6d65 6474 7570 6c65 2827 5472 616e  namedtuple('Tran
+0005d3e0: 7363 7269 7074 272c 205c 0a20 2020 2020  script', \.     
+0005d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d410: 2020 2027 7072 6566 6978 2c20 6769 6478     'prefix, gidx
+0005d420: 2c20 6772 705f 7369 7a65 2c20 6963 6e74  , grp_size, icnt
+0005d430: 2c20 6368 722c 2073 7461 7274 2c20 656e  , chr, start, en
+0005d440: 642c 205c 0a20 2020 2020 2020 2020 2020  d, \.           
+0005d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d460: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0005d470: 7261 6e64 2c20 6364 6e67 2c20 7365 712c  rand, cdng, seq,
+0005d480: 2061 626e 2c20 7470 6d2c 2069 736f 5f66   abn, tpm, iso_f
+0005d490: 7261 632c 2070 726f 622c 206e 6578 732c  rac, prob, nexs,
+0005d4a0: 2067 766f 6c27 290a 0a20 2020 2064 6566   gvol')..    def
+0005d4b0: 2067 6574 5f74 7261 6e73 6372 6970 745f   get_transcript_
+0005d4c0: 7475 706c 6528 7365 6c66 293a 0a20 2020  tuple(self):.   
+0005d4d0: 2020 2020 2072 6574 7572 6e20 5472 616e       return Tran
+0005d4e0: 7363 7269 7074 2873 656c 662e 7072 6566  script(self.pref
+0005d4f0: 6978 2c20 7365 6c66 2e67 6964 2c20 7365  ix, self.gid, se
+0005d500: 6c66 2e67 7270 5f73 697a 652c 2073 656c  lf.grp_size, sel
+0005d510: 662e 6963 6e74 2c20 7365 6c66 2e63 6872  f.icnt, self.chr
+0005d520: 2c20 7365 6c66 2e62 6567 696e 2c20 7365  , self.begin, se
+0005d530: 6c66 2e65 6e64 2c20 5c0a 2020 2020 2020  lf.end, \.      
+0005d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d550: 2020 2020 6765 745f 635f 6672 6f6d 5f69      get_c_from_i
+0005d560: 7374 7261 6e64 2873 656c 662e 6973 7472  strand(self.istr
+0005d570: 616e 6429 2c20 6765 745f 7374 725f 6672  and), get_str_fr
+0005d580: 6f6d 5f69 6364 6e67 2873 656c 662e 6963  om_icdng(self.ic
+0005d590: 6473 292c 2073 656c 662e 7473 6571 2c20  ds), self.tseq, 
+0005d5a0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0005d5b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005d5c0: 2e61 626e 2c20 7365 6c66 2e74 706d 2c20  .abn, self.tpm, 
+0005d5d0: 7365 6c66 2e69 736f 5f66 7261 632c 2073  self.iso_frac, s
+0005d5e0: 656c 662e 7072 6f62 2c20 7365 6c66 2e6e  elf.prob, self.n
+0005d5f0: 6578 6f6e 732c 2073 656c 662e 6776 6f6c  exons, self.gvol
+0005d600: 290a 0a20 2020 2027 2727 0a20 2020 2064  )..    '''.    d
+0005d610: 6566 2075 7064 6174 655f 7464 5f69 6e66  ef update_td_inf
+0005d620: 6f28 7365 6c66 2c20 6765 6e6f 6d65 203d  o(self, genome =
+0005d630: 204e 6f6e 652c 2073 656c 203d 2030 2c20   None, sel = 0, 
+0005d640: 7065 7074 6964 6520 3d20 4661 6c73 6529  peptide = False)
+0005d650: 3a0a 0a20 2020 2020 2020 2069 6620 6c65  :..        if le
+0005d660: 6e28 7365 6c66 2e74 645f 6c73 7429 203e  n(self.td_lst) >
+0005d670: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0005d680: 0a20 2020 2020 2020 2020 2020 2067 766f  .            gvo
+0005d690: 6c20 3d20 300a 2020 2020 2020 2020 2020  l = 0.          
+0005d6a0: 2020 6966 2073 656c 203d 3d20 303a 200a    if sel == 0: .
+0005d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d6c0: 7365 6c66 2e72 676e 732e 7365 745f 6376  self.rgns.set_cv
+0005d6d0: 6728 290a 2020 2020 2020 2020 2020 2020  g().            
+0005d6e0: 2020 2020 666d 203d 207b 274d 273a 2027      fm = {'M': '
+0005d6f0: 6578 6f6e 272c 2027 4927 3a20 2769 6e73  exon', 'I': 'ins
+0005d700: 6572 7369 6f6e 272c 2027 4427 3a20 2764  ersion', 'D': 'd
+0005d710: 656c 6574 696f 6e27 7d0a 2020 2020 2020  eletion'}.      
+0005d720: 2020 2020 2020 2020 2020 666f 7220 7220            for r 
+0005d730: 696e 2073 656c 662e 7267 6e73 2e72 676e  in self.rgns.rgn
+0005d740: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0005d750: 2020 2020 2020 2069 6620 722e 7479 7065         if r.type
+0005d760: 2069 6e20 666d 2e6b 6579 7328 293a 0a20   in fm.keys():. 
+0005d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d780: 2020 2020 2020 2072 2e74 7970 6520 3d20         r.type = 
+0005d790: 666d 5b72 2e74 7970 655d 0a20 2020 2020  fm[r.type].     
+0005d7a0: 2020 2020 2020 2020 2020 2074 676d 7320             tgms 
+0005d7b0: 3d20 7365 6c66 2e74 725f 746f 5f67 725f  = self.tr_to_gr_
+0005d7c0: 6d61 7073 0a0a 2020 2020 2020 2020 2020  maps..          
+0005d7d0: 2020 2020 2020 666f 7220 7220 696e 2073        for r in s
+0005d7e0: 656c 662e 7267 6e73 2e72 676e 733a 0a20  elf.rgns.rgns:. 
+0005d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d800: 2020 2067 766f 6c20 2b3d 206e 702e 7375     gvol += np.su
+0005d810: 6d28 722e 6376 6729 0a20 2020 2020 2020  m(r.cvg).       
+0005d820: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0005d830: 2020 2020 2020 656c 7365 3a20 0a20 2020        else: .   
+0005d840: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0005d850: 6765 6e6f 6d65 2069 7320 4e6f 6e65 3a20  genome is None: 
+0005d860: 7365 6c66 2e65 786f 6e73 2e73 6574 5f63  self.exons.set_c
+0005d870: 7667 2829 0a20 2020 2020 2020 2020 2020  vg().           
+0005d880: 2020 2020 2074 676d 7320 3d20 7365 6c66       tgms = self
+0005d890: 2e74 655f 746f 5f67 655f 6d61 7073 0a20  .te_to_ge_maps. 
+0005d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d8b0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0005d8c0: 7463 5f74 6f5f 6763 5f6d 6170 735f 6e65  tc_to_gc_maps_ne
+0005d8d0: 7720 3d20 5b5b 5d20 666f 7220 6b20 696e  w = [[] for k in
+0005d8e0: 2072 616e 6765 2873 656c 662e 6e74 7229   range(self.ntr)
+0005d8f0: 5d0a 2020 2020 2020 2020 2020 2020 6364  ].            cd
+0005d900: 735f 6e65 7720 3d20 7265 6769 6f6e 7328  s_new = regions(
+0005d910: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+0005d920: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
+0005d930: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0005d940: 2063 6e74 5f70 203d 2030 0a20 2020 2020   cnt_p = 0.     
+0005d950: 2020 2020 2020 2063 6e74 5f65 203d 2030         cnt_e = 0
+0005d960: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0005d970: 7220 6b2c 2074 6420 696e 2065 6e75 6d65  r k, td in enume
+0005d980: 7261 7465 2873 656c 662e 7464 5f6c 7374  rate(self.td_lst
+0005d990: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0005d9a0: 2020 2069 6620 6c65 6e28 7467 6d73 5b6b     if len(tgms[k
+0005d9b0: 5d29 203e 2030 3a20 200a 2020 2020 2020  ]) > 0:  .      
+0005d9c0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0005d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d9e0: 2020 2074 642e 7472 5f74 6f5f 6772 5f6d     td.tr_to_gr_m
+0005d9f0: 6170 203d 2063 6f70 792e 6465 6570 636f  ap = copy.deepco
+0005da00: 7079 2873 656c 662e 7472 5f74 6f5f 6772  py(self.tr_to_gr
+0005da10: 5f6d 6170 735b 6b5d 290a 2020 2020 2020  _maps[k]).      
+0005da20: 2020 2020 2020 2020 2020 2020 2020 7464                td
+0005da30: 2e74 655f 746f 5f67 655f 6d61 7020 3d20  .te_to_ge_map = 
+0005da40: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+0005da50: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
+0005da60: 5b6b 5d29 0a20 2020 2020 2020 2020 2020  [k]).           
+0005da70: 2020 2020 2020 2020 2074 642e 7463 5f74           td.tc_t
+0005da80: 6f5f 6763 5f6d 6170 203d 2063 6f70 792e  o_gc_map = copy.
+0005da90: 6465 6570 636f 7079 2873 656c 662e 7463  deepcopy(self.tc
+0005daa0: 5f74 6f5f 6763 5f6d 6170 735b 6b5d 290a  _to_gc_maps[k]).
+0005dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dac0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0005dad0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0005dae0: 7464 2e74 655f 746f 5f67 655f 6d61 7029  td.te_to_ge_map)
+0005daf0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0005db00: 2020 2020 2020 2020 2020 2020 2020 7473                ts
+0005db10: 6571 2c20 6173 6571 2c20 6364 732c 2062  eq, aseq, cds, b
+0005db20: 6520 3d20 7464 2e75 7064 6174 655f 696e  e = td.update_in
+0005db30: 666f 2873 656c 662e 6578 6f6e 732e 7267  fo(self.exons.rg
+0005db40: 6e73 2c20 7365 6c66 2e72 676e 732e 7267  ns, self.rgns.rg
+0005db50: 6e73 2c20 7365 6c66 2e63 6473 2e72 676e  ns, self.cds.rgn
+0005db60: 732c 205c 0a20 2020 2020 2020 2020 2020  s, \.           
+0005db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005db90: 2020 2020 2020 2020 2067 656e 6f6d 652c           genome,
+0005dba0: 2073 656c 203d 2073 656c 2c20 7065 7074   sel = sel, pept
+0005dbb0: 6964 6520 3d20 7065 7074 6964 6529 0a20  ide = peptide). 
+0005dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dbd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0005dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dbf0: 2074 7365 712c 2061 7365 712c 2063 6473   tseq, aseq, cds
+0005dc00: 2c20 6265 203d 2074 642e 7570 6461 7465  , be = td.update
+0005dc10: 5f69 6e66 6f28 7365 6c66 2e65 786f 6e73  _info(self.exons
+0005dc20: 2e72 676e 732c 2073 656c 662e 7267 6e73  .rgns, self.rgns
+0005dc30: 2e72 676e 732c 2073 656c 662e 6364 732e  .rgns, self.cds.
+0005dc40: 7267 6e73 2c20 5c0a 2020 2020 2020 2020  rgns, \.        
 0005dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dc60: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-0005dc70: 6e6f 6d65 2c20 7365 6c20 3d20 7365 6c2c  nome, sel = sel,
-0005dc80: 2070 6570 7469 6465 203d 2070 6570 7469   peptide = pepti
-0005dc90: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-0005dca0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0005dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dcc0: 2020 2020 2020 7473 6571 2c20 6173 6571        tseq, aseq
-0005dcd0: 2c20 6364 732c 2062 6520 3d20 7464 2e75  , cds, be = td.u
-0005dce0: 7064 6174 655f 696e 666f 2873 656c 662e  pdate_info(self.
-0005dcf0: 6578 6f6e 732e 7267 6e73 2c20 7365 6c66  exons.rgns, self
-0005dd00: 2e72 676e 732e 7267 6e73 2c20 7365 6c66  .rgns.rgns, self
-0005dd10: 2e63 6473 2e72 676e 732c 205c 0a20 2020  .cds.rgns, \.   
-0005dd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dd50: 2067 656e 6f6d 652c 2073 656c 203d 2073   genome, sel = s
-0005dd60: 656c 2c20 7065 7074 6964 6520 3d20 7065  el, peptide = pe
-0005dd70: 7074 6964 6529 0a0a 2020 2020 2020 2020  ptide)..        
-0005dd80: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-0005dd90: 642e 7072 6566 6978 203d 3d20 2758 273a  d.prefix == 'X':
-0005dda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005ddb0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0005ddc0: 2e6e 7472 203d 3d20 313a 2020 7464 2e70  .ntr == 1:  td.p
-0005ddd0: 7265 6669 7820 3d20 2754 270a 2020 2020  refix = 'T'.    
-0005dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ddf0: 2020 2020 656c 6966 2073 656c 662e 6e74      elif self.nt
-0005de00: 7220 3e20 313a 2020 7464 2e70 7265 6669  r > 1:  td.prefi
-0005de10: 7820 3d20 2749 270a 2020 2020 2020 2020  x = 'I'.        
+0005dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dc70: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
+0005dc80: 6d65 2c20 7365 6c20 3d20 7365 6c2c 2070  me, sel = sel, p
+0005dc90: 6570 7469 6465 203d 2070 6570 7469 6465  eptide = peptide
+0005dca0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005dcb0: 2020 2020 2020 2069 6620 7464 2e70 7265         if td.pre
+0005dcc0: 6669 7820 3d3d 2027 5827 3a0a 2020 2020  fix == 'X':.    
+0005dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dce0: 2020 2020 6966 2073 656c 662e 6e74 7220      if self.ntr 
+0005dcf0: 3d3d 2031 3a20 2074 642e 7072 6566 6978  == 1:  td.prefix
+0005dd00: 203d 2027 5427 0a20 2020 2020 2020 2020   = 'T'.         
+0005dd10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0005dd20: 6c69 6620 7365 6c66 2e6e 7472 203e 2031  lif self.ntr > 1
+0005dd30: 3a20 2074 642e 7072 6566 6978 203d 2027  :  td.prefix = '
+0005dd40: 4927 0a20 2020 2020 2020 2020 2020 2020  I'.             
+0005dd50: 2020 2020 2020 2069 6620 7464 2e69 636e         if td.icn
+0005dd60: 7420 3c20 303a 2074 642e 6963 6e74 203d  t < 0: td.icnt =
+0005dd70: 206b 0a20 2020 2020 2020 2020 2020 2020   k.             
+0005dd80: 2020 2020 2020 2069 6620 7464 2e67 766f         if td.gvo
+0005dd90: 6c20 3c3d 2030 3a20 7464 2e67 766f 6c20  l <= 0: td.gvol 
+0005dda0: 3d20 6776 6f6c 0a20 2020 2020 2020 2020  = gvol.         
+0005ddb0: 2020 2020 2020 2020 2020 2069 6620 7464             if td
+0005ddc0: 2e67 7270 5f73 697a 6520 3c3d 2030 3a20  .grp_size <= 0: 
+0005ddd0: 7464 2e67 7270 5f73 697a 6520 3d20 7365  td.grp_size = se
+0005dde0: 6c66 2e6e 7472 0a20 2020 2020 2020 2020  lf.ntr.         
+0005ddf0: 2020 2020 2020 2020 2020 2069 6620 7464             if td
+0005de00: 2e70 726f 6220 3c3d 2030 3a20 7464 2e70  .prob <= 0: td.p
+0005de10: 726f 6220 3d20 310a 2020 2020 2020 2020  rob = 1.        
 0005de20: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-0005de30: 642e 6963 6e74 203c 2030 3a20 7464 2e69  d.icnt < 0: td.i
-0005de40: 636e 7420 3d20 6b0a 2020 2020 2020 2020  cnt = k.        
-0005de50: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-0005de60: 642e 6776 6f6c 203c 3d20 303a 2074 642e  d.gvol <= 0: td.
-0005de70: 6776 6f6c 203d 2067 766f 6c0a 2020 2020  gvol = gvol.    
-0005de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005de90: 6966 2074 642e 6772 705f 7369 7a65 203c  if td.grp_size <
-0005dea0: 3d20 303a 2074 642e 6772 705f 7369 7a65  = 0: td.grp_size
-0005deb0: 203d 2073 656c 662e 6e74 720a 2020 2020   = self.ntr.    
-0005dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ded0: 6966 2074 642e 7072 6f62 203c 3d20 303a  if td.prob <= 0:
-0005dee0: 2074 642e 7072 6f62 203d 2031 0a20 2020   td.prob = 1.   
-0005def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005df00: 2069 6620 7464 2e6e 6578 6f6e 7320 3c3d   if td.nexons <=
-0005df10: 2030 3a20 0a20 2020 2020 2020 2020 2020   0: .           
-0005df20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0005df30: 7365 6c20 3d3d 2030 3a0a 2020 2020 2020  sel == 0:.      
-0005df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005df50: 2020 2020 2020 7464 2e6e 6578 6f6e 7320        td.nexons 
-0005df60: 3d20 6c65 6e28 7365 6c66 2e74 725f 746f  = len(self.tr_to
-0005df70: 5f67 725f 6d61 7073 5b6b 5d29 0a20 2020  _gr_maps[k]).   
-0005df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005df90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0005dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dfb0: 2020 2020 2020 2074 642e 6e65 786f 6e73         td.nexons
-0005dfc0: 203d 206c 656e 2873 656c 662e 7465 5f74   = len(self.te_t
-0005dfd0: 6f5f 6765 5f6d 6170 735b 6b5d 290a 2020  o_ge_maps[k]).  
-0005dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dff0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0005e000: 2020 2020 2020 2069 6620 6265 3a20 636e         if be: cn
-0005e010: 745f 6520 2b3d 2031 0a20 2020 2020 2020  t_e += 1.       
-0005e020: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0005e030: 6c65 6e28 7473 6571 2920 3e20 303a 2063  len(tseq) > 0: c
-0005e040: 6e74 5f74 202b 3d20 310a 2020 2020 2020  nt_t += 1.      
-0005e050: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005e060: 206c 656e 2861 7365 7129 203e 2030 3a20   len(aseq) > 0: 
-0005e070: 636e 745f 7020 2b3d 2031 0a20 2020 2020  cnt_p += 1.     
-0005e080: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0005e090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005e0a0: 2020 2020 2069 6620 2828 7365 6c20 3e20       if ((sel > 
-0005e0b0: 3029 2026 2070 6570 7469 6465 293a 2023  0) & peptide): #
-0005e0c0: 207c 2028 2873 656c 203d 3d20 3029 2026   | ((sel == 0) &
-0005e0d0: 2028 6c65 6e28 7464 2e74 655f 746f 5f67   (len(td.te_to_g
-0005e0e0: 655f 6d61 7029 203d 3d20 3029 293a 0a20  e_map) == 0)):. 
+0005de30: 642e 6e65 786f 6e73 203c 3d20 303a 200a  d.nexons <= 0: .
+0005de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005de50: 2020 2020 2020 2020 6966 2073 656c 203d          if sel =
+0005de60: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0005de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005de80: 2074 642e 6e65 786f 6e73 203d 206c 656e   td.nexons = len
+0005de90: 2873 656c 662e 7472 5f74 6f5f 6772 5f6d  (self.tr_to_gr_m
+0005dea0: 6170 735b 6b5d 290a 2020 2020 2020 2020  aps[k]).        
+0005deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dec0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0005ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dee0: 2020 7464 2e6e 6578 6f6e 7320 3d20 6c65    td.nexons = le
+0005def0: 6e28 7365 6c66 2e74 655f 746f 5f67 655f  n(self.te_to_ge_
+0005df00: 6d61 7073 5b6b 5d29 0a20 2020 2020 2020  maps[k]).       
+0005df10: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0005df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005df30: 2020 6966 2062 653a 2063 6e74 5f65 202b    if be: cnt_e +
+0005df40: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0005df50: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
+0005df60: 7365 7129 203e 2030 3a20 636e 745f 7420  seq) > 0: cnt_t 
+0005df70: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0005df80: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0005df90: 6173 6571 2920 3e20 303a 2063 6e74 5f70  aseq) > 0: cnt_p
+0005dfa0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0005dfb0: 2020 2020 2020 2020 2020 0a0a 2020 2020            ..    
+0005dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dfd0: 6966 2028 2873 656c 203e 2030 2920 2620  if ((sel > 0) & 
+0005dfe0: 7065 7074 6964 6529 3a20 2320 7c20 2828  peptide): # | ((
+0005dff0: 7365 6c20 3d3d 2030 2920 2620 286c 656e  sel == 0) & (len
+0005e000: 2874 642e 7465 5f74 6f5f 6765 5f6d 6170  (td.te_to_ge_map
+0005e010: 2920 3d3d 2030 2929 3a0a 2020 2020 2020  ) == 0)):.      
+0005e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e030: 2020 6966 206c 656e 2861 7365 7129 203e    if len(aseq) >
+0005e040: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0005e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e060: 666f 7220 7220 696e 2063 6473 2e72 676e  for r in cds.rgn
+0005e070: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0005e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e090: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
+0005e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e0b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005e0c0: 6d2c 2063 2069 6e20 656e 756d 6572 6174  m, c in enumerat
+0005e0d0: 6528 6364 735f 6e65 772e 7267 6e73 293a  e(cds_new.rgns):
+0005e0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0005e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e100: 2020 2020 2020 2069 6620 6c65 6e28 6173         if len(as
-0005e110: 6571 2920 3e20 303a 0a20 2020 2020 2020  eq) > 0:.       
+0005e100: 2020 2020 2069 6620 722e 6973 5f74 6865       if r.is_the
+0005e110: 5f73 616d 655f 6173 2863 293a 0a20 2020  _same_as(c):.   
 0005e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e130: 2020 2020 2066 6f72 2072 2069 6e20 6364       for r in cd
-0005e140: 732e 7267 6e73 3a0a 2020 2020 2020 2020  s.rgns:.        
+0005e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e140: 2020 2020 2062 203d 2046 616c 7365 0a20       b = False. 
 0005e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e160: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
-0005e170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e190: 2066 6f72 206d 2c20 6320 696e 2065 6e75   for m, c in enu
-0005e1a0: 6d65 7261 7465 2863 6473 5f6e 6577 2e72  merate(cds_new.r
-0005e1b0: 676e 7329 3a0a 2020 2020 2020 2020 2020  gns):.          
-0005e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e1d0: 2020 2020 2020 2020 2020 6966 2072 2e69            if r.i
-0005e1e0: 735f 7468 655f 7361 6d65 5f61 7328 6329  s_the_same_as(c)
-0005e1f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0005e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e210: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
-0005e220: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0005e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e170: 2020 2020 2020 2074 635f 746f 5f67 635f         tc_to_gc_
+0005e180: 6d61 7073 5f6e 6577 5b6b 5d2e 6170 7065  maps_new[k].appe
+0005e190: 6e64 286d 290a 2020 2020 2020 2020 2020  nd(m).          
+0005e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e1b0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0005e1c0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0005e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e1e0: 2020 2020 6966 2062 3a0a 2020 2020 2020      if b:.      
+0005e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e200: 2020 2020 2020 2020 2020 2020 2020 6d20                m 
+0005e210: 3d20 6c65 6e28 6364 735f 6e65 772e 7267  = len(cds_new.rg
+0005e220: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
 0005e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e240: 2020 2020 2020 2020 2020 2020 7463 5f74              tc_t
-0005e250: 6f5f 6763 5f6d 6170 735f 6e65 775b 6b5d  o_gc_maps_new[k]
-0005e260: 2e61 7070 656e 6428 6d29 0a20 2020 2020  .append(m).     
+0005e240: 2020 2020 2020 2020 7463 5f74 6f5f 6763          tc_to_gc
+0005e250: 5f6d 6170 735f 6e65 775b 6b5d 2e61 7070  _maps_new[k].app
+0005e260: 656e 6428 6d29 0a20 2020 2020 2020 2020  end(m).         
 0005e270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e290: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-0005e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e2b0: 2020 2020 2020 2020 2069 6620 623a 0a20           if b:. 
-0005e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e2e0: 2020 206d 203d 206c 656e 2863 6473 5f6e     m = len(cds_n
-0005e2f0: 6577 2e72 676e 7329 0a20 2020 2020 2020  ew.rgns).       
-0005e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e310: 2020 2020 2020 2020 2020 2020 2074 635f               tc_
-0005e320: 746f 5f67 635f 6d61 7073 5f6e 6577 5b6b  to_gc_maps_new[k
-0005e330: 5d2e 6170 7065 6e64 286d 290a 2020 2020  ].append(m).    
-0005e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e360: 6364 735f 6e65 772e 7267 6e73 2e61 7070  cds_new.rgns.app
-0005e370: 656e 6428 7229 0a0a 2020 2020 2020 2020  end(r)..        
-0005e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e390: 2020 2020 7464 2e74 635f 746f 5f67 635f      td.tc_to_gc_
-0005e3a0: 6d61 7020 3d20 7463 5f74 6f5f 6763 5f6d  map = tc_to_gc_m
-0005e3b0: 6170 735f 6e65 775b 6b5d 0a0a 2020 2020  aps_new[k]..    
-0005e3c0: 2020 2020 2020 2020 6966 2028 2873 656c          if ((sel
-0005e3d0: 203e 2030 2920 2620 7065 7074 6964 6529   > 0) & peptide)
-0005e3e0: 3a20 2320 7c20 2828 7365 6c20 3d3d 2030  : # | ((sel == 0
-0005e3f0: 2920 2620 286c 656e 2874 642e 7465 5f74  ) & (len(td.te_t
-0005e400: 6f5f 6765 5f6d 6170 2920 3d3d 2030 2929  o_ge_map) == 0))
-0005e410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0005e420: 2020 7365 6c66 2e63 6473 203d 2063 6473    self.cds = cds
-0005e430: 5f6e 6577 0a20 2020 2020 2020 2020 2020  _new.           
-0005e440: 2020 2020 2073 656c 662e 7463 5f74 6f5f       self.tc_to_
-0005e450: 6763 5f6d 6170 7320 3d20 7463 5f74 6f5f  gc_maps = tc_to_
-0005e460: 6763 5f6d 6170 735f 6e65 770a 2020 2020  gc_maps_new.    
-0005e470: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005e480: 2e67 6574 5f73 7061 6e28 290a 0a20 2020  .get_span()..   
-0005e490: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0005e4a0: 636e 745f 742c 2063 6e74 5f70 2c20 636e  cnt_t, cnt_p, cn
-0005e4b0: 745f 650a 2020 2020 2020 2020 656c 7365  t_e.        else
-0005e4c0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0005e4d0: 696e 7428 2775 7064 6174 655f 7464 5f69  int('update_td_i
-0005e4e0: 6e66 6f3a 206e 6f20 7472 616e 7363 7269  nfo: no transcri
-0005e4f0: 7074 7327 290a 2020 2020 2020 2020 2020  pts').          
-0005e500: 2020 7265 7475 726e 2030 2c20 302c 2030    return 0, 0, 0
-0005e510: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0005e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e530: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0005e540: 2020 2020 6465 6620 6765 745f 6774 665f      def get_gtf_
-0005e550: 6c69 6e65 735f 6672 6f6d 5f65 786f 6e73  lines_from_exons
-0005e560: 2873 656c 662c 2067 656e 6f6d 6520 3d20  (self, genome = 
-0005e570: 4e6f 6e65 2c20 7365 6c20 3d20 302c 2061  None, sel = 0, a
-0005e580: 6464 5f73 6571 203d 2054 7275 652c 2063  dd_seq = True, c
-0005e590: 6f6e 6e65 6374 203d 2046 616c 7365 293a  onnect = False):
-0005e5a0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0005e5b0: 2020 6c69 6e65 5f6c 7374 203d 205b 5d0a    line_lst = [].
-0005e5c0: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
-0005e5d0: 203d 2030 0a20 2020 2020 2020 2069 6620   = 0.        if 
-0005e5e0: 6c65 6e28 7365 6c66 2e74 645f 6c73 7429  len(self.td_lst)
-0005e5f0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0005e600: 2020 0a20 2020 2020 2020 2020 2020 2066    .            f
-0005e610: 6d20 3d20 7b27 4d27 3a20 2765 786f 6e27  m = {'M': 'exon'
-0005e620: 2c20 2749 273a 2027 696e 7365 7273 696f  , 'I': 'insersio
-0005e630: 6e27 2c20 2744 273a 2027 6465 6c65 7469  n', 'D': 'deleti
-0005e640: 6f6e 277d 0a20 2020 2020 2020 2020 2020  on'}.           
-0005e650: 2066 6f72 2072 2069 6e20 7365 6c66 2e72   for r in self.r
-0005e660: 676e 732e 7267 6e73 3a0a 2020 2020 2020  gns.rgns:.      
-0005e670: 2020 2020 2020 2020 2020 6966 2072 2e74            if r.t
-0005e680: 7970 6520 696e 2066 6d2e 6b65 7973 2829  ype in fm.keys()
-0005e690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0005e6a0: 2020 2020 2020 722e 7479 7065 203d 2066        r.type = f
-0005e6b0: 6d5b 722e 7479 7065 5d0a 2020 2020 2020  m[r.type].      
-0005e6c0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0005e6d0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0005e6e0: 6c20 3c20 323a 0a0a 2020 2020 2020 2020  l < 2:..        
-0005e6f0: 2020 2020 2020 2020 6966 2073 656c 203d          if sel =
-0005e700: 3d20 303a 2074 676d 203d 2073 656c 662e  = 0: tgm = self.
-0005e710: 7472 5f74 6f5f 6772 5f6d 6170 730a 2020  tr_to_gr_maps.  
-0005e720: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0005e730: 7365 3a20 7467 6d20 3d20 7365 6c66 2e74  se: tgm = self.t
-0005e740: 655f 746f 5f67 655f 6d61 7073 0a0a 2020  e_to_ge_maps..  
-0005e750: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005e760: 2028 7365 6c66 2e63 6f76 5f74 6820 3d3d   (self.cov_th ==
-0005e770: 2030 293a 2063 6f76 5f74 6820 3d20 2d32   0): cov_th = -2
-0005e780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005e790: 2065 6c73 653a 2063 6f76 5f74 6820 3d20   else: cov_th = 
-0005e7a0: 7365 6c66 2e63 6f76 5f74 680a 2020 2020  self.cov_th.    
-0005e7b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0005e7c0: 7365 6c66 2e61 626e 5f74 6820 3d3d 2030  self.abn_th == 0
-0005e7d0: 293a 2061 626e 5f74 6820 3d20 2d31 0a20  ): abn_th = -1. 
-0005e7e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0005e7f0: 6c73 653a 2061 626e 5f74 6820 3d20 7365  lse: abn_th = se
-0005e800: 6c66 2e61 626e 5f74 680a 0a20 2020 2020  lf.abn_th..     
-0005e810: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-0005e820: 2c20 7464 2069 6e20 656e 756d 6572 6174  , td in enumerat
-0005e830: 6528 7365 6c66 2e74 645f 6c73 7429 3a0a  e(self.td_lst):.
-0005e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e850: 2020 2020 6966 2028 6c65 6e28 7467 6d5b      if (len(tgm[
-0005e860: 6b5d 2920 3e20 3029 2026 2028 7464 2e63  k]) > 0) & (td.c
-0005e870: 6f76 203e 3d20 636f 765f 7468 293a 2023  ov >= cov_th): #
-0005e880: 2026 2028 7464 2e61 626e 203e 3d20 6162   & (td.abn >= ab
-0005e890: 6e5f 7468 293a 2020 0a20 2020 2020 2020  n_th):  .       
-0005e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e8b0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0005e8c0: 2020 2020 2020 2020 2020 7464 2e74 725f            td.tr_
-0005e8d0: 746f 5f67 725f 6d61 7020 3d20 636f 7079  to_gr_map = copy
-0005e8e0: 2e64 6565 7063 6f70 7928 7365 6c66 2e74  .deepcopy(self.t
-0005e8f0: 725f 746f 5f67 725f 6d61 7073 5b6b 5d29  r_to_gr_maps[k])
-0005e900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005e910: 2020 2020 2020 2020 2074 642e 7465 5f74           td.te_t
-0005e920: 6f5f 6765 5f6d 6170 203d 2063 6f70 792e  o_ge_map = copy.
-0005e930: 6465 6570 636f 7079 2873 656c 662e 7465  deepcopy(self.te
-0005e940: 5f74 6f5f 6765 5f6d 6170 735b 6b5d 290a  _to_ge_maps[k]).
-0005e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e960: 2020 2020 2020 2020 7464 2e74 635f 746f          td.tc_to
-0005e970: 5f67 635f 6d61 7020 3d20 636f 7079 2e64  _gc_map = copy.d
-0005e980: 6565 7063 6f70 7928 7365 6c66 2e74 635f  eepcopy(self.tc_
-0005e990: 746f 5f67 635f 6d61 7073 5b6b 5d29 0a20  to_gc_maps[k]). 
+0005e280: 2020 2020 2020 2020 2020 2063 6473 5f6e             cds_n
+0005e290: 6577 2e72 676e 732e 6170 7065 6e64 2872  ew.rgns.append(r
+0005e2a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005e2b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0005e2c0: 642e 7463 5f74 6f5f 6763 5f6d 6170 203d  d.tc_to_gc_map =
+0005e2d0: 2074 635f 746f 5f67 635f 6d61 7073 5f6e   tc_to_gc_maps_n
+0005e2e0: 6577 5b6b 5d0a 0a20 2020 2020 2020 2020  ew[k]..         
+0005e2f0: 2020 2069 6620 2828 7365 6c20 3e20 3029     if ((sel > 0)
+0005e300: 2026 2070 6570 7469 6465 293a 2023 207c   & peptide): # |
+0005e310: 2028 2873 656c 203d 3d20 3029 2026 2028   ((sel == 0) & (
+0005e320: 6c65 6e28 7464 2e74 655f 746f 5f67 655f  len(td.te_to_ge_
+0005e330: 6d61 7029 203d 3d20 3029 293a 0a20 2020  map) == 0)):.   
+0005e340: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005e350: 662e 6364 7320 3d20 6364 735f 6e65 770a  f.cds = cds_new.
+0005e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e370: 7365 6c66 2e74 635f 746f 5f67 635f 6d61  self.tc_to_gc_ma
+0005e380: 7073 203d 2074 635f 746f 5f67 635f 6d61  ps = tc_to_gc_ma
+0005e390: 7073 5f6e 6577 0a20 2020 2020 2020 2020  ps_new.         
+0005e3a0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+0005e3b0: 7370 616e 2829 0a0a 2020 2020 2020 2020  span()..        
+0005e3c0: 2020 2020 7265 7475 726e 2063 6e74 5f74      return cnt_t
+0005e3d0: 2c20 636e 745f 702c 2063 6e74 5f65 0a20  , cnt_p, cnt_e. 
+0005e3e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0005e3f0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0005e400: 7570 6461 7465 5f74 645f 696e 666f 3a20  update_td_info: 
+0005e410: 6e6f 2074 7261 6e73 6372 6970 7473 2729  no transcripts')
+0005e420: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0005e430: 7572 6e20 302c 2030 2c20 300a 2020 2020  urn 0, 0, 0.    
+0005e440: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0005e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e460: 2020 2020 2020 2020 2020 0a20 2020 2064            .    d
+0005e470: 6566 2067 6574 5f67 7466 5f6c 696e 6573  ef get_gtf_lines
+0005e480: 5f66 726f 6d5f 6578 6f6e 7328 7365 6c66  _from_exons(self
+0005e490: 2c20 6765 6e6f 6d65 203d 204e 6f6e 652c  , genome = None,
+0005e4a0: 2073 656c 203d 2030 2c20 6164 645f 7365   sel = 0, add_se
+0005e4b0: 7120 3d20 5472 7565 2c20 636f 6e6e 6563  q = True, connec
+0005e4c0: 7420 3d20 4661 6c73 6529 3a0a 2020 2020  t = False):.    
+0005e4d0: 2020 2020 0a20 2020 2020 2020 206c 696e      .        lin
+0005e4e0: 655f 6c73 7420 3d20 5b5d 0a20 2020 2020  e_lst = [].     
+0005e4f0: 2020 2063 6e74 5f6e 6f6e 6520 3d20 300a     cnt_none = 0.
+0005e500: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+0005e510: 656c 662e 7464 5f6c 7374 2920 3e20 303a  elf.td_lst) > 0:
+0005e520: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0005e530: 2020 2020 2020 2020 2020 666d 203d 207b            fm = {
+0005e540: 274d 273a 2027 6578 6f6e 272c 2027 4927  'M': 'exon', 'I'
+0005e550: 3a20 2769 6e73 6572 7369 6f6e 272c 2027  : 'insersion', '
+0005e560: 4427 3a20 2764 656c 6574 696f 6e27 7d0a  D': 'deletion'}.
+0005e570: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005e580: 7220 696e 2073 656c 662e 7267 6e73 2e72  r in self.rgns.r
+0005e590: 676e 733a 0a20 2020 2020 2020 2020 2020  gns:.           
+0005e5a0: 2020 2020 2069 6620 722e 7479 7065 2069       if r.type i
+0005e5b0: 6e20 666d 2e6b 6579 7328 293a 0a20 2020  n fm.keys():.   
+0005e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e5d0: 2072 2e74 7970 6520 3d20 666d 5b72 2e74   r.type = fm[r.t
+0005e5e0: 7970 655d 0a20 2020 2020 2020 2020 2020  ype].           
+0005e5f0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0005e600: 2020 2020 2020 6966 2073 656c 203c 2032        if sel < 2
+0005e610: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+0005e620: 2020 2069 6620 7365 6c20 3d3d 2030 3a20     if sel == 0: 
+0005e630: 7467 6d20 3d20 7365 6c66 2e74 725f 746f  tgm = self.tr_to
+0005e640: 5f67 725f 6d61 7073 0a20 2020 2020 2020  _gr_maps.       
+0005e650: 2020 2020 2020 2020 2065 6c73 653a 2074           else: t
+0005e660: 676d 203d 2073 656c 662e 7465 5f74 6f5f  gm = self.te_to_
+0005e670: 6765 5f6d 6170 730a 0a20 2020 2020 2020  ge_maps..       
+0005e680: 2020 2020 2020 2020 2069 6620 2873 656c           if (sel
+0005e690: 662e 636f 765f 7468 203d 3d20 3029 3a20  f.cov_th == 0): 
+0005e6a0: 636f 765f 7468 203d 202d 320a 2020 2020  cov_th = -2.    
+0005e6b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0005e6c0: 3a20 636f 765f 7468 203d 2073 656c 662e  : cov_th = self.
+0005e6d0: 636f 765f 7468 0a20 2020 2020 2020 2020  cov_th.         
+0005e6e0: 2020 2020 2020 2069 6620 2873 656c 662e         if (self.
+0005e6f0: 6162 6e5f 7468 203d 3d20 3029 3a20 6162  abn_th == 0): ab
+0005e700: 6e5f 7468 203d 202d 310a 2020 2020 2020  n_th = -1.      
+0005e710: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
+0005e720: 6162 6e5f 7468 203d 2073 656c 662e 6162  abn_th = self.ab
+0005e730: 6e5f 7468 0a0a 2020 2020 2020 2020 2020  n_th..          
+0005e740: 2020 2020 2020 666f 7220 6b2c 2074 6420        for k, td 
+0005e750: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
+0005e760: 662e 7464 5f6c 7374 293a 0a20 2020 2020  f.td_lst):.     
+0005e770: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0005e780: 6620 286c 656e 2874 676d 5b6b 5d29 203e  f (len(tgm[k]) >
+0005e790: 2030 2920 2620 2874 642e 636f 7620 3e3d   0) & (td.cov >=
+0005e7a0: 2063 6f76 5f74 6829 3a20 2320 2620 2874   cov_th): # & (t
+0005e7b0: 642e 6162 6e20 3e3d 2061 626e 5f74 6829  d.abn >= abn_th)
+0005e7c0: 3a20 200a 2020 2020 2020 2020 2020 2020  :  .            
+0005e7d0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0005e7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e7f0: 2020 2020 2074 642e 7472 5f74 6f5f 6772       td.tr_to_gr
+0005e800: 5f6d 6170 203d 2063 6f70 792e 6465 6570  _map = copy.deep
+0005e810: 636f 7079 2873 656c 662e 7472 5f74 6f5f  copy(self.tr_to_
+0005e820: 6772 5f6d 6170 735b 6b5d 290a 2020 2020  gr_maps[k]).    
+0005e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e840: 2020 2020 7464 2e74 655f 746f 5f67 655f      td.te_to_ge_
+0005e850: 6d61 7020 3d20 636f 7079 2e64 6565 7063  map = copy.deepc
+0005e860: 6f70 7928 7365 6c66 2e74 655f 746f 5f67  opy(self.te_to_g
+0005e870: 655f 6d61 7073 5b6b 5d29 0a20 2020 2020  e_maps[k]).     
+0005e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e890: 2020 2074 642e 7463 5f74 6f5f 6763 5f6d     td.tc_to_gc_m
+0005e8a0: 6170 203d 2063 6f70 792e 6465 6570 636f  ap = copy.deepco
+0005e8b0: 7079 2873 656c 662e 7463 5f74 6f5f 6763  py(self.tc_to_gc
+0005e8c0: 5f6d 6170 735b 6b5d 290a 2020 2020 2020  _maps[k]).      
+0005e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e8e0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0005e8f0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0005e900: 7420 7365 6c66 2e67 7466 3a20 2320 6c65  t self.gtf: # le
+0005e910: 6e28 7464 2e74 655f 746f 5f67 655f 6d61  n(td.te_to_ge_ma
+0005e920: 7029 203d 3d20 303a 0a20 2020 2020 2020  p) == 0:.       
+0005e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e940: 2020 2020 2067 6c73 203d 2074 642e 6765       gls = td.ge
+0005e950: 745f 6774 665f 6c69 6e65 735f 6672 6f6d  t_gtf_lines_from
+0005e960: 5f65 786f 6e73 2873 656c 662e 6578 6f6e  _exons(self.exon
+0005e970: 732e 7267 6e73 2c20 7365 6c66 2e72 676e  s.rgns, self.rgn
+0005e980: 732e 7267 6e73 2c20 7365 6c66 2e63 6473  s.rgns, self.cds
+0005e990: 2e72 676e 732c 205c 0a20 2020 2020 2020  .rgns, \.       
 0005e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e9b0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0005e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e9d0: 6966 206e 6f74 2073 656c 662e 6774 663a  if not self.gtf:
-0005e9e0: 2023 206c 656e 2874 642e 7465 5f74 6f5f   # len(td.te_to_
-0005e9f0: 6765 5f6d 6170 2920 3d3d 2030 3a0a 2020  ge_map) == 0:.  
-0005ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ea10: 2020 2020 2020 2020 2020 676c 7320 3d20            gls = 
-0005ea20: 7464 2e67 6574 5f67 7466 5f6c 696e 6573  td.get_gtf_lines
-0005ea30: 5f66 726f 6d5f 6578 6f6e 7328 7365 6c66  _from_exons(self
-0005ea40: 2e65 786f 6e73 2e72 676e 732c 2073 656c  .exons.rgns, sel
-0005ea50: 662e 7267 6e73 2e72 676e 732c 2073 656c  f.rgns.rgns, sel
-0005ea60: 662e 6364 732e 7267 6e73 2c20 5c0a 2020  f.cds.rgns, \.  
+0005e9d0: 2020 2020 2020 2067 656e 6f6d 652c 2073         genome, s
+0005e9e0: 656c 203d 2073 656c 2c20 6164 645f 7365  el = sel, add_se
+0005e9f0: 7120 3d20 6164 645f 7365 712c 2063 6f6e  q = add_seq, con
+0005ea00: 6e65 6374 203d 2063 6f6e 6e65 6374 290a  nect = connect).
+0005ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ea20: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0005ea30: 656e 2867 6c73 2920 3c3d 2031 3a0a 2020  en(gls) <= 1:.  
+0005ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ea50: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+0005ea60: 745f 6e6f 6e65 202b 3d20 310a 2020 2020  t_none += 1.    
 0005ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005eaa0: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
-0005eab0: 6d65 2c20 7365 6c20 3d20 7365 6c2c 2061  me, sel = sel, a
-0005eac0: 6464 5f73 6571 203d 2061 6464 5f73 6571  dd_seq = add_seq
-0005ead0: 2c20 636f 6e6e 6563 7420 3d20 636f 6e6e  , connect = conn
-0005eae0: 6563 7429 0a20 2020 2020 2020 2020 2020  ect).           
-0005eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005eb00: 2069 6620 6c65 6e28 676c 7329 203c 3d20   if len(gls) <= 
-0005eb10: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-0005eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005eb30: 2020 2063 6e74 5f6e 6f6e 6520 2b3d 2031     cnt_none += 1
-0005eb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005eb60: 2023 2070 7269 6e74 2827 4552 524f 5220   # print('ERROR 
-0005eb70: 696e 2067 642e 6765 745f 6774 665f 6c69  in gd.get_gtf_li
-0005eb80: 6e65 735f 6672 6f6d 5f65 786f 6e73 3a20  nes_from_exons: 
-0005eb90: 4c65 6e28 4754 4620 6c69 6e65 7329 203d  Len(GTF lines) =
-0005eba0: 3d20 2569 204c 2825 692c 2569 2927 205c  = %i L(%i,%i)' \
-0005ebb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ebd0: 2023 2020 2020 2020 2020 2520 286c 656e   #        % (len
-0005ebe0: 2867 6c73 292c 206c 656e 2874 642e 7465  (gls), len(td.te
-0005ebf0: 5f74 6f5f 6765 5f6d 6170 292c 206c 656e  _to_ge_map), len
-0005ec00: 2874 642e 7472 5f74 6f5f 6772 5f6d 6170  (td.tr_to_gr_map
-0005ec10: 2929 2029 0a20 2020 2020 2020 2020 2020  )) ).           
-0005ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0005ea80: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+0005ea90: 696e 7428 2745 5252 4f52 2069 6e20 6764  int('ERROR in gd
+0005eaa0: 2e67 6574 5f67 7466 5f6c 696e 6573 5f66  .get_gtf_lines_f
+0005eab0: 726f 6d5f 6578 6f6e 733a 204c 656e 2847  rom_exons: Len(G
+0005eac0: 5446 206c 696e 6573 2920 3d3d 2025 6920  TF lines) == %i 
+0005ead0: 4c28 2569 2c25 6929 2720 5c0a 2020 2020  L(%i,%i)' \.    
+0005eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005eaf0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0005eb00: 2020 2020 2025 2028 6c65 6e28 676c 7329       % (len(gls)
+0005eb10: 2c20 6c65 6e28 7464 2e74 655f 746f 5f67  , len(td.te_to_g
+0005eb20: 655f 6d61 7029 2c20 6c65 6e28 7464 2e74  e_map), len(td.t
+0005eb30: 725f 746f 5f67 725f 6d61 7029 2920 290a  r_to_gr_map)) ).
+0005eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005eb50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0005eb60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005eb80: 2020 6966 2054 525f 4649 4c54 4552 5f53    if TR_FILTER_S
+0005eb90: 454c 203d 3d20 313a 0a20 2020 2020 2020  EL == 1:.       
+0005eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ebb0: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+0005ebc0: 2073 656c 662e 6368 6563 6b5f 7472 5f31   self.check_tr_1
+0005ebd0: 2874 642c 2066 7261 675f 6c65 6e20 3d20  (td, frag_len = 
+0005ebe0: 7365 6c66 2e72 6561 645f 6c65 6e2c 2067  self.read_len, g
+0005ebf0: 5f74 6820 3d20 4d49 4e5f 4e5f 5244 535f  _th = MIN_N_RDS_
+0005ec00: 5045 525f 4745 4e45 2c20 6162 6e5f 7468  PER_GENE, abn_th
+0005ec10: 5f74 203d 204d 494e 5f41 424e 5f54 4f5f  _t = MIN_ABN_TO_
+0005ec20: 5345 4c2c 205c 0a20 2020 2020 2020 2020  SEL, \.         
+0005ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec50: 2020 2020 2020 2069 6620 5452 5f46 494c         if TR_FIL
-0005ec60: 5445 525f 5345 4c20 3d3d 2031 3a0a 2020  TER_SEL == 1:.  
-0005ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec90: 2020 6220 3d20 7365 6c66 2e63 6865 636b    b = self.check
-0005eca0: 5f74 725f 3128 7464 2c20 6672 6167 5f6c  _tr_1(td, frag_l
-0005ecb0: 656e 203d 2073 656c 662e 7265 6164 5f6c  en = self.read_l
-0005ecc0: 656e 2c20 675f 7468 203d 204d 494e 5f4e  en, g_th = MIN_N
-0005ecd0: 5f52 4453 5f50 4552 5f47 454e 452c 2061  _RDS_PER_GENE, a
-0005ece0: 626e 5f74 685f 7420 3d20 4d49 4e5f 4142  bn_th_t = MIN_AB
-0005ecf0: 4e5f 544f 5f53 454c 2c20 5c0a 2020 2020  N_TO_SEL, \.    
-0005ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ed30: 2020 2020 2020 2020 2020 2061 626e 5f74             abn_t
-0005ed40: 685f 6920 3d20 4d49 4e5f 4142 4e5f 544f  h_i = MIN_ABN_TO
-0005ed50: 5f53 454c 2c20 6973 6f5f 6672 6163 5f74  _SEL, iso_frac_t
-0005ed60: 6820 3d20 4d49 4e5f 4953 4f5f 4652 4143  h = MIN_ISO_FRAC
-0005ed70: 2c20 6c65 6e5f 7468 203d 204d 494e 5f54  , len_th = MIN_T
-0005ed80: 525f 4c45 4e47 5448 2029 0a20 2020 2020  R_LENGTH ).     
+0005ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ec60: 2020 2020 2020 6162 6e5f 7468 5f69 203d        abn_th_i =
+0005ec70: 204d 494e 5f41 424e 5f54 4f5f 5345 4c2c   MIN_ABN_TO_SEL,
+0005ec80: 2069 736f 5f66 7261 635f 7468 203d 204d   iso_frac_th = M
+0005ec90: 494e 5f49 534f 5f46 5241 432c 206c 656e  IN_ISO_FRAC, len
+0005eca0: 5f74 6820 3d20 4d49 4e5f 5452 5f4c 454e  _th = MIN_TR_LEN
+0005ecb0: 4754 4820 290a 2020 2020 2020 2020 2020  GTH ).          
+0005ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ecd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0005ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ed00: 6220 3d20 7365 6c66 2e63 6865 636b 5f74  b = self.check_t
+0005ed10: 725f 3228 7464 2c20 6672 6167 5f6c 656e  r_2(td, frag_len
+0005ed20: 203d 2073 656c 662e 7265 6164 5f6c 656e   = self.read_len
+0005ed30: 2c20 675f 7468 203d 204d 494e 5f4e 5f52  , g_th = MIN_N_R
+0005ed40: 4453 5f50 4552 5f47 454e 452c 2061 626e  DS_PER_GENE, abn
+0005ed50: 5f74 685f 7420 3d20 4d49 4e5f 4142 4e5f  _th_t = MIN_ABN_
+0005ed60: 544f 5f53 454c 2c20 5c0a 2020 2020 2020  TO_SEL, \.      
+0005ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005eda0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0005edb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005edd0: 2020 2020 2062 203d 2073 656c 662e 6368       b = self.ch
-0005ede0: 6563 6b5f 7472 5f32 2874 642c 2066 7261  eck_tr_2(td, fra
-0005edf0: 675f 6c65 6e20 3d20 7365 6c66 2e72 6561  g_len = self.rea
-0005ee00: 645f 6c65 6e2c 2067 5f74 6820 3d20 4d49  d_len, g_th = MI
-0005ee10: 4e5f 4e5f 5244 535f 5045 525f 4745 4e45  N_N_RDS_PER_GENE
-0005ee20: 2c20 6162 6e5f 7468 5f74 203d 204d 494e  , abn_th_t = MIN
-0005ee30: 5f41 424e 5f54 4f5f 5345 4c2c 205c 0a20  _ABN_TO_SEL, \. 
-0005ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005eda0: 2020 2020 2020 2020 2061 626e 5f74 685f           abn_th_
+0005edb0: 6920 3d20 4d49 4e5f 4142 4e5f 544f 5f53  i = MIN_ABN_TO_S
+0005edc0: 454c 2c20 6973 6f5f 6672 6163 5f74 6820  EL, iso_frac_th 
+0005edd0: 3d20 4d49 4e5f 4953 4f5f 4652 4143 2c20  = MIN_ISO_FRAC, 
+0005ede0: 6c65 6e5f 7468 203d 204d 494e 5f54 525f  len_th = MIN_TR_
+0005edf0: 4c45 4e47 5448 2029 0a20 2020 2020 2020  LENGTH ).       
+0005ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ee10: 2020 2020 2020 2020 2069 6620 623a 0a20           if b:. 
+0005ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ee40: 2020 206c 696e 655f 6c73 7420 3d20 6c69     line_lst = li
+0005ee50: 6e65 5f6c 7374 202b 2067 6c73 0a20 2020  ne_lst + gls.   
 0005ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ee70: 2020 2020 2020 2020 2020 2020 2020 6162                ab
-0005ee80: 6e5f 7468 5f69 203d 204d 494e 5f41 424e  n_th_i = MIN_ABN
-0005ee90: 5f54 4f5f 5345 4c2c 2069 736f 5f66 7261  _TO_SEL, iso_fra
-0005eea0: 635f 7468 203d 204d 494e 5f49 534f 5f46  c_th = MIN_ISO_F
-0005eeb0: 5241 432c 206c 656e 5f74 6820 3d20 4d49  RAC, len_th = MI
-0005eec0: 4e5f 5452 5f4c 454e 4754 4820 290a 2020  N_TR_LENGTH ).  
-0005eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005eee0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005eef0: 2062 3a0a 2020 2020 2020 2020 2020 2020   b:.            
-0005ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ef10: 2020 2020 2020 2020 6c69 6e65 5f6c 7374          line_lst
-0005ef20: 203d 206c 696e 655f 6c73 7420 2b20 676c   = line_lst + gl
-0005ef30: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0005ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ef50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0005ee70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0005ee80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0005ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005eea0: 2020 2020 2020 2063 6e74 5f6e 6f6e 6520         cnt_none 
+0005eeb0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0005eec0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0005eed0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0005eee0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0005eef0: 6c73 203d 2074 642e 6765 745f 6774 665f  ls = td.get_gtf_
+0005ef00: 6c69 6e65 735f 6672 6f6d 5f65 786f 6e73  lines_from_exons
+0005ef10: 2873 656c 662e 6578 6f6e 732e 7267 6e73  (self.exons.rgns
+0005ef20: 2c20 7365 6c66 2e72 676e 732e 7267 6e73  , self.rgns.rgns
+0005ef30: 2c20 7365 6c66 2e63 6473 2e72 676e 732c  , self.cds.rgns,
+0005ef40: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0005ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ef70: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-0005ef80: 6e6f 6e65 202b 3d20 310a 2020 2020 2020  none += 1.      
-0005ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005efa0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0005efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005efc0: 2020 2020 676c 7320 3d20 7464 2e67 6574      gls = td.get
-0005efd0: 5f67 7466 5f6c 696e 6573 5f66 726f 6d5f  _gtf_lines_from_
-0005efe0: 6578 6f6e 7328 7365 6c66 2e65 786f 6e73  exons(self.exons
-0005eff0: 2e72 676e 732c 2073 656c 662e 7267 6e73  .rgns, self.rgns
-0005f000: 2e72 676e 732c 2073 656c 662e 6364 732e  .rgns, self.cds.
-0005f010: 7267 6e73 2c20 5c0a 2020 2020 2020 2020  rgns, \.        
+0005ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ef80: 2067 656e 6f6d 652c 2073 656c 203d 2073   genome, sel = s
+0005ef90: 656c 2c20 6164 645f 7365 7120 3d20 6164  el, add_seq = ad
+0005efa0: 645f 7365 712c 2063 6f6e 6e65 6374 203d  d_seq, connect =
+0005efb0: 2063 6f6e 6e65 6374 290a 2020 2020 2020   connect).      
+0005efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005efd0: 2020 2020 2020 6966 206c 656e 2867 6c73        if len(gls
+0005efe0: 2920 3c3d 2031 3a0a 2020 2020 2020 2020  ) <= 1:.        
+0005eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f000: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
+0005f010: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
 0005f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f050: 2020 2020 2020 6765 6e6f 6d65 2c20 7365        genome, se
-0005f060: 6c20 3d20 7365 6c2c 2061 6464 5f73 6571  l = sel, add_seq
-0005f070: 203d 2061 6464 5f73 6571 2c20 636f 6e6e   = add_seq, conn
-0005f080: 6563 7420 3d20 636f 6e6e 6563 7429 0a20  ect = connect). 
+0005f030: 2020 2020 2020 2320 7072 696e 7428 2745        # print('E
+0005f040: 5252 4f52 2069 6e20 6764 2e67 6574 5f67  RROR in gd.get_g
+0005f050: 7466 5f6c 696e 6573 5f66 726f 6d5f 6578  tf_lines_from_ex
+0005f060: 6f6e 733a 204c 656e 2847 5446 206c 696e  ons: Len(GTF lin
+0005f070: 6573 2920 3d3d 2025 6920 4c28 2569 2c25  es) == %i L(%i,%
+0005f080: 6929 2720 5c0a 2020 2020 2020 2020 2020  i)' \.          
 0005f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f0a0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0005f0b0: 6e28 676c 7329 203c 3d20 313a 0a20 2020  n(gls) <= 1:.   
-0005f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f0d0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
-0005f0e0: 5f6e 6f6e 6520 2b3d 2031 0a20 2020 2020  _none += 1.     
+0005f0a0: 2020 2020 2020 2320 2020 2020 2020 2025        #        %
+0005f0b0: 2028 6c65 6e28 676c 7329 2c20 6c65 6e28   (len(gls), len(
+0005f0c0: 7464 2e74 655f 746f 5f67 655f 6d61 7029  td.te_to_ge_map)
+0005f0d0: 2c20 6c65 6e28 7464 2e74 725f 746f 5f67  , len(td.tr_to_g
+0005f0e0: 725f 6d61 7029 2920 290a 2020 2020 2020  r_map)) ).      
 0005f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f100: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-0005f110: 6e74 2827 4552 524f 5220 696e 2067 642e  nt('ERROR in gd.
-0005f120: 6765 745f 6774 665f 6c69 6e65 735f 6672  get_gtf_lines_fr
-0005f130: 6f6d 5f65 786f 6e73 3a20 4c65 6e28 4754  om_exons: Len(GT
-0005f140: 4620 6c69 6e65 7329 203d 3d20 2569 204c  F lines) == %i L
-0005f150: 2825 692c 2569 2927 205c 0a20 2020 2020  (%i,%i)' \.     
-0005f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f170: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0005f180: 2020 2020 2520 286c 656e 2867 6c73 292c      % (len(gls),
-0005f190: 206c 656e 2874 642e 7465 5f74 6f5f 6765   len(td.te_to_ge
-0005f1a0: 5f6d 6170 292c 206c 656e 2874 642e 7472  _map), len(td.tr
-0005f1b0: 5f74 6f5f 6772 5f6d 6170 2929 2029 0a20  _to_gr_map)) ). 
-0005f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f1d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0005f1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f200: 206c 696e 655f 6c73 7420 3d20 6c69 6e65   line_lst = line
-0005f210: 5f6c 7374 202b 2067 6c73 0a20 2020 2020  _lst + gls.     
-0005f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f230: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0005f240: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0005f250: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0005f260: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
-0005f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f280: 2020 2020 2020 2070 7269 6e74 2827 4578         print('Ex
-0005f290: 6365 7074 696f 6e20 2825 6929 3a20 436f  ception (%i): Co
-0005f2a0: 763a 2025 342e 3266 2c20 2534 2e32 662c  v: %4.2f, %4.2f,
-0005f2b0: 2025 692c 204c 6572 633a 2025 692c 2025   %i, Lerc: %i, %
-0005f2c0: 692c 2025 6920 2d20 2569 2c20 2569 2c20  i, %i - %i, %i, 
-0005f2d0: 2569 2027 2025 2028 7365 6c2c 2063 6f76  %i ' % (sel, cov
-0005f2e0: 5f74 682c 2074 642e 636f 762c 2074 642e  _th, td.cov, td.
-0005f2f0: 636f 765f 6c65 6e2c 205c 0a20 2020 2020  cov_len, \.     
+0005f100: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0005f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f120: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0005f130: 5f6c 7374 203d 206c 696e 655f 6c73 7420  _lst = line_lst 
+0005f140: 2b20 676c 730a 2020 2020 2020 2020 2020  + gls.          
+0005f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f160: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0005f170: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0005f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f190: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+0005f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f1b0: 2020 7072 696e 7428 2745 7863 6570 7469    print('Excepti
+0005f1c0: 6f6e 2028 2569 293a 2043 6f76 3a20 2534  on (%i): Cov: %4
+0005f1d0: 2e32 662c 2025 342e 3266 2c20 2569 2c20  .2f, %4.2f, %i, 
+0005f1e0: 4c65 7263 3a20 2569 2c20 2569 2c20 2569  Lerc: %i, %i, %i
+0005f1f0: 202d 2025 692c 2025 692c 2025 6920 2720   - %i, %i, %i ' 
+0005f200: 2520 2873 656c 2c20 636f 765f 7468 2c20  % (sel, cov_th, 
+0005f210: 7464 2e63 6f76 2c20 7464 2e63 6f76 5f6c  td.cov, td.cov_l
+0005f220: 656e 2c20 5c0a 2020 2020 2020 2020 2020  en, \.          
+0005f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f240: 2020 2020 2020 206c 656e 2873 656c 662e         len(self.
+0005f250: 7465 5f74 6f5f 6765 5f6d 6170 735b 6b5d  te_to_ge_maps[k]
+0005f260: 292c 206c 656e 2873 656c 662e 7472 5f74  ), len(self.tr_t
+0005f270: 6f5f 6772 5f6d 6170 735b 6b5d 292c 206c  o_gr_maps[k]), l
+0005f280: 656e 2873 656c 662e 7463 5f74 6f5f 6763  en(self.tc_to_gc
+0005f290: 5f6d 6170 735b 6b5d 292c 205c 0a20 2020  _maps[k]), \.   
+0005f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f2b0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+0005f2c0: 6e28 7365 6c66 2e65 786f 6e73 2e72 676e  n(self.exons.rgn
+0005f2d0: 7329 2c20 6c65 6e28 7365 6c66 2e72 676e  s), len(self.rgn
+0005f2e0: 732e 7267 6e73 292c 206c 656e 2873 656c  s.rgns), len(sel
+0005f2f0: 662e 6364 732e 7267 6e73 2929 2029 0a20  f.cds.rgns)) ). 
 0005f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f310: 2020 2020 2020 2020 2020 2020 6c65 6e28              len(
-0005f320: 7365 6c66 2e74 655f 746f 5f67 655f 6d61  self.te_to_ge_ma
-0005f330: 7073 5b6b 5d29 2c20 6c65 6e28 7365 6c66  ps[k]), len(self
-0005f340: 2e74 725f 746f 5f67 725f 6d61 7073 5b6b  .tr_to_gr_maps[k
-0005f350: 5d29 2c20 6c65 6e28 7365 6c66 2e74 635f  ]), len(self.tc_
-0005f360: 746f 5f67 635f 6d61 7073 5b6b 5d29 2c20  to_gc_maps[k]), 
-0005f370: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0005f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f390: 2020 206c 656e 2873 656c 662e 6578 6f6e     len(self.exon
-0005f3a0: 732e 7267 6e73 292c 206c 656e 2873 656c  s.rgns), len(sel
-0005f3b0: 662e 7267 6e73 2e72 676e 7329 2c20 6c65  f.rgns.rgns), le
-0005f3c0: 6e28 7365 6c66 2e63 6473 2e72 676e 7329  n(self.cds.rgns)
-0005f3d0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0005f3e0: 2020 2020 2020 2020 2020 2020 2327 2727              #'''
-0005f3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f400: 2020 2020 2020 2020 2063 6e74 5f6e 6f6e           cnt_non
-0005f410: 6520 2b3d 2031 0a20 2020 2020 2020 2020  e += 1.         
-0005f420: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0005f430: 6173 730a 0a20 2020 2020 2020 2020 2020  ass..           
-0005f440: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0005f450: 2020 2020 2020 2066 6f72 206b 2c20 7464         for k, td
-0005f460: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-0005f470: 6c66 2e74 645f 6c73 7429 3a0a 2020 2020  lf.td_lst):.    
-0005f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f490: 6966 2028 6c65 6e28 7365 6c66 2e74 655f  if (len(self.te_
-0005f4a0: 746f 5f67 655f 6d61 7073 5b6b 5d29 203e  to_ge_maps[k]) >
-0005f4b0: 2030 293a 200a 2020 2020 2020 2020 2020   0): .          
-0005f4c0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0005f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f4e0: 2020 2020 2020 2074 642e 7472 5f74 6f5f         td.tr_to_
-0005f4f0: 6772 5f6d 6170 203d 2063 6f70 792e 6465  gr_map = copy.de
-0005f500: 6570 636f 7079 2873 656c 662e 7472 5f74  epcopy(self.tr_t
-0005f510: 6f5f 6772 5f6d 6170 735b 6b5d 290a 2020  o_gr_maps[k]).  
-0005f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f530: 2020 2020 2020 7464 2e74 655f 746f 5f67        td.te_to_g
-0005f540: 655f 6d61 7020 3d20 636f 7079 2e64 6565  e_map = copy.dee
-0005f550: 7063 6f70 7928 7365 6c66 2e74 655f 746f  pcopy(self.te_to
-0005f560: 5f67 655f 6d61 7073 5b6b 5d29 0a20 2020  _ge_maps[k]).   
+0005f310: 2020 2020 2020 2023 2727 270a 2020 2020         #'''.    
+0005f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f330: 2020 2020 636e 745f 6e6f 6e65 202b 3d20      cnt_none += 
+0005f340: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0005f350: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+0005f360: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0005f370: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0005f380: 2020 666f 7220 6b2c 2074 6420 696e 2065    for k, td in e
+0005f390: 6e75 6d65 7261 7465 2873 656c 662e 7464  numerate(self.td
+0005f3a0: 5f6c 7374 293a 0a20 2020 2020 2020 2020  _lst):.         
+0005f3b0: 2020 2020 2020 2020 2020 2069 6620 286c             if (l
+0005f3c0: 656e 2873 656c 662e 7465 5f74 6f5f 6765  en(self.te_to_ge
+0005f3d0: 5f6d 6170 735b 6b5d 2920 3e20 3029 3a20  _maps[k]) > 0): 
+0005f3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005f3f0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0005f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f410: 2020 7464 2e74 725f 746f 5f67 725f 6d61    td.tr_to_gr_ma
+0005f420: 7020 3d20 636f 7079 2e64 6565 7063 6f70  p = copy.deepcop
+0005f430: 7928 7365 6c66 2e74 725f 746f 5f67 725f  y(self.tr_to_gr_
+0005f440: 6d61 7073 5b6b 5d29 0a20 2020 2020 2020  maps[k]).       
+0005f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f460: 2074 642e 7465 5f74 6f5f 6765 5f6d 6170   td.te_to_ge_map
+0005f470: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0005f480: 2873 656c 662e 7465 5f74 6f5f 6765 5f6d  (self.te_to_ge_m
+0005f490: 6170 735b 6b5d 290a 2020 2020 2020 2020  aps[k]).        
+0005f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f4b0: 7464 2e74 635f 746f 5f67 635f 6d61 7020  td.tc_to_gc_map 
+0005f4c0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+0005f4d0: 7365 6c66 2e74 635f 746f 5f67 635f 6d61  self.tc_to_gc_ma
+0005f4e0: 7073 5b6b 5d29 0a20 2020 2020 2020 2020  ps[k]).         
+0005f4f0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0005f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f510: 2020 2020 2020 2020 676c 7320 3d20 7464          gls = td
+0005f520: 2e67 6574 5f67 7466 5f6c 696e 6573 5f66  .get_gtf_lines_f
+0005f530: 726f 6d5f 6578 6f6e 7328 7365 6c66 2e65  rom_exons(self.e
+0005f540: 786f 6e73 2e72 676e 732c 2073 656c 662e  xons.rgns, self.
+0005f550: 7267 6e73 2e72 676e 732c 2073 656c 662e  rgns.rgns, self.
+0005f560: 6364 732e 7267 6e73 2c20 5c0a 2020 2020  cds.rgns, \.    
 0005f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f580: 2020 2020 2074 642e 7463 5f74 6f5f 6763       td.tc_to_gc
-0005f590: 5f6d 6170 203d 2063 6f70 792e 6465 6570  _map = copy.deep
-0005f5a0: 636f 7079 2873 656c 662e 7463 5f74 6f5f  copy(self.tc_to_
-0005f5b0: 6763 5f6d 6170 735b 6b5d 290a 2020 2020  gc_maps[k]).    
-0005f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f5d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0005f5e0: 2020 2020 2020 2020 2020 2020 2067 6c73               gls
-0005f5f0: 203d 2074 642e 6765 745f 6774 665f 6c69   = td.get_gtf_li
-0005f600: 6e65 735f 6672 6f6d 5f65 786f 6e73 2873  nes_from_exons(s
-0005f610: 656c 662e 6578 6f6e 732e 7267 6e73 2c20  elf.exons.rgns, 
-0005f620: 7365 6c66 2e72 676e 732e 7267 6e73 2c20  self.rgns.rgns, 
-0005f630: 7365 6c66 2e63 6473 2e72 676e 732c 205c  self.cds.rgns, \
-0005f640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f670: 2020 2020 2020 2020 2020 2067 656e 6f6d             genom
-0005f680: 652c 2073 656c 203d 2073 656c 2c20 6164  e, sel = sel, ad
-0005f690: 645f 7365 7120 3d20 6164 645f 7365 712c  d_seq = add_seq,
-0005f6a0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0005f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f6d0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0005f6e0: 6e65 6374 203d 2063 6f6e 6e65 6374 290a  nect = connect).
-0005f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f700: 2020 2020 2020 2020 6c69 6e65 5f6c 7374          line_lst
-0005f710: 203d 206c 696e 655f 6c73 7420 2b20 676c   = line_lst + gl
-0005f720: 730a 0a20 2020 2020 2020 2020 2020 2027  s..            '
-0005f730: 2727 0a20 2020 2020 2020 2020 2020 2073  ''.            s
-0005f740: 656c 662e 6765 745f 7370 616e 2829 0a20  elf.get_span(). 
-0005f750: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
-0005f760: 656c 662e 7370 616e 2e73 7461 7274 203e  elf.span.start >
-0005f770: 2030 2920 2620 2873 656c 662e 7370 616e   0) & (self.span
-0005f780: 2e65 6e64 203e 2030 293a 0a0a 2020 2020  .end > 0):..    
-0005f790: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005f7a0: 2e62 6567 696e 203d 2073 656c 662e 7370  .begin = self.sp
-0005f7b0: 616e 2e73 7461 7274 0a20 2020 2020 2020  an.start.       
-0005f7c0: 2020 2020 2020 2020 2073 656c 662e 656e           self.en
-0005f7d0: 6420 3d20 7365 6c66 2e73 7061 6e2e 656e  d = self.span.en
-0005f7e0: 640a 0a20 2020 2020 2020 2020 2020 2020  d..             
-0005f7f0: 2020 2061 7474 725f 6864 7220 3d20 2767     attr_hdr = 'g
-0005f800: 656e 655f 6964 2022 2573 223b 2067 656e  ene_id "%s"; gen
-0005f810: 655f 6e61 6d65 2022 2573 223b 2720 2520  e_name "%s";' % 
-0005f820: 2873 656c 662e 7464 5f6c 7374 5b30 5d2e  (self.td_lst[0].
-0005f830: 6769 642c 2073 656c 662e 7464 5f6c 7374  gid, self.td_lst
-0005f840: 5b30 5d2e 676e 616d 6529 0a20 2020 2020  [0].gname).     
-0005f850: 2020 2020 2020 2020 2020 2061 7474 725f             attr_
-0005f860: 7461 696c 203d 2027 2720 2320 2720 636f  tail = '' # ' co
-0005f870: 7620 2225 332e 3166 223b 2061 626e 2022  v "%3.1f"; abn "
-0005f880: 2533 2e31 6622 3b27 2025 2028 7365 6c66  %3.1f";' % (self
-0005f890: 2e63 6f76 2c20 7365 6c66 2e61 626e 2029  .cov, self.abn )
-0005f8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f8b0: 2061 7474 7220 3d20 6174 7472 5f68 6472   attr = attr_hdr
-0005f8c0: 202b 2061 7474 725f 7461 696c 0a0a 2020   + attr_tail..  
-0005f8d0: 2020 2020 2020 2020 2020 2020 2020 6320                c 
-0005f8e0: 3d20 6765 745f 635f 6672 6f6d 5f69 7374  = get_c_from_ist
-0005f8f0: 7261 6e64 2873 656c 662e 7464 5f6c 7374  rand(self.td_lst
-0005f900: 5b30 5d2e 6973 7472 616e 6429 0a20 2020  [0].istrand).   
-0005f910: 2020 2020 2020 2020 2020 2020 2067 7466               gtf
-0005f920: 5f6c 696e 655f 6864 7220 3d20 4754 465f  _line_hdr = GTF_
-0005f930: 6c69 6e65 2873 656c 662e 6368 722c 2047  line(self.chr, G
-0005f940: 5446 5f53 4f55 5243 452c 2027 6765 6e65  TF_SOURCE, 'gene
-0005f950: 272c 2073 656c 662e 7370 616e 2e73 7461  ', self.span.sta
-0005f960: 7274 2c20 7365 6c66 2e73 7061 6e2e 656e  rt, self.span.en
-0005f970: 642c 2027 3027 2c20 632c 2027 3027 2c20  d, '0', c, '0', 
-0005f980: 6174 7472 2c20 5c0a 2020 2020 2020 2020  attr, \.        
-0005f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f9a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005f9b0: 2e74 645f 6c73 745b 305d 2e67 6964 2c20  .td_lst[0].gid, 
-0005f9c0: 7365 6c66 2e74 645f 6c73 745b 305d 2e67  self.td_lst[0].g
-0005f9d0: 6e61 6d65 2c20 2727 2c20 2727 2029 0a20  name, '', '' ). 
-0005f9e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0005f9f0: 696e 655f 6c73 7420 3d20 5b67 7466 5f6c  ine_lst = [gtf_l
-0005fa00: 696e 655f 6864 725d 202b 206c 696e 655f  ine_hdr] + line_
-0005fa10: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
-0005fa20: 2327 2727 2020 2020 0a20 2020 2020 2020  #'''    .       
-0005fa30: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0005fa40: 2020 7265 7475 726e 206c 696e 655f 6c73    return line_ls
-0005fa50: 742c 2063 6e74 5f6e 6f6e 650a 2020 2020  t, cnt_none.    
-0005fa60: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0005fa70: 2020 2020 2020 2020 200a 2020 2020 6465           .    de
-0005fa80: 6620 6765 745f 6661 7374 615f 6c69 6e65  f get_fasta_line
-0005fa90: 735f 6672 6f6d 5f65 786f 6e73 2873 656c  s_from_exons(sel
-0005faa0: 662c 2067 656e 6f6d 6520 3d20 4e6f 6e65  f, genome = None
-0005fab0: 2c20 7365 6c20 3d20 302c 2070 6570 7469  , sel = 0, pepti
-0005fac0: 6465 203d 2046 616c 7365 2c20 5c0a 2020  de = False, \.  
-0005fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005faf0: 204c 5f74 685f 7420 3d20 4d49 4e5f 5452   L_th_t = MIN_TR
-0005fb00: 5f4c 454e 4754 482c 204c 5f74 685f 7020  _LENGTH, L_th_p 
-0005fb10: 3d20 4d49 4e5f 5052 5f4c 454e 4754 4829  = MIN_PR_LENGTH)
-0005fb20: 3a20 0a20 2020 2020 2020 200a 2020 2020  : .        .    
-0005fb30: 2020 2020 6c69 6e65 5f6c 7374 203d 205b      line_lst = [
-0005fb40: 5d0a 2020 2020 2020 2020 6c69 6e65 5f6c  ].        line_l
-0005fb50: 7374 3220 3d20 5b5d 0a20 2020 2020 2020  st2 = [].       
-0005fb60: 2069 6620 6c65 6e28 7365 6c66 2e74 645f   if len(self.td_
-0005fb70: 6c73 7429 203e 2030 3a0a 2020 2020 2020  lst) > 0:.      
-0005fb80: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0005fb90: 2020 2069 6620 7365 6c20 3d3d 2030 3a20     if sel == 0: 
-0005fba0: 7365 6c66 2e72 676e 732e 7365 745f 6376  self.rgns.set_cv
-0005fbb0: 6728 290a 2020 2020 2020 2020 2020 2020  g().            
-0005fbc0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0005fbd0: 2020 2020 2020 6966 2067 656e 6f6d 6520        if genome 
-0005fbe0: 6973 204e 6f6e 653a 2073 656c 662e 6578  is None: self.ex
-0005fbf0: 6f6e 732e 7365 745f 6376 6728 290a 2020  ons.set_cvg().  
-0005fc00: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0005fc10: 2020 2020 2020 2069 6620 7365 6c20 3c20         if sel < 
-0005fc20: 323a 0a0a 2020 2020 2020 2020 2020 2020  2:..            
-0005fc30: 2020 2020 6966 2073 656c 203d 3d20 303a      if sel == 0:
-0005fc40: 2074 676d 203d 2073 656c 662e 7472 5f74   tgm = self.tr_t
-0005fc50: 6f5f 6772 5f6d 6170 730a 2020 2020 2020  o_gr_maps.      
-0005fc60: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-0005fc70: 7467 6d20 3d20 7365 6c66 2e74 655f 746f  tgm = self.te_to
-0005fc80: 5f67 655f 6d61 7073 0a0a 2020 2020 2020  _ge_maps..      
-0005fc90: 2020 2020 2020 2020 2020 6966 2028 7365            if (se
-0005fca0: 6c66 2e63 6f76 5f74 6820 3d3d 2030 293a  lf.cov_th == 0):
-0005fcb0: 2063 6f76 5f74 6820 3d20 2d31 0a20 2020   cov_th = -1.   
-0005fcc0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0005fcd0: 653a 2063 6f76 5f74 6820 3d20 7365 6c66  e: cov_th = self
-0005fce0: 2e63 6f76 5f74 680a 2020 2020 2020 2020  .cov_th.        
-0005fcf0: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
-0005fd00: 2e61 626e 5f74 6820 3d3d 2030 293a 2061  .abn_th == 0): a
-0005fd10: 626e 5f74 6820 3d20 2d31 0a20 2020 2020  bn_th = -1.     
-0005fd20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0005fd30: 2061 626e 5f74 6820 3d20 7365 6c66 2e61   abn_th = self.a
-0005fd40: 626e 5f74 680a 0a20 2020 2020 2020 2020  bn_th..         
-0005fd50: 2020 2020 2020 2063 6e74 2020 3d20 300a         cnt  = 0.
-0005fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fd70: 666f 7220 6b2c 2074 6420 696e 2065 6e75  for k, td in enu
-0005fd80: 6d65 7261 7465 2873 656c 662e 7464 5f6c  merate(self.td_l
-0005fd90: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-0005fda0: 2020 2020 2020 2020 2069 6620 2874 642e           if (td.
-0005fdb0: 636f 7620 3e3d 2063 6f76 5f74 6829 2026  cov >= cov_th) &
-0005fdc0: 2028 6c65 6e28 7467 6d5b 6b5d 2920 3e20   (len(tgm[k]) > 
-0005fdd0: 3029 2026 2028 7464 2e61 626e 203e 3d20  0) & (td.abn >= 
-0005fde0: 6162 6e5f 7468 293a 2020 0a0a 2020 2020  abn_th):  ..    
-0005fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fe00: 2020 2020 7464 2e74 725f 746f 5f67 725f      td.tr_to_gr_
-0005fe10: 6d61 7020 3d20 636f 7079 2e64 6565 7063  map = copy.deepc
-0005fe20: 6f70 7928 7365 6c66 2e74 725f 746f 5f67  opy(self.tr_to_g
-0005fe30: 725f 6d61 7073 5b6b 5d29 0a20 2020 2020  r_maps[k]).     
-0005fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fe50: 2020 2074 642e 7465 5f74 6f5f 6765 5f6d     td.te_to_ge_m
-0005fe60: 6170 203d 2063 6f70 792e 6465 6570 636f  ap = copy.deepco
-0005fe70: 7079 2873 656c 662e 7465 5f74 6f5f 6765  py(self.te_to_ge
-0005fe80: 5f6d 6170 735b 6b5d 290a 2020 2020 2020  _maps[k]).      
-0005fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fea0: 2020 7464 2e74 635f 746f 5f67 635f 6d61    td.tc_to_gc_ma
-0005feb0: 7020 3d20 636f 7079 2e64 6565 7063 6f70  p = copy.deepcop
-0005fec0: 7928 7365 6c66 2e74 635f 746f 5f67 635f  y(self.tc_to_gc_
-0005fed0: 6d61 7073 5b6b 5d29 0a20 2020 2020 2020  maps[k]).       
-0005fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fef0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0005ff00: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0005ff10: 2073 656c 662e 6774 663a 2023 2028 6c65   self.gtf: # (le
-0005ff20: 6e28 7464 2e74 655f 746f 5f67 655f 6d61  n(td.te_to_ge_ma
-0005ff30: 7029 203d 3d20 303a 0a20 2020 2020 2020  p) == 0:.       
-0005ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ff50: 2020 2020 2066 615f 7365 712c 2066 615f       fa_seq, fa_
-0005ff60: 6173 6571 203d 205c 0a20 2020 2020 2020  aseq = \.       
-0005ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ff80: 2020 2020 2020 2020 2074 642e 6765 745f           td.get_
-0005ff90: 6661 7374 615f 6c69 6e65 735f 6672 6f6d  fasta_lines_from
-0005ffa0: 5f65 786f 6e73 2873 656c 662e 6578 6f6e  _exons(self.exon
-0005ffb0: 732e 7267 6e73 2c20 7365 6c66 2e72 676e  s.rgns, self.rgn
-0005ffc0: 732e 7267 6e73 2c20 7365 6c66 2e63 6473  s.rgns, self.cds
-0005ffd0: 2e72 676e 732c 205c 0a20 2020 2020 2020  .rgns, \.       
-0005ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060010: 2020 2020 2020 2067 656e 6f6d 652c 2073         genome, s
-00060020: 656c 2c20 7065 7074 6964 652c 204c 5f74  el, peptide, L_t
-00060030: 685f 7420 3d20 4c5f 7468 5f74 2c20 4c5f  h_t = L_th_t, L_
-00060040: 7468 5f70 203d 204c 5f74 685f 7029 0a0a  th_p = L_th_p)..
+0005f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f5a0: 2020 2020 2020 6765 6e6f 6d65 2c20 7365        genome, se
+0005f5b0: 6c20 3d20 7365 6c2c 2061 6464 5f73 6571  l = sel, add_seq
+0005f5c0: 203d 2061 6464 5f73 6571 2c20 5c0a 2020   = add_seq, \.  
+0005f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f600: 2020 2020 2020 2020 636f 6e6e 6563 7420          connect 
+0005f610: 3d20 636f 6e6e 6563 7429 0a20 2020 2020  = connect).     
+0005f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f630: 2020 206c 696e 655f 6c73 7420 3d20 6c69     line_lst = li
+0005f640: 6e65 5f6c 7374 202b 2067 6c73 0a0a 2020  ne_lst + gls..  
+0005f650: 2020 2020 2020 2020 2020 2727 270a 2020            '''.  
+0005f660: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+0005f670: 6574 5f73 7061 6e28 290a 2020 2020 2020  et_span().      
+0005f680: 2020 2020 2020 6966 2028 7365 6c66 2e73        if (self.s
+0005f690: 7061 6e2e 7374 6172 7420 3e20 3029 2026  pan.start > 0) &
+0005f6a0: 2028 7365 6c66 2e73 7061 6e2e 656e 6420   (self.span.end 
+0005f6b0: 3e20 3029 3a0a 0a20 2020 2020 2020 2020  > 0):..         
+0005f6c0: 2020 2020 2020 2073 656c 662e 6265 6769         self.begi
+0005f6d0: 6e20 3d20 7365 6c66 2e73 7061 6e2e 7374  n = self.span.st
+0005f6e0: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
+0005f6f0: 2020 2020 7365 6c66 2e65 6e64 203d 2073      self.end = s
+0005f700: 656c 662e 7370 616e 2e65 6e64 0a0a 2020  elf.span.end..  
+0005f710: 2020 2020 2020 2020 2020 2020 2020 6174                at
+0005f720: 7472 5f68 6472 203d 2027 6765 6e65 5f69  tr_hdr = 'gene_i
+0005f730: 6420 2225 7322 3b20 6765 6e65 5f6e 616d  d "%s"; gene_nam
+0005f740: 6520 2225 7322 3b27 2025 2028 7365 6c66  e "%s";' % (self
+0005f750: 2e74 645f 6c73 745b 305d 2e67 6964 2c20  .td_lst[0].gid, 
+0005f760: 7365 6c66 2e74 645f 6c73 745b 305d 2e67  self.td_lst[0].g
+0005f770: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+0005f780: 2020 2020 2020 6174 7472 5f74 6169 6c20        attr_tail 
+0005f790: 3d20 2727 2023 2027 2063 6f76 2022 2533  = '' # ' cov "%3
+0005f7a0: 2e31 6622 3b20 6162 6e20 2225 332e 3166  .1f"; abn "%3.1f
+0005f7b0: 223b 2720 2520 2873 656c 662e 636f 762c  ";' % (self.cov,
+0005f7c0: 2073 656c 662e 6162 6e20 290a 2020 2020   self.abn ).    
+0005f7d0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+0005f7e0: 203d 2061 7474 725f 6864 7220 2b20 6174   = attr_hdr + at
+0005f7f0: 7472 5f74 6169 6c0a 0a20 2020 2020 2020  tr_tail..       
+0005f800: 2020 2020 2020 2020 2063 203d 2067 6574           c = get
+0005f810: 5f63 5f66 726f 6d5f 6973 7472 616e 6428  _c_from_istrand(
+0005f820: 7365 6c66 2e74 645f 6c73 745b 305d 2e69  self.td_lst[0].i
+0005f830: 7374 7261 6e64 290a 2020 2020 2020 2020  strand).        
+0005f840: 2020 2020 2020 2020 6774 665f 6c69 6e65          gtf_line
+0005f850: 5f68 6472 203d 2047 5446 5f6c 696e 6528  _hdr = GTF_line(
+0005f860: 7365 6c66 2e63 6872 2c20 4754 465f 534f  self.chr, GTF_SO
+0005f870: 5552 4345 2c20 2767 656e 6527 2c20 7365  URCE, 'gene', se
+0005f880: 6c66 2e73 7061 6e2e 7374 6172 742c 2073  lf.span.start, s
+0005f890: 656c 662e 7370 616e 2e65 6e64 2c20 2730  elf.span.end, '0
+0005f8a0: 272c 2063 2c20 2730 272c 2061 7474 722c  ', c, '0', attr,
+0005f8b0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0005f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f8d0: 2020 2020 2020 2073 656c 662e 7464 5f6c         self.td_l
+0005f8e0: 7374 5b30 5d2e 6769 642c 2073 656c 662e  st[0].gid, self.
+0005f8f0: 7464 5f6c 7374 5b30 5d2e 676e 616d 652c  td_lst[0].gname,
+0005f900: 2027 272c 2027 2720 290a 2020 2020 2020   '', '' ).      
+0005f910: 2020 2020 2020 2020 2020 6c69 6e65 5f6c            line_l
+0005f920: 7374 203d 205b 6774 665f 6c69 6e65 5f68  st = [gtf_line_h
+0005f930: 6472 5d20 2b20 6c69 6e65 5f6c 7374 0a20  dr] + line_lst. 
+0005f940: 2020 2020 2020 2020 2020 2023 2727 2720             #''' 
+0005f950: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0005f960: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
+0005f970: 7572 6e20 6c69 6e65 5f6c 7374 2c20 636e  urn line_lst, cn
+0005f980: 745f 6e6f 6e65 0a20 2020 2020 2020 2020  t_none.         
+0005f990: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0005f9a0: 2020 2020 0a20 2020 2064 6566 2067 6574      .    def get
+0005f9b0: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
+0005f9c0: 6d5f 6578 6f6e 7328 7365 6c66 2c20 6765  m_exons(self, ge
+0005f9d0: 6e6f 6d65 203d 204e 6f6e 652c 2073 656c  nome = None, sel
+0005f9e0: 203d 2030 2c20 7065 7074 6964 6520 3d20   = 0, peptide = 
+0005f9f0: 4661 6c73 652c 205c 0a20 2020 2020 2020  False, \.       
+0005fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fa10: 2020 2020 2020 2020 2020 2020 4c5f 7468              L_th
+0005fa20: 5f74 203d 204d 494e 5f54 525f 4c45 4e47  _t = MIN_TR_LENG
+0005fa30: 5448 2c20 4c5f 7468 5f70 203d 204d 494e  TH, L_th_p = MIN
+0005fa40: 5f50 525f 4c45 4e47 5448 293a 200a 2020  _PR_LENGTH): .  
+0005fa50: 2020 2020 2020 0a20 2020 2020 2020 206c        .        l
+0005fa60: 696e 655f 6c73 7420 3d20 5b5d 0a20 2020  ine_lst = [].   
+0005fa70: 2020 2020 206c 696e 655f 6c73 7432 203d       line_lst2 =
+0005fa80: 205b 5d0a 2020 2020 2020 2020 6966 206c   [].        if l
+0005fa90: 656e 2873 656c 662e 7464 5f6c 7374 2920  en(self.td_lst) 
+0005faa0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0005fab0: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+0005fac0: 2073 656c 203d 3d20 303a 2073 656c 662e   sel == 0: self.
+0005fad0: 7267 6e73 2e73 6574 5f63 7667 2829 0a20  rgns.set_cvg(). 
+0005fae0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0005faf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005fb00: 2069 6620 6765 6e6f 6d65 2069 7320 4e6f   if genome is No
+0005fb10: 6e65 3a20 7365 6c66 2e65 786f 6e73 2e73  ne: self.exons.s
+0005fb20: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
+0005fb30: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0005fb40: 2020 6966 2073 656c 203c 2032 3a0a 0a20    if sel < 2:.. 
+0005fb50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0005fb60: 6620 7365 6c20 3d3d 2030 3a20 7467 6d20  f sel == 0: tgm 
+0005fb70: 3d20 7365 6c66 2e74 725f 746f 5f67 725f  = self.tr_to_gr_
+0005fb80: 6d61 7073 0a20 2020 2020 2020 2020 2020  maps.           
+0005fb90: 2020 2020 2065 6c73 653a 2074 676d 203d       else: tgm =
+0005fba0: 2073 656c 662e 7465 5f74 6f5f 6765 5f6d   self.te_to_ge_m
+0005fbb0: 6170 730a 0a20 2020 2020 2020 2020 2020  aps..           
+0005fbc0: 2020 2020 2069 6620 2873 656c 662e 636f       if (self.co
+0005fbd0: 765f 7468 203d 3d20 3029 3a20 636f 765f  v_th == 0): cov_
+0005fbe0: 7468 203d 202d 310a 2020 2020 2020 2020  th = -1.        
+0005fbf0: 2020 2020 2020 2020 656c 7365 3a20 636f          else: co
+0005fc00: 765f 7468 203d 2073 656c 662e 636f 765f  v_th = self.cov_
+0005fc10: 7468 0a20 2020 2020 2020 2020 2020 2020  th.             
+0005fc20: 2020 2069 6620 2873 656c 662e 6162 6e5f     if (self.abn_
+0005fc30: 7468 203d 3d20 3029 3a20 6162 6e5f 7468  th == 0): abn_th
+0005fc40: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
+0005fc50: 2020 2020 2020 656c 7365 3a20 6162 6e5f        else: abn_
+0005fc60: 7468 203d 2073 656c 662e 6162 6e5f 7468  th = self.abn_th
+0005fc70: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005fc80: 2020 636e 7420 203d 2030 0a20 2020 2020    cnt  = 0.     
+0005fc90: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0005fca0: 2c20 7464 2069 6e20 656e 756d 6572 6174  , td in enumerat
+0005fcb0: 6528 7365 6c66 2e74 645f 6c73 7429 3a0a  e(self.td_lst):.
+0005fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fcd0: 2020 2020 6966 2028 7464 2e63 6f76 203e      if (td.cov >
+0005fce0: 3d20 636f 765f 7468 2920 2620 286c 656e  = cov_th) & (len
+0005fcf0: 2874 676d 5b6b 5d29 203e 2030 2920 2620  (tgm[k]) > 0) & 
+0005fd00: 2874 642e 6162 6e20 3e3d 2061 626e 5f74  (td.abn >= abn_t
+0005fd10: 6829 3a20 200a 0a20 2020 2020 2020 2020  h):  ..         
+0005fd20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0005fd30: 642e 7472 5f74 6f5f 6772 5f6d 6170 203d  d.tr_to_gr_map =
+0005fd40: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
+0005fd50: 656c 662e 7472 5f74 6f5f 6772 5f6d 6170  elf.tr_to_gr_map
+0005fd60: 735b 6b5d 290a 2020 2020 2020 2020 2020  s[k]).          
+0005fd70: 2020 2020 2020 2020 2020 2020 2020 7464                td
+0005fd80: 2e74 655f 746f 5f67 655f 6d61 7020 3d20  .te_to_ge_map = 
+0005fd90: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+0005fda0: 6c66 2e74 655f 746f 5f67 655f 6d61 7073  lf.te_to_ge_maps
+0005fdb0: 5b6b 5d29 0a20 2020 2020 2020 2020 2020  [k]).           
+0005fdc0: 2020 2020 2020 2020 2020 2020 2074 642e               td.
+0005fdd0: 7463 5f74 6f5f 6763 5f6d 6170 203d 2063  tc_to_gc_map = c
+0005fde0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
+0005fdf0: 662e 7463 5f74 6f5f 6763 5f6d 6170 735b  f.tc_to_gc_maps[
+0005fe00: 6b5d 290a 2020 2020 2020 2020 2020 2020  k]).            
+0005fe10: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0005fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fe30: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0005fe40: 2e67 7466 3a20 2320 286c 656e 2874 642e  .gtf: # (len(td.
+0005fe50: 7465 5f74 6f5f 6765 5f6d 6170 2920 3d3d  te_to_ge_map) ==
+0005fe60: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0005fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fe80: 6661 5f73 6571 2c20 6661 5f61 7365 7120  fa_seq, fa_aseq 
+0005fe90: 3d20 5c0a 2020 2020 2020 2020 2020 2020  = \.            
+0005fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005feb0: 2020 2020 7464 2e67 6574 5f66 6173 7461      td.get_fasta
+0005fec0: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
+0005fed0: 7328 7365 6c66 2e65 786f 6e73 2e72 676e  s(self.exons.rgn
+0005fee0: 732c 2073 656c 662e 7267 6e73 2e72 676e  s, self.rgns.rgn
+0005fef0: 732c 2073 656c 662e 6364 732e 7267 6e73  s, self.cds.rgns
+0005ff00: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+0005ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ff40: 2020 6765 6e6f 6d65 2c20 7365 6c2c 2070    genome, sel, p
+0005ff50: 6570 7469 6465 2c20 4c5f 7468 5f74 203d  eptide, L_th_t =
+0005ff60: 204c 5f74 685f 742c 204c 5f74 685f 7020   L_th_t, L_th_p 
+0005ff70: 3d20 4c5f 7468 5f70 290a 0a20 2020 2020  = L_th_p)..     
+0005ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ff90: 2020 2020 2020 2069 6620 5452 5f46 494c         if TR_FIL
+0005ffa0: 5445 525f 5345 4c20 3d3d 2031 3a0a 2020  TER_SEL == 1:.  
+0005ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ffc0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+0005ffd0: 3d20 7365 6c66 2e63 6865 636b 5f74 725f  = self.check_tr_
+0005ffe0: 3128 7464 2c20 6672 6167 5f6c 656e 203d  1(td, frag_len =
+0005fff0: 2073 656c 662e 7265 6164 5f6c 656e 2c20   self.read_len, 
+00060000: 675f 7468 203d 204d 494e 5f4e 5f52 4453  g_th = MIN_N_RDS
+00060010: 5f50 4552 5f47 454e 452c 2061 626e 5f74  _PER_GENE, abn_t
+00060020: 685f 7420 3d20 4d49 4e5f 4142 4e5f 544f  h_t = MIN_ABN_TO
+00060030: 5f53 454c 2c20 5c0a 2020 2020 2020 2020  _SEL, \.        
+00060040: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00060050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060060: 2020 2020 2020 2020 2020 2020 6966 2054              if T
-00060070: 525f 4649 4c54 4552 5f53 454c 203d 3d20  R_FILTER_SEL == 
-00060080: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00060090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000600a0: 2020 2062 203d 2073 656c 662e 6368 6563     b = self.chec
-000600b0: 6b5f 7472 5f31 2874 642c 2066 7261 675f  k_tr_1(td, frag_
-000600c0: 6c65 6e20 3d20 7365 6c66 2e72 6561 645f  len = self.read_
-000600d0: 6c65 6e2c 2067 5f74 6820 3d20 4d49 4e5f  len, g_th = MIN_
-000600e0: 4e5f 5244 535f 5045 525f 4745 4e45 2c20  N_RDS_PER_GENE, 
-000600f0: 6162 6e5f 7468 5f74 203d 204d 494e 5f41  abn_th_t = MIN_A
-00060100: 424e 5f54 4f5f 5345 4c2c 205c 0a20 2020  BN_TO_SEL, \.   
-00060110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060140: 2020 2020 2020 2020 6162 6e5f 7468 5f69          abn_th_i
-00060150: 203d 204d 494e 5f41 424e 5f54 4f5f 5345   = MIN_ABN_TO_SE
-00060160: 4c2c 2069 736f 5f66 7261 635f 7468 203d  L, iso_frac_th =
-00060170: 204d 494e 5f49 534f 5f46 5241 432c 206c   MIN_ISO_FRAC, l
-00060180: 656e 5f74 6820 3d20 4c5f 7468 5f74 2029  en_th = L_th_t )
-00060190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000601a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000601b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000601c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000601d0: 2020 2062 203d 2073 656c 662e 6368 6563     b = self.chec
-000601e0: 6b5f 7472 5f32 2874 642c 2066 7261 675f  k_tr_2(td, frag_
-000601f0: 6c65 6e20 3d20 7365 6c66 2e72 6561 645f  len = self.read_
-00060200: 6c65 6e2c 2067 5f74 6820 3d20 4d49 4e5f  len, g_th = MIN_
-00060210: 4e5f 5244 535f 5045 525f 4745 4e45 2c20  N_RDS_PER_GENE, 
-00060220: 6162 6e5f 7468 5f74 203d 204d 494e 5f41  abn_th_t = MIN_A
-00060230: 424e 5f54 4f5f 5345 4c2c 205c 0a20 2020  BN_TO_SEL, \.   
-00060240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060070: 2020 2061 626e 5f74 685f 6920 3d20 4d49     abn_th_i = MI
+00060080: 4e5f 4142 4e5f 544f 5f53 454c 2c20 6973  N_ABN_TO_SEL, is
+00060090: 6f5f 6672 6163 5f74 6820 3d20 4d49 4e5f  o_frac_th = MIN_
+000600a0: 4953 4f5f 4652 4143 2c20 6c65 6e5f 7468  ISO_FRAC, len_th
+000600b0: 203d 204c 5f74 685f 7420 290a 2020 2020   = L_th_t ).    
+000600c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000600d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000600e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000600f0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+00060100: 3d20 7365 6c66 2e63 6865 636b 5f74 725f  = self.check_tr_
+00060110: 3228 7464 2c20 6672 6167 5f6c 656e 203d  2(td, frag_len =
+00060120: 2073 656c 662e 7265 6164 5f6c 656e 2c20   self.read_len, 
+00060130: 675f 7468 203d 204d 494e 5f4e 5f52 4453  g_th = MIN_N_RDS
+00060140: 5f50 4552 5f47 454e 452c 2061 626e 5f74  _PER_GENE, abn_t
+00060150: 685f 7420 3d20 4d49 4e5f 4142 4e5f 544f  h_t = MIN_ABN_TO
+00060160: 5f53 454c 2c20 5c0a 2020 2020 2020 2020  _SEL, \.        
+00060170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000601a0: 2020 2061 626e 5f74 685f 6920 3d20 4d49     abn_th_i = MI
+000601b0: 4e5f 4142 4e5f 544f 5f53 454c 2c20 6973  N_ABN_TO_SEL, is
+000601c0: 6f5f 6672 6163 5f74 6820 3d20 4d49 4e5f  o_frac_th = MIN_
+000601d0: 4953 4f5f 4652 4143 2c20 6c65 6e5f 7468  ISO_FRAC, len_th
+000601e0: 203d 204c 5f74 685f 7420 290a 0a20 2020   = L_th_t )..   
+000601f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060200: 2020 2020 2020 2020 2069 6620 623a 0a20           if b:. 
+00060210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060220: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00060230: 696e 655f 6c73 7420 3d20 6c69 6e65 5f6c  ine_lst = line_l
+00060240: 7374 202b 2066 615f 7365 710a 2020 2020  st + fa_seq.    
 00060250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060270: 2020 2020 2020 2020 6162 6e5f 7468 5f69          abn_th_i
-00060280: 203d 204d 494e 5f41 424e 5f54 4f5f 5345   = MIN_ABN_TO_SE
-00060290: 4c2c 2069 736f 5f66 7261 635f 7468 203d  L, iso_frac_th =
-000602a0: 204d 494e 5f49 534f 5f46 5241 432c 206c   MIN_ISO_FRAC, l
-000602b0: 656e 5f74 6820 3d20 4c5f 7468 5f74 2029  en_th = L_th_t )
-000602c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000602d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000602e0: 2062 3a0a 2020 2020 2020 2020 2020 2020   b:.            
-000602f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060300: 2020 2020 6c69 6e65 5f6c 7374 203d 206c      line_lst = l
-00060310: 696e 655f 6c73 7420 2b20 6661 5f73 6571  ine_lst + fa_seq
-00060320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00060330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060340: 206c 696e 655f 6c73 7432 203d 206c 696e   line_lst2 = lin
-00060350: 655f 6c73 7432 202b 2066 615f 6173 6571  e_lst2 + fa_aseq
-00060360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00060370: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00060380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060390: 2020 2020 2020 2020 2020 2066 615f 7365             fa_se
-000603a0: 712c 2066 615f 6173 6571 203d 205c 0a20  q, fa_aseq = \. 
-000603b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000603c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000603d0: 642e 6765 745f 6661 7374 615f 6c69 6e65  d.get_fasta_line
-000603e0: 735f 6672 6f6d 5f65 786f 6e73 2873 656c  s_from_exons(sel
-000603f0: 662e 6578 6f6e 732e 7267 6e73 2c20 7365  f.exons.rgns, se
-00060400: 6c66 2e72 676e 732e 7267 6e73 2c20 7365  lf.rgns.rgns, se
-00060410: 6c66 2e63 6473 2e72 676e 732c 205c 0a20  lf.cds.rgns, \. 
-00060420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060450: 2020 2020 2020 2020 2020 2020 2067 656e               gen
-00060460: 6f6d 652c 2073 656c 2c20 7065 7074 6964  ome, sel, peptid
-00060470: 652c 204c 5f74 685f 7420 3d20 4c5f 7468  e, L_th_t = L_th
-00060480: 5f74 2c20 4c5f 7468 5f70 203d 204c 5f74  _t, L_th_p = L_t
-00060490: 685f 7029 0a0a 2020 2020 2020 2020 2020  h_p)..          
-000604a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000604b0: 2020 6c69 6e65 5f6c 7374 203d 206c 696e    line_lst = lin
-000604c0: 655f 6c73 7420 2b20 6661 5f73 6571 0a20  e_lst + fa_seq. 
-000604d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000604e0: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-000604f0: 6c73 7432 203d 206c 696e 655f 6c73 7432  lst2 = line_lst2
-00060500: 202b 2066 615f 6173 6571 0a20 2020 2020   + fa_aseq.     
-00060510: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00060520: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00060530: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-00060540: 7269 6e74 2827 4162 6e20 7468 3a20 2535  rint('Abn th: %5
-00060550: 2e33 662c 2041 626e 3a20 2535 2e32 6620  .3f, Abn: %5.2f 
-00060560: 2720 2520 2861 626e 5f74 682c 2074 642e  ' % (abn_th, td.
-00060570: 6162 6e29 290a 2020 2020 2020 2020 2020  abn)).          
-00060580: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-00060590: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-000605a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000605b0: 2020 2020 2020 2020 2320 6966 2063 6e74          # if cnt
-000605c0: 203e 2030 3a20 7072 696e 7428 2745 5252   > 0: print('ERR
-000605d0: 4f52 2069 6e20 6765 745f 6661 7374 615f  OR in get_fasta_
-000605e0: 6c69 6e65 735f 6672 6f6d 5f65 786f 6e73  lines_from_exons
-000605f0: 2028 4129 3a20 2569 2027 2025 2028 636e   (A): %i ' % (cn
-00060600: 7429 290a 0a20 2020 2020 2020 2020 2020  t))..           
-00060610: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00060620: 2020 2020 2020 2066 6f72 206b 2c20 7464         for k, td
-00060630: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-00060640: 6c66 2e74 645f 6c73 7429 3a0a 2020 2020  lf.td_lst):.    
-00060650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00060670: 2020 2020 2074 642e 7472 5f74 6f5f 6772       td.tr_to_gr
-00060680: 5f6d 6170 203d 2063 6f70 792e 6465 6570  _map = copy.deep
-00060690: 636f 7079 2873 656c 662e 7472 5f74 6f5f  copy(self.tr_to_
-000606a0: 6772 5f6d 6170 735b 6b5d 290a 2020 2020  gr_maps[k]).    
+00060260: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00060270: 5f6c 7374 3220 3d20 6c69 6e65 5f6c 7374  _lst2 = line_lst
+00060280: 3220 2b20 6661 5f61 7365 710a 2020 2020  2 + fa_aseq.    
+00060290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000602a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000602b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000602c0: 2020 2020 2020 6661 5f73 6571 2c20 6661        fa_seq, fa
+000602d0: 5f61 7365 7120 3d20 5c0a 2020 2020 2020  _aseq = \.      
+000602e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000602f0: 2020 2020 2020 2020 2020 7464 2e67 6574            td.get
+00060300: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
+00060310: 6d5f 6578 6f6e 7328 7365 6c66 2e65 786f  m_exons(self.exo
+00060320: 6e73 2e72 676e 732c 2073 656c 662e 7267  ns.rgns, self.rg
+00060330: 6e73 2e72 676e 732c 2073 656c 662e 6364  ns.rgns, self.cd
+00060340: 732e 7267 6e73 2c20 5c0a 2020 2020 2020  s.rgns, \.      
+00060350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060380: 2020 2020 2020 2020 6765 6e6f 6d65 2c20          genome, 
+00060390: 7365 6c2c 2070 6570 7469 6465 2c20 4c5f  sel, peptide, L_
+000603a0: 7468 5f74 203d 204c 5f74 685f 742c 204c  th_t = L_th_t, L
+000603b0: 5f74 685f 7020 3d20 4c5f 7468 5f70 290a  _th_p = L_th_p).
+000603c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000603d0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+000603e0: 655f 6c73 7420 3d20 6c69 6e65 5f6c 7374  e_lst = line_lst
+000603f0: 202b 2066 615f 7365 710a 2020 2020 2020   + fa_seq.      
+00060400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060410: 2020 2020 2020 6c69 6e65 5f6c 7374 3220        line_lst2 
+00060420: 3d20 6c69 6e65 5f6c 7374 3220 2b20 6661  = line_lst2 + fa
+00060430: 5f61 7365 710a 2020 2020 2020 2020 2020  _aseq.          
+00060440: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00060450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060460: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00060470: 2741 626e 2074 683a 2025 352e 3366 2c20  'Abn th: %5.3f, 
+00060480: 4162 6e3a 2025 352e 3266 2027 2025 2028  Abn: %5.2f ' % (
+00060490: 6162 6e5f 7468 2c20 7464 2e61 626e 2929  abn_th, td.abn))
+000604a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000604b0: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
+000604c0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+000604d0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+000604e0: 2020 2023 2069 6620 636e 7420 3e20 303a     # if cnt > 0:
+000604f0: 2070 7269 6e74 2827 4552 524f 5220 696e   print('ERROR in
+00060500: 2067 6574 5f66 6173 7461 5f6c 696e 6573   get_fasta_lines
+00060510: 5f66 726f 6d5f 6578 6f6e 7320 2841 293a  _from_exons (A):
+00060520: 2025 6920 2720 2520 2863 6e74 2929 0a0a   %i ' % (cnt))..
+00060530: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00060540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00060550: 2020 666f 7220 6b2c 2074 6420 696e 2065    for k, td in e
+00060560: 6e75 6d65 7261 7465 2873 656c 662e 7464  numerate(self.td
+00060570: 5f6c 7374 293a 0a20 2020 2020 2020 2020  _lst):.         
+00060580: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00060590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000605a0: 7464 2e74 725f 746f 5f67 725f 6d61 7020  td.tr_to_gr_map 
+000605b0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+000605c0: 7365 6c66 2e74 725f 746f 5f67 725f 6d61  self.tr_to_gr_ma
+000605d0: 7073 5b6b 5d29 0a20 2020 2020 2020 2020  ps[k]).         
+000605e0: 2020 2020 2020 2020 2020 2074 642e 7465             td.te
+000605f0: 5f74 6f5f 6765 5f6d 6170 203d 2063 6f70  _to_ge_map = cop
+00060600: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+00060610: 7465 5f74 6f5f 6765 5f6d 6170 735b 6b5d  te_to_ge_maps[k]
+00060620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00060630: 2020 2020 2020 7464 2e74 635f 746f 5f67        td.tc_to_g
+00060640: 635f 6d61 7020 3d20 636f 7079 2e64 6565  c_map = copy.dee
+00060650: 7063 6f70 7928 7365 6c66 2e74 635f 746f  pcopy(self.tc_to
+00060660: 5f67 635f 6d61 7073 5b6b 5d29 0a20 2020  _gc_maps[k]).   
+00060670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060680: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00060690: 2020 2020 2020 6661 5f73 6571 2c20 6661        fa_seq, fa
+000606a0: 5f61 7365 7120 3d20 5c0a 2020 2020 2020  _aseq = \.      
 000606b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000606c0: 7464 2e74 655f 746f 5f67 655f 6d61 7020  td.te_to_ge_map 
-000606d0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-000606e0: 7365 6c66 2e74 655f 746f 5f67 655f 6d61  self.te_to_ge_ma
-000606f0: 7073 5b6b 5d29 0a20 2020 2020 2020 2020  ps[k]).         
-00060700: 2020 2020 2020 2020 2020 2074 642e 7463             td.tc
-00060710: 5f74 6f5f 6763 5f6d 6170 203d 2063 6f70  _to_gc_map = cop
-00060720: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-00060730: 7463 5f74 6f5f 6763 5f6d 6170 735b 6b5d  tc_to_gc_maps[k]
-00060740: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00060750: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00060760: 2020 2020 2020 2020 2020 2066 615f 7365             fa_se
-00060770: 712c 2066 615f 6173 6571 203d 205c 0a20  q, fa_aseq = \. 
+000606c0: 2020 7464 2e67 6574 5f66 6173 7461 5f6c    td.get_fasta_l
+000606d0: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
+000606e0: 7365 6c66 2e65 786f 6e73 2e72 676e 732c  self.exons.rgns,
+000606f0: 2073 656c 662e 7267 6e73 2e72 676e 732c   self.rgns.rgns,
+00060700: 2073 656c 662e 6364 732e 7267 6e73 2c20   self.cds.rgns, 
+00060710: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00060720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060740: 2020 2020 2020 2020 6765 6e6f 6d65 2c20          genome, 
+00060750: 7365 6c2c 2070 6570 7469 6465 2c20 4c5f  sel, peptide, L_
+00060760: 7468 5f74 203d 204c 5f74 685f 742c 204c  th_t = L_th_t, L
+00060770: 5f74 685f 7020 3d20 4c5f 7468 5f70 290a  _th_p = L_th_p).
 00060780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060790: 2020 2020 2020 2074 642e 6765 745f 6661         td.get_fa
-000607a0: 7374 615f 6c69 6e65 735f 6672 6f6d 5f65  sta_lines_from_e
-000607b0: 786f 6e73 2873 656c 662e 6578 6f6e 732e  xons(self.exons.
-000607c0: 7267 6e73 2c20 7365 6c66 2e72 676e 732e  rgns, self.rgns.
-000607d0: 7267 6e73 2c20 7365 6c66 2e63 6473 2e72  rgns, self.cds.r
-000607e0: 676e 732c 205c 0a20 2020 2020 2020 2020  gns, \.         
-000607f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060810: 2020 2020 2020 2020 2020 2020 2067 656e               gen
-00060820: 6f6d 652c 2073 656c 2c20 7065 7074 6964  ome, sel, peptid
-00060830: 652c 204c 5f74 685f 7420 3d20 4c5f 7468  e, L_th_t = L_th
-00060840: 5f74 2c20 4c5f 7468 5f70 203d 204c 5f74  _t, L_th_p = L_t
-00060850: 685f 7029 0a20 2020 2020 2020 2020 2020  h_p).           
-00060860: 2020 2020 2020 2020 206c 696e 655f 6c73           line_ls
-00060870: 7420 3d20 6c69 6e65 5f6c 7374 202b 2066  t = line_lst + f
-00060880: 615f 7365 710a 2020 2020 2020 2020 2020  a_seq.          
-00060890: 2020 2020 2020 2020 2020 6c69 6e65 5f6c            line_l
-000608a0: 7374 3220 3d20 6c69 6e65 5f6c 7374 3220  st2 = line_lst2 
-000608b0: 2b20 6661 5f61 7365 710a 2020 2020 2020  + fa_aseq.      
-000608c0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-000608d0: 2020 2072 6574 7572 6e20 6c69 6e65 5f6c     return line_l
-000608e0: 7374 2c20 6c69 6e65 5f6c 7374 320a 2020  st, line_lst2.  
-000608f0: 2020 2020 2020 2020 2020 0a0a 2020 2020            ..    
-00060900: 6465 6620 6368 6563 6b5f 7472 5f31 2873  def check_tr_1(s
-00060910: 656c 662c 2074 722c 2066 7261 675f 6c65  elf, tr, frag_le
-00060920: 6e20 3d20 3830 2c20 675f 7468 203d 2031  n = 80, g_th = 1
-00060930: 302c 2061 626e 5f74 685f 7420 3d20 312c  0, abn_th_t = 1,
-00060940: 2061 626e 5f74 685f 6920 3d20 312c 2069   abn_th_i = 1, i
-00060950: 736f 5f66 7261 635f 7468 203d 2030 2e30  so_frac_th = 0.0
-00060960: 312c 206c 656e 5f74 6820 3d20 3230 3020  1, len_th = 200 
-00060970: 293a 0a0a 2020 2020 2020 2020 6220 3d20  ):..        b = 
-00060980: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
-00060990: 2074 722e 7072 6566 6978 203d 3d20 2754   tr.prefix == 'T
-000609a0: 273a 0a20 2020 2020 2020 2020 2020 2069  ':.            i
-000609b0: 6620 7472 2e6e 6578 6f6e 7320 3c3d 2031  f tr.nexons <= 1
-000609c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000609d0: 2020 6966 2028 7472 2e67 766f 6c20 3e3d    if (tr.gvol >=
-000609e0: 2067 5f74 682a 6672 6167 5f6c 656e 2a31   g_th*frag_len*1
-000609f0: 2920 2620 2874 722e 6162 6e20 3e3d 2061  ) & (tr.abn >= a
-00060a00: 626e 5f74 685f 742a 342e 3529 2026 2028  bn_th_t*4.5) & (
-00060a10: 6c65 6e28 7472 2e74 7365 7129 203e 3d20  len(tr.tseq) >= 
-00060a20: 6c65 6e5f 7468 293a 0a20 2020 2020 2020  len_th):.       
-00060a30: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-00060a40: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00060a50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00060a60: 2020 2020 2020 2020 6966 2028 7472 2e6e          if (tr.n
-00060a70: 6578 6f6e 7320 3e3d 2034 293a 0a20 2020  exons >= 4):.   
-00060a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060a90: 2069 6620 2874 722e 6776 6f6c 203e 3d20   if (tr.gvol >= 
-00060aa0: 675f 7468 2a66 7261 675f 6c65 6e29 2026  g_th*frag_len) &
-00060ab0: 2028 7472 2e61 626e 203e 3d20 6162 6e5f   (tr.abn >= abn_
-00060ac0: 7468 5f74 2920 2620 286c 656e 2874 722e  th_t) & (len(tr.
-00060ad0: 7473 6571 2920 3e3d 206c 656e 5f74 6829  tseq) >= len_th)
-00060ae0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-00060af0: 2020 2020 2020 2020 2020 2062 203d 2054             b = T
-00060b00: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00060b10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00060b20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00060b30: 2028 7472 2e67 766f 6c20 3e3d 2067 5f74   (tr.gvol >= g_t
-00060b40: 682a 6672 6167 5f6c 656e 2920 2620 2874  h*frag_len) & (t
-00060b50: 722e 6162 6e20 3e3d 2061 626e 5f74 685f  r.abn >= abn_th_
-00060b60: 7429 2026 2028 6c65 6e28 7472 2e74 7365  t) & (len(tr.tse
-00060b70: 7129 203e 3d20 6c65 6e5f 7468 293a 200a  q) >= len_th): .
-00060b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060b90: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
-00060ba0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00060bb0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00060bc0: 7472 2e67 766f 6c20 3e3d 2067 5f74 682a  tr.gvol >= g_th*
-00060bd0: 6672 6167 5f6c 656e 2920 2620 2874 722e  frag_len) & (tr.
-00060be0: 6162 6e20 3e3d 2061 626e 5f74 685f 6929  abn >= abn_th_i)
-00060bf0: 2026 2028 7472 2e69 736f 5f66 7261 6320   & (tr.iso_frac 
-00060c00: 3e3d 2069 736f 5f66 7261 635f 7468 2920  >= iso_frac_th) 
-00060c10: 2620 286c 656e 2874 722e 7473 6571 2920  & (len(tr.tseq) 
-00060c20: 3e3d 206c 656e 5f74 6829 3a20 0a20 2020  >= len_th): .   
-00060c30: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-00060c40: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00060c50: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00060c60: 2020 2072 6574 7572 6e20 620a 0a20 2020     return b..   
-00060c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060c80: 200a 2020 2020 6465 6620 6368 6563 6b5f   .    def check_
-00060c90: 7472 5f32 2873 656c 662c 2074 722c 2066  tr_2(self, tr, f
-00060ca0: 7261 675f 6c65 6e20 3d20 3830 2c20 675f  rag_len = 80, g_
-00060cb0: 7468 203d 2031 302c 2061 626e 5f74 685f  th = 10, abn_th_
-00060cc0: 7420 3d20 312c 2061 626e 5f74 685f 6920  t = 1, abn_th_i 
-00060cd0: 3d20 312c 2069 736f 5f66 7261 635f 7468  = 1, iso_frac_th
-00060ce0: 203d 2030 2e30 312c 206c 656e 5f74 6820   = 0.01, len_th 
-00060cf0: 3d20 3230 302c 206e 655f 7468 203d 2034  = 200, ne_th = 4
-00060d00: 2029 3a0a 0a20 2020 2020 2020 2062 203d   ):..        b =
-00060d10: 2046 616c 7365 0a20 2020 2020 2020 2067   False.        g
-00060d20: 5f74 6820 3d20 675f 7468 202a 2061 626e  _th = g_th * abn
-00060d30: 5f74 685f 690a 2020 2020 2020 2020 7265  _th_i.        re
-00060d40: 665f 7468 203d 206e 655f 7468 2a67 5f74  f_th = ne_th*g_t
-00060d50: 682a 6672 6167 5f6c 656e 2a61 626e 5f74  h*frag_len*abn_t
-00060d60: 685f 690a 2020 2020 2020 2020 6d65 7420  h_i.        met 
-00060d70: 3d20 6d69 6e28 7472 2e67 7270 5f73 697a  = min(tr.grp_siz
-00060d80: 652c 2034 292a 6d69 6e28 7472 2e6e 6578  e, 4)*min(tr.nex
-00060d90: 6f6e 732c 3429 2a6d 696e 2874 722e 6776  ons,4)*min(tr.gv
-00060da0: 6f6c 2c20 3430 3029 0a20 2020 2020 2020  ol, 400).       
-00060db0: 2074 6872 203d 2072 6566 5f74 682f 6d65   thr = ref_th/me
-00060dc0: 740a 2020 2020 2020 2020 7220 3d20 310a  t.        r = 1.
-00060dd0: 2020 2020 2020 2020 2320 6966 2074 6872          # if thr
-00060de0: 203e 2031 3a20 7220 3d20 312e 350a 2020   > 1: r = 1.5.  
-00060df0: 2020 2020 2020 6966 2074 722e 6e65 786f        if tr.nexo
-00060e00: 6e73 203d 3d20 313a 2074 6872 202a 3d20  ns == 1: thr *= 
-00060e10: 340a 2020 2020 2020 2020 6966 2028 7472  4.        if (tr
-00060e20: 2e67 766f 6c20 3e20 675f 7468 2a66 7261  .gvol > g_th*fra
-00060e30: 675f 6c65 6e2a 7468 7229 2026 2028 7472  g_len*thr) & (tr
-00060e40: 2e61 626e 203e 3d20 6162 6e5f 7468 5f69  .abn >= abn_th_i
-00060e50: 2a74 6872 2920 2620 2874 722e 6973 6f5f  *thr) & (tr.iso_
-00060e60: 6672 6163 203e 3d20 6973 6f5f 6672 6163  frac >= iso_frac
-00060e70: 5f74 6829 2026 2028 6c65 6e28 7472 2e74  _th) & (len(tr.t
-00060e80: 7365 7129 203e 3d20 6c65 6e5f 7468 2a72  seq) >= len_th*r
-00060e90: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
-00060ea0: 6966 2074 722e 7072 6566 6978 203d 3d20  if tr.prefix == 
-00060eb0: 2754 273a 200a 2020 2020 2020 2020 2020  'T': .          
-00060ec0: 2020 2020 2020 6220 3d20 5472 7565 0a20        b = True. 
-00060ed0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00060ee0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00060ef0: 2020 6220 3d20 5472 7565 0a20 2020 2020    b = True.     
-00060f00: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00060f10: 2020 2020 7265 7475 726e 2062 0a0a 2020      return b..  
-00060f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060f30: 2020 0a20 2020 2064 6566 2067 6574 5f73    .    def get_s
-00060f40: 6571 5f66 726f 6d5f 6765 6e6f 6d65 2873  eq_from_genome(s
-00060f50: 656c 662c 206e 2c20 6765 6e6f 6d65 293a  elf, n, genome):
-00060f60: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00060f70: 662e 6368 7220 696e 2067 656e 6f6d 652e  f.chr in genome.
-00060f80: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-00060f90: 2020 2020 7467 6d20 3d20 7365 6c66 2e74      tgm = self.t
-00060fa0: 655f 746f 5f67 655f 6d61 7073 0a20 2020  e_to_ge_maps.   
-00060fb0: 2020 2020 2020 2020 2072 676e 7320 3d20           rgns = 
-00060fc0: 7365 6c66 2e65 786f 6e73 0a0a 2020 2020  self.exons..    
-00060fd0: 2020 2020 2020 2020 7464 203d 2073 656c          td = sel
-00060fe0: 662e 7464 5f6c 7374 5b6e 5d0a 0a20 2020  f.td_lst[n]..   
-00060ff0: 2020 2020 2020 2020 2065 786f 6e73 5f74           exons_t
-00061000: 6d70 203d 2072 6567 696f 6e73 2829 0a20  mp = regions(). 
-00061010: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-00061020: 2069 6e20 7467 6d5b 6b5d 3a20 0a20 2020   in tgm[k]: .   
-00061030: 2020 2020 2020 2020 2020 2020 2065 786f               exo
-00061040: 6e73 5f74 6d70 2e72 676e 732e 6170 7065  ns_tmp.rgns.appe
-00061050: 6e64 2872 676e 732e 7267 6e73 5b6d 5d29  nd(rgns.rgns[m])
-00061060: 0a0a 2020 2020 2020 2020 2020 2020 6364  ..            cd
-00061070: 735f 746d 7020 3d20 4e6f 6e65 0a20 2020  s_tmp = None.   
-00061080: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00061090: 7365 6c66 2e63 6473 2e72 676e 7329 203e  self.cds.rgns) >
-000610a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-000610b0: 2020 2020 7467 7220 3d20 7464 2e74 635f      tgr = td.tc_
-000610c0: 746f 5f67 635f 6d61 700a 2020 2020 2020  to_gc_map.      
-000610d0: 2020 2020 2020 2020 2020 6364 735f 746d            cds_tm
-000610e0: 7020 3d20 7265 6769 6f6e 7328 290a 2020  p = regions().  
-000610f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00061100: 7220 6d20 696e 2074 6772 3a0a 2020 2020  r m in tgr:.    
-00061110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061120: 6364 735f 746d 702e 7267 6e73 2e61 7070  cds_tmp.rgns.app
-00061130: 656e 6428 7365 6c66 2e63 6473 2e72 676e  end(self.cds.rgn
-00061140: 735b 6d5d 290a 2020 2020 2020 2020 2020  s[m]).          
-00061150: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00061160: 2020 2020 2020 2069 6364 732c 2069 7374         icds, ist
-00061170: 7261 6e64 2c20 7473 2c20 7073 2c20 7374  rand, ts, ps, st
-00061180: 6172 745f 732c 2073 746f 705f 732c 2073  art_s, stop_s, s
-00061190: 7461 7274 5f70 5f6f 7267 2c20 7374 6172  tart_p_org, star
-000611a0: 745f 702c 2073 746f 705f 705f 6f72 672c  t_p, stop_p_org,
-000611b0: 2073 746f 705f 7020 3d20 5c0a 2020 2020   stop_p = \.    
-000611c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000611d0: 2020 2020 7365 6c66 2e74 645f 6c73 745b      self.td_lst[
-000611e0: 6e5d 2e67 6574 5f73 6571 5f66 726f 6d5f  n].get_seq_from_
-000611f0: 6765 6e6f 6d65 2865 786f 6e73 5f74 6d70  genome(exons_tmp
-00061200: 2c20 6364 735f 746d 702c 2067 656e 6f6d  , cds_tmp, genom
-00061210: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-00061220: 6574 7572 6e20 6963 6473 2c20 6973 7472  eturn icds, istr
-00061230: 616e 642c 2074 732c 2070 732c 2073 7461  and, ts, ps, sta
-00061240: 7274 5f73 2c20 7374 6f70 5f73 2c20 7374  rt_s, stop_s, st
-00061250: 6172 745f 705f 6f72 672c 2073 7461 7274  art_p_org, start
-00061260: 5f70 2c20 7374 6f70 5f70 5f6f 7267 2c20  _p, stop_p_org, 
-00061270: 7374 6f70 5f70 0a20 2020 2020 2020 2065  stop_p.        e
-00061280: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00061290: 2072 6574 7572 6e20 2d31 2c20 302c 2027   return -1, 0, '
-000612a0: 272c 2027 272c 2027 272c 2027 272c 202d  ', '', '', '', -
-000612b0: 312c 202d 312c 202d 312c 202d 310a 2020  1, -1, -1, -1.  
-000612c0: 2020 0a20 2020 2020 2020 200a 2020 2020    .        .    
-000612d0: 2020 2020 0a20 2020 2064 6566 2063 6f6d      .    def com
-000612e0: 7061 7265 5f73 6571 7328 7365 6c66 2c20  pare_seqs(self, 
-000612f0: 7331 2c20 7332 2c20 7469 642c 2076 6572  s1, s2, tid, ver
-00061300: 626f 7365 203d 2046 616c 7365 293a 0a20  bose = False):. 
-00061310: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00061320: 6966 2028 6c65 6e28 7331 2920 3e20 3029  if (len(s1) > 0)
-00061330: 2026 2028 6c65 6e28 7332 2920 3e20 3029   & (len(s2) > 0)
-00061340: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00061350: 206c 656e 2873 3129 2021 3d20 6c65 6e28   len(s1) != len(
-00061360: 7332 293a 0a20 2020 2020 2020 2020 2020  s2):.           
-00061370: 2020 2020 2065 203d 205b 5d0a 2020 2020       e = [].    
-00061380: 2020 2020 2020 2020 2020 2020 6572 5f63              er_c
-00061390: 6e74 203d 2030 0a20 2020 2020 2020 2020  nt = 0.         
-000613a0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-000613b0: 7261 6e67 6528 6d69 6e28 6c65 6e28 7331  range(min(len(s1
-000613c0: 292c 206c 656e 2873 3229 2929 3a0a 2020  ), len(s2))):.  
-000613d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000613e0: 2020 6966 2073 315b 6b5d 203d 3d20 7332    if s1[k] == s2
-000613f0: 5b6b 5d3a 0a20 2020 2020 2020 2020 2020  [k]:.           
-00061400: 2020 2020 2020 2020 2020 2020 2065 2e61               e.a
-00061410: 7070 656e 6428 275f 2729 0a20 2020 2020  ppend('_').     
-00061420: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00061430: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00061440: 2020 2020 2020 2020 2020 2020 2065 2e61               e.a
-00061450: 7070 656e 6428 7332 5b6b 5d29 0a20 2020  ppend(s2[k]).   
-00061460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061470: 2020 2020 2065 725f 636e 7420 2b3d 2031       er_cnt += 1
-00061480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061490: 2069 6620 2876 6572 626f 7365 2920 2620   if (verbose) & 
-000614a0: 2865 725f 636e 7420 3e20 3029 3a0a 2020  (er_cnt > 0):.  
-000614b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000614c0: 2020 6573 6571 203d 2027 272e 6a6f 696e    eseq = ''.join
-000614d0: 2865 290a 2020 2020 2020 2020 2020 2020  (e).            
-000614e0: 2020 2020 2020 2020 7072 696e 7428 273d          print('=
-000614f0: 3d3d 3d27 202b 2074 6964 202b 2027 3d3d  ===' + tid + '==
-00061500: 3d3d 2025 692c 2025 6927 2025 2028 6c65  == %i, %i' % (le
-00061510: 6e28 7331 292c 206c 656e 2873 3229 2929  n(s1), len(s2)))
-00061520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061530: 2020 2020 2070 7269 6e74 2873 3129 0a20       print(s1). 
-00061540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061550: 2020 2070 7269 6e74 2873 3229 0a20 2020     print(s2).   
+00060790: 2020 2020 6c69 6e65 5f6c 7374 203d 206c      line_lst = l
+000607a0: 696e 655f 6c73 7420 2b20 6661 5f73 6571  ine_lst + fa_seq
+000607b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000607c0: 2020 2020 206c 696e 655f 6c73 7432 203d       line_lst2 =
+000607d0: 206c 696e 655f 6c73 7432 202b 2066 615f   line_lst2 + fa_
+000607e0: 6173 6571 0a20 2020 2020 2020 2020 2020  aseq.           
+000607f0: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
+00060800: 7475 726e 206c 696e 655f 6c73 742c 206c  turn line_lst, l
+00060810: 696e 655f 6c73 7432 0a20 2020 2020 2020  ine_lst2.       
+00060820: 2020 2020 200a 0a20 2020 2064 6566 2063       ..    def c
+00060830: 6865 636b 5f74 725f 3128 7365 6c66 2c20  heck_tr_1(self, 
+00060840: 7472 2c20 6672 6167 5f6c 656e 203d 2038  tr, frag_len = 8
+00060850: 302c 2067 5f74 6820 3d20 3130 2c20 6162  0, g_th = 10, ab
+00060860: 6e5f 7468 5f74 203d 2031 2c20 6162 6e5f  n_th_t = 1, abn_
+00060870: 7468 5f69 203d 2031 2c20 6973 6f5f 6672  th_i = 1, iso_fr
+00060880: 6163 5f74 6820 3d20 302e 3031 2c20 6c65  ac_th = 0.01, le
+00060890: 6e5f 7468 203d 2032 3030 2029 3a0a 0a20  n_th = 200 ):.. 
+000608a0: 2020 2020 2020 2062 203d 2046 616c 7365         b = False
+000608b0: 0a20 2020 2020 2020 2069 6620 7472 2e70  .        if tr.p
+000608c0: 7265 6669 7820 3d3d 2027 5427 3a0a 2020  refix == 'T':.  
+000608d0: 2020 2020 2020 2020 2020 6966 2074 722e            if tr.
+000608e0: 6e65 786f 6e73 203c 3d20 313a 0a20 2020  nexons <= 1:.   
+000608f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00060900: 2874 722e 6776 6f6c 203e 3d20 675f 7468  (tr.gvol >= g_th
+00060910: 2a66 7261 675f 6c65 6e2a 3129 2026 2028  *frag_len*1) & (
+00060920: 7472 2e61 626e 203e 3d20 6162 6e5f 7468  tr.abn >= abn_th
+00060930: 5f74 2a34 2e35 2920 2620 286c 656e 2874  _t*4.5) & (len(t
+00060940: 722e 7473 6571 2920 3e3d 206c 656e 5f74  r.tseq) >= len_t
+00060950: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00060960: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
+00060970: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00060980: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00060990: 2020 2069 6620 2874 722e 6e65 786f 6e73     if (tr.nexons
+000609a0: 203e 3d20 3429 3a0a 2020 2020 2020 2020   >= 4):.        
+000609b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000609c0: 7472 2e67 766f 6c20 3e3d 2067 5f74 682a  tr.gvol >= g_th*
+000609d0: 6672 6167 5f6c 656e 2920 2620 2874 722e  frag_len) & (tr.
+000609e0: 6162 6e20 3e3d 2061 626e 5f74 685f 7429  abn >= abn_th_t)
+000609f0: 2026 2028 6c65 6e28 7472 2e74 7365 7129   & (len(tr.tseq)
+00060a00: 203e 3d20 6c65 6e5f 7468 293a 200a 2020   >= len_th): .  
+00060a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060a20: 2020 2020 2020 6220 3d20 5472 7565 0a20        b = True. 
+00060a30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00060a40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00060a50: 2020 2020 2020 2020 2069 6620 2874 722e           if (tr.
+00060a60: 6776 6f6c 203e 3d20 675f 7468 2a66 7261  gvol >= g_th*fra
+00060a70: 675f 6c65 6e29 2026 2028 7472 2e61 626e  g_len) & (tr.abn
+00060a80: 203e 3d20 6162 6e5f 7468 5f74 2920 2620   >= abn_th_t) & 
+00060a90: 286c 656e 2874 722e 7473 6571 2920 3e3d  (len(tr.tseq) >=
+00060aa0: 206c 656e 5f74 6829 3a20 0a20 2020 2020   len_th): .     
+00060ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060ac0: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
+00060ad0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00060ae0: 2020 2020 2020 2069 6620 2874 722e 6776         if (tr.gv
+00060af0: 6f6c 203e 3d20 675f 7468 2a66 7261 675f  ol >= g_th*frag_
+00060b00: 6c65 6e29 2026 2028 7472 2e61 626e 203e  len) & (tr.abn >
+00060b10: 3d20 6162 6e5f 7468 5f69 2920 2620 2874  = abn_th_i) & (t
+00060b20: 722e 6973 6f5f 6672 6163 203e 3d20 6973  r.iso_frac >= is
+00060b30: 6f5f 6672 6163 5f74 6829 2026 2028 6c65  o_frac_th) & (le
+00060b40: 6e28 7472 2e74 7365 7129 203e 3d20 6c65  n(tr.tseq) >= le
+00060b50: 6e5f 7468 293a 200a 2020 2020 2020 2020  n_th): .        
+00060b60: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
+00060b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00060b80: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
+00060b90: 7475 726e 2062 0a0a 2020 2020 2020 2020  turn b..        
+00060ba0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00060bb0: 2064 6566 2063 6865 636b 5f74 725f 3228   def check_tr_2(
+00060bc0: 7365 6c66 2c20 7472 2c20 6672 6167 5f6c  self, tr, frag_l
+00060bd0: 656e 203d 2038 302c 2067 5f74 6820 3d20  en = 80, g_th = 
+00060be0: 3130 2c20 6162 6e5f 7468 5f74 203d 2031  10, abn_th_t = 1
+00060bf0: 2c20 6162 6e5f 7468 5f69 203d 2031 2c20  , abn_th_i = 1, 
+00060c00: 6973 6f5f 6672 6163 5f74 6820 3d20 302e  iso_frac_th = 0.
+00060c10: 3031 2c20 6c65 6e5f 7468 203d 2032 3030  01, len_th = 200
+00060c20: 2c20 6e65 5f74 6820 3d20 3420 293a 0a0a  , ne_th = 4 ):..
+00060c30: 2020 2020 2020 2020 6220 3d20 4661 6c73          b = Fals
+00060c40: 650a 2020 2020 2020 2020 675f 7468 203d  e.        g_th =
+00060c50: 2067 5f74 6820 2a20 6162 6e5f 7468 5f69   g_th * abn_th_i
+00060c60: 0a20 2020 2020 2020 2072 6566 5f74 6820  .        ref_th 
+00060c70: 3d20 6e65 5f74 682a 675f 7468 2a66 7261  = ne_th*g_th*fra
+00060c80: 675f 6c65 6e2a 6162 6e5f 7468 5f69 0a20  g_len*abn_th_i. 
+00060c90: 2020 2020 2020 206d 6574 203d 206d 696e         met = min
+00060ca0: 2874 722e 6772 705f 7369 7a65 2c20 3429  (tr.grp_size, 4)
+00060cb0: 2a6d 696e 2874 722e 6e65 786f 6e73 2c34  *min(tr.nexons,4
+00060cc0: 292a 6d69 6e28 7472 2e67 766f 6c2c 2034  )*min(tr.gvol, 4
+00060cd0: 3030 290a 2020 2020 2020 2020 7468 7220  00).        thr 
+00060ce0: 3d20 7265 665f 7468 2f6d 6574 0a20 2020  = ref_th/met.   
+00060cf0: 2020 2020 2072 203d 2031 0a20 2020 2020       r = 1.     
+00060d00: 2020 2023 2069 6620 7468 7220 3e20 313a     # if thr > 1:
+00060d10: 2072 203d 2031 2e35 0a20 2020 2020 2020   r = 1.5.       
+00060d20: 2069 6620 7472 2e6e 6578 6f6e 7320 3d3d   if tr.nexons ==
+00060d30: 2031 3a20 7468 7220 2a3d 2034 0a20 2020   1: thr *= 4.   
+00060d40: 2020 2020 2069 6620 2874 722e 6776 6f6c       if (tr.gvol
+00060d50: 203e 2067 5f74 682a 6672 6167 5f6c 656e   > g_th*frag_len
+00060d60: 2a74 6872 2920 2620 2874 722e 6162 6e20  *thr) & (tr.abn 
+00060d70: 3e3d 2061 626e 5f74 685f 692a 7468 7229  >= abn_th_i*thr)
+00060d80: 2026 2028 7472 2e69 736f 5f66 7261 6320   & (tr.iso_frac 
+00060d90: 3e3d 2069 736f 5f66 7261 635f 7468 2920  >= iso_frac_th) 
+00060da0: 2620 286c 656e 2874 722e 7473 6571 2920  & (len(tr.tseq) 
+00060db0: 3e3d 206c 656e 5f74 682a 7229 3a20 0a20  >= len_th*r): . 
+00060dc0: 2020 2020 2020 2020 2020 2069 6620 7472             if tr
+00060dd0: 2e70 7265 6669 7820 3d3d 2027 5427 3a20  .prefix == 'T': 
+00060de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00060df0: 2062 203d 2054 7275 650a 2020 2020 2020   b = True.      
+00060e00: 2020 2020 2020 656c 7365 3a20 0a20 2020        else: .   
+00060e10: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+00060e20: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00060e30: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
+00060e40: 6574 7572 6e20 620a 0a20 2020 2020 2020  eturn b..       
+00060e50: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00060e60: 2020 6465 6620 6765 745f 7365 715f 6672    def get_seq_fr
+00060e70: 6f6d 5f67 656e 6f6d 6528 7365 6c66 2c20  om_genome(self, 
+00060e80: 6e2c 2067 656e 6f6d 6529 3a0a 0a20 2020  n, genome):..   
+00060e90: 2020 2020 2069 6620 7365 6c66 2e63 6872       if self.chr
+00060ea0: 2069 6e20 6765 6e6f 6d65 2e6b 6579 7328   in genome.keys(
+00060eb0: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
+00060ec0: 676d 203d 2073 656c 662e 7465 5f74 6f5f  gm = self.te_to_
+00060ed0: 6765 5f6d 6170 730a 2020 2020 2020 2020  ge_maps.        
+00060ee0: 2020 2020 7267 6e73 203d 2073 656c 662e      rgns = self.
+00060ef0: 6578 6f6e 730a 0a20 2020 2020 2020 2020  exons..         
+00060f00: 2020 2074 6420 3d20 7365 6c66 2e74 645f     td = self.td_
+00060f10: 6c73 745b 6e5d 0a0a 2020 2020 2020 2020  lst[n]..        
+00060f20: 2020 2020 6578 6f6e 735f 746d 7020 3d20      exons_tmp = 
+00060f30: 7265 6769 6f6e 7328 290a 2020 2020 2020  regions().      
+00060f40: 2020 2020 2020 666f 7220 6d20 696e 2074        for m in t
+00060f50: 676d 5b6b 5d3a 200a 2020 2020 2020 2020  gm[k]: .        
+00060f60: 2020 2020 2020 2020 6578 6f6e 735f 746d          exons_tm
+00060f70: 702e 7267 6e73 2e61 7070 656e 6428 7267  p.rgns.append(rg
+00060f80: 6e73 2e72 676e 735b 6d5d 290a 0a20 2020  ns.rgns[m])..   
+00060f90: 2020 2020 2020 2020 2063 6473 5f74 6d70           cds_tmp
+00060fa0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00060fb0: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+00060fc0: 6364 732e 7267 6e73 2920 3e20 303a 0a20  cds.rgns) > 0:. 
+00060fd0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00060fe0: 6772 203d 2074 642e 7463 5f74 6f5f 6763  gr = td.tc_to_gc
+00060ff0: 5f6d 6170 0a20 2020 2020 2020 2020 2020  _map.           
+00061000: 2020 2020 2063 6473 5f74 6d70 203d 2072       cds_tmp = r
+00061010: 6567 696f 6e73 2829 0a20 2020 2020 2020  egions().       
+00061020: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
+00061030: 6e20 7467 723a 0a20 2020 2020 2020 2020  n tgr:.         
+00061040: 2020 2020 2020 2020 2020 2063 6473 5f74             cds_t
+00061050: 6d70 2e72 676e 732e 6170 7065 6e64 2873  mp.rgns.append(s
+00061060: 656c 662e 6364 732e 7267 6e73 5b6d 5d29  elf.cds.rgns[m])
+00061070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00061080: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00061090: 2020 6963 6473 2c20 6973 7472 616e 642c    icds, istrand,
+000610a0: 2074 732c 2070 732c 2073 7461 7274 5f73   ts, ps, start_s
+000610b0: 2c20 7374 6f70 5f73 2c20 7374 6172 745f  , stop_s, start_
+000610c0: 705f 6f72 672c 2073 7461 7274 5f70 2c20  p_org, start_p, 
+000610d0: 7374 6f70 5f70 5f6f 7267 2c20 7374 6f70  stop_p_org, stop
+000610e0: 5f70 203d 205c 0a20 2020 2020 2020 2020  _p = \.         
+000610f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00061100: 656c 662e 7464 5f6c 7374 5b6e 5d2e 6765  elf.td_lst[n].ge
+00061110: 745f 7365 715f 6672 6f6d 5f67 656e 6f6d  t_seq_from_genom
+00061120: 6528 6578 6f6e 735f 746d 702c 2063 6473  e(exons_tmp, cds
+00061130: 5f74 6d70 2c20 6765 6e6f 6d65 290a 2020  _tmp, genome).  
+00061140: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00061150: 2069 6364 732c 2069 7374 7261 6e64 2c20   icds, istrand, 
+00061160: 7473 2c20 7073 2c20 7374 6172 745f 732c  ts, ps, start_s,
+00061170: 2073 746f 705f 732c 2073 7461 7274 5f70   stop_s, start_p
+00061180: 5f6f 7267 2c20 7374 6172 745f 702c 2073  _org, start_p, s
+00061190: 746f 705f 705f 6f72 672c 2073 746f 705f  top_p_org, stop_
+000611a0: 700a 2020 2020 2020 2020 656c 7365 3a0a  p.        else:.
+000611b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000611c0: 726e 202d 312c 2030 2c20 2727 2c20 2727  rn -1, 0, '', ''
+000611d0: 2c20 2727 2c20 2727 2c20 2d31 2c20 2d31  , '', '', -1, -1
+000611e0: 2c20 2d31 2c20 2d31 0a20 2020 200a 2020  , -1, -1.    .  
+000611f0: 2020 2020 2020 0a20 2020 2020 2020 200a        .        .
+00061200: 2020 2020 6465 6620 636f 6d70 6172 655f      def compare_
+00061210: 7365 7173 2873 656c 662c 2073 312c 2073  seqs(self, s1, s
+00061220: 322c 2074 6964 2c20 7665 7262 6f73 6520  2, tid, verbose 
+00061230: 3d20 4661 6c73 6529 3a0a 2020 2020 2020  = False):.      
+00061240: 2020 0a20 2020 2020 2020 2069 6620 286c    .        if (l
+00061250: 656e 2873 3129 203e 2030 2920 2620 286c  en(s1) > 0) & (l
+00061260: 656e 2873 3229 203e 2030 293a 0a20 2020  en(s2) > 0):.   
+00061270: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00061280: 7331 2920 213d 206c 656e 2873 3229 3a0a  s1) != len(s2):.
+00061290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000612a0: 6520 3d20 5b5d 0a20 2020 2020 2020 2020  e = [].         
+000612b0: 2020 2020 2020 2065 725f 636e 7420 3d20         er_cnt = 
+000612c0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+000612d0: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
+000612e0: 286d 696e 286c 656e 2873 3129 2c20 6c65  (min(len(s1), le
+000612f0: 6e28 7332 2929 293a 0a20 2020 2020 2020  n(s2))):.       
+00061300: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00061310: 7331 5b6b 5d20 3d3d 2073 325b 6b5d 3a0a  s1[k] == s2[k]:.
+00061320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061330: 2020 2020 2020 2020 652e 6170 7065 6e64          e.append
+00061340: 2827 5f27 290a 2020 2020 2020 2020 2020  ('_').          
+00061350: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00061360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061370: 2020 2020 2020 2020 652e 6170 7065 6e64          e.append
+00061380: 2873 325b 6b5d 290a 2020 2020 2020 2020  (s2[k]).        
+00061390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000613a0: 6572 5f63 6e74 202b 3d20 310a 2020 2020  er_cnt += 1.    
+000613b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000613c0: 7665 7262 6f73 6529 2026 2028 6572 5f63  verbose) & (er_c
+000613d0: 6e74 203e 2030 293a 0a20 2020 2020 2020  nt > 0):.       
+000613e0: 2020 2020 2020 2020 2020 2020 2065 7365               ese
+000613f0: 7120 3d20 2727 2e6a 6f69 6e28 6529 0a20  q = ''.join(e). 
+00061400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061410: 2020 2070 7269 6e74 2827 3d3d 3d3d 2720     print('====' 
+00061420: 2b20 7469 6420 2b20 273d 3d3d 3d20 2569  + tid + '==== %i
+00061430: 2c20 2569 2720 2520 286c 656e 2873 3129  , %i' % (len(s1)
+00061440: 2c20 6c65 6e28 7332 2929 290a 2020 2020  , len(s2))).    
+00061450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061460: 7072 696e 7428 7331 290a 2020 2020 2020  print(s1).      
+00061470: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00061480: 696e 7428 7332 290a 2020 2020 2020 2020  int(s2).        
+00061490: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+000614a0: 696e 7428 6573 6571 290a 0a20 2020 2020  int(eseq)..     
+000614b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000614c0: 6e20 6572 5f63 6e74 0a0a 2020 2020 2020  n er_cnt..      
+000614d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000614e0: 2020 2020 2020 2020 2020 2020 6520 3d20              e = 
+000614f0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+00061500: 2020 2065 725f 636e 7420 3d20 300a 2020     er_cnt = 0.  
+00061510: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00061520: 7220 6b2c 2063 2069 6e20 656e 756d 6572  r k, c in enumer
+00061530: 6174 6528 7331 293a 0a20 2020 2020 2020  ate(s1):.       
+00061540: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00061550: 6320 3d3d 2073 325b 6b5d 3a0a 2020 2020  c == s2[k]:.    
 00061560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061570: 2023 2070 7269 6e74 2865 7365 7129 0a0a   # print(eseq)..
-00061580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061590: 7265 7475 726e 2065 725f 636e 740a 0a20  return er_cnt.. 
-000615a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000615b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000615c0: 2065 203d 205b 5d0a 2020 2020 2020 2020   e = [].        
-000615d0: 2020 2020 2020 2020 6572 5f63 6e74 203d          er_cnt =
-000615e0: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-000615f0: 2020 2066 6f72 206b 2c20 6320 696e 2065     for k, c in e
-00061600: 6e75 6d65 7261 7465 2873 3129 3a0a 2020  numerate(s1):.  
-00061610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061620: 2020 6966 2063 203d 3d20 7332 5b6b 5d3a    if c == s2[k]:
-00061630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061640: 2020 2020 2020 2020 2065 2e61 7070 656e           e.appen
-00061650: 6428 275f 2729 0a20 2020 2020 2020 2020  d('_').         
-00061660: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00061670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061680: 2020 2020 2020 2020 2065 2e61 7070 656e           e.appen
-00061690: 6428 7332 5b6b 5d29 0a20 2020 2020 2020  d(s2[k]).       
-000616a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000616b0: 2065 725f 636e 7420 2b3d 2031 0a20 2020   er_cnt += 1.   
-000616c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000616d0: 2876 6572 626f 7365 2920 2620 2865 725f  (verbose) & (er_
-000616e0: 636e 7420 3e20 3029 3a0a 2020 2020 2020  cnt > 0):.      
-000616f0: 2020 2020 2020 2020 2020 2020 2020 6573                es
-00061700: 6571 203d 2027 272e 6a6f 696e 2865 290a  eq = ''.join(e).
-00061710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061720: 2020 2020 7072 696e 7428 272d 2d2d 2d27      print('----'
-00061730: 202b 2074 6964 202b 2027 2d2d 2d2d 2025   + tid + '---- %
-00061740: 692c 2025 6927 2025 2028 6c65 6e28 7331  i, %i' % (len(s1
-00061750: 292c 206c 656e 2873 3229 2929 0a20 2020  ), len(s2))).   
-00061760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061770: 2070 7269 6e74 2873 3129 0a20 2020 2020   print(s1).     
-00061780: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00061790: 7269 6e74 2873 3229 0a20 2020 2020 2020  rint(s2).       
-000617a0: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-000617b0: 7269 6e74 2865 7365 7129 0a0a 2020 2020  rint(eseq)..    
-000617c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000617d0: 726e 2065 725f 636e 740a 2020 2020 2020  rn er_cnt.      
-000617e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000617f0: 2020 2020 7265 7475 726e 2030 0a20 2020      return 0.   
-00061800: 200a 0a20 2020 2064 6566 2070 7269 6e74   ..    def print
-00061810: 5f63 6473 5f69 6e66 6f28 7365 6c66 2c20  _cds_info(self, 
-00061820: 6368 725f 7365 7129 3a0a 2020 2020 2020  chr_seq):.      
-00061830: 2020 0a20 2020 2020 2020 2070 7269 6e74    .        print
-00061840: 2827 3d3d 3d20 2573 3a25 692d 2569 203d  ('=== %s:%i-%i =
-00061850: 3d3d 2720 2528 7365 6c66 2e63 6872 2c20  ==' %(self.chr, 
-00061860: 7365 6c66 2e62 6567 696e 2c20 7365 6c66  self.begin, self
-00061870: 2e65 6e64 2929 0a20 2020 2020 2020 2073  .end)).        s
-00061880: 656c 662e 6364 732e 7072 696e 745f 7368  elf.cds.print_sh
-00061890: 6f72 7428 290a 2020 2020 2020 2020 7072  ort().        pr
-000618a0: 696e 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d  int('-----------
-000618b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
-000618c0: 290a 2020 2020 2020 2020 666f 7220 7220  ).        for r 
-000618d0: 696e 2073 656c 662e 6364 732e 7267 6e73  in self.cds.rgns
-000618e0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000618f0: 7120 3d20 6368 725f 7365 715b 2872 2e73  q = chr_seq[(r.s
-00061900: 7461 7274 2d31 293a 722e 656e 645d 0a20  tart-1):r.end]. 
-00061910: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00061920: 6e28 7365 7129 203e 2031 3030 3a20 7365  n(seq) > 100: se
-00061930: 7120 3d20 7365 715b 3a31 3030 5d0a 2020  q = seq[:100].  
-00061940: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00061950: 7365 7129 0a20 2020 2020 2020 2070 7269  seq).        pri
-00061960: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
-00061970: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
-00061980: 0a20 2020 2020 2020 2070 7269 6e74 2873  .        print(s
-00061990: 656c 662e 7463 5f74 6f5f 6763 5f6d 6170  elf.tc_to_gc_map
-000619a0: 7329 0a20 2020 2020 2020 2070 7269 6e74  s).        print
-000619b0: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
-000619c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a20  ------------'). 
-000619d0: 2020 2020 2020 2066 6f72 2074 6420 696e         for td in
-000619e0: 2073 656c 662e 7464 5f6c 7374 3a0a 2020   self.td_lst:.  
-000619f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00061a00: 2725 733a 2025 6920 2d20 2569 2720 2520  '%s: %i - %i' % 
-00061a10: 2874 642e 7469 642c 2074 642e 6265 6769  (td.tid, td.begi
-00061a20: 6e2c 2074 642e 656e 6429 290a 2020 2020  n, td.end)).    
-00061a30: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
-00061a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00061a50: 2d2d 2d2d 2d27 290a 0a20 2020 2020 2020  -----')..       
-00061a60: 200a 2020 2020 6465 6620 636f 6d70 6172   .    def compar
-00061a70: 655f 7365 7173 5f66 726f 6d5f 6364 735f  e_seqs_from_cds_
-00061a80: 616e 645f 6765 6e6f 6d65 2873 656c 662c  and_genome(self,
-00061a90: 2063 6872 5f73 6571 293a 0a0a 2020 2020   chr_seq):..    
-00061aa0: 2020 2020 6e5f 6572 5f74 6f74 616c 2c20      n_er_total, 
-00061ab0: 6e5f 746f 7461 6c20 3d20 302c 2030 0a20  n_total = 0, 0. 
-00061ac0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00061ad0: 7467 6d65 203d 2073 656c 662e 7465 5f74  tgme = self.te_t
-00061ae0: 6f5f 6765 5f6d 6170 730a 2020 2020 2020  o_ge_maps.      
-00061af0: 2020 7467 6d63 203d 2073 656c 662e 7463    tgmc = self.tc
-00061b00: 5f74 6f5f 6763 5f6d 6170 730a 0a20 2020  _to_gc_maps..   
-00061b10: 2020 2020 2066 6f72 206b 2c20 7464 2069       for k, td i
-00061b20: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-00061b30: 2e74 645f 6c73 7429 3a0a 2020 2020 2020  .td_lst):.      
-00061b40: 2020 2020 2020 6966 206c 656e 2874 676d        if len(tgm
-00061b50: 655b 6b5d 2920 3e20 303a 0a20 2020 2020  e[k]) > 0:.     
-00061b60: 2020 2020 2020 2020 2020 2074 6964 203d             tid =
-00061b70: 2074 642e 7469 640a 2020 2020 2020 2020   td.tid.        
-00061b80: 2020 2020 2020 2020 7365 7120 3d20 2727          seq = ''
-00061b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061ba0: 2066 6f72 206d 2069 6e20 7467 6d65 5b6b   for m in tgme[k
-00061bb0: 5d3a 200a 2020 2020 2020 2020 2020 2020  ]: .            
-00061bc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00061bd0: 6578 6f6e 732e 7267 6e73 5b6d 5d2e 7479  exons.rgns[m].ty
-00061be0: 7065 203d 3d20 2765 786f 6e27 3a0a 2020  pe == 'exon':.  
-00061bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061c00: 2020 2020 2020 7365 7120 3d20 7365 7120        seq = seq 
-00061c10: 2b20 6368 725f 7365 715b 2873 656c 662e  + chr_seq[(self.
-00061c20: 6578 6f6e 732e 7267 6e73 5b6d 5d2e 7374  exons.rgns[m].st
-00061c30: 6172 742d 3129 3a73 656c 662e 6578 6f6e  art-1):self.exon
-00061c40: 732e 7267 6e73 5b6d 5d2e 656e 645d 0a20  s.rgns[m].end]. 
-00061c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00061c60: 6620 6c65 6e28 7365 7129 203d 3d20 303a  f len(seq) == 0:
-00061c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061c80: 2020 2020 2070 7269 6e74 2827 4552 524f       print('ERRO
-00061c90: 5228 5429 3a20 2573 206f 6620 6c65 6e28  R(T): %s of len(
-00061ca0: 2569 2920 6e6f 7420 6465 7465 6374 6564  %i) not detected
-00061cb0: 2720 2520 2874 6964 2c20 6c65 6e28 7464  ' % (tid, len(td
-00061cc0: 2e74 7365 7129 2929 0a20 2020 2020 2020  .tseq))).       
-00061cd0: 2020 2020 2020 2020 2074 7365 7120 3d20           tseq = 
-00061ce0: 7365 710a 0a20 2020 2020 2020 2020 2020  seq..           
-00061cf0: 2069 6620 6c65 6e28 7467 6d63 5b6b 5d29   if len(tgmc[k])
-00061d00: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-00061d10: 2020 2020 2020 7469 6420 3d20 7464 2e74        tid = td.t
-00061d20: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
-00061d30: 2020 2073 6571 203d 2027 270a 2020 2020     seq = ''.    
-00061d40: 2020 2020 2020 2020 2020 2020 6364 735f              cds_
-00061d50: 746d 7020 3d20 7265 6769 6f6e 7328 290a  tmp = regions().
-00061d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061d70: 666f 7220 6d20 696e 2074 676d 635b 6b5d  for m in tgmc[k]
-00061d80: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-00061d90: 2020 2020 2020 2063 6473 5f74 6d70 2e72         cds_tmp.r
-00061da0: 676e 732e 6170 7065 6e64 2873 656c 662e  gns.append(self.
-00061db0: 6364 732e 7267 6e73 5b6d 5d29 0a20 2020  cds.rgns[m]).   
+00061570: 2020 2020 652e 6170 7065 6e64 2827 5f27      e.append('_'
+00061580: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00061590: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000615a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000615b0: 2020 2020 652e 6170 7065 6e64 2873 325b      e.append(s2[
+000615c0: 6b5d 290a 2020 2020 2020 2020 2020 2020  k]).            
+000615d0: 2020 2020 2020 2020 2020 2020 6572 5f63              er_c
+000615e0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+000615f0: 2020 2020 2020 2020 6966 2028 7665 7262          if (verb
+00061600: 6f73 6529 2026 2028 6572 5f63 6e74 203e  ose) & (er_cnt >
+00061610: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+00061620: 2020 2020 2020 2020 2065 7365 7120 3d20           eseq = 
+00061630: 2727 2e6a 6f69 6e28 6529 0a20 2020 2020  ''.join(e).     
+00061640: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00061650: 7269 6e74 2827 2d2d 2d2d 2720 2b20 7469  rint('----' + ti
+00061660: 6420 2b20 272d 2d2d 2d20 2569 2c20 2569  d + '---- %i, %i
+00061670: 2720 2520 286c 656e 2873 3129 2c20 6c65  ' % (len(s1), le
+00061680: 6e28 7332 2929 290a 2020 2020 2020 2020  n(s2))).        
+00061690: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000616a0: 7428 7331 290a 2020 2020 2020 2020 2020  t(s1).          
+000616b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000616c0: 7332 290a 2020 2020 2020 2020 2020 2020  s2).            
+000616d0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+000616e0: 6573 6571 290a 0a20 2020 2020 2020 2020  eseq)..         
+000616f0: 2020 2020 2020 2072 6574 7572 6e20 6572         return er
+00061700: 5f63 6e74 0a20 2020 2020 2020 2065 6c73  _cnt.        els
+00061710: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00061720: 6574 7572 6e20 300a 2020 2020 0a0a 2020  eturn 0.    ..  
+00061730: 2020 6465 6620 7072 696e 745f 6364 735f    def print_cds_
+00061740: 696e 666f 2873 656c 662c 2063 6872 5f73  info(self, chr_s
+00061750: 6571 293a 0a20 2020 2020 2020 200a 2020  eq):.        .  
+00061760: 2020 2020 2020 7072 696e 7428 273d 3d3d        print('===
+00061770: 2025 733a 2569 2d25 6920 3d3d 3d27 2025   %s:%i-%i ===' %
+00061780: 2873 656c 662e 6368 722c 2073 656c 662e  (self.chr, self.
+00061790: 6265 6769 6e2c 2073 656c 662e 656e 6429  begin, self.end)
+000617a0: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
+000617b0: 6473 2e70 7269 6e74 5f73 686f 7274 2829  ds.print_short()
+000617c0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+000617d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000617e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020  ----------').   
+000617f0: 2020 2020 2066 6f72 2072 2069 6e20 7365       for r in se
+00061800: 6c66 2e63 6473 2e72 676e 733a 0a20 2020  lf.cds.rgns:.   
+00061810: 2020 2020 2020 2020 2073 6571 203d 2063           seq = c
+00061820: 6872 5f73 6571 5b28 722e 7374 6172 742d  hr_seq[(r.start-
+00061830: 3129 3a72 2e65 6e64 5d0a 2020 2020 2020  1):r.end].      
+00061840: 2020 2020 2020 6966 206c 656e 2873 6571        if len(seq
+00061850: 2920 3e20 3130 303a 2073 6571 203d 2073  ) > 100: seq = s
+00061860: 6571 5b3a 3130 305d 0a20 2020 2020 2020  eq[:100].       
+00061870: 2020 2020 2070 7269 6e74 2873 6571 290a       print(seq).
+00061880: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
+00061890: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000618a0: 2d2d 2d2d 2d2d 2d2d 2d27 290a 2020 2020  ---------').    
+000618b0: 2020 2020 7072 696e 7428 7365 6c66 2e74      print(self.t
+000618c0: 635f 746f 5f67 635f 6d61 7073 290a 2020  c_to_gc_maps).  
+000618d0: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
+000618e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000618f0: 2d2d 2d2d 2d2d 2d27 290a 2020 2020 2020  -------').      
+00061900: 2020 666f 7220 7464 2069 6e20 7365 6c66    for td in self
+00061910: 2e74 645f 6c73 743a 0a20 2020 2020 2020  .td_lst:.       
+00061920: 2020 2020 2070 7269 6e74 2827 2573 3a20       print('%s: 
+00061930: 2569 202d 2025 6927 2025 2028 7464 2e74  %i - %i' % (td.t
+00061940: 6964 2c20 7464 2e62 6567 696e 2c20 7464  id, td.begin, td
+00061950: 2e65 6e64 2929 0a20 2020 2020 2020 2070  .end)).        p
+00061960: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
+00061970: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00061980: 2729 0a0a 2020 2020 2020 2020 0a20 2020  ')..        .   
+00061990: 2064 6566 2063 6f6d 7061 7265 5f73 6571   def compare_seq
+000619a0: 735f 6672 6f6d 5f63 6473 5f61 6e64 5f67  s_from_cds_and_g
+000619b0: 656e 6f6d 6528 7365 6c66 2c20 6368 725f  enome(self, chr_
+000619c0: 7365 7129 3a0a 0a20 2020 2020 2020 206e  seq):..        n
+000619d0: 5f65 725f 746f 7461 6c2c 206e 5f74 6f74  _er_total, n_tot
+000619e0: 616c 203d 2030 2c20 300a 2020 2020 2020  al = 0, 0.      
+000619f0: 2020 0a20 2020 2020 2020 2074 676d 6520    .        tgme 
+00061a00: 3d20 7365 6c66 2e74 655f 746f 5f67 655f  = self.te_to_ge_
+00061a10: 6d61 7073 0a20 2020 2020 2020 2074 676d  maps.        tgm
+00061a20: 6320 3d20 7365 6c66 2e74 635f 746f 5f67  c = self.tc_to_g
+00061a30: 635f 6d61 7073 0a0a 2020 2020 2020 2020  c_maps..        
+00061a40: 666f 7220 6b2c 2074 6420 696e 2065 6e75  for k, td in enu
+00061a50: 6d65 7261 7465 2873 656c 662e 7464 5f6c  merate(self.td_l
+00061a60: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+00061a70: 2069 6620 6c65 6e28 7467 6d65 5b6b 5d29   if len(tgme[k])
+00061a80: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00061a90: 2020 2020 2020 7469 6420 3d20 7464 2e74        tid = td.t
+00061aa0: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
+00061ab0: 2020 2073 6571 203d 2027 270a 2020 2020     seq = ''.    
+00061ac0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00061ad0: 6d20 696e 2074 676d 655b 6b5d 3a20 0a20  m in tgme[k]: . 
+00061ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061af0: 2020 2069 6620 7365 6c66 2e65 786f 6e73     if self.exons
+00061b00: 2e72 676e 735b 6d5d 2e74 7970 6520 3d3d  .rgns[m].type ==
+00061b10: 2027 6578 6f6e 273a 0a20 2020 2020 2020   'exon':.       
+00061b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061b30: 2073 6571 203d 2073 6571 202b 2063 6872   seq = seq + chr
+00061b40: 5f73 6571 5b28 7365 6c66 2e65 786f 6e73  _seq[(self.exons
+00061b50: 2e72 676e 735b 6d5d 2e73 7461 7274 2d31  .rgns[m].start-1
+00061b60: 293a 7365 6c66 2e65 786f 6e73 2e72 676e  ):self.exons.rgn
+00061b70: 735b 6d5d 2e65 6e64 5d0a 2020 2020 2020  s[m].end].      
+00061b80: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00061b90: 2873 6571 2920 3d3d 2030 3a0a 2020 2020  (seq) == 0:.    
+00061ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061bb0: 7072 696e 7428 2745 5252 4f52 2854 293a  print('ERROR(T):
+00061bc0: 2025 7320 6f66 206c 656e 2825 6929 206e   %s of len(%i) n
+00061bd0: 6f74 2064 6574 6563 7465 6427 2025 2028  ot detected' % (
+00061be0: 7469 642c 206c 656e 2874 642e 7473 6571  tid, len(td.tseq
+00061bf0: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
+00061c00: 2020 2020 7473 6571 203d 2073 6571 0a0a      tseq = seq..
+00061c10: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00061c20: 656e 2874 676d 635b 6b5d 2920 3e20 303a  en(tgmc[k]) > 0:
+00061c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00061c40: 2074 6964 203d 2074 642e 7469 640a 2020   tid = td.tid.  
+00061c50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00061c60: 7120 3d20 2727 0a20 2020 2020 2020 2020  q = ''.         
+00061c70: 2020 2020 2020 2063 6473 5f74 6d70 203d         cds_tmp =
+00061c80: 2072 6567 696f 6e73 2829 0a20 2020 2020   regions().     
+00061c90: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+00061ca0: 2069 6e20 7467 6d63 5b6b 5d3a 200a 2020   in tgmc[k]: .  
+00061cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061cc0: 2020 6364 735f 746d 702e 7267 6e73 2e61    cds_tmp.rgns.a
+00061cd0: 7070 656e 6428 7365 6c66 2e63 6473 2e72  ppend(self.cds.r
+00061ce0: 676e 735b 6d5d 290a 2020 2020 2020 2020  gns[m]).        
+00061cf0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00061d00: 656c 662e 6364 732e 7267 6e73 5b6d 5d2e  elf.cds.rgns[m].
+00061d10: 7479 7065 203d 3d20 2743 4453 273a 0a20  type == 'CDS':. 
+00061d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061d30: 2020 2020 2020 2073 6571 203d 2073 6571         seq = seq
+00061d40: 202b 2063 6872 5f73 6571 5b28 7365 6c66   + chr_seq[(self
+00061d50: 2e63 6473 2e72 676e 735b 6d5d 2e73 7461  .cds.rgns[m].sta
+00061d60: 7274 2d31 293a 7365 6c66 2e63 6473 2e72  rt-1):self.cds.r
+00061d70: 676e 735b 6d5d 2e65 6e64 5d0a 2020 2020  gns[m].end].    
+00061d80: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00061d90: 656e 2873 6571 2920 3e20 303a 0a20 2020  en(seq) > 0:.   
+00061da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061db0: 2070 7365 7120 3d20 7365 710a 2020 2020   pseq = seq.    
 00061dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061dd0: 2069 6620 7365 6c66 2e63 6473 2e72 676e   if self.cds.rgn
-00061de0: 735b 6d5d 2e74 7970 6520 3d3d 2027 4344  s[m].type == 'CD
-00061df0: 5327 3a0a 2020 2020 2020 2020 2020 2020  S':.            
-00061e00: 2020 2020 2020 2020 2020 2020 7365 7120              seq 
-00061e10: 3d20 7365 7120 2b20 6368 725f 7365 715b  = seq + chr_seq[
-00061e20: 2873 656c 662e 6364 732e 7267 6e73 5b6d  (self.cds.rgns[m
-00061e30: 5d2e 7374 6172 742d 3129 3a73 656c 662e  ].start-1):self.
-00061e40: 6364 732e 7267 6e73 5b6d 5d2e 656e 645d  cds.rgns[m].end]
-00061e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061e60: 2069 6620 6c65 6e28 7365 7129 203e 2030   if len(seq) > 0
-00061e70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00061e80: 2020 2020 2020 7073 6571 203d 2073 6571        pseq = seq
-00061e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061ea0: 2020 2020 2069 6620 7464 2e69 7374 7261       if td.istra
-00061eb0: 6e64 203c 2030 3a0a 2020 2020 2020 2020  nd < 0:.        
-00061ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061ed0: 7073 6571 203d 2072 6576 6572 7365 5f63  pseq = reverse_c
-00061ee0: 6f6d 706c 656d 656e 7428 7365 7129 0a20  omplement(seq). 
-00061ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061f00: 2020 2061 7365 7120 3d20 7472 616e 736c     aseq = transl
-00061f10: 6174 6528 7073 6571 290a 2020 2020 2020  ate(pseq).      
-00061f20: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
-00061f30: 6572 203d 2073 656c 662e 636f 6d70 6172  er = self.compar
-00061f40: 655f 7365 7173 2820 7464 2e61 7365 712c  e_seqs( td.aseq,
-00061f50: 2061 7365 712c 2074 6964 2c20 7665 7262   aseq, tid, verb
-00061f60: 6f73 6520 3d20 4661 6c73 6520 290a 0a20  ose = False ).. 
-00061f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061f80: 2020 206e 5f65 725f 746f 7461 6c20 2b3d     n_er_total +=
-00061f90: 206e 5f65 720a 2020 2020 2020 2020 2020   n_er.          
-00061fa0: 2020 2020 2020 2020 2020 6e5f 746f 7461            n_tota
-00061fb0: 6c20 2b3d 206c 656e 2861 7365 7129 0a0a  l += len(aseq)..
-00061fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061fd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00061fe0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00061ff0: 2745 5252 4f52 2850 293a 2025 7320 6f66  'ERROR(P): %s of
-00062000: 206c 656e 2825 6929 206e 6f74 2064 6574   len(%i) not det
-00062010: 6563 7465 6427 2025 2028 7469 642c 206c  ected' % (tid, l
-00062020: 656e 2874 642e 6173 6571 2929 290a 2020  en(td.aseq))).  
-00062030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062040: 2020 0a20 2020 2020 2020 2023 2069 6620    .        # if 
-00062050: 6e5f 6572 5f74 6f74 616c 203e 2030 3a20  n_er_total > 0: 
-00062060: 7365 6c66 2e70 7269 6e74 5f63 6473 5f69  self.print_cds_i
-00062070: 6e66 6f28 6368 725f 7365 7129 0a0a 2020  nfo(chr_seq)..  
-00062080: 2020 2020 2020 7265 7475 726e 206e 5f65        return n_e
-00062090: 725f 746f 7461 6c2c 206e 5f74 6f74 616c  r_total, n_total
-000620a0: 0a20 2020 200a 0a20 2020 2064 6566 2067  .    ..    def g
-000620b0: 6574 5f61 6c6c 5f73 6571 5f66 726f 6d5f  et_all_seq_from_
-000620c0: 6765 6e6f 6d65 2873 656c 662c 2067 656e  genome(self, gen
-000620d0: 6f6d 652c 2061 626e 5f74 6820 3d20 302c  ome, abn_th = 0,
-000620e0: 2063 6f76 5f74 6820 3d20 302c 206c 656e   cov_th = 0, len
-000620f0: 5f74 685f 7420 3d20 3230 302c 206c 656e  _th_t = 200, len
-00062100: 5f74 685f 7020 3d20 3530 293a 0a0a 2020  _th_p = 50):..  
-00062110: 2020 2020 2020 7469 6473 203d 205b 5d0a        tids = [].
-00062120: 2020 2020 2020 2020 7473 6571 203d 205b          tseq = [
-00062130: 5d0a 2020 2020 2020 2020 6162 6e74 203d  ].        abnt =
-00062140: 205b 5d0a 0a20 2020 2020 2020 2070 6964   []..        pid
-00062150: 7320 3d20 5b5d 0a20 2020 2020 2020 2070  s = [].        p
-00062160: 7365 7120 3d20 5b5d 0a20 2020 2020 2020  seq = [].       
-00062170: 2061 626e 7020 3d20 5b5d 0a0a 2020 2020   abnp = []..    
-00062180: 2020 2020 6966 2073 656c 662e 6368 7220      if self.chr 
-00062190: 696e 2067 656e 6f6d 652e 6b65 7973 2829  in genome.keys()
-000621a0: 3a0a 2020 2020 2020 2020 2020 2020 0a20  :.            . 
-000621b0: 2020 2020 2020 2020 2020 2074 676d 7320             tgms 
-000621c0: 3d20 7365 6c66 2e74 655f 746f 5f67 655f  = self.te_to_ge_
-000621d0: 6d61 7073 0a20 2020 2020 2020 2020 2020  maps.           
-000621e0: 2072 676e 7320 3d20 7365 6c66 2e65 786f   rgns = self.exo
-000621f0: 6e73 2e72 676e 730a 2020 2020 2020 2020  ns.rgns.        
-00062200: 2020 2020 7461 7267 6574 203d 2027 6578      target = 'ex
-00062210: 6f6e 270a 0a20 2020 2020 2020 2020 2020  on'..           
-00062220: 2066 6f72 206b 2c20 7464 2069 6e20 656e   for k, td in en
-00062230: 756d 6572 6174 6528 7365 6c66 2e74 645f  umerate(self.td_
-00062240: 6c73 7429 3a0a 2020 2020 2020 2020 2020  lst):.          
-00062250: 2020 2020 2020 6966 206c 656e 2874 676d        if len(tgm
-00062260: 735b 6b5d 2920 3e20 303a 0a20 2020 2020  s[k]) > 0:.     
-00062270: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00062280: 6964 203d 2074 642e 7469 640a 2020 2020  id = td.tid.    
-00062290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000622a0: 7267 6e73 5f74 6d70 203d 2072 6567 696f  rgns_tmp = regio
-000622b0: 6e73 2829 0a20 2020 2020 2020 2020 2020  ns().           
-000622c0: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
-000622d0: 6e20 7467 6d73 5b6b 5d3a 200a 2020 2020  n tgms[k]: .    
-000622e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000622f0: 2020 2020 6966 2072 676e 735b 6d5d 2e74      if rgns[m].t
-00062300: 7970 6520 3d3d 2074 6172 6765 743a 0a20  ype == target:. 
-00062310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062320: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
-00062330: 746d 702e 7267 6e73 2e61 7070 656e 6428  tmp.rgns.append(
-00062340: 7267 6e73 5b6d 5d2e 636f 7079 2875 7064  rgns[m].copy(upd
-00062350: 6174 6520 3d20 4661 6c73 6529 290a 2020  ate = False)).  
-00062360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062370: 2020 7267 6e73 5f74 6d70 2e6f 7264 6572    rgns_tmp.order
-00062380: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00062390: 2020 2020 2020 2020 7365 7120 3d20 2727          seq = ''
-000623a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000623b0: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
-000623c0: 6e73 5f74 6d70 2e72 676e 733a 200a 2020  ns_tmp.rgns: .  
-000623d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000623e0: 2020 2020 2020 7365 7120 3d20 7365 7120        seq = seq 
-000623f0: 2b20 6765 6e6f 6d65 5b72 2e63 6872 5d2e  + genome[r.chr].
-00062400: 7365 715b 2872 2e73 7461 7274 2d31 293a  seq[(r.start-1):
-00062410: 722e 656e 645d 0a20 2020 2020 2020 2020  r.end].         
-00062420: 2020 2020 2020 2020 2020 2069 6620 286c             if (l
-00062430: 656e 2873 6571 2920 3e3d 206c 656e 5f74  en(seq) >= len_t
-00062440: 685f 7429 2026 2028 7464 2e61 626e 203e  h_t) & (td.abn >
-00062450: 3d20 6162 6e5f 7468 2920 2620 2874 642e  = abn_th) & (td.
-00062460: 636f 7620 3e3d 2063 6f76 5f74 6829 3a0a  cov >= cov_th):.
-00062470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062480: 2020 2020 2020 2020 6864 7220 3d20 7365          hdr = se
-00062490: 745f 6661 5f68 6561 6465 7228 2074 6964  t_fa_header( tid
-000624a0: 2c20 6c65 6e28 7365 7129 2c20 6e70 2e72  , len(seq), np.r
-000624b0: 6f75 6e64 2874 642e 6162 6e2c 2032 292c  ound(td.abn, 2),
-000624c0: 2074 642e 6973 7472 616e 642c 2074 642e   td.istrand, td.
-000624d0: 6963 6473 2029 0a20 2020 2020 2020 2020  icds ).         
-000624e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000624f0: 6964 203d 2068 6472 0a20 2020 2020 2020  id = hdr.       
-00062500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062510: 2023 2074 6964 203d 2074 6964 202b 2027   # tid = tid + '
-00062520: 206c 656e 6774 683a 2569 2073 7472 616e   length:%i stran
-00062530: 643a 2573 2025 7327 2025 2028 6c65 6e28  d:%s %s' % (len(
-00062540: 7365 7129 2c20 6765 745f 635f 6672 6f6d  seq), get_c_from
-00062550: 5f69 7374 7261 6e64 2874 642e 6973 7472  _istrand(td.istr
-00062560: 616e 6429 2c20 6765 745f 7374 725f 6672  and), get_str_fr
-00062570: 6f6d 5f69 6364 6e67 2820 7464 2e69 6364  om_icdng( td.icd
-00062580: 7320 2929 0a20 2020 2020 2020 2020 2020  s )).           
-00062590: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000625a0: 7464 2e69 7374 7261 6e64 203c 2030 3a0a  td.istrand < 0:.
-000625b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000625c0: 2020 2020 2020 2020 2020 2020 7365 7120              seq 
-000625d0: 3d20 7265 7665 7273 655f 636f 6d70 6c65  = reverse_comple
-000625e0: 6d65 6e74 2873 6571 290a 2020 2020 2020  ment(seq).      
-000625f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062600: 2020 7469 6473 2e61 7070 656e 6428 7469    tids.append(ti
-00062610: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
-00062620: 2020 2020 2020 2020 2020 2074 7365 712e             tseq.
-00062630: 6170 7065 6e64 2873 6571 290a 2020 2020  append(seq).    
-00062640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062650: 2020 2020 6162 6e74 2e61 7070 656e 6428      abnt.append(
-00062660: 7464 2e61 626e 290a 0a20 2020 2020 2020  td.abn)..       
-00062670: 2020 2020 2074 676d 7320 3d20 7365 6c66       tgms = self
-00062680: 2e74 635f 746f 5f67 635f 6d61 7073 0a20  .tc_to_gc_maps. 
-00062690: 2020 2020 2020 2020 2020 2072 676e 7320             rgns 
-000626a0: 3d20 7365 6c66 2e63 6473 2e72 676e 730a  = self.cds.rgns.
-000626b0: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-000626c0: 6574 203d 2027 4344 5327 0a0a 2020 2020  et = 'CDS'..    
-000626d0: 2020 2020 2020 2020 666f 7220 6b2c 2074          for k, t
-000626e0: 6420 696e 2065 6e75 6d65 7261 7465 2873  d in enumerate(s
-000626f0: 656c 662e 7464 5f6c 7374 293a 0a20 2020  elf.td_lst):.   
-00062700: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00062710: 6c65 6e28 7467 6d73 5b6b 5d29 203e 2030  len(tgms[k]) > 0
-00062720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00062730: 2020 2020 2020 7469 6420 3d20 7464 2e74        tid = td.t
-00062740: 6964 0a0a 2020 2020 2020 2020 2020 2020  id..            
-00062750: 2020 2020 2020 2020 7267 6e73 5f74 6d70          rgns_tmp
-00062760: 203d 2072 6567 696f 6e73 2829 0a20 2020   = regions().   
-00062770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062780: 2066 6f72 206d 2069 6e20 7467 6d73 5b6b   for m in tgms[k
-00062790: 5d3a 200a 2020 2020 2020 2020 2020 2020  ]: .            
-000627a0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-000627b0: 676e 735b 6d5d 2e74 7970 6520 3d3d 2074  gns[m].type == t
-000627c0: 6172 6765 743a 0a20 2020 2020 2020 2020  arget:.         
-000627d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000627e0: 2020 2072 676e 735f 746d 702e 7267 6e73     rgns_tmp.rgns
-000627f0: 2e61 7070 656e 6428 7267 6e73 5b6d 5d2e  .append(rgns[m].
-00062800: 636f 7079 2875 7064 6174 6520 3d20 4661  copy(update = Fa
-00062810: 6c73 6529 290a 2020 2020 2020 2020 2020  lse)).          
-00062820: 2020 2020 2020 2020 2020 7267 6e73 5f74            rgns_t
-00062830: 6d70 2e6f 7264 6572 2829 0a0a 2020 2020  mp.order()..    
-00062840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062850: 7365 7120 3d20 2727 0a20 2020 2020 2020  seq = ''.       
-00062860: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00062870: 2072 2069 6e20 7267 6e73 5f74 6d70 2e72   r in rgns_tmp.r
-00062880: 676e 733a 200a 2020 2020 2020 2020 2020  gns: .          
-00062890: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000628a0: 7120 3d20 7365 7120 2b20 6765 6e6f 6d65  q = seq + genome
-000628b0: 5b72 2e63 6872 5d2e 7365 715b 2872 2e73  [r.chr].seq[(r.s
-000628c0: 7461 7274 2d31 293a 722e 656e 645d 0a0a  tart-1):r.end]..
-000628d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000628e0: 2020 2020 6966 2028 6c65 6e28 7365 7129      if (len(seq)
-000628f0: 203e 3d20 6c65 6e5f 7468 5f74 2920 2620   >= len_th_t) & 
-00062900: 2874 642e 6162 6e20 3e3d 2061 626e 5f74  (td.abn >= abn_t
-00062910: 6829 2026 2028 7464 2e63 6f76 203e 3d20  h) & (td.cov >= 
-00062920: 636f 765f 7468 293a 0a20 2020 2020 2020  cov_th):.       
-00062930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062940: 2023 2074 6964 203d 2074 6964 202b 2027   # tid = tid + '
-00062950: 206c 656e 6774 683a 2569 2073 7472 616e   length:%i stran
-00062960: 643a 2573 2025 7327 2025 2028 6c65 6e28  d:%s %s' % (len(
-00062970: 7365 7129 2c20 6765 745f 635f 6672 6f6d  seq), get_c_from
-00062980: 5f69 7374 7261 6e64 2874 642e 6973 7472  _istrand(td.istr
-00062990: 616e 6429 2c20 6765 745f 7374 725f 6672  and), get_str_fr
-000629a0: 6f6d 5f69 6364 6e67 2820 7464 2e69 6364  om_icdng( td.icd
-000629b0: 7320 2929 0a20 2020 2020 2020 2020 2020  s )).           
-000629c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000629d0: 7464 2e69 7374 7261 6e64 203e 3d20 303a  td.istrand >= 0:
-000629e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000629f0: 2020 2020 2020 2020 2020 2020 2061 7365               ase
-00062a00: 7120 3d20 7472 616e 736c 6174 6528 7365  q = translate(se
-00062a10: 7129 0a20 2020 2020 2020 2020 2020 2020  q).             
-00062a20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00062a30: 6620 6c65 6e28 6173 6571 2920 3e3d 206c  f len(aseq) >= l
-00062a40: 656e 5f74 685f 703a 0a20 2020 2020 2020  en_th_p:.       
+00061dd0: 6966 2074 642e 6973 7472 616e 6420 3c20  if td.istrand < 
+00061de0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00061df0: 2020 2020 2020 2020 2020 2070 7365 7120             pseq 
+00061e00: 3d20 7265 7665 7273 655f 636f 6d70 6c65  = reverse_comple
+00061e10: 6d65 6e74 2873 6571 290a 2020 2020 2020  ment(seq).      
+00061e20: 2020 2020 2020 2020 2020 2020 2020 6173                as
+00061e30: 6571 203d 2074 7261 6e73 6c61 7465 2870  eq = translate(p
+00061e40: 7365 7129 0a20 2020 2020 2020 2020 2020  seq).           
+00061e50: 2020 2020 2020 2020 206e 5f65 7220 3d20           n_er = 
+00061e60: 7365 6c66 2e63 6f6d 7061 7265 5f73 6571  self.compare_seq
+00061e70: 7328 2074 642e 6173 6571 2c20 6173 6571  s( td.aseq, aseq
+00061e80: 2c20 7469 642c 2076 6572 626f 7365 203d  , tid, verbose =
+00061e90: 2046 616c 7365 2029 0a0a 2020 2020 2020   False )..      
+00061ea0: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+00061eb0: 6572 5f74 6f74 616c 202b 3d20 6e5f 6572  er_total += n_er
+00061ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00061ed0: 2020 2020 206e 5f74 6f74 616c 202b 3d20       n_total += 
+00061ee0: 6c65 6e28 6173 6571 290a 0a20 2020 2020  len(aseq)..     
+00061ef0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00061f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00061f10: 2020 2020 2070 7269 6e74 2827 4552 524f       print('ERRO
+00061f20: 5228 5029 3a20 2573 206f 6620 6c65 6e28  R(P): %s of len(
+00061f30: 2569 2920 6e6f 7420 6465 7465 6374 6564  %i) not detected
+00061f40: 2720 2520 2874 6964 2c20 6c65 6e28 7464  ' % (tid, len(td
+00061f50: 2e61 7365 7129 2929 0a20 2020 2020 2020  .aseq))).       
+00061f60: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00061f70: 2020 2020 2020 2320 6966 206e 5f65 725f        # if n_er_
+00061f80: 746f 7461 6c20 3e20 303a 2073 656c 662e  total > 0: self.
+00061f90: 7072 696e 745f 6364 735f 696e 666f 2863  print_cds_info(c
+00061fa0: 6872 5f73 6571 290a 0a20 2020 2020 2020  hr_seq)..       
+00061fb0: 2072 6574 7572 6e20 6e5f 6572 5f74 6f74   return n_er_tot
+00061fc0: 616c 2c20 6e5f 746f 7461 6c0a 2020 2020  al, n_total.    
+00061fd0: 0a0a 2020 2020 6465 6620 6765 745f 616c  ..    def get_al
+00061fe0: 6c5f 7365 715f 6672 6f6d 5f67 656e 6f6d  l_seq_from_genom
+00061ff0: 6528 7365 6c66 2c20 6765 6e6f 6d65 2c20  e(self, genome, 
+00062000: 6162 6e5f 7468 203d 2030 2c20 636f 765f  abn_th = 0, cov_
+00062010: 7468 203d 2030 2c20 6c65 6e5f 7468 5f74  th = 0, len_th_t
+00062020: 203d 2032 3030 2c20 6c65 6e5f 7468 5f70   = 200, len_th_p
+00062030: 203d 2035 3029 3a0a 0a20 2020 2020 2020   = 50):..       
+00062040: 2074 6964 7320 3d20 5b5d 0a20 2020 2020   tids = [].     
+00062050: 2020 2074 7365 7120 3d20 5b5d 0a20 2020     tseq = [].   
+00062060: 2020 2020 2061 626e 7420 3d20 5b5d 0a0a       abnt = []..
+00062070: 2020 2020 2020 2020 7069 6473 203d 205b          pids = [
+00062080: 5d0a 2020 2020 2020 2020 7073 6571 203d  ].        pseq =
+00062090: 205b 5d0a 2020 2020 2020 2020 6162 6e70   [].        abnp
+000620a0: 203d 205b 5d0a 0a20 2020 2020 2020 2069   = []..        i
+000620b0: 6620 7365 6c66 2e63 6872 2069 6e20 6765  f self.chr in ge
+000620c0: 6e6f 6d65 2e6b 6579 7328 293a 0a20 2020  nome.keys():.   
+000620d0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+000620e0: 2020 2020 2020 7467 6d73 203d 2073 656c        tgms = sel
+000620f0: 662e 7465 5f74 6f5f 6765 5f6d 6170 730a  f.te_to_ge_maps.
+00062100: 2020 2020 2020 2020 2020 2020 7267 6e73              rgns
+00062110: 203d 2073 656c 662e 6578 6f6e 732e 7267   = self.exons.rg
+00062120: 6e73 0a20 2020 2020 2020 2020 2020 2074  ns.            t
+00062130: 6172 6765 7420 3d20 2765 786f 6e27 0a0a  arget = 'exon'..
+00062140: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00062150: 6b2c 2074 6420 696e 2065 6e75 6d65 7261  k, td in enumera
+00062160: 7465 2873 656c 662e 7464 5f6c 7374 293a  te(self.td_lst):
+00062170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00062180: 2069 6620 6c65 6e28 7467 6d73 5b6b 5d29   if len(tgms[k])
+00062190: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+000621a0: 2020 2020 2020 2020 2020 7469 6420 3d20            tid = 
+000621b0: 7464 2e74 6964 0a20 2020 2020 2020 2020  td.tid.         
+000621c0: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
+000621d0: 746d 7020 3d20 7265 6769 6f6e 7328 290a  tmp = regions().
+000621e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000621f0: 2020 2020 666f 7220 6d20 696e 2074 676d      for m in tgm
+00062200: 735b 6b5d 3a20 0a20 2020 2020 2020 2020  s[k]: .         
+00062210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00062220: 6620 7267 6e73 5b6d 5d2e 7479 7065 203d  f rgns[m].type =
+00062230: 3d20 7461 7267 6574 3a0a 2020 2020 2020  = target:.      
+00062240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062250: 2020 2020 2020 7267 6e73 5f74 6d70 2e72        rgns_tmp.r
+00062260: 676e 732e 6170 7065 6e64 2872 676e 735b  gns.append(rgns[
+00062270: 6d5d 2e63 6f70 7928 7570 6461 7465 203d  m].copy(update =
+00062280: 2046 616c 7365 2929 0a20 2020 2020 2020   False)).       
+00062290: 2020 2020 2020 2020 2020 2020 2072 676e               rgn
+000622a0: 735f 746d 702e 6f72 6465 7228 290a 0a20  s_tmp.order().. 
+000622b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000622c0: 2020 2073 6571 203d 2027 270a 2020 2020     seq = ''.    
+000622d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000622e0: 666f 7220 7220 696e 2072 676e 735f 746d  for r in rgns_tm
+000622f0: 702e 7267 6e73 3a20 0a20 2020 2020 2020  p.rgns: .       
+00062300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062310: 2073 6571 203d 2073 6571 202b 2067 656e   seq = seq + gen
+00062320: 6f6d 655b 722e 6368 725d 2e73 6571 5b28  ome[r.chr].seq[(
+00062330: 722e 7374 6172 742d 3129 3a72 2e65 6e64  r.start-1):r.end
+00062340: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00062350: 2020 2020 2020 6966 2028 6c65 6e28 7365        if (len(se
+00062360: 7129 203e 3d20 6c65 6e5f 7468 5f74 2920  q) >= len_th_t) 
+00062370: 2620 2874 642e 6162 6e20 3e3d 2061 626e  & (td.abn >= abn
+00062380: 5f74 6829 2026 2028 7464 2e63 6f76 203e  _th) & (td.cov >
+00062390: 3d20 636f 765f 7468 293a 0a20 2020 2020  = cov_th):.     
+000623a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000623b0: 2020 2068 6472 203d 2073 6574 5f66 615f     hdr = set_fa_
+000623c0: 6865 6164 6572 2820 7469 642c 206c 656e  header( tid, len
+000623d0: 2873 6571 292c 206e 702e 726f 756e 6428  (seq), np.round(
+000623e0: 7464 2e61 626e 2c20 3229 2c20 7464 2e69  td.abn, 2), td.i
+000623f0: 7374 7261 6e64 2c20 7464 2e69 6364 7320  strand, td.icds 
+00062400: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00062410: 2020 2020 2020 2020 2020 7469 6420 3d20            tid = 
+00062420: 6864 720a 2020 2020 2020 2020 2020 2020  hdr.            
+00062430: 2020 2020 2020 2020 2020 2020 2320 7469              # ti
+00062440: 6420 3d20 7469 6420 2b20 2720 6c65 6e67  d = tid + ' leng
+00062450: 7468 3a25 6920 7374 7261 6e64 3a25 7320  th:%i strand:%s 
+00062460: 2573 2720 2520 286c 656e 2873 6571 292c  %s' % (len(seq),
+00062470: 2067 6574 5f63 5f66 726f 6d5f 6973 7472   get_c_from_istr
+00062480: 616e 6428 7464 2e69 7374 7261 6e64 292c  and(td.istrand),
+00062490: 2067 6574 5f73 7472 5f66 726f 6d5f 6963   get_str_from_ic
+000624a0: 646e 6728 2074 642e 6963 6473 2029 290a  dng( td.icds )).
+000624b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000624c0: 2020 2020 2020 2020 6966 2074 642e 6973          if td.is
+000624d0: 7472 616e 6420 3c20 303a 0a20 2020 2020  trand < 0:.     
+000624e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000624f0: 2020 2020 2020 2073 6571 203d 2072 6576         seq = rev
+00062500: 6572 7365 5f63 6f6d 706c 656d 656e 7428  erse_complement(
+00062510: 7365 7129 0a20 2020 2020 2020 2020 2020  seq).           
+00062520: 2020 2020 2020 2020 2020 2020 2074 6964               tid
+00062530: 732e 6170 7065 6e64 2874 6964 290a 2020  s.append(tid).  
+00062540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062550: 2020 2020 2020 7473 6571 2e61 7070 656e        tseq.appen
+00062560: 6428 7365 7129 0a20 2020 2020 2020 2020  d(seq).         
+00062570: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00062580: 626e 742e 6170 7065 6e64 2874 642e 6162  bnt.append(td.ab
+00062590: 6e29 0a0a 2020 2020 2020 2020 2020 2020  n)..            
+000625a0: 7467 6d73 203d 2073 656c 662e 7463 5f74  tgms = self.tc_t
+000625b0: 6f5f 6763 5f6d 6170 730a 2020 2020 2020  o_gc_maps.      
+000625c0: 2020 2020 2020 7267 6e73 203d 2073 656c        rgns = sel
+000625d0: 662e 6364 732e 7267 6e73 0a20 2020 2020  f.cds.rgns.     
+000625e0: 2020 2020 2020 2074 6172 6765 7420 3d20         target = 
+000625f0: 2743 4453 270a 0a20 2020 2020 2020 2020  'CDS'..         
+00062600: 2020 2066 6f72 206b 2c20 7464 2069 6e20     for k, td in 
+00062610: 656e 756d 6572 6174 6528 7365 6c66 2e74  enumerate(self.t
+00062620: 645f 6c73 7429 3a0a 2020 2020 2020 2020  d_lst):.        
+00062630: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
+00062640: 676d 735b 6b5d 2920 3e20 303a 0a20 2020  gms[k]) > 0:.   
+00062650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062660: 2074 6964 203d 2074 642e 7469 640a 0a20   tid = td.tid.. 
+00062670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062680: 2020 2072 676e 735f 746d 7020 3d20 7265     rgns_tmp = re
+00062690: 6769 6f6e 7328 290a 2020 2020 2020 2020  gions().        
+000626a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000626b0: 6d20 696e 2074 676d 735b 6b5d 3a20 0a20  m in tgms[k]: . 
+000626c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000626d0: 2020 2020 2020 2069 6620 7267 6e73 5b6d         if rgns[m
+000626e0: 5d2e 7479 7065 203d 3d20 7461 7267 6574  ].type == target
+000626f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00062700: 2020 2020 2020 2020 2020 2020 2020 7267                rg
+00062710: 6e73 5f74 6d70 2e72 676e 732e 6170 7065  ns_tmp.rgns.appe
+00062720: 6e64 2872 676e 735b 6d5d 2e63 6f70 7928  nd(rgns[m].copy(
+00062730: 7570 6461 7465 203d 2046 616c 7365 2929  update = False))
+00062740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00062750: 2020 2020 2072 676e 735f 746d 702e 6f72       rgns_tmp.or
+00062760: 6465 7228 290a 0a20 2020 2020 2020 2020  der()..         
+00062770: 2020 2020 2020 2020 2020 2073 6571 203d             seq =
+00062780: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
+00062790: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+000627a0: 2072 676e 735f 746d 702e 7267 6e73 3a20   rgns_tmp.rgns: 
+000627b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000627c0: 2020 2020 2020 2020 2073 6571 203d 2073           seq = s
+000627d0: 6571 202b 2067 656e 6f6d 655b 722e 6368  eq + genome[r.ch
+000627e0: 725d 2e73 6571 5b28 722e 7374 6172 742d  r].seq[(r.start-
+000627f0: 3129 3a72 2e65 6e64 5d0a 0a20 2020 2020  1):r.end]..     
+00062800: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00062810: 6620 286c 656e 2873 6571 2920 3e3d 206c  f (len(seq) >= l
+00062820: 656e 5f74 685f 7429 2026 2028 7464 2e61  en_th_t) & (td.a
+00062830: 626e 203e 3d20 6162 6e5f 7468 2920 2620  bn >= abn_th) & 
+00062840: 2874 642e 636f 7620 3e3d 2063 6f76 5f74  (td.cov >= cov_t
+00062850: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00062860: 2020 2020 2020 2020 2020 2020 2320 7469              # ti
+00062870: 6420 3d20 7469 6420 2b20 2720 6c65 6e67  d = tid + ' leng
+00062880: 7468 3a25 6920 7374 7261 6e64 3a25 7320  th:%i strand:%s 
+00062890: 2573 2720 2520 286c 656e 2873 6571 292c  %s' % (len(seq),
+000628a0: 2067 6574 5f63 5f66 726f 6d5f 6973 7472   get_c_from_istr
+000628b0: 616e 6428 7464 2e69 7374 7261 6e64 292c  and(td.istrand),
+000628c0: 2067 6574 5f73 7472 5f66 726f 6d5f 6963   get_str_from_ic
+000628d0: 646e 6728 2074 642e 6963 6473 2029 290a  dng( td.icds )).
+000628e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000628f0: 2020 2020 2020 2020 6966 2074 642e 6973          if td.is
+00062900: 7472 616e 6420 3e3d 2030 3a0a 2020 2020  trand >= 0:.    
+00062910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062920: 2020 2020 2020 2020 6173 6571 203d 2074          aseq = t
+00062930: 7261 6e73 6c61 7465 2873 6571 290a 2020  ranslate(seq).  
+00062940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062950: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00062960: 2861 7365 7129 203e 3d20 6c65 6e5f 7468  (aseq) >= len_th
+00062970: 5f70 3a0a 2020 2020 2020 2020 2020 2020  _p:.            
+00062980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062990: 2020 2020 7469 6420 3d20 7365 745f 6661      tid = set_fa
+000629a0: 5f68 6561 6465 7228 2074 6964 2c20 6c65  _header( tid, le
+000629b0: 6e28 6173 6571 292c 206e 702e 726f 756e  n(aseq), np.roun
+000629c0: 6428 7464 2e61 626e 2c20 3229 2c20 7464  d(td.abn, 2), td
+000629d0: 2e69 7374 7261 6e64 2c20 7464 2e69 6364  .istrand, td.icd
+000629e0: 7320 290a 2020 2020 2020 2020 2020 2020  s ).            
+000629f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062a00: 2020 2020 7069 6473 2e61 7070 656e 6428      pids.append(
+00062a10: 7469 6429 0a20 2020 2020 2020 2020 2020  tid).           
+00062a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062a30: 2020 2020 2070 7365 712e 6170 7065 6e64       pseq.append
+00062a40: 2861 7365 7129 0a20 2020 2020 2020 2020  (aseq).         
 00062a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062a60: 2020 2020 2020 2020 2074 6964 203d 2073           tid = s
-00062a70: 6574 5f66 615f 6865 6164 6572 2820 7469  et_fa_header( ti
-00062a80: 642c 206c 656e 2861 7365 7129 2c20 6e70  d, len(aseq), np
-00062a90: 2e72 6f75 6e64 2874 642e 6162 6e2c 2032  .round(td.abn, 2
-00062aa0: 292c 2074 642e 6973 7472 616e 642c 2074  ), td.istrand, t
-00062ab0: 642e 6963 6473 2029 0a20 2020 2020 2020  d.icds ).       
-00062ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062ad0: 2020 2020 2020 2020 2070 6964 732e 6170           pids.ap
-00062ae0: 7065 6e64 2874 6964 290a 2020 2020 2020  pend(tid).      
-00062af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062b00: 2020 2020 2020 2020 2020 7073 6571 2e61            pseq.a
-00062b10: 7070 656e 6428 6173 6571 290a 2020 2020  ppend(aseq).    
+00062a60: 2020 2020 2020 2061 626e 702e 6170 7065         abnp.appe
+00062a70: 6e64 2874 642e 6162 6e29 0a20 2020 2020  nd(td.abn).     
+00062a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062a90: 2020 2069 6620 7464 2e69 7374 7261 6e64     if td.istrand
+00062aa0: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
+00062ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062ac0: 2020 2061 7365 7120 3d20 7265 7665 7273     aseq = revers
+00062ad0: 655f 636f 6d70 6c65 6d65 6e74 2873 6571  e_complement(seq
+00062ae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00062af0: 2020 2020 2020 2020 2020 2020 2020 6173                as
+00062b00: 6571 203d 2074 7261 6e73 6c61 7465 2861  eq = translate(a
+00062b10: 7365 7129 0a20 2020 2020 2020 2020 2020  seq).           
 00062b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062b30: 2020 2020 2020 2020 2020 2020 6162 6e70              abnp
-00062b40: 2e61 7070 656e 6428 7464 2e61 626e 290a  .append(td.abn).
+00062b30: 2069 6620 6c65 6e28 6173 6571 2920 3e3d   if len(aseq) >=
+00062b40: 206c 656e 5f74 685f 703a 0a20 2020 2020   len_th_p:.     
 00062b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062b60: 2020 2020 2020 2020 6966 2074 642e 6973          if td.is
-00062b70: 7472 616e 6420 3c3d 2030 3a0a 2020 2020  trand <= 0:.    
-00062b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062b90: 2020 2020 2020 2020 6173 6571 203d 2072          aseq = r
-00062ba0: 6576 6572 7365 5f63 6f6d 706c 656d 656e  everse_complemen
-00062bb0: 7428 7365 7129 0a20 2020 2020 2020 2020  t(seq).         
+00062b60: 2020 2020 2020 2020 2020 2074 6964 203d             tid =
+00062b70: 2073 6574 5f66 615f 6865 6164 6572 2820   set_fa_header( 
+00062b80: 7469 642c 206c 656e 2861 7365 7129 2c20  tid, len(aseq), 
+00062b90: 6e70 2e72 6f75 6e64 2874 642e 6162 6e2c  np.round(td.abn,
+00062ba0: 2032 292c 2074 642e 6973 7472 616e 642c   2), td.istrand,
+00062bb0: 2074 642e 6963 6473 2029 0a20 2020 2020   td.icds ).     
 00062bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062bd0: 2020 2061 7365 7120 3d20 7472 616e 736c     aseq = transl
-00062be0: 6174 6528 6173 6571 290a 2020 2020 2020  ate(aseq).      
+00062bd0: 2020 2020 2020 2020 2020 2070 6964 732e             pids.
+00062be0: 6170 7065 6e64 2874 6964 290a 2020 2020  append(tid).    
 00062bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062c00: 2020 2020 2020 6966 206c 656e 2861 7365        if len(ase
-00062c10: 7129 203e 3d20 6c65 6e5f 7468 5f70 3a0a  q) >= len_th_p:.
+00062c00: 2020 2020 2020 2020 2020 2020 7073 6571              pseq
+00062c10: 2e61 7070 656e 6428 6173 6571 290a 2020  .append(aseq).  
 00062c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062c40: 7469 6420 3d20 7365 745f 6661 5f68 6561  tid = set_fa_hea
-00062c50: 6465 7228 2074 6964 2c20 6c65 6e28 6173  der( tid, len(as
-00062c60: 6571 292c 206e 702e 726f 756e 6428 7464  eq), np.round(td
-00062c70: 2e61 626e 2c20 3229 2c20 7464 2e69 7374  .abn, 2), td.ist
-00062c80: 7261 6e64 2c20 7464 2e69 6364 7320 290a  rand, td.icds ).
-00062c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062cb0: 7069 6473 2e61 7070 656e 6428 7469 6429  pids.append(tid)
-00062cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00062cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062ce0: 2070 7365 712e 6170 7065 6e64 2861 7365   pseq.append(ase
-00062cf0: 7129 0a20 2020 2020 2020 2020 2020 2020  q).             
-00062d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062d10: 2020 2061 626e 702e 6170 7065 6e64 2874     abnp.append(t
-00062d20: 642e 6162 6e29 0a20 2020 2020 2020 2020  d.abn).         
-00062d30: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00062d40: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00062d50: 6964 732c 2074 7365 712c 2061 626e 742c  ids, tseq, abnt,
-00062d60: 2070 6964 732c 2070 7365 712c 2061 626e   pids, pseq, abn
-00062d70: 700a 0a0a 0a20 2020 2064 6566 2067 6574  p....    def get
-00062d80: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
-00062d90: 6d5f 6765 6e6f 6d65 2873 656c 662c 2067  m_genome(self, g
-00062da0: 656e 6f6d 652c 2061 626e 5f74 6820 3d20  enome, abn_th = 
-00062db0: 302c 2063 6f76 5f74 6820 3d20 302c 206c  0, cov_th = 0, l
-00062dc0: 656e 5f74 685f 7420 3d20 3230 302c 206c  en_th_t = 200, l
-00062dd0: 656e 5f74 685f 7020 3d20 3530 293a 0a0a  en_th_p = 50):..
-00062de0: 2020 2020 2020 2020 7469 6473 2c20 7473          tids, ts
-00062df0: 6571 2c20 6162 6e74 2c20 7069 6473 2c20  eq, abnt, pids, 
-00062e00: 7073 6571 2c20 6162 6e70 203d 2073 656c  pseq, abnp = sel
-00062e10: 662e 6765 745f 616c 6c5f 7365 715f 6672  f.get_all_seq_fr
-00062e20: 6f6d 5f67 656e 6f6d 6528 6765 6e6f 6d65  om_genome(genome
-00062e30: 2c20 6162 6e5f 7468 2c20 636f 765f 7468  , abn_th, cov_th
-00062e40: 2c20 6c65 6e5f 7468 5f74 2c20 6c65 6e5f  , len_th_t, len_
-00062e50: 7468 5f70 290a 0a20 2020 2020 2020 2066  th_p)..        f
-00062e60: 6173 7461 5f6c 696e 6573 5f74 203d 205b  asta_lines_t = [
-00062e70: 5d0a 2020 2020 2020 2020 666f 7220 6b2c  ].        for k,
-00062e80: 2074 6964 2069 6e20 656e 756d 6572 6174   tid in enumerat
-00062e90: 6528 7469 6473 293a 0a20 2020 2020 2020  e(tids):.       
-00062ea0: 2020 2020 2066 6173 7461 5f6c 696e 6573       fasta_lines
-00062eb0: 5f74 2e61 7070 656e 6428 2027 3e25 735c  _t.append( '>%s\
-00062ec0: 6e27 2025 2074 6964 2029 0a20 2020 2020  n' % tid ).     
-00062ed0: 2020 2020 2020 2066 6173 7461 5f6c 696e         fasta_lin
-00062ee0: 6573 5f74 2e61 7070 656e 6428 2027 2573  es_t.append( '%s
-00062ef0: 5c6e 2720 2520 7473 6571 5b6b 5d20 290a  \n' % tseq[k] ).
-00062f00: 0a20 2020 2020 2020 2066 6173 7461 5f6c  .        fasta_l
-00062f10: 696e 6573 5f70 203d 205b 5d0a 2020 2020  ines_p = [].    
-00062f20: 2020 2020 666f 7220 6b2c 2074 6964 2069      for k, tid i
-00062f30: 6e20 656e 756d 6572 6174 6528 7069 6473  n enumerate(pids
-00062f40: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-00062f50: 6173 7461 5f6c 696e 6573 5f70 2e61 7070  asta_lines_p.app
-00062f60: 656e 6428 2027 3e25 735c 6e27 2025 2074  end( '>%s\n' % t
-00062f70: 6964 2029 0a20 2020 2020 2020 2020 2020  id ).           
-00062f80: 2066 6173 7461 5f6c 696e 6573 5f70 2e61   fasta_lines_p.a
-00062f90: 7070 656e 6428 2027 2573 5c6e 2720 2520  ppend( '%s\n' % 
-00062fa0: 7073 6571 5b6b 5d20 290a 2020 2020 2020  pseq[k] ).      
-00062fb0: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
-00062fc0: 6574 7572 6e20 6661 7374 615f 6c69 6e65  eturn fasta_line
-00062fd0: 735f 742c 2066 6173 7461 5f6c 696e 6573  s_t, fasta_lines
-00062fe0: 5f70 0a20 2020 2020 2020 2020 2020 200a  _p.            .
-00062ff0: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
-00063000: 2070 7269 6e74 5f65 786f 6e28 7365 6c66   print_exon(self
-00063010: 293a 0a20 2020 2020 2020 200a 2020 2020  ):.        .    
-00063020: 2020 2020 7365 6c66 2e65 786f 6e73 2e70      self.exons.p
-00063030: 7269 6e74 5f73 686f 7274 2829 0a20 2020  rint_short().   
-00063040: 2020 2020 200a 0a23 2323 2323 2323 2323       ..#########
-00063050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00063060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00063070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00063080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00063090: 230a 2323 2046 756e 6374 696f 6e73 2074  #.## Functions t
-000630a0: 6f20 696e 6974 6961 6c69 7a65 2047 442f  o initialize GD/
-000630b0: 5444 2066 726f 6d20 4754 460a 2323 2323  TD from GTF.####
-000630c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000630d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000630e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000630f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00063100: 2323 2323 2323 0a0a 6465 6620 7365 6c65  ######..def sele
-00063110: 6374 5f63 6f64 696e 675f 6765 6e65 735f  ct_coding_genes_
-00063120: 6672 6f6d 5f67 7466 5f66 696c 6528 6774  from_gtf_file(gt
-00063130: 665f 6669 6c65 293a 0a0a 2020 2020 666e  f_file):..    fn
-00063140: 7320 3d20 6774 665f 6669 6c65 2e73 706c  s = gtf_file.spl
-00063150: 6974 2827 2e27 295b 3a2d 315d 0a20 2020  it('.')[:-1].   
-00063160: 2066 6e61 6d65 203d 2027 270a 2020 2020   fname = ''.    
-00063170: 666f 7220 6b2c 2066 6e20 696e 2065 6e75  for k, fn in enu
-00063180: 6d65 7261 7465 2866 6e73 293a 0a20 2020  merate(fns):.   
-00063190: 2020 2020 2069 6620 6b20 3e20 303a 0a20       if k > 0:. 
-000631a0: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-000631b0: 203d 2066 6e61 6d65 202b 2027 2e27 0a20   = fname + '.'. 
-000631c0: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
-000631d0: 6e61 6d65 202b 2066 6e0a 2020 2020 0a20  name + fn.    . 
-000631e0: 2020 2067 7466 5f6c 696e 6573 2c20 6864     gtf_lines, hd
-000631f0: 725f 6c69 6e65 7320 3d20 6c6f 6164 5f67  r_lines = load_g
-00063200: 7466 2867 7466 5f66 696c 652c 2076 6572  tf(gtf_file, ver
-00063210: 626f 7365 203d 2054 7275 6529 0a20 2020  bose = True).   
-00063220: 200a 2020 2020 6261 7365 5f63 6473 203d   .    base_cds =
-00063230: 2067 6574 5f62 6173 655f 6364 735f 6672   get_base_cds_fr
-00063240: 6f6d 5f67 7466 5f6c 696e 6573 2867 7466  om_gtf_lines(gtf
-00063250: 5f6c 696e 6573 290a 2020 2020 6966 2062  _lines).    if b
-00063260: 6173 655f 6364 7320 3c20 303a 0a20 2020  ase_cds < 0:.   
-00063270: 2020 2020 2070 7269 6e74 2827 494e 464f       print('INFO
-00063280: 3a20 4e6f 2063 6f64 696e 6720 696e 666f  : No coding info
-00063290: 726d 6174 696f 6e20 6176 6169 6c61 626c  rmation availabl
-000632a0: 6520 696e 2074 6865 2047 5446 2f47 4646  e in the GTF/GFF
-000632b0: 2e27 290a 2020 2020 0a20 2020 2067 7466  .').    .    gtf
-000632c0: 5f6c 696e 6573 5f6c 7374 203d 2070 6172  _lines_lst = par
-000632d0: 7365 5f67 7466 5f6c 696e 6573 5f61 6e64  se_gtf_lines_and
-000632e0: 5f73 706c 6974 5f69 6e74 6f5f 6765 6e65  _split_into_gene
-000632f0: 7328 2067 7466 5f6c 696e 6573 2029 0a0a  s( gtf_lines )..
-00063300: 2020 2020 6774 665f 6c69 6e65 735f 6c73      gtf_lines_ls
-00063310: 745f 6e65 7720 3d20 5b5d 0a20 2020 2063  t_new = [].    c
-00063320: 636e 7420 3d20 300a 2020 2020 6763 6e74  cnt = 0.    gcnt
-00063330: 203d 2030 0a20 2020 2066 6f72 206b 2c20   = 0.    for k, 
-00063340: 6c69 6e65 7320 696e 2065 6e75 6d65 7261  lines in enumera
-00063350: 7465 2867 7466 5f6c 696e 6573 5f6c 7374  te(gtf_lines_lst
-00063360: 293a 0a20 2020 2020 2020 2062 203d 2046  ):.        b = F
-00063370: 616c 7365 0a20 2020 2020 2020 2063 6e74  alse.        cnt
-00063380: 203d 205b 302c 305d 0a20 2020 2020 2020   = [0,0].       
-00063390: 2066 6f72 2067 7466 6c69 6e65 2069 6e20   for gtfline in 
-000633a0: 6c69 6e65 733a 0a20 2020 2020 2020 2020  lines:.         
-000633b0: 2020 2069 6620 6774 666c 696e 652e 6665     if gtfline.fe
-000633c0: 6174 7572 6520 3d3d 2027 7374 6172 745f  ature == 'start_
-000633d0: 636f 646f 6e27 3a0a 2020 2020 2020 2020  codon':.        
-000633e0: 2020 2020 2020 2020 636e 745b 305d 202b          cnt[0] +
-000633f0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00063400: 6966 2067 7466 6c69 6e65 2e66 6561 7475  if gtfline.featu
-00063410: 7265 203d 3d20 2773 746f 705f 636f 646f  re == 'stop_codo
-00063420: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-00063430: 2020 2020 636e 745b 315d 202b 3d20 310a      cnt[1] += 1.
-00063440: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00063450: 636e 745b 305d 203e 2030 2920 2620 2863  cnt[0] > 0) & (c
-00063460: 6e74 5b31 5d20 3e20 3029 3a0a 2020 2020  nt[1] > 0):.    
-00063470: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-00063480: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00063490: 2020 2020 2063 636e 7420 2b3d 2031 0a20       ccnt += 1. 
-000634a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000634b0: 7265 616b 0a20 2020 2020 2020 2067 636e  reak.        gcn
-000634c0: 7420 2b3d 2031 0a20 2020 2020 2020 2069  t += 1.        i
-000634d0: 6620 6b25 3130 3020 3d3d 2030 3a20 7072  f k%100 == 0: pr
-000634e0: 696e 7428 275c 7270 6172 7369 6e67 202e  int('\rparsing .
-000634f0: 2e20 2569 2f25 6920 2825 692f 2569 2927  . %i/%i (%i/%i)'
-00063500: 2025 2028 6b2c 206c 656e 2867 7466 5f6c   % (k, len(gtf_l
-00063510: 696e 6573 5f6c 7374 292c 2063 636e 742c  ines_lst), ccnt,
-00063520: 2067 636e 7429 2c20 656e 643d 2727 2c20   gcnt), end='', 
-00063530: 666c 7573 6820 3d20 5472 7565 2029 0a20  flush = True ). 
-00063540: 2020 2020 2020 2069 6620 623a 2067 7466         if b: gtf
-00063550: 5f6c 696e 6573 5f6c 7374 5f6e 6577 203d  _lines_lst_new =
-00063560: 2067 7466 5f6c 696e 6573 5f6c 7374 5f6e   gtf_lines_lst_n
-00063570: 6577 202b 206c 696e 6573 0a0a 2020 2020  ew + lines..    
-00063580: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
-00063590: 275f 6364 732e 6774 6627 0a20 2020 2073  '_cds.gtf'.    s
-000635a0: 6176 655f 6774 6628 2066 6e61 6d65 2c20  ave_gtf( fname, 
-000635b0: 6774 665f 6c69 6e65 735f 6c73 745f 6e65  gtf_lines_lst_ne
-000635c0: 772c 2068 6472 5f6c 696e 6573 2029 0a20  w, hdr_lines ). 
-000635d0: 2020 200a 2020 2020 7265 7475 726e 2066     .    return f
-000635e0: 6e61 6d65 0a20 2020 200a 0a0a 6465 6620  name.    ...def 
-000635f0: 636f 6d62 696e 655f 6765 6e65 735f 7065  combine_genes_pe
-00063600: 725f 6368 7228 2067 645f 6c73 742c 2076  r_chr( gd_lst, v
-00063610: 6572 626f 7365 203d 2046 616c 7365 2029  erbose = False )
-00063620: 3a0a 2020 2020 0a20 2020 2067 5f6c 7374  :.    .    g_lst
-00063630: 203d 207b 6b3a 205b 5d20 666f 7220 6b20   = {k: [] for k 
-00063640: 696e 2072 616e 6765 286c 656e 2867 645f  in range(len(gd_
-00063650: 6c73 7429 297d 0a20 2020 206e 6720 3d20  lst))}.    ng = 
-00063660: 6c65 6e28 6764 5f6c 7374 290a 0a20 2020  len(gd_lst)..   
-00063670: 2073 7461 7274 5f74 696d 6531 203d 2074   start_time1 = t
-00063680: 696d 652e 7469 6d65 2829 0a20 2020 2023  ime.time().    #
-00063690: 2727 270a 2020 2020 0a20 2020 206e 5f67  '''.    .    n_g
-000636a0: 6420 3d20 6c65 6e28 6764 5f6c 7374 290a  d = len(gd_lst).
-000636b0: 2020 2020 735f 706f 7320 3d20 6e70 2e7a      s_pos = np.z
-000636c0: 6572 6f73 286e 5f67 6429 0a20 2020 2065  eros(n_gd).    e
-000636d0: 5f70 6f73 203d 206e 702e 7a65 726f 7328  _pos = np.zeros(
-000636e0: 6e5f 6764 290a 2020 2020 655f 6d61 7820  n_gd).    e_max 
-000636f0: 3d20 6e70 2e7a 6572 6f73 286e 5f67 6429  = np.zeros(n_gd)
-00063700: 0a20 2020 2065 6e64 5f6d 6178 203d 2030  .    end_max = 0
-00063710: 0a20 2020 2066 6f72 206b 2c20 6764 2069  .    for k, gd i
-00063720: 6e20 656e 756d 6572 6174 6528 6764 5f6c  n enumerate(gd_l
-00063730: 7374 293a 200a 2020 2020 2020 2020 735f  st): .        s_
-00063740: 706f 735b 6b5d 203d 2067 642e 6265 6769  pos[k] = gd.begi
-00063750: 6e0a 2020 2020 2020 2020 655f 706f 735b  n.        e_pos[
-00063760: 6b5d 203d 2067 642e 656e 640a 2020 2020  k] = gd.end.    
-00063770: 2020 2020 0a20 2020 206f 6472 203d 2073      .    odr = s
-00063780: 5f70 6f73 2e61 7267 736f 7274 2829 0a20  _pos.argsort(). 
-00063790: 2020 200a 2020 2020 666f 7220 6b6b 2069     .    for kk i
-000637a0: 6e20 7261 6e67 6528 6c65 6e28 6764 5f6c  n range(len(gd_l
-000637b0: 7374 2929 3a20 0a20 2020 2020 2020 206b  st)): .        k
-000637c0: 203d 206f 6472 5b6b 6b5d 0a20 2020 2020   = odr[kk].     
-000637d0: 2020 2065 6e64 5f6d 6178 203d 206d 6178     end_max = max
-000637e0: 2865 6e64 5f6d 6178 2c20 655f 706f 735b  (end_max, e_pos[
-000637f0: 6b5d 290a 2020 2020 2020 2020 655f 6d61  k]).        e_ma
-00063800: 785b 6b5d 203d 2065 6e64 5f6d 6178 0a20  x[k] = end_max. 
-00063810: 2020 2020 2020 200a 2020 2020 2327 2727         .    #'''
-00063820: 0a20 2020 2066 6f72 206b 6b20 696e 2072  .    for kk in r
-00063830: 616e 6765 2831 2c6e 5f67 6429 3a0a 2020  ange(1,n_gd):.  
-00063840: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
-00063850: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00063860: 206b 6b25 3130 3020 3d3d 2030 3a0a 2020   kk%100 == 0:.  
-00063870: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00063880: 696e 7428 275c 7243 6f6d 6269 6e69 6e67  int('\rCombining
-00063890: 2067 656e 6573 2025 692f 2569 2720 2520   genes %i/%i' % 
-000638a0: 286b 6b2c 6e5f 6764 292c 2065 6e64 3d27  (kk,n_gd), end='
-000638b0: 2020 2020 2720 290a 2020 2020 2020 2020      ' ).        
-000638c0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000638d0: 206b 203d 206f 6472 5b6b 6b5d 0a20 2020   k = odr[kk].   
-000638e0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-000638f0: 2073 5f70 6f73 5b6b 5d20 3e20 655f 6d61   s_pos[k] > e_ma
-00063900: 785b 6f64 725b 6b6b 2d31 5d5d 3a0a 2020  x[odr[kk-1]]:.  
-00063910: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00063920: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00063930: 2020 2020 2020 2020 2066 6f72 206d 6d20           for mm 
-00063940: 696e 2072 6576 6572 7365 6428 7261 6e67  in reversed(rang
-00063950: 6528 6b6b 2929 3a0a 2020 2020 2020 2020  e(kk)):.        
-00063960: 2020 2020 2020 2020 6d20 3d20 6f64 725b          m = odr[
-00063970: 6d6d 5d0a 2020 2020 2020 2020 2020 2020  mm].            
-00063980: 2020 2020 6966 2073 5f70 6f73 5b6b 5d20      if s_pos[k] 
-00063990: 3e20 655f 6d61 785b 6d5d 3a20 6272 6561  > e_max[m]: brea
-000639a0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-000639b0: 2020 6966 2028 6764 5f6c 7374 5b6b 5d2e    if (gd_lst[k].
-000639c0: 6368 7220 3d3d 2067 645f 6c73 745b 6d5d  chr == gd_lst[m]
-000639d0: 2e63 6872 293a 0a20 2020 2020 2020 2020  .chr):.         
-000639e0: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
-000639f0: 5f70 6f73 5b6b 5d20 3c20 655f 706f 735b  _pos[k] < e_pos[
-00063a00: 6d5d 293a 0a20 2020 2020 2020 2020 2020  m]):.           
-00063a10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00063a20: 6764 5f6c 7374 5b6d 5d2e 6578 6f6e 732e  gd_lst[m].exons.
-00063a30: 6861 735f 6578 745f 696e 7465 7273 6563  has_ext_intersec
-00063a40: 7469 6f6e 5f77 6974 6828 6764 5f6c 7374  tion_with(gd_lst
-00063a50: 5b6b 5d2e 6578 6f6e 7329 3a0a 2020 2020  [k].exons):.    
-00063a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063a70: 2020 2020 2020 2020 675f 6c73 745b 6b5d          g_lst[k]
-00063a80: 2e61 7070 656e 6428 6d29 0a20 2020 2020  .append(m).     
-00063a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063aa0: 2020 2020 2020 2067 5f6c 7374 5b6d 5d2e         g_lst[m].
-00063ab0: 6170 7065 6e64 286b 290a 2020 2020 2020  append(k).      
-00063ac0: 2020 2020 2020 2020 2020 0a20 2020 2065            .    e
-00063ad0: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
-00063ae0: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00063af0: 7274 5f74 696d 6531 0a20 2020 2069 6620  rt_time1.    if 
-00063b00: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-00063b10: 5c72 436f 6d62 696e 696e 6720 6765 6e65  \rCombining gene
-00063b20: 7320 2569 202e 2e2e 2064 6f6e 652e 2025  s %i ... done. %
-00063b30: 6928 7329 2027 2025 2028 6e5f 6764 2c65  i(s) ' % (n_gd,e
-00063b40: 6c61 7073 6564 5f74 696d 6531 2920 290a  lapsed_time1) ).
-00063b50: 2020 2020 2327 2727 0a0a 2020 2020 2727      #'''..    ''
-00063b60: 270a 2020 2020 6b6b 203d 2030 0a20 2020  '.    kk = 0.   
-00063b70: 206d 6d20 3d20 6b6b 2b31 0a20 2020 206b   mm = kk+1.    k
-00063b80: 203d 206f 6472 5b6b 6b5d 0a20 2020 206d   = odr[kk].    m
-00063b90: 203d 206f 6472 5b6d 6d5d 0a20 2020 200a   = odr[mm].    .
-00063ba0: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
-00063bb0: 2020 2020 2020 2020 6966 2065 5f70 6f73          if e_pos
-00063bc0: 5b6b 5d20 3c20 735f 706f 735b 6d5d 3a0a  [k] < s_pos[m]:.
-00063bd0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00063be0: 6d20 3c20 6b6b 3a20 6d6d 203d 206b 6b20  m < kk: mm = kk 
-00063bf0: 2b20 310a 2020 2020 2020 2020 2020 2020  + 1.            
-00063c00: 656c 7365 3a20 6b6b 203d 206d 6d20 2b20  else: kk = mm + 
-00063c10: 310a 2020 2020 2020 2020 2020 2020 6b20  1.            k 
-00063c20: 3d20 6f64 725b 6b6b 5d0a 2020 2020 2020  = odr[kk].      
-00063c30: 2020 2020 2020 6d20 3d20 6f64 725b 6d6d        m = odr[mm
-00063c40: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
-00063c50: 2020 2020 2020 2065 6c69 6620 655f 706f         elif e_po
-00063c60: 735b 6d5d 203c 2073 5f70 6f73 5b6b 5d3a  s[m] < s_pos[k]:
-00063c70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00063c80: 6d6d 203c 206b 6b3a 206d 6d20 3d20 6b6b  mm < kk: mm = kk
-00063c90: 202b 2031 0a20 2020 2020 2020 2020 2020   + 1.           
-00063ca0: 2065 6c73 653a 206b 6b20 3d20 6d6d 202b   else: kk = mm +
-00063cb0: 2031 0a20 2020 2020 2020 2020 2020 206b   1.            k
-00063cc0: 203d 206f 6472 5b6b 6b5d 0a20 2020 2020   = odr[kk].     
-00063cd0: 2020 2020 2020 206d 203d 206f 6472 5b6d         m = odr[m
-00063ce0: 6d5d 0a20 2020 2020 2020 2065 6c73 653a  m].        else:
-00063cf0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00063d00: 2867 645f 6c73 745b 6b5d 2e63 6872 203d  (gd_lst[k].chr =
-00063d10: 3d20 6764 5f6c 7374 5b6d 5d2e 6368 7229  = gd_lst[m].chr)
-00063d20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00063d30: 2020 6966 2067 645f 6c73 745b 6d5d 2e65    if gd_lst[m].e
-00063d40: 786f 6e73 2e68 6173 5f65 7874 5f69 6e74  xons.has_ext_int
-00063d50: 6572 7365 6374 696f 6e5f 7769 7468 2867  ersection_with(g
-00063d60: 645f 6c73 745b 6b5d 2e65 786f 6e73 293a  d_lst[k].exons):
-00063d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00063d80: 2020 2020 2067 5f6c 7374 5b6b 5d2e 6170       g_lst[k].ap
-00063d90: 7065 6e64 286d 290a 2020 2020 2020 2020  pend(m).        
-00063da0: 2020 2020 2020 2020 2020 2020 675f 6c73              g_ls
-00063db0: 745b 6d5d 2e61 7070 656e 6428 6b29 0a0a  t[m].append(k)..
-00063dc0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00063dd0: 6d20 3c20 6b6b 3a20 6d6d 203d 206b 6b20  m < kk: mm = kk 
-00063de0: 2b20 310a 2020 2020 2020 2020 2020 2020  + 1.            
-00063df0: 656c 7365 3a20 6b6b 203d 206d 6d20 2b20  else: kk = mm + 
-00063e00: 310a 2020 2020 2020 2020 2020 2020 6b20  1.            k 
-00063e10: 3d20 6f64 725b 6b6b 5d0a 2020 2020 2020  = odr[kk].      
-00063e20: 2020 2020 2020 6d20 3d20 6f64 725b 6d6d        m = odr[mm
-00063e30: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
-00063e40: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-00063e50: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00063e60: 6620 6b6b 2531 3030 203d 3d20 303a 0a20  f kk%100 == 0:. 
-00063e70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00063e80: 7269 6e74 2827 5c72 436f 6d62 696e 696e  rint('\rCombinin
-00063e90: 6720 6765 6e65 7320 2569 2f25 6927 2025  g genes %i/%i' %
-00063ea0: 2028 6b6b 2c6e 5f67 6429 2c20 656e 643d   (kk,n_gd), end=
-00063eb0: 2720 2020 2027 2029 0a20 2020 2020 2020  '    ' ).       
-00063ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063ed0: 2020 2020 2020 2020 200a 2020 2020 656c           .    el
-00063ee0: 6170 7365 645f 7469 6d65 3120 3d20 7469  apsed_time1 = ti
-00063ef0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-00063f00: 745f 7469 6d65 310a 2020 2020 6966 2076  t_time1.    if v
-00063f10: 6572 626f 7365 3a20 7072 696e 7428 275c  erbose: print('\
-00063f20: 7243 6f6d 6269 6e69 6e67 2067 656e 6573  rCombining genes
-00063f30: 2025 6920 2e2e 2e20 646f 6e65 2e20 2569   %i ... done. %i
-00063f40: 2873 2920 2720 2520 286e 5f67 642c 656c  (s) ' % (n_gd,el
-00063f50: 6170 7365 645f 7469 6d65 3129 2029 0a20  apsed_time1) ). 
-00063f60: 2020 2023 2727 270a 0a20 2020 2020 2020     #'''..       
-00063f70: 200a 2020 2020 0a20 2020 2062 7067 203d   .    .    bpg =
-00063f80: 206e 702e 6f6e 6573 286c 656e 2867 645f   np.ones(len(gd_
-00063f90: 6c73 7429 290a 0a20 2020 2063 6f6d 625f  lst))..    comb_
-00063fa0: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
-00063fb0: 206b 2069 6e20 675f 6c73 742e 6b65 7973   k in g_lst.keys
-00063fc0: 2829 3a0a 2020 2020 2020 2020 6966 2028  ():.        if (
-00063fd0: 6c65 6e28 675f 6c73 745b 6b5d 2920 3e20  len(g_lst[k]) > 
-00063fe0: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
-00063ff0: 6966 2028 6270 675b 6b5d 203e 2030 293a  if (bpg[k] > 0):
-00064000: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00064010: 2020 6769 7320 3d20 7365 7428 675f 6c73    gis = set(g_ls
-00064020: 745b 6b5d 290a 2020 2020 2020 2020 2020  t[k]).          
-00064030: 2020 2020 2020 6e5f 7072 6576 203d 206c        n_prev = l
-00064040: 656e 2867 6973 290a 2020 2020 2020 2020  en(gis).        
-00064050: 2020 2020 2020 2020 636e 7420 3d20 300a          cnt = 0.
-00064060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064070: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-00064080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064090: 666f 7220 6920 696e 2067 6973 3a0a 2020  for i in gis:.  
-000640a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000640b0: 2020 2020 2020 6769 7320 3d20 6769 732e        gis = gis.
-000640c0: 756e 696f 6e28 2073 6574 2867 5f6c 7374  union( set(g_lst
-000640d0: 5b69 5d29 2029 0a20 2020 2020 2020 2020  [i]) ).         
-000640e0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-000640f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064100: 2020 2020 6966 2028 6c65 6e28 6769 7329      if (len(gis)
-00064110: 203d 3d20 6e5f 7072 6576 293a 2062 7265   == n_prev): bre
-00064120: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00064130: 2020 2020 2020 2065 6c73 653a 206e 5f70         else: n_p
-00064140: 7265 7620 3d20 6c65 6e28 6769 7329 0a20  rev = len(gis). 
-00064150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064160: 2020 2063 6e74 202b 3d20 310a 2020 2020     cnt += 1.    
-00064170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064180: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00064190: 2020 2020 2067 6973 203d 206c 6973 7428       gis = list(
-000641a0: 7365 7428 6c69 7374 2867 6973 2920 2b20  set(list(gis) + 
-000641b0: 5b6b 5d29 290a 2020 2020 2020 2020 2020  [k])).          
-000641c0: 2020 2020 2020 666f 7220 6d20 696e 2067        for m in g
-000641d0: 6973 3a20 6270 675b 6d5d 203d 2030 0a20  is: bpg[m] = 0. 
-000641e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000641f0: 6f6d 625f 6c73 742e 6170 7065 6e64 2828  omb_lst.append((
-00064200: 6769 7329 290a 0a20 2020 2069 6620 6c65  gis))..    if le
-00064210: 6e28 636f 6d62 5f6c 7374 2920 3e20 303a  n(comb_lst) > 0:
-00064220: 0a20 2020 2020 2020 2063 6e74 203d 2030  .        cnt = 0
-00064230: 0a20 2020 2020 2020 2074 6f5f 6465 6c5f  .        to_del_
-00064240: 6720 3d20 5b5d 0a20 2020 2020 2020 2066  g = [].        f
-00064250: 6f72 2063 6c20 696e 2063 6f6d 625f 6c73  or cl in comb_ls
-00064260: 743a 0a20 2020 2020 2020 2020 2020 200a  t:.            .
-00064270: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00064280: 656e 2863 6c29 203e 2031 3a0a 2020 2020  en(cl) > 1:.    
-00064290: 2020 2020 2020 2020 2020 2020 636e 7420              cnt 
-000642a0: 2b3d 206c 656e 2863 6c29 2d31 0a20 2020  += len(cl)-1.   
-000642b0: 2020 2020 2020 2020 2020 2020 206b 203d               k =
-000642c0: 2063 6c5b 305d 0a20 2020 2020 2020 2020   cl[0].         
-000642d0: 2020 2020 2020 2066 6f72 2067 6920 696e         for gi in
-000642e0: 2063 6c5b 313a 5d3a 0a20 2020 2020 2020   cl[1:]:.       
-000642f0: 2020 2020 2020 2020 2020 2020 2067 645f               gd_
-00064300: 6c73 745b 6b5d 2e6d 6572 6765 2867 645f  lst[k].merge(gd_
-00064310: 6c73 745b 6769 5d29 0a20 2020 2020 2020  lst[gi]).       
-00064320: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
-00064330: 6465 6c5f 672e 6170 7065 6e64 2867 6929  del_g.append(gi)
-00064340: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00064350: 2874 6f5f 6465 6c5f 6729 203e 2030 3a0a  (to_del_g) > 0:.
-00064360: 2020 2020 2020 2020 2020 2020 746f 5f64              to_d
-00064370: 656c 5f67 203d 206c 6973 7428 7365 7428  el_g = list(set(
-00064380: 746f 5f64 656c 5f67 2929 0a20 2020 2020  to_del_g)).     
-00064390: 2020 2020 2020 2074 6f5f 6465 6c5f 672e         to_del_g.
-000643a0: 736f 7274 2872 6576 6572 7365 3d54 7275  sort(reverse=Tru
-000643b0: 6529 0a20 2020 2020 2020 2020 2020 2066  e).            f
-000643c0: 6f72 2067 6920 696e 2074 6f5f 6465 6c5f  or gi in to_del_
-000643d0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-000643e0: 2020 2064 656c 2067 645f 6c73 745b 6769     del gd_lst[gi
-000643f0: 5d0a 2020 2020 2020 2020 2320 7072 696e  ].        # prin
-00064400: 7428 2720 2569 202d 3e20 2569 2720 2520  t(' %i -> %i' % 
-00064410: 286e 672c 206c 656e 2867 645f 6c73 7429  (ng, len(gd_lst)
-00064420: 2920 290a 2020 2020 2020 2020 6465 6c20  ) ).        del 
-00064430: 675f 6c73 740a 2020 2020 2020 2020 6465  g_lst.        de
-00064440: 6c20 636f 6d62 5f6c 7374 0a20 2020 2065  l comb_lst.    e
-00064450: 6c73 653a 0a20 2020 2020 2020 2070 6173  lse:.        pas
-00064460: 730a 2020 2020 2020 2020 2320 7072 696e  s.        # prin
-00064470: 7428 2720 2729 0a0a 2020 2020 7265 7475  t(' ')..    retu
-00064480: 726e 2067 645f 6c73 740a 2327 2727 0a0a  rn gd_lst.#'''..
-00064490: 6465 6620 6765 745f 6765 6e65 5f64 6573  def get_gene_des
-000644a0: 6372 6970 746f 7228 6774 665f 6c69 6e65  criptor(gtf_line
-000644b0: 732c 2067 656e 6f6d 6520 3d20 4e6f 6e65  s, genome = None
-000644c0: 2c20 6669 6c6c 203d 2046 616c 7365 2c20  , fill = False, 
-000644d0: 6367 203d 2054 7275 652c 205c 0a20 2020  cg = True, \.   
-000644e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000644f0: 2020 2020 2076 6572 626f 7365 203d 2046       verbose = F
-00064500: 616c 7365 2c20 6e5f 636f 7265 7320 3d20  alse, n_cores = 
-00064510: 3129 3a0a 0a20 2020 2062 6173 655f 6364  1):..    base_cd
-00064520: 7320 3d20 6765 745f 6261 7365 5f63 6473  s = get_base_cds
-00064530: 5f66 726f 6d5f 6774 665f 6c69 6e65 7328  _from_gtf_lines(
-00064540: 6774 665f 6c69 6e65 7329 0a20 2020 2069  gtf_lines).    i
-00064550: 6620 6261 7365 5f63 6473 203c 2030 3a0a  f base_cds < 0:.
-00064560: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-00064570: 2020 4e6f 2063 6f64 696e 6720 696e 666f    No coding info
-00064580: 726d 6174 696f 6e20 6176 6169 6c61 626c  rmation availabl
-00064590: 6520 696e 2074 6865 2047 5446 2f47 4646  e in the GTF/GFF
-000645a0: 2e27 290a 2020 2020 0a20 2020 2067 7466  .').    .    gtf
-000645b0: 5f6c 696e 6573 5f6c 7374 203d 2070 6172  _lines_lst = par
-000645c0: 7365 5f67 7466 5f6c 696e 6573 5f61 6e64  se_gtf_lines_and
-000645d0: 5f73 706c 6974 5f69 6e74 6f5f 6765 6e65  _split_into_gene
-000645e0: 7328 2067 7466 5f6c 696e 6573 2029 0a20  s( gtf_lines ). 
-000645f0: 2020 2067 645f 6c73 7420 3d20 5b5d 0a20     gd_lst = []. 
-00064600: 2020 2074 636e 7420 3d20 300a 2020 2020     tcnt = 0.    
-00064610: 7463 6e74 3220 3d20 300a 2020 2020 6763  tcnt2 = 0.    gc
-00064620: 6e74 203d 2030 0a20 2020 2063 6872 7320  nt = 0.    chrs 
-00064630: 3d20 5b5d 2020 2020 0a20 2020 200a 2020  = []    .    .  
-00064640: 2020 7374 6172 745f 7469 6d65 3120 3d20    start_time1 = 
-00064650: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
-00064660: 6966 2054 7275 653a 2023 203e 2031 3a0a  if True: # > 1:.
-00064670: 2020 2020 2020 2020 666f 7220 6b2c 6720          for k,g 
-00064680: 696e 2065 6e75 6d65 7261 7465 2867 7466  in enumerate(gtf
-00064690: 5f6c 696e 6573 5f6c 7374 293a 0a20 2020  _lines_lst):.   
-000646a0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-000646b0: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
-000646c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000646d0: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
-000646e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000646f0: 2020 2020 2070 7269 6e74 2827 5c72 5061       print('\rPa
-00064700: 7273 696e 6720 4754 4620 2569 2f25 6927  rsing GTF %i/%i'
-00064710: 2025 2028 6b2c 6c65 6e28 6774 665f 6c69   % (k,len(gtf_li
-00064720: 6e65 735f 6c73 7429 292c 2065 6e64 3d27  nes_lst)), end='
-00064730: 2020 2020 2720 290a 2020 2020 2020 2020      ' ).        
-00064740: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00064750: 2020 2020 2020 2020 2067 6420 3d20 6765           gd = ge
-00064760: 6e65 5f64 6573 6372 6970 746f 7228 672c  ne_descriptor(g,
-00064770: 2067 656e 6f6d 652c 2062 6173 655f 6364   genome, base_cd
-00064780: 732c 2066 696c 6c2c 2043 6f76 5f74 6820  s, fill, Cov_th 
-00064790: 3d20 4d49 4e5f 434f 565f 544f 5f53 454c  = MIN_COV_TO_SEL
-000647a0: 2c20 4162 6e5f 7468 203d 204d 494e 5f41  , Abn_th = MIN_A
-000647b0: 424e 5f54 4f5f 5345 4c29 0a20 2020 2020  BN_TO_SEL).     
-000647c0: 2020 2020 2020 2067 645f 6c73 742e 6170         gd_lst.ap
-000647d0: 7065 6e64 2867 6429 0a20 2020 2020 2020  pend(gd).       
-000647e0: 2020 2020 2063 6872 732e 6170 7065 6e64       chrs.append
-000647f0: 2820 6764 2e63 6872 2029 0a20 2020 2020  ( gd.chr ).     
-00064800: 2020 2020 2020 2074 636e 7420 2b3d 206c         tcnt += l
-00064810: 656e 2867 642e 7464 5f6c 7374 290a 2020  en(gd.td_lst).  
-00064820: 2020 2020 2020 2020 2020 666f 7220 7464            for td
-00064830: 2069 6e20 6764 2e74 645f 6c73 743a 0a20   in gd.td_lst:. 
-00064840: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00064850: 6620 6c65 6e28 7464 2e74 655f 746f 5f67  f len(td.te_to_g
-00064860: 655f 6d61 7029 203e 2030 3a20 7463 6e74  e_map) > 0: tcnt
-00064870: 3220 2b3d 2031 0a20 2020 200a 2020 2020  2 += 1.    .    
-00064880: 2020 2020 6465 6c20 6774 665f 6c69 6e65      del gtf_line
-00064890: 735f 6c73 740a 2020 2020 0a20 2020 2065  s_lst.    .    e
-000648a0: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
-000648b0: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-000648c0: 7274 5f74 696d 6531 0a20 2020 2069 6620  rt_time1.    if 
-000648d0: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-000648e0: 5c72 5061 7273 696e 6720 4754 4620 2e2e  \rParsing GTF ..
-000648f0: 2e20 646f 6e65 2e20 2569 2f25 6920 7472  . done. %i/%i tr
-00064900: 7320 666f 756e 6420 6672 6f6d 2025 6920  s found from %i 
-00064910: 6765 6e65 7320 2825 6929 2027 2025 2028  genes (%i) ' % (
-00064920: 7463 6e74 2c20 7463 6e74 322c 206c 656e  tcnt, tcnt2, len
-00064930: 2867 645f 6c73 7429 2c20 656c 6170 7365  (gd_lst), elapse
-00064940: 645f 7469 6d65 3129 2c20 656e 6420 3d20  d_time1), end = 
-00064950: 2720 2729 0a20 2020 2023 2069 6620 7665  ' ').    # if ve
-00064960: 7262 6f73 653a 2070 7269 6e74 2827 5c72  rbose: print('\r
-00064970: 5061 7273 696e 6720 4754 4620 2e2e 2e20  Parsing GTF ... 
-00064980: 646f 6e65 2e20 2569 2f25 6920 7472 7320  done. %i/%i trs 
-00064990: 666f 756e 6420 6672 6f6d 2025 6920 6765  found from %i ge
-000649a0: 6e65 7320 2825 6929 2027 2025 2028 7463  nes (%i) ' % (tc
-000649b0: 6e74 2c20 7463 6e74 322c 206c 656e 2867  nt, tcnt2, len(g
-000649c0: 645f 6c73 7429 2c20 656c 6170 7365 645f  d_lst), elapsed_
-000649d0: 7469 6d65 3129 290a 0a20 2020 2072 6574  time1))..    ret
-000649e0: 7572 6e20 6764 5f6c 7374 2c20 6368 7273  urn gd_lst, chrs
-000649f0: 0a0a 0a64 6566 206d 635f 636f 7265 5f67  ...def mc_core_g
-00064a00: 656e 5f64 6573 6372 6970 746f 7228 6778  en_descriptor(gx
-00064a10: 293a 0a20 2020 200a 2020 2020 7265 7475  ):.    .    retu
-00064a20: 726e 2067 656e 655f 6465 7363 7269 7074  rn gene_descript
-00064a30: 6f72 2867 785b 305d 2c20 6778 5b31 5d2c  or(gx[0], gx[1],
-00064a40: 2067 785b 325d 2c20 6778 5b33 5d2c 2043   gx[2], gx[3], C
-00064a50: 6f76 5f74 6820 3d20 4d49 4e5f 434f 565f  ov_th = MIN_COV_
-00064a60: 544f 5f53 454c 2c20 4162 6e5f 7468 203d  TO_SEL, Abn_th =
-00064a70: 204d 494e 5f41 424e 5f54 4f5f 5345 4c29   MIN_ABN_TO_SEL)
-00064a80: 0a20 2020 200a 6465 6620 6d63 5f63 6f72  .    .def mc_cor
-00064a90: 655f 6d61 7070 696e 6728 2061 2029 3a0a  e_mapping( a ):.
-00064aa0: 2020 2020 0a20 2020 2067 2c20 726d 2c20      .    g, rm, 
-00064ab0: 726e 642c 2072 7374 692c 206e 672c 206e  rnd, rsti, ng, n
-00064ac0: 722c 2074 6467 2c20 7464 7220 3d20 636f  r, tdg, tdr = co
-00064ad0: 6d62 696e 655f 6765 6e65 735f 616e 645f  mbine_genes_and_
-00064ae0: 7267 6e73 5f70 6572 5f63 6872 2820 615b  rgns_per_chr( a[
-00064af0: 305d 2c20 615b 315d 2c20 5c0a 2020 2020  0], a[1], \.    
-00064b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064b30: 2020 2061 5b32 5d2c 2061 5b33 5d2c 205c     a[2], a[3], \
-00064b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00064b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064b70: 2020 2020 2020 2020 7665 7262 6f73 6520          verbose 
-00064b80: 3d20 4661 6c73 6520 290a 2020 2020 2020  = False ).      
-00064b90: 2020 2020 2020 2020 2020 0a20 2020 2072            .    r
-00064ba0: 6574 7572 6e20 672c 2072 6d2c 2072 6e64  eturn g, rm, rnd
-00064bb0: 2c20 7273 7469 2c20 6e67 2c20 6e72 2c20  , rsti, ng, nr, 
-00064bc0: 5b61 5b34 5d5b 775d 2066 6f72 2077 2069  [a[4][w] for w i
-00064bd0: 6e20 7464 675d 2c20 5b61 5b35 5d5b 775d  n tdg], [a[5][w]
-00064be0: 2066 6f72 2077 2069 6e20 7464 725d 0a0a   for w in tdr]..
-00064bf0: 0a27 2727 0a20 2020 2020 2020 2067 645f  .'''.        gd_
-00064c00: 6c73 7473 2c20 6368 725f 6c73 7420 3d20  lsts, chr_lst = 
-00064c10: 6765 745f 6765 6e65 5f64 6573 6372 6970  get_gene_descrip
-00064c20: 746f 7228 6774 665f 6c69 6e65 732c 2067  tor(gtf_lines, g
-00064c30: 656e 6f6d 6520 3d20 4e6f 6e65 2c20 6669  enome = None, fi
-00064c40: 6c6c 203d 2054 7275 652c 205c 0a20 2020  ll = True, \.   
-00064c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064c70: 2020 2020 2020 2020 2020 2020 6367 203d              cg =
-00064c80: 2054 7275 652c 2076 6572 626f 7365 203d   True, verbose =
-00064c90: 2054 7275 6529 0a27 2727 0a0a 6465 6620   True).'''..def 
-00064ca0: 7061 636b 5f67 656e 655f 6465 7363 7269  pack_gene_descri
-00064cb0: 7074 6f72 2820 6764 5f6c 7374 2c20 6368  ptor( gd_lst, ch
-00064cc0: 7273 2029 3a0a 2020 2020 0a20 2020 2063  rs ):.    .    c
-00064cd0: 6872 5f6c 7374 203d 206c 6973 7428 7365  hr_lst = list(se
-00064ce0: 7428 6368 7273 2929 0a20 2020 2063 6872  t(chrs)).    chr
-00064cf0: 5f6c 7374 2e73 6f72 7428 290a 2020 2020  _lst.sort().    
-00064d00: 6368 7273 203d 206e 702e 6172 7261 7928  chrs = np.array(
-00064d10: 6368 7273 290a 0a20 2020 2067 645f 6c73  chrs)..    gd_ls
-00064d20: 745f 6f66 5f6c 7374 203d 205b 5d0a 2020  t_of_lst = [].  
-00064d30: 2020 666f 7220 6368 726d 2069 6e20 6368    for chrm in ch
-00064d40: 725f 6c73 743a 0a20 2020 2020 2020 2077  r_lst:.        w
-00064d50: 6820 3d20 7768 6963 6828 6368 7273 203d  h = which(chrs =
-00064d60: 3d20 6368 726d 290a 0a20 2020 2020 2020  = chrm)..       
-00064d70: 2073 5f70 6f73 203d 206e 702e 7a65 726f   s_pos = np.zero
-00064d80: 7328 6c65 6e28 7768 2929 0a20 2020 2020  s(len(wh)).     
-00064d90: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-00064da0: 6528 6c65 6e28 7768 2929 3a20 0a20 2020  e(len(wh)): .   
-00064db0: 2020 2020 2020 2020 2073 5f70 6f73 5b6b           s_pos[k
-00064dc0: 5d20 3d20 6764 5f6c 7374 5b77 685b 6b5d  ] = gd_lst[wh[k]
-00064dd0: 5d2e 6265 6769 6e0a 2020 2020 2020 2020  ].begin.        
-00064de0: 6f64 7220 3d20 735f 706f 732e 6172 6773  odr = s_pos.args
-00064df0: 6f72 7428 290a 0a20 2020 2020 2020 2067  ort()..        g
-00064e00: 645f 7365 6c5f 6f72 6465 7265 6420 3d20  d_sel_ordered = 
-00064e10: 5b67 645f 6c73 745b 7768 5b6f 6472 5b6b  [gd_lst[wh[odr[k
-00064e20: 5d5d 5d20 666f 7220 6b20 696e 2072 616e  ]]] for k in ran
-00064e30: 6765 286c 656e 2877 6829 295d 0a20 2020  ge(len(wh))].   
-00064e40: 2020 2020 2067 645f 6c73 745f 6f66 5f6c       gd_lst_of_l
-00064e50: 7374 2e61 7070 656e 6428 6764 5f73 656c  st.append(gd_sel
-00064e60: 5f6f 7264 6572 6564 290a 2020 2020 0a20  _ordered).    . 
-00064e70: 2020 2066 6f72 206b 2c20 6764 5f73 656c     for k, gd_sel
-00064e80: 5f6f 7264 6572 6564 2069 6e20 656e 756d  _ordered in enum
-00064e90: 6572 6174 6528 6764 5f6c 7374 5f6f 665f  erate(gd_lst_of_
-00064ea0: 6c73 7429 3a0a 2020 2020 2020 2020 6764  lst):.        gd
-00064eb0: 5f73 656c 5f6f 7264 6572 6564 203d 2063  _sel_ordered = c
-00064ec0: 6f6d 6269 6e65 5f67 656e 6573 5f70 6572  ombine_genes_per
-00064ed0: 5f63 6872 2820 6764 5f73 656c 5f6f 7264  _chr( gd_sel_ord
-00064ee0: 6572 6564 2c20 7665 7262 6f73 6520 3d20  ered, verbose = 
-00064ef0: 4661 6c73 6520 290a 2020 2020 2020 2020  False ).        
-00064f00: 6764 5f6c 7374 5f6f 665f 6c73 745b 6b5d  gd_lst_of_lst[k]
-00064f10: 203d 2067 645f 7365 6c5f 6f72 6465 7265   = gd_sel_ordere
-00064f20: 640a 0a20 2020 2072 6574 7572 6e20 6764  d..    return gd
-00064f30: 5f6c 7374 5f6f 665f 6c73 742c 2063 6872  _lst_of_lst, chr
-00064f40: 5f6c 7374 0a0a 0a64 6566 2070 6172 7365  _lst...def parse
-00064f50: 5f61 6e64 5f63 6f6d 6269 6e65 5f67 656e  _and_combine_gen
-00064f60: 6573 5f61 6e64 5f72 676e 7328 2067 645f  es_and_rgns( gd_
-00064f70: 6c73 745f 6f66 5f6c 7374 2c20 6368 725f  lst_of_lst, chr_
-00064f80: 6c73 742c 2072 676e 735f 6c73 745f 6d69  lst, rgns_lst_mi
-00064f90: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
-00064fa0: 676e 735f 6c73 745f 7374 692c 205c 0a20  gns_lst_sti, \. 
-00064fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064fd0: 2020 2020 6e5f 636f 7265 7320 3d20 312c      n_cores = 1,
-00064fe0: 2067 656e 6f6d 6520 3d20 4e6f 6e65 2c20   genome = None, 
-00064ff0: 7665 7262 6f73 6520 3d20 4661 6c73 6520  verbose = False 
-00065000: 293a 0a20 2020 200a 2020 2020 2323 204d  ):.    .    ## M
-00065010: 6170 7069 6e67 0a20 2020 2020 2020 200a  apping.        .
-00065020: 2020 2020 766f 6c5f 746f 7461 6c20 3d20      vol_total = 
-00065030: 300a 2020 2020 7273 5f63 6872 7320 3d20  0.    rs_chrs = 
-00065040: 5b5d 0a20 2020 2066 6f72 2072 7320 696e  [].    for rs in
-00065050: 2072 676e 735f 6c73 745f 6d69 3a20 0a20   rgns_lst_mi: . 
-00065060: 2020 2020 2020 2072 735f 6368 7273 2e61         rs_chrs.a
-00065070: 7070 656e 6428 7273 2e72 676e 735b 305d  ppend(rs.rgns[0]
-00065080: 2e63 6872 290a 2020 2020 2020 2020 766f  .chr).        vo
-00065090: 6c5f 746f 7461 6c20 2b3d 2072 732e 6765  l_total += rs.ge
-000650a0: 745f 766f 6c75 6d65 2829 0a0a 2020 2020  t_volume()..    
-000650b0: 6368 7273 203d 2063 6872 5f6c 7374 2023  chrs = chr_lst #
-000650c0: 206c 6973 7428 7365 7428 6368 725f 6c73   list(set(chr_ls
-000650d0: 742b 7273 5f63 6872 7329 290a 2020 2020  t+rs_chrs)).    
-000650e0: 2020 2020 0a20 2020 2072 735f 6368 7273      .    rs_chrs
-000650f0: 203d 206e 702e 6172 7261 7928 7273 5f63   = np.array(rs_c
-00065100: 6872 7329 0a20 2020 200a 2020 2020 6764  hrs).    .    gd
-00065110: 5f6c 7374 5f6f 7574 203d 205b 5d0a 2020  _lst_out = [].  
-00065120: 2020 7273 5f6d 5f6c 7374 5f6f 7574 203d    rs_m_lst_out =
-00065130: 205b 5d0a 2020 2020 7273 5f6e 645f 6c73   [].    rs_nd_ls
-00065140: 745f 6f75 7420 3d20 5b5d 0a20 2020 2072  t_out = [].    r
-00065150: 735f 7374 695f 6c73 745f 6f75 7420 3d20  s_sti_lst_out = 
-00065160: 5b5d 0a20 2020 2067 645f 6c73 745f 756e  [].    gd_lst_un
-00065170: 6d61 7070 6564 203d 205b 5d0a 0a20 2020  mapped = []..   
-00065180: 2073 7461 7274 5f74 696d 6531 203d 2074   start_time1 = t
-00065190: 696d 652e 7469 6d65 2829 0a20 2020 200a  ime.time().    .
-000651a0: 2020 2020 6e67 5f75 6e6d 6170 7065 6420      ng_unmapped 
-000651b0: 3d20 300a 2020 2020 6e72 5f75 6e6d 6170  = 0.    nr_unmap
-000651c0: 7065 6420 3d20 300a 0a20 2020 2074 6f5f  ped = 0..    to_
-000651d0: 6465 6c5f 6720 3d20 5b5d 0a20 2020 2074  del_g = [].    t
-000651e0: 6f5f 6465 6c5f 7220 3d20 5b5d 0a0a 2020  o_del_r = []..  
-000651f0: 2020 6966 206e 5f63 6f72 6573 203d 3d20    if n_cores == 
-00065200: 313a 0a20 2020 2020 2020 2067 636e 7420  1:.        gcnt 
-00065210: 3d20 300a 0a20 2020 2020 2020 2072 736d  = 0..        rsm
-00065220: 203d 207b 2063 3a20 5b5d 2066 6f72 2063   = { c: [] for c
-00065230: 2069 6e20 6368 7273 207d 0a20 2020 2020   in chrs }.     
-00065240: 2020 2072 736e 6420 3d20 7b20 633a 205b     rsnd = { c: [
-00065250: 5d20 666f 7220 6320 696e 2063 6872 7320  ] for c in chrs 
-00065260: 7d0a 2020 2020 2020 2020 7273 7374 6920  }.        rssti 
-00065270: 3d20 7b20 633a 205b 5d20 666f 7220 6320  = { c: [] for c 
-00065280: 696e 2063 6872 7320 7d0a 2020 2020 2020  in chrs }.      
-00065290: 2020 666f 7220 6b2c 2063 2069 6e20 656e    for k, c in en
-000652a0: 756d 6572 6174 6528 7273 5f63 6872 7329  umerate(rs_chrs)
-000652b0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000652c0: 2063 2069 6e20 6368 7273 3a0a 2020 2020   c in chrs:.    
-000652d0: 2020 2020 2020 2020 2020 2020 7273 6d5b              rsm[
-000652e0: 635d 2e61 7070 656e 6428 7267 6e73 5f6c  c].append(rgns_l
-000652f0: 7374 5f6d 695b 6b5d 290a 2020 2020 2020  st_mi[k]).      
-00065300: 2020 2020 2020 2020 2020 7273 6e64 5b63            rsnd[c
-00065310: 5d2e 6170 7065 6e64 2872 676e 735f 6c73  ].append(rgns_ls
-00065320: 745f 6e64 5b6b 5d29 0a20 2020 2020 2020  t_nd[k]).       
-00065330: 2020 2020 2020 2020 2072 7373 7469 5b63           rssti[c
-00065340: 5d2e 6170 7065 6e64 2872 676e 735f 6c73  ].append(rgns_ls
-00065350: 745f 7374 695b 6b5d 290a 2020 2020 2020  t_sti[k]).      
-00065360: 2020 0a20 2020 2020 2020 2064 656c 2072    .        del r
-00065370: 676e 735f 6c73 745f 6d69 0a20 2020 2020  gns_lst_mi.     
-00065380: 2020 2064 656c 2072 676e 735f 6c73 745f     del rgns_lst_
-00065390: 6e64 0a20 2020 2020 2020 2064 656c 2072  nd.        del r
-000653a0: 676e 735f 6c73 745f 7374 690a 0a20 2020  gns_lst_sti..   
-000653b0: 2020 2020 2066 6f72 206b 2c20 6320 696e       for k, c in
-000653c0: 2065 6e75 6d65 7261 7465 2863 6872 7329   enumerate(chrs)
-000653d0: 3a0a 0a20 2020 2020 2020 2020 2020 2067  :..            g
-000653e0: 636e 7420 2b3d 206c 656e 2867 645f 6c73  cnt += len(gd_ls
-000653f0: 745f 6f66 5f6c 7374 5b6b 5d29 0a20 2020  t_of_lst[k]).   
-00065400: 2020 2020 2020 2020 2069 6620 7665 7262           if verb
-00065410: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
-00065420: 2020 2020 2070 7269 6e74 2827 5c72 4d61       print('\rMa
-00065430: 7070 696e 6720 2569 2f25 6927 2025 2028  pping %i/%i' % (
-00065440: 6b2c 6c65 6e28 6368 7273 2929 2c20 656e  k,len(chrs)), en
-00065450: 643d 2720 2020 2027 2c20 666c 7573 6820  d='    ', flush 
-00065460: 3d20 5472 7565 2029 0a20 2020 2020 2020  = True ).       
-00065470: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00065480: 2020 2020 2020 672c 2072 6d2c 2072 6e64        g, rm, rnd
-00065490: 2c20 7273 7469 2c20 6e67 2c20 6e72 2c20  , rsti, ng, nr, 
-000654a0: 7464 672c 2074 6472 2c20 675f 756d 203d  tdg, tdr, g_um =
-000654b0: 206d 635f 636f 7265 5f63 6f6d 6269 6e65   mc_core_combine
-000654c0: 5f67 656e 6573 5f61 6e64 5f72 676e 735f  _genes_and_rgns_
-000654d0: 7065 725f 6368 7228 2028 6764 5f6c 7374  per_chr( (gd_lst
-000654e0: 5f6f 665f 6c73 745b 6b5d 2c20 7273 6d5b  _of_lst[k], rsm[
-000654f0: 635d 2c20 5c0a 2020 2020 2020 2020 2020  c], \.          
-00065500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065530: 2020 2020 2072 736e 645b 635d 2c20 7273       rsnd[c], rs
-00065540: 7374 695b 635d 2c20 4661 6c73 6529 2029  sti[c], False) )
-00065550: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-00065560: 6f5f 6465 6c5f 6720 3d20 746f 5f64 656c  o_del_g = to_del
-00065570: 5f67 202b 205b 6764 5f73 656c 5f69 6478  _g + [gd_sel_idx
-00065580: 5b6d 5d20 666f 7220 6d20 696e 2074 6467  [m] for m in tdg
-00065590: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
-000655a0: 746f 5f64 656c 5f72 203d 2074 6f5f 6465  to_del_r = to_de
-000655b0: 6c5f 7220 2b20 5b72 735f 7365 6c5f 6964  l_r + [rs_sel_id
-000655c0: 785b 6d5d 2066 6f72 206d 2069 6e20 7464  x[m] for m in td
-000655d0: 725d 0a0a 2020 2020 2020 2020 2020 2020  r]..            
-000655e0: 666f 7220 6764 2069 6e20 673a 200a 2020  for gd in g: .  
-000655f0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-00065600: 2e67 636e 7420 3d20 6763 6e74 0a20 2020  .gcnt = gcnt.   
-00065610: 2020 2020 2020 2020 2020 2020 2023 2067               # g
-00065620: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
-00065630: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00065640: 2020 2020 2020 6764 5f6c 7374 5f6f 7574        gd_lst_out
-00065650: 203d 2067 645f 6c73 745f 6f75 7420 2b20   = gd_lst_out + 
-00065660: 670a 2020 2020 2020 2020 2020 2020 7273  g.            rs
-00065670: 5f6d 5f6c 7374 5f6f 7574 203d 2072 735f  _m_lst_out = rs_
-00065680: 6d5f 6c73 745f 6f75 7420 2b20 726d 0a20  m_lst_out + rm. 
-00065690: 2020 2020 2020 2020 2020 2072 735f 6e64             rs_nd
-000656a0: 5f6c 7374 5f6f 7574 203d 2072 735f 6e64  _lst_out = rs_nd
-000656b0: 5f6c 7374 5f6f 7574 202b 2072 6e64 0a20  _lst_out + rnd. 
-000656c0: 2020 2020 2020 2020 2020 2072 735f 7374             rs_st
-000656d0: 695f 6c73 745f 6f75 7420 3d20 7273 5f73  i_lst_out = rs_s
-000656e0: 7469 5f6c 7374 5f6f 7574 202b 2072 7374  ti_lst_out + rst
-000656f0: 690a 2020 2020 2020 2020 2020 2020 6764  i.            gd
-00065700: 5f6c 7374 5f75 6e6d 6170 7065 6420 3d20  _lst_unmapped = 
-00065710: 6764 5f6c 7374 5f75 6e6d 6170 7065 6420  gd_lst_unmapped 
-00065720: 2b20 675f 756d 0a0a 2020 2020 2020 2020  + g_um..        
-00065730: 2020 2020 6e67 5f75 6e6d 6170 7065 6420      ng_unmapped 
-00065740: 2b3d 206e 670a 2020 2020 2020 2020 2020  += ng.          
-00065750: 2020 6e72 5f75 6e6d 6170 7065 6420 2b3d    nr_unmapped +=
-00065760: 206e 720a 2020 2020 0a20 2020 2020 2020   nr.    .       
-00065770: 2064 656c 2067 645f 6c73 745f 6f66 5f6c   del gd_lst_of_l
-00065780: 7374 0a20 2020 2020 2020 200a 2020 2020  st.        .    
-00065790: 656c 7365 3a0a 2020 2020 2020 2020 6966  else:.        if
-000657a0: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
-000657b0: 2020 2020 2020 7072 696e 7428 275c 724d        print('\rM
-000657c0: 6170 7069 6e67 202e 2e27 2c20 656e 643d  apping ..', end=
-000657d0: 2720 2020 2027 2c20 666c 7573 6820 3d20  '    ', flush = 
-000657e0: 5472 7565 2029 0a20 2020 2020 2020 2020  True ).         
-000657f0: 2020 200a 2020 2020 2020 2020 7273 6d20     .        rsm 
-00065800: 3d20 7b20 633a 205b 5d20 666f 7220 6320  = { c: [] for c 
-00065810: 696e 2063 6872 7320 7d0a 2020 2020 2020  in chrs }.      
-00065820: 2020 7273 6e64 203d 207b 2063 3a20 5b5d    rsnd = { c: []
-00065830: 2066 6f72 2063 2069 6e20 6368 7273 207d   for c in chrs }
-00065840: 0a20 2020 2020 2020 2072 7373 7469 203d  .        rssti =
-00065850: 207b 2063 3a20 5b5d 2066 6f72 2063 2069   { c: [] for c i
-00065860: 6e20 6368 7273 207d 0a20 2020 2020 2020  n chrs }.       
-00065870: 2066 6f72 206b 2c20 6320 696e 2065 6e75   for k, c in enu
-00065880: 6d65 7261 7465 2872 735f 6368 7273 293a  merate(rs_chrs):
-00065890: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000658a0: 6320 696e 2063 6872 733a 0a20 2020 2020  c in chrs:.     
-000658b0: 2020 2020 2020 2020 2020 2072 736d 5b63             rsm[c
-000658c0: 5d2e 6170 7065 6e64 2872 676e 735f 6c73  ].append(rgns_ls
-000658d0: 745f 6d69 5b6b 5d29 0a20 2020 2020 2020  t_mi[k]).       
-000658e0: 2020 2020 2020 2020 2072 736e 645b 635d           rsnd[c]
-000658f0: 2e61 7070 656e 6428 7267 6e73 5f6c 7374  .append(rgns_lst
-00065900: 5f6e 645b 6b5d 290a 2020 2020 2020 2020  _nd[k]).        
-00065910: 2020 2020 2020 2020 7273 7374 695b 635d          rssti[c]
-00065920: 2e61 7070 656e 6428 7267 6e73 5f6c 7374  .append(rgns_lst
-00065930: 5f73 7469 5b6b 5d29 0a20 2020 2020 2020  _sti[k]).       
-00065940: 200a 2020 2020 2020 2020 6465 6c20 7267   .        del rg
-00065950: 6e73 5f6c 7374 5f6d 690a 2020 2020 2020  ns_lst_mi.      
-00065960: 2020 6465 6c20 7267 6e73 5f6c 7374 5f6e    del rgns_lst_n
-00065970: 640a 2020 2020 2020 2020 6465 6c20 7267  d.        del rg
-00065980: 6e73 5f6c 7374 5f73 7469 0a0a 2020 2020  ns_lst_sti..    
-00065990: 2020 2020 6763 6e74 203d 2030 0a20 2020      gcnt = 0.   
-000659a0: 2020 2020 2072 735f 7475 706c 6520 3d20       rs_tuple = 
-000659b0: 5b5d 0a20 2020 2020 2020 2066 6f72 206b  [].        for k
-000659c0: 2c20 6320 696e 2065 6e75 6d65 7261 7465  , c in enumerate
-000659d0: 2863 6872 7329 3a0a 2020 2020 2020 2020  (chrs):.        
-000659e0: 2020 2020 7273 5f74 7570 6c65 2e61 7070      rs_tuple.app
-000659f0: 656e 6428 2028 6764 5f6c 7374 5f6f 665f  end( (gd_lst_of_
-00065a00: 6c73 745b 6b5d 2c20 7273 6d5b 635d 2c20  lst[k], rsm[c], 
-00065a10: 7273 6e64 5b63 5d2c 2072 7373 7469 5b63  rsnd[c], rssti[c
-00065a20: 5d2c 2076 6572 626f 7365 2920 290a 2020  ], verbose) ).  
-00065a30: 2020 2020 2020 2020 2020 6763 6e74 202b            gcnt +
-00065a40: 3d20 6c65 6e28 6764 5f6c 7374 5f6f 665f  = len(gd_lst_of_
-00065a50: 6c73 745b 6b5d 290a 2020 2020 2020 2020  lst[k]).        
-00065a60: 2020 2020 0a20 2020 2020 2020 2064 656c      .        del
-00065a70: 2067 645f 6c73 745f 6f66 5f6c 7374 0a0a   gd_lst_of_lst..
-00065a80: 2020 2020 2020 2020 6e75 6d5f 636f 7265          num_core
-00065a90: 203d 206d 696e 2820 6e5f 636f 7265 732c   = min( n_cores,
-00065aa0: 2028 6370 755f 636f 756e 7428 2920 2d20   (cpu_count() - 
-00065ab0: 3129 2029 0a20 2020 2020 2020 2070 6f6f  1) ).        poo
-00065ac0: 6c20 3d20 506f 6f6c 286e 756d 5f63 6f72  l = Pool(num_cor
-00065ad0: 6529 0a20 2020 2020 2020 206d 203d 2031  e).        m = 1
-00065ae0: 0a20 2020 2020 2020 2023 2066 6f72 2067  .        # for g
-00065af0: 2c20 726d 2c20 726e 642c 2072 7374 692c  , rm, rnd, rsti,
-00065b00: 206e 672c 206e 722c 2074 6467 2c20 7464   ng, nr, tdg, td
-00065b10: 7220 696e 2070 6f6f 6c2e 6d61 7028 6d63  r in pool.map(mc
-00065b20: 5f63 6f72 655f 636f 6d62 696e 655f 6765  _core_combine_ge
-00065b30: 6e65 735f 616e 645f 7267 6e73 5f70 6572  nes_and_rgns_per
-00065b40: 5f63 6872 2c20 7273 5f74 7570 6c65 293a  _chr, rs_tuple):
-00065b50: 0a20 2020 2020 2020 2066 6f72 2067 2c20  .        for g, 
-00065b60: 726d 2c20 726e 642c 2072 7374 692c 206e  rm, rnd, rsti, n
-00065b70: 672c 206e 722c 2074 6467 2c20 7464 722c  g, nr, tdg, tdr,
-00065b80: 2067 5f75 6d20 696e 2070 6f6f 6c2e 696d   g_um in pool.im
-00065b90: 6170 5f75 6e6f 7264 6572 6564 286d 635f  ap_unordered(mc_
-00065ba0: 636f 7265 5f63 6f6d 6269 6e65 5f67 656e  core_combine_gen
-00065bb0: 6573 5f61 6e64 5f72 676e 735f 7065 725f  es_and_rgns_per_
-00065bc0: 6368 722c 2072 735f 7475 706c 6529 3a0a  chr, rs_tuple):.
-00065bd0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00065be0: 2020 2020 2020 2020 2069 6620 7665 7262           if verb
-00065bf0: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
-00065c00: 2020 2020 2070 7269 6e74 2827 5c72 4d61       print('\rMa
-00065c10: 7070 696e 6720 2569 2f25 6927 2025 2028  pping %i/%i' % (
-00065c20: 6d2c 6c65 6e28 6368 7273 2929 2c20 656e  m,len(chrs)), en
-00065c30: 643d 2720 2020 2027 2c20 666c 7573 6820  d='    ', flush 
-00065c40: 3d20 5472 7565 2029 0a0a 2020 2020 2020  = True )..      
-00065c50: 2020 2020 2020 6d20 2b3d 2031 2020 2020        m += 1    
-00065c60: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00065c70: 2067 6420 696e 2067 3a20 0a20 2020 2020   gd in g: .     
-00065c80: 2020 2020 2020 2020 2020 2067 642e 6763             gd.gc
-00065c90: 6e74 203d 2067 636e 740a 2020 2020 2020  nt = gcnt.      
-00065ca0: 2020 2020 2020 2020 2020 2320 6763 6e74            # gcnt
-00065cb0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00065cc0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00065cd0: 2020 2067 645f 6c73 745f 6f75 7420 3d20     gd_lst_out = 
-00065ce0: 6764 5f6c 7374 5f6f 7574 202b 2067 0a20  gd_lst_out + g. 
-00065cf0: 2020 2020 2020 2020 2020 2072 735f 6d5f             rs_m_
-00065d00: 6c73 745f 6f75 7420 3d20 7273 5f6d 5f6c  lst_out = rs_m_l
-00065d10: 7374 5f6f 7574 202b 2072 6d0a 2020 2020  st_out + rm.    
-00065d20: 2020 2020 2020 2020 7273 5f6e 645f 6c73          rs_nd_ls
-00065d30: 745f 6f75 7420 3d20 7273 5f6e 645f 6c73  t_out = rs_nd_ls
-00065d40: 745f 6f75 7420 2b20 726e 640a 2020 2020  t_out + rnd.    
-00065d50: 2020 2020 2020 2020 7273 5f73 7469 5f6c          rs_sti_l
-00065d60: 7374 5f6f 7574 203d 2072 735f 7374 695f  st_out = rs_sti_
-00065d70: 6c73 745f 6f75 7420 2b20 7273 7469 0a20  lst_out + rsti. 
-00065d80: 2020 2020 2020 2020 2020 2067 645f 6c73             gd_ls
-00065d90: 745f 756e 6d61 7070 6564 203d 2067 645f  t_unmapped = gd_
-00065da0: 6c73 745f 756e 6d61 7070 6564 202b 2067  lst_unmapped + g
-00065db0: 5f75 6d0a 0a20 2020 2020 2020 2020 2020  _um..           
-00065dc0: 206e 675f 756e 6d61 7070 6564 202b 3d20   ng_unmapped += 
-00065dd0: 6e67 0a20 2020 2020 2020 2020 2020 206e  ng.            n
-00065de0: 725f 756e 6d61 7070 6564 202b 3d20 6e72  r_unmapped += nr
-00065df0: 0a20 2020 200a 2020 2020 2020 2020 706f  .    .        po
-00065e00: 6f6c 2e63 6c6f 7365 2829 0a20 2020 2020  ol.close().     
-00065e10: 2020 2070 6f6f 6c2e 6a6f 696e 2829 0a0a     pool.join()..
-00065e20: 2020 2020 2020 2020 0a20 2020 2065 6c61          .    ela
-00065e30: 7073 6564 5f74 696d 6531 203d 2074 696d  psed_time1 = tim
-00065e40: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
-00065e50: 5f74 696d 6531 0a20 2020 2069 6620 7665  _time1.    if ve
-00065e60: 7262 6f73 653a 2070 7269 6e74 2827 5c72  rbose: print('\r
-00065e70: 4d61 7070 696e 6720 2569 2063 6872 7320  Mapping %i chrs 
-00065e80: 2e2e 2e20 646f 6e65 2028 2569 2920 2720  ... done (%i) ' 
-00065e90: 2520 286c 656e 2863 6872 7329 2c65 6c61  % (len(chrs),ela
-00065ea0: 7073 6564 5f74 696d 6531 2920 290a 0a20  psed_time1) ).. 
-00065eb0: 2020 2076 6f6c 5f73 656c 203d 2030 0a20     vol_sel = 0. 
-00065ec0: 2020 2066 6f72 2072 7320 696e 2072 735f     for rs in rs_
-00065ed0: 6d5f 6c73 745f 6f75 743a 200a 2020 2020  m_lst_out: .    
-00065ee0: 2020 2020 766f 6c5f 7365 6c20 2b3d 2072      vol_sel += r
-00065ef0: 732e 6765 745f 766f 6c75 6d65 2829 0a20  s.get_volume(). 
-00065f00: 2020 2020 2020 200a 2020 2020 6966 206e         .    if n
-00065f10: 6720 3e20 303a 0a20 2020 2020 2020 2070  g > 0:.        p
-00065f20: 7269 6e74 2827 2020 2025 6920 6765 6e65  rint('   %i gene
-00065f30: 7320 696e 2074 6865 2047 5446 2f47 4646  s in the GTF/GFF
-00065f40: 2064 6f20 6e6f 7420 6861 7665 206d 6170   do not have map
-00065f50: 7065 6420 7265 6164 732e 2720 2520 286e  ped reads.' % (n
-00065f60: 675f 756e 6d61 7070 6564 2920 290a 2020  g_unmapped) ).  
-00065f70: 2020 6966 206e 7220 3e20 303a 0a20 2020    if nr > 0:.   
-00065f80: 2020 2020 2070 7269 6e74 2827 2020 2025       print('   %
-00065f90: 6920 6368 756e 6b73 2061 7265 206f 7574  i chunks are out
-00065fa0: 206f 6620 6765 6e65 206c 6f63 6920 696e   of gene loci in
-00065fb0: 2047 5446 2f47 4646 2e20 2825 6925 2520   GTF/GFF. (%i%% 
-00065fc0: 6f66 2074 6f74 616c 2076 6f6c 756d 6529  of total volume)
-00065fd0: 2027 2025 2028 6e72 5f75 6e6d 6170 7065   ' % (nr_unmappe
-00065fe0: 642c 2069 6e74 2831 3030 2a28 766f 6c5f  d, int(100*(vol_
-00065ff0: 746f 7461 6c2d 766f 6c5f 7365 6c29 2f76  total-vol_sel)/v
-00066000: 6f6c 5f74 6f74 616c 2929 2029 0a20 2020  ol_total)) ).   
-00066010: 2020 2020 200a 2020 2020 2727 270a 2020       .    '''.  
-00066020: 2020 6966 206c 656e 2874 6f5f 6465 6c5f    if len(to_del_
-00066030: 7229 203e 2030 3a0a 2020 2020 2020 2020  r) > 0:.        
-00066040: 746f 5f64 656c 5f72 2e73 6f72 7428 7265  to_del_r.sort(re
-00066050: 7665 7273 653d 5472 7565 290a 2020 2020  verse=True).    
-00066060: 2020 2020 666f 7220 7269 2069 6e20 746f      for ri in to
-00066070: 5f64 656c 5f72 3a0a 2020 2020 2020 2020  _del_r:.        
-00066080: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
-00066090: 5f6d 695b 7269 5d0a 2020 2020 2020 2020  _mi[ri].        
-000660a0: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
-000660b0: 5f6e 645b 7269 5d0a 2020 2020 2020 2020  _nd[ri].        
-000660c0: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
-000660d0: 5f73 7469 5b72 695d 0a20 2020 2020 2020  _sti[ri].       
-000660e0: 2020 2020 200a 2020 2020 6966 206c 656e       .    if len
-000660f0: 2874 6f5f 6465 6c5f 6729 203e 2030 3a0a  (to_del_g) > 0:.
-00066100: 2020 2020 2020 2020 746f 5f64 656c 5f67          to_del_g
-00066110: 2e73 6f72 7428 7265 7665 7273 653d 5472  .sort(reverse=Tr
-00066120: 7565 290a 2020 2020 2020 2020 666f 7220  ue).        for 
-00066130: 6769 2069 6e20 746f 5f64 656c 5f67 3a0a  gi in to_del_g:.
-00066140: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00066150: 6764 5f6c 7374 5b67 695d 0a20 2020 2027  gd_lst[gi].    '
-00066160: 2727 0a20 2020 2020 2020 2020 2020 200a  ''.            .
-00066170: 2020 2020 7265 7475 726e 2067 645f 6c73      return gd_ls
-00066180: 745f 6f75 742c 2072 735f 6d5f 6c73 745f  t_out, rs_m_lst_
-00066190: 6f75 742c 2072 735f 6e64 5f6c 7374 5f6f  out, rs_nd_lst_o
-000661a0: 7574 2c20 7273 5f73 7469 5f6c 7374 5f6f  ut, rs_sti_lst_o
-000661b0: 7574 2c20 6764 5f6c 7374 5f75 6e6d 6170  ut, gd_lst_unmap
-000661c0: 7065 640a 0a0a 6465 6620 6d63 5f63 6f72  ped...def mc_cor
-000661d0: 655f 636f 6d62 696e 655f 6765 6e65 735f  e_combine_genes_
-000661e0: 616e 645f 7267 6e73 5f70 6572 5f63 6872  and_rgns_per_chr
-000661f0: 2820 7273 5f74 7570 6c65 2029 3a0a 0a20  ( rs_tuple ):.. 
-00066200: 2020 2067 645f 6c73 742c 2072 676e 735f     gd_lst, rgns_
-00066210: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
-00066220: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
-00066230: 692c 2076 6572 626f 7365 203d 2072 735f  i, verbose = rs_
-00066240: 7475 706c 650a 0a20 2020 2023 2727 270a  tuple..    #'''.
-00066250: 2020 2020 6e5f 6764 203d 206c 656e 2867      n_gd = len(g
-00066260: 645f 6c73 7429 0a20 2020 2073 5f70 6f73  d_lst).    s_pos
-00066270: 203d 206e 702e 7a65 726f 7328 6e5f 6764   = np.zeros(n_gd
-00066280: 290a 2020 2020 655f 706f 7320 3d20 6e70  ).    e_pos = np
-00066290: 2e7a 6572 6f73 286e 5f67 6429 0a20 2020  .zeros(n_gd).   
-000662a0: 2073 5f6d 696e 203d 206e 702e 7a65 726f   s_min = np.zero
-000662b0: 7328 6e5f 6764 290a 2020 2020 655f 6d61  s(n_gd).    e_ma
-000662c0: 7820 3d20 6e70 2e7a 6572 6f73 286e 5f67  x = np.zeros(n_g
-000662d0: 6429 0a20 2020 2066 6f72 206b 2c20 6764  d).    for k, gd
-000662e0: 2069 6e20 656e 756d 6572 6174 6528 6764   in enumerate(gd
-000662f0: 5f6c 7374 293a 200a 2020 2020 2020 2020  _lst): .        
-00066300: 735f 706f 735b 6b5d 203d 2067 642e 6265  s_pos[k] = gd.be
-00066310: 6769 6e0a 2020 2020 2020 2020 655f 706f  gin.        e_po
-00066320: 735b 6b5d 203d 2067 642e 656e 640a 2020  s[k] = gd.end.  
-00066330: 2020 2020 2020 6966 206b 203d 3d20 303a        if k == 0:
-00066340: 0a20 2020 2020 2020 2020 2020 2065 6d20  .            em 
-00066350: 3d20 655f 706f 735b 305d 0a20 2020 2020  = e_pos[0].     
-00066360: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00066370: 2020 2020 2065 6d20 3d20 6d61 7828 656d       em = max(em
-00066380: 2c20 655f 706f 735b 6b5d 290a 2020 2020  , e_pos[k]).    
-00066390: 2020 2020 655f 6d61 785b 6b5d 203d 2065      e_max[k] = e
-000663a0: 6d0a 2020 2020 2020 2020 0a20 2020 2066  m.        .    f
-000663b0: 6f72 206b 2069 6e20 7265 7665 7273 6564  or k in reversed
-000663c0: 2872 616e 6765 286c 656e 2873 5f70 6f73  (range(len(s_pos
-000663d0: 2929 293a 0a20 2020 2020 2020 2069 6620  ))):.        if 
-000663e0: 6b20 3d3d 2028 6c65 6e28 735f 706f 7329  k == (len(s_pos)
-000663f0: 2d31 293a 0a20 2020 2020 2020 2020 2020  -1):.           
-00066400: 2073 6d20 3d20 735f 706f 735b 6b5d 0a20   sm = s_pos[k]. 
-00066410: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00066420: 2020 2020 2020 2020 2073 6d20 3d20 6d69           sm = mi
-00066430: 6e28 736d 2c73 5f70 6f73 5b6b 5d29 0a20  n(sm,s_pos[k]). 
-00066440: 2020 2020 2020 2073 5f6d 696e 5b6b 5d20         s_min[k] 
-00066450: 3d20 736d 0a20 2020 2020 2020 200a 2020  = sm.        .  
-00066460: 2020 2323 2323 0a20 2020 2072 5f6c 7374    ####.    r_lst
-00066470: 203d 207b 6b3a 205b 5d20 666f 7220 6b20   = {k: [] for k 
-00066480: 696e 2072 616e 6765 286c 656e 2872 676e  in range(len(rgn
-00066490: 735f 6c73 745f 6d69 2929 7d0a 2020 2020  s_lst_mi))}.    
-000664a0: 675f 6c73 7420 3d20 7b6b 3a20 5b5d 2066  g_lst = {k: [] f
-000664b0: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
-000664c0: 6e28 6764 5f6c 7374 2929 7d0a 0a20 2020  n(gd_lst))}..   
-000664d0: 2073 7461 7274 5f74 696d 6531 203d 2074   start_time1 = t
-000664e0: 696d 652e 7469 6d65 2829 0a20 2020 2023  ime.time().    #
-000664f0: 2727 270a 0a20 2020 2066 6f72 206b 2c20  '''..    for k, 
-00066500: 7273 2069 6e20 656e 756d 6572 6174 6528  rs in enumerate(
-00066510: 7267 6e73 5f6c 7374 5f6d 6929 3a0a 2020  rgns_lst_mi):.  
-00066520: 2020 2020 2020 7370 616e 203d 2072 732e        span = rs.
-00066530: 6765 745f 7370 616e 2829 0a20 2020 2020  get_span().     
-00066540: 2020 2077 6820 3d20 7768 6963 6828 2028     wh = which( (
-00066550: 2865 5f70 6f73 203c 2073 7061 6e2e 7374  (e_pos < span.st
-00066560: 6172 7429 207c 2028 735f 706f 7320 3e20  art) | (s_pos > 
-00066570: 7370 616e 2e65 6e64 2929 2c20 4661 6c73  span.end)), Fals
-00066580: 6520 290a 2020 2020 2020 2020 666f 7220  e ).        for 
-00066590: 6d20 696e 2077 683a 0a20 2020 2020 2020  m in wh:.       
-000665a0: 2020 2020 2069 6620 6764 5f6c 7374 5b6d       if gd_lst[m
-000665b0: 5d2e 6578 6f6e 732e 6861 735f 6578 745f  ].exons.has_ext_
-000665c0: 696e 7465 7273 6563 7469 6f6e 5f77 6974  intersection_wit
-000665d0: 6828 7273 293a 0a20 2020 2020 2020 2020  h(rs):.         
-000665e0: 2020 2020 2020 2072 5f6c 7374 5b6b 5d2e         r_lst[k].
-000665f0: 6170 7065 6e64 286d 290a 2020 2020 2020  append(m).      
-00066600: 2020 2020 2020 2020 2020 675f 6c73 745b            g_lst[
-00066610: 6d5d 2e61 7070 656e 6428 6b29 0a20 2020  m].append(k).   
-00066620: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
-00066630: 2066 6f72 206d 2069 6e20 7768 3a0a 2020   for m in wh:.  
-00066640: 2020 2020 2020 2020 2020 725f 6c73 745b            r_lst[
-00066650: 6b5d 2e61 7070 656e 6428 6d29 0a20 2020  k].append(m).   
-00066660: 2020 2020 2020 2020 2067 5f6c 7374 5b6d           g_lst[m
-00066670: 5d2e 6170 7065 6e64 286b 290a 2020 2020  ].append(k).    
-00066680: 2020 2020 2727 270a 2020 2020 656c 6170      '''.    elap
-00066690: 7365 645f 7469 6d65 3120 3d20 7469 6d65  sed_time1 = time
-000666a0: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-000666b0: 7469 6d65 310a 2020 2020 2320 6966 2076  time1.    # if v
-000666c0: 6572 626f 7365 3a20 7072 696e 7428 275c  erbose: print('\
-000666d0: 724d 6170 7069 6e67 2025 6920 2e2e 2e20  rMapping %i ... 
-000666e0: 646f 6e65 2028 2569 2920 2720 2520 286c  done (%i) ' % (l
-000666f0: 656e 2872 676e 735f 6c73 745f 6d69 292c  en(rgns_lst_mi),
-00066700: 656c 6170 7365 645f 7469 6d65 3129 2029  elapsed_time1) )
-00066710: 0a20 2020 2023 2727 270a 0a20 2020 2027  .    #'''..    '
-00066720: 2727 0a20 2020 206e 5f6e 6720 3d20 300a  ''.    n_ng = 0.
-00066730: 2020 2020 666f 7220 6b20 696e 2067 5f6c      for k in g_l
-00066740: 7374 2e6b 6579 7328 293a 0a20 2020 2020  st.keys():.     
-00066750: 2020 2069 6620 6c65 6e28 675f 6c73 745b     if len(g_lst[
-00066760: 6b5d 2920 3d3d 2030 3a0a 2020 2020 2020  k]) == 0:.      
-00066770: 2020 2020 2020 6e5f 6e67 202b 3d20 310a        n_ng += 1.
-00066780: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00066790: 7428 273d 3d3d 3d20 556e 6d61 7070 6564  t('==== Unmapped
-000667a0: 3a20 2573 2028 2569 292c 2025 7320 3d3d  : %s (%i), %s ==
-000667b0: 3d3d 2720 250a 2020 2020 2020 2020 2020  ==' %.          
-000667c0: 2020 2020 2020 2020 2867 645f 6c73 745b          (gd_lst[
-000667d0: 6b5d 2e74 645f 6c73 745b 305d 2e67 6964  k].td_lst[0].gid
-000667e0: 2c20 6764 5f6c 7374 5b6b 5d2e 6e74 722c  , gd_lst[k].ntr,
-000667f0: 2067 645f 6c73 745b 6b5d 2e74 645f 6c73   gd_lst[k].td_ls
-00066800: 745b 305d 2e74 6964 2920 290a 2020 2020  t[0].tid) ).    
-00066810: 2020 2020 2020 2020 6764 5f6c 7374 5b6b          gd_lst[k
-00066820: 5d2e 6578 6f6e 732e 7072 696e 745f 6d69  ].exons.print_mi
-00066830: 6e69 6d61 6c28 2920 2020 2020 2020 200a  nimal()        .
-00066840: 2020 2020 6966 206e 5f6e 6720 3e20 303a      if n_ng > 0:
-00066850: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00066860: 4e75 6d20 756e 6d61 7070 6564 2067 656e  Num unmapped gen
-00066870: 6573 2069 6e20 2573 203d 2025 6920 2720  es in %s = %i ' 
-00066880: 2520 2867 645f 6c73 745b 305d 2e63 6872  % (gd_lst[0].chr
-00066890: 2c20 6e5f 6e67 2920 290a 2020 2020 0a20  , n_ng) ).    . 
-000668a0: 2020 2023 2727 270a 2020 2020 2727 270a     #'''.    '''.
-000668b0: 2020 2020 6d20 3d20 300a 0a20 2020 2066      m = 0..    f
-000668c0: 6f72 206b 2c20 7273 2069 6e20 656e 756d  or k, rs in enum
-000668d0: 6572 6174 6528 7267 6e73 5f6c 7374 5f6d  erate(rgns_lst_m
-000668e0: 6929 3a0a 2020 2020 2020 2020 7370 616e  i):.        span
-000668f0: 203d 2072 732e 6765 745f 7370 616e 2829   = rs.get_span()
-00066900: 0a20 2020 2020 2020 2069 6620 286b 2b31  .        if (k+1
-00066910: 2920 3c20 6c65 6e28 7267 6e73 5f6c 7374  ) < len(rgns_lst
-00066920: 5f6d 6929 3a0a 2020 2020 2020 2020 2020  _mi):.          
-00066930: 2020 7370 616e 3220 3d20 7267 6e73 5f6c    span2 = rgns_l
-00066940: 7374 5f6d 695b 6b2b 315d 2e67 6574 5f73  st_mi[k+1].get_s
-00066950: 7061 6e28 290a 2020 2020 2020 2020 656c  pan().        el
-00066960: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00066970: 7370 616e 3220 3d20 7370 616e 0a0a 2020  span2 = span..  
-00066980: 2020 2020 2020 6d32 203d 206d 0a20 2020        m2 = m.   
-00066990: 2020 2020 200a 2020 2020 2020 2020 6d31       .        m1
-000669a0: 203d 206d 0a20 2020 2020 2020 2069 6620   = m.        if 
-000669b0: 6d31 203c 206c 656e 2867 645f 6c73 7429  m1 < len(gd_lst)
-000669c0: 3a0a 2020 2020 2020 2020 2020 2020 7768  :.            wh
-000669d0: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
-000669e0: 2020 2020 2020 2020 2020 6966 2065 5f6d            if e_m
-000669f0: 6178 5b6d 315d 203c 2073 7061 6e2e 7374  ax[m1] < span.st
-00066a00: 6172 743a 0a20 2020 2020 2020 2020 2020  art:.           
-00066a10: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00066a20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00066a30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00066a40: 2020 2020 2020 2020 2069 6620 6764 5f6c           if gd_l
-00066a50: 7374 5b6d 315d 2e65 786f 6e73 2e68 6173  st[m1].exons.has
-00066a60: 5f65 7874 5f69 6e74 6572 7365 6374 696f  _ext_intersectio
-00066a70: 6e5f 7769 7468 2872 7329 3a0a 2020 2020  n_with(rs):.    
-00066a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066a90: 2020 2020 725f 6c73 745b 6b5d 2e61 7070      r_lst[k].app
-00066aa0: 656e 6428 6d31 290a 2020 2020 2020 2020  end(m1).        
-00066ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066ac0: 675f 6c73 745b 6d31 5d2e 6170 7065 6e64  g_lst[m1].append
-00066ad0: 286b 290a 2020 2020 2020 2020 2020 2020  (k).            
-00066ae0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00066af0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00066b00: 655f 6d61 785b 6d31 5d20 3c20 7370 616e  e_max[m1] < span
-00066b10: 322e 7374 6172 743a 206d 3220 3d20 6d31  2.start: m2 = m1
-00066b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00066b30: 206d 3120 2d3d 2031 0a20 2020 2020 2020   m1 -= 1.       
-00066b40: 2020 2020 2020 2020 2069 6620 6d31 203c           if m1 <
-00066b50: 2030 3a20 6272 6561 6b0a 2020 2020 2020   0: break.      
-00066b60: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
-00066b70: 6620 286d 2b31 2920 3c20 6c65 6e28 6764  f (m+1) < len(gd
-00066b80: 5f6c 7374 293a 0a20 2020 2020 2020 2020  _lst):.         
-00066b90: 2020 206d 3120 3d20 6d2b 310a 2020 2020     m1 = m+1.    
-00066ba0: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
-00066bb0: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00066bc0: 2020 2020 6966 2073 5f6d 696e 5b6d 315d      if s_min[m1]
-00066bd0: 203e 2073 7061 6e2e 656e 643a 0a20 2020   > span.end:.   
-00066be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066bf0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00066c00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00066c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066c20: 2069 6620 6764 5f6c 7374 5b6d 315d 2e65   if gd_lst[m1].e
-00066c30: 786f 6e73 2e68 6173 5f65 7874 5f69 6e74  xons.has_ext_int
-00066c40: 6572 7365 6374 696f 6e5f 7769 7468 2872  ersection_with(r
-00066c50: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00066c60: 2020 2020 2020 2020 2020 2020 725f 6c73              r_ls
-00066c70: 745b 6b5d 2e61 7070 656e 6428 6d31 290a  t[k].append(m1).
-00066c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066c90: 2020 2020 2020 2020 675f 6c73 745b 6d31          g_lst[m1
-00066ca0: 5d2e 6170 7065 6e64 286b 290a 0a20 2020  ].append(k)..   
-00066cb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00066cc0: 655f 6d61 785b 6d31 5d20 3c20 7370 616e  e_max[m1] < span
-00066cd0: 322e 7374 6172 743a 206d 3220 3d20 6d31  2.start: m2 = m1
-00066ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00066cf0: 206d 3120 2b3d 2031 0a20 2020 2020 2020   m1 += 1.       
-00066d00: 2020 2020 2020 2020 2069 6620 6d31 203e           if m1 >
-00066d10: 3d20 6c65 6e28 6764 5f6c 7374 293a 2062  = len(gd_lst): b
-00066d20: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-00066d30: 2020 2020 200a 2020 2020 2020 2020 6d20       .        m 
-00066d40: 3d20 6d32 202b 2031 0a20 2020 2020 2020  = m2 + 1.       
-00066d50: 200a 2020 2020 2020 2020 6966 2076 6572   .        if ver
-00066d60: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
-00066d70: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
-00066d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00066d90: 2070 7269 6e74 2827 5c72 4d61 7070 696e   print('\rMappin
-00066da0: 6720 2569 2f25 6927 2025 2028 6b2c 6c65  g %i/%i' % (k,le
-00066db0: 6e28 7267 6e73 5f6c 7374 5f6d 6929 292c  n(rgns_lst_mi)),
-00066dc0: 2065 6e64 3d27 2020 2020 272c 2066 6c75   end='    ', flu
-00066dd0: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
-00066de0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00066df0: 2065 6c61 7073 6564 5f74 696d 6531 203d   elapsed_time1 =
-00066e00: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
-00066e10: 7461 7274 5f74 696d 6531 0a20 2020 2023  tart_time1.    #
-00066e20: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
-00066e30: 6e74 2827 5c72 4d61 7070 696e 6720 2569  nt('\rMapping %i
-00066e40: 202e 2e2e 2064 6f6e 6520 2825 6929 2027   ... done (%i) '
-00066e50: 2025 2028 6c65 6e28 7267 6e73 5f6c 7374   % (len(rgns_lst
-00066e60: 5f6d 6929 2c65 6c61 7073 6564 5f74 696d  _mi),elapsed_tim
-00066e70: 6531 2920 290a 2020 2020 2327 2727 0a20  e1) ).    #'''. 
-00066e80: 2020 200a 2020 2020 6270 7220 3d20 6e70     .    bpr = np
-00066e90: 2e6f 6e65 7328 6c65 6e28 7267 6e73 5f6c  .ones(len(rgns_l
-00066ea0: 7374 5f6d 6929 290a 2020 2020 6270 6720  st_mi)).    bpg 
-00066eb0: 3d20 6e70 2e6f 6e65 7328 6c65 6e28 6764  = np.ones(len(gd
-00066ec0: 5f6c 7374 2929 0a0a 2020 2020 7267 5f6c  _lst))..    rg_l
-00066ed0: 7374 203d 205b 5d0a 2020 2020 666f 7220  st = [].    for 
-00066ee0: 6b20 696e 2072 5f6c 7374 2e6b 6579 7328  k in r_lst.keys(
-00066ef0: 293a 0a20 2020 2020 2020 2067 6973 203d  ):.        gis =
-00066f00: 2072 5f6c 7374 5b6b 5d0a 2020 2020 2020   r_lst[k].      
-00066f10: 2020 6966 2062 7072 5b6b 5d20 3e20 303a    if bpr[k] > 0:
-00066f20: 0a20 2020 2020 2020 2020 2020 2072 6920  .            ri 
-00066f30: 3d20 5b6b 5d0a 2020 2020 2020 2020 2020  = [k].          
-00066f40: 2020 6769 7420 3d20 5b5d 0a20 2020 2020    git = [].     
-00066f50: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
-00066f60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00066f70: 2020 2067 6974 203d 2073 6574 2829 0a20     git = set(). 
-00066f80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00066f90: 6f72 2069 2069 6e20 7269 3a0a 2020 2020  or i in ri:.    
-00066fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066fb0: 6966 2062 7072 5b69 5d20 3e20 303a 0a20  if bpr[i] > 0:. 
-00066fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066fd0: 2020 2020 2020 2067 6974 203d 2067 6974         git = git
-00066fe0: 2e75 6e69 6f6e 2872 5f6c 7374 5b69 5d29  .union(r_lst[i])
-00066ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067000: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00067010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067020: 2020 2070 7269 6e74 2827 4552 524f 5220     print('ERROR 
-00067030: 2569 2c25 6927 2025 2028 6b2c 6929 290a  %i,%i' % (k,i)).
-00067040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067050: 6966 206c 656e 2867 6974 2920 3d3d 2030  if len(git) == 0
-00067060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00067070: 2020 2020 2020 2320 7267 5f6c 7374 2e61        # rg_lst.a
-00067080: 7070 656e 6428 2872 6974 2c5b 5d29 290a  ppend((rit,[])).
+00062c30: 2020 2020 2020 2020 2020 2020 2020 6162                ab
+00062c40: 6e70 2e61 7070 656e 6428 7464 2e61 626e  np.append(td.abn
+00062c50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00062c60: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00062c70: 2020 2072 6574 7572 6e20 7469 6473 2c20     return tids, 
+00062c80: 7473 6571 2c20 6162 6e74 2c20 7069 6473  tseq, abnt, pids
+00062c90: 2c20 7073 6571 2c20 6162 6e70 0a0a 0a0a  , pseq, abnp....
+00062ca0: 2020 2020 6465 6620 6765 745f 6661 7374      def get_fast
+00062cb0: 615f 6c69 6e65 735f 6672 6f6d 5f67 656e  a_lines_from_gen
+00062cc0: 6f6d 6528 7365 6c66 2c20 6765 6e6f 6d65  ome(self, genome
+00062cd0: 2c20 6162 6e5f 7468 203d 2030 2c20 636f  , abn_th = 0, co
+00062ce0: 765f 7468 203d 2030 2c20 6c65 6e5f 7468  v_th = 0, len_th
+00062cf0: 5f74 203d 2032 3030 2c20 6c65 6e5f 7468  _t = 200, len_th
+00062d00: 5f70 203d 2035 3029 3a0a 0a20 2020 2020  _p = 50):..     
+00062d10: 2020 2074 6964 732c 2074 7365 712c 2061     tids, tseq, a
+00062d20: 626e 742c 2070 6964 732c 2070 7365 712c  bnt, pids, pseq,
+00062d30: 2061 626e 7020 3d20 7365 6c66 2e67 6574   abnp = self.get
+00062d40: 5f61 6c6c 5f73 6571 5f66 726f 6d5f 6765  _all_seq_from_ge
+00062d50: 6e6f 6d65 2867 656e 6f6d 652c 2061 626e  nome(genome, abn
+00062d60: 5f74 682c 2063 6f76 5f74 682c 206c 656e  _th, cov_th, len
+00062d70: 5f74 685f 742c 206c 656e 5f74 685f 7029  _th_t, len_th_p)
+00062d80: 0a0a 2020 2020 2020 2020 6661 7374 615f  ..        fasta_
+00062d90: 6c69 6e65 735f 7420 3d20 5b5d 0a20 2020  lines_t = [].   
+00062da0: 2020 2020 2066 6f72 206b 2c20 7469 6420       for k, tid 
+00062db0: 696e 2065 6e75 6d65 7261 7465 2874 6964  in enumerate(tid
+00062dc0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00062dd0: 6661 7374 615f 6c69 6e65 735f 742e 6170  fasta_lines_t.ap
+00062de0: 7065 6e64 2820 273e 2573 5c6e 2720 2520  pend( '>%s\n' % 
+00062df0: 7469 6420 290a 2020 2020 2020 2020 2020  tid ).          
+00062e00: 2020 6661 7374 615f 6c69 6e65 735f 742e    fasta_lines_t.
+00062e10: 6170 7065 6e64 2820 2725 735c 6e27 2025  append( '%s\n' %
+00062e20: 2074 7365 715b 6b5d 2029 0a0a 2020 2020   tseq[k] )..    
+00062e30: 2020 2020 6661 7374 615f 6c69 6e65 735f      fasta_lines_
+00062e40: 7020 3d20 5b5d 0a20 2020 2020 2020 2066  p = [].        f
+00062e50: 6f72 206b 2c20 7469 6420 696e 2065 6e75  or k, tid in enu
+00062e60: 6d65 7261 7465 2870 6964 7329 3a0a 2020  merate(pids):.  
+00062e70: 2020 2020 2020 2020 2020 6661 7374 615f            fasta_
+00062e80: 6c69 6e65 735f 702e 6170 7065 6e64 2820  lines_p.append( 
+00062e90: 273e 2573 5c6e 2720 2520 7469 6420 290a  '>%s\n' % tid ).
+00062ea0: 2020 2020 2020 2020 2020 2020 6661 7374              fast
+00062eb0: 615f 6c69 6e65 735f 702e 6170 7065 6e64  a_lines_p.append
+00062ec0: 2820 2725 735c 6e27 2025 2070 7365 715b  ( '%s\n' % pseq[
+00062ed0: 6b5d 2029 0a20 2020 2020 2020 2020 2020  k] ).           
+00062ee0: 200a 2020 2020 2020 2020 7265 7475 726e   .        return
+00062ef0: 2066 6173 7461 5f6c 696e 6573 5f74 2c20   fasta_lines_t, 
+00062f00: 6661 7374 615f 6c69 6e65 735f 700a 2020  fasta_lines_p.  
+00062f10: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00062f20: 2020 200a 2020 2020 6465 6620 7072 696e     .    def prin
+00062f30: 745f 6578 6f6e 2873 656c 6629 3a0a 2020  t_exon(self):.  
+00062f40: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
+00062f50: 656c 662e 6578 6f6e 732e 7072 696e 745f  elf.exons.print_
+00062f60: 7368 6f72 7428 290a 2020 2020 2020 2020  short().        
+00062f70: 0a0a 2323 2323 2323 2323 2323 2323 2323  ..##############
+00062f80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00062f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00062fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00062fb0: 2323 2323 2323 2323 2323 2323 0a23 2320  ############.## 
+00062fc0: 4675 6e63 7469 6f6e 7320 746f 2069 6e69  Functions to ini
+00062fd0: 7469 616c 697a 6520 4744 2f54 4420 6672  tialize GD/TD fr
+00062fe0: 6f6d 2047 5446 0a23 2323 2323 2323 2323  om GTF.#########
+00062ff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00063000: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00063010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00063020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00063030: 230a 0a64 6566 2073 656c 6563 745f 636f  #..def select_co
+00063040: 6469 6e67 5f67 656e 6573 5f66 726f 6d5f  ding_genes_from_
+00063050: 6774 665f 6669 6c65 2867 7466 5f66 696c  gtf_file(gtf_fil
+00063060: 6529 3a0a 0a20 2020 2066 6e73 203d 2067  e):..    fns = g
+00063070: 7466 5f66 696c 652e 7370 6c69 7428 272e  tf_file.split('.
+00063080: 2729 5b3a 2d31 5d0a 2020 2020 666e 616d  ')[:-1].    fnam
+00063090: 6520 3d20 2727 0a20 2020 2066 6f72 206b  e = ''.    for k
+000630a0: 2c20 666e 2069 6e20 656e 756d 6572 6174  , fn in enumerat
+000630b0: 6528 666e 7329 3a0a 2020 2020 2020 2020  e(fns):.        
+000630c0: 6966 206b 203e 2030 3a0a 2020 2020 2020  if k > 0:.      
+000630d0: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
+000630e0: 616d 6520 2b20 272e 270a 2020 2020 2020  ame + '.'.      
+000630f0: 2020 666e 616d 6520 3d20 666e 616d 6520    fname = fname 
+00063100: 2b20 666e 0a20 2020 200a 2020 2020 6774  + fn.    .    gt
+00063110: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
+00063120: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
+00063130: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
+00063140: 3d20 5472 7565 290a 2020 2020 0a20 2020  = True).    .   
+00063150: 2062 6173 655f 6364 7320 3d20 6765 745f   base_cds = get_
+00063160: 6261 7365 5f63 6473 5f66 726f 6d5f 6774  base_cds_from_gt
+00063170: 665f 6c69 6e65 7328 6774 665f 6c69 6e65  f_lines(gtf_line
+00063180: 7329 0a20 2020 2069 6620 6261 7365 5f63  s).    if base_c
+00063190: 6473 203c 2030 3a0a 2020 2020 2020 2020  ds < 0:.        
+000631a0: 7072 696e 7428 2749 4e46 4f3a 204e 6f20  print('INFO: No 
+000631b0: 636f 6469 6e67 2069 6e66 6f72 6d61 7469  coding informati
+000631c0: 6f6e 2061 7661 696c 6162 6c65 2069 6e20  on available in 
+000631d0: 7468 6520 4754 462f 4746 462e 2729 0a20  the GTF/GFF.'). 
+000631e0: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
+000631f0: 735f 6c73 7420 3d20 7061 7273 655f 6774  s_lst = parse_gt
+00063200: 665f 6c69 6e65 735f 616e 645f 7370 6c69  f_lines_and_spli
+00063210: 745f 696e 746f 5f67 656e 6573 2820 6774  t_into_genes( gt
+00063220: 665f 6c69 6e65 7320 290a 0a20 2020 2067  f_lines )..    g
+00063230: 7466 5f6c 696e 6573 5f6c 7374 5f6e 6577  tf_lines_lst_new
+00063240: 203d 205b 5d0a 2020 2020 6363 6e74 203d   = [].    ccnt =
+00063250: 2030 0a20 2020 2067 636e 7420 3d20 300a   0.    gcnt = 0.
+00063260: 2020 2020 666f 7220 6b2c 206c 696e 6573      for k, lines
+00063270: 2069 6e20 656e 756d 6572 6174 6528 6774   in enumerate(gt
+00063280: 665f 6c69 6e65 735f 6c73 7429 3a0a 2020  f_lines_lst):.  
+00063290: 2020 2020 2020 6220 3d20 4661 6c73 650a        b = False.
+000632a0: 2020 2020 2020 2020 636e 7420 3d20 5b30          cnt = [0
+000632b0: 2c30 5d0a 2020 2020 2020 2020 666f 7220  ,0].        for 
+000632c0: 6774 666c 696e 6520 696e 206c 696e 6573  gtfline in lines
+000632d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000632e0: 2067 7466 6c69 6e65 2e66 6561 7475 7265   gtfline.feature
+000632f0: 203d 3d20 2773 7461 7274 5f63 6f64 6f6e   == 'start_codon
+00063300: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00063310: 2020 2063 6e74 5b30 5d20 2b3d 2031 0a20     cnt[0] += 1. 
+00063320: 2020 2020 2020 2020 2020 2069 6620 6774             if gt
+00063330: 666c 696e 652e 6665 6174 7572 6520 3d3d  fline.feature ==
+00063340: 2027 7374 6f70 5f63 6f64 6f6e 273a 0a20   'stop_codon':. 
+00063350: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00063360: 6e74 5b31 5d20 2b3d 2031 0a20 2020 2020  nt[1] += 1.     
+00063370: 2020 2020 2020 2069 6620 2863 6e74 5b30         if (cnt[0
+00063380: 5d20 3e20 3029 2026 2028 636e 745b 315d  ] > 0) & (cnt[1]
+00063390: 203e 2030 293a 0a20 2020 2020 2020 2020   > 0):.         
+000633a0: 2020 2020 2020 2062 203d 2054 7275 650a         b = True.
+000633b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000633c0: 6363 6e74 202b 3d20 310a 2020 2020 2020  ccnt += 1.      
+000633d0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+000633e0: 2020 2020 2020 2020 6763 6e74 202b 3d20          gcnt += 
+000633f0: 310a 2020 2020 2020 2020 6966 206b 2531  1.        if k%1
+00063400: 3030 203d 3d20 303a 2070 7269 6e74 2827  00 == 0: print('
+00063410: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
+00063420: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
+00063430: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
+00063440: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
+00063450: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
+00063460: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
+00063470: 2020 6966 2062 3a20 6774 665f 6c69 6e65    if b: gtf_line
+00063480: 735f 6c73 745f 6e65 7720 3d20 6774 665f  s_lst_new = gtf_
+00063490: 6c69 6e65 735f 6c73 745f 6e65 7720 2b20  lines_lst_new + 
+000634a0: 6c69 6e65 730a 0a20 2020 2066 6e61 6d65  lines..    fname
+000634b0: 203d 2066 6e61 6d65 202b 2027 5f63 6473   = fname + '_cds
+000634c0: 2e67 7466 270a 2020 2020 7361 7665 5f67  .gtf'.    save_g
+000634d0: 7466 2820 666e 616d 652c 2067 7466 5f6c  tf( fname, gtf_l
+000634e0: 696e 6573 5f6c 7374 5f6e 6577 2c20 6864  ines_lst_new, hd
+000634f0: 725f 6c69 6e65 7320 290a 2020 2020 0a20  r_lines ).    . 
+00063500: 2020 2072 6574 7572 6e20 666e 616d 650a     return fname.
+00063510: 2020 2020 0a0a 0a64 6566 2063 6f6d 6269      ...def combi
+00063520: 6e65 5f67 656e 6573 5f70 6572 5f63 6872  ne_genes_per_chr
+00063530: 2820 6764 5f6c 7374 2c20 7665 7262 6f73  ( gd_lst, verbos
+00063540: 6520 3d20 4661 6c73 6520 293a 0a20 2020  e = False ):.   
+00063550: 200a 2020 2020 675f 6c73 7420 3d20 7b6b   .    g_lst = {k
+00063560: 3a20 5b5d 2066 6f72 206b 2069 6e20 7261  : [] for k in ra
+00063570: 6e67 6528 6c65 6e28 6764 5f6c 7374 2929  nge(len(gd_lst))
+00063580: 7d0a 2020 2020 6e67 203d 206c 656e 2867  }.    ng = len(g
+00063590: 645f 6c73 7429 0a0a 2020 2020 7374 6172  d_lst)..    star
+000635a0: 745f 7469 6d65 3120 3d20 7469 6d65 2e74  t_time1 = time.t
+000635b0: 696d 6528 290a 2020 2020 2327 2727 0a20  ime().    #'''. 
+000635c0: 2020 200a 2020 2020 6e5f 6764 203d 206c     .    n_gd = l
+000635d0: 656e 2867 645f 6c73 7429 0a20 2020 2073  en(gd_lst).    s
+000635e0: 5f70 6f73 203d 206e 702e 7a65 726f 7328  _pos = np.zeros(
+000635f0: 6e5f 6764 290a 2020 2020 655f 706f 7320  n_gd).    e_pos 
+00063600: 3d20 6e70 2e7a 6572 6f73 286e 5f67 6429  = np.zeros(n_gd)
+00063610: 0a20 2020 2065 5f6d 6178 203d 206e 702e  .    e_max = np.
+00063620: 7a65 726f 7328 6e5f 6764 290a 2020 2020  zeros(n_gd).    
+00063630: 656e 645f 6d61 7820 3d20 300a 2020 2020  end_max = 0.    
+00063640: 666f 7220 6b2c 2067 6420 696e 2065 6e75  for k, gd in enu
+00063650: 6d65 7261 7465 2867 645f 6c73 7429 3a20  merate(gd_lst): 
+00063660: 0a20 2020 2020 2020 2073 5f70 6f73 5b6b  .        s_pos[k
+00063670: 5d20 3d20 6764 2e62 6567 696e 0a20 2020  ] = gd.begin.   
+00063680: 2020 2020 2065 5f70 6f73 5b6b 5d20 3d20       e_pos[k] = 
+00063690: 6764 2e65 6e64 0a20 2020 2020 2020 200a  gd.end.        .
+000636a0: 2020 2020 6f64 7220 3d20 735f 706f 732e      odr = s_pos.
+000636b0: 6172 6773 6f72 7428 290a 2020 2020 0a20  argsort().    . 
+000636c0: 2020 2066 6f72 206b 6b20 696e 2072 616e     for kk in ran
+000636d0: 6765 286c 656e 2867 645f 6c73 7429 293a  ge(len(gd_lst)):
+000636e0: 200a 2020 2020 2020 2020 6b20 3d20 6f64   .        k = od
+000636f0: 725b 6b6b 5d0a 2020 2020 2020 2020 656e  r[kk].        en
+00063700: 645f 6d61 7820 3d20 6d61 7828 656e 645f  d_max = max(end_
+00063710: 6d61 782c 2065 5f70 6f73 5b6b 5d29 0a20  max, e_pos[k]). 
+00063720: 2020 2020 2020 2065 5f6d 6178 5b6b 5d20         e_max[k] 
+00063730: 3d20 656e 645f 6d61 780a 2020 2020 2020  = end_max.      
+00063740: 2020 0a20 2020 2023 2727 270a 2020 2020    .    #'''.    
+00063750: 666f 7220 6b6b 2069 6e20 7261 6e67 6528  for kk in range(
+00063760: 312c 6e5f 6764 293a 0a20 2020 2020 2020  1,n_gd):.       
+00063770: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
+00063780: 2020 2020 2020 2020 2069 6620 6b6b 2531           if kk%1
+00063790: 3030 203d 3d20 303a 0a20 2020 2020 2020  00 == 0:.       
+000637a0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000637b0: 5c72 436f 6d62 696e 696e 6720 6765 6e65  \rCombining gene
+000637c0: 7320 2569 2f25 6927 2025 2028 6b6b 2c6e  s %i/%i' % (kk,n
+000637d0: 5f67 6429 2c20 656e 643d 2720 2020 2027  _gd), end='    '
+000637e0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+000637f0: 2020 200a 2020 2020 2020 2020 6b20 3d20     .        k = 
+00063800: 6f64 725b 6b6b 5d0a 2020 2020 2020 2020  odr[kk].        
+00063810: 0a20 2020 2020 2020 2069 6620 735f 706f  .        if s_po
+00063820: 735b 6b5d 203e 2065 5f6d 6178 5b6f 6472  s[k] > e_max[odr
+00063830: 5b6b 6b2d 315d 5d3a 0a20 2020 2020 2020  [kk-1]]:.       
+00063840: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00063850: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00063860: 2020 2020 666f 7220 6d6d 2069 6e20 7265      for mm in re
+00063870: 7665 7273 6564 2872 616e 6765 286b 6b29  versed(range(kk)
+00063880: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00063890: 2020 206d 203d 206f 6472 5b6d 6d5d 0a20     m = odr[mm]. 
+000638a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000638b0: 6620 735f 706f 735b 6b5d 203e 2065 5f6d  f s_pos[k] > e_m
+000638c0: 6178 5b6d 5d3a 2062 7265 616b 0a20 2020  ax[m]: break.   
+000638d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000638e0: 2867 645f 6c73 745b 6b5d 2e63 6872 203d  (gd_lst[k].chr =
+000638f0: 3d20 6764 5f6c 7374 5b6d 5d2e 6368 7229  = gd_lst[m].chr)
+00063900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00063910: 2020 2020 2020 6966 2028 735f 706f 735b        if (s_pos[
+00063920: 6b5d 203c 2065 5f70 6f73 5b6d 5d29 3a0a  k] < e_pos[m]):.
+00063930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063940: 2020 2020 2020 2020 6966 2067 645f 6c73          if gd_ls
+00063950: 745b 6d5d 2e65 786f 6e73 2e68 6173 5f65  t[m].exons.has_e
+00063960: 7874 5f69 6e74 6572 7365 6374 696f 6e5f  xt_intersection_
+00063970: 7769 7468 2867 645f 6c73 745b 6b5d 2e65  with(gd_lst[k].e
+00063980: 786f 6e73 293a 0a20 2020 2020 2020 2020  xons):.         
+00063990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000639a0: 2020 2067 5f6c 7374 5b6b 5d2e 6170 7065     g_lst[k].appe
+000639b0: 6e64 286d 290a 2020 2020 2020 2020 2020  nd(m).          
+000639c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000639d0: 2020 675f 6c73 745b 6d5d 2e61 7070 656e    g_lst[m].appen
+000639e0: 6428 6b29 0a20 2020 2020 2020 2020 2020  d(k).           
+000639f0: 2020 2020 200a 2020 2020 656c 6170 7365       .    elapse
+00063a00: 645f 7469 6d65 3120 3d20 7469 6d65 2e74  d_time1 = time.t
+00063a10: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
+00063a20: 6d65 310a 2020 2020 6966 2076 6572 626f  me1.    if verbo
+00063a30: 7365 3a20 7072 696e 7428 275c 7243 6f6d  se: print('\rCom
+00063a40: 6269 6e69 6e67 2067 656e 6573 2025 6920  bining genes %i 
+00063a50: 2e2e 2e20 646f 6e65 2e20 2569 2873 2920  ... done. %i(s) 
+00063a60: 2720 2520 286e 5f67 642c 656c 6170 7365  ' % (n_gd,elapse
+00063a70: 645f 7469 6d65 3129 2029 0a20 2020 2023  d_time1) ).    #
+00063a80: 2727 270a 0a20 2020 2027 2727 0a20 2020  '''..    '''.   
+00063a90: 206b 6b20 3d20 300a 2020 2020 6d6d 203d   kk = 0.    mm =
+00063aa0: 206b 6b2b 310a 2020 2020 6b20 3d20 6f64   kk+1.    k = od
+00063ab0: 725b 6b6b 5d0a 2020 2020 6d20 3d20 6f64  r[kk].    m = od
+00063ac0: 725b 6d6d 5d0a 2020 2020 0a20 2020 2077  r[mm].    .    w
+00063ad0: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
+00063ae0: 2020 2069 6620 655f 706f 735b 6b5d 203c     if e_pos[k] <
+00063af0: 2073 5f70 6f73 5b6d 5d3a 0a20 2020 2020   s_pos[m]:.     
+00063b00: 2020 2020 2020 2069 6620 6d6d 203c 206b         if mm < k
+00063b10: 6b3a 206d 6d20 3d20 6b6b 202b 2031 0a20  k: mm = kk + 1. 
+00063b20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00063b30: 206b 6b20 3d20 6d6d 202b 2031 0a20 2020   kk = mm + 1.   
+00063b40: 2020 2020 2020 2020 206b 203d 206f 6472           k = odr
+00063b50: 5b6b 6b5d 0a20 2020 2020 2020 2020 2020  [kk].           
+00063b60: 206d 203d 206f 6472 5b6d 6d5d 0a20 2020   m = odr[mm].   
+00063b70: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00063b80: 2020 656c 6966 2065 5f70 6f73 5b6d 5d20    elif e_pos[m] 
+00063b90: 3c20 735f 706f 735b 6b5d 3a0a 2020 2020  < s_pos[k]:.    
+00063ba0: 2020 2020 2020 2020 6966 206d 6d20 3c20          if mm < 
+00063bb0: 6b6b 3a20 6d6d 203d 206b 6b20 2b20 310a  kk: mm = kk + 1.
+00063bc0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00063bd0: 3a20 6b6b 203d 206d 6d20 2b20 310a 2020  : kk = mm + 1.  
+00063be0: 2020 2020 2020 2020 2020 6b20 3d20 6f64            k = od
+00063bf0: 725b 6b6b 5d0a 2020 2020 2020 2020 2020  r[kk].          
+00063c00: 2020 6d20 3d20 6f64 725b 6d6d 5d0a 2020    m = odr[mm].  
+00063c10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00063c20: 2020 2020 2020 2020 6966 2028 6764 5f6c          if (gd_l
+00063c30: 7374 5b6b 5d2e 6368 7220 3d3d 2067 645f  st[k].chr == gd_
+00063c40: 6c73 745b 6d5d 2e63 6872 293a 0a20 2020  lst[m].chr):.   
+00063c50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00063c60: 6764 5f6c 7374 5b6d 5d2e 6578 6f6e 732e  gd_lst[m].exons.
+00063c70: 6861 735f 6578 745f 696e 7465 7273 6563  has_ext_intersec
+00063c80: 7469 6f6e 5f77 6974 6828 6764 5f6c 7374  tion_with(gd_lst
+00063c90: 5b6b 5d2e 6578 6f6e 7329 3a0a 2020 2020  [k].exons):.    
+00063ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063cb0: 675f 6c73 745b 6b5d 2e61 7070 656e 6428  g_lst[k].append(
+00063cc0: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
+00063cd0: 2020 2020 2020 2067 5f6c 7374 5b6d 5d2e         g_lst[m].
+00063ce0: 6170 7065 6e64 286b 290a 0a20 2020 2020  append(k)..     
+00063cf0: 2020 2020 2020 2069 6620 6d6d 203c 206b         if mm < k
+00063d00: 6b3a 206d 6d20 3d20 6b6b 202b 2031 0a20  k: mm = kk + 1. 
+00063d10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00063d20: 206b 6b20 3d20 6d6d 202b 2031 0a20 2020   kk = mm + 1.   
+00063d30: 2020 2020 2020 2020 206b 203d 206f 6472           k = odr
+00063d40: 5b6b 6b5d 0a20 2020 2020 2020 2020 2020  [kk].           
+00063d50: 206d 203d 206f 6472 5b6d 6d5d 0a20 2020   m = odr[mm].   
+00063d60: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00063d70: 2020 6966 2076 6572 626f 7365 3a0a 2020    if verbose:.  
+00063d80: 2020 2020 2020 2020 2020 6966 206b 6b25            if kk%
+00063d90: 3130 3020 3d3d 2030 3a0a 2020 2020 2020  100 == 0:.      
+00063da0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00063db0: 275c 7243 6f6d 6269 6e69 6e67 2067 656e  '\rCombining gen
+00063dc0: 6573 2025 692f 2569 2720 2520 286b 6b2c  es %i/%i' % (kk,
+00063dd0: 6e5f 6764 292c 2065 6e64 3d27 2020 2020  n_gd), end='    
+00063de0: 2720 290a 2020 2020 2020 2020 2020 2020  ' ).            
+00063df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063e00: 2020 2020 0a20 2020 2065 6c61 7073 6564      .    elapsed
+00063e10: 5f74 696d 6531 203d 2074 696d 652e 7469  _time1 = time.ti
+00063e20: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
+00063e30: 6531 0a20 2020 2069 6620 7665 7262 6f73  e1.    if verbos
+00063e40: 653a 2070 7269 6e74 2827 5c72 436f 6d62  e: print('\rComb
+00063e50: 696e 696e 6720 6765 6e65 7320 2569 202e  ining genes %i .
+00063e60: 2e2e 2064 6f6e 652e 2025 6928 7329 2027  .. done. %i(s) '
+00063e70: 2025 2028 6e5f 6764 2c65 6c61 7073 6564   % (n_gd,elapsed
+00063e80: 5f74 696d 6531 2920 290a 2020 2020 2327  _time1) ).    #'
+00063e90: 2727 0a0a 2020 2020 2020 2020 0a20 2020  ''..        .   
+00063ea0: 200a 2020 2020 6270 6720 3d20 6e70 2e6f   .    bpg = np.o
+00063eb0: 6e65 7328 6c65 6e28 6764 5f6c 7374 2929  nes(len(gd_lst))
+00063ec0: 0a0a 2020 2020 636f 6d62 5f6c 7374 203d  ..    comb_lst =
+00063ed0: 205b 5d0a 2020 2020 666f 7220 6b20 696e   [].    for k in
+00063ee0: 2067 5f6c 7374 2e6b 6579 7328 293a 0a20   g_lst.keys():. 
+00063ef0: 2020 2020 2020 2069 6620 286c 656e 2867         if (len(g
+00063f00: 5f6c 7374 5b6b 5d29 203e 2030 293a 0a20  _lst[k]) > 0):. 
+00063f10: 2020 2020 2020 2020 2020 2069 6620 2862             if (b
+00063f20: 7067 5b6b 5d20 3e20 3029 3a20 0a20 2020  pg[k] > 0): .   
+00063f30: 2020 2020 2020 2020 2020 2020 2067 6973               gis
+00063f40: 203d 2073 6574 2867 5f6c 7374 5b6b 5d29   = set(g_lst[k])
+00063f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00063f60: 206e 5f70 7265 7620 3d20 6c65 6e28 6769   n_prev = len(gi
+00063f70: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00063f80: 2020 2063 6e74 203d 2030 0a20 2020 2020     cnt = 0.     
+00063f90: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00063fa0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+00063fb0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00063fc0: 2069 6e20 6769 733a 0a20 2020 2020 2020   in gis:.       
+00063fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063fe0: 2067 6973 203d 2067 6973 2e75 6e69 6f6e   gis = gis.union
+00063ff0: 2820 7365 7428 675f 6c73 745b 695d 2920  ( set(g_lst[i]) 
+00064000: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00064010: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00064020: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00064030: 6620 286c 656e 2867 6973 2920 3d3d 206e  f (len(gis) == n
+00064040: 5f70 7265 7629 3a20 6272 6561 6b0a 2020  _prev): break.  
+00064050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064060: 2020 656c 7365 3a20 6e5f 7072 6576 203d    else: n_prev =
+00064070: 206c 656e 2867 6973 290a 2020 2020 2020   len(gis).      
+00064080: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+00064090: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
+000640a0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+000640b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000640c0: 6769 7320 3d20 6c69 7374 2873 6574 286c  gis = list(set(l
+000640d0: 6973 7428 6769 7329 202b 205b 6b5d 2929  ist(gis) + [k]))
+000640e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000640f0: 2066 6f72 206d 2069 6e20 6769 733a 2062   for m in gis: b
+00064100: 7067 5b6d 5d20 3d20 300a 2020 2020 2020  pg[m] = 0.      
+00064110: 2020 2020 2020 2020 2020 636f 6d62 5f6c            comb_l
+00064120: 7374 2e61 7070 656e 6428 2867 6973 2929  st.append((gis))
+00064130: 0a0a 2020 2020 6966 206c 656e 2863 6f6d  ..    if len(com
+00064140: 625f 6c73 7429 203e 2030 3a0a 2020 2020  b_lst) > 0:.    
+00064150: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
+00064160: 2020 2020 746f 5f64 656c 5f67 203d 205b      to_del_g = [
+00064170: 5d0a 2020 2020 2020 2020 666f 7220 636c  ].        for cl
+00064180: 2069 6e20 636f 6d62 5f6c 7374 3a0a 2020   in comb_lst:.  
+00064190: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000641a0: 2020 2020 2020 2069 6620 6c65 6e28 636c         if len(cl
+000641b0: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
+000641c0: 2020 2020 2020 2063 6e74 202b 3d20 6c65         cnt += le
+000641d0: 6e28 636c 292d 310a 2020 2020 2020 2020  n(cl)-1.        
+000641e0: 2020 2020 2020 2020 6b20 3d20 636c 5b30          k = cl[0
+000641f0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00064200: 2020 666f 7220 6769 2069 6e20 636c 5b31    for gi in cl[1
+00064210: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
+00064220: 2020 2020 2020 2020 6764 5f6c 7374 5b6b          gd_lst[k
+00064230: 5d2e 6d65 7267 6528 6764 5f6c 7374 5b67  ].merge(gd_lst[g
+00064240: 695d 290a 2020 2020 2020 2020 2020 2020  i]).            
+00064250: 2020 2020 2020 2020 746f 5f64 656c 5f67          to_del_g
+00064260: 2e61 7070 656e 6428 6769 290a 0a20 2020  .append(gi)..   
+00064270: 2020 2020 2069 6620 6c65 6e28 746f 5f64       if len(to_d
+00064280: 656c 5f67 2920 3e20 303a 0a20 2020 2020  el_g) > 0:.     
+00064290: 2020 2020 2020 2074 6f5f 6465 6c5f 6720         to_del_g 
+000642a0: 3d20 6c69 7374 2873 6574 2874 6f5f 6465  = list(set(to_de
+000642b0: 6c5f 6729 290a 2020 2020 2020 2020 2020  l_g)).          
+000642c0: 2020 746f 5f64 656c 5f67 2e73 6f72 7428    to_del_g.sort(
+000642d0: 7265 7665 7273 653d 5472 7565 290a 2020  reverse=True).  
+000642e0: 2020 2020 2020 2020 2020 666f 7220 6769            for gi
+000642f0: 2069 6e20 746f 5f64 656c 5f67 3a0a 2020   in to_del_g:.  
+00064300: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00064310: 6c20 6764 5f6c 7374 5b67 695d 0a20 2020  l gd_lst[gi].   
+00064320: 2020 2020 2023 2070 7269 6e74 2827 2025       # print(' %
+00064330: 6920 2d3e 2025 6927 2025 2028 6e67 2c20  i -> %i' % (ng, 
+00064340: 6c65 6e28 6764 5f6c 7374 2929 2029 0a20  len(gd_lst)) ). 
+00064350: 2020 2020 2020 2064 656c 2067 5f6c 7374         del g_lst
+00064360: 0a20 2020 2020 2020 2064 656c 2063 6f6d  .        del com
+00064370: 625f 6c73 740a 2020 2020 656c 7365 3a0a  b_lst.    else:.
+00064380: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00064390: 2020 2020 2023 2070 7269 6e74 2827 2027       # print(' '
+000643a0: 290a 0a20 2020 2072 6574 7572 6e20 6764  )..    return gd
+000643b0: 5f6c 7374 0a23 2727 270a 0a64 6566 2067  _lst.#'''..def g
+000643c0: 6574 5f67 656e 655f 6465 7363 7269 7074  et_gene_descript
+000643d0: 6f72 2867 7466 5f6c 696e 6573 2c20 6765  or(gtf_lines, ge
+000643e0: 6e6f 6d65 203d 204e 6f6e 652c 2066 696c  nome = None, fil
+000643f0: 6c20 3d20 4661 6c73 652c 2063 6720 3d20  l = False, cg = 
+00064400: 5472 7565 2c20 5c0a 2020 2020 2020 2020  True, \.        
+00064410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064420: 7665 7262 6f73 6520 3d20 4661 6c73 652c  verbose = False,
+00064430: 206e 5f63 6f72 6573 203d 2031 293a 0a0a   n_cores = 1):..
+00064440: 2020 2020 6261 7365 5f63 6473 203d 2067      base_cds = g
+00064450: 6574 5f62 6173 655f 6364 735f 6672 6f6d  et_base_cds_from
+00064460: 5f67 7466 5f6c 696e 6573 2867 7466 5f6c  _gtf_lines(gtf_l
+00064470: 696e 6573 290a 2020 2020 6966 2062 6173  ines).    if bas
+00064480: 655f 6364 7320 3c20 303a 0a20 2020 2020  e_cds < 0:.     
+00064490: 2020 2070 7269 6e74 2827 2020 204e 6f20     print('   No 
+000644a0: 636f 6469 6e67 2069 6e66 6f72 6d61 7469  coding informati
+000644b0: 6f6e 2061 7661 696c 6162 6c65 2069 6e20  on available in 
+000644c0: 7468 6520 4754 462f 4746 462e 2729 0a20  the GTF/GFF.'). 
+000644d0: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
+000644e0: 735f 6c73 7420 3d20 7061 7273 655f 6774  s_lst = parse_gt
+000644f0: 665f 6c69 6e65 735f 616e 645f 7370 6c69  f_lines_and_spli
+00064500: 745f 696e 746f 5f67 656e 6573 2820 6774  t_into_genes( gt
+00064510: 665f 6c69 6e65 7320 290a 2020 2020 6764  f_lines ).    gd
+00064520: 5f6c 7374 203d 205b 5d0a 2020 2020 7463  _lst = [].    tc
+00064530: 6e74 203d 2030 0a20 2020 2074 636e 7432  nt = 0.    tcnt2
+00064540: 203d 2030 0a20 2020 2067 636e 7420 3d20   = 0.    gcnt = 
+00064550: 300a 2020 2020 6368 7273 203d 205b 5d20  0.    chrs = [] 
+00064560: 2020 200a 2020 2020 0a20 2020 2073 7461     .    .    sta
+00064570: 7274 5f74 696d 6531 203d 2074 696d 652e  rt_time1 = time.
+00064580: 7469 6d65 2829 0a20 2020 2069 6620 5472  time().    if Tr
+00064590: 7565 3a20 2320 3e20 313a 0a20 2020 2020  ue: # > 1:.     
+000645a0: 2020 2066 6f72 206b 2c67 2069 6e20 656e     for k,g in en
+000645b0: 756d 6572 6174 6528 6774 665f 6c69 6e65  umerate(gtf_line
+000645c0: 735f 6c73 7429 3a0a 2020 2020 2020 2020  s_lst):.        
+000645d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+000645e0: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
+000645f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00064600: 6b25 3130 3020 3d3d 2030 3a0a 2020 2020  k%100 == 0:.    
+00064610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064620: 7072 696e 7428 275c 7250 6172 7369 6e67  print('\rParsing
+00064630: 2047 5446 2025 692f 2569 2720 2520 286b   GTF %i/%i' % (k
+00064640: 2c6c 656e 2867 7466 5f6c 696e 6573 5f6c  ,len(gtf_lines_l
+00064650: 7374 2929 2c20 656e 643d 2720 2020 2027  st)), end='    '
+00064660: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00064670: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00064680: 2020 2020 6764 203d 2067 656e 655f 6465      gd = gene_de
+00064690: 7363 7269 7074 6f72 2867 2c20 6765 6e6f  scriptor(g, geno
+000646a0: 6d65 2c20 6261 7365 5f63 6473 2c20 6669  me, base_cds, fi
+000646b0: 6c6c 2c20 436f 765f 7468 203d 204d 494e  ll, Cov_th = MIN
+000646c0: 5f43 4f56 5f54 4f5f 5345 4c2c 2041 626e  _COV_TO_SEL, Abn
+000646d0: 5f74 6820 3d20 4d49 4e5f 4142 4e5f 544f  _th = MIN_ABN_TO
+000646e0: 5f53 454c 290a 2020 2020 2020 2020 2020  _SEL).          
+000646f0: 2020 6764 5f6c 7374 2e61 7070 656e 6428    gd_lst.append(
+00064700: 6764 290a 2020 2020 2020 2020 2020 2020  gd).            
+00064710: 6368 7273 2e61 7070 656e 6428 2067 642e  chrs.append( gd.
+00064720: 6368 7220 290a 2020 2020 2020 2020 2020  chr ).          
+00064730: 2020 7463 6e74 202b 3d20 6c65 6e28 6764    tcnt += len(gd
+00064740: 2e74 645f 6c73 7429 0a20 2020 2020 2020  .td_lst).       
+00064750: 2020 2020 2066 6f72 2074 6420 696e 2067       for td in g
+00064760: 642e 7464 5f6c 7374 3a0a 2020 2020 2020  d.td_lst:.      
+00064770: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00064780: 2874 642e 7465 5f74 6f5f 6765 5f6d 6170  (td.te_to_ge_map
+00064790: 2920 3e20 303a 2074 636e 7432 202b 3d20  ) > 0: tcnt2 += 
+000647a0: 310a 2020 2020 0a20 2020 2020 2020 2064  1.    .        d
+000647b0: 656c 2067 7466 5f6c 696e 6573 5f6c 7374  el gtf_lines_lst
+000647c0: 0a20 2020 200a 2020 2020 656c 6170 7365  .    .    elapse
+000647d0: 645f 7469 6d65 3120 3d20 7469 6d65 2e74  d_time1 = time.t
+000647e0: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
+000647f0: 6d65 310a 2020 2020 6966 2076 6572 626f  me1.    if verbo
+00064800: 7365 3a20 7072 696e 7428 275c 7250 6172  se: print('\rPar
+00064810: 7369 6e67 2047 5446 202e 2e2e 2064 6f6e  sing GTF ... don
+00064820: 652e 2025 692f 2569 2074 7273 2066 6f75  e. %i/%i trs fou
+00064830: 6e64 2066 726f 6d20 2569 2067 656e 6573  nd from %i genes
+00064840: 2028 2569 2920 2720 2520 2874 636e 742c   (%i) ' % (tcnt,
+00064850: 2074 636e 7432 2c20 6c65 6e28 6764 5f6c   tcnt2, len(gd_l
+00064860: 7374 292c 2065 6c61 7073 6564 5f74 696d  st), elapsed_tim
+00064870: 6531 292c 2065 6e64 203d 2027 2027 290a  e1), end = ' ').
+00064880: 2020 2020 2320 6966 2076 6572 626f 7365      # if verbose
+00064890: 3a20 7072 696e 7428 275c 7250 6172 7369  : print('\rParsi
+000648a0: 6e67 2047 5446 202e 2e2e 2064 6f6e 652e  ng GTF ... done.
+000648b0: 2025 692f 2569 2074 7273 2066 6f75 6e64   %i/%i trs found
+000648c0: 2066 726f 6d20 2569 2067 656e 6573 2028   from %i genes (
+000648d0: 2569 2920 2720 2520 2874 636e 742c 2074  %i) ' % (tcnt, t
+000648e0: 636e 7432 2c20 6c65 6e28 6764 5f6c 7374  cnt2, len(gd_lst
+000648f0: 292c 2065 6c61 7073 6564 5f74 696d 6531  ), elapsed_time1
+00064900: 2929 0a0a 2020 2020 7265 7475 726e 2067  ))..    return g
+00064910: 645f 6c73 742c 2063 6872 730a 0a0a 6465  d_lst, chrs...de
+00064920: 6620 6d63 5f63 6f72 655f 6765 6e5f 6465  f mc_core_gen_de
+00064930: 7363 7269 7074 6f72 2867 7829 3a0a 2020  scriptor(gx):.  
+00064940: 2020 0a20 2020 2072 6574 7572 6e20 6765    .    return ge
+00064950: 6e65 5f64 6573 6372 6970 746f 7228 6778  ne_descriptor(gx
+00064960: 5b30 5d2c 2067 785b 315d 2c20 6778 5b32  [0], gx[1], gx[2
+00064970: 5d2c 2067 785b 335d 2c20 436f 765f 7468  ], gx[3], Cov_th
+00064980: 203d 204d 494e 5f43 4f56 5f54 4f5f 5345   = MIN_COV_TO_SE
+00064990: 4c2c 2041 626e 5f74 6820 3d20 4d49 4e5f  L, Abn_th = MIN_
+000649a0: 4142 4e5f 544f 5f53 454c 290a 2020 2020  ABN_TO_SEL).    
+000649b0: 0a64 6566 206d 635f 636f 7265 5f6d 6170  .def mc_core_map
+000649c0: 7069 6e67 2820 6120 293a 0a20 2020 200a  ping( a ):.    .
+000649d0: 2020 2020 672c 2072 6d2c 2072 6e64 2c20      g, rm, rnd, 
+000649e0: 7273 7469 2c20 6e67 2c20 6e72 2c20 7464  rsti, ng, nr, td
+000649f0: 672c 2074 6472 203d 2063 6f6d 6269 6e65  g, tdr = combine
+00064a00: 5f67 656e 6573 5f61 6e64 5f72 676e 735f  _genes_and_rgns_
+00064a10: 7065 725f 6368 7228 2061 5b30 5d2c 2061  per_chr( a[0], a
+00064a20: 5b31 5d2c 205c 0a20 2020 2020 2020 2020  [1], \.         
+00064a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064a50: 2020 2020 2020 2020 2020 2020 2020 615b                a[
+00064a60: 325d 2c20 615b 335d 2c20 5c0a 2020 2020  2], a[3], \.    
+00064a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064aa0: 2020 2076 6572 626f 7365 203d 2046 616c     verbose = Fal
+00064ab0: 7365 2029 0a20 2020 2020 2020 2020 2020  se ).           
+00064ac0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
+00064ad0: 2067 2c20 726d 2c20 726e 642c 2072 7374   g, rm, rnd, rst
+00064ae0: 692c 206e 672c 206e 722c 205b 615b 345d  i, ng, nr, [a[4]
+00064af0: 5b77 5d20 666f 7220 7720 696e 2074 6467  [w] for w in tdg
+00064b00: 5d2c 205b 615b 355d 5b77 5d20 666f 7220  ], [a[5][w] for 
+00064b10: 7720 696e 2074 6472 5d0a 0a0a 2727 270a  w in tdr]...'''.
+00064b20: 2020 2020 2020 2020 6764 5f6c 7374 732c          gd_lsts,
+00064b30: 2063 6872 5f6c 7374 203d 2067 6574 5f67   chr_lst = get_g
+00064b40: 656e 655f 6465 7363 7269 7074 6f72 2867  ene_descriptor(g
+00064b50: 7466 5f6c 696e 6573 2c20 6765 6e6f 6d65  tf_lines, genome
+00064b60: 203d 204e 6f6e 652c 2066 696c 6c20 3d20   = None, fill = 
+00064b70: 5472 7565 2c20 5c0a 2020 2020 2020 2020  True, \.        
+00064b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064ba0: 2020 2020 2020 2063 6720 3d20 5472 7565         cg = True
+00064bb0: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
+00064bc0: 290a 2727 270a 0a64 6566 2070 6163 6b5f  ).'''..def pack_
+00064bd0: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
+00064be0: 2067 645f 6c73 742c 2063 6872 7320 293a   gd_lst, chrs ):
+00064bf0: 0a20 2020 200a 2020 2020 6368 725f 6c73  .    .    chr_ls
+00064c00: 7420 3d20 6c69 7374 2873 6574 2863 6872  t = list(set(chr
+00064c10: 7329 290a 2020 2020 6368 725f 6c73 742e  s)).    chr_lst.
+00064c20: 736f 7274 2829 0a20 2020 2063 6872 7320  sort().    chrs 
+00064c30: 3d20 6e70 2e61 7272 6179 2863 6872 7329  = np.array(chrs)
+00064c40: 0a0a 2020 2020 6764 5f6c 7374 5f6f 665f  ..    gd_lst_of_
+00064c50: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
+00064c60: 2063 6872 6d20 696e 2063 6872 5f6c 7374   chrm in chr_lst
+00064c70: 3a0a 2020 2020 2020 2020 7768 203d 2077  :.        wh = w
+00064c80: 6869 6368 2863 6872 7320 3d3d 2063 6872  hich(chrs == chr
+00064c90: 6d29 0a0a 2020 2020 2020 2020 735f 706f  m)..        s_po
+00064ca0: 7320 3d20 6e70 2e7a 6572 6f73 286c 656e  s = np.zeros(len
+00064cb0: 2877 6829 290a 2020 2020 2020 2020 666f  (wh)).        fo
+00064cc0: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
+00064cd0: 2877 6829 293a 200a 2020 2020 2020 2020  (wh)): .        
+00064ce0: 2020 2020 735f 706f 735b 6b5d 203d 2067      s_pos[k] = g
+00064cf0: 645f 6c73 745b 7768 5b6b 5d5d 2e62 6567  d_lst[wh[k]].beg
+00064d00: 696e 0a20 2020 2020 2020 206f 6472 203d  in.        odr =
+00064d10: 2073 5f70 6f73 2e61 7267 736f 7274 2829   s_pos.argsort()
+00064d20: 0a0a 2020 2020 2020 2020 6764 5f73 656c  ..        gd_sel
+00064d30: 5f6f 7264 6572 6564 203d 205b 6764 5f6c  _ordered = [gd_l
+00064d40: 7374 5b77 685b 6f64 725b 6b5d 5d5d 2066  st[wh[odr[k]]] f
+00064d50: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
+00064d60: 6e28 7768 2929 5d0a 2020 2020 2020 2020  n(wh))].        
+00064d70: 6764 5f6c 7374 5f6f 665f 6c73 742e 6170  gd_lst_of_lst.ap
+00064d80: 7065 6e64 2867 645f 7365 6c5f 6f72 6465  pend(gd_sel_orde
+00064d90: 7265 6429 0a20 2020 200a 2020 2020 666f  red).    .    fo
+00064da0: 7220 6b2c 2067 645f 7365 6c5f 6f72 6465  r k, gd_sel_orde
+00064db0: 7265 6420 696e 2065 6e75 6d65 7261 7465  red in enumerate
+00064dc0: 2867 645f 6c73 745f 6f66 5f6c 7374 293a  (gd_lst_of_lst):
+00064dd0: 0a20 2020 2020 2020 2067 645f 7365 6c5f  .        gd_sel_
+00064de0: 6f72 6465 7265 6420 3d20 636f 6d62 696e  ordered = combin
+00064df0: 655f 6765 6e65 735f 7065 725f 6368 7228  e_genes_per_chr(
+00064e00: 2067 645f 7365 6c5f 6f72 6465 7265 642c   gd_sel_ordered,
+00064e10: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
+00064e20: 2029 0a20 2020 2020 2020 2067 645f 6c73   ).        gd_ls
+00064e30: 745f 6f66 5f6c 7374 5b6b 5d20 3d20 6764  t_of_lst[k] = gd
+00064e40: 5f73 656c 5f6f 7264 6572 6564 0a0a 2020  _sel_ordered..  
+00064e50: 2020 7265 7475 726e 2067 645f 6c73 745f    return gd_lst_
+00064e60: 6f66 5f6c 7374 2c20 6368 725f 6c73 740a  of_lst, chr_lst.
+00064e70: 0a0a 6465 6620 7061 7273 655f 616e 645f  ..def parse_and_
+00064e80: 636f 6d62 696e 655f 6765 6e65 735f 616e  combine_genes_an
+00064e90: 645f 7267 6e73 2820 6764 5f6c 7374 5f6f  d_rgns( gd_lst_o
+00064ea0: 665f 6c73 742c 2063 6872 5f6c 7374 2c20  f_lst, chr_lst, 
+00064eb0: 7267 6e73 5f6c 7374 5f6d 692c 2072 676e  rgns_lst_mi, rgn
+00064ec0: 735f 6c73 745f 6e64 2c20 7267 6e73 5f6c  s_lst_nd, rgns_l
+00064ed0: 7374 5f73 7469 2c20 5c0a 2020 2020 2020  st_sti, \.      
+00064ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064ef0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00064f00: 5f63 6f72 6573 203d 2031 2c20 6765 6e6f  _cores = 1, geno
+00064f10: 6d65 203d 204e 6f6e 652c 2076 6572 626f  me = None, verbo
+00064f20: 7365 203d 2046 616c 7365 2029 3a0a 2020  se = False ):.  
+00064f30: 2020 0a20 2020 2023 2320 4d61 7070 696e    .    ## Mappin
+00064f40: 670a 2020 2020 2020 2020 0a20 2020 2076  g.        .    v
+00064f50: 6f6c 5f74 6f74 616c 203d 2030 0a20 2020  ol_total = 0.   
+00064f60: 2072 735f 6368 7273 203d 205b 5d0a 2020   rs_chrs = [].  
+00064f70: 2020 666f 7220 7273 2069 6e20 7267 6e73    for rs in rgns
+00064f80: 5f6c 7374 5f6d 693a 200a 2020 2020 2020  _lst_mi: .      
+00064f90: 2020 7273 5f63 6872 732e 6170 7065 6e64    rs_chrs.append
+00064fa0: 2872 732e 7267 6e73 5b30 5d2e 6368 7229  (rs.rgns[0].chr)
+00064fb0: 0a20 2020 2020 2020 2076 6f6c 5f74 6f74  .        vol_tot
+00064fc0: 616c 202b 3d20 7273 2e67 6574 5f76 6f6c  al += rs.get_vol
+00064fd0: 756d 6528 290a 0a20 2020 2063 6872 7320  ume()..    chrs 
+00064fe0: 3d20 6368 725f 6c73 7420 2320 6c69 7374  = chr_lst # list
+00064ff0: 2873 6574 2863 6872 5f6c 7374 2b72 735f  (set(chr_lst+rs_
+00065000: 6368 7273 2929 0a20 2020 2020 2020 200a  chrs)).        .
+00065010: 2020 2020 7273 5f63 6872 7320 3d20 6e70      rs_chrs = np
+00065020: 2e61 7272 6179 2872 735f 6368 7273 290a  .array(rs_chrs).
+00065030: 2020 2020 0a20 2020 2067 645f 6c73 745f      .    gd_lst_
+00065040: 6f75 7420 3d20 5b5d 0a20 2020 2072 735f  out = [].    rs_
+00065050: 6d5f 6c73 745f 6f75 7420 3d20 5b5d 0a20  m_lst_out = []. 
+00065060: 2020 2072 735f 6e64 5f6c 7374 5f6f 7574     rs_nd_lst_out
+00065070: 203d 205b 5d0a 2020 2020 7273 5f73 7469   = [].    rs_sti
+00065080: 5f6c 7374 5f6f 7574 203d 205b 5d0a 2020  _lst_out = [].  
+00065090: 2020 6764 5f6c 7374 5f75 6e6d 6170 7065    gd_lst_unmappe
+000650a0: 6420 3d20 5b5d 0a0a 2020 2020 7374 6172  d = []..    star
+000650b0: 745f 7469 6d65 3120 3d20 7469 6d65 2e74  t_time1 = time.t
+000650c0: 696d 6528 290a 2020 2020 0a20 2020 206e  ime().    .    n
+000650d0: 675f 756e 6d61 7070 6564 203d 2030 0a20  g_unmapped = 0. 
+000650e0: 2020 206e 725f 756e 6d61 7070 6564 203d     nr_unmapped =
+000650f0: 2030 0a0a 2020 2020 746f 5f64 656c 5f67   0..    to_del_g
+00065100: 203d 205b 5d0a 2020 2020 746f 5f64 656c   = [].    to_del
+00065110: 5f72 203d 205b 5d0a 0a20 2020 2069 6620  _r = []..    if 
+00065120: 6e5f 636f 7265 7320 3d3d 2031 3a0a 2020  n_cores == 1:.  
+00065130: 2020 2020 2020 6763 6e74 203d 2030 0a0a        gcnt = 0..
+00065140: 2020 2020 2020 2020 7273 6d20 3d20 7b20          rsm = { 
+00065150: 633a 205b 5d20 666f 7220 6320 696e 2063  c: [] for c in c
+00065160: 6872 7320 7d0a 2020 2020 2020 2020 7273  hrs }.        rs
+00065170: 6e64 203d 207b 2063 3a20 5b5d 2066 6f72  nd = { c: [] for
+00065180: 2063 2069 6e20 6368 7273 207d 0a20 2020   c in chrs }.   
+00065190: 2020 2020 2072 7373 7469 203d 207b 2063       rssti = { c
+000651a0: 3a20 5b5d 2066 6f72 2063 2069 6e20 6368  : [] for c in ch
+000651b0: 7273 207d 0a20 2020 2020 2020 2066 6f72  rs }.        for
+000651c0: 206b 2c20 6320 696e 2065 6e75 6d65 7261   k, c in enumera
+000651d0: 7465 2872 735f 6368 7273 293a 0a20 2020  te(rs_chrs):.   
+000651e0: 2020 2020 2020 2020 2069 6620 6320 696e           if c in
+000651f0: 2063 6872 733a 0a20 2020 2020 2020 2020   chrs:.         
+00065200: 2020 2020 2020 2072 736d 5b63 5d2e 6170         rsm[c].ap
+00065210: 7065 6e64 2872 676e 735f 6c73 745f 6d69  pend(rgns_lst_mi
+00065220: 5b6b 5d29 0a20 2020 2020 2020 2020 2020  [k]).           
+00065230: 2020 2020 2072 736e 645b 635d 2e61 7070       rsnd[c].app
+00065240: 656e 6428 7267 6e73 5f6c 7374 5f6e 645b  end(rgns_lst_nd[
+00065250: 6b5d 290a 2020 2020 2020 2020 2020 2020  k]).            
+00065260: 2020 2020 7273 7374 695b 635d 2e61 7070      rssti[c].app
+00065270: 656e 6428 7267 6e73 5f6c 7374 5f73 7469  end(rgns_lst_sti
+00065280: 5b6b 5d29 0a20 2020 2020 2020 200a 2020  [k]).        .  
+00065290: 2020 2020 2020 6465 6c20 7267 6e73 5f6c        del rgns_l
+000652a0: 7374 5f6d 690a 2020 2020 2020 2020 6465  st_mi.        de
+000652b0: 6c20 7267 6e73 5f6c 7374 5f6e 640a 2020  l rgns_lst_nd.  
+000652c0: 2020 2020 2020 6465 6c20 7267 6e73 5f6c        del rgns_l
+000652d0: 7374 5f73 7469 0a0a 2020 2020 2020 2020  st_sti..        
+000652e0: 666f 7220 6b2c 2063 2069 6e20 656e 756d  for k, c in enum
+000652f0: 6572 6174 6528 6368 7273 293a 0a0a 2020  erate(chrs):..  
+00065300: 2020 2020 2020 2020 2020 6763 6e74 202b            gcnt +
+00065310: 3d20 6c65 6e28 6764 5f6c 7374 5f6f 665f  = len(gd_lst_of_
+00065320: 6c73 745b 6b5d 290a 2020 2020 2020 2020  lst[k]).        
+00065330: 2020 2020 6966 2076 6572 626f 7365 3a0a      if verbose:.
+00065340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065350: 7072 696e 7428 275c 724d 6170 7069 6e67  print('\rMapping
+00065360: 2025 692f 2569 2720 2520 286b 2c6c 656e   %i/%i' % (k,len
+00065370: 2863 6872 7329 292c 2065 6e64 3d27 2020  (chrs)), end='  
+00065380: 2020 272c 2066 6c75 7368 203d 2054 7275    ', flush = Tru
+00065390: 6520 290a 2020 2020 2020 2020 2020 2020  e ).            
+000653a0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+000653b0: 2067 2c20 726d 2c20 726e 642c 2072 7374   g, rm, rnd, rst
+000653c0: 692c 206e 672c 206e 722c 2074 6467 2c20  i, ng, nr, tdg, 
+000653d0: 7464 722c 2067 5f75 6d20 3d20 6d63 5f63  tdr, g_um = mc_c
+000653e0: 6f72 655f 636f 6d62 696e 655f 6765 6e65  ore_combine_gene
+000653f0: 735f 616e 645f 7267 6e73 5f70 6572 5f63  s_and_rgns_per_c
+00065400: 6872 2820 2867 645f 6c73 745f 6f66 5f6c  hr( (gd_lst_of_l
+00065410: 7374 5b6b 5d2c 2072 736d 5b63 5d2c 205c  st[k], rsm[c], \
+00065420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00065430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065460: 7273 6e64 5b63 5d2c 2072 7373 7469 5b63  rsnd[c], rssti[c
+00065470: 5d2c 2046 616c 7365 2920 290a 2020 2020  ], False) ).    
+00065480: 2020 2020 2020 2020 2320 746f 5f64 656c          # to_del
+00065490: 5f67 203d 2074 6f5f 6465 6c5f 6720 2b20  _g = to_del_g + 
+000654a0: 5b67 645f 7365 6c5f 6964 785b 6d5d 2066  [gd_sel_idx[m] f
+000654b0: 6f72 206d 2069 6e20 7464 675d 0a20 2020  or m in tdg].   
+000654c0: 2020 2020 2020 2020 2023 2074 6f5f 6465           # to_de
+000654d0: 6c5f 7220 3d20 746f 5f64 656c 5f72 202b  l_r = to_del_r +
+000654e0: 205b 7273 5f73 656c 5f69 6478 5b6d 5d20   [rs_sel_idx[m] 
+000654f0: 666f 7220 6d20 696e 2074 6472 5d0a 0a20  for m in tdr].. 
+00065500: 2020 2020 2020 2020 2020 2066 6f72 2067             for g
+00065510: 6420 696e 2067 3a20 0a20 2020 2020 2020  d in g: .       
+00065520: 2020 2020 2020 2020 2067 642e 6763 6e74           gd.gcnt
+00065530: 203d 2067 636e 740a 2020 2020 2020 2020   = gcnt.        
+00065540: 2020 2020 2020 2020 2320 6763 6e74 202b          # gcnt +
+00065550: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00065560: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00065570: 2067 645f 6c73 745f 6f75 7420 3d20 6764   gd_lst_out = gd
+00065580: 5f6c 7374 5f6f 7574 202b 2067 0a20 2020  _lst_out + g.   
+00065590: 2020 2020 2020 2020 2072 735f 6d5f 6c73           rs_m_ls
+000655a0: 745f 6f75 7420 3d20 7273 5f6d 5f6c 7374  t_out = rs_m_lst
+000655b0: 5f6f 7574 202b 2072 6d0a 2020 2020 2020  _out + rm.      
+000655c0: 2020 2020 2020 7273 5f6e 645f 6c73 745f        rs_nd_lst_
+000655d0: 6f75 7420 3d20 7273 5f6e 645f 6c73 745f  out = rs_nd_lst_
+000655e0: 6f75 7420 2b20 726e 640a 2020 2020 2020  out + rnd.      
+000655f0: 2020 2020 2020 7273 5f73 7469 5f6c 7374        rs_sti_lst
+00065600: 5f6f 7574 203d 2072 735f 7374 695f 6c73  _out = rs_sti_ls
+00065610: 745f 6f75 7420 2b20 7273 7469 0a20 2020  t_out + rsti.   
+00065620: 2020 2020 2020 2020 2067 645f 6c73 745f           gd_lst_
+00065630: 756e 6d61 7070 6564 203d 2067 645f 6c73  unmapped = gd_ls
+00065640: 745f 756e 6d61 7070 6564 202b 2067 5f75  t_unmapped + g_u
+00065650: 6d0a 0a20 2020 2020 2020 2020 2020 206e  m..            n
+00065660: 675f 756e 6d61 7070 6564 202b 3d20 6e67  g_unmapped += ng
+00065670: 0a20 2020 2020 2020 2020 2020 206e 725f  .            nr_
+00065680: 756e 6d61 7070 6564 202b 3d20 6e72 0a20  unmapped += nr. 
+00065690: 2020 200a 2020 2020 2020 2020 6465 6c20     .        del 
+000656a0: 6764 5f6c 7374 5f6f 665f 6c73 740a 2020  gd_lst_of_lst.  
+000656b0: 2020 2020 2020 0a20 2020 2065 6c73 653a        .    else:
+000656c0: 0a20 2020 2020 2020 2069 6620 7665 7262  .        if verb
+000656d0: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
+000656e0: 2070 7269 6e74 2827 5c72 4d61 7070 696e   print('\rMappin
+000656f0: 6720 2e2e 272c 2065 6e64 3d27 2020 2020  g ..', end='    
+00065700: 272c 2066 6c75 7368 203d 2054 7275 6520  ', flush = True 
+00065710: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+00065720: 2020 2020 2020 2072 736d 203d 207b 2063         rsm = { c
+00065730: 3a20 5b5d 2066 6f72 2063 2069 6e20 6368  : [] for c in ch
+00065740: 7273 207d 0a20 2020 2020 2020 2072 736e  rs }.        rsn
+00065750: 6420 3d20 7b20 633a 205b 5d20 666f 7220  d = { c: [] for 
+00065760: 6320 696e 2063 6872 7320 7d0a 2020 2020  c in chrs }.    
+00065770: 2020 2020 7273 7374 6920 3d20 7b20 633a      rssti = { c:
+00065780: 205b 5d20 666f 7220 6320 696e 2063 6872   [] for c in chr
+00065790: 7320 7d0a 2020 2020 2020 2020 666f 7220  s }.        for 
+000657a0: 6b2c 2063 2069 6e20 656e 756d 6572 6174  k, c in enumerat
+000657b0: 6528 7273 5f63 6872 7329 3a0a 2020 2020  e(rs_chrs):.    
+000657c0: 2020 2020 2020 2020 6966 2063 2069 6e20          if c in 
+000657d0: 6368 7273 3a0a 2020 2020 2020 2020 2020  chrs:.          
+000657e0: 2020 2020 2020 7273 6d5b 635d 2e61 7070        rsm[c].app
+000657f0: 656e 6428 7267 6e73 5f6c 7374 5f6d 695b  end(rgns_lst_mi[
+00065800: 6b5d 290a 2020 2020 2020 2020 2020 2020  k]).            
+00065810: 2020 2020 7273 6e64 5b63 5d2e 6170 7065      rsnd[c].appe
+00065820: 6e64 2872 676e 735f 6c73 745f 6e64 5b6b  nd(rgns_lst_nd[k
+00065830: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00065840: 2020 2072 7373 7469 5b63 5d2e 6170 7065     rssti[c].appe
+00065850: 6e64 2872 676e 735f 6c73 745f 7374 695b  nd(rgns_lst_sti[
+00065860: 6b5d 290a 2020 2020 2020 2020 0a20 2020  k]).        .   
+00065870: 2020 2020 2064 656c 2072 676e 735f 6c73       del rgns_ls
+00065880: 745f 6d69 0a20 2020 2020 2020 2064 656c  t_mi.        del
+00065890: 2072 676e 735f 6c73 745f 6e64 0a20 2020   rgns_lst_nd.   
+000658a0: 2020 2020 2064 656c 2072 676e 735f 6c73       del rgns_ls
+000658b0: 745f 7374 690a 0a20 2020 2020 2020 2067  t_sti..        g
+000658c0: 636e 7420 3d20 300a 2020 2020 2020 2020  cnt = 0.        
+000658d0: 7273 5f74 7570 6c65 203d 205b 5d0a 2020  rs_tuple = [].  
+000658e0: 2020 2020 2020 666f 7220 6b2c 2063 2069        for k, c i
+000658f0: 6e20 656e 756d 6572 6174 6528 6368 7273  n enumerate(chrs
+00065900: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00065910: 735f 7475 706c 652e 6170 7065 6e64 2820  s_tuple.append( 
+00065920: 2867 645f 6c73 745f 6f66 5f6c 7374 5b6b  (gd_lst_of_lst[k
+00065930: 5d2c 2072 736d 5b63 5d2c 2072 736e 645b  ], rsm[c], rsnd[
+00065940: 635d 2c20 7273 7374 695b 635d 2c20 7665  c], rssti[c], ve
+00065950: 7262 6f73 6529 2029 0a20 2020 2020 2020  rbose) ).       
+00065960: 2020 2020 2067 636e 7420 2b3d 206c 656e       gcnt += len
+00065970: 2867 645f 6c73 745f 6f66 5f6c 7374 5b6b  (gd_lst_of_lst[k
+00065980: 5d29 0a20 2020 2020 2020 2020 2020 200a  ]).            .
+00065990: 2020 2020 2020 2020 6465 6c20 6764 5f6c          del gd_l
+000659a0: 7374 5f6f 665f 6c73 740a 0a20 2020 2020  st_of_lst..     
+000659b0: 2020 206e 756d 5f63 6f72 6520 3d20 6d69     num_core = mi
+000659c0: 6e28 206e 5f63 6f72 6573 2c20 2863 7075  n( n_cores, (cpu
+000659d0: 5f63 6f75 6e74 2829 202d 2031 2920 290a  _count() - 1) ).
+000659e0: 2020 2020 2020 2020 706f 6f6c 203d 2050          pool = P
+000659f0: 6f6f 6c28 6e75 6d5f 636f 7265 290a 2020  ool(num_core).  
+00065a00: 2020 2020 2020 6d20 3d20 310a 2020 2020        m = 1.    
+00065a10: 2020 2020 2320 666f 7220 672c 2072 6d2c      # for g, rm,
+00065a20: 2072 6e64 2c20 7273 7469 2c20 6e67 2c20   rnd, rsti, ng, 
+00065a30: 6e72 2c20 7464 672c 2074 6472 2069 6e20  nr, tdg, tdr in 
+00065a40: 706f 6f6c 2e6d 6170 286d 635f 636f 7265  pool.map(mc_core
+00065a50: 5f63 6f6d 6269 6e65 5f67 656e 6573 5f61  _combine_genes_a
+00065a60: 6e64 5f72 676e 735f 7065 725f 6368 722c  nd_rgns_per_chr,
+00065a70: 2072 735f 7475 706c 6529 3a0a 2020 2020   rs_tuple):.    
+00065a80: 2020 2020 666f 7220 672c 2072 6d2c 2072      for g, rm, r
+00065a90: 6e64 2c20 7273 7469 2c20 6e67 2c20 6e72  nd, rsti, ng, nr
+00065aa0: 2c20 7464 672c 2074 6472 2c20 675f 756d  , tdg, tdr, g_um
+00065ab0: 2069 6e20 706f 6f6c 2e69 6d61 705f 756e   in pool.imap_un
+00065ac0: 6f72 6465 7265 6428 6d63 5f63 6f72 655f  ordered(mc_core_
+00065ad0: 636f 6d62 696e 655f 6765 6e65 735f 616e  combine_genes_an
+00065ae0: 645f 7267 6e73 5f70 6572 5f63 6872 2c20  d_rgns_per_chr, 
+00065af0: 7273 5f74 7570 6c65 293a 0a20 2020 2020  rs_tuple):.     
+00065b00: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00065b10: 2020 2020 6966 2076 6572 626f 7365 3a0a      if verbose:.
+00065b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065b30: 7072 696e 7428 275c 724d 6170 7069 6e67  print('\rMapping
+00065b40: 2025 692f 2569 2720 2520 286d 2c6c 656e   %i/%i' % (m,len
+00065b50: 2863 6872 7329 292c 2065 6e64 3d27 2020  (chrs)), end='  
+00065b60: 2020 272c 2066 6c75 7368 203d 2054 7275    ', flush = Tru
+00065b70: 6520 290a 0a20 2020 2020 2020 2020 2020  e )..           
+00065b80: 206d 202b 3d20 3120 2020 200a 2020 2020   m += 1    .    
+00065b90: 2020 2020 2020 2020 666f 7220 6764 2069          for gd i
+00065ba0: 6e20 673a 200a 2020 2020 2020 2020 2020  n g: .          
+00065bb0: 2020 2020 2020 6764 2e67 636e 7420 3d20        gd.gcnt = 
+00065bc0: 6763 6e74 0a20 2020 2020 2020 2020 2020  gcnt.           
+00065bd0: 2020 2020 2023 2067 636e 7420 2b3d 2031       # gcnt += 1
+00065be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00065bf0: 200a 2020 2020 2020 2020 2020 2020 6764   .            gd
+00065c00: 5f6c 7374 5f6f 7574 203d 2067 645f 6c73  _lst_out = gd_ls
+00065c10: 745f 6f75 7420 2b20 670a 2020 2020 2020  t_out + g.      
+00065c20: 2020 2020 2020 7273 5f6d 5f6c 7374 5f6f        rs_m_lst_o
+00065c30: 7574 203d 2072 735f 6d5f 6c73 745f 6f75  ut = rs_m_lst_ou
+00065c40: 7420 2b20 726d 0a20 2020 2020 2020 2020  t + rm.         
+00065c50: 2020 2072 735f 6e64 5f6c 7374 5f6f 7574     rs_nd_lst_out
+00065c60: 203d 2072 735f 6e64 5f6c 7374 5f6f 7574   = rs_nd_lst_out
+00065c70: 202b 2072 6e64 0a20 2020 2020 2020 2020   + rnd.         
+00065c80: 2020 2072 735f 7374 695f 6c73 745f 6f75     rs_sti_lst_ou
+00065c90: 7420 3d20 7273 5f73 7469 5f6c 7374 5f6f  t = rs_sti_lst_o
+00065ca0: 7574 202b 2072 7374 690a 2020 2020 2020  ut + rsti.      
+00065cb0: 2020 2020 2020 6764 5f6c 7374 5f75 6e6d        gd_lst_unm
+00065cc0: 6170 7065 6420 3d20 6764 5f6c 7374 5f75  apped = gd_lst_u
+00065cd0: 6e6d 6170 7065 6420 2b20 675f 756d 0a0a  nmapped + g_um..
+00065ce0: 2020 2020 2020 2020 2020 2020 6e67 5f75              ng_u
+00065cf0: 6e6d 6170 7065 6420 2b3d 206e 670a 2020  nmapped += ng.  
+00065d00: 2020 2020 2020 2020 2020 6e72 5f75 6e6d            nr_unm
+00065d10: 6170 7065 6420 2b3d 206e 720a 2020 2020  apped += nr.    
+00065d20: 0a20 2020 2020 2020 2070 6f6f 6c2e 636c  .        pool.cl
+00065d30: 6f73 6528 290a 2020 2020 2020 2020 706f  ose().        po
+00065d40: 6f6c 2e6a 6f69 6e28 290a 0a20 2020 2020  ol.join()..     
+00065d50: 2020 200a 2020 2020 656c 6170 7365 645f     .    elapsed_
+00065d60: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
+00065d70: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
+00065d80: 310a 2020 2020 6966 2076 6572 626f 7365  1.    if verbose
+00065d90: 3a20 7072 696e 7428 275c 724d 6170 7069  : print('\rMappi
+00065da0: 6e67 2025 6920 6368 7273 202e 2e2e 2064  ng %i chrs ... d
+00065db0: 6f6e 6520 2825 6929 2027 2025 2028 6c65  one (%i) ' % (le
+00065dc0: 6e28 6368 7273 292c 656c 6170 7365 645f  n(chrs),elapsed_
+00065dd0: 7469 6d65 3129 2029 0a0a 2020 2020 766f  time1) )..    vo
+00065de0: 6c5f 7365 6c20 3d20 300a 2020 2020 666f  l_sel = 0.    fo
+00065df0: 7220 7273 2069 6e20 7273 5f6d 5f6c 7374  r rs in rs_m_lst
+00065e00: 5f6f 7574 3a20 0a20 2020 2020 2020 2076  _out: .        v
+00065e10: 6f6c 5f73 656c 202b 3d20 7273 2e67 6574  ol_sel += rs.get
+00065e20: 5f76 6f6c 756d 6528 290a 2020 2020 2020  _volume().      
+00065e30: 2020 0a20 2020 2069 6620 6e67 203e 2030    .    if ng > 0
+00065e40: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00065e50: 2720 2020 2569 2067 656e 6573 2069 6e20  '   %i genes in 
+00065e60: 7468 6520 4754 462f 4746 4620 646f 206e  the GTF/GFF do n
+00065e70: 6f74 2068 6176 6520 6d61 7070 6564 2072  ot have mapped r
+00065e80: 6561 6473 2e27 2025 2028 6e67 5f75 6e6d  eads.' % (ng_unm
+00065e90: 6170 7065 6429 2029 0a20 2020 2069 6620  apped) ).    if 
+00065ea0: 6e72 203e 2030 3a0a 2020 2020 2020 2020  nr > 0:.        
+00065eb0: 7072 696e 7428 2720 2020 2569 2063 6875  print('   %i chu
+00065ec0: 6e6b 7320 6172 6520 6f75 7420 6f66 2067  nks are out of g
+00065ed0: 656e 6520 6c6f 6369 2069 6e20 4754 462f  ene loci in GTF/
+00065ee0: 4746 462e 2028 2569 2525 206f 6620 746f  GFF. (%i%% of to
+00065ef0: 7461 6c20 766f 6c75 6d65 2920 2720 2520  tal volume) ' % 
+00065f00: 286e 725f 756e 6d61 7070 6564 2c20 696e  (nr_unmapped, in
+00065f10: 7428 3130 302a 2876 6f6c 5f74 6f74 616c  t(100*(vol_total
+00065f20: 2d76 6f6c 5f73 656c 292f 766f 6c5f 746f  -vol_sel)/vol_to
+00065f30: 7461 6c29 2920 290a 2020 2020 2020 2020  tal)) ).        
+00065f40: 0a20 2020 2027 2727 0a20 2020 2069 6620  .    '''.    if 
+00065f50: 6c65 6e28 746f 5f64 656c 5f72 2920 3e20  len(to_del_r) > 
+00065f60: 303a 0a20 2020 2020 2020 2074 6f5f 6465  0:.        to_de
+00065f70: 6c5f 722e 736f 7274 2872 6576 6572 7365  l_r.sort(reverse
+00065f80: 3d54 7275 6529 0a20 2020 2020 2020 2066  =True).        f
+00065f90: 6f72 2072 6920 696e 2074 6f5f 6465 6c5f  or ri in to_del_
+00065fa0: 723a 0a20 2020 2020 2020 2020 2020 2064  r:.            d
+00065fb0: 656c 2072 676e 735f 6c73 745f 6d69 5b72  el rgns_lst_mi[r
+00065fc0: 695d 0a20 2020 2020 2020 2020 2020 2064  i].            d
+00065fd0: 656c 2072 676e 735f 6c73 745f 6e64 5b72  el rgns_lst_nd[r
+00065fe0: 695d 0a20 2020 2020 2020 2020 2020 2064  i].            d
+00065ff0: 656c 2072 676e 735f 6c73 745f 7374 695b  el rgns_lst_sti[
+00066000: 7269 5d0a 2020 2020 2020 2020 2020 2020  ri].            
+00066010: 0a20 2020 2069 6620 6c65 6e28 746f 5f64  .    if len(to_d
+00066020: 656c 5f67 2920 3e20 303a 0a20 2020 2020  el_g) > 0:.     
+00066030: 2020 2074 6f5f 6465 6c5f 672e 736f 7274     to_del_g.sort
+00066040: 2872 6576 6572 7365 3d54 7275 6529 0a20  (reverse=True). 
+00066050: 2020 2020 2020 2066 6f72 2067 6920 696e         for gi in
+00066060: 2074 6f5f 6465 6c5f 673a 0a20 2020 2020   to_del_g:.     
+00066070: 2020 2020 2020 2064 656c 2067 645f 6c73         del gd_ls
+00066080: 745b 6769 5d0a 2020 2020 2727 270a 2020  t[gi].    '''.  
+00066090: 2020 2020 2020 2020 2020 0a20 2020 2072            .    r
+000660a0: 6574 7572 6e20 6764 5f6c 7374 5f6f 7574  eturn gd_lst_out
+000660b0: 2c20 7273 5f6d 5f6c 7374 5f6f 7574 2c20  , rs_m_lst_out, 
+000660c0: 7273 5f6e 645f 6c73 745f 6f75 742c 2072  rs_nd_lst_out, r
+000660d0: 735f 7374 695f 6c73 745f 6f75 742c 2067  s_sti_lst_out, g
+000660e0: 645f 6c73 745f 756e 6d61 7070 6564 0a0a  d_lst_unmapped..
+000660f0: 0a64 6566 206d 635f 636f 7265 5f63 6f6d  .def mc_core_com
+00066100: 6269 6e65 5f67 656e 6573 5f61 6e64 5f72  bine_genes_and_r
+00066110: 676e 735f 7065 725f 6368 7228 2072 735f  gns_per_chr( rs_
+00066120: 7475 706c 6520 293a 0a0a 2020 2020 6764  tuple ):..    gd
+00066130: 5f6c 7374 2c20 7267 6e73 5f6c 7374 5f6d  _lst, rgns_lst_m
+00066140: 692c 2072 676e 735f 6c73 745f 6e64 2c20  i, rgns_lst_nd, 
+00066150: 7267 6e73 5f6c 7374 5f73 7469 2c20 7665  rgns_lst_sti, ve
+00066160: 7262 6f73 6520 3d20 7273 5f74 7570 6c65  rbose = rs_tuple
+00066170: 0a0a 2020 2020 2327 2727 0a20 2020 206e  ..    #'''.    n
+00066180: 5f67 6420 3d20 6c65 6e28 6764 5f6c 7374  _gd = len(gd_lst
+00066190: 290a 2020 2020 735f 706f 7320 3d20 6e70  ).    s_pos = np
+000661a0: 2e7a 6572 6f73 286e 5f67 6429 0a20 2020  .zeros(n_gd).   
+000661b0: 2065 5f70 6f73 203d 206e 702e 7a65 726f   e_pos = np.zero
+000661c0: 7328 6e5f 6764 290a 2020 2020 735f 6d69  s(n_gd).    s_mi
+000661d0: 6e20 3d20 6e70 2e7a 6572 6f73 286e 5f67  n = np.zeros(n_g
+000661e0: 6429 0a20 2020 2065 5f6d 6178 203d 206e  d).    e_max = n
+000661f0: 702e 7a65 726f 7328 6e5f 6764 290a 2020  p.zeros(n_gd).  
+00066200: 2020 666f 7220 6b2c 2067 6420 696e 2065    for k, gd in e
+00066210: 6e75 6d65 7261 7465 2867 645f 6c73 7429  numerate(gd_lst)
+00066220: 3a20 0a20 2020 2020 2020 2073 5f70 6f73  : .        s_pos
+00066230: 5b6b 5d20 3d20 6764 2e62 6567 696e 0a20  [k] = gd.begin. 
+00066240: 2020 2020 2020 2065 5f70 6f73 5b6b 5d20         e_pos[k] 
+00066250: 3d20 6764 2e65 6e64 0a20 2020 2020 2020  = gd.end.       
+00066260: 2069 6620 6b20 3d3d 2030 3a0a 2020 2020   if k == 0:.    
+00066270: 2020 2020 2020 2020 656d 203d 2065 5f70          em = e_p
+00066280: 6f73 5b30 5d0a 2020 2020 2020 2020 656c  os[0].        el
+00066290: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000662a0: 656d 203d 206d 6178 2865 6d2c 2065 5f70  em = max(em, e_p
+000662b0: 6f73 5b6b 5d29 0a20 2020 2020 2020 2065  os[k]).        e
+000662c0: 5f6d 6178 5b6b 5d20 3d20 656d 0a20 2020  _max[k] = em.   
+000662d0: 2020 2020 200a 2020 2020 666f 7220 6b20       .    for k 
+000662e0: 696e 2072 6576 6572 7365 6428 7261 6e67  in reversed(rang
+000662f0: 6528 6c65 6e28 735f 706f 7329 2929 3a0a  e(len(s_pos))):.
+00066300: 2020 2020 2020 2020 6966 206b 203d 3d20          if k == 
+00066310: 286c 656e 2873 5f70 6f73 292d 3129 3a0a  (len(s_pos)-1):.
+00066320: 2020 2020 2020 2020 2020 2020 736d 203d              sm =
+00066330: 2073 5f70 6f73 5b6b 5d0a 2020 2020 2020   s_pos[k].      
+00066340: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00066350: 2020 2020 736d 203d 206d 696e 2873 6d2c      sm = min(sm,
+00066360: 735f 706f 735b 6b5d 290a 2020 2020 2020  s_pos[k]).      
+00066370: 2020 735f 6d69 6e5b 6b5d 203d 2073 6d0a    s_min[k] = sm.
+00066380: 2020 2020 2020 2020 0a20 2020 2023 2323          .    ###
+00066390: 230a 2020 2020 725f 6c73 7420 3d20 7b6b  #.    r_lst = {k
+000663a0: 3a20 5b5d 2066 6f72 206b 2069 6e20 7261  : [] for k in ra
+000663b0: 6e67 6528 6c65 6e28 7267 6e73 5f6c 7374  nge(len(rgns_lst
+000663c0: 5f6d 6929 297d 0a20 2020 2067 5f6c 7374  _mi))}.    g_lst
+000663d0: 203d 207b 6b3a 205b 5d20 666f 7220 6b20   = {k: [] for k 
+000663e0: 696e 2072 616e 6765 286c 656e 2867 645f  in range(len(gd_
+000663f0: 6c73 7429 297d 0a0a 2020 2020 7374 6172  lst))}..    star
+00066400: 745f 7469 6d65 3120 3d20 7469 6d65 2e74  t_time1 = time.t
+00066410: 696d 6528 290a 2020 2020 2327 2727 0a0a  ime().    #'''..
+00066420: 2020 2020 666f 7220 6b2c 2072 7320 696e      for k, rs in
+00066430: 2065 6e75 6d65 7261 7465 2872 676e 735f   enumerate(rgns_
+00066440: 6c73 745f 6d69 293a 0a20 2020 2020 2020  lst_mi):.       
+00066450: 2073 7061 6e20 3d20 7273 2e67 6574 5f73   span = rs.get_s
+00066460: 7061 6e28 290a 2020 2020 2020 2020 7768  pan().        wh
+00066470: 203d 2077 6869 6368 2820 2828 655f 706f   = which( ((e_po
+00066480: 7320 3c20 7370 616e 2e73 7461 7274 2920  s < span.start) 
+00066490: 7c20 2873 5f70 6f73 203e 2073 7061 6e2e  | (s_pos > span.
+000664a0: 656e 6429 292c 2046 616c 7365 2029 0a20  end)), False ). 
+000664b0: 2020 2020 2020 2066 6f72 206d 2069 6e20         for m in 
+000664c0: 7768 3a0a 2020 2020 2020 2020 2020 2020  wh:.            
+000664d0: 6966 2067 645f 6c73 745b 6d5d 2e65 786f  if gd_lst[m].exo
+000664e0: 6e73 2e68 6173 5f65 7874 5f69 6e74 6572  ns.has_ext_inter
+000664f0: 7365 6374 696f 6e5f 7769 7468 2872 7329  section_with(rs)
+00066500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00066510: 2020 725f 6c73 745b 6b5d 2e61 7070 656e    r_lst[k].appen
+00066520: 6428 6d29 0a20 2020 2020 2020 2020 2020  d(m).           
+00066530: 2020 2020 2067 5f6c 7374 5b6d 5d2e 6170       g_lst[m].ap
+00066540: 7065 6e64 286b 290a 2020 2020 2020 2020  pend(k).        
+00066550: 2727 270a 2020 2020 2020 2020 666f 7220  '''.        for 
+00066560: 6d20 696e 2077 683a 0a20 2020 2020 2020  m in wh:.       
+00066570: 2020 2020 2072 5f6c 7374 5b6b 5d2e 6170       r_lst[k].ap
+00066580: 7065 6e64 286d 290a 2020 2020 2020 2020  pend(m).        
+00066590: 2020 2020 675f 6c73 745b 6d5d 2e61 7070      g_lst[m].app
+000665a0: 656e 6428 6b29 0a20 2020 2020 2020 2027  end(k).        '
+000665b0: 2727 0a20 2020 2065 6c61 7073 6564 5f74  ''.    elapsed_t
+000665c0: 696d 6531 203d 2074 696d 652e 7469 6d65  ime1 = time.time
+000665d0: 2829 202d 2073 7461 7274 5f74 696d 6531  () - start_time1
+000665e0: 0a20 2020 2023 2069 6620 7665 7262 6f73  .    # if verbos
+000665f0: 653a 2070 7269 6e74 2827 5c72 4d61 7070  e: print('\rMapp
+00066600: 696e 6720 2569 202e 2e2e 2064 6f6e 6520  ing %i ... done 
+00066610: 2825 6929 2027 2025 2028 6c65 6e28 7267  (%i) ' % (len(rg
+00066620: 6e73 5f6c 7374 5f6d 6929 2c65 6c61 7073  ns_lst_mi),elaps
+00066630: 6564 5f74 696d 6531 2920 290a 2020 2020  ed_time1) ).    
+00066640: 2327 2727 0a0a 2020 2020 2727 270a 2020  #'''..    '''.  
+00066650: 2020 6e5f 6e67 203d 2030 0a20 2020 2066    n_ng = 0.    f
+00066660: 6f72 206b 2069 6e20 675f 6c73 742e 6b65  or k in g_lst.ke
+00066670: 7973 2829 3a0a 2020 2020 2020 2020 6966  ys():.        if
+00066680: 206c 656e 2867 5f6c 7374 5b6b 5d29 203d   len(g_lst[k]) =
+00066690: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+000666a0: 206e 5f6e 6720 2b3d 2031 0a20 2020 2020   n_ng += 1.     
+000666b0: 2020 2020 2020 2070 7269 6e74 2827 3d3d         print('==
+000666c0: 3d3d 2055 6e6d 6170 7065 643a 2025 7320  == Unmapped: %s 
+000666d0: 2825 6929 2c20 2573 203d 3d3d 3d27 2025  (%i), %s ====' %
+000666e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000666f0: 2020 2028 6764 5f6c 7374 5b6b 5d2e 7464     (gd_lst[k].td
+00066700: 5f6c 7374 5b30 5d2e 6769 642c 2067 645f  _lst[0].gid, gd_
+00066710: 6c73 745b 6b5d 2e6e 7472 2c20 6764 5f6c  lst[k].ntr, gd_l
+00066720: 7374 5b6b 5d2e 7464 5f6c 7374 5b30 5d2e  st[k].td_lst[0].
+00066730: 7469 6429 2029 0a20 2020 2020 2020 2020  tid) ).         
+00066740: 2020 2067 645f 6c73 745b 6b5d 2e65 786f     gd_lst[k].exo
+00066750: 6e73 2e70 7269 6e74 5f6d 696e 696d 616c  ns.print_minimal
+00066760: 2829 2020 2020 2020 2020 0a20 2020 2069  ()        .    i
+00066770: 6620 6e5f 6e67 203e 2030 3a0a 2020 2020  f n_ng > 0:.    
+00066780: 2020 2020 7072 696e 7428 274e 756d 2075      print('Num u
+00066790: 6e6d 6170 7065 6420 6765 6e65 7320 696e  nmapped genes in
+000667a0: 2025 7320 3d20 2569 2027 2025 2028 6764   %s = %i ' % (gd
+000667b0: 5f6c 7374 5b30 5d2e 6368 722c 206e 5f6e  _lst[0].chr, n_n
+000667c0: 6729 2029 0a20 2020 200a 2020 2020 2327  g) ).    .    #'
+000667d0: 2727 0a20 2020 2027 2727 0a20 2020 206d  ''.    '''.    m
+000667e0: 203d 2030 0a0a 2020 2020 666f 7220 6b2c   = 0..    for k,
+000667f0: 2072 7320 696e 2065 6e75 6d65 7261 7465   rs in enumerate
+00066800: 2872 676e 735f 6c73 745f 6d69 293a 0a20  (rgns_lst_mi):. 
+00066810: 2020 2020 2020 2073 7061 6e20 3d20 7273         span = rs
+00066820: 2e67 6574 5f73 7061 6e28 290a 2020 2020  .get_span().    
+00066830: 2020 2020 6966 2028 6b2b 3129 203c 206c      if (k+1) < l
+00066840: 656e 2872 676e 735f 6c73 745f 6d69 293a  en(rgns_lst_mi):
+00066850: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
+00066860: 6e32 203d 2072 676e 735f 6c73 745f 6d69  n2 = rgns_lst_mi
+00066870: 5b6b 2b31 5d2e 6765 745f 7370 616e 2829  [k+1].get_span()
+00066880: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00066890: 2020 2020 2020 2020 2020 2073 7061 6e32             span2
+000668a0: 203d 2073 7061 6e0a 0a20 2020 2020 2020   = span..       
+000668b0: 206d 3220 3d20 6d0a 2020 2020 2020 2020   m2 = m.        
+000668c0: 0a20 2020 2020 2020 206d 3120 3d20 6d0a  .        m1 = m.
+000668d0: 2020 2020 2020 2020 6966 206d 3120 3c20          if m1 < 
+000668e0: 6c65 6e28 6764 5f6c 7374 293a 0a20 2020  len(gd_lst):.   
+000668f0: 2020 2020 2020 2020 2077 6869 6c65 2054           while T
+00066900: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+00066910: 2020 2020 2069 6620 655f 6d61 785b 6d31       if e_max[m1
+00066920: 5d20 3c20 7370 616e 2e73 7461 7274 3a0a  ] < span.start:.
+00066930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066940: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00066950: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00066960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066970: 2020 2020 6966 2067 645f 6c73 745b 6d31      if gd_lst[m1
+00066980: 5d2e 6578 6f6e 732e 6861 735f 6578 745f  ].exons.has_ext_
+00066990: 696e 7465 7273 6563 7469 6f6e 5f77 6974  intersection_wit
+000669a0: 6828 7273 293a 0a20 2020 2020 2020 2020  h(rs):.         
+000669b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000669c0: 5f6c 7374 5b6b 5d2e 6170 7065 6e64 286d  _lst[k].append(m
+000669d0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+000669e0: 2020 2020 2020 2020 2020 2067 5f6c 7374             g_lst
+000669f0: 5b6d 315d 2e61 7070 656e 6428 6b29 0a20  [m1].append(k). 
+00066a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066a10: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00066a20: 2020 2020 2020 2020 6966 2065 5f6d 6178          if e_max
+00066a30: 5b6d 315d 203c 2073 7061 6e32 2e73 7461  [m1] < span2.sta
+00066a40: 7274 3a20 6d32 203d 206d 310a 2020 2020  rt: m2 = m1.    
+00066a50: 2020 2020 2020 2020 2020 2020 6d31 202d              m1 -
+00066a60: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00066a70: 2020 2020 6966 206d 3120 3c20 303a 2062      if m1 < 0: b
+00066a80: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00066a90: 200a 2020 2020 2020 2020 6966 2028 6d2b   .        if (m+
+00066aa0: 3129 203c 206c 656e 2867 645f 6c73 7429  1) < len(gd_lst)
+00066ab0: 3a0a 2020 2020 2020 2020 2020 2020 6d31  :.            m1
+00066ac0: 203d 206d 2b31 0a20 2020 2020 2020 2020   = m+1.         
+00066ad0: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
+00066ae0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00066af0: 6620 735f 6d69 6e5b 6d31 5d20 3e20 7370  f s_min[m1] > sp
+00066b00: 616e 2e65 6e64 3a0a 2020 2020 2020 2020  an.end:.        
+00066b10: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00066b20: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00066b30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00066b40: 2020 2020 2020 2020 2020 2020 6966 2067              if g
+00066b50: 645f 6c73 745b 6d31 5d2e 6578 6f6e 732e  d_lst[m1].exons.
+00066b60: 6861 735f 6578 745f 696e 7465 7273 6563  has_ext_intersec
+00066b70: 7469 6f6e 5f77 6974 6828 7273 293a 0a20  tion_with(rs):. 
+00066b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066b90: 2020 2020 2020 2072 5f6c 7374 5b6b 5d2e         r_lst[k].
+00066ba0: 6170 7065 6e64 286d 3129 0a20 2020 2020  append(m1).     
+00066bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066bc0: 2020 2067 5f6c 7374 5b6d 315d 2e61 7070     g_lst[m1].app
+00066bd0: 656e 6428 6b29 0a0a 2020 2020 2020 2020  end(k)..        
+00066be0: 2020 2020 2020 2020 6966 2065 5f6d 6178          if e_max
+00066bf0: 5b6d 315d 203c 2073 7061 6e32 2e73 7461  [m1] < span2.sta
+00066c00: 7274 3a20 6d32 203d 206d 310a 2020 2020  rt: m2 = m1.    
+00066c10: 2020 2020 2020 2020 2020 2020 6d31 202b              m1 +
+00066c20: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00066c30: 2020 2020 6966 206d 3120 3e3d 206c 656e      if m1 >= len
+00066c40: 2867 645f 6c73 7429 3a20 6272 6561 6b0a  (gd_lst): break.
+00066c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066c60: 0a20 2020 2020 2020 206d 203d 206d 3220  .        m = m2 
+00066c70: 2b20 310a 2020 2020 2020 2020 0a20 2020  + 1.        .   
+00066c80: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
+00066c90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00066ca0: 6b25 3130 3020 3d3d 2030 3a0a 2020 2020  k%100 == 0:.    
+00066cb0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00066cc0: 7428 275c 724d 6170 7069 6e67 2025 692f  t('\rMapping %i/
+00066cd0: 2569 2720 2520 286b 2c6c 656e 2872 676e  %i' % (k,len(rgn
+00066ce0: 735f 6c73 745f 6d69 2929 2c20 656e 643d  s_lst_mi)), end=
+00066cf0: 2720 2020 2027 2c20 666c 7573 6820 3d20  '    ', flush = 
+00066d00: 5472 7565 2029 0a20 2020 2020 2020 2020  True ).         
+00066d10: 2020 2020 2020 200a 2020 2020 656c 6170         .    elap
+00066d20: 7365 645f 7469 6d65 3120 3d20 7469 6d65  sed_time1 = time
+00066d30: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
+00066d40: 7469 6d65 310a 2020 2020 2320 6966 2076  time1.    # if v
+00066d50: 6572 626f 7365 3a20 7072 696e 7428 275c  erbose: print('\
+00066d60: 724d 6170 7069 6e67 2025 6920 2e2e 2e20  rMapping %i ... 
+00066d70: 646f 6e65 2028 2569 2920 2720 2520 286c  done (%i) ' % (l
+00066d80: 656e 2872 676e 735f 6c73 745f 6d69 292c  en(rgns_lst_mi),
+00066d90: 656c 6170 7365 645f 7469 6d65 3129 2029  elapsed_time1) )
+00066da0: 0a20 2020 2023 2727 270a 2020 2020 0a20  .    #'''.    . 
+00066db0: 2020 2062 7072 203d 206e 702e 6f6e 6573     bpr = np.ones
+00066dc0: 286c 656e 2872 676e 735f 6c73 745f 6d69  (len(rgns_lst_mi
+00066dd0: 2929 0a20 2020 2062 7067 203d 206e 702e  )).    bpg = np.
+00066de0: 6f6e 6573 286c 656e 2867 645f 6c73 7429  ones(len(gd_lst)
+00066df0: 290a 0a20 2020 2072 675f 6c73 7420 3d20  )..    rg_lst = 
+00066e00: 5b5d 0a20 2020 2066 6f72 206b 2069 6e20  [].    for k in 
+00066e10: 725f 6c73 742e 6b65 7973 2829 3a0a 2020  r_lst.keys():.  
+00066e20: 2020 2020 2020 6769 7320 3d20 725f 6c73        gis = r_ls
+00066e30: 745b 6b5d 0a20 2020 2020 2020 2069 6620  t[k].        if 
+00066e40: 6270 725b 6b5d 203e 2030 3a0a 2020 2020  bpr[k] > 0:.    
+00066e50: 2020 2020 2020 2020 7269 203d 205b 6b5d          ri = [k]
+00066e60: 0a20 2020 2020 2020 2020 2020 2067 6974  .            git
+00066e70: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00066e80: 2020 7768 696c 6520 5472 7565 3a0a 2020    while True:.  
+00066e90: 2020 2020 2020 2020 2020 2020 2020 6769                gi
+00066ea0: 7420 3d20 7365 7428 290a 2020 2020 2020  t = set().      
+00066eb0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+00066ec0: 696e 2072 693a 0a20 2020 2020 2020 2020  in ri:.         
+00066ed0: 2020 2020 2020 2020 2020 2069 6620 6270             if bp
+00066ee0: 725b 695d 203e 2030 3a0a 2020 2020 2020  r[i] > 0:.      
+00066ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066f00: 2020 6769 7420 3d20 6769 742e 756e 696f    git = git.unio
+00066f10: 6e28 725f 6c73 745b 695d 290a 2020 2020  n(r_lst[i]).    
+00066f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066f30: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00066f40: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00066f50: 696e 7428 2745 5252 4f52 2025 692c 2569  int('ERROR %i,%i
+00066f60: 2720 2520 286b 2c69 2929 0a20 2020 2020  ' % (k,i)).     
+00066f70: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00066f80: 6e28 6769 7429 203d 3d20 303a 0a20 2020  n(git) == 0:.   
+00066f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066fa0: 2023 2072 675f 6c73 742e 6170 7065 6e64   # rg_lst.append
+00066fb0: 2828 7269 742c 5b5d 2929 0a20 2020 2020  ((rit,[])).     
+00066fc0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00066fd0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00066fe0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00066ff0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00067000: 6974 203d 2073 6574 2829 0a20 2020 2020  it = set().     
+00067010: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00067020: 6f72 206a 2069 6e20 6769 743a 0a20 2020  or j in git:.   
+00067030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067040: 2020 2020 2069 6620 6270 675b 6a5d 203e       if bpg[j] >
+00067050: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00067060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067070: 7269 7420 3d20 7269 742e 756e 696f 6e28  rit = rit.union(
+00067080: 675f 6c73 745b 6a5d 290a 2020 2020 2020  g_lst[j]).      
 00067090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000670a0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-000670b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000670c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000670d0: 2020 2020 7269 7420 3d20 7365 7428 290a      rit = set().
-000670e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000670f0: 2020 2020 666f 7220 6a20 696e 2067 6974      for j in git
-00067100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00067110: 2020 2020 2020 2020 2020 6966 2062 7067            if bpg
-00067120: 5b6a 5d20 3e20 303a 0a20 2020 2020 2020  [j] > 0:.       
-00067130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067140: 2020 2020 2072 6974 203d 2072 6974 2e75       rit = rit.u
-00067150: 6e69 6f6e 2867 5f6c 7374 5b6a 5d29 0a20  nion(g_lst[j]). 
-00067160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067170: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00067180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067190: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000671a0: 4552 524f 5220 2569 2c25 6927 2025 2028  ERROR %i,%i' % (
-000671b0: 6b2c 6a29 290a 0a20 2020 2020 2020 2020  k,j))..         
-000671c0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-000671d0: 6e28 7269 7429 203d 3d20 6c65 6e28 7269  n(rit) == len(ri
-000671e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000671f0: 2020 2020 2020 2020 2020 2072 675f 6c73             rg_ls
-00067200: 742e 6170 7065 6e64 2828 7269 742c 6769  t.append((rit,gi
-00067210: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-00067220: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00067230: 6920 696e 2072 6974 3a20 6270 725b 695d  i in rit: bpr[i]
-00067240: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00067250: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00067260: 2069 2069 6e20 6769 743a 2062 7067 5b69   i in git: bpg[i
-00067270: 5d20 3d20 300a 2020 2020 2020 2020 2020  ] = 0.          
-00067280: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00067290: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-000672a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000672b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000672c0: 2020 2020 2020 7269 203d 2072 6974 0a20        ri = rit. 
-000672d0: 2020 2020 2020 0a20 2020 206d 6170 5f72        .    map_r
-000672e0: 3267 203d 205b 5d20 2320 6e70 2e66 756c  2g = [] # np.ful
-000672f0: 6c28 6c65 6e28 7267 5f6c 7374 292c 202d  l(len(rg_lst), -
-00067300: 3129 0a20 2020 2074 6f5f 6465 6c5f 7220  1).    to_del_r 
-00067310: 3d20 5b5d 0a20 2020 2074 6f5f 6465 6c5f  = [].    to_del_
-00067320: 6720 3d20 5b5d 0a20 2020 2066 6f72 2072  g = [].    for r
-00067330: 6720 696e 2072 675f 6c73 743a 0a20 2020  g in rg_lst:.   
-00067340: 2020 2020 2072 6973 203d 206c 6973 7428       ris = list(
-00067350: 7267 5b30 5d29 0a20 2020 2020 2020 2074  rg[0]).        t
-00067360: 6774 203d 2072 6973 5b30 5d0a 2020 2020  gt = ris[0].    
-00067370: 2020 2020 666f 7220 7269 2069 6e20 7269      for ri in ri
-00067380: 735b 313a 5d3a 0a20 2020 2020 2020 2020  s[1:]:.         
-00067390: 2020 2072 676e 735f 6c73 745f 6d69 5b74     rgns_lst_mi[t
-000673a0: 6774 5d2e 6d65 7267 6528 7267 6e73 5f6c  gt].merge(rgns_l
-000673b0: 7374 5f6d 695b 7269 5d29 0a20 2020 2020  st_mi[ri]).     
-000673c0: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
-000673d0: 6e64 5b74 6774 5d2e 6d65 7267 6528 7267  nd[tgt].merge(rg
-000673e0: 6e73 5f6c 7374 5f6e 645b 7269 5d29 0a20  ns_lst_nd[ri]). 
-000673f0: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
-00067400: 6c73 745f 7374 695b 7467 745d 2e6d 6572  lst_sti[tgt].mer
-00067410: 6765 2872 676e 735f 6c73 745f 7374 695b  ge(rgns_lst_sti[
-00067420: 7269 5d29 0a20 2020 2020 2020 2020 2020  ri]).           
-00067430: 2074 6f5f 6465 6c5f 722e 6170 7065 6e64   to_del_r.append
-00067440: 2872 6929 0a20 2020 2020 2020 2020 2020  (ri).           
-00067450: 200a 2020 2020 2020 2020 7269 203d 2074   .        ri = t
-00067460: 6774 0a20 2020 2020 2020 2067 6973 203d  gt.        gis =
-00067470: 206c 6973 7428 7267 5b31 5d29 0a20 2020   list(rg[1]).   
-00067480: 2020 2020 2074 6774 203d 2067 6973 5b30       tgt = gis[0
-00067490: 5d0a 2020 2020 2020 2020 666f 7220 6769  ].        for gi
-000674a0: 2069 6e20 6769 735b 313a 5d3a 0a20 2020   in gis[1:]:.   
-000674b0: 2020 2020 2020 2020 2067 645f 6c73 745b           gd_lst[
-000674c0: 7467 745d 2e6d 6572 6765 2867 645f 6c73  tgt].merge(gd_ls
-000674d0: 745b 6769 5d29 0a20 2020 2020 2020 2020  t[gi]).         
-000674e0: 2020 2074 6f5f 6465 6c5f 672e 6170 7065     to_del_g.appe
-000674f0: 6e64 2867 6929 0a20 2020 2020 2020 2020  nd(gi).         
-00067500: 2020 200a 2020 2020 2020 2020 6764 5f6c     .        gd_l
-00067510: 7374 5b74 6774 5d2e 6765 745f 7370 616e  st[tgt].get_span
-00067520: 2829 0a20 2020 2020 2020 206d 6170 5f72  ().        map_r
-00067530: 3267 2e61 7070 656e 6428 2872 692c 2074  2g.append((ri, t
-00067540: 6774 2929 0a20 2020 2020 2020 200a 2020  gt)).        .  
-00067550: 2020 7267 6e73 5f6c 7374 5f6d 695f 6f75    rgns_lst_mi_ou
-00067560: 7420 3d20 5b5d 0a20 2020 2072 676e 735f  t = [].    rgns_
-00067570: 6c73 745f 6e64 5f6f 7574 203d 205b 5d20  lst_nd_out = [] 
-00067580: 0a20 2020 2072 676e 735f 6c73 745f 7374  .    rgns_lst_st
-00067590: 695f 6f75 7420 3d20 5b5d 0a20 2020 2067  i_out = [].    g
-000675a0: 645f 6c73 745f 6f75 7420 3d20 5b5d 0a20  d_lst_out = []. 
-000675b0: 2020 200a 2020 2020 666f 7220 7269 2c20     .    for ri, 
-000675c0: 6769 2069 6e20 6d61 705f 7232 673a 0a20  gi in map_r2g:. 
-000675d0: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
-000675e0: 6d69 5f6f 7574 2e61 7070 656e 6428 7267  mi_out.append(rg
-000675f0: 6e73 5f6c 7374 5f6d 695b 7269 5d29 0a20  ns_lst_mi[ri]). 
-00067600: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
-00067610: 6e64 5f6f 7574 2e61 7070 656e 6428 7267  nd_out.append(rg
-00067620: 6e73 5f6c 7374 5f6e 645b 7269 5d29 200a  ns_lst_nd[ri]) .
-00067630: 2020 2020 2020 2020 7267 6e73 5f6c 7374          rgns_lst
-00067640: 5f73 7469 5f6f 7574 2e61 7070 656e 6428  _sti_out.append(
-00067650: 7267 6e73 5f6c 7374 5f73 7469 5b72 695d  rgns_lst_sti[ri]
-00067660: 290a 2020 2020 2020 2020 6764 5f6c 7374  ).        gd_lst
-00067670: 5f6f 7574 2e61 7070 656e 6428 6764 5f6c  _out.append(gd_l
-00067680: 7374 5b67 695d 290a 2020 2020 2020 2020  st[gi]).        
-00067690: 0a20 2020 206e 6720 3d20 6e70 2e73 756d  .    ng = np.sum
-000676a0: 2862 7067 203e 2030 290a 2020 2020 6e72  (bpg > 0).    nr
-000676b0: 203d 206e 702e 7375 6d28 6270 7220 3e20   = np.sum(bpr > 
-000676c0: 3029 0a0a 2020 2020 7768 203d 2077 6869  0)..    wh = whi
-000676d0: 6368 2862 7067 203e 2030 290a 2020 2020  ch(bpg > 0).    
-000676e0: 6966 206c 656e 2877 6829 203e 2030 3a0a  if len(wh) > 0:.
-000676f0: 2020 2020 2020 2020 6764 5f6c 7374 5f75          gd_lst_u
-00067700: 6e6d 6170 7065 6420 3d20 5b67 645f 6c73  nmapped = [gd_ls
-00067710: 745b 775d 2066 6f72 2077 2069 6e20 7768  t[w] for w in wh
-00067720: 5d0a 2020 2020 656c 7365 3a0a 2020 2020  ].    else:.    
-00067730: 2020 2020 6764 5f6c 7374 5f75 6e6d 6170      gd_lst_unmap
-00067740: 7065 6420 3d20 5b5d 0a20 2020 200a 2020  ped = [].    .  
-00067750: 2020 2727 270a 2020 2020 7768 203d 2077    '''.    wh = w
-00067760: 6869 6368 2862 7072 203e 2030 290a 2020  hich(bpr > 0).  
-00067770: 2020 7267 6e73 5f6c 7374 5f6d 695f 6f75    rgns_lst_mi_ou
-00067780: 7420 3d20 7267 6e73 5f6c 7374 5f6d 695f  t = rgns_lst_mi_
-00067790: 6f75 7420 2b20 5b72 676e 735f 6c73 745f  out + [rgns_lst_
-000677a0: 6d69 5b77 5d20 666f 7220 7720 696e 2077  mi[w] for w in w
-000677b0: 685d 0a20 2020 2072 676e 735f 6c73 745f  h].    rgns_lst_
-000677c0: 6e64 5f6f 7574 203d 2072 676e 735f 6c73  nd_out = rgns_ls
-000677d0: 745f 6e64 5f6f 7574 202b 205b 7267 6e73  t_nd_out + [rgns
-000677e0: 5f6c 7374 5f6e 645b 775d 2066 6f72 2077  _lst_nd[w] for w
-000677f0: 2069 6e20 7768 5d0a 2020 2020 7267 6e73   in wh].    rgns
-00067800: 5f6c 7374 5f73 7469 5f6f 7574 203d 2072  _lst_sti_out = r
-00067810: 676e 735f 6c73 745f 7374 695f 6f75 7420  gns_lst_sti_out 
-00067820: 2b20 5b72 676e 735f 6c73 745f 7374 695b  + [rgns_lst_sti[
-00067830: 775d 2066 6f72 2077 2069 6e20 7768 5d0a  w] for w in wh].
-00067840: 2020 2020 6764 5f6c 7374 5f6f 7574 203d      gd_lst_out =
-00067850: 2067 645f 6c73 745f 6f75 7420 2b20 5b4e   gd_lst_out + [N
-00067860: 6f6e 6520 666f 7220 7720 696e 2077 685d  one for w in wh]
-00067870: 0a20 2020 2023 2727 270a 2020 2020 0a20  .    #'''.    . 
-00067880: 2020 2074 6f5f 6465 6c5f 7220 3d20 746f     to_del_r = to
-00067890: 5f64 656c 5f72 202b 2077 6869 6368 2862  _del_r + which(b
-000678a0: 7072 203e 2030 290a 2020 2020 746f 5f64  pr > 0).    to_d
-000678b0: 656c 5f67 203d 2074 6f5f 6465 6c5f 6720  el_g = to_del_g 
-000678c0: 2b20 7768 6963 6828 6270 6720 3e20 3029  + which(bpg > 0)
-000678d0: 0a20 2020 2027 2727 0a20 2020 2069 6620  .    '''.    if 
-000678e0: 6c65 6e28 746f 5f64 656c 5f72 2920 3e20  len(to_del_r) > 
-000678f0: 303a 0a20 2020 2020 2020 2074 6f5f 6465  0:.        to_de
-00067900: 6c5f 722e 736f 7274 2872 6576 6572 7365  l_r.sort(reverse
-00067910: 3d54 7275 6529 0a20 2020 2020 2020 2066  =True).        f
-00067920: 6f72 2072 6920 696e 2074 6f5f 6465 6c5f  or ri in to_del_
-00067930: 723a 0a20 2020 2020 2020 2020 2020 2064  r:.            d
-00067940: 656c 2072 676e 735f 6c73 745f 6d69 5b72  el rgns_lst_mi[r
-00067950: 695d 0a20 2020 2020 2020 2020 2020 2064  i].            d
-00067960: 656c 2072 676e 735f 6c73 745f 6e64 5b72  el rgns_lst_nd[r
-00067970: 695d 0a20 2020 2020 2020 2020 2020 2064  i].            d
-00067980: 656c 2072 676e 735f 6c73 745f 7374 695b  el rgns_lst_sti[
-00067990: 7269 5d0a 2020 2020 2020 2020 2020 2020  ri].            
-000679a0: 0a20 2020 2069 6620 6c65 6e28 746f 5f64  .    if len(to_d
-000679b0: 656c 5f67 2920 3e20 303a 0a20 2020 2020  el_g) > 0:.     
-000679c0: 2020 2074 6f5f 6465 6c5f 672e 736f 7274     to_del_g.sort
-000679d0: 2872 6576 6572 7365 3d54 7275 6529 0a20  (reverse=True). 
-000679e0: 2020 2020 2020 2066 6f72 2067 6920 696e         for gi in
-000679f0: 2074 6f5f 6465 6c5f 673a 0a20 2020 2020   to_del_g:.     
-00067a00: 2020 2020 2020 2064 656c 2067 645f 6c73         del gd_ls
-00067a10: 745b 6769 5d0a 2020 2020 2327 2727 2020  t[gi].    #'''  
-00067a20: 2020 2020 2020 0a20 2020 2064 656c 2072        .    del r
-00067a30: 5f6c 7374 0a20 2020 2064 656c 2067 5f6c  _lst.    del g_l
-00067a40: 7374 0a20 2020 2064 656c 2072 675f 6c73  st.    del rg_ls
-00067a50: 740a 2020 2020 0a20 2020 2066 6f72 2072  t.    .    for r
-00067a60: 2069 6e20 7267 6e73 5f6c 7374 5f6d 695f   in rgns_lst_mi_
-00067a70: 6f75 743a 2072 2e73 6574 5f63 7667 2829  out: r.set_cvg()
-00067a80: 0a20 2020 2066 6f72 2072 2069 6e20 7267  .    for r in rg
-00067a90: 6e73 5f6c 7374 5f6e 645f 6f75 743a 2072  ns_lst_nd_out: r
-00067aa0: 2e73 6574 5f63 7667 2829 0a20 2020 2066  .set_cvg().    f
-00067ab0: 6f72 2072 2069 6e20 7267 6e73 5f6c 7374  or r in rgns_lst
-00067ac0: 5f73 7469 5f6f 7574 3a20 722e 7365 745f  _sti_out: r.set_
-00067ad0: 6376 6728 290a 2020 2020 2020 2020 2020  cvg().          
-00067ae0: 2020 2020 2020 2020 2020 0a20 2020 2072            .    r
-00067af0: 6574 7572 6e20 6764 5f6c 7374 5f6f 7574  eturn gd_lst_out
-00067b00: 2c20 7267 6e73 5f6c 7374 5f6d 695f 6f75  , rgns_lst_mi_ou
-00067b10: 742c 2072 676e 735f 6c73 745f 6e64 5f6f  t, rgns_lst_nd_o
-00067b20: 7574 2c20 7267 6e73 5f6c 7374 5f73 7469  ut, rgns_lst_sti
-00067b30: 5f6f 7574 2c20 6e67 2c20 6e72 2c20 746f  _out, ng, nr, to
-00067b40: 5f64 656c 5f67 2c20 746f 5f64 656c 5f72  _del_g, to_del_r
-00067b50: 2c20 6764 5f6c 7374 5f75 6e6d 6170 7065  , gd_lst_unmappe
-00067b60: 640a 2327 2727 0a20 2020 200a 0a64 6566  d.#'''.    ..def
-00067b70: 2063 6f6d 6269 6e65 5f67 656e 6573 5f61   combine_genes_a
-00067b80: 6e64 5f72 676e 735f 7065 725f 6368 7228  nd_rgns_per_chr(
-00067b90: 2067 645f 6c73 742c 2072 676e 735f 6c73   gd_lst, rgns_ls
-00067ba0: 745f 6d69 2c20 7267 6e73 5f6c 7374 5f6e  t_mi, rgns_lst_n
-00067bb0: 642c 2072 676e 735f 6c73 745f 7374 692c  d, rgns_lst_sti,
-00067bc0: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
-00067bd0: 2029 3a0a 0a20 2020 2023 2727 270a 2020   ):..    #'''.  
-00067be0: 2020 6e5f 6764 203d 206c 656e 2867 645f    n_gd = len(gd_
-00067bf0: 6c73 7429 0a20 2020 2073 5f70 6f73 203d  lst).    s_pos =
-00067c00: 206e 702e 7a65 726f 7328 6e5f 6764 290a   np.zeros(n_gd).
-00067c10: 2020 2020 655f 706f 7320 3d20 6e70 2e7a      e_pos = np.z
-00067c20: 6572 6f73 286e 5f67 6429 0a20 2020 2073  eros(n_gd).    s
-00067c30: 5f6d 696e 203d 206e 702e 7a65 726f 7328  _min = np.zeros(
-00067c40: 6e5f 6764 290a 2020 2020 655f 6d61 7820  n_gd).    e_max 
-00067c50: 3d20 6e70 2e7a 6572 6f73 286e 5f67 6429  = np.zeros(n_gd)
-00067c60: 0a20 2020 2066 6f72 206b 2c20 6764 2069  .    for k, gd i
-00067c70: 6e20 656e 756d 6572 6174 6528 6764 5f6c  n enumerate(gd_l
-00067c80: 7374 293a 200a 2020 2020 2020 2020 735f  st): .        s_
-00067c90: 706f 735b 6b5d 203d 2067 642e 6265 6769  pos[k] = gd.begi
-00067ca0: 6e0a 2020 2020 2020 2020 655f 706f 735b  n.        e_pos[
-00067cb0: 6b5d 203d 2067 642e 656e 640a 2020 2020  k] = gd.end.    
-00067cc0: 2020 2020 6966 206b 203d 3d20 303a 0a20      if k == 0:. 
-00067cd0: 2020 2020 2020 2020 2020 2065 6d20 3d20             em = 
-00067ce0: 655f 706f 735b 305d 0a20 2020 2020 2020  e_pos[0].       
-00067cf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00067d00: 2020 2065 6d20 3d20 6d61 7828 656d 2c20     em = max(em, 
-00067d10: 655f 706f 735b 6b5d 290a 2020 2020 2020  e_pos[k]).      
-00067d20: 2020 655f 6d61 785b 6b5d 203d 2065 6d0a    e_max[k] = em.
-00067d30: 2020 2020 2020 2020 0a20 2020 2066 6f72          .    for
-00067d40: 206b 2069 6e20 7265 7665 7273 6564 2872   k in reversed(r
-00067d50: 616e 6765 286c 656e 2873 5f70 6f73 2929  ange(len(s_pos))
-00067d60: 293a 0a20 2020 2020 2020 2069 6620 6b20  ):.        if k 
-00067d70: 3d3d 2028 6c65 6e28 735f 706f 7329 2d31  == (len(s_pos)-1
-00067d80: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00067d90: 6d20 3d20 735f 706f 735b 6b5d 0a20 2020  m = s_pos[k].   
-00067da0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00067db0: 2020 2020 2020 2073 6d20 3d20 6d69 6e28         sm = min(
-00067dc0: 736d 2c73 5f70 6f73 5b6b 5d29 0a20 2020  sm,s_pos[k]).   
-00067dd0: 2020 2020 2073 5f6d 696e 5b6b 5d20 3d20       s_min[k] = 
-00067de0: 736d 0a20 2020 2020 2020 200a 2020 2020  sm.        .    
-00067df0: 2323 2323 0a20 2020 2072 5f6c 7374 203d  ####.    r_lst =
-00067e00: 207b 6b3a 205b 5d20 666f 7220 6b20 696e   {k: [] for k in
-00067e10: 2072 616e 6765 286c 656e 2872 676e 735f   range(len(rgns_
-00067e20: 6c73 745f 6d69 2929 7d0a 2020 2020 675f  lst_mi))}.    g_
-00067e30: 6c73 7420 3d20 7b6b 3a20 5b5d 2066 6f72  lst = {k: [] for
-00067e40: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
-00067e50: 6764 5f6c 7374 2929 7d0a 0a20 2020 2073  gd_lst))}..    s
-00067e60: 7461 7274 5f74 696d 6531 203d 2074 696d  tart_time1 = tim
-00067e70: 652e 7469 6d65 2829 0a20 2020 2023 2727  e.time().    #''
-00067e80: 270a 0a20 2020 2066 6f72 206b 2c20 7273  '..    for k, rs
-00067e90: 2069 6e20 656e 756d 6572 6174 6528 7267   in enumerate(rg
-00067ea0: 6e73 5f6c 7374 5f6d 6929 3a0a 2020 2020  ns_lst_mi):.    
-00067eb0: 2020 2020 7370 616e 203d 2072 732e 6765      span = rs.ge
-00067ec0: 745f 7370 616e 2829 0a20 2020 2020 2020  t_span().       
-00067ed0: 2077 6820 3d20 7768 6963 6828 2028 2865   wh = which( ((e
-00067ee0: 5f70 6f73 203c 2073 7061 6e2e 7374 6172  _pos < span.star
-00067ef0: 7429 207c 2028 735f 706f 7320 3e20 7370  t) | (s_pos > sp
-00067f00: 616e 2e65 6e64 2929 2c20 4661 6c73 6520  an.end)), False 
-00067f10: 290a 2020 2020 2020 2020 666f 7220 6d20  ).        for m 
-00067f20: 696e 2077 683a 0a20 2020 2020 2020 2020  in wh:.         
-00067f30: 2020 2069 6620 6764 5f6c 7374 5b6d 5d2e     if gd_lst[m].
-00067f40: 6578 6f6e 732e 6861 735f 6578 745f 696e  exons.has_ext_in
-00067f50: 7465 7273 6563 7469 6f6e 5f77 6974 6828  tersection_with(
-00067f60: 7273 293a 0a20 2020 2020 2020 2020 2020  rs):.           
-00067f70: 2020 2020 2072 5f6c 7374 5b6b 5d2e 6170       r_lst[k].ap
-00067f80: 7065 6e64 286d 290a 2020 2020 2020 2020  pend(m).        
-00067f90: 2020 2020 2020 2020 675f 6c73 745b 6d5d          g_lst[m]
-00067fa0: 2e61 7070 656e 6428 6b29 0a0a 2020 2020  .append(k)..    
-00067fb0: 656c 6170 7365 645f 7469 6d65 3120 3d20  elapsed_time1 = 
-00067fc0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00067fd0: 6172 745f 7469 6d65 310a 2020 2020 2320  art_time1.    # 
-00067fe0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-00067ff0: 7428 275c 724d 6170 7069 6e67 2025 6920  t('\rMapping %i 
-00068000: 2e2e 2e20 646f 6e65 2028 2569 2920 2720  ... done (%i) ' 
-00068010: 2520 286c 656e 2872 676e 735f 6c73 745f  % (len(rgns_lst_
-00068020: 6d69 292c 656c 6170 7365 645f 7469 6d65  mi),elapsed_time
-00068030: 3129 2029 0a20 2020 2023 2727 270a 2020  1) ).    #'''.  
-00068040: 2020 0a20 2020 2027 2727 0a20 2020 206d    .    '''.    m
-00068050: 203d 2030 0a0a 2020 2020 666f 7220 6b2c   = 0..    for k,
-00068060: 2072 7320 696e 2065 6e75 6d65 7261 7465   rs in enumerate
-00068070: 2872 676e 735f 6c73 745f 6d69 293a 0a20  (rgns_lst_mi):. 
-00068080: 2020 2020 2020 2073 7061 6e20 3d20 7273         span = rs
-00068090: 2e67 6574 5f73 7061 6e28 290a 2020 2020  .get_span().    
-000680a0: 2020 2020 6966 2028 6b2b 3129 203c 206c      if (k+1) < l
-000680b0: 656e 2872 676e 735f 6c73 745f 6d69 293a  en(rgns_lst_mi):
-000680c0: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
-000680d0: 6e32 203d 2072 676e 735f 6c73 745f 6d69  n2 = rgns_lst_mi
-000680e0: 5b6b 2b31 5d2e 6765 745f 7370 616e 2829  [k+1].get_span()
-000680f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00068100: 2020 2020 2020 2020 2020 2073 7061 6e32             span2
-00068110: 203d 2073 7061 6e0a 0a20 2020 2020 2020   = span..       
-00068120: 206d 3220 3d20 6d0a 2020 2020 2020 2020   m2 = m.        
-00068130: 0a20 2020 2020 2020 206d 3120 3d20 6d0a  .        m1 = m.
-00068140: 2020 2020 2020 2020 6966 206d 3120 3c20          if m1 < 
-00068150: 6c65 6e28 6764 5f6c 7374 293a 0a20 2020  len(gd_lst):.   
-00068160: 2020 2020 2020 2020 2077 6869 6c65 2054           while T
-00068170: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
-00068180: 2020 2020 2069 6620 655f 6d61 785b 6d31       if e_max[m1
-00068190: 5d20 3c20 7370 616e 2e73 7461 7274 3a0a  ] < span.start:.
+000670a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000670b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000670c0: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
+000670d0: 2025 692c 2569 2720 2520 286b 2c6a 2929   %i,%i' % (k,j))
+000670e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000670f0: 2020 2020 2020 6966 206c 656e 2872 6974        if len(rit
+00067100: 2920 3d3d 206c 656e 2872 6929 3a0a 2020  ) == len(ri):.  
+00067110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067120: 2020 2020 2020 7267 5f6c 7374 2e61 7070        rg_lst.app
+00067130: 656e 6428 2872 6974 2c67 6974 2929 0a20  end((rit,git)). 
+00067140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067150: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00067160: 7269 743a 2062 7072 5b69 5d20 3d20 300a  rit: bpr[i] = 0.
+00067170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067180: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00067190: 2067 6974 3a20 6270 675b 695d 203d 2030   git: bpg[i] = 0
+000671a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000671b0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+000671c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000671d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000671e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000671f0: 2072 6920 3d20 7269 740a 2020 2020 2020   ri = rit.      
+00067200: 200a 2020 2020 6d61 705f 7232 6720 3d20   .    map_r2g = 
+00067210: 5b5d 2023 206e 702e 6675 6c6c 286c 656e  [] # np.full(len
+00067220: 2872 675f 6c73 7429 2c20 2d31 290a 2020  (rg_lst), -1).  
+00067230: 2020 746f 5f64 656c 5f72 203d 205b 5d0a    to_del_r = [].
+00067240: 2020 2020 746f 5f64 656c 5f67 203d 205b      to_del_g = [
+00067250: 5d0a 2020 2020 666f 7220 7267 2069 6e20  ].    for rg in 
+00067260: 7267 5f6c 7374 3a0a 2020 2020 2020 2020  rg_lst:.        
+00067270: 7269 7320 3d20 6c69 7374 2872 675b 305d  ris = list(rg[0]
+00067280: 290a 2020 2020 2020 2020 7467 7420 3d20  ).        tgt = 
+00067290: 7269 735b 305d 0a20 2020 2020 2020 2066  ris[0].        f
+000672a0: 6f72 2072 6920 696e 2072 6973 5b31 3a5d  or ri in ris[1:]
+000672b0: 3a0a 2020 2020 2020 2020 2020 2020 7267  :.            rg
+000672c0: 6e73 5f6c 7374 5f6d 695b 7467 745d 2e6d  ns_lst_mi[tgt].m
+000672d0: 6572 6765 2872 676e 735f 6c73 745f 6d69  erge(rgns_lst_mi
+000672e0: 5b72 695d 290a 2020 2020 2020 2020 2020  [ri]).          
+000672f0: 2020 7267 6e73 5f6c 7374 5f6e 645b 7467    rgns_lst_nd[tg
+00067300: 745d 2e6d 6572 6765 2872 676e 735f 6c73  t].merge(rgns_ls
+00067310: 745f 6e64 5b72 695d 290a 2020 2020 2020  t_nd[ri]).      
+00067320: 2020 2020 2020 7267 6e73 5f6c 7374 5f73        rgns_lst_s
+00067330: 7469 5b74 6774 5d2e 6d65 7267 6528 7267  ti[tgt].merge(rg
+00067340: 6e73 5f6c 7374 5f73 7469 5b72 695d 290a  ns_lst_sti[ri]).
+00067350: 2020 2020 2020 2020 2020 2020 746f 5f64              to_d
+00067360: 656c 5f72 2e61 7070 656e 6428 7269 290a  el_r.append(ri).
+00067370: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00067380: 2020 2020 2072 6920 3d20 7467 740a 2020       ri = tgt.  
+00067390: 2020 2020 2020 6769 7320 3d20 6c69 7374        gis = list
+000673a0: 2872 675b 315d 290a 2020 2020 2020 2020  (rg[1]).        
+000673b0: 7467 7420 3d20 6769 735b 305d 0a20 2020  tgt = gis[0].   
+000673c0: 2020 2020 2066 6f72 2067 6920 696e 2067       for gi in g
+000673d0: 6973 5b31 3a5d 3a0a 2020 2020 2020 2020  is[1:]:.        
+000673e0: 2020 2020 6764 5f6c 7374 5b74 6774 5d2e      gd_lst[tgt].
+000673f0: 6d65 7267 6528 6764 5f6c 7374 5b67 695d  merge(gd_lst[gi]
+00067400: 290a 2020 2020 2020 2020 2020 2020 746f  ).            to
+00067410: 5f64 656c 5f67 2e61 7070 656e 6428 6769  _del_g.append(gi
+00067420: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+00067430: 2020 2020 2020 2067 645f 6c73 745b 7467         gd_lst[tg
+00067440: 745d 2e67 6574 5f73 7061 6e28 290a 2020  t].get_span().  
+00067450: 2020 2020 2020 6d61 705f 7232 672e 6170        map_r2g.ap
+00067460: 7065 6e64 2828 7269 2c20 7467 7429 290a  pend((ri, tgt)).
+00067470: 2020 2020 2020 2020 0a20 2020 2072 676e          .    rgn
+00067480: 735f 6c73 745f 6d69 5f6f 7574 203d 205b  s_lst_mi_out = [
+00067490: 5d0a 2020 2020 7267 6e73 5f6c 7374 5f6e  ].    rgns_lst_n
+000674a0: 645f 6f75 7420 3d20 5b5d 200a 2020 2020  d_out = [] .    
+000674b0: 7267 6e73 5f6c 7374 5f73 7469 5f6f 7574  rgns_lst_sti_out
+000674c0: 203d 205b 5d0a 2020 2020 6764 5f6c 7374   = [].    gd_lst
+000674d0: 5f6f 7574 203d 205b 5d0a 2020 2020 0a20  _out = [].    . 
+000674e0: 2020 2066 6f72 2072 692c 2067 6920 696e     for ri, gi in
+000674f0: 206d 6170 5f72 3267 3a0a 2020 2020 2020   map_r2g:.      
+00067500: 2020 7267 6e73 5f6c 7374 5f6d 695f 6f75    rgns_lst_mi_ou
+00067510: 742e 6170 7065 6e64 2872 676e 735f 6c73  t.append(rgns_ls
+00067520: 745f 6d69 5b72 695d 290a 2020 2020 2020  t_mi[ri]).      
+00067530: 2020 7267 6e73 5f6c 7374 5f6e 645f 6f75    rgns_lst_nd_ou
+00067540: 742e 6170 7065 6e64 2872 676e 735f 6c73  t.append(rgns_ls
+00067550: 745f 6e64 5b72 695d 2920 0a20 2020 2020  t_nd[ri]) .     
+00067560: 2020 2072 676e 735f 6c73 745f 7374 695f     rgns_lst_sti_
+00067570: 6f75 742e 6170 7065 6e64 2872 676e 735f  out.append(rgns_
+00067580: 6c73 745f 7374 695b 7269 5d29 0a20 2020  lst_sti[ri]).   
+00067590: 2020 2020 2067 645f 6c73 745f 6f75 742e       gd_lst_out.
+000675a0: 6170 7065 6e64 2867 645f 6c73 745b 6769  append(gd_lst[gi
+000675b0: 5d29 0a20 2020 2020 2020 200a 2020 2020  ]).        .    
+000675c0: 6e67 203d 206e 702e 7375 6d28 6270 6720  ng = np.sum(bpg 
+000675d0: 3e20 3029 0a20 2020 206e 7220 3d20 6e70  > 0).    nr = np
+000675e0: 2e73 756d 2862 7072 203e 2030 290a 0a20  .sum(bpr > 0).. 
+000675f0: 2020 2077 6820 3d20 7768 6963 6828 6270     wh = which(bp
+00067600: 6720 3e20 3029 0a20 2020 2069 6620 6c65  g > 0).    if le
+00067610: 6e28 7768 2920 3e20 303a 0a20 2020 2020  n(wh) > 0:.     
+00067620: 2020 2067 645f 6c73 745f 756e 6d61 7070     gd_lst_unmapp
+00067630: 6564 203d 205b 6764 5f6c 7374 5b77 5d20  ed = [gd_lst[w] 
+00067640: 666f 7220 7720 696e 2077 685d 0a20 2020  for w in wh].   
+00067650: 2065 6c73 653a 0a20 2020 2020 2020 2067   else:.        g
+00067660: 645f 6c73 745f 756e 6d61 7070 6564 203d  d_lst_unmapped =
+00067670: 205b 5d0a 2020 2020 0a20 2020 2027 2727   [].    .    '''
+00067680: 0a20 2020 2077 6820 3d20 7768 6963 6828  .    wh = which(
+00067690: 6270 7220 3e20 3029 0a20 2020 2072 676e  bpr > 0).    rgn
+000676a0: 735f 6c73 745f 6d69 5f6f 7574 203d 2072  s_lst_mi_out = r
+000676b0: 676e 735f 6c73 745f 6d69 5f6f 7574 202b  gns_lst_mi_out +
+000676c0: 205b 7267 6e73 5f6c 7374 5f6d 695b 775d   [rgns_lst_mi[w]
+000676d0: 2066 6f72 2077 2069 6e20 7768 5d0a 2020   for w in wh].  
+000676e0: 2020 7267 6e73 5f6c 7374 5f6e 645f 6f75    rgns_lst_nd_ou
+000676f0: 7420 3d20 7267 6e73 5f6c 7374 5f6e 645f  t = rgns_lst_nd_
+00067700: 6f75 7420 2b20 5b72 676e 735f 6c73 745f  out + [rgns_lst_
+00067710: 6e64 5b77 5d20 666f 7220 7720 696e 2077  nd[w] for w in w
+00067720: 685d 0a20 2020 2072 676e 735f 6c73 745f  h].    rgns_lst_
+00067730: 7374 695f 6f75 7420 3d20 7267 6e73 5f6c  sti_out = rgns_l
+00067740: 7374 5f73 7469 5f6f 7574 202b 205b 7267  st_sti_out + [rg
+00067750: 6e73 5f6c 7374 5f73 7469 5b77 5d20 666f  ns_lst_sti[w] fo
+00067760: 7220 7720 696e 2077 685d 0a20 2020 2067  r w in wh].    g
+00067770: 645f 6c73 745f 6f75 7420 3d20 6764 5f6c  d_lst_out = gd_l
+00067780: 7374 5f6f 7574 202b 205b 4e6f 6e65 2066  st_out + [None f
+00067790: 6f72 2077 2069 6e20 7768 5d0a 2020 2020  or w in wh].    
+000677a0: 2327 2727 0a20 2020 200a 2020 2020 746f  #'''.    .    to
+000677b0: 5f64 656c 5f72 203d 2074 6f5f 6465 6c5f  _del_r = to_del_
+000677c0: 7220 2b20 7768 6963 6828 6270 7220 3e20  r + which(bpr > 
+000677d0: 3029 0a20 2020 2074 6f5f 6465 6c5f 6720  0).    to_del_g 
+000677e0: 3d20 746f 5f64 656c 5f67 202b 2077 6869  = to_del_g + whi
+000677f0: 6368 2862 7067 203e 2030 290a 2020 2020  ch(bpg > 0).    
+00067800: 2727 270a 2020 2020 6966 206c 656e 2874  '''.    if len(t
+00067810: 6f5f 6465 6c5f 7229 203e 2030 3a0a 2020  o_del_r) > 0:.  
+00067820: 2020 2020 2020 746f 5f64 656c 5f72 2e73        to_del_r.s
+00067830: 6f72 7428 7265 7665 7273 653d 5472 7565  ort(reverse=True
+00067840: 290a 2020 2020 2020 2020 666f 7220 7269  ).        for ri
+00067850: 2069 6e20 746f 5f64 656c 5f72 3a0a 2020   in to_del_r:.  
+00067860: 2020 2020 2020 2020 2020 6465 6c20 7267            del rg
+00067870: 6e73 5f6c 7374 5f6d 695b 7269 5d0a 2020  ns_lst_mi[ri].  
+00067880: 2020 2020 2020 2020 2020 6465 6c20 7267            del rg
+00067890: 6e73 5f6c 7374 5f6e 645b 7269 5d0a 2020  ns_lst_nd[ri].  
+000678a0: 2020 2020 2020 2020 2020 6465 6c20 7267            del rg
+000678b0: 6e73 5f6c 7374 5f73 7469 5b72 695d 0a20  ns_lst_sti[ri]. 
+000678c0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+000678d0: 6966 206c 656e 2874 6f5f 6465 6c5f 6729  if len(to_del_g)
+000678e0: 203e 2030 3a0a 2020 2020 2020 2020 746f   > 0:.        to
+000678f0: 5f64 656c 5f67 2e73 6f72 7428 7265 7665  _del_g.sort(reve
+00067900: 7273 653d 5472 7565 290a 2020 2020 2020  rse=True).      
+00067910: 2020 666f 7220 6769 2069 6e20 746f 5f64    for gi in to_d
+00067920: 656c 5f67 3a0a 2020 2020 2020 2020 2020  el_g:.          
+00067930: 2020 6465 6c20 6764 5f6c 7374 5b67 695d    del gd_lst[gi]
+00067940: 0a20 2020 2023 2727 2720 2020 2020 2020  .    #'''       
+00067950: 200a 2020 2020 6465 6c20 725f 6c73 740a   .    del r_lst.
+00067960: 2020 2020 6465 6c20 675f 6c73 740a 2020      del g_lst.  
+00067970: 2020 6465 6c20 7267 5f6c 7374 0a20 2020    del rg_lst.   
+00067980: 200a 2020 2020 666f 7220 7220 696e 2072   .    for r in r
+00067990: 676e 735f 6c73 745f 6d69 5f6f 7574 3a20  gns_lst_mi_out: 
+000679a0: 722e 7365 745f 6376 6728 290a 2020 2020  r.set_cvg().    
+000679b0: 666f 7220 7220 696e 2072 676e 735f 6c73  for r in rgns_ls
+000679c0: 745f 6e64 5f6f 7574 3a20 722e 7365 745f  t_nd_out: r.set_
+000679d0: 6376 6728 290a 2020 2020 666f 7220 7220  cvg().    for r 
+000679e0: 696e 2072 676e 735f 6c73 745f 7374 695f  in rgns_lst_sti_
+000679f0: 6f75 743a 2072 2e73 6574 5f63 7667 2829  out: r.set_cvg()
+00067a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00067a10: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
+00067a20: 2067 645f 6c73 745f 6f75 742c 2072 676e   gd_lst_out, rgn
+00067a30: 735f 6c73 745f 6d69 5f6f 7574 2c20 7267  s_lst_mi_out, rg
+00067a40: 6e73 5f6c 7374 5f6e 645f 6f75 742c 2072  ns_lst_nd_out, r
+00067a50: 676e 735f 6c73 745f 7374 695f 6f75 742c  gns_lst_sti_out,
+00067a60: 206e 672c 206e 722c 2074 6f5f 6465 6c5f   ng, nr, to_del_
+00067a70: 672c 2074 6f5f 6465 6c5f 722c 2067 645f  g, to_del_r, gd_
+00067a80: 6c73 745f 756e 6d61 7070 6564 0a23 2727  lst_unmapped.#''
+00067a90: 270a 2020 2020 0a0a 6465 6620 636f 6d62  '.    ..def comb
+00067aa0: 696e 655f 6765 6e65 735f 616e 645f 7267  ine_genes_and_rg
+00067ab0: 6e73 5f70 6572 5f63 6872 2820 6764 5f6c  ns_per_chr( gd_l
+00067ac0: 7374 2c20 7267 6e73 5f6c 7374 5f6d 692c  st, rgns_lst_mi,
+00067ad0: 2072 676e 735f 6c73 745f 6e64 2c20 7267   rgns_lst_nd, rg
+00067ae0: 6e73 5f6c 7374 5f73 7469 2c20 7665 7262  ns_lst_sti, verb
+00067af0: 6f73 6520 3d20 4661 6c73 6520 293a 0a0a  ose = False ):..
+00067b00: 2020 2020 2327 2727 0a20 2020 206e 5f67      #'''.    n_g
+00067b10: 6420 3d20 6c65 6e28 6764 5f6c 7374 290a  d = len(gd_lst).
+00067b20: 2020 2020 735f 706f 7320 3d20 6e70 2e7a      s_pos = np.z
+00067b30: 6572 6f73 286e 5f67 6429 0a20 2020 2065  eros(n_gd).    e
+00067b40: 5f70 6f73 203d 206e 702e 7a65 726f 7328  _pos = np.zeros(
+00067b50: 6e5f 6764 290a 2020 2020 735f 6d69 6e20  n_gd).    s_min 
+00067b60: 3d20 6e70 2e7a 6572 6f73 286e 5f67 6429  = np.zeros(n_gd)
+00067b70: 0a20 2020 2065 5f6d 6178 203d 206e 702e  .    e_max = np.
+00067b80: 7a65 726f 7328 6e5f 6764 290a 2020 2020  zeros(n_gd).    
+00067b90: 666f 7220 6b2c 2067 6420 696e 2065 6e75  for k, gd in enu
+00067ba0: 6d65 7261 7465 2867 645f 6c73 7429 3a20  merate(gd_lst): 
+00067bb0: 0a20 2020 2020 2020 2073 5f70 6f73 5b6b  .        s_pos[k
+00067bc0: 5d20 3d20 6764 2e62 6567 696e 0a20 2020  ] = gd.begin.   
+00067bd0: 2020 2020 2065 5f70 6f73 5b6b 5d20 3d20       e_pos[k] = 
+00067be0: 6764 2e65 6e64 0a20 2020 2020 2020 2069  gd.end.        i
+00067bf0: 6620 6b20 3d3d 2030 3a0a 2020 2020 2020  f k == 0:.      
+00067c00: 2020 2020 2020 656d 203d 2065 5f70 6f73        em = e_pos
+00067c10: 5b30 5d0a 2020 2020 2020 2020 656c 7365  [0].        else
+00067c20: 3a0a 2020 2020 2020 2020 2020 2020 656d  :.            em
+00067c30: 203d 206d 6178 2865 6d2c 2065 5f70 6f73   = max(em, e_pos
+00067c40: 5b6b 5d29 0a20 2020 2020 2020 2065 5f6d  [k]).        e_m
+00067c50: 6178 5b6b 5d20 3d20 656d 0a20 2020 2020  ax[k] = em.     
+00067c60: 2020 200a 2020 2020 666f 7220 6b20 696e     .    for k in
+00067c70: 2072 6576 6572 7365 6428 7261 6e67 6528   reversed(range(
+00067c80: 6c65 6e28 735f 706f 7329 2929 3a0a 2020  len(s_pos))):.  
+00067c90: 2020 2020 2020 6966 206b 203d 3d20 286c        if k == (l
+00067ca0: 656e 2873 5f70 6f73 292d 3129 3a0a 2020  en(s_pos)-1):.  
+00067cb0: 2020 2020 2020 2020 2020 736d 203d 2073            sm = s
+00067cc0: 5f70 6f73 5b6b 5d0a 2020 2020 2020 2020  _pos[k].        
+00067cd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00067ce0: 2020 736d 203d 206d 696e 2873 6d2c 735f    sm = min(sm,s_
+00067cf0: 706f 735b 6b5d 290a 2020 2020 2020 2020  pos[k]).        
+00067d00: 735f 6d69 6e5b 6b5d 203d 2073 6d0a 2020  s_min[k] = sm.  
+00067d10: 2020 2020 2020 0a20 2020 2023 2323 230a        .    ####.
+00067d20: 2020 2020 725f 6c73 7420 3d20 7b6b 3a20      r_lst = {k: 
+00067d30: 5b5d 2066 6f72 206b 2069 6e20 7261 6e67  [] for k in rang
+00067d40: 6528 6c65 6e28 7267 6e73 5f6c 7374 5f6d  e(len(rgns_lst_m
+00067d50: 6929 297d 0a20 2020 2067 5f6c 7374 203d  i))}.    g_lst =
+00067d60: 207b 6b3a 205b 5d20 666f 7220 6b20 696e   {k: [] for k in
+00067d70: 2072 616e 6765 286c 656e 2867 645f 6c73   range(len(gd_ls
+00067d80: 7429 297d 0a0a 2020 2020 7374 6172 745f  t))}..    start_
+00067d90: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
+00067da0: 6528 290a 2020 2020 2327 2727 0a0a 2020  e().    #'''..  
+00067db0: 2020 666f 7220 6b2c 2072 7320 696e 2065    for k, rs in e
+00067dc0: 6e75 6d65 7261 7465 2872 676e 735f 6c73  numerate(rgns_ls
+00067dd0: 745f 6d69 293a 0a20 2020 2020 2020 2073  t_mi):.        s
+00067de0: 7061 6e20 3d20 7273 2e67 6574 5f73 7061  pan = rs.get_spa
+00067df0: 6e28 290a 2020 2020 2020 2020 7768 203d  n().        wh =
+00067e00: 2077 6869 6368 2820 2828 655f 706f 7320   which( ((e_pos 
+00067e10: 3c20 7370 616e 2e73 7461 7274 2920 7c20  < span.start) | 
+00067e20: 2873 5f70 6f73 203e 2073 7061 6e2e 656e  (s_pos > span.en
+00067e30: 6429 292c 2046 616c 7365 2029 0a20 2020  d)), False ).   
+00067e40: 2020 2020 2066 6f72 206d 2069 6e20 7768       for m in wh
+00067e50: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00067e60: 2067 645f 6c73 745b 6d5d 2e65 786f 6e73   gd_lst[m].exons
+00067e70: 2e68 6173 5f65 7874 5f69 6e74 6572 7365  .has_ext_interse
+00067e80: 6374 696f 6e5f 7769 7468 2872 7329 3a0a  ction_with(rs):.
+00067e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067ea0: 725f 6c73 745b 6b5d 2e61 7070 656e 6428  r_lst[k].append(
+00067eb0: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
+00067ec0: 2020 2067 5f6c 7374 5b6d 5d2e 6170 7065     g_lst[m].appe
+00067ed0: 6e64 286b 290a 0a20 2020 2065 6c61 7073  nd(k)..    elaps
+00067ee0: 6564 5f74 696d 6531 203d 2074 696d 652e  ed_time1 = time.
+00067ef0: 7469 6d65 2829 202d 2073 7461 7274 5f74  time() - start_t
+00067f00: 696d 6531 0a20 2020 2023 2069 6620 7665  ime1.    # if ve
+00067f10: 7262 6f73 653a 2070 7269 6e74 2827 5c72  rbose: print('\r
+00067f20: 4d61 7070 696e 6720 2569 202e 2e2e 2064  Mapping %i ... d
+00067f30: 6f6e 6520 2825 6929 2027 2025 2028 6c65  one (%i) ' % (le
+00067f40: 6e28 7267 6e73 5f6c 7374 5f6d 6929 2c65  n(rgns_lst_mi),e
+00067f50: 6c61 7073 6564 5f74 696d 6531 2920 290a  lapsed_time1) ).
+00067f60: 2020 2020 2327 2727 0a20 2020 200a 2020      #'''.    .  
+00067f70: 2020 2727 270a 2020 2020 6d20 3d20 300a    '''.    m = 0.
+00067f80: 0a20 2020 2066 6f72 206b 2c20 7273 2069  .    for k, rs i
+00067f90: 6e20 656e 756d 6572 6174 6528 7267 6e73  n enumerate(rgns
+00067fa0: 5f6c 7374 5f6d 6929 3a0a 2020 2020 2020  _lst_mi):.      
+00067fb0: 2020 7370 616e 203d 2072 732e 6765 745f    span = rs.get_
+00067fc0: 7370 616e 2829 0a20 2020 2020 2020 2069  span().        i
+00067fd0: 6620 286b 2b31 2920 3c20 6c65 6e28 7267  f (k+1) < len(rg
+00067fe0: 6e73 5f6c 7374 5f6d 6929 3a0a 2020 2020  ns_lst_mi):.    
+00067ff0: 2020 2020 2020 2020 7370 616e 3220 3d20          span2 = 
+00068000: 7267 6e73 5f6c 7374 5f6d 695b 6b2b 315d  rgns_lst_mi[k+1]
+00068010: 2e67 6574 5f73 7061 6e28 290a 2020 2020  .get_span().    
+00068020: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00068030: 2020 2020 2020 7370 616e 3220 3d20 7370        span2 = sp
+00068040: 616e 0a0a 2020 2020 2020 2020 6d32 203d  an..        m2 =
+00068050: 206d 0a20 2020 2020 2020 200a 2020 2020   m.        .    
+00068060: 2020 2020 6d31 203d 206d 0a20 2020 2020      m1 = m.     
+00068070: 2020 2069 6620 6d31 203c 206c 656e 2867     if m1 < len(g
+00068080: 645f 6c73 7429 3a0a 2020 2020 2020 2020  d_lst):.        
+00068090: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
+000680a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000680b0: 6966 2065 5f6d 6178 5b6d 315d 203c 2073  if e_max[m1] < s
+000680c0: 7061 6e2e 7374 6172 743a 0a20 2020 2020  pan.start:.     
+000680d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000680e0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+000680f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00068100: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00068110: 6620 6764 5f6c 7374 5b6d 315d 2e65 786f  f gd_lst[m1].exo
+00068120: 6e73 2e68 6173 5f65 7874 5f69 6e74 6572  ns.has_ext_inter
+00068130: 7365 6374 696f 6e5f 7769 7468 2872 7329  section_with(rs)
+00068140: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00068150: 2020 2020 2020 2020 2020 725f 6c73 745b            r_lst[
+00068160: 6b5d 2e61 7070 656e 6428 6d31 290a 2020  k].append(m1).  
+00068170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068180: 2020 2020 2020 675f 6c73 745b 6d31 5d2e        g_lst[m1].
+00068190: 6170 7065 6e64 286b 290a 2020 2020 2020  append(k).      
 000681a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000681b0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-000681c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000681d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000681e0: 2020 2020 6966 2067 645f 6c73 745b 6d31      if gd_lst[m1
-000681f0: 5d2e 6578 6f6e 732e 6861 735f 6578 745f  ].exons.has_ext_
-00068200: 696e 7465 7273 6563 7469 6f6e 5f77 6974  intersection_wit
-00068210: 6828 7273 293a 0a20 2020 2020 2020 2020  h(rs):.         
-00068220: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00068230: 5f6c 7374 5b6b 5d2e 6170 7065 6e64 286d  _lst[k].append(m
-00068240: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00068250: 2020 2020 2020 2020 2020 2067 5f6c 7374             g_lst
-00068260: 5b6d 315d 2e61 7070 656e 6428 6b29 0a20  [m1].append(k). 
-00068270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068280: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00068290: 2020 2020 2020 2020 6966 2065 5f6d 6178          if e_max
-000682a0: 5b6d 315d 203c 2073 7061 6e32 2e73 7461  [m1] < span2.sta
-000682b0: 7274 3a20 6d32 203d 206d 310a 2020 2020  rt: m2 = m1.    
-000682c0: 2020 2020 2020 2020 2020 2020 6d31 202d              m1 -
-000682d0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-000682e0: 2020 2020 6966 206d 3120 3c20 303a 2062      if m1 < 0: b
-000682f0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-00068300: 200a 2020 2020 2020 2020 6966 2028 6d2b   .        if (m+
-00068310: 3129 203c 206c 656e 2867 645f 6c73 7429  1) < len(gd_lst)
-00068320: 3a0a 2020 2020 2020 2020 2020 2020 6d31  :.            m1
-00068330: 203d 206d 2b31 0a20 2020 2020 2020 2020   = m+1.         
-00068340: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
-00068350: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00068360: 6620 735f 6d69 6e5b 6d31 5d20 3e20 7370  f s_min[m1] > sp
-00068370: 616e 2e65 6e64 3a0a 2020 2020 2020 2020  an.end:.        
-00068380: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00068390: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-000683a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000683b0: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-000683c0: 645f 6c73 745b 6d31 5d2e 6578 6f6e 732e  d_lst[m1].exons.
-000683d0: 6861 735f 6578 745f 696e 7465 7273 6563  has_ext_intersec
-000683e0: 7469 6f6e 5f77 6974 6828 7273 293a 0a20  tion_with(rs):. 
-000683f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068400: 2020 2020 2020 2072 5f6c 7374 5b6b 5d2e         r_lst[k].
-00068410: 6170 7065 6e64 286d 3129 0a20 2020 2020  append(m1).     
-00068420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068430: 2020 2067 5f6c 7374 5b6d 315d 2e61 7070     g_lst[m1].app
-00068440: 656e 6428 6b29 0a0a 2020 2020 2020 2020  end(k)..        
-00068450: 2020 2020 2020 2020 6966 2065 5f6d 6178          if e_max
-00068460: 5b6d 315d 203c 2073 7061 6e32 2e73 7461  [m1] < span2.sta
-00068470: 7274 3a20 6d32 203d 206d 310a 2020 2020  rt: m2 = m1.    
-00068480: 2020 2020 2020 2020 2020 2020 6d31 202b              m1 +
-00068490: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-000684a0: 2020 2020 6966 206d 3120 3e3d 206c 656e      if m1 >= len
-000684b0: 2867 645f 6c73 7429 3a20 6272 6561 6b0a  (gd_lst): break.
-000684c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000684d0: 0a20 2020 2020 2020 206d 203d 206d 3220  .        m = m2 
-000684e0: 2b20 310a 2020 2020 2020 2020 0a20 2020  + 1.        .   
-000684f0: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
-00068500: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00068510: 6b25 3130 3020 3d3d 2030 3a0a 2020 2020  k%100 == 0:.    
-00068520: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00068530: 7428 275c 724d 6170 7069 6e67 2025 692f  t('\rMapping %i/
-00068540: 2569 2720 2520 286b 2c6c 656e 2872 676e  %i' % (k,len(rgn
-00068550: 735f 6c73 745f 6d69 2929 2c20 656e 643d  s_lst_mi)), end=
-00068560: 2720 2020 2027 2c20 666c 7573 6820 3d20  '    ', flush = 
-00068570: 5472 7565 2029 0a20 2020 2020 2020 2020  True ).         
-00068580: 2020 2020 2020 200a 2020 2020 656c 6170         .    elap
-00068590: 7365 645f 7469 6d65 3120 3d20 7469 6d65  sed_time1 = time
-000685a0: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-000685b0: 7469 6d65 310a 2020 2020 6966 2076 6572  time1.    if ver
-000685c0: 626f 7365 3a20 7072 696e 7428 275c 724d  bose: print('\rM
-000685d0: 6170 7069 6e67 2025 6920 2e2e 2e20 646f  apping %i ... do
-000685e0: 6e65 2028 2569 2920 2720 2520 286c 656e  ne (%i) ' % (len
-000685f0: 2872 676e 735f 6c73 745f 6d69 292c 656c  (rgns_lst_mi),el
-00068600: 6170 7365 645f 7469 6d65 3129 2029 0a20  apsed_time1) ). 
-00068610: 2020 2023 2727 270a 2020 2020 0a20 2020     #'''.    .   
-00068620: 2062 7072 203d 206e 702e 6f6e 6573 286c   bpr = np.ones(l
-00068630: 656e 2872 676e 735f 6c73 745f 6d69 2929  en(rgns_lst_mi))
-00068640: 0a20 2020 2062 7067 203d 206e 702e 6f6e  .    bpg = np.on
-00068650: 6573 286c 656e 2867 645f 6c73 7429 290a  es(len(gd_lst)).
-00068660: 0a20 2020 2072 675f 6c73 7420 3d20 5b5d  .    rg_lst = []
-00068670: 0a20 2020 2066 6f72 206b 2069 6e20 725f  .    for k in r_
-00068680: 6c73 742e 6b65 7973 2829 3a0a 2020 2020  lst.keys():.    
-00068690: 2020 2020 6769 7320 3d20 725f 6c73 745b      gis = r_lst[
-000686a0: 6b5d 0a20 2020 2020 2020 2069 6620 6270  k].        if bp
-000686b0: 725b 6b5d 203e 2030 3a0a 2020 2020 2020  r[k] > 0:.      
-000686c0: 2020 2020 2020 7269 203d 205b 6b5d 0a20        ri = [k]. 
-000686d0: 2020 2020 2020 2020 2020 2067 6974 203d             git =
-000686e0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-000686f0: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-00068700: 2020 2020 2020 2020 2020 2020 6769 7420              git 
-00068710: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
-00068720: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00068730: 2072 693a 0a20 2020 2020 2020 2020 2020   ri:.           
-00068740: 2020 2020 2020 2020 2069 6620 6270 725b           if bpr[
-00068750: 695d 203e 2030 3a0a 2020 2020 2020 2020  i] > 0:.        
-00068760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068770: 6769 7420 3d20 6769 742e 756e 696f 6e28  git = git.union(
-00068780: 725f 6c73 745b 695d 290a 2020 2020 2020  r_lst[i]).      
-00068790: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000687a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000687b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000687c0: 7428 2745 5252 4f52 2025 692c 2569 2720  t('ERROR %i,%i' 
-000687d0: 2520 286b 2c69 2929 0a20 2020 2020 2020  % (k,i)).       
-000687e0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-000687f0: 6769 7429 203d 3d20 303a 0a20 2020 2020  git) == 0:.     
-00068800: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00068810: 2072 675f 6c73 742e 6170 7065 6e64 2828   rg_lst.append((
-00068820: 7269 742c 5b5d 2929 0a20 2020 2020 2020  rit,[])).       
-00068830: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00068840: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00068850: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00068860: 2020 2020 2020 2020 2020 2020 2072 6974               rit
-00068870: 203d 2073 6574 2829 0a20 2020 2020 2020   = set().       
-00068880: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00068890: 206a 2069 6e20 6769 743a 0a20 2020 2020   j in git:.     
-000688a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000688b0: 2020 2069 6620 6270 675b 6a5d 203e 2030     if bpg[j] > 0
-000688c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000688d0: 2020 2020 2020 2020 2020 2020 2020 7269                ri
-000688e0: 7420 3d20 7269 742e 756e 696f 6e28 675f  t = rit.union(g_
-000688f0: 6c73 745b 6a5d 290a 2020 2020 2020 2020  lst[j]).        
-00068900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068910: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00068920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068930: 2020 7072 696e 7428 2745 5252 4f52 2025    print('ERROR %
-00068940: 692c 2569 2720 2520 286b 2c6a 2929 0a0a  i,%i' % (k,j))..
-00068950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068960: 2020 2020 6966 206c 656e 2872 6974 2920      if len(rit) 
-00068970: 3d3d 206c 656e 2872 6929 3a0a 2020 2020  == len(ri):.    
-00068980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068990: 2020 2020 7267 5f6c 7374 2e61 7070 656e      rg_lst.appen
-000689a0: 6428 2872 6974 2c67 6974 2929 0a20 2020  d((rit,git)).   
-000689b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000689c0: 2020 2020 2066 6f72 2069 2069 6e20 7269       for i in ri
-000689d0: 743a 2062 7072 5b69 5d20 3d20 300a 2020  t: bpr[i] = 0.  
-000689e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000689f0: 2020 2020 2020 666f 7220 6920 696e 2067        for i in g
-00068a00: 6974 3a20 6270 675b 695d 203d 2030 0a20  it: bpg[i] = 0. 
-00068a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068a20: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00068a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068a40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00068a50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00068a60: 6920 3d20 7269 740a 2020 2020 2020 200a  i = rit.       .
-00068a70: 2020 2020 6d61 705f 7232 6720 3d20 5b5d      map_r2g = []
-00068a80: 2023 206e 702e 6675 6c6c 286c 656e 2872   # np.full(len(r
-00068a90: 675f 6c73 7429 2c20 2d31 290a 2020 2020  g_lst), -1).    
-00068aa0: 746f 5f64 656c 5f72 203d 205b 5d0a 2020  to_del_r = [].  
-00068ab0: 2020 746f 5f64 656c 5f67 203d 205b 5d0a    to_del_g = [].
-00068ac0: 2020 2020 666f 7220 7267 2069 6e20 7267      for rg in rg
-00068ad0: 5f6c 7374 3a0a 2020 2020 2020 2020 7269  _lst:.        ri
-00068ae0: 7320 3d20 6c69 7374 2872 675b 305d 290a  s = list(rg[0]).
-00068af0: 2020 2020 2020 2020 7467 7420 3d20 7269          tgt = ri
-00068b00: 735b 305d 0a20 2020 2020 2020 2066 6f72  s[0].        for
-00068b10: 2072 6920 696e 2072 6973 5b31 3a5d 3a0a   ri in ris[1:]:.
-00068b20: 2020 2020 2020 2020 2020 2020 7267 6e73              rgns
-00068b30: 5f6c 7374 5f6d 695b 7467 745d 2e6d 6572  _lst_mi[tgt].mer
-00068b40: 6765 2872 676e 735f 6c73 745f 6d69 5b72  ge(rgns_lst_mi[r
-00068b50: 695d 290a 2020 2020 2020 2020 2020 2020  i]).            
-00068b60: 7267 6e73 5f6c 7374 5f6e 645b 7467 745d  rgns_lst_nd[tgt]
-00068b70: 2e6d 6572 6765 2872 676e 735f 6c73 745f  .merge(rgns_lst_
-00068b80: 6e64 5b72 695d 290a 2020 2020 2020 2020  nd[ri]).        
-00068b90: 2020 2020 7267 6e73 5f6c 7374 5f73 7469      rgns_lst_sti
-00068ba0: 5b74 6774 5d2e 6d65 7267 6528 7267 6e73  [tgt].merge(rgns
-00068bb0: 5f6c 7374 5f73 7469 5b72 695d 290a 2020  _lst_sti[ri]).  
-00068bc0: 2020 2020 2020 2020 2020 746f 5f64 656c            to_del
-00068bd0: 5f72 2e61 7070 656e 6428 7269 290a 2020  _r.append(ri).  
-00068be0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00068bf0: 2020 2072 6920 3d20 7467 740a 2020 2020     ri = tgt.    
-00068c00: 2020 2020 6769 7320 3d20 6c69 7374 2872      gis = list(r
-00068c10: 675b 315d 290a 2020 2020 2020 2020 7467  g[1]).        tg
-00068c20: 7420 3d20 6769 735b 305d 0a20 2020 2020  t = gis[0].     
-00068c30: 2020 2066 6f72 2067 6920 696e 2067 6973     for gi in gis
-00068c40: 5b31 3a5d 3a0a 2020 2020 2020 2020 2020  [1:]:.          
-00068c50: 2020 6764 5f6c 7374 5b74 6774 5d2e 6d65    gd_lst[tgt].me
-00068c60: 7267 6528 6764 5f6c 7374 5b67 695d 290a  rge(gd_lst[gi]).
-00068c70: 2020 2020 2020 2020 2020 2020 746f 5f64              to_d
-00068c80: 656c 5f67 2e61 7070 656e 6428 6769 290a  el_g.append(gi).
-00068c90: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00068ca0: 2020 2020 2067 645f 6c73 745b 7467 745d       gd_lst[tgt]
-00068cb0: 2e67 6574 5f73 7061 6e28 290a 2020 2020  .get_span().    
-00068cc0: 2020 2020 6d61 705f 7232 672e 6170 7065      map_r2g.appe
-00068cd0: 6e64 2828 7269 2c20 7467 7429 290a 2020  nd((ri, tgt)).  
-00068ce0: 2020 2020 2020 0a20 2020 2072 676e 735f        .    rgns_
-00068cf0: 6c73 745f 6d69 5f6f 7574 203d 205b 5d0a  lst_mi_out = [].
-00068d00: 2020 2020 7267 6e73 5f6c 7374 5f6e 645f      rgns_lst_nd_
-00068d10: 6f75 7420 3d20 5b5d 200a 2020 2020 7267  out = [] .    rg
-00068d20: 6e73 5f6c 7374 5f73 7469 5f6f 7574 203d  ns_lst_sti_out =
-00068d30: 205b 5d0a 2020 2020 6764 5f6c 7374 5f6f   [].    gd_lst_o
-00068d40: 7574 203d 205b 5d0a 2020 2020 0a20 2020  ut = [].    .   
-00068d50: 2066 6f72 2072 692c 2067 6920 696e 206d   for ri, gi in m
-00068d60: 6170 5f72 3267 3a0a 2020 2020 2020 2020  ap_r2g:.        
-00068d70: 7267 6e73 5f6c 7374 5f6d 695f 6f75 742e  rgns_lst_mi_out.
-00068d80: 6170 7065 6e64 2872 676e 735f 6c73 745f  append(rgns_lst_
-00068d90: 6d69 5b72 695d 290a 2020 2020 2020 2020  mi[ri]).        
-00068da0: 7267 6e73 5f6c 7374 5f6e 645f 6f75 742e  rgns_lst_nd_out.
-00068db0: 6170 7065 6e64 2872 676e 735f 6c73 745f  append(rgns_lst_
-00068dc0: 6e64 5b72 695d 2920 0a20 2020 2020 2020  nd[ri]) .       
-00068dd0: 2072 676e 735f 6c73 745f 7374 695f 6f75   rgns_lst_sti_ou
-00068de0: 742e 6170 7065 6e64 2872 676e 735f 6c73  t.append(rgns_ls
-00068df0: 745f 7374 695b 7269 5d29 0a20 2020 2020  t_sti[ri]).     
-00068e00: 2020 2067 645f 6c73 745f 6f75 742e 6170     gd_lst_out.ap
-00068e10: 7065 6e64 2867 645f 6c73 745b 6769 5d29  pend(gd_lst[gi])
-00068e20: 0a20 2020 2020 2020 200a 2020 2020 6e67  .        .    ng
-00068e30: 203d 206e 702e 7375 6d28 6270 6720 3e20   = np.sum(bpg > 
-00068e40: 3029 0a20 2020 206e 7220 3d20 6e70 2e73  0).    nr = np.s
-00068e50: 756d 2862 7072 203e 2030 290a 2020 2020  um(bpr > 0).    
-00068e60: 0a20 2020 2027 2727 0a20 2020 2077 6820  .    '''.    wh 
-00068e70: 3d20 7768 6963 6828 6270 7220 3e20 3029  = which(bpr > 0)
-00068e80: 0a20 2020 2072 676e 735f 6c73 745f 6d69  .    rgns_lst_mi
-00068e90: 5f6f 7574 203d 2072 676e 735f 6c73 745f  _out = rgns_lst_
-00068ea0: 6d69 5f6f 7574 202b 205b 7267 6e73 5f6c  mi_out + [rgns_l
-00068eb0: 7374 5f6d 695b 775d 2066 6f72 2077 2069  st_mi[w] for w i
-00068ec0: 6e20 7768 5d0a 2020 2020 7267 6e73 5f6c  n wh].    rgns_l
-00068ed0: 7374 5f6e 645f 6f75 7420 3d20 7267 6e73  st_nd_out = rgns
-00068ee0: 5f6c 7374 5f6e 645f 6f75 7420 2b20 5b72  _lst_nd_out + [r
-00068ef0: 676e 735f 6c73 745f 6e64 5b77 5d20 666f  gns_lst_nd[w] fo
-00068f00: 7220 7720 696e 2077 685d 0a20 2020 2072  r w in wh].    r
-00068f10: 676e 735f 6c73 745f 7374 695f 6f75 7420  gns_lst_sti_out 
-00068f20: 3d20 7267 6e73 5f6c 7374 5f73 7469 5f6f  = rgns_lst_sti_o
-00068f30: 7574 202b 205b 7267 6e73 5f6c 7374 5f73  ut + [rgns_lst_s
-00068f40: 7469 5b77 5d20 666f 7220 7720 696e 2077  ti[w] for w in w
-00068f50: 685d 0a20 2020 2067 645f 6c73 745f 6f75  h].    gd_lst_ou
-00068f60: 7420 3d20 6764 5f6c 7374 5f6f 7574 202b  t = gd_lst_out +
-00068f70: 205b 4e6f 6e65 2066 6f72 2077 2069 6e20   [None for w in 
-00068f80: 7768 5d0a 2020 2020 2327 2727 0a20 2020  wh].    #'''.   
-00068f90: 200a 2020 2020 746f 5f64 656c 5f72 203d   .    to_del_r =
-00068fa0: 2074 6f5f 6465 6c5f 7220 2b20 7768 6963   to_del_r + whic
-00068fb0: 6828 6270 7220 3e20 3029 0a20 2020 2074  h(bpr > 0).    t
-00068fc0: 6f5f 6465 6c5f 6720 3d20 746f 5f64 656c  o_del_g = to_del
-00068fd0: 5f67 202b 2077 6869 6368 2862 7067 203e  _g + which(bpg >
-00068fe0: 2030 290a 2020 2020 2727 270a 2020 2020   0).    '''.    
-00068ff0: 6966 206c 656e 2874 6f5f 6465 6c5f 7229  if len(to_del_r)
-00069000: 203e 2030 3a0a 2020 2020 2020 2020 746f   > 0:.        to
-00069010: 5f64 656c 5f72 2e73 6f72 7428 7265 7665  _del_r.sort(reve
-00069020: 7273 653d 5472 7565 290a 2020 2020 2020  rse=True).      
-00069030: 2020 666f 7220 7269 2069 6e20 746f 5f64    for ri in to_d
-00069040: 656c 5f72 3a0a 2020 2020 2020 2020 2020  el_r:.          
-00069050: 2020 6465 6c20 7267 6e73 5f6c 7374 5f6d    del rgns_lst_m
-00069060: 695b 7269 5d0a 2020 2020 2020 2020 2020  i[ri].          
-00069070: 2020 6465 6c20 7267 6e73 5f6c 7374 5f6e    del rgns_lst_n
-00069080: 645b 7269 5d0a 2020 2020 2020 2020 2020  d[ri].          
-00069090: 2020 6465 6c20 7267 6e73 5f6c 7374 5f73    del rgns_lst_s
-000690a0: 7469 5b72 695d 0a20 2020 2020 2020 2020  ti[ri].         
-000690b0: 2020 200a 2020 2020 6966 206c 656e 2874     .    if len(t
-000690c0: 6f5f 6465 6c5f 6729 203e 2030 3a0a 2020  o_del_g) > 0:.  
-000690d0: 2020 2020 2020 746f 5f64 656c 5f67 2e73        to_del_g.s
-000690e0: 6f72 7428 7265 7665 7273 653d 5472 7565  ort(reverse=True
-000690f0: 290a 2020 2020 2020 2020 666f 7220 6769  ).        for gi
-00069100: 2069 6e20 746f 5f64 656c 5f67 3a0a 2020   in to_del_g:.  
-00069110: 2020 2020 2020 2020 2020 6465 6c20 6764            del gd
-00069120: 5f6c 7374 5b67 695d 0a20 2020 2023 2727  _lst[gi].    #''
-00069130: 2720 2020 2020 2020 200a 2020 2020 6465  '        .    de
-00069140: 6c20 725f 6c73 740a 2020 2020 6465 6c20  l r_lst.    del 
-00069150: 675f 6c73 740a 2020 2020 6465 6c20 7267  g_lst.    del rg
-00069160: 5f6c 7374 0a20 2020 200a 2020 2020 666f  _lst.    .    fo
-00069170: 7220 7220 696e 2072 676e 735f 6c73 745f  r r in rgns_lst_
-00069180: 6d69 5f6f 7574 3a20 722e 7365 745f 6376  mi_out: r.set_cv
-00069190: 6728 290a 2020 2020 666f 7220 7220 696e  g().    for r in
-000691a0: 2072 676e 735f 6c73 745f 6e64 5f6f 7574   rgns_lst_nd_out
-000691b0: 3a20 722e 7365 745f 6376 6728 290a 2020  : r.set_cvg().  
-000691c0: 2020 666f 7220 7220 696e 2072 676e 735f    for r in rgns_
-000691d0: 6c73 745f 7374 695f 6f75 743a 2072 2e73  lst_sti_out: r.s
-000691e0: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
-000691f0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00069200: 2020 7265 7475 726e 2067 645f 6c73 745f    return gd_lst_
-00069210: 6f75 742c 2072 676e 735f 6c73 745f 6d69  out, rgns_lst_mi
-00069220: 5f6f 7574 2c20 7267 6e73 5f6c 7374 5f6e  _out, rgns_lst_n
-00069230: 645f 6f75 742c 2072 676e 735f 6c73 745f  d_out, rgns_lst_
-00069240: 7374 695f 6f75 742c 206e 672c 206e 722c  sti_out, ng, nr,
-00069250: 2074 6f5f 6465 6c5f 672c 2074 6f5f 6465   to_del_g, to_de
-00069260: 6c5f 720a 2327 2727 0a20 2020 200a 0a64  l_r.#'''.    ..d
-00069270: 6566 2063 6f6d 6269 6e65 5f67 656e 6573  ef combine_genes
-00069280: 5f61 6e64 5f72 676e 7328 2067 645f 6c73  _and_rgns( gd_ls
-00069290: 742c 2072 676e 735f 6c73 745f 6d69 2c20  t, rgns_lst_mi, 
-000692a0: 7267 6e73 5f6c 7374 5f6e 642c 2072 676e  rgns_lst_nd, rgn
-000692b0: 735f 6c73 745f 7374 692c 206e 5f63 6f72  s_lst_sti, n_cor
-000692c0: 6573 203d 2031 2c20 7665 7262 6f73 6520  es = 1, verbose 
-000692d0: 3d20 4661 6c73 6520 293a 0a20 2020 200a  = False ):.    .
-000692e0: 2020 2020 6764 5f63 6872 7320 3d20 5b5d      gd_chrs = []
-000692f0: 0a20 2020 2066 6f72 2067 6420 696e 2067  .    for gd in g
-00069300: 645f 6c73 743a 2067 645f 6368 7273 2e61  d_lst: gd_chrs.a
-00069310: 7070 656e 6428 6764 2e63 6872 290a 2020  ppend(gd.chr).  
-00069320: 2020 2020 2020 0a20 2020 2072 735f 6368        .    rs_ch
-00069330: 7273 203d 205b 5d0a 2020 2020 666f 7220  rs = [].    for 
-00069340: 7273 2069 6e20 7267 6e73 5f6c 7374 5f6d  rs in rgns_lst_m
-00069350: 693a 2072 735f 6368 7273 2e61 7070 656e  i: rs_chrs.appen
-00069360: 6428 7273 2e72 676e 735b 305d 2e63 6872  d(rs.rgns[0].chr
-00069370: 290a 0a20 2020 2063 6872 7320 3d20 6c69  )..    chrs = li
-00069380: 7374 2873 6574 2867 645f 6368 7273 2b72  st(set(gd_chrs+r
-00069390: 735f 6368 7273 2929 0a20 2020 2020 2020  s_chrs)).       
-000693a0: 200a 2020 2020 6764 5f63 6872 7320 3d20   .    gd_chrs = 
-000693b0: 6e70 2e61 7272 6179 2867 645f 6368 7273  np.array(gd_chrs
-000693c0: 290a 2020 2020 7273 5f63 6872 7320 3d20  ).    rs_chrs = 
-000693d0: 6e70 2e61 7272 6179 2872 735f 6368 7273  np.array(rs_chrs
-000693e0: 290a 2020 2020 0a20 2020 2067 645f 6c73  ).    .    gd_ls
-000693f0: 745f 6f75 7420 3d20 5b5d 0a20 2020 2072  t_out = [].    r
-00069400: 735f 6d5f 6c73 745f 6f75 7420 3d20 5b5d  s_m_lst_out = []
-00069410: 0a20 2020 2072 735f 6e64 5f6c 7374 5f6f  .    rs_nd_lst_o
-00069420: 7574 203d 205b 5d0a 2020 2020 7273 5f73  ut = [].    rs_s
-00069430: 7469 5f6c 7374 5f6f 7574 203d 205b 5d0a  ti_lst_out = [].
-00069440: 0a20 2020 2073 7461 7274 5f74 696d 6531  .    start_time1
-00069450: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
-00069460: 2020 200a 2020 2020 6e67 5f75 6e6d 6170     .    ng_unmap
-00069470: 7065 6420 3d20 300a 2020 2020 6e72 5f75  ped = 0.    nr_u
-00069480: 6e6d 6170 7065 6420 3d20 300a 0a20 2020  nmapped = 0..   
-00069490: 2074 6f5f 6465 6c5f 6720 3d20 5b5d 0a20   to_del_g = []. 
-000694a0: 2020 2074 6f5f 6465 6c5f 7220 3d20 5b5d     to_del_r = []
-000694b0: 0a20 2020 200a 2020 2020 6966 206e 5f63  .    .    if n_c
-000694c0: 6f72 6573 203d 3d20 303a 0a20 2020 2020  ores == 0:.     
-000694d0: 2020 2061 7267 5f6c 7374 203d 205b 5d0a     arg_lst = [].
-000694e0: 2020 2020 2020 2020 666f 7220 6b2c 2063          for k, c
-000694f0: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
-00069500: 7273 293a 0a20 2020 2020 2020 2020 2020  rs):.           
-00069510: 2067 645f 7365 6c5f 6964 7820 3d20 7768   gd_sel_idx = wh
-00069520: 6963 6828 6764 5f63 6872 7320 3d3d 2063  ich(gd_chrs == c
-00069530: 290a 2020 2020 2020 2020 2020 2020 7273  ).            rs
-00069540: 5f73 656c 5f69 6478 203d 2077 6869 6368  _sel_idx = which
-00069550: 2872 735f 6368 7273 203d 3d20 6329 0a0a  (rs_chrs == c)..
-00069560: 2020 2020 2020 2020 2020 2020 6764 5f73              gd_s
-00069570: 656c 203d 205b 6764 5f6c 7374 5b77 5d20  el = [gd_lst[w] 
-00069580: 666f 7220 7720 696e 2067 645f 7365 6c5f  for w in gd_sel_
-00069590: 6964 785d 0a20 2020 2020 2020 2020 2020  idx].           
-000695a0: 2072 736d 5f73 656c 203d 205b 7267 6e73   rsm_sel = [rgns
-000695b0: 5f6c 7374 5f6d 695b 775d 2066 6f72 2077  _lst_mi[w] for w
-000695c0: 2069 6e20 7273 5f73 656c 5f69 6478 5d0a   in rs_sel_idx].
-000695d0: 2020 2020 2020 2020 2020 2020 7273 6e64              rsnd
-000695e0: 5f73 656c 203d 205b 7267 6e73 5f6c 7374  _sel = [rgns_lst
-000695f0: 5f6e 645b 775d 2066 6f72 2077 2069 6e20  _nd[w] for w in 
-00069600: 7273 5f73 656c 5f69 6478 5d0a 2020 2020  rs_sel_idx].    
-00069610: 2020 2020 2020 2020 7273 7374 695f 7365          rssti_se
-00069620: 6c20 3d20 5b72 676e 735f 6c73 745f 7374  l = [rgns_lst_st
-00069630: 695b 775d 2066 6f72 2077 2069 6e20 7273  i[w] for w in rs
-00069640: 5f73 656c 5f69 6478 5d0a 0a20 2020 2020  _sel_idx]..     
-00069650: 2020 2020 2020 2061 7267 5f6c 7374 2e61         arg_lst.a
-00069660: 7070 656e 6428 2028 6764 5f73 656c 2c20  ppend( (gd_sel, 
-00069670: 7273 6d5f 7365 6c2c 2072 736e 645f 7365  rsm_sel, rsnd_se
-00069680: 6c2c 2072 7373 7469 5f73 656c 2c20 6764  l, rssti_sel, gd
-00069690: 5f73 656c 5f69 6478 2c20 7273 5f73 656c  _sel_idx, rs_sel
-000696a0: 5f69 6478 2920 290a 0a20 2020 2020 2020  _idx) )..       
-000696b0: 2064 656c 2067 645f 6c73 740a 2020 2020   del gd_lst.    
-000696c0: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
-000696d0: 5f6d 690a 2020 2020 2020 2020 6465 6c20  _mi.        del 
-000696e0: 7267 6e73 5f6c 7374 5f6e 640a 2020 2020  rgns_lst_nd.    
-000696f0: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
-00069700: 5f73 7469 0a20 2020 2020 2020 200a 2020  _sti.        .  
-00069710: 2020 2020 2020 6e75 6d5f 636f 7265 203d        num_core =
-00069720: 206d 696e 2820 6e5f 636f 7265 732c 2028   min( n_cores, (
-00069730: 6370 755f 636f 756e 7428 2920 2d20 3129  cpu_count() - 1)
-00069740: 2029 0a20 2020 2020 2020 2070 6f6f 6c20   ).        pool 
-00069750: 3d20 506f 6f6c 286e 756d 5f63 6f72 6529  = Pool(num_core)
-00069760: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00069770: 6e75 6d20 636f 7265 7320 746f 2075 7365  num cores to use
-00069780: 203d 2025 6927 2025 206e 5f63 6f72 6573   = %i' % n_cores
-00069790: 290a 0a20 2020 2020 2020 2063 6e74 203d  )..        cnt =
-000697a0: 2030 0a20 2020 2020 2020 2066 6f72 2067   0.        for g
-000697b0: 2c20 726d 2c20 726e 642c 2072 7374 692c  , rm, rnd, rsti,
-000697c0: 206e 672c 206e 722c 2074 6467 2c20 7464   ng, nr, tdg, td
-000697d0: 7220 696e 2070 6f6f 6c2e 696d 6170 5f75  r in pool.imap_u
-000697e0: 6e6f 7264 6572 6564 286d 635f 636f 7265  nordered(mc_core
-000697f0: 5f6d 6170 7069 6e67 2c20 6172 675f 6c73  _mapping, arg_ls
-00069800: 7429 3a0a 0a20 2020 2020 2020 2020 2020  t):..           
-00069810: 2074 6f5f 6465 6c5f 6720 3d20 746f 5f64   to_del_g = to_d
-00069820: 656c 5f67 202b 2074 6467 0a20 2020 2020  el_g + tdg.     
-00069830: 2020 2020 2020 2074 6f5f 6465 6c5f 7220         to_del_r 
-00069840: 3d20 746f 5f64 656c 5f72 202b 2074 6472  = to_del_r + tdr
-00069850: 0a0a 2020 2020 2020 2020 2020 2020 6764  ..            gd
-00069860: 5f6c 7374 5f6f 7574 203d 2067 645f 6c73  _lst_out = gd_ls
-00069870: 745f 6f75 7420 2b20 670a 2020 2020 2020  t_out + g.      
-00069880: 2020 2020 2020 7273 5f6d 5f6c 7374 5f6f        rs_m_lst_o
-00069890: 7574 203d 2072 735f 6d5f 6c73 745f 6f75  ut = rs_m_lst_ou
-000698a0: 7420 2b20 726d 0a20 2020 2020 2020 2020  t + rm.         
-000698b0: 2020 2072 735f 6e64 5f6c 7374 5f6f 7574     rs_nd_lst_out
-000698c0: 203d 2072 735f 6e64 5f6c 7374 5f6f 7574   = rs_nd_lst_out
-000698d0: 202b 2072 6e64 0a20 2020 2020 2020 2020   + rnd.         
-000698e0: 2020 2072 735f 7374 695f 6c73 745f 6f75     rs_sti_lst_ou
-000698f0: 7420 3d20 7273 5f73 7469 5f6c 7374 5f6f  t = rs_sti_lst_o
-00069900: 7574 202b 2072 7374 690a 0a20 2020 2020  ut + rsti..     
-00069910: 2020 2020 2020 206e 675f 756e 6d61 7070         ng_unmapp
-00069920: 6564 202b 3d20 6e67 0a20 2020 2020 2020  ed += ng.       
-00069930: 2020 2020 206e 725f 756e 6d61 7070 6564       nr_unmapped
-00069940: 202b 3d20 6e72 0a20 2020 2020 2020 2020   += nr.         
-00069950: 2020 2063 6e74 202b 3d20 310a 0a20 2020     cnt += 1..   
-00069960: 2020 2020 2020 2020 2069 6620 7665 7262           if verb
-00069970: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
-00069980: 2020 2020 2070 7269 6e74 2827 5c72 4d61       print('\rMa
-00069990: 7070 696e 6720 2569 2f25 6927 2025 2028  pping %i/%i' % (
-000699a0: 636e 742c 6c65 6e28 6368 7273 2929 2c20  cnt,len(chrs)), 
-000699b0: 656e 643d 2720 2020 2027 2c20 666c 7573  end='    ', flus
-000699c0: 6820 3d20 5472 7565 2029 0a0a 2020 2020  h = True )..    
-000699d0: 2020 2020 6465 6c20 6172 675f 6c73 740a      del arg_lst.
-000699e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000699f0: 2070 6f6f 6c2e 636c 6f73 6528 290a 2020   pool.close().  
-00069a00: 2020 2020 2020 706f 6f6c 2e6a 6f69 6e28        pool.join(
-00069a10: 290a 2020 2020 2020 2020 0a20 2020 2065  ).        .    e
-00069a20: 6c73 653a 0a20 2020 2020 2020 2066 6f72  lse:.        for
-00069a30: 206b 2c20 6320 696e 2065 6e75 6d65 7261   k, c in enumera
-00069a40: 7465 2863 6872 7329 3a0a 2020 2020 2020  te(chrs):.      
-00069a50: 2020 2020 2020 6764 5f73 656c 5f69 6478        gd_sel_idx
-00069a60: 203d 2077 6869 6368 2867 645f 6368 7273   = which(gd_chrs
-00069a70: 203d 3d20 6329 0a20 2020 2020 2020 2020   == c).         
-00069a80: 2020 2072 735f 7365 6c5f 6964 7820 3d20     rs_sel_idx = 
-00069a90: 7768 6963 6828 7273 5f63 6872 7320 3d3d  which(rs_chrs ==
-00069aa0: 2063 290a 0a20 2020 2020 2020 2020 2020   c)..           
-00069ab0: 2067 645f 7365 6c20 3d20 5b67 645f 6c73   gd_sel = [gd_ls
-00069ac0: 745b 775d 2066 6f72 2077 2069 6e20 6764  t[w] for w in gd
-00069ad0: 5f73 656c 5f69 6478 5d0a 2020 2020 2020  _sel_idx].      
-00069ae0: 2020 2020 2020 7273 6d5f 7365 6c20 3d20        rsm_sel = 
-00069af0: 5b72 676e 735f 6c73 745f 6d69 5b77 5d20  [rgns_lst_mi[w] 
-00069b00: 666f 7220 7720 696e 2072 735f 7365 6c5f  for w in rs_sel_
-00069b10: 6964 785d 0a20 2020 2020 2020 2020 2020  idx].           
-00069b20: 2072 736e 645f 7365 6c20 3d20 5b72 676e   rsnd_sel = [rgn
-00069b30: 735f 6c73 745f 6e64 5b77 5d20 666f 7220  s_lst_nd[w] for 
-00069b40: 7720 696e 2072 735f 7365 6c5f 6964 785d  w in rs_sel_idx]
-00069b50: 0a20 2020 2020 2020 2020 2020 2072 7373  .            rss
-00069b60: 7469 5f73 656c 203d 205b 7267 6e73 5f6c  ti_sel = [rgns_l
-00069b70: 7374 5f73 7469 5b77 5d20 666f 7220 7720  st_sti[w] for w 
-00069b80: 696e 2072 735f 7365 6c5f 6964 785d 0a0a  in rs_sel_idx]..
-00069b90: 2020 2020 2020 2020 2020 2020 672c 2072              g, r
-00069ba0: 6d2c 2072 6e64 2c20 7273 7469 2c20 6e67  m, rnd, rsti, ng
-00069bb0: 2c20 6e72 2c20 7464 672c 2074 6472 203d  , nr, tdg, tdr =
-00069bc0: 2063 6f6d 6269 6e65 5f67 656e 6573 5f61   combine_genes_a
-00069bd0: 6e64 5f72 676e 735f 7065 725f 6368 7228  nd_rgns_per_chr(
-00069be0: 2067 645f 7365 6c2c 2072 736d 5f73 656c   gd_sel, rsm_sel
-00069bf0: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00069c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c30: 2020 2072 736e 645f 7365 6c2c 2072 7373     rsnd_sel, rss
-00069c40: 7469 5f73 656c 2c20 5c0a 2020 2020 2020  ti_sel, \.      
-00069c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c80: 2020 2020 2020 2020 2076 6572 626f 7365           verbose
-00069c90: 203d 2046 616c 7365 2029 0a20 2020 2020   = False ).     
-00069ca0: 2020 2020 2020 2074 6f5f 6465 6c5f 6720         to_del_g 
-00069cb0: 3d20 746f 5f64 656c 5f67 202b 205b 6764  = to_del_g + [gd
-00069cc0: 5f73 656c 5f69 6478 5b6d 5d20 666f 7220  _sel_idx[m] for 
-00069cd0: 6d20 696e 2074 6467 5d0a 2020 2020 2020  m in tdg].      
-00069ce0: 2020 2020 2020 746f 5f64 656c 5f72 203d        to_del_r =
-00069cf0: 2074 6f5f 6465 6c5f 7220 2b20 5b72 735f   to_del_r + [rs_
-00069d00: 7365 6c5f 6964 785b 6d5d 2066 6f72 206d  sel_idx[m] for m
-00069d10: 2069 6e20 7464 725d 0a0a 2020 2020 2020   in tdr]..      
-00069d20: 2020 2020 2020 6764 5f6c 7374 5f6f 7574        gd_lst_out
-00069d30: 203d 2067 645f 6c73 745f 6f75 7420 2b20   = gd_lst_out + 
-00069d40: 670a 2020 2020 2020 2020 2020 2020 7273  g.            rs
-00069d50: 5f6d 5f6c 7374 5f6f 7574 203d 2072 735f  _m_lst_out = rs_
-00069d60: 6d5f 6c73 745f 6f75 7420 2b20 726d 0a20  m_lst_out + rm. 
-00069d70: 2020 2020 2020 2020 2020 2072 735f 6e64             rs_nd
-00069d80: 5f6c 7374 5f6f 7574 203d 2072 735f 6e64  _lst_out = rs_nd
-00069d90: 5f6c 7374 5f6f 7574 202b 2072 6e64 0a20  _lst_out + rnd. 
-00069da0: 2020 2020 2020 2020 2020 2072 735f 7374             rs_st
-00069db0: 695f 6c73 745f 6f75 7420 3d20 7273 5f73  i_lst_out = rs_s
-00069dc0: 7469 5f6c 7374 5f6f 7574 202b 2072 7374  ti_lst_out + rst
-00069dd0: 690a 0a20 2020 2020 2020 2020 2020 206e  i..            n
-00069de0: 675f 756e 6d61 7070 6564 202b 3d20 6e67  g_unmapped += ng
-00069df0: 0a20 2020 2020 2020 2020 2020 206e 725f  .            nr_
-00069e00: 756e 6d61 7070 6564 202b 3d20 6e72 0a0a  unmapped += nr..
-00069e10: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00069e20: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
-00069e30: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-00069e40: 724d 6170 7069 6e67 2025 692f 2569 2720  rMapping %i/%i' 
-00069e50: 2520 286b 2c6c 656e 2863 6872 7329 292c  % (k,len(chrs)),
-00069e60: 2065 6e64 3d27 2020 2020 272c 2066 6c75   end='    ', flu
-00069e70: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
-00069e80: 0a20 2020 2020 2020 2064 656c 2067 645f  .        del gd_
-00069e90: 6c73 740a 2020 2020 2020 2020 6465 6c20  lst.        del 
-00069ea0: 7267 6e73 5f6c 7374 5f6d 690a 2020 2020  rgns_lst_mi.    
-00069eb0: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
-00069ec0: 5f6e 640a 2020 2020 2020 2020 6465 6c20  _nd.        del 
-00069ed0: 7267 6e73 5f6c 7374 5f73 7469 0a20 2020  rgns_lst_sti.   
-00069ee0: 2020 2020 200a 2020 2020 656c 6170 7365       .    elapse
-00069ef0: 645f 7469 6d65 3120 3d20 7469 6d65 2e74  d_time1 = time.t
-00069f00: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
-00069f10: 6d65 310a 2020 2020 6966 2076 6572 626f  me1.    if verbo
-00069f20: 7365 3a20 7072 696e 7428 275c 724d 6170  se: print('\rMap
-00069f30: 7069 6e67 2025 6920 6368 7273 202e 2e2e  ping %i chrs ...
-00069f40: 2064 6f6e 652e 2025 6928 7329 2720 2520   done. %i(s)' % 
-00069f50: 286c 656e 2863 6872 7329 2c65 6c61 7073  (len(chrs),elaps
-00069f60: 6564 5f74 696d 6531 2920 290a 2020 2020  ed_time1) ).    
-00069f70: 2020 2020 0a20 2020 2069 6620 6e67 203e      .    if ng >
-00069f80: 2030 3a0a 2020 2020 2020 2020 7072 696e   0:.        prin
-00069f90: 7428 2720 2020 2569 2067 656e 6573 2069  t('   %i genes i
-00069fa0: 6e20 7468 6520 4754 462f 4746 4620 646f  n the GTF/GFF do
-00069fb0: 206e 6f74 2068 6176 6520 6d61 7070 6564   not have mapped
-00069fc0: 2072 6561 6473 2e27 2025 206e 675f 756e   reads.' % ng_un
-00069fd0: 6d61 7070 6564 2029 0a20 2020 2069 6620  mapped ).    if 
-00069fe0: 6e72 203e 2030 3a0a 2020 2020 2020 2020  nr > 0:.        
-00069ff0: 7072 696e 7428 2720 2020 2569 2063 6875  print('   %i chu
-0006a000: 6e6b 7320 6172 6520 6f75 7420 6f66 2067  nks are out of g
-0006a010: 656e 6520 6c6f 6369 2069 6e20 4754 462f  ene loci in GTF/
-0006a020: 4746 462e 2720 2520 6e72 5f75 6e6d 6170  GFF.' % nr_unmap
-0006a030: 7065 6420 290a 2020 2020 2020 2020 0a20  ped ).        . 
-0006a040: 2020 2027 2727 0a20 2020 2069 6620 6c65     '''.    if le
-0006a050: 6e28 746f 5f64 656c 5f72 2920 3e20 303a  n(to_del_r) > 0:
-0006a060: 0a20 2020 2020 2020 2074 6f5f 6465 6c5f  .        to_del_
-0006a070: 722e 736f 7274 2872 6576 6572 7365 3d54  r.sort(reverse=T
-0006a080: 7275 6529 0a20 2020 2020 2020 2066 6f72  rue).        for
-0006a090: 2072 6920 696e 2074 6f5f 6465 6c5f 723a   ri in to_del_r:
-0006a0a0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-0006a0b0: 2072 676e 735f 6c73 745f 6d69 5b72 695d   rgns_lst_mi[ri]
-0006a0c0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-0006a0d0: 2072 676e 735f 6c73 745f 6e64 5b72 695d   rgns_lst_nd[ri]
-0006a0e0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-0006a0f0: 2072 676e 735f 6c73 745f 7374 695b 7269   rgns_lst_sti[ri
-0006a100: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
-0006a110: 2020 2069 6620 6c65 6e28 746f 5f64 656c     if len(to_del
-0006a120: 5f67 2920 3e20 303a 0a20 2020 2020 2020  _g) > 0:.       
-0006a130: 2074 6f5f 6465 6c5f 672e 736f 7274 2872   to_del_g.sort(r
-0006a140: 6576 6572 7365 3d54 7275 6529 0a20 2020  everse=True).   
-0006a150: 2020 2020 2066 6f72 2067 6920 696e 2074       for gi in t
-0006a160: 6f5f 6465 6c5f 673a 0a20 2020 2020 2020  o_del_g:.       
-0006a170: 2020 2020 2064 656c 2067 645f 6c73 745b       del gd_lst[
-0006a180: 6769 5d0a 2020 2020 2727 270a 2020 2020  gi].    '''.    
-0006a190: 2020 2020 2020 2020 0a20 2020 2072 6574          .    ret
-0006a1a0: 7572 6e20 6764 5f6c 7374 5f6f 7574 2c20  urn gd_lst_out, 
-0006a1b0: 7273 5f6d 5f6c 7374 5f6f 7574 2c20 7273  rs_m_lst_out, rs
-0006a1c0: 5f6e 645f 6c73 745f 6f75 742c 2072 735f  _nd_lst_out, rs_
-0006a1d0: 7374 695f 6c73 745f 6f75 740a 0a0a 2323  sti_lst_out...##
-0006a1e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a1f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a220: 2323 2323 2323 2323 0a23 2320 4675 6e63  ########.## Func
-0006a230: 7469 6f6e 7320 746f 2066 696e 6420 636f  tions to find co
-0006a240: 6469 6e67 2072 6567 696f 6e73 2061 6e64  ding regions and
-0006a250: 2074 6f20 6765 6e65 7261 7465 2070 726f   to generate pro
-0006a260: 7465 6f6d 650a 2323 2323 2323 2323 2323  teome.##########
-0006a270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a280: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a2a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a2b0: 0a0a 4241 5345 5320 3d20 2754 4341 4727  ..BASES = 'TCAG'
-0006a2c0: 2023 2022 7463 6167 220a 434f 444f 4e53   # "tcag".CODONS
-0006a2d0: 203d 205b 6120 2b20 6220 2b20 6320 666f   = [a + b + c fo
-0006a2e0: 7220 6120 696e 2042 4153 4553 2066 6f72  r a in BASES for
-0006a2f0: 2062 2069 6e20 4241 5345 5320 666f 7220   b in BASES for 
-0006a300: 6320 696e 2042 4153 4553 5d0a 414d 494e  c in BASES].AMIN
-0006a310: 4f5f 4143 4944 5320 3d20 2746 464c 4c53  O_ACIDS = 'FFLLS
-0006a320: 5353 5359 592a 2a43 432a 574c 4c4c 4c50  SSSYY**CC*WLLLLP
-0006a330: 5050 5048 4851 5152 5252 5249 4949 4d54  PPPHHQQRRRRIIIMT
-0006a340: 5454 544e 4e4b 4b53 5352 5256 5656 5641  TTTNNKKSSRRVVVVA
-0006a350: 4141 4144 4445 4547 4747 4727 0a63 6f64  AAADDEEGGGG'.cod
-0006a360: 6f6e 5f74 6162 6c65 203d 2064 6963 7428  on_table = dict(
-0006a370: 7a69 7028 434f 444f 4e53 2c20 414d 494e  zip(CODONS, AMIN
-0006a380: 4f5f 4143 4944 5329 290a 5354 4152 545f  O_ACIDS)).START_
-0006a390: 434f 444f 4e20 3d20 2741 5447 270a 7263  CODON = 'ATG'.rc
-0006a3a0: 5f53 5441 5254 5f43 4f44 4f4e 203d 2027  _START_CODON = '
-0006a3b0: 4341 5427 0a53 544f 505f 434f 444f 4e53  CAT'.STOP_CODONS
-0006a3c0: 203d 205b 2754 4141 272c 2754 4147 272c   = ['TAA','TAG',
-0006a3d0: 2754 4741 275d 0a72 635f 5354 4f50 5f43  'TGA'].rc_STOP_C
-0006a3e0: 4f44 4f4e 5320 3d20 5b27 5454 4127 2c27  ODONS = ['TTA','
-0006a3f0: 4354 4127 2c27 5443 4127 5d0a 7265 765f  CTA','TCA'].rev_
-0006a400: 636f 6d70 5f74 6162 6c65 203d 207b 2741  comp_table = {'A
-0006a410: 273a 2754 272c 2027 4327 3a20 2747 272c  ':'T', 'C': 'G',
-0006a420: 2027 4727 3a27 4327 2c20 2754 273a 2741   'G':'C', 'T':'A
-0006a430: 272c 2027 4e27 3a20 274e 277d 0a0a 6465  ', 'N': 'N'}..de
-0006a440: 6620 7472 616e 736c 6174 6528 7365 7129  f translate(seq)
-0006a450: 3a0a 2020 2020 7365 7120 3d20 7365 712e  :.    seq = seq.
-0006a460: 7570 7065 7228 292e 7265 706c 6163 6528  upper().replace(
-0006a470: 275c 6e27 2c20 2727 292e 7265 706c 6163  '\n', '').replac
-0006a480: 6528 2720 272c 2027 2729 0a20 2020 2070  e(' ', '').    p
-0006a490: 6570 7469 6465 203d 2027 270a 2020 2020  eptide = ''.    
-0006a4a0: 0a20 2020 2066 6f72 2069 2069 6e20 7261  .    for i in ra
-0006a4b0: 6e67 6528 302c 206c 656e 2873 6571 292c  nge(0, len(seq),
-0006a4c0: 2033 293a 0a20 2020 2020 2020 2063 6f64   3):.        cod
-0006a4d0: 6f6e 203d 2073 6571 5b69 3a20 692b 335d  on = seq[i: i+3]
-0006a4e0: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
-0006a4f0: 2020 2020 2069 6620 636f 646f 6e2e 636f       if codon.co
-0006a500: 756e 7428 274e 2729 203d 3d20 303a 0a20  unt('N') == 0:. 
-0006a510: 2020 2020 2020 2020 2020 2061 6d69 6e6f             amino
-0006a520: 5f61 6369 6420 3d20 636f 646f 6e5f 7461  _acid = codon_ta
-0006a530: 626c 652e 6765 7428 636f 646f 6e2c 2027  ble.get(codon, '
-0006a540: 2a27 290a 2020 2020 2020 2020 656c 7365  *').        else
-0006a550: 3a0a 2020 2020 2020 2020 2020 2020 616d  :.            am
-0006a560: 696e 6f5f 6163 6964 203d 2027 2a27 0a20  ino_acid = '*'. 
-0006a570: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
-0006a580: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
-0006a590: 616d 696e 6f5f 6163 6964 203d 2063 6f64  amino_acid = cod
-0006a5a0: 6f6e 5f74 6162 6c65 2e67 6574 2863 6f64  on_table.get(cod
-0006a5b0: 6f6e 2c20 272a 2729 0a20 2020 2020 2020  on, '*').       
-0006a5c0: 2023 6966 2061 6d69 6e6f 5f61 6369 6420   #if amino_acid 
-0006a5d0: 213d 2027 2a27 3a0a 2020 2020 2020 2020  != '*':.        
-0006a5e0: 7065 7074 6964 6520 2b3d 2061 6d69 6e6f  peptide += amino
-0006a5f0: 5f61 6369 640a 2020 2020 2020 2020 2320  _acid.        # 
-0006a600: 656c 7365 3a20 6272 6561 6b0a 2020 2020  else: break.    
-0006a610: 2020 2020 2327 2727 0a20 2020 2020 2020      #'''.       
-0006a620: 2020 2020 2020 2020 200a 2020 2020 7265           .    re
-0006a630: 7475 726e 2070 6570 7469 6465 0a0a 6465  turn peptide..de
-0006a640: 6620 7265 7665 7273 655f 636f 6d70 6c65  f reverse_comple
-0006a650: 6d65 6e74 2873 6571 293a 0a20 2020 200a  ment(seq):.    .
-0006a660: 2020 2020 7263 5f73 6571 203d 2027 270a      rc_seq = ''.
-0006a670: 2020 2020 4b65 7973 203d 2072 6576 5f63      Keys = rev_c
-0006a680: 6f6d 705f 7461 626c 652e 6b65 7973 2829  omp_table.keys()
-0006a690: 0a20 2020 2066 6f72 206b 2069 6e20 7265  .    for k in re
-0006a6a0: 7665 7273 6564 2872 616e 6765 286c 656e  versed(range(len
-0006a6b0: 2873 6571 2929 293a 0a20 2020 2020 2020  (seq))):.       
-0006a6c0: 2069 6620 7365 715b 6b5d 2069 6e20 4b65   if seq[k] in Ke
-0006a6d0: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
-0006a6e0: 7263 5f73 6571 203d 2072 635f 7365 7120  rc_seq = rc_seq 
-0006a6f0: 2b20 7265 765f 636f 6d70 5f74 6162 6c65  + rev_comp_table
-0006a700: 5b73 6571 5b6b 5d5d 0a20 2020 2020 2020  [seq[k]].       
-0006a710: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0006a720: 2020 2072 635f 7365 7120 3d20 7263 5f73     rc_seq = rc_s
-0006a730: 6571 202b 2027 4e27 0a20 2020 2072 6574  eq + 'N'.    ret
-0006a740: 7572 6e20 7263 5f73 6571 0a20 2020 200a  urn rc_seq.    .
-0006a750: 6465 6620 6669 6e64 5f61 6c6c 5f73 5f69  def find_all_s_i
-0006a760: 6e5f 7374 7228 7374 722c 7329 3a0a 2020  n_str(str,s):.  
-0006a770: 2020 0a20 2020 2070 6f73 5f6c 7374 203d    .    pos_lst =
-0006a780: 205b 5d0a 2020 2020 7374 6172 7420 3d20   [].    start = 
-0006a790: 300a 2020 2020 7768 696c 6520 5472 7565  0.    while True
-0006a7a0: 3a0a 2020 2020 2020 2020 706f 7320 3d20  :.        pos = 
-0006a7b0: 7374 722e 6669 6e64 2873 2c20 7374 6172  str.find(s, star
-0006a7c0: 7429 0a20 2020 2020 2020 2069 6620 706f  t).        if po
-0006a7d0: 7320 3c20 303a 2062 7265 616b 0a20 2020  s < 0: break.   
-0006a7e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0006a7f0: 2020 2020 2020 2070 6f73 5f6c 7374 2e61         pos_lst.a
-0006a800: 7070 656e 6428 706f 7329 0a20 2020 2020  ppend(pos).     
-0006a810: 2020 2020 2020 2073 7461 7274 203d 2070         start = p
-0006a820: 6f73 2b31 0a20 2020 2020 2020 2069 6620  os+1.        if 
-0006a830: 7374 6172 742b 3320 3e3d 206c 656e 2873  start+3 >= len(s
-0006a840: 7472 293a 2062 7265 616b 0a20 2020 2020  tr): break.     
-0006a850: 2020 2020 2020 200a 2020 2020 7265 7475         .    retu
-0006a860: 726e 2070 6f73 5f6c 7374 0a0a 6465 6620  rn pos_lst..def 
-0006a870: 6368 6563 6b5f 6f72 665f 636f 6e64 6974  check_orf_condit
-0006a880: 696f 6e5f 666f 7277 6172 645f 6672 6f6d  ion_forward_from
-0006a890: 5f73 7461 7274 2874 7365 7129 3a0a 2020  _start(tseq):.  
-0006a8a0: 2020 0a20 2020 2073 7461 7274 203d 202d    .    start = -
-0006a8b0: 310a 2020 2020 7374 6f70 203d 202d 310a  1.    stop = -1.
-0006a8c0: 2020 2020 7373 5f6c 7374 203d 205b 5d0a      ss_lst = [].
-0006a8d0: 2020 2020 706f 735f 6c73 7420 3d20 6669      pos_lst = fi
-0006a8e0: 6e64 5f61 6c6c 5f73 5f69 6e5f 7374 7228  nd_all_s_in_str(
-0006a8f0: 7473 6571 2c20 5354 4152 545f 434f 444f  tseq, START_CODO
-0006a900: 4e29 0a20 2020 2069 6620 6c65 6e28 706f  N).    if len(po
-0006a910: 735f 6c73 7429 203d 3d20 303a 0a20 2020  s_lst) == 0:.   
-0006a920: 2020 2020 2072 6574 7572 6e20 7374 6172       return star
-0006a930: 742c 2073 746f 702c 2073 735f 6c73 740a  t, stop, ss_lst.
-0006a940: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0006a950: 2020 666f 7220 706f 735f 7374 6172 7420    for pos_start 
-0006a960: 696e 2070 6f73 5f6c 7374 3a0a 2020 2020  in pos_lst:.    
-0006a970: 2020 2020 2020 2020 706f 735f 7374 6f70          pos_stop
-0006a980: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
-0006a990: 2020 6e5f 7374 6f70 7320 3d20 300a 2020    n_stops = 0.  
-0006a9a0: 2020 2020 2020 2020 2020 666f 7220 7020            for p 
-0006a9b0: 696e 2072 616e 6765 2870 6f73 5f73 7461  in range(pos_sta
-0006a9c0: 7274 2b33 2c6c 656e 2874 7365 7129 2d31  rt+3,len(tseq)-1
-0006a9d0: 2c20 3329 3a0a 2020 2020 2020 2020 2020  , 3):.          
-0006a9e0: 2020 2020 2020 656e 6470 203d 206d 696e        endp = min
-0006a9f0: 2870 2b33 2c6c 656e 2874 7365 7129 290a  (p+3,len(tseq)).
-0006aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aa10: 636f 646f 6e20 3d20 7473 6571 5b70 3a28  codon = tseq[p:(
-0006aa20: 702b 3329 5d0a 2020 2020 2020 2020 2020  p+3)].          
-0006aa30: 2020 2020 2020 6966 2063 6f64 6f6e 2069        if codon i
-0006aa40: 6e20 5354 4f50 5f43 4f44 4f4e 533a 0a20  n STOP_CODONS:. 
+000681b0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+000681c0: 2020 2069 6620 655f 6d61 785b 6d31 5d20     if e_max[m1] 
+000681d0: 3c20 7370 616e 322e 7374 6172 743a 206d  < span2.start: m
+000681e0: 3220 3d20 6d31 0a20 2020 2020 2020 2020  2 = m1.         
+000681f0: 2020 2020 2020 206d 3120 2d3d 2031 0a20         m1 -= 1. 
+00068200: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00068210: 6620 6d31 203c 2030 3a20 6272 6561 6b0a  f m1 < 0: break.
+00068220: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00068230: 2020 2020 2069 6620 286d 2b31 2920 3c20       if (m+1) < 
+00068240: 6c65 6e28 6764 5f6c 7374 293a 0a20 2020  len(gd_lst):.   
+00068250: 2020 2020 2020 2020 206d 3120 3d20 6d2b           m1 = m+
+00068260: 310a 2020 2020 2020 2020 2020 2020 7768  1.            wh
+00068270: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
+00068280: 2020 2020 2020 2020 2020 6966 2073 5f6d            if s_m
+00068290: 696e 5b6d 315d 203e 2073 7061 6e2e 656e  in[m1] > span.en
+000682a0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+000682b0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+000682c0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000682d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000682e0: 2020 2020 2020 2069 6620 6764 5f6c 7374         if gd_lst
+000682f0: 5b6d 315d 2e65 786f 6e73 2e68 6173 5f65  [m1].exons.has_e
+00068300: 7874 5f69 6e74 6572 7365 6374 696f 6e5f  xt_intersection_
+00068310: 7769 7468 2872 7329 3a0a 2020 2020 2020  with(rs):.      
+00068320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068330: 2020 725f 6c73 745b 6b5d 2e61 7070 656e    r_lst[k].appen
+00068340: 6428 6d31 290a 2020 2020 2020 2020 2020  d(m1).          
+00068350: 2020 2020 2020 2020 2020 2020 2020 675f                g_
+00068360: 6c73 745b 6d31 5d2e 6170 7065 6e64 286b  lst[m1].append(k
+00068370: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00068380: 2020 2069 6620 655f 6d61 785b 6d31 5d20     if e_max[m1] 
+00068390: 3c20 7370 616e 322e 7374 6172 743a 206d  < span2.start: m
+000683a0: 3220 3d20 6d31 0a20 2020 2020 2020 2020  2 = m1.         
+000683b0: 2020 2020 2020 206d 3120 2b3d 2031 0a20         m1 += 1. 
+000683c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000683d0: 6620 6d31 203e 3d20 6c65 6e28 6764 5f6c  f m1 >= len(gd_l
+000683e0: 7374 293a 2062 7265 616b 0a20 2020 2020  st): break.     
+000683f0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00068400: 2020 2020 6d20 3d20 6d32 202b 2031 0a20      m = m2 + 1. 
+00068410: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00068420: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
+00068430: 2020 2020 2020 2020 6966 206b 2531 3030          if k%100
+00068440: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00068450: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+00068460: 4d61 7070 696e 6720 2569 2f25 6927 2025  Mapping %i/%i' %
+00068470: 2028 6b2c 6c65 6e28 7267 6e73 5f6c 7374   (k,len(rgns_lst
+00068480: 5f6d 6929 292c 2065 6e64 3d27 2020 2020  _mi)), end='    
+00068490: 272c 2066 6c75 7368 203d 2054 7275 6520  ', flush = True 
+000684a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000684b0: 2020 0a20 2020 2065 6c61 7073 6564 5f74    .    elapsed_t
+000684c0: 696d 6531 203d 2074 696d 652e 7469 6d65  ime1 = time.time
+000684d0: 2829 202d 2073 7461 7274 5f74 696d 6531  () - start_time1
+000684e0: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
+000684f0: 2070 7269 6e74 2827 5c72 4d61 7070 696e   print('\rMappin
+00068500: 6720 2569 202e 2e2e 2064 6f6e 6520 2825  g %i ... done (%
+00068510: 6929 2027 2025 2028 6c65 6e28 7267 6e73  i) ' % (len(rgns
+00068520: 5f6c 7374 5f6d 6929 2c65 6c61 7073 6564  _lst_mi),elapsed
+00068530: 5f74 696d 6531 2920 290a 2020 2020 2327  _time1) ).    #'
+00068540: 2727 0a20 2020 200a 2020 2020 6270 7220  ''.    .    bpr 
+00068550: 3d20 6e70 2e6f 6e65 7328 6c65 6e28 7267  = np.ones(len(rg
+00068560: 6e73 5f6c 7374 5f6d 6929 290a 2020 2020  ns_lst_mi)).    
+00068570: 6270 6720 3d20 6e70 2e6f 6e65 7328 6c65  bpg = np.ones(le
+00068580: 6e28 6764 5f6c 7374 2929 0a0a 2020 2020  n(gd_lst))..    
+00068590: 7267 5f6c 7374 203d 205b 5d0a 2020 2020  rg_lst = [].    
+000685a0: 666f 7220 6b20 696e 2072 5f6c 7374 2e6b  for k in r_lst.k
+000685b0: 6579 7328 293a 0a20 2020 2020 2020 2067  eys():.        g
+000685c0: 6973 203d 2072 5f6c 7374 5b6b 5d0a 2020  is = r_lst[k].  
+000685d0: 2020 2020 2020 6966 2062 7072 5b6b 5d20        if bpr[k] 
+000685e0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+000685f0: 2072 6920 3d20 5b6b 5d0a 2020 2020 2020   ri = [k].      
+00068600: 2020 2020 2020 6769 7420 3d20 5b5d 0a20        git = []. 
+00068610: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00068620: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+00068630: 2020 2020 2020 2067 6974 203d 2073 6574         git = set
+00068640: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00068650: 2020 2066 6f72 2069 2069 6e20 7269 3a0a     for i in ri:.
+00068660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068670: 2020 2020 6966 2062 7072 5b69 5d20 3e20      if bpr[i] > 
+00068680: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00068690: 2020 2020 2020 2020 2020 2067 6974 203d             git =
+000686a0: 2067 6974 2e75 6e69 6f6e 2872 5f6c 7374   git.union(r_lst
+000686b0: 5b69 5d29 0a20 2020 2020 2020 2020 2020  [i]).           
+000686c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000686d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000686e0: 2020 2020 2020 2070 7269 6e74 2827 4552         print('ER
+000686f0: 524f 5220 2569 2c25 6927 2025 2028 6b2c  ROR %i,%i' % (k,
+00068700: 6929 290a 2020 2020 2020 2020 2020 2020  i)).            
+00068710: 2020 2020 6966 206c 656e 2867 6974 2920      if len(git) 
+00068720: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00068730: 2020 2020 2020 2020 2020 2320 7267 5f6c            # rg_l
+00068740: 7374 2e61 7070 656e 6428 2872 6974 2c5b  st.append((rit,[
+00068750: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+00068760: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00068770: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00068780: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00068790: 2020 2020 2020 2020 7269 7420 3d20 7365          rit = se
+000687a0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+000687b0: 2020 2020 2020 2020 666f 7220 6a20 696e          for j in
+000687c0: 2067 6974 3a0a 2020 2020 2020 2020 2020   git:.          
+000687d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000687e0: 2062 7067 5b6a 5d20 3e20 303a 0a20 2020   bpg[j] > 0:.   
+000687f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068800: 2020 2020 2020 2020 2072 6974 203d 2072           rit = r
+00068810: 6974 2e75 6e69 6f6e 2867 5f6c 7374 5b6a  it.union(g_lst[j
+00068820: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00068830: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00068840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00068850: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00068860: 6e74 2827 4552 524f 5220 2569 2c25 6927  nt('ERROR %i,%i'
+00068870: 2025 2028 6b2c 6a29 290a 0a20 2020 2020   % (k,j))..     
+00068880: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00068890: 6620 6c65 6e28 7269 7429 203d 3d20 6c65  f len(rit) == le
+000688a0: 6e28 7269 293a 0a20 2020 2020 2020 2020  n(ri):.         
+000688b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000688c0: 675f 6c73 742e 6170 7065 6e64 2828 7269  g_lst.append((ri
+000688d0: 742c 6769 7429 290a 2020 2020 2020 2020  t,git)).        
+000688e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000688f0: 666f 7220 6920 696e 2072 6974 3a20 6270  for i in rit: bp
+00068900: 725b 695d 203d 2030 0a20 2020 2020 2020  r[i] = 0.       
+00068910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068920: 2066 6f72 2069 2069 6e20 6769 743a 2062   for i in git: b
+00068930: 7067 5b69 5d20 3d20 300a 2020 2020 2020  pg[i] = 0.      
+00068940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068950: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+00068960: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00068970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00068980: 2020 2020 2020 2020 2020 7269 203d 2072            ri = r
+00068990: 6974 0a20 2020 2020 2020 0a20 2020 206d  it.       .    m
+000689a0: 6170 5f72 3267 203d 205b 5d20 2320 6e70  ap_r2g = [] # np
+000689b0: 2e66 756c 6c28 6c65 6e28 7267 5f6c 7374  .full(len(rg_lst
+000689c0: 292c 202d 3129 0a20 2020 2074 6f5f 6465  ), -1).    to_de
+000689d0: 6c5f 7220 3d20 5b5d 0a20 2020 2074 6f5f  l_r = [].    to_
+000689e0: 6465 6c5f 6720 3d20 5b5d 0a20 2020 2066  del_g = [].    f
+000689f0: 6f72 2072 6720 696e 2072 675f 6c73 743a  or rg in rg_lst:
+00068a00: 0a20 2020 2020 2020 2072 6973 203d 206c  .        ris = l
+00068a10: 6973 7428 7267 5b30 5d29 0a20 2020 2020  ist(rg[0]).     
+00068a20: 2020 2074 6774 203d 2072 6973 5b30 5d0a     tgt = ris[0].
+00068a30: 2020 2020 2020 2020 666f 7220 7269 2069          for ri i
+00068a40: 6e20 7269 735b 313a 5d3a 0a20 2020 2020  n ris[1:]:.     
+00068a50: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
+00068a60: 6d69 5b74 6774 5d2e 6d65 7267 6528 7267  mi[tgt].merge(rg
+00068a70: 6e73 5f6c 7374 5f6d 695b 7269 5d29 0a20  ns_lst_mi[ri]). 
+00068a80: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
+00068a90: 6c73 745f 6e64 5b74 6774 5d2e 6d65 7267  lst_nd[tgt].merg
+00068aa0: 6528 7267 6e73 5f6c 7374 5f6e 645b 7269  e(rgns_lst_nd[ri
+00068ab0: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+00068ac0: 676e 735f 6c73 745f 7374 695b 7467 745d  gns_lst_sti[tgt]
+00068ad0: 2e6d 6572 6765 2872 676e 735f 6c73 745f  .merge(rgns_lst_
+00068ae0: 7374 695b 7269 5d29 0a20 2020 2020 2020  sti[ri]).       
+00068af0: 2020 2020 2074 6f5f 6465 6c5f 722e 6170       to_del_r.ap
+00068b00: 7065 6e64 2872 6929 0a20 2020 2020 2020  pend(ri).       
+00068b10: 2020 2020 200a 2020 2020 2020 2020 7269       .        ri
+00068b20: 203d 2074 6774 0a20 2020 2020 2020 2067   = tgt.        g
+00068b30: 6973 203d 206c 6973 7428 7267 5b31 5d29  is = list(rg[1])
+00068b40: 0a20 2020 2020 2020 2074 6774 203d 2067  .        tgt = g
+00068b50: 6973 5b30 5d0a 2020 2020 2020 2020 666f  is[0].        fo
+00068b60: 7220 6769 2069 6e20 6769 735b 313a 5d3a  r gi in gis[1:]:
+00068b70: 0a20 2020 2020 2020 2020 2020 2067 645f  .            gd_
+00068b80: 6c73 745b 7467 745d 2e6d 6572 6765 2867  lst[tgt].merge(g
+00068b90: 645f 6c73 745b 6769 5d29 0a20 2020 2020  d_lst[gi]).     
+00068ba0: 2020 2020 2020 2074 6f5f 6465 6c5f 672e         to_del_g.
+00068bb0: 6170 7065 6e64 2867 6929 0a20 2020 2020  append(gi).     
+00068bc0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00068bd0: 6764 5f6c 7374 5b74 6774 5d2e 6765 745f  gd_lst[tgt].get_
+00068be0: 7370 616e 2829 0a20 2020 2020 2020 206d  span().        m
+00068bf0: 6170 5f72 3267 2e61 7070 656e 6428 2872  ap_r2g.append((r
+00068c00: 692c 2074 6774 2929 0a20 2020 2020 2020  i, tgt)).       
+00068c10: 200a 2020 2020 7267 6e73 5f6c 7374 5f6d   .    rgns_lst_m
+00068c20: 695f 6f75 7420 3d20 5b5d 0a20 2020 2072  i_out = [].    r
+00068c30: 676e 735f 6c73 745f 6e64 5f6f 7574 203d  gns_lst_nd_out =
+00068c40: 205b 5d20 0a20 2020 2072 676e 735f 6c73   [] .    rgns_ls
+00068c50: 745f 7374 695f 6f75 7420 3d20 5b5d 0a20  t_sti_out = []. 
+00068c60: 2020 2067 645f 6c73 745f 6f75 7420 3d20     gd_lst_out = 
+00068c70: 5b5d 0a20 2020 200a 2020 2020 666f 7220  [].    .    for 
+00068c80: 7269 2c20 6769 2069 6e20 6d61 705f 7232  ri, gi in map_r2
+00068c90: 673a 0a20 2020 2020 2020 2072 676e 735f  g:.        rgns_
+00068ca0: 6c73 745f 6d69 5f6f 7574 2e61 7070 656e  lst_mi_out.appen
+00068cb0: 6428 7267 6e73 5f6c 7374 5f6d 695b 7269  d(rgns_lst_mi[ri
+00068cc0: 5d29 0a20 2020 2020 2020 2072 676e 735f  ]).        rgns_
+00068cd0: 6c73 745f 6e64 5f6f 7574 2e61 7070 656e  lst_nd_out.appen
+00068ce0: 6428 7267 6e73 5f6c 7374 5f6e 645b 7269  d(rgns_lst_nd[ri
+00068cf0: 5d29 200a 2020 2020 2020 2020 7267 6e73  ]) .        rgns
+00068d00: 5f6c 7374 5f73 7469 5f6f 7574 2e61 7070  _lst_sti_out.app
+00068d10: 656e 6428 7267 6e73 5f6c 7374 5f73 7469  end(rgns_lst_sti
+00068d20: 5b72 695d 290a 2020 2020 2020 2020 6764  [ri]).        gd
+00068d30: 5f6c 7374 5f6f 7574 2e61 7070 656e 6428  _lst_out.append(
+00068d40: 6764 5f6c 7374 5b67 695d 290a 2020 2020  gd_lst[gi]).    
+00068d50: 2020 2020 0a20 2020 206e 6720 3d20 6e70      .    ng = np
+00068d60: 2e73 756d 2862 7067 203e 2030 290a 2020  .sum(bpg > 0).  
+00068d70: 2020 6e72 203d 206e 702e 7375 6d28 6270    nr = np.sum(bp
+00068d80: 7220 3e20 3029 0a20 2020 200a 2020 2020  r > 0).    .    
+00068d90: 2727 270a 2020 2020 7768 203d 2077 6869  '''.    wh = whi
+00068da0: 6368 2862 7072 203e 2030 290a 2020 2020  ch(bpr > 0).    
+00068db0: 7267 6e73 5f6c 7374 5f6d 695f 6f75 7420  rgns_lst_mi_out 
+00068dc0: 3d20 7267 6e73 5f6c 7374 5f6d 695f 6f75  = rgns_lst_mi_ou
+00068dd0: 7420 2b20 5b72 676e 735f 6c73 745f 6d69  t + [rgns_lst_mi
+00068de0: 5b77 5d20 666f 7220 7720 696e 2077 685d  [w] for w in wh]
+00068df0: 0a20 2020 2072 676e 735f 6c73 745f 6e64  .    rgns_lst_nd
+00068e00: 5f6f 7574 203d 2072 676e 735f 6c73 745f  _out = rgns_lst_
+00068e10: 6e64 5f6f 7574 202b 205b 7267 6e73 5f6c  nd_out + [rgns_l
+00068e20: 7374 5f6e 645b 775d 2066 6f72 2077 2069  st_nd[w] for w i
+00068e30: 6e20 7768 5d0a 2020 2020 7267 6e73 5f6c  n wh].    rgns_l
+00068e40: 7374 5f73 7469 5f6f 7574 203d 2072 676e  st_sti_out = rgn
+00068e50: 735f 6c73 745f 7374 695f 6f75 7420 2b20  s_lst_sti_out + 
+00068e60: 5b72 676e 735f 6c73 745f 7374 695b 775d  [rgns_lst_sti[w]
+00068e70: 2066 6f72 2077 2069 6e20 7768 5d0a 2020   for w in wh].  
+00068e80: 2020 6764 5f6c 7374 5f6f 7574 203d 2067    gd_lst_out = g
+00068e90: 645f 6c73 745f 6f75 7420 2b20 5b4e 6f6e  d_lst_out + [Non
+00068ea0: 6520 666f 7220 7720 696e 2077 685d 0a20  e for w in wh]. 
+00068eb0: 2020 2023 2727 270a 2020 2020 0a20 2020     #'''.    .   
+00068ec0: 2074 6f5f 6465 6c5f 7220 3d20 746f 5f64   to_del_r = to_d
+00068ed0: 656c 5f72 202b 2077 6869 6368 2862 7072  el_r + which(bpr
+00068ee0: 203e 2030 290a 2020 2020 746f 5f64 656c   > 0).    to_del
+00068ef0: 5f67 203d 2074 6f5f 6465 6c5f 6720 2b20  _g = to_del_g + 
+00068f00: 7768 6963 6828 6270 6720 3e20 3029 0a20  which(bpg > 0). 
+00068f10: 2020 2027 2727 0a20 2020 2069 6620 6c65     '''.    if le
+00068f20: 6e28 746f 5f64 656c 5f72 2920 3e20 303a  n(to_del_r) > 0:
+00068f30: 0a20 2020 2020 2020 2074 6f5f 6465 6c5f  .        to_del_
+00068f40: 722e 736f 7274 2872 6576 6572 7365 3d54  r.sort(reverse=T
+00068f50: 7275 6529 0a20 2020 2020 2020 2066 6f72  rue).        for
+00068f60: 2072 6920 696e 2074 6f5f 6465 6c5f 723a   ri in to_del_r:
+00068f70: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00068f80: 2072 676e 735f 6c73 745f 6d69 5b72 695d   rgns_lst_mi[ri]
+00068f90: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00068fa0: 2072 676e 735f 6c73 745f 6e64 5b72 695d   rgns_lst_nd[ri]
+00068fb0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00068fc0: 2072 676e 735f 6c73 745f 7374 695b 7269   rgns_lst_sti[ri
+00068fd0: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
+00068fe0: 2020 2069 6620 6c65 6e28 746f 5f64 656c     if len(to_del
+00068ff0: 5f67 2920 3e20 303a 0a20 2020 2020 2020  _g) > 0:.       
+00069000: 2074 6f5f 6465 6c5f 672e 736f 7274 2872   to_del_g.sort(r
+00069010: 6576 6572 7365 3d54 7275 6529 0a20 2020  everse=True).   
+00069020: 2020 2020 2066 6f72 2067 6920 696e 2074       for gi in t
+00069030: 6f5f 6465 6c5f 673a 0a20 2020 2020 2020  o_del_g:.       
+00069040: 2020 2020 2064 656c 2067 645f 6c73 745b       del gd_lst[
+00069050: 6769 5d0a 2020 2020 2327 2727 2020 2020  gi].    #'''    
+00069060: 2020 2020 0a20 2020 2064 656c 2072 5f6c      .    del r_l
+00069070: 7374 0a20 2020 2064 656c 2067 5f6c 7374  st.    del g_lst
+00069080: 0a20 2020 2064 656c 2072 675f 6c73 740a  .    del rg_lst.
+00069090: 2020 2020 0a20 2020 2066 6f72 2072 2069      .    for r i
+000690a0: 6e20 7267 6e73 5f6c 7374 5f6d 695f 6f75  n rgns_lst_mi_ou
+000690b0: 743a 2072 2e73 6574 5f63 7667 2829 0a20  t: r.set_cvg(). 
+000690c0: 2020 2066 6f72 2072 2069 6e20 7267 6e73     for r in rgns
+000690d0: 5f6c 7374 5f6e 645f 6f75 743a 2072 2e73  _lst_nd_out: r.s
+000690e0: 6574 5f63 7667 2829 0a20 2020 2066 6f72  et_cvg().    for
+000690f0: 2072 2069 6e20 7267 6e73 5f6c 7374 5f73   r in rgns_lst_s
+00069100: 7469 5f6f 7574 3a20 722e 7365 745f 6376  ti_out: r.set_cv
+00069110: 6728 290a 2020 2020 2020 2020 2020 2020  g().            
+00069120: 2020 2020 2020 2020 0a20 2020 2072 6574          .    ret
+00069130: 7572 6e20 6764 5f6c 7374 5f6f 7574 2c20  urn gd_lst_out, 
+00069140: 7267 6e73 5f6c 7374 5f6d 695f 6f75 742c  rgns_lst_mi_out,
+00069150: 2072 676e 735f 6c73 745f 6e64 5f6f 7574   rgns_lst_nd_out
+00069160: 2c20 7267 6e73 5f6c 7374 5f73 7469 5f6f  , rgns_lst_sti_o
+00069170: 7574 2c20 6e67 2c20 6e72 2c20 746f 5f64  ut, ng, nr, to_d
+00069180: 656c 5f67 2c20 746f 5f64 656c 5f72 0a23  el_g, to_del_r.#
+00069190: 2727 270a 2020 2020 0a0a 6465 6620 636f  '''.    ..def co
+000691a0: 6d62 696e 655f 6765 6e65 735f 616e 645f  mbine_genes_and_
+000691b0: 7267 6e73 2820 6764 5f6c 7374 2c20 7267  rgns( gd_lst, rg
+000691c0: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
+000691d0: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
+000691e0: 5f73 7469 2c20 6e5f 636f 7265 7320 3d20  _sti, n_cores = 
+000691f0: 312c 2076 6572 626f 7365 203d 2046 616c  1, verbose = Fal
+00069200: 7365 2029 3a0a 2020 2020 0a20 2020 2067  se ):.    .    g
+00069210: 645f 6368 7273 203d 205b 5d0a 2020 2020  d_chrs = [].    
+00069220: 666f 7220 6764 2069 6e20 6764 5f6c 7374  for gd in gd_lst
+00069230: 3a20 6764 5f63 6872 732e 6170 7065 6e64  : gd_chrs.append
+00069240: 2867 642e 6368 7229 0a20 2020 2020 2020  (gd.chr).       
+00069250: 200a 2020 2020 7273 5f63 6872 7320 3d20   .    rs_chrs = 
+00069260: 5b5d 0a20 2020 2066 6f72 2072 7320 696e  [].    for rs in
+00069270: 2072 676e 735f 6c73 745f 6d69 3a20 7273   rgns_lst_mi: rs
+00069280: 5f63 6872 732e 6170 7065 6e64 2872 732e  _chrs.append(rs.
+00069290: 7267 6e73 5b30 5d2e 6368 7229 0a0a 2020  rgns[0].chr)..  
+000692a0: 2020 6368 7273 203d 206c 6973 7428 7365    chrs = list(se
+000692b0: 7428 6764 5f63 6872 732b 7273 5f63 6872  t(gd_chrs+rs_chr
+000692c0: 7329 290a 2020 2020 2020 2020 0a20 2020  s)).        .   
+000692d0: 2067 645f 6368 7273 203d 206e 702e 6172   gd_chrs = np.ar
+000692e0: 7261 7928 6764 5f63 6872 7329 0a20 2020  ray(gd_chrs).   
+000692f0: 2072 735f 6368 7273 203d 206e 702e 6172   rs_chrs = np.ar
+00069300: 7261 7928 7273 5f63 6872 7329 0a20 2020  ray(rs_chrs).   
+00069310: 200a 2020 2020 6764 5f6c 7374 5f6f 7574   .    gd_lst_out
+00069320: 203d 205b 5d0a 2020 2020 7273 5f6d 5f6c   = [].    rs_m_l
+00069330: 7374 5f6f 7574 203d 205b 5d0a 2020 2020  st_out = [].    
+00069340: 7273 5f6e 645f 6c73 745f 6f75 7420 3d20  rs_nd_lst_out = 
+00069350: 5b5d 0a20 2020 2072 735f 7374 695f 6c73  [].    rs_sti_ls
+00069360: 745f 6f75 7420 3d20 5b5d 0a0a 2020 2020  t_out = []..    
+00069370: 7374 6172 745f 7469 6d65 3120 3d20 7469  start_time1 = ti
+00069380: 6d65 2e74 696d 6528 290a 2020 2020 0a20  me.time().    . 
+00069390: 2020 206e 675f 756e 6d61 7070 6564 203d     ng_unmapped =
+000693a0: 2030 0a20 2020 206e 725f 756e 6d61 7070   0.    nr_unmapp
+000693b0: 6564 203d 2030 0a0a 2020 2020 746f 5f64  ed = 0..    to_d
+000693c0: 656c 5f67 203d 205b 5d0a 2020 2020 746f  el_g = [].    to
+000693d0: 5f64 656c 5f72 203d 205b 5d0a 2020 2020  _del_r = [].    
+000693e0: 0a20 2020 2069 6620 6e5f 636f 7265 7320  .    if n_cores 
+000693f0: 3d3d 2030 3a0a 2020 2020 2020 2020 6172  == 0:.        ar
+00069400: 675f 6c73 7420 3d20 5b5d 0a20 2020 2020  g_lst = [].     
+00069410: 2020 2066 6f72 206b 2c20 6320 696e 2065     for k, c in e
+00069420: 6e75 6d65 7261 7465 2863 6872 7329 3a0a  numerate(chrs):.
+00069430: 2020 2020 2020 2020 2020 2020 6764 5f73              gd_s
+00069440: 656c 5f69 6478 203d 2077 6869 6368 2867  el_idx = which(g
+00069450: 645f 6368 7273 203d 3d20 6329 0a20 2020  d_chrs == c).   
+00069460: 2020 2020 2020 2020 2072 735f 7365 6c5f           rs_sel_
+00069470: 6964 7820 3d20 7768 6963 6828 7273 5f63  idx = which(rs_c
+00069480: 6872 7320 3d3d 2063 290a 0a20 2020 2020  hrs == c)..     
+00069490: 2020 2020 2020 2067 645f 7365 6c20 3d20         gd_sel = 
+000694a0: 5b67 645f 6c73 745b 775d 2066 6f72 2077  [gd_lst[w] for w
+000694b0: 2069 6e20 6764 5f73 656c 5f69 6478 5d0a   in gd_sel_idx].
+000694c0: 2020 2020 2020 2020 2020 2020 7273 6d5f              rsm_
+000694d0: 7365 6c20 3d20 5b72 676e 735f 6c73 745f  sel = [rgns_lst_
+000694e0: 6d69 5b77 5d20 666f 7220 7720 696e 2072  mi[w] for w in r
+000694f0: 735f 7365 6c5f 6964 785d 0a20 2020 2020  s_sel_idx].     
+00069500: 2020 2020 2020 2072 736e 645f 7365 6c20         rsnd_sel 
+00069510: 3d20 5b72 676e 735f 6c73 745f 6e64 5b77  = [rgns_lst_nd[w
+00069520: 5d20 666f 7220 7720 696e 2072 735f 7365  ] for w in rs_se
+00069530: 6c5f 6964 785d 0a20 2020 2020 2020 2020  l_idx].         
+00069540: 2020 2072 7373 7469 5f73 656c 203d 205b     rssti_sel = [
+00069550: 7267 6e73 5f6c 7374 5f73 7469 5b77 5d20  rgns_lst_sti[w] 
+00069560: 666f 7220 7720 696e 2072 735f 7365 6c5f  for w in rs_sel_
+00069570: 6964 785d 0a0a 2020 2020 2020 2020 2020  idx]..          
+00069580: 2020 6172 675f 6c73 742e 6170 7065 6e64    arg_lst.append
+00069590: 2820 2867 645f 7365 6c2c 2072 736d 5f73  ( (gd_sel, rsm_s
+000695a0: 656c 2c20 7273 6e64 5f73 656c 2c20 7273  el, rsnd_sel, rs
+000695b0: 7374 695f 7365 6c2c 2067 645f 7365 6c5f  sti_sel, gd_sel_
+000695c0: 6964 782c 2072 735f 7365 6c5f 6964 7829  idx, rs_sel_idx)
+000695d0: 2029 0a0a 2020 2020 2020 2020 6465 6c20   )..        del 
+000695e0: 6764 5f6c 7374 0a20 2020 2020 2020 2064  gd_lst.        d
+000695f0: 656c 2072 676e 735f 6c73 745f 6d69 0a20  el rgns_lst_mi. 
+00069600: 2020 2020 2020 2064 656c 2072 676e 735f         del rgns_
+00069610: 6c73 745f 6e64 0a20 2020 2020 2020 2064  lst_nd.        d
+00069620: 656c 2072 676e 735f 6c73 745f 7374 690a  el rgns_lst_sti.
+00069630: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00069640: 206e 756d 5f63 6f72 6520 3d20 6d69 6e28   num_core = min(
+00069650: 206e 5f63 6f72 6573 2c20 2863 7075 5f63   n_cores, (cpu_c
+00069660: 6f75 6e74 2829 202d 2031 2920 290a 2020  ount() - 1) ).  
+00069670: 2020 2020 2020 706f 6f6c 203d 2050 6f6f        pool = Poo
+00069680: 6c28 6e75 6d5f 636f 7265 290a 2020 2020  l(num_core).    
+00069690: 2020 2020 7072 696e 7428 276e 756d 2063      print('num c
+000696a0: 6f72 6573 2074 6f20 7573 6520 3d20 2569  ores to use = %i
+000696b0: 2720 2520 6e5f 636f 7265 7329 0a0a 2020  ' % n_cores)..  
+000696c0: 2020 2020 2020 636e 7420 3d20 300a 2020        cnt = 0.  
+000696d0: 2020 2020 2020 666f 7220 672c 2072 6d2c        for g, rm,
+000696e0: 2072 6e64 2c20 7273 7469 2c20 6e67 2c20   rnd, rsti, ng, 
+000696f0: 6e72 2c20 7464 672c 2074 6472 2069 6e20  nr, tdg, tdr in 
+00069700: 706f 6f6c 2e69 6d61 705f 756e 6f72 6465  pool.imap_unorde
+00069710: 7265 6428 6d63 5f63 6f72 655f 6d61 7070  red(mc_core_mapp
+00069720: 696e 672c 2061 7267 5f6c 7374 293a 0a0a  ing, arg_lst):..
+00069730: 2020 2020 2020 2020 2020 2020 746f 5f64              to_d
+00069740: 656c 5f67 203d 2074 6f5f 6465 6c5f 6720  el_g = to_del_g 
+00069750: 2b20 7464 670a 2020 2020 2020 2020 2020  + tdg.          
+00069760: 2020 746f 5f64 656c 5f72 203d 2074 6f5f    to_del_r = to_
+00069770: 6465 6c5f 7220 2b20 7464 720a 0a20 2020  del_r + tdr..   
+00069780: 2020 2020 2020 2020 2067 645f 6c73 745f           gd_lst_
+00069790: 6f75 7420 3d20 6764 5f6c 7374 5f6f 7574  out = gd_lst_out
+000697a0: 202b 2067 0a20 2020 2020 2020 2020 2020   + g.           
+000697b0: 2072 735f 6d5f 6c73 745f 6f75 7420 3d20   rs_m_lst_out = 
+000697c0: 7273 5f6d 5f6c 7374 5f6f 7574 202b 2072  rs_m_lst_out + r
+000697d0: 6d0a 2020 2020 2020 2020 2020 2020 7273  m.            rs
+000697e0: 5f6e 645f 6c73 745f 6f75 7420 3d20 7273  _nd_lst_out = rs
+000697f0: 5f6e 645f 6c73 745f 6f75 7420 2b20 726e  _nd_lst_out + rn
+00069800: 640a 2020 2020 2020 2020 2020 2020 7273  d.            rs
+00069810: 5f73 7469 5f6c 7374 5f6f 7574 203d 2072  _sti_lst_out = r
+00069820: 735f 7374 695f 6c73 745f 6f75 7420 2b20  s_sti_lst_out + 
+00069830: 7273 7469 0a0a 2020 2020 2020 2020 2020  rsti..          
+00069840: 2020 6e67 5f75 6e6d 6170 7065 6420 2b3d    ng_unmapped +=
+00069850: 206e 670a 2020 2020 2020 2020 2020 2020   ng.            
+00069860: 6e72 5f75 6e6d 6170 7065 6420 2b3d 206e  nr_unmapped += n
+00069870: 720a 2020 2020 2020 2020 2020 2020 636e  r.            cn
+00069880: 7420 2b3d 2031 0a0a 2020 2020 2020 2020  t += 1..        
+00069890: 2020 2020 6966 2076 6572 626f 7365 3a0a      if verbose:.
+000698a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000698b0: 7072 696e 7428 275c 724d 6170 7069 6e67  print('\rMapping
+000698c0: 2025 692f 2569 2720 2520 2863 6e74 2c6c   %i/%i' % (cnt,l
+000698d0: 656e 2863 6872 7329 292c 2065 6e64 3d27  en(chrs)), end='
+000698e0: 2020 2020 272c 2066 6c75 7368 203d 2054      ', flush = T
+000698f0: 7275 6520 290a 0a20 2020 2020 2020 2064  rue )..        d
+00069900: 656c 2061 7267 5f6c 7374 0a20 2020 2020  el arg_lst.     
+00069910: 2020 200a 2020 2020 2020 2020 706f 6f6c     .        pool
+00069920: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+00069930: 2070 6f6f 6c2e 6a6f 696e 2829 0a20 2020   pool.join().   
+00069940: 2020 2020 200a 2020 2020 656c 7365 3a0a       .    else:.
+00069950: 2020 2020 2020 2020 666f 7220 6b2c 2063          for k, c
+00069960: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
+00069970: 7273 293a 0a20 2020 2020 2020 2020 2020  rs):.           
+00069980: 2067 645f 7365 6c5f 6964 7820 3d20 7768   gd_sel_idx = wh
+00069990: 6963 6828 6764 5f63 6872 7320 3d3d 2063  ich(gd_chrs == c
+000699a0: 290a 2020 2020 2020 2020 2020 2020 7273  ).            rs
+000699b0: 5f73 656c 5f69 6478 203d 2077 6869 6368  _sel_idx = which
+000699c0: 2872 735f 6368 7273 203d 3d20 6329 0a0a  (rs_chrs == c)..
+000699d0: 2020 2020 2020 2020 2020 2020 6764 5f73              gd_s
+000699e0: 656c 203d 205b 6764 5f6c 7374 5b77 5d20  el = [gd_lst[w] 
+000699f0: 666f 7220 7720 696e 2067 645f 7365 6c5f  for w in gd_sel_
+00069a00: 6964 785d 0a20 2020 2020 2020 2020 2020  idx].           
+00069a10: 2072 736d 5f73 656c 203d 205b 7267 6e73   rsm_sel = [rgns
+00069a20: 5f6c 7374 5f6d 695b 775d 2066 6f72 2077  _lst_mi[w] for w
+00069a30: 2069 6e20 7273 5f73 656c 5f69 6478 5d0a   in rs_sel_idx].
+00069a40: 2020 2020 2020 2020 2020 2020 7273 6e64              rsnd
+00069a50: 5f73 656c 203d 205b 7267 6e73 5f6c 7374  _sel = [rgns_lst
+00069a60: 5f6e 645b 775d 2066 6f72 2077 2069 6e20  _nd[w] for w in 
+00069a70: 7273 5f73 656c 5f69 6478 5d0a 2020 2020  rs_sel_idx].    
+00069a80: 2020 2020 2020 2020 7273 7374 695f 7365          rssti_se
+00069a90: 6c20 3d20 5b72 676e 735f 6c73 745f 7374  l = [rgns_lst_st
+00069aa0: 695b 775d 2066 6f72 2077 2069 6e20 7273  i[w] for w in rs
+00069ab0: 5f73 656c 5f69 6478 5d0a 0a20 2020 2020  _sel_idx]..     
+00069ac0: 2020 2020 2020 2067 2c20 726d 2c20 726e         g, rm, rn
+00069ad0: 642c 2072 7374 692c 206e 672c 206e 722c  d, rsti, ng, nr,
+00069ae0: 2074 6467 2c20 7464 7220 3d20 636f 6d62   tdg, tdr = comb
+00069af0: 696e 655f 6765 6e65 735f 616e 645f 7267  ine_genes_and_rg
+00069b00: 6e73 5f70 6572 5f63 6872 2820 6764 5f73  ns_per_chr( gd_s
+00069b10: 656c 2c20 7273 6d5f 7365 6c2c 205c 0a20  el, rsm_sel, \. 
+00069b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069b50: 2020 2020 2020 2020 2020 2020 2020 7273                rs
+00069b60: 6e64 5f73 656c 2c20 7273 7374 695f 7365  nd_sel, rssti_se
+00069b70: 6c2c 205c 0a20 2020 2020 2020 2020 2020  l, \.           
+00069b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069bb0: 2020 2020 7665 7262 6f73 6520 3d20 4661      verbose = Fa
+00069bc0: 6c73 6520 290a 2020 2020 2020 2020 2020  lse ).          
+00069bd0: 2020 746f 5f64 656c 5f67 203d 2074 6f5f    to_del_g = to_
+00069be0: 6465 6c5f 6720 2b20 5b67 645f 7365 6c5f  del_g + [gd_sel_
+00069bf0: 6964 785b 6d5d 2066 6f72 206d 2069 6e20  idx[m] for m in 
+00069c00: 7464 675d 0a20 2020 2020 2020 2020 2020  tdg].           
+00069c10: 2074 6f5f 6465 6c5f 7220 3d20 746f 5f64   to_del_r = to_d
+00069c20: 656c 5f72 202b 205b 7273 5f73 656c 5f69  el_r + [rs_sel_i
+00069c30: 6478 5b6d 5d20 666f 7220 6d20 696e 2074  dx[m] for m in t
+00069c40: 6472 5d0a 0a20 2020 2020 2020 2020 2020  dr]..           
+00069c50: 2067 645f 6c73 745f 6f75 7420 3d20 6764   gd_lst_out = gd
+00069c60: 5f6c 7374 5f6f 7574 202b 2067 0a20 2020  _lst_out + g.   
+00069c70: 2020 2020 2020 2020 2072 735f 6d5f 6c73           rs_m_ls
+00069c80: 745f 6f75 7420 3d20 7273 5f6d 5f6c 7374  t_out = rs_m_lst
+00069c90: 5f6f 7574 202b 2072 6d0a 2020 2020 2020  _out + rm.      
+00069ca0: 2020 2020 2020 7273 5f6e 645f 6c73 745f        rs_nd_lst_
+00069cb0: 6f75 7420 3d20 7273 5f6e 645f 6c73 745f  out = rs_nd_lst_
+00069cc0: 6f75 7420 2b20 726e 640a 2020 2020 2020  out + rnd.      
+00069cd0: 2020 2020 2020 7273 5f73 7469 5f6c 7374        rs_sti_lst
+00069ce0: 5f6f 7574 203d 2072 735f 7374 695f 6c73  _out = rs_sti_ls
+00069cf0: 745f 6f75 7420 2b20 7273 7469 0a0a 2020  t_out + rsti..  
+00069d00: 2020 2020 2020 2020 2020 6e67 5f75 6e6d            ng_unm
+00069d10: 6170 7065 6420 2b3d 206e 670a 2020 2020  apped += ng.    
+00069d20: 2020 2020 2020 2020 6e72 5f75 6e6d 6170          nr_unmap
+00069d30: 7065 6420 2b3d 206e 720a 0a20 2020 2020  ped += nr..     
+00069d40: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
+00069d50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00069d60: 2020 2070 7269 6e74 2827 5c72 4d61 7070     print('\rMapp
+00069d70: 696e 6720 2569 2f25 6927 2025 2028 6b2c  ing %i/%i' % (k,
+00069d80: 6c65 6e28 6368 7273 2929 2c20 656e 643d  len(chrs)), end=
+00069d90: 2720 2020 2027 2c20 666c 7573 6820 3d20  '    ', flush = 
+00069da0: 5472 7565 2029 0a20 2020 200a 2020 2020  True ).    .    
+00069db0: 2020 2020 6465 6c20 6764 5f6c 7374 0a20      del gd_lst. 
+00069dc0: 2020 2020 2020 2064 656c 2072 676e 735f         del rgns_
+00069dd0: 6c73 745f 6d69 0a20 2020 2020 2020 2064  lst_mi.        d
+00069de0: 656c 2072 676e 735f 6c73 745f 6e64 0a20  el rgns_lst_nd. 
+00069df0: 2020 2020 2020 2064 656c 2072 676e 735f         del rgns_
+00069e00: 6c73 745f 7374 690a 2020 2020 2020 2020  lst_sti.        
+00069e10: 0a20 2020 2065 6c61 7073 6564 5f74 696d  .    elapsed_tim
+00069e20: 6531 203d 2074 696d 652e 7469 6d65 2829  e1 = time.time()
+00069e30: 202d 2073 7461 7274 5f74 696d 6531 0a20   - start_time1. 
+00069e40: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
+00069e50: 7269 6e74 2827 5c72 4d61 7070 696e 6720  rint('\rMapping 
+00069e60: 2569 2063 6872 7320 2e2e 2e20 646f 6e65  %i chrs ... done
+00069e70: 2e20 2569 2873 2927 2025 2028 6c65 6e28  . %i(s)' % (len(
+00069e80: 6368 7273 292c 656c 6170 7365 645f 7469  chrs),elapsed_ti
+00069e90: 6d65 3129 2029 0a20 2020 2020 2020 200a  me1) ).        .
+00069ea0: 2020 2020 6966 206e 6720 3e20 303a 0a20      if ng > 0:. 
+00069eb0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+00069ec0: 2025 6920 6765 6e65 7320 696e 2074 6865   %i genes in the
+00069ed0: 2047 5446 2f47 4646 2064 6f20 6e6f 7420   GTF/GFF do not 
+00069ee0: 6861 7665 206d 6170 7065 6420 7265 6164  have mapped read
+00069ef0: 732e 2720 2520 6e67 5f75 6e6d 6170 7065  s.' % ng_unmappe
+00069f00: 6420 290a 2020 2020 6966 206e 7220 3e20  d ).    if nr > 
+00069f10: 303a 0a20 2020 2020 2020 2070 7269 6e74  0:.        print
+00069f20: 2827 2020 2025 6920 6368 756e 6b73 2061  ('   %i chunks a
+00069f30: 7265 206f 7574 206f 6620 6765 6e65 206c  re out of gene l
+00069f40: 6f63 6920 696e 2047 5446 2f47 4646 2e27  oci in GTF/GFF.'
+00069f50: 2025 206e 725f 756e 6d61 7070 6564 2029   % nr_unmapped )
+00069f60: 0a20 2020 2020 2020 200a 2020 2020 2727  .        .    ''
+00069f70: 270a 2020 2020 6966 206c 656e 2874 6f5f  '.    if len(to_
+00069f80: 6465 6c5f 7229 203e 2030 3a0a 2020 2020  del_r) > 0:.    
+00069f90: 2020 2020 746f 5f64 656c 5f72 2e73 6f72      to_del_r.sor
+00069fa0: 7428 7265 7665 7273 653d 5472 7565 290a  t(reverse=True).
+00069fb0: 2020 2020 2020 2020 666f 7220 7269 2069          for ri i
+00069fc0: 6e20 746f 5f64 656c 5f72 3a0a 2020 2020  n to_del_r:.    
+00069fd0: 2020 2020 2020 2020 6465 6c20 7267 6e73          del rgns
+00069fe0: 5f6c 7374 5f6d 695b 7269 5d0a 2020 2020  _lst_mi[ri].    
+00069ff0: 2020 2020 2020 2020 6465 6c20 7267 6e73          del rgns
+0006a000: 5f6c 7374 5f6e 645b 7269 5d0a 2020 2020  _lst_nd[ri].    
+0006a010: 2020 2020 2020 2020 6465 6c20 7267 6e73          del rgns
+0006a020: 5f6c 7374 5f73 7469 5b72 695d 0a20 2020  _lst_sti[ri].   
+0006a030: 2020 2020 2020 2020 200a 2020 2020 6966           .    if
+0006a040: 206c 656e 2874 6f5f 6465 6c5f 6729 203e   len(to_del_g) >
+0006a050: 2030 3a0a 2020 2020 2020 2020 746f 5f64   0:.        to_d
+0006a060: 656c 5f67 2e73 6f72 7428 7265 7665 7273  el_g.sort(revers
+0006a070: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+0006a080: 666f 7220 6769 2069 6e20 746f 5f64 656c  for gi in to_del
+0006a090: 5f67 3a0a 2020 2020 2020 2020 2020 2020  _g:.            
+0006a0a0: 6465 6c20 6764 5f6c 7374 5b67 695d 0a20  del gd_lst[gi]. 
+0006a0b0: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+0006a0c0: 2020 200a 2020 2020 7265 7475 726e 2067     .    return g
+0006a0d0: 645f 6c73 745f 6f75 742c 2072 735f 6d5f  d_lst_out, rs_m_
+0006a0e0: 6c73 745f 6f75 742c 2072 735f 6e64 5f6c  lst_out, rs_nd_l
+0006a0f0: 7374 5f6f 7574 2c20 7273 5f73 7469 5f6c  st_out, rs_sti_l
+0006a100: 7374 5f6f 7574 0a0a 0a23 2323 2323 2323  st_out...#######
+0006a110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a150: 2323 230a 2323 2046 756e 6374 696f 6e73  ###.## Functions
+0006a160: 2074 6f20 6669 6e64 2063 6f64 696e 6720   to find coding 
+0006a170: 7265 6769 6f6e 7320 616e 6420 746f 2067  regions and to g
+0006a180: 656e 6572 6174 6520 7072 6f74 656f 6d65  enerate proteome
+0006a190: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+0006a1a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a1b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a1c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a1d0: 2323 2323 2323 2323 2323 230a 0a42 4153  ###########..BAS
+0006a1e0: 4553 203d 2027 5443 4147 2720 2320 2274  ES = 'TCAG' # "t
+0006a1f0: 6361 6722 0a43 4f44 4f4e 5320 3d20 5b61  cag".CODONS = [a
+0006a200: 202b 2062 202b 2063 2066 6f72 2061 2069   + b + c for a i
+0006a210: 6e20 4241 5345 5320 666f 7220 6220 696e  n BASES for b in
+0006a220: 2042 4153 4553 2066 6f72 2063 2069 6e20   BASES for c in 
+0006a230: 4241 5345 535d 0a41 4d49 4e4f 5f41 4349  BASES].AMINO_ACI
+0006a240: 4453 203d 2027 4646 4c4c 5353 5353 5959  DS = 'FFLLSSSSYY
+0006a250: 2a2a 4343 2a57 4c4c 4c4c 5050 5050 4848  **CC*WLLLLPPPPHH
+0006a260: 5151 5252 5252 4949 494d 5454 5454 4e4e  QQRRRRIIIMTTTTNN
+0006a270: 4b4b 5353 5252 5656 5656 4141 4141 4444  KKSSRRVVVVAAAADD
+0006a280: 4545 4747 4747 270a 636f 646f 6e5f 7461  EEGGGG'.codon_ta
+0006a290: 626c 6520 3d20 6469 6374 287a 6970 2843  ble = dict(zip(C
+0006a2a0: 4f44 4f4e 532c 2041 4d49 4e4f 5f41 4349  ODONS, AMINO_ACI
+0006a2b0: 4453 2929 0a53 5441 5254 5f43 4f44 4f4e  DS)).START_CODON
+0006a2c0: 203d 2027 4154 4727 0a72 635f 5354 4152   = 'ATG'.rc_STAR
+0006a2d0: 545f 434f 444f 4e20 3d20 2743 4154 270a  T_CODON = 'CAT'.
+0006a2e0: 5354 4f50 5f43 4f44 4f4e 5320 3d20 5b27  STOP_CODONS = ['
+0006a2f0: 5441 4127 2c27 5441 4727 2c27 5447 4127  TAA','TAG','TGA'
+0006a300: 5d0a 7263 5f53 544f 505f 434f 444f 4e53  ].rc_STOP_CODONS
+0006a310: 203d 205b 2754 5441 272c 2743 5441 272c   = ['TTA','CTA',
+0006a320: 2754 4341 275d 0a72 6576 5f63 6f6d 705f  'TCA'].rev_comp_
+0006a330: 7461 626c 6520 3d20 7b27 4127 3a27 5427  table = {'A':'T'
+0006a340: 2c20 2743 273a 2027 4727 2c20 2747 273a  , 'C': 'G', 'G':
+0006a350: 2743 272c 2027 5427 3a27 4127 2c20 274e  'C', 'T':'A', 'N
+0006a360: 273a 2027 4e27 7d0a 0a64 6566 2074 7261  ': 'N'}..def tra
+0006a370: 6e73 6c61 7465 2873 6571 293a 0a20 2020  nslate(seq):.   
+0006a380: 2073 6571 203d 2073 6571 2e75 7070 6572   seq = seq.upper
+0006a390: 2829 2e72 6570 6c61 6365 2827 5c6e 272c  ().replace('\n',
+0006a3a0: 2027 2729 2e72 6570 6c61 6365 2827 2027   '').replace(' '
+0006a3b0: 2c20 2727 290a 2020 2020 7065 7074 6964  , '').    peptid
+0006a3c0: 6520 3d20 2727 0a20 2020 200a 2020 2020  e = ''.    .    
+0006a3d0: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
+0006a3e0: 2c20 6c65 6e28 7365 7129 2c20 3329 3a0a  , len(seq), 3):.
+0006a3f0: 2020 2020 2020 2020 636f 646f 6e20 3d20          codon = 
+0006a400: 7365 715b 693a 2069 2b33 5d0a 2020 2020  seq[i: i+3].    
+0006a410: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
+0006a420: 6966 2063 6f64 6f6e 2e63 6f75 6e74 2827  if codon.count('
+0006a430: 4e27 2920 3d3d 2030 3a0a 2020 2020 2020  N') == 0:.      
+0006a440: 2020 2020 2020 616d 696e 6f5f 6163 6964        amino_acid
+0006a450: 203d 2063 6f64 6f6e 5f74 6162 6c65 2e67   = codon_table.g
+0006a460: 6574 2863 6f64 6f6e 2c20 272a 2729 0a20  et(codon, '*'). 
+0006a470: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0006a480: 2020 2020 2020 2020 2061 6d69 6e6f 5f61           amino_a
+0006a490: 6369 6420 3d20 272a 270a 2020 2020 2020  cid = '*'.      
+0006a4a0: 2020 2727 270a 2020 2020 2020 2020 2327    '''.        #'
+0006a4b0: 2727 0a20 2020 2020 2020 2061 6d69 6e6f  ''.        amino
+0006a4c0: 5f61 6369 6420 3d20 636f 646f 6e5f 7461  _acid = codon_ta
+0006a4d0: 626c 652e 6765 7428 636f 646f 6e2c 2027  ble.get(codon, '
+0006a4e0: 2a27 290a 2020 2020 2020 2020 2369 6620  *').        #if 
+0006a4f0: 616d 696e 6f5f 6163 6964 2021 3d20 272a  amino_acid != '*
+0006a500: 273a 0a20 2020 2020 2020 2070 6570 7469  ':.        pepti
+0006a510: 6465 202b 3d20 616d 696e 6f5f 6163 6964  de += amino_acid
+0006a520: 0a20 2020 2020 2020 2023 2065 6c73 653a  .        # else:
+0006a530: 2062 7265 616b 0a20 2020 2020 2020 2023   break.        #
+0006a540: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+0006a550: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
+0006a560: 7065 7074 6964 650a 0a64 6566 2072 6576  peptide..def rev
+0006a570: 6572 7365 5f63 6f6d 706c 656d 656e 7428  erse_complement(
+0006a580: 7365 7129 3a0a 2020 2020 0a20 2020 2072  seq):.    .    r
+0006a590: 635f 7365 7120 3d20 2727 0a20 2020 204b  c_seq = ''.    K
+0006a5a0: 6579 7320 3d20 7265 765f 636f 6d70 5f74  eys = rev_comp_t
+0006a5b0: 6162 6c65 2e6b 6579 7328 290a 2020 2020  able.keys().    
+0006a5c0: 666f 7220 6b20 696e 2072 6576 6572 7365  for k in reverse
+0006a5d0: 6428 7261 6e67 6528 6c65 6e28 7365 7129  d(range(len(seq)
+0006a5e0: 2929 3a0a 2020 2020 2020 2020 6966 2073  )):.        if s
+0006a5f0: 6571 5b6b 5d20 696e 204b 6579 733a 0a20  eq[k] in Keys:. 
+0006a600: 2020 2020 2020 2020 2020 2072 635f 7365             rc_se
+0006a610: 7120 3d20 7263 5f73 6571 202b 2072 6576  q = rc_seq + rev
+0006a620: 5f63 6f6d 705f 7461 626c 655b 7365 715b  _comp_table[seq[
+0006a630: 6b5d 5d0a 2020 2020 2020 2020 656c 7365  k]].        else
+0006a640: 3a0a 2020 2020 2020 2020 2020 2020 7263  :.            rc
+0006a650: 5f73 6571 203d 2072 635f 7365 7120 2b20  _seq = rc_seq + 
+0006a660: 274e 270a 2020 2020 7265 7475 726e 2072  'N'.    return r
+0006a670: 635f 7365 710a 2020 2020 0a64 6566 2066  c_seq.    .def f
+0006a680: 696e 645f 616c 6c5f 735f 696e 5f73 7472  ind_all_s_in_str
+0006a690: 2873 7472 2c73 293a 0a20 2020 200a 2020  (str,s):.    .  
+0006a6a0: 2020 706f 735f 6c73 7420 3d20 5b5d 0a20    pos_lst = []. 
+0006a6b0: 2020 2073 7461 7274 203d 2030 0a20 2020     start = 0.   
+0006a6c0: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
+0006a6d0: 2020 2020 2070 6f73 203d 2073 7472 2e66       pos = str.f
+0006a6e0: 696e 6428 732c 2073 7461 7274 290a 2020  ind(s, start).  
+0006a6f0: 2020 2020 2020 6966 2070 6f73 203c 2030        if pos < 0
+0006a700: 3a20 6272 6561 6b0a 2020 2020 2020 2020  : break.        
+0006a710: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0006a720: 2020 706f 735f 6c73 742e 6170 7065 6e64    pos_lst.append
+0006a730: 2870 6f73 290a 2020 2020 2020 2020 2020  (pos).          
+0006a740: 2020 7374 6172 7420 3d20 706f 732b 310a    start = pos+1.
+0006a750: 2020 2020 2020 2020 6966 2073 7461 7274          if start
+0006a760: 2b33 203e 3d20 6c65 6e28 7374 7229 3a20  +3 >= len(str): 
+0006a770: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0006a780: 2020 0a20 2020 2072 6574 7572 6e20 706f    .    return po
+0006a790: 735f 6c73 740a 0a64 6566 2063 6865 636b  s_lst..def check
+0006a7a0: 5f6f 7266 5f63 6f6e 6469 7469 6f6e 5f66  _orf_condition_f
+0006a7b0: 6f72 7761 7264 5f66 726f 6d5f 7374 6172  orward_from_star
+0006a7c0: 7428 7473 6571 293a 0a20 2020 200a 2020  t(tseq):.    .  
+0006a7d0: 2020 7374 6172 7420 3d20 2d31 0a20 2020    start = -1.   
+0006a7e0: 2073 746f 7020 3d20 2d31 0a20 2020 2073   stop = -1.    s
+0006a7f0: 735f 6c73 7420 3d20 5b5d 0a20 2020 2070  s_lst = [].    p
+0006a800: 6f73 5f6c 7374 203d 2066 696e 645f 616c  os_lst = find_al
+0006a810: 6c5f 735f 696e 5f73 7472 2874 7365 712c  l_s_in_str(tseq,
+0006a820: 2053 5441 5254 5f43 4f44 4f4e 290a 2020   START_CODON).  
+0006a830: 2020 6966 206c 656e 2870 6f73 5f6c 7374    if len(pos_lst
+0006a840: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0006a850: 7265 7475 726e 2073 7461 7274 2c20 7374  return start, st
+0006a860: 6f70 2c20 7373 5f6c 7374 0a20 2020 2065  op, ss_lst.    e
+0006a870: 6c73 653a 0a20 2020 2020 2020 2066 6f72  lse:.        for
+0006a880: 2070 6f73 5f73 7461 7274 2069 6e20 706f   pos_start in po
+0006a890: 735f 6c73 743a 0a20 2020 2020 2020 2020  s_lst:.         
+0006a8a0: 2020 2070 6f73 5f73 746f 7020 3d20 2d31     pos_stop = -1
+0006a8b0: 0a20 2020 2020 2020 2020 2020 206e 5f73  .            n_s
+0006a8c0: 746f 7073 203d 2030 0a20 2020 2020 2020  tops = 0.       
+0006a8d0: 2020 2020 2066 6f72 2070 2069 6e20 7261       for p in ra
+0006a8e0: 6e67 6528 706f 735f 7374 6172 742b 332c  nge(pos_start+3,
+0006a8f0: 6c65 6e28 7473 6571 292d 312c 2033 293a  len(tseq)-1, 3):
+0006a900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006a910: 2065 6e64 7020 3d20 6d69 6e28 702b 332c   endp = min(p+3,
+0006a920: 6c65 6e28 7473 6571 2929 0a20 2020 2020  len(tseq)).     
+0006a930: 2020 2020 2020 2020 2020 2063 6f64 6f6e             codon
+0006a940: 203d 2074 7365 715b 703a 2870 2b33 295d   = tseq[p:(p+3)]
+0006a950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006a960: 2069 6620 636f 646f 6e20 696e 2053 544f   if codon in STO
+0006a970: 505f 434f 444f 4e53 3a0a 2020 2020 2020  P_CODONS:.      
+0006a980: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+0006a990: 7374 6f70 7320 2b3d 2031 0a20 2020 2020  stops += 1.     
+0006a9a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0006a9b0: 6620 6e5f 7374 6f70 7320 3d3d 2031 3a0a  f n_stops == 1:.
+0006a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a9d0: 2020 2020 2020 2020 706f 735f 7374 6f70          pos_stop
+0006a9e0: 203d 2070 0a20 2020 2020 2020 2020 2020   = p.           
+0006a9f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0006aa00: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+0006aa10: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0006aa20: 2020 2020 2020 2020 6966 2028 706f 735f          if (pos_
+0006aa30: 7374 6f70 203e 3d20 3029 3a20 2320 2620  stop >= 0): # & 
+0006aa40: 286e 5f73 746f 7073 203d 3d20 3129 3a0a  (n_stops == 1):.
 0006aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aa60: 2020 206e 5f73 746f 7073 202b 3d20 310a     n_stops += 1.
-0006aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aa80: 2020 2020 6966 206e 5f73 746f 7073 203d      if n_stops =
-0006aa90: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0006aaa0: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-0006aab0: 5f73 746f 7020 3d20 700a 2020 2020 2020  _stop = p.      
-0006aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aad0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0006aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aaf0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0006ab00: 2870 6f73 5f73 746f 7020 3e3d 2030 293a  (pos_stop >= 0):
-0006ab10: 2023 2026 2028 6e5f 7374 6f70 7320 3d3d   # & (n_stops ==
-0006ab20: 2031 293a 0a20 2020 2020 2020 2020 2020   1):.           
-0006ab30: 2020 2020 2073 735f 6c73 742e 6170 7065       ss_lst.appe
-0006ab40: 6e64 2828 706f 735f 7374 6172 742c 2070  nd((pos_start, p
-0006ab50: 6f73 5f73 746f 7029 290a 2020 2020 2020  os_stop)).      
-0006ab60: 2020 2020 2020 2020 2020 2327 2727 0a20            #'''. 
-0006ab70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006ab80: 6620 2873 7461 7274 203e 3d20 3029 2026  f (start >= 0) &
-0006ab90: 2028 7374 6f70 203e 3d20 3029 3a0a 2020   (stop >= 0):.  
-0006aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006abb0: 2020 6c65 6e5f 7072 6576 203d 2073 746f    len_prev = sto
-0006abc0: 7020 2d20 7374 6172 740a 2020 2020 2020  p - start.      
-0006abd0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-0006abe0: 6e5f 6375 7272 203d 2070 6f73 5f73 746f  n_curr = pos_sto
-0006abf0: 7020 2d20 706f 735f 7374 6172 740a 2020  p - pos_start.  
-0006ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ac10: 2020 6966 206c 656e 5f63 7572 7220 3e20    if len_curr > 
-0006ac20: 6c65 6e5f 7072 6576 3a0a 2020 2020 2020  len_prev:.      
-0006ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ac40: 2020 7374 6172 7420 3d20 706f 735f 7374    start = pos_st
-0006ac50: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
-0006ac60: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-0006ac70: 203d 2070 6f73 5f73 746f 700a 2020 2020   = pos_stop.    
-0006ac80: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0006ac90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0006aca0: 2020 2020 2020 7374 6172 7420 3d20 706f        start = po
-0006acb0: 735f 7374 6172 740a 2020 2020 2020 2020  s_start.        
-0006acc0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-0006acd0: 203d 2070 6f73 5f73 746f 700a 2020 2020   = pos_stop.    
-0006ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006acf0: 2320 6272 6561 6b0a 2020 2020 2020 2020  # break.        
-0006ad00: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
-0006ad10: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0006ad20: 2020 2020 2020 7265 7475 726e 2073 7461        return sta
-0006ad30: 7274 2c20 7374 6f70 2c20 7373 5f6c 7374  rt, stop, ss_lst
-0006ad40: 0a20 2020 2020 2020 2020 2020 200a 6465  .            .de
-0006ad50: 6620 6368 6563 6b5f 6571 7561 6c5f 7261  f check_equal_ra
-0006ad60: 6e67 6528 7373 5f6c 7374 2c20 7373 293a  nge(ss_lst, ss):
-0006ad70: 0a20 2020 200a 2020 2020 6220 3d20 4661  .    .    b = Fa
-0006ad80: 6c73 650a 2020 2020 666f 7220 7320 696e  lse.    for s in
-0006ad90: 2073 735f 6c73 743a 0a20 2020 2020 2020   ss_lst:.       
-0006ada0: 2069 6620 2873 5b30 5d3d 3d73 735b 305d   if (s[0]==ss[0]
-0006adb0: 2920 2620 2873 5b31 5d3d 3d73 735b 315d  ) & (s[1]==ss[1]
-0006adc0: 293a 2062 203d 2054 7275 650a 2020 2020  ): b = True.    
-0006add0: 7265 7475 726e 2062 0a20 2020 2020 2020  return b.       
-0006ade0: 200a 6465 6620 6368 6563 6b5f 6f72 665f   .def check_orf_
-0006adf0: 636f 6e64 6974 696f 6e5f 666f 7277 6172  condition_forwar
-0006ae00: 645f 6f6c 6428 7473 6571 293a 0a20 2020  d_old(tseq):.   
-0006ae10: 200a 2020 2020 7374 6172 7420 3d20 2d31   .    start = -1
-0006ae20: 0a20 2020 2073 746f 7020 3d20 2d31 0a20  .    stop = -1. 
-0006ae30: 2020 2073 735f 6c73 7420 3d20 5b28 2d31     ss_lst = [(-1
-0006ae40: 2c2d 3129 2c28 2d31 2c2d 3129 2c28 2d31  ,-1),(-1,-1),(-1
-0006ae50: 2c2d 3129 5d0a 2020 2020 0a20 2020 2070  ,-1)].    .    p
-0006ae60: 6f73 5f6c 7374 3120 3d20 6669 6e64 5f61  os_lst1 = find_a
-0006ae70: 6c6c 5f73 5f69 6e5f 7374 7228 7473 6571  ll_s_in_str(tseq
-0006ae80: 2c20 5354 4f50 5f43 4f44 4f4e 535b 305d  , STOP_CODONS[0]
-0006ae90: 290a 2020 2020 706f 735f 6c73 7432 203d  ).    pos_lst2 =
-0006aea0: 2066 696e 645f 616c 6c5f 735f 696e 5f73   find_all_s_in_s
-0006aeb0: 7472 2874 7365 712c 2053 544f 505f 434f  tr(tseq, STOP_CO
-0006aec0: 444f 4e53 5b31 5d29 0a20 2020 2070 6f73  DONS[1]).    pos
-0006aed0: 5f6c 7374 3320 3d20 6669 6e64 5f61 6c6c  _lst3 = find_all
-0006aee0: 5f73 5f69 6e5f 7374 7228 7473 6571 2c20  _s_in_str(tseq, 
-0006aef0: 5354 4f50 5f43 4f44 4f4e 535b 325d 290a  STOP_CODONS[2]).
-0006af00: 2020 2020 706f 735f 6c73 7420 3d20 706f      pos_lst = po
-0006af10: 735f 6c73 7431 202b 2070 6f73 5f6c 7374  s_lst1 + pos_lst
-0006af20: 3220 2b20 706f 735f 6c73 7433 0a20 2020  2 + pos_lst3.   
-0006af30: 2070 6f73 5f6c 7374 2e73 6f72 7428 290a   pos_lst.sort().
-0006af40: 2020 2020 0a20 2020 2069 6620 6c65 6e28      .    if len(
-0006af50: 706f 735f 6c73 7429 203d 3d20 303a 0a20  pos_lst) == 0:. 
-0006af60: 2020 2020 2020 2072 6574 7572 6e20 6368         return ch
-0006af70: 6563 6b5f 6f72 665f 636f 6e64 6974 696f  eck_orf_conditio
-0006af80: 6e5f 666f 7277 6172 645f 6672 6f6d 5f73  n_forward_from_s
-0006af90: 7461 7274 2874 7365 7129 0a20 2020 2065  tart(tseq).    e
-0006afa0: 6c73 653a 0a20 2020 2020 2020 2070 6f73  lse:.        pos
-0006afb0: 5f6c 7374 203d 206e 702e 6172 7261 7928  _lst = np.array(
-0006afc0: 706f 735f 6c73 7429 0a20 2020 2020 2020  pos_lst).       
-0006afd0: 2066 6f72 206f 7320 696e 2072 616e 6765   for os in range
-0006afe0: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
-0006aff0: 2073 7461 7274 203d 202d 310a 2020 2020   start = -1.    
-0006b000: 2020 2020 2020 2020 7374 6f70 203d 202d          stop = -
-0006b010: 310a 2020 2020 2020 2020 2020 2020 7768  1.            wh
-0006b020: 203d 2077 6869 6368 2820 706f 735f 6c73   = which( pos_ls
-0006b030: 7425 3320 3d3d 206f 7320 290a 2020 2020  t%3 == os ).    
-0006b040: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
-0006b050: 6829 203e 2030 3a0a 2020 2020 2020 2020  h) > 0:.        
-0006b060: 2020 2020 2020 2020 666f 7220 6b2c 7720          for k,w 
-0006b070: 696e 2065 6e75 6d65 7261 7465 2877 6829  in enumerate(wh)
-0006b080: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0006b090: 2020 2020 2020 706f 735f 7374 6f70 203d        pos_stop =
-0006b0a0: 2070 6f73 5f6c 7374 5b77 5d0a 2020 2020   pos_lst[w].    
+0006aa60: 7373 5f6c 7374 2e61 7070 656e 6428 2870  ss_lst.append((p
+0006aa70: 6f73 5f73 7461 7274 2c20 706f 735f 7374  os_start, pos_st
+0006aa80: 6f70 2929 0a20 2020 2020 2020 2020 2020  op)).           
+0006aa90: 2020 2020 2023 2727 270a 2020 2020 2020       #'''.      
+0006aaa0: 2020 2020 2020 2020 2020 6966 2028 7374            if (st
+0006aab0: 6172 7420 3e3d 2030 2920 2620 2873 746f  art >= 0) & (sto
+0006aac0: 7020 3e3d 2030 293a 0a20 2020 2020 2020  p >= 0):.       
+0006aad0: 2020 2020 2020 2020 2020 2020 206c 656e               len
+0006aae0: 5f70 7265 7620 3d20 7374 6f70 202d 2073  _prev = stop - s
+0006aaf0: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
+0006ab00: 2020 2020 2020 2020 206c 656e 5f63 7572           len_cur
+0006ab10: 7220 3d20 706f 735f 7374 6f70 202d 2070  r = pos_stop - p
+0006ab20: 6f73 5f73 7461 7274 0a20 2020 2020 2020  os_start.       
+0006ab30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0006ab40: 6c65 6e5f 6375 7272 203e 206c 656e 5f70  len_curr > len_p
+0006ab50: 7265 763a 0a20 2020 2020 2020 2020 2020  rev:.           
+0006ab60: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0006ab70: 7274 203d 2070 6f73 5f73 7461 7274 0a20  rt = pos_start. 
+0006ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ab90: 2020 2020 2020 2073 746f 7020 3d20 706f         stop = po
+0006aba0: 735f 7374 6f70 0a20 2020 2020 2020 2020  s_stop.         
+0006abb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0006abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006abd0: 2073 7461 7274 203d 2070 6f73 5f73 7461   start = pos_sta
+0006abe0: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
+0006abf0: 2020 2020 2020 2073 746f 7020 3d20 706f         stop = po
+0006ac00: 735f 7374 6f70 0a20 2020 2020 2020 2020  s_stop.         
+0006ac10: 2020 2020 2020 2020 2020 2023 2062 7265             # bre
+0006ac20: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+0006ac30: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
+0006ac40: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0006ac50: 2072 6574 7572 6e20 7374 6172 742c 2073   return start, s
+0006ac60: 746f 702c 2073 735f 6c73 740a 2020 2020  top, ss_lst.    
+0006ac70: 2020 2020 2020 2020 0a64 6566 2063 6865          .def che
+0006ac80: 636b 5f65 7175 616c 5f72 616e 6765 2873  ck_equal_range(s
+0006ac90: 735f 6c73 742c 2073 7329 3a0a 2020 2020  s_lst, ss):.    
+0006aca0: 0a20 2020 2062 203d 2046 616c 7365 0a20  .    b = False. 
+0006acb0: 2020 2066 6f72 2073 2069 6e20 7373 5f6c     for s in ss_l
+0006acc0: 7374 3a0a 2020 2020 2020 2020 6966 2028  st:.        if (
+0006acd0: 735b 305d 3d3d 7373 5b30 5d29 2026 2028  s[0]==ss[0]) & (
+0006ace0: 735b 315d 3d3d 7373 5b31 5d29 3a20 6220  s[1]==ss[1]): b 
+0006acf0: 3d20 5472 7565 0a20 2020 2072 6574 7572  = True.    retur
+0006ad00: 6e20 620a 2020 2020 2020 2020 0a64 6566  n b.        .def
+0006ad10: 2063 6865 636b 5f6f 7266 5f63 6f6e 6469   check_orf_condi
+0006ad20: 7469 6f6e 5f66 6f72 7761 7264 5f6f 6c64  tion_forward_old
+0006ad30: 2874 7365 7129 3a0a 2020 2020 0a20 2020  (tseq):.    .   
+0006ad40: 2073 7461 7274 203d 202d 310a 2020 2020   start = -1.    
+0006ad50: 7374 6f70 203d 202d 310a 2020 2020 7373  stop = -1.    ss
+0006ad60: 5f6c 7374 203d 205b 282d 312c 2d31 292c  _lst = [(-1,-1),
+0006ad70: 282d 312c 2d31 292c 282d 312c 2d31 295d  (-1,-1),(-1,-1)]
+0006ad80: 0a20 2020 200a 2020 2020 706f 735f 6c73  .    .    pos_ls
+0006ad90: 7431 203d 2066 696e 645f 616c 6c5f 735f  t1 = find_all_s_
+0006ada0: 696e 5f73 7472 2874 7365 712c 2053 544f  in_str(tseq, STO
+0006adb0: 505f 434f 444f 4e53 5b30 5d29 0a20 2020  P_CODONS[0]).   
+0006adc0: 2070 6f73 5f6c 7374 3220 3d20 6669 6e64   pos_lst2 = find
+0006add0: 5f61 6c6c 5f73 5f69 6e5f 7374 7228 7473  _all_s_in_str(ts
+0006ade0: 6571 2c20 5354 4f50 5f43 4f44 4f4e 535b  eq, STOP_CODONS[
+0006adf0: 315d 290a 2020 2020 706f 735f 6c73 7433  1]).    pos_lst3
+0006ae00: 203d 2066 696e 645f 616c 6c5f 735f 696e   = find_all_s_in
+0006ae10: 5f73 7472 2874 7365 712c 2053 544f 505f  _str(tseq, STOP_
+0006ae20: 434f 444f 4e53 5b32 5d29 0a20 2020 2070  CODONS[2]).    p
+0006ae30: 6f73 5f6c 7374 203d 2070 6f73 5f6c 7374  os_lst = pos_lst
+0006ae40: 3120 2b20 706f 735f 6c73 7432 202b 2070  1 + pos_lst2 + p
+0006ae50: 6f73 5f6c 7374 330a 2020 2020 706f 735f  os_lst3.    pos_
+0006ae60: 6c73 742e 736f 7274 2829 0a20 2020 200a  lst.sort().    .
+0006ae70: 2020 2020 6966 206c 656e 2870 6f73 5f6c      if len(pos_l
+0006ae80: 7374 2920 3d3d 2030 3a0a 2020 2020 2020  st) == 0:.      
+0006ae90: 2020 7265 7475 726e 2063 6865 636b 5f6f    return check_o
+0006aea0: 7266 5f63 6f6e 6469 7469 6f6e 5f66 6f72  rf_condition_for
+0006aeb0: 7761 7264 5f66 726f 6d5f 7374 6172 7428  ward_from_start(
+0006aec0: 7473 6571 290a 2020 2020 656c 7365 3a0a  tseq).    else:.
+0006aed0: 2020 2020 2020 2020 706f 735f 6c73 7420          pos_lst 
+0006aee0: 3d20 6e70 2e61 7272 6179 2870 6f73 5f6c  = np.array(pos_l
+0006aef0: 7374 290a 2020 2020 2020 2020 666f 7220  st).        for 
+0006af00: 6f73 2069 6e20 7261 6e67 6528 3329 3a0a  os in range(3):.
+0006af10: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0006af20: 7420 3d20 2d31 0a20 2020 2020 2020 2020  t = -1.         
+0006af30: 2020 2073 746f 7020 3d20 2d31 0a20 2020     stop = -1.   
+0006af40: 2020 2020 2020 2020 2077 6820 3d20 7768           wh = wh
+0006af50: 6963 6828 2070 6f73 5f6c 7374 2533 203d  ich( pos_lst%3 =
+0006af60: 3d20 6f73 2029 0a20 2020 2020 2020 2020  = os ).         
+0006af70: 2020 2069 6620 6c65 6e28 7768 2920 3e20     if len(wh) > 
+0006af80: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0006af90: 2020 2066 6f72 206b 2c77 2069 6e20 656e     for k,w in en
+0006afa0: 756d 6572 6174 6528 7768 293a 0a20 2020  umerate(wh):.   
+0006afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006afc0: 2070 6f73 5f73 746f 7020 3d20 706f 735f   pos_stop = pos_
+0006afd0: 6c73 745b 775d 0a20 2020 2020 2020 2020  lst[w].         
+0006afe0: 2020 2020 2020 2020 2020 2070 6f73 5f73             pos_s
+0006aff0: 7461 7274 203d 202d 310a 0a20 2020 2020  tart = -1..     
+0006b000: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0006b010: 7320 3d20 300a 2020 2020 2020 2020 2020  s = 0.          
+0006b020: 2020 2020 2020 2020 2020 6966 206b 203e            if k >
+0006b030: 2030 3a20 7373 203d 2070 6f73 5f6c 7374   0: ss = pos_lst
+0006b040: 5b77 685b 6b2d 315d 5d0a 2020 2020 2020  [wh[k-1]].      
+0006b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b060: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0006b070: 2020 2020 2020 2070 7320 3d20 6669 6e64         ps = find
+0006b080: 5f61 6c6c 5f73 5f69 6e5f 7374 7228 7473  _all_s_in_str(ts
+0006b090: 6571 5b73 733a 706f 735f 7374 6f70 5d2c  eq[ss:pos_stop],
+0006b0a0: 2053 5441 5254 5f43 4f44 4f4e 290a 2020   START_CODON).  
 0006b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b0c0: 706f 735f 7374 6172 7420 3d20 2d31 0a0a  pos_start = -1..
-0006b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b0e0: 2020 2020 7373 203d 2030 0a20 2020 2020      ss = 0.     
-0006b0f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006b100: 6620 6b20 3e20 303a 2073 7320 3d20 706f  f k > 0: ss = po
-0006b110: 735f 6c73 745b 7768 5b6b 2d31 5d5d 0a20  s_lst[wh[k-1]]. 
-0006b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b130: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0006b140: 2020 2020 2020 2020 2020 2020 7073 203d              ps =
-0006b150: 2066 696e 645f 616c 6c5f 735f 696e 5f73   find_all_s_in_s
-0006b160: 7472 2874 7365 715b 7373 3a70 6f73 5f73  tr(tseq[ss:pos_s
-0006b170: 746f 705d 2c20 5354 4152 545f 434f 444f  top], START_CODO
-0006b180: 4e29 0a20 2020 2020 2020 2020 2020 2020  N).             
-0006b190: 2020 2020 2020 2069 6620 6c65 6e28 7073         if len(ps
-0006b1a0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-0006b1b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0006b1c0: 7320 3d20 6e70 2e61 7272 6179 2870 7329  s = np.array(ps)
-0006b1d0: 202b 2073 730a 2020 2020 2020 2020 2020   + ss.          
-0006b1e0: 2020 2020 2020 2020 2020 2020 2020 7768                wh
-0006b1f0: 3220 3d20 7768 6963 6828 7073 2533 203d  2 = which(ps%3 =
-0006b200: 3d20 6f73 290a 2020 2020 2020 2020 2020  = os).          
-0006b210: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0006b220: 206c 656e 2877 6832 2920 3e20 303a 0a20   len(wh2) > 0:. 
+0006b0c0: 2020 6966 206c 656e 2870 7329 203e 2030    if len(ps) > 0
+0006b0d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0006b0e0: 2020 2020 2020 2020 2020 7073 203d 206e            ps = n
+0006b0f0: 702e 6172 7261 7928 7073 2920 2b20 7373  p.array(ps) + ss
+0006b100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006b110: 2020 2020 2020 2020 2077 6832 203d 2077           wh2 = w
+0006b120: 6869 6368 2870 7325 3320 3d3d 206f 7329  hich(ps%3 == os)
+0006b130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006b140: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0006b150: 7768 3229 203e 2030 3a0a 2020 2020 2020  wh2) > 0:.      
+0006b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b170: 2020 2020 2020 706f 735f 7374 6172 7420        pos_start 
+0006b180: 3d20 206e 702e 6d69 6e28 7073 5b77 6832  =  np.min(ps[wh2
+0006b190: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0006b1a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0006b1b0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+0006b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b1d0: 6966 2070 6f73 5f73 7461 7274 203c 2070  if pos_start < p
+0006b1e0: 6f73 5f73 746f 703a 0a20 2020 2020 2020  os_stop:.       
+0006b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b200: 2020 2020 2020 2020 2069 6620 2873 7461           if (sta
+0006b210: 7274 203e 3d20 3029 2026 2028 7374 6f70  rt >= 0) & (stop
+0006b220: 203e 3d20 3029 3a0a 2020 2020 2020 2020   >= 0):.        
 0006b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b240: 2020 2020 2020 2020 2020 2070 6f73 5f73             pos_s
-0006b250: 7461 7274 203d 2020 6e70 2e6d 696e 2870  tart =  np.min(p
-0006b260: 735b 7768 325d 290a 2020 2020 2020 2020  s[wh2]).        
+0006b240: 2020 2020 2020 2020 2020 2020 6c65 6e5f              len_
+0006b250: 7072 6576 203d 2073 746f 7020 2d20 7374  prev = stop - st
+0006b260: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
 0006b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b280: 2020 2020 2327 2727 0a20 2020 2020 2020      #'''.       
-0006b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b2a0: 2020 2020 2069 6620 706f 735f 7374 6172       if pos_star
-0006b2b0: 7420 3c20 706f 735f 7374 6f70 3a0a 2020  t < pos_stop:.  
-0006b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b2d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0006b2e0: 2028 7374 6172 7420 3e3d 2030 2920 2620   (start >= 0) & 
-0006b2f0: 2873 746f 7020 3e3d 2030 293a 0a20 2020  (stop >= 0):.   
-0006b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b320: 206c 656e 5f70 7265 7620 3d20 7374 6f70   len_prev = stop
-0006b330: 202d 2073 7461 7274 0a20 2020 2020 2020   - start.       
-0006b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b350: 2020 2020 2020 2020 2020 2020 206c 656e               len
-0006b360: 5f63 7572 7220 3d20 706f 735f 7374 6f70  _curr = pos_stop
-0006b370: 202d 2070 6f73 5f73 7461 7274 0a20 2020   - pos_start.   
+0006b280: 2020 2020 2020 2020 6c65 6e5f 6375 7272          len_curr
+0006b290: 203d 2070 6f73 5f73 746f 7020 2d20 706f   = pos_stop - po
+0006b2a0: 735f 7374 6172 740a 2020 2020 2020 2020  s_start.        
+0006b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b2c0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0006b2d0: 656e 5f63 7572 7220 3e20 6c65 6e5f 7072  en_curr > len_pr
+0006b2e0: 6576 3a0a 2020 2020 2020 2020 2020 2020  ev:.            
+0006b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b300: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0006b310: 7420 3d20 706f 735f 7374 6172 740a 2020  t = pos_start.  
+0006b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b340: 2020 2020 2020 7374 6f70 203d 2070 6f73        stop = pos
+0006b350: 5f73 746f 700a 2020 2020 2020 2020 2020  _stop.          
+0006b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b370: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
 0006b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0006b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b3a0: 2069 6620 6c65 6e5f 6375 7272 203e 206c   if len_curr > l
-0006b3b0: 656e 5f70 7265 763a 0a20 2020 2020 2020  en_prev:.       
+0006b3a0: 7374 6172 7420 3d20 706f 735f 7374 6172  start = pos_star
+0006b3b0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
 0006b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b3e0: 2073 7461 7274 203d 2070 6f73 5f73 7461   start = pos_sta
-0006b3f0: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-0006b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b410: 2020 2020 2020 2020 2020 2073 746f 7020             stop 
-0006b420: 3d20 706f 735f 7374 6f70 0a20 2020 2020  = pos_stop.     
-0006b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b440: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0006b450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b470: 2020 2020 2073 7461 7274 203d 2070 6f73       start = pos
-0006b480: 5f73 7461 7274 0a20 2020 2020 2020 2020  _start.         
-0006b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b4a0: 2020 2020 2020 2020 2020 2073 746f 7020             stop 
-0006b4b0: 3d20 706f 735f 7374 6f70 0a20 2020 2020  = pos_stop.     
-0006b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b4d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0006b4e0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-0006b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b500: 2020 2020 2020 2023 2727 270a 2020 2020         #'''.    
-0006b510: 2020 2020 2020 2020 7373 5f6c 7374 5b6f          ss_lst[o
-0006b520: 735d 203d 2028 7374 6172 742c 2073 746f  s] = (start, sto
-0006b530: 7029 0a20 2020 2020 2020 2020 2020 200a  p).            .
-0006b540: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
-0006b550: 2d31 0a20 2020 2020 2020 2073 746f 7020  -1.        stop 
-0006b560: 3d20 2d31 0a20 2020 2020 2020 2066 6f72  = -1.        for
-0006b570: 206f 7320 696e 2072 616e 6765 2833 293a   os in range(3):
-0006b580: 0a20 2020 2020 2020 2020 2020 2028 706f  .            (po
-0006b590: 735f 7374 6172 742c 2070 6f73 5f73 746f  s_start, pos_sto
-0006b5a0: 7029 203d 2073 735f 6c73 745b 6f73 5d0a  p) = ss_lst[os].
-0006b5b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0006b5c0: 7374 6172 7420 3e3d 2030 2920 2620 2873  start >= 0) & (s
-0006b5d0: 746f 7020 3e3d 2030 293a 0a20 2020 2020  top >= 0):.     
-0006b5e0: 2020 2020 2020 2020 2020 206c 656e 5f70             len_p
-0006b5f0: 7265 7620 3d20 7374 6f70 202d 2073 7461  rev = stop - sta
-0006b600: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-0006b610: 2020 206c 656e 5f63 7572 7220 3d20 706f     len_curr = po
-0006b620: 735f 7374 6f70 202d 2070 6f73 5f73 7461  s_stop - pos_sta
-0006b630: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-0006b640: 2020 2069 6620 6c65 6e5f 6375 7272 203e     if len_curr >
-0006b650: 206c 656e 5f70 7265 763a 0a20 2020 2020   len_prev:.     
-0006b660: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006b670: 7461 7274 203d 2070 6f73 5f73 7461 7274  tart = pos_start
-0006b680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006b690: 2020 2020 2073 746f 7020 3d20 706f 735f       stop = pos_
-0006b6a0: 7374 6f70 0a20 2020 2020 2020 2020 2020  stop.           
-0006b6b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0006b6c0: 2020 2020 2020 2073 7461 7274 203d 2070         start = p
-0006b6d0: 6f73 5f73 7461 7274 0a20 2020 2020 2020  os_start.       
-0006b6e0: 2020 2020 2020 2020 2073 746f 7020 3d20           stop = 
-0006b6f0: 706f 735f 7374 6f70 0a20 2020 2020 2020  pos_stop.       
-0006b700: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0006b710: 2020 2020 2020 7265 7475 726e 2073 7461        return sta
-0006b720: 7274 2c20 7374 6f70 2c20 7373 5f6c 7374  rt, stop, ss_lst
-0006b730: 0a20 2020 2020 2020 2020 2020 200a 0a64  .            ..d
-0006b740: 6566 2063 6865 636b 5f6f 7266 5f63 6f6e  ef check_orf_con
-0006b750: 6469 7469 6f6e 5f66 6f72 7761 7264 2874  dition_forward(t
-0006b760: 7365 7129 3a0a 2020 2020 0a20 2020 2073  seq):.    .    s
-0006b770: 7461 7274 203d 202d 310a 2020 2020 7374  tart = -1.    st
-0006b780: 6f70 203d 202d 310a 2020 2020 7373 5f6c  op = -1.    ss_l
-0006b790: 7374 203d 205b 282d 312c 2d31 292c 282d  st = [(-1,-1),(-
-0006b7a0: 312c 2d31 292c 282d 312c 2d31 295d 0a20  1,-1),(-1,-1)]. 
-0006b7b0: 2020 200a 2020 2020 706f 735f 6c73 7431     .    pos_lst1
-0006b7c0: 203d 2066 696e 645f 616c 6c5f 735f 696e   = find_all_s_in
-0006b7d0: 5f73 7472 2874 7365 712c 2053 544f 505f  _str(tseq, STOP_
-0006b7e0: 434f 444f 4e53 5b30 5d29 0a20 2020 2070  CODONS[0]).    p
-0006b7f0: 6f73 5f6c 7374 3220 3d20 6669 6e64 5f61  os_lst2 = find_a
-0006b800: 6c6c 5f73 5f69 6e5f 7374 7228 7473 6571  ll_s_in_str(tseq
-0006b810: 2c20 5354 4f50 5f43 4f44 4f4e 535b 315d  , STOP_CODONS[1]
-0006b820: 290a 2020 2020 706f 735f 6c73 7433 203d  ).    pos_lst3 =
-0006b830: 2066 696e 645f 616c 6c5f 735f 696e 5f73   find_all_s_in_s
-0006b840: 7472 2874 7365 712c 2053 544f 505f 434f  tr(tseq, STOP_CO
-0006b850: 444f 4e53 5b32 5d29 0a20 2020 2070 6f73  DONS[2]).    pos
-0006b860: 5f6c 7374 203d 2070 6f73 5f6c 7374 3120  _lst = pos_lst1 
-0006b870: 2b20 706f 735f 6c73 7432 202b 2070 6f73  + pos_lst2 + pos
-0006b880: 5f6c 7374 330a 2020 2020 706f 735f 6c73  _lst3.    pos_ls
-0006b890: 742e 736f 7274 2829 0a20 2020 200a 2020  t.sort().    .  
-0006b8a0: 2020 706f 735f 6c73 745f 7374 6172 7420    pos_lst_start 
-0006b8b0: 3d20 6669 6e64 5f61 6c6c 5f73 5f69 6e5f  = find_all_s_in_
-0006b8c0: 7374 7228 7473 6571 2c20 5354 4152 545f  str(tseq, START_
-0006b8d0: 434f 444f 4e29 0a20 2020 2070 6f73 5f6c  CODON).    pos_l
-0006b8e0: 7374 5f73 7461 7274 203d 206e 702e 6172  st_start = np.ar
-0006b8f0: 7261 7928 706f 735f 6c73 745f 7374 6172  ray(pos_lst_star
-0006b900: 7429 0a20 2020 200a 2020 2020 6966 206c  t).    .    if l
-0006b910: 656e 2870 6f73 5f6c 7374 2920 3e20 303a  en(pos_lst) > 0:
-0006b920: 0a20 2020 2020 2020 2070 6f73 5f6c 7374  .        pos_lst
-0006b930: 203d 206e 702e 6172 7261 7928 706f 735f   = np.array(pos_
-0006b940: 6c73 7429 0a20 2020 2020 2020 2066 6f72  lst).        for
-0006b950: 206f 7320 696e 2072 616e 6765 2833 293a   os in range(3):
-0006b960: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-0006b970: 7274 203d 202d 310a 2020 2020 2020 2020  rt = -1.        
-0006b980: 2020 2020 7374 6f70 203d 202d 310a 2020      stop = -1.  
-0006b990: 2020 2020 2020 2020 2020 7768 203d 2077            wh = w
-0006b9a0: 6869 6368 2820 706f 735f 6c73 7425 3320  hich( pos_lst%3 
-0006b9b0: 3d3d 206f 7320 290a 2020 2020 2020 2020  == os ).        
-0006b9c0: 2020 2020 6966 206c 656e 2877 6829 203e      if len(wh) >
-0006b9d0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0006b9e0: 2020 2020 666f 7220 6b2c 7720 696e 2065      for k,w in e
-0006b9f0: 6e75 6d65 7261 7465 2877 6829 3a0a 2020  numerate(wh):.  
-0006ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ba10: 2020 706f 735f 7374 6f70 203d 2070 6f73    pos_stop = pos
-0006ba20: 5f6c 7374 5b77 5d0a 2020 2020 2020 2020  _lst[w].        
-0006ba30: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
-0006ba40: 7374 6172 7420 3d20 2d31 0a0a 2020 2020  start = -1..    
+0006b3d0: 2020 2020 2020 7374 6f70 203d 2070 6f73        stop = pos
+0006b3e0: 5f73 746f 700a 2020 2020 2020 2020 2020  _stop.          
+0006b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b400: 2020 2020 2020 2020 2020 2320 6272 6561            # brea
+0006b410: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0006b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b430: 2020 2327 2727 0a20 2020 2020 2020 2020    #'''.         
+0006b440: 2020 2073 735f 6c73 745b 6f73 5d20 3d20     ss_lst[os] = 
+0006b450: 2873 7461 7274 2c20 7374 6f70 290a 2020  (start, stop).  
+0006b460: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0006b470: 2020 2073 7461 7274 203d 202d 310a 2020     start = -1.  
+0006b480: 2020 2020 2020 7374 6f70 203d 202d 310a        stop = -1.
+0006b490: 2020 2020 2020 2020 666f 7220 6f73 2069          for os i
+0006b4a0: 6e20 7261 6e67 6528 3329 3a0a 2020 2020  n range(3):.    
+0006b4b0: 2020 2020 2020 2020 2870 6f73 5f73 7461          (pos_sta
+0006b4c0: 7274 2c20 706f 735f 7374 6f70 2920 3d20  rt, pos_stop) = 
+0006b4d0: 7373 5f6c 7374 5b6f 735d 0a20 2020 2020  ss_lst[os].     
+0006b4e0: 2020 2020 2020 2069 6620 2873 7461 7274         if (start
+0006b4f0: 203e 3d20 3029 2026 2028 7374 6f70 203e   >= 0) & (stop >
+0006b500: 3d20 3029 3a0a 2020 2020 2020 2020 2020  = 0):.          
+0006b510: 2020 2020 2020 6c65 6e5f 7072 6576 203d        len_prev =
+0006b520: 2073 746f 7020 2d20 7374 6172 740a 2020   stop - start.  
+0006b530: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+0006b540: 6e5f 6375 7272 203d 2070 6f73 5f73 746f  n_curr = pos_sto
+0006b550: 7020 2d20 706f 735f 7374 6172 740a 2020  p - pos_start.  
+0006b560: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0006b570: 206c 656e 5f63 7572 7220 3e20 6c65 6e5f   len_curr > len_
+0006b580: 7072 6576 3a0a 2020 2020 2020 2020 2020  prev:.          
+0006b590: 2020 2020 2020 2020 2020 7374 6172 7420            start 
+0006b5a0: 3d20 706f 735f 7374 6172 740a 2020 2020  = pos_start.    
+0006b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b5c0: 7374 6f70 203d 2070 6f73 5f73 746f 700a  stop = pos_stop.
+0006b5d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0006b5e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0006b5f0: 2020 7374 6172 7420 3d20 706f 735f 7374    start = pos_st
+0006b600: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
+0006b610: 2020 2020 7374 6f70 203d 2070 6f73 5f73      stop = pos_s
+0006b620: 746f 700a 2020 2020 2020 2020 2020 2020  top.            
+0006b630: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0006b640: 2072 6574 7572 6e20 7374 6172 742c 2073   return start, s
+0006b650: 746f 702c 2073 735f 6c73 740a 2020 2020  top, ss_lst.    
+0006b660: 2020 2020 2020 2020 0a0a 6465 6620 6368          ..def ch
+0006b670: 6563 6b5f 6f72 665f 636f 6e64 6974 696f  eck_orf_conditio
+0006b680: 6e5f 666f 7277 6172 6428 7473 6571 293a  n_forward(tseq):
+0006b690: 0a20 2020 200a 2020 2020 7374 6172 7420  .    .    start 
+0006b6a0: 3d20 2d31 0a20 2020 2073 746f 7020 3d20  = -1.    stop = 
+0006b6b0: 2d31 0a20 2020 2073 735f 6c73 7420 3d20  -1.    ss_lst = 
+0006b6c0: 5b28 2d31 2c2d 3129 2c28 2d31 2c2d 3129  [(-1,-1),(-1,-1)
+0006b6d0: 2c28 2d31 2c2d 3129 5d0a 2020 2020 0a20  ,(-1,-1)].    . 
+0006b6e0: 2020 2070 6f73 5f6c 7374 3120 3d20 6669     pos_lst1 = fi
+0006b6f0: 6e64 5f61 6c6c 5f73 5f69 6e5f 7374 7228  nd_all_s_in_str(
+0006b700: 7473 6571 2c20 5354 4f50 5f43 4f44 4f4e  tseq, STOP_CODON
+0006b710: 535b 305d 290a 2020 2020 706f 735f 6c73  S[0]).    pos_ls
+0006b720: 7432 203d 2066 696e 645f 616c 6c5f 735f  t2 = find_all_s_
+0006b730: 696e 5f73 7472 2874 7365 712c 2053 544f  in_str(tseq, STO
+0006b740: 505f 434f 444f 4e53 5b31 5d29 0a20 2020  P_CODONS[1]).   
+0006b750: 2070 6f73 5f6c 7374 3320 3d20 6669 6e64   pos_lst3 = find
+0006b760: 5f61 6c6c 5f73 5f69 6e5f 7374 7228 7473  _all_s_in_str(ts
+0006b770: 6571 2c20 5354 4f50 5f43 4f44 4f4e 535b  eq, STOP_CODONS[
+0006b780: 325d 290a 2020 2020 706f 735f 6c73 7420  2]).    pos_lst 
+0006b790: 3d20 706f 735f 6c73 7431 202b 2070 6f73  = pos_lst1 + pos
+0006b7a0: 5f6c 7374 3220 2b20 706f 735f 6c73 7433  _lst2 + pos_lst3
+0006b7b0: 0a20 2020 2070 6f73 5f6c 7374 2e73 6f72  .    pos_lst.sor
+0006b7c0: 7428 290a 2020 2020 0a20 2020 2070 6f73  t().    .    pos
+0006b7d0: 5f6c 7374 5f73 7461 7274 203d 2066 696e  _lst_start = fin
+0006b7e0: 645f 616c 6c5f 735f 696e 5f73 7472 2874  d_all_s_in_str(t
+0006b7f0: 7365 712c 2053 5441 5254 5f43 4f44 4f4e  seq, START_CODON
+0006b800: 290a 2020 2020 706f 735f 6c73 745f 7374  ).    pos_lst_st
+0006b810: 6172 7420 3d20 6e70 2e61 7272 6179 2870  art = np.array(p
+0006b820: 6f73 5f6c 7374 5f73 7461 7274 290a 2020  os_lst_start).  
+0006b830: 2020 0a20 2020 2069 6620 6c65 6e28 706f    .    if len(po
+0006b840: 735f 6c73 7429 203e 2030 3a0a 2020 2020  s_lst) > 0:.    
+0006b850: 2020 2020 706f 735f 6c73 7420 3d20 6e70      pos_lst = np
+0006b860: 2e61 7272 6179 2870 6f73 5f6c 7374 290a  .array(pos_lst).
+0006b870: 2020 2020 2020 2020 666f 7220 6f73 2069          for os i
+0006b880: 6e20 7261 6e67 6528 3329 3a0a 2020 2020  n range(3):.    
+0006b890: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
+0006b8a0: 2d31 0a20 2020 2020 2020 2020 2020 2073  -1.            s
+0006b8b0: 746f 7020 3d20 2d31 0a20 2020 2020 2020  top = -1.       
+0006b8c0: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
+0006b8d0: 2070 6f73 5f6c 7374 2533 203d 3d20 6f73   pos_lst%3 == os
+0006b8e0: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+0006b8f0: 6620 6c65 6e28 7768 2920 3e20 303a 0a20  f len(wh) > 0:. 
+0006b900: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0006b910: 6f72 206b 2c77 2069 6e20 656e 756d 6572  or k,w in enumer
+0006b920: 6174 6528 7768 293a 0a20 2020 2020 2020  ate(wh):.       
+0006b930: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+0006b940: 5f73 746f 7020 3d20 706f 735f 6c73 745b  _stop = pos_lst[
+0006b950: 775d 0a20 2020 2020 2020 2020 2020 2020  w].             
+0006b960: 2020 2020 2020 2070 6f73 5f73 7461 7274         pos_start
+0006b970: 203d 202d 310a 0a20 2020 2020 2020 2020   = -1..         
+0006b980: 2020 2020 2020 2020 2020 2073 7320 3d20             ss = 
+0006b990: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+0006b9a0: 2020 2020 2020 6966 206b 203e 2030 3a20        if k > 0: 
+0006b9b0: 7373 203d 2070 6f73 5f6c 7374 5b77 685b  ss = pos_lst[wh[
+0006b9c0: 6b2d 315d 5d0a 2020 2020 2020 2020 2020  k-1]].          
+0006b9d0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0006b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b9f0: 2020 2070 7320 3d20 6669 6e64 5f61 6c6c     ps = find_all
+0006ba00: 5f73 5f69 6e5f 7374 7228 7473 6571 5b73  _s_in_str(tseq[s
+0006ba10: 733a 706f 735f 7374 6f70 5d2c 2053 5441  s:pos_stop], STA
+0006ba20: 5254 5f43 4f44 4f4e 290a 2020 2020 2020  RT_CODON).      
+0006ba30: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0006ba40: 206c 656e 2870 7329 203e 2030 3a0a 2020   len(ps) > 0:.  
 0006ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ba60: 7373 203d 2030 0a20 2020 2020 2020 2020  ss = 0.         
-0006ba70: 2020 2020 2020 2020 2020 2069 6620 6b20             if k 
-0006ba80: 3e20 303a 2073 7320 3d20 706f 735f 6c73  > 0: ss = pos_ls
-0006ba90: 745b 7768 5b6b 2d31 5d5d 0a20 2020 2020  t[wh[k-1]].     
-0006baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bab0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0006bac0: 2020 2020 2020 2020 7073 203d 2066 696e          ps = fin
-0006bad0: 645f 616c 6c5f 735f 696e 5f73 7472 2874  d_all_s_in_str(t
-0006bae0: 7365 715b 7373 3a70 6f73 5f73 746f 705d  seq[ss:pos_stop]
-0006baf0: 2c20 5354 4152 545f 434f 444f 4e29 0a20  , START_CODON). 
-0006bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bb10: 2020 2069 6620 6c65 6e28 7073 2920 3e20     if len(ps) > 
-0006bb20: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0006bb30: 2020 2020 2020 2020 2020 2070 7320 3d20             ps = 
-0006bb40: 6e70 2e61 7272 6179 2870 7329 202b 2073  np.array(ps) + s
-0006bb50: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0006bb60: 2020 2020 2020 2020 2020 7768 3220 3d20            wh2 = 
-0006bb70: 7768 6963 6828 7073 2533 203d 3d20 6f73  which(ps%3 == os
-0006bb80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0006bb90: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0006bba0: 2877 6832 2920 3e20 303a 0a20 2020 2020  (wh2) > 0:.     
+0006ba60: 2020 2020 2020 7073 203d 206e 702e 6172        ps = np.ar
+0006ba70: 7261 7928 7073 2920 2b20 7373 0a20 2020  ray(ps) + ss.   
+0006ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ba90: 2020 2020 2077 6832 203d 2077 6869 6368       wh2 = which
+0006baa0: 2870 7325 3320 3d3d 206f 7329 0a20 2020  (ps%3 == os).   
+0006bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bac0: 2020 2020 2069 6620 6c65 6e28 7768 3229       if len(wh2)
+0006bad0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0006bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006baf0: 2020 706f 735f 7374 6172 7420 3d20 206e    pos_start =  n
+0006bb00: 702e 6d69 6e28 7073 5b77 6832 5d29 0a20  p.min(ps[wh2]). 
+0006bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bb20: 2020 2020 2020 2020 2020 2023 2727 270a             #'''.
+0006bb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bb40: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0006bb50: 6f73 5f73 7461 7274 203c 2070 6f73 5f73  os_start < pos_s
+0006bb60: 746f 703a 0a20 2020 2020 2020 2020 2020  top:.           
+0006bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bb80: 2020 2020 2069 6620 2873 7461 7274 203e       if (start >
+0006bb90: 3d20 3029 2026 2028 7374 6f70 203e 3d20  = 0) & (stop >= 
+0006bba0: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
 0006bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bbc0: 2020 2020 2020 2070 6f73 5f73 7461 7274         pos_start
-0006bbd0: 203d 2020 6e70 2e6d 696e 2870 735b 7768   =  np.min(ps[wh
-0006bbe0: 325d 290a 2020 2020 2020 2020 2020 2020  2]).            
+0006bbc0: 2020 2020 2020 2020 6c65 6e5f 7072 6576          len_prev
+0006bbd0: 203d 2073 746f 7020 2d20 7374 6172 740a   = stop - start.
+0006bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0006bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bc00: 2327 2727 0a20 2020 2020 2020 2020 2020  #'''.           
-0006bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bc20: 2069 6620 706f 735f 7374 6172 7420 3c20   if pos_start < 
-0006bc30: 706f 735f 7374 6f70 3a0a 2020 2020 2020  pos_stop:.      
-0006bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bc50: 2020 2020 2020 2020 2020 6966 2028 7374            if (st
-0006bc60: 6172 7420 3e3d 2030 2920 2620 2873 746f  art >= 0) & (sto
-0006bc70: 7020 3e3d 2030 293a 0a20 2020 2020 2020  p >= 0):.       
-0006bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bc90: 2020 2020 2020 2020 2020 2020 206c 656e               len
-0006bca0: 5f70 7265 7620 3d20 7374 6f70 202d 2073  _prev = stop - s
-0006bcb0: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
-0006bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bcd0: 2020 2020 2020 2020 206c 656e 5f63 7572           len_cur
-0006bce0: 7220 3d20 706f 735f 7374 6f70 202d 2070  r = pos_stop - p
-0006bcf0: 6f73 5f73 7461 7274 0a20 2020 2020 2020  os_start.       
+0006bc00: 2020 2020 6c65 6e5f 6375 7272 203d 2070      len_curr = p
+0006bc10: 6f73 5f73 746f 7020 2d20 706f 735f 7374  os_stop - pos_st
+0006bc20: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
+0006bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bc40: 2020 2020 2020 2020 6966 206c 656e 5f63          if len_c
+0006bc50: 7572 7220 3e20 6c65 6e5f 7072 6576 3a0a  urr > len_prev:.
+0006bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bc80: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
+0006bc90: 706f 735f 7374 6172 740a 2020 2020 2020  pos_start.      
+0006bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bcc0: 2020 7374 6f70 203d 2070 6f73 5f73 746f    stop = pos_sto
+0006bcd0: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
+0006bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bcf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
 0006bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bd10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0006bd20: 6c65 6e5f 6375 7272 203e 206c 656e 5f70  len_curr > len_p
-0006bd30: 7265 763a 0a20 2020 2020 2020 2020 2020  rev:.           
+0006bd10: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0006bd20: 7420 3d20 706f 735f 7374 6172 740a 2020  t = pos_start.  
+0006bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0006bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bd50: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-0006bd60: 7274 203d 2070 6f73 5f73 7461 7274 0a20  rt = pos_start. 
+0006bd50: 2020 7374 6f70 203d 2070 6f73 5f73 746f    stop = pos_sto
+0006bd60: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
 0006bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bd90: 2020 2020 2020 2073 746f 7020 3d20 706f         stop = po
-0006bda0: 735f 7374 6f70 0a20 2020 2020 2020 2020  s_stop.         
-0006bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bdc0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0006bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bdf0: 2073 7461 7274 203d 2070 6f73 5f73 7461   start = pos_sta
-0006be00: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-0006be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006be20: 2020 2020 2020 2073 746f 7020 3d20 706f         stop = po
-0006be30: 735f 7374 6f70 0a20 2020 2020 2020 2020  s_stop.         
-0006be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006be50: 2020 2020 2020 2020 2020 2023 2062 7265             # bre
-0006be60: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-0006be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006be80: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
-0006be90: 2020 2020 2020 2020 6966 2028 7374 6172          if (star
-0006bea0: 7420 3c20 3029 3a0a 2020 2020 2020 2020  t < 0):.        
-0006beb0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-0006bec0: 203d 2070 6f73 5f6c 7374 5b77 685b 305d   = pos_lst[wh[0]
-0006bed0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-0006bee0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0006bef0: 2020 2020 6966 206c 656e 2870 6f73 5f6c      if len(pos_l
-0006bf00: 7374 5f73 7461 7274 2920 3e20 303a 200a  st_start) > 0: .
-0006bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bf20: 2020 2020 7768 203d 2077 6869 6368 2870      wh = which(p
-0006bf30: 6f73 5f6c 7374 5f73 7461 7274 2533 203d  os_lst_start%3 =
-0006bf40: 3d20 6f73 290a 2020 2020 2020 2020 2020  = os).          
-0006bf50: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0006bf60: 2877 6829 203e 2030 3a0a 2020 2020 2020  (wh) > 0:.      
-0006bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bf80: 2020 7374 6172 7420 3d20 706f 735f 6c73    start = pos_ls
-0006bf90: 745f 7374 6172 745b 7768 5b30 5d5d 0a20  t_start[wh[0]]. 
-0006bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bfb0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0006bfc0: 2020 2020 7373 5f6c 7374 5b6f 735d 203d      ss_lst[os] =
-0006bfd0: 2028 7374 6172 742c 2073 746f 7029 0a20   (start, stop). 
-0006bfe0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0006bff0: 656c 6966 206c 656e 2870 6f73 5f6c 7374  elif len(pos_lst
-0006c000: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0006c010: 6966 206c 656e 2870 6f73 5f6c 7374 5f73  if len(pos_lst_s
-0006c020: 7461 7274 2920 3e20 303a 0a20 2020 2020  tart) > 0:.     
-0006c030: 2020 2020 2020 2066 6f72 206f 7320 696e         for os in
-0006c040: 2072 616e 6765 2833 293a 0a20 2020 2020   range(3):.     
-0006c050: 2020 2020 2020 2020 2020 2073 7461 7274             start
-0006c060: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
-0006c070: 2020 2020 2020 7768 203d 2077 6869 6368        wh = which
-0006c080: 2870 6f73 5f6c 7374 5f73 7461 7274 2533  (pos_lst_start%3
-0006c090: 203d 3d20 6f73 290a 2020 2020 2020 2020   == os).        
-0006c0a0: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
-0006c0b0: 6829 203e 2030 3a0a 2020 2020 2020 2020  h) > 0:.        
-0006c0c0: 2020 2020 2020 2020 2020 2020 7374 6172              star
-0006c0d0: 7420 3d20 706f 735f 6c73 745f 7374 6172  t = pos_lst_star
-0006c0e0: 745b 7768 5b30 5d5d 0a20 2020 2020 2020  t[wh[0]].       
-0006c0f0: 2020 2020 2020 2020 2073 735f 6c73 745b           ss_lst[
-0006c100: 6f73 5d20 3d20 2873 7461 7274 2c20 7374  os] = (start, st
-0006c110: 6f70 290a 2020 2020 2020 2020 656c 7365  op).        else
-0006c120: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0006c130: 7475 726e 2073 7461 7274 2c20 7374 6f70  turn start, stop
-0006c140: 2c20 7373 5f6c 7374 0a20 2020 2020 2020  , ss_lst.       
-0006c150: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0006c160: 2020 0a20 2020 2073 7461 7274 203d 202d    .    start = -
-0006c170: 310a 2020 2020 7374 6f70 203d 202d 310a  1.    stop = -1.
-0006c180: 2020 2020 666f 7220 6f73 2069 6e20 7261      for os in ra
-0006c190: 6e67 6528 3329 3a0a 2020 2020 2020 2020  nge(3):.        
-0006c1a0: 2870 6f73 5f73 7461 7274 2c20 706f 735f  (pos_start, pos_
-0006c1b0: 7374 6f70 2920 3d20 7373 5f6c 7374 5b6f  stop) = ss_lst[o
-0006c1c0: 735d 0a20 2020 2020 2020 2069 6620 2870  s].        if (p
-0006c1d0: 6f73 5f73 7461 7274 203e 3d20 3029 2026  os_start >= 0) &
-0006c1e0: 2028 706f 735f 7374 6f70 203e 3d20 3029   (pos_stop >= 0)
-0006c1f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0006c200: 2028 7374 6172 7420 3e3d 2030 2920 2620   (start >= 0) & 
-0006c210: 2873 746f 7020 3e3d 2030 293a 0a20 2020  (stop >= 0):.   
-0006c220: 2020 2020 2020 2020 2020 2020 206c 656e               len
-0006c230: 5f70 7265 7620 3d20 7374 6f70 202d 2073  _prev = stop - s
-0006c240: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
-0006c250: 2020 2020 206c 656e 5f63 7572 7220 3d20       len_curr = 
-0006c260: 706f 735f 7374 6f70 202d 2070 6f73 5f73  pos_stop - pos_s
-0006c270: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
-0006c280: 2020 2020 2069 6620 6c65 6e5f 6375 7272       if len_curr
-0006c290: 203e 206c 656e 5f70 7265 763a 0a20 2020   > len_prev:.   
-0006c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c2b0: 2073 7461 7274 203d 2070 6f73 5f73 7461   start = pos_sta
-0006c2c0: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-0006c2d0: 2020 2020 2020 2073 746f 7020 3d20 706f         stop = po
-0006c2e0: 735f 7374 6f70 0a20 2020 2020 2020 2020  s_stop.         
-0006c2f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0006c300: 2020 2020 2020 2020 2073 7461 7274 203d           start =
-0006c310: 2070 6f73 5f73 7461 7274 0a20 2020 2020   pos_start.     
-0006c320: 2020 2020 2020 2020 2020 2073 746f 7020             stop 
-0006c330: 3d20 706f 735f 7374 6f70 0a0a 2020 2020  = pos_stop..    
-0006c340: 6966 2028 7374 6172 7420 3c20 3029 2026  if (start < 0) &
-0006c350: 2028 7374 6f70 203c 2030 293a 0a20 2020   (stop < 0):.   
-0006c360: 2020 2020 2066 6f72 206f 7320 696e 2072       for os in r
-0006c370: 616e 6765 2833 293a 0a20 2020 2020 2020  ange(3):.       
-0006c380: 2020 2020 2028 706f 735f 7374 6172 742c       (pos_start,
-0006c390: 2070 6f73 5f73 746f 7029 203d 2073 735f   pos_stop) = ss_
-0006c3a0: 6c73 745b 6f73 5d0a 2020 2020 2020 2020  lst[os].        
-0006c3b0: 2020 2020 6966 2028 706f 735f 7374 6172      if (pos_star
-0006c3c0: 7420 3e3d 2030 293a 0a20 2020 2020 2020  t >= 0):.       
-0006c3d0: 2020 2020 2020 2020 2070 6f73 5f73 746f           pos_sto
-0006c3e0: 7020 3d20 6c65 6e28 7473 6571 2920 2d20  p = len(tseq) - 
-0006c3f0: 286c 656e 2874 7365 7129 202d 2070 6f73  (len(tseq) - pos
-0006c400: 5f73 7461 7274 2925 330a 2020 2020 2020  _start)%3.      
-0006c410: 2020 2020 2020 656c 6966 2028 706f 735f        elif (pos_
-0006c420: 7374 6f70 203e 3d20 3029 3a0a 2020 2020  stop >= 0):.    
-0006c430: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
-0006c440: 7374 6172 7420 3d20 6f73 0a0a 2020 2020  start = os..    
-0006c450: 2020 2020 2020 2020 6966 2028 7374 6172          if (star
-0006c460: 7420 3e3d 2030 2920 2620 2873 746f 7020  t >= 0) & (stop 
-0006c470: 3e3d 2030 293a 0a20 2020 2020 2020 2020  >= 0):.         
-0006c480: 2020 2020 2020 206c 656e 5f70 7265 7620         len_prev 
-0006c490: 3d20 7374 6f70 202d 2073 7461 7274 0a20  = stop - start. 
-0006c4a0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0006c4b0: 656e 5f63 7572 7220 3d20 706f 735f 7374  en_curr = pos_st
-0006c4c0: 6f70 202d 2070 6f73 5f73 7461 7274 0a20  op - pos_start. 
-0006c4d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006c4e0: 6620 6c65 6e5f 6375 7272 203e 206c 656e  f len_curr > len
-0006c4f0: 5f70 7265 763a 0a20 2020 2020 2020 2020  _prev:.         
-0006c500: 2020 2020 2020 2020 2020 2073 7461 7274             start
-0006c510: 203d 2070 6f73 5f73 7461 7274 0a20 2020   = pos_start.   
-0006c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c530: 2073 746f 7020 3d20 706f 735f 7374 6f70   stop = pos_stop
-0006c540: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0006c550: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0006c560: 2020 2073 7461 7274 203d 2070 6f73 5f73     start = pos_s
-0006c570: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
-0006c580: 2020 2020 2073 746f 7020 3d20 706f 735f       stop = pos_
-0006c590: 7374 6f70 0a20 2020 2020 2020 2020 2020  stop.           
-0006c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c5b0: 2020 2020 2020 2020 0a20 2020 2072 6574          .    ret
-0006c5c0: 7572 6e20 7374 6172 742c 2073 746f 702c  urn start, stop,
-0006c5d0: 2073 735f 6c73 740a 2020 2020 2020 2020   ss_lst.        
-0006c5e0: 2020 2020 0a0a 6465 6620 6368 6563 6b5f      ..def check_
-0006c5f0: 6f72 665f 636f 6e64 6974 696f 6e28 7473  orf_condition(ts
-0006c600: 6571 2c20 7374 7261 6e64 203d 2031 293a  eq, strand = 1):
-0006c610: 0a20 2020 200a 2020 2020 6966 2073 7472  .    .    if str
-0006c620: 616e 6420 3e20 303a 0a20 2020 2020 2020  and > 0:.       
-0006c630: 2073 7461 7274 2c20 7374 6f70 2c20 7373   start, stop, ss
-0006c640: 5f6c 7374 203d 2063 6865 636b 5f6f 7266  _lst = check_orf
-0006c650: 5f63 6f6e 6469 7469 6f6e 5f66 6f72 7761  _condition_forwa
-0006c660: 7264 2874 7365 7129 0a20 2020 2020 2020  rd(tseq).       
-0006c670: 2072 6574 7572 6e20 7374 6172 742c 2073   return start, s
-0006c680: 746f 702c 2073 735f 6c73 740a 2020 2020  top, ss_lst.    
-0006c690: 656c 6966 2073 7472 616e 6420 3c20 303a  elif strand < 0:
-0006c6a0: 0a20 2020 2020 2020 2074 7365 715f 6320  .        tseq_c 
-0006c6b0: 3d20 7265 7665 7273 655f 636f 6d70 6c65  = reverse_comple
-0006c6c0: 6d65 6e74 2874 7365 7129 0a20 2020 2020  ment(tseq).     
-0006c6d0: 2020 2073 7461 7274 2c20 7374 6f70 2c20     start, stop, 
-0006c6e0: 7373 5f6c 7374 203d 2063 6865 636b 5f6f  ss_lst = check_o
-0006c6f0: 7266 5f63 6f6e 6469 7469 6f6e 5f66 6f72  rf_condition_for
-0006c700: 7761 7264 2874 7365 715f 6329 0a20 2020  ward(tseq_c).   
-0006c710: 2020 2020 2072 6574 7572 6e20 7374 6172       return star
-0006c720: 742c 2073 746f 702c 2073 735f 6c73 740a  t, stop, ss_lst.
-0006c730: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0006c740: 2020 7374 6172 7420 3d20 2d31 0a20 2020    start = -1.   
-0006c750: 2020 2020 2073 746f 7020 3d20 2d31 0a20       stop = -1. 
-0006c760: 2020 2020 2020 2073 735f 6c73 7420 3d20         ss_lst = 
-0006c770: 5b5d 0a20 2020 2020 2020 2072 6574 7572  [].        retur
-0006c780: 6e20 7374 6172 742c 2073 746f 702c 2073  n start, stop, s
-0006c790: 735f 6c73 7420 2020 200a 0a0a 6465 6620  s_lst    ...def 
-0006c7a0: 6765 745f 6174 7472 735f 6672 6f6d 5f66  get_attrs_from_f
-0006c7b0: 615f 6865 6164 6572 2873 7472 5f61 7474  a_header(str_att
-0006c7c0: 7229 3a0a 2020 2020 0a20 2020 206e 616d  r):.    .    nam
-0006c7d0: 6520 3d20 4e6f 6e65 0a20 2020 204c 656e  e = None.    Len
-0006c7e0: 203d 202d 310a 2020 2020 6162 6e20 3d20   = -1.    abn = 
-0006c7f0: 2d31 0a20 2020 2069 7374 7261 6e64 203d  -1.    istrand =
-0006c800: 204e 6f6e 650a 2020 2020 6364 6e67 203d   None.    cdng =
-0006c810: 204e 6f6e 650a 2020 2020 0a20 2020 2069   None.    .    i
-0006c820: 7465 6d73 203d 2073 7472 5f61 7474 722e  tems = str_attr.
-0006c830: 7370 6c69 7428 2720 2729 0a20 2020 2069  split(' ').    i
-0006c840: 6620 6c65 6e28 6974 656d 7329 203e 2030  f len(items) > 0
-0006c850: 3a20 6e61 6d65 203d 2069 7465 6d73 5b30  : name = items[0
-0006c860: 5d0a 2020 2020 6966 206c 656e 2869 7465  ].    if len(ite
-0006c870: 6d73 2920 3e20 313a 0a20 2020 2020 2020  ms) > 1:.       
-0006c880: 2066 6f72 2069 7465 6d20 696e 2069 7465   for item in ite
-0006c890: 6d73 5b31 3a2d 315d 3a0a 2020 2020 2020  ms[1:-1]:.      
-0006c8a0: 2020 2020 2020 7375 625f 6974 656d 203d        sub_item =
-0006c8b0: 2069 7465 6d2e 7370 6c69 7428 273a 2729   item.split(':')
-0006c8c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0006c8d0: 7375 625f 6974 656d 5b30 5d20 3d3d 2027  sub_item[0] == '
-0006c8e0: 6c65 6e67 7468 273a 0a20 2020 2020 2020  length':.       
-0006c8f0: 2020 2020 2020 2020 204c 656e 203d 2069           Len = i
-0006c900: 6e74 2873 7562 5f69 7465 6d5b 315d 290a  nt(sub_item[1]).
-0006c910: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0006c920: 2073 7562 5f69 7465 6d5b 305d 203d 3d20   sub_item[0] == 
-0006c930: 2761 626e 273a 0a20 2020 2020 2020 2020  'abn':.         
-0006c940: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0006c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c960: 6162 6e20 3d20 6e70 2e66 6c6f 6174 3332  abn = np.float32
-0006c970: 2873 7562 5f69 7465 6d5b 315d 290a 2020  (sub_item[1]).  
-0006c980: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0006c990: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-0006c9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006c9b0: 2020 2020 2070 7269 6e74 2827 5741 524e       print('WARN
-0006c9c0: 494e 473a 2025 7320 6e6f 7420 6120 6e75  ING: %s not a nu
-0006c9d0: 6d62 6572 2720 2520 7375 625f 6974 656d  mber' % sub_item
-0006c9e0: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-0006c9f0: 2020 2020 2020 2020 2061 626e 203d 2030           abn = 0
-0006ca00: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0006ca10: 6620 7375 625f 6974 656d 5b30 5d20 3d3d  f sub_item[0] ==
-0006ca20: 2027 7374 7261 6e64 273a 0a20 2020 2020   'strand':.     
-0006ca30: 2020 2020 2020 2020 2020 2069 7374 7261             istra
-0006ca40: 6e64 203d 2067 6574 5f69 7374 7261 6e64  nd = get_istrand
-0006ca50: 5f66 726f 6d5f 6328 7375 625f 6974 656d  _from_c(sub_item
-0006ca60: 5b31 5d5b 305d 2920 2320 6765 745f 635f  [1][0]) # get_c_
-0006ca70: 6672 6f6d 5f69 7374 7261 6e64 0a20 2020  from_istrand.   
-0006ca80: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
-0006ca90: 6e28 7375 625f 6974 656d 2920 3d3d 2031  n(sub_item) == 1
-0006caa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0006cab0: 2020 6364 6e67 203d 2067 6574 5f69 6364    cdng = get_icd
-0006cac0: 6e67 5f66 726f 6d5f 7374 7228 7375 625f  ng_from_str(sub_
-0006cad0: 6974 656d 5b30 5d29 0a20 2020 200a 2020  item[0]).    .  
-0006cae0: 2020 7265 7475 726e 206e 616d 652c 204c    return name, L
-0006caf0: 656e 2c20 6162 6e2c 2069 7374 7261 6e64  en, abn, istrand
-0006cb00: 2c20 6364 6e67 0a0a 2727 270a 6465 6620  , cdng..'''.def 
-0006cb10: 7365 745f 6661 5f68 6561 6465 7228 6e61  set_fa_header(na
-0006cb20: 6d65 2c20 4c65 6e2c 2061 626e 2c20 7374  me, Len, abn, st
-0006cb30: 7261 6e64 2c20 6364 6e67 293a 0a20 2020  rand, cdng):.   
-0006cb40: 200a 2020 2020 6864 7220 3d20 2725 7320   .    hdr = '%s 
-0006cb50: 6c65 6e67 7468 3a25 6920 6162 6e3a 2535  length:%i abn:%5
-0006cb60: 2e32 6620 7374 7261 6e64 3a25 7320 2573  .2f strand:%s %s
-0006cb70: 2720 2520 286e 616d 652c 204c 656e 2c20  ' % (name, Len, 
-0006cb80: 6162 6e2c 2067 6574 5f63 5f66 726f 6d5f  abn, get_c_from_
-0006cb90: 6973 7472 616e 6428 7374 7261 6e64 292c  istrand(strand),
-0006cba0: 2067 6574 5f73 7472 5f66 726f 6d5f 6963   get_str_from_ic
-0006cbb0: 646e 6728 6364 6e67 2929 0a20 2020 2072  dng(cdng)).    r
-0006cbc0: 6574 7572 6e20 6864 720a 2727 2720 2020  eturn hdr.'''   
-0006cbd0: 200a 0a64 6566 2067 656e 5f70 726f 7465   ..def gen_prote
-0006cbe0: 6f6d 655f 6672 6f6d 5f74 7261 7363 7269  ome_from_trascri
-0006cbf0: 7074 6f6d 6528 6864 725f 6c73 742c 2074  ptome(hdr_lst, t
-0006cc00: 7365 715f 6c73 742c 206c 656e 5f74 6820  seq_lst, len_th 
-0006cc10: 3d20 4d49 4e5f 5052 5f4c 454e 4754 482c  = MIN_PR_LENGTH,
-0006cc20: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
-0006cc30: 206d 785f 636e 7420 3d20 302c 2074 7261   mx_cnt = 0, tra
-0006cc40: 7265 636f 203d 2046 616c 7365 2c20 6967  reco = False, ig
-0006cc50: 6e6f 7265 5f73 203d 2046 616c 7365 293a  nore_s = False):
-0006cc60: 0a20 2020 200a 2020 2020 6361 6e64 5f63  .    .    cand_c
-0006cc70: 6e74 203d 206c 656e 2868 6472 5f6c 7374  nt = len(hdr_lst
-0006cc80: 290a 2020 2020 6966 206d 785f 636e 7420  ).    if mx_cnt 
-0006cc90: 3d3d 2030 3a20 6d78 5f63 6e74 203d 2063  == 0: mx_cnt = c
-0006cca0: 616e 645f 636e 740a 2020 2020 6c69 6e65  and_cnt.    line
-0006ccb0: 7320 3d20 5b5d 0a0a 2020 2020 6966 206c  s = []..    if l
-0006ccc0: 656e 2868 6472 5f6c 7374 2920 3e20 303a  en(hdr_lst) > 0:
-0006ccd0: 0a0a 2020 2020 2020 2020 6e61 6d65 2c20  ..        name, 
-0006cce0: 4c65 6e2c 2061 626e 2c20 6973 7472 616e  Len, abn, istran
-0006ccf0: 642c 2069 6364 6e67 203d 2067 6574 5f61  d, icdng = get_a
-0006cd00: 7474 7273 5f66 726f 6d5f 6661 5f68 6561  ttrs_from_fa_hea
-0006cd10: 6465 7228 2068 6472 5f6c 7374 5b30 5d20  der( hdr_lst[0] 
-0006cd20: 290a 2020 2020 2020 2020 6966 2028 4c65  ).        if (Le
-0006cd30: 6e20 3e3d 2030 2920 2620 2861 626e 203e  n >= 0) & (abn >
-0006cd40: 3d20 3029 2026 2028 6973 7472 616e 6420  = 0) & (istrand 
-0006cd50: 6973 206e 6f74 204e 6f6e 6529 2026 2028  is not None) & (
-0006cd60: 6963 646e 6720 6973 206e 6f74 204e 6f6e  icdng is not Non
-0006cd70: 6529 3a0a 2020 2020 2020 2020 0a20 2020  e):.        .   
-0006cd80: 2020 2020 2020 2020 2069 6620 7665 7262           if verb
-0006cd90: 6f73 653a 2070 7269 6e74 2827 436f 6e76  ose: print('Conv
-0006cda0: 6572 7469 6e67 202e 2e20 272c 2065 6e64  erting .. ', end
-0006cdb0: 203d 2027 272c 2066 6c75 7368 203d 2054   = '', flush = T
-0006cdc0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0006cdd0: 2070 5f63 616e 645f 636e 7420 3d20 300a   p_cand_cnt = 0.
-0006cde0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0006cdf0: 6b2c 2074 7365 7120 696e 2065 6e75 6d65  k, tseq in enume
-0006ce00: 7261 7465 2874 7365 715f 6c73 7429 3a0a  rate(tseq_lst):.
-0006ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ce20: 6e61 6d65 2c20 4c65 6e2c 2061 626e 2c20  name, Len, abn, 
-0006ce30: 6973 7472 616e 642c 2069 6364 6e67 203d  istrand, icdng =
-0006ce40: 2067 6574 5f61 7474 7273 5f66 726f 6d5f   get_attrs_from_
-0006ce50: 6661 5f68 6561 6465 7228 2068 6472 5f6c  fa_header( hdr_l
-0006ce60: 7374 5b6b 5d20 290a 0a20 2020 2020 2020  st[k] )..       
-0006ce70: 2020 2020 2020 2020 2069 6620 6963 646e           if icdn
-0006ce80: 6720 6973 204e 6f6e 653a 2069 6364 6e67  g is None: icdng
-0006ce90: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
-0006cea0: 2020 2020 2020 6966 2028 6973 7472 616e        if (istran
-0006ceb0: 6420 6973 204e 6f6e 6529 3a20 6973 7472  d is None): istr
-0006cec0: 616e 6420 3d20 300a 0a20 2020 2020 2020  and = 0..       
-0006ced0: 2020 2020 2020 2020 2069 6620 2828 6973           if ((is
-0006cee0: 7472 616e 6420 3e3d 2030 2920 2620 2869  trand >= 0) & (i
-0006cef0: 6364 6e67 2021 3d20 3029 2920 7c20 2869  cdng != 0)) | (i
-0006cf00: 676e 6f72 655f 7329 3a0a 2020 2020 2020  gnore_s):.      
-0006cf10: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0006cf20: 7261 6e64 203d 2031 0a20 2020 2020 2020  rand = 1.       
-0006cf30: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-0006cf40: 7274 2c20 7374 6f70 2c20 7373 5f6c 7374  rt, stop, ss_lst
-0006cf50: 203d 2063 6865 636b 5f6f 7266 5f63 6f6e   = check_orf_con
-0006cf60: 6469 7469 6f6e 2874 7365 712c 2073 7472  dition(tseq, str
-0006cf70: 616e 6420 3d20 7374 7261 6e64 290a 2020  and = strand).  
-0006cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006cf90: 2020 6966 2028 7374 6172 7420 3e3d 2030    if (start >= 0
-0006cfa0: 2920 2620 2873 746f 7020 3e3d 2030 293a  ) & (stop >= 0):
-0006cfb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006cfc0: 2020 2020 2020 2020 2061 7365 7120 3d20           aseq = 
-0006cfd0: 7472 616e 736c 6174 6528 7473 6571 5b73  translate(tseq[s
-0006cfe0: 7461 7274 3a73 746f 705d 290a 2020 2020  tart:stop]).    
-0006cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d000: 2020 2020 6966 206c 656e 2861 7365 7129      if len(aseq)
-0006d010: 203e 3d20 6c65 6e5f 7468 3a0a 2020 2020   >= len_th:.    
-0006d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d030: 2020 2020 2020 2020 6864 7220 3d20 7365          hdr = se
-0006d040: 745f 6661 5f68 6561 6465 7228 6e61 6d65  t_fa_header(name
-0006d050: 2c20 6c65 6e28 6173 6571 292c 2061 626e  , len(aseq), abn
-0006d060: 2c20 6973 7472 616e 642c 2069 6364 6e67  , istrand, icdng
-0006d070: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0006d080: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0006d090: 6e65 732e 6170 7065 6e64 2820 273e 2720  nes.append( '>' 
-0006d0a0: 2b20 6864 7220 2b20 275c 6e27 2029 0a20  + hdr + '\n' ). 
-0006d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d0c0: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-0006d0d0: 2e61 7070 656e 6428 6173 6571 2b27 5c6e  .append(aseq+'\n
-0006d0e0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0006d0f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0006d100: 5f63 616e 645f 636e 7420 2b3d 2031 0a0a  _cand_cnt += 1..
-0006d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d120: 6966 2028 2869 7374 7261 6e64 203c 3d20  if ((istrand <= 
-0006d130: 3029 2026 2028 6963 646e 6720 213d 2030  0) & (icdng != 0
-0006d140: 2929 207c 2028 6967 6e6f 7265 5f73 293a  )) | (ignore_s):
-0006d150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006d160: 2020 2020 2073 7472 616e 6420 3d20 2d31       strand = -1
-0006d170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006d180: 2020 2020 2073 7461 7274 2c20 7374 6f70       start, stop
-0006d190: 2c20 7373 5f6c 7374 203d 2063 6865 636b  , ss_lst = check
-0006d1a0: 5f6f 7266 5f63 6f6e 6469 7469 6f6e 2874  _orf_condition(t
-0006d1b0: 7365 712c 2073 7472 616e 6420 3d20 7374  seq, strand = st
-0006d1c0: 7261 6e64 290a 2020 2020 2020 2020 2020  rand).          
-0006d1d0: 2020 2020 2020 2020 2020 6966 2028 7374            if (st
-0006d1e0: 6172 7420 3e3d 2030 2920 2620 2873 746f  art >= 0) & (sto
-0006d1f0: 7020 3e3d 2030 293a 0a20 2020 2020 2020  p >= 0):.       
-0006d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d210: 2070 7365 7120 3d20 7265 7665 7273 655f   pseq = reverse_
-0006d220: 636f 6d70 6c65 6d65 6e74 2874 7365 7129  complement(tseq)
-0006d230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006d240: 2020 2020 2020 2020 2061 7365 7120 3d20           aseq = 
-0006d250: 7472 616e 736c 6174 6528 7073 6571 5b73  translate(pseq[s
-0006d260: 7461 7274 3a73 746f 705d 290a 2020 2020  tart:stop]).    
-0006d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d280: 2020 2020 6966 206c 656e 2861 7365 7129      if len(aseq)
-0006d290: 203e 3d20 6c65 6e5f 7468 3a0a 2020 2020   >= len_th:.    
-0006d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d2b0: 2020 2020 2020 2020 6864 7220 3d20 7365          hdr = se
-0006d2c0: 745f 6661 5f68 6561 6465 7228 6e61 6d65  t_fa_header(name
-0006d2d0: 2c20 6c65 6e28 6173 6571 292c 2061 626e  , len(aseq), abn
-0006d2e0: 2c20 6973 7472 616e 642c 2069 6364 6e67  , istrand, icdng
-0006d2f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0006d300: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0006d310: 6e65 732e 6170 7065 6e64 2820 273e 2720  nes.append( '>' 
-0006d320: 2b20 6864 7220 2b20 275c 6e27 2029 0a20  + hdr + '\n' ). 
-0006d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d340: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-0006d350: 2e61 7070 656e 6428 6173 6571 2b27 5c6e  .append(aseq+'\n
-0006d360: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0006d370: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0006d380: 5f63 616e 645f 636e 7420 2b3d 2031 0a0a  _cand_cnt += 1..
-0006d390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d3a0: 6966 2076 6572 626f 7365 3a20 0a20 2020  if verbose: .   
-0006d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d3c0: 2069 6620 6b25 3530 3020 3d3d 2030 3a20   if k%500 == 0: 
-0006d3d0: 7072 696e 7428 275c 7243 6f6e 7665 7274  print('\rConvert
-0006d3e0: 696e 6720 2e2e 2025 692f 2569 2020 2027  ing .. %i/%i   '
-0006d3f0: 2025 2028 6b2c 6361 6e64 5f63 6e74 292c   % (k,cand_cnt),
-0006d400: 2065 6e64 203d 2027 272c 2066 6c75 7368   end = '', flush
-0006d410: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-0006d420: 2020 2020 2020 2020 2069 6620 6b20 3e20           if k > 
-0006d430: 6d78 5f63 6e74 3a20 6272 6561 6b0a 2020  mx_cnt: break.  
-0006d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d450: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-0006d460: 6620 7665 7262 6f73 653a 200a 2020 2020  f verbose: .    
-0006d470: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0006d480: 7428 275c 7243 6f6e 7665 7274 696e 6720  t('\rConverting 
-0006d490: 646f 6e65 2e20 2569 2041 4153 6571 2063  done. %i AASeq c
-0006d4a0: 616e 6469 6461 7465 7320 666f 756e 6420  andidates found 
-0006d4b0: 6672 6f6d 2025 6920 7472 732e 2027 2025  from %i trs. ' %
-0006d4c0: 2028 705f 6361 6e64 5f63 6e74 2c63 616e   (p_cand_cnt,can
-0006d4d0: 645f 636e 7429 290a 2020 2020 2020 2020  d_cnt)).        
-0006d4e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0006d4f0: 2020 7374 7261 6e64 7320 3d20 6e70 2e7a    strands = np.z
-0006d500: 6572 6f73 2863 616e 645f 636e 7429 0a20  eros(cand_cnt). 
-0006d510: 2020 2020 2020 2020 2020 2069 6364 6e67             icdng
-0006d520: 7320 3d20 6e70 2e66 756c 6c28 6361 6e64  s = np.full(cand
-0006d530: 5f63 6e74 2c20 2d31 2920 2323 2069 6e69  _cnt, -1) ## ini
-0006d540: 7469 616c 6c79 2073 6574 2075 6e73 7065  tially set unspe
-0006d550: 6369 6669 6564 0a20 2020 2020 2020 2020  cified.         
-0006d560: 2020 2069 6620 7472 6172 6563 6f3a 0a20     if trareco:. 
-0006d570: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0006d580: 6f72 206b 2069 6e20 7261 6e67 6528 6361  or k in range(ca
-0006d590: 6e64 5f63 6e74 293a 0a20 2020 2020 2020  nd_cnt):.       
-0006d5a0: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-0006d5b0: 6d73 203d 2068 6472 5f6c 7374 5b6b 5d2e  ms = hdr_lst[k].
-0006d5c0: 7370 6c69 7428 275f 2729 0a20 2020 2020  split('_').     
-0006d5d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006d5e0: 7472 616e 6473 5b6b 5d20 3d20 6765 745f  trands[k] = get_
-0006d5f0: 6973 7472 616e 645f 6672 6f6d 5f63 2869  istrand_from_c(i
-0006d600: 7465 6d73 5b32 5d29 0a20 2020 2020 2020  tems[2]).       
-0006d610: 2020 2020 2020 2020 2020 2020 2069 6364               icd
-0006d620: 6e67 735b 6b5d 203d 2067 6574 5f69 6364  ngs[k] = get_icd
-0006d630: 6e67 5f66 726f 6d5f 7374 7228 2069 7465  ng_from_str( ite
-0006d640: 6d73 5b33 5d20 290a 0a20 2020 2020 2020  ms[3] )..       
-0006d650: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0006d660: 2020 2020 2020 2020 2020 2068 6472 3020             hdr0 
-0006d670: 3d20 6864 725f 6c73 745b 305d 0a20 2020  = hdr_lst[0].   
-0006d680: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-0006d690: 6d73 203d 2068 6472 302e 7370 6c69 7428  ms = hdr0.split(
-0006d6a0: 2720 2729 0a20 2020 2020 2020 2020 2020  ' ').           
-0006d6b0: 2020 2020 2069 6620 6c65 6e28 6974 656d       if len(item
-0006d6c0: 7329 203e 2033 3a0a 2020 2020 2020 2020  s) > 3:.        
-0006d6d0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0006d6e0: 656e 2869 7465 6d73 5b33 5d29 203e 2037  en(items[3]) > 7
-0006d6f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0006d700: 2020 2020 2020 2020 2020 6966 2069 7465            if ite
-0006d710: 6d73 5b33 5d5b 3a37 5d20 3d3d 2027 7374  ms[3][:7] == 'st
-0006d720: 7261 6e64 3a27 3a0a 2020 2020 2020 2020  rand:':.        
-0006d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d740: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
-0006d750: 6765 2863 616e 645f 636e 7429 3a0a 2020  ge(cand_cnt):.  
-0006d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d770: 2020 2020 2020 2020 2020 2020 2020 6974                it
-0006d780: 656d 7320 3d20 6864 725f 6c73 745b 6b5d  ems = hdr_lst[k]
-0006d790: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
-0006d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d7b0: 2020 2020 2020 2020 2020 2020 7374 7261              stra
-0006d7c0: 6e64 735b 6b5d 203d 2067 6574 5f69 7374  nds[k] = get_ist
-0006d7d0: 7261 6e64 5f66 726f 6d5f 6328 2069 7465  rand_from_c( ite
-0006d7e0: 6d73 5b33 5d5b 373a 5d20 290a 2020 2020  ms[3][7:] ).    
-0006d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d800: 2020 2020 2020 2020 2020 2020 6963 646e              icdn
-0006d810: 6773 5b6b 5d20 3d20 6765 745f 6963 646e  gs[k] = get_icdn
-0006d820: 675f 6672 6f6d 5f73 7472 2820 6974 656d  g_from_str( item
-0006d830: 735b 345d 2029 0a20 2020 2020 2020 2020  s[4] ).         
-0006d840: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0006d850: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0006d860: 7428 2743 6f6e 7665 7274 696e 6720 2e2e  t('Converting ..
-0006d870: 2027 2c20 656e 6420 3d20 2727 290a 2020   ', end = '').  
-0006d880: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
-0006d890: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0006d8a0: 2070 5f63 616e 645f 636e 7420 3d20 300a   p_cand_cnt = 0.
-0006d8b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0006d8c0: 6b2c 2074 7365 7120 696e 2065 6e75 6d65  k, tseq in enume
-0006d8d0: 7261 7465 2874 7365 715f 6c73 7429 3a0a  rate(tseq_lst):.
-0006d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d8f0: 6966 2028 2873 7472 616e 6473 5b6b 5d20  if ((strands[k] 
-0006d900: 3e3d 2030 2920 2620 2869 6364 6e67 735b  >= 0) & (icdngs[
-0006d910: 6b5d 2021 3d20 3029 2920 7c20 2869 676e  k] != 0)) | (ign
-0006d920: 6f72 655f 7329 3a0a 2020 2020 2020 2020  ore_s):.        
-0006d930: 2020 2020 2020 2020 2020 2020 7374 7261              stra
-0006d940: 6e64 203d 2031 0a20 2020 2020 2020 2020  nd = 1.         
-0006d950: 2020 2020 2020 2020 2020 2073 7461 7274             start
-0006d960: 2c20 7374 6f70 2c20 7373 5f6c 7374 203d  , stop, ss_lst =
-0006d970: 2063 6865 636b 5f6f 7266 5f63 6f6e 6469   check_orf_condi
-0006d980: 7469 6f6e 2874 7365 712c 2073 7472 616e  tion(tseq, stran
-0006d990: 6420 3d20 7374 7261 6e64 290a 2020 2020  d = strand).    
+0006bd80: 2020 2020 2020 2320 6272 6561 6b0a 2020        # break.  
+0006bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bda0: 2020 2020 2020 2020 2020 2020 2020 2327                #'
+0006bdb0: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+0006bdc0: 2020 2069 6620 2873 7461 7274 203c 2030     if (start < 0
+0006bdd0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0006bde0: 2020 2020 2020 2073 746f 7020 3d20 706f         stop = po
+0006bdf0: 735f 6c73 745b 7768 5b30 5d5d 0a20 2020  s_lst[wh[0]].   
+0006be00: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0006be10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0006be20: 6620 6c65 6e28 706f 735f 6c73 745f 7374  f len(pos_lst_st
+0006be30: 6172 7429 203e 2030 3a20 0a20 2020 2020  art) > 0: .     
+0006be40: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0006be50: 6820 3d20 7768 6963 6828 706f 735f 6c73  h = which(pos_ls
+0006be60: 745f 7374 6172 7425 3320 3d3d 206f 7329  t_start%3 == os)
+0006be70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006be80: 2020 2020 2069 6620 6c65 6e28 7768 2920       if len(wh) 
+0006be90: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0006bea0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0006beb0: 7274 203d 2070 6f73 5f6c 7374 5f73 7461  rt = pos_lst_sta
+0006bec0: 7274 5b77 685b 305d 5d0a 2020 2020 2020  rt[wh[0]].      
+0006bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bee0: 2020 0a20 2020 2020 2020 2020 2020 2073    .            s
+0006bef0: 735f 6c73 745b 6f73 5d20 3d20 2873 7461  s_lst[os] = (sta
+0006bf00: 7274 2c20 7374 6f70 290a 2020 2020 2020  rt, stop).      
+0006bf10: 2020 2020 2020 0a20 2020 2065 6c69 6620        .    elif 
+0006bf20: 6c65 6e28 706f 735f 6c73 7429 203d 3d20  len(pos_lst) == 
+0006bf30: 303a 0a20 2020 2020 2020 2069 6620 6c65  0:.        if le
+0006bf40: 6e28 706f 735f 6c73 745f 7374 6172 7429  n(pos_lst_start)
+0006bf50: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0006bf60: 2020 666f 7220 6f73 2069 6e20 7261 6e67    for os in rang
+0006bf70: 6528 3329 3a0a 2020 2020 2020 2020 2020  e(3):.          
+0006bf80: 2020 2020 2020 7374 6172 7420 3d20 2d31        start = -1
+0006bf90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006bfa0: 2077 6820 3d20 7768 6963 6828 706f 735f   wh = which(pos_
+0006bfb0: 6c73 745f 7374 6172 7425 3320 3d3d 206f  lst_start%3 == o
+0006bfc0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0006bfd0: 2020 2069 6620 6c65 6e28 7768 2920 3e20     if len(wh) > 
+0006bfe0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0006bff0: 2020 2020 2020 2073 7461 7274 203d 2070         start = p
+0006c000: 6f73 5f6c 7374 5f73 7461 7274 5b77 685b  os_lst_start[wh[
+0006c010: 305d 5d0a 2020 2020 2020 2020 2020 2020  0]].            
+0006c020: 2020 2020 7373 5f6c 7374 5b6f 735d 203d      ss_lst[os] =
+0006c030: 2028 7374 6172 742c 2073 746f 7029 0a20   (start, stop). 
+0006c040: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0006c050: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0006c060: 7374 6172 742c 2073 746f 702c 2073 735f  start, stop, ss_
+0006c070: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
+0006c080: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0006c090: 2020 7374 6172 7420 3d20 2d31 0a20 2020    start = -1.   
+0006c0a0: 2073 746f 7020 3d20 2d31 0a20 2020 2066   stop = -1.    f
+0006c0b0: 6f72 206f 7320 696e 2072 616e 6765 2833  or os in range(3
+0006c0c0: 293a 0a20 2020 2020 2020 2028 706f 735f  ):.        (pos_
+0006c0d0: 7374 6172 742c 2070 6f73 5f73 746f 7029  start, pos_stop)
+0006c0e0: 203d 2073 735f 6c73 745b 6f73 5d0a 2020   = ss_lst[os].  
+0006c0f0: 2020 2020 2020 6966 2028 706f 735f 7374        if (pos_st
+0006c100: 6172 7420 3e3d 2030 2920 2620 2870 6f73  art >= 0) & (pos
+0006c110: 5f73 746f 7020 3e3d 2030 293a 0a20 2020  _stop >= 0):.   
+0006c120: 2020 2020 2020 2020 2069 6620 2873 7461           if (sta
+0006c130: 7274 203e 3d20 3029 2026 2028 7374 6f70  rt >= 0) & (stop
+0006c140: 203e 3d20 3029 3a0a 2020 2020 2020 2020   >= 0):.        
+0006c150: 2020 2020 2020 2020 6c65 6e5f 7072 6576          len_prev
+0006c160: 203d 2073 746f 7020 2d20 7374 6172 740a   = stop - start.
+0006c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c180: 6c65 6e5f 6375 7272 203d 2070 6f73 5f73  len_curr = pos_s
+0006c190: 746f 7020 2d20 706f 735f 7374 6172 740a  top - pos_start.
+0006c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c1b0: 6966 206c 656e 5f63 7572 7220 3e20 6c65  if len_curr > le
+0006c1c0: 6e5f 7072 6576 3a0a 2020 2020 2020 2020  n_prev:.        
+0006c1d0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0006c1e0: 7420 3d20 706f 735f 7374 6172 740a 2020  t = pos_start.  
+0006c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c200: 2020 7374 6f70 203d 2070 6f73 5f73 746f    stop = pos_sto
+0006c210: 700a 2020 2020 2020 2020 2020 2020 656c  p.            el
+0006c220: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0006c230: 2020 2020 7374 6172 7420 3d20 706f 735f      start = pos_
+0006c240: 7374 6172 740a 2020 2020 2020 2020 2020  start.          
+0006c250: 2020 2020 2020 7374 6f70 203d 2070 6f73        stop = pos
+0006c260: 5f73 746f 700a 0a20 2020 2069 6620 2873  _stop..    if (s
+0006c270: 7461 7274 203c 2030 2920 2620 2873 746f  tart < 0) & (sto
+0006c280: 7020 3c20 3029 3a0a 2020 2020 2020 2020  p < 0):.        
+0006c290: 666f 7220 6f73 2069 6e20 7261 6e67 6528  for os in range(
+0006c2a0: 3329 3a0a 2020 2020 2020 2020 2020 2020  3):.            
+0006c2b0: 2870 6f73 5f73 7461 7274 2c20 706f 735f  (pos_start, pos_
+0006c2c0: 7374 6f70 2920 3d20 7373 5f6c 7374 5b6f  stop) = ss_lst[o
+0006c2d0: 735d 0a20 2020 2020 2020 2020 2020 2069  s].            i
+0006c2e0: 6620 2870 6f73 5f73 7461 7274 203e 3d20  f (pos_start >= 
+0006c2f0: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+0006c300: 2020 2020 706f 735f 7374 6f70 203d 206c      pos_stop = l
+0006c310: 656e 2874 7365 7129 202d 2028 6c65 6e28  en(tseq) - (len(
+0006c320: 7473 6571 2920 2d20 706f 735f 7374 6172  tseq) - pos_star
+0006c330: 7429 2533 0a20 2020 2020 2020 2020 2020  t)%3.           
+0006c340: 2065 6c69 6620 2870 6f73 5f73 746f 7020   elif (pos_stop 
+0006c350: 3e3d 2030 293a 0a20 2020 2020 2020 2020  >= 0):.         
+0006c360: 2020 2020 2020 2070 6f73 5f73 7461 7274         pos_start
+0006c370: 203d 206f 730a 0a20 2020 2020 2020 2020   = os..         
+0006c380: 2020 2069 6620 2873 7461 7274 203e 3d20     if (start >= 
+0006c390: 3029 2026 2028 7374 6f70 203e 3d20 3029  0) & (stop >= 0)
+0006c3a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0006c3b0: 2020 6c65 6e5f 7072 6576 203d 2073 746f    len_prev = sto
+0006c3c0: 7020 2d20 7374 6172 740a 2020 2020 2020  p - start.      
+0006c3d0: 2020 2020 2020 2020 2020 6c65 6e5f 6375            len_cu
+0006c3e0: 7272 203d 2070 6f73 5f73 746f 7020 2d20  rr = pos_stop - 
+0006c3f0: 706f 735f 7374 6172 740a 2020 2020 2020  pos_start.      
+0006c400: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0006c410: 5f63 7572 7220 3e20 6c65 6e5f 7072 6576  _curr > len_prev
+0006c420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0006c430: 2020 2020 2020 7374 6172 7420 3d20 706f        start = po
+0006c440: 735f 7374 6172 740a 2020 2020 2020 2020  s_start.        
+0006c450: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+0006c460: 203d 2070 6f73 5f73 746f 700a 2020 2020   = pos_stop.    
+0006c470: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0006c480: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0006c490: 6172 7420 3d20 706f 735f 7374 6172 740a  art = pos_start.
+0006c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c4b0: 7374 6f70 203d 2070 6f73 5f73 746f 700a  stop = pos_stop.
+0006c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c4e0: 2020 200a 2020 2020 7265 7475 726e 2073     .    return s
+0006c4f0: 7461 7274 2c20 7374 6f70 2c20 7373 5f6c  tart, stop, ss_l
+0006c500: 7374 0a20 2020 2020 2020 2020 2020 200a  st.            .
+0006c510: 0a64 6566 2063 6865 636b 5f6f 7266 5f63  .def check_orf_c
+0006c520: 6f6e 6469 7469 6f6e 2874 7365 712c 2073  ondition(tseq, s
+0006c530: 7472 616e 6420 3d20 3129 3a0a 2020 2020  trand = 1):.    
+0006c540: 0a20 2020 2069 6620 7374 7261 6e64 203e  .    if strand >
+0006c550: 2030 3a0a 2020 2020 2020 2020 7374 6172   0:.        star
+0006c560: 742c 2073 746f 702c 2073 735f 6c73 7420  t, stop, ss_lst 
+0006c570: 3d20 6368 6563 6b5f 6f72 665f 636f 6e64  = check_orf_cond
+0006c580: 6974 696f 6e5f 666f 7277 6172 6428 7473  ition_forward(ts
+0006c590: 6571 290a 2020 2020 2020 2020 7265 7475  eq).        retu
+0006c5a0: 726e 2073 7461 7274 2c20 7374 6f70 2c20  rn start, stop, 
+0006c5b0: 7373 5f6c 7374 0a20 2020 2065 6c69 6620  ss_lst.    elif 
+0006c5c0: 7374 7261 6e64 203c 2030 3a0a 2020 2020  strand < 0:.    
+0006c5d0: 2020 2020 7473 6571 5f63 203d 2072 6576      tseq_c = rev
+0006c5e0: 6572 7365 5f63 6f6d 706c 656d 656e 7428  erse_complement(
+0006c5f0: 7473 6571 290a 2020 2020 2020 2020 7374  tseq).        st
+0006c600: 6172 742c 2073 746f 702c 2073 735f 6c73  art, stop, ss_ls
+0006c610: 7420 3d20 6368 6563 6b5f 6f72 665f 636f  t = check_orf_co
+0006c620: 6e64 6974 696f 6e5f 666f 7277 6172 6428  ndition_forward(
+0006c630: 7473 6571 5f63 290a 2020 2020 2020 2020  tseq_c).        
+0006c640: 7265 7475 726e 2073 7461 7274 2c20 7374  return start, st
+0006c650: 6f70 2c20 7373 5f6c 7374 0a20 2020 2065  op, ss_lst.    e
+0006c660: 6c73 653a 0a20 2020 2020 2020 2073 7461  lse:.        sta
+0006c670: 7274 203d 202d 310a 2020 2020 2020 2020  rt = -1.        
+0006c680: 7374 6f70 203d 202d 310a 2020 2020 2020  stop = -1.      
+0006c690: 2020 7373 5f6c 7374 203d 205b 5d0a 2020    ss_lst = [].  
+0006c6a0: 2020 2020 2020 7265 7475 726e 2073 7461        return sta
+0006c6b0: 7274 2c20 7374 6f70 2c20 7373 5f6c 7374  rt, stop, ss_lst
+0006c6c0: 2020 2020 0a0a 0a64 6566 2067 6574 5f61      ...def get_a
+0006c6d0: 7474 7273 5f66 726f 6d5f 6661 5f68 6561  ttrs_from_fa_hea
+0006c6e0: 6465 7228 7374 725f 6174 7472 293a 0a20  der(str_attr):. 
+0006c6f0: 2020 200a 2020 2020 6e61 6d65 203d 204e     .    name = N
+0006c700: 6f6e 650a 2020 2020 4c65 6e20 3d20 2d31  one.    Len = -1
+0006c710: 0a20 2020 2061 626e 203d 202d 310a 2020  .    abn = -1.  
+0006c720: 2020 6973 7472 616e 6420 3d20 4e6f 6e65    istrand = None
+0006c730: 0a20 2020 2063 646e 6720 3d20 4e6f 6e65  .    cdng = None
+0006c740: 0a20 2020 200a 2020 2020 6974 656d 7320  .    .    items 
+0006c750: 3d20 7374 725f 6174 7472 2e73 706c 6974  = str_attr.split
+0006c760: 2827 2027 290a 2020 2020 6966 206c 656e  (' ').    if len
+0006c770: 2869 7465 6d73 2920 3e20 303a 206e 616d  (items) > 0: nam
+0006c780: 6520 3d20 6974 656d 735b 305d 0a20 2020  e = items[0].   
+0006c790: 2069 6620 6c65 6e28 6974 656d 7329 203e   if len(items) >
+0006c7a0: 2031 3a0a 2020 2020 2020 2020 666f 7220   1:.        for 
+0006c7b0: 6974 656d 2069 6e20 6974 656d 735b 313a  item in items[1:
+0006c7c0: 2d31 5d3a 0a20 2020 2020 2020 2020 2020  -1]:.           
+0006c7d0: 2073 7562 5f69 7465 6d20 3d20 6974 656d   sub_item = item
+0006c7e0: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0006c7f0: 2020 2020 2020 2020 6966 2073 7562 5f69          if sub_i
+0006c800: 7465 6d5b 305d 203d 3d20 276c 656e 6774  tem[0] == 'lengt
+0006c810: 6827 3a0a 2020 2020 2020 2020 2020 2020  h':.            
+0006c820: 2020 2020 4c65 6e20 3d20 696e 7428 7375      Len = int(su
+0006c830: 625f 6974 656d 5b31 5d29 0a20 2020 2020  b_item[1]).     
+0006c840: 2020 2020 2020 2065 6c69 6620 7375 625f         elif sub_
+0006c850: 6974 656d 5b30 5d20 3d3d 2027 6162 6e27  item[0] == 'abn'
+0006c860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0006c870: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0006c880: 2020 2020 2020 2020 2020 2061 626e 203d             abn =
+0006c890: 206e 702e 666c 6f61 7433 3228 7375 625f   np.float32(sub_
+0006c8a0: 6974 656d 5b31 5d29 0a20 2020 2020 2020  item[1]).       
+0006c8b0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0006c8c0: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
+0006c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c8e0: 7072 696e 7428 2757 4152 4e49 4e47 3a20  print('WARNING: 
+0006c8f0: 2573 206e 6f74 2061 206e 756d 6265 7227  %s not a number'
+0006c900: 2025 2073 7562 5f69 7465 6d5b 315d 290a   % sub_item[1]).
+0006c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c920: 2020 2020 6162 6e20 3d20 300a 2020 2020      abn = 0.    
+0006c930: 2020 2020 2020 2020 656c 6966 2073 7562          elif sub
+0006c940: 5f69 7465 6d5b 305d 203d 3d20 2773 7472  _item[0] == 'str
+0006c950: 616e 6427 3a0a 2020 2020 2020 2020 2020  and':.          
+0006c960: 2020 2020 2020 6973 7472 616e 6420 3d20        istrand = 
+0006c970: 6765 745f 6973 7472 616e 645f 6672 6f6d  get_istrand_from
+0006c980: 5f63 2873 7562 5f69 7465 6d5b 315d 5b30  _c(sub_item[1][0
+0006c990: 5d29 2023 2067 6574 5f63 5f66 726f 6d5f  ]) # get_c_from_
+0006c9a0: 6973 7472 616e 640a 2020 2020 2020 2020  istrand.        
+0006c9b0: 2020 2020 656c 6966 206c 656e 2873 7562      elif len(sub
+0006c9c0: 5f69 7465 6d29 203d 3d20 313a 0a20 2020  _item) == 1:.   
+0006c9d0: 2020 2020 2020 2020 2020 2020 2063 646e               cdn
+0006c9e0: 6720 3d20 6765 745f 6963 646e 675f 6672  g = get_icdng_fr
+0006c9f0: 6f6d 5f73 7472 2873 7562 5f69 7465 6d5b  om_str(sub_item[
+0006ca00: 305d 290a 2020 2020 0a20 2020 2072 6574  0]).    .    ret
+0006ca10: 7572 6e20 6e61 6d65 2c20 4c65 6e2c 2061  urn name, Len, a
+0006ca20: 626e 2c20 6973 7472 616e 642c 2063 646e  bn, istrand, cdn
+0006ca30: 670a 0a27 2727 0a64 6566 2073 6574 5f66  g..'''.def set_f
+0006ca40: 615f 6865 6164 6572 286e 616d 652c 204c  a_header(name, L
+0006ca50: 656e 2c20 6162 6e2c 2073 7472 616e 642c  en, abn, strand,
+0006ca60: 2063 646e 6729 3a0a 2020 2020 0a20 2020   cdng):.    .   
+0006ca70: 2068 6472 203d 2027 2573 206c 656e 6774   hdr = '%s lengt
+0006ca80: 683a 2569 2061 626e 3a25 352e 3266 2073  h:%i abn:%5.2f s
+0006ca90: 7472 616e 643a 2573 2025 7327 2025 2028  trand:%s %s' % (
+0006caa0: 6e61 6d65 2c20 4c65 6e2c 2061 626e 2c20  name, Len, abn, 
+0006cab0: 6765 745f 635f 6672 6f6d 5f69 7374 7261  get_c_from_istra
+0006cac0: 6e64 2873 7472 616e 6429 2c20 6765 745f  nd(strand), get_
+0006cad0: 7374 725f 6672 6f6d 5f69 6364 6e67 2863  str_from_icdng(c
+0006cae0: 646e 6729 290a 2020 2020 7265 7475 726e  dng)).    return
+0006caf0: 2068 6472 0a27 2727 2020 2020 0a0a 6465   hdr.'''    ..de
+0006cb00: 6620 6765 6e5f 7072 6f74 656f 6d65 5f66  f gen_proteome_f
+0006cb10: 726f 6d5f 7472 6173 6372 6970 746f 6d65  rom_trascriptome
+0006cb20: 2868 6472 5f6c 7374 2c20 7473 6571 5f6c  (hdr_lst, tseq_l
+0006cb30: 7374 2c20 6c65 6e5f 7468 203d 204d 494e  st, len_th = MIN
+0006cb40: 5f50 525f 4c45 4e47 5448 2c20 7665 7262  _PR_LENGTH, verb
+0006cb50: 6f73 6520 3d20 5472 7565 2c20 6d78 5f63  ose = True, mx_c
+0006cb60: 6e74 203d 2030 2c20 7472 6172 6563 6f20  nt = 0, trareco 
+0006cb70: 3d20 4661 6c73 652c 2069 676e 6f72 655f  = False, ignore_
+0006cb80: 7320 3d20 4661 6c73 6529 3a0a 2020 2020  s = False):.    
+0006cb90: 0a20 2020 2063 616e 645f 636e 7420 3d20  .    cand_cnt = 
+0006cba0: 6c65 6e28 6864 725f 6c73 7429 0a20 2020  len(hdr_lst).   
+0006cbb0: 2069 6620 6d78 5f63 6e74 203d 3d20 303a   if mx_cnt == 0:
+0006cbc0: 206d 785f 636e 7420 3d20 6361 6e64 5f63   mx_cnt = cand_c
+0006cbd0: 6e74 0a20 2020 206c 696e 6573 203d 205b  nt.    lines = [
+0006cbe0: 5d0a 0a20 2020 2069 6620 6c65 6e28 6864  ]..    if len(hd
+0006cbf0: 725f 6c73 7429 203e 2030 3a0a 0a20 2020  r_lst) > 0:..   
+0006cc00: 2020 2020 206e 616d 652c 204c 656e 2c20       name, Len, 
+0006cc10: 6162 6e2c 2069 7374 7261 6e64 2c20 6963  abn, istrand, ic
+0006cc20: 646e 6720 3d20 6765 745f 6174 7472 735f  dng = get_attrs_
+0006cc30: 6672 6f6d 5f66 615f 6865 6164 6572 2820  from_fa_header( 
+0006cc40: 6864 725f 6c73 745b 305d 2029 0a20 2020  hdr_lst[0] ).   
+0006cc50: 2020 2020 2069 6620 284c 656e 203e 3d20       if (Len >= 
+0006cc60: 3029 2026 2028 6162 6e20 3e3d 2030 2920  0) & (abn >= 0) 
+0006cc70: 2620 2869 7374 7261 6e64 2069 7320 6e6f  & (istrand is no
+0006cc80: 7420 4e6f 6e65 2920 2620 2869 6364 6e67  t None) & (icdng
+0006cc90: 2069 7320 6e6f 7420 4e6f 6e65 293a 0a20   is not None):. 
+0006cca0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0006ccb0: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+0006ccc0: 7072 696e 7428 2743 6f6e 7665 7274 696e  print('Convertin
+0006ccd0: 6720 2e2e 2027 2c20 656e 6420 3d20 2727  g .. ', end = ''
+0006cce0: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+0006ccf0: 2020 2020 2020 2020 2020 2020 705f 6361              p_ca
+0006cd00: 6e64 5f63 6e74 203d 2030 0a20 2020 2020  nd_cnt = 0.     
+0006cd10: 2020 2020 2020 2066 6f72 206b 2c20 7473         for k, ts
+0006cd20: 6571 2069 6e20 656e 756d 6572 6174 6528  eq in enumerate(
+0006cd30: 7473 6571 5f6c 7374 293a 0a20 2020 2020  tseq_lst):.     
+0006cd40: 2020 2020 2020 2020 2020 206e 616d 652c             name,
+0006cd50: 204c 656e 2c20 6162 6e2c 2069 7374 7261   Len, abn, istra
+0006cd60: 6e64 2c20 6963 646e 6720 3d20 6765 745f  nd, icdng = get_
+0006cd70: 6174 7472 735f 6672 6f6d 5f66 615f 6865  attrs_from_fa_he
+0006cd80: 6164 6572 2820 6864 725f 6c73 745b 6b5d  ader( hdr_lst[k]
+0006cd90: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+0006cda0: 2020 2020 6966 2069 6364 6e67 2069 7320      if icdng is 
+0006cdb0: 4e6f 6e65 3a20 6963 646e 6720 3d20 2d31  None: icdng = -1
+0006cdc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006cdd0: 2069 6620 2869 7374 7261 6e64 2069 7320   if (istrand is 
+0006cde0: 4e6f 6e65 293a 2069 7374 7261 6e64 203d  None): istrand =
+0006cdf0: 2030 0a0a 2020 2020 2020 2020 2020 2020   0..            
+0006ce00: 2020 2020 6966 2028 2869 7374 7261 6e64      if ((istrand
+0006ce10: 203e 3d20 3029 2026 2028 6963 646e 6720   >= 0) & (icdng 
+0006ce20: 213d 2030 2929 207c 2028 6967 6e6f 7265  != 0)) | (ignore
+0006ce30: 5f73 293a 0a20 2020 2020 2020 2020 2020  _s):.           
+0006ce40: 2020 2020 2020 2020 2073 7472 616e 6420           strand 
+0006ce50: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0006ce60: 2020 2020 2020 2020 7374 6172 742c 2073          start, s
+0006ce70: 746f 702c 2073 735f 6c73 7420 3d20 6368  top, ss_lst = ch
+0006ce80: 6563 6b5f 6f72 665f 636f 6e64 6974 696f  eck_orf_conditio
+0006ce90: 6e28 7473 6571 2c20 7374 7261 6e64 203d  n(tseq, strand =
+0006cea0: 2073 7472 616e 6429 0a20 2020 2020 2020   strand).       
+0006ceb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0006cec0: 2873 7461 7274 203e 3d20 3029 2026 2028  (start >= 0) & (
+0006ced0: 7374 6f70 203e 3d20 3029 3a0a 2020 2020  stop >= 0):.    
+0006cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cef0: 2020 2020 6173 6571 203d 2074 7261 6e73      aseq = trans
+0006cf00: 6c61 7465 2874 7365 715b 7374 6172 743a  late(tseq[start:
+0006cf10: 7374 6f70 5d29 0a20 2020 2020 2020 2020  stop]).         
+0006cf20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0006cf30: 6620 6c65 6e28 6173 6571 2920 3e3d 206c  f len(aseq) >= l
+0006cf40: 656e 5f74 683a 0a20 2020 2020 2020 2020  en_th:.         
+0006cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cf60: 2020 2068 6472 203d 2073 6574 5f66 615f     hdr = set_fa_
+0006cf70: 6865 6164 6572 286e 616d 652c 206c 656e  header(name, len
+0006cf80: 2861 7365 7129 2c20 6162 6e2c 2069 7374  (aseq), abn, ist
+0006cf90: 7261 6e64 2c20 6963 646e 6729 0a20 2020  rand, icdng).   
+0006cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cfb0: 2020 2020 2020 2020 206c 696e 6573 2e61           lines.a
+0006cfc0: 7070 656e 6428 2027 3e27 202b 2068 6472  ppend( '>' + hdr
+0006cfd0: 202b 2027 5c6e 2720 290a 2020 2020 2020   + '\n' ).      
+0006cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cff0: 2020 2020 2020 6c69 6e65 732e 6170 7065        lines.appe
+0006d000: 6e64 2861 7365 712b 275c 6e27 290a 2020  nd(aseq+'\n').  
+0006d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d020: 2020 2020 2020 2020 2020 705f 6361 6e64            p_cand
+0006d030: 5f63 6e74 202b 3d20 310a 0a20 2020 2020  _cnt += 1..     
+0006d040: 2020 2020 2020 2020 2020 2069 6620 2828             if ((
+0006d050: 6973 7472 616e 6420 3c3d 2030 2920 2620  istrand <= 0) & 
+0006d060: 2869 6364 6e67 2021 3d20 3029 2920 7c20  (icdng != 0)) | 
+0006d070: 2869 676e 6f72 655f 7329 3a0a 2020 2020  (ignore_s):.    
+0006d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d090: 7374 7261 6e64 203d 202d 310a 2020 2020  strand = -1.    
+0006d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d0b0: 7374 6172 742c 2073 746f 702c 2073 735f  start, stop, ss_
+0006d0c0: 6c73 7420 3d20 6368 6563 6b5f 6f72 665f  lst = check_orf_
+0006d0d0: 636f 6e64 6974 696f 6e28 7473 6571 2c20  condition(tseq, 
+0006d0e0: 7374 7261 6e64 203d 2073 7472 616e 6429  strand = strand)
+0006d0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006d100: 2020 2020 2069 6620 2873 7461 7274 203e       if (start >
+0006d110: 3d20 3029 2026 2028 7374 6f70 203e 3d20  = 0) & (stop >= 
+0006d120: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+0006d130: 2020 2020 2020 2020 2020 2020 7073 6571              pseq
+0006d140: 203d 2072 6576 6572 7365 5f63 6f6d 706c   = reverse_compl
+0006d150: 656d 656e 7428 7473 6571 290a 2020 2020  ement(tseq).    
+0006d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d170: 2020 2020 6173 6571 203d 2074 7261 6e73      aseq = trans
+0006d180: 6c61 7465 2870 7365 715b 7374 6172 743a  late(pseq[start:
+0006d190: 7374 6f70 5d29 0a20 2020 2020 2020 2020  stop]).         
+0006d1a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0006d1b0: 6620 6c65 6e28 6173 6571 2920 3e3d 206c  f len(aseq) >= l
+0006d1c0: 656e 5f74 683a 0a20 2020 2020 2020 2020  en_th:.         
+0006d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d1e0: 2020 2068 6472 203d 2073 6574 5f66 615f     hdr = set_fa_
+0006d1f0: 6865 6164 6572 286e 616d 652c 206c 656e  header(name, len
+0006d200: 2861 7365 7129 2c20 6162 6e2c 2069 7374  (aseq), abn, ist
+0006d210: 7261 6e64 2c20 6963 646e 6729 0a20 2020  rand, icdng).   
+0006d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d230: 2020 2020 2020 2020 206c 696e 6573 2e61           lines.a
+0006d240: 7070 656e 6428 2027 3e27 202b 2068 6472  ppend( '>' + hdr
+0006d250: 202b 2027 5c6e 2720 290a 2020 2020 2020   + '\n' ).      
+0006d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d270: 2020 2020 2020 6c69 6e65 732e 6170 7065        lines.appe
+0006d280: 6e64 2861 7365 712b 275c 6e27 290a 2020  nd(aseq+'\n').  
+0006d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d2a0: 2020 2020 2020 2020 2020 705f 6361 6e64            p_cand
+0006d2b0: 5f63 6e74 202b 3d20 310a 0a20 2020 2020  _cnt += 1..     
+0006d2c0: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+0006d2d0: 7262 6f73 653a 200a 2020 2020 2020 2020  rbose: .        
+0006d2e0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+0006d2f0: 2535 3030 203d 3d20 303a 2070 7269 6e74  %500 == 0: print
+0006d300: 2827 5c72 436f 6e76 6572 7469 6e67 202e  ('\rConverting .
+0006d310: 2e20 2569 2f25 6920 2020 2720 2520 286b  . %i/%i   ' % (k
+0006d320: 2c63 616e 645f 636e 7429 2c20 656e 6420  ,cand_cnt), end 
+0006d330: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
+0006d340: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0006d350: 2020 2020 6966 206b 203e 206d 785f 636e      if k > mx_cn
+0006d360: 743a 2062 7265 616b 0a20 2020 2020 2020  t: break.       
+0006d370: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0006d380: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
+0006d390: 626f 7365 3a20 0a20 2020 2020 2020 2020  bose: .         
+0006d3a0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+0006d3b0: 436f 6e76 6572 7469 6e67 2064 6f6e 652e  Converting done.
+0006d3c0: 2025 6920 4141 5365 7120 6361 6e64 6964   %i AASeq candid
+0006d3d0: 6174 6573 2066 6f75 6e64 2066 726f 6d20  ates found from 
+0006d3e0: 2569 2074 7273 2e20 2720 2520 2870 5f63  %i trs. ' % (p_c
+0006d3f0: 616e 645f 636e 742c 6361 6e64 5f63 6e74  and_cnt,cand_cnt
+0006d400: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
+0006d410: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+0006d420: 616e 6473 203d 206e 702e 7a65 726f 7328  ands = np.zeros(
+0006d430: 6361 6e64 5f63 6e74 290a 2020 2020 2020  cand_cnt).      
+0006d440: 2020 2020 2020 6963 646e 6773 203d 206e        icdngs = n
+0006d450: 702e 6675 6c6c 2863 616e 645f 636e 742c  p.full(cand_cnt,
+0006d460: 202d 3129 2023 2320 696e 6974 6961 6c6c   -1) ## initiall
+0006d470: 7920 7365 7420 756e 7370 6563 6966 6965  y set unspecifie
+0006d480: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
+0006d490: 2074 7261 7265 636f 3a0a 2020 2020 2020   trareco:.      
+0006d4a0: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
+0006d4b0: 696e 2072 616e 6765 2863 616e 645f 636e  in range(cand_cn
+0006d4c0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0006d4d0: 2020 2020 2020 2020 6974 656d 7320 3d20          items = 
+0006d4e0: 6864 725f 6c73 745b 6b5d 2e73 706c 6974  hdr_lst[k].split
+0006d4f0: 2827 5f27 290a 2020 2020 2020 2020 2020  ('_').          
+0006d500: 2020 2020 2020 2020 2020 7374 7261 6e64            strand
+0006d510: 735b 6b5d 203d 2067 6574 5f69 7374 7261  s[k] = get_istra
+0006d520: 6e64 5f66 726f 6d5f 6328 6974 656d 735b  nd_from_c(items[
+0006d530: 325d 290a 2020 2020 2020 2020 2020 2020  2]).            
+0006d540: 2020 2020 2020 2020 6963 646e 6773 5b6b          icdngs[k
+0006d550: 5d20 3d20 6765 745f 6963 646e 675f 6672  ] = get_icdng_fr
+0006d560: 6f6d 5f73 7472 2820 6974 656d 735b 335d  om_str( items[3]
+0006d570: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+0006d580: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0006d590: 2020 2020 2020 6864 7230 203d 2068 6472        hdr0 = hdr
+0006d5a0: 5f6c 7374 5b30 5d0a 2020 2020 2020 2020  _lst[0].        
+0006d5b0: 2020 2020 2020 2020 6974 656d 7320 3d20          items = 
+0006d5c0: 6864 7230 2e73 706c 6974 2827 2027 290a  hdr0.split(' ').
+0006d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d5e0: 6966 206c 656e 2869 7465 6d73 2920 3e20  if len(items) > 
+0006d5f0: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
+0006d600: 2020 2020 2020 2069 6620 6c65 6e28 6974         if len(it
+0006d610: 656d 735b 335d 2920 3e20 373a 0a20 2020  ems[3]) > 7:.   
+0006d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d630: 2020 2020 2069 6620 6974 656d 735b 335d       if items[3]
+0006d640: 5b3a 375d 203d 3d20 2773 7472 616e 643a  [:7] == 'strand:
+0006d650: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0006d660: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0006d670: 6f72 206b 2069 6e20 7261 6e67 6528 6361  or k in range(ca
+0006d680: 6e64 5f63 6e74 293a 0a20 2020 2020 2020  nd_cnt):.       
+0006d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d6a0: 2020 2020 2020 2020 2069 7465 6d73 203d           items =
+0006d6b0: 2068 6472 5f6c 7374 5b6b 5d2e 7370 6c69   hdr_lst[k].spli
+0006d6c0: 7428 2720 2729 0a20 2020 2020 2020 2020  t(' ').         
+0006d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d6e0: 2020 2020 2020 2073 7472 616e 6473 5b6b         strands[k
+0006d6f0: 5d20 3d20 6765 745f 6973 7472 616e 645f  ] = get_istrand_
+0006d700: 6672 6f6d 5f63 2820 6974 656d 735b 335d  from_c( items[3]
+0006d710: 5b37 3a5d 2029 0a20 2020 2020 2020 2020  [7:] ).         
+0006d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d730: 2020 2020 2020 2069 6364 6e67 735b 6b5d         icdngs[k]
+0006d740: 203d 2067 6574 5f69 6364 6e67 5f66 726f   = get_icdng_fro
+0006d750: 6d5f 7374 7228 2069 7465 6d73 5b34 5d20  m_str( items[4] 
+0006d760: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+0006d770: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+0006d780: 7262 6f73 653a 2070 7269 6e74 2827 436f  rbose: print('Co
+0006d790: 6e76 6572 7469 6e67 202e 2e20 272c 2065  nverting .. ', e
+0006d7a0: 6e64 203d 2027 2729 0a20 2020 2020 2020  nd = '').       
+0006d7b0: 2020 2020 206c 696e 6573 203d 205b 5d0a       lines = [].
+0006d7c0: 2020 2020 2020 2020 2020 2020 705f 6361              p_ca
+0006d7d0: 6e64 5f63 6e74 203d 2030 0a20 2020 2020  nd_cnt = 0.     
+0006d7e0: 2020 2020 2020 2066 6f72 206b 2c20 7473         for k, ts
+0006d7f0: 6571 2069 6e20 656e 756d 6572 6174 6528  eq in enumerate(
+0006d800: 7473 6571 5f6c 7374 293a 0a20 2020 2020  tseq_lst):.     
+0006d810: 2020 2020 2020 2020 2020 2069 6620 2828             if ((
+0006d820: 7374 7261 6e64 735b 6b5d 203e 3d20 3029  strands[k] >= 0)
+0006d830: 2026 2028 6963 646e 6773 5b6b 5d20 213d   & (icdngs[k] !=
+0006d840: 2030 2929 207c 2028 6967 6e6f 7265 5f73   0)) | (ignore_s
+0006d850: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0006d860: 2020 2020 2020 2073 7472 616e 6420 3d20         strand = 
+0006d870: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0006d880: 2020 2020 2020 7374 6172 742c 2073 746f        start, sto
+0006d890: 702c 2073 735f 6c73 7420 3d20 6368 6563  p, ss_lst = chec
+0006d8a0: 6b5f 6f72 665f 636f 6e64 6974 696f 6e28  k_orf_condition(
+0006d8b0: 7473 6571 2c20 7374 7261 6e64 203d 2073  tseq, strand = s
+0006d8c0: 7472 616e 6429 0a20 2020 2020 2020 2020  trand).         
+0006d8d0: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+0006d8e0: 7461 7274 203e 3d20 3029 2026 2028 7374  tart >= 0) & (st
+0006d8f0: 6f70 203e 3d20 3029 3a0a 2020 2020 2020  op >= 0):.      
+0006d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d910: 2020 6173 6571 203d 2074 7261 6e73 6c61    aseq = transla
+0006d920: 7465 2874 7365 715b 7374 6172 743a 7374  te(tseq[start:st
+0006d930: 6f70 5d29 0a20 2020 2020 2020 2020 2020  op]).           
+0006d940: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0006d950: 6c65 6e28 6173 6571 2920 3e3d 206c 656e  len(aseq) >= len
+0006d960: 5f74 683a 0a20 2020 2020 2020 2020 2020  _th:.           
+0006d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d980: 2069 7465 6d73 203d 2068 6472 5f6c 7374   items = hdr_lst
+0006d990: 5b6b 5d2e 7370 6c69 7428 2720 2729 0a20  [k].split(' '). 
 0006d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d9b0: 6966 2028 7374 6172 7420 3e3d 2030 2920  if (start >= 0) 
-0006d9c0: 2620 2873 746f 7020 3e3d 2030 293a 0a20  & (stop >= 0):. 
+0006d9b0: 2020 2020 2020 2020 2020 2069 6620 7374             if st
+0006d9c0: 7261 6e64 2021 3d20 303a 0a20 2020 2020  rand != 0:.     
 0006d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d9e0: 2020 2020 2020 2061 7365 7120 3d20 7472         aseq = tr
-0006d9f0: 616e 736c 6174 6528 7473 6571 5b73 7461  anslate(tseq[sta
-0006da00: 7274 3a73 746f 705d 290a 2020 2020 2020  rt:stop]).      
-0006da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006da20: 2020 6966 206c 656e 2861 7365 7129 203e    if len(aseq) >
-0006da30: 3d20 6c65 6e5f 7468 3a0a 2020 2020 2020  = len_th:.      
+0006d9e0: 2020 2020 2020 2020 2020 206c 696e 6573             lines
+0006d9f0: 2e61 7070 656e 6428 273e 2720 2b20 6864  .append('>' + hd
+0006da00: 725f 6c73 745b 6b5d 2e73 706c 6974 2827  r_lst[k].split('
+0006da10: 2027 295b 305d 202b 2027 206c 656e 6774   ')[0] + ' lengt
+0006da20: 683a 2569 2073 7472 616e 643a 2573 2025  h:%i strand:%s %
+0006da30: 735c 6e27 2025 205c 0a20 2020 2020 2020  s\n' % \.       
 0006da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006da50: 2020 2020 2020 6974 656d 7320 3d20 6864        items = hd
-0006da60: 725f 6c73 745b 6b5d 2e73 706c 6974 2827  r_lst[k].split('
-0006da70: 2027 290a 2020 2020 2020 2020 2020 2020   ').            
-0006da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006da90: 6966 2073 7472 616e 6420 213d 2030 3a0a  if strand != 0:.
-0006daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dac0: 6c69 6e65 732e 6170 7065 6e64 2827 3e27  lines.append('>'
-0006dad0: 202b 2068 6472 5f6c 7374 5b6b 5d2e 7370   + hdr_lst[k].sp
-0006dae0: 6c69 7428 2720 2729 5b30 5d20 2b20 2720  lit(' ')[0] + ' 
-0006daf0: 6c65 6e67 7468 3a25 6920 7374 7261 6e64  length:%i strand
-0006db00: 3a25 7320 2573 5c6e 2720 2520 5c0a 2020  :%s %s\n' % \.  
-0006db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006db30: 2020 2020 2020 2020 2020 2028 6c65 6e28             (len(
-0006db40: 6173 6571 292c 2067 6574 5f63 5f66 726f  aseq), get_c_fro
-0006db50: 6d5f 6973 7472 616e 6428 7374 7261 6e64  m_istrand(strand
-0006db60: 292c 2067 6574 5f73 7472 5f66 726f 6d5f  ), get_str_from_
-0006db70: 6963 646e 6728 2069 6364 6e67 735b 6b5d  icdng( icdngs[k]
-0006db80: 2029 2920 2920 2320 2b27 5f2b 5c6e 2729   )) ) # +'_+\n')
-0006db90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006dba0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0006dbb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0006dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dbd0: 2020 206c 696e 6573 2e61 7070 656e 6428     lines.append(
-0006dbe0: 273e 2720 2b20 6864 725f 6c73 745b 6b5d  '>' + hdr_lst[k]
-0006dbf0: 202b 2027 2073 7472 616e 643a 2569 5c6e   + ' strand:%i\n
-0006dc00: 2720 2520 7374 7261 6e64 2029 0a0a 2020  ' % strand )..  
-0006dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dc20: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
-0006dc30: 6170 7065 6e64 2861 7365 712b 275c 6e27  append(aseq+'\n'
-0006dc40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0006dc50: 2020 2020 2020 2020 2020 2020 2020 705f                p_
-0006dc60: 6361 6e64 5f63 6e74 202b 3d20 310a 0a20  cand_cnt += 1.. 
-0006dc70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006dc80: 6620 2828 7374 7261 6e64 735b 6b5d 203c  f ((strands[k] <
-0006dc90: 3d20 3029 2026 2028 6963 646e 6773 5b6b  = 0) & (icdngs[k
-0006dca0: 5d20 213d 2030 2929 207c 2028 6967 6e6f  ] != 0)) | (igno
-0006dcb0: 7265 5f73 293a 0a20 2020 2020 2020 2020  re_s):.         
-0006dcc0: 2020 2020 2020 2020 2020 2073 7472 616e             stran
-0006dcd0: 6420 3d20 2d31 0a20 2020 2020 2020 2020  d = -1.         
-0006dce0: 2020 2020 2020 2020 2020 2073 7461 7274             start
-0006dcf0: 2c20 7374 6f70 2c20 7373 5f6c 7374 203d  , stop, ss_lst =
-0006dd00: 2063 6865 636b 5f6f 7266 5f63 6f6e 6469   check_orf_condi
-0006dd10: 7469 6f6e 2874 7365 712c 2073 7472 616e  tion(tseq, stran
-0006dd20: 6420 3d20 7374 7261 6e64 290a 2020 2020  d = strand).    
+0006da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006da60: 2020 2020 2020 286c 656e 2861 7365 7129        (len(aseq)
+0006da70: 2c20 6765 745f 635f 6672 6f6d 5f69 7374  , get_c_from_ist
+0006da80: 7261 6e64 2873 7472 616e 6429 2c20 6765  rand(strand), ge
+0006da90: 745f 7374 725f 6672 6f6d 5f69 6364 6e67  t_str_from_icdng
+0006daa0: 2820 6963 646e 6773 5b6b 5d20 2929 2029  ( icdngs[k] )) )
+0006dab0: 2023 202b 275f 2b5c 6e27 290a 2020 2020   # +'_+\n').    
+0006dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dad0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0006dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006daf0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0006db00: 6e65 732e 6170 7065 6e64 2827 3e27 202b  nes.append('>' +
+0006db10: 2068 6472 5f6c 7374 5b6b 5d20 2b20 2720   hdr_lst[k] + ' 
+0006db20: 7374 7261 6e64 3a25 695c 6e27 2025 2073  strand:%i\n' % s
+0006db30: 7472 616e 6420 290a 0a20 2020 2020 2020  trand )..       
+0006db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006db50: 2020 2020 206c 696e 6573 2e61 7070 656e       lines.appen
+0006db60: 6428 6173 6571 2b27 5c6e 2729 0a20 2020  d(aseq+'\n').   
+0006db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006db80: 2020 2020 2020 2020 2070 5f63 616e 645f           p_cand_
+0006db90: 636e 7420 2b3d 2031 0a0a 2020 2020 2020  cnt += 1..      
+0006dba0: 2020 2020 2020 2020 2020 6966 2028 2873            if ((s
+0006dbb0: 7472 616e 6473 5b6b 5d20 3c3d 2030 2920  trands[k] <= 0) 
+0006dbc0: 2620 2869 6364 6e67 735b 6b5d 2021 3d20  & (icdngs[k] != 
+0006dbd0: 3029 2920 7c20 2869 676e 6f72 655f 7329  0)) | (ignore_s)
+0006dbe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0006dbf0: 2020 2020 2020 7374 7261 6e64 203d 202d        strand = -
+0006dc00: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0006dc10: 2020 2020 2020 7374 6172 742c 2073 746f        start, sto
+0006dc20: 702c 2073 735f 6c73 7420 3d20 6368 6563  p, ss_lst = chec
+0006dc30: 6b5f 6f72 665f 636f 6e64 6974 696f 6e28  k_orf_condition(
+0006dc40: 7473 6571 2c20 7374 7261 6e64 203d 2073  tseq, strand = s
+0006dc50: 7472 616e 6429 0a20 2020 2020 2020 2020  trand).         
+0006dc60: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+0006dc70: 7461 7274 203e 3d20 3029 2026 2028 7374  tart >= 0) & (st
+0006dc80: 6f70 203e 3d20 3029 3a0a 2020 2020 2020  op >= 0):.      
+0006dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dca0: 2020 7073 6571 203d 2072 6576 6572 7365    pseq = reverse
+0006dcb0: 5f63 6f6d 706c 656d 656e 7428 7473 6571  _complement(tseq
+0006dcc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0006dcd0: 2020 2020 2020 2020 2020 6173 6571 203d            aseq =
+0006dce0: 2074 7261 6e73 6c61 7465 2870 7365 715b   translate(pseq[
+0006dcf0: 7374 6172 743a 7374 6f70 5d29 0a20 2020  start:stop]).   
+0006dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dd10: 2020 2020 2069 6620 6c65 6e28 6173 6571       if len(aseq
+0006dd20: 2920 3e3d 206c 656e 5f74 683a 0a20 2020  ) >= len_th:.   
 0006dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dd40: 6966 2028 7374 6172 7420 3e3d 2030 2920  if (start >= 0) 
-0006dd50: 2620 2873 746f 7020 3e3d 2030 293a 0a20  & (stop >= 0):. 
+0006dd40: 2020 2020 2020 2020 2069 6620 7374 7261           if stra
+0006dd50: 6e64 2021 3d20 303a 0a20 2020 2020 2020  nd != 0:.       
 0006dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dd70: 2020 2020 2020 2070 7365 7120 3d20 7265         pseq = re
-0006dd80: 7665 7273 655f 636f 6d70 6c65 6d65 6e74  verse_complement
-0006dd90: 2874 7365 7129 0a20 2020 2020 2020 2020  (tseq).         
-0006dda0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0006ddb0: 7365 7120 3d20 7472 616e 736c 6174 6528  seq = translate(
-0006ddc0: 7073 6571 5b73 7461 7274 3a73 746f 705d  pseq[start:stop]
-0006ddd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0006dde0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0006ddf0: 2861 7365 7129 203e 3d20 6c65 6e5f 7468  (aseq) >= len_th
-0006de00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0006de10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0006de20: 2073 7472 616e 6420 213d 2030 3a0a 2020   strand != 0:.  
-0006de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006de40: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0006de50: 6e65 732e 6170 7065 6e64 2827 3e27 202b  nes.append('>' +
-0006de60: 2068 6472 5f6c 7374 5b6b 5d2e 7370 6c69   hdr_lst[k].spli
-0006de70: 7428 2720 2729 5b30 5d20 2b20 2720 6c65  t(' ')[0] + ' le
-0006de80: 6e67 7468 3a25 6920 7374 7261 6e64 3a25  ngth:%i strand:%
-0006de90: 7320 2573 5c6e 2720 2520 5c0a 2020 2020  s %s\n' % \.    
-0006dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dec0: 2020 2020 2020 2020 2028 6c65 6e28 6173           (len(as
-0006ded0: 6571 292c 2067 6574 5f63 5f66 726f 6d5f  eq), get_c_from_
-0006dee0: 6973 7472 616e 6428 7374 7261 6e64 292c  istrand(strand),
-0006def0: 2067 6574 5f73 7472 5f66 726f 6d5f 6963   get_str_from_ic
-0006df00: 646e 6728 2069 6364 6e67 735b 6b5d 2029  dng( icdngs[k] )
-0006df10: 2920 2920 2320 2b27 5f2b 5c6e 2729 0a20  ) ) # +'_+\n'). 
-0006df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006df30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0006df40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006df60: 206c 696e 6573 2e61 7070 656e 6428 273e   lines.append('>
-0006df70: 2720 2b20 6864 725f 6c73 745b 6b5d 202b  ' + hdr_lst[k] +
-0006df80: 2027 2073 7472 616e 643a 2569 5c6e 2720   ' strand:%i\n' 
-0006df90: 2520 7374 7261 6e64 2029 0a0a 2020 2020  % strand )..    
+0006dd70: 2020 2020 2020 2020 206c 696e 6573 2e61           lines.a
+0006dd80: 7070 656e 6428 273e 2720 2b20 6864 725f  ppend('>' + hdr_
+0006dd90: 6c73 745b 6b5d 2e73 706c 6974 2827 2027  lst[k].split(' '
+0006dda0: 295b 305d 202b 2027 206c 656e 6774 683a  )[0] + ' length:
+0006ddb0: 2569 2073 7472 616e 643a 2573 2025 735c  %i strand:%s %s\
+0006ddc0: 6e27 2025 205c 0a20 2020 2020 2020 2020  n' % \.         
+0006ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ddf0: 2020 2020 286c 656e 2861 7365 7129 2c20      (len(aseq), 
+0006de00: 6765 745f 635f 6672 6f6d 5f69 7374 7261  get_c_from_istra
+0006de10: 6e64 2873 7472 616e 6429 2c20 6765 745f  nd(strand), get_
+0006de20: 7374 725f 6672 6f6d 5f69 6364 6e67 2820  str_from_icdng( 
+0006de30: 6963 646e 6773 5b6b 5d20 2929 2029 2023  icdngs[k] )) ) #
+0006de40: 202b 275f 2b5c 6e27 290a 2020 2020 2020   +'_+\n').      
+0006de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006de60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0006de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006de80: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0006de90: 732e 6170 7065 6e64 2827 3e27 202b 2068  s.append('>' + h
+0006dea0: 6472 5f6c 7374 5b6b 5d20 2b20 2720 7374  dr_lst[k] + ' st
+0006deb0: 7261 6e64 3a25 695c 6e27 2025 2073 7472  rand:%i\n' % str
+0006dec0: 616e 6420 290a 0a20 2020 2020 2020 2020  and )..         
+0006ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dee0: 2020 206c 696e 6573 2e61 7070 656e 6428     lines.append(
+0006def0: 6173 6571 2b27 5c6e 2729 0a20 2020 2020  aseq+'\n').     
+0006df00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006df10: 2020 2020 2020 2070 5f63 616e 645f 636e         p_cand_cn
+0006df20: 7420 2b3d 2031 0a0a 2020 2020 2020 2020  t += 1..        
+0006df30: 2020 2020 2020 2020 6966 2076 6572 626f          if verbo
+0006df40: 7365 3a20 0a20 2020 2020 2020 2020 2020  se: .           
+0006df50: 2020 2020 2020 2020 2069 6620 6b25 3130           if k%10
+0006df60: 3020 3d3d 2030 3a20 7072 696e 7428 275c  0 == 0: print('\
+0006df70: 7243 6f6e 7665 7274 696e 6720 2e2e 2025  rConverting .. %
+0006df80: 692f 2569 2720 2520 286b 2c63 616e 645f  i/%i' % (k,cand_
+0006df90: 636e 7429 2c20 656e 6420 3d20 2727 290a  cnt), end = '').
 0006dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dfb0: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
-0006dfc0: 7065 6e64 2861 7365 712b 275c 6e27 290a  pend(aseq+'\n').
-0006dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dfe0: 2020 2020 2020 2020 2020 2020 705f 6361              p_ca
-0006dff0: 6e64 5f63 6e74 202b 3d20 310a 0a20 2020  nd_cnt += 1..   
-0006e000: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0006e010: 7665 7262 6f73 653a 200a 2020 2020 2020  verbose: .      
-0006e020: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0006e030: 206b 2531 3030 203d 3d20 303a 2070 7269   k%100 == 0: pri
-0006e040: 6e74 2827 5c72 436f 6e76 6572 7469 6e67  nt('\rConverting
-0006e050: 202e 2e20 2569 2f25 6927 2025 2028 6b2c   .. %i/%i' % (k,
-0006e060: 6361 6e64 5f63 6e74 292c 2065 6e64 203d  cand_cnt), end =
-0006e070: 2027 2729 0a20 2020 2020 2020 2020 2020   '').           
-0006e080: 2020 2020 2069 6620 6b20 3e20 6d78 5f63       if k > mx_c
-0006e090: 6e74 3a20 6272 6561 6b0a 2020 2020 2020  nt: break.      
-0006e0a0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0006e0b0: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
-0006e0c0: 7262 6f73 653a 200a 2020 2020 2020 2020  rbose: .        
-0006e0d0: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-0006e0e0: 7243 6f6e 7665 7274 696e 6720 646f 6e65  rConverting done
-0006e0f0: 2e20 2569 2041 4153 6571 2063 616e 6469  . %i AASeq candi
-0006e100: 6461 7465 7320 666f 756e 6420 6672 6f6d  dates found from
-0006e110: 2025 6920 7472 732e 2027 2025 2028 705f   %i trs. ' % (p_
-0006e120: 6361 6e64 5f63 6e74 2c63 616e 645f 636e  cand_cnt,cand_cn
-0006e130: 7429 290a 2020 2020 2020 2020 200a 2020  t)).         .  
-0006e140: 2020 7265 7475 726e 206c 696e 6573 0a0a    return lines..
-0006e150: 2020 2020 0a64 6566 2047 656e 6572 6174      .def Generat
-0006e160: 655f 5072 6f74 656f 6d65 2874 725f 6661  e_Proteome(tr_fa
-0006e170: 2c20 6c65 6e5f 7468 203d 204d 494e 5f50  , len_th = MIN_P
-0006e180: 525f 4c45 4e47 5448 2c20 7665 7262 6f73  R_LENGTH, verbos
-0006e190: 6520 3d20 5472 7565 2c20 6d78 5f63 6e74  e = True, mx_cnt
-0006e1a0: 203d 2030 2c20 7472 6172 6563 6f20 3d20   = 0, trareco = 
-0006e1b0: 4661 6c73 652c 2066 6e61 6d65 5f6f 7574  False, fname_out
-0006e1c0: 203d 204e 6f6e 652c 2069 676e 6f72 655f   = None, ignore_
-0006e1d0: 7320 3d20 4661 6c73 6529 3a0a 2020 2020  s = False):.    
-0006e1e0: 0a20 2020 2066 696c 655f 6e61 6d65 203d  .    file_name =
-0006e1f0: 2074 725f 6661 2e73 706c 6974 2827 2f27   tr_fa.split('/'
-0006e200: 295b 2d31 5d0a 2020 2020 666e 7320 3d20  )[-1].    fns = 
-0006e210: 6669 6c65 5f6e 616d 652e 7370 6c69 7428  file_name.split(
-0006e220: 272e 2729 5b3a 2d31 5d0a 2020 2020 666e  '.')[:-1].    fn
-0006e230: 616d 6520 3d20 2727 0a20 2020 2066 6f72  ame = ''.    for
-0006e240: 206b 2c20 666e 2069 6e20 656e 756d 6572   k, fn in enumer
-0006e250: 6174 6528 666e 7329 3a0a 2020 2020 2020  ate(fns):.      
-0006e260: 2020 6966 206b 203e 2030 3a0a 2020 2020    if k > 0:.    
-0006e270: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
-0006e280: 666e 616d 6520 2b20 272e 270a 2020 2020  fname + '.'.    
-0006e290: 2020 2020 666e 616d 6520 3d20 666e 616d      fname = fnam
-0006e2a0: 6520 2b20 666e 0a20 2020 200a 2020 2020  e + fn.    .    
-0006e2b0: 6864 725f 6c73 742c 2074 7365 715f 6c73  hdr_lst, tseq_ls
-0006e2c0: 7420 3d20 6c6f 6164 5f66 6173 7461 3128  t = load_fasta1(
-0006e2d0: 7472 5f66 612c 2076 6572 626f 7365 203d  tr_fa, verbose =
-0006e2e0: 2046 616c 7365 290a 2020 2020 6361 6e64   False).    cand
-0006e2f0: 5f63 6e74 203d 206c 656e 2874 7365 715f  _cnt = len(tseq_
-0006e300: 6c73 7429 0a0a 2020 2020 6c69 6e65 7320  lst)..    lines 
-0006e310: 3d20 6765 6e5f 7072 6f74 656f 6d65 5f66  = gen_proteome_f
-0006e320: 726f 6d5f 7472 6173 6372 6970 746f 6d65  rom_trascriptome
-0006e330: 2868 6472 5f6c 7374 2c20 7473 6571 5f6c  (hdr_lst, tseq_l
-0006e340: 7374 2c20 6c65 6e5f 7468 203d 206c 656e  st, len_th = len
-0006e350: 5f74 682c 2076 6572 626f 7365 203d 2076  _th, verbose = v
-0006e360: 6572 626f 7365 2c20 7472 6172 6563 6f20  erbose, trareco 
-0006e370: 3d20 7472 6172 6563 6f2c 2069 676e 6f72  = trareco, ignor
-0006e380: 655f 7320 3d20 6967 6e6f 7265 5f73 290a  e_s = ignore_s).
-0006e390: 2020 2020 705f 6361 6e64 5f63 6e74 203d      p_cand_cnt =
-0006e3a0: 206c 656e 286c 696e 6573 292f 320a 2020   len(lines)/2.  
-0006e3b0: 2020 2020 2020 2020 2020 0a20 2020 2069            .    i
-0006e3c0: 6620 666e 616d 655f 6f75 7420 6973 204e  f fname_out is N
-0006e3d0: 6f6e 653a 2066 6e61 6d65 5f6f 7574 203d  one: fname_out =
-0006e3e0: 2066 6e61 6d65 202b 2027 5f70 726f 7465   fname + '_prote
-0006e3f0: 6f6d 652e 6661 270a 2020 2020 6620 3d20  ome.fa'.    f = 
-0006e400: 6f70 656e 2866 6e61 6d65 5f6f 7574 2c27  open(fname_out,'
-0006e410: 772b 2729 0a20 2020 2066 2e77 7269 7465  w+').    f.write
-0006e420: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
-0006e430: 2066 2e63 6c6f 7365 2829 0a20 2020 2020   f.close().     
-0006e440: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0006e450: 6966 2076 6572 626f 7365 3a20 0a20 2020  if verbose: .   
-0006e460: 2020 2020 2070 7269 6e74 2827 4141 5365       print('AASe
-0006e470: 7120 7361 7665 6420 746f 2025 7327 2025  q saved to %s' %
-0006e480: 2028 666e 616d 655f 6f75 7429 290a 2020   (fname_out)).  
-0006e490: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-0006e4a0: 6e20 666e 616d 655f 6f75 740a 0a20 2020  n fname_out..   
-0006e4b0: 200a 2323 2323 2323 2323 2323 2323 2323   .##############
-0006e4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006e4d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006e4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006e4f0: 2323 2323 2323 2323 2323 2323 0a23 2320  ############.## 
-0006e500: 4675 6e63 7469 6f6e 7320 666f 7220 5374  Functions for St
-0006e510: 7269 6e67 4669 7820 6d61 696e 2028 3129  ringFix main (1)
-0006e520: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-0006e530: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006e540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006e550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006e560: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-0006e570: 2067 6574 5f6d 6178 5f63 7667 2872 7329   get_max_cvg(rs)
-0006e580: 3a0a 2020 2020 6d61 785f 6376 6720 3d20  :.    max_cvg = 
-0006e590: 300a 2020 2020 666f 7220 7267 6e20 696e  0.    for rgn in
-0006e5a0: 2072 732e 7267 6e73 3a0a 2020 2020 2020   rs.rgns:.      
-0006e5b0: 2020 6d61 785f 6376 6720 3d20 6d61 7828    max_cvg = max(
-0006e5c0: 206d 6178 5f63 7667 2c20 7267 6e2e 6176   max_cvg, rgn.av
-0006e5d0: 655f 6376 675f 6465 7074 6828 2920 290a  e_cvg_depth() ).
-0006e5e0: 2020 2020 7265 7475 726e 286d 6178 5f63      return(max_c
-0006e5f0: 7667 290a 0a23 2054 7261 6e73 6372 6970  vg)..# Transcrip
-0006e600: 7420 3d20 636f 6c6c 6563 7469 6f6e 732e  t = collections.
-0006e610: 6e61 6d65 6474 7570 6c65 2827 5472 616e  namedtuple('Tran
-0006e620: 7363 7269 7074 272c 2027 7072 6566 6978  script', 'prefix
-0006e630: 2c20 6769 6478 2c20 6772 705f 7369 7a65  , gidx, grp_size
-0006e640: 2c20 6963 6e74 2c20 6368 722c 2073 7461  , icnt, chr, sta
-0006e650: 7274 2c20 656e 642c 2073 6571 2c20 6162  rt, end, seq, ab
-0006e660: 6e2c 2074 706d 2c20 6973 6f5f 6672 6163  n, tpm, iso_frac
-0006e670: 2c20 7072 6f62 2729 0a0a 6465 6620 7361  , prob')..def sa
-0006e680: 7665 5f74 7261 6e73 6372 6970 7473 2820  ve_transcripts( 
-0006e690: 666e 616d 652c 2074 725f 6c73 7420 293a  fname, tr_lst ):
-0006e6a0: 0a20 2020 200a 2020 2020 7472 5f6e 616d  .    .    tr_nam
-0006e6b0: 6573 203d 2067 6574 5f74 725f 6e61 6d65  es = get_tr_name
-0006e6c0: 2874 725f 6c73 7429 0a20 2020 2066 203d  (tr_lst).    f =
-0006e6d0: 206f 7065 6e28 666e 616d 652c 2777 2b27   open(fname,'w+'
-0006e6e0: 290a 2020 2020 666f 7220 6b2c 2074 7220  ).    for k, tr 
-0006e6f0: 696e 2065 6e75 6d65 7261 7465 2874 725f  in enumerate(tr_
-0006e700: 6c73 7429 3a0a 2020 2020 2020 2020 7320  lst):.        s 
-0006e710: 3d20 273e 2573 5c6e 2720 2520 7472 5f6e  = '>%s\n' % tr_n
-0006e720: 616d 6573 5b6b 5d0a 2020 2020 2020 2020  ames[k].        
-0006e730: 7365 7120 3d20 7472 2e73 6571 202b 2027  seq = tr.seq + '
-0006e740: 5c6e 270a 2020 2020 2020 2020 662e 7772  \n'.        f.wr
-0006e750: 6974 656c 696e 6573 2873 290a 2020 2020  itelines(s).    
-0006e760: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
-0006e770: 2873 6571 290a 2020 2020 662e 636c 6f73  (seq).    f.clos
-0006e780: 6528 290a 0a64 6566 2073 6176 655f 7472  e()..def save_tr
-0006e790: 616e 7363 7269 7074 7332 2820 666e 616d  anscripts2( fnam
-0006e7a0: 652c 2074 725f 6c73 7420 293a 0a20 2020  e, tr_lst ):.   
-0006e7b0: 200a 2020 2020 7472 5f6e 616d 6573 203d   .    tr_names =
-0006e7c0: 2067 6574 5f74 725f 6e61 6d65 2874 725f   get_tr_name(tr_
-0006e7d0: 6c73 7429 0a20 2020 2066 203d 206f 7065  lst).    f = ope
-0006e7e0: 6e28 666e 616d 652c 2777 2b27 290a 2020  n(fname,'w+').  
-0006e7f0: 2020 666f 7220 6b2c 2074 7220 696e 2065    for k, tr in e
-0006e800: 6e75 6d65 7261 7465 2874 725f 6c73 7429  numerate(tr_lst)
-0006e810: 3a0a 2020 2020 2020 2020 2320 7320 3d20  :.        # s = 
-0006e820: 273e 2573 5c6e 2720 2520 7472 5f6e 616d  '>%s\n' % tr_nam
-0006e830: 6573 5b6b 5d0a 2020 2020 2020 2020 7469  es[k].        ti
-0006e840: 6420 3d20 2753 4669 782e 2573 2e25 6927  d = 'SFix.%s.%i'
-0006e850: 2025 2028 7374 7228 7472 2e67 6964 7829   % (str(tr.gidx)
-0006e860: 2c20 7472 2e69 636e 742b 3129 0a20 2020  , tr.icnt+1).   
-0006e870: 2020 2020 2063 203d 2067 6574 5f63 5f66       c = get_c_f
-0006e880: 726f 6d5f 6973 7472 616e 6428 7472 2e73  rom_istrand(tr.s
-0006e890: 7472 616e 6429 0a20 2020 2020 2020 2063  trand).        c
-0006e8a0: 5f6f 725f 6e20 3d20 7472 2e63 646e 6720  _or_n = tr.cdng 
-0006e8b0: 2320 6765 745f 7374 725f 6672 6f6d 5f69  # get_str_from_i
-0006e8c0: 6364 6e67 2820 7472 2e63 646e 6720 290a  cdng( tr.cdng ).
-0006e8d0: 2020 2020 2020 2020 7320 3d20 273e 2573          s = '>%s
-0006e8e0: 206c 656e 6774 683a 2569 2061 626e 3a25   length:%i abn:%
-0006e8f0: 6620 7374 7261 6e64 3a25 7320 2573 5c6e  f strand:%s %s\n
-0006e900: 2720 2520 2874 6964 2c20 6c65 6e28 7472  ' % (tid, len(tr
-0006e910: 2e73 6571 292c 206e 702e 726f 756e 6428  .seq), np.round(
-0006e920: 7472 2e61 626e 2c20 3229 2c20 632c 2063  tr.abn, 2), c, c
-0006e930: 5f6f 725f 6e29 0a20 2020 2020 2020 2073  _or_n).        s
-0006e940: 6571 203d 2074 722e 7365 7120 2b20 275c  eq = tr.seq + '\
-0006e950: 6e27 0a20 2020 2020 2020 2066 2e77 7269  n'.        f.wri
-0006e960: 7465 6c69 6e65 7328 7329 0a20 2020 2020  telines(s).     
-0006e970: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
-0006e980: 7365 7129 0a20 2020 2066 2e63 6c6f 7365  seq).    f.close
-0006e990: 2829 0a0a 2020 2020 0a64 6566 2067 6574  ()..    .def get
-0006e9a0: 5f63 5f66 726f 6d5f 6973 7472 616e 6428  _c_from_istrand(
-0006e9b0: 6973 7472 616e 6429 3a0a 2020 2020 0a20  istrand):.    . 
-0006e9c0: 2020 2069 6620 6973 7472 616e 6420 3e20     if istrand > 
-0006e9d0: 303a 2073 7472 616e 6420 3d20 272b 270a  0: strand = '+'.
-0006e9e0: 2020 2020 656c 6966 2069 7374 7261 6e64      elif istrand
-0006e9f0: 203d 3d20 303a 2073 7472 616e 6420 3d20   == 0: strand = 
-0006ea00: 272e 270a 2020 2020 656c 7365 3a20 7374  '.'.    else: st
-0006ea10: 7261 6e64 203d 2027 2d27 0a20 2020 2072  rand = '-'.    r
-0006ea20: 6574 7572 6e20 7374 7261 6e64 0a20 2020  eturn strand.   
-0006ea30: 2020 2020 200a 2020 2020 0a64 6566 2067       .    .def g
-0006ea40: 6574 5f69 7374 7261 6e64 5f66 726f 6d5f  et_istrand_from_
-0006ea50: 6328 7374 7261 6e64 5f63 293a 0a20 2020  c(strand_c):.   
-0006ea60: 200a 2020 2020 6966 2073 7472 616e 645f   .    if strand_
-0006ea70: 6320 3d3d 2027 2b27 3a20 7374 7261 6e64  c == '+': strand
-0006ea80: 203d 2031 0a20 2020 2065 6c69 6620 7374   = 1.    elif st
-0006ea90: 7261 6e64 5f63 203d 3d20 272d 273a 2073  rand_c == '-': s
-0006eaa0: 7472 616e 6420 3d20 2d31 0a20 2020 2065  trand = -1.    e
-0006eab0: 6c73 653a 2073 7472 616e 6420 3d20 300a  lse: strand = 0.
-0006eac0: 2020 2020 7265 7475 726e 2073 7472 616e      return stran
-0006ead0: 640a 2020 2020 2020 2020 0a20 2020 200a  d.        .    .
-0006eae0: 6465 6620 6765 745f 7374 725f 6672 6f6d  def get_str_from
-0006eaf0: 5f69 6364 6e67 2820 6364 7320 293a 0a20  _icdng( cds ):. 
-0006eb00: 2020 200a 2020 2020 6966 2063 6473 203e     .    if cds >
-0006eb10: 2030 3a20 635f 6f72 5f6e 203d 2027 436f   0: c_or_n = 'Co
-0006eb20: 6469 6e67 270a 2020 2020 656c 6966 2063  ding'.    elif c
-0006eb30: 6473 203d 3d20 303a 2063 5f6f 725f 6e20  ds == 0: c_or_n 
-0006eb40: 3d20 274e 6f6e 2d63 6f64 696e 6727 0a20  = 'Non-coding'. 
-0006eb50: 2020 2065 6c73 653a 2063 5f6f 725f 6e20     else: c_or_n 
-0006eb60: 3d20 2775 6e73 7065 6369 6669 6564 270a  = 'unspecified'.
-0006eb70: 2020 2020 7265 7475 726e 2063 5f6f 725f      return c_or_
-0006eb80: 6e0a 0a0a 6465 6620 6765 745f 6963 646e  n...def get_icdn
-0006eb90: 675f 6672 6f6d 5f73 7472 2820 635f 6f72  g_from_str( c_or
-0006eba0: 5f6e 2029 3a0a 2020 2020 0a20 2020 2069  _n ):.    .    i
-0006ebb0: 6620 635f 6f72 5f6e 203d 3d20 2743 6f64  f c_or_n == 'Cod
-0006ebc0: 696e 6727 3a20 6963 646e 6720 3d20 310a  ing': icdng = 1.
-0006ebd0: 2020 2020 656c 6966 2063 5f6f 725f 6e20      elif c_or_n 
-0006ebe0: 3d3d 2027 4e6f 6e2d 636f 6469 6e67 273a  == 'Non-coding':
-0006ebf0: 2069 6364 6e67 203d 2030 0a20 2020 2065   icdng = 0.    e
-0006ec00: 6c73 653a 2069 6364 6e67 203d 202d 310a  lse: icdng = -1.
-0006ec10: 2020 2020 7265 7475 726e 2069 6364 6e67      return icdng
-0006ec20: 0a0a 0a64 6566 2063 6f6e 7665 7274 5f69  ...def convert_i
-0006ec30: 6e74 6f5f 7472 2868 6561 6465 722c 2073  nto_tr(header, s
-0006ec40: 6571 293a 2020 2020 0a20 2020 200a 2020  eq):    .    .  
-0006ec50: 2020 6974 656d 7320 3d20 6865 6164 6572    items = header
-0006ec60: 2e73 706c 6974 2827 5f27 290a 2020 2020  .split('_').    
-0006ec70: 0a20 2020 2070 7265 6669 7820 3d20 6974  .    prefix = it
-0006ec80: 656d 735b 305d 0a20 2020 200a 2020 2020  ems[0].    .    
-0006ec90: 6373 6520 3d20 6974 656d 735b 315d 2023  cse = items[1] #
-0006eca0: 205b 333a 5d0a 2020 2020 7373 203d 2063   [3:].    ss = c
-0006ecb0: 7365 2e73 706c 6974 2827 3a27 290a 2020  se.split(':').  
-0006ecc0: 2020 6368 7220 3d20 7373 5b30 5d0a 2020    chr = ss[0].  
-0006ecd0: 2020 7365 203d 2073 735b 315d 2e73 706c    se = ss[1].spl
-0006ece0: 6974 2827 2d27 290a 2020 2020 7374 6172  it('-').    star
-0006ecf0: 7420 3d20 6e70 2e69 6e74 2873 655b 305d  t = np.int(se[0]
-0006ed00: 290a 2020 2020 656e 6420 3d20 6e70 2e69  ).    end = np.i
-0006ed10: 6e74 2873 655b 315d 290a 2020 2020 0a20  nt(se[1]).    . 
-0006ed20: 2020 2073 7472 616e 6420 3d20 6765 745f     strand = get_
-0006ed30: 6973 7472 616e 645f 6672 6f6d 5f63 2869  istrand_from_c(i
-0006ed40: 7465 6d73 5b32 5d29 0a20 2020 2063 646e  tems[2]).    cdn
-0006ed50: 6720 3d20 6974 656d 735b 335d 0a20 2020  g = items[3].   
-0006ed60: 2067 6964 7820 3d20 6e70 2e69 6e74 2869   gidx = np.int(i
-0006ed70: 7465 6d73 5b34 5d29 0a20 2020 2067 7270  tems[4]).    grp
-0006ed80: 5f73 697a 6520 3d20 6e70 2e69 6e74 2869  _size = np.int(i
-0006ed90: 7465 6d73 5b35 5d29 0a20 2020 2069 636e  tems[5]).    icn
-0006eda0: 7420 3d20 6e70 2e69 6e74 2869 7465 6d73  t = np.int(items
-0006edb0: 5b36 5d29 0a20 2020 2061 626e 203d 206e  [6]).    abn = n
-0006edc0: 702e 666c 6f61 7433 3228 6974 656d 735b  p.float32(items[
-0006edd0: 375d 5b34 3a5d 290a 2020 2020 7470 6d20  7][4:]).    tpm 
-0006ede0: 3d20 6e70 2e66 6c6f 6174 3332 2869 7465  = np.float32(ite
-0006edf0: 6d73 5b38 5d5b 343a 5d29 0a20 2020 2069  ms[8][4:]).    i
-0006ee00: 736f 5f66 7261 6320 3d20 6e70 2e66 6c6f  so_frac = np.flo
-0006ee10: 6174 3332 2869 7465 6d73 5b39 5d5b 363a  at32(items[9][6:
-0006ee20: 5d29 0a20 2020 2070 726f 6220 3d20 6e70  ]).    prob = np
-0006ee30: 2e66 6c6f 6174 3332 2869 7465 6d73 5b31  .float32(items[1
-0006ee40: 305d 5b32 3a5d 290a 2020 2020 6e65 786f  0][2:]).    nexo
-0006ee50: 6e73 203d 206e 702e 696e 7428 6974 656d  ns = np.int(item
-0006ee60: 735b 3131 5d5b 333a 5d29 0a20 2020 2076  s[11][3:]).    v
-0006ee70: 6f6c 203d 206e 702e 696e 7428 6974 656d  ol = np.int(item
-0006ee80: 735b 3132 5d5b 323a 5d29 0a20 2020 2020  s[12][2:]).     
-0006ee90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0006eea0: 7472 203d 2054 7261 6e73 6372 6970 7428  tr = Transcript(
-0006eeb0: 7072 6566 6978 2c20 6769 6478 2c20 6772  prefix, gidx, gr
-0006eec0: 705f 7369 7a65 2c20 6963 6e74 2c20 6368  p_size, icnt, ch
-0006eed0: 722c 2073 7461 7274 2c20 656e 642c 2073  r, start, end, s
-0006eee0: 7472 616e 642c 2063 646e 672c 2073 6571  trand, cdng, seq
-0006eef0: 2c20 6162 6e2c 2074 706d 2c20 6973 6f5f  , abn, tpm, iso_
-0006ef00: 6672 6163 2c20 7072 6f62 2c20 6e65 786f  frac, prob, nexo
-0006ef10: 6e73 2c20 766f 6c29 0a20 2020 2020 2020  ns, vol).       
-0006ef20: 200a 2020 2020 7265 7475 726e 2874 7229   .    return(tr)
-0006ef30: 0a20 2020 200a 6465 6620 6c6f 6164 5f74  .    .def load_t
-0006ef40: 7261 6e73 6372 6970 7473 2866 696c 655f  ranscripts(file_
-0006ef50: 6e61 6d65 2c20 7665 7262 6f73 6520 3d20  name, verbose = 
-0006ef60: 5472 7565 293a 0a20 2020 200a 2020 2020  True):.    .    
-0006ef70: 6966 2076 6572 626f 7365 203d 3d20 5472  if verbose == Tr
-0006ef80: 7565 203a 2070 7269 6e74 2827 4c6f 6164  ue : print('Load
-0006ef90: 696e 6720 2573 202e 2e2e 2027 2025 2066  ing %s ... ' % f
-0006efa0: 696c 655f 6e61 6d65 2c20 656e 643d 2727  ile_name, end=''
-0006efb0: 2029 0a20 2020 2066 203d 206f 7065 6e28   ).    f = open(
-0006efc0: 6669 6c65 5f6e 616d 652c 2027 7227 290a  file_name, 'r').
-0006efd0: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
-0006efe0: 7472 7320 3d20 5b5d 0a20 2020 2066 6f72  trs = [].    for
-0006eff0: 206c 696e 6520 696e 2066 203a 0a20 2020   line in f :.   
-0006f000: 2020 2020 2069 6620 6c69 6e65 5b30 5d20       if line[0] 
-0006f010: 3d3d 2027 3e27 3a0a 2020 2020 2020 2020  == '>':.        
-0006f020: 2020 2020 6966 2063 6e74 203e 2030 3a20      if cnt > 0: 
-0006f030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006f040: 2074 7220 3d20 636f 6e76 6572 745f 696e   tr = convert_in
-0006f050: 746f 5f74 7228 6865 6164 6572 2c20 7365  to_tr(header, se
-0006f060: 715f 6c73 7429 0a20 2020 2020 2020 2020  q_lst).         
-0006f070: 2020 2020 2020 2074 7273 2e61 7070 656e         trs.appen
-0006f080: 6428 7472 290a 2020 2020 2020 2020 2020  d(tr).          
-0006f090: 2020 636e 7420 2b3d 2031 0a20 2020 2020    cnt += 1.     
-0006f0a0: 2020 2020 2020 2068 6561 6465 7220 3d20         header = 
-0006f0b0: 6c69 6e65 5b31 3a2d 315d 0a20 2020 2020  line[1:-1].     
-0006f0c0: 2020 2020 2020 2073 6571 5f6c 7374 203d         seq_lst =
-0006f0d0: 2027 270a 2020 2020 2020 2020 656c 7365   ''.        else
-0006f0e0: 203a 0a20 2020 2020 2020 2020 2020 2073   :.            s
-0006f0f0: 6571 5f6c 7374 203d 2073 6571 5f6c 7374  eq_lst = seq_lst
-0006f100: 202b 206c 696e 655b 3a2d 315d 0a0a 2020   + line[:-1]..  
-0006f110: 2020 7472 203d 2063 6f6e 7665 7274 5f69    tr = convert_i
-0006f120: 6e74 6f5f 7472 2868 6561 6465 722c 2073  nto_tr(header, s
-0006f130: 6571 5f6c 7374 290a 2020 2020 7472 732e  eq_lst).    trs.
-0006f140: 6170 7065 6e64 2874 7229 0a0a 2020 2020  append(tr)..    
-0006f150: 662e 636c 6f73 6528 290a 2020 2020 0a20  f.close().    . 
-0006f160: 2020 2069 6620 7665 7262 6f73 6520 3d3d     if verbose ==
-0006f170: 2054 7275 6520 3a20 7072 696e 7428 274e   True : print('N
-0006f180: 756d 2e54 7273 203d 2027 2c20 636e 742c  um.Trs = ', cnt,
-0006f190: 2027 206c 6f61 6465 6420 2020 2020 2020   ' loaded       
-0006f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f1b0: 2020 2020 2020 2729 0a20 2020 200a 2020        ').    .  
-0006f1c0: 2020 7265 7475 726e 2874 7273 290a 0a0a    return(trs)...
-0006f1d0: 5265 665f 5472 203d 2063 6f6c 6c65 6374  Ref_Tr = collect
-0006f1e0: 696f 6e73 2e6e 616d 6564 7475 706c 6528  ions.namedtuple(
-0006f1f0: 2752 6566 5f54 7227 2c20 276e 616d 652c  'Ref_Tr', 'name,
-0006f200: 2063 7667 5f66 7261 632c 2061 626e 2c20   cvg_frac, abn, 
-0006f210: 7270 6b6d 2c20 7470 6d2c 2073 6571 2729  rpkm, tpm, seq')
-0006f220: 0a0a 6465 6620 6c6f 6164 5f72 6566 5f74  ..def load_ref_t
-0006f230: 725f 7369 6d28 6669 6c65 5f6e 616d 652c  r_sim(file_name,
-0006f240: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
-0006f250: 3a0a 2020 2020 0a20 2020 2069 6620 7665  :.    .    if ve
-0006f260: 7262 6f73 6520 3d3d 2054 7275 6520 3a20  rbose == True : 
-0006f270: 7072 696e 7428 274c 6f61 6469 6e67 2025  print('Loading %
-0006f280: 7320 2e2e 2e20 2720 2520 6669 6c65 5f6e  s ... ' % file_n
-0006f290: 616d 652c 2065 6e64 3d27 2720 290a 2020  ame, end='' ).  
-0006f2a0: 2020 6620 3d20 6f70 656e 2866 696c 655f    f = open(file_
-0006f2b0: 6e61 6d65 2c20 2772 2729 0a20 2020 2063  name, 'r').    c
-0006f2c0: 6e74 203d 2030 0a20 2020 2072 6566 5f74  nt = 0.    ref_t
-0006f2d0: 7220 3d20 5b5d 0a20 2020 2066 6f72 206c  r = [].    for l
-0006f2e0: 696e 6520 696e 2066 203a 0a20 2020 2020  ine in f :.     
-0006f2f0: 2020 2069 6620 6c69 6e65 5b30 5d20 3d3d     if line[0] ==
-0006f300: 2027 3e27 3a0a 2020 2020 2020 2020 2020   '>':.          
-0006f310: 2020 6966 2063 6e74 203e 2030 3a20 0a20    if cnt > 0: . 
-0006f320: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0006f330: 7220 3d20 5265 665f 5472 2869 7465 6d73  r = Ref_Tr(items
-0006f340: 5b30 5d2c 206e 702e 666c 6f61 7433 3228  [0], np.float32(
-0006f350: 6974 656d 735b 315d 292a 3130 302c 206e  items[1])*100, n
-0006f360: 702e 666c 6f61 7433 3228 6974 656d 735b  p.float32(items[
-0006f370: 325d 292c 206e 702e 666c 6f61 7433 3228  2]), np.float32(
-0006f380: 6974 656d 735b 335d 292c 2030 2c20 7365  items[3]), 0, se
-0006f390: 715f 6c73 7429 0a20 2020 2020 2020 2020  q_lst).         
-0006f3a0: 2020 2020 2020 2072 6566 5f74 722e 6170         ref_tr.ap
-0006f3b0: 7065 6e64 2874 7229 0a20 2020 2020 2020  pend(tr).       
-0006f3c0: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
-0006f3d0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-0006f3e0: 203d 206c 696e 655b 313a 2d31 5d0a 2020   = line[1:-1].  
-0006f3f0: 2020 2020 2020 2020 2020 6974 656d 7320            items 
-0006f400: 3d20 6865 6164 6572 2e73 706c 6974 2827  = header.split('
-0006f410: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
-0006f420: 7365 715f 6c73 7420 3d20 2727 0a20 2020  seq_lst = ''.   
-0006f430: 2020 2020 2065 6c73 6520 3a0a 2020 2020       else :.    
-0006f440: 2020 2020 2020 2020 7365 715f 6c73 7420          seq_lst 
-0006f450: 3d20 7365 715f 6c73 7420 2b20 6c69 6e65  = seq_lst + line
-0006f460: 5b3a 2d31 5d0a 0a20 2020 2074 7220 3d20  [:-1]..    tr = 
-0006f470: 5265 665f 5472 2869 7465 6d73 5b30 5d2c  Ref_Tr(items[0],
-0006f480: 206e 702e 666c 6f61 7433 3228 6974 656d   np.float32(item
-0006f490: 735b 315d 292a 3130 302c 206e 702e 666c  s[1])*100, np.fl
-0006f4a0: 6f61 7433 3228 6974 656d 735b 325d 292c  oat32(items[2]),
-0006f4b0: 206e 702e 666c 6f61 7433 3228 6974 656d   np.float32(item
-0006f4c0: 735b 335d 292c 2030 2c20 7365 715f 6c73  s[3]), 0, seq_ls
-0006f4d0: 7429 0a20 2020 2072 6566 5f74 722e 6170  t).    ref_tr.ap
-0006f4e0: 7065 6e64 2874 7229 0a0a 2020 2020 662e  pend(tr)..    f.
-0006f4f0: 636c 6f73 6528 290a 2020 2020 0a20 2020  close().    .   
-0006f500: 2072 6566 5f74 7232 203d 205b 5d0a 2020   ref_tr2 = [].  
-0006f510: 2020 6162 6e5f 746f 7461 6c20 3d20 300a    abn_total = 0.
-0006f520: 2020 2020 666f 7220 7472 2069 6e20 7265      for tr in re
-0006f530: 665f 7472 3a0a 2020 2020 2020 2020 6162  f_tr:.        ab
-0006f540: 6e5f 746f 7461 6c20 2b3d 2074 722e 6162  n_total += tr.ab
-0006f550: 6e0a 2020 2020 6e66 203d 2031 3030 3030  n.    nf = 10000
-0006f560: 3030 2f61 626e 5f74 6f74 616c 0a20 2020  00/abn_total.   
-0006f570: 200a 2020 2020 666f 7220 7420 696e 2072   .    for t in r
-0006f580: 6566 5f74 723a 0a20 2020 2020 2020 2074  ef_tr:.        t
-0006f590: 7220 3d20 5265 665f 5472 2874 2e6e 616d  r = Ref_Tr(t.nam
-0006f5a0: 652c 2074 2e63 7667 5f66 7261 632c 2074  e, t.cvg_frac, t
-0006f5b0: 2e61 626e 2c20 742e 7270 6b6d 2c20 742e  .abn, t.rpkm, t.
-0006f5c0: 6162 6e2a 6e66 2c20 742e 7365 7120 290a  abn*nf, t.seq ).
-0006f5d0: 2020 2020 2020 2020 7265 665f 7472 322e          ref_tr2.
-0006f5e0: 6170 7065 6e64 2874 7229 0a20 2020 200a  append(tr).    .
-0006f5f0: 2020 2020 6966 2076 6572 626f 7365 203d      if verbose =
-0006f600: 3d20 5472 7565 203a 2070 7269 6e74 2827  = True : print('
-0006f610: 4e75 6d2e 5472 7320 3d20 272c 2063 6e74  Num.Trs = ', cnt
-0006f620: 2c20 2720 6c6f 6164 6564 2020 2020 2020  , ' loaded      
-0006f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f640: 2020 2020 2020 2027 290a 2020 2020 0a20         ').    . 
-0006f650: 2020 2072 6574 7572 6e28 7265 665f 7472     return(ref_tr
-0006f660: 290a 0a0a 2323 2054 7261 6e73 6372 6970  )...## Transcrip
-0006f670: 7420 3d20 636f 6c6c 6563 7469 6f6e 732e  t = collections.
-0006f680: 6e61 6d65 6474 7570 6c65 2827 5472 616e  namedtuple('Tran
-0006f690: 7363 7269 7074 272c 2027 7072 6566 6978  script', 'prefix
-0006f6a0: 2c20 6963 6e74 2c20 6368 722c 2073 7461  , icnt, chr, sta
-0006f6b0: 7274 2c20 656e 642c 2073 6571 2c20 6162  rt, end, seq, ab
-0006f6c0: 6e2c 2074 706d 2729 2020 2020 0a64 6566  n, tpm')    .def
-0006f6d0: 2070 7269 6e74 5f74 7228 7472 5f6c 7374   print_tr(tr_lst
-0006f6e0: 293a 0a20 2020 2066 6f72 2074 7220 696e  ):.    for tr in
-0006f6f0: 2074 725f 6c73 743a 0a20 2020 2020 2020   tr_lst:.       
-0006f700: 2070 7269 6e74 2827 2569 2c20 4c65 6e3a   print('%i, Len:
-0006f710: 2025 692c 2041 626e 3a20 2534 2e31 6627   %i, Abn: %4.1f'
-0006f720: 2025 2028 7472 2e69 636e 742c 206c 656e   % (tr.icnt, len
-0006f730: 2874 722e 7365 7129 2c20 7472 2e61 626e  (tr.seq), tr.abn
-0006f740: 2920 290a 2020 2020 7072 696e 7428 2720  ) ).    print(' 
-0006f750: 2027 290a 0a20 2020 200a 6465 6620 6368   ')..    .def ch
-0006f760: 6563 6b5f 7273 5f6d 2872 735f 6d2c 2068  eck_rs_m(rs_m, h
-0006f770: 6472 203d 2027 2720 293a 0a20 2020 2063  dr = '' ):.    c
-0006f780: 6e74 203d 2030 0a20 2020 2066 6f72 206b  nt = 0.    for k
-0006f790: 2069 6e20 7261 6e67 6528 6c65 6e28 7273   in range(len(rs
-0006f7a0: 5f6d 2e72 676e 7329 293a 0a20 2020 2020  _m.rgns)):.     
-0006f7b0: 2020 206c 3120 3d20 2872 735f 6d2e 7267     l1 = (rs_m.rg
-0006f7c0: 6e73 5b6b 5d2e 656e 642d 7273 5f6d 2e72  ns[k].end-rs_m.r
-0006f7d0: 676e 735b 6b5d 2e73 7461 7274 2b31 290a  gns[k].start+1).
-0006f7e0: 2020 2020 2020 2020 6c32 203d 2072 735f          l2 = rs_
-0006f7f0: 6d2e 7267 6e73 5b6b 5d2e 636d 6174 2e73  m.rgns[k].cmat.s
-0006f800: 6861 7065 5b31 5d0a 2020 2020 2020 2020  hape[1].        
-0006f810: 6966 206c 3120 213d 206c 323a 0a20 2020  if l1 != l2:.   
-0006f820: 2020 2020 2020 2020 2069 6620 636e 7420           if cnt 
-0006f830: 3d3d 2030 3a20 0a20 2020 2020 2020 2020  == 0: .         
-0006f840: 2020 2020 2020 2070 7269 6e74 2827 5c6e         print('\n
-0006f850: 272c 656e 643d 2727 290a 2020 2020 2020  ',end='').      
-0006f860: 2020 2020 2020 2020 2020 636e 7420 2b3d            cnt +=
-0006f870: 2031 0a20 2020 2020 2020 2020 2020 2070   1.            p
-0006f880: 7269 6e74 2827 4552 524f 5220 696e 2063  rint('ERROR in c
-0006f890: 6865 636b 5f72 735f 6d28 2920 6174 2025  heck_rs_m() at %
-0006f8a0: 733a 2025 6920 7267 6e73 206f 626a 2069  s: %i rgns obj i
-0006f8b0: 7320 6e6f 7420 636f 6e73 6973 7465 6e74  s not consistent
-0006f8c0: 2e20 2569 2021 3d20 2569 2720 2520 2868  . %i != %i' % (h
-0006f8d0: 6472 2c6b 2c20 6c31 2c20 6c32 2029 2029  dr,k, l1, l2 ) )
-0006f8e0: 0a0a 0a64 6566 2073 6176 655f 7267 6e73  ...def save_rgns
-0006f8f0: 2820 666e 616d 652c 2072 676e 735f 6c73  ( fname, rgns_ls
-0006f900: 742c 2072 645f 6c65 6e2c 206e 756d 5f72  t, rd_len, num_r
-0006f910: 6473 2c20 686f 203d 2046 616c 7365 2029  ds, ho = False )
-0006f920: 3a0a 2020 2020 0a20 2020 2066 203d 206f  :.    .    f = o
-0006f930: 7065 6e28 666e 616d 652c 2777 2b27 290a  pen(fname,'w+').
-0006f940: 2020 2020 0a20 2020 206c 696e 6520 3d20      .    line = 
-0006f950: 2740 4652 4147 5f4c 454e 3d25 692c 4e55  '@FRAG_LEN=%i,NU
-0006f960: 4d5f 5245 4144 533d 2569 5c6e 2720 2520  M_READS=%i\n' % 
-0006f970: 2872 645f 6c65 6e2c 206e 756d 5f72 6473  (rd_len, num_rds
-0006f980: 290a 2020 2020 662e 7772 6974 656c 696e  ).    f.writelin
-0006f990: 6573 286c 696e 6529 0a20 2020 200a 2020  es(line).    .  
-0006f9a0: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-0006f9b0: 286c 656e 2872 676e 735f 6c73 7429 293a  (len(rgns_lst)):
-0006f9c0: 0a20 2020 2020 2020 2072 676e 735f 6c73  .        rgns_ls
-0006f9d0: 745b 6b5d 2e6f 7264 6572 2829 0a20 2020  t[k].order().   
-0006f9e0: 2020 2020 2069 6620 686f 3a0a 2020 2020       if ho:.    
-0006f9f0: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
-0006fa00: 7267 6e73 5f6c 7374 5b6b 5d2e 636f 6e76  rgns_lst[k].conv
-0006fa10: 6572 745f 746f 5f74 6578 745f 6c69 6e65  ert_to_text_line
-0006fa20: 735f 686f 286b 290a 2020 2020 2020 2020  s_ho(k).        
-0006fa30: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
-0006fa40: 286c 696e 6573 290a 2020 2020 2020 2020  (lines).        
-0006fa50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0006fa60: 2020 6c69 6e65 7320 3d20 7267 6e73 5f6c    lines = rgns_l
-0006fa70: 7374 5b6b 5d2e 636f 6e76 6572 745f 746f  st[k].convert_to
-0006fa80: 5f74 6578 745f 6c69 6e65 7328 6b29 0a20  _text_lines(k). 
-0006fa90: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-0006faa0: 7465 6c69 6e65 7328 6c69 6e65 7329 0a20  telines(lines). 
-0006fab0: 2020 2066 2e63 6c6f 7365 2829 0a0a 2020     f.close()..  
-0006fac0: 2020 0a64 6566 2067 6574 5f69 645f 6672    .def get_id_fr
-0006fad0: 6f6d 5f68 6472 2868 6472 293a 0a0a 2020  om_hdr(hdr):..  
-0006fae0: 2020 6974 656d 7320 3d20 6864 722e 7370    items = hdr.sp
-0006faf0: 6c69 7428 290a 2020 2020 736e 203d 2069  lit().    sn = i
-0006fb00: 6e74 2869 7465 6d73 5b30 5d29 0a20 2020  nt(items[0]).   
-0006fb10: 204e 203d 2069 6e74 2869 7465 6d73 5b31   N = int(items[1
-0006fb20: 5d29 0a20 2020 206e 203d 2069 6e74 2869  ]).    n = int(i
-0006fb30: 7465 6d73 5b32 5d29 0a20 2020 2072 6574  tems[2]).    ret
-0006fb40: 7572 6e28 736e 2c4e 2c6e 290a 2020 2020  urn(sn,N,n).    
-0006fb50: 0a64 6566 206c 6f61 645f 7267 6e73 2820  .def load_rgns( 
-0006fb60: 666e 616d 652c 206d 6f64 652c 206e 5f72  fname, mode, n_r
-0006fb70: 676e 7320 3d20 302c 2076 6572 626f 7365  gns = 0, verbose
-0006fb80: 203d 2046 616c 7365 2029 3a0a 2020 2020   = False ):.    
-0006fb90: 0a20 2020 2072 676e 735f 6c73 7420 3d20  .    rgns_lst = 
-0006fba0: 5b5d 0a20 2020 2066 203d 206f 7065 6e28  [].    f = open(
-0006fbb0: 666e 616d 652c 2772 2729 0a20 2020 206c  fname,'r').    l
-0006fbc0: 696e 655f 6c73 7420 3d20 662e 7265 6164  ine_lst = f.read
-0006fbd0: 6c69 6e65 7328 290a 2020 2020 662e 636c  lines().    f.cl
-0006fbe0: 6f73 6528 290a 2020 2020 0a20 2020 2069  ose().    .    i
-0006fbf0: 6620 6d6f 6465 203d 3d20 303a 204c 636e  f mode == 0: Lcn
-0006fc00: 7420 3d20 370a 2020 2020 656c 7365 3a20  t = 7.    else: 
-0006fc10: 4c63 6e74 203d 2032 0a20 2020 2020 2020  Lcnt = 2.       
-0006fc20: 200a 2020 2020 7264 5f6c 656e 203d 2030   .    rd_len = 0
-0006fc30: 0a20 2020 206e 756d 5f72 6473 203d 2030  .    num_rds = 0
-0006fc40: 0a20 2020 2072 636e 7420 3d20 300a 2020  .    rcnt = 0.  
-0006fc50: 2020 6c63 6e74 203d 2030 0a20 2020 2073    lcnt = 0.    s
-0006fc60: 6469 7620 3d20 3130 0a20 2020 2073 7465  div = 10.    ste
-0006fc70: 7020 3d20 6e70 2e63 6569 6c28 6c65 6e28  p = np.ceil(len(
-0006fc80: 6c69 6e65 5f6c 7374 292f 2873 6469 762a  line_lst)/(sdiv*
-0006fc90: 4c63 6e74 2929 0a20 2020 200a 2020 2020  Lcnt)).    .    
-0006fca0: 666f 7220 6c69 6e65 2069 6e20 6c69 6e65  for line in line
-0006fcb0: 5f6c 7374 3a20 2320 6620 3a0a 2020 2020  _lst: # f :.    
-0006fcc0: 2020 2020 2320 7072 696e 7428 6c69 6e65      # print(line
-0006fcd0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-0006fce0: 286c 696e 6529 203d 3d20 303a 2062 7265  (line) == 0: bre
-0006fcf0: 616b 0a20 2020 2020 2020 2065 6c73 653a  ak.        else:
-0006fd00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0006fd10: 6c69 6e65 5b30 5d20 3d3d 2027 4027 3a0a  line[0] == '@':.
-0006fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006fd30: 6c69 6e65 5f74 6d70 203d 206c 696e 655b  line_tmp = line[
-0006fd40: 313a 2d31 5d0a 2020 2020 2020 2020 2020  1:-1].          
-0006fd50: 2020 2020 2020 6974 656d 7320 3d20 6c69        items = li
-0006fd60: 6e65 5f74 6d70 2e73 706c 6974 2827 2c27  ne_tmp.split(','
-0006fd70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0006fd80: 2020 7264 5f6c 656e 203d 2069 6e74 2869    rd_len = int(i
-0006fd90: 7465 6d73 5b30 5d5b 393a 5d29 0a20 2020  tems[0][9:]).   
-0006fda0: 2020 2020 2020 2020 2020 2020 206e 756d               num
-0006fdb0: 5f72 6473 203d 2069 6e74 2869 7465 6d73  _rds = int(items
-0006fdc0: 5b31 5d5b 3130 3a5d 290a 2020 2020 2020  [1][10:]).      
-0006fdd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0006fde0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0006fdf0: 636e 7420 3d3d 2030 3a0a 2020 2020 2020  cnt == 0:.      
-0006fe00: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0006fe10: 6e65 735f 746d 7020 3d20 5b5d 0a20 2020  nes_tmp = [].   
+0006dfb0: 6966 206b 203e 206d 785f 636e 743a 2062  if k > mx_cnt: b
+0006dfc0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+0006dfd0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0006dfe0: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
+0006dff0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0006e000: 2020 2070 7269 6e74 2827 5c72 436f 6e76     print('\rConv
+0006e010: 6572 7469 6e67 2064 6f6e 652e 2025 6920  erting done. %i 
+0006e020: 4141 5365 7120 6361 6e64 6964 6174 6573  AASeq candidates
+0006e030: 2066 6f75 6e64 2066 726f 6d20 2569 2074   found from %i t
+0006e040: 7273 2e20 2720 2520 2870 5f63 616e 645f  rs. ' % (p_cand_
+0006e050: 636e 742c 6361 6e64 5f63 6e74 2929 0a20  cnt,cand_cnt)). 
+0006e060: 2020 2020 2020 2020 0a20 2020 2072 6574          .    ret
+0006e070: 7572 6e20 6c69 6e65 730a 0a20 2020 200a  urn lines..    .
+0006e080: 6465 6620 4765 6e65 7261 7465 5f50 726f  def Generate_Pro
+0006e090: 7465 6f6d 6528 7472 5f66 612c 206c 656e  teome(tr_fa, len
+0006e0a0: 5f74 6820 3d20 4d49 4e5f 5052 5f4c 454e  _th = MIN_PR_LEN
+0006e0b0: 4754 482c 2076 6572 626f 7365 203d 2054  GTH, verbose = T
+0006e0c0: 7275 652c 206d 785f 636e 7420 3d20 302c  rue, mx_cnt = 0,
+0006e0d0: 2074 7261 7265 636f 203d 2046 616c 7365   trareco = False
+0006e0e0: 2c20 666e 616d 655f 6f75 7420 3d20 4e6f  , fname_out = No
+0006e0f0: 6e65 2c20 6967 6e6f 7265 5f73 203d 2046  ne, ignore_s = F
+0006e100: 616c 7365 293a 0a20 2020 200a 2020 2020  alse):.    .    
+0006e110: 6669 6c65 5f6e 616d 6520 3d20 7472 5f66  file_name = tr_f
+0006e120: 612e 7370 6c69 7428 272f 2729 5b2d 315d  a.split('/')[-1]
+0006e130: 0a20 2020 2066 6e73 203d 2066 696c 655f  .    fns = file_
+0006e140: 6e61 6d65 2e73 706c 6974 2827 2e27 295b  name.split('.')[
+0006e150: 3a2d 315d 0a20 2020 2066 6e61 6d65 203d  :-1].    fname =
+0006e160: 2027 270a 2020 2020 666f 7220 6b2c 2066   ''.    for k, f
+0006e170: 6e20 696e 2065 6e75 6d65 7261 7465 2866  n in enumerate(f
+0006e180: 6e73 293a 0a20 2020 2020 2020 2069 6620  ns):.        if 
+0006e190: 6b20 3e20 303a 0a20 2020 2020 2020 2020  k > 0:.         
+0006e1a0: 2020 2066 6e61 6d65 203d 2066 6e61 6d65     fname = fname
+0006e1b0: 202b 2027 2e27 0a20 2020 2020 2020 2066   + '.'.        f
+0006e1c0: 6e61 6d65 203d 2066 6e61 6d65 202b 2066  name = fname + f
+0006e1d0: 6e0a 2020 2020 0a20 2020 2068 6472 5f6c  n.    .    hdr_l
+0006e1e0: 7374 2c20 7473 6571 5f6c 7374 203d 206c  st, tseq_lst = l
+0006e1f0: 6f61 645f 6661 7374 6131 2874 725f 6661  oad_fasta1(tr_fa
+0006e200: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
+0006e210: 6529 0a20 2020 2063 616e 645f 636e 7420  e).    cand_cnt 
+0006e220: 3d20 6c65 6e28 7473 6571 5f6c 7374 290a  = len(tseq_lst).
+0006e230: 0a20 2020 206c 696e 6573 203d 2067 656e  .    lines = gen
+0006e240: 5f70 726f 7465 6f6d 655f 6672 6f6d 5f74  _proteome_from_t
+0006e250: 7261 7363 7269 7074 6f6d 6528 6864 725f  rascriptome(hdr_
+0006e260: 6c73 742c 2074 7365 715f 6c73 742c 206c  lst, tseq_lst, l
+0006e270: 656e 5f74 6820 3d20 6c65 6e5f 7468 2c20  en_th = len_th, 
+0006e280: 7665 7262 6f73 6520 3d20 7665 7262 6f73  verbose = verbos
+0006e290: 652c 2074 7261 7265 636f 203d 2074 7261  e, trareco = tra
+0006e2a0: 7265 636f 2c20 6967 6e6f 7265 5f73 203d  reco, ignore_s =
+0006e2b0: 2069 676e 6f72 655f 7329 0a20 2020 2070   ignore_s).    p
+0006e2c0: 5f63 616e 645f 636e 7420 3d20 6c65 6e28  _cand_cnt = len(
+0006e2d0: 6c69 6e65 7329 2f32 0a20 2020 2020 2020  lines)/2.       
+0006e2e0: 2020 2020 200a 2020 2020 6966 2066 6e61       .    if fna
+0006e2f0: 6d65 5f6f 7574 2069 7320 4e6f 6e65 3a20  me_out is None: 
+0006e300: 666e 616d 655f 6f75 7420 3d20 666e 616d  fname_out = fnam
+0006e310: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
+0006e320: 6127 0a20 2020 2066 203d 206f 7065 6e28  a'.    f = open(
+0006e330: 666e 616d 655f 6f75 742c 2777 2b27 290a  fname_out,'w+').
+0006e340: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
+0006e350: 286c 696e 6573 290a 2020 2020 662e 636c  (lines).    f.cl
+0006e360: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+0006e370: 2020 2020 2020 0a20 2020 2069 6620 7665        .    if ve
+0006e380: 7262 6f73 653a 200a 2020 2020 2020 2020  rbose: .        
+0006e390: 7072 696e 7428 2741 4153 6571 2073 6176  print('AASeq sav
+0006e3a0: 6564 2074 6f20 2573 2720 2520 2866 6e61  ed to %s' % (fna
+0006e3b0: 6d65 5f6f 7574 2929 0a20 2020 2020 2020  me_out)).       
+0006e3c0: 200a 2020 2020 7265 7475 726e 2066 6e61   .    return fna
+0006e3d0: 6d65 5f6f 7574 0a0a 2020 2020 0a23 2323  me_out..    .###
+0006e3e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e3f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e420: 2323 2323 2323 230a 2323 2046 756e 6374  #######.## Funct
+0006e430: 696f 6e73 2066 6f72 2053 7472 696e 6746  ions for StringF
+0006e440: 6978 206d 6169 6e20 2831 290a 2323 2323  ix main (1).####
+0006e450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006e490: 2323 2323 2323 0a0a 6465 6620 6765 745f  ######..def get_
+0006e4a0: 6d61 785f 6376 6728 7273 293a 0a20 2020  max_cvg(rs):.   
+0006e4b0: 206d 6178 5f63 7667 203d 2030 0a20 2020   max_cvg = 0.   
+0006e4c0: 2066 6f72 2072 676e 2069 6e20 7273 2e72   for rgn in rs.r
+0006e4d0: 676e 733a 0a20 2020 2020 2020 206d 6178  gns:.        max
+0006e4e0: 5f63 7667 203d 206d 6178 2820 6d61 785f  _cvg = max( max_
+0006e4f0: 6376 672c 2072 676e 2e61 7665 5f63 7667  cvg, rgn.ave_cvg
+0006e500: 5f64 6570 7468 2829 2029 0a20 2020 2072  _depth() ).    r
+0006e510: 6574 7572 6e28 6d61 785f 6376 6729 0a0a  eturn(max_cvg)..
+0006e520: 2320 5472 616e 7363 7269 7074 203d 2063  # Transcript = c
+0006e530: 6f6c 6c65 6374 696f 6e73 2e6e 616d 6564  ollections.named
+0006e540: 7475 706c 6528 2754 7261 6e73 6372 6970  tuple('Transcrip
+0006e550: 7427 2c20 2770 7265 6669 782c 2067 6964  t', 'prefix, gid
+0006e560: 782c 2067 7270 5f73 697a 652c 2069 636e  x, grp_size, icn
+0006e570: 742c 2063 6872 2c20 7374 6172 742c 2065  t, chr, start, e
+0006e580: 6e64 2c20 7365 712c 2061 626e 2c20 7470  nd, seq, abn, tp
+0006e590: 6d2c 2069 736f 5f66 7261 632c 2070 726f  m, iso_frac, pro
+0006e5a0: 6227 290a 0a64 6566 2073 6176 655f 7472  b')..def save_tr
+0006e5b0: 616e 7363 7269 7074 7328 2066 6e61 6d65  anscripts( fname
+0006e5c0: 2c20 7472 5f6c 7374 2029 3a0a 2020 2020  , tr_lst ):.    
+0006e5d0: 0a20 2020 2074 725f 6e61 6d65 7320 3d20  .    tr_names = 
+0006e5e0: 6765 745f 7472 5f6e 616d 6528 7472 5f6c  get_tr_name(tr_l
+0006e5f0: 7374 290a 2020 2020 6620 3d20 6f70 656e  st).    f = open
+0006e600: 2866 6e61 6d65 2c27 772b 2729 0a20 2020  (fname,'w+').   
+0006e610: 2066 6f72 206b 2c20 7472 2069 6e20 656e   for k, tr in en
+0006e620: 756d 6572 6174 6528 7472 5f6c 7374 293a  umerate(tr_lst):
+0006e630: 0a20 2020 2020 2020 2073 203d 2027 3e25  .        s = '>%
+0006e640: 735c 6e27 2025 2074 725f 6e61 6d65 735b  s\n' % tr_names[
+0006e650: 6b5d 0a20 2020 2020 2020 2073 6571 203d  k].        seq =
+0006e660: 2074 722e 7365 7120 2b20 275c 6e27 0a20   tr.seq + '\n'. 
+0006e670: 2020 2020 2020 2066 2e77 7269 7465 6c69         f.writeli
+0006e680: 6e65 7328 7329 0a20 2020 2020 2020 2066  nes(s).        f
+0006e690: 2e77 7269 7465 6c69 6e65 7328 7365 7129  .writelines(seq)
+0006e6a0: 0a20 2020 2066 2e63 6c6f 7365 2829 0a0a  .    f.close()..
+0006e6b0: 6465 6620 7361 7665 5f74 7261 6e73 6372  def save_transcr
+0006e6c0: 6970 7473 3228 2066 6e61 6d65 2c20 7472  ipts2( fname, tr
+0006e6d0: 5f6c 7374 2029 3a0a 2020 2020 0a20 2020  _lst ):.    .   
+0006e6e0: 2074 725f 6e61 6d65 7320 3d20 6765 745f   tr_names = get_
+0006e6f0: 7472 5f6e 616d 6528 7472 5f6c 7374 290a  tr_name(tr_lst).
+0006e700: 2020 2020 6620 3d20 6f70 656e 2866 6e61      f = open(fna
+0006e710: 6d65 2c27 772b 2729 0a20 2020 2066 6f72  me,'w+').    for
+0006e720: 206b 2c20 7472 2069 6e20 656e 756d 6572   k, tr in enumer
+0006e730: 6174 6528 7472 5f6c 7374 293a 0a20 2020  ate(tr_lst):.   
+0006e740: 2020 2020 2023 2073 203d 2027 3e25 735c       # s = '>%s\
+0006e750: 6e27 2025 2074 725f 6e61 6d65 735b 6b5d  n' % tr_names[k]
+0006e760: 0a20 2020 2020 2020 2074 6964 203d 2027  .        tid = '
+0006e770: 5346 6978 2e25 732e 2569 2720 2520 2873  SFix.%s.%i' % (s
+0006e780: 7472 2874 722e 6769 6478 292c 2074 722e  tr(tr.gidx), tr.
+0006e790: 6963 6e74 2b31 290a 2020 2020 2020 2020  icnt+1).        
+0006e7a0: 6320 3d20 6765 745f 635f 6672 6f6d 5f69  c = get_c_from_i
+0006e7b0: 7374 7261 6e64 2874 722e 7374 7261 6e64  strand(tr.strand
+0006e7c0: 290a 2020 2020 2020 2020 635f 6f72 5f6e  ).        c_or_n
+0006e7d0: 203d 2074 722e 6364 6e67 2023 2067 6574   = tr.cdng # get
+0006e7e0: 5f73 7472 5f66 726f 6d5f 6963 646e 6728  _str_from_icdng(
+0006e7f0: 2074 722e 6364 6e67 2029 0a20 2020 2020   tr.cdng ).     
+0006e800: 2020 2073 203d 2027 3e25 7320 6c65 6e67     s = '>%s leng
+0006e810: 7468 3a25 6920 6162 6e3a 2566 2073 7472  th:%i abn:%f str
+0006e820: 616e 643a 2573 2025 735c 6e27 2025 2028  and:%s %s\n' % (
+0006e830: 7469 642c 206c 656e 2874 722e 7365 7129  tid, len(tr.seq)
+0006e840: 2c20 6e70 2e72 6f75 6e64 2874 722e 6162  , np.round(tr.ab
+0006e850: 6e2c 2032 292c 2063 2c20 635f 6f72 5f6e  n, 2), c, c_or_n
+0006e860: 290a 2020 2020 2020 2020 7365 7120 3d20  ).        seq = 
+0006e870: 7472 2e73 6571 202b 2027 5c6e 270a 2020  tr.seq + '\n'.  
+0006e880: 2020 2020 2020 662e 7772 6974 656c 696e        f.writelin
+0006e890: 6573 2873 290a 2020 2020 2020 2020 662e  es(s).        f.
+0006e8a0: 7772 6974 656c 696e 6573 2873 6571 290a  writelines(seq).
+0006e8b0: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
+0006e8c0: 2020 200a 6465 6620 6765 745f 635f 6672     .def get_c_fr
+0006e8d0: 6f6d 5f69 7374 7261 6e64 2869 7374 7261  om_istrand(istra
+0006e8e0: 6e64 293a 0a20 2020 200a 2020 2020 6966  nd):.    .    if
+0006e8f0: 2069 7374 7261 6e64 203e 2030 3a20 7374   istrand > 0: st
+0006e900: 7261 6e64 203d 2027 2b27 0a20 2020 2065  rand = '+'.    e
+0006e910: 6c69 6620 6973 7472 616e 6420 3d3d 2030  lif istrand == 0
+0006e920: 3a20 7374 7261 6e64 203d 2027 2e27 0a20  : strand = '.'. 
+0006e930: 2020 2065 6c73 653a 2073 7472 616e 6420     else: strand 
+0006e940: 3d20 272d 270a 2020 2020 7265 7475 726e  = '-'.    return
+0006e950: 2073 7472 616e 640a 2020 2020 2020 2020   strand.        
+0006e960: 0a20 2020 200a 6465 6620 6765 745f 6973  .    .def get_is
+0006e970: 7472 616e 645f 6672 6f6d 5f63 2873 7472  trand_from_c(str
+0006e980: 616e 645f 6329 3a0a 2020 2020 0a20 2020  and_c):.    .   
+0006e990: 2069 6620 7374 7261 6e64 5f63 203d 3d20   if strand_c == 
+0006e9a0: 272b 273a 2073 7472 616e 6420 3d20 310a  '+': strand = 1.
+0006e9b0: 2020 2020 656c 6966 2073 7472 616e 645f      elif strand_
+0006e9c0: 6320 3d3d 2027 2d27 3a20 7374 7261 6e64  c == '-': strand
+0006e9d0: 203d 202d 310a 2020 2020 656c 7365 3a20   = -1.    else: 
+0006e9e0: 7374 7261 6e64 203d 2030 0a20 2020 2072  strand = 0.    r
+0006e9f0: 6574 7572 6e20 7374 7261 6e64 0a20 2020  eturn strand.   
+0006ea00: 2020 2020 200a 2020 2020 0a64 6566 2067       .    .def g
+0006ea10: 6574 5f73 7472 5f66 726f 6d5f 6963 646e  et_str_from_icdn
+0006ea20: 6728 2063 6473 2029 3a0a 2020 2020 0a20  g( cds ):.    . 
+0006ea30: 2020 2069 6620 6364 7320 3e20 303a 2063     if cds > 0: c
+0006ea40: 5f6f 725f 6e20 3d20 2743 6f64 696e 6727  _or_n = 'Coding'
+0006ea50: 0a20 2020 2065 6c69 6620 6364 7320 3d3d  .    elif cds ==
+0006ea60: 2030 3a20 635f 6f72 5f6e 203d 2027 4e6f   0: c_or_n = 'No
+0006ea70: 6e2d 636f 6469 6e67 270a 2020 2020 656c  n-coding'.    el
+0006ea80: 7365 3a20 635f 6f72 5f6e 203d 2027 756e  se: c_or_n = 'un
+0006ea90: 7370 6563 6966 6965 6427 0a20 2020 2072  specified'.    r
+0006eaa0: 6574 7572 6e20 635f 6f72 5f6e 0a0a 0a64  eturn c_or_n...d
+0006eab0: 6566 2067 6574 5f69 6364 6e67 5f66 726f  ef get_icdng_fro
+0006eac0: 6d5f 7374 7228 2063 5f6f 725f 6e20 293a  m_str( c_or_n ):
+0006ead0: 0a20 2020 200a 2020 2020 6966 2063 5f6f  .    .    if c_o
+0006eae0: 725f 6e20 3d3d 2027 436f 6469 6e67 273a  r_n == 'Coding':
+0006eaf0: 2069 6364 6e67 203d 2031 0a20 2020 2065   icdng = 1.    e
+0006eb00: 6c69 6620 635f 6f72 5f6e 203d 3d20 274e  lif c_or_n == 'N
+0006eb10: 6f6e 2d63 6f64 696e 6727 3a20 6963 646e  on-coding': icdn
+0006eb20: 6720 3d20 300a 2020 2020 656c 7365 3a20  g = 0.    else: 
+0006eb30: 6963 646e 6720 3d20 2d31 0a20 2020 2072  icdng = -1.    r
+0006eb40: 6574 7572 6e20 6963 646e 670a 0a0a 6465  eturn icdng...de
+0006eb50: 6620 636f 6e76 6572 745f 696e 746f 5f74  f convert_into_t
+0006eb60: 7228 6865 6164 6572 2c20 7365 7129 3a20  r(header, seq): 
+0006eb70: 2020 200a 2020 2020 0a20 2020 2069 7465     .    .    ite
+0006eb80: 6d73 203d 2068 6561 6465 722e 7370 6c69  ms = header.spli
+0006eb90: 7428 275f 2729 0a20 2020 200a 2020 2020  t('_').    .    
+0006eba0: 7072 6566 6978 203d 2069 7465 6d73 5b30  prefix = items[0
+0006ebb0: 5d0a 2020 2020 0a20 2020 2063 7365 203d  ].    .    cse =
+0006ebc0: 2069 7465 6d73 5b31 5d20 2320 5b33 3a5d   items[1] # [3:]
+0006ebd0: 0a20 2020 2073 7320 3d20 6373 652e 7370  .    ss = cse.sp
+0006ebe0: 6c69 7428 273a 2729 0a20 2020 2063 6872  lit(':').    chr
+0006ebf0: 203d 2073 735b 305d 0a20 2020 2073 6520   = ss[0].    se 
+0006ec00: 3d20 7373 5b31 5d2e 7370 6c69 7428 272d  = ss[1].split('-
+0006ec10: 2729 0a20 2020 2073 7461 7274 203d 206e  ').    start = n
+0006ec20: 702e 696e 7428 7365 5b30 5d29 0a20 2020  p.int(se[0]).   
+0006ec30: 2065 6e64 203d 206e 702e 696e 7428 7365   end = np.int(se
+0006ec40: 5b31 5d29 0a20 2020 200a 2020 2020 7374  [1]).    .    st
+0006ec50: 7261 6e64 203d 2067 6574 5f69 7374 7261  rand = get_istra
+0006ec60: 6e64 5f66 726f 6d5f 6328 6974 656d 735b  nd_from_c(items[
+0006ec70: 325d 290a 2020 2020 6364 6e67 203d 2069  2]).    cdng = i
+0006ec80: 7465 6d73 5b33 5d0a 2020 2020 6769 6478  tems[3].    gidx
+0006ec90: 203d 206e 702e 696e 7428 6974 656d 735b   = np.int(items[
+0006eca0: 345d 290a 2020 2020 6772 705f 7369 7a65  4]).    grp_size
+0006ecb0: 203d 206e 702e 696e 7428 6974 656d 735b   = np.int(items[
+0006ecc0: 355d 290a 2020 2020 6963 6e74 203d 206e  5]).    icnt = n
+0006ecd0: 702e 696e 7428 6974 656d 735b 365d 290a  p.int(items[6]).
+0006ece0: 2020 2020 6162 6e20 3d20 6e70 2e66 6c6f      abn = np.flo
+0006ecf0: 6174 3332 2869 7465 6d73 5b37 5d5b 343a  at32(items[7][4:
+0006ed00: 5d29 0a20 2020 2074 706d 203d 206e 702e  ]).    tpm = np.
+0006ed10: 666c 6f61 7433 3228 6974 656d 735b 385d  float32(items[8]
+0006ed20: 5b34 3a5d 290a 2020 2020 6973 6f5f 6672  [4:]).    iso_fr
+0006ed30: 6163 203d 206e 702e 666c 6f61 7433 3228  ac = np.float32(
+0006ed40: 6974 656d 735b 395d 5b36 3a5d 290a 2020  items[9][6:]).  
+0006ed50: 2020 7072 6f62 203d 206e 702e 666c 6f61    prob = np.floa
+0006ed60: 7433 3228 6974 656d 735b 3130 5d5b 323a  t32(items[10][2:
+0006ed70: 5d29 0a20 2020 206e 6578 6f6e 7320 3d20  ]).    nexons = 
+0006ed80: 6e70 2e69 6e74 2869 7465 6d73 5b31 315d  np.int(items[11]
+0006ed90: 5b33 3a5d 290a 2020 2020 766f 6c20 3d20  [3:]).    vol = 
+0006eda0: 6e70 2e69 6e74 2869 7465 6d73 5b31 325d  np.int(items[12]
+0006edb0: 5b32 3a5d 290a 2020 2020 2020 2020 2020  [2:]).          
+0006edc0: 2020 2020 2020 0a20 2020 2074 7220 3d20        .    tr = 
+0006edd0: 5472 616e 7363 7269 7074 2870 7265 6669  Transcript(prefi
+0006ede0: 782c 2067 6964 782c 2067 7270 5f73 697a  x, gidx, grp_siz
+0006edf0: 652c 2069 636e 742c 2063 6872 2c20 7374  e, icnt, chr, st
+0006ee00: 6172 742c 2065 6e64 2c20 7374 7261 6e64  art, end, strand
+0006ee10: 2c20 6364 6e67 2c20 7365 712c 2061 626e  , cdng, seq, abn
+0006ee20: 2c20 7470 6d2c 2069 736f 5f66 7261 632c  , tpm, iso_frac,
+0006ee30: 2070 726f 622c 206e 6578 6f6e 732c 2076   prob, nexons, v
+0006ee40: 6f6c 290a 2020 2020 2020 2020 0a20 2020  ol).        .   
+0006ee50: 2072 6574 7572 6e28 7472 290a 2020 2020   return(tr).    
+0006ee60: 0a64 6566 206c 6f61 645f 7472 616e 7363  .def load_transc
+0006ee70: 7269 7074 7328 6669 6c65 5f6e 616d 652c  ripts(file_name,
+0006ee80: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
+0006ee90: 3a0a 2020 2020 0a20 2020 2069 6620 7665  :.    .    if ve
+0006eea0: 7262 6f73 6520 3d3d 2054 7275 6520 3a20  rbose == True : 
+0006eeb0: 7072 696e 7428 274c 6f61 6469 6e67 2025  print('Loading %
+0006eec0: 7320 2e2e 2e20 2720 2520 6669 6c65 5f6e  s ... ' % file_n
+0006eed0: 616d 652c 2065 6e64 3d27 2720 290a 2020  ame, end='' ).  
+0006eee0: 2020 6620 3d20 6f70 656e 2866 696c 655f    f = open(file_
+0006eef0: 6e61 6d65 2c20 2772 2729 0a20 2020 2063  name, 'r').    c
+0006ef00: 6e74 203d 2030 0a20 2020 2074 7273 203d  nt = 0.    trs =
+0006ef10: 205b 5d0a 2020 2020 666f 7220 6c69 6e65   [].    for line
+0006ef20: 2069 6e20 6620 3a0a 2020 2020 2020 2020   in f :.        
+0006ef30: 6966 206c 696e 655b 305d 203d 3d20 273e  if line[0] == '>
+0006ef40: 273a 0a20 2020 2020 2020 2020 2020 2069  ':.            i
+0006ef50: 6620 636e 7420 3e20 303a 200a 2020 2020  f cnt > 0: .    
+0006ef60: 2020 2020 2020 2020 2020 2020 7472 203d              tr =
+0006ef70: 2063 6f6e 7665 7274 5f69 6e74 6f5f 7472   convert_into_tr
+0006ef80: 2868 6561 6465 722c 2073 6571 5f6c 7374  (header, seq_lst
+0006ef90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0006efa0: 2020 7472 732e 6170 7065 6e64 2874 7229    trs.append(tr)
+0006efb0: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
+0006efc0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0006efd0: 2020 6865 6164 6572 203d 206c 696e 655b    header = line[
+0006efe0: 313a 2d31 5d0a 2020 2020 2020 2020 2020  1:-1].          
+0006eff0: 2020 7365 715f 6c73 7420 3d20 2727 0a20    seq_lst = ''. 
+0006f000: 2020 2020 2020 2065 6c73 6520 3a0a 2020         else :.  
+0006f010: 2020 2020 2020 2020 2020 7365 715f 6c73            seq_ls
+0006f020: 7420 3d20 7365 715f 6c73 7420 2b20 6c69  t = seq_lst + li
+0006f030: 6e65 5b3a 2d31 5d0a 0a20 2020 2074 7220  ne[:-1]..    tr 
+0006f040: 3d20 636f 6e76 6572 745f 696e 746f 5f74  = convert_into_t
+0006f050: 7228 6865 6164 6572 2c20 7365 715f 6c73  r(header, seq_ls
+0006f060: 7429 0a20 2020 2074 7273 2e61 7070 656e  t).    trs.appen
+0006f070: 6428 7472 290a 0a20 2020 2066 2e63 6c6f  d(tr)..    f.clo
+0006f080: 7365 2829 0a20 2020 200a 2020 2020 6966  se().    .    if
+0006f090: 2076 6572 626f 7365 203d 3d20 5472 7565   verbose == True
+0006f0a0: 203a 2070 7269 6e74 2827 4e75 6d2e 5472   : print('Num.Tr
+0006f0b0: 7320 3d20 272c 2063 6e74 2c20 2720 6c6f  s = ', cnt, ' lo
+0006f0c0: 6164 6564 2020 2020 2020 2020 2020 2020  aded            
+0006f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f0e0: 2027 290a 2020 2020 0a20 2020 2072 6574   ').    .    ret
+0006f0f0: 7572 6e28 7472 7329 0a0a 0a52 6566 5f54  urn(trs)...Ref_T
+0006f100: 7220 3d20 636f 6c6c 6563 7469 6f6e 732e  r = collections.
+0006f110: 6e61 6d65 6474 7570 6c65 2827 5265 665f  namedtuple('Ref_
+0006f120: 5472 272c 2027 6e61 6d65 2c20 6376 675f  Tr', 'name, cvg_
+0006f130: 6672 6163 2c20 6162 6e2c 2072 706b 6d2c  frac, abn, rpkm,
+0006f140: 2074 706d 2c20 7365 7127 290a 0a64 6566   tpm, seq')..def
+0006f150: 206c 6f61 645f 7265 665f 7472 5f73 696d   load_ref_tr_sim
+0006f160: 2866 696c 655f 6e61 6d65 2c20 7665 7262  (file_name, verb
+0006f170: 6f73 6520 3d20 5472 7565 293a 0a20 2020  ose = True):.   
+0006f180: 200a 2020 2020 6966 2076 6572 626f 7365   .    if verbose
+0006f190: 203d 3d20 5472 7565 203a 2070 7269 6e74   == True : print
+0006f1a0: 2827 4c6f 6164 696e 6720 2573 202e 2e2e  ('Loading %s ...
+0006f1b0: 2027 2025 2066 696c 655f 6e61 6d65 2c20   ' % file_name, 
+0006f1c0: 656e 643d 2727 2029 0a20 2020 2066 203d  end='' ).    f =
+0006f1d0: 206f 7065 6e28 6669 6c65 5f6e 616d 652c   open(file_name,
+0006f1e0: 2027 7227 290a 2020 2020 636e 7420 3d20   'r').    cnt = 
+0006f1f0: 300a 2020 2020 7265 665f 7472 203d 205b  0.    ref_tr = [
+0006f200: 5d0a 2020 2020 666f 7220 6c69 6e65 2069  ].    for line i
+0006f210: 6e20 6620 3a0a 2020 2020 2020 2020 6966  n f :.        if
+0006f220: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
+0006f230: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0006f240: 636e 7420 3e20 303a 200a 2020 2020 2020  cnt > 0: .      
+0006f250: 2020 2020 2020 2020 2020 7472 203d 2052            tr = R
+0006f260: 6566 5f54 7228 6974 656d 735b 305d 2c20  ef_Tr(items[0], 
+0006f270: 6e70 2e66 6c6f 6174 3332 2869 7465 6d73  np.float32(items
+0006f280: 5b31 5d29 2a31 3030 2c20 6e70 2e66 6c6f  [1])*100, np.flo
+0006f290: 6174 3332 2869 7465 6d73 5b32 5d29 2c20  at32(items[2]), 
+0006f2a0: 6e70 2e66 6c6f 6174 3332 2869 7465 6d73  np.float32(items
+0006f2b0: 5b33 5d29 2c20 302c 2073 6571 5f6c 7374  [3]), 0, seq_lst
+0006f2c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0006f2d0: 2020 7265 665f 7472 2e61 7070 656e 6428    ref_tr.append(
+0006f2e0: 7472 290a 2020 2020 2020 2020 2020 2020  tr).            
+0006f2f0: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
+0006f300: 2020 2020 2068 6561 6465 7220 3d20 6c69       header = li
+0006f310: 6e65 5b31 3a2d 315d 0a20 2020 2020 2020  ne[1:-1].       
+0006f320: 2020 2020 2069 7465 6d73 203d 2068 6561       items = hea
+0006f330: 6465 722e 7370 6c69 7428 273a 2729 0a20  der.split(':'). 
+0006f340: 2020 2020 2020 2020 2020 2073 6571 5f6c             seq_l
+0006f350: 7374 203d 2027 270a 2020 2020 2020 2020  st = ''.        
+0006f360: 656c 7365 203a 0a20 2020 2020 2020 2020  else :.         
+0006f370: 2020 2073 6571 5f6c 7374 203d 2073 6571     seq_lst = seq
+0006f380: 5f6c 7374 202b 206c 696e 655b 3a2d 315d  _lst + line[:-1]
+0006f390: 0a0a 2020 2020 7472 203d 2052 6566 5f54  ..    tr = Ref_T
+0006f3a0: 7228 6974 656d 735b 305d 2c20 6e70 2e66  r(items[0], np.f
+0006f3b0: 6c6f 6174 3332 2869 7465 6d73 5b31 5d29  loat32(items[1])
+0006f3c0: 2a31 3030 2c20 6e70 2e66 6c6f 6174 3332  *100, np.float32
+0006f3d0: 2869 7465 6d73 5b32 5d29 2c20 6e70 2e66  (items[2]), np.f
+0006f3e0: 6c6f 6174 3332 2869 7465 6d73 5b33 5d29  loat32(items[3])
+0006f3f0: 2c20 302c 2073 6571 5f6c 7374 290a 2020  , 0, seq_lst).  
+0006f400: 2020 7265 665f 7472 2e61 7070 656e 6428    ref_tr.append(
+0006f410: 7472 290a 0a20 2020 2066 2e63 6c6f 7365  tr)..    f.close
+0006f420: 2829 0a20 2020 200a 2020 2020 7265 665f  ().    .    ref_
+0006f430: 7472 3220 3d20 5b5d 0a20 2020 2061 626e  tr2 = [].    abn
+0006f440: 5f74 6f74 616c 203d 2030 0a20 2020 2066  _total = 0.    f
+0006f450: 6f72 2074 7220 696e 2072 6566 5f74 723a  or tr in ref_tr:
+0006f460: 0a20 2020 2020 2020 2061 626e 5f74 6f74  .        abn_tot
+0006f470: 616c 202b 3d20 7472 2e61 626e 0a20 2020  al += tr.abn.   
+0006f480: 206e 6620 3d20 3130 3030 3030 302f 6162   nf = 1000000/ab
+0006f490: 6e5f 746f 7461 6c0a 2020 2020 0a20 2020  n_total.    .   
+0006f4a0: 2066 6f72 2074 2069 6e20 7265 665f 7472   for t in ref_tr
+0006f4b0: 3a0a 2020 2020 2020 2020 7472 203d 2052  :.        tr = R
+0006f4c0: 6566 5f54 7228 742e 6e61 6d65 2c20 742e  ef_Tr(t.name, t.
+0006f4d0: 6376 675f 6672 6163 2c20 742e 6162 6e2c  cvg_frac, t.abn,
+0006f4e0: 2074 2e72 706b 6d2c 2074 2e61 626e 2a6e   t.rpkm, t.abn*n
+0006f4f0: 662c 2074 2e73 6571 2029 0a20 2020 2020  f, t.seq ).     
+0006f500: 2020 2072 6566 5f74 7232 2e61 7070 656e     ref_tr2.appen
+0006f510: 6428 7472 290a 2020 2020 0a20 2020 2069  d(tr).    .    i
+0006f520: 6620 7665 7262 6f73 6520 3d3d 2054 7275  f verbose == Tru
+0006f530: 6520 3a20 7072 696e 7428 274e 756d 2e54  e : print('Num.T
+0006f540: 7273 203d 2027 2c20 636e 742c 2027 206c  rs = ', cnt, ' l
+0006f550: 6f61 6465 6420 2020 2020 2020 2020 2020  oaded           
+0006f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f570: 2020 2729 0a20 2020 200a 2020 2020 7265    ').    .    re
+0006f580: 7475 726e 2872 6566 5f74 7229 0a0a 0a23  turn(ref_tr)...#
+0006f590: 2320 5472 616e 7363 7269 7074 203d 2063  # Transcript = c
+0006f5a0: 6f6c 6c65 6374 696f 6e73 2e6e 616d 6564  ollections.named
+0006f5b0: 7475 706c 6528 2754 7261 6e73 6372 6970  tuple('Transcrip
+0006f5c0: 7427 2c20 2770 7265 6669 782c 2069 636e  t', 'prefix, icn
+0006f5d0: 742c 2063 6872 2c20 7374 6172 742c 2065  t, chr, start, e
+0006f5e0: 6e64 2c20 7365 712c 2061 626e 2c20 7470  nd, seq, abn, tp
+0006f5f0: 6d27 2920 2020 200a 6465 6620 7072 696e  m')    .def prin
+0006f600: 745f 7472 2874 725f 6c73 7429 3a0a 2020  t_tr(tr_lst):.  
+0006f610: 2020 666f 7220 7472 2069 6e20 7472 5f6c    for tr in tr_l
+0006f620: 7374 3a0a 2020 2020 2020 2020 7072 696e  st:.        prin
+0006f630: 7428 2725 692c 204c 656e 3a20 2569 2c20  t('%i, Len: %i, 
+0006f640: 4162 6e3a 2025 342e 3166 2720 2520 2874  Abn: %4.1f' % (t
+0006f650: 722e 6963 6e74 2c20 6c65 6e28 7472 2e73  r.icnt, len(tr.s
+0006f660: 6571 292c 2074 722e 6162 6e29 2029 0a20  eq), tr.abn) ). 
+0006f670: 2020 2070 7269 6e74 2827 2020 2729 0a0a     print('  ')..
+0006f680: 2020 2020 0a64 6566 2063 6865 636b 5f72      .def check_r
+0006f690: 735f 6d28 7273 5f6d 2c20 6864 7220 3d20  s_m(rs_m, hdr = 
+0006f6a0: 2727 2029 3a0a 2020 2020 636e 7420 3d20  '' ):.    cnt = 
+0006f6b0: 300a 2020 2020 666f 7220 6b20 696e 2072  0.    for k in r
+0006f6c0: 616e 6765 286c 656e 2872 735f 6d2e 7267  ange(len(rs_m.rg
+0006f6d0: 6e73 2929 3a0a 2020 2020 2020 2020 6c31  ns)):.        l1
+0006f6e0: 203d 2028 7273 5f6d 2e72 676e 735b 6b5d   = (rs_m.rgns[k]
+0006f6f0: 2e65 6e64 2d72 735f 6d2e 7267 6e73 5b6b  .end-rs_m.rgns[k
+0006f700: 5d2e 7374 6172 742b 3129 0a20 2020 2020  ].start+1).     
+0006f710: 2020 206c 3220 3d20 7273 5f6d 2e72 676e     l2 = rs_m.rgn
+0006f720: 735b 6b5d 2e63 6d61 742e 7368 6170 655b  s[k].cmat.shape[
+0006f730: 315d 0a20 2020 2020 2020 2069 6620 6c31  1].        if l1
+0006f740: 2021 3d20 6c32 3a0a 2020 2020 2020 2020   != l2:.        
+0006f750: 2020 2020 6966 2063 6e74 203d 3d20 303a      if cnt == 0:
+0006f760: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0006f770: 2020 7072 696e 7428 275c 6e27 2c65 6e64    print('\n',end
+0006f780: 3d27 2729 0a20 2020 2020 2020 2020 2020  ='').           
+0006f790: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
+0006f7a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0006f7b0: 2745 5252 4f52 2069 6e20 6368 6563 6b5f  'ERROR in check_
+0006f7c0: 7273 5f6d 2829 2061 7420 2573 3a20 2569  rs_m() at %s: %i
+0006f7d0: 2072 676e 7320 6f62 6a20 6973 206e 6f74   rgns obj is not
+0006f7e0: 2063 6f6e 7369 7374 656e 742e 2025 6920   consistent. %i 
+0006f7f0: 213d 2025 6927 2025 2028 6864 722c 6b2c  != %i' % (hdr,k,
+0006f800: 206c 312c 206c 3220 2920 290a 0a0a 6465   l1, l2 ) )...de
+0006f810: 6620 7361 7665 5f72 676e 7328 2066 6e61  f save_rgns( fna
+0006f820: 6d65 2c20 7267 6e73 5f6c 7374 2c20 7264  me, rgns_lst, rd
+0006f830: 5f6c 656e 2c20 6e75 6d5f 7264 732c 2068  _len, num_rds, h
+0006f840: 6f20 3d20 4661 6c73 6520 293a 0a20 2020  o = False ):.   
+0006f850: 200a 2020 2020 6620 3d20 6f70 656e 2866   .    f = open(f
+0006f860: 6e61 6d65 2c27 772b 2729 0a20 2020 200a  name,'w+').    .
+0006f870: 2020 2020 6c69 6e65 203d 2027 4046 5241      line = '@FRA
+0006f880: 475f 4c45 4e3d 2569 2c4e 554d 5f52 4541  G_LEN=%i,NUM_REA
+0006f890: 4453 3d25 695c 6e27 2025 2028 7264 5f6c  DS=%i\n' % (rd_l
+0006f8a0: 656e 2c20 6e75 6d5f 7264 7329 0a20 2020  en, num_rds).   
+0006f8b0: 2066 2e77 7269 7465 6c69 6e65 7328 6c69   f.writelines(li
+0006f8c0: 6e65 290a 2020 2020 0a20 2020 2066 6f72  ne).    .    for
+0006f8d0: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
+0006f8e0: 7267 6e73 5f6c 7374 2929 3a0a 2020 2020  rgns_lst)):.    
+0006f8f0: 2020 2020 7267 6e73 5f6c 7374 5b6b 5d2e      rgns_lst[k].
+0006f900: 6f72 6465 7228 290a 2020 2020 2020 2020  order().        
+0006f910: 6966 2068 6f3a 0a20 2020 2020 2020 2020  if ho:.         
+0006f920: 2020 206c 696e 6573 203d 2072 676e 735f     lines = rgns_
+0006f930: 6c73 745b 6b5d 2e63 6f6e 7665 7274 5f74  lst[k].convert_t
+0006f940: 6f5f 7465 7874 5f6c 696e 6573 5f68 6f28  o_text_lines_ho(
+0006f950: 6b29 0a20 2020 2020 2020 2020 2020 2066  k).            f
+0006f960: 2e77 7269 7465 6c69 6e65 7328 6c69 6e65  .writelines(line
+0006f970: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
+0006f980: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
+0006f990: 6573 203d 2072 676e 735f 6c73 745b 6b5d  es = rgns_lst[k]
+0006f9a0: 2e63 6f6e 7665 7274 5f74 6f5f 7465 7874  .convert_to_text
+0006f9b0: 5f6c 696e 6573 286b 290a 2020 2020 2020  _lines(k).      
+0006f9c0: 2020 2020 2020 662e 7772 6974 656c 696e        f.writelin
+0006f9d0: 6573 286c 696e 6573 290a 2020 2020 662e  es(lines).    f.
+0006f9e0: 636c 6f73 6528 290a 0a20 2020 200a 6465  close()..    .de
+0006f9f0: 6620 6765 745f 6964 5f66 726f 6d5f 6864  f get_id_from_hd
+0006fa00: 7228 6864 7229 3a0a 0a20 2020 2069 7465  r(hdr):..    ite
+0006fa10: 6d73 203d 2068 6472 2e73 706c 6974 2829  ms = hdr.split()
+0006fa20: 0a20 2020 2073 6e20 3d20 696e 7428 6974  .    sn = int(it
+0006fa30: 656d 735b 305d 290a 2020 2020 4e20 3d20  ems[0]).    N = 
+0006fa40: 696e 7428 6974 656d 735b 315d 290a 2020  int(items[1]).  
+0006fa50: 2020 6e20 3d20 696e 7428 6974 656d 735b    n = int(items[
+0006fa60: 325d 290a 2020 2020 7265 7475 726e 2873  2]).    return(s
+0006fa70: 6e2c 4e2c 6e29 0a20 2020 200a 6465 6620  n,N,n).    .def 
+0006fa80: 6c6f 6164 5f72 676e 7328 2066 6e61 6d65  load_rgns( fname
+0006fa90: 2c20 6d6f 6465 2c20 6e5f 7267 6e73 203d  , mode, n_rgns =
+0006faa0: 2030 2c20 7665 7262 6f73 6520 3d20 4661   0, verbose = Fa
+0006fab0: 6c73 6520 293a 0a20 2020 200a 2020 2020  lse ):.    .    
+0006fac0: 7267 6e73 5f6c 7374 203d 205b 5d0a 2020  rgns_lst = [].  
+0006fad0: 2020 6620 3d20 6f70 656e 2866 6e61 6d65    f = open(fname
+0006fae0: 2c27 7227 290a 2020 2020 6c69 6e65 5f6c  ,'r').    line_l
+0006faf0: 7374 203d 2066 2e72 6561 646c 696e 6573  st = f.readlines
+0006fb00: 2829 0a20 2020 2066 2e63 6c6f 7365 2829  ().    f.close()
+0006fb10: 0a20 2020 200a 2020 2020 6966 206d 6f64  .    .    if mod
+0006fb20: 6520 3d3d 2030 3a20 4c63 6e74 203d 2037  e == 0: Lcnt = 7
+0006fb30: 0a20 2020 2065 6c73 653a 204c 636e 7420  .    else: Lcnt 
+0006fb40: 3d20 320a 2020 2020 2020 2020 0a20 2020  = 2.        .   
+0006fb50: 2072 645f 6c65 6e20 3d20 300a 2020 2020   rd_len = 0.    
+0006fb60: 6e75 6d5f 7264 7320 3d20 300a 2020 2020  num_rds = 0.    
+0006fb70: 7263 6e74 203d 2030 0a20 2020 206c 636e  rcnt = 0.    lcn
+0006fb80: 7420 3d20 300a 2020 2020 7364 6976 203d  t = 0.    sdiv =
+0006fb90: 2031 300a 2020 2020 7374 6570 203d 206e   10.    step = n
+0006fba0: 702e 6365 696c 286c 656e 286c 696e 655f  p.ceil(len(line_
+0006fbb0: 6c73 7429 2f28 7364 6976 2a4c 636e 7429  lst)/(sdiv*Lcnt)
+0006fbc0: 290a 2020 2020 0a20 2020 2066 6f72 206c  ).    .    for l
+0006fbd0: 696e 6520 696e 206c 696e 655f 6c73 743a  ine in line_lst:
+0006fbe0: 2023 2066 203a 0a20 2020 2020 2020 2023   # f :.        #
+0006fbf0: 2070 7269 6e74 286c 696e 6529 0a20 2020   print(line).   
+0006fc00: 2020 2020 2069 6620 6c65 6e28 6c69 6e65       if len(line
+0006fc10: 2920 3d3d 2030 3a20 6272 6561 6b0a 2020  ) == 0: break.  
+0006fc20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0006fc30: 2020 2020 2020 2020 6966 206c 696e 655b          if line[
+0006fc40: 305d 203d 3d20 2740 273a 0a20 2020 2020  0] == '@':.     
+0006fc50: 2020 2020 2020 2020 2020 206c 696e 655f             line_
+0006fc60: 746d 7020 3d20 6c69 6e65 5b31 3a2d 315d  tmp = line[1:-1]
+0006fc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006fc80: 2069 7465 6d73 203d 206c 696e 655f 746d   items = line_tm
+0006fc90: 702e 7370 6c69 7428 272c 2729 0a20 2020  p.split(',').   
+0006fca0: 2020 2020 2020 2020 2020 2020 2072 645f               rd_
+0006fcb0: 6c65 6e20 3d20 696e 7428 6974 656d 735b  len = int(items[
+0006fcc0: 305d 5b39 3a5d 290a 2020 2020 2020 2020  0][9:]).        
+0006fcd0: 2020 2020 2020 2020 6e75 6d5f 7264 7320          num_rds 
+0006fce0: 3d20 696e 7428 6974 656d 735b 315d 5b31  = int(items[1][1
+0006fcf0: 303a 5d29 0a20 2020 2020 2020 2020 2020  0:]).           
+0006fd00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0006fd10: 2020 2020 2020 2069 6620 6c63 6e74 203d         if lcnt =
+0006fd20: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0006fd30: 2020 2020 2020 2020 206c 696e 6573 5f74           lines_t
+0006fd40: 6d70 203d 205b 5d0a 2020 2020 2020 2020  mp = [].        
+0006fd50: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0006fd60: 696e 655b 305d 203d 3d20 273e 273a 0a20  ine[0] == '>':. 
+0006fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006fd80: 2020 2020 2020 206c 696e 6573 5f74 6d70         lines_tmp
+0006fd90: 2e61 7070 656e 6428 6c69 6e65 290a 2020  .append(line).  
+0006fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006fdb0: 2020 2020 2020 6c63 6e74 202b 3d20 310a        lcnt += 1.
+0006fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006fdd0: 2020 2020 2020 2020 736e 2c20 4e2c 206e          sn, N, n
+0006fde0: 203d 2067 6574 5f69 645f 6672 6f6d 5f68   = get_id_from_h
+0006fdf0: 6472 2820 6c69 6e65 5b31 3a2d 315d 2029  dr( line[1:-1] )
+0006fe00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006fe10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
 0006fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006fe30: 2069 6620 6c69 6e65 5b30 5d20 3d3d 2027   if line[0] == '
-0006fe40: 3e27 3a0a 2020 2020 2020 2020 2020 2020  >':.            
-0006fe50: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0006fe60: 735f 746d 702e 6170 7065 6e64 286c 696e  s_tmp.append(lin
-0006fe70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0006fe80: 2020 2020 2020 2020 2020 206c 636e 7420             lcnt 
-0006fe90: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-0006fea0: 2020 2020 2020 2020 2020 2020 2073 6e2c               sn,
-0006feb0: 204e 2c20 6e20 3d20 6765 745f 6964 5f66   N, n = get_id_f
-0006fec0: 726f 6d5f 6864 7228 206c 696e 655b 313a  rom_hdr( line[1:
-0006fed0: 2d31 5d20 290a 2020 2020 2020 2020 2020  -1] ).          
-0006fee0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0006fe30: 2020 2070 7269 6e74 2827 4552 524f 5220     print('ERROR 
+0006fe40: 696e 206c 6f61 645f 7267 6e73 2829 3a20  in load_rgns(): 
+0006fe50: 3027 290a 0a20 2020 2020 2020 2020 2020  0')..           
+0006fe60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0006fe70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0006fe80: 6620 6c63 6e74 254c 636e 7420 3d3d 2030  f lcnt%Lcnt == 0
+0006fe90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0006fea0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
+0006feb0: 655b 305d 203d 3d20 273e 273a 0a20 2020  e[0] == '>':.   
+0006fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006fed0: 2020 2020 2020 2020 206c 696e 6573 5f74           lines_t
+0006fee0: 6d70 2e61 7070 656e 6428 6c69 6e65 290a  mp.append(line).
 0006fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ff00: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
-0006ff10: 5252 4f52 2069 6e20 6c6f 6164 5f72 676e  RROR in load_rgn
-0006ff20: 7328 293a 2030 2729 0a0a 2020 2020 2020  s(): 0')..      
-0006ff30: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0006ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ff50: 2020 2020 6966 206c 636e 7425 4c63 6e74      if lcnt%Lcnt
-0006ff60: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0006ff70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006ff80: 6620 6c69 6e65 5b30 5d20 3d3d 2027 3e27  f line[0] == '>'
-0006ff90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0006ffa0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0006ffb0: 6e65 735f 746d 702e 6170 7065 6e64 286c  nes_tmp.append(l
-0006ffc0: 696e 6529 0a20 2020 2020 2020 2020 2020  ine).           
-0006ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ffe0: 206c 636e 7420 2b3d 2031 0a20 2020 2020   lcnt += 1.     
-0006fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070000: 2020 2020 2020 2073 6e2c 204e 2c20 6e20         sn, N, n 
-00070010: 3d20 6765 745f 6964 5f66 726f 6d5f 6864  = get_id_from_hd
-00070020: 7228 206c 696e 655b 313a 2d31 5d20 290a  r( line[1:-1] ).
-00070030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070040: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00070050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070060: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00070070: 2745 5252 4f52 2069 6e20 6c6f 6164 5f72  'ERROR in load_r
-00070080: 676e 7328 293a 2031 2729 0a0a 2020 2020  gns(): 1')..    
-00070090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000700a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000700b0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-000700c0: 6e65 735f 746d 702e 6170 7065 6e64 286c  nes_tmp.append(l
-000700d0: 696e 6529 0a20 2020 2020 2020 2020 2020  ine).           
-000700e0: 2020 2020 2020 2020 2020 2020 206c 636e               lcn
-000700f0: 7420 2b3d 2031 0a0a 2020 2020 2020 2020  t += 1..        
-00070100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070110: 6966 2028 6c63 6e74 254c 636e 7420 3d3d  if (lcnt%Lcnt ==
-00070120: 2030 2920 2620 284e 3d3d 6e29 3a0a 0a20   0) & (N==n):.. 
-00070130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070140: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
-00070150: 6465 203d 3d20 303a 2072 676e 7320 3d20  de == 0: rgns = 
-00070160: 7265 6769 6f6e 7328 290a 2020 2020 2020  regions().      
-00070170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070180: 2020 2020 2020 656c 7365 3a20 7267 6e73        else: rgns
-00070190: 203d 2072 6567 696f 6e73 5f6e 6428 290a   = regions_nd().
-000701a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000701b0: 2020 2020 2020 2020 2020 2020 2072 676e               rgn
-000701c0: 732e 7365 745f 6672 6f6d 5f74 6578 745f  s.set_from_text_
-000701d0: 6c69 6e65 7328 6c69 6e65 735f 746d 7029  lines(lines_tmp)
-000701e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000701f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00070200: 2028 6e5f 7267 6e73 203e 2030 2920 2620   (n_rgns > 0) & 
-00070210: 2828 736e 2d72 636e 7429 3e30 293a 0a20  ((sn-rcnt)>0):. 
-00070220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070230: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00070240: 6620 6d6f 6465 203d 3d20 303a 0a20 2020  f mode == 0:.   
-00070250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ff00: 2020 2020 2020 2020 2020 2020 6c63 6e74              lcnt
+0006ff10: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0006ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ff30: 2020 736e 2c20 4e2c 206e 203d 2067 6574    sn, N, n = get
+0006ff40: 5f69 645f 6672 6f6d 5f68 6472 2820 6c69  _id_from_hdr( li
+0006ff50: 6e65 5b31 3a2d 315d 2029 0a20 2020 2020  ne[1:-1] ).     
+0006ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ff70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0006ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ff90: 2020 2020 2070 7269 6e74 2827 4552 524f       print('ERRO
+0006ffa0: 5220 696e 206c 6f61 645f 7267 6e73 2829  R in load_rgns()
+0006ffb0: 3a20 3127 290a 0a20 2020 2020 2020 2020  : 1')..         
+0006ffc0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0006ffd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006ffe0: 2020 2020 2020 2020 206c 696e 6573 5f74           lines_t
+0006fff0: 6d70 2e61 7070 656e 6428 6c69 6e65 290a  mp.append(line).
+00070000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070010: 2020 2020 2020 2020 6c63 6e74 202b 3d20          lcnt += 
+00070020: 310a 0a20 2020 2020 2020 2020 2020 2020  1..             
+00070030: 2020 2020 2020 2020 2020 2069 6620 286c             if (l
+00070040: 636e 7425 4c63 6e74 203d 3d20 3029 2026  cnt%Lcnt == 0) &
+00070050: 2028 4e3d 3d6e 293a 0a0a 2020 2020 2020   (N==n):..      
+00070060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070070: 2020 2020 2020 6966 206d 6f64 6520 3d3d        if mode ==
+00070080: 2030 3a20 7267 6e73 203d 2072 6567 696f   0: rgns = regio
+00070090: 6e73 2829 0a20 2020 2020 2020 2020 2020  ns().           
+000700a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000700b0: 2065 6c73 653a 2072 676e 7320 3d20 7265   else: rgns = re
+000700c0: 6769 6f6e 735f 6e64 2829 0a0a 2020 2020  gions_nd()..    
+000700d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000700e0: 2020 2020 2020 2020 7267 6e73 2e73 6574          rgns.set
+000700f0: 5f66 726f 6d5f 7465 7874 5f6c 696e 6573  _from_text_lines
+00070100: 286c 696e 6573 5f74 6d70 290a 0a20 2020  (lines_tmp)..   
+00070110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070120: 2020 2020 2020 2020 2069 6620 286e 5f72           if (n_r
+00070130: 676e 7320 3e20 3029 2026 2028 2873 6e2d  gns > 0) & ((sn-
+00070140: 7263 6e74 293e 3029 3a0a 2020 2020 2020  rcnt)>0):.      
+00070150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070160: 2020 2020 2020 2020 2020 6966 206d 6f64            if mod
+00070170: 6520 3d3d 2030 3a0a 2020 2020 2020 2020  e == 0:.        
+00070180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070190: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000701a0: 6d20 696e 2072 616e 6765 2873 6e2d 7263  m in range(sn-rc
+000701b0: 6e74 293a 2072 676e 735f 6c73 742e 6170  nt): rgns_lst.ap
+000701c0: 7065 6e64 2872 6567 696f 6e73 2829 290a  pend(regions()).
+000701d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000701e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000701f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00070200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070210: 2020 2020 2020 2020 2020 666f 7220 6d20            for m 
+00070220: 696e 2072 616e 6765 2873 6e2d 7263 6e74  in range(sn-rcnt
+00070230: 293a 2072 676e 735f 6c73 742e 6170 7065  ): rgns_lst.appe
+00070240: 6e64 2872 6567 696f 6e73 5f6e 6428 2929  nd(regions_nd())
+00070250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00070260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070270: 2066 6f72 206d 2069 6e20 7261 6e67 6528   for m in range(
-00070280: 736e 2d72 636e 7429 3a20 7267 6e73 5f6c  sn-rcnt): rgns_l
-00070290: 7374 2e61 7070 656e 6428 7265 6769 6f6e  st.append(region
-000702a0: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
-000702b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000702c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000702d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000702e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000702f0: 6f72 206d 2069 6e20 7261 6e67 6528 736e  or m in range(sn
-00070300: 2d72 636e 7429 3a20 7267 6e73 5f6c 7374  -rcnt): rgns_lst
-00070310: 2e61 7070 656e 6428 7265 6769 6f6e 735f  .append(regions_
-00070320: 6e64 2829 290a 2020 2020 2020 2020 2020  nd()).          
+00070270: 2072 636e 7420 2b3d 2028 736e 2d72 636e   rcnt += (sn-rcn
+00070280: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
+00070290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000702a0: 7267 6e73 5f6c 7374 2e61 7070 656e 6428  rgns_lst.append(
+000702b0: 7267 6e73 290a 2020 2020 2020 2020 2020  rgns).          
+000702c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000702d0: 2020 7263 6e74 202b 3d20 310a 2020 2020    rcnt += 1.    
+000702e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000702f0: 2020 2020 2020 2020 6c63 6e74 203d 2030          lcnt = 0
+00070300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070310: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00070320: 7665 7262 6f73 653a 0a20 2020 2020 2020  verbose:.       
 00070330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070340: 2020 2020 2020 7263 6e74 202b 3d20 2873        rcnt += (s
-00070350: 6e2d 7263 6e74 290a 0a20 2020 2020 2020  n-rcnt)..       
-00070360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070370: 2020 2020 2072 676e 735f 6c73 742e 6170       rgns_lst.ap
-00070380: 7065 6e64 2872 676e 7329 0a20 2020 2020  pend(rgns).     
-00070390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000703a0: 2020 2020 2020 2072 636e 7420 2b3d 2031         rcnt += 1
-000703b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000703c0: 2020 2020 2020 2020 2020 2020 206c 636e               lcn
-000703d0: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-000703e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000703f0: 2020 6966 2076 6572 626f 7365 3a0a 2020    if verbose:.  
-00070400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070410: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00070420: 2072 636e 7425 7374 6570 203d 3d20 303a   rcnt%step == 0:
-00070430: 2070 7269 6e74 2827 2e27 2c65 6e64 3d27   print('.',end='
-00070440: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00070450: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00070460: 6966 206e 5f72 676e 7320 3e20 303a 0a20  if n_rgns > 0:. 
-00070470: 2020 2020 2020 2069 6620 7263 6e74 203c         if rcnt <
-00070480: 206e 5f72 676e 733a 0a20 2020 2020 2020   n_rgns:.       
-00070490: 2020 2020 2069 6620 6d6f 6465 203d 3d20       if mode == 
-000704a0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-000704b0: 2020 2066 6f72 206d 2069 6e20 7261 6e67     for m in rang
-000704c0: 6528 6e5f 7267 6e73 2d72 636e 7429 3a20  e(n_rgns-rcnt): 
-000704d0: 7267 6e73 5f6c 7374 2e61 7070 656e 6428  rgns_lst.append(
-000704e0: 7265 6769 6f6e 7328 2929 0a20 2020 2020  regions()).     
-000704f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00070500: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00070510: 206d 2069 6e20 7261 6e67 6528 6e5f 7267   m in range(n_rg
-00070520: 6e73 2d72 636e 7429 3a20 7267 6e73 5f6c  ns-rcnt): rgns_l
-00070530: 7374 2e61 7070 656e 6428 7265 6769 6f6e  st.append(region
-00070540: 735f 6e64 2829 290a 2020 2020 2020 2020  s_nd()).        
-00070550: 2020 2020 7263 6e74 202b 3d20 286e 5f72      rcnt += (n_r
-00070560: 676e 732d 7263 6e74 290a 2020 2020 2020  gns-rcnt).      
-00070570: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-00070580: 6e28 7267 6e73 5f6c 7374 2c20 7263 6e74  n(rgns_lst, rcnt
-00070590: 2c20 7264 5f6c 656e 2c20 6e75 6d5f 7264  , rd_len, num_rd
-000705a0: 7329 0a20 2020 2020 2020 200a 0a64 6566  s).        ..def
-000705b0: 206c 6f61 645f 7267 6e73 5f6e 6428 2066   load_rgns_nd( f
-000705c0: 6e61 6d65 2c20 6d6f 6465 2c20 6e5f 7267  name, mode, n_rg
-000705d0: 6e73 2c20 7665 7262 6f73 6520 3d20 4661  ns, verbose = Fa
-000705e0: 6c73 6520 293a 0a20 2020 200a 2020 2020  lse ):.    .    
-000705f0: 7267 6e73 5f6c 7374 203d 205b 5d0a 2020  rgns_lst = [].  
-00070600: 2020 6620 3d20 6f70 656e 2866 6e61 6d65    f = open(fname
-00070610: 2c27 7227 290a 2020 2020 6c69 6e65 5f6c  ,'r').    line_l
-00070620: 7374 203d 2066 2e72 6561 646c 696e 6573  st = f.readlines
-00070630: 2829 0a20 2020 2066 2e63 6c6f 7365 2829  ().    f.close()
-00070640: 0a20 2020 200a 2020 2020 7264 5f6c 656e  .    .    rd_len
-00070650: 203d 2030 0a20 2020 206e 756d 5f72 6473   = 0.    num_rds
-00070660: 203d 2030 0a20 2020 2072 636e 7420 3d20   = 0.    rcnt = 
-00070670: 300a 2020 2020 6c63 6e74 203d 2030 0a20  0.    lcnt = 0. 
-00070680: 2020 2073 6469 7620 3d20 3130 0a20 2020     sdiv = 10.   
-00070690: 2073 7465 7020 3d20 6e70 2e63 6569 6c28   step = np.ceil(
-000706a0: 6c65 6e28 6c69 6e65 5f6c 7374 292f 2873  len(line_lst)/(s
-000706b0: 6469 7629 290a 2020 2020 0a20 2020 2066  div)).    .    f
-000706c0: 6f72 206c 696e 6520 696e 206c 696e 655f  or line in line_
-000706d0: 6c73 743a 2023 2066 203a 0a20 2020 2020  lst: # f :.     
-000706e0: 2020 2023 2070 7269 6e74 286c 696e 6529     # print(line)
-000706f0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00070700: 6c69 6e65 2920 3d3d 2030 3a20 6272 6561  line) == 0: brea
-00070710: 6b0a 2020 2020 2020 2020 656c 7365 3a0a  k.        else:.
-00070720: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00070730: 696e 655b 305d 203d 3d20 2740 273a 0a20  ine[0] == '@':. 
-00070740: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00070750: 696e 655f 746d 7020 3d20 6c69 6e65 5b31  ine_tmp = line[1
-00070760: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
-00070770: 2020 2020 2069 7465 6d73 203d 206c 696e       items = lin
-00070780: 655f 746d 702e 7370 6c69 7428 272c 2729  e_tmp.split(',')
-00070790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000707a0: 2072 645f 6c65 6e20 3d20 696e 7428 6974   rd_len = int(it
-000707b0: 656d 735b 305d 5b39 3a5d 290a 2020 2020  ems[0][9:]).    
-000707c0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
-000707d0: 7264 7320 3d20 696e 7428 6974 656d 735b  rds = int(items[
-000707e0: 315d 5b31 303a 5d29 0a20 2020 2020 2020  1][10:]).       
-000707f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00070800: 2020 2020 2020 2020 2020 2069 6620 6c63             if lc
-00070810: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
-00070820: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-00070830: 6573 5f74 6d70 203d 205b 5d0a 0a20 2020  es_tmp = []..   
-00070840: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-00070850: 6573 5f74 6d70 2e61 7070 656e 6428 6c69  es_tmp.append(li
-00070860: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-00070870: 2020 2020 6c63 6e74 202b 3d20 310a 0a20      lcnt += 1.. 
-00070880: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00070890: 6e2c 204e 2c20 6e20 3d20 6765 745f 6964  n, N, n = get_id
-000708a0: 5f66 726f 6d5f 6864 7228 206c 696e 655b  _from_hdr( line[
-000708b0: 313a 2d31 5d20 290a 0a20 2020 2020 2020  1:-1] )..       
-000708c0: 2020 2020 2020 2020 2069 6620 284e 3d3d           if (N==
-000708d0: 6e29 3a0a 0a20 2020 2020 2020 2020 2020  n):..           
-000708e0: 2020 2020 2020 2020 2072 676e 7320 3d20           rgns = 
-000708f0: 7265 6769 6f6e 735f 6e64 2829 0a20 2020  regions_nd().   
-00070900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070910: 2072 676e 732e 7365 745f 6672 6f6d 5f74   rgns.set_from_t
-00070920: 6578 745f 6c69 6e65 7328 6c69 6e65 735f  ext_lines(lines_
-00070930: 746d 7029 0a0a 2020 2020 2020 2020 2020  tmp)..          
-00070940: 2020 2020 2020 2020 2020 6966 2028 6e5f            if (n_
-00070950: 7267 6e73 203e 2030 2920 2620 2828 736e  rgns > 0) & ((sn
-00070960: 2d72 636e 7429 3e30 293a 0a20 2020 2020  -rcnt)>0):.     
-00070970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070980: 2020 2066 6f72 206d 2069 6e20 7261 6e67     for m in rang
-00070990: 6528 736e 2d72 636e 7429 3a20 7267 6e73  e(sn-rcnt): rgns
-000709a0: 5f6c 7374 2e61 7070 656e 6428 7265 6769  _lst.append(regi
-000709b0: 6f6e 735f 6e64 2829 290a 2020 2020 2020  ons_nd()).      
-000709c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000709d0: 2020 7263 6e74 202b 3d20 2873 6e2d 7263    rcnt += (sn-rc
-000709e0: 6e74 290a 0a20 2020 2020 2020 2020 2020  nt)..           
-000709f0: 2020 2020 2020 2020 2072 676e 735f 6c73           rgns_ls
-00070a00: 742e 6170 7065 6e64 2872 676e 7329 0a20  t.append(rgns). 
-00070a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070a20: 2020 2072 636e 7420 2b3d 2031 0a20 2020     rcnt += 1.   
-00070a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070a40: 206c 636e 7420 3d20 300a 2020 2020 2020   lcnt = 0.      
-00070a50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00070a60: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
-00070a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070a80: 2020 6966 2072 636e 7425 7374 6570 203d    if rcnt%step =
-00070a90: 3d20 303a 2070 7269 6e74 2827 2e27 2c65  = 0: print('.',e
-00070aa0: 6e64 3d27 2729 0a20 2020 2020 2020 2020  nd='').         
-00070ab0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00070ac0: 2020 2020 6966 206e 5f72 676e 7320 3e20      if n_rgns > 
-00070ad0: 303a 0a20 2020 2020 2020 2069 6620 7263  0:.        if rc
-00070ae0: 6e74 203c 206e 5f72 676e 733a 0a20 2020  nt < n_rgns:.   
-00070af0: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
-00070b00: 6e20 7261 6e67 6528 6e5f 7267 6e73 2d72  n range(n_rgns-r
-00070b10: 636e 7429 3a20 7267 6e73 5f6c 7374 2e61  cnt): rgns_lst.a
-00070b20: 7070 656e 6428 7265 6769 6f6e 735f 6e64  ppend(regions_nd
-00070b30: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-00070b40: 7263 6e74 202b 3d20 286e 5f72 676e 732d  rcnt += (n_rgns-
-00070b50: 7263 6e74 290a 2020 2020 2020 2020 2020  rcnt).          
-00070b60: 2020 0a20 2020 2072 6574 7572 6e28 7267    .    return(rg
-00070b70: 6e73 5f6c 7374 2c20 7263 6e74 2c20 7264  ns_lst, rcnt, rd
-00070b80: 5f6c 656e 2c20 6e75 6d5f 7264 7329 0a20  _len, num_rds). 
-00070b90: 2020 2020 2020 200a 0a64 6566 2074 7269         ..def tri
-00070ba0: 6d5f 636f 6e74 6967 7328 2072 676e 735f  m_contigs( rgns_
-00070bb0: 6c73 745f 6d2c 2072 676e 735f 6c73 745f  lst_m, rgns_lst_
-00070bc0: 6e64 2c20 7267 6e73 5f6c 7374 5f73 7469  nd, rgns_lst_sti
-00070bd0: 2c20 7665 7262 6f73 6520 3d20 312c 2073  , verbose = 1, s
-00070be0: 6469 7620 3d20 3130 2029 3a0a 0a20 2020  div = 10 ):..   
-00070bf0: 2073 7461 7274 5f74 696d 6520 3d20 7469   start_time = ti
-00070c00: 6d65 2e74 696d 6528 290a 2020 2020 636e  me.time().    cn
-00070c10: 7470 203d 2030 3b20 636e 746e 203d 2030  tp = 0; cntn = 0
-00070c20: 3b20 636e 7430 203d 2030 3b20 636e 7466  ; cnt0 = 0; cntf
-00070c30: 203d 2030 3b20 636e 7467 203d 2030 0a20   = 0; cntg = 0. 
-00070c40: 2020 2066 7020 3d20 303b 2066 6e20 3d20     fp = 0; fn = 
-00070c50: 303b 2066 3020 3d20 303b 2066 6620 3d20  0; f0 = 0; ff = 
-00070c60: 300a 0a20 2020 2070 6f73 203d 206e 702e  0..    pos = np.
-00070c70: 7a65 726f 7328 6c65 6e28 7267 6e73 5f6c  zeros(len(rgns_l
-00070c80: 7374 5f6d 2929 0a20 2020 2066 6f72 206b  st_m)).    for k
-00070c90: 2069 6e20 7261 6e67 6528 6c65 6e28 7267   in range(len(rg
-00070ca0: 6e73 5f6c 7374 5f6d 2929 3a0a 2020 2020  ns_lst_m)):.    
-00070cb0: 2020 2020 7267 6e5f 7420 3d20 7267 6e73      rgn_t = rgns
-00070cc0: 5f6c 7374 5f6d 5b6b 5d2e 6765 745f 7370  _lst_m[k].get_sp
-00070cd0: 616e 2829 0a20 2020 2020 2020 2070 6f73  an().        pos
-00070ce0: 5b6b 5d20 3d20 7267 6e5f 742e 7374 6172  [k] = rgn_t.star
-00070cf0: 740a 0a20 2020 2070 6f73 203d 206e 702e  t..    pos = np.
-00070d00: 6172 7261 7928 706f 7329 0a20 2020 206f  array(pos).    o
-00070d10: 6472 203d 2070 6f73 2e61 7267 736f 7274  dr = pos.argsort
-00070d20: 2829 0a20 2020 206e 5f74 7220 3d20 300a  ().    n_tr = 0.
-00070d30: 2020 2020 5472 5f6c 7374 203d 205b 5d0a      Tr_lst = [].
-00070d40: 2020 2020 4973 5f6c 7374 203d 205b 5d0a      Is_lst = [].
-00070d50: 0a20 2020 2067 636e 7420 3d20 300a 2020  .    gcnt = 0.  
-00070d60: 2020 7273 5f6d 695f 6c73 7420 3d20 5b5d    rs_mi_lst = []
-00070d70: 0a20 2020 2072 735f 6e64 5f6c 7374 203d  .    rs_nd_lst =
-00070d80: 205b 5d0a 2020 2020 666f 7220 6e20 696e   [].    for n in
-00070d90: 2072 616e 6765 286c 656e 2872 676e 735f   range(len(rgns_
-00070da0: 6c73 745f 6d29 293a 0a0a 2020 2020 2020  lst_m)):..      
-00070db0: 2020 6b20 3d20 6f64 725b 6e5d 0a20 2020    k = odr[n].   
-00070dc0: 2020 2020 2072 735f 6d20 3d20 7267 6e73       rs_m = rgns
-00070dd0: 5f6c 7374 5f6d 5b6b 5d0a 2020 2020 2020  _lst_m[k].      
-00070de0: 2020 7273 5f6e 6420 3d20 7267 6e73 5f6c    rs_nd = rgns_l
-00070df0: 7374 5f6e 645b 6b5d 0a20 2020 2020 2020  st_nd[k].       
-00070e00: 2072 735f 7374 6920 3d20 7267 6e73 5f6c   rs_sti = rgns_l
-00070e10: 7374 5f73 7469 5b6b 5d0a 2020 2020 2020  st_sti[k].      
-00070e20: 2020 2020 200a 2020 2020 2020 2020 566f       .        Vo
-00070e30: 6c20 3d20 7273 5f6d 2e67 6574 5f76 6f6c  l = rs_m.get_vol
-00070e40: 756d 6528 2920 2b20 7273 5f73 7469 2e67  ume() + rs_sti.g
-00070e50: 6574 5f76 6f6c 756d 6528 290a 2020 2020  et_volume().    
-00070e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070e70: 0a20 2020 2020 2020 206d 6178 5f64 6576  .        max_dev
-00070e80: 5f6e 203d 204d 4158 5f44 4556 5f4e 0a20  _n = MAX_DEV_N. 
-00070e90: 2020 2020 2020 206d 6178 5f64 6576 5f64         max_dev_d
-00070ea0: 203d 204d 4158 5f44 4556 5f44 0a20 2020   = MAX_DEV_D.   
-00070eb0: 2020 2020 206d 6178 5f64 6576 5f69 203d       max_dev_i =
-00070ec0: 204d 4158 5f44 4556 5f49 0a0a 2020 2020   MAX_DEV_I..    
-00070ed0: 2020 2020 7665 635f 6420 3d20 6368 6563      vec_d = chec
-00070ee0: 6b5f 636f 6d70 6c74 655f 6f76 6572 6c61  k_complte_overla
-00070ef0: 7028 2072 735f 6d2c 2072 735f 6e64 2c20  p( rs_m, rs_nd, 
-00070f00: 2744 2720 290a 2020 2020 2020 2020 7273  'D' ).        rs
-00070f10: 5f6e 642c 2063 6d20 3d20 6d65 7267 655f  _nd, cm = merge_
-00070f20: 6e65 6172 6279 5f6e 6469 2872 735f 6e64  nearby_ndi(rs_nd
-00070f30: 2c20 6d61 785f 6465 765f 6e2c 206d 6178  , max_dev_n, max
-00070f40: 5f64 6576 5f64 2c20 6d61 785f 6465 765f  _dev_d, max_dev_
-00070f50: 692c 2076 6563 5f64 290a 2020 2020 2020  i, vec_d).      
-00070f60: 2020 2320 7273 5f6e 642c 2063 6d20 3d20    # rs_nd, cm = 
-00070f70: 6d65 7267 655f 6e65 6172 6279 5f6e 6469  merge_nearby_ndi
-00070f80: 2872 735f 6e64 2c20 6d61 785f 6465 765f  (rs_nd, max_dev_
-00070f90: 6e2c 206d 6178 5f64 6576 5f64 2c20 6d61  n, max_dev_d, ma
-00070fa0: 785f 6465 765f 6929 0a20 2020 2020 2020  x_dev_i).       
-00070fb0: 2072 735f 7374 692c 2063 6920 3d20 6d65   rs_sti, ci = me
-00070fc0: 7267 655f 6e65 6172 6279 5f6e 6469 2872  rge_nearby_ndi(r
-00070fd0: 735f 7374 692c 206d 6178 5f64 6576 5f6e  s_sti, max_dev_n
-00070fe0: 2c20 6d61 785f 6465 765f 642c 206d 6178  , max_dev_d, max
-00070ff0: 5f64 6576 5f69 290a 0a20 2020 2020 2020  _dev_i)..       
-00071000: 2072 735f 6e64 2c20 7273 5f6d 2c20 6220   rs_nd, rs_m, b 
-00071010: 3d20 7265 6d5f 6e6d 5f32 6c6f 6e67 5f61  = rem_nm_2long_a
-00071020: 6e64 5f32 7468 696e 2820 7273 5f6e 642c  nd_2thin( rs_nd,
-00071030: 2072 735f 6d20 290a 2020 2020 2020 2020   rs_m ).        
-00071040: 2320 7273 5f6d 2c20 7273 5f6e 642c 2072  # rs_m, rs_nd, r
-00071050: 735f 7374 6920 3d20 7265 6d5f 6c6f 775f  s_sti = rem_low_
-00071060: 6376 675f 7267 6e73 2820 7273 5f6d 2c20  cvg_rgns( rs_m, 
-00071070: 7273 5f6e 642c 2072 735f 7374 6920 290a  rs_nd, rs_sti ).
-00071080: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00071090: 2069 6620 6c65 6e28 7273 5f6d 2e72 676e   if len(rs_m.rgn
-000710a0: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
-000710b0: 2020 2020 7273 5f6e 642c 2072 735f 6d2c      rs_nd, rs_m,
-000710c0: 2062 203d 2061 646a 5f6e 6428 2072 735f   b = adj_nd( rs_
-000710d0: 6e64 2c20 7273 5f6d 2029 0a20 2020 2020  nd, rs_m ).     
-000710e0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000710f0: 2020 2020 7273 5f6e 642c 2072 735f 6d2c      rs_nd, rs_m,
-00071100: 2062 203d 2074 7269 6d5f 6d28 2072 735f   b = trim_m( rs_
-00071110: 6e64 2c20 7273 5f6d 2c20 7273 5f73 7469  nd, rs_m, rs_sti
-00071120: 2c20 6d61 785f 6465 765f 6e2c 206d 6178  , max_dev_n, max
-00071130: 5f64 6576 5f64 2029 2020 2020 2020 2020  _dev_d )        
-00071140: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00071150: 2020 2020 7273 5f6e 642c 2072 735f 6d2c      rs_nd, rs_m,
-00071160: 2062 203d 2074 7269 6d5f 6428 2072 735f   b = trim_d( rs_
-00071170: 6e64 2c20 7273 5f6d 2029 2020 2323 206e  nd, rs_m )  ## n
-00071180: 2073 686f 756c 6420 6265 2066 6972 7374   should be first
-00071190: 2c20 7468 656e 2064 0a20 2020 2020 2020  , then d.       
-000711a0: 2020 2020 2072 735f 6e64 2c20 7273 5f6d       rs_nd, rs_m
-000711b0: 2c20 6220 3d20 7370 6c69 745f 6d28 2072  , b = split_m( r
-000711c0: 735f 6e64 2c20 7273 5f6d 2c20 7273 5f73  s_nd, rs_m, rs_s
-000711d0: 7469 2029 2020 2020 2020 2020 2020 200a  ti )           .
-000711e0: 2020 2020 2020 2020 2020 2020 7273 5f6e              rs_n
-000711f0: 642c 2072 735f 6d2c 2062 203d 2074 7269  d, rs_m, b = tri
-00071200: 6d5f 6e5f 7368 6f72 7428 2072 735f 6e64  m_n_short( rs_nd
-00071210: 2c20 7273 5f6d 2029 2020 0a20 2020 2020  , rs_m )  .     
-00071220: 2020 2020 2020 2072 735f 6e64 2c20 7273         rs_nd, rs
-00071230: 5f6d 2c20 6220 3d20 6164 645f 6928 2072  _m, b = add_i( r
-00071240: 735f 6e64 2c20 7273 5f6d 2c20 7273 5f73  s_nd, rs_m, rs_s
-00071250: 7469 2029 0a20 2020 2020 2020 2020 2020  ti ).           
-00071260: 0a20 2020 2020 2020 2020 2020 2072 735f  .            rs_
-00071270: 6d2e 7570 6461 7465 2829 0a20 2020 2020  m.update().     
-00071280: 2020 2020 2020 2072 735f 6d2e 7365 745f         rs_m.set_
-00071290: 6376 6728 290a 2020 2020 2020 2020 2020  cvg().          
-000712a0: 2020 7273 5f6e 642e 7570 6461 7465 2829    rs_nd.update()
-000712b0: 0a20 2020 2020 2020 2020 2020 2072 735f  .            rs_
-000712c0: 6e64 2e73 6574 5f63 7667 2829 0a20 2020  nd.set_cvg().   
-000712d0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-000712e0: 2020 2020 2020 7273 5f6d 695f 6c73 742e        rs_mi_lst.
-000712f0: 6170 7065 6e64 2872 735f 6d29 0a20 2020  append(rs_m).   
-00071300: 2020 2020 2020 2020 2072 735f 6e64 5f6c           rs_nd_l
-00071310: 7374 2e61 7070 656e 6428 7273 5f6e 6429  st.append(rs_nd)
-00071320: 0a20 2020 2020 2020 2020 2020 2020 200a  .              .
-00071330: 2020 2020 7265 7475 726e 2872 735f 6d69      return(rs_mi
-00071340: 5f6c 7374 2c20 7273 5f6e 645f 6c73 7429  _lst, rs_nd_lst)
-00071350: 200a 0a0a 6465 6620 7265 6d5f 6c6f 775f   ...def rem_low_
-00071360: 6376 675f 7267 6e73 2820 7273 5f6d 2c20  cvg_rgns( rs_m, 
-00071370: 7273 5f6e 642c 2072 735f 7374 6920 3d20  rs_nd, rs_sti = 
-00071380: 4e6f 6e65 2029 3a0a 2020 2020 0a20 2020  None ):.    .   
-00071390: 206d 785f 6376 6720 3d20 300a 2020 2020   mx_cvg = 0.    
-000713a0: 666f 7220 7220 696e 2072 735f 6d2e 7267  for r in rs_m.rg
-000713b0: 6e73 3a0a 2020 2020 2020 2020 6d78 5f63  ns:.        mx_c
-000713c0: 7667 203d 206d 6178 2820 6d78 5f63 7667  vg = max( mx_cvg
-000713d0: 2c20 722e 6176 655f 6376 675f 6465 7074  , r.ave_cvg_dept
-000713e0: 6828 2920 290a 2020 2020 666f 7220 7220  h() ).    for r 
-000713f0: 696e 2072 735f 6e64 2e72 676e 733a 0a20  in rs_nd.rgns:. 
-00071400: 2020 2020 2020 206d 785f 6376 6720 3d20         mx_cvg = 
-00071410: 6d61 7828 206d 785f 6376 672c 2072 2e61  max( mx_cvg, r.a
-00071420: 7665 5f63 7667 5f64 6570 7468 2829 2029  ve_cvg_depth() )
-00071430: 0a20 2020 2063 7667 5f74 6820 3d20 6d78  .    cvg_th = mx
-00071440: 5f63 7667 2a52 5f56 414c 4944 5f43 4652  _cvg*R_VALID_CFR
-00071450: 4143 0a20 2020 2020 2020 200a 2020 2020  AC.        .    
-00071460: 746f 5f64 656c 203d 205b 5d0a 2020 2020  to_del = [].    
-00071470: 666f 7220 6b2c 2072 2069 6e20 656e 756d  for k, r in enum
-00071480: 6572 6174 6528 7273 5f6d 2e72 676e 7329  erate(rs_m.rgns)
-00071490: 3a0a 2020 2020 2020 2020 2320 6966 2028  :.        # if (
-000714a0: 722e 6176 655f 6376 675f 6465 7074 6828  r.ave_cvg_depth(
-000714b0: 2920 3c20 6376 675f 7468 293a 2074 6f5f  ) < cvg_th): to_
-000714c0: 6465 6c2e 6170 7065 6e64 286b 290a 2020  del.append(k).  
-000714d0: 2020 2020 2020 6966 2028 722e 6176 655f        if (r.ave_
-000714e0: 6376 675f 6465 7074 6828 2920 3c20 6376  cvg_depth() < cv
-000714f0: 675f 7468 2920 2620 2872 2e61 7665 5f63  g_th) & (r.ave_c
-00071500: 7667 5f64 6570 7468 2829 203c 2052 5f56  vg_depth() < R_V
-00071510: 414c 4944 5f43 5647 293a 2074 6f5f 6465  ALID_CVG): to_de
-00071520: 6c2e 6170 7065 6e64 286b 290a 2020 2020  l.append(k).    
-00071530: 0a20 2020 2069 6620 6c65 6e28 746f 5f64  .    if len(to_d
-00071540: 656c 2920 3e20 303a 0a20 2020 2020 2020  el) > 0:.       
-00071550: 2074 6f5f 6465 6c2e 736f 7274 2872 6576   to_del.sort(rev
-00071560: 6572 7365 3d54 7275 6529 0a20 2020 2020  erse=True).     
-00071570: 2020 2066 6f72 206b 2069 6e20 746f 5f64     for k in to_d
-00071580: 656c 3a20 6465 6c20 7273 5f6d 2e72 676e  el: del rs_m.rgn
-00071590: 735b 6b5d 0a20 2020 2020 2020 200a 2020  s[k].        .  
-000715a0: 2020 746f 5f64 656c 203d 205b 5d0a 2020    to_del = [].  
-000715b0: 2020 666f 7220 6b2c 2072 2069 6e20 656e    for k, r in en
-000715c0: 756d 6572 6174 6528 7273 5f6e 642e 7267  umerate(rs_nd.rg
-000715d0: 6e73 293a 0a20 2020 2020 2020 2069 6620  ns):.        if 
-000715e0: 2872 2e61 7665 5f63 7667 5f64 6570 7468  (r.ave_cvg_depth
-000715f0: 2829 203c 2063 7667 5f74 6829 2026 2028  () < cvg_th) & (
-00071600: 722e 6176 655f 6376 675f 6465 7074 6828  r.ave_cvg_depth(
-00071610: 2920 3c20 525f 5641 4c49 445f 4356 4729  ) < R_VALID_CVG)
-00071620: 3a20 746f 5f64 656c 2e61 7070 656e 6428  : to_del.append(
-00071630: 6b29 0a20 2020 200a 2020 2020 6966 206c  k).    .    if l
-00071640: 656e 2874 6f5f 6465 6c29 203e 2030 3a0a  en(to_del) > 0:.
-00071650: 2020 2020 2020 2020 746f 5f64 656c 2e73          to_del.s
-00071660: 6f72 7428 7265 7665 7273 653d 5472 7565  ort(reverse=True
-00071670: 290a 2020 2020 2020 2020 666f 7220 6b20  ).        for k 
-00071680: 696e 2074 6f5f 6465 6c3a 2064 656c 2072  in to_del: del r
-00071690: 735f 6e64 2e72 676e 735b 6b5d 0a20 2020  s_nd.rgns[k].   
-000716a0: 200a 2020 2020 6966 2072 735f 7374 6920   .    if rs_sti 
-000716b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000716c0: 2072 6574 7572 6e20 7273 5f6d 2c20 7273   return rs_m, rs
-000716d0: 5f6e 6420 2020 2020 2020 200a 2020 2020  _nd        .    
-000716e0: 656c 7365 3a0a 2020 2020 2020 2020 746f  else:.        to
-000716f0: 5f64 656c 203d 205b 5d0a 2020 2020 2020  _del = [].      
-00071700: 2020 666f 7220 6b2c 2072 2069 6e20 656e    for k, r in en
-00071710: 756d 6572 6174 6528 7273 5f73 7469 2e72  umerate(rs_sti.r
-00071720: 676e 7329 3a0a 2020 2020 2020 2020 2020  gns):.          
-00071730: 2020 6966 2028 722e 6176 655f 6376 675f    if (r.ave_cvg_
-00071740: 6465 7074 6828 2920 3c20 6376 675f 7468  depth() < cvg_th
-00071750: 2920 2620 2872 2e61 7665 5f63 7667 5f64  ) & (r.ave_cvg_d
-00071760: 6570 7468 2829 203c 2052 5f56 414c 4944  epth() < R_VALID
-00071770: 5f43 5647 293a 2074 6f5f 6465 6c2e 6170  _CVG): to_del.ap
-00071780: 7065 6e64 286b 290a 0a20 2020 2020 2020  pend(k)..       
-00071790: 2069 6620 6c65 6e28 746f 5f64 656c 2920   if len(to_del) 
-000717a0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-000717b0: 2074 6f5f 6465 6c2e 736f 7274 2872 6576   to_del.sort(rev
-000717c0: 6572 7365 3d54 7275 6529 0a20 2020 2020  erse=True).     
-000717d0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-000717e0: 746f 5f64 656c 3a20 6465 6c20 7273 5f73  to_del: del rs_s
-000717f0: 7469 2e72 676e 735b 6b5d 0a20 2020 200a  ti.rgns[k].    .
-00071800: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00071810: 735f 6d2c 2072 735f 6e64 2c20 7273 5f73  s_m, rs_nd, rs_s
-00071820: 7469 0a0a 6465 6620 7472 696d 5f63 6f6e  ti..def trim_con
-00071830: 7469 6773 5f73 696e 676c 6528 2072 735f  tigs_single( rs_
-00071840: 6d2c 2072 735f 6e64 2c20 7273 5f73 7469  m, rs_nd, rs_sti
-00071850: 2c20 6763 6e74 203d 2030 2c20 7265 6d5f  , gcnt = 0, rem_
-00071860: 6c6f 775f 6376 6720 3d20 5472 7565 2c20  low_cvg = True, 
-00071870: 7665 7262 6f73 6520 3d20 312c 2073 6469  verbose = 1, sdi
-00071880: 7620 3d20 3130 2029 3a0a 0a20 2020 2056  v = 10 ):..    V
-00071890: 6f6c 203d 2072 735f 6d2e 6765 745f 766f  ol = rs_m.get_vo
-000718a0: 6c75 6d65 2829 202b 2072 735f 7374 692e  lume() + rs_sti.
-000718b0: 6765 745f 766f 6c75 6d65 2829 0a0a 2020  get_volume()..  
-000718c0: 2020 6d61 785f 6465 765f 6e20 3d20 4d41    max_dev_n = MA
-000718d0: 585f 4445 565f 4e0a 2020 2020 6d61 785f  X_DEV_N.    max_
-000718e0: 6465 765f 6420 3d20 4d41 585f 4445 565f  dev_d = MAX_DEV_
-000718f0: 440a 2020 2020 6d61 785f 6465 765f 6920  D.    max_dev_i 
-00071900: 3d20 4d41 585f 4445 565f 490a 0a20 2020  = MAX_DEV_I..   
-00071910: 2076 6563 5f64 203d 2063 6865 636b 5f63   vec_d = check_c
-00071920: 6f6d 706c 7465 5f6f 7665 726c 6170 2820  omplte_overlap( 
-00071930: 7273 5f6d 2c20 7273 5f6e 642c 2027 4427  rs_m, rs_nd, 'D'
-00071940: 2029 0a20 2020 2072 735f 6e64 2c20 636d   ).    rs_nd, cm
-00071950: 203d 206d 6572 6765 5f6e 6561 7262 795f   = merge_nearby_
-00071960: 6e64 6928 7273 5f6e 642c 206d 6178 5f64  ndi(rs_nd, max_d
-00071970: 6576 5f6e 2c20 6d61 785f 6465 765f 642c  ev_n, max_dev_d,
-00071980: 206d 6178 5f64 6576 5f69 2c20 7665 635f   max_dev_i, vec_
-00071990: 6429 0a20 2020 2023 2076 6563 5f69 203d  d).    # vec_i =
-000719a0: 2063 6865 636b 5f63 6f6d 706c 7465 5f6f   check_complte_o
-000719b0: 7665 726c 6170 2820 7273 5f6d 2c20 7273  verlap( rs_m, rs
-000719c0: 5f73 7469 2c20 2749 2720 290a 2020 2020  _sti, 'I' ).    
-000719d0: 7273 5f73 7469 2c20 6369 203d 206d 6572  rs_sti, ci = mer
-000719e0: 6765 5f6e 6561 7262 795f 6e64 6928 7273  ge_nearby_ndi(rs
-000719f0: 5f73 7469 2c20 6d61 785f 6465 765f 6e2c  _sti, max_dev_n,
-00071a00: 206d 6178 5f64 6576 5f64 2c20 6d61 785f   max_dev_d, max_
-00071a10: 6465 765f 6929 0a0a 2020 2020 6966 2072  dev_i)..    if r
-00071a20: 656d 5f6c 6f77 5f63 7667 3a20 0a20 2020  em_low_cvg: .   
-00071a30: 2020 2020 2072 735f 6e64 2c20 7273 5f6d       rs_nd, rs_m
-00071a40: 2c20 6220 3d20 7265 6d5f 6e6d 5f32 6c6f  , b = rem_nm_2lo
-00071a50: 6e67 5f61 6e64 5f32 7468 696e 2820 7273  ng_and_2thin( rs
-00071a60: 5f6e 642c 2072 735f 6d20 290a 2020 2020  _nd, rs_m ).    
-00071a70: 2020 2020 7273 5f6d 2c20 7273 5f6e 642c      rs_m, rs_nd,
-00071a80: 2072 735f 7374 6920 3d20 7265 6d5f 6c6f   rs_sti = rem_lo
-00071a90: 775f 6376 675f 7267 6e73 2820 7273 5f6d  w_cvg_rgns( rs_m
-00071aa0: 2c20 7273 5f6e 642c 2072 735f 7374 6920  , rs_nd, rs_sti 
-00071ab0: 290a 0a20 2020 2069 6620 6c65 6e28 7273  )..    if len(rs
-00071ac0: 5f6d 2e72 676e 7329 203e 2030 3a0a 2020  _m.rgns) > 0:.  
-00071ad0: 2020 2020 2020 2320 7273 5f6e 642c 2072        # rs_nd, r
-00071ae0: 735f 6d2c 2062 203d 2061 646a 5f6e 6428  s_m, b = adj_nd(
-00071af0: 2072 735f 6e64 2c20 7273 5f6d 2029 0a0a   rs_nd, rs_m )..
-00071b00: 2020 2020 2020 2020 7273 5f6e 642c 2072          rs_nd, r
-00071b10: 735f 6d2c 2062 203d 2074 7269 6d5f 6d28  s_m, b = trim_m(
-00071b20: 2072 735f 6e64 2c20 7273 5f6d 2c20 7273   rs_nd, rs_m, rs
-00071b30: 5f73 7469 2c20 6d61 785f 6465 765f 6e2c  _sti, max_dev_n,
-00071b40: 206d 6178 5f64 6576 5f64 2029 2020 2020   max_dev_d )    
-00071b50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00071b60: 2020 2020 7273 5f6e 642c 2072 735f 6d2c      rs_nd, rs_m,
-00071b70: 2062 203d 2074 7269 6d5f 6428 2072 735f   b = trim_d( rs_
-00071b80: 6e64 2c20 7273 5f6d 2029 2020 2323 206e  nd, rs_m )  ## n
-00071b90: 2073 686f 756c 6420 6265 2066 6972 7374   should be first
-00071ba0: 2c20 7468 656e 2064 0a20 2020 2020 2020  , then d.       
-00071bb0: 2072 735f 6e64 2c20 7273 5f6d 2c20 6220   rs_nd, rs_m, b 
-00071bc0: 3d20 7370 6c69 745f 6d28 2072 735f 6e64  = split_m( rs_nd
-00071bd0: 2c20 7273 5f6d 2c20 7273 5f73 7469 2029  , rs_m, rs_sti )
-00071be0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00071bf0: 2020 2020 7273 5f6e 642c 2072 735f 6d2c      rs_nd, rs_m,
-00071c00: 2062 203d 2074 7269 6d5f 6e5f 7368 6f72   b = trim_n_shor
-00071c10: 7428 2072 735f 6e64 2c20 7273 5f6d 2029  t( rs_nd, rs_m )
-00071c20: 2020 0a20 2020 2020 2020 2072 735f 6e64    .        rs_nd
-00071c30: 2c20 7273 5f6d 2c20 6220 3d20 6164 645f  , rs_m, b = add_
-00071c40: 6928 2072 735f 6e64 2c20 7273 5f6d 2c20  i( rs_nd, rs_m, 
-00071c50: 7273 5f73 7469 2029 0a20 2020 2020 2020  rs_sti ).       
-00071c60: 200a 2020 2020 2020 2020 7273 5f6d 2e75   .        rs_m.u
-00071c70: 7064 6174 6528 290a 2020 2020 2020 2020  pdate().        
-00071c80: 7273 5f6d 2e73 6574 5f63 7667 2829 0a20  rs_m.set_cvg(). 
-00071c90: 2020 2020 2020 2072 735f 6e64 2e75 7064         rs_nd.upd
-00071ca0: 6174 6528 290a 2020 2020 2020 2020 7273  ate().        rs
-00071cb0: 5f6e 642e 7365 745f 6376 6728 290a 2020  _nd.set_cvg().  
-00071cc0: 2020 2020 2020 2020 2020 0a20 2020 2072            .    r
-00071cd0: 6574 7572 6e20 7273 5f6d 2c20 7273 5f6e  eturn rs_m, rs_n
-00071ce0: 640a 0a0a 6465 6620 6368 6563 6b5f 6269  d...def check_bi
-00071cf0: 7374 7261 6e64 2820 725f 6d69 2c20 725f  strand( r_mi, r_
-00071d00: 6e64 2029 3a0a 2020 2020 0a20 2020 2070  nd ):.    .    p
-00071d10: 6f73 203d 2030 0a20 2020 206e 6567 203d  os = 0.    neg =
-00071d20: 2030 0a20 2020 2069 6620 6c65 6e28 725f   0.    if len(r_
-00071d30: 6d69 2e72 676e 7329 203e 2030 3a0a 2020  mi.rgns) > 0:.  
-00071d40: 2020 2020 2020 666f 7220 7267 6e20 696e        for rgn in
-00071d50: 2072 5f6d 692e 7267 6e73 3a0a 2020 2020   r_mi.rgns:.    
-00071d60: 2020 2020 2020 2020 6966 2072 676e 2e78          if rgn.x
-00071d70: 7320 3e20 303a 2070 6f73 202b 3d20 310a  s > 0: pos += 1.
-00071d80: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00071d90: 2072 676e 2e78 7320 3c20 303a 206e 6567   rgn.xs < 0: neg
-00071da0: 202b 3d20 310a 0a20 2020 2069 6620 6c65   += 1..    if le
-00071db0: 6e28 725f 6e64 2e72 676e 7329 203e 2030  n(r_nd.rgns) > 0
-00071dc0: 3a0a 2020 2020 2020 2020 666f 7220 7267  :.        for rg
-00071dd0: 6e20 696e 2072 5f6e 642e 7267 6e73 3a0a  n in r_nd.rgns:.
-00071de0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00071df0: 676e 2e78 7320 3e20 303a 2070 6f73 202b  gn.xs > 0: pos +
-00071e00: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00071e10: 656c 6966 2072 676e 2e78 7320 3c20 303a  elif rgn.xs < 0:
-00071e20: 206e 6567 202b 3d20 310a 2020 2020 2020   neg += 1.      
-00071e30: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-00071e40: 6e20 706f 732c 206e 6567 0a0a 0a4e 554d  n pos, neg...NUM
-00071e50: 5f43 4f52 4553 203d 2034 0a0a 6465 6620  _CORES = 4..def 
-00071e60: 6669 6e64 5f6b 665f 616e 645f 6b62 2820  find_kf_and_kb( 
-00071e70: 6578 6f6e 732c 2072 735f 6d20 293a 0a0a  exons, rs_m ):..
-00071e80: 2020 2020 666c 6167 5f66 203d 2054 7275      flag_f = Tru
-00071e90: 650a 2020 2020 666c 6167 5f62 203d 2054  e.    flag_b = T
-00071ea0: 7275 650a 2020 2020 6b66 203d 2030 0a20  rue.    kf = 0. 
-00071eb0: 2020 206b 6220 3d20 6c65 6e28 6578 6f6e     kb = len(exon
-00071ec0: 732e 7267 6e73 292d 310a 2020 2020 666f  s.rgns)-1.    fo
-00071ed0: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
-00071ee0: 2865 786f 6e73 2e72 676e 7329 293a 0a20  (exons.rgns)):. 
-00071ef0: 2020 2020 2020 2069 6620 666c 6167 5f66         if flag_f
-00071f00: 3a0a 2020 2020 2020 2020 2020 2020 7220  :.            r 
-00071f10: 3d20 6578 6f6e 732e 7267 6e73 5b6b 5d0a  = exons.rgns[k].
-00071f20: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00071f30: 2e74 7970 652e 6c6f 7765 7228 2920 3d3d  .type.lower() ==
-00071f40: 2027 6578 6f6e 273a 0a20 2020 2020 2020   'exon':.       
-00071f50: 2020 2020 2020 2020 2069 6620 7273 5f6d           if rs_m
-00071f60: 2e68 6173 5f65 7874 5f69 6e74 6572 7365  .has_ext_interse
-00071f70: 6374 696f 6e5f 7769 7468 2872 293a 0a20  ction_with(r):. 
-00071f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071f90: 2020 206b 6620 3d20 6b0a 2020 2020 2020     kf = k.      
-00071fa0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00071fb0: 6167 5f66 203d 2046 616c 7365 0a20 2020  ag_f = False.   
-00071fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071fd0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00071fe0: 2020 2020 2020 200a 2020 2020 666f 7220         .    for 
-00071ff0: 6b20 696e 2072 6576 6572 7365 6428 7261  k in reversed(ra
-00072000: 6e67 6528 6c65 6e28 6578 6f6e 732e 7267  nge(len(exons.rg
-00072010: 6e73 2929 293a 0a20 2020 2020 2020 2069  ns))):.        i
-00072020: 6620 666c 6167 5f62 3a0a 2020 2020 2020  f flag_b:.      
-00072030: 2020 2020 2020 7220 3d20 6578 6f6e 732e        r = exons.
-00072040: 7267 6e73 5b6b 5d0a 2020 2020 2020 2020  rgns[k].        
-00072050: 2020 2020 6966 2072 2e74 7970 652e 6c6f      if r.type.lo
-00072060: 7765 7228 2920 3d3d 2027 6578 6f6e 273a  wer() == 'exon':
-00072070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00072080: 2069 6620 7273 5f6d 2e68 6173 5f65 7874   if rs_m.has_ext
-00072090: 5f69 6e74 6572 7365 6374 696f 6e5f 7769  _intersection_wi
-000720a0: 7468 2872 293a 0a20 2020 2020 2020 2020  th(r):.         
-000720b0: 2020 2020 2020 2020 2020 206b 6220 3d20             kb = 
-000720c0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-000720d0: 2020 2020 2020 666c 6167 5f66 203d 2046        flag_f = F
-000720e0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-000720f0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00072100: 2020 2072 6574 7572 6e20 6b66 2c20 6b62     return kf, kb
-00072110: 0a20 2020 200a 0a64 6566 206d 635f 636f  .    ..def mc_co
-00072120: 7265 5f67 6574 5f74 7228 7273 5f74 7570  re_get_tr(rs_tup
-00072130: 6c65 293a 0a20 2020 200a 2020 2020 7273  le):.    .    rs
-00072140: 5f6d 203d 2072 735f 7475 706c 655b 305d  _m = rs_tuple[0]
-00072150: 0a20 2020 2072 735f 6e64 203d 2072 735f  .    rs_nd = rs_
-00072160: 7475 706c 655b 315d 0a20 2020 2072 735f  tuple[1].    rs_
-00072170: 7374 6920 3d20 7273 5f74 7570 6c65 5b32  sti = rs_tuple[2
-00072180: 5d0a 2020 2020 6763 6e74 203d 2072 735f  ].    gcnt = rs_
-00072190: 7475 706c 655b 335d 0a20 2020 206c 656e  tuple[3].    len
-000721a0: 5f74 6820 3d20 7273 5f74 7570 6c65 5b34  _th = rs_tuple[4
-000721b0: 5d0a 2020 2020 6d65 7468 6f64 203d 2072  ].    method = r
-000721c0: 735f 7475 706c 655b 355d 0a20 2020 2072  s_tuple[5].    r
-000721d0: 645f 6c65 6e20 3d20 7273 5f74 7570 6c65  d_len = rs_tuple
-000721e0: 5b36 5d0a 2020 2020 6764 203d 2072 735f  [6].    gd = rs_
-000721f0: 7475 706c 655b 375d 0a20 2020 200a 2020  tuple[7].    .  
-00072200: 2020 6773 697a 6520 3d20 6c65 6e28 7273    gsize = len(rs
-00072210: 5f6d 2e72 676e 7329 0a20 2020 2067 766f  _m.rgns).    gvo
-00072220: 6c20 3d20 7273 5f6d 2e67 6574 5f76 6f6c  l = rs_m.get_vol
-00072230: 756d 6528 290a 0a20 2020 2023 2727 270a  ume()..    #'''.
-00072240: 2020 2020 7374 203d 2074 696d 652e 7469      st = time.ti
-00072250: 6d65 2829 0a20 2020 2069 6620 6764 2069  me().    if gd i
-00072260: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00072270: 2020 2020 2323 206d 6572 6765 2067 642e      ## merge gd.
-00072280: 6578 6f6e 7320 746f 2072 735f 6d20 2d3e  exons to rs_m ->
-00072290: 2075 7064 6174 6520 7273 5f6d 0a20 2020   update rs_m.   
-000722a0: 2020 2020 2066 6f72 206b 2c20 7220 696e       for k, r in
-000722b0: 2065 6e75 6d65 7261 7465 2867 642e 6578   enumerate(gd.ex
-000722c0: 6f6e 732e 7267 6e73 293a 0a20 2020 2020  ons.rgns):.     
-000722d0: 2020 2020 2020 2069 6620 722e 7479 7065         if r.type
-000722e0: 2e6c 6f77 6572 2829 203d 3d20 2765 786f  .lower() == 'exo
-000722f0: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-00072300: 2020 2020 4c65 6e20 3d20 722e 656e 6420      Len = r.end 
-00072310: 2d20 722e 7374 6172 7420 2b20 310a 2020  - r.start + 1.  
-00072320: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-00072330: 203d 2072 6567 696f 6e28 722e 6368 722c   = region(r.chr,
-00072340: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
-00072350: 2027 4d27 2c20 7365 715f 6f72 5f63 6d61   'M', seq_or_cma
-00072360: 7420 3d20 274e 272a 4c65 6e2c 2063 7667  t = 'N'*Len, cvg
-00072370: 5f64 6570 203d 2043 5647 5f44 4550 5448  _dep = CVG_DEPTH
-00072380: 5f54 4d50 290a 2020 2020 2020 2020 2020  _TMP).          
-00072390: 2020 2020 2020 2320 726d 2e67 6574 5f63        # rm.get_c
-000723a0: 7667 2829 0a20 2020 2020 2020 2020 2020  vg().           
-000723b0: 2020 2020 2072 735f 6d2e 7267 6e73 2e61       rs_m.rgns.a
-000723c0: 7070 656e 6428 726d 290a 2020 2020 2020  ppend(rm).      
-000723d0: 2020 2020 2020 2020 2020 2320 7273 5f6d            # rs_m
-000723e0: 2e75 7064 6174 6528 726d 290a 2020 2020  .update(rm).    
-000723f0: 2020 2020 7273 5f6d 2e75 7064 6174 6528      rs_m.update(
-00072400: 290a 2020 2020 2020 2020 7273 5f6d 2e73  ).        rs_m.s
-00072410: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
-00072420: 2023 2066 6f72 2072 2069 6e20 7273 5f6d   # for r in rs_m
-00072430: 2e72 676e 733a 2072 2e67 6574 5f63 7667  .rgns: r.get_cvg
-00072440: 2829 0a20 2020 2023 2727 270a 2020 2020  ().    #'''.    
-00072450: 6574 3120 3d20 7469 6d65 2e74 696d 6528  et1 = time.time(
-00072460: 2920 2d20 7374 0a20 2020 2020 2020 200a  ) - st.        .
-00072470: 2020 2020 7374 203d 2074 696d 652e 7469      st = time.ti
-00072480: 6d65 2829 0a20 2020 2072 735f 6d2c 2072  me().    rs_m, r
-00072490: 735f 6e64 203d 2074 7269 6d5f 636f 6e74  s_nd = trim_cont
-000724a0: 6967 735f 7369 6e67 6c65 2820 7273 5f6d  igs_single( rs_m
-000724b0: 2c20 7273 5f6e 642c 2072 735f 7374 692c  , rs_nd, rs_sti,
-000724c0: 2067 636e 742c 2028 6764 2069 7320 4e6f   gcnt, (gd is No
-000724d0: 6e65 2920 290a 2020 2020 6574 3220 3d20  ne) ).    et2 = 
-000724e0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-000724f0: 0a0a 2020 2020 2327 2727 0a20 2020 2073  ..    #'''.    s
-00072500: 7420 3d20 7469 6d65 2e74 696d 6528 290a  t = time.time().
-00072510: 2020 2020 6966 2067 6420 6973 206e 6f74      if gd is not
-00072520: 204e 6f6e 653a 0a20 2020 2020 2020 2074   None:.        t
-00072530: 6f5f 6465 6c20 3d20 5b5d 0a20 2020 2020  o_del = [].     
-00072540: 2020 2066 6f72 206b 2c20 7220 696e 2065     for k, r in e
-00072550: 6e75 6d65 7261 7465 2872 735f 6d2e 7267  numerate(rs_m.rg
-00072560: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
-00072570: 2069 6620 722e 6176 655f 6376 675f 6465   if r.ave_cvg_de
-00072580: 7074 6828 2920 3c3d 2043 5647 5f44 4550  pth() <= CVG_DEP
-00072590: 5448 5f54 4d50 3a0a 2020 2020 2020 2020  TH_TMP:.        
-000725a0: 2020 2020 2020 2020 746f 5f64 656c 2e61          to_del.a
-000725b0: 7070 656e 6428 6b29 0a20 2020 2020 2020  ppend(k).       
-000725c0: 2069 6620 6c65 6e28 746f 5f64 656c 2920   if len(to_del) 
-000725d0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-000725e0: 2023 2070 7269 6e74 2827 2569 2052 535f   # print('%i RS_
-000725f0: 4d20 7265 6d6f 7665 6420 616d 6f6e 6720  M removed among 
-00072600: 2569 2720 2520 286c 656e 2874 6f5f 6465  %i' % (len(to_de
-00072610: 6c29 2c20 6c65 6e28 7273 5f6d 2e72 676e  l), len(rs_m.rgn
-00072620: 7329 2929 0a20 2020 2020 2020 2020 2020  s))).           
-00072630: 2074 6f5f 6465 6c2e 736f 7274 2829 0a20   to_del.sort(). 
-00072640: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00072650: 2069 6e20 7265 7665 7273 6564 2874 6f5f   in reversed(to_
-00072660: 6465 6c29 3a20 6465 6c20 7273 5f6d 2e72  del): del rs_m.r
-00072670: 676e 735b 6b5d 0a20 2020 2020 2020 2020  gns[k].         
-00072680: 2020 2072 735f 6d2e 7570 6461 7465 2829     rs_m.update()
-00072690: 0a20 2020 2065 7433 203d 2074 696d 652e  .    et3 = time.
-000726a0: 7469 6d65 2829 202d 2073 740a 2020 2020  time() - st.    
-000726b0: 2327 2727 0a20 2020 200a 2020 2020 6772  #'''.    .    gr
-000726c0: 7020 3d20 7370 6c69 6365 5f67 7261 7068  p = splice_graph
-000726d0: 2872 645f 6c65 6e2c 2067 636e 7429 0a20  (rd_len, gcnt). 
-000726e0: 2020 200a 2020 2020 6220 3d20 5472 7565     .    b = True
-000726f0: 0a20 2020 2065 7436 203d 2030 0a20 2020  .    et6 = 0.   
-00072700: 2065 7435 203d 2030 0a20 2020 2065 7434   et5 = 0.    et4
-00072710: 203d 2030 0a20 2020 2065 7478 203d 2030   = 0.    etx = 0
-00072720: 0a20 2020 2069 6620 286c 656e 2872 735f  .    if (len(rs_
-00072730: 6d2e 7267 6e73 2920 3e20 3029 3a20 2320  m.rgns) > 0): # 
-00072740: 2620 286c 656e 2872 735f 6d2e 7267 6e73  & (len(rs_m.rgns
-00072750: 2920 3c20 3230 293a 0a20 2020 2020 2020  ) < 20):.       
-00072760: 200a 2020 2020 2020 2020 7374 203d 2074   .        st = t
-00072770: 696d 652e 7469 6d65 2829 0a20 2020 2020  ime.time().     
-00072780: 2020 2062 672c 2072 735f 6d2c 2072 735f     bg, rs_m, rs_
-00072790: 6e64 203d 2067 7270 2e62 7569 6c64 2872  nd = grp.build(r
-000727a0: 735f 6d2c 2072 735f 6e64 2c20 2867 6420  s_m, rs_nd, (gd 
-000727b0: 6973 204e 6f6e 6529 2c20 6c65 6e5f 7468  is None), len_th
-000727c0: 203d 206c 656e 5f74 6829 0a20 2020 2020   = len_th).     
-000727d0: 2020 2065 7434 203d 2074 696d 652e 7469     et4 = time.ti
-000727e0: 6d65 2829 202d 2073 740a 2020 2020 2020  me() - st.      
-000727f0: 2020 6d6e 203d 2030 0a20 2020 2020 2020    mn = 0.       
-00072800: 2063 6e74 203d 2030 0a0a 2020 2020 2020   cnt = 0..      
-00072810: 2020 7472 5f6c 7374 203d 205b 5d0a 2020    tr_lst = [].  
-00072820: 2020 2020 2020 6966 5f6c 7374 203d 205b        if_lst = [
-00072830: 5d0a 2020 2020 2020 2020 6774 665f 6c69  ].        gtf_li
-00072840: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-00072850: 2069 6620 6764 2069 7320 6e6f 7420 4e6f   if gd is not No
-00072860: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00072870: 7374 203d 2074 696d 652e 7469 6d65 2829  st = time.time()
-00072880: 0a20 2020 2020 2020 2020 2020 2067 642c  .            gd,
-00072890: 2074 725f 6c73 742c 2069 665f 6c73 742c   tr_lst, if_lst,
-000728a0: 2067 7466 5f6c 696e 6573 2c20 6574 7820   gtf_lines, etx 
-000728b0: 3d20 6772 702e 7464 5f61 6e64 5f61 655f  = grp.td_and_ae_
-000728c0: 7573 696e 675f 616e 6e6f 7461 7469 6f6e  using_annotation
-000728d0: 2867 642c 206c 656e 5f74 682c 206d 6574  (gd, len_th, met
-000728e0: 686f 6420 3d20 6d65 7468 6f64 290a 2020  hod = method).  
-000728f0: 2020 2020 2020 2020 2020 6574 3620 3d20            et6 = 
-00072900: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00072910: 0a0a 2020 2020 2020 2020 656c 7365 3a20  ..        else: 
-00072920: 2320 6966 206c 656e 2874 725f 6c73 742b  # if len(tr_lst+
-00072930: 6966 5f6c 7374 2920 3d3d 2030 3a0a 2020  if_lst) == 0:.  
-00072940: 2020 2020 2020 2020 2020 7374 203d 2074            st = t
-00072950: 696d 652e 7469 6d65 2829 0a20 2020 2020  ime.time().     
-00072960: 2020 2020 2020 2062 2c20 6d6e 2c20 636e         b, mn, cn
-00072970: 742c 2072 735f 6d2c 2072 735f 6e64 203d  t, rs_m, rs_nd =
-00072980: 2067 7270 2e73 656c 6563 745f 6e6f 6465   grp.select_node
-00072990: 735f 616e 645f 6564 6765 7328 2029 2023  s_and_edges( ) #
-000729a0: 2072 735f 6d2c 2072 735f 6e64 290a 2020   rs_m, rs_nd).  
-000729b0: 2020 2020 2020 2020 2020 6574 3520 3d20            et5 = 
-000729c0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-000729d0: 0a20 2020 2020 2020 2020 2020 2073 7420  .            st 
-000729e0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-000729f0: 2020 2020 2020 2020 2020 6966 2062 3a0a            if b:.
-00072a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072a10: 6764 2c20 7472 5f6c 7374 2c20 6966 5f6c  gd, tr_lst, if_l
-00072a20: 7374 2c20 6774 665f 6c69 6e65 7320 3d20  st, gtf_lines = 
-00072a30: 6772 702e 7464 5f61 6e64 5f61 6528 6c65  grp.td_and_ae(le
-00072a40: 6e5f 7468 2c20 6d65 7468 6f64 203d 206d  n_th, method = m
-00072a50: 6574 686f 6429 0a0a 2020 2020 2020 2020  ethod)..        
-00072a60: 2020 2020 702c 206e 203d 2063 6865 636b      p, n = check
-00072a70: 5f62 6973 7472 616e 6428 2072 735f 6d2c  _bistrand( rs_m,
-00072a80: 2072 735f 6e64 2029 0a20 2020 2020 2020   rs_nd ).       
-00072a90: 2020 2020 2069 6620 2870 203e 2030 2920       if (p > 0) 
-00072aa0: 2620 286e 203e 2030 293a 2067 7270 2e62  & (n > 0): grp.b
-00072ab0: 6973 7472 616e 6465 6420 3d20 5472 7565  istranded = True
-00072ac0: 2023 2070 6173 730a 2020 2020 2020 2020   # pass.        
-00072ad0: 2020 2020 656c 7365 3a20 6772 702e 6269      else: grp.bi
-00072ae0: 7374 7261 6e64 6564 203d 2046 616c 7365  stranded = False
-00072af0: 2023 2067 7270 203d 204e 6f6e 650a 2020   # grp = None.  
-00072b00: 2020 2020 2020 2020 2020 6574 3620 3d20            et6 = 
-00072b10: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00072b20: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00072b30: 2020 6465 6c20 7273 5f6d 0a20 2020 2064    del rs_m.    d
-00072b40: 656c 2072 735f 6e64 0a20 2020 2064 656c  el rs_nd.    del
-00072b50: 2072 735f 7374 690a 2020 2020 2320 6465   rs_sti.    # de
-00072b60: 6c20 6764 0a20 2020 2020 2020 2020 2020  l gd.           
-00072b70: 200a 2020 2020 6966 206e 6f74 2062 3a0a   .    if not b:.
-00072b80: 2020 2020 2020 2020 7472 5f6c 7374 203d          tr_lst =
-00072b90: 205b 5d0a 2020 2020 2020 2020 6966 5f6c   [].        if_l
-00072ba0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-00072bb0: 6774 665f 6c69 6e65 7320 3d20 5b5d 0a20  gtf_lines = []. 
-00072bc0: 2020 2020 2020 206d 6e20 3d20 300a 2020         mn = 0.  
-00072bd0: 2020 2020 2020 636e 7420 3d20 300a 0a20        cnt = 0.. 
-00072be0: 2020 2072 6574 7572 6e20 7472 5f6c 7374     return tr_lst
-00072bf0: 2c20 6966 5f6c 7374 2c20 6774 665f 6c69  , if_lst, gtf_li
-00072c00: 6e65 732c 2067 7369 7a65 2c20 6776 6f6c  nes, gsize, gvol
-00072c10: 2c20 6d6e 2c20 636e 742c 2067 7270 2c20  , mn, cnt, grp, 
-00072c20: 6763 6e74 2c20 6764 2c20 6e70 2e61 7272  gcnt, gd, np.arr
-00072c30: 6179 285b 6574 312c 6574 322c 6574 332c  ay([et1,et2,et3,
-00072c40: 6574 342c 2065 7435 2c20 6574 365d 292c  et4, et5, et6]),
-00072c50: 2065 7478 0a0a 6465 6620 6765 745f 7472   etx..def get_tr
-00072c60: 616e 7363 7269 7074 735f 6d63 2820 7267  anscripts_mc( rg
-00072c70: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
-00072c80: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
-00072c90: 5f73 742c 2072 6561 645f 6c65 6e2c 2061  _st, read_len, a
-00072ca0: 6e6e 6f74 203d 204e 6f6e 652c 205c 0a20  nnot = None, \. 
-00072cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072cc0: 2020 2020 2020 206e 5f63 6f72 6573 203d         n_cores =
-00072cd0: 204e 554d 5f43 4f52 4553 2c20 6c65 6e5f   NUM_CORES, len_
-00072ce0: 7468 203d 204d 494e 5f54 525f 4c45 4e47  th = MIN_TR_LENG
-00072cf0: 5448 2c20 6d65 7468 6f64 203d 2027 6c61  TH, method = 'la
-00072d00: 7373 6f27 2c20 5c0a 2020 2020 2020 2020  sso', \.        
-00072d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072d20: 6e72 6563 203d 2030 2c20 7374 6172 7420  nrec = 0, start 
-00072d30: 3d20 302c 2076 6572 626f 7365 203d 2054  = 0, verbose = T
-00072d40: 7275 652c 2073 6469 7620 3d20 3230 2029  rue, sdiv = 20 )
-00072d50: 3a0a 0a20 2020 2073 7461 7274 5f74 696d  :..    start_tim
-00072d60: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-00072d70: 2020 2020 636e 7470 203d 2030 3b20 636e      cntp = 0; cn
-00072d80: 746e 203d 2030 3b20 636e 7430 203d 2030  tn = 0; cnt0 = 0
-00072d90: 3b20 636e 7466 203d 2030 3b20 636e 7467  ; cntf = 0; cntg
-00072da0: 203d 2030 0a20 2020 2066 7020 3d20 303b   = 0.    fp = 0;
-00072db0: 2066 6e20 3d20 303b 2066 3020 3d20 303b   fn = 0; f0 = 0;
-00072dc0: 2066 6620 3d20 300a 0a20 2020 206e 5f74   ff = 0..    n_t
-00072dd0: 7220 3d20 300a 2020 2020 4754 465f 6c73  r = 0.    GTF_ls
-00072de0: 7420 3d20 5b5d 0a20 2020 2054 725f 6c73  t = [].    Tr_ls
-00072df0: 7420 3d20 5b5d 0a20 2020 2049 735f 6c73  t = [].    Is_ls
-00072e00: 7420 3d20 5b5d 0a20 2020 206d 6e5f 6c73  t = [].    mn_ls
-00072e10: 7420 3d20 5b5d 0a20 2020 2067 7270 5f6c  t = [].    grp_l
-00072e20: 7374 203d 205b 5d0a 2020 2020 6764 5f6c  st = [].    gd_l
-00072e30: 7374 203d 205b 5d0a 2020 2020 6364 5f74  st = [].    cd_t
-00072e40: 6820 3d20 6e70 2e7a 6572 6f73 286c 656e  h = np.zeros(len
-00072e50: 2872 676e 735f 6c73 745f 6d69 292c 2064  (rgns_lst_mi), d
-00072e60: 7479 7065 3d69 6e74 290a 2020 2020 775f  type=int).    w_
-00072e70: 636e 7420 3d20 6e70 2e7a 6572 6f73 286c  cnt = np.zeros(l
-00072e80: 656e 2872 676e 735f 6c73 745f 6d69 292c  en(rgns_lst_mi),
-00072e90: 2064 7479 7065 3d69 6e74 290a 2020 2020   dtype=int).    
-00072ea0: 6773 697a 6520 3d20 6e70 2e7a 6572 6f73  gsize = np.zeros
-00072eb0: 286c 656e 2872 676e 735f 6c73 745f 6d69  (len(rgns_lst_mi
-00072ec0: 292c 2064 7479 7065 3d69 6e74 290a 2020  ), dtype=int).  
-00072ed0: 2020 6776 6f6c 203d 206e 702e 7a65 726f    gvol = np.zero
-00072ee0: 7328 6c65 6e28 7267 6e73 5f6c 7374 5f6d  s(len(rgns_lst_m
-00072ef0: 6929 2c20 6474 7970 653d 696e 7429 0a0a  i), dtype=int)..
-00072f00: 2020 2020 6763 6e74 203d 2030 0a20 2020      gcnt = 0.   
-00072f10: 2073 7461 7274 5f74 696d 6531 203d 2074   start_time1 = t
-00072f20: 696d 652e 7469 6d65 2829 0a20 2020 2069  ime.time().    i
-00072f30: 6620 7665 7262 6f73 653a 200a 2020 2020  f verbose: .    
-00072f40: 2020 2020 6966 2061 6e6e 6f74 2069 7320      if annot is 
-00072f50: 4e6f 6e65 3a20 7072 696e 7428 275c 7253  None: print('\rS
-00072f60: 6561 7263 6820 6973 6f66 6f72 6d73 2026  earch isoforms &
-00072f70: 2065 7374 2061 6275 6e64 616e 6365 7320   est abundances 
-00072f80: 2e2e 2e2e 2e20 272c 2065 6e64 3d27 2729  ..... ', end='')
-00072f90: 0a20 2020 2020 2020 2065 6c73 653a 2070  .        else: p
-00072fa0: 7269 6e74 2827 5c72 5265 636f 7665 7269  rint('\rRecoveri
-00072fb0: 6e67 2069 736f 666f 726d 7320 2620 6573  ng isoforms & es
-00072fc0: 7420 6162 756e 6461 6e63 6573 202e 2e2e  t abundances ...
-00072fd0: 2e2e 2027 2c20 656e 643d 2727 290a 2020  .. ', end='').  
-00072fe0: 2020 2020 2020 0a20 2020 2023 2727 270a        .    #'''.
-00072ff0: 2020 2020 6776 203d 206e 702e 7a65 726f      gv = np.zero
-00073000: 7328 6c65 6e28 7267 6e73 5f6c 7374 5f6e  s(len(rgns_lst_n
-00073010: 6429 290a 2020 2020 666f 7220 6b20 696e  d)).    for k in
-00073020: 2072 616e 6765 286c 656e 2872 676e 735f   range(len(rgns_
-00073030: 6c73 745f 6e64 2929 3a0a 2020 2020 2020  lst_nd)):.      
-00073040: 2020 6776 5b6b 5d20 3d20 2d6c 656e 2872    gv[k] = -len(r
-00073050: 676e 735f 6c73 745f 6e64 5b6b 5d2e 7267  gns_lst_nd[k].rg
-00073060: 6e73 2920 2320 2d72 676e 735f 6c73 745f  ns) # -rgns_lst_
-00073070: 6d69 5b6b 5d2e 6765 745f 766f 6c75 6d65  mi[k].get_volume
-00073080: 2829 0a20 2020 206f 6472 203d 2067 762e  ().    odr = gv.
-00073090: 6172 6773 6f72 7428 290a 2020 2020 2327  argsort().    #'
-000730a0: 2727 0a20 2020 200a 2020 2020 7273 5f74  ''.    .    rs_t
-000730b0: 7570 6c65 5f6c 7374 203d 205b 5d0a 2020  uple_lst = [].  
-000730c0: 2020 6966 2073 7461 7274 203d 3d20 303a    if start == 0:
-000730d0: 0a20 2020 2020 2020 2069 6620 6e72 6563  .        if nrec
-000730e0: 203d 3d20 303a 204e 7265 6320 3d20 6c65   == 0: Nrec = le
-000730f0: 6e28 7267 6e73 5f6c 7374 5f6d 6929 0a20  n(rgns_lst_mi). 
-00073100: 2020 2020 2020 2065 6c73 653a 204e 7265         else: Nre
-00073110: 6320 3d20 6e72 6563 0a20 2020 2065 6c73  c = nrec.    els
-00073120: 653a 0a20 2020 2020 2020 204e 7265 6320  e:.        Nrec 
-00073130: 3d20 6c65 6e28 7267 6e73 5f6c 7374 5f6d  = len(rgns_lst_m
-00073140: 6929 0a20 2020 2020 2020 2069 6620 7374  i).        if st
-00073150: 6172 7420 3e3d 204e 7265 633a 2073 7461  art >= Nrec: sta
-00073160: 7274 203d 204e 7265 632d 310a 0a20 2020  rt = Nrec-1..   
-00073170: 2066 6f72 206d 2069 6e20 7261 6e67 6528   for m in range(
-00073180: 4e72 6563 2d73 7461 7274 293a 0a20 2020  Nrec-start):.   
-00073190: 2020 2020 206b 203d 2020 6f64 725b 6d2b       k =  odr[m+
-000731a0: 7374 6172 745d 2023 206d 202b 2073 7461  start] # m + sta
-000731b0: 7274 0a20 2020 2020 2020 2067 6420 3d20  rt.        gd = 
-000731c0: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
-000731d0: 2861 6e6e 6f74 2069 7320 6e6f 7420 4e6f  (annot is not No
-000731e0: 6e65 293a 200a 2020 2020 2020 2020 2020  ne): .          
-000731f0: 2020 6966 206b 203c 206c 656e 2861 6e6e    if k < len(ann
-00073200: 6f74 293a 2067 6420 3d20 616e 6e6f 745b  ot): gd = annot[
-00073210: 6b5d 0a20 2020 2020 2020 2072 735f 7475  k].        rs_tu
-00073220: 706c 655f 6c73 742e 6170 7065 6e64 2820  ple_lst.append( 
-00073230: 2872 676e 735f 6c73 745f 6d69 5b6b 5d2c  (rgns_lst_mi[k],
-00073240: 2072 676e 735f 6c73 745f 6e64 5b6b 5d2c   rgns_lst_nd[k],
-00073250: 2072 676e 735f 6c73 745f 7374 5b6b 5d2c   rgns_lst_st[k],
-00073260: 206b 2c20 5c0a 2020 2020 2020 2020 2020   k, \.          
-00073270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073280: 2020 2020 6c65 6e5f 7468 2c20 6d65 7468      len_th, meth
-00073290: 6f64 2c20 7265 6164 5f6c 656e 2c20 6764  od, read_len, gd
-000732a0: 2920 290a 2020 2020 0a20 2020 206e 756d  ) ).    .    num
-000732b0: 5f63 6f72 6520 3d20 6d69 6e28 206e 5f63  _core = min( n_c
-000732c0: 6f72 6573 2c20 2863 7075 5f63 6f75 6e74  ores, (cpu_count
-000732d0: 2829 202d 2031 2920 290a 2020 2020 2320  () - 1) ).    # 
-000732e0: 7072 696e 7428 226e 756d 2063 6f72 6573  print("num cores
-000732f0: 2074 6f20 7573 6520 3d20 7b7d 222e 666f   to use = {}".fo
-00073300: 726d 6174 286e 756d 5f63 6f72 6529 290a  rmat(num_core)).
-00073310: 2020 2020 706f 6f6c 203d 2050 6f6f 6c28      pool = Pool(
-00073320: 6e75 6d5f 636f 7265 290a 2020 2020 746f  num_core).    to
-00073330: 7461 6c5f 6974 6572 6174 696f 6e20 3d20  tal_iteration = 
-00073340: 6c65 6e28 7273 5f74 7570 6c65 5f6c 7374  len(rs_tuple_lst
-00073350: 290a 0a20 2020 2073 7461 7274 5f74 696d  )..    start_tim
-00073360: 6531 203d 2074 696d 652e 7469 6d65 2829  e1 = time.time()
-00073370: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
-00073380: 200a 2020 2020 2020 2020 6966 2061 6e6e   .        if ann
-00073390: 6f74 2069 7320 4e6f 6e65 3a20 7072 696e  ot is None: prin
-000733a0: 7428 275c 7253 6561 7263 6820 6973 6f66  t('\rSearch isof
-000733b0: 6f72 6d73 2026 2065 7374 2061 6275 6e64  orms & est abund
-000733c0: 616e 6365 7320 2e2e 2e2e 2e20 272c 2065  ances ..... ', e
-000733d0: 6e64 3d27 2729 0a20 2020 2020 2020 2065  nd='').        e
-000733e0: 6c73 653a 2070 7269 6e74 2827 5c72 5265  lse: print('\rRe
-000733f0: 636f 7665 7269 6e67 2069 736f 666f 726d  covering isoform
-00073400: 7320 2620 6573 7420 6162 756e 6461 6e63  s & est abundanc
-00073410: 6573 202e 2e2e 2e2e 2027 2c20 656e 643d  es ..... ', end=
-00073420: 2727 290a 2020 2020 6d20 3d20 310a 2020  '').    m = 1.  
-00073430: 2020 6574 735f 7375 6d20 3d20 300a 2020    ets_sum = 0.  
-00073440: 2020 6574 785f 7375 6d20 3d20 300a 2020    etx_sum = 0.  
-00073450: 2020 666f 7220 746c 7374 2c20 696c 7374    for tlst, ilst
-00073460: 2c20 6774 665f 6c69 6e65 732c 2067 732c  , gtf_lines, gs,
-00073470: 2067 762c 206d 6e2c 2063 742c 2067 7270   gv, mn, ct, grp
-00073480: 2c20 6b2c 2067 642c 2065 7473 2c20 6574  , k, gd, ets, et
-00073490: 7820 696e 205c 0a20 2020 2020 2020 2070  x in \.        p
-000734a0: 6f6f 6c2e 696d 6170 5f75 6e6f 7264 6572  ool.imap_unorder
-000734b0: 6564 286d 635f 636f 7265 5f67 6574 5f74  ed(mc_core_get_t
-000734c0: 722c 2072 735f 7475 706c 655f 6c73 7429  r, rs_tuple_lst)
-000734d0: 3a0a 2020 2020 2020 2020 2320 7471 646d  :.        # tqdm
-000734e0: 2e74 7164 6d5f 6e6f 7465 626f 6f6b 2870  .tqdm_notebook(p
-000734f0: 6f6f 6c2e 696d 6170 5f75 6e6f 7264 6572  ool.imap_unorder
-00073500: 6564 286d 635f 636f 7265 5f67 6574 5f74  ed(mc_core_get_t
-00073510: 722c 2072 735f 7475 706c 655f 6c73 7429  r, rs_tuple_lst)
-00073520: 2c20 746f 7461 6c3d 746f 7461 6c5f 6974  , total=total_it
-00073530: 6572 6174 696f 6e29 3a0a 0a20 2020 2020  eration):..     
-00073540: 2020 2065 7473 5f73 756d 203d 2065 7473     ets_sum = ets
-00073550: 5f73 756d 202b 2065 7473 0a20 2020 2020  _sum + ets.     
-00073560: 2020 2065 7478 5f73 756d 203d 2065 7478     etx_sum = etx
-00073570: 5f73 756d 202b 2065 7478 0a0a 2020 2020  _sum + etx..    
-00073580: 2020 2020 5472 5f6c 7374 203d 2054 725f      Tr_lst = Tr_
-00073590: 6c73 7420 2b20 746c 7374 0a20 2020 2020  lst + tlst.     
-000735a0: 2020 2049 735f 6c73 7420 3d20 4973 5f6c     Is_lst = Is_l
-000735b0: 7374 202b 2069 6c73 740a 2020 2020 2020  st + ilst.      
-000735c0: 2020 4754 465f 6c73 7420 3d20 4754 465f    GTF_lst = GTF_
-000735d0: 6c73 7420 2b20 6774 665f 6c69 6e65 730a  lst + gtf_lines.
-000735e0: 2020 2020 2020 2020 6773 697a 655b 6b5d          gsize[k]
-000735f0: 203d 2067 730a 2020 2020 2020 2020 6776   = gs.        gv
-00073600: 6f6c 5b6b 5d20 3d20 6776 0a20 2020 2020  ol[k] = gv.     
-00073610: 2020 2063 645f 7468 5b6b 5d20 3d20 6d6e     cd_th[k] = mn
-00073620: 0a20 2020 2020 2020 2077 5f63 6e74 5b6b  .        w_cnt[k
-00073630: 5d20 3d20 6374 0a20 2020 2020 2020 2069  ] = ct.        i
-00073640: 6620 6772 7020 6973 206e 6f74 204e 6f6e  f grp is not Non
-00073650: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-00073660: 6772 705f 6c73 742e 6170 7065 6e64 2867  grp_lst.append(g
-00073670: 7270 290a 2020 2020 2020 2020 2020 2020  rp).            
-00073680: 0a20 2020 2020 2020 2069 6620 6764 2069  .        if gd i
-00073690: 7320 6e6f 7420 4e6f 6e65 3a20 0a20 2020  s not None: .   
-000736a0: 2020 2020 2020 2020 2067 645f 6c73 742e           gd_lst.
-000736b0: 6170 7065 6e64 2867 6429 0a0a 2020 2020  append(gd)..    
-000736c0: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
-000736d0: 0a20 2020 2020 2020 2020 2020 2065 6c61  .            ela
-000736e0: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
-000736f0: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-00073700: 7469 6d65 310a 2020 2020 2020 2020 2020  time1.          
-00073710: 2020 745f 7469 6d65 203d 2065 6c61 7073    t_time = elaps
-00073720: 6564 5f74 696d 652a 6c65 6e28 7273 5f74  ed_time*len(rs_t
-00073730: 7570 6c65 5f6c 7374 292f 6d0a 2020 2020  uple_lst)/m.    
-00073740: 2020 2020 2020 2020 725f 7469 6d65 203d          r_time =
-00073750: 2074 5f74 696d 6520 2d20 656c 6170 7365   t_time - elapse
-00073760: 645f 7469 6d65 0a20 2020 2020 2020 2020  d_time.         
-00073770: 2020 2069 6620 6d25 3130 3020 3d3d 2030     if m%100 == 0
-00073780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00073790: 2020 6966 2061 6e6e 6f74 2069 7320 4e6f    if annot is No
-000737a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000737b0: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-000737c0: 7253 6561 7263 6820 6973 6f66 6f72 6d73  rSearch isoforms
-000737d0: 2026 2065 7374 2061 6275 6e64 616e 6365   & est abundance
-000737e0: 7320 2e2e 2e2e 2e20 2569 2f25 6920 2020  s ..... %i/%i   
-000737f0: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-00073800: 2020 2020 2020 2020 2020 2020 2020 2025                 %
-00073810: 2028 6d2c 206c 656e 2872 735f 7475 706c   (m, len(rs_tupl
-00073820: 655f 6c73 7429 292c 2065 6e64 3d27 2729  e_lst)), end='')
-00073830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00073840: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00073850: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00073860: 2827 5c72 5265 636f 7665 7269 6e67 2069  ('\rRecovering i
-00073870: 736f 666f 726d 7320 2620 6573 7420 6162  soforms & est ab
-00073880: 756e 6461 6e63 6573 202e 2e2e 2e2e 2025  undances ..... %
-00073890: 692f 2569 2020 2027 205c 0a20 2020 2020  i/%i   ' \.     
-000738a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000738b0: 2020 2020 2020 2520 286d 2c20 6c65 6e28        % (m, len(
-000738c0: 7273 5f74 7570 6c65 5f6c 7374 2929 2c20  rs_tuple_lst)), 
-000738d0: 656e 643d 2727 290a 2020 2020 2020 2020  end='').        
-000738e0: 2020 2020 6d20 2b3d 2031 0a20 2020 2020      m += 1.     
-000738f0: 2020 2020 2020 200a 2020 2020 706f 6f6c         .    pool
-00073900: 2e63 6c6f 7365 2829 0a20 2020 2070 6f6f  .close().    poo
-00073910: 6c2e 6a6f 696e 2829 0a20 2020 200a 2020  l.join().    .  
-00073920: 2020 6966 2076 6572 626f 7365 3a20 0a0a    if verbose: ..
-00073930: 2020 2020 2020 2020 6e5f 636f 765f 6568          n_cov_eh
-00073940: 203d 2030 0a20 2020 2020 2020 2023 2069   = 0.        # i
-00073950: 6620 6764 2069 7320 6e6f 7420 4e6f 6e65  f gd is not None
-00073960: 3a0a 2020 2020 2020 2020 6966 206c 656e  :.        if len
-00073970: 2867 645f 6c73 7429 203e 2030 3a0a 2020  (gd_lst) > 0:.  
-00073980: 2020 2020 2020 2020 2020 666f 7220 6764            for gd
-00073990: 2069 6e20 6764 5f6c 7374 3a0a 2020 2020   in gd_lst:.    
-000739a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000739b0: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
-000739c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000739d0: 2020 2020 2069 6620 7464 2e63 6f76 203e       if td.cov >
-000739e0: 2031 2e31 3a20 6e5f 636f 765f 6568 202b   1.1: n_cov_eh +
-000739f0: 3d20 310a 0a20 2020 2020 2020 2065 6c61  = 1..        ela
-00073a00: 7073 6564 5f74 696d 6531 203d 2074 696d  psed_time1 = tim
-00073a10: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
-00073a20: 5f74 696d 6531 0a20 2020 2020 2020 2069  _time1.        i
-00073a30: 6620 616e 6e6f 7420 6973 204e 6f6e 653a  f annot is None:
-00073a40: 200a 2020 2020 2020 2020 2020 2020 7072   .            pr
-00073a50: 696e 7428 275c 7253 6561 7263 6820 6973  int('\rSearch is
-00073a60: 6f66 6f72 6d73 2026 2065 7374 2061 6275  oforms & est abu
-00073a70: 6e64 616e 6365 7320 2e2e 2e2e 2e20 646f  ndances ..... do
-00073a80: 6e65 2028 2569 2920 2020 2020 2020 2020  ne (%i)         
-00073a90: 2020 2020 2020 2020 2720 2520 2869 6e74          ' % (int
-00073aa0: 2865 6c61 7073 6564 5f74 696d 6531 2929  (elapsed_time1))
-00073ab0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00073ac0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00073ad0: 7428 275c 7252 6563 6f76 6572 696e 6720  t('\rRecovering 
-00073ae0: 6973 6f66 6f72 6d73 2026 2065 7374 2061  isoforms & est a
-00073af0: 6275 6e64 616e 6365 7320 2e2e 2e2e 2e20  bundances ..... 
-00073b00: 646f 6e65 2028 2569 2c20 2569 2920 2020  done (%i, %i)   
-00073b10: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
-00073b20: 2520 2869 6e74 2865 6c61 7073 6564 5f74  % (int(elapsed_t
-00073b30: 696d 6531 292c 206e 5f63 6f76 5f65 6829  ime1), n_cov_eh)
-00073b40: 290a 2020 2020 0a20 2020 2064 203d 207b  ).    .    d = {
-00073b50: 2767 7369 7a65 273a 2067 7369 7a65 2c20  'gsize': gsize, 
-00073b60: 2767 766f 6c27 3a20 6776 6f6c 2c20 2763  'gvol': gvol, 'c
-00073b70: 645f 7468 273a 2063 645f 7468 2c20 2777  d_th': cd_th, 'w
-00073b80: 5f63 6e74 273a 2077 5f63 6e74 207d 0a20  _cnt': w_cnt }. 
-00073b90: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
-00073ba0: 7261 6d65 2864 6174 6120 3d20 6429 0a20  rame(data = d). 
-00073bb0: 2020 200a 2020 2020 7265 7475 726e 2054     .    return T
-00073bc0: 725f 6c73 742c 2049 735f 6c73 742c 2047  r_lst, Is_lst, G
-00073bd0: 5446 5f6c 7374 2c20 6466 2c20 6772 705f  TF_lst, df, grp_
-00073be0: 6c73 742c 2067 645f 6c73 742c 2065 7473  lst, gd_lst, ets
-00073bf0: 5f73 756d 2c20 6574 785f 7375 6d20 2320  _sum, etx_sum # 
-00073c00: 6d6e 5f6c 7374 0a0a 0a64 6566 2067 6574  mn_lst...def get
-00073c10: 5f74 7261 6e73 6372 6970 7473 2820 7267  _transcripts( rg
-00073c20: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
-00073c30: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
-00073c40: 5f73 742c 2072 6561 645f 6c65 6e2c 2061  _st, read_len, a
-00073c50: 6e6e 6f74 203d 204e 6f6e 652c 206c 656e  nnot = None, len
-00073c60: 5f74 6820 3d20 4d49 4e5f 5452 5f4c 454e  _th = MIN_TR_LEN
-00073c70: 4754 482c 205c 0a20 2020 2020 2020 2020  GTH, \.         
-00073c80: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-00073c90: 6f64 203d 2027 6c61 7373 6f27 2c20 6e72  od = 'lasso', nr
-00073ca0: 6563 203d 2030 2c20 7374 6172 7420 3d20  ec = 0, start = 
-00073cb0: 302c 2076 6572 626f 7365 203d 2054 7275  0, verbose = Tru
-00073cc0: 652c 2073 6469 7620 3d20 3230 2029 3a0a  e, sdiv = 20 ):.
-00073cd0: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
-00073ce0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-00073cf0: 2020 636e 7470 203d 2030 3b20 636e 746e    cntp = 0; cntn
-00073d00: 203d 2030 3b20 636e 7430 203d 2030 3b20   = 0; cnt0 = 0; 
-00073d10: 636e 7466 203d 2030 3b20 636e 7467 203d  cntf = 0; cntg =
-00073d20: 2030 0a20 2020 2066 7020 3d20 303b 2066   0.    fp = 0; f
-00073d30: 6e20 3d20 303b 2066 3020 3d20 303b 2066  n = 0; f0 = 0; f
-00073d40: 6620 3d20 300a 0a20 2020 206e 5f74 7220  f = 0..    n_tr 
-00073d50: 3d20 300a 2020 2020 4754 465f 6c73 7420  = 0.    GTF_lst 
-00073d60: 3d20 5b5d 0a20 2020 2054 725f 6c73 7420  = [].    Tr_lst 
-00073d70: 3d20 5b5d 0a20 2020 2049 735f 6c73 7420  = [].    Is_lst 
-00073d80: 3d20 5b5d 0a20 2020 206d 6e5f 6c73 7420  = [].    mn_lst 
-00073d90: 3d20 5b5d 0a20 2020 2067 7270 5f6c 7374  = [].    grp_lst
-00073da0: 203d 205b 5d0a 2020 2020 6764 5f6c 7374   = [].    gd_lst
-00073db0: 203d 205b 5d0a 2020 2020 6364 5f74 6820   = [].    cd_th 
-00073dc0: 3d20 6e70 2e7a 6572 6f73 286c 656e 2872  = np.zeros(len(r
-00073dd0: 676e 735f 6c73 745f 6d69 292c 2064 7479  gns_lst_mi), dty
-00073de0: 7065 3d69 6e74 290a 2020 2020 775f 636e  pe=int).    w_cn
-00073df0: 7420 3d20 6e70 2e7a 6572 6f73 286c 656e  t = np.zeros(len
-00073e00: 2872 676e 735f 6c73 745f 6d69 292c 2064  (rgns_lst_mi), d
-00073e10: 7479 7065 3d69 6e74 290a 2020 2020 6773  type=int).    gs
-00073e20: 697a 6520 3d20 6e70 2e7a 6572 6f73 286c  ize = np.zeros(l
-00073e30: 656e 2872 676e 735f 6c73 745f 6d69 292c  en(rgns_lst_mi),
-00073e40: 2064 7479 7065 3d69 6e74 290a 2020 2020   dtype=int).    
-00073e50: 6776 6f6c 203d 206e 702e 7a65 726f 7328  gvol = np.zeros(
-00073e60: 6c65 6e28 7267 6e73 5f6c 7374 5f6d 6929  len(rgns_lst_mi)
-00073e70: 2c20 6474 7970 653d 696e 7429 0a0a 2020  , dtype=int)..  
-00073e80: 2020 6763 6e74 203d 2030 0a20 2020 2073    gcnt = 0.    s
-00073e90: 7461 7274 5f74 696d 6531 203d 2074 696d  tart_time1 = tim
-00073ea0: 652e 7469 6d65 2829 0a20 2020 2069 6620  e.time().    if 
-00073eb0: 7665 7262 6f73 653a 200a 2020 2020 2020  verbose: .      
-00073ec0: 2020 6966 2061 6e6e 6f74 2069 7320 4e6f    if annot is No
-00073ed0: 6e65 3a20 7072 696e 7428 275c 7253 6561  ne: print('\rSea
-00073ee0: 7263 6820 6973 6f66 6f72 6d73 2026 2065  rch isoforms & e
-00073ef0: 7374 2061 6275 6e64 616e 6365 7320 2e2e  st abundances ..
-00073f00: 2e2e 2e20 272c 2065 6e64 3d27 2729 0a20  ... ', end=''). 
-00073f10: 2020 2020 2020 2065 6c73 653a 2070 7269         else: pri
-00073f20: 6e74 2827 5c72 5265 636f 7665 7269 6e67  nt('\rRecovering
-00073f30: 2069 736f 666f 726d 7320 2620 6573 7420   isoforms & est 
-00073f40: 6162 756e 6461 6e63 6573 202e 2e2e 2e2e  abundances .....
-00073f50: 2027 2c20 656e 643d 2727 290a 2020 2020   ', end='').    
-00073f60: 2020 2020 0a20 2020 2023 2727 270a 2020      .    #'''.  
-00073f70: 2020 6776 203d 206e 702e 7a65 726f 7328    gv = np.zeros(
-00073f80: 6c65 6e28 7267 6e73 5f6c 7374 5f6e 6429  len(rgns_lst_nd)
-00073f90: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-00073fa0: 3332 290a 2020 2020 666f 7220 6b20 696e  32).    for k in
-00073fb0: 2072 616e 6765 286c 656e 2872 676e 735f   range(len(rgns_
-00073fc0: 6c73 745f 6e64 2929 3a0a 2020 2020 2020  lst_nd)):.      
-00073fd0: 2020 6776 5b6b 5d20 3d20 2d6c 656e 2872    gv[k] = -len(r
-00073fe0: 676e 735f 6c73 745f 6e64 5b6b 5d2e 7267  gns_lst_nd[k].rg
-00073ff0: 6e73 2920 2320 2d72 676e 735f 6c73 745f  ns) # -rgns_lst_
-00074000: 6d69 5b6b 5d2e 6765 745f 766f 6c75 6d65  mi[k].get_volume
-00074010: 2829 0a20 2020 206f 6472 203d 2067 762e  ().    odr = gv.
-00074020: 6172 6773 6f72 7428 290a 2020 2020 2327  argsort().    #'
-00074030: 2727 0a20 2020 200a 2020 2020 7273 5f74  ''.    .    rs_t
-00074040: 7570 6c65 5f6c 7374 203d 205b 5d0a 2020  uple_lst = [].  
-00074050: 2020 6966 2073 7461 7274 203d 3d20 303a    if start == 0:
-00074060: 0a20 2020 2020 2020 2069 6620 6e72 6563  .        if nrec
-00074070: 203d 3d20 303a 204e 7265 6320 3d20 6c65   == 0: Nrec = le
-00074080: 6e28 7267 6e73 5f6c 7374 5f6d 6929 0a20  n(rgns_lst_mi). 
-00074090: 2020 2020 2020 2065 6c73 653a 204e 7265         else: Nre
-000740a0: 6320 3d20 6e72 6563 0a20 2020 2065 6c73  c = nrec.    els
-000740b0: 653a 0a20 2020 2020 2020 204e 7265 6320  e:.        Nrec 
-000740c0: 3d20 6c65 6e28 7267 6e73 5f6c 7374 5f6d  = len(rgns_lst_m
-000740d0: 6929 0a20 2020 2020 2020 2069 6620 7374  i).        if st
-000740e0: 6172 7420 3e3d 204e 7265 633a 2073 7461  art >= Nrec: sta
-000740f0: 7274 203d 204e 7265 632d 310a 0a20 2020  rt = Nrec-1..   
-00074100: 2066 6f72 206d 2069 6e20 7261 6e67 6528   for m in range(
-00074110: 4e72 6563 2d73 7461 7274 293a 0a20 2020  Nrec-start):.   
-00074120: 2020 2020 206b 203d 206f 6472 5b6d 2b73       k = odr[m+s
-00074130: 7461 7274 5d0a 2020 2020 2020 2020 6764  tart].        gd
-00074140: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00074150: 6966 2028 616e 6e6f 7420 6973 206e 6f74  if (annot is not
-00074160: 204e 6f6e 6529 3a20 0a20 2020 2020 2020   None): .       
-00074170: 2020 2020 2069 6620 6b20 3c20 6c65 6e28       if k < len(
-00074180: 616e 6e6f 7429 3a20 6764 203d 2061 6e6e  annot): gd = ann
-00074190: 6f74 5b6b 5d0a 2020 2020 2020 2020 7273  ot[k].        rs
-000741a0: 5f74 7570 6c65 5f6c 7374 2e61 7070 656e  _tuple_lst.appen
-000741b0: 6428 2028 7267 6e73 5f6c 7374 5f6d 695b  d( (rgns_lst_mi[
-000741c0: 6b5d 2c20 7267 6e73 5f6c 7374 5f6e 645b  k], rgns_lst_nd[
-000741d0: 6b5d 2c20 7267 6e73 5f6c 7374 5f73 745b  k], rgns_lst_st[
-000741e0: 6b5d 2c20 6b2c 205c 0a20 2020 2020 2020  k], k, \.       
-000741f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074200: 2020 2020 2020 206c 656e 5f74 682c 206d         len_th, m
-00074210: 6574 686f 642c 2072 6561 645f 6c65 6e2c  ethod, read_len,
-00074220: 2067 6429 2029 0a0a 2020 2020 6574 735f   gd) )..    ets_
-00074230: 7375 6d20 3d20 3020 2020 2020 2020 200a  sum = 0        .
-00074240: 2020 2020 6574 785f 7375 6d20 3d20 3020      etx_sum = 0 
-00074250: 2020 2020 2020 200a 2020 2020 666f 7220         .    for 
-00074260: 6d20 696e 2072 616e 6765 286c 656e 2872  m in range(len(r
-00074270: 735f 7475 706c 655f 6c73 7429 293a 0a20  s_tuple_lst)):. 
-00074280: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00074290: 746c 7374 2c20 696c 7374 2c20 6774 665f  tlst, ilst, gtf_
-000742a0: 6c69 6e65 732c 2067 732c 2067 762c 206d  lines, gs, gv, m
-000742b0: 6e2c 2063 742c 2067 7270 2c20 6b2c 2067  n, ct, grp, k, g
-000742c0: 642c 2065 7473 2c20 6574 7820 3d20 6d63  d, ets, etx = mc
-000742d0: 5f63 6f72 655f 6765 745f 7472 2872 735f  _core_get_tr(rs_
-000742e0: 7475 706c 655f 6c73 745b 6d5d 290a 2020  tuple_lst[m]).  
-000742f0: 2020 2020 2020 0a20 2020 2020 2020 2065        .        e
-00074300: 7473 5f73 756d 203d 2065 7473 5f73 756d  ts_sum = ets_sum
-00074310: 202b 2065 7473 0a20 2020 2020 2020 2065   + ets.        e
-00074320: 7478 5f73 756d 203d 2065 7478 5f73 756d  tx_sum = etx_sum
-00074330: 202b 2065 7478 0a0a 2020 2020 2020 2020   + etx..        
-00074340: 5472 5f6c 7374 203d 2054 725f 6c73 7420  Tr_lst = Tr_lst 
-00074350: 2b20 746c 7374 0a20 2020 2020 2020 2049  + tlst.        I
-00074360: 735f 6c73 7420 3d20 4973 5f6c 7374 202b  s_lst = Is_lst +
-00074370: 2069 6c73 740a 2020 2020 2020 2020 4754   ilst.        GT
-00074380: 465f 6c73 7420 3d20 4754 465f 6c73 7420  F_lst = GTF_lst 
-00074390: 2b20 6774 665f 6c69 6e65 730a 2020 2020  + gtf_lines.    
-000743a0: 2020 2020 6773 697a 655b 6b5d 203d 2067      gsize[k] = g
-000743b0: 730a 2020 2020 2020 2020 6776 6f6c 5b6b  s.        gvol[k
-000743c0: 5d20 3d20 6776 0a20 2020 2020 2020 2063  ] = gv.        c
-000743d0: 645f 7468 5b6b 5d20 3d20 6d6e 0a20 2020  d_th[k] = mn.   
-000743e0: 2020 2020 2077 5f63 6e74 5b6b 5d20 3d20       w_cnt[k] = 
-000743f0: 6374 0a20 2020 2020 2020 2069 6620 6772  ct.        if gr
-00074400: 7020 6973 206e 6f74 204e 6f6e 653a 200a  p is not None: .
-00074410: 2020 2020 2020 2020 2020 2020 6772 705f              grp_
-00074420: 6c73 742e 6170 7065 6e64 2867 7270 290a  lst.append(grp).
-00074430: 2020 2020 2020 2020 2020 2020 6764 5f6c              gd_l
-00074440: 7374 2e61 7070 656e 6428 6764 290a 0a20  st.append(gd).. 
-00074450: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-00074460: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-00074470: 6966 206d 203e 2030 3a0a 2020 2020 2020  if m > 0:.      
-00074480: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
-00074490: 645f 7469 6d65 203d 2074 696d 652e 7469  d_time = time.ti
-000744a0: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
-000744b0: 6531 0a20 2020 2020 2020 2020 2020 2020  e1.             
-000744c0: 2020 2074 5f74 696d 6520 3d20 656c 6170     t_time = elap
-000744d0: 7365 645f 7469 6d65 2a6c 656e 2872 735f  sed_time*len(rs_
-000744e0: 7475 706c 655f 6c73 7429 2f6d 0a20 2020  tuple_lst)/m.   
-000744f0: 2020 2020 2020 2020 2020 2020 2072 5f74               r_t
-00074500: 696d 6520 3d20 745f 7469 6d65 202d 2065  ime = t_time - e
-00074510: 6c61 7073 6564 5f74 696d 650a 2020 2020  lapsed_time.    
-00074520: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00074530: 2531 3030 203d 3d20 303a 0a20 2020 2020  %100 == 0:.     
-00074540: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00074550: 6620 616e 6e6f 7420 6973 204e 6f6e 653a  f annot is None:
-00074560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00074570: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00074580: 5c72 5365 6172 6368 2069 736f 666f 726d  \rSearch isoform
-00074590: 7320 2620 6573 7420 6162 756e 6461 6e63  s & est abundanc
-000745a0: 6573 202e 2e2e 2e2e 2025 692f 2569 2020  es ..... %i/%i  
-000745b0: 2027 205c 0a20 2020 2020 2020 2020 2020   ' \.           
-000745c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000745d0: 2020 2020 2520 2869 6e74 2872 5f74 696d      % (int(r_tim
-000745e0: 6529 2c20 6d2c 206c 656e 2872 735f 7475  e), m, len(rs_tu
-000745f0: 706c 655f 6c73 7429 292c 2065 6e64 3d27  ple_lst)), end='
-00074600: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00074610: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00074620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074630: 2020 2020 2070 7269 6e74 2827 5c72 5265       print('\rRe
-00074640: 636f 7665 7269 6e67 2069 736f 666f 726d  covering isoform
-00074650: 7320 2620 6573 7420 6162 756e 6461 6e63  s & est abundanc
-00074660: 6573 202e 2e2e 2e2e 2025 692f 2569 2020  es ..... %i/%i  
-00074670: 2027 205c 0a20 2020 2020 2020 2020 2020   ' \.           
-00074680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074690: 2020 2020 2520 286d 2c20 6c65 6e28 7273      % (m, len(rs
-000746a0: 5f74 7570 6c65 5f6c 7374 2929 2c20 656e  _tuple_lst)), en
-000746b0: 643d 2727 290a 2020 2020 0a20 2020 2069  d='').    .    i
-000746c0: 6620 7665 7262 6f73 653a 200a 2020 2020  f verbose: .    
-000746d0: 2020 2020 656c 6170 7365 645f 7469 6d65      elapsed_time
-000746e0: 3120 3d20 7469 6d65 2e74 696d 6528 2920  1 = time.time() 
-000746f0: 2d20 7374 6172 745f 7469 6d65 310a 2020  - start_time1.  
-00074700: 2020 2020 2020 6966 2061 6e6e 6f74 2069        if annot i
-00074710: 7320 4e6f 6e65 3a20 0a20 2020 2020 2020  s None: .       
-00074720: 2020 2020 2070 7269 6e74 2827 5c72 5365       print('\rSe
-00074730: 6172 6368 2069 736f 666f 726d 7320 2620  arch isoforms & 
-00074740: 6573 7420 6162 756e 6461 6e63 6573 202e  est abundances .
-00074750: 2e2e 2e2e 2064 6f6e 6520 2825 6929 2020  .... done (%i)  
-00074760: 2020 2020 2020 2020 2020 2020 2027 2025               ' %
-00074770: 2028 696e 7428 656c 6170 7365 645f 7469   (int(elapsed_ti
-00074780: 6d65 3129 2929 0a20 2020 2020 2020 2065  me1))).        e
-00074790: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000747a0: 2070 7269 6e74 2827 5c72 5265 636f 7665   print('\rRecove
-000747b0: 7269 6e67 2069 736f 666f 726d 7320 2620  ring isoforms & 
-000747c0: 6573 7420 6162 756e 6461 6e63 6573 202e  est abundances .
-000747d0: 2e2e 2e2e 2064 6f6e 6520 2825 6929 2020  .... done (%i)  
-000747e0: 2020 2020 2020 2020 2020 2020 2027 2025               ' %
-000747f0: 2028 696e 7428 656c 6170 7365 645f 7469   (int(elapsed_ti
-00074800: 6d65 3129 2929 0a20 2020 200a 2020 2020  me1))).    .    
-00074810: 6420 3d20 7b27 6773 697a 6527 3a20 6773  d = {'gsize': gs
-00074820: 697a 652c 2027 6776 6f6c 273a 2067 766f  ize, 'gvol': gvo
-00074830: 6c2c 2027 6364 5f74 6827 3a20 6364 5f74  l, 'cd_th': cd_t
-00074840: 682c 2027 775f 636e 7427 3a20 775f 636e  h, 'w_cnt': w_cn
-00074850: 7420 7d0a 2020 2020 6466 203d 2070 642e  t }.    df = pd.
-00074860: 4461 7461 4672 616d 6528 6461 7461 203d  DataFrame(data =
-00074870: 2064 290a 2020 2020 0a20 2020 2072 6574   d).    .    ret
-00074880: 7572 6e20 5472 5f6c 7374 2c20 4973 5f6c  urn Tr_lst, Is_l
-00074890: 7374 2c20 4754 465f 6c73 742c 2064 662c  st, GTF_lst, df,
-000748a0: 2067 7270 5f6c 7374 2c20 6764 5f6c 7374   grp_lst, gd_lst
-000748b0: 2c20 6574 735f 7375 6d2c 2065 7478 5f73  , ets_sum, etx_s
-000748c0: 756d 2023 206d 6e5f 6c73 740a 0a0a 2323  um # mn_lst...##
-000748d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000748e0: 2323 2323 2323 2323 2323 0a23 2323 2320  ##########.#### 
-000748f0: 5374 7269 6e67 4669 7820 6d61 696e 2023  StringFix main #
-00074900: 2323 2323 2323 230a 0a64 6566 2067 6574  #######..def get
-00074910: 5f74 706d 2874 725f 6c73 7429 3a0a 2020  _tpm(tr_lst):.  
-00074920: 2020 0a20 2020 2061 626e 5f74 6f74 616c    .    abn_total
-00074930: 203d 2030 0a20 2020 2066 6f72 2074 7220   = 0.    for tr 
-00074940: 696e 2074 725f 6c73 743a 0a20 2020 2020  in tr_lst:.     
-00074950: 2020 2061 626e 5f74 6f74 616c 202b 3d20     abn_total += 
-00074960: 7472 2e61 626e 0a20 2020 206e 6620 3d20  tr.abn.    nf = 
-00074970: 3130 3030 3030 302f 6162 6e5f 746f 7461  1000000/abn_tota
-00074980: 6c0a 0a20 2020 2074 725f 6c73 745f 6f75  l..    tr_lst_ou
-00074990: 7420 3d20 5b5d 0a20 2020 2066 6f72 2074  t = [].    for t
-000749a0: 2069 6e20 7472 5f6c 7374 3a0a 2020 2020   in tr_lst:.    
-000749b0: 2020 2020 5450 4d20 3d20 742e 7470 6d2a      TPM = t.tpm*
-000749c0: 6e66 0a20 2020 2020 2020 2074 7220 3d20  nf.        tr = 
-000749d0: 5472 616e 7363 7269 7074 2874 2e70 7265  Transcript(t.pre
-000749e0: 6669 782c 742e 6769 6478 2c74 2e67 7270  fix,t.gidx,t.grp
-000749f0: 5f73 697a 652c 742e 6963 6e74 2c74 2e63  _size,t.icnt,t.c
-00074a00: 6872 2c74 2e73 7461 7274 2c74 2e65 6e64  hr,t.start,t.end
-00074a10: 2c74 2e73 7472 616e 642c 2074 2e63 646e  ,t.strand, t.cdn
-00074a20: 672c 205c 0a20 2020 2020 2020 2020 2020  g, \.           
-00074a30: 2020 2020 2020 2020 2020 2020 2074 2e73               t.s
-00074a40: 6571 2c74 2e61 626e 2c20 5450 4d2c 2074  eq,t.abn, TPM, t
-00074a50: 2e69 736f 5f66 7261 632c 2074 2e70 726f  .iso_frac, t.pro
-00074a60: 622c 2074 2e6e 6578 732c 2074 2e67 766f  b, t.nexs, t.gvo
-00074a70: 6c29 0a20 2020 2020 2020 2074 725f 6c73  l).        tr_ls
-00074a80: 745f 6f75 742e 6170 7065 6e64 2874 7229  t_out.append(tr)
-00074a90: 0a20 2020 2020 2020 200a 2020 2020 7265  .        .    re
-00074aa0: 7475 726e 2874 725f 6c73 745f 6f75 7429  turn(tr_lst_out)
-00074ab0: 0a0a 6465 6620 6669 6c74 6572 5f72 676e  ..def filter_rgn
-00074ac0: 7328 2072 5f6c 7374 5f6d 2c20 725f 6c73  s( r_lst_m, r_ls
-00074ad0: 745f 6e64 2c20 725f 6c73 745f 7374 692c  t_nd, r_lst_sti,
-00074ae0: 2076 6f6c 5f74 682c 2073 5f74 6820 3d20   vol_th, s_th = 
-00074af0: 302e 3920 293a 0a20 2020 200a 2020 2020  0.9 ):.    .    
-00074b00: 746f 5f64 656c 203d 205b 5d0a 2020 2020  to_del = [].    
-00074b10: 666f 7220 6b2c 2072 2069 6e20 656e 756d  for k, r in enum
-00074b20: 6572 6174 6528 725f 6c73 745f 6d29 3a0a  erate(r_lst_m):.
-00074b30: 2020 2020 2020 2020 766f 6c20 3d20 722e          vol = r.
-00074b40: 6765 745f 766f 6c75 6d65 2829 2023 202b  get_volume() # +
-00074b50: 2072 2e67 6574 5f76 6f6c 756d 6528 290a   r.get_volume().
-00074b60: 2020 2020 2020 2020 6966 2028 766f 6c20          if (vol 
-00074b70: 3c20 766f 6c5f 7468 293a 0a20 2020 2020  < vol_th):.     
-00074b80: 2020 2020 2020 2074 6f5f 6465 6c2e 6170         to_del.ap
-00074b90: 7065 6e64 286b 290a 2020 2020 2020 2020  pend(k).        
-00074ba0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00074bb0: 2020 6966 2072 2e63 6e74 5f72 203e 2030    if r.cnt_r > 0
-00074bc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00074bd0: 2020 6966 2072 2e63 6e74 5f73 2f72 2e63    if r.cnt_s/r.c
-00074be0: 6e74 5f72 203e 2073 5f74 683a 2074 6f5f  nt_r > s_th: to_
-00074bf0: 6465 6c2e 6170 7065 6e64 286b 290a 2020  del.append(k).  
-00074c00: 2020 2020 2020 2020 2020 0a20 2020 2069            .    i
-00074c10: 6620 6c65 6e28 746f 5f64 656c 2920 3e20  f len(to_del) > 
-00074c20: 303a 0a20 2020 2020 2020 2074 6f5f 6465  0:.        to_de
-00074c30: 6c2e 736f 7274 2872 6576 6572 7365 3d54  l.sort(reverse=T
-00074c40: 7275 6529 0a20 2020 2020 2020 2066 6f72  rue).        for
-00074c50: 206b 2069 6e20 746f 5f64 656c 3a20 0a20   k in to_del: . 
-00074c60: 2020 2020 2020 2020 2020 2064 656c 2072             del r
-00074c70: 5f6c 7374 5f6d 5b6b 5d0a 2020 2020 2020  _lst_m[k].      
-00074c80: 2020 2020 2020 6465 6c20 725f 6c73 745f        del r_lst_
-00074c90: 6e64 5b6b 5d0a 2020 2020 2020 2020 2020  nd[k].          
-00074ca0: 2020 6465 6c20 725f 6c73 745f 7374 695b    del r_lst_sti[
-00074cb0: 6b5d 0a20 2020 200a 2020 2020 7265 7475  k].    .    retu
-00074cc0: 726e 2872 5f6c 7374 5f6d 2c20 725f 6c73  rn(r_lst_m, r_ls
-00074cd0: 745f 6e64 2c20 725f 6c73 745f 7374 6929  t_nd, r_lst_sti)
-00074ce0: 0a0a 0a64 6566 2066 696c 7465 725f 7267  ...def filter_rg
-00074cf0: 6e73 5f6f 6c64 2820 725f 6c73 745f 6d2c  ns_old( r_lst_m,
-00074d00: 2072 5f6c 7374 5f6e 642c 2076 6f6c 5f74   r_lst_nd, vol_t
-00074d10: 6820 293a 0a20 2020 200a 2020 2020 746f  h ):.    .    to
-00074d20: 5f64 656c 203d 205b 5d0a 2020 2020 666f  _del = [].    fo
-00074d30: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
-00074d40: 2872 5f6c 7374 5f6d 2929 3a0a 2020 2020  (r_lst_m)):.    
-00074d50: 2020 2020 766f 6c20 3d20 725f 6c73 745f      vol = r_lst_
-00074d60: 6d5b 6b5d 2e67 6574 5f76 6f6c 756d 6528  m[k].get_volume(
-00074d70: 290a 2020 2020 2020 2020 6966 2076 6f6c  ).        if vol
-00074d80: 203c 2076 6f6c 5f74 683a 0a20 2020 2020   < vol_th:.     
-00074d90: 2020 2020 2020 2074 6f5f 6465 6c2e 6170         to_del.ap
-00074da0: 7065 6e64 286b 290a 2020 2020 2020 2020  pend(k).        
-00074db0: 2020 2020 0a20 2020 2069 6620 6c65 6e28      .    if len(
-00074dc0: 746f 5f64 656c 2920 3e20 303a 0a20 2020  to_del) > 0:.   
-00074dd0: 2020 2020 2074 6f5f 6465 6c2e 736f 7274       to_del.sort
-00074de0: 2872 6576 6572 7365 3d54 7275 6529 0a20  (reverse=True). 
-00074df0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-00074e00: 746f 5f64 656c 3a20 0a20 2020 2020 2020  to_del: .       
-00074e10: 2020 2020 2064 656c 2072 5f6c 7374 5f6d       del r_lst_m
-00074e20: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
-00074e30: 6465 6c20 725f 6c73 745f 6e64 5b6b 5d0a  del r_lst_nd[k].
-00074e40: 2020 2020 0a20 2020 2072 6574 7572 6e28      .    return(
-00074e50: 725f 6c73 745f 6d2c 2072 5f6c 7374 5f6e  r_lst_m, r_lst_n
-00074e60: 6429 0a0a 0a23 2323 2044 6566 6175 6c74  d)...### Default
-00074e70: 2054 7273 2046 696c 7465 7220 7061 7261   Trs Filter para
-00074e80: 6d65 7465 7273 0a64 6566 2063 6865 636b  meters.def check
-00074e90: 5f72 676e 7328 2072 676e 735f 6c73 745f  _rgns( rgns_lst_
-00074ea0: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 6420  mi, rgns_lst_nd 
-00074eb0: 293a 0a0a 2020 2020 636e 7420 3d20 300a  ):..    cnt = 0.
-00074ec0: 2020 2020 765f 746f 7420 3d20 300a 2020      v_tot = 0.  
-00074ed0: 2020 765f 6879 6220 3d20 300a 2020 2020    v_hyb = 0.    
-00074ee0: 666f 7220 6b20 696e 2072 616e 6765 286c  for k in range(l
-00074ef0: 656e 2872 676e 735f 6c73 745f 6d69 2929  en(rgns_lst_mi))
-00074f00: 3a0a 2020 2020 2020 2020 6376 6f6c 203d  :.        cvol =
-00074f10: 2072 676e 735f 6c73 745f 6d69 5b6b 5d2e   rgns_lst_mi[k].
-00074f20: 6765 745f 766f 6c75 6d65 2829 0a20 2020  get_volume().   
-00074f30: 2020 2020 2076 5f74 6f74 202b 3d20 6376       v_tot += cv
-00074f40: 6f6c 0a20 2020 2020 2020 2063 7020 3d20  ol.        cp = 
-00074f50: 300a 2020 2020 2020 2020 636e 203d 2030  0.        cn = 0
-00074f60: 0a20 2020 2020 2020 2066 6f72 206d 2069  .        for m i
-00074f70: 6e20 7261 6e67 6528 6c65 6e28 7267 6e73  n range(len(rgns
-00074f80: 5f6c 7374 5f6e 645b 6b5d 2e72 676e 7329  _lst_nd[k].rgns)
-00074f90: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00074fa0: 6620 7267 6e73 5f6c 7374 5f6e 645b 6b5d  f rgns_lst_nd[k]
-00074fb0: 2e72 676e 735b 6d5d 2e78 7320 3c20 303a  .rgns[m].xs < 0:
-00074fc0: 2063 6e20 2b3d 2031 0a20 2020 2020 2020   cn += 1.       
-00074fd0: 2020 2020 2065 6c69 6620 7267 6e73 5f6c       elif rgns_l
-00074fe0: 7374 5f6e 645b 6b5d 2e72 676e 735b 6d5d  st_nd[k].rgns[m]
-00074ff0: 2e78 7320 3e20 303a 2063 7020 2b3d 2031  .xs > 0: cp += 1
-00075000: 0a20 2020 2020 2020 2069 6620 2863 7020  .        if (cp 
-00075010: 3e20 3029 2026 2028 636e 203e 2030 293a  > 0) & (cn > 0):
-00075020: 0a20 2020 2020 2020 2020 2020 2076 5f68  .            v_h
-00075030: 7962 202b 3d20 6376 6f6c 0a20 2020 2020  yb += cvol.     
-00075040: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
-00075050: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00075060: 696e 7428 273d 3d3d 2025 6920 3d3d 3d27  int('=== %i ==='
-00075070: 2025 206b 290a 2020 2020 2020 2020 2020   % k).          
-00075080: 2020 2320 7267 6e73 5f6c 7374 5f6d 695b    # rgns_lst_mi[
-00075090: 6b5d 2e70 7269 6e74 5f73 686f 7274 2829  k].print_short()
-000750a0: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
-000750b0: 676e 735f 6c73 745f 6e64 5b6b 5d2e 7072  gns_lst_nd[k].pr
-000750c0: 696e 745f 7368 6f72 7428 290a 2020 2020  int_short().    
-000750d0: 2020 2020 2020 2020 0a20 2020 2072 6574          .    ret
-000750e0: 7572 6e20 636e 742c 2076 5f68 7962 2c20  urn cnt, v_hyb, 
-000750f0: 765f 746f 740a 2020 2020 0a0a 2727 270a  v_tot.    ..'''.
-00075100: 4c49 4e45 5f56 414c 4944 203d 2030 0a4e  LINE_VALID = 0.N
-00075110: 4f5f 4d4f 5245 5f4c 494e 4520 3d20 340a  O_MORE_LINE = 4.
-00075120: 4c49 4e45 5f49 4e56 414c 4944 203d 2032  LINE_INVALID = 2
-00075130: 0a0a 434f 4e54 494e 5545 4420 3d20 300a  ..CONTINUED = 0.
-00075140: 4e45 575f 4348 524d 203d 2031 0a23 204c  NEW_CHRM = 1.# L
-00075150: 494e 455f 494e 5641 4c49 4420 3d20 320a  INE_INVALID = 2.
-00075160: 4e4f 545f 534f 5254 4544 203d 2033 0a27  NOT_SORTED = 3.'
-00075170: 2727 0a0a 6465 6620 6368 6563 6b5f 7374  ''..def check_st
-00075180: 7261 6e64 2820 725f 6d5f 6c73 742c 2072  rand( r_m_lst, r
-00075190: 5f6e 645f 6c73 7420 293a 0a20 2020 200a  _nd_lst ):.    .
-000751a0: 2020 2020 706f 7320 3d20 300a 2020 2020      pos = 0.    
-000751b0: 6e65 6720 3d20 300a 2020 2020 666f 7220  neg = 0.    for 
-000751c0: 7220 696e 2072 5f6e 645f 6c73 743a 0a20  r in r_nd_lst:. 
-000751d0: 2020 2020 2020 2069 6620 6c65 6e28 722e         if len(r.
-000751e0: 7267 6e73 2920 3e20 303a 0a20 2020 2020  rgns) > 0:.     
-000751f0: 2020 2020 2020 2069 6620 722e 7267 6e73         if r.rgns
-00075200: 5b30 5d2e 7873 203e 2030 3a20 706f 7320  [0].xs > 0: pos 
-00075210: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00075220: 2065 6c69 6620 722e 7267 6e73 5b30 5d2e   elif r.rgns[0].
-00075230: 7873 203c 2030 3a20 6e65 6720 2b3d 2031  xs < 0: neg += 1
-00075240: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00075250: 2020 666f 7220 7220 696e 2072 5f6d 5f6c    for r in r_m_l
-00075260: 7374 3a0a 2020 2020 2020 2020 6966 206c  st:.        if l
-00075270: 656e 2872 2e72 676e 7329 203e 2030 3a0a  en(r.rgns) > 0:.
-00075280: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00075290: 2e72 676e 735b 305d 2e78 7320 3e20 303a  .rgns[0].xs > 0:
-000752a0: 2070 6f73 202b 3d20 310a 2020 2020 2020   pos += 1.      
-000752b0: 2020 2020 2020 656c 6966 2072 2e72 676e        elif r.rgn
-000752c0: 735b 305d 2e78 7320 3c20 303a 206e 6567  s[0].xs < 0: neg
-000752d0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-000752e0: 2020 0a20 2020 2072 6574 7572 6e20 706f    .    return po
-000752f0: 732c 206e 6567 0a0a 0a64 6566 206d 635f  s, neg...def mc_
-00075300: 636f 7265 5f62 7569 6c64 5f63 6e74 6728  core_build_cntg(
-00075310: 7361 6d5f 6c73 745f 6e5f 7361 293a 0a20  sam_lst_n_sa):. 
-00075320: 2020 200a 2020 2020 6220 3d20 5472 7565     .    b = True
-00075330: 0a20 2020 2073 616d 5f6c 7374 2c20 7361  .    sam_lst, sa
-00075340: 203d 2073 616d 5f6c 7374 5f6e 5f73 615b   = sam_lst_n_sa[
-00075350: 3a2d 315d 2c20 7361 6d5f 6c73 745f 6e5f  :-1], sam_lst_n_
-00075360: 7361 5b2d 315d 2020 2020 2020 2020 0a20  sa[-1]        . 
-00075370: 2020 2069 6620 286c 656e 2873 616d 5f6c     if (len(sam_l
-00075380: 7374 2920 3e3d 204d 494e 5f4e 5f52 4453  st) >= MIN_N_RDS
-00075390: 5f50 4552 5f47 454e 4529 3a20 2320 4d49  _PER_GENE): # MI
-000753a0: 4e5f 5244 5f4e 554d 5f50 4552 5f47 454e  N_RD_NUM_PER_GEN
-000753b0: 4529 3a20 2320 2620 2828 6370 3d3d 3029  E): # & ((cp==0)
-000753c0: 207c 2028 636e 3d3d 3029 293a 0a0a 2020   | (cn==0)):..  
-000753d0: 2020 2020 2020 725f 6c73 745f 6d2c 2072        r_lst_m, r
-000753e0: 5f6c 7374 5f6e 642c 2072 5f6c 7374 5f73  _lst_nd, r_lst_s
-000753f0: 7469 2c20 7267 6e5f 6964 7820 3d20 5c0a  ti, rgn_idx = \.
-00075400: 2020 2020 2020 2020 2020 2020 6765 745f              get_
-00075410: 7265 6769 6f6e 735f 616c 6c5f 6672 6f6d  regions_all_from
-00075420: 5f73 616d 2820 7361 6d5f 6c73 742c 2073  _sam( sam_lst, s
-00075430: 6120 3d20 7361 2029 0a20 2020 2020 2020  a = sa ).       
-00075440: 2062 203d 2046 616c 7365 0a20 2020 2020   b = False.     
-00075450: 2020 2073 616d 5f6c 7374 203d 204e 6f6e     sam_lst = Non
-00075460: 6520 2320 5b5d 0a20 2020 2020 2020 2020  e # [].         
-00075470: 2020 200a 2020 2020 6966 2062 3a0a 2020     .    if b:.  
-00075480: 2020 2020 2020 725f 6c73 745f 6d20 3d20        r_lst_m = 
-00075490: 5b5d 0a20 2020 2020 2020 2072 5f6c 7374  [].        r_lst
-000754a0: 5f6e 6420 3d20 5b5d 0a20 2020 2020 2020  _nd = [].       
-000754b0: 2072 5f6c 7374 5f73 7469 203d 205b 5d0a   r_lst_sti = [].
-000754c0: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
-000754d0: 725f 6c73 745f 6d2c 2072 5f6c 7374 5f6e  r_lst_m, r_lst_n
-000754e0: 642c 2072 5f6c 7374 5f73 7469 0a0a 0a64  d, r_lst_sti...d
-000754f0: 6566 2062 7569 6c64 5f63 6f6e 7469 6773  ef build_contigs
-00075500: 2873 5f6c 7374 5f6f 665f 6c73 742c 2074  (s_lst_of_lst, t
-00075510: 6974 6c65 203d 2027 2729 3a0a 2020 2020  itle = ''):.    
-00075520: 0a20 2020 2072 676e 735f 6c73 745f 6d69  .    rgns_lst_mi
-00075530: 203d 205b 5d0a 2020 2020 7267 6e73 5f6c   = [].    rgns_l
-00075540: 7374 5f6e 6420 3d20 5b5d 0a20 2020 2072  st_nd = [].    r
-00075550: 676e 735f 6c73 745f 7374 203d 205b 5d0a  gns_lst_st = [].
-00075560: 2020 2020 0a20 2020 2066 6f72 206b 2c20      .    for k, 
-00075570: 735f 6c73 7420 696e 2065 6e75 6d65 7261  s_lst in enumera
-00075580: 7465 2873 5f6c 7374 5f6f 665f 6c73 7429  te(s_lst_of_lst)
-00075590: 3a0a 2020 2020 2020 2020 0a20 2020 2020  :.        .     
-000755a0: 2020 2072 5f6c 7374 5f6d 692c 2072 5f6c     r_lst_mi, r_l
-000755b0: 7374 5f6e 642c 2072 5f6c 7374 5f73 7420  st_nd, r_lst_st 
-000755c0: 3d20 6d63 5f63 6f72 655f 6275 696c 645f  = mc_core_build_
-000755d0: 636e 7467 2873 5f6c 7374 290a 2020 2020  cntg(s_lst).    
-000755e0: 2020 2020 7267 6e73 5f6c 7374 5f6d 6920      rgns_lst_mi 
-000755f0: 3d20 7267 6e73 5f6c 7374 5f6d 6920 2b20  = rgns_lst_mi + 
-00075600: 725f 6c73 745f 6d69 0a20 2020 2020 2020  r_lst_mi.       
-00075610: 2072 676e 735f 6c73 745f 6e64 203d 2072   rgns_lst_nd = r
-00075620: 676e 735f 6c73 745f 6e64 202b 2072 5f6c  gns_lst_nd + r_l
-00075630: 7374 5f6e 640a 2020 2020 2020 2020 7267  st_nd.        rg
-00075640: 6e73 5f6c 7374 5f73 7420 3d20 7267 6e73  ns_lst_st = rgns
-00075650: 5f6c 7374 5f73 7420 2b20 725f 6c73 745f  _lst_st + r_lst_
-00075660: 7374 0a0a 2020 2020 2020 2020 6966 206b  st..        if k
-00075670: 2531 3030 203d 3d20 303a 0a20 2020 2020  %100 == 0:.     
-00075680: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
-00075690: 5c72 4275 696c 6469 6e67 206c 6f63 6920  \rBuilding loci 
-000756a0: 2620 434d 6174 202e 2e2e 2028 2569 2f25  & CMat ... (%i/%
-000756b0: 6967 2920 2020 2020 2020 2020 2020 2020  ig)             
-000756c0: 2020 2020 2020 2020 2020 2027 205c 0a20             ' \. 
-000756d0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-000756e0: 2020 2025 2028 6b2c 206c 656e 2873 5f6c     % (k, len(s_l
-000756f0: 7374 5f6f 665f 6c73 7429 292c 2065 6e64  st_of_lst)), end
-00075700: 3d27 2729 0a20 2020 2020 2020 2020 2020  ='').           
-00075710: 2070 7269 6e74 2827 5c72 2720 2b20 2720   print('\r' + ' 
-00075720: 272a 3130 302c 2065 6e64 3d27 272c 2066  '*100, end='', f
-00075730: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
-00075740: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00075750: 7469 746c 6529 203d 3d20 303a 0a20 2020  title) == 0:.   
-00075760: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00075770: 6e74 2827 5c72 4275 696c 6469 6e67 206c  nt('\rBuilding l
-00075780: 6f63 6920 2620 434d 6174 202e 2e2e 2028  oci & CMat ... (
-00075790: 2569 2f25 6963 2920 2720 5c0a 2020 2020  %i/%ic) ' \.    
-000757a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000757b0: 2020 2520 286b 2c20 6c65 6e28 735f 6c73    % (k, len(s_ls
-000757c0: 745f 6f66 5f6c 7374 2929 2c20 656e 643d  t_of_lst)), end=
-000757d0: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-000757e0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-000757f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00075800: 2020 2020 7072 696e 7428 275c 7220 2020      print('\r   
-00075810: 7072 6f63 6573 7369 6e67 2025 7320 2825  processing %s (%
-00075820: 692f 2569 6329 2027 205c 0a20 2020 2020  i/%ic) ' \.     
-00075830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00075840: 2025 2028 7469 746c 652c 206b 2c20 6c65   % (title, k, le
-00075850: 6e28 735f 6c73 745f 6f66 5f6c 7374 2929  n(s_lst_of_lst))
-00075860: 2c20 656e 643d 2727 2c20 666c 7573 6820  , end='', flush 
-00075870: 3d20 5472 7565 290a 2020 2020 0a20 2020  = True).    .   
-00075880: 2023 2070 7269 6e74 2827 5c72 4275 696c   # print('\rBuil
-00075890: 6469 6e67 206c 6f63 6920 2620 434d 6174  ding loci & CMat
-000758a0: 202e 2e2e 2064 6f6e 6520 2825 6967 2920   ... done (%ig) 
-000758b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000758c0: 2020 2020 2020 2027 2025 2028 6c65 6e28         ' % (len(
-000758d0: 735f 6c73 745f 6f66 5f6c 7374 2929 2c20  s_lst_of_lst)), 
-000758e0: 656e 643d 2727 290a 2020 2020 7265 7475  end='').    retu
-000758f0: 726e 2072 676e 735f 6c73 745f 6d69 2c20  rn rgns_lst_mi, 
-00075900: 7267 6e73 5f6c 7374 5f6e 642c 2072 676e  rgns_lst_nd, rgn
-00075910: 735f 6c73 745f 7374 0a0a 0a64 6566 2062  s_lst_st...def b
-00075920: 7569 6c64 5f63 6f6e 7469 6773 5f6d 6328  uild_contigs_mc(
-00075930: 735f 6c73 745f 6f66 5f6c 7374 2c20 6e5f  s_lst_of_lst, n_
-00075940: 636f 7265 7320 3d20 4e55 4d5f 434f 5245  cores = NUM_CORE
-00075950: 532c 2074 6974 6c65 203d 2027 2729 3a0a  S, title = ''):.
-00075960: 2020 2020 0a20 2020 2072 676e 735f 6c73      .    rgns_ls
-00075970: 745f 6d69 203d 205b 5d0a 2020 2020 7267  t_mi = [].    rg
-00075980: 6e73 5f6c 7374 5f6e 6420 3d20 5b5d 0a20  ns_lst_nd = []. 
-00075990: 2020 2072 676e 735f 6c73 745f 7374 203d     rgns_lst_st =
-000759a0: 205b 5d0a 2020 2020 0a20 2020 206e 756d   [].    .    num
-000759b0: 5f63 6f72 6520 3d20 6d61 7828 206d 696e  _core = max( min
-000759c0: 2820 6e5f 636f 7265 732c 2028 6370 755f  ( n_cores, (cpu_
-000759d0: 636f 756e 7428 2920 2d20 3129 2029 2c20  count() - 1) ), 
-000759e0: 3129 0a20 2020 2070 6f6f 6c20 3d20 506f  1).    pool = Po
-000759f0: 6f6c 286e 756d 5f63 6f72 6529 0a20 2020  ol(num_core).   
-00075a00: 2074 6f74 616c 5f69 7465 7261 7469 6f6e   total_iteration
-00075a10: 203d 206c 656e 2873 5f6c 7374 5f6f 665f   = len(s_lst_of_
-00075a20: 6c73 7429 0a20 2020 200a 2020 2020 6966  lst).    .    if
-00075a30: 2054 7275 653a 2023 206e 6f74 2054 5144   True: # not TQD
-00075a40: 4d3a 0a20 2020 2020 2020 200a 2020 2020  M:.        .    
-00075a50: 2020 2020 735f 6c73 745f 6f66 5f6c 7374      s_lst_of_lst
-00075a60: 2e73 6f72 7428 7265 7665 7273 6520 3d20  .sort(reverse = 
-00075a70: 5472 7565 2c20 6b65 793d 6c65 6e29 0a0a  True, key=len)..
-00075a80: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-00075a90: 7227 202b 2027 2027 2a31 3030 2c20 656e  r' + ' '*100, en
-00075aa0: 643d 2727 2c20 666c 7573 6820 3d20 5472  d='', flush = Tr
-00075ab0: 7565 290a 2020 2020 2020 2020 6966 206c  ue).        if l
-00075ac0: 656e 2874 6974 6c65 2920 3d3d 2030 3a0a  en(title) == 0:.
-00075ad0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00075ae0: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
-00075af0: 6369 2026 2043 4d61 7420 2e2e 2e20 2027  ci & CMat ...  '
-00075b00: 2c20 656e 643d 2727 2c20 666c 7573 6820  , end='', flush 
-00075b10: 3d20 5472 7565 290a 2020 2020 2020 2020  = True).        
-00075b20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00075b30: 2020 7072 696e 7428 275c 7220 2020 7072    print('\r   pr
-00075b40: 6f63 6573 7369 6e67 2025 7320 2e2e 2e20  ocessing %s ... 
-00075b50: 2720 2520 2874 6974 6c65 292c 2065 6e64  ' % (title), end
-00075b60: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
-00075b70: 6529 0a20 2020 2020 2020 206b 203d 2030  e).        k = 0
-00075b80: 0a20 2020 2020 2020 2066 6f72 2072 5f6c  .        for r_l
-00075b90: 7374 5f6d 692c 2072 5f6c 7374 5f6e 642c  st_mi, r_lst_nd,
-00075ba0: 2072 5f6c 7374 5f73 7420 696e 2070 6f6f   r_lst_st in poo
-00075bb0: 6c2e 696d 6170 5f75 6e6f 7264 6572 6564  l.imap_unordered
-00075bc0: 286d 635f 636f 7265 5f62 7569 6c64 5f63  (mc_core_build_c
-00075bd0: 6e74 672c 2073 5f6c 7374 5f6f 665f 6c73  ntg, s_lst_of_ls
-00075be0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00075bf0: 7267 6e73 5f6c 7374 5f6d 6920 3d20 7267  rgns_lst_mi = rg
-00075c00: 6e73 5f6c 7374 5f6d 6920 2b20 725f 6c73  ns_lst_mi + r_ls
-00075c10: 745f 6d69 0a20 2020 2020 2020 2020 2020  t_mi.           
-00075c20: 2072 676e 735f 6c73 745f 6e64 203d 2072   rgns_lst_nd = r
-00075c30: 676e 735f 6c73 745f 6e64 202b 2072 5f6c  gns_lst_nd + r_l
-00075c40: 7374 5f6e 640a 2020 2020 2020 2020 2020  st_nd.          
-00075c50: 2020 7267 6e73 5f6c 7374 5f73 7420 3d20    rgns_lst_st = 
-00075c60: 7267 6e73 5f6c 7374 5f73 7420 2b20 725f  rgns_lst_st + r_
-00075c70: 6c73 745f 7374 2020 2020 0a20 2020 2020  lst_st    .     
-00075c80: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00075c90: 2020 2020 6b20 2b3d 2031 0a20 2020 2020      k += 1.     
-00075ca0: 2020 2020 2020 2069 6620 6b25 3130 3020         if k%100 
-00075cb0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00075cc0: 2020 2020 2020 7072 696e 7428 275c 7227        print('\r'
-00075cd0: 202b 2027 2027 2a31 3030 2c20 656e 643d   + ' '*100, end=
-00075ce0: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-00075cf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00075d00: 2020 6966 206c 656e 2874 6974 6c65 2920    if len(title) 
-00075d10: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00075d20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00075d30: 275c 7242 7569 6c64 696e 6720 6c6f 6369  '\rBuilding loci
-00075d40: 2026 2043 4d61 7420 2e2e 2e20 2825 692f   & CMat ... (%i/
-00075d50: 2569 6329 2027 205c 0a20 2020 2020 2020  %ic) ' \.       
-00075d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00075d70: 2020 2025 2028 6b2c 2074 6f74 616c 5f69     % (k, total_i
-00075d80: 7465 7261 7469 6f6e 292c 2065 6e64 3d27  teration), end='
-00075d90: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
-00075da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00075db0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00075dc0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00075dd0: 2827 5c72 2020 2070 726f 6365 7373 696e  ('\r   processin
-00075de0: 6720 2573 202e 2e2e 2028 2569 2f25 6963  g %s ... (%i/%ic
-00075df0: 2920 2720 5c0a 2020 2020 2020 2020 2020  ) ' \.          
-00075e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00075e10: 2520 2874 6974 6c65 2c20 6b2c 2074 6f74  % (title, k, tot
-00075e20: 616c 5f69 7465 7261 7469 6f6e 292c 2065  al_iteration), e
-00075e30: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
-00075e40: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00075e50: 200a 2020 2020 706f 6f6c 2e63 6c6f 7365   .    pool.close
-00075e60: 2829 0a20 2020 2070 6f6f 6c2e 6a6f 696e  ().    pool.join
-00075e70: 2829 0a20 2020 200a 2020 2020 7265 7475  ().    .    retu
-00075e80: 726e 2072 676e 735f 6c73 745f 6d69 2c20  rn rgns_lst_mi, 
-00075e90: 7267 6e73 5f6c 7374 5f6e 642c 2072 676e  rgns_lst_nd, rgn
-00075ea0: 735f 6c73 745f 7374 0a0a 0a64 6566 2070  s_lst_st...def p
-00075eb0: 726f 635f 7265 6164 5f73 616d 2820 7361  roc_read_sam( sa
-00075ec0: 6d5f 6f62 6a2c 2071 2029 3a0a 2020 2020  m_obj, q ):.    
-00075ed0: 0a20 2020 2077 6869 6c65 2054 7275 653a  .    while True:
-00075ee0: 0a20 2020 2020 2020 2065 725f 636f 6465  .        er_code
-00075ef0: 2c20 7361 6d5f 6c73 742c 206e 756d 5f72  , sam_lst, num_r
-00075f00: 6561 6473 203d 2073 616d 5f6f 626a 2e67  eads = sam_obj.g
-00075f10: 6574 5f6f 6e65 5f6f 7665 726c 6170 6564  et_one_overlaped
-00075f20: 5f73 616d 2829 2020 2020 2020 2020 0a20  _sam()        . 
-00075f30: 2020 2020 2020 2071 2e70 7574 2820 2865         q.put( (e
-00075f40: 725f 636f 6465 2c20 7361 6d5f 6c73 742c  r_code, sam_lst,
-00075f50: 2073 616d 5f6f 626a 2e6e 756d 5f72 6561   sam_obj.num_rea
-00075f60: 6473 2920 290a 2020 2020 2020 2020 6966  ds) ).        if
-00075f70: 2065 725f 636f 6465 203d 3d20 4e4f 5f4d   er_code == NO_M
-00075f80: 4f52 455f 4c49 4e45 3a20 6272 6561 6b0a  ORE_LINE: break.
-00075f90: 2020 2020 2020 2020 0a0a 6465 6620 7361          ..def sa
-00075fa0: 7665 5f72 676e 735f 6f62 6a28 6669 6c65  ve_rgns_obj(file
-00075fb0: 6e61 6d65 2c20 7267 6e73 5f6c 7374 5f6d  name, rgns_lst_m
-00075fc0: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
-00075fd0: 676e 735f 6c73 745f 7374 692c 2072 645f  gns_lst_sti, rd_
-00075fe0: 6c65 6e2c 206e 5f72 6473 2c20 6d65 645f  len, n_rds, med_
-00075ff0: 6672 6167 5f6c 656e 2029 3a0a 2020 2020  frag_len ):.    
-00076000: 0a20 2020 2077 6974 6820 6f70 656e 2866  .    with open(f
-00076010: 696c 656e 616d 652c 2027 7762 2729 2061  ilename, 'wb') a
-00076020: 7320 663a 0a20 2020 2020 2020 2070 6963  s f:.        pic
-00076030: 6b6c 652e 6475 6d70 2820 2872 676e 735f  kle.dump( (rgns_
-00076040: 6c73 745f 6d2c 2072 676e 735f 6c73 745f  lst_m, rgns_lst_
-00076050: 6e64 2c20 7267 6e73 5f6c 7374 5f73 7469  nd, rgns_lst_sti
-00076060: 2c20 7264 5f6c 656e 2c20 6e5f 7264 732c  , rd_len, n_rds,
-00076070: 206d 6564 5f66 7261 675f 6c65 6e29 2c20   med_frag_len), 
-00076080: 6620 290a 2020 2020 2020 2020 0a64 6566  f ).        .def
-00076090: 206c 6f61 645f 7267 6e73 5f6f 626a 2866   load_rgns_obj(f
-000760a0: 696c 656e 616d 6529 3a0a 2020 2020 0a20  ilename):.    . 
-000760b0: 2020 2077 6974 6820 6f70 656e 2866 696c     with open(fil
-000760c0: 656e 616d 652c 2027 7262 2729 2061 7320  ename, 'rb') as 
-000760d0: 663a 0a20 2020 2020 2020 2064 6174 6120  f:.        data 
-000760e0: 3d20 7069 636b 6c65 2e6c 6f61 6428 2066  = pickle.load( f
-000760f0: 2029 0a20 2020 2020 2020 2023 2072 676e   ).        # rgn
-00076100: 735f 6c73 745f 6d2c 2072 676e 735f 6c73  s_lst_m, rgns_ls
-00076110: 745f 6e64 2c20 7267 6e73 5f6c 7374 5f73  t_nd, rgns_lst_s
-00076120: 7469 2c20 7264 5f6c 656e 2c20 6e5f 7264  ti, rd_len, n_rd
-00076130: 732c 206d 6564 5f66 7261 675f 6c65 6e20  s, med_frag_len 
-00076140: 3d20 7069 636b 6c65 2e6c 6f61 6428 2066  = pickle.load( f
-00076150: 2029 0a20 2020 2023 2072 6574 7572 6e20   ).    # return 
-00076160: 7267 6e73 5f6c 7374 5f6d 2c20 7267 6e73  rgns_lst_m, rgns
-00076170: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
-00076180: 745f 7374 692c 2072 645f 6c65 6e2c 206e  t_sti, rd_len, n
-00076190: 5f72 6473 2c20 6d65 645f 6672 6167 5f6c  _rds, med_frag_l
-000761a0: 656e 0a20 2020 2072 6574 7572 6e20 6461  en.    return da
-000761b0: 7461 0a20 0a64 6566 2073 6176 655f 6f62  ta. .def save_ob
-000761c0: 6a28 6669 6c65 6e61 6d65 2c20 6f62 6a20  j(filename, obj 
-000761d0: 293a 0a20 2020 200a 2020 2020 7769 7468  ):.    .    with
-000761e0: 206f 7065 6e28 6669 6c65 6e61 6d65 2c20   open(filename, 
-000761f0: 2777 6227 2920 6173 2066 3a0a 2020 2020  'wb') as f:.    
-00076200: 2020 2020 7069 636b 6c65 2e64 756d 7028      pickle.dump(
-00076210: 2028 6f62 6a29 2c20 6620 290a 2020 2020   (obj), f ).    
-00076220: 2020 2020 0a64 6566 206c 6f61 645f 6f62      .def load_ob
-00076230: 6a28 6669 6c65 6e61 6d65 293a 0a20 2020  j(filename):.   
-00076240: 200a 2020 2020 7769 7468 206f 7065 6e28   .    with open(
-00076250: 6669 6c65 6e61 6d65 2c20 2772 6227 2920  filename, 'rb') 
-00076260: 6173 2066 3a0a 2020 2020 2020 2020 6f62  as f:.        ob
-00076270: 6a20 3d20 7069 636b 6c65 2e6c 6f61 6428  j = pickle.load(
-00076280: 2066 2029 0a20 2020 2072 6574 7572 6e20   f ).    return 
-00076290: 6f62 6a0a 0a0a 2323 2323 2323 2323 2323  obj...##########
-000762a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000762b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000762c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000762d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000762e0: 0a23 2320 5374 7269 6e67 4669 782d 416e  .## StringFix-An
-000762f0: 616c 7973 6973 0a23 2323 2323 2323 2323  alysis.#########
-00076300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00076310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00076320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00076330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00076340: 230a 0a64 6566 2066 696c 7465 725f 7472  #..def filter_tr
-00076350: 735f 6c65 6e28 2066 615f 6c69 6e65 735f  s_len( fa_lines_
-00076360: 6c69 7374 2c20 6d69 6e5f 6c65 6e20 3d20  list, min_len = 
-00076370: 3020 293a 0a0a 2020 2020 4c65 6e20 203d  0 ):..    Len  =
-00076380: 206c 656e 2866 615f 6c69 6e65 735f 6c69   len(fa_lines_li
-00076390: 7374 290a 2020 2020 6966 204c 656e 2532  st).    if Len%2
-000763a0: 2021 3d20 303a 0a20 2020 2020 2020 2070   != 0:.        p
-000763b0: 7269 6e74 2827 4552 524f 5220 696e 2066  rint('ERROR in f
-000763c0: 696c 7465 725f 7472 735f 6c65 6e3a 204e  ilter_trs_len: N
-000763d0: 756d 206c 696e 6573 203d 2025 6920 2720  um lines = %i ' 
-000763e0: 2520 4c65 6e20 290a 2020 2020 2020 2020  % Len ).        
-000763f0: 7265 7475 726e 205b 5d0a 2020 2020 656c  return [].    el
-00076400: 7365 3a0a 2020 2020 2020 2020 6661 5f6c  se:.        fa_l
-00076410: 696e 6573 5f6f 7574 203d 205b 5d0a 2020  ines_out = [].  
-00076420: 2020 2020 2020 4e75 6d20 3d20 6e70 2e69        Num = np.i
-00076430: 6e74 284c 656e 2f32 290a 2020 2020 2020  nt(Len/2).      
-00076440: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-00076450: 284e 756d 293a 0a20 2020 2020 2020 2020  (Num):.         
-00076460: 2020 2069 6620 6c65 6e28 6661 5f6c 696e     if len(fa_lin
-00076470: 6573 5f6c 6973 745b 206b 2a32 2b31 205d  es_list[ k*2+1 ]
-00076480: 2920 3e20 6d69 6e5f 6c65 6e3a 2023 2069  ) > min_len: # i
-00076490: 6e63 6c75 6469 6e67 2027 5c6e 270a 2020  ncluding '\n'.  
-000764a0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-000764b0: 5f6c 696e 6573 5f6f 7574 2e61 7070 656e  _lines_out.appen
-000764c0: 6428 2066 615f 6c69 6e65 735f 6c69 7374  d( fa_lines_list
-000764d0: 5b20 6b2a 3220 5d20 290a 2020 2020 2020  [ k*2 ] ).      
-000764e0: 2020 2020 2020 2020 2020 6661 5f6c 696e            fa_lin
-000764f0: 6573 5f6f 7574 2e61 7070 656e 6428 2066  es_out.append( f
-00076500: 615f 6c69 6e65 735f 6c69 7374 5b20 6b2a  a_lines_list[ k*
-00076510: 322b 3120 5d20 290a 2020 2020 2020 2020  2+1 ] ).        
-00076520: 7265 7475 726e 2066 615f 6c69 6e65 735f  return fa_lines_
-00076530: 6f75 740a 0a0a 6465 6620 6669 6c74 6572  out...def filter
-00076540: 5f74 7273 5f31 2874 7273 2c20 6672 6167  _trs_1(trs, frag
-00076550: 5f6c 656e 203d 2038 302c 2067 5f74 6820  _len = 80, g_th 
-00076560: 3d20 3130 2c20 6162 6e5f 7468 5f74 203d  = 10, abn_th_t =
-00076570: 2031 2c20 6162 6e5f 7468 5f69 203d 2031   1, abn_th_i = 1
-00076580: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00076590: 2020 2069 736f 5f66 7261 635f 7468 203d     iso_frac_th =
-000765a0: 2030 2e30 312c 206c 656e 5f74 6820 3d20   0.01, len_th = 
-000765b0: 3230 302c 2076 6572 626f 7365 203d 2054  200, verbose = T
-000765c0: 7275 6520 293a 0a20 2020 200a 2020 2020  rue ):.    .    
-000765d0: 6966 2076 6572 626f 7365 203d 3d20 5472  if verbose == Tr
-000765e0: 7565 203a 2070 7269 6e74 2827 4669 6c74  ue : print('Filt
-000765f0: 6572 696e 6720 2e2e 2e20 272c 2065 6e64  ering ... ', end
-00076600: 3d27 2720 290a 2020 2020 7472 735f 6f75  ='' ).    trs_ou
-00076610: 7420 3d20 5b5d 0a20 2020 2069 7366 6d5f  t = [].    isfm_
-00076620: 6f75 7420 3d20 5b5d 0a20 2020 206e 7469  out = [].    nti
-00076630: 203d 2030 0a20 2020 206e 6969 203d 2030   = 0.    nii = 0
-00076640: 0a20 2020 206e 746f 203d 2030 0a20 2020  .    nto = 0.   
-00076650: 206e 696f 203d 2030 0a20 2020 2066 6f72   nio = 0.    for
-00076660: 2074 7220 696e 2074 7273 3a0a 2020 2020   tr in trs:.    
-00076670: 2020 2020 6966 2074 722e 7072 6566 6978      if tr.prefix
-00076680: 203d 3d20 2754 273a 0a20 2020 2020 2020   == 'T':.       
-00076690: 2020 2020 206e 7469 202b 3d20 310a 2020       nti += 1.  
-000766a0: 2020 2020 2020 2020 2020 6966 2074 722e            if tr.
-000766b0: 6e65 7873 203d 3d20 313a 0a20 2020 2020  nexs == 1:.     
-000766c0: 2020 2020 2020 2020 2020 2069 6620 2874             if (t
-000766d0: 722e 6776 6f6c 203e 3d20 675f 7468 2a66  r.gvol >= g_th*f
-000766e0: 7261 675f 6c65 6e2a 3129 2026 2028 7472  rag_len*1) & (tr
-000766f0: 2e61 626e 203e 3d20 6162 6e5f 7468 5f74  .abn >= abn_th_t
-00076700: 2a34 2e35 2920 2620 286c 656e 2874 722e  *4.5) & (len(tr.
-00076710: 7365 7129 203e 3d20 6c65 6e5f 7468 293a  seq) >= len_th):
-00076720: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00076730: 2020 2020 2020 6e74 6f20 2b3d 2031 0a20        nto += 1. 
-00076740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076750: 2020 2074 7273 5f6f 7574 2e61 7070 656e     trs_out.appen
-00076760: 6428 7472 290a 2020 2020 2020 2020 2020  d(tr).          
-00076770: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00076780: 2020 2020 2020 2020 6966 2028 7472 2e6e          if (tr.n
-00076790: 6578 7320 3e3d 2034 293a 0a20 2020 2020  exs >= 4):.     
-000767a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000767b0: 6620 2874 722e 6776 6f6c 203e 3d20 675f  f (tr.gvol >= g_
-000767c0: 7468 2a66 7261 675f 6c65 6e29 2026 2028  th*frag_len) & (
-000767d0: 7472 2e61 626e 203e 3d20 6162 6e5f 7468  tr.abn >= abn_th
-000767e0: 5f74 2920 2620 286c 656e 2874 722e 7365  _t) & (len(tr.se
-000767f0: 7129 203e 3d20 6c65 6e5f 7468 293a 200a  q) >= len_th): .
-00076800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076810: 2020 2020 2020 2020 6e74 6f20 2b3d 2031          nto += 1
-00076820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00076830: 2020 2020 2020 2020 2074 7273 5f6f 7574           trs_out
-00076840: 2e61 7070 656e 6428 7472 290a 2020 2020  .append(tr).    
-00076850: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00076860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00076870: 2020 2020 2020 6966 2028 7472 2e67 766f        if (tr.gvo
-00076880: 6c20 3e3d 2067 5f74 682a 6672 6167 5f6c  l >= g_th*frag_l
-00076890: 656e 2920 2620 2874 722e 6162 6e20 3e3d  en) & (tr.abn >=
-000768a0: 2061 626e 5f74 685f 7429 2026 2028 6c65   abn_th_t) & (le
-000768b0: 6e28 7472 2e73 6571 2920 3e3d 206c 656e  n(tr.seq) >= len
-000768c0: 5f74 6829 3a20 0a20 2020 2020 2020 2020  _th): .         
-000768d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000768e0: 746f 202b 3d20 310a 2020 2020 2020 2020  to += 1.        
-000768f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076900: 7472 735f 6f75 742e 6170 7065 6e64 2874  trs_out.append(t
-00076910: 7229 0a20 2020 2020 2020 2065 6c73 653a  r).        else:
-00076920: 0a20 2020 2020 2020 2020 2020 206e 6969  .            nii
-00076930: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00076940: 2020 6966 2028 7472 2e67 766f 6c20 3e3d    if (tr.gvol >=
-00076950: 2067 5f74 682a 6672 6167 5f6c 656e 2920   g_th*frag_len) 
-00076960: 2620 2874 722e 6162 6e20 3e3d 2061 626e  & (tr.abn >= abn
-00076970: 5f74 685f 6929 2026 2028 7472 2e69 736f  _th_i) & (tr.iso
-00076980: 5f66 7261 6320 3e3d 2069 736f 5f66 7261  _frac >= iso_fra
-00076990: 635f 7468 2920 2620 286c 656e 2874 722e  c_th) & (len(tr.
-000769a0: 7365 7129 203e 3d20 6c65 6e5f 7468 293a  seq) >= len_th):
-000769b0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000769c0: 2020 2320 6973 666d 5f6f 7574 2e61 7070    # isfm_out.app
-000769d0: 656e 6428 7472 290a 2020 2020 2020 2020  end(tr).        
-000769e0: 2020 2020 2020 2020 7472 735f 6f75 742e          trs_out.
-000769f0: 6170 7065 6e64 2874 7229 0a20 2020 2020  append(tr).     
-00076a00: 2020 2020 2020 2020 2020 206e 696f 202b             nio +
-00076a10: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00076a20: 2020 2020 0a20 2020 2069 6620 7665 7262      .    if verb
-00076a30: 6f73 6520 3d3d 2054 7275 6520 3a20 7072  ose == True : pr
-00076a40: 696e 7428 274e 756d 2e54 7273 203d 2025  int('Num.Trs = %
-00076a50: 6920 2569 2028 2569 2920 2d3e 2025 692c  i %i (%i) -> %i,
-00076a60: 2025 6920 2825 6929 2027 2025 2028 6e74   %i (%i) ' % (nt
-00076a70: 692c 6e69 692c 6e74 692b 6e69 692c 6e74  i,nii,nti+nii,nt
-00076a80: 6f2c 6e69 6f2c 6e74 6f2b 6e69 6f29 290a  o,nio,nto+nio)).
-00076a90: 2020 2020 2320 7265 7475 726e 2874 7273      # return(trs
-00076aa0: 5f6f 7574 2c20 6973 666d 5f6f 7574 290a  _out, isfm_out).
-00076ab0: 2020 2020 7265 7475 726e 2874 7273 5f6f      return(trs_o
-00076ac0: 7574 290a 0a0a 6465 6620 6669 6c74 6572  ut)...def filter
-00076ad0: 5f74 7273 5f32 2874 7273 2c20 6672 6167  _trs_2(trs, frag
-00076ae0: 5f6c 656e 203d 2038 302c 2067 5f74 6820  _len = 80, g_th 
-00076af0: 3d20 3130 2c20 6162 6e5f 7468 5f74 203d  = 10, abn_th_t =
-00076b00: 2031 2c20 6162 6e5f 7468 5f69 203d 2031   1, abn_th_i = 1
-00076b10: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00076b20: 2020 2069 736f 5f66 7261 635f 7468 203d     iso_frac_th =
-00076b30: 2030 2e30 312c 206c 656e 5f74 6820 3d20   0.01, len_th = 
-00076b40: 3230 302c 206e 655f 7468 203d 2034 2c20  200, ne_th = 4, 
-00076b50: 7665 7262 6f73 6520 3d20 5472 7565 293a  verbose = True):
-00076b60: 0a20 2020 200a 2020 2020 6966 2076 6572  .    .    if ver
-00076b70: 626f 7365 203d 3d20 5472 7565 203a 2070  bose == True : p
-00076b80: 7269 6e74 2827 4669 6c74 6572 696e 6720  rint('Filtering 
-00076b90: 2e2e 2e20 272c 2065 6e64 3d27 2720 290a  ... ', end='' ).
-00076ba0: 2020 2020 7472 735f 6f75 7420 3d20 5b5d      trs_out = []
-00076bb0: 0a20 2020 2069 7366 6d5f 6f75 7420 3d20  .    isfm_out = 
-00076bc0: 5b5d 0a20 2020 206e 7469 203d 2030 0a20  [].    nti = 0. 
-00076bd0: 2020 206e 6969 203d 2030 0a20 2020 206e     nii = 0.    n
-00076be0: 746f 203d 2030 0a20 2020 206e 696f 203d  to = 0.    nio =
-00076bf0: 2030 0a20 2020 2067 5f74 6820 3d20 675f   0.    g_th = g_
-00076c00: 7468 202a 2061 626e 5f74 685f 690a 2020  th * abn_th_i.  
-00076c10: 2020 7265 665f 7468 203d 206e 655f 7468    ref_th = ne_th
-00076c20: 2a67 5f74 682a 6672 6167 5f6c 656e 2a61  *g_th*frag_len*a
-00076c30: 626e 5f74 685f 690a 2020 2020 6d69 6e5f  bn_th_i.    min_
-00076c40: 6162 6e20 3d20 3130 3030 3030 3030 0a20  abn = 10000000. 
-00076c50: 2020 206d 696e 5f67 766f 6c20 3d20 3130     min_gvol = 10
-00076c60: 3030 3030 3030 0a20 2020 206d 696e 5f69  000000.    min_i
-00076c70: 7366 203d 2032 0a20 2020 2066 6f72 2074  sf = 2.    for t
-00076c80: 7220 696e 2074 7273 3a0a 2020 2020 2020  r in trs:.      
-00076c90: 2020 6d65 7420 3d20 6d69 6e28 7472 2e67    met = min(tr.g
-00076ca0: 7270 5f73 697a 652c 2034 292a 6d69 6e28  rp_size, 4)*min(
-00076cb0: 7472 2e6e 6578 732c 3429 2a6d 696e 2874  tr.nexs,4)*min(t
-00076cc0: 722e 6776 6f6c 2c20 3430 3029 0a20 2020  r.gvol, 400).   
-00076cd0: 2020 2020 2074 6872 203d 2072 6566 5f74       thr = ref_t
-00076ce0: 682f 6d65 740a 2020 2020 2020 2020 7220  h/met.        r 
-00076cf0: 3d20 310a 2020 2020 2020 2020 2320 6966  = 1.        # if
-00076d00: 2074 6872 203e 2031 3a20 7220 3d20 312e   thr > 1: r = 1.
-00076d10: 350a 2020 2020 2020 2020 6966 2074 722e  5.        if tr.
-00076d20: 6e65 7873 203d 3d20 313a 2074 6872 202a  nexs == 1: thr *
-00076d30: 3d20 340a 2020 2020 2020 2020 6966 2028  = 4.        if (
-00076d40: 7472 2e67 766f 6c20 3e20 675f 7468 2a66  tr.gvol > g_th*f
-00076d50: 7261 675f 6c65 6e2a 7468 7229 2026 2028  rag_len*thr) & (
-00076d60: 7472 2e61 626e 203e 3d20 6162 6e5f 7468  tr.abn >= abn_th
-00076d70: 5f69 2a74 6872 2920 2620 2874 722e 6973  _i*thr) & (tr.is
-00076d80: 6f5f 6672 6163 203e 3d20 6973 6f5f 6672  o_frac >= iso_fr
-00076d90: 6163 5f74 6829 2026 2028 6c65 6e28 7472  ac_th) & (len(tr
-00076da0: 2e74 7365 7129 203e 3d20 6c65 6e5f 7468  .tseq) >= len_th
-00076db0: 2a72 293a 200a 2020 2020 2020 2020 2020  *r): .          
-00076dc0: 2020 6966 2074 722e 7072 6566 6978 203d    if tr.prefix =
-00076dd0: 3d20 2754 273a 200a 2020 2020 2020 2020  = 'T': .        
-00076de0: 2020 2020 2020 2020 7472 735f 6f75 742e          trs_out.
-00076df0: 6170 7065 6e64 2874 7229 0a20 2020 2020  append(tr).     
-00076e00: 2020 2020 2020 2020 2020 206e 746f 202b             nto +
-00076e10: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00076e20: 656c 7365 3a20 0a20 2020 2020 2020 2020  else: .         
-00076e30: 2020 2020 2020 2023 2069 7366 6d5f 6f75         # isfm_ou
-00076e40: 742e 6170 7065 6e64 2874 7229 0a20 2020  t.append(tr).   
-00076e50: 2020 2020 2020 2020 2020 2020 2074 7273               trs
-00076e60: 5f6f 7574 2e61 7070 656e 6428 7472 290a  _out.append(tr).
-00076e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076e80: 6e69 6f20 2b3d 2031 0a20 2020 2020 2020  nio += 1.       
-00076e90: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00076ea0: 2020 2020 2020 6d69 6e5f 6162 6e20 3d20        min_abn = 
-00076eb0: 6d69 6e28 6d69 6e5f 6162 6e2c 7472 2e61  min(min_abn,tr.a
-00076ec0: 626e 290a 2020 2020 2020 2020 2020 2020  bn).            
-00076ed0: 6d69 6e5f 6776 6f6c 203d 206d 696e 286d  min_gvol = min(m
-00076ee0: 696e 5f67 766f 6c2c 7472 2e67 766f 6c29  in_gvol,tr.gvol)
-00076ef0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-00076f00: 5f69 7366 203d 206d 696e 286d 696e 5f69  _isf = min(min_i
-00076f10: 7366 2c74 722e 6973 6f5f 6672 6163 290a  sf,tr.iso_frac).
-00076f20: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00076f30: 2020 2020 2069 6620 7472 2e70 7265 6669       if tr.prefi
-00076f40: 7820 3d3d 2027 5427 3a20 6e74 6920 2b3d  x == 'T': nti +=
-00076f50: 2031 0a20 2020 2020 2020 2065 6c73 653a   1.        else:
-00076f60: 206e 6969 202b 3d20 310a 2020 2020 2020   nii += 1.      
-00076f70: 2020 2020 2020 0a20 2020 2069 6620 7665        .    if ve
-00076f80: 7262 6f73 6520 3d3d 2054 7275 6520 3a20  rbose == True : 
-00076f90: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00076fa0: 4e75 6d2e 5472 7320 3d20 2569 2025 6920  Num.Trs = %i %i 
-00076fb0: 2825 6929 202d 3e20 2569 2c20 2569 2028  (%i) -> %i, %i (
-00076fc0: 2569 2927 2025 2028 6e74 692c 6e69 692c  %i)' % (nti,nii,
-00076fd0: 6e74 692b 6e69 692c 6e74 6f2c 6e69 6f2c  nti+nii,nto,nio,
-00076fe0: 6e74 6f2b 6e69 6f29 2029 0a20 2020 2020  nto+nio) ).     
-00076ff0: 2020 2070 7269 6e74 2827 4d69 6e2e 4162     print('Min.Ab
-00077000: 6e20 3d20 2566 2c20 4d69 6e2e 4973 6f46  n = %f, Min.IsoF
-00077010: 7261 6320 3d20 2566 2c20 4d69 6e2e 4756  rac = %f, Min.GV
-00077020: 6f6c 203d 2025 342e 3166 2720 2520 286d  ol = %4.1f' % (m
-00077030: 696e 5f61 626e 2c20 6d69 6e5f 6973 662c  in_abn, min_isf,
-00077040: 206d 696e 5f67 766f 6c29 2029 0a20 2020   min_gvol) ).   
-00077050: 2020 2020 200a 2020 2020 2023 2072 6574       .     # ret
-00077060: 7572 6e28 7472 735f 6f75 742c 2069 7366  urn(trs_out, isf
-00077070: 6d5f 6f75 7429 0a20 2020 2072 6574 7572  m_out).    retur
-00077080: 6e28 7472 735f 6f75 7429 0a0a 0a64 6566  n(trs_out)...def
-00077090: 2067 6574 5f66 696c 655f 6e61 6d65 2820   get_file_name( 
-000770a0: 7061 7468 5f66 696c 655f 6e61 6d65 2029  path_file_name )
-000770b0: 3a0a 0a20 2020 2066 696c 655f 6e61 6d65  :..    file_name
-000770c0: 7320 3d20 7061 7468 5f66 696c 655f 6e61  s = path_file_na
-000770d0: 6d65 2e73 706c 6974 2827 2f27 295b 2d31  me.split('/')[-1
-000770e0: 5d0a 2020 2020 666e 7320 3d20 6669 6c65  ].    fns = file
-000770f0: 5f6e 616d 6573 2e73 706c 6974 2827 2e27  _names.split('.'
-00077100: 290a 2020 2020 6578 7420 3d20 666e 735b  ).    ext = fns[
-00077110: 2d31 5d0a 2020 2020 666e 7320 3d20 666e  -1].    fns = fn
-00077120: 735b 3a2d 315d 0a20 2020 2066 6e61 6d65  s[:-1].    fname
-00077130: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
-00077140: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
-00077150: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
-00077160: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
-00077170: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-00077180: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
-00077190: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
-000771a0: 2066 6e0a 0a20 2020 2072 6574 7572 6e20   fn..    return 
-000771b0: 666e 616d 652c 2065 7874 0a0a 0a64 6566  fname, ext...def
-000771c0: 2067 6574 5f70 6174 685f 6e61 6d65 2820   get_path_name( 
-000771d0: 7061 7468 5f66 696c 655f 6e61 6d65 2029  path_file_name )
-000771e0: 3a0a 0a20 2020 2066 6e73 203d 2070 6174  :..    fns = pat
-000771f0: 685f 6669 6c65 5f6e 616d 652e 7370 6c69  h_file_name.spli
-00077200: 7428 272e 2729 0a20 2020 2065 7874 203d  t('.').    ext =
-00077210: 2066 6e73 5b2d 315d 0a20 2020 2066 6e73   fns[-1].    fns
-00077220: 203d 2066 6e73 5b3a 2d31 5d0a 2020 2020   = fns[:-1].    
-00077230: 666e 616d 6520 3d20 2727 0a20 2020 2066  fname = ''.    f
-00077240: 6f72 206b 2c20 666e 2069 6e20 656e 756d  or k, fn in enum
-00077250: 6572 6174 6528 666e 7329 3a0a 2020 2020  erate(fns):.    
-00077260: 2020 2020 6966 206b 203e 2030 3a0a 2020      if k > 0:.  
-00077270: 2020 2020 2020 2020 2020 666e 616d 6520            fname 
-00077280: 3d20 666e 616d 6520 2b20 272e 270a 2020  = fname + '.'.  
-00077290: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
-000772a0: 616d 6520 2b20 666e 0a0a 2020 2020 7265  ame + fn..    re
-000772b0: 7475 726e 2066 6e61 6d65 2c20 6578 740a  turn fname, ext.
-000772c0: 0a0a 6465 6620 6d63 5f63 6f72 655f 6765  ..def mc_core_ge
-000772d0: 745f 6774 665f 616e 645f 6661 7374 615f  t_gtf_and_fasta_
-000772e0: 7066 2867 6429 3a0a 0a20 2020 206e 6520  pf(gd):..    ne 
-000772f0: 3d20 300a 2020 2020 2320 6e74 722c 206e  = 0.    # ntr, n
-00077300: 7072 2c20 6e65 203d 2067 642e 7570 6461  pr, ne = gd.upda
-00077310: 7465 5f74 645f 696e 666f 2829 0a20 2020  te_td_info().   
-00077320: 2067 7466 5f6c 696e 652c 2063 6e20 3d20   gtf_line, cn = 
-00077330: 6764 2e67 6574 5f67 7466 5f6c 696e 6573  gd.get_gtf_lines
-00077340: 5f66 726f 6d5f 6578 6f6e 7328 290a 2020  _from_exons().  
-00077350: 2020 6c74 2c20 6c70 203d 2067 642e 6765    lt, lp = gd.ge
-00077360: 745f 6661 7374 615f 6c69 6e65 735f 6672  t_fasta_lines_fr
-00077370: 6f6d 5f65 786f 6e73 2870 6570 7469 6465  om_exons(peptide
-00077380: 203d 2046 616c 7365 290a 0a20 2020 2027   = False)..    '
-00077390: 2727 0a20 2020 2069 6620 6c65 6e28 6c74  ''.    if len(lt
-000773a0: 2920 213d 206e 7472 2a32 3a0a 2020 2020  ) != ntr*2:.    
-000773b0: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
-000773c0: 2069 6e20 6d63 5f63 6f72 655f 6765 745f   in mc_core_get_
-000773d0: 6774 665f 616e 645f 6661 7374 615f 7066  gtf_and_fasta_pf
-000773e0: 3a20 2569 2021 3d20 2569 2027 2025 2028  : %i != %i ' % (
-000773f0: 6e74 722c 206c 656e 286c 7429 2f32 2920  ntr, len(lt)/2) 
-00077400: 290a 2020 2020 6966 206c 656e 286c 7029  ).    if len(lp)
-00077410: 2021 3d20 6e70 722a 323a 0a20 2020 2020   != npr*2:.     
-00077420: 2020 2070 7269 6e74 2827 4552 524f 5220     print('ERROR 
-00077430: 696e 206d 635f 636f 7265 5f67 6574 5f67  in mc_core_get_g
-00077440: 7466 5f61 6e64 5f66 6173 7461 5f70 663a  tf_and_fasta_pf:
-00077450: 2025 6920 213d 2025 6920 2720 2520 286e   %i != %i ' % (n
-00077460: 7072 2c20 6c65 6e28 6c70 292f 3229 2029  pr, len(lp)/2) )
-00077470: 0a20 2020 2023 2727 270a 2020 2020 7265  .    #'''.    re
-00077480: 7475 726e 2067 7466 5f6c 696e 652c 206c  turn gtf_line, l
-00077490: 742c 206c 702c 206e 652c 2063 6e0a 0a0a  t, lp, ne, cn...
-000774a0: 6465 6620 5374 7269 6e67 4669 785f 616e  def StringFix_an
-000774b0: 616c 7973 6973 2873 616d 5f66 696c 652c  alysis(sam_file,
-000774c0: 2067 7466 203d 204e 6f6e 652c 2067 656e   gtf = None, gen
-000774d0: 6f6d 655f 6669 6c65 203d 204e 6f6e 652c  ome_file = None,
-000774e0: 2073 7566 6669 7820 3d20 4e6f 6e65 2c20   suffix = None, 
-000774f0: 6a75 6d70 203d 2030 2c20 7361 203d 2032  jump = 0, sa = 2
-00077500: 2c20 6362 7963 203d 2046 616c 7365 2c20  , cbyc = False, 
-00077510: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00077520: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
-00077530: 203d 2031 2c20 6d69 6e5f 6672 6167 735f   = 1, min_frags_
-00077540: 7065 725f 6765 6e65 203d 2032 2c20 6c65  per_gene = 2, le
-00077550: 6e5f 7468 203d 204d 494e 5f54 525f 4c45  n_th = MIN_TR_LE
-00077560: 4e47 5448 2c20 6f75 745f 7472 203d 2046  NGTH, out_tr = F
-00077570: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00077580: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-00077590: 5f72 676e 203d 2046 616c 7365 2c20 6f75  _rgn = False, ou
-000775a0: 745f 6469 7220 3d20 4e6f 6e65 2029 3a0a  t_dir = None ):.
-000775b0: 2020 2020 2727 270a 2020 2020 6966 2067      '''.    if g
-000775c0: 7466 2069 7320 4e6f 6e65 3a0a 2020 2020  tf is None:.    
-000775d0: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
-000775e0: 3a20 4e6f 2047 5446 2f47 4646 2066 696c  : No GTF/GFF fil
-000775f0: 6520 7072 6f76 6964 6564 2e27 290a 2020  e provided.').  
-00077600: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00077610: 2023 2727 270a 2020 2020 0a20 2020 206d   #'''.    .    m
-00077620: 6574 686f 6420 3d20 276c 6173 736f 270a  ethod = 'lasso'.
-00077630: 2020 2020 4e72 6563 203d 2030 0a20 2020      Nrec = 0.   
-00077640: 2053 7461 7274 203d 2030 0a20 2020 200a   Start = 0.    .
-00077650: 2020 2020 6669 6c65 5f6e 616d 6573 203d      file_names =
-00077660: 2073 616d 5f66 696c 652e 7370 6c69 7428   sam_file.split(
-00077670: 272f 2729 5b2d 315d 0a20 2020 2066 6e73  '/')[-1].    fns
-00077680: 203d 2066 696c 655f 6e61 6d65 732e 7370   = file_names.sp
-00077690: 6c69 7428 272e 2729 5b3a 2d31 5d0a 2020  lit('.')[:-1].  
-000776a0: 2020 666e 616d 6520 3d20 2727 0a20 2020    fname = ''.   
-000776b0: 2066 6f72 206b 2c20 666e 2069 6e20 656e   for k, fn in en
-000776c0: 756d 6572 6174 6528 666e 7329 3a0a 2020  umerate(fns):.  
-000776d0: 2020 2020 2020 6966 206b 203e 2030 3a0a        if k > 0:.
-000776e0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
-000776f0: 6520 3d20 666e 616d 6520 2b20 272e 270a  e = fname + '.'.
-00077700: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
-00077710: 666e 616d 6520 2b20 666e 0a0a 2020 2020  fname + fn..    
-00077720: 6966 206f 7574 5f64 6972 2069 7320 6e6f  if out_dir is no
-00077730: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00077740: 6966 206f 7574 5f64 6972 5b2d 315d 203d  if out_dir[-1] =
-00077750: 3d20 272f 273a 0a20 2020 2020 2020 2020  = '/':.         
-00077760: 2020 2066 6e61 6d65 203d 206f 7574 5f64     fname = out_d
-00077770: 6972 202b 2066 6e61 6d65 0a20 2020 2020  ir + fname.     
-00077780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00077790: 2020 2020 2066 6e61 6d65 203d 206f 7574       fname = out
-000777a0: 5f64 6972 202b 2027 2f27 202b 2066 6e61  _dir + '/' + fna
-000777b0: 6d65 0a0a 2020 2020 6966 2073 7566 6669  me..    if suffi
-000777c0: 7820 6973 206e 6f74 204e 6f6e 653a 2020  x is not None:  
-000777d0: 2020 0a20 2020 2020 2020 2066 6e61 6d65    .        fname
-000777e0: 203d 2066 6e61 6d65 202b 2027 5f27 202b   = fname + '_' +
-000777f0: 2073 7566 6669 780a 0a20 2020 2069 6620   suffix..    if 
-00077800: 6a75 6d70 203e 2031 3a20 7265 7475 726e  jump > 1: return
-00077810: 2066 6e61 6d65 2c20 4e6f 6e65 2c20 4e6f   fname, None, No
-00077820: 6e65 0a0a 2020 2020 4e55 4d5f 434f 5245  ne..    NUM_CORE
-00077830: 5320 3d20 6e5f 636f 7265 730a 2020 2020  S = n_cores.    
-00077840: 7374 6172 745f 7469 6d65 3120 3d20 7469  start_time1 = ti
-00077850: 6d65 2e74 696d 6528 290a 2020 2020 7374  me.time().    st
-00077860: 6172 745f 7469 6d65 3220 3d20 7469 6d65  art_time2 = time
-00077870: 2e74 696d 6528 290a 2020 2020 6966 206a  .time().    if j
-00077880: 756d 7025 3220 3d3d 2030 3a0a 0a20 2020  ump%2 == 0:..   
-00077890: 2020 2020 2047 5446 5f6c 7374 203d 205b       GTF_lst = [
-000778a0: 5d0a 2020 2020 2020 2020 7267 6e73 5f6c  ].        rgns_l
-000778b0: 7374 5f6d 6920 3d20 5b5d 0a20 2020 2020  st_mi = [].     
-000778c0: 2020 2072 676e 735f 6c73 745f 6e64 203d     rgns_lst_nd =
-000778d0: 205b 5d0a 2020 2020 2020 2020 7267 6e73   [].        rgns
-000778e0: 5f6c 7374 5f73 7420 3d20 5b5d 0a0a 2020  _lst_st = []..  
-000778f0: 2020 2020 2020 636e 7420 3d20 300a 2020        cnt = 0.  
-00077900: 2020 2020 2020 6d78 5f6c 656e 203d 2031        mx_len = 1
-00077910: 320a 2020 2020 2020 2020 6572 5f63 6f64  2.        er_cod
-00077920: 6520 3d20 300a 2020 2020 2020 2020 0a20  e = 0.        . 
-00077930: 2020 2020 2020 2070 7269 6e74 2827 5374         print('St
-00077940: 7269 6e67 4669 7820 7374 6172 7465 6420  ringFix started 
-00077950: 272c 2064 6174 6574 696d 652e 6461 7465  ', datetime.date
-00077960: 7469 6d65 2e6e 6f77 2829 290a 2020 2020  time.now()).    
-00077970: 2020 2020 736f 203d 2073 616d 5f6f 626a      so = sam_obj
-00077980: 2873 616d 5f66 696c 652c 2073 6120 3d20  (sam_file, sa = 
-00077990: 7361 290a 2020 2020 2020 2020 0a20 2020  sa).        .   
-000779a0: 2020 2020 2069 6620 6e5f 636f 7265 7320       if n_cores 
-000779b0: 3d3d 2031 3a20 6e75 6d5f 7061 7261 6c6c  == 1: num_parall
-000779c0: 656c 5f63 6875 6e6b 7320 3d20 340a 2020  el_chunks = 4.  
-000779d0: 2020 2020 2020 656c 7365 3a20 6e75 6d5f        else: num_
-000779e0: 7061 7261 6c6c 656c 5f63 6875 6e6b 7320  parallel_chunks 
-000779f0: 3d20 4e55 4d5f 5041 5241 4c4c 454c 5f43  = NUM_PARALLEL_C
-00077a00: 4855 4e4b 530a 2020 2020 2020 2020 0a20  HUNKS.        . 
-00077a10: 2020 2020 2020 2062 5f63 6e74 203d 2030         b_cnt = 0
-00077a20: 0a20 2020 2020 2020 2072 5f6c 7374 5f6f  .        r_lst_o
-00077a30: 665f 6c73 7420 3d20 5b5d 0a20 2020 2020  f_lst = [].     
-00077a40: 2020 200a 2020 2020 2020 2020 2323 2323     .        ####
-00077a50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00077a60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00077a70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00077a80: 2323 2323 0a20 2020 2020 2020 200a 2020  ####.        .  
-00077a90: 2020 2020 2020 6d65 645f 6672 6167 5f6c        med_frag_l
-00077aa0: 656e 203d 2030 0a20 2020 2020 2020 2069  en = 0.        i
-00077ab0: 6620 6362 7963 3a0a 2020 2020 2020 2020  f cbyc:.        
-00077ac0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00077ad0: 2070 7269 6e74 2827 5c72 4275 696c 6469   print('\rBuildi
-00077ae0: 6e67 206c 6f63 6920 2620 434d 6174 2027  ng loci & CMat '
-00077af0: 2920 2320 2c20 656e 643d 2727 290a 2020  ) # , end='').  
-00077b00: 2020 2020 2020 2020 2020 636e 745f 6320            cnt_c 
-00077b10: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00077b20: 7768 696c 6520 5472 7565 3a0a 0a20 2020  while True:..   
-00077b30: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-00077b40: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
-00077b50: 696d 6528 290a 2020 2020 2020 2020 2020  ime().          
-00077b60: 2020 2020 2020 6572 5f63 6f64 652c 2073        er_code, s
-00077b70: 616d 5f6c 7374 2c20 6e75 6d5f 7265 6164  am_lst, num_read
-00077b80: 7320 3d20 736f 2e67 6574 5f6f 6e65 5f6f  s = so.get_one_o
-00077b90: 7665 726c 6170 6564 5f73 616d 2829 0a0a  verlaped_sam()..
-00077ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077bb0: 6966 2065 725f 636f 6465 203d 3d20 4e4f  if er_code == NO
-00077bc0: 545f 534f 5254 4544 3a0a 2020 2020 2020  T_SORTED:.      
-00077bd0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00077be0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00077bf0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00077c00: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00077c10: 2062 5f63 6e74 203d 3d20 303a 2072 5f6c   b_cnt == 0: r_l
-00077c20: 7374 5f6f 665f 6c73 7420 3d20 5b5d 0a20  st_of_lst = []. 
+00070340: 2020 2020 2020 2020 2069 6620 7263 6e74           if rcnt
+00070350: 2573 7465 7020 3d3d 2030 3a20 7072 696e  %step == 0: prin
+00070360: 7428 272e 272c 656e 643d 2727 290a 2020  t('.',end='').  
+00070370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070380: 2020 2020 2020 0a20 2020 2069 6620 6e5f        .    if n_
+00070390: 7267 6e73 203e 2030 3a0a 2020 2020 2020  rgns > 0:.      
+000703a0: 2020 6966 2072 636e 7420 3c20 6e5f 7267    if rcnt < n_rg
+000703b0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+000703c0: 6966 206d 6f64 6520 3d3d 2030 3a0a 2020  if mode == 0:.  
+000703d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000703e0: 7220 6d20 696e 2072 616e 6765 286e 5f72  r m in range(n_r
+000703f0: 676e 732d 7263 6e74 293a 2072 676e 735f  gns-rcnt): rgns_
+00070400: 6c73 742e 6170 7065 6e64 2872 6567 696f  lst.append(regio
+00070410: 6e73 2829 290a 2020 2020 2020 2020 2020  ns()).          
+00070420: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00070430: 2020 2020 2020 2020 666f 7220 6d20 696e          for m in
+00070440: 2072 616e 6765 286e 5f72 676e 732d 7263   range(n_rgns-rc
+00070450: 6e74 293a 2072 676e 735f 6c73 742e 6170  nt): rgns_lst.ap
+00070460: 7065 6e64 2872 6567 696f 6e73 5f6e 6428  pend(regions_nd(
+00070470: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
+00070480: 636e 7420 2b3d 2028 6e5f 7267 6e73 2d72  cnt += (n_rgns-r
+00070490: 636e 7429 0a20 2020 2020 2020 2020 2020  cnt).           
+000704a0: 200a 2020 2020 7265 7475 726e 2872 676e   .    return(rgn
+000704b0: 735f 6c73 742c 2072 636e 742c 2072 645f  s_lst, rcnt, rd_
+000704c0: 6c65 6e2c 206e 756d 5f72 6473 290a 2020  len, num_rds).  
+000704d0: 2020 2020 2020 0a0a 6465 6620 6c6f 6164        ..def load
+000704e0: 5f72 676e 735f 6e64 2820 666e 616d 652c  _rgns_nd( fname,
+000704f0: 206d 6f64 652c 206e 5f72 676e 732c 2076   mode, n_rgns, v
+00070500: 6572 626f 7365 203d 2046 616c 7365 2029  erbose = False )
+00070510: 3a0a 2020 2020 0a20 2020 2072 676e 735f  :.    .    rgns_
+00070520: 6c73 7420 3d20 5b5d 0a20 2020 2066 203d  lst = [].    f =
+00070530: 206f 7065 6e28 666e 616d 652c 2772 2729   open(fname,'r')
+00070540: 0a20 2020 206c 696e 655f 6c73 7420 3d20  .    line_lst = 
+00070550: 662e 7265 6164 6c69 6e65 7328 290a 2020  f.readlines().  
+00070560: 2020 662e 636c 6f73 6528 290a 2020 2020    f.close().    
+00070570: 0a20 2020 2072 645f 6c65 6e20 3d20 300a  .    rd_len = 0.
+00070580: 2020 2020 6e75 6d5f 7264 7320 3d20 300a      num_rds = 0.
+00070590: 2020 2020 7263 6e74 203d 2030 0a20 2020      rcnt = 0.   
+000705a0: 206c 636e 7420 3d20 300a 2020 2020 7364   lcnt = 0.    sd
+000705b0: 6976 203d 2031 300a 2020 2020 7374 6570  iv = 10.    step
+000705c0: 203d 206e 702e 6365 696c 286c 656e 286c   = np.ceil(len(l
+000705d0: 696e 655f 6c73 7429 2f28 7364 6976 2929  ine_lst)/(sdiv))
+000705e0: 0a20 2020 200a 2020 2020 666f 7220 6c69  .    .    for li
+000705f0: 6e65 2069 6e20 6c69 6e65 5f6c 7374 3a20  ne in line_lst: 
+00070600: 2320 6620 3a0a 2020 2020 2020 2020 2320  # f :.        # 
+00070610: 7072 696e 7428 6c69 6e65 290a 2020 2020  print(line).    
+00070620: 2020 2020 6966 206c 656e 286c 696e 6529      if len(line)
+00070630: 203d 3d20 303a 2062 7265 616b 0a20 2020   == 0: break.   
+00070640: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00070650: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
+00070660: 5d20 3d3d 2027 4027 3a0a 2020 2020 2020  ] == '@':.      
+00070670: 2020 2020 2020 2020 2020 6c69 6e65 5f74            line_t
+00070680: 6d70 203d 206c 696e 655b 313a 2d31 5d0a  mp = line[1:-1].
+00070690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000706a0: 6974 656d 7320 3d20 6c69 6e65 5f74 6d70  items = line_tmp
+000706b0: 2e73 706c 6974 2827 2c27 290a 2020 2020  .split(',').    
+000706c0: 2020 2020 2020 2020 2020 2020 7264 5f6c              rd_l
+000706d0: 656e 203d 2069 6e74 2869 7465 6d73 5b30  en = int(items[0
+000706e0: 5d5b 393a 5d29 0a20 2020 2020 2020 2020  ][9:]).         
+000706f0: 2020 2020 2020 206e 756d 5f72 6473 203d         num_rds =
+00070700: 2069 6e74 2869 7465 6d73 5b31 5d5b 3130   int(items[1][10
+00070710: 3a5d 290a 2020 2020 2020 2020 2020 2020  :]).            
+00070720: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00070730: 2020 2020 2020 6966 206c 636e 7420 3d3d        if lcnt ==
+00070740: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00070750: 2020 2020 2020 2020 6c69 6e65 735f 746d          lines_tm
+00070760: 7020 3d20 5b5d 0a0a 2020 2020 2020 2020  p = []..        
+00070770: 2020 2020 2020 2020 6c69 6e65 735f 746d          lines_tm
+00070780: 702e 6170 7065 6e64 286c 696e 6529 0a20  p.append(line). 
+00070790: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000707a0: 636e 7420 2b3d 2031 0a0a 2020 2020 2020  cnt += 1..      
+000707b0: 2020 2020 2020 2020 2020 736e 2c20 4e2c            sn, N,
+000707c0: 206e 203d 2067 6574 5f69 645f 6672 6f6d   n = get_id_from
+000707d0: 5f68 6472 2820 6c69 6e65 5b31 3a2d 315d  _hdr( line[1:-1]
+000707e0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+000707f0: 2020 2020 6966 2028 4e3d 3d6e 293a 0a0a      if (N==n):..
+00070800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070810: 2020 2020 7267 6e73 203d 2072 6567 696f      rgns = regio
+00070820: 6e73 5f6e 6428 290a 2020 2020 2020 2020  ns_nd().        
+00070830: 2020 2020 2020 2020 2020 2020 7267 6e73              rgns
+00070840: 2e73 6574 5f66 726f 6d5f 7465 7874 5f6c  .set_from_text_l
+00070850: 696e 6573 286c 696e 6573 5f74 6d70 290a  ines(lines_tmp).
+00070860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070870: 2020 2020 2069 6620 286e 5f72 676e 7320       if (n_rgns 
+00070880: 3e20 3029 2026 2028 2873 6e2d 7263 6e74  > 0) & ((sn-rcnt
+00070890: 293e 3029 3a0a 2020 2020 2020 2020 2020  )>0):.          
+000708a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000708b0: 7220 6d20 696e 2072 616e 6765 2873 6e2d  r m in range(sn-
+000708c0: 7263 6e74 293a 2072 676e 735f 6c73 742e  rcnt): rgns_lst.
+000708d0: 6170 7065 6e64 2872 6567 696f 6e73 5f6e  append(regions_n
+000708e0: 6428 2929 0a20 2020 2020 2020 2020 2020  d()).           
+000708f0: 2020 2020 2020 2020 2020 2020 2072 636e               rcn
+00070900: 7420 2b3d 2028 736e 2d72 636e 7429 0a0a  t += (sn-rcnt)..
+00070910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070920: 2020 2020 7267 6e73 5f6c 7374 2e61 7070      rgns_lst.app
+00070930: 656e 6428 7267 6e73 290a 2020 2020 2020  end(rgns).      
+00070940: 2020 2020 2020 2020 2020 2020 2020 7263                rc
+00070950: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+00070960: 2020 2020 2020 2020 2020 2020 6c63 6e74              lcnt
+00070970: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00070980: 2020 2020 2020 2020 2069 6620 7665 7262           if verb
+00070990: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
+000709a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000709b0: 7263 6e74 2573 7465 7020 3d3d 2030 3a20  rcnt%step == 0: 
+000709c0: 7072 696e 7428 272e 272c 656e 643d 2727  print('.',end=''
+000709d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000709e0: 2020 2020 2020 2020 2020 0a20 2020 2069            .    i
+000709f0: 6620 6e5f 7267 6e73 203e 2030 3a0a 2020  f n_rgns > 0:.  
+00070a00: 2020 2020 2020 6966 2072 636e 7420 3c20        if rcnt < 
+00070a10: 6e5f 7267 6e73 3a0a 2020 2020 2020 2020  n_rgns:.        
+00070a20: 2020 2020 666f 7220 6d20 696e 2072 616e      for m in ran
+00070a30: 6765 286e 5f72 676e 732d 7263 6e74 293a  ge(n_rgns-rcnt):
+00070a40: 2072 676e 735f 6c73 742e 6170 7065 6e64   rgns_lst.append
+00070a50: 2872 6567 696f 6e73 5f6e 6428 2929 0a20  (regions_nd()). 
+00070a60: 2020 2020 2020 2020 2020 2072 636e 7420             rcnt 
+00070a70: 2b3d 2028 6e5f 7267 6e73 2d72 636e 7429  += (n_rgns-rcnt)
+00070a80: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00070a90: 2020 7265 7475 726e 2872 676e 735f 6c73    return(rgns_ls
+00070aa0: 742c 2072 636e 742c 2072 645f 6c65 6e2c  t, rcnt, rd_len,
+00070ab0: 206e 756d 5f72 6473 290a 2020 2020 2020   num_rds).      
+00070ac0: 2020 0a0a 6465 6620 7472 696d 5f63 6f6e    ..def trim_con
+00070ad0: 7469 6773 2820 7267 6e73 5f6c 7374 5f6d  tigs( rgns_lst_m
+00070ae0: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
+00070af0: 676e 735f 6c73 745f 7374 692c 2076 6572  gns_lst_sti, ver
+00070b00: 626f 7365 203d 2031 2c20 7364 6976 203d  bose = 1, sdiv =
+00070b10: 2031 3020 293a 0a0a 2020 2020 7374 6172   10 ):..    star
+00070b20: 745f 7469 6d65 203d 2074 696d 652e 7469  t_time = time.ti
+00070b30: 6d65 2829 0a20 2020 2063 6e74 7020 3d20  me().    cntp = 
+00070b40: 303b 2063 6e74 6e20 3d20 303b 2063 6e74  0; cntn = 0; cnt
+00070b50: 3020 3d20 303b 2063 6e74 6620 3d20 303b  0 = 0; cntf = 0;
+00070b60: 2063 6e74 6720 3d20 300a 2020 2020 6670   cntg = 0.    fp
+00070b70: 203d 2030 3b20 666e 203d 2030 3b20 6630   = 0; fn = 0; f0
+00070b80: 203d 2030 3b20 6666 203d 2030 0a0a 2020   = 0; ff = 0..  
+00070b90: 2020 706f 7320 3d20 6e70 2e7a 6572 6f73    pos = np.zeros
+00070ba0: 286c 656e 2872 676e 735f 6c73 745f 6d29  (len(rgns_lst_m)
+00070bb0: 290a 2020 2020 666f 7220 6b20 696e 2072  ).    for k in r
+00070bc0: 616e 6765 286c 656e 2872 676e 735f 6c73  ange(len(rgns_ls
+00070bd0: 745f 6d29 293a 0a20 2020 2020 2020 2072  t_m)):.        r
+00070be0: 676e 5f74 203d 2072 676e 735f 6c73 745f  gn_t = rgns_lst_
+00070bf0: 6d5b 6b5d 2e67 6574 5f73 7061 6e28 290a  m[k].get_span().
+00070c00: 2020 2020 2020 2020 706f 735b 6b5d 203d          pos[k] =
+00070c10: 2072 676e 5f74 2e73 7461 7274 0a0a 2020   rgn_t.start..  
+00070c20: 2020 706f 7320 3d20 6e70 2e61 7272 6179    pos = np.array
+00070c30: 2870 6f73 290a 2020 2020 6f64 7220 3d20  (pos).    odr = 
+00070c40: 706f 732e 6172 6773 6f72 7428 290a 2020  pos.argsort().  
+00070c50: 2020 6e5f 7472 203d 2030 0a20 2020 2054    n_tr = 0.    T
+00070c60: 725f 6c73 7420 3d20 5b5d 0a20 2020 2049  r_lst = [].    I
+00070c70: 735f 6c73 7420 3d20 5b5d 0a0a 2020 2020  s_lst = []..    
+00070c80: 6763 6e74 203d 2030 0a20 2020 2072 735f  gcnt = 0.    rs_
+00070c90: 6d69 5f6c 7374 203d 205b 5d0a 2020 2020  mi_lst = [].    
+00070ca0: 7273 5f6e 645f 6c73 7420 3d20 5b5d 0a20  rs_nd_lst = []. 
+00070cb0: 2020 2066 6f72 206e 2069 6e20 7261 6e67     for n in rang
+00070cc0: 6528 6c65 6e28 7267 6e73 5f6c 7374 5f6d  e(len(rgns_lst_m
+00070cd0: 2929 3a0a 0a20 2020 2020 2020 206b 203d  )):..        k =
+00070ce0: 206f 6472 5b6e 5d0a 2020 2020 2020 2020   odr[n].        
+00070cf0: 7273 5f6d 203d 2072 676e 735f 6c73 745f  rs_m = rgns_lst_
+00070d00: 6d5b 6b5d 0a20 2020 2020 2020 2072 735f  m[k].        rs_
+00070d10: 6e64 203d 2072 676e 735f 6c73 745f 6e64  nd = rgns_lst_nd
+00070d20: 5b6b 5d0a 2020 2020 2020 2020 7273 5f73  [k].        rs_s
+00070d30: 7469 203d 2072 676e 735f 6c73 745f 7374  ti = rgns_lst_st
+00070d40: 695b 6b5d 0a20 2020 2020 2020 2020 2020  i[k].           
+00070d50: 0a20 2020 2020 2020 2056 6f6c 203d 2072  .        Vol = r
+00070d60: 735f 6d2e 6765 745f 766f 6c75 6d65 2829  s_m.get_volume()
+00070d70: 202b 2072 735f 7374 692e 6765 745f 766f   + rs_sti.get_vo
+00070d80: 6c75 6d65 2829 0a20 2020 2020 2020 2020  lume().         
+00070d90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00070da0: 2020 2020 6d61 785f 6465 765f 6e20 3d20      max_dev_n = 
+00070db0: 4d41 585f 4445 565f 4e0a 2020 2020 2020  MAX_DEV_N.      
+00070dc0: 2020 6d61 785f 6465 765f 6420 3d20 4d41    max_dev_d = MA
+00070dd0: 585f 4445 565f 440a 2020 2020 2020 2020  X_DEV_D.        
+00070de0: 6d61 785f 6465 765f 6920 3d20 4d41 585f  max_dev_i = MAX_
+00070df0: 4445 565f 490a 0a20 2020 2020 2020 2076  DEV_I..        v
+00070e00: 6563 5f64 203d 2063 6865 636b 5f63 6f6d  ec_d = check_com
+00070e10: 706c 7465 5f6f 7665 726c 6170 2820 7273  plte_overlap( rs
+00070e20: 5f6d 2c20 7273 5f6e 642c 2027 4427 2029  _m, rs_nd, 'D' )
+00070e30: 0a20 2020 2020 2020 2072 735f 6e64 2c20  .        rs_nd, 
+00070e40: 636d 203d 206d 6572 6765 5f6e 6561 7262  cm = merge_nearb
+00070e50: 795f 6e64 6928 7273 5f6e 642c 206d 6178  y_ndi(rs_nd, max
+00070e60: 5f64 6576 5f6e 2c20 6d61 785f 6465 765f  _dev_n, max_dev_
+00070e70: 642c 206d 6178 5f64 6576 5f69 2c20 7665  d, max_dev_i, ve
+00070e80: 635f 6429 0a20 2020 2020 2020 2023 2072  c_d).        # r
+00070e90: 735f 6e64 2c20 636d 203d 206d 6572 6765  s_nd, cm = merge
+00070ea0: 5f6e 6561 7262 795f 6e64 6928 7273 5f6e  _nearby_ndi(rs_n
+00070eb0: 642c 206d 6178 5f64 6576 5f6e 2c20 6d61  d, max_dev_n, ma
+00070ec0: 785f 6465 765f 642c 206d 6178 5f64 6576  x_dev_d, max_dev
+00070ed0: 5f69 290a 2020 2020 2020 2020 7273 5f73  _i).        rs_s
+00070ee0: 7469 2c20 6369 203d 206d 6572 6765 5f6e  ti, ci = merge_n
+00070ef0: 6561 7262 795f 6e64 6928 7273 5f73 7469  earby_ndi(rs_sti
+00070f00: 2c20 6d61 785f 6465 765f 6e2c 206d 6178  , max_dev_n, max
+00070f10: 5f64 6576 5f64 2c20 6d61 785f 6465 765f  _dev_d, max_dev_
+00070f20: 6929 0a0a 2020 2020 2020 2020 7273 5f6e  i)..        rs_n
+00070f30: 642c 2072 735f 6d2c 2062 203d 2072 656d  d, rs_m, b = rem
+00070f40: 5f6e 6d5f 326c 6f6e 675f 616e 645f 3274  _nm_2long_and_2t
+00070f50: 6869 6e28 2072 735f 6e64 2c20 7273 5f6d  hin( rs_nd, rs_m
+00070f60: 2029 0a20 2020 2020 2020 2023 2072 735f   ).        # rs_
+00070f70: 6d2c 2072 735f 6e64 2c20 7273 5f73 7469  m, rs_nd, rs_sti
+00070f80: 203d 2072 656d 5f6c 6f77 5f63 7667 5f72   = rem_low_cvg_r
+00070f90: 676e 7328 2072 735f 6d2c 2072 735f 6e64  gns( rs_m, rs_nd
+00070fa0: 2c20 7273 5f73 7469 2029 0a20 2020 2020  , rs_sti ).     
+00070fb0: 2020 200a 2020 2020 2020 2020 6966 206c     .        if l
+00070fc0: 656e 2872 735f 6d2e 7267 6e73 2920 3e20  en(rs_m.rgns) > 
+00070fd0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+00070fe0: 735f 6e64 2c20 7273 5f6d 2c20 6220 3d20  s_nd, rs_m, b = 
+00070ff0: 6164 6a5f 6e64 2820 7273 5f6e 642c 2072  adj_nd( rs_nd, r
+00071000: 735f 6d20 290a 2020 2020 2020 2020 2020  s_m ).          
+00071010: 2020 0a20 2020 2020 2020 2020 2020 2072    .            r
+00071020: 735f 6e64 2c20 7273 5f6d 2c20 6220 3d20  s_nd, rs_m, b = 
+00071030: 7472 696d 5f6d 2820 7273 5f6e 642c 2072  trim_m( rs_nd, r
+00071040: 735f 6d2c 2072 735f 7374 692c 206d 6178  s_m, rs_sti, max
+00071050: 5f64 6576 5f6e 2c20 6d61 785f 6465 765f  _dev_n, max_dev_
+00071060: 6420 2920 2020 2020 2020 2020 2020 2020  d )             
+00071070: 2020 0a20 2020 2020 2020 2020 2020 2072    .            r
+00071080: 735f 6e64 2c20 7273 5f6d 2c20 6220 3d20  s_nd, rs_m, b = 
+00071090: 7472 696d 5f64 2820 7273 5f6e 642c 2072  trim_d( rs_nd, r
+000710a0: 735f 6d20 2920 2023 2320 6e20 7368 6f75  s_m )  ## n shou
+000710b0: 6c64 2062 6520 6669 7273 742c 2074 6865  ld be first, the
+000710c0: 6e20 640a 2020 2020 2020 2020 2020 2020  n d.            
+000710d0: 7273 5f6e 642c 2072 735f 6d2c 2062 203d  rs_nd, rs_m, b =
+000710e0: 2073 706c 6974 5f6d 2820 7273 5f6e 642c   split_m( rs_nd,
+000710f0: 2072 735f 6d2c 2072 735f 7374 6920 2920   rs_m, rs_sti ) 
+00071100: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00071110: 2020 2020 2020 2072 735f 6e64 2c20 7273         rs_nd, rs
+00071120: 5f6d 2c20 6220 3d20 7472 696d 5f6e 5f73  _m, b = trim_n_s
+00071130: 686f 7274 2820 7273 5f6e 642c 2072 735f  hort( rs_nd, rs_
+00071140: 6d20 2920 200a 2020 2020 2020 2020 2020  m )  .          
+00071150: 2020 7273 5f6e 642c 2072 735f 6d2c 2062    rs_nd, rs_m, b
+00071160: 203d 2061 6464 5f69 2820 7273 5f6e 642c   = add_i( rs_nd,
+00071170: 2072 735f 6d2c 2072 735f 7374 6920 290a   rs_m, rs_sti ).
+00071180: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00071190: 2020 2020 2020 2020 7273 5f6d 2e75 7064          rs_m.upd
+000711a0: 6174 6528 290a 2020 2020 2020 2020 2020  ate().          
+000711b0: 2020 7273 5f6d 2e73 6574 5f63 7667 2829    rs_m.set_cvg()
+000711c0: 0a20 2020 2020 2020 2020 2020 2072 735f  .            rs_
+000711d0: 6e64 2e75 7064 6174 6528 290a 2020 2020  nd.update().    
+000711e0: 2020 2020 2020 2020 7273 5f6e 642e 7365          rs_nd.se
+000711f0: 745f 6376 6728 290a 2020 2020 2020 2020  t_cvg().        
+00071200: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00071210: 2072 735f 6d69 5f6c 7374 2e61 7070 656e   rs_mi_lst.appen
+00071220: 6428 7273 5f6d 290a 2020 2020 2020 2020  d(rs_m).        
+00071230: 2020 2020 7273 5f6e 645f 6c73 742e 6170      rs_nd_lst.ap
+00071240: 7065 6e64 2872 735f 6e64 290a 2020 2020  pend(rs_nd).    
+00071250: 2020 2020 2020 2020 2020 0a20 2020 2072            .    r
+00071260: 6574 7572 6e28 7273 5f6d 695f 6c73 742c  eturn(rs_mi_lst,
+00071270: 2072 735f 6e64 5f6c 7374 2920 0a0a 0a64   rs_nd_lst) ...d
+00071280: 6566 2072 656d 5f6c 6f77 5f63 7667 5f72  ef rem_low_cvg_r
+00071290: 676e 7328 2072 735f 6d2c 2072 735f 6e64  gns( rs_m, rs_nd
+000712a0: 2c20 7273 5f73 7469 203d 204e 6f6e 6520  , rs_sti = None 
+000712b0: 293a 0a20 2020 200a 2020 2020 6d78 5f63  ):.    .    mx_c
+000712c0: 7667 203d 2030 0a20 2020 2066 6f72 2072  vg = 0.    for r
+000712d0: 2069 6e20 7273 5f6d 2e72 676e 733a 0a20   in rs_m.rgns:. 
+000712e0: 2020 2020 2020 206d 785f 6376 6720 3d20         mx_cvg = 
+000712f0: 6d61 7828 206d 785f 6376 672c 2072 2e61  max( mx_cvg, r.a
+00071300: 7665 5f63 7667 5f64 6570 7468 2829 2029  ve_cvg_depth() )
+00071310: 0a20 2020 2066 6f72 2072 2069 6e20 7273  .    for r in rs
+00071320: 5f6e 642e 7267 6e73 3a0a 2020 2020 2020  _nd.rgns:.      
+00071330: 2020 6d78 5f63 7667 203d 206d 6178 2820    mx_cvg = max( 
+00071340: 6d78 5f63 7667 2c20 722e 6176 655f 6376  mx_cvg, r.ave_cv
+00071350: 675f 6465 7074 6828 2920 290a 2020 2020  g_depth() ).    
+00071360: 6376 675f 7468 203d 206d 785f 6376 672a  cvg_th = mx_cvg*
+00071370: 525f 5641 4c49 445f 4346 5241 430a 2020  R_VALID_CFRAC.  
+00071380: 2020 2020 2020 0a20 2020 2074 6f5f 6465        .    to_de
+00071390: 6c20 3d20 5b5d 0a20 2020 2066 6f72 206b  l = [].    for k
+000713a0: 2c20 7220 696e 2065 6e75 6d65 7261 7465  , r in enumerate
+000713b0: 2872 735f 6d2e 7267 6e73 293a 0a20 2020  (rs_m.rgns):.   
+000713c0: 2020 2020 2023 2069 6620 2872 2e61 7665       # if (r.ave
+000713d0: 5f63 7667 5f64 6570 7468 2829 203c 2063  _cvg_depth() < c
+000713e0: 7667 5f74 6829 3a20 746f 5f64 656c 2e61  vg_th): to_del.a
+000713f0: 7070 656e 6428 6b29 0a20 2020 2020 2020  ppend(k).       
+00071400: 2069 6620 2872 2e61 7665 5f63 7667 5f64   if (r.ave_cvg_d
+00071410: 6570 7468 2829 203c 2063 7667 5f74 6829  epth() < cvg_th)
+00071420: 2026 2028 722e 6176 655f 6376 675f 6465   & (r.ave_cvg_de
+00071430: 7074 6828 2920 3c20 525f 5641 4c49 445f  pth() < R_VALID_
+00071440: 4356 4729 3a20 746f 5f64 656c 2e61 7070  CVG): to_del.app
+00071450: 656e 6428 6b29 0a20 2020 200a 2020 2020  end(k).    .    
+00071460: 6966 206c 656e 2874 6f5f 6465 6c29 203e  if len(to_del) >
+00071470: 2030 3a0a 2020 2020 2020 2020 746f 5f64   0:.        to_d
+00071480: 656c 2e73 6f72 7428 7265 7665 7273 653d  el.sort(reverse=
+00071490: 5472 7565 290a 2020 2020 2020 2020 666f  True).        fo
+000714a0: 7220 6b20 696e 2074 6f5f 6465 6c3a 2064  r k in to_del: d
+000714b0: 656c 2072 735f 6d2e 7267 6e73 5b6b 5d0a  el rs_m.rgns[k].
+000714c0: 2020 2020 2020 2020 0a20 2020 2074 6f5f          .    to_
+000714d0: 6465 6c20 3d20 5b5d 0a20 2020 2066 6f72  del = [].    for
+000714e0: 206b 2c20 7220 696e 2065 6e75 6d65 7261   k, r in enumera
+000714f0: 7465 2872 735f 6e64 2e72 676e 7329 3a0a  te(rs_nd.rgns):.
+00071500: 2020 2020 2020 2020 6966 2028 722e 6176          if (r.av
+00071510: 655f 6376 675f 6465 7074 6828 2920 3c20  e_cvg_depth() < 
+00071520: 6376 675f 7468 2920 2620 2872 2e61 7665  cvg_th) & (r.ave
+00071530: 5f63 7667 5f64 6570 7468 2829 203c 2052  _cvg_depth() < R
+00071540: 5f56 414c 4944 5f43 5647 293a 2074 6f5f  _VALID_CVG): to_
+00071550: 6465 6c2e 6170 7065 6e64 286b 290a 2020  del.append(k).  
+00071560: 2020 0a20 2020 2069 6620 6c65 6e28 746f    .    if len(to
+00071570: 5f64 656c 2920 3e20 303a 0a20 2020 2020  _del) > 0:.     
+00071580: 2020 2074 6f5f 6465 6c2e 736f 7274 2872     to_del.sort(r
+00071590: 6576 6572 7365 3d54 7275 6529 0a20 2020  everse=True).   
+000715a0: 2020 2020 2066 6f72 206b 2069 6e20 746f       for k in to
+000715b0: 5f64 656c 3a20 6465 6c20 7273 5f6e 642e  _del: del rs_nd.
+000715c0: 7267 6e73 5b6b 5d0a 2020 2020 0a20 2020  rgns[k].    .   
+000715d0: 2069 6620 7273 5f73 7469 2069 7320 4e6f   if rs_sti is No
+000715e0: 6e65 3a0a 2020 2020 2020 2020 7265 7475  ne:.        retu
+000715f0: 726e 2072 735f 6d2c 2072 735f 6e64 2020  rn rs_m, rs_nd  
+00071600: 2020 2020 2020 0a20 2020 2065 6c73 653a        .    else:
+00071610: 0a20 2020 2020 2020 2074 6f5f 6465 6c20  .        to_del 
+00071620: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00071630: 206b 2c20 7220 696e 2065 6e75 6d65 7261   k, r in enumera
+00071640: 7465 2872 735f 7374 692e 7267 6e73 293a  te(rs_sti.rgns):
+00071650: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00071660: 2872 2e61 7665 5f63 7667 5f64 6570 7468  (r.ave_cvg_depth
+00071670: 2829 203c 2063 7667 5f74 6829 2026 2028  () < cvg_th) & (
+00071680: 722e 6176 655f 6376 675f 6465 7074 6828  r.ave_cvg_depth(
+00071690: 2920 3c20 525f 5641 4c49 445f 4356 4729  ) < R_VALID_CVG)
+000716a0: 3a20 746f 5f64 656c 2e61 7070 656e 6428  : to_del.append(
+000716b0: 6b29 0a0a 2020 2020 2020 2020 6966 206c  k)..        if l
+000716c0: 656e 2874 6f5f 6465 6c29 203e 2030 3a0a  en(to_del) > 0:.
+000716d0: 2020 2020 2020 2020 2020 2020 746f 5f64              to_d
+000716e0: 656c 2e73 6f72 7428 7265 7665 7273 653d  el.sort(reverse=
+000716f0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00071700: 2020 666f 7220 6b20 696e 2074 6f5f 6465    for k in to_de
+00071710: 6c3a 2064 656c 2072 735f 7374 692e 7267  l: del rs_sti.rg
+00071720: 6e73 5b6b 5d0a 2020 2020 0a20 2020 2020  ns[k].    .     
+00071730: 2020 2072 6574 7572 6e20 7273 5f6d 2c20     return rs_m, 
+00071740: 7273 5f6e 642c 2072 735f 7374 690a 0a64  rs_nd, rs_sti..d
+00071750: 6566 2074 7269 6d5f 636f 6e74 6967 735f  ef trim_contigs_
+00071760: 7369 6e67 6c65 2820 7273 5f6d 2c20 7273  single( rs_m, rs
+00071770: 5f6e 642c 2072 735f 7374 692c 2067 636e  _nd, rs_sti, gcn
+00071780: 7420 3d20 302c 2072 656d 5f6c 6f77 5f63  t = 0, rem_low_c
+00071790: 7667 203d 2054 7275 652c 2076 6572 626f  vg = True, verbo
+000717a0: 7365 203d 2031 2c20 7364 6976 203d 2031  se = 1, sdiv = 1
+000717b0: 3020 293a 0a0a 2020 2020 566f 6c20 3d20  0 ):..    Vol = 
+000717c0: 7273 5f6d 2e67 6574 5f76 6f6c 756d 6528  rs_m.get_volume(
+000717d0: 2920 2b20 7273 5f73 7469 2e67 6574 5f76  ) + rs_sti.get_v
+000717e0: 6f6c 756d 6528 290a 0a20 2020 206d 6178  olume()..    max
+000717f0: 5f64 6576 5f6e 203d 204d 4158 5f44 4556  _dev_n = MAX_DEV
+00071800: 5f4e 0a20 2020 206d 6178 5f64 6576 5f64  _N.    max_dev_d
+00071810: 203d 204d 4158 5f44 4556 5f44 0a20 2020   = MAX_DEV_D.   
+00071820: 206d 6178 5f64 6576 5f69 203d 204d 4158   max_dev_i = MAX
+00071830: 5f44 4556 5f49 0a0a 2020 2020 7665 635f  _DEV_I..    vec_
+00071840: 6420 3d20 6368 6563 6b5f 636f 6d70 6c74  d = check_complt
+00071850: 655f 6f76 6572 6c61 7028 2072 735f 6d2c  e_overlap( rs_m,
+00071860: 2072 735f 6e64 2c20 2744 2720 290a 2020   rs_nd, 'D' ).  
+00071870: 2020 7273 5f6e 642c 2063 6d20 3d20 6d65    rs_nd, cm = me
+00071880: 7267 655f 6e65 6172 6279 5f6e 6469 2872  rge_nearby_ndi(r
+00071890: 735f 6e64 2c20 6d61 785f 6465 765f 6e2c  s_nd, max_dev_n,
+000718a0: 206d 6178 5f64 6576 5f64 2c20 6d61 785f   max_dev_d, max_
+000718b0: 6465 765f 692c 2076 6563 5f64 290a 2020  dev_i, vec_d).  
+000718c0: 2020 2320 7665 635f 6920 3d20 6368 6563    # vec_i = chec
+000718d0: 6b5f 636f 6d70 6c74 655f 6f76 6572 6c61  k_complte_overla
+000718e0: 7028 2072 735f 6d2c 2072 735f 7374 692c  p( rs_m, rs_sti,
+000718f0: 2027 4927 2029 0a20 2020 2072 735f 7374   'I' ).    rs_st
+00071900: 692c 2063 6920 3d20 6d65 7267 655f 6e65  i, ci = merge_ne
+00071910: 6172 6279 5f6e 6469 2872 735f 7374 692c  arby_ndi(rs_sti,
+00071920: 206d 6178 5f64 6576 5f6e 2c20 6d61 785f   max_dev_n, max_
+00071930: 6465 765f 642c 206d 6178 5f64 6576 5f69  dev_d, max_dev_i
+00071940: 290a 0a20 2020 2069 6620 7265 6d5f 6c6f  )..    if rem_lo
+00071950: 775f 6376 673a 200a 2020 2020 2020 2020  w_cvg: .        
+00071960: 7273 5f6e 642c 2072 735f 6d2c 2062 203d  rs_nd, rs_m, b =
+00071970: 2072 656d 5f6e 6d5f 326c 6f6e 675f 616e   rem_nm_2long_an
+00071980: 645f 3274 6869 6e28 2072 735f 6e64 2c20  d_2thin( rs_nd, 
+00071990: 7273 5f6d 2029 0a20 2020 2020 2020 2072  rs_m ).        r
+000719a0: 735f 6d2c 2072 735f 6e64 2c20 7273 5f73  s_m, rs_nd, rs_s
+000719b0: 7469 203d 2072 656d 5f6c 6f77 5f63 7667  ti = rem_low_cvg
+000719c0: 5f72 676e 7328 2072 735f 6d2c 2072 735f  _rgns( rs_m, rs_
+000719d0: 6e64 2c20 7273 5f73 7469 2029 0a0a 2020  nd, rs_sti )..  
+000719e0: 2020 6966 206c 656e 2872 735f 6d2e 7267    if len(rs_m.rg
+000719f0: 6e73 2920 3e20 303a 0a20 2020 2020 2020  ns) > 0:.       
+00071a00: 2023 2072 735f 6e64 2c20 7273 5f6d 2c20   # rs_nd, rs_m, 
+00071a10: 6220 3d20 6164 6a5f 6e64 2820 7273 5f6e  b = adj_nd( rs_n
+00071a20: 642c 2072 735f 6d20 290a 0a20 2020 2020  d, rs_m )..     
+00071a30: 2020 2072 735f 6e64 2c20 7273 5f6d 2c20     rs_nd, rs_m, 
+00071a40: 6220 3d20 7472 696d 5f6d 2820 7273 5f6e  b = trim_m( rs_n
+00071a50: 642c 2072 735f 6d2c 2072 735f 7374 692c  d, rs_m, rs_sti,
+00071a60: 206d 6178 5f64 6576 5f6e 2c20 6d61 785f   max_dev_n, max_
+00071a70: 6465 765f 6420 2920 2020 2020 2020 2020  dev_d )         
+00071a80: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
+00071a90: 735f 6e64 2c20 7273 5f6d 2c20 6220 3d20  s_nd, rs_m, b = 
+00071aa0: 7472 696d 5f64 2820 7273 5f6e 642c 2072  trim_d( rs_nd, r
+00071ab0: 735f 6d20 2920 2023 2320 6e20 7368 6f75  s_m )  ## n shou
+00071ac0: 6c64 2062 6520 6669 7273 742c 2074 6865  ld be first, the
+00071ad0: 6e20 640a 2020 2020 2020 2020 7273 5f6e  n d.        rs_n
+00071ae0: 642c 2072 735f 6d2c 2062 203d 2073 706c  d, rs_m, b = spl
+00071af0: 6974 5f6d 2820 7273 5f6e 642c 2072 735f  it_m( rs_nd, rs_
+00071b00: 6d2c 2072 735f 7374 6920 2920 2020 2020  m, rs_sti )     
+00071b10: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
+00071b20: 735f 6e64 2c20 7273 5f6d 2c20 6220 3d20  s_nd, rs_m, b = 
+00071b30: 7472 696d 5f6e 5f73 686f 7274 2820 7273  trim_n_short( rs
+00071b40: 5f6e 642c 2072 735f 6d20 2920 200a 2020  _nd, rs_m )  .  
+00071b50: 2020 2020 2020 7273 5f6e 642c 2072 735f        rs_nd, rs_
+00071b60: 6d2c 2062 203d 2061 6464 5f69 2820 7273  m, b = add_i( rs
+00071b70: 5f6e 642c 2072 735f 6d2c 2072 735f 7374  _nd, rs_m, rs_st
+00071b80: 6920 290a 2020 2020 2020 2020 0a20 2020  i ).        .   
+00071b90: 2020 2020 2072 735f 6d2e 7570 6461 7465       rs_m.update
+00071ba0: 2829 0a20 2020 2020 2020 2072 735f 6d2e  ().        rs_m.
+00071bb0: 7365 745f 6376 6728 290a 2020 2020 2020  set_cvg().      
+00071bc0: 2020 7273 5f6e 642e 7570 6461 7465 2829    rs_nd.update()
+00071bd0: 0a20 2020 2020 2020 2072 735f 6e64 2e73  .        rs_nd.s
+00071be0: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
+00071bf0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
+00071c00: 2072 735f 6d2c 2072 735f 6e64 0a0a 0a64   rs_m, rs_nd...d
+00071c10: 6566 2063 6865 636b 5f62 6973 7472 616e  ef check_bistran
+00071c20: 6428 2072 5f6d 692c 2072 5f6e 6420 293a  d( r_mi, r_nd ):
+00071c30: 0a20 2020 200a 2020 2020 706f 7320 3d20  .    .    pos = 
+00071c40: 300a 2020 2020 6e65 6720 3d20 300a 2020  0.    neg = 0.  
+00071c50: 2020 6966 206c 656e 2872 5f6d 692e 7267    if len(r_mi.rg
+00071c60: 6e73 2920 3e20 303a 0a20 2020 2020 2020  ns) > 0:.       
+00071c70: 2066 6f72 2072 676e 2069 6e20 725f 6d69   for rgn in r_mi
+00071c80: 2e72 676e 733a 0a20 2020 2020 2020 2020  .rgns:.         
+00071c90: 2020 2069 6620 7267 6e2e 7873 203e 2030     if rgn.xs > 0
+00071ca0: 3a20 706f 7320 2b3d 2031 0a20 2020 2020  : pos += 1.     
+00071cb0: 2020 2020 2020 2065 6c69 6620 7267 6e2e         elif rgn.
+00071cc0: 7873 203c 2030 3a20 6e65 6720 2b3d 2031  xs < 0: neg += 1
+00071cd0: 0a0a 2020 2020 6966 206c 656e 2872 5f6e  ..    if len(r_n
+00071ce0: 642e 7267 6e73 2920 3e20 303a 0a20 2020  d.rgns) > 0:.   
+00071cf0: 2020 2020 2066 6f72 2072 676e 2069 6e20       for rgn in 
+00071d00: 725f 6e64 2e72 676e 733a 0a20 2020 2020  r_nd.rgns:.     
+00071d10: 2020 2020 2020 2069 6620 7267 6e2e 7873         if rgn.xs
+00071d20: 203e 2030 3a20 706f 7320 2b3d 2031 0a20   > 0: pos += 1. 
+00071d30: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00071d40: 7267 6e2e 7873 203c 2030 3a20 6e65 6720  rgn.xs < 0: neg 
+00071d50: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00071d60: 200a 2020 2020 7265 7475 726e 2070 6f73   .    return pos
+00071d70: 2c20 6e65 670a 0a0a 4e55 4d5f 434f 5245  , neg...NUM_CORE
+00071d80: 5320 3d20 340a 0a64 6566 2066 696e 645f  S = 4..def find_
+00071d90: 6b66 5f61 6e64 5f6b 6228 2065 786f 6e73  kf_and_kb( exons
+00071da0: 2c20 7273 5f6d 2029 3a0a 0a20 2020 2066  , rs_m ):..    f
+00071db0: 6c61 675f 6620 3d20 5472 7565 0a20 2020  lag_f = True.   
+00071dc0: 2066 6c61 675f 6220 3d20 5472 7565 0a20   flag_b = True. 
+00071dd0: 2020 206b 6620 3d20 300a 2020 2020 6b62     kf = 0.    kb
+00071de0: 203d 206c 656e 2865 786f 6e73 2e72 676e   = len(exons.rgn
+00071df0: 7329 2d31 0a20 2020 2066 6f72 206b 2069  s)-1.    for k i
+00071e00: 6e20 7261 6e67 6528 6c65 6e28 6578 6f6e  n range(len(exon
+00071e10: 732e 7267 6e73 2929 3a0a 2020 2020 2020  s.rgns)):.      
+00071e20: 2020 6966 2066 6c61 675f 663a 0a20 2020    if flag_f:.   
+00071e30: 2020 2020 2020 2020 2072 203d 2065 786f           r = exo
+00071e40: 6e73 2e72 676e 735b 6b5d 0a20 2020 2020  ns.rgns[k].     
+00071e50: 2020 2020 2020 2069 6620 722e 7479 7065         if r.type
+00071e60: 2e6c 6f77 6572 2829 203d 3d20 2765 786f  .lower() == 'exo
+00071e70: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
+00071e80: 2020 2020 6966 2072 735f 6d2e 6861 735f      if rs_m.has_
+00071e90: 6578 745f 696e 7465 7273 6563 7469 6f6e  ext_intersection
+00071ea0: 5f77 6974 6828 7229 3a0a 2020 2020 2020  _with(r):.      
+00071eb0: 2020 2020 2020 2020 2020 2020 2020 6b66                kf
+00071ec0: 203d 206b 0a20 2020 2020 2020 2020 2020   = k.           
+00071ed0: 2020 2020 2020 2020 2066 6c61 675f 6620           flag_f 
+00071ee0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00071ef0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00071f00: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00071f10: 2020 0a20 2020 2066 6f72 206b 2069 6e20    .    for k in 
+00071f20: 7265 7665 7273 6564 2872 616e 6765 286c  reversed(range(l
+00071f30: 656e 2865 786f 6e73 2e72 676e 7329 2929  en(exons.rgns)))
+00071f40: 3a0a 2020 2020 2020 2020 6966 2066 6c61  :.        if fla
+00071f50: 675f 623a 0a20 2020 2020 2020 2020 2020  g_b:.           
+00071f60: 2072 203d 2065 786f 6e73 2e72 676e 735b   r = exons.rgns[
+00071f70: 6b5d 0a20 2020 2020 2020 2020 2020 2069  k].            i
+00071f80: 6620 722e 7479 7065 2e6c 6f77 6572 2829  f r.type.lower()
+00071f90: 203d 3d20 2765 786f 6e27 3a0a 2020 2020   == 'exon':.    
+00071fa0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00071fb0: 735f 6d2e 6861 735f 6578 745f 696e 7465  s_m.has_ext_inte
+00071fc0: 7273 6563 7469 6f6e 5f77 6974 6828 7229  rsection_with(r)
+00071fd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00071fe0: 2020 2020 2020 6b62 203d 206b 0a20 2020        kb = k.   
+00071ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072000: 2066 6c61 675f 6620 3d20 4661 6c73 650a   flag_f = False.
+00072010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072020: 2020 2020 6272 6561 6b0a 2020 2020 7265      break.    re
+00072030: 7475 726e 206b 662c 206b 620a 2020 2020  turn kf, kb.    
+00072040: 0a0a 6465 6620 6d63 5f63 6f72 655f 6765  ..def mc_core_ge
+00072050: 745f 7472 2872 735f 7475 706c 6529 3a0a  t_tr(rs_tuple):.
+00072060: 2020 2020 0a20 2020 2072 735f 6d20 3d20      .    rs_m = 
+00072070: 7273 5f74 7570 6c65 5b30 5d0a 2020 2020  rs_tuple[0].    
+00072080: 7273 5f6e 6420 3d20 7273 5f74 7570 6c65  rs_nd = rs_tuple
+00072090: 5b31 5d0a 2020 2020 7273 5f73 7469 203d  [1].    rs_sti =
+000720a0: 2072 735f 7475 706c 655b 325d 0a20 2020   rs_tuple[2].   
+000720b0: 2067 636e 7420 3d20 7273 5f74 7570 6c65   gcnt = rs_tuple
+000720c0: 5b33 5d0a 2020 2020 6c65 6e5f 7468 203d  [3].    len_th =
+000720d0: 2072 735f 7475 706c 655b 345d 0a20 2020   rs_tuple[4].   
+000720e0: 206d 6574 686f 6420 3d20 7273 5f74 7570   method = rs_tup
+000720f0: 6c65 5b35 5d0a 2020 2020 7264 5f6c 656e  le[5].    rd_len
+00072100: 203d 2072 735f 7475 706c 655b 365d 0a20   = rs_tuple[6]. 
+00072110: 2020 2067 6420 3d20 7273 5f74 7570 6c65     gd = rs_tuple
+00072120: 5b37 5d0a 2020 2020 0a20 2020 2067 7369  [7].    .    gsi
+00072130: 7a65 203d 206c 656e 2872 735f 6d2e 7267  ze = len(rs_m.rg
+00072140: 6e73 290a 2020 2020 6776 6f6c 203d 2072  ns).    gvol = r
+00072150: 735f 6d2e 6765 745f 766f 6c75 6d65 2829  s_m.get_volume()
+00072160: 0a0a 2020 2020 2327 2727 0a20 2020 2073  ..    #'''.    s
+00072170: 7420 3d20 7469 6d65 2e74 696d 6528 290a  t = time.time().
+00072180: 2020 2020 6966 2067 6420 6973 206e 6f74      if gd is not
+00072190: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+000721a0: 2320 6d65 7267 6520 6764 2e65 786f 6e73  # merge gd.exons
+000721b0: 2074 6f20 7273 5f6d 202d 3e20 7570 6461   to rs_m -> upda
+000721c0: 7465 2072 735f 6d0a 2020 2020 2020 2020  te rs_m.        
+000721d0: 666f 7220 6b2c 2072 2069 6e20 656e 756d  for k, r in enum
+000721e0: 6572 6174 6528 6764 2e65 786f 6e73 2e72  erate(gd.exons.r
+000721f0: 676e 7329 3a0a 2020 2020 2020 2020 2020  gns):.          
+00072200: 2020 6966 2072 2e74 7970 652e 6c6f 7765    if r.type.lowe
+00072210: 7228 2920 3d3d 2027 6578 6f6e 273a 0a20  r() == 'exon':. 
+00072220: 2020 2020 2020 2020 2020 2020 2020 204c                 L
+00072230: 656e 203d 2072 2e65 6e64 202d 2072 2e73  en = r.end - r.s
+00072240: 7461 7274 202b 2031 0a20 2020 2020 2020  tart + 1.       
+00072250: 2020 2020 2020 2020 2072 6d20 3d20 7265           rm = re
+00072260: 6769 6f6e 2872 2e63 6872 2c20 722e 7374  gion(r.chr, r.st
+00072270: 6172 742c 2072 2e65 6e64 2c20 274d 272c  art, r.end, 'M',
+00072280: 2073 6571 5f6f 725f 636d 6174 203d 2027   seq_or_cmat = '
+00072290: 4e27 2a4c 656e 2c20 6376 675f 6465 7020  N'*Len, cvg_dep 
+000722a0: 3d20 4356 475f 4445 5054 485f 544d 5029  = CVG_DEPTH_TMP)
+000722b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000722c0: 2023 2072 6d2e 6765 745f 6376 6728 290a   # rm.get_cvg().
+000722d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000722e0: 7273 5f6d 2e72 676e 732e 6170 7065 6e64  rs_m.rgns.append
+000722f0: 2872 6d29 0a20 2020 2020 2020 2020 2020  (rm).           
+00072300: 2020 2020 2023 2072 735f 6d2e 7570 6461       # rs_m.upda
+00072310: 7465 2872 6d29 0a20 2020 2020 2020 2072  te(rm).        r
+00072320: 735f 6d2e 7570 6461 7465 2829 0a20 2020  s_m.update().   
+00072330: 2020 2020 2072 735f 6d2e 7365 745f 6376       rs_m.set_cv
+00072340: 6728 290a 2020 2020 2020 2020 2320 666f  g().        # fo
+00072350: 7220 7220 696e 2072 735f 6d2e 7267 6e73  r r in rs_m.rgns
+00072360: 3a20 722e 6765 745f 6376 6728 290a 2020  : r.get_cvg().  
+00072370: 2020 2327 2727 0a20 2020 2065 7431 203d    #'''.    et1 =
+00072380: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
+00072390: 740a 2020 2020 2020 2020 0a20 2020 2073  t.        .    s
+000723a0: 7420 3d20 7469 6d65 2e74 696d 6528 290a  t = time.time().
+000723b0: 2020 2020 7273 5f6d 2c20 7273 5f6e 6420      rs_m, rs_nd 
+000723c0: 3d20 7472 696d 5f63 6f6e 7469 6773 5f73  = trim_contigs_s
+000723d0: 696e 676c 6528 2072 735f 6d2c 2072 735f  ingle( rs_m, rs_
+000723e0: 6e64 2c20 7273 5f73 7469 2c20 6763 6e74  nd, rs_sti, gcnt
+000723f0: 2c20 2867 6420 6973 204e 6f6e 6529 2029  , (gd is None) )
+00072400: 0a20 2020 2065 7432 203d 2074 696d 652e  .    et2 = time.
+00072410: 7469 6d65 2829 202d 2073 740a 0a20 2020  time() - st..   
+00072420: 2023 2727 270a 2020 2020 7374 203d 2074   #'''.    st = t
+00072430: 696d 652e 7469 6d65 2829 0a20 2020 2069  ime.time().    i
+00072440: 6620 6764 2069 7320 6e6f 7420 4e6f 6e65  f gd is not None
+00072450: 3a0a 2020 2020 2020 2020 746f 5f64 656c  :.        to_del
+00072460: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00072470: 7220 6b2c 2072 2069 6e20 656e 756d 6572  r k, r in enumer
+00072480: 6174 6528 7273 5f6d 2e72 676e 7329 3a0a  ate(rs_m.rgns):.
+00072490: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000724a0: 2e61 7665 5f63 7667 5f64 6570 7468 2829  .ave_cvg_depth()
+000724b0: 203c 3d20 4356 475f 4445 5054 485f 544d   <= CVG_DEPTH_TM
+000724c0: 503a 0a20 2020 2020 2020 2020 2020 2020  P:.             
+000724d0: 2020 2074 6f5f 6465 6c2e 6170 7065 6e64     to_del.append
+000724e0: 286b 290a 2020 2020 2020 2020 6966 206c  (k).        if l
+000724f0: 656e 2874 6f5f 6465 6c29 203e 2030 3a0a  en(to_del) > 0:.
+00072500: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+00072510: 696e 7428 2725 6920 5253 5f4d 2072 656d  int('%i RS_M rem
+00072520: 6f76 6564 2061 6d6f 6e67 2025 6927 2025  oved among %i' %
+00072530: 2028 6c65 6e28 746f 5f64 656c 292c 206c   (len(to_del), l
+00072540: 656e 2872 735f 6d2e 7267 6e73 2929 290a  en(rs_m.rgns))).
+00072550: 2020 2020 2020 2020 2020 2020 746f 5f64              to_d
+00072560: 656c 2e73 6f72 7428 290a 2020 2020 2020  el.sort().      
+00072570: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
+00072580: 6576 6572 7365 6428 746f 5f64 656c 293a  eversed(to_del):
+00072590: 2064 656c 2072 735f 6d2e 7267 6e73 5b6b   del rs_m.rgns[k
+000725a0: 5d0a 2020 2020 2020 2020 2020 2020 7273  ].            rs
+000725b0: 5f6d 2e75 7064 6174 6528 290a 2020 2020  _m.update().    
+000725c0: 6574 3320 3d20 7469 6d65 2e74 696d 6528  et3 = time.time(
+000725d0: 2920 2d20 7374 0a20 2020 2023 2727 270a  ) - st.    #'''.
+000725e0: 2020 2020 0a20 2020 2067 7270 203d 2073      .    grp = s
+000725f0: 706c 6963 655f 6772 6170 6828 7264 5f6c  plice_graph(rd_l
+00072600: 656e 2c20 6763 6e74 290a 2020 2020 0a20  en, gcnt).    . 
+00072610: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
+00072620: 6574 3620 3d20 300a 2020 2020 6574 3520  et6 = 0.    et5 
+00072630: 3d20 300a 2020 2020 6574 3420 3d20 300a  = 0.    et4 = 0.
+00072640: 2020 2020 6574 7820 3d20 300a 2020 2020      etx = 0.    
+00072650: 6966 2028 6c65 6e28 7273 5f6d 2e72 676e  if (len(rs_m.rgn
+00072660: 7329 203e 2030 293a 2023 2026 2028 6c65  s) > 0): # & (le
+00072670: 6e28 7273 5f6d 2e72 676e 7329 203c 2032  n(rs_m.rgns) < 2
+00072680: 3029 3a0a 2020 2020 2020 2020 0a20 2020  0):.        .   
+00072690: 2020 2020 2073 7420 3d20 7469 6d65 2e74       st = time.t
+000726a0: 696d 6528 290a 2020 2020 2020 2020 6267  ime().        bg
+000726b0: 2c20 7273 5f6d 2c20 7273 5f6e 6420 3d20  , rs_m, rs_nd = 
+000726c0: 6772 702e 6275 696c 6428 7273 5f6d 2c20  grp.build(rs_m, 
+000726d0: 7273 5f6e 642c 2028 6764 2069 7320 4e6f  rs_nd, (gd is No
+000726e0: 6e65 292c 206c 656e 5f74 6820 3d20 6c65  ne), len_th = le
+000726f0: 6e5f 7468 290a 2020 2020 2020 2020 6574  n_th).        et
+00072700: 3420 3d20 7469 6d65 2e74 696d 6528 2920  4 = time.time() 
+00072710: 2d20 7374 0a20 2020 2020 2020 206d 6e20  - st.        mn 
+00072720: 3d20 300a 2020 2020 2020 2020 636e 7420  = 0.        cnt 
+00072730: 3d20 300a 0a20 2020 2020 2020 2074 725f  = 0..        tr_
+00072740: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
+00072750: 2069 665f 6c73 7420 3d20 5b5d 0a20 2020   if_lst = [].   
+00072760: 2020 2020 2067 7466 5f6c 696e 6573 203d       gtf_lines =
+00072770: 205b 5d0a 2020 2020 2020 2020 6966 2067   [].        if g
+00072780: 6420 6973 206e 6f74 204e 6f6e 653a 0a20  d is not None:. 
+00072790: 2020 2020 2020 2020 2020 2073 7420 3d20             st = 
+000727a0: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
+000727b0: 2020 2020 2020 2020 6764 2c20 7472 5f6c          gd, tr_l
+000727c0: 7374 2c20 6966 5f6c 7374 2c20 6774 665f  st, if_lst, gtf_
+000727d0: 6c69 6e65 732c 2065 7478 203d 2067 7270  lines, etx = grp
+000727e0: 2e74 645f 616e 645f 6165 5f75 7369 6e67  .td_and_ae_using
+000727f0: 5f61 6e6e 6f74 6174 696f 6e28 6764 2c20  _annotation(gd, 
+00072800: 6c65 6e5f 7468 2c20 6d65 7468 6f64 203d  len_th, method =
+00072810: 206d 6574 686f 6429 0a20 2020 2020 2020   method).       
+00072820: 2020 2020 2065 7436 203d 2074 696d 652e       et6 = time.
+00072830: 7469 6d65 2829 202d 2073 740a 0a20 2020  time() - st..   
+00072840: 2020 2020 2065 6c73 653a 2023 2069 6620       else: # if 
+00072850: 6c65 6e28 7472 5f6c 7374 2b69 665f 6c73  len(tr_lst+if_ls
+00072860: 7429 203d 3d20 303a 0a20 2020 2020 2020  t) == 0:.       
+00072870: 2020 2020 2073 7420 3d20 7469 6d65 2e74       st = time.t
+00072880: 696d 6528 290a 2020 2020 2020 2020 2020  ime().          
+00072890: 2020 622c 206d 6e2c 2063 6e74 2c20 7273    b, mn, cnt, rs
+000728a0: 5f6d 2c20 7273 5f6e 6420 3d20 6772 702e  _m, rs_nd = grp.
+000728b0: 7365 6c65 6374 5f6e 6f64 6573 5f61 6e64  select_nodes_and
+000728c0: 5f65 6467 6573 2820 2920 2320 7273 5f6d  _edges( ) # rs_m
+000728d0: 2c20 7273 5f6e 6429 0a20 2020 2020 2020  , rs_nd).       
+000728e0: 2020 2020 2065 7435 203d 2074 696d 652e       et5 = time.
+000728f0: 7469 6d65 2829 202d 2073 740a 2020 2020  time() - st.    
+00072900: 2020 2020 2020 2020 7374 203d 2074 696d          st = tim
+00072910: 652e 7469 6d65 2829 0a20 2020 2020 2020  e.time().       
+00072920: 2020 2020 2069 6620 623a 0a20 2020 2020       if b:.     
+00072930: 2020 2020 2020 2020 2020 2067 642c 2074             gd, t
+00072940: 725f 6c73 742c 2069 665f 6c73 742c 2067  r_lst, if_lst, g
+00072950: 7466 5f6c 696e 6573 203d 2067 7270 2e74  tf_lines = grp.t
+00072960: 645f 616e 645f 6165 286c 656e 5f74 682c  d_and_ae(len_th,
+00072970: 206d 6574 686f 6420 3d20 6d65 7468 6f64   method = method
+00072980: 290a 0a20 2020 2020 2020 2020 2020 2070  )..            p
+00072990: 2c20 6e20 3d20 6368 6563 6b5f 6269 7374  , n = check_bist
+000729a0: 7261 6e64 2820 7273 5f6d 2c20 7273 5f6e  rand( rs_m, rs_n
+000729b0: 6420 290a 2020 2020 2020 2020 2020 2020  d ).            
+000729c0: 6966 2028 7020 3e20 3029 2026 2028 6e20  if (p > 0) & (n 
+000729d0: 3e20 3029 3a20 6772 702e 6269 7374 7261  > 0): grp.bistra
+000729e0: 6e64 6564 203d 2054 7275 6520 2320 7061  nded = True # pa
+000729f0: 7373 0a20 2020 2020 2020 2020 2020 2065  ss.            e
+00072a00: 6c73 653a 2067 7270 2e62 6973 7472 616e  lse: grp.bistran
+00072a10: 6465 6420 3d20 4661 6c73 6520 2320 6772  ded = False # gr
+00072a20: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
+00072a30: 2020 2020 2065 7436 203d 2074 696d 652e       et6 = time.
+00072a40: 7469 6d65 2829 202d 2073 740a 2020 2020  time() - st.    
+00072a50: 2020 2020 2020 2020 0a20 2020 2064 656c          .    del
+00072a60: 2072 735f 6d0a 2020 2020 6465 6c20 7273   rs_m.    del rs
+00072a70: 5f6e 640a 2020 2020 6465 6c20 7273 5f73  _nd.    del rs_s
+00072a80: 7469 0a20 2020 2023 2064 656c 2067 640a  ti.    # del gd.
+00072a90: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00072aa0: 2069 6620 6e6f 7420 623a 0a20 2020 2020   if not b:.     
+00072ab0: 2020 2074 725f 6c73 7420 3d20 5b5d 0a20     tr_lst = []. 
+00072ac0: 2020 2020 2020 2069 665f 6c73 7420 3d20         if_lst = 
+00072ad0: 5b5d 0a20 2020 2020 2020 2067 7466 5f6c  [].        gtf_l
+00072ae0: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
+00072af0: 2020 6d6e 203d 2030 0a20 2020 2020 2020    mn = 0.       
+00072b00: 2063 6e74 203d 2030 0a0a 2020 2020 7265   cnt = 0..    re
+00072b10: 7475 726e 2074 725f 6c73 742c 2069 665f  turn tr_lst, if_
+00072b20: 6c73 742c 2067 7466 5f6c 696e 6573 2c20  lst, gtf_lines, 
+00072b30: 6773 697a 652c 2067 766f 6c2c 206d 6e2c  gsize, gvol, mn,
+00072b40: 2063 6e74 2c20 6772 702c 2067 636e 742c   cnt, grp, gcnt,
+00072b50: 2067 642c 206e 702e 6172 7261 7928 5b65   gd, np.array([e
+00072b60: 7431 2c65 7432 2c65 7433 2c65 7434 2c20  t1,et2,et3,et4, 
+00072b70: 6574 352c 2065 7436 5d29 2c20 6574 780a  et5, et6]), etx.
+00072b80: 0a64 6566 2067 6574 5f74 7261 6e73 6372  .def get_transcr
+00072b90: 6970 7473 5f6d 6328 2072 676e 735f 6c73  ipts_mc( rgns_ls
+00072ba0: 745f 6d69 2c20 7267 6e73 5f6c 7374 5f6e  t_mi, rgns_lst_n
+00072bb0: 642c 2072 676e 735f 6c73 745f 7374 2c20  d, rgns_lst_st, 
+00072bc0: 7265 6164 5f6c 656e 2c20 616e 6e6f 7420  read_len, annot 
+00072bd0: 3d20 4e6f 6e65 2c20 5c0a 2020 2020 2020  = None, \.      
+00072be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072bf0: 2020 6e5f 636f 7265 7320 3d20 4e55 4d5f    n_cores = NUM_
+00072c00: 434f 5245 532c 206c 656e 5f74 6820 3d20  CORES, len_th = 
+00072c10: 4d49 4e5f 5452 5f4c 454e 4754 482c 206d  MIN_TR_LENGTH, m
+00072c20: 6574 686f 6420 3d20 276c 6173 736f 272c  ethod = 'lasso',
+00072c30: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00072c40: 2020 2020 2020 2020 2020 206e 7265 6320             nrec 
+00072c50: 3d20 302c 2073 7461 7274 203d 2030 2c20  = 0, start = 0, 
+00072c60: 7665 7262 6f73 6520 3d20 5472 7565 2c20  verbose = True, 
+00072c70: 7364 6976 203d 2032 3020 293a 0a0a 2020  sdiv = 20 ):..  
+00072c80: 2020 7374 6172 745f 7469 6d65 203d 2074    start_time = t
+00072c90: 696d 652e 7469 6d65 2829 0a20 2020 2063  ime.time().    c
+00072ca0: 6e74 7020 3d20 303b 2063 6e74 6e20 3d20  ntp = 0; cntn = 
+00072cb0: 303b 2063 6e74 3020 3d20 303b 2063 6e74  0; cnt0 = 0; cnt
+00072cc0: 6620 3d20 303b 2063 6e74 6720 3d20 300a  f = 0; cntg = 0.
+00072cd0: 2020 2020 6670 203d 2030 3b20 666e 203d      fp = 0; fn =
+00072ce0: 2030 3b20 6630 203d 2030 3b20 6666 203d   0; f0 = 0; ff =
+00072cf0: 2030 0a0a 2020 2020 6e5f 7472 203d 2030   0..    n_tr = 0
+00072d00: 0a20 2020 2047 5446 5f6c 7374 203d 205b  .    GTF_lst = [
+00072d10: 5d0a 2020 2020 5472 5f6c 7374 203d 205b  ].    Tr_lst = [
+00072d20: 5d0a 2020 2020 4973 5f6c 7374 203d 205b  ].    Is_lst = [
+00072d30: 5d0a 2020 2020 6d6e 5f6c 7374 203d 205b  ].    mn_lst = [
+00072d40: 5d0a 2020 2020 6772 705f 6c73 7420 3d20  ].    grp_lst = 
+00072d50: 5b5d 0a20 2020 2067 645f 6c73 7420 3d20  [].    gd_lst = 
+00072d60: 5b5d 0a20 2020 2063 645f 7468 203d 206e  [].    cd_th = n
+00072d70: 702e 7a65 726f 7328 6c65 6e28 7267 6e73  p.zeros(len(rgns
+00072d80: 5f6c 7374 5f6d 6929 2c20 6474 7970 653d  _lst_mi), dtype=
+00072d90: 696e 7429 0a20 2020 2077 5f63 6e74 203d  int).    w_cnt =
+00072da0: 206e 702e 7a65 726f 7328 6c65 6e28 7267   np.zeros(len(rg
+00072db0: 6e73 5f6c 7374 5f6d 6929 2c20 6474 7970  ns_lst_mi), dtyp
+00072dc0: 653d 696e 7429 0a20 2020 2067 7369 7a65  e=int).    gsize
+00072dd0: 203d 206e 702e 7a65 726f 7328 6c65 6e28   = np.zeros(len(
+00072de0: 7267 6e73 5f6c 7374 5f6d 6929 2c20 6474  rgns_lst_mi), dt
+00072df0: 7970 653d 696e 7429 0a20 2020 2067 766f  ype=int).    gvo
+00072e00: 6c20 3d20 6e70 2e7a 6572 6f73 286c 656e  l = np.zeros(len
+00072e10: 2872 676e 735f 6c73 745f 6d69 292c 2064  (rgns_lst_mi), d
+00072e20: 7479 7065 3d69 6e74 290a 0a20 2020 2067  type=int)..    g
+00072e30: 636e 7420 3d20 300a 2020 2020 7374 6172  cnt = 0.    star
+00072e40: 745f 7469 6d65 3120 3d20 7469 6d65 2e74  t_time1 = time.t
+00072e50: 696d 6528 290a 2020 2020 6966 2076 6572  ime().    if ver
+00072e60: 626f 7365 3a20 0a20 2020 2020 2020 2069  bose: .        i
+00072e70: 6620 616e 6e6f 7420 6973 204e 6f6e 653a  f annot is None:
+00072e80: 2070 7269 6e74 2827 5c72 5365 6172 6368   print('\rSearch
+00072e90: 2069 736f 666f 726d 7320 2620 6573 7420   isoforms & est 
+00072ea0: 6162 756e 6461 6e63 6573 202e 2e2e 2e2e  abundances .....
+00072eb0: 2027 2c20 656e 643d 2727 290a 2020 2020   ', end='').    
+00072ec0: 2020 2020 656c 7365 3a20 7072 696e 7428      else: print(
+00072ed0: 275c 7252 6563 6f76 6572 696e 6720 6973  '\rRecovering is
+00072ee0: 6f66 6f72 6d73 2026 2065 7374 2061 6275  oforms & est abu
+00072ef0: 6e64 616e 6365 7320 2e2e 2e2e 2e20 272c  ndances ..... ',
+00072f00: 2065 6e64 3d27 2729 0a20 2020 2020 2020   end='').       
+00072f10: 200a 2020 2020 2327 2727 0a20 2020 2067   .    #'''.    g
+00072f20: 7620 3d20 6e70 2e7a 6572 6f73 286c 656e  v = np.zeros(len
+00072f30: 2872 676e 735f 6c73 745f 6e64 2929 0a20  (rgns_lst_nd)). 
+00072f40: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
+00072f50: 6528 6c65 6e28 7267 6e73 5f6c 7374 5f6e  e(len(rgns_lst_n
+00072f60: 6429 293a 0a20 2020 2020 2020 2067 765b  d)):.        gv[
+00072f70: 6b5d 203d 202d 6c65 6e28 7267 6e73 5f6c  k] = -len(rgns_l
+00072f80: 7374 5f6e 645b 6b5d 2e72 676e 7329 2023  st_nd[k].rgns) #
+00072f90: 202d 7267 6e73 5f6c 7374 5f6d 695b 6b5d   -rgns_lst_mi[k]
+00072fa0: 2e67 6574 5f76 6f6c 756d 6528 290a 2020  .get_volume().  
+00072fb0: 2020 6f64 7220 3d20 6776 2e61 7267 736f    odr = gv.argso
+00072fc0: 7274 2829 0a20 2020 2023 2727 270a 2020  rt().    #'''.  
+00072fd0: 2020 0a20 2020 2072 735f 7475 706c 655f    .    rs_tuple_
+00072fe0: 6c73 7420 3d20 5b5d 0a20 2020 2069 6620  lst = [].    if 
+00072ff0: 7374 6172 7420 3d3d 2030 3a0a 2020 2020  start == 0:.    
+00073000: 2020 2020 6966 206e 7265 6320 3d3d 2030      if nrec == 0
+00073010: 3a20 4e72 6563 203d 206c 656e 2872 676e  : Nrec = len(rgn
+00073020: 735f 6c73 745f 6d69 290a 2020 2020 2020  s_lst_mi).      
+00073030: 2020 656c 7365 3a20 4e72 6563 203d 206e    else: Nrec = n
+00073040: 7265 630a 2020 2020 656c 7365 3a0a 2020  rec.    else:.  
+00073050: 2020 2020 2020 4e72 6563 203d 206c 656e        Nrec = len
+00073060: 2872 676e 735f 6c73 745f 6d69 290a 2020  (rgns_lst_mi).  
+00073070: 2020 2020 2020 6966 2073 7461 7274 203e        if start >
+00073080: 3d20 4e72 6563 3a20 7374 6172 7420 3d20  = Nrec: start = 
+00073090: 4e72 6563 2d31 0a0a 2020 2020 666f 7220  Nrec-1..    for 
+000730a0: 6d20 696e 2072 616e 6765 284e 7265 632d  m in range(Nrec-
+000730b0: 7374 6172 7429 3a0a 2020 2020 2020 2020  start):.        
+000730c0: 6b20 3d20 206f 6472 5b6d 2b73 7461 7274  k =  odr[m+start
+000730d0: 5d20 2320 6d20 2b20 7374 6172 740a 2020  ] # m + start.  
+000730e0: 2020 2020 2020 6764 203d 204e 6f6e 650a        gd = None.
+000730f0: 2020 2020 2020 2020 6966 2028 616e 6e6f          if (anno
+00073100: 7420 6973 206e 6f74 204e 6f6e 6529 3a20  t is not None): 
+00073110: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00073120: 6b20 3c20 6c65 6e28 616e 6e6f 7429 3a20  k < len(annot): 
+00073130: 6764 203d 2061 6e6e 6f74 5b6b 5d0a 2020  gd = annot[k].  
+00073140: 2020 2020 2020 7273 5f74 7570 6c65 5f6c        rs_tuple_l
+00073150: 7374 2e61 7070 656e 6428 2028 7267 6e73  st.append( (rgns
+00073160: 5f6c 7374 5f6d 695b 6b5d 2c20 7267 6e73  _lst_mi[k], rgns
+00073170: 5f6c 7374 5f6e 645b 6b5d 2c20 7267 6e73  _lst_nd[k], rgns
+00073180: 5f6c 7374 5f73 745b 6b5d 2c20 6b2c 205c  _lst_st[k], k, \
+00073190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000731a0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000731b0: 656e 5f74 682c 206d 6574 686f 642c 2072  en_th, method, r
+000731c0: 6561 645f 6c65 6e2c 2067 6429 2029 0a20  ead_len, gd) ). 
+000731d0: 2020 200a 2020 2020 6e75 6d5f 636f 7265     .    num_core
+000731e0: 203d 206d 696e 2820 6e5f 636f 7265 732c   = min( n_cores,
+000731f0: 2028 6370 755f 636f 756e 7428 2920 2d20   (cpu_count() - 
+00073200: 3129 2029 0a20 2020 2023 2070 7269 6e74  1) ).    # print
+00073210: 2822 6e75 6d20 636f 7265 7320 746f 2075  ("num cores to u
+00073220: 7365 203d 207b 7d22 2e66 6f72 6d61 7428  se = {}".format(
+00073230: 6e75 6d5f 636f 7265 2929 0a20 2020 2070  num_core)).    p
+00073240: 6f6f 6c20 3d20 506f 6f6c 286e 756d 5f63  ool = Pool(num_c
+00073250: 6f72 6529 0a20 2020 2074 6f74 616c 5f69  ore).    total_i
+00073260: 7465 7261 7469 6f6e 203d 206c 656e 2872  teration = len(r
+00073270: 735f 7475 706c 655f 6c73 7429 0a0a 2020  s_tuple_lst)..  
+00073280: 2020 7374 6172 745f 7469 6d65 3120 3d20    start_time1 = 
+00073290: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
+000732a0: 6966 2076 6572 626f 7365 3a20 0a20 2020  if verbose: .   
+000732b0: 2020 2020 2069 6620 616e 6e6f 7420 6973       if annot is
+000732c0: 204e 6f6e 653a 2070 7269 6e74 2827 5c72   None: print('\r
+000732d0: 5365 6172 6368 2069 736f 666f 726d 7320  Search isoforms 
+000732e0: 2620 6573 7420 6162 756e 6461 6e63 6573  & est abundances
+000732f0: 202e 2e2e 2e2e 2027 2c20 656e 643d 2727   ..... ', end=''
+00073300: 290a 2020 2020 2020 2020 656c 7365 3a20  ).        else: 
+00073310: 7072 696e 7428 275c 7252 6563 6f76 6572  print('\rRecover
+00073320: 696e 6720 6973 6f66 6f72 6d73 2026 2065  ing isoforms & e
+00073330: 7374 2061 6275 6e64 616e 6365 7320 2e2e  st abundances ..
+00073340: 2e2e 2e20 272c 2065 6e64 3d27 2729 0a20  ... ', end=''). 
+00073350: 2020 206d 203d 2031 0a20 2020 2065 7473     m = 1.    ets
+00073360: 5f73 756d 203d 2030 0a20 2020 2065 7478  _sum = 0.    etx
+00073370: 5f73 756d 203d 2030 0a20 2020 2066 6f72  _sum = 0.    for
+00073380: 2074 6c73 742c 2069 6c73 742c 2067 7466   tlst, ilst, gtf
+00073390: 5f6c 696e 6573 2c20 6773 2c20 6776 2c20  _lines, gs, gv, 
+000733a0: 6d6e 2c20 6374 2c20 6772 702c 206b 2c20  mn, ct, grp, k, 
+000733b0: 6764 2c20 6574 732c 2065 7478 2069 6e20  gd, ets, etx in 
+000733c0: 5c0a 2020 2020 2020 2020 706f 6f6c 2e69  \.        pool.i
+000733d0: 6d61 705f 756e 6f72 6465 7265 6428 6d63  map_unordered(mc
+000733e0: 5f63 6f72 655f 6765 745f 7472 2c20 7273  _core_get_tr, rs
+000733f0: 5f74 7570 6c65 5f6c 7374 293a 0a20 2020  _tuple_lst):.   
+00073400: 2020 2020 2023 2074 7164 6d2e 7471 646d       # tqdm.tqdm
+00073410: 5f6e 6f74 6562 6f6f 6b28 706f 6f6c 2e69  _notebook(pool.i
+00073420: 6d61 705f 756e 6f72 6465 7265 6428 6d63  map_unordered(mc
+00073430: 5f63 6f72 655f 6765 745f 7472 2c20 7273  _core_get_tr, rs
+00073440: 5f74 7570 6c65 5f6c 7374 292c 2074 6f74  _tuple_lst), tot
+00073450: 616c 3d74 6f74 616c 5f69 7465 7261 7469  al=total_iterati
+00073460: 6f6e 293a 0a0a 2020 2020 2020 2020 6574  on):..        et
+00073470: 735f 7375 6d20 3d20 6574 735f 7375 6d20  s_sum = ets_sum 
+00073480: 2b20 6574 730a 2020 2020 2020 2020 6574  + ets.        et
+00073490: 785f 7375 6d20 3d20 6574 785f 7375 6d20  x_sum = etx_sum 
+000734a0: 2b20 6574 780a 0a20 2020 2020 2020 2054  + etx..        T
+000734b0: 725f 6c73 7420 3d20 5472 5f6c 7374 202b  r_lst = Tr_lst +
+000734c0: 2074 6c73 740a 2020 2020 2020 2020 4973   tlst.        Is
+000734d0: 5f6c 7374 203d 2049 735f 6c73 7420 2b20  _lst = Is_lst + 
+000734e0: 696c 7374 0a20 2020 2020 2020 2047 5446  ilst.        GTF
+000734f0: 5f6c 7374 203d 2047 5446 5f6c 7374 202b  _lst = GTF_lst +
+00073500: 2067 7466 5f6c 696e 6573 0a20 2020 2020   gtf_lines.     
+00073510: 2020 2067 7369 7a65 5b6b 5d20 3d20 6773     gsize[k] = gs
+00073520: 0a20 2020 2020 2020 2067 766f 6c5b 6b5d  .        gvol[k]
+00073530: 203d 2067 760a 2020 2020 2020 2020 6364   = gv.        cd
+00073540: 5f74 685b 6b5d 203d 206d 6e0a 2020 2020  _th[k] = mn.    
+00073550: 2020 2020 775f 636e 745b 6b5d 203d 2063      w_cnt[k] = c
+00073560: 740a 2020 2020 2020 2020 6966 2067 7270  t.        if grp
+00073570: 2069 7320 6e6f 7420 4e6f 6e65 3a20 0a20   is not None: . 
+00073580: 2020 2020 2020 2020 2020 2067 7270 5f6c             grp_l
+00073590: 7374 2e61 7070 656e 6428 6772 7029 0a20  st.append(grp). 
+000735a0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+000735b0: 2020 2020 6966 2067 6420 6973 206e 6f74      if gd is not
+000735c0: 204e 6f6e 653a 200a 2020 2020 2020 2020   None: .        
+000735d0: 2020 2020 6764 5f6c 7374 2e61 7070 656e      gd_lst.appen
+000735e0: 6428 6764 290a 0a20 2020 2020 2020 2069  d(gd)..        i
+000735f0: 6620 7665 7262 6f73 653a 200a 2020 2020  f verbose: .    
+00073600: 2020 2020 2020 2020 656c 6170 7365 645f          elapsed_
+00073610: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+00073620: 2829 202d 2073 7461 7274 5f74 696d 6531  () - start_time1
+00073630: 0a20 2020 2020 2020 2020 2020 2074 5f74  .            t_t
+00073640: 696d 6520 3d20 656c 6170 7365 645f 7469  ime = elapsed_ti
+00073650: 6d65 2a6c 656e 2872 735f 7475 706c 655f  me*len(rs_tuple_
+00073660: 6c73 7429 2f6d 0a20 2020 2020 2020 2020  lst)/m.         
+00073670: 2020 2072 5f74 696d 6520 3d20 745f 7469     r_time = t_ti
+00073680: 6d65 202d 2065 6c61 7073 6564 5f74 696d  me - elapsed_tim
+00073690: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+000736a0: 206d 2531 3030 203d 3d20 303a 0a20 2020   m%100 == 0:.   
+000736b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000736c0: 616e 6e6f 7420 6973 204e 6f6e 653a 0a20  annot is None:. 
+000736d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000736e0: 2020 2070 7269 6e74 2827 5c72 5365 6172     print('\rSear
+000736f0: 6368 2069 736f 666f 726d 7320 2620 6573  ch isoforms & es
+00073700: 7420 6162 756e 6461 6e63 6573 202e 2e2e  t abundances ...
+00073710: 2e2e 2025 692f 2569 2020 2027 205c 0a20  .. %i/%i   ' \. 
+00073720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073730: 2020 2020 2020 2020 2020 2520 286d 2c20            % (m, 
+00073740: 6c65 6e28 7273 5f74 7570 6c65 5f6c 7374  len(rs_tuple_lst
+00073750: 2929 2c20 656e 643d 2727 290a 2020 2020  )), end='').    
+00073760: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00073770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00073780: 2020 2020 2020 7072 696e 7428 275c 7252        print('\rR
+00073790: 6563 6f76 6572 696e 6720 6973 6f66 6f72  ecovering isofor
+000737a0: 6d73 2026 2065 7374 2061 6275 6e64 616e  ms & est abundan
+000737b0: 6365 7320 2e2e 2e2e 2e20 2569 2f25 6920  ces ..... %i/%i 
+000737c0: 2020 2720 5c0a 2020 2020 2020 2020 2020    ' \.          
+000737d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000737e0: 2025 2028 6d2c 206c 656e 2872 735f 7475   % (m, len(rs_tu
+000737f0: 706c 655f 6c73 7429 292c 2065 6e64 3d27  ple_lst)), end='
+00073800: 2729 0a20 2020 2020 2020 2020 2020 206d  ').            m
+00073810: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00073820: 2020 0a20 2020 2070 6f6f 6c2e 636c 6f73    .    pool.clos
+00073830: 6528 290a 2020 2020 706f 6f6c 2e6a 6f69  e().    pool.joi
+00073840: 6e28 290a 2020 2020 0a20 2020 2069 6620  n().    .    if 
+00073850: 7665 7262 6f73 653a 200a 0a20 2020 2020  verbose: ..     
+00073860: 2020 206e 5f63 6f76 5f65 6820 3d20 300a     n_cov_eh = 0.
+00073870: 2020 2020 2020 2020 2320 6966 2067 6420          # if gd 
+00073880: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00073890: 2020 2020 2069 6620 6c65 6e28 6764 5f6c       if len(gd_l
+000738a0: 7374 2920 3e20 303a 0a20 2020 2020 2020  st) > 0:.       
+000738b0: 2020 2020 2066 6f72 2067 6420 696e 2067       for gd in g
+000738c0: 645f 6c73 743a 0a20 2020 2020 2020 2020  d_lst:.         
+000738d0: 2020 2020 2020 2066 6f72 2074 6420 696e         for td in
+000738e0: 2067 642e 7464 5f6c 7374 3a0a 2020 2020   gd.td_lst:.    
+000738f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073900: 6966 2074 642e 636f 7620 3e20 312e 313a  if td.cov > 1.1:
+00073910: 206e 5f63 6f76 5f65 6820 2b3d 2031 0a0a   n_cov_eh += 1..
+00073920: 2020 2020 2020 2020 656c 6170 7365 645f          elapsed_
+00073930: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
+00073940: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
+00073950: 310a 2020 2020 2020 2020 6966 2061 6e6e  1.        if ann
+00073960: 6f74 2069 7320 4e6f 6e65 3a20 0a20 2020  ot is None: .   
+00073970: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00073980: 5c72 5365 6172 6368 2069 736f 666f 726d  \rSearch isoform
+00073990: 7320 2620 6573 7420 6162 756e 6461 6e63  s & est abundanc
+000739a0: 6573 202e 2e2e 2e2e 2064 6f6e 6520 2825  es ..... done (%
+000739b0: 6929 2020 2020 2020 2020 2020 2020 2020  i)              
+000739c0: 2020 2027 2025 2028 696e 7428 656c 6170     ' % (int(elap
+000739d0: 7365 645f 7469 6d65 3129 2929 0a20 2020  sed_time1))).   
+000739e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000739f0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+00073a00: 5265 636f 7665 7269 6e67 2069 736f 666f  Recovering isofo
+00073a10: 726d 7320 2620 6573 7420 6162 756e 6461  rms & est abunda
+00073a20: 6e63 6573 202e 2e2e 2e2e 2064 6f6e 6520  nces ..... done 
+00073a30: 2825 692c 2025 6929 2020 2020 2020 2020  (%i, %i)        
+00073a40: 2020 2020 2020 2020 2027 2025 2028 696e           ' % (in
+00073a50: 7428 656c 6170 7365 645f 7469 6d65 3129  t(elapsed_time1)
+00073a60: 2c20 6e5f 636f 765f 6568 2929 0a20 2020  , n_cov_eh)).   
+00073a70: 200a 2020 2020 6420 3d20 7b27 6773 697a   .    d = {'gsiz
+00073a80: 6527 3a20 6773 697a 652c 2027 6776 6f6c  e': gsize, 'gvol
+00073a90: 273a 2067 766f 6c2c 2027 6364 5f74 6827  ': gvol, 'cd_th'
+00073aa0: 3a20 6364 5f74 682c 2027 775f 636e 7427  : cd_th, 'w_cnt'
+00073ab0: 3a20 775f 636e 7420 7d0a 2020 2020 6466  : w_cnt }.    df
+00073ac0: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
+00073ad0: 6461 7461 203d 2064 290a 2020 2020 0a20  data = d).    . 
+00073ae0: 2020 2072 6574 7572 6e20 5472 5f6c 7374     return Tr_lst
+00073af0: 2c20 4973 5f6c 7374 2c20 4754 465f 6c73  , Is_lst, GTF_ls
+00073b00: 742c 2064 662c 2067 7270 5f6c 7374 2c20  t, df, grp_lst, 
+00073b10: 6764 5f6c 7374 2c20 6574 735f 7375 6d2c  gd_lst, ets_sum,
+00073b20: 2065 7478 5f73 756d 2023 206d 6e5f 6c73   etx_sum # mn_ls
+00073b30: 740a 0a0a 6465 6620 6765 745f 7472 616e  t...def get_tran
+00073b40: 7363 7269 7074 7328 2072 676e 735f 6c73  scripts( rgns_ls
+00073b50: 745f 6d69 2c20 7267 6e73 5f6c 7374 5f6e  t_mi, rgns_lst_n
+00073b60: 642c 2072 676e 735f 6c73 745f 7374 2c20  d, rgns_lst_st, 
+00073b70: 7265 6164 5f6c 656e 2c20 616e 6e6f 7420  read_len, annot 
+00073b80: 3d20 4e6f 6e65 2c20 6c65 6e5f 7468 203d  = None, len_th =
+00073b90: 204d 494e 5f54 525f 4c45 4e47 5448 2c20   MIN_TR_LENGTH, 
+00073ba0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00073bb0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
+00073bc0: 276c 6173 736f 272c 206e 7265 6320 3d20  'lasso', nrec = 
+00073bd0: 302c 2073 7461 7274 203d 2030 2c20 7665  0, start = 0, ve
+00073be0: 7262 6f73 6520 3d20 5472 7565 2c20 7364  rbose = True, sd
+00073bf0: 6976 203d 2032 3020 293a 0a0a 2020 2020  iv = 20 ):..    
+00073c00: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
+00073c10: 652e 7469 6d65 2829 0a20 2020 2063 6e74  e.time().    cnt
+00073c20: 7020 3d20 303b 2063 6e74 6e20 3d20 303b  p = 0; cntn = 0;
+00073c30: 2063 6e74 3020 3d20 303b 2063 6e74 6620   cnt0 = 0; cntf 
+00073c40: 3d20 303b 2063 6e74 6720 3d20 300a 2020  = 0; cntg = 0.  
+00073c50: 2020 6670 203d 2030 3b20 666e 203d 2030    fp = 0; fn = 0
+00073c60: 3b20 6630 203d 2030 3b20 6666 203d 2030  ; f0 = 0; ff = 0
+00073c70: 0a0a 2020 2020 6e5f 7472 203d 2030 0a20  ..    n_tr = 0. 
+00073c80: 2020 2047 5446 5f6c 7374 203d 205b 5d0a     GTF_lst = [].
+00073c90: 2020 2020 5472 5f6c 7374 203d 205b 5d0a      Tr_lst = [].
+00073ca0: 2020 2020 4973 5f6c 7374 203d 205b 5d0a      Is_lst = [].
+00073cb0: 2020 2020 6d6e 5f6c 7374 203d 205b 5d0a      mn_lst = [].
+00073cc0: 2020 2020 6772 705f 6c73 7420 3d20 5b5d      grp_lst = []
+00073cd0: 0a20 2020 2067 645f 6c73 7420 3d20 5b5d  .    gd_lst = []
+00073ce0: 0a20 2020 2063 645f 7468 203d 206e 702e  .    cd_th = np.
+00073cf0: 7a65 726f 7328 6c65 6e28 7267 6e73 5f6c  zeros(len(rgns_l
+00073d00: 7374 5f6d 6929 2c20 6474 7970 653d 696e  st_mi), dtype=in
+00073d10: 7429 0a20 2020 2077 5f63 6e74 203d 206e  t).    w_cnt = n
+00073d20: 702e 7a65 726f 7328 6c65 6e28 7267 6e73  p.zeros(len(rgns
+00073d30: 5f6c 7374 5f6d 6929 2c20 6474 7970 653d  _lst_mi), dtype=
+00073d40: 696e 7429 0a20 2020 2067 7369 7a65 203d  int).    gsize =
+00073d50: 206e 702e 7a65 726f 7328 6c65 6e28 7267   np.zeros(len(rg
+00073d60: 6e73 5f6c 7374 5f6d 6929 2c20 6474 7970  ns_lst_mi), dtyp
+00073d70: 653d 696e 7429 0a20 2020 2067 766f 6c20  e=int).    gvol 
+00073d80: 3d20 6e70 2e7a 6572 6f73 286c 656e 2872  = np.zeros(len(r
+00073d90: 676e 735f 6c73 745f 6d69 292c 2064 7479  gns_lst_mi), dty
+00073da0: 7065 3d69 6e74 290a 0a20 2020 2067 636e  pe=int)..    gcn
+00073db0: 7420 3d20 300a 2020 2020 7374 6172 745f  t = 0.    start_
+00073dc0: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
+00073dd0: 6528 290a 2020 2020 6966 2076 6572 626f  e().    if verbo
+00073de0: 7365 3a20 0a20 2020 2020 2020 2069 6620  se: .        if 
+00073df0: 616e 6e6f 7420 6973 204e 6f6e 653a 2070  annot is None: p
+00073e00: 7269 6e74 2827 5c72 5365 6172 6368 2069  rint('\rSearch i
+00073e10: 736f 666f 726d 7320 2620 6573 7420 6162  soforms & est ab
+00073e20: 756e 6461 6e63 6573 202e 2e2e 2e2e 2027  undances ..... '
+00073e30: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
+00073e40: 2020 656c 7365 3a20 7072 696e 7428 275c    else: print('\
+00073e50: 7252 6563 6f76 6572 696e 6720 6973 6f66  rRecovering isof
+00073e60: 6f72 6d73 2026 2065 7374 2061 6275 6e64  orms & est abund
+00073e70: 616e 6365 7320 2e2e 2e2e 2e20 272c 2065  ances ..... ', e
+00073e80: 6e64 3d27 2729 0a20 2020 2020 2020 200a  nd='').        .
+00073e90: 2020 2020 2327 2727 0a20 2020 2067 7620      #'''.    gv 
+00073ea0: 3d20 6e70 2e7a 6572 6f73 286c 656e 2872  = np.zeros(len(r
+00073eb0: 676e 735f 6c73 745f 6e64 292c 2064 7479  gns_lst_nd), dty
+00073ec0: 7065 3d6e 702e 666c 6f61 7433 3229 0a20  pe=np.float32). 
+00073ed0: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
+00073ee0: 6528 6c65 6e28 7267 6e73 5f6c 7374 5f6e  e(len(rgns_lst_n
+00073ef0: 6429 293a 0a20 2020 2020 2020 2067 765b  d)):.        gv[
+00073f00: 6b5d 203d 202d 6c65 6e28 7267 6e73 5f6c  k] = -len(rgns_l
+00073f10: 7374 5f6e 645b 6b5d 2e72 676e 7329 2023  st_nd[k].rgns) #
+00073f20: 202d 7267 6e73 5f6c 7374 5f6d 695b 6b5d   -rgns_lst_mi[k]
+00073f30: 2e67 6574 5f76 6f6c 756d 6528 290a 2020  .get_volume().  
+00073f40: 2020 6f64 7220 3d20 6776 2e61 7267 736f    odr = gv.argso
+00073f50: 7274 2829 0a20 2020 2023 2727 270a 2020  rt().    #'''.  
+00073f60: 2020 0a20 2020 2072 735f 7475 706c 655f    .    rs_tuple_
+00073f70: 6c73 7420 3d20 5b5d 0a20 2020 2069 6620  lst = [].    if 
+00073f80: 7374 6172 7420 3d3d 2030 3a0a 2020 2020  start == 0:.    
+00073f90: 2020 2020 6966 206e 7265 6320 3d3d 2030      if nrec == 0
+00073fa0: 3a20 4e72 6563 203d 206c 656e 2872 676e  : Nrec = len(rgn
+00073fb0: 735f 6c73 745f 6d69 290a 2020 2020 2020  s_lst_mi).      
+00073fc0: 2020 656c 7365 3a20 4e72 6563 203d 206e    else: Nrec = n
+00073fd0: 7265 630a 2020 2020 656c 7365 3a0a 2020  rec.    else:.  
+00073fe0: 2020 2020 2020 4e72 6563 203d 206c 656e        Nrec = len
+00073ff0: 2872 676e 735f 6c73 745f 6d69 290a 2020  (rgns_lst_mi).  
+00074000: 2020 2020 2020 6966 2073 7461 7274 203e        if start >
+00074010: 3d20 4e72 6563 3a20 7374 6172 7420 3d20  = Nrec: start = 
+00074020: 4e72 6563 2d31 0a0a 2020 2020 666f 7220  Nrec-1..    for 
+00074030: 6d20 696e 2072 616e 6765 284e 7265 632d  m in range(Nrec-
+00074040: 7374 6172 7429 3a0a 2020 2020 2020 2020  start):.        
+00074050: 6b20 3d20 6f64 725b 6d2b 7374 6172 745d  k = odr[m+start]
+00074060: 0a20 2020 2020 2020 2067 6420 3d20 4e6f  .        gd = No
+00074070: 6e65 0a20 2020 2020 2020 2069 6620 2861  ne.        if (a
+00074080: 6e6e 6f74 2069 7320 6e6f 7420 4e6f 6e65  nnot is not None
+00074090: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
+000740a0: 6966 206b 203c 206c 656e 2861 6e6e 6f74  if k < len(annot
+000740b0: 293a 2067 6420 3d20 616e 6e6f 745b 6b5d  ): gd = annot[k]
+000740c0: 0a20 2020 2020 2020 2072 735f 7475 706c  .        rs_tupl
+000740d0: 655f 6c73 742e 6170 7065 6e64 2820 2872  e_lst.append( (r
+000740e0: 676e 735f 6c73 745f 6d69 5b6b 5d2c 2072  gns_lst_mi[k], r
+000740f0: 676e 735f 6c73 745f 6e64 5b6b 5d2c 2072  gns_lst_nd[k], r
+00074100: 676e 735f 6c73 745f 7374 5b6b 5d2c 206b  gns_lst_st[k], k
+00074110: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00074120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074130: 2020 6c65 6e5f 7468 2c20 6d65 7468 6f64    len_th, method
+00074140: 2c20 7265 6164 5f6c 656e 2c20 6764 2920  , read_len, gd) 
+00074150: 290a 0a20 2020 2065 7473 5f73 756d 203d  )..    ets_sum =
+00074160: 2030 2020 2020 2020 2020 0a20 2020 2065   0        .    e
+00074170: 7478 5f73 756d 203d 2030 2020 2020 2020  tx_sum = 0      
+00074180: 2020 0a20 2020 2066 6f72 206d 2069 6e20    .    for m in 
+00074190: 7261 6e67 6528 6c65 6e28 7273 5f74 7570  range(len(rs_tup
+000741a0: 6c65 5f6c 7374 2929 3a0a 2020 2020 2020  le_lst)):.      
+000741b0: 2020 0a20 2020 2020 2020 2074 6c73 742c    .        tlst,
+000741c0: 2069 6c73 742c 2067 7466 5f6c 696e 6573   ilst, gtf_lines
+000741d0: 2c20 6773 2c20 6776 2c20 6d6e 2c20 6374  , gs, gv, mn, ct
+000741e0: 2c20 6772 702c 206b 2c20 6764 2c20 6574  , grp, k, gd, et
+000741f0: 732c 2065 7478 203d 206d 635f 636f 7265  s, etx = mc_core
+00074200: 5f67 6574 5f74 7228 7273 5f74 7570 6c65  _get_tr(rs_tuple
+00074210: 5f6c 7374 5b6d 5d29 0a20 2020 2020 2020  _lst[m]).       
+00074220: 200a 2020 2020 2020 2020 6574 735f 7375   .        ets_su
+00074230: 6d20 3d20 6574 735f 7375 6d20 2b20 6574  m = ets_sum + et
+00074240: 730a 2020 2020 2020 2020 6574 785f 7375  s.        etx_su
+00074250: 6d20 3d20 6574 785f 7375 6d20 2b20 6574  m = etx_sum + et
+00074260: 780a 0a20 2020 2020 2020 2054 725f 6c73  x..        Tr_ls
+00074270: 7420 3d20 5472 5f6c 7374 202b 2074 6c73  t = Tr_lst + tls
+00074280: 740a 2020 2020 2020 2020 4973 5f6c 7374  t.        Is_lst
+00074290: 203d 2049 735f 6c73 7420 2b20 696c 7374   = Is_lst + ilst
+000742a0: 0a20 2020 2020 2020 2047 5446 5f6c 7374  .        GTF_lst
+000742b0: 203d 2047 5446 5f6c 7374 202b 2067 7466   = GTF_lst + gtf
+000742c0: 5f6c 696e 6573 0a20 2020 2020 2020 2067  _lines.        g
+000742d0: 7369 7a65 5b6b 5d20 3d20 6773 0a20 2020  size[k] = gs.   
+000742e0: 2020 2020 2067 766f 6c5b 6b5d 203d 2067       gvol[k] = g
+000742f0: 760a 2020 2020 2020 2020 6364 5f74 685b  v.        cd_th[
+00074300: 6b5d 203d 206d 6e0a 2020 2020 2020 2020  k] = mn.        
+00074310: 775f 636e 745b 6b5d 203d 2063 740a 2020  w_cnt[k] = ct.  
+00074320: 2020 2020 2020 6966 2067 7270 2069 7320        if grp is 
+00074330: 6e6f 7420 4e6f 6e65 3a20 0a20 2020 2020  not None: .     
+00074340: 2020 2020 2020 2067 7270 5f6c 7374 2e61         grp_lst.a
+00074350: 7070 656e 6428 6772 7029 0a20 2020 2020  ppend(grp).     
+00074360: 2020 2020 2020 2067 645f 6c73 742e 6170         gd_lst.ap
+00074370: 7065 6e64 2867 6429 0a0a 2020 2020 2020  pend(gd)..      
+00074380: 2020 6966 2076 6572 626f 7365 3a20 0a20    if verbose: . 
+00074390: 2020 2020 2020 2020 2020 2069 6620 6d20             if m 
+000743a0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+000743b0: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
+000743c0: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
+000743d0: 2d20 7374 6172 745f 7469 6d65 310a 2020  - start_time1.  
+000743e0: 2020 2020 2020 2020 2020 2020 2020 745f                t_
+000743f0: 7469 6d65 203d 2065 6c61 7073 6564 5f74  time = elapsed_t
+00074400: 696d 652a 6c65 6e28 7273 5f74 7570 6c65  ime*len(rs_tuple
+00074410: 5f6c 7374 292f 6d0a 2020 2020 2020 2020  _lst)/m.        
+00074420: 2020 2020 2020 2020 725f 7469 6d65 203d          r_time =
+00074430: 2074 5f74 696d 6520 2d20 656c 6170 7365   t_time - elapse
+00074440: 645f 7469 6d65 0a20 2020 2020 2020 2020  d_time.         
+00074450: 2020 2020 2020 2069 6620 6d25 3130 3020         if m%100 
+00074460: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00074470: 2020 2020 2020 2020 2020 6966 2061 6e6e            if ann
+00074480: 6f74 2069 7320 4e6f 6e65 3a0a 2020 2020  ot is None:.    
+00074490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000744a0: 2020 2020 7072 696e 7428 275c 7253 6561      print('\rSea
+000744b0: 7263 6820 6973 6f66 6f72 6d73 2026 2065  rch isoforms & e
+000744c0: 7374 2061 6275 6e64 616e 6365 7320 2e2e  st abundances ..
+000744d0: 2e2e 2e20 2569 2f25 6920 2020 2720 5c0a  ... %i/%i   ' \.
+000744e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000744f0: 2020 2020 2020 2020 2020 2020 2020 2025                 %
+00074500: 2028 696e 7428 725f 7469 6d65 292c 206d   (int(r_time), m
+00074510: 2c20 6c65 6e28 7273 5f74 7570 6c65 5f6c  , len(rs_tuple_l
+00074520: 7374 2929 2c20 656e 643d 2727 290a 2020  st)), end='').  
+00074530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074540: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00074550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074560: 7072 696e 7428 275c 7252 6563 6f76 6572  print('\rRecover
+00074570: 696e 6720 6973 6f66 6f72 6d73 2026 2065  ing isoforms & e
+00074580: 7374 2061 6275 6e64 616e 6365 7320 2e2e  st abundances ..
+00074590: 2e2e 2e20 2569 2f25 6920 2020 2720 5c0a  ... %i/%i   ' \.
+000745a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000745b0: 2020 2020 2020 2020 2020 2020 2020 2025                 %
+000745c0: 2028 6d2c 206c 656e 2872 735f 7475 706c   (m, len(rs_tupl
+000745d0: 655f 6c73 7429 292c 2065 6e64 3d27 2729  e_lst)), end='')
+000745e0: 0a20 2020 200a 2020 2020 6966 2076 6572  .    .    if ver
+000745f0: 626f 7365 3a20 0a20 2020 2020 2020 2065  bose: .        e
+00074600: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
+00074610: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
+00074620: 7274 5f74 696d 6531 0a20 2020 2020 2020  rt_time1.       
+00074630: 2069 6620 616e 6e6f 7420 6973 204e 6f6e   if annot is Non
+00074640: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+00074650: 7072 696e 7428 275c 7253 6561 7263 6820  print('\rSearch 
+00074660: 6973 6f66 6f72 6d73 2026 2065 7374 2061  isoforms & est a
+00074670: 6275 6e64 616e 6365 7320 2e2e 2e2e 2e20  bundances ..... 
+00074680: 646f 6e65 2028 2569 2920 2020 2020 2020  done (%i)       
+00074690: 2020 2020 2020 2020 2720 2520 2869 6e74          ' % (int
+000746a0: 2865 6c61 7073 6564 5f74 696d 6531 2929  (elapsed_time1))
+000746b0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000746c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000746d0: 7428 275c 7252 6563 6f76 6572 696e 6720  t('\rRecovering 
+000746e0: 6973 6f66 6f72 6d73 2026 2065 7374 2061  isoforms & est a
+000746f0: 6275 6e64 616e 6365 7320 2e2e 2e2e 2e20  bundances ..... 
+00074700: 646f 6e65 2028 2569 2920 2020 2020 2020  done (%i)       
+00074710: 2020 2020 2020 2020 2720 2520 2869 6e74          ' % (int
+00074720: 2865 6c61 7073 6564 5f74 696d 6531 2929  (elapsed_time1))
+00074730: 290a 2020 2020 0a20 2020 2064 203d 207b  ).    .    d = {
+00074740: 2767 7369 7a65 273a 2067 7369 7a65 2c20  'gsize': gsize, 
+00074750: 2767 766f 6c27 3a20 6776 6f6c 2c20 2763  'gvol': gvol, 'c
+00074760: 645f 7468 273a 2063 645f 7468 2c20 2777  d_th': cd_th, 'w
+00074770: 5f63 6e74 273a 2077 5f63 6e74 207d 0a20  _cnt': w_cnt }. 
+00074780: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
+00074790: 7261 6d65 2864 6174 6120 3d20 6429 0a20  rame(data = d). 
+000747a0: 2020 200a 2020 2020 7265 7475 726e 2054     .    return T
+000747b0: 725f 6c73 742c 2049 735f 6c73 742c 2047  r_lst, Is_lst, G
+000747c0: 5446 5f6c 7374 2c20 6466 2c20 6772 705f  TF_lst, df, grp_
+000747d0: 6c73 742c 2067 645f 6c73 742c 2065 7473  lst, gd_lst, ets
+000747e0: 5f73 756d 2c20 6574 785f 7375 6d20 2320  _sum, etx_sum # 
+000747f0: 6d6e 5f6c 7374 0a0a 0a23 2323 2323 2323  mn_lst...#######
+00074800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00074810: 2323 2323 230a 2323 2323 2053 7472 696e  #####.#### Strin
+00074820: 6746 6978 206d 6169 6e20 2323 2323 2323  gFix main ######
+00074830: 2323 0a0a 6465 6620 6765 745f 7470 6d28  ##..def get_tpm(
+00074840: 7472 5f6c 7374 293a 0a20 2020 200a 2020  tr_lst):.    .  
+00074850: 2020 6162 6e5f 746f 7461 6c20 3d20 300a    abn_total = 0.
+00074860: 2020 2020 666f 7220 7472 2069 6e20 7472      for tr in tr
+00074870: 5f6c 7374 3a0a 2020 2020 2020 2020 6162  _lst:.        ab
+00074880: 6e5f 746f 7461 6c20 2b3d 2074 722e 6162  n_total += tr.ab
+00074890: 6e0a 2020 2020 6e66 203d 2031 3030 3030  n.    nf = 10000
+000748a0: 3030 2f61 626e 5f74 6f74 616c 0a0a 2020  00/abn_total..  
+000748b0: 2020 7472 5f6c 7374 5f6f 7574 203d 205b    tr_lst_out = [
+000748c0: 5d0a 2020 2020 666f 7220 7420 696e 2074  ].    for t in t
+000748d0: 725f 6c73 743a 0a20 2020 2020 2020 2054  r_lst:.        T
+000748e0: 504d 203d 2074 2e74 706d 2a6e 660a 2020  PM = t.tpm*nf.  
+000748f0: 2020 2020 2020 7472 203d 2054 7261 6e73        tr = Trans
+00074900: 6372 6970 7428 742e 7072 6566 6978 2c74  cript(t.prefix,t
+00074910: 2e67 6964 782c 742e 6772 705f 7369 7a65  .gidx,t.grp_size
+00074920: 2c74 2e69 636e 742c 742e 6368 722c 742e  ,t.icnt,t.chr,t.
+00074930: 7374 6172 742c 742e 656e 642c 742e 7374  start,t.end,t.st
+00074940: 7261 6e64 2c20 742e 6364 6e67 2c20 5c0a  rand, t.cdng, \.
+00074950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074960: 2020 2020 2020 2020 742e 7365 712c 742e          t.seq,t.
+00074970: 6162 6e2c 2054 504d 2c20 742e 6973 6f5f  abn, TPM, t.iso_
+00074980: 6672 6163 2c20 742e 7072 6f62 2c20 742e  frac, t.prob, t.
+00074990: 6e65 7873 2c20 742e 6776 6f6c 290a 2020  nexs, t.gvol).  
+000749a0: 2020 2020 2020 7472 5f6c 7374 5f6f 7574        tr_lst_out
+000749b0: 2e61 7070 656e 6428 7472 290a 2020 2020  .append(tr).    
+000749c0: 2020 2020 0a20 2020 2072 6574 7572 6e28      .    return(
+000749d0: 7472 5f6c 7374 5f6f 7574 290a 0a64 6566  tr_lst_out)..def
+000749e0: 2066 696c 7465 725f 7267 6e73 2820 725f   filter_rgns( r_
+000749f0: 6c73 745f 6d2c 2072 5f6c 7374 5f6e 642c  lst_m, r_lst_nd,
+00074a00: 2072 5f6c 7374 5f73 7469 2c20 766f 6c5f   r_lst_sti, vol_
+00074a10: 7468 2c20 735f 7468 203d 2030 2e39 2029  th, s_th = 0.9 )
+00074a20: 3a0a 2020 2020 0a20 2020 2074 6f5f 6465  :.    .    to_de
+00074a30: 6c20 3d20 5b5d 0a20 2020 2066 6f72 206b  l = [].    for k
+00074a40: 2c20 7220 696e 2065 6e75 6d65 7261 7465  , r in enumerate
+00074a50: 2872 5f6c 7374 5f6d 293a 0a20 2020 2020  (r_lst_m):.     
+00074a60: 2020 2076 6f6c 203d 2072 2e67 6574 5f76     vol = r.get_v
+00074a70: 6f6c 756d 6528 2920 2320 2b20 722e 6765  olume() # + r.ge
+00074a80: 745f 766f 6c75 6d65 2829 0a20 2020 2020  t_volume().     
+00074a90: 2020 2069 6620 2876 6f6c 203c 2076 6f6c     if (vol < vol
+00074aa0: 5f74 6829 3a0a 2020 2020 2020 2020 2020  _th):.          
+00074ab0: 2020 746f 5f64 656c 2e61 7070 656e 6428    to_del.append(
+00074ac0: 6b29 0a20 2020 2020 2020 2065 6c73 653a  k).        else:
+00074ad0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00074ae0: 722e 636e 745f 7220 3e20 303a 0a20 2020  r.cnt_r > 0:.   
+00074af0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00074b00: 722e 636e 745f 732f 722e 636e 745f 7220  r.cnt_s/r.cnt_r 
+00074b10: 3e20 735f 7468 3a20 746f 5f64 656c 2e61  > s_th: to_del.a
+00074b20: 7070 656e 6428 6b29 0a20 2020 2020 2020  ppend(k).       
+00074b30: 2020 2020 200a 2020 2020 6966 206c 656e       .    if len
+00074b40: 2874 6f5f 6465 6c29 203e 2030 3a0a 2020  (to_del) > 0:.  
+00074b50: 2020 2020 2020 746f 5f64 656c 2e73 6f72        to_del.sor
+00074b60: 7428 7265 7665 7273 653d 5472 7565 290a  t(reverse=True).
+00074b70: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
+00074b80: 2074 6f5f 6465 6c3a 200a 2020 2020 2020   to_del: .      
+00074b90: 2020 2020 2020 6465 6c20 725f 6c73 745f        del r_lst_
+00074ba0: 6d5b 6b5d 0a20 2020 2020 2020 2020 2020  m[k].           
+00074bb0: 2064 656c 2072 5f6c 7374 5f6e 645b 6b5d   del r_lst_nd[k]
+00074bc0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00074bd0: 2072 5f6c 7374 5f73 7469 5b6b 5d0a 2020   r_lst_sti[k].  
+00074be0: 2020 0a20 2020 2072 6574 7572 6e28 725f    .    return(r_
+00074bf0: 6c73 745f 6d2c 2072 5f6c 7374 5f6e 642c  lst_m, r_lst_nd,
+00074c00: 2072 5f6c 7374 5f73 7469 290a 0a0a 6465   r_lst_sti)...de
+00074c10: 6620 6669 6c74 6572 5f72 676e 735f 6f6c  f filter_rgns_ol
+00074c20: 6428 2072 5f6c 7374 5f6d 2c20 725f 6c73  d( r_lst_m, r_ls
+00074c30: 745f 6e64 2c20 766f 6c5f 7468 2029 3a0a  t_nd, vol_th ):.
+00074c40: 2020 2020 0a20 2020 2074 6f5f 6465 6c20      .    to_del 
+00074c50: 3d20 5b5d 0a20 2020 2066 6f72 206b 2069  = [].    for k i
+00074c60: 6e20 7261 6e67 6528 6c65 6e28 725f 6c73  n range(len(r_ls
+00074c70: 745f 6d29 293a 0a20 2020 2020 2020 2076  t_m)):.        v
+00074c80: 6f6c 203d 2072 5f6c 7374 5f6d 5b6b 5d2e  ol = r_lst_m[k].
+00074c90: 6765 745f 766f 6c75 6d65 2829 0a20 2020  get_volume().   
+00074ca0: 2020 2020 2069 6620 766f 6c20 3c20 766f       if vol < vo
+00074cb0: 6c5f 7468 3a0a 2020 2020 2020 2020 2020  l_th:.          
+00074cc0: 2020 746f 5f64 656c 2e61 7070 656e 6428    to_del.append(
+00074cd0: 6b29 0a20 2020 2020 2020 2020 2020 200a  k).            .
+00074ce0: 2020 2020 6966 206c 656e 2874 6f5f 6465      if len(to_de
+00074cf0: 6c29 203e 2030 3a0a 2020 2020 2020 2020  l) > 0:.        
+00074d00: 746f 5f64 656c 2e73 6f72 7428 7265 7665  to_del.sort(reve
+00074d10: 7273 653d 5472 7565 290a 2020 2020 2020  rse=True).      
+00074d20: 2020 666f 7220 6b20 696e 2074 6f5f 6465    for k in to_de
+00074d30: 6c3a 200a 2020 2020 2020 2020 2020 2020  l: .            
+00074d40: 6465 6c20 725f 6c73 745f 6d5b 6b5d 0a20  del r_lst_m[k]. 
+00074d50: 2020 2020 2020 2020 2020 2064 656c 2072             del r
+00074d60: 5f6c 7374 5f6e 645b 6b5d 0a20 2020 200a  _lst_nd[k].    .
+00074d70: 2020 2020 7265 7475 726e 2872 5f6c 7374      return(r_lst
+00074d80: 5f6d 2c20 725f 6c73 745f 6e64 290a 0a0a  _m, r_lst_nd)...
+00074d90: 2323 2320 4465 6661 756c 7420 5472 7320  ### Default Trs 
+00074da0: 4669 6c74 6572 2070 6172 616d 6574 6572  Filter parameter
+00074db0: 730a 6465 6620 6368 6563 6b5f 7267 6e73  s.def check_rgns
+00074dc0: 2820 7267 6e73 5f6c 7374 5f6d 692c 2072  ( rgns_lst_mi, r
+00074dd0: 676e 735f 6c73 745f 6e64 2029 3a0a 0a20  gns_lst_nd ):.. 
+00074de0: 2020 2063 6e74 203d 2030 0a20 2020 2076     cnt = 0.    v
+00074df0: 5f74 6f74 203d 2030 0a20 2020 2076 5f68  _tot = 0.    v_h
+00074e00: 7962 203d 2030 0a20 2020 2066 6f72 206b  yb = 0.    for k
+00074e10: 2069 6e20 7261 6e67 6528 6c65 6e28 7267   in range(len(rg
+00074e20: 6e73 5f6c 7374 5f6d 6929 293a 0a20 2020  ns_lst_mi)):.   
+00074e30: 2020 2020 2063 766f 6c20 3d20 7267 6e73       cvol = rgns
+00074e40: 5f6c 7374 5f6d 695b 6b5d 2e67 6574 5f76  _lst_mi[k].get_v
+00074e50: 6f6c 756d 6528 290a 2020 2020 2020 2020  olume().        
+00074e60: 765f 746f 7420 2b3d 2063 766f 6c0a 2020  v_tot += cvol.  
+00074e70: 2020 2020 2020 6370 203d 2030 0a20 2020        cp = 0.   
+00074e80: 2020 2020 2063 6e20 3d20 300a 2020 2020       cn = 0.    
+00074e90: 2020 2020 666f 7220 6d20 696e 2072 616e      for m in ran
+00074ea0: 6765 286c 656e 2872 676e 735f 6c73 745f  ge(len(rgns_lst_
+00074eb0: 6e64 5b6b 5d2e 7267 6e73 2929 3a0a 2020  nd[k].rgns)):.  
+00074ec0: 2020 2020 2020 2020 2020 6966 2072 676e            if rgn
+00074ed0: 735f 6c73 745f 6e64 5b6b 5d2e 7267 6e73  s_lst_nd[k].rgns
+00074ee0: 5b6d 5d2e 7873 203c 2030 3a20 636e 202b  [m].xs < 0: cn +
+00074ef0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00074f00: 656c 6966 2072 676e 735f 6c73 745f 6e64  elif rgns_lst_nd
+00074f10: 5b6b 5d2e 7267 6e73 5b6d 5d2e 7873 203e  [k].rgns[m].xs >
+00074f20: 2030 3a20 6370 202b 3d20 310a 2020 2020   0: cp += 1.    
+00074f30: 2020 2020 6966 2028 6370 203e 2030 2920      if (cp > 0) 
+00074f40: 2620 2863 6e20 3e20 3029 3a0a 2020 2020  & (cn > 0):.    
+00074f50: 2020 2020 2020 2020 765f 6879 6220 2b3d          v_hyb +=
+00074f60: 2063 766f 6c0a 2020 2020 2020 2020 2020   cvol.          
+00074f70: 2020 636e 7420 2b3d 2031 0a20 2020 2020    cnt += 1.     
+00074f80: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+00074f90: 3d3d 3d20 2569 203d 3d3d 2720 2520 6b29  === %i ===' % k)
+00074fa0: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
+00074fb0: 676e 735f 6c73 745f 6d69 5b6b 5d2e 7072  gns_lst_mi[k].pr
+00074fc0: 696e 745f 7368 6f72 7428 290a 2020 2020  int_short().    
+00074fd0: 2020 2020 2020 2020 2320 7267 6e73 5f6c          # rgns_l
+00074fe0: 7374 5f6e 645b 6b5d 2e70 7269 6e74 5f73  st_nd[k].print_s
+00074ff0: 686f 7274 2829 0a20 2020 2020 2020 2020  hort().         
+00075000: 2020 200a 2020 2020 7265 7475 726e 2063     .    return c
+00075010: 6e74 2c20 765f 6879 622c 2076 5f74 6f74  nt, v_hyb, v_tot
+00075020: 0a20 2020 200a 0a27 2727 0a4c 494e 455f  .    ..'''.LINE_
+00075030: 5641 4c49 4420 3d20 300a 4e4f 5f4d 4f52  VALID = 0.NO_MOR
+00075040: 455f 4c49 4e45 203d 2034 0a4c 494e 455f  E_LINE = 4.LINE_
+00075050: 494e 5641 4c49 4420 3d20 320a 0a43 4f4e  INVALID = 2..CON
+00075060: 5449 4e55 4544 203d 2030 0a4e 4557 5f43  TINUED = 0.NEW_C
+00075070: 4852 4d20 3d20 310a 2320 4c49 4e45 5f49  HRM = 1.# LINE_I
+00075080: 4e56 414c 4944 203d 2032 0a4e 4f54 5f53  NVALID = 2.NOT_S
+00075090: 4f52 5445 4420 3d20 330a 2727 270a 0a64  ORTED = 3.'''..d
+000750a0: 6566 2063 6865 636b 5f73 7472 616e 6428  ef check_strand(
+000750b0: 2072 5f6d 5f6c 7374 2c20 725f 6e64 5f6c   r_m_lst, r_nd_l
+000750c0: 7374 2029 3a0a 2020 2020 0a20 2020 2070  st ):.    .    p
+000750d0: 6f73 203d 2030 0a20 2020 206e 6567 203d  os = 0.    neg =
+000750e0: 2030 0a20 2020 2066 6f72 2072 2069 6e20   0.    for r in 
+000750f0: 725f 6e64 5f6c 7374 3a0a 2020 2020 2020  r_nd_lst:.      
+00075100: 2020 6966 206c 656e 2872 2e72 676e 7329    if len(r.rgns)
+00075110: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00075120: 2020 6966 2072 2e72 676e 735b 305d 2e78    if r.rgns[0].x
+00075130: 7320 3e20 303a 2070 6f73 202b 3d20 310a  s > 0: pos += 1.
+00075140: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00075150: 2072 2e72 676e 735b 305d 2e78 7320 3c20   r.rgns[0].xs < 
+00075160: 303a 206e 6567 202b 3d20 310a 2020 2020  0: neg += 1.    
+00075170: 2020 2020 2020 2020 0a20 2020 2066 6f72          .    for
+00075180: 2072 2069 6e20 725f 6d5f 6c73 743a 0a20   r in r_m_lst:. 
+00075190: 2020 2020 2020 2069 6620 6c65 6e28 722e         if len(r.
+000751a0: 7267 6e73 2920 3e20 303a 0a20 2020 2020  rgns) > 0:.     
+000751b0: 2020 2020 2020 2069 6620 722e 7267 6e73         if r.rgns
+000751c0: 5b30 5d2e 7873 203e 2030 3a20 706f 7320  [0].xs > 0: pos 
+000751d0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+000751e0: 2065 6c69 6620 722e 7267 6e73 5b30 5d2e   elif r.rgns[0].
+000751f0: 7873 203c 2030 3a20 6e65 6720 2b3d 2031  xs < 0: neg += 1
+00075200: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00075210: 2020 7265 7475 726e 2070 6f73 2c20 6e65    return pos, ne
+00075220: 670a 0a0a 6465 6620 6d63 5f63 6f72 655f  g...def mc_core_
+00075230: 6275 696c 645f 636e 7467 2873 616d 5f6c  build_cntg(sam_l
+00075240: 7374 5f6e 5f73 6129 3a0a 2020 2020 0a20  st_n_sa):.    . 
+00075250: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
+00075260: 7361 6d5f 6c73 742c 2073 6120 3d20 7361  sam_lst, sa = sa
+00075270: 6d5f 6c73 745f 6e5f 7361 5b3a 2d31 5d2c  m_lst_n_sa[:-1],
+00075280: 2073 616d 5f6c 7374 5f6e 5f73 615b 2d31   sam_lst_n_sa[-1
+00075290: 5d20 2020 2020 2020 200a 2020 2020 6966  ]        .    if
+000752a0: 2028 6c65 6e28 7361 6d5f 6c73 7429 203e   (len(sam_lst) >
+000752b0: 3d20 4d49 4e5f 4e5f 5244 535f 5045 525f  = MIN_N_RDS_PER_
+000752c0: 4745 4e45 293a 2023 204d 494e 5f52 445f  GENE): # MIN_RD_
+000752d0: 4e55 4d5f 5045 525f 4745 4e45 293a 2023  NUM_PER_GENE): #
+000752e0: 2026 2028 2863 703d 3d30 2920 7c20 2863   & ((cp==0) | (c
+000752f0: 6e3d 3d30 2929 3a0a 0a20 2020 2020 2020  n==0)):..       
+00075300: 2072 5f6c 7374 5f6d 2c20 725f 6c73 745f   r_lst_m, r_lst_
+00075310: 6e64 2c20 725f 6c73 745f 7374 692c 2072  nd, r_lst_sti, r
+00075320: 676e 5f69 6478 203d 205c 0a20 2020 2020  gn_idx = \.     
+00075330: 2020 2020 2020 2067 6574 5f72 6567 696f         get_regio
+00075340: 6e73 5f61 6c6c 5f66 726f 6d5f 7361 6d28  ns_all_from_sam(
+00075350: 2073 616d 5f6c 7374 2c20 7361 203d 2073   sam_lst, sa = s
+00075360: 6120 290a 2020 2020 2020 2020 6220 3d20  a ).        b = 
+00075370: 4661 6c73 650a 2020 2020 2020 2020 7361  False.        sa
+00075380: 6d5f 6c73 7420 3d20 4e6f 6e65 2023 205b  m_lst = None # [
+00075390: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
+000753a0: 2020 2069 6620 623a 0a20 2020 2020 2020     if b:.       
+000753b0: 2072 5f6c 7374 5f6d 203d 205b 5d0a 2020   r_lst_m = [].  
+000753c0: 2020 2020 2020 725f 6c73 745f 6e64 203d        r_lst_nd =
+000753d0: 205b 5d0a 2020 2020 2020 2020 725f 6c73   [].        r_ls
+000753e0: 745f 7374 6920 3d20 5b5d 0a20 2020 200a  t_sti = [].    .
+000753f0: 2020 2020 7265 7475 726e 2072 5f6c 7374      return r_lst
+00075400: 5f6d 2c20 725f 6c73 745f 6e64 2c20 725f  _m, r_lst_nd, r_
+00075410: 6c73 745f 7374 690a 0a0a 6465 6620 6275  lst_sti...def bu
+00075420: 696c 645f 636f 6e74 6967 7328 735f 6c73  ild_contigs(s_ls
+00075430: 745f 6f66 5f6c 7374 2c20 7469 746c 6520  t_of_lst, title 
+00075440: 3d20 2727 293a 0a20 2020 200a 2020 2020  = ''):.    .    
+00075450: 7267 6e73 5f6c 7374 5f6d 6920 3d20 5b5d  rgns_lst_mi = []
+00075460: 0a20 2020 2072 676e 735f 6c73 745f 6e64  .    rgns_lst_nd
+00075470: 203d 205b 5d0a 2020 2020 7267 6e73 5f6c   = [].    rgns_l
+00075480: 7374 5f73 7420 3d20 5b5d 0a20 2020 200a  st_st = [].    .
+00075490: 2020 2020 666f 7220 6b2c 2073 5f6c 7374      for k, s_lst
+000754a0: 2069 6e20 656e 756d 6572 6174 6528 735f   in enumerate(s_
+000754b0: 6c73 745f 6f66 5f6c 7374 293a 0a20 2020  lst_of_lst):.   
+000754c0: 2020 2020 200a 2020 2020 2020 2020 725f       .        r_
+000754d0: 6c73 745f 6d69 2c20 725f 6c73 745f 6e64  lst_mi, r_lst_nd
+000754e0: 2c20 725f 6c73 745f 7374 203d 206d 635f  , r_lst_st = mc_
+000754f0: 636f 7265 5f62 7569 6c64 5f63 6e74 6728  core_build_cntg(
+00075500: 735f 6c73 7429 0a20 2020 2020 2020 2072  s_lst).        r
+00075510: 676e 735f 6c73 745f 6d69 203d 2072 676e  gns_lst_mi = rgn
+00075520: 735f 6c73 745f 6d69 202b 2072 5f6c 7374  s_lst_mi + r_lst
+00075530: 5f6d 690a 2020 2020 2020 2020 7267 6e73  _mi.        rgns
+00075540: 5f6c 7374 5f6e 6420 3d20 7267 6e73 5f6c  _lst_nd = rgns_l
+00075550: 7374 5f6e 6420 2b20 725f 6c73 745f 6e64  st_nd + r_lst_nd
+00075560: 0a20 2020 2020 2020 2072 676e 735f 6c73  .        rgns_ls
+00075570: 745f 7374 203d 2072 676e 735f 6c73 745f  t_st = rgns_lst_
+00075580: 7374 202b 2072 5f6c 7374 5f73 740a 0a20  st + r_lst_st.. 
+00075590: 2020 2020 2020 2069 6620 6b25 3130 3020         if k%100 
+000755a0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+000755b0: 2020 2320 7072 696e 7428 275c 7242 7569    # print('\rBui
+000755c0: 6c64 696e 6720 6c6f 6369 2026 2043 4d61  lding loci & CMa
+000755d0: 7420 2e2e 2e20 2825 692f 2569 6729 2020  t ... (%i/%ig)  
+000755e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000755f0: 2020 2020 2020 2720 5c0a 2020 2020 2020        ' \.      
+00075600: 2020 2020 2020 2320 2020 2020 2020 2520        #       % 
+00075610: 286b 2c20 6c65 6e28 735f 6c73 745f 6f66  (k, len(s_lst_of
+00075620: 5f6c 7374 2929 2c20 656e 643d 2727 290a  _lst)), end='').
+00075630: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00075640: 7428 275c 7227 202b 2027 2027 2a31 3030  t('\r' + ' '*100
+00075650: 2c20 656e 643d 2727 2c20 666c 7573 6820  , end='', flush 
+00075660: 3d20 5472 7565 290a 2020 2020 2020 2020  = True).        
+00075670: 2020 2020 6966 206c 656e 2874 6974 6c65      if len(title
+00075680: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00075690: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
+000756a0: 7242 7569 6c64 696e 6720 6c6f 6369 2026  rBuilding loci &
+000756b0: 2043 4d61 7420 2e2e 2e20 2825 692f 2569   CMat ... (%i/%i
+000756c0: 6329 2027 205c 0a20 2020 2020 2020 2020  c) ' \.         
+000756d0: 2020 2020 2020 2020 2020 2020 2025 2028               % (
+000756e0: 6b2c 206c 656e 2873 5f6c 7374 5f6f 665f  k, len(s_lst_of_
+000756f0: 6c73 7429 292c 2065 6e64 3d27 272c 2066  lst)), end='', f
+00075700: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
+00075710: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00075720: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00075730: 7269 6e74 2827 5c72 2020 2070 726f 6365  rint('\r   proce
+00075740: 7373 696e 6720 2573 2028 2569 2f25 6963  ssing %s (%i/%ic
+00075750: 2920 2720 5c0a 2020 2020 2020 2020 2020  ) ' \.          
+00075760: 2020 2020 2020 2020 2020 2020 2520 2874              % (t
+00075770: 6974 6c65 2c20 6b2c 206c 656e 2873 5f6c  itle, k, len(s_l
+00075780: 7374 5f6f 665f 6c73 7429 292c 2065 6e64  st_of_lst)), end
+00075790: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
+000757a0: 6529 0a20 2020 200a 2020 2020 2320 7072  e).    .    # pr
+000757b0: 696e 7428 275c 7242 7569 6c64 696e 6720  int('\rBuilding 
+000757c0: 6c6f 6369 2026 2043 4d61 7420 2e2e 2e20  loci & CMat ... 
+000757d0: 646f 6e65 2028 2569 6729 2020 2020 2020  done (%ig)      
+000757e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000757f0: 2020 2720 2520 286c 656e 2873 5f6c 7374    ' % (len(s_lst
+00075800: 5f6f 665f 6c73 7429 292c 2065 6e64 3d27  _of_lst)), end='
+00075810: 2729 0a20 2020 2072 6574 7572 6e20 7267  ').    return rg
+00075820: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
+00075830: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
+00075840: 5f73 740a 0a0a 6465 6620 6275 696c 645f  _st...def build_
+00075850: 636f 6e74 6967 735f 6d63 2873 5f6c 7374  contigs_mc(s_lst
+00075860: 5f6f 665f 6c73 742c 206e 5f63 6f72 6573  _of_lst, n_cores
+00075870: 203d 204e 554d 5f43 4f52 4553 2c20 7469   = NUM_CORES, ti
+00075880: 746c 6520 3d20 2727 293a 0a20 2020 200a  tle = ''):.    .
+00075890: 2020 2020 7267 6e73 5f6c 7374 5f6d 6920      rgns_lst_mi 
+000758a0: 3d20 5b5d 0a20 2020 2072 676e 735f 6c73  = [].    rgns_ls
+000758b0: 745f 6e64 203d 205b 5d0a 2020 2020 7267  t_nd = [].    rg
+000758c0: 6e73 5f6c 7374 5f73 7420 3d20 5b5d 0a20  ns_lst_st = []. 
+000758d0: 2020 200a 2020 2020 6e75 6d5f 636f 7265     .    num_core
+000758e0: 203d 206d 6178 2820 6d69 6e28 206e 5f63   = max( min( n_c
+000758f0: 6f72 6573 2c20 2863 7075 5f63 6f75 6e74  ores, (cpu_count
+00075900: 2829 202d 2031 2920 292c 2031 290a 2020  () - 1) ), 1).  
+00075910: 2020 706f 6f6c 203d 2050 6f6f 6c28 6e75    pool = Pool(nu
+00075920: 6d5f 636f 7265 290a 2020 2020 746f 7461  m_core).    tota
+00075930: 6c5f 6974 6572 6174 696f 6e20 3d20 6c65  l_iteration = le
+00075940: 6e28 735f 6c73 745f 6f66 5f6c 7374 290a  n(s_lst_of_lst).
+00075950: 2020 2020 0a20 2020 2069 6620 5472 7565      .    if True
+00075960: 3a20 2320 6e6f 7420 5451 444d 3a0a 2020  : # not TQDM:.  
+00075970: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
+00075980: 5f6c 7374 5f6f 665f 6c73 742e 736f 7274  _lst_of_lst.sort
+00075990: 2872 6576 6572 7365 203d 2054 7275 652c  (reverse = True,
+000759a0: 206b 6579 3d6c 656e 290a 0a20 2020 2020   key=len)..     
+000759b0: 2020 2070 7269 6e74 2827 5c72 2720 2b20     print('\r' + 
+000759c0: 2720 272a 3130 302c 2065 6e64 3d27 272c  ' '*100, end='',
+000759d0: 2066 6c75 7368 203d 2054 7275 6529 0a20   flush = True). 
+000759e0: 2020 2020 2020 2069 6620 6c65 6e28 7469         if len(ti
+000759f0: 746c 6529 203d 3d20 303a 0a20 2020 2020  tle) == 0:.     
+00075a00: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+00075a10: 4275 696c 6469 6e67 206c 6f63 6920 2620  Building loci & 
+00075a20: 434d 6174 202e 2e2e 2020 272c 2065 6e64  CMat ...  ', end
+00075a30: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
+00075a40: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
+00075a50: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00075a60: 6e74 2827 5c72 2020 2070 726f 6365 7373  nt('\r   process
+00075a70: 696e 6720 2573 202e 2e2e 2027 2025 2028  ing %s ... ' % (
+00075a80: 7469 746c 6529 2c20 656e 643d 2727 2c20  title), end='', 
+00075a90: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
+00075aa0: 2020 2020 2020 6b20 3d20 300a 2020 2020        k = 0.    
+00075ab0: 2020 2020 666f 7220 725f 6c73 745f 6d69      for r_lst_mi
+00075ac0: 2c20 725f 6c73 745f 6e64 2c20 725f 6c73  , r_lst_nd, r_ls
+00075ad0: 745f 7374 2069 6e20 706f 6f6c 2e69 6d61  t_st in pool.ima
+00075ae0: 705f 756e 6f72 6465 7265 6428 6d63 5f63  p_unordered(mc_c
+00075af0: 6f72 655f 6275 696c 645f 636e 7467 2c20  ore_build_cntg, 
+00075b00: 735f 6c73 745f 6f66 5f6c 7374 293a 0a20  s_lst_of_lst):. 
+00075b10: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
+00075b20: 6c73 745f 6d69 203d 2072 676e 735f 6c73  lst_mi = rgns_ls
+00075b30: 745f 6d69 202b 2072 5f6c 7374 5f6d 690a  t_mi + r_lst_mi.
+00075b40: 2020 2020 2020 2020 2020 2020 7267 6e73              rgns
+00075b50: 5f6c 7374 5f6e 6420 3d20 7267 6e73 5f6c  _lst_nd = rgns_l
+00075b60: 7374 5f6e 6420 2b20 725f 6c73 745f 6e64  st_nd + r_lst_nd
+00075b70: 0a20 2020 2020 2020 2020 2020 2072 676e  .            rgn
+00075b80: 735f 6c73 745f 7374 203d 2072 676e 735f  s_lst_st = rgns_
+00075b90: 6c73 745f 7374 202b 2072 5f6c 7374 5f73  lst_st + r_lst_s
+00075ba0: 7420 2020 200a 2020 2020 2020 2020 2020  t    .          
+00075bb0: 2020 0a20 2020 2020 2020 2020 2020 206b    .            k
+00075bc0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00075bd0: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
+00075be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00075bf0: 2070 7269 6e74 2827 5c72 2720 2b20 2720   print('\r' + ' 
+00075c00: 272a 3130 302c 2065 6e64 3d27 272c 2066  '*100, end='', f
+00075c10: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
+00075c20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00075c30: 6c65 6e28 7469 746c 6529 203d 3d20 303a  len(title) == 0:
+00075c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00075c50: 2020 2020 2070 7269 6e74 2827 5c72 4275       print('\rBu
+00075c60: 696c 6469 6e67 206c 6f63 6920 2620 434d  ilding loci & CM
+00075c70: 6174 202e 2e2e 2028 2569 2f25 6963 2920  at ... (%i/%ic) 
+00075c80: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
+00075c90: 2020 2020 2020 2020 2020 2020 2020 2520                % 
+00075ca0: 286b 2c20 746f 7461 6c5f 6974 6572 6174  (k, total_iterat
+00075cb0: 696f 6e29 2c20 656e 643d 2727 2c20 666c  ion), end='', fl
+00075cc0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+00075cd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00075ce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00075cf0: 2020 2020 2020 7072 696e 7428 275c 7220        print('\r 
+00075d00: 2020 7072 6f63 6573 7369 6e67 2025 7320    processing %s 
+00075d10: 2e2e 2e20 2825 692f 2569 6329 2027 205c  ... (%i/%ic) ' \
+00075d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00075d30: 2020 2020 2020 2020 2020 2025 2028 7469             % (ti
+00075d40: 746c 652c 206b 2c20 746f 7461 6c5f 6974  tle, k, total_it
+00075d50: 6572 6174 696f 6e29 2c20 656e 643d 2727  eration), end=''
+00075d60: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+00075d70: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00075d80: 2070 6f6f 6c2e 636c 6f73 6528 290a 2020   pool.close().  
+00075d90: 2020 706f 6f6c 2e6a 6f69 6e28 290a 2020    pool.join().  
+00075da0: 2020 0a20 2020 2072 6574 7572 6e20 7267    .    return rg
+00075db0: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
+00075dc0: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
+00075dd0: 5f73 740a 0a0a 6465 6620 7072 6f63 5f72  _st...def proc_r
+00075de0: 6561 645f 7361 6d28 2073 616d 5f6f 626a  ead_sam( sam_obj
+00075df0: 2c20 7120 293a 0a20 2020 200a 2020 2020  , q ):.    .    
+00075e00: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
+00075e10: 2020 2020 6572 5f63 6f64 652c 2073 616d      er_code, sam
+00075e20: 5f6c 7374 2c20 6e75 6d5f 7265 6164 7320  _lst, num_reads 
+00075e30: 3d20 7361 6d5f 6f62 6a2e 6765 745f 6f6e  = sam_obj.get_on
+00075e40: 655f 6f76 6572 6c61 7065 645f 7361 6d28  e_overlaped_sam(
+00075e50: 2920 2020 2020 2020 200a 2020 2020 2020  )        .      
+00075e60: 2020 712e 7075 7428 2028 6572 5f63 6f64    q.put( (er_cod
+00075e70: 652c 2073 616d 5f6c 7374 2c20 7361 6d5f  e, sam_lst, sam_
+00075e80: 6f62 6a2e 6e75 6d5f 7265 6164 7329 2029  obj.num_reads) )
+00075e90: 0a20 2020 2020 2020 2069 6620 6572 5f63  .        if er_c
+00075ea0: 6f64 6520 3d3d 204e 4f5f 4d4f 5245 5f4c  ode == NO_MORE_L
+00075eb0: 494e 453a 2062 7265 616b 0a20 2020 2020  INE: break.     
+00075ec0: 2020 200a 0a64 6566 2073 6176 655f 7267     ..def save_rg
+00075ed0: 6e73 5f6f 626a 2866 696c 656e 616d 652c  ns_obj(filename,
+00075ee0: 2072 676e 735f 6c73 745f 6d2c 2072 676e   rgns_lst_m, rgn
+00075ef0: 735f 6c73 745f 6e64 2c20 7267 6e73 5f6c  s_lst_nd, rgns_l
+00075f00: 7374 5f73 7469 2c20 7264 5f6c 656e 2c20  st_sti, rd_len, 
+00075f10: 6e5f 7264 732c 206d 6564 5f66 7261 675f  n_rds, med_frag_
+00075f20: 6c65 6e20 293a 0a20 2020 200a 2020 2020  len ):.    .    
+00075f30: 7769 7468 206f 7065 6e28 6669 6c65 6e61  with open(filena
+00075f40: 6d65 2c20 2777 6227 2920 6173 2066 3a0a  me, 'wb') as f:.
+00075f50: 2020 2020 2020 2020 7069 636b 6c65 2e64          pickle.d
+00075f60: 756d 7028 2028 7267 6e73 5f6c 7374 5f6d  ump( (rgns_lst_m
+00075f70: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
+00075f80: 676e 735f 6c73 745f 7374 692c 2072 645f  gns_lst_sti, rd_
+00075f90: 6c65 6e2c 206e 5f72 6473 2c20 6d65 645f  len, n_rds, med_
+00075fa0: 6672 6167 5f6c 656e 292c 2066 2029 0a20  frag_len), f ). 
+00075fb0: 2020 2020 2020 200a 6465 6620 6c6f 6164         .def load
+00075fc0: 5f72 676e 735f 6f62 6a28 6669 6c65 6e61  _rgns_obj(filena
+00075fd0: 6d65 293a 0a20 2020 200a 2020 2020 7769  me):.    .    wi
+00075fe0: 7468 206f 7065 6e28 6669 6c65 6e61 6d65  th open(filename
+00075ff0: 2c20 2772 6227 2920 6173 2066 3a0a 2020  , 'rb') as f:.  
+00076000: 2020 2020 2020 6461 7461 203d 2070 6963        data = pic
+00076010: 6b6c 652e 6c6f 6164 2820 6620 290a 2020  kle.load( f ).  
+00076020: 2020 2020 2020 2320 7267 6e73 5f6c 7374        # rgns_lst
+00076030: 5f6d 2c20 7267 6e73 5f6c 7374 5f6e 642c  _m, rgns_lst_nd,
+00076040: 2072 676e 735f 6c73 745f 7374 692c 2072   rgns_lst_sti, r
+00076050: 645f 6c65 6e2c 206e 5f72 6473 2c20 6d65  d_len, n_rds, me
+00076060: 645f 6672 6167 5f6c 656e 203d 2070 6963  d_frag_len = pic
+00076070: 6b6c 652e 6c6f 6164 2820 6620 290a 2020  kle.load( f ).  
+00076080: 2020 2320 7265 7475 726e 2072 676e 735f    # return rgns_
+00076090: 6c73 745f 6d2c 2072 676e 735f 6c73 745f  lst_m, rgns_lst_
+000760a0: 6e64 2c20 7267 6e73 5f6c 7374 5f73 7469  nd, rgns_lst_sti
+000760b0: 2c20 7264 5f6c 656e 2c20 6e5f 7264 732c  , rd_len, n_rds,
+000760c0: 206d 6564 5f66 7261 675f 6c65 6e0a 2020   med_frag_len.  
+000760d0: 2020 7265 7475 726e 2064 6174 610a 200a    return data. .
+000760e0: 6465 6620 7361 7665 5f6f 626a 2866 696c  def save_obj(fil
+000760f0: 656e 616d 652c 206f 626a 2029 3a0a 2020  ename, obj ):.  
+00076100: 2020 0a20 2020 2077 6974 6820 6f70 656e    .    with open
+00076110: 2866 696c 656e 616d 652c 2027 7762 2729  (filename, 'wb')
+00076120: 2061 7320 663a 0a20 2020 2020 2020 2070   as f:.        p
+00076130: 6963 6b6c 652e 6475 6d70 2820 286f 626a  ickle.dump( (obj
+00076140: 292c 2066 2029 0a20 2020 2020 2020 200a  ), f ).        .
+00076150: 6465 6620 6c6f 6164 5f6f 626a 2866 696c  def load_obj(fil
+00076160: 656e 616d 6529 3a0a 2020 2020 0a20 2020  ename):.    .   
+00076170: 2077 6974 6820 6f70 656e 2866 696c 656e   with open(filen
+00076180: 616d 652c 2027 7262 2729 2061 7320 663a  ame, 'rb') as f:
+00076190: 0a20 2020 2020 2020 206f 626a 203d 2070  .        obj = p
+000761a0: 6963 6b6c 652e 6c6f 6164 2820 6620 290a  ickle.load( f ).
+000761b0: 2020 2020 7265 7475 726e 206f 626a 0a0a      return obj..
+000761c0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+000761d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000761e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000761f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00076200: 2323 2323 2323 2323 2323 230a 2323 2053  ###########.## S
+00076210: 7472 696e 6746 6978 2d41 6e61 6c79 7369  tringFix-Analysi
+00076220: 730a 2323 2323 2323 2323 2323 2323 2323  s.##############
+00076230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00076240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00076250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00076260: 2323 2323 2323 2323 2323 2323 0a0a 6465  ############..de
+00076270: 6620 6669 6c74 6572 5f74 7273 5f6c 656e  f filter_trs_len
+00076280: 2820 6661 5f6c 696e 6573 5f6c 6973 742c  ( fa_lines_list,
+00076290: 206d 696e 5f6c 656e 203d 2030 2029 3a0a   min_len = 0 ):.
+000762a0: 0a20 2020 204c 656e 2020 3d20 6c65 6e28  .    Len  = len(
+000762b0: 6661 5f6c 696e 6573 5f6c 6973 7429 0a20  fa_lines_list). 
+000762c0: 2020 2069 6620 4c65 6e25 3220 213d 2030     if Len%2 != 0
+000762d0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+000762e0: 2745 5252 4f52 2069 6e20 6669 6c74 6572  'ERROR in filter
+000762f0: 5f74 7273 5f6c 656e 3a20 4e75 6d20 6c69  _trs_len: Num li
+00076300: 6e65 7320 3d20 2569 2027 2025 204c 656e  nes = %i ' % Len
+00076310: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00076320: 6e20 5b5d 0a20 2020 2065 6c73 653a 0a20  n [].    else:. 
+00076330: 2020 2020 2020 2066 615f 6c69 6e65 735f         fa_lines_
+00076340: 6f75 7420 3d20 5b5d 0a20 2020 2020 2020  out = [].       
+00076350: 204e 756d 203d 206e 702e 696e 7428 4c65   Num = np.int(Le
+00076360: 6e2f 3229 0a20 2020 2020 2020 2066 6f72  n/2).        for
+00076370: 206b 2069 6e20 7261 6e67 6528 4e75 6d29   k in range(Num)
+00076380: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00076390: 206c 656e 2866 615f 6c69 6e65 735f 6c69   len(fa_lines_li
+000763a0: 7374 5b20 6b2a 322b 3120 5d29 203e 206d  st[ k*2+1 ]) > m
+000763b0: 696e 5f6c 656e 3a20 2320 696e 636c 7564  in_len: # includ
+000763c0: 696e 6720 275c 6e27 0a20 2020 2020 2020  ing '\n'.       
+000763d0: 2020 2020 2020 2020 2066 615f 6c69 6e65           fa_line
+000763e0: 735f 6f75 742e 6170 7065 6e64 2820 6661  s_out.append( fa
+000763f0: 5f6c 696e 6573 5f6c 6973 745b 206b 2a32  _lines_list[ k*2
+00076400: 205d 2029 0a20 2020 2020 2020 2020 2020   ] ).           
+00076410: 2020 2020 2066 615f 6c69 6e65 735f 6f75       fa_lines_ou
+00076420: 742e 6170 7065 6e64 2820 6661 5f6c 696e  t.append( fa_lin
+00076430: 6573 5f6c 6973 745b 206b 2a32 2b31 205d  es_list[ k*2+1 ]
+00076440: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00076450: 6e20 6661 5f6c 696e 6573 5f6f 7574 0a0a  n fa_lines_out..
+00076460: 0a64 6566 2066 696c 7465 725f 7472 735f  .def filter_trs_
+00076470: 3128 7472 732c 2066 7261 675f 6c65 6e20  1(trs, frag_len 
+00076480: 3d20 3830 2c20 675f 7468 203d 2031 302c  = 80, g_th = 10,
+00076490: 2061 626e 5f74 685f 7420 3d20 312c 2061   abn_th_t = 1, a
+000764a0: 626e 5f74 685f 6920 3d20 312c 205c 0a20  bn_th_i = 1, \. 
+000764b0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+000764c0: 6f5f 6672 6163 5f74 6820 3d20 302e 3031  o_frac_th = 0.01
+000764d0: 2c20 6c65 6e5f 7468 203d 2032 3030 2c20  , len_th = 200, 
+000764e0: 7665 7262 6f73 6520 3d20 5472 7565 2029  verbose = True )
+000764f0: 3a0a 2020 2020 0a20 2020 2069 6620 7665  :.    .    if ve
+00076500: 7262 6f73 6520 3d3d 2054 7275 6520 3a20  rbose == True : 
+00076510: 7072 696e 7428 2746 696c 7465 7269 6e67  print('Filtering
+00076520: 202e 2e2e 2027 2c20 656e 643d 2727 2029   ... ', end='' )
+00076530: 0a20 2020 2074 7273 5f6f 7574 203d 205b  .    trs_out = [
+00076540: 5d0a 2020 2020 6973 666d 5f6f 7574 203d  ].    isfm_out =
+00076550: 205b 5d0a 2020 2020 6e74 6920 3d20 300a   [].    nti = 0.
+00076560: 2020 2020 6e69 6920 3d20 300a 2020 2020      nii = 0.    
+00076570: 6e74 6f20 3d20 300a 2020 2020 6e69 6f20  nto = 0.    nio 
+00076580: 3d20 300a 2020 2020 666f 7220 7472 2069  = 0.    for tr i
+00076590: 6e20 7472 733a 0a20 2020 2020 2020 2069  n trs:.        i
+000765a0: 6620 7472 2e70 7265 6669 7820 3d3d 2027  f tr.prefix == '
+000765b0: 5427 3a0a 2020 2020 2020 2020 2020 2020  T':.            
+000765c0: 6e74 6920 2b3d 2031 0a20 2020 2020 2020  nti += 1.       
+000765d0: 2020 2020 2069 6620 7472 2e6e 6578 7320       if tr.nexs 
+000765e0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+000765f0: 2020 2020 2020 6966 2028 7472 2e67 766f        if (tr.gvo
+00076600: 6c20 3e3d 2067 5f74 682a 6672 6167 5f6c  l >= g_th*frag_l
+00076610: 656e 2a31 2920 2620 2874 722e 6162 6e20  en*1) & (tr.abn 
+00076620: 3e3d 2061 626e 5f74 685f 742a 342e 3529  >= abn_th_t*4.5)
+00076630: 2026 2028 6c65 6e28 7472 2e73 6571 2920   & (len(tr.seq) 
+00076640: 3e3d 206c 656e 5f74 6829 3a20 0a20 2020  >= len_th): .   
+00076650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076660: 206e 746f 202b 3d20 310a 2020 2020 2020   nto += 1.      
+00076670: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00076680: 735f 6f75 742e 6170 7065 6e64 2874 7229  s_out.append(tr)
+00076690: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000766a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000766b0: 2020 2069 6620 2874 722e 6e65 7873 203e     if (tr.nexs >
+000766c0: 3d20 3429 3a0a 2020 2020 2020 2020 2020  = 4):.          
+000766d0: 2020 2020 2020 2020 2020 6966 2028 7472            if (tr
+000766e0: 2e67 766f 6c20 3e3d 2067 5f74 682a 6672  .gvol >= g_th*fr
+000766f0: 6167 5f6c 656e 2920 2620 2874 722e 6162  ag_len) & (tr.ab
+00076700: 6e20 3e3d 2061 626e 5f74 685f 7429 2026  n >= abn_th_t) &
+00076710: 2028 6c65 6e28 7472 2e73 6571 2920 3e3d   (len(tr.seq) >=
+00076720: 206c 656e 5f74 6829 3a20 0a20 2020 2020   len_th): .     
+00076730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076740: 2020 206e 746f 202b 3d20 310a 2020 2020     nto += 1.    
+00076750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076760: 2020 2020 7472 735f 6f75 742e 6170 7065      trs_out.appe
+00076770: 6e64 2874 7229 0a20 2020 2020 2020 2020  nd(tr).         
+00076780: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00076790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000767a0: 2069 6620 2874 722e 6776 6f6c 203e 3d20   if (tr.gvol >= 
+000767b0: 675f 7468 2a66 7261 675f 6c65 6e29 2026  g_th*frag_len) &
+000767c0: 2028 7472 2e61 626e 203e 3d20 6162 6e5f   (tr.abn >= abn_
+000767d0: 7468 5f74 2920 2620 286c 656e 2874 722e  th_t) & (len(tr.
+000767e0: 7365 7129 203e 3d20 6c65 6e5f 7468 293a  seq) >= len_th):
+000767f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00076800: 2020 2020 2020 2020 2020 6e74 6f20 2b3d            nto +=
+00076810: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00076820: 2020 2020 2020 2020 2020 2074 7273 5f6f             trs_o
+00076830: 7574 2e61 7070 656e 6428 7472 290a 2020  ut.append(tr).  
+00076840: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00076850: 2020 2020 2020 2020 6e69 6920 2b3d 2031          nii += 1
+00076860: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00076870: 2874 722e 6776 6f6c 203e 3d20 675f 7468  (tr.gvol >= g_th
+00076880: 2a66 7261 675f 6c65 6e29 2026 2028 7472  *frag_len) & (tr
+00076890: 2e61 626e 203e 3d20 6162 6e5f 7468 5f69  .abn >= abn_th_i
+000768a0: 2920 2620 2874 722e 6973 6f5f 6672 6163  ) & (tr.iso_frac
+000768b0: 203e 3d20 6973 6f5f 6672 6163 5f74 6829   >= iso_frac_th)
+000768c0: 2026 2028 6c65 6e28 7472 2e73 6571 2920   & (len(tr.seq) 
+000768d0: 3e3d 206c 656e 5f74 6829 3a20 0a20 2020  >= len_th): .   
+000768e0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+000768f0: 7366 6d5f 6f75 742e 6170 7065 6e64 2874  sfm_out.append(t
+00076900: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+00076910: 2020 2074 7273 5f6f 7574 2e61 7070 656e     trs_out.appen
+00076920: 6428 7472 290a 2020 2020 2020 2020 2020  d(tr).          
+00076930: 2020 2020 2020 6e69 6f20 2b3d 2031 0a20        nio += 1. 
+00076940: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00076950: 2020 2020 6966 2076 6572 626f 7365 203d      if verbose =
+00076960: 3d20 5472 7565 203a 2070 7269 6e74 2827  = True : print('
+00076970: 4e75 6d2e 5472 7320 3d20 2569 2025 6920  Num.Trs = %i %i 
+00076980: 2825 6929 202d 3e20 2569 2c20 2569 2028  (%i) -> %i, %i (
+00076990: 2569 2920 2720 2520 286e 7469 2c6e 6969  %i) ' % (nti,nii
+000769a0: 2c6e 7469 2b6e 6969 2c6e 746f 2c6e 696f  ,nti+nii,nto,nio
+000769b0: 2c6e 746f 2b6e 696f 2929 0a20 2020 2023  ,nto+nio)).    #
+000769c0: 2072 6574 7572 6e28 7472 735f 6f75 742c   return(trs_out,
+000769d0: 2069 7366 6d5f 6f75 7429 0a20 2020 2072   isfm_out).    r
+000769e0: 6574 7572 6e28 7472 735f 6f75 7429 0a0a  eturn(trs_out)..
+000769f0: 0a64 6566 2066 696c 7465 725f 7472 735f  .def filter_trs_
+00076a00: 3228 7472 732c 2066 7261 675f 6c65 6e20  2(trs, frag_len 
+00076a10: 3d20 3830 2c20 675f 7468 203d 2031 302c  = 80, g_th = 10,
+00076a20: 2061 626e 5f74 685f 7420 3d20 312c 2061   abn_th_t = 1, a
+00076a30: 626e 5f74 685f 6920 3d20 312c 205c 0a20  bn_th_i = 1, \. 
+00076a40: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00076a50: 6f5f 6672 6163 5f74 6820 3d20 302e 3031  o_frac_th = 0.01
+00076a60: 2c20 6c65 6e5f 7468 203d 2032 3030 2c20  , len_th = 200, 
+00076a70: 6e65 5f74 6820 3d20 342c 2076 6572 626f  ne_th = 4, verbo
+00076a80: 7365 203d 2054 7275 6529 3a0a 2020 2020  se = True):.    
+00076a90: 0a20 2020 2069 6620 7665 7262 6f73 6520  .    if verbose 
+00076aa0: 3d3d 2054 7275 6520 3a20 7072 696e 7428  == True : print(
+00076ab0: 2746 696c 7465 7269 6e67 202e 2e2e 2027  'Filtering ... '
+00076ac0: 2c20 656e 643d 2727 2029 0a20 2020 2074  , end='' ).    t
+00076ad0: 7273 5f6f 7574 203d 205b 5d0a 2020 2020  rs_out = [].    
+00076ae0: 6973 666d 5f6f 7574 203d 205b 5d0a 2020  isfm_out = [].  
+00076af0: 2020 6e74 6920 3d20 300a 2020 2020 6e69    nti = 0.    ni
+00076b00: 6920 3d20 300a 2020 2020 6e74 6f20 3d20  i = 0.    nto = 
+00076b10: 300a 2020 2020 6e69 6f20 3d20 300a 2020  0.    nio = 0.  
+00076b20: 2020 675f 7468 203d 2067 5f74 6820 2a20    g_th = g_th * 
+00076b30: 6162 6e5f 7468 5f69 0a20 2020 2072 6566  abn_th_i.    ref
+00076b40: 5f74 6820 3d20 6e65 5f74 682a 675f 7468  _th = ne_th*g_th
+00076b50: 2a66 7261 675f 6c65 6e2a 6162 6e5f 7468  *frag_len*abn_th
+00076b60: 5f69 0a20 2020 206d 696e 5f61 626e 203d  _i.    min_abn =
+00076b70: 2031 3030 3030 3030 300a 2020 2020 6d69   10000000.    mi
+00076b80: 6e5f 6776 6f6c 203d 2031 3030 3030 3030  n_gvol = 1000000
+00076b90: 300a 2020 2020 6d69 6e5f 6973 6620 3d20  0.    min_isf = 
+00076ba0: 320a 2020 2020 666f 7220 7472 2069 6e20  2.    for tr in 
+00076bb0: 7472 733a 0a20 2020 2020 2020 206d 6574  trs:.        met
+00076bc0: 203d 206d 696e 2874 722e 6772 705f 7369   = min(tr.grp_si
+00076bd0: 7a65 2c20 3429 2a6d 696e 2874 722e 6e65  ze, 4)*min(tr.ne
+00076be0: 7873 2c34 292a 6d69 6e28 7472 2e67 766f  xs,4)*min(tr.gvo
+00076bf0: 6c2c 2034 3030 290a 2020 2020 2020 2020  l, 400).        
+00076c00: 7468 7220 3d20 7265 665f 7468 2f6d 6574  thr = ref_th/met
+00076c10: 0a20 2020 2020 2020 2072 203d 2031 0a20  .        r = 1. 
+00076c20: 2020 2020 2020 2023 2069 6620 7468 7220         # if thr 
+00076c30: 3e20 313a 2072 203d 2031 2e35 0a20 2020  > 1: r = 1.5.   
+00076c40: 2020 2020 2069 6620 7472 2e6e 6578 7320       if tr.nexs 
+00076c50: 3d3d 2031 3a20 7468 7220 2a3d 2034 0a20  == 1: thr *= 4. 
+00076c60: 2020 2020 2020 2069 6620 2874 722e 6776         if (tr.gv
+00076c70: 6f6c 203e 2067 5f74 682a 6672 6167 5f6c  ol > g_th*frag_l
+00076c80: 656e 2a74 6872 2920 2620 2874 722e 6162  en*thr) & (tr.ab
+00076c90: 6e20 3e3d 2061 626e 5f74 685f 692a 7468  n >= abn_th_i*th
+00076ca0: 7229 2026 2028 7472 2e69 736f 5f66 7261  r) & (tr.iso_fra
+00076cb0: 6320 3e3d 2069 736f 5f66 7261 635f 7468  c >= iso_frac_th
+00076cc0: 2920 2620 286c 656e 2874 722e 7473 6571  ) & (len(tr.tseq
+00076cd0: 2920 3e3d 206c 656e 5f74 682a 7229 3a20  ) >= len_th*r): 
+00076ce0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00076cf0: 7472 2e70 7265 6669 7820 3d3d 2027 5427  tr.prefix == 'T'
+00076d00: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+00076d10: 2020 2074 7273 5f6f 7574 2e61 7070 656e     trs_out.appen
+00076d20: 6428 7472 290a 2020 2020 2020 2020 2020  d(tr).          
+00076d30: 2020 2020 2020 6e74 6f20 2b3d 2031 0a20        nto += 1. 
+00076d40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00076d50: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00076d60: 2020 2320 6973 666d 5f6f 7574 2e61 7070    # isfm_out.app
+00076d70: 656e 6428 7472 290a 2020 2020 2020 2020  end(tr).        
+00076d80: 2020 2020 2020 2020 7472 735f 6f75 742e          trs_out.
+00076d90: 6170 7065 6e64 2874 7229 0a20 2020 2020  append(tr).     
+00076da0: 2020 2020 2020 2020 2020 206e 696f 202b             nio +
+00076db0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00076dc0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00076dd0: 206d 696e 5f61 626e 203d 206d 696e 286d   min_abn = min(m
+00076de0: 696e 5f61 626e 2c74 722e 6162 6e29 0a20  in_abn,tr.abn). 
+00076df0: 2020 2020 2020 2020 2020 206d 696e 5f67             min_g
+00076e00: 766f 6c20 3d20 6d69 6e28 6d69 6e5f 6776  vol = min(min_gv
+00076e10: 6f6c 2c74 722e 6776 6f6c 290a 2020 2020  ol,tr.gvol).    
+00076e20: 2020 2020 2020 2020 6d69 6e5f 6973 6620          min_isf 
+00076e30: 3d20 6d69 6e28 6d69 6e5f 6973 662c 7472  = min(min_isf,tr
+00076e40: 2e69 736f 5f66 7261 6329 0a20 2020 2020  .iso_frac).     
+00076e50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00076e60: 6966 2074 722e 7072 6566 6978 203d 3d20  if tr.prefix == 
+00076e70: 2754 273a 206e 7469 202b 3d20 310a 2020  'T': nti += 1.  
+00076e80: 2020 2020 2020 656c 7365 3a20 6e69 6920        else: nii 
+00076e90: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00076ea0: 200a 2020 2020 6966 2076 6572 626f 7365   .    if verbose
+00076eb0: 203d 3d20 5472 7565 203a 200a 2020 2020   == True : .    
+00076ec0: 2020 2020 7072 696e 7428 274e 756d 2e54      print('Num.T
+00076ed0: 7273 203d 2025 6920 2569 2028 2569 2920  rs = %i %i (%i) 
+00076ee0: 2d3e 2025 692c 2025 6920 2825 6929 2720  -> %i, %i (%i)' 
+00076ef0: 2520 286e 7469 2c6e 6969 2c6e 7469 2b6e  % (nti,nii,nti+n
+00076f00: 6969 2c6e 746f 2c6e 696f 2c6e 746f 2b6e  ii,nto,nio,nto+n
+00076f10: 696f 2920 290a 2020 2020 2020 2020 7072  io) ).        pr
+00076f20: 696e 7428 274d 696e 2e41 626e 203d 2025  int('Min.Abn = %
+00076f30: 662c 204d 696e 2e49 736f 4672 6163 203d  f, Min.IsoFrac =
+00076f40: 2025 662c 204d 696e 2e47 566f 6c20 3d20   %f, Min.GVol = 
+00076f50: 2534 2e31 6627 2025 2028 6d69 6e5f 6162  %4.1f' % (min_ab
+00076f60: 6e2c 206d 696e 5f69 7366 2c20 6d69 6e5f  n, min_isf, min_
+00076f70: 6776 6f6c 2920 290a 2020 2020 2020 2020  gvol) ).        
+00076f80: 0a20 2020 2020 2320 7265 7475 726e 2874  .     # return(t
+00076f90: 7273 5f6f 7574 2c20 6973 666d 5f6f 7574  rs_out, isfm_out
+00076fa0: 290a 2020 2020 7265 7475 726e 2874 7273  ).    return(trs
+00076fb0: 5f6f 7574 290a 0a0a 6465 6620 6765 745f  _out)...def get_
+00076fc0: 6669 6c65 5f6e 616d 6528 2070 6174 685f  file_name( path_
+00076fd0: 6669 6c65 5f6e 616d 6520 293a 0a0a 2020  file_name ):..  
+00076fe0: 2020 6669 6c65 5f6e 616d 6573 203d 2070    file_names = p
+00076ff0: 6174 685f 6669 6c65 5f6e 616d 652e 7370  ath_file_name.sp
+00077000: 6c69 7428 272f 2729 5b2d 315d 0a20 2020  lit('/')[-1].   
+00077010: 2066 6e73 203d 2066 696c 655f 6e61 6d65   fns = file_name
+00077020: 732e 7370 6c69 7428 272e 2729 0a20 2020  s.split('.').   
+00077030: 2065 7874 203d 2066 6e73 5b2d 315d 0a20   ext = fns[-1]. 
+00077040: 2020 2066 6e73 203d 2066 6e73 5b3a 2d31     fns = fns[:-1
+00077050: 5d0a 2020 2020 666e 616d 6520 3d20 2727  ].    fname = ''
+00077060: 0a20 2020 2066 6f72 206b 2c20 666e 2069  .    for k, fn i
+00077070: 6e20 656e 756d 6572 6174 6528 666e 7329  n enumerate(fns)
+00077080: 3a0a 2020 2020 2020 2020 6966 206b 203e  :.        if k >
+00077090: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000770a0: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
+000770b0: 272e 270a 2020 2020 2020 2020 666e 616d  '.'.        fnam
+000770c0: 6520 3d20 666e 616d 6520 2b20 666e 0a0a  e = fname + fn..
+000770d0: 2020 2020 7265 7475 726e 2066 6e61 6d65      return fname
+000770e0: 2c20 6578 740a 0a0a 6465 6620 6765 745f  , ext...def get_
+000770f0: 7061 7468 5f6e 616d 6528 2070 6174 685f  path_name( path_
+00077100: 6669 6c65 5f6e 616d 6520 293a 0a0a 2020  file_name ):..  
+00077110: 2020 666e 7320 3d20 7061 7468 5f66 696c    fns = path_fil
+00077120: 655f 6e61 6d65 2e73 706c 6974 2827 2e27  e_name.split('.'
+00077130: 290a 2020 2020 6578 7420 3d20 666e 735b  ).    ext = fns[
+00077140: 2d31 5d0a 2020 2020 666e 7320 3d20 666e  -1].    fns = fn
+00077150: 735b 3a2d 315d 0a20 2020 2066 6e61 6d65  s[:-1].    fname
+00077160: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
+00077170: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
+00077180: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
+00077190: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
+000771a0: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
+000771b0: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
+000771c0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
+000771d0: 2066 6e0a 0a20 2020 2072 6574 7572 6e20   fn..    return 
+000771e0: 666e 616d 652c 2065 7874 0a0a 0a64 6566  fname, ext...def
+000771f0: 206d 635f 636f 7265 5f67 6574 5f67 7466   mc_core_get_gtf
+00077200: 5f61 6e64 5f66 6173 7461 5f70 6628 6764  _and_fasta_pf(gd
+00077210: 293a 0a0a 2020 2020 6e65 203d 2030 0a20  ):..    ne = 0. 
+00077220: 2020 2023 206e 7472 2c20 6e70 722c 206e     # ntr, npr, n
+00077230: 6520 3d20 6764 2e75 7064 6174 655f 7464  e = gd.update_td
+00077240: 5f69 6e66 6f28 290a 2020 2020 6774 665f  _info().    gtf_
+00077250: 6c69 6e65 2c20 636e 203d 2067 642e 6765  line, cn = gd.ge
+00077260: 745f 6774 665f 6c69 6e65 735f 6672 6f6d  t_gtf_lines_from
+00077270: 5f65 786f 6e73 2829 0a20 2020 206c 742c  _exons().    lt,
+00077280: 206c 7020 3d20 6764 2e67 6574 5f66 6173   lp = gd.get_fas
+00077290: 7461 5f6c 696e 6573 5f66 726f 6d5f 6578  ta_lines_from_ex
+000772a0: 6f6e 7328 7065 7074 6964 6520 3d20 4661  ons(peptide = Fa
+000772b0: 6c73 6529 0a0a 2020 2020 2727 270a 2020  lse)..    '''.  
+000772c0: 2020 6966 206c 656e 286c 7429 2021 3d20    if len(lt) != 
+000772d0: 6e74 722a 323a 0a20 2020 2020 2020 2070  ntr*2:.        p
+000772e0: 7269 6e74 2827 4552 524f 5220 696e 206d  rint('ERROR in m
+000772f0: 635f 636f 7265 5f67 6574 5f67 7466 5f61  c_core_get_gtf_a
+00077300: 6e64 5f66 6173 7461 5f70 663a 2025 6920  nd_fasta_pf: %i 
+00077310: 213d 2025 6920 2720 2520 286e 7472 2c20  != %i ' % (ntr, 
+00077320: 6c65 6e28 6c74 292f 3229 2029 0a20 2020  len(lt)/2) ).   
+00077330: 2069 6620 6c65 6e28 6c70 2920 213d 206e   if len(lp) != n
+00077340: 7072 2a32 3a0a 2020 2020 2020 2020 7072  pr*2:.        pr
+00077350: 696e 7428 2745 5252 4f52 2069 6e20 6d63  int('ERROR in mc
+00077360: 5f63 6f72 655f 6765 745f 6774 665f 616e  _core_get_gtf_an
+00077370: 645f 6661 7374 615f 7066 3a20 2569 2021  d_fasta_pf: %i !
+00077380: 3d20 2569 2027 2025 2028 6e70 722c 206c  = %i ' % (npr, l
+00077390: 656e 286c 7029 2f32 2920 290a 2020 2020  en(lp)/2) ).    
+000773a0: 2327 2727 0a20 2020 2072 6574 7572 6e20  #'''.    return 
+000773b0: 6774 665f 6c69 6e65 2c20 6c74 2c20 6c70  gtf_line, lt, lp
+000773c0: 2c20 6e65 2c20 636e 0a0a 0a64 6566 2053  , ne, cn...def S
+000773d0: 7472 696e 6746 6978 5f61 6e61 6c79 7369  tringFix_analysi
+000773e0: 7328 7361 6d5f 6669 6c65 2c20 6774 6620  s(sam_file, gtf 
+000773f0: 3d20 4e6f 6e65 2c20 6765 6e6f 6d65 5f66  = None, genome_f
+00077400: 696c 6520 3d20 4e6f 6e65 2c20 7375 6666  ile = None, suff
+00077410: 6978 203d 204e 6f6e 652c 206a 756d 7020  ix = None, jump 
+00077420: 3d20 302c 2073 6120 3d20 322c 2063 6279  = 0, sa = 2, cby
+00077430: 6320 3d20 4661 6c73 652c 205c 0a20 2020  c = False, \.   
+00077440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077450: 2020 2020 6e5f 636f 7265 7320 3d20 312c      n_cores = 1,
+00077460: 206d 696e 5f66 7261 6773 5f70 6572 5f67   min_frags_per_g
+00077470: 656e 6520 3d20 322c 206c 656e 5f74 6820  ene = 2, len_th 
+00077480: 3d20 4d49 4e5f 5452 5f4c 454e 4754 482c  = MIN_TR_LENGTH,
+00077490: 206f 7574 5f74 7220 3d20 4661 6c73 652c   out_tr = False,
+000774a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000774b0: 2020 2020 2020 2020 7361 765f 7267 6e20          sav_rgn 
+000774c0: 3d20 4661 6c73 652c 206f 7574 5f64 6972  = False, out_dir
+000774d0: 203d 204e 6f6e 6520 293a 0a20 2020 2027   = None ):.    '
+000774e0: 2727 0a20 2020 2069 6620 6774 6620 6973  ''.    if gtf is
+000774f0: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
+00077500: 7269 6e74 2827 4552 524f 523a 204e 6f20  rint('ERROR: No 
+00077510: 4754 462f 4746 4620 6669 6c65 2070 726f  GTF/GFF file pro
+00077520: 7669 6465 642e 2729 0a20 2020 2020 2020  vided.').       
+00077530: 2072 6574 7572 6e0a 2020 2020 2327 2727   return.    #'''
+00077540: 0a20 2020 200a 2020 2020 6d65 7468 6f64  .    .    method
+00077550: 203d 2027 6c61 7373 6f27 0a20 2020 204e   = 'lasso'.    N
+00077560: 7265 6320 3d20 300a 2020 2020 5374 6172  rec = 0.    Star
+00077570: 7420 3d20 300a 2020 2020 0a20 2020 2066  t = 0.    .    f
+00077580: 696c 655f 6e61 6d65 7320 3d20 7361 6d5f  ile_names = sam_
+00077590: 6669 6c65 2e73 706c 6974 2827 2f27 295b  file.split('/')[
+000775a0: 2d31 5d0a 2020 2020 666e 7320 3d20 6669  -1].    fns = fi
+000775b0: 6c65 5f6e 616d 6573 2e73 706c 6974 2827  le_names.split('
+000775c0: 2e27 295b 3a2d 315d 0a20 2020 2066 6e61  .')[:-1].    fna
+000775d0: 6d65 203d 2027 270a 2020 2020 666f 7220  me = ''.    for 
+000775e0: 6b2c 2066 6e20 696e 2065 6e75 6d65 7261  k, fn in enumera
+000775f0: 7465 2866 6e73 293a 0a20 2020 2020 2020  te(fns):.       
+00077600: 2069 6620 6b20 3e20 303a 0a20 2020 2020   if k > 0:.     
+00077610: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
+00077620: 6e61 6d65 202b 2027 2e27 0a20 2020 2020  name + '.'.     
+00077630: 2020 2066 6e61 6d65 203d 2066 6e61 6d65     fname = fname
+00077640: 202b 2066 6e0a 0a20 2020 2069 6620 6f75   + fn..    if ou
+00077650: 745f 6469 7220 6973 206e 6f74 204e 6f6e  t_dir is not Non
+00077660: 653a 0a20 2020 2020 2020 2069 6620 6f75  e:.        if ou
+00077670: 745f 6469 725b 2d31 5d20 3d3d 2027 2f27  t_dir[-1] == '/'
+00077680: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
+00077690: 616d 6520 3d20 6f75 745f 6469 7220 2b20  ame = out_dir + 
+000776a0: 666e 616d 650a 2020 2020 2020 2020 656c  fname.        el
+000776b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000776c0: 666e 616d 6520 3d20 6f75 745f 6469 7220  fname = out_dir 
+000776d0: 2b20 272f 2720 2b20 666e 616d 650a 0a20  + '/' + fname.. 
+000776e0: 2020 2069 6620 7375 6666 6978 2069 7320     if suffix is 
+000776f0: 6e6f 7420 4e6f 6e65 3a20 2020 200a 2020  not None:    .  
+00077700: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
+00077710: 616d 6520 2b20 275f 2720 2b20 7375 6666  ame + '_' + suff
+00077720: 6978 0a0a 2020 2020 6966 206a 756d 7020  ix..    if jump 
+00077730: 3e20 313a 2072 6574 7572 6e20 666e 616d  > 1: return fnam
+00077740: 652c 204e 6f6e 652c 204e 6f6e 650a 0a20  e, None, None.. 
+00077750: 2020 204e 554d 5f43 4f52 4553 203d 206e     NUM_CORES = n
+00077760: 5f63 6f72 6573 0a20 2020 2073 7461 7274  _cores.    start
+00077770: 5f74 696d 6531 203d 2074 696d 652e 7469  _time1 = time.ti
+00077780: 6d65 2829 0a20 2020 2073 7461 7274 5f74  me().    start_t
+00077790: 696d 6532 203d 2074 696d 652e 7469 6d65  ime2 = time.time
+000777a0: 2829 0a20 2020 2069 6620 6a75 6d70 2532  ().    if jump%2
+000777b0: 203d 3d20 303a 0a0a 2020 2020 2020 2020   == 0:..        
+000777c0: 4754 465f 6c73 7420 3d20 5b5d 0a20 2020  GTF_lst = [].   
+000777d0: 2020 2020 2072 676e 735f 6c73 745f 6d69       rgns_lst_mi
+000777e0: 203d 205b 5d0a 2020 2020 2020 2020 7267   = [].        rg
+000777f0: 6e73 5f6c 7374 5f6e 6420 3d20 5b5d 0a20  ns_lst_nd = []. 
+00077800: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
+00077810: 7374 203d 205b 5d0a 0a20 2020 2020 2020  st = []..       
+00077820: 2063 6e74 203d 2030 0a20 2020 2020 2020   cnt = 0.       
+00077830: 206d 785f 6c65 6e20 3d20 3132 0a20 2020   mx_len = 12.   
+00077840: 2020 2020 2065 725f 636f 6465 203d 2030       er_code = 0
+00077850: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00077860: 2020 7072 696e 7428 2753 7472 696e 6746    print('StringF
+00077870: 6978 2073 7461 7274 6564 2027 2c20 6461  ix started ', da
+00077880: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+00077890: 6e6f 7728 2929 0a20 2020 2020 2020 2073  now()).        s
+000778a0: 6f20 3d20 7361 6d5f 6f62 6a28 7361 6d5f  o = sam_obj(sam_
+000778b0: 6669 6c65 2c20 7361 203d 2073 6129 0a20  file, sa = sa). 
+000778c0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000778d0: 6966 206e 5f63 6f72 6573 203d 3d20 313a  if n_cores == 1:
+000778e0: 206e 756d 5f70 6172 616c 6c65 6c5f 6368   num_parallel_ch
+000778f0: 756e 6b73 203d 2034 0a20 2020 2020 2020  unks = 4.       
+00077900: 2065 6c73 653a 206e 756d 5f70 6172 616c   else: num_paral
+00077910: 6c65 6c5f 6368 756e 6b73 203d 204e 554d  lel_chunks = NUM
+00077920: 5f50 4152 414c 4c45 4c5f 4348 554e 4b53  _PARALLEL_CHUNKS
+00077930: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00077940: 2020 625f 636e 7420 3d20 300a 2020 2020    b_cnt = 0.    
+00077950: 2020 2020 725f 6c73 745f 6f66 5f6c 7374      r_lst_of_lst
+00077960: 203d 205b 5d0a 2020 2020 2020 2020 0a20   = [].        . 
+00077970: 2020 2020 2020 2023 2323 2323 2323 2323         #########
+00077980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00077990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000779a0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+000779b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000779c0: 206d 6564 5f66 7261 675f 6c65 6e20 3d20   med_frag_len = 
+000779d0: 300a 2020 2020 2020 2020 6966 2063 6279  0.        if cby
+000779e0: 633a 0a20 2020 2020 2020 2020 2020 200a  c:.            .
+000779f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00077a00: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
+00077a10: 6369 2026 2043 4d61 7420 2729 2023 202c  ci & CMat ') # ,
+00077a20: 2065 6e64 3d27 2729 0a20 2020 2020 2020   end='').       
+00077a30: 2020 2020 2063 6e74 5f63 203d 2030 0a20       cnt_c = 0. 
+00077a40: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00077a50: 2054 7275 653a 0a0a 2020 2020 2020 2020   True:..        
+00077a60: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
+00077a70: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+00077a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00077a90: 2065 725f 636f 6465 2c20 7361 6d5f 6c73   er_code, sam_ls
+00077aa0: 742c 206e 756d 5f72 6561 6473 203d 2073  t, num_reads = s
+00077ab0: 6f2e 6765 745f 6f6e 655f 6f76 6572 6c61  o.get_one_overla
+00077ac0: 7065 645f 7361 6d28 290a 0a20 2020 2020  ped_sam()..     
+00077ad0: 2020 2020 2020 2020 2020 2069 6620 6572             if er
+00077ae0: 5f63 6f64 6520 3d3d 204e 4f54 5f53 4f52  _code == NOT_SOR
+00077af0: 5445 443a 0a20 2020 2020 2020 2020 2020  TED:.           
+00077b00: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00077b10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00077b20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00077b30: 2020 2020 2020 2020 2069 6620 625f 636e           if b_cn
+00077b40: 7420 3d3d 2030 3a20 725f 6c73 745f 6f66  t == 0: r_lst_of
+00077b50: 5f6c 7374 203d 205b 5d0a 2020 2020 2020  _lst = [].      
+00077b60: 2020 2020 2020 2020 2020 2020 2020 625f                b_
+00077b70: 636e 7420 2b3d 206c 656e 2873 616d 5f6c  cnt += len(sam_l
+00077b80: 7374 290a 0a20 2020 2020 2020 2020 2020  st)..           
+00077b90: 2020 2020 2020 2020 2073 616d 5f6c 7374           sam_lst
+00077ba0: 2e61 7070 656e 6428 7361 290a 2020 2020  .append(sa).    
+00077bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077bc0: 725f 6c73 745f 6f66 5f6c 7374 2e61 7070  r_lst_of_lst.app
+00077bd0: 656e 6428 2073 616d 5f6c 7374 2029 2023  end( sam_lst ) #
+00077be0: 2028 7361 6d5f 6c73 742c 2073 6129 2029   (sam_lst, sa) )
+00077bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00077c00: 2020 2020 2023 2072 5f6c 7374 5f6f 665f       # r_lst_of_
+00077c10: 6c73 742e 6170 7065 6e64 2820 2873 616d  lst.append( (sam
+00077c20: 5f6c 7374 2c20 7361 2920 290a 0a20 2020  _lst, sa) )..   
 00077c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077c40: 2020 2062 5f63 6e74 202b 3d20 6c65 6e28     b_cnt += len(
-00077c50: 7361 6d5f 6c73 7429 0a0a 2020 2020 2020  sam_lst)..      
-00077c60: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00077c70: 6d5f 6c73 742e 6170 7065 6e64 2873 6129  m_lst.append(sa)
-00077c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077c90: 2020 2020 2072 5f6c 7374 5f6f 665f 6c73       r_lst_of_ls
-00077ca0: 742e 6170 7065 6e64 2820 7361 6d5f 6c73  t.append( sam_ls
-00077cb0: 7420 2920 2320 2873 616d 5f6c 7374 2c20  t ) # (sam_lst, 
-00077cc0: 7361 2920 290a 2020 2020 2020 2020 2020  sa) ).          
-00077cd0: 2020 2020 2020 2020 2020 2320 725f 6c73            # r_ls
-00077ce0: 745f 6f66 5f6c 7374 2e61 7070 656e 6428  t_of_lst.append(
-00077cf0: 2028 7361 6d5f 6c73 742c 2073 6129 2029   (sam_lst, sa) )
-00077d00: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00077d10: 2020 2020 2020 6966 206e 5f63 6f72 6573        if n_cores
-00077d20: 203d 3d20 313a 200a 2020 2020 2020 2020   == 1: .        
+00077c40: 2069 6620 6e5f 636f 7265 7320 3d3d 2031   if n_cores == 1
+00077c50: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+00077c60: 2020 2020 2020 2020 2020 2069 6620 2862             if (b
+00077c70: 5f63 6e74 203d 3d20 6e75 6d5f 7061 7261  _cnt == num_para
+00077c80: 6c6c 656c 5f63 6875 6e6b 7329 207c 2028  llel_chunks) | (
+00077c90: 6572 5f63 6f64 6520 3d3d 204e 4f5f 4d4f  er_code == NO_MO
+00077ca0: 5245 5f4c 494e 4529 3a20 625f 636e 7420  RE_LINE): b_cnt 
+00077cb0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00077cc0: 2020 2020 2020 2020 656c 7365 3a20 0a20          else: . 
+00077cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077ce0: 2020 2020 2020 2023 2069 6620 2865 725f         # if (er_
+00077cf0: 636f 6465 203d 3d20 4e45 575f 4348 524d  code == NEW_CHRM
+00077d00: 2920 7c20 2865 725f 636f 6465 203d 3d20  ) | (er_code == 
+00077d10: 4e4f 5f4d 4f52 455f 4c49 4e45 293a 2062  NO_MORE_LINE): b
+00077d20: 5f63 6e74 203d 2030 0a20 2020 2020 2020  _cnt = 0.       
 00077d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077d40: 6966 2028 625f 636e 7420 3d3d 206e 756d  if (b_cnt == num
-00077d50: 5f70 6172 616c 6c65 6c5f 6368 756e 6b73  _parallel_chunks
-00077d60: 2920 7c20 2865 725f 636f 6465 203d 3d20  ) | (er_code == 
-00077d70: 4e4f 5f4d 4f52 455f 4c49 4e45 293a 2062  NO_MORE_LINE): b
-00077d80: 5f63 6e74 203d 2030 0a20 2020 2020 2020  _cnt = 0.       
-00077d90: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00077da0: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-00077db0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-00077dc0: 2028 6572 5f63 6f64 6520 3d3d 204e 4557   (er_code == NEW
-00077dd0: 5f43 4852 4d29 207c 2028 6572 5f63 6f64  _CHRM) | (er_cod
-00077de0: 6520 3d3d 204e 4f5f 4d4f 5245 5f4c 494e  e == NO_MORE_LIN
-00077df0: 4529 3a20 625f 636e 7420 3d20 300a 2020  E): b_cnt = 0.  
-00077e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077e10: 2020 2020 2020 6966 2028 2862 5f63 6e74        if ((b_cnt
-00077e20: 203e 206e 756d 5f70 6172 616c 6c65 6c5f   > num_parallel_
-00077e30: 6368 756e 6b73 2920 2620 2865 725f 636f  chunks) & (er_co
-00077e40: 6465 203d 3d20 4e45 575f 4348 524d 2929  de == NEW_CHRM))
-00077e50: 207c 2028 6572 5f63 6f64 6520 3d3d 204e   | (er_code == N
-00077e60: 4f5f 4d4f 5245 5f4c 494e 4529 3a20 625f  O_MORE_LINE): b_
-00077e70: 636e 7420 3d20 300a 0a20 2020 2020 2020  cnt = 0..       
-00077e80: 2020 2020 2020 2020 2020 2020 2023 2727               #''
-00077e90: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00077ea0: 2020 2020 2020 6966 2062 5f63 6e74 203d        if b_cnt =
-00077eb0: 3d20 303a 0a0a 2020 2020 2020 2020 2020  = 0:..          
-00077ec0: 2020 2020 2020 2020 2020 2020 2020 746c                tl
-00077ed0: 656e 203d 205b 5d0a 2020 2020 2020 2020  en = [].        
+00077d40: 2069 6620 2828 625f 636e 7420 3e20 6e75   if ((b_cnt > nu
+00077d50: 6d5f 7061 7261 6c6c 656c 5f63 6875 6e6b  m_parallel_chunk
+00077d60: 7329 2026 2028 6572 5f63 6f64 6520 3d3d  s) & (er_code ==
+00077d70: 204e 4557 5f43 4852 4d29 2920 7c20 2865   NEW_CHRM)) | (e
+00077d80: 725f 636f 6465 203d 3d20 4e4f 5f4d 4f52  r_code == NO_MOR
+00077d90: 455f 4c49 4e45 293a 2062 5f63 6e74 203d  E_LINE): b_cnt =
+00077da0: 2030 0a0a 2020 2020 2020 2020 2020 2020   0..            
+00077db0: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
+00077dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077dd0: 2069 6620 625f 636e 7420 3d3d 2030 3a0a   if b_cnt == 0:.
+00077de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00077df0: 2020 2020 2020 2020 2074 6c65 6e20 3d20           tlen = 
+00077e00: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+00077e10: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+00077e20: 5f6c 7374 2069 6e20 725f 6c73 745f 6f66  _lst in r_lst_of
+00077e30: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
+00077e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e50: 2020 666f 7220 736c 2069 6e20 725f 6c73    for sl in r_ls
+00077e60: 745b 3a2d 315d 3a0a 2020 2020 2020 2020  t[:-1]:.        
+00077e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e80: 2020 2020 2020 2020 746c 656e 2e61 7070          tlen.app
+00077e90: 656e 6428 736c 2e74 6c65 6e29 0a20 2020  end(sl.tlen).   
+00077ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077eb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00077ec0: 6c65 6e28 746c 656e 2920 3e20 3130 3030  len(tlen) > 1000
+00077ed0: 3030 3a20 6272 6561 6b0a 2020 2020 2020  00: break.      
 00077ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077ef0: 666f 7220 725f 6c73 7420 696e 2072 5f6c  for r_lst in r_l
-00077f00: 7374 5f6f 665f 6c73 743a 0a20 2020 2020  st_of_lst:.     
+00077ef0: 2020 6d66 6c20 3d20 6e70 2e6d 6564 6961    mfl = np.media
+00077f00: 6e28 746c 656e 290a 2020 2020 2020 2020  n(tlen).        
 00077f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f20: 2020 2020 2020 2066 6f72 2073 6c20 696e         for sl in
-00077f30: 2072 5f6c 7374 5b3a 2d31 5d3a 0a20 2020   r_lst[:-1]:.   
-00077f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f50: 2020 2020 2020 2020 2020 2020 2074 6c65               tle
-00077f60: 6e2e 6170 7065 6e64 2873 6c2e 746c 656e  n.append(sl.tlen
-00077f70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00077f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f90: 2020 6966 206c 656e 2874 6c65 6e29 203e    if len(tlen) >
-00077fa0: 2031 3030 3030 303a 2062 7265 616b 0a20   100000: break. 
-00077fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077fc0: 2020 2020 2020 206d 666c 203d 206e 702e         mfl = np.
-00077fd0: 6d65 6469 616e 2874 6c65 6e29 0a20 2020  median(tlen).   
-00077fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077ff0: 2020 2020 206d 6564 5f66 7261 675f 6c65       med_frag_le
-00078000: 6e20 2b3d 206d 666c 200a 0a20 2020 2020  n += mfl ..     
-00078010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078020: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
-00078030: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00078040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078050: 2320 6368 725f 6e61 6d65 203d 2073 616d  # chr_name = sam
-00078060: 5f6c 7374 5b30 5d2e 726e 616d 650a 2020  _lst[0].rname.  
+00077f20: 6d65 645f 6672 6167 5f6c 656e 202b 3d20  med_frag_len += 
+00077f30: 6d66 6c20 0a0a 2020 2020 2020 2020 2020  mfl ..          
+00077f40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00077f50: 206e 5f63 6f72 6573 203d 3d20 313a 0a20   n_cores == 1:. 
+00077f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077f70: 2020 2020 2020 2020 2020 2023 2063 6872             # chr
+00077f80: 5f6e 616d 6520 3d20 7361 6d5f 6c73 745b  _name = sam_lst[
+00077f90: 305d 2e72 6e61 6d65 0a20 2020 2020 2020  0].rname.       
+00077fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077fb0: 2020 2020 2063 6872 5f6c 7374 203d 205b       chr_lst = [
+00077fc0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00077fd0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00077fe0: 725f 6e61 6d65 203d 2027 270a 2020 2020  r_name = ''.    
+00077ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078000: 2020 2020 2020 2020 666f 7220 725f 6c73          for r_ls
+00078010: 7420 696e 2072 5f6c 7374 5f6f 665f 6c73  t in r_lst_of_ls
+00078020: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00078030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078040: 2020 2069 6620 725f 6c73 745b 305d 2e72     if r_lst[0].r
+00078050: 6e61 6d65 206e 6f74 2069 6e20 6368 725f  name not in chr_
+00078060: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
 00078070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078080: 2020 2020 2020 2020 2020 6368 725f 6c73            chr_ls
-00078090: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
-000780a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000780b0: 2020 2063 6872 5f6e 616d 6520 3d20 2727     chr_name = ''
-000780c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000780d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000780e0: 2072 5f6c 7374 2069 6e20 725f 6c73 745f   r_lst in r_lst_
-000780f0: 6f66 5f6c 7374 3a0a 2020 2020 2020 2020  of_lst:.        
+00078080: 2020 2020 2020 2020 2063 6872 5f6c 7374           chr_lst
+00078090: 2e61 7070 656e 6428 725f 6c73 745b 305d  .append(r_lst[0]
+000780a0: 2e72 6e61 6d65 290a 2020 2020 2020 2020  .rname).        
+000780b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000780c0: 2020 2020 2020 2020 2020 2020 6368 725f              chr_
+000780d0: 6e61 6d65 203d 2063 6872 5f6e 616d 6520  name = chr_name 
+000780e0: 2b20 2725 7320 2720 2520 2872 5f6c 7374  + '%s ' % (r_lst
+000780f0: 5b30 5d2e 726e 616d 6529 0a20 2020 2020  [0].rname).     
 00078100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078110: 2020 2020 2020 2020 6966 2072 5f6c 7374          if r_lst
-00078120: 5b30 5d2e 726e 616d 6520 6e6f 7420 696e  [0].rname not in
-00078130: 2063 6872 5f6c 7374 3a0a 2020 2020 2020   chr_lst:.      
-00078140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078150: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00078160: 725f 6c73 742e 6170 7065 6e64 2872 5f6c  r_lst.append(r_l
-00078170: 7374 5b30 5d2e 726e 616d 6529 0a20 2020  st[0].rname).   
-00078180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078110: 2020 2020 2020 2069 6620 6c65 6e28 6368         if len(ch
+00078120: 725f 6e61 6d65 2920 3e20 3530 3a20 0a20  r_name) > 50: . 
+00078130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078140: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00078150: 6620 2863 6e74 5f63 203d 3d20 3029 2026  f (cnt_c == 0) &
+00078160: 2028 6572 5f63 6f64 6520 3d3d 204e 4f5f   (er_code == NO_
+00078170: 4d4f 5245 5f4c 494e 4529 3a20 6368 725f  MORE_LINE): chr_
+00078180: 6e61 6d65 203d 2027 2027 0a20 2020 2020  name = ' '.     
 00078190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000781a0: 2063 6872 5f6e 616d 6520 3d20 6368 725f   chr_name = chr_
-000781b0: 6e61 6d65 202b 2027 2573 2027 2025 2028  name + '%s ' % (
-000781c0: 725f 6c73 745b 305d 2e72 6e61 6d65 290a  r_lst[0].rname).
+000781a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000781b0: 2063 6872 5f6e 616d 6520 3d20 276f 7468   chr_name = 'oth
+000781c0: 6572 7327 0a20 2020 2020 2020 2020 2020  ers'.           
 000781d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000781e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000781f0: 656e 2863 6872 5f6e 616d 6529 203e 2035  en(chr_name) > 5
-00078200: 303a 200a 2020 2020 2020 2020 2020 2020  0: .            
-00078210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078220: 2020 2020 6966 2028 636e 745f 6320 3d3d      if (cnt_c ==
-00078230: 2030 2920 2620 2865 725f 636f 6465 203d   0) & (er_code =
-00078240: 3d20 4e4f 5f4d 4f52 455f 4c49 4e45 293a  = NO_MORE_LINE):
-00078250: 2063 6872 5f6e 616d 6520 3d20 2720 270a   chr_name = ' '.
-00078260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000781e0: 2072 5f6d 695f 6c73 742c 2072 5f6e 645f   r_mi_lst, r_nd_
+000781f0: 6c73 742c 2072 5f73 745f 6c73 7420 3d20  lst, r_st_lst = 
+00078200: 6275 696c 645f 636f 6e74 6967 7328 725f  build_contigs(r_
+00078210: 6c73 745f 6f66 5f6c 7374 2c20 6368 725f  lst_of_lst, chr_
+00078220: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00078230: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00078240: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00078250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078260: 6368 725f 6e61 6d65 203d 2027 270a 2020  chr_name = ''.  
 00078270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078280: 656c 7365 3a20 6368 725f 6e61 6d65 203d  else: chr_name =
-00078290: 2027 6f74 6865 7273 270a 2020 2020 2020   'others'.      
-000782a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000782b0: 2020 2020 2020 725f 6d69 5f6c 7374 2c20        r_mi_lst, 
-000782c0: 725f 6e64 5f6c 7374 2c20 725f 7374 5f6c  r_nd_lst, r_st_l
-000782d0: 7374 203d 2062 7569 6c64 5f63 6f6e 7469  st = build_conti
-000782e0: 6773 2872 5f6c 7374 5f6f 665f 6c73 742c  gs(r_lst_of_lst,
-000782f0: 2063 6872 5f6e 616d 6529 0a20 2020 2020   chr_name).     
-00078300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078310: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00078320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078330: 2020 2020 2063 6872 5f6e 616d 6520 3d20       chr_name = 
-00078340: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
-00078350: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00078360: 2069 6620 2863 6e74 5f63 203e 2030 2920   if (cnt_c > 0) 
-00078370: 7c20 2865 725f 636f 6465 2021 3d20 4e4f  | (er_code != NO
-00078380: 5f4d 4f52 455f 4c49 4e45 293a 0a20 2020  _MORE_LINE):.   
+00078280: 2020 2020 2020 2020 2020 2320 6966 2028            # if (
+00078290: 636e 745f 6320 3e20 3029 207c 2028 6572  cnt_c > 0) | (er
+000782a0: 5f63 6f64 6520 213d 204e 4f5f 4d4f 5245  _code != NO_MORE
+000782b0: 5f4c 494e 4529 3a0a 2020 2020 2020 2020  _LINE):.        
+000782c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000782d0: 2020 2020 6368 725f 6c73 7420 3d20 5b5d      chr_lst = []
+000782e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000782f0: 2020 2020 2020 2020 2020 2020 2063 6872               chr
+00078300: 5f6e 616d 6520 3d20 2727 0a20 2020 2020  _name = ''.     
+00078310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078320: 2020 2020 2020 2066 6f72 2072 5f6c 7374         for r_lst
+00078330: 2069 6e20 725f 6c73 745f 6f66 5f6c 7374   in r_lst_of_lst
+00078340: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00078350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078360: 2020 6966 2072 5f6c 7374 5b30 5d2e 726e    if r_lst[0].rn
+00078370: 616d 6520 6e6f 7420 696e 2063 6872 5f6c  ame not in chr_l
+00078380: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
 00078390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000783a0: 2020 2020 2020 2020 2063 6872 5f6c 7374           chr_lst
-000783b0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-000783c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000783d0: 2020 6368 725f 6e61 6d65 203d 2027 270a    chr_name = ''.
-000783e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000783f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00078400: 725f 6c73 7420 696e 2072 5f6c 7374 5f6f  r_lst in r_lst_o
-00078410: 665f 6c73 743a 0a20 2020 2020 2020 2020  f_lst:.         
+000783a0: 2020 2020 2020 2020 6368 725f 6c73 742e          chr_lst.
+000783b0: 6170 7065 6e64 2872 5f6c 7374 5b30 5d2e  append(r_lst[0].
+000783c0: 726e 616d 6529 0a20 2020 2020 2020 2020  rname).         
+000783d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000783e0: 2020 2020 2020 2020 2020 2063 6872 5f6e             chr_n
+000783f0: 616d 6520 3d20 6368 725f 6e61 6d65 202b  ame = chr_name +
+00078400: 2027 2573 2027 2025 2028 725f 6c73 745b   '%s ' % (r_lst[
+00078410: 305d 2e72 6e61 6d65 290a 2020 2020 2020  0].rname).      
 00078420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078430: 2020 2020 2020 2069 6620 725f 6c73 745b         if r_lst[
-00078440: 305d 2e72 6e61 6d65 206e 6f74 2069 6e20  0].rname not in 
-00078450: 6368 725f 6c73 743a 0a20 2020 2020 2020  chr_lst:.       
-00078460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078470: 2020 2020 2020 2020 2020 2020 2063 6872               chr
-00078480: 5f6c 7374 2e61 7070 656e 6428 725f 6c73  _lst.append(r_ls
-00078490: 745b 305d 2e72 6e61 6d65 290a 2020 2020  t[0].rname).    
-000784a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078430: 2020 2020 2020 6966 206c 656e 2863 6872        if len(chr
+00078440: 5f6e 616d 6529 203e 2035 303a 200a 2020  _name) > 50: .  
+00078450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078460: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00078470: 2028 636e 745f 6320 3d3d 2030 2920 2620   (cnt_c == 0) & 
+00078480: 2865 725f 636f 6465 203d 3d20 4e4f 5f4d  (er_code == NO_M
+00078490: 4f52 455f 4c49 4e45 293a 2063 6872 5f6e  ORE_LINE): chr_n
+000784a0: 616d 6520 3d20 2720 270a 2020 2020 2020  ame = ' '.      
 000784b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000784c0: 6368 725f 6e61 6d65 203d 2063 6872 5f6e  chr_name = chr_n
-000784d0: 616d 6520 2b20 2725 7320 2720 2520 2872  ame + '%s ' % (r
-000784e0: 5f6c 7374 5b30 5d2e 726e 616d 6529 0a20  _lst[0].rname). 
+000784c0: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
+000784d0: 6368 725f 6e61 6d65 203d 2027 6f74 6865  chr_name = 'othe
+000784e0: 7273 270a 2020 2020 2020 2020 2020 2020  rs'.            
 000784f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078500: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00078510: 6e28 6368 725f 6e61 6d65 2920 3e20 3530  n(chr_name) > 50
-00078520: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-00078530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078540: 2020 2069 6620 2863 6e74 5f63 203d 3d20     if (cnt_c == 
-00078550: 3029 2026 2028 6572 5f63 6f64 6520 3d3d  0) & (er_code ==
-00078560: 204e 4f5f 4d4f 5245 5f4c 494e 4529 3a20   NO_MORE_LINE): 
-00078570: 6368 725f 6e61 6d65 203d 2027 2027 0a20  chr_name = ' '. 
-00078580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078590: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000785a0: 6c73 653a 2063 6872 5f6e 616d 6520 3d20  lse: chr_name = 
-000785b0: 276f 7468 6572 7327 0a20 2020 2020 2020  'others'.       
-000785c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000785d0: 2020 2020 2023 2069 6620 636e 745f 6320       # if cnt_c 
-000785e0: 3d3d 2030 3a20 7072 696e 7428 2720 2729  == 0: print(' ')
-000785f0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00078600: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00078610: 6172 745f 7469 6d65 3320 3d20 7469 6d65  art_time3 = time
-00078620: 2e74 696d 6528 290a 2020 2020 2020 2020  .time().        
-00078630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078640: 2020 2020 725f 6d69 5f6c 7374 2c20 725f      r_mi_lst, r_
-00078650: 6e64 5f6c 7374 2c20 725f 7374 5f6c 7374  nd_lst, r_st_lst
-00078660: 203d 2062 7569 6c64 5f63 6f6e 7469 6773   = build_contigs
-00078670: 5f6d 6328 725f 6c73 745f 6f66 5f6c 7374  _mc(r_lst_of_lst
-00078680: 2c20 6e5f 636f 7265 732c 2063 6872 5f6e  , n_cores, chr_n
-00078690: 616d 6529 0a0a 2020 2020 2020 2020 2020  ame)..          
+00078500: 2320 6966 2063 6e74 5f63 203d 3d20 303a  # if cnt_c == 0:
+00078510: 2070 7269 6e74 2827 2027 290a 0a20 2020   print(' ')..   
+00078520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078530: 2020 2020 2020 2020 2073 7461 7274 5f74           start_t
+00078540: 696d 6533 203d 2074 696d 652e 7469 6d65  ime3 = time.time
+00078550: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00078560: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00078570: 5f6d 695f 6c73 742c 2072 5f6e 645f 6c73  _mi_lst, r_nd_ls
+00078580: 742c 2072 5f73 745f 6c73 7420 3d20 6275  t, r_st_lst = bu
+00078590: 696c 645f 636f 6e74 6967 735f 6d63 2872  ild_contigs_mc(r
+000785a0: 5f6c 7374 5f6f 665f 6c73 742c 206e 5f63  _lst_of_lst, n_c
+000785b0: 6f72 6573 2c20 6368 725f 6e61 6d65 290a  ores, chr_name).
+000785c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000785d0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+000785e0: 6620 2863 6e74 5f63 203e 2030 2920 7c20  f (cnt_c > 0) | 
+000785f0: 2865 725f 636f 6465 2021 3d20 4e4f 5f4d  (er_code != NO_M
+00078600: 4f52 455f 4c49 4e45 293a 0a20 2020 2020  ORE_LINE):.     
+00078610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078620: 2020 2020 2020 2065 6c61 7073 6564 5f74         elapsed_t
+00078630: 696d 6533 203d 2074 696d 652e 7469 6d65  ime3 = time.time
+00078640: 2829 202d 2073 7461 7274 5f74 696d 6533  () - start_time3
+00078650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078660: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00078670: 6e74 2827 5c72 2720 2b20 2720 272a 3130  nt('\r' + ' '*10
+00078680: 302c 2065 6e64 3d27 272c 2066 6c75 7368  0, end='', flush
+00078690: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
 000786a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000786b0: 2020 2320 6966 2028 636e 745f 6320 3e20    # if (cnt_c > 
-000786c0: 3029 207c 2028 6572 5f63 6f64 6520 213d  0) | (er_code !=
-000786d0: 204e 4f5f 4d4f 5245 5f4c 494e 4529 3a0a   NO_MORE_LINE):.
-000786e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000786f0: 2020 2020 2020 2020 2020 2020 656c 6170              elap
-00078700: 7365 645f 7469 6d65 3320 3d20 7469 6d65  sed_time3 = time
-00078710: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-00078720: 7469 6d65 330a 2020 2020 2020 2020 2020  time3.          
-00078730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078740: 2020 7072 696e 7428 275c 7227 202b 2027    print('\r' + '
-00078750: 2027 2a31 3030 2c20 656e 643d 2727 2c20   '*100, end='', 
-00078760: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-00078770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078780: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00078790: 275c 7220 2020 7072 6f63 6573 7369 6e67  '\r   processing
-000787a0: 2025 732e 2e2e 2064 6f6e 652e 2028 2569   %s... done. (%i
-000787b0: 2920 2825 6972 2c20 2569 632c 2025 6929  ) (%ir, %ic, %i)
-000787c0: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-000787d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000787e0: 2020 2020 2020 2520 2863 6872 5f6e 616d        % (chr_nam
-000787f0: 652c 2065 6c61 7073 6564 5f74 696d 6533  e, elapsed_time3
-00078800: 2c20 696e 7428 736f 2e6e 756d 5f72 6561  , int(so.num_rea
-00078810: 6473 292c 206c 656e 2872 5f6c 7374 5f6f  ds), len(r_lst_o
-00078820: 665f 6c73 7429 2c20 6d66 6c29 2c20 666c  f_lst), mfl), fl
-00078830: 7573 6820 3d20 5472 7565 2920 232c 2065  ush = True) #, e
-00078840: 6e64 3d27 2729 0a0a 2020 2020 2020 2020  nd='')..        
-00078850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078860: 7267 6e73 5f6c 7374 5f6d 6920 3d20 7267  rgns_lst_mi = rg
-00078870: 6e73 5f6c 7374 5f6d 6920 2b20 725f 6d69  ns_lst_mi + r_mi
-00078880: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
-00078890: 2020 2020 2020 2020 2020 2020 2072 676e               rgn
-000788a0: 735f 6c73 745f 6e64 203d 2072 676e 735f  s_lst_nd = rgns_
-000788b0: 6c73 745f 6e64 202b 2072 5f6e 645f 6c73  lst_nd + r_nd_ls
-000788c0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000788d0: 2020 2020 2020 2020 2020 7267 6e73 5f6c            rgns_l
-000788e0: 7374 5f73 7420 3d20 7267 6e73 5f6c 7374  st_st = rgns_lst
-000788f0: 5f73 7420 2b20 725f 7374 5f6c 7374 0a20  _st + r_st_lst. 
-00078900: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000786b0: 2020 2020 2070 7269 6e74 2827 5c72 2020       print('\r  
+000786c0: 2070 726f 6365 7373 696e 6720 2573 2e2e   processing %s..
+000786d0: 2e20 646f 6e65 2e20 2825 6929 2028 2569  . done. (%i) (%i
+000786e0: 722c 2025 6963 2c20 2569 2927 205c 0a20  r, %ic, %i)' \. 
+000786f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078710: 2025 2028 6368 725f 6e61 6d65 2c20 656c   % (chr_name, el
+00078720: 6170 7365 645f 7469 6d65 332c 2069 6e74  apsed_time3, int
+00078730: 2873 6f2e 6e75 6d5f 7265 6164 7329 2c20  (so.num_reads), 
+00078740: 6c65 6e28 725f 6c73 745f 6f66 5f6c 7374  len(r_lst_of_lst
+00078750: 292c 206d 666c 292c 2066 6c75 7368 203d  ), mfl), flush =
+00078760: 2054 7275 6529 2023 2c20 656e 643d 2727   True) #, end=''
+00078770: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00078780: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
+00078790: 6c73 745f 6d69 203d 2072 676e 735f 6c73  lst_mi = rgns_ls
+000787a0: 745f 6d69 202b 2072 5f6d 695f 6c73 740a  t_mi + r_mi_lst.
+000787b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000787c0: 2020 2020 2020 2020 7267 6e73 5f6c 7374          rgns_lst
+000787d0: 5f6e 6420 3d20 7267 6e73 5f6c 7374 5f6e  _nd = rgns_lst_n
+000787e0: 6420 2b20 725f 6e64 5f6c 7374 0a20 2020  d + r_nd_lst.   
+000787f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078800: 2020 2020 2072 676e 735f 6c73 745f 7374       rgns_lst_st
+00078810: 203d 2072 676e 735f 6c73 745f 7374 202b   = rgns_lst_st +
+00078820: 2072 5f73 745f 6c73 740a 2020 2020 2020   r_st_lst.      
+00078830: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+00078840: 2020 2020 2020 2020 2020 2069 6620 6572             if er
+00078850: 5f63 6f64 6520 3d3d 204e 4f5f 4d4f 5245  _code == NO_MORE
+00078860: 5f4c 494e 453a 2062 7265 616b 0a20 2020  _LINE: break.   
+00078870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078880: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00078890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000788a0: 2020 2020 2020 2063 6e74 5f63 202b 3d20         cnt_c += 
+000788b0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+000788c0: 2020 2020 2020 2327 2727 0a0a 2020 2020        #'''..    
+000788d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000788e0: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
+000788f0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00078900: 6620 636e 745f 6320 3e20 303a 0a20 2020  f cnt_c > 0:.   
 00078910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078920: 6966 2065 725f 636f 6465 203d 3d20 4e4f  if er_code == NO
-00078930: 5f4d 4f52 455f 4c49 4e45 3a20 6272 6561  _MORE_LINE: brea
-00078940: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00078950: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00078960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078970: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-00078980: 6320 2b3d 2031 0a20 2020 2020 2020 2020  c += 1.         
-00078990: 2020 2020 2020 2020 2020 2023 2727 270a             #'''.
-000789a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000789b0: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
+00078920: 2069 6620 636e 7425 3130 3020 3d3d 2030   if cnt%100 == 0
+00078930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00078940: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00078950: 275c 7227 202b 2027 2027 2a31 3030 2c20  '\r' + ' '*100, 
+00078960: 656e 643d 2727 2c20 666c 7573 6820 3d20  end='', flush = 
+00078970: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00078980: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00078990: 696e 7428 275c 7220 2020 6c6f 6164 696e  int('\r   loadin
+000789a0: 6720 2825 6972 2c20 2569 632c 2025 7329  g (%ir, %ic, %s)
+000789b0: 2027 205c 0a20 2020 2020 2020 2020 2020   ' \.           
 000789c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000789d0: 2020 2320 6966 2063 6e74 5f63 203e 2030    # if cnt_c > 0
-000789e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000789f0: 2020 2020 2020 6966 2063 6e74 2531 3030        if cnt%100
-00078a00: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00078a10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00078a20: 7269 6e74 2827 5c72 2720 2b20 2720 272a  rint('\r' + ' '*
-00078a30: 3130 302c 2065 6e64 3d27 272c 2066 6c75  100, end='', flu
-00078a40: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
-00078a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078a60: 2020 2070 7269 6e74 2827 5c72 2020 206c     print('\r   l
-00078a70: 6f61 6469 6e67 2028 2569 722c 2025 6963  oading (%ir, %ic
-00078a80: 2c20 2573 2920 2720 5c0a 2020 2020 2020  , %s) ' \.      
-00078a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078aa0: 2020 2020 2020 2020 2520 2869 6e74 2873          % (int(s
-00078ab0: 6f2e 6e75 6d5f 7265 6164 7329 2c20 636e  o.num_reads), cn
-00078ac0: 742c 2073 616d 5f6c 7374 5b30 5d2e 726e  t, sam_lst[0].rn
-00078ad0: 616d 6529 2c20 656e 643d 2727 2c20 666c  ame), end='', fl
-00078ae0: 7573 6820 3d20 5472 7565 290a 0a20 2020  ush = True)..   
-00078af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078b00: 2069 6620 6572 5f63 6f64 6520 3d3d 204e   if er_code == N
-00078b10: 4f5f 4d4f 5245 5f4c 494e 453a 2062 7265  O_MORE_LINE: bre
-00078b20: 616b 0a0a 2020 2020 2020 2020 2020 2020  ak..            
-00078b30: 6d65 645f 6672 6167 5f6c 656e 203d 206e  med_frag_len = n
-00078b40: 702e 696e 7428 6d65 645f 6672 6167 5f6c  p.int(med_frag_l
-00078b50: 656e 2f28 636e 745f 632b 3129 290a 0a20  en/(cnt_c+1)).. 
-00078b60: 2020 2020 2020 2020 2020 2065 6c61 7073             elaps
-00078b70: 6564 5f74 696d 6531 203d 2074 696d 652e  ed_time1 = time.
-00078b80: 7469 6d65 2829 202d 2073 7461 7274 5f74  time() - start_t
-00078b90: 696d 6532 0a20 2020 2020 2020 2020 2020  ime2.           
-00078ba0: 2070 7269 6e74 2827 5c72 4275 696c 6469   print('\rBuildi
-00078bb0: 6e67 206c 6f63 6920 2620 434d 6174 202e  ng loci & CMat .
-00078bc0: 2e2e 2064 6f6e 6520 2825 6929 2e20 2825  .. done (%i). (%
-00078bd0: 6972 2c20 2569 632c 2025 6929 2027 205c  ir, %ic, %i) ' \
-00078be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00078bf0: 2020 2025 2028 696e 7428 656c 6170 7365     % (int(elapse
-00078c00: 645f 7469 6d65 3129 2c20 696e 7428 736f  d_time1), int(so
-00078c10: 2e6e 756d 5f72 6561 6473 292c 2063 6e74  .num_reads), cnt
-00078c20: 2c20 6d65 645f 6672 6167 5f6c 656e 2920  , med_frag_len) 
-00078c30: 290a 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00078c40: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00078c50: 2020 2020 2020 7072 696e 7428 275c 724c        print('\rL
-00078c60: 6f61 6469 6e67 2053 414d 206c 696e 6573  oading SAM lines
-00078c70: 202e 2e2e 2e2e 2e20 2027 2c20 656e 643d   ......  ', end=
-00078c80: 2727 2920 2020 2020 2020 200a 2020 2020  '')        .    
-00078c90: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
-00078ca0: 7565 3a0a 0a20 2020 2020 2020 2020 2020  ue:..           
-00078cb0: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
-00078cc0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-00078cd0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00078ce0: 5f63 6f64 652c 2073 616d 5f6c 7374 2c20  _code, sam_lst, 
-00078cf0: 6e75 6d5f 7265 6164 7320 3d20 736f 2e67  num_reads = so.g
-00078d00: 6574 5f6f 6e65 5f6f 7665 726c 6170 6564  et_one_overlaped
-00078d10: 5f73 616d 2829 0a0a 2020 2020 2020 2020  _sam()..        
-00078d20: 2020 2020 2020 2020 6966 2065 725f 636f          if er_co
-00078d30: 6465 203d 3d20 4e4f 545f 534f 5254 4544  de == NOT_SORTED
-00078d40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00078d50: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00078d60: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00078d70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00078d80: 2020 2020 2020 7361 6d5f 6c73 742e 6170        sam_lst.ap
-00078d90: 7065 6e64 2873 6129 0a20 2020 2020 2020  pend(sa).       
-00078da0: 2020 2020 2020 2020 2020 2020 2072 5f6c               r_l
-00078db0: 7374 5f6f 665f 6c73 742e 6170 7065 6e64  st_of_lst.append
-00078dc0: 2820 7361 6d5f 6c73 7420 2920 2320 2873  ( sam_lst ) # (s
-00078dd0: 616d 5f6c 7374 2c20 7361 2920 290a 2020  am_lst, sa) ).  
-00078de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078df0: 2020 2320 725f 6c73 745f 6f66 5f6c 7374    # r_lst_of_lst
-00078e00: 2e61 7070 656e 6428 2028 7361 6d5f 6c73  .append( (sam_ls
-00078e10: 742c 2073 6129 2029 0a0a 2020 2020 2020  t, sa) )..      
-00078e20: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-00078e30: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-00078e40: 2020 2020 2020 2020 2020 2069 6620 636e             if cn
-00078e50: 7425 3130 3020 3d3d 2030 3a0a 2020 2020  t%100 == 0:.    
-00078e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078e70: 2020 2020 7072 696e 7428 275c 7227 202b      print('\r' +
-00078e80: 2027 2027 2a31 3030 2c20 656e 643d 2727   ' '*100, end=''
-00078e90: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-00078ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078eb0: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-00078ec0: 724c 6f61 6469 6e67 2053 414d 206c 696e  rLoading SAM lin
-00078ed0: 6573 202e 2e2e 2e2e 2e20 2825 6972 2c20  es ...... (%ir, 
-00078ee0: 2569 6329 2027 2025 2028 696e 7428 736f  %ic) ' % (int(so
-00078ef0: 2e6e 756d 5f72 6561 6473 292c 2063 6e74  .num_reads), cnt
-00078f00: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
-00078f10: 203d 2054 7275 6529 0a0a 2020 2020 2020   = True)..      
-00078f20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00078f30: 2065 725f 636f 6465 203d 3d20 4e4f 5f4d   er_code == NO_M
-00078f40: 4f52 455f 4c49 4e45 3a20 6272 6561 6b0a  ORE_LINE: break.
-00078f50: 0a20 2020 2020 2020 2020 2020 2074 6c65  .            tle
-00078f60: 6e20 3d20 5b5d 0a20 2020 2020 2020 2020  n = [].         
-00078f70: 2020 2066 6f72 2072 5f6c 7374 2069 6e20     for r_lst in 
-00078f80: 725f 6c73 745f 6f66 5f6c 7374 3a0a 2020  r_lst_of_lst:.  
-00078f90: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00078fa0: 7220 736c 2069 6e20 725f 6c73 745b 3a2d  r sl in r_lst[:-
-00078fb0: 315d 3a0a 2020 2020 2020 2020 2020 2020  1]:.            
-00078fc0: 2020 2020 2020 2020 746c 656e 2e61 7070          tlen.app
-00078fd0: 656e 6428 736c 2e74 6c65 6e29 0a20 2020  end(sl.tlen).   
-00078fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078ff0: 2069 6620 6c65 6e28 746c 656e 2920 3e20   if len(tlen) > 
-00079000: 3130 3030 3030 3a0a 2020 2020 2020 2020  100000:.        
-00079010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00079020: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00079030: 2020 6d65 645f 6672 6167 5f6c 656e 203d    med_frag_len =
-00079040: 206e 702e 6d65 6469 616e 2874 6c65 6e29   np.median(tlen)
-00079050: 0a0a 2020 2020 2020 2020 2020 2020 2327  ..            #'
-00079060: 2727 0a20 2020 2020 2020 2020 2020 2065  ''.            e
-00079070: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
-00079080: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00079090: 7274 5f74 696d 6531 0a20 2020 2020 2020  rt_time1.       
-000790a0: 2020 2020 2070 7269 6e74 2827 5c72 2720       print('\r' 
-000790b0: 2b20 2720 272a 3130 302c 2065 6e64 3d27  + ' '*100, end='
-000790c0: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
-000790d0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000790e0: 6e74 2827 5c72 4c6f 6164 696e 6720 5341  nt('\rLoading SA
-000790f0: 4d20 6c69 6e65 7320 2e2e 2e2e 2e2e 2064  M lines ...... d
-00079100: 6f6e 6520 2825 6929 2e20 2825 6972 2c20  one (%i). (%ir, 
-00079110: 2569 6329 2027 205c 0a20 2020 2020 2020  %ic) ' \.       
-00079120: 2020 2020 2020 2020 2020 2025 2028 696e             % (in
-00079130: 7428 656c 6170 7365 645f 7469 6d65 3129  t(elapsed_time1)
-00079140: 2c20 696e 7428 736f 2e6e 756d 5f72 6561  , int(so.num_rea
-00079150: 6473 292c 2063 6e74 292c 2066 6c75 7368  ds), cnt), flush
-00079160: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
-00079170: 2020 2020 2020 7374 6172 745f 7469 6d65        start_time
-00079180: 3220 3d20 7469 6d65 2e74 696d 6528 290a  2 = time.time().
-00079190: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000791a0: 6e5f 636f 7265 7320 3d3d 2031 3a0a 2020  n_cores == 1:.  
-000791b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000791c0: 696e 7428 2742 7569 6c64 696e 6720 6c6f  int('Building lo
-000791d0: 6369 2026 2043 4d61 7420 2e2e 2e20 272c  ci & CMat ... ',
-000791e0: 2065 6e64 3d27 2729 0a20 2020 2020 2020   end='').       
-000791f0: 2020 2020 2020 2020 2072 5f6d 695f 6c73           r_mi_ls
-00079200: 742c 2072 5f6e 645f 6c73 742c 2072 5f73  t, r_nd_lst, r_s
-00079210: 745f 6c73 7420 3d20 6275 696c 645f 636f  t_lst = build_co
-00079220: 6e74 6967 7328 725f 6c73 745f 6f66 5f6c  ntigs(r_lst_of_l
-00079230: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
-00079240: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00079250: 2020 2020 2020 7072 696e 7428 2742 7569        print('Bui
-00079260: 6c64 696e 6720 6c6f 6369 2026 2043 4d61  lding loci & CMa
-00079270: 7420 2e2e 2e20 272c 2065 6e64 3d27 2729  t ... ', end='')
-00079280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00079290: 2072 5f6d 695f 6c73 742c 2072 5f6e 645f   r_mi_lst, r_nd_
-000792a0: 6c73 742c 2072 5f73 745f 6c73 7420 3d20  lst, r_st_lst = 
-000792b0: 6275 696c 645f 636f 6e74 6967 735f 6d63  build_contigs_mc
-000792c0: 2872 5f6c 7374 5f6f 665f 6c73 742c 206e  (r_lst_of_lst, n
-000792d0: 5f63 6f72 6573 290a 0a20 2020 2020 2020  _cores)..       
-000792e0: 2020 2020 2072 676e 735f 6c73 745f 6d69       rgns_lst_mi
-000792f0: 203d 2072 676e 735f 6c73 745f 6d69 202b   = rgns_lst_mi +
-00079300: 2072 5f6d 695f 6c73 740a 2020 2020 2020   r_mi_lst.      
-00079310: 2020 2020 2020 7267 6e73 5f6c 7374 5f6e        rgns_lst_n
-00079320: 6420 3d20 7267 6e73 5f6c 7374 5f6e 6420  d = rgns_lst_nd 
-00079330: 2b20 725f 6e64 5f6c 7374 0a20 2020 2020  + r_nd_lst.     
-00079340: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
-00079350: 7374 203d 2072 676e 735f 6c73 745f 7374  st = rgns_lst_st
-00079360: 202b 2072 5f73 745f 6c73 740a 2020 2020   + r_st_lst.    
-00079370: 2020 2020 2020 2020 2327 2727 200a 2020          #''' .  
-00079380: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00079390: 2020 2020 2020 656c 6170 7365 645f 7469        elapsed_ti
-000793a0: 6d65 3120 3d20 7469 6d65 2e74 696d 6528  me1 = time.time(
-000793b0: 2920 2d20 7374 6172 745f 7469 6d65 320a  ) - start_time2.
-000793c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000793d0: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
-000793e0: 6369 2026 2043 4d61 7420 2e2e 2e20 646f  ci & CMat ... do
-000793f0: 6e65 2028 2569 292e 2025 6972 2c20 2569  ne (%i). %ir, %i
-00079400: 632c 206d 6564 2e66 7261 672e 6c65 6e20  c, med.frag.len 
-00079410: 3d20 2569 2027 205c 0a20 2020 2020 2020  = %i ' \.       
-00079420: 2020 2020 2020 2020 2020 2025 2028 696e             % (in
-00079430: 7428 656c 6170 7365 645f 7469 6d65 3129  t(elapsed_time1)
-00079440: 2c20 696e 7428 736f 2e6e 756d 5f72 6561  , int(so.num_rea
-00079450: 6473 292c 2063 6e74 2c20 6d65 645f 6672  ds), cnt, med_fr
-00079460: 6167 5f6c 656e 2920 290a 2020 2020 2020  ag_len) ).      
-00079470: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
-00079480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00079490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000794a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000794b0: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
-000794c0: 0a20 2020 2020 2020 2064 656c 2072 5f6c  .        del r_l
-000794d0: 7374 5f6f 665f 6c73 740a 2020 2020 2020  st_of_lst.      
-000794e0: 2020 2727 270a 2020 2020 2020 2020 636e    '''.        cn
-000794f0: 745f 6920 3d20 300a 2020 2020 2020 2020  t_i = 0.        
-00079500: 636e 745f 7320 3d20 300a 2020 2020 2020  cnt_s = 0.      
-00079510: 2020 636e 745f 7420 3d20 300a 2020 2020    cnt_t = 0.    
-00079520: 2020 2020 666f 7220 7267 6e73 2069 6e20      for rgns in 
-00079530: 7267 6e73 5f6c 7374 5f73 743a 200a 2020  rgns_lst_st: .  
-00079540: 2020 2020 2020 2020 2020 666f 7220 7220            for r 
-00079550: 696e 2072 676e 732e 7267 6e73 3a0a 2020  in rgns.rgns:.  
-00079560: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00079570: 2072 2e74 7970 6520 3d3d 2027 4927 3a20   r.type == 'I': 
-00079580: 636e 745f 6920 2b3d 2031 0a20 2020 2020  cnt_i += 1.     
-00079590: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000795a0: 722e 7479 7065 203d 3d20 2753 273a 2063  r.type == 'S': c
-000795b0: 6e74 5f73 202b 3d20 310a 2020 2020 2020  nt_s += 1.      
-000795c0: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
-000795d0: 2e74 7970 6520 3d3d 2027 5427 3a20 636e  .type == 'T': cn
-000795e0: 745f 7420 2b3d 2031 0a20 2020 2020 2020  t_t += 1.       
-000795f0: 2070 7269 6e74 2820 2743 6e74 2049 2f53   print( 'Cnt I/S
-00079600: 2f54 203d 2025 692c 2025 692c 2025 6920  /T = %i, %i, %i 
-00079610: 2720 2520 2863 6e74 5f69 2c20 636e 745f  ' % (cnt_i, cnt_
-00079620: 732c 2063 6e74 5f74 2920 290a 2020 2020  s, cnt_t) ).    
-00079630: 2020 2020 2727 2720 2020 2020 2020 2020      '''         
-00079640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00079650: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00079660: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
-00079670: 2072 676e 735f 6c73 745f 6d69 3a20 722e   rgns_lst_mi: r.
-00079680: 7365 745f 6376 6728 290a 2020 2020 2020  set_cvg().      
-00079690: 2020 666f 7220 7220 696e 2072 676e 735f    for r in rgns_
-000796a0: 6c73 745f 6e64 3a20 722e 7365 745f 6376  lst_nd: r.set_cv
-000796b0: 6728 290a 2020 2020 2020 2020 666f 7220  g().        for 
-000796c0: 7220 696e 2072 676e 735f 6c73 745f 7374  r in rgns_lst_st
-000796d0: 3a20 722e 7365 745f 6376 6728 290a 2020  : r.set_cvg().  
-000796e0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-000796f0: 2020 2073 6f2e 636c 6f73 6528 290a 2020     so.close().  
-00079700: 2020 2020 2020 6e5f 7265 6164 732c 206e        n_reads, n
-00079710: 5f62 6173 6573 2c20 7264 5f6c 656e 203d  _bases, rd_len =
-00079720: 2073 6f2e 6e75 6d5f 7265 6164 732c 2073   so.num_reads, s
-00079730: 6f2e 6e75 6d5f 6261 7365 732c 2073 6f2e  o.num_bases, so.
-00079740: 7265 6164 5f6c 656e 0a20 2020 2020 2020  read_len.       
-00079750: 2072 645f 6c65 6e20 3d20 736f 2e72 6561   rd_len = so.rea
-00079760: 645f 6c65 6e0a 2020 2020 2020 2020 656c  d_len.        el
-00079770: 6170 7365 645f 7469 6d65 3120 3d20 7469  apsed_time1 = ti
-00079780: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-00079790: 745f 7469 6d65 320a 0a20 2020 2020 2020  t_time2..       
-000797a0: 2023 2727 270a 2020 2020 2020 2020 6966   #'''.        if
-000797b0: 2073 6176 5f72 676e 3a0a 2020 2020 2020   sav_rgn:.      
-000797c0: 2020 2020 2020 7072 696e 7428 2753 6176        print('Sav
-000797d0: 696e 6720 6c6f 6369 2026 2063 6f6e 7365  ing loci & conse
-000797e0: 6e73 7573 206d 6174 7269 6365 7320 2e2e  nsus matrices ..
-000797f0: 2e2e 2e27 2c20 656e 643d 2727 2c20 666c  ...', end='', fl
-00079800: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-00079810: 2020 2020 2020 2020 7361 7665 5f72 676e          save_rgn
-00079820: 735f 6f62 6a28 666e 616d 6520 2b20 272e  s_obj(fname + '.
-00079830: 7267 6e73 272c 2072 676e 735f 6c73 745f  rgns', rgns_lst_
-00079840: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 642c  mi, rgns_lst_nd,
-00079850: 2072 676e 735f 6c73 745f 7374 2c20 736f   rgns_lst_st, so
-00079860: 2e72 6561 645f 6c65 6e2c 2073 6f2e 6e75  .read_len, so.nu
-00079870: 6d5f 7265 6164 732c 206d 6564 5f66 7261  m_reads, med_fra
-00079880: 675f 6c65 6e20 290a 2020 2020 2020 2020  g_len ).        
-00079890: 2020 2020 7072 696e 7428 2720 646f 6e65      print(' done
-000798a0: 2729 0a0a 2020 2020 2020 2020 2320 7072  ')..        # pr
-000798b0: 696e 7428 272e 272c 2065 6e64 3d27 2729  int('.', end='')
-000798c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000798d0: 2020 2020 2073 6176 655f 7267 6e73 2820       save_rgns( 
-000798e0: 666e 616d 6520 2b20 275f 7267 6e73 5f6d  fname + '_rgns_m
-000798f0: 695f 2569 2e74 7874 2720 2520 7361 2c20  i_%i.txt' % sa, 
-00079900: 7267 6e73 5f6c 7374 5f6d 692c 2073 6f2e  rgns_lst_mi, so.
-00079910: 7265 6164 5f6c 656e 2c20 736f 2e6e 756d  read_len, so.num
-00079920: 5f72 6561 6473 2029 0a20 2020 2020 2020  _reads ).       
-00079930: 2070 7269 6e74 2827 2e27 2c20 656e 643d   print('.', end=
-00079940: 2727 290a 2020 2020 2020 2020 2222 220a  '').        """.
-00079950: 2020 2020 2020 2020 2320 7361 7665 5f72          # save_r
-00079960: 676e 7328 2066 6e61 6d65 202b 2027 5f72  gns( fname + '_r
-00079970: 676e 735f 6e64 5f25 692e 7478 7427 2025  gns_nd_%i.txt' %
-00079980: 2073 612c 2072 676e 735f 6c73 745f 6e64   sa, rgns_lst_nd
-00079990: 2c20 736f 2e72 6561 645f 6c65 6e2c 2073  , so.read_len, s
-000799a0: 6f2e 6e75 6d5f 7265 6164 7320 290a 2020  o.num_reads ).  
-000799b0: 2020 2020 2020 2320 7072 696e 7428 272e        # print('.
-000799c0: 272c 2065 6e64 3d27 2729 0a20 2020 2020  ', end='').     
-000799d0: 2020 2023 2073 6176 655f 7267 6e73 2820     # save_rgns( 
-000799e0: 666e 616d 6520 2b20 275f 7267 6e73 5f69  fname + '_rgns_i
-000799f0: 5f25 695f 686f 2e74 7874 2720 2520 7361  _%i_ho.txt' % sa
-00079a00: 2c20 7267 6e73 5f6c 7374 5f73 742c 2073  , rgns_lst_st, s
-00079a10: 6f2e 7265 6164 5f6c 656e 2c20 736f 2e6e  o.read_len, so.n
-00079a20: 756d 5f72 6561 6473 2c20 686f 203d 2054  um_reads, ho = T
-00079a30: 7275 6520 290a 2020 2020 2020 2020 2320  rue ).        # 
-00079a40: 7072 696e 7428 272e 272c 2065 6e64 3d27  print('.', end='
-00079a50: 2729 0a20 2020 2020 2020 200a 2020 2020  ').        .    
-00079a60: 2020 2020 2320 7361 7665 5f72 676e 7328      # save_rgns(
-00079a70: 2066 6e61 6d65 202b 2027 5f72 676e 735f   fname + '_rgns_
-00079a80: 6d5f 2569 5f68 6f2e 7478 7427 2025 2073  m_%i_ho.txt' % s
-00079a90: 612c 2072 676e 735f 6c73 745f 6d69 2c20  a, rgns_lst_mi, 
-00079aa0: 736f 2e72 6561 645f 6c65 6e2c 2073 6f2e  so.read_len, so.
-00079ab0: 6e75 6d5f 7265 6164 732c 2068 6f20 3d20  num_reads, ho = 
-00079ac0: 5472 7565 2029 0a20 2020 2020 2020 2023  True ).        #
-00079ad0: 2070 7269 6e74 2827 2e27 2c20 656e 643d   print('.', end=
-00079ae0: 2727 290a 2020 2020 2020 2020 2320 6774  '').        # gt
-00079af0: 665f 6c69 6e65 5f6c 7374 203d 2067 6574  f_line_lst = get
-00079b00: 5f67 7466 5f6c 696e 6573 2820 7267 6e73  _gtf_lines( rgns
-00079b10: 5f6c 7374 5f6d 692c 2072 676e 735f 6c73  _lst_mi, rgns_ls
-00079b20: 745f 6e64 2029 0a20 2020 2020 2020 2023  t_nd ).        #
-00079b30: 2073 6176 655f 6774 6628 2066 6e61 6d65   save_gtf( fname
-00079b40: 2b27 5f72 6567 696f 6e73 2e67 7466 272c  +'_regions.gtf',
-00079b50: 2067 7466 5f6c 696e 655f 6c73 7420 290a   gtf_line_lst ).
-00079b60: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-00079b70: 2720 646f 6e65 2729 0a20 2020 2020 2020  ' done').       
-00079b80: 2023 2727 270a 2020 2020 0a20 2020 2065   #'''.    .    e
-00079b90: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
-00079ba0: 6e74 2827 5374 7269 6e67 4669 7820 7374  nt('StringFix st
-00079bb0: 6172 7465 6420 272c 2064 6174 6574 696d  arted ', datetim
-00079bc0: 652e 6461 7465 7469 6d65 2e6e 6f77 2829  e.datetime.now()
-00079bd0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00079be0: 274c 6f61 6469 6e67 206c 6f63 6920 2620  'Loading loci & 
-00079bf0: 636f 6e73 656e 7375 7320 6d61 7472 6963  consensus matric
-00079c00: 6573 202e 2e2e 272c 2065 6e64 3d27 2729  es ...', end='')
-00079c10: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00079c20: 2020 6461 7461 203d 206c 6f61 645f 7267    data = load_rg
-00079c30: 6e73 5f6f 626a 2866 6e61 6d65 202b 2027  ns_obj(fname + '
-00079c40: 2e72 676e 7327 290a 2020 2020 2020 2020  .rgns').        
-00079c50: 6966 206c 656e 2864 6174 6129 203d 3d20  if len(data) == 
-00079c60: 353a 0a20 2020 2020 2020 2020 2020 2072  5:.            r
-00079c70: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
-00079c80: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
-00079c90: 745f 7374 2c20 7264 5f6c 656e 2c20 6e5f  t_st, rd_len, n_
-00079ca0: 7265 6164 7320 3d20 6461 7461 0a20 2020  reads = data.   
-00079cb0: 2020 2020 2020 2020 206d 6564 5f66 7261           med_fra
-00079cc0: 675f 6c65 6e20 3d20 3330 300a 2020 2020  g_len = 300.    
-00079cd0: 2020 2020 2020 2020 6465 6c20 6461 7461          del data
-00079ce0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00079cf0: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
-00079d00: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
-00079d10: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
-00079d20: 2c20 7264 5f6c 656e 2c20 6e5f 7265 6164  , rd_len, n_read
-00079d30: 732c 206d 6564 5f66 7261 675f 6c65 6e20  s, med_frag_len 
-00079d40: 3d20 6461 7461 0a20 2020 2020 2020 2020  = data.         
-00079d50: 2020 2064 656c 2064 6174 610a 2020 2020     del data.    
-00079d60: 2020 2020 7072 696e 7428 2720 646f 6e65      print(' done
-00079d70: 2e27 290a 2020 2020 2020 2020 0a20 2020  .').        .   
-00079d80: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
-00079d90: 6e73 5f6c 7374 5f6d 693a 2072 2e73 6574  ns_lst_mi: r.set
-00079da0: 5f63 7667 2829 0a20 2020 2020 2020 2066  _cvg().        f
-00079db0: 6f72 2072 2069 6e20 7267 6e73 5f6c 7374  or r in rgns_lst
-00079dc0: 5f6e 643a 2072 2e73 6574 5f63 7667 2829  _nd: r.set_cvg()
-00079dd0: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-00079de0: 6e20 7267 6e73 5f6c 7374 5f73 743a 2072  n rgns_lst_st: r
-00079df0: 2e73 6574 5f63 7667 2829 0a20 2020 2020  .set_cvg().     
-00079e00: 2020 2065 725f 636f 6465 203d 204e 4f5f     er_code = NO_
-00079e10: 4d4f 5245 5f4c 494e 450a 2020 2020 2020  MORE_LINE.      
-00079e20: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00079e30: 2020 2065 6c61 7073 6564 5f74 696d 6531     elapsed_time1
-00079e40: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
-00079e50: 2073 7461 7274 5f74 696d 6531 0a20 2020   start_time1.   
-00079e60: 2020 2020 2020 2020 200a 2020 2020 6966           .    if
-00079e70: 2065 725f 636f 6465 2021 3d20 4e4f 5f4d   er_code != NO_M
-00079e80: 4f52 455f 4c49 4e45 3a0a 2020 2020 2020  ORE_LINE:.      
-00079e90: 2020 7072 696e 7428 2745 5252 4f52 3a20    print('ERROR: 
-00079ea0: 696e 7075 7420 616c 6967 6e6d 656e 7473  input alignments
-00079eb0: 2077 6572 6520 4e4f 5420 736f 7274 6564   were NOT sorted
-00079ec0: 2e27 290a 2020 2020 656c 7365 3a0a 2020  .').    else:.  
-00079ed0: 2020 2020 2020 6764 7320 3d20 4e6f 6e65        gds = None
-00079ee0: 0a20 2020 2020 2020 2069 6620 6a75 6d70  .        if jump
-00079ef0: 203c 2032 3a0a 2020 2020 2020 2020 2020   < 2:.          
-00079f00: 2020 0a20 2020 2020 2020 2020 2020 2076    .            v
-00079f10: 5f74 6820 3d20 7264 5f6c 656e 2a6d 696e  _th = rd_len*min
-00079f20: 5f66 7261 6773 5f70 6572 5f67 656e 650a  _frags_per_gene.
-00079f30: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-00079f40: 2067 7466 2069 7320 4e6f 6e65 3a0a 2020   gtf is None:.  
-00079f50: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00079f60: 7267 6e73 5f6c 7374 5f6d 692c 2072 676e  rgns_lst_mi, rgn
-00079f70: 735f 6c73 745f 6e64 2c20 7267 6e73 5f6c  s_lst_nd, rgns_l
-00079f80: 7374 5f73 7420 3d20 6669 6c74 6572 5f72  st_st = filter_r
-00079f90: 676e 7328 7267 6e73 5f6c 7374 5f6d 692c  gns(rgns_lst_mi,
-00079fa0: 2072 676e 735f 6c73 745f 6e64 2c20 7267   rgns_lst_nd, rg
-00079fb0: 6e73 5f6c 7374 5f73 742c 2076 5f74 682c  ns_lst_st, v_th,
-00079fc0: 2073 5f74 6820 3d20 4d41 585f 5045 5243   s_th = MAX_PERC
-00079fd0: 454e 545f 5345 4329 0a0a 2020 2020 2020  ENT_SEC)..      
-00079fe0: 2020 2020 2020 6764 735f 756e 6d61 7070        gds_unmapp
-00079ff0: 6564 203d 204e 6f6e 650a 2020 2020 2020  ed = None.      
-0007a000: 2020 2020 2020 6966 2067 7466 2069 7320        if gtf is 
-0007a010: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0007a020: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0007a030: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
-0007a040: 6e6f 6d65 5f66 696c 6520 6973 204e 6f6e  nome_file is Non
-0007a050: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0007a060: 2020 2020 2020 2067 656e 6f6d 6520 3d20         genome = 
-0007a070: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0007a080: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0007a090: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0007a0a0: 656e 6f6d 6520 3d20 6c6f 6164 5f67 656e  enome = load_gen
-0007a0b0: 6f6d 6528 6765 6e6f 6d65 5f66 696c 652c  ome(genome_file,
-0007a0c0: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
-0007a0d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007a0e0: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
-0007a0f0: 696c 6528 6774 6620 2b20 272e 6774 7827  ile(gtf + '.gtx'
-0007a100: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0007a110: 2020 2020 2020 2070 7269 6e74 2827 4c6f         print('Lo
-0007a120: 6164 696e 6720 4754 4678 202e 2e20 272c  ading GTFx .. ',
-0007a130: 2065 6e64 203d 2027 2027 2c20 666c 7573   end = ' ', flus
-0007a140: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
-0007a150: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-0007a160: 7468 206f 7065 6e28 6774 6620 2b20 272e  th open(gtf + '.
-0007a170: 6774 7827 2c20 2772 6227 2920 6173 2066  gtx', 'rb') as f
-0007a180: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007a190: 2020 2020 2020 2020 2020 2867 645f 6c73            (gd_ls
-0007a1a0: 742c 2063 6872 7329 203d 2070 6963 6b6c  t, chrs) = pickl
-0007a1b0: 652e 6c6f 6164 2820 6620 290a 2020 2020  e.load( f ).    
-0007a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a1d0: 7072 696e 7428 2764 6f6e 652e 2027 290a  print('done. ').
+000789d0: 2020 2025 2028 696e 7428 736f 2e6e 756d     % (int(so.num
+000789e0: 5f72 6561 6473 292c 2063 6e74 2c20 7361  _reads), cnt, sa
+000789f0: 6d5f 6c73 745b 305d 2e72 6e61 6d65 292c  m_lst[0].rname),
+00078a00: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
+00078a10: 2054 7275 6529 0a0a 2020 2020 2020 2020   True)..        
+00078a20: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00078a30: 725f 636f 6465 203d 3d20 4e4f 5f4d 4f52  r_code == NO_MOR
+00078a40: 455f 4c49 4e45 3a20 6272 6561 6b0a 0a20  E_LINE: break.. 
+00078a50: 2020 2020 2020 2020 2020 206d 6564 5f66             med_f
+00078a60: 7261 675f 6c65 6e20 3d20 6e70 2e69 6e74  rag_len = np.int
+00078a70: 286d 6564 5f66 7261 675f 6c65 6e2f 2863  (med_frag_len/(c
+00078a80: 6e74 5f63 2b31 2929 0a0a 2020 2020 2020  nt_c+1))..      
+00078a90: 2020 2020 2020 656c 6170 7365 645f 7469        elapsed_ti
+00078aa0: 6d65 3120 3d20 7469 6d65 2e74 696d 6528  me1 = time.time(
+00078ab0: 2920 2d20 7374 6172 745f 7469 6d65 320a  ) - start_time2.
+00078ac0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00078ad0: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
+00078ae0: 6369 2026 2043 4d61 7420 2e2e 2e20 646f  ci & CMat ... do
+00078af0: 6e65 2028 2569 292e 2028 2569 722c 2025  ne (%i). (%ir, %
+00078b00: 6963 2c20 2569 2920 2720 5c0a 2020 2020  ic, %i) ' \.    
+00078b10: 2020 2020 2020 2020 2020 2020 2020 2520                % 
+00078b20: 2869 6e74 2865 6c61 7073 6564 5f74 696d  (int(elapsed_tim
+00078b30: 6531 292c 2069 6e74 2873 6f2e 6e75 6d5f  e1), int(so.num_
+00078b40: 7265 6164 7329 2c20 636e 742c 206d 6564  reads), cnt, med
+00078b50: 5f66 7261 675f 6c65 6e29 2029 0a0a 2020  _frag_len) )..  
+00078b60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00078b70: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00078b80: 2070 7269 6e74 2827 5c72 4c6f 6164 696e   print('\rLoadin
+00078b90: 6720 5341 4d20 6c69 6e65 7320 2e2e 2e2e  g SAM lines ....
+00078ba0: 2e2e 2020 272c 2065 6e64 3d27 2729 2020  ..  ', end='')  
+00078bb0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+00078bc0: 2020 2077 6869 6c65 2054 7275 653a 0a0a     while True:..
+00078bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078be0: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
+00078bf0: 652e 7469 6d65 2829 0a20 2020 2020 2020  e.time().       
+00078c00: 2020 2020 2020 2020 2065 725f 636f 6465           er_code
+00078c10: 2c20 7361 6d5f 6c73 742c 206e 756d 5f72  , sam_lst, num_r
+00078c20: 6561 6473 203d 2073 6f2e 6765 745f 6f6e  eads = so.get_on
+00078c30: 655f 6f76 6572 6c61 7065 645f 7361 6d28  e_overlaped_sam(
+00078c40: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00078c50: 2020 2069 6620 6572 5f63 6f64 6520 3d3d     if er_code ==
+00078c60: 204e 4f54 5f53 4f52 5445 443a 0a20 2020   NOT_SORTED:.   
+00078c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078c80: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00078c90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00078ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078cb0: 2073 616d 5f6c 7374 2e61 7070 656e 6428   sam_lst.append(
+00078cc0: 7361 290a 2020 2020 2020 2020 2020 2020  sa).            
+00078cd0: 2020 2020 2020 2020 725f 6c73 745f 6f66          r_lst_of
+00078ce0: 5f6c 7374 2e61 7070 656e 6428 2073 616d  _lst.append( sam
+00078cf0: 5f6c 7374 2029 2023 2028 7361 6d5f 6c73  _lst ) # (sam_ls
+00078d00: 742c 2073 6129 2029 0a20 2020 2020 2020  t, sa) ).       
+00078d10: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+00078d20: 5f6c 7374 5f6f 665f 6c73 742e 6170 7065  _lst_of_lst.appe
+00078d30: 6e64 2820 2873 616d 5f6c 7374 2c20 7361  nd( (sam_lst, sa
+00078d40: 2920 290a 0a20 2020 2020 2020 2020 2020  ) )..           
+00078d50: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
+00078d60: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00078d70: 2020 2020 2020 6966 2063 6e74 2531 3030        if cnt%100
+00078d80: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00078d90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00078da0: 7269 6e74 2827 5c72 2720 2b20 2720 272a  rint('\r' + ' '*
+00078db0: 3130 302c 2065 6e64 3d27 272c 2066 6c75  100, end='', flu
+00078dc0: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
+00078dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078de0: 2020 2070 7269 6e74 2827 5c72 4c6f 6164     print('\rLoad
+00078df0: 696e 6720 5341 4d20 6c69 6e65 7320 2e2e  ing SAM lines ..
+00078e00: 2e2e 2e2e 2028 2569 722c 2025 6963 2920  .... (%ir, %ic) 
+00078e10: 2720 2520 2869 6e74 2873 6f2e 6e75 6d5f  ' % (int(so.num_
+00078e20: 7265 6164 7329 2c20 636e 7429 2c20 656e  reads), cnt), en
+00078e30: 643d 2727 2c20 666c 7573 6820 3d20 5472  d='', flush = Tr
+00078e40: 7565 290a 0a20 2020 2020 2020 2020 2020  ue)..           
+00078e50: 2020 2020 2020 2020 2069 6620 6572 5f63           if er_c
+00078e60: 6f64 6520 3d3d 204e 4f5f 4d4f 5245 5f4c  ode == NO_MORE_L
+00078e70: 494e 453a 2062 7265 616b 0a0a 2020 2020  INE: break..    
+00078e80: 2020 2020 2020 2020 746c 656e 203d 205b          tlen = [
+00078e90: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+00078ea0: 7220 725f 6c73 7420 696e 2072 5f6c 7374  r r_lst in r_lst
+00078eb0: 5f6f 665f 6c73 743a 0a20 2020 2020 2020  _of_lst:.       
+00078ec0: 2020 2020 2020 2020 2066 6f72 2073 6c20           for sl 
+00078ed0: 696e 2072 5f6c 7374 5b3a 2d31 5d3a 0a20  in r_lst[:-1]:. 
+00078ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078ef0: 2020 2074 6c65 6e2e 6170 7065 6e64 2873     tlen.append(s
+00078f00: 6c2e 746c 656e 290a 2020 2020 2020 2020  l.tlen).        
+00078f10: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00078f20: 656e 2874 6c65 6e29 203e 2031 3030 3030  en(tlen) > 10000
+00078f30: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00078f40: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00078f50: 0a20 2020 2020 2020 2020 2020 206d 6564  .            med
+00078f60: 5f66 7261 675f 6c65 6e20 3d20 6e70 2e6d  _frag_len = np.m
+00078f70: 6564 6961 6e28 746c 656e 290a 0a20 2020  edian(tlen)..   
+00078f80: 2020 2020 2020 2020 2023 2727 270a 2020           #'''.  
+00078f90: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
+00078fa0: 645f 7469 6d65 3120 3d20 7469 6d65 2e74  d_time1 = time.t
+00078fb0: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
+00078fc0: 6d65 310a 2020 2020 2020 2020 2020 2020  me1.            
+00078fd0: 7072 696e 7428 275c 7227 202b 2027 2027  print('\r' + ' '
+00078fe0: 2a31 3030 2c20 656e 643d 2727 2c20 666c  *100, end='', fl
+00078ff0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+00079000: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
+00079010: 724c 6f61 6469 6e67 2053 414d 206c 696e  rLoading SAM lin
+00079020: 6573 202e 2e2e 2e2e 2e20 646f 6e65 2028  es ...... done (
+00079030: 2569 292e 2028 2569 722c 2025 6963 2920  %i). (%ir, %ic) 
+00079040: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
+00079050: 2020 2020 2020 2520 2869 6e74 2865 6c61        % (int(ela
+00079060: 7073 6564 5f74 696d 6531 292c 2069 6e74  psed_time1), int
+00079070: 2873 6f2e 6e75 6d5f 7265 6164 7329 2c20  (so.num_reads), 
+00079080: 636e 7429 2c20 666c 7573 6820 3d20 5472  cnt), flush = Tr
+00079090: 7565 2029 0a20 2020 2020 2020 2020 2020  ue ).           
+000790a0: 2073 7461 7274 5f74 696d 6532 203d 2074   start_time2 = t
+000790b0: 696d 652e 7469 6d65 2829 0a0a 2020 2020  ime.time()..    
+000790c0: 2020 2020 2020 2020 6966 206e 5f63 6f72          if n_cor
+000790d0: 6573 203d 3d20 313a 0a20 2020 2020 2020  es == 1:.       
+000790e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000790f0: 4275 696c 6469 6e67 206c 6f63 6920 2620  Building loci & 
+00079100: 434d 6174 202e 2e2e 2027 2c20 656e 643d  CMat ... ', end=
+00079110: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
+00079120: 2020 2020 725f 6d69 5f6c 7374 2c20 725f      r_mi_lst, r_
+00079130: 6e64 5f6c 7374 2c20 725f 7374 5f6c 7374  nd_lst, r_st_lst
+00079140: 203d 2062 7569 6c64 5f63 6f6e 7469 6773   = build_contigs
+00079150: 2872 5f6c 7374 5f6f 665f 6c73 7429 0a20  (r_lst_of_lst). 
+00079160: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00079170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00079180: 2070 7269 6e74 2827 4275 696c 6469 6e67   print('Building
+00079190: 206c 6f63 6920 2620 434d 6174 202e 2e2e   loci & CMat ...
+000791a0: 2027 2c20 656e 643d 2727 290a 2020 2020   ', end='').    
+000791b0: 2020 2020 2020 2020 2020 2020 725f 6d69              r_mi
+000791c0: 5f6c 7374 2c20 725f 6e64 5f6c 7374 2c20  _lst, r_nd_lst, 
+000791d0: 725f 7374 5f6c 7374 203d 2062 7569 6c64  r_st_lst = build
+000791e0: 5f63 6f6e 7469 6773 5f6d 6328 725f 6c73  _contigs_mc(r_ls
+000791f0: 745f 6f66 5f6c 7374 2c20 6e5f 636f 7265  t_of_lst, n_core
+00079200: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00079210: 7267 6e73 5f6c 7374 5f6d 6920 3d20 7267  rgns_lst_mi = rg
+00079220: 6e73 5f6c 7374 5f6d 6920 2b20 725f 6d69  ns_lst_mi + r_mi
+00079230: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+00079240: 2072 676e 735f 6c73 745f 6e64 203d 2072   rgns_lst_nd = r
+00079250: 676e 735f 6c73 745f 6e64 202b 2072 5f6e  gns_lst_nd + r_n
+00079260: 645f 6c73 740a 2020 2020 2020 2020 2020  d_lst.          
+00079270: 2020 7267 6e73 5f6c 7374 5f73 7420 3d20    rgns_lst_st = 
+00079280: 7267 6e73 5f6c 7374 5f73 7420 2b20 725f  rgns_lst_st + r_
+00079290: 7374 5f6c 7374 0a20 2020 2020 2020 2020  st_lst.         
+000792a0: 2020 2023 2727 2720 0a20 2020 2020 2020     #''' .       
+000792b0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+000792c0: 2065 6c61 7073 6564 5f74 696d 6531 203d   elapsed_time1 =
+000792d0: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
+000792e0: 7461 7274 5f74 696d 6532 0a20 2020 2020  tart_time2.     
+000792f0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+00079300: 4275 696c 6469 6e67 206c 6f63 6920 2620  Building loci & 
+00079310: 434d 6174 202e 2e2e 2064 6f6e 6520 2825  CMat ... done (%
+00079320: 6929 2e20 2569 722c 2025 6963 2c20 6d65  i). %ir, %ic, me
+00079330: 642e 6672 6167 2e6c 656e 203d 2025 6920  d.frag.len = %i 
+00079340: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
+00079350: 2020 2020 2020 2520 2869 6e74 2865 6c61        % (int(ela
+00079360: 7073 6564 5f74 696d 6531 292c 2069 6e74  psed_time1), int
+00079370: 2873 6f2e 6e75 6d5f 7265 6164 7329 2c20  (so.num_reads), 
+00079380: 636e 742c 206d 6564 5f66 7261 675f 6c65  cnt, med_frag_le
+00079390: 6e29 2029 0a20 2020 2020 2020 2020 2020  n) ).           
+000793a0: 200a 2020 2020 2020 2020 2323 2323 2323   .        ######
+000793b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000793c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000793d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000793e0: 2323 0a20 2020 2020 2020 200a 2020 2020  ##.        .    
+000793f0: 2020 2020 6465 6c20 725f 6c73 745f 6f66      del r_lst_of
+00079400: 5f6c 7374 0a20 2020 2020 2020 2027 2727  _lst.        '''
+00079410: 0a20 2020 2020 2020 2063 6e74 5f69 203d  .        cnt_i =
+00079420: 2030 0a20 2020 2020 2020 2063 6e74 5f73   0.        cnt_s
+00079430: 203d 2030 0a20 2020 2020 2020 2063 6e74   = 0.        cnt
+00079440: 5f74 203d 2030 0a20 2020 2020 2020 2066  _t = 0.        f
+00079450: 6f72 2072 676e 7320 696e 2072 676e 735f  or rgns in rgns_
+00079460: 6c73 745f 7374 3a20 0a20 2020 2020 2020  lst_st: .       
+00079470: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
+00079480: 6e73 2e72 676e 733a 0a20 2020 2020 2020  ns.rgns:.       
+00079490: 2020 2020 2020 2020 2069 6620 722e 7479           if r.ty
+000794a0: 7065 203d 3d20 2749 273a 2063 6e74 5f69  pe == 'I': cnt_i
+000794b0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+000794c0: 2020 2020 2020 656c 6966 2072 2e74 7970        elif r.typ
+000794d0: 6520 3d3d 2027 5327 3a20 636e 745f 7320  e == 'S': cnt_s 
+000794e0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+000794f0: 2020 2020 2065 6c69 6620 722e 7479 7065       elif r.type
+00079500: 203d 3d20 2754 273a 2063 6e74 5f74 202b   == 'T': cnt_t +
+00079510: 3d20 310a 2020 2020 2020 2020 7072 696e  = 1.        prin
+00079520: 7428 2027 436e 7420 492f 532f 5420 3d20  t( 'Cnt I/S/T = 
+00079530: 2569 2c20 2569 2c20 2569 2027 2025 2028  %i, %i, %i ' % (
+00079540: 636e 745f 692c 2063 6e74 5f73 2c20 636e  cnt_i, cnt_s, cn
+00079550: 745f 7429 2029 0a20 2020 2020 2020 2027  t_t) ).        '
+00079560: 2727 2020 2020 2020 2020 2020 2020 2020  ''              
+00079570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079580: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00079590: 2020 2066 6f72 2072 2069 6e20 7267 6e73     for r in rgns
+000795a0: 5f6c 7374 5f6d 693a 2072 2e73 6574 5f63  _lst_mi: r.set_c
+000795b0: 7667 2829 0a20 2020 2020 2020 2066 6f72  vg().        for
+000795c0: 2072 2069 6e20 7267 6e73 5f6c 7374 5f6e   r in rgns_lst_n
+000795d0: 643a 2072 2e73 6574 5f63 7667 2829 0a20  d: r.set_cvg(). 
+000795e0: 2020 2020 2020 2066 6f72 2072 2069 6e20         for r in 
+000795f0: 7267 6e73 5f6c 7374 5f73 743a 2072 2e73  rgns_lst_st: r.s
+00079600: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
+00079610: 2020 2020 200a 2020 2020 2020 2020 736f       .        so
+00079620: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+00079630: 206e 5f72 6561 6473 2c20 6e5f 6261 7365   n_reads, n_base
+00079640: 732c 2072 645f 6c65 6e20 3d20 736f 2e6e  s, rd_len = so.n
+00079650: 756d 5f72 6561 6473 2c20 736f 2e6e 756d  um_reads, so.num
+00079660: 5f62 6173 6573 2c20 736f 2e72 6561 645f  _bases, so.read_
+00079670: 6c65 6e0a 2020 2020 2020 2020 7264 5f6c  len.        rd_l
+00079680: 656e 203d 2073 6f2e 7265 6164 5f6c 656e  en = so.read_len
+00079690: 0a20 2020 2020 2020 2065 6c61 7073 6564  .        elapsed
+000796a0: 5f74 696d 6531 203d 2074 696d 652e 7469  _time1 = time.ti
+000796b0: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
+000796c0: 6532 0a0a 2020 2020 2020 2020 2327 2727  e2..        #'''
+000796d0: 0a20 2020 2020 2020 2069 6620 7361 765f  .        if sav_
+000796e0: 7267 6e3a 0a20 2020 2020 2020 2020 2020  rgn:.           
+000796f0: 2070 7269 6e74 2827 5361 7669 6e67 206c   print('Saving l
+00079700: 6f63 6920 2620 636f 6e73 656e 7375 7320  oci & consensus 
+00079710: 6d61 7472 6963 6573 202e 2e2e 2e2e 272c  matrices .....',
+00079720: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
+00079730: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
+00079740: 2020 2073 6176 655f 7267 6e73 5f6f 626a     save_rgns_obj
+00079750: 2866 6e61 6d65 202b 2027 2e72 676e 7327  (fname + '.rgns'
+00079760: 2c20 7267 6e73 5f6c 7374 5f6d 692c 2072  , rgns_lst_mi, r
+00079770: 676e 735f 6c73 745f 6e64 2c20 7267 6e73  gns_lst_nd, rgns
+00079780: 5f6c 7374 5f73 742c 2073 6f2e 7265 6164  _lst_st, so.read
+00079790: 5f6c 656e 2c20 736f 2e6e 756d 5f72 6561  _len, so.num_rea
+000797a0: 6473 2c20 6d65 645f 6672 6167 5f6c 656e  ds, med_frag_len
+000797b0: 2029 0a20 2020 2020 2020 2020 2020 2070   ).            p
+000797c0: 7269 6e74 2827 2064 6f6e 6527 290a 0a20  rint(' done').. 
+000797d0: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+000797e0: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+000797f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00079800: 7361 7665 5f72 676e 7328 2066 6e61 6d65  save_rgns( fname
+00079810: 202b 2027 5f72 676e 735f 6d69 5f25 692e   + '_rgns_mi_%i.
+00079820: 7478 7427 2025 2073 612c 2072 676e 735f  txt' % sa, rgns_
+00079830: 6c73 745f 6d69 2c20 736f 2e72 6561 645f  lst_mi, so.read_
+00079840: 6c65 6e2c 2073 6f2e 6e75 6d5f 7265 6164  len, so.num_read
+00079850: 7320 290a 2020 2020 2020 2020 7072 696e  s ).        prin
+00079860: 7428 272e 272c 2065 6e64 3d27 2729 0a20  t('.', end=''). 
+00079870: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00079880: 2020 2023 2073 6176 655f 7267 6e73 2820     # save_rgns( 
+00079890: 666e 616d 6520 2b20 275f 7267 6e73 5f6e  fname + '_rgns_n
+000798a0: 645f 2569 2e74 7874 2720 2520 7361 2c20  d_%i.txt' % sa, 
+000798b0: 7267 6e73 5f6c 7374 5f6e 642c 2073 6f2e  rgns_lst_nd, so.
+000798c0: 7265 6164 5f6c 656e 2c20 736f 2e6e 756d  read_len, so.num
+000798d0: 5f72 6561 6473 2029 0a20 2020 2020 2020  _reads ).       
+000798e0: 2023 2070 7269 6e74 2827 2e27 2c20 656e   # print('.', en
+000798f0: 643d 2727 290a 2020 2020 2020 2020 2320  d='').        # 
+00079900: 7361 7665 5f72 676e 7328 2066 6e61 6d65  save_rgns( fname
+00079910: 202b 2027 5f72 676e 735f 695f 2569 5f68   + '_rgns_i_%i_h
+00079920: 6f2e 7478 7427 2025 2073 612c 2072 676e  o.txt' % sa, rgn
+00079930: 735f 6c73 745f 7374 2c20 736f 2e72 6561  s_lst_st, so.rea
+00079940: 645f 6c65 6e2c 2073 6f2e 6e75 6d5f 7265  d_len, so.num_re
+00079950: 6164 732c 2068 6f20 3d20 5472 7565 2029  ads, ho = True )
+00079960: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
+00079970: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
+00079980: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00079990: 2073 6176 655f 7267 6e73 2820 666e 616d   save_rgns( fnam
+000799a0: 6520 2b20 275f 7267 6e73 5f6d 5f25 695f  e + '_rgns_m_%i_
+000799b0: 686f 2e74 7874 2720 2520 7361 2c20 7267  ho.txt' % sa, rg
+000799c0: 6e73 5f6c 7374 5f6d 692c 2073 6f2e 7265  ns_lst_mi, so.re
+000799d0: 6164 5f6c 656e 2c20 736f 2e6e 756d 5f72  ad_len, so.num_r
+000799e0: 6561 6473 2c20 686f 203d 2054 7275 6520  eads, ho = True 
+000799f0: 290a 2020 2020 2020 2020 2320 7072 696e  ).        # prin
+00079a00: 7428 272e 272c 2065 6e64 3d27 2729 0a20  t('.', end=''). 
+00079a10: 2020 2020 2020 2023 2067 7466 5f6c 696e         # gtf_lin
+00079a20: 655f 6c73 7420 3d20 6765 745f 6774 665f  e_lst = get_gtf_
+00079a30: 6c69 6e65 7328 2072 676e 735f 6c73 745f  lines( rgns_lst_
+00079a40: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 6420  mi, rgns_lst_nd 
+00079a50: 290a 2020 2020 2020 2020 2320 7361 7665  ).        # save
+00079a60: 5f67 7466 2820 666e 616d 652b 275f 7265  _gtf( fname+'_re
+00079a70: 6769 6f6e 732e 6774 6627 2c20 6774 665f  gions.gtf', gtf_
+00079a80: 6c69 6e65 5f6c 7374 2029 0a20 2020 2020  line_lst ).     
+00079a90: 2020 2023 2070 7269 6e74 2827 2064 6f6e     # print(' don
+00079aa0: 6527 290a 2020 2020 2020 2020 2327 2727  e').        #'''
+00079ab0: 0a20 2020 200a 2020 2020 656c 7365 3a0a  .    .    else:.
+00079ac0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+00079ad0: 7472 696e 6746 6978 2073 7461 7274 6564  tringFix started
+00079ae0: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
+00079af0: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
+00079b00: 2020 2020 2070 7269 6e74 2827 4c6f 6164       print('Load
+00079b10: 696e 6720 6c6f 6369 2026 2063 6f6e 7365  ing loci & conse
+00079b20: 6e73 7573 206d 6174 7269 6365 7320 2e2e  nsus matrices ..
+00079b30: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+00079b40: 2020 2020 0a20 2020 2020 2020 2064 6174      .        dat
+00079b50: 6120 3d20 6c6f 6164 5f72 676e 735f 6f62  a = load_rgns_ob
+00079b60: 6a28 666e 616d 6520 2b20 272e 7267 6e73  j(fname + '.rgns
+00079b70: 2729 0a20 2020 2020 2020 2069 6620 6c65  ').        if le
+00079b80: 6e28 6461 7461 2920 3d3d 2035 3a0a 2020  n(data) == 5:.  
+00079b90: 2020 2020 2020 2020 2020 7267 6e73 5f6c            rgns_l
+00079ba0: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
+00079bb0: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
+00079bc0: 2072 645f 6c65 6e2c 206e 5f72 6561 6473   rd_len, n_reads
+00079bd0: 203d 2064 6174 610a 2020 2020 2020 2020   = data.        
+00079be0: 2020 2020 6d65 645f 6672 6167 5f6c 656e      med_frag_len
+00079bf0: 203d 2033 3030 0a20 2020 2020 2020 2020   = 300.         
+00079c00: 2020 2064 656c 2064 6174 610a 2020 2020     del data.    
+00079c10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00079c20: 2020 2020 2020 7267 6e73 5f6c 7374 5f6d        rgns_lst_m
+00079c30: 692c 2072 676e 735f 6c73 745f 6e64 2c20  i, rgns_lst_nd, 
+00079c40: 7267 6e73 5f6c 7374 5f73 742c 2072 645f  rgns_lst_st, rd_
+00079c50: 6c65 6e2c 206e 5f72 6561 6473 2c20 6d65  len, n_reads, me
+00079c60: 645f 6672 6167 5f6c 656e 203d 2064 6174  d_frag_len = dat
+00079c70: 610a 2020 2020 2020 2020 2020 2020 6465  a.            de
+00079c80: 6c20 6461 7461 0a20 2020 2020 2020 2070  l data.        p
+00079c90: 7269 6e74 2827 2064 6f6e 652e 2729 0a20  rint(' done.'). 
+00079ca0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00079cb0: 666f 7220 7220 696e 2072 676e 735f 6c73  for r in rgns_ls
+00079cc0: 745f 6d69 3a20 722e 7365 745f 6376 6728  t_mi: r.set_cvg(
+00079cd0: 290a 2020 2020 2020 2020 666f 7220 7220  ).        for r 
+00079ce0: 696e 2072 676e 735f 6c73 745f 6e64 3a20  in rgns_lst_nd: 
+00079cf0: 722e 7365 745f 6376 6728 290a 2020 2020  r.set_cvg().    
+00079d00: 2020 2020 666f 7220 7220 696e 2072 676e      for r in rgn
+00079d10: 735f 6c73 745f 7374 3a20 722e 7365 745f  s_lst_st: r.set_
+00079d20: 6376 6728 290a 2020 2020 2020 2020 6572  cvg().        er
+00079d30: 5f63 6f64 6520 3d20 4e4f 5f4d 4f52 455f  _code = NO_MORE_
+00079d40: 4c49 4e45 0a20 2020 2020 2020 2020 2020  LINE.           
+00079d50: 2020 2020 200a 2020 2020 2020 2020 656c       .        el
+00079d60: 6170 7365 645f 7469 6d65 3120 3d20 7469  apsed_time1 = ti
+00079d70: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+00079d80: 745f 7469 6d65 310a 2020 2020 2020 2020  t_time1.        
+00079d90: 2020 2020 0a20 2020 2069 6620 6572 5f63      .    if er_c
+00079da0: 6f64 6520 213d 204e 4f5f 4d4f 5245 5f4c  ode != NO_MORE_L
+00079db0: 494e 453a 0a20 2020 2020 2020 2070 7269  INE:.        pri
+00079dc0: 6e74 2827 4552 524f 523a 2069 6e70 7574  nt('ERROR: input
+00079dd0: 2061 6c69 676e 6d65 6e74 7320 7765 7265   alignments were
+00079de0: 204e 4f54 2073 6f72 7465 642e 2729 0a20   NOT sorted.'). 
+00079df0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00079e00: 2067 6473 203d 204e 6f6e 650a 2020 2020   gds = None.    
+00079e10: 2020 2020 6966 206a 756d 7020 3c20 323a      if jump < 2:
+00079e20: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00079e30: 2020 2020 2020 2020 2020 765f 7468 203d            v_th =
+00079e40: 2072 645f 6c65 6e2a 6d69 6e5f 6672 6167   rd_len*min_frag
+00079e50: 735f 7065 725f 6765 6e65 0a20 2020 2020  s_per_gene.     
+00079e60: 2020 2020 2020 2023 2069 6620 6774 6620         # if gtf 
+00079e70: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00079e80: 2020 2020 2023 2020 2020 2072 676e 735f       #     rgns_
+00079e90: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
+00079ea0: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
+00079eb0: 203d 2066 696c 7465 725f 7267 6e73 2872   = filter_rgns(r
+00079ec0: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
+00079ed0: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
+00079ee0: 745f 7374 2c20 765f 7468 2c20 735f 7468  t_st, v_th, s_th
+00079ef0: 203d 204d 4158 5f50 4552 4345 4e54 5f53   = MAX_PERCENT_S
+00079f00: 4543 290a 0a20 2020 2020 2020 2020 2020  EC)..           
+00079f10: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
+00079f20: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00079f30: 2069 6620 6774 6620 6973 206e 6f74 204e   if gtf is not N
+00079f40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00079f50: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00079f60: 2020 2020 2020 6966 2067 656e 6f6d 655f        if genome_
+00079f70: 6669 6c65 2069 7320 4e6f 6e65 3a0a 2020  file is None:.  
+00079f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079f90: 2020 6765 6e6f 6d65 203d 204e 6f6e 650a    genome = None.
+00079fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079fb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00079fc0: 2020 2020 2020 2020 2020 6765 6e6f 6d65            genome
+00079fd0: 203d 206c 6f61 645f 6765 6e6f 6d65 2867   = load_genome(g
+00079fe0: 656e 6f6d 655f 6669 6c65 2c20 7665 7262  enome_file, verb
+00079ff0: 6f73 6520 3d20 5472 7565 290a 0a20 2020  ose = True)..   
+0007a000: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007a010: 6f73 2e70 6174 682e 6973 6669 6c65 2867  os.path.isfile(g
+0007a020: 7466 202b 2027 2e67 7478 2729 3a0a 2020  tf + '.gtx'):.  
+0007a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a040: 2020 7072 696e 7428 274c 6f61 6469 6e67    print('Loading
+0007a050: 2047 5446 7820 2e2e 2027 2c20 656e 6420   GTFx .. ', end 
+0007a060: 3d20 2720 272c 2066 6c75 7368 203d 2054  = ' ', flush = T
+0007a070: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0007a080: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0007a090: 656e 2867 7466 202b 2027 2e67 7478 272c  en(gtf + '.gtx',
+0007a0a0: 2027 7262 2729 2061 7320 663a 0a20 2020   'rb') as f:.   
+0007a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a0c0: 2020 2020 2028 6764 5f6c 7374 2c20 6368       (gd_lst, ch
+0007a0d0: 7273 2920 3d20 7069 636b 6c65 2e6c 6f61  rs) = pickle.loa
+0007a0e0: 6428 2066 2029 0a20 2020 2020 2020 2020  d( f ).         
+0007a0f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0007a100: 2827 646f 6e65 2e20 2729 0a20 2020 2020  ('done. ').     
+0007a110: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0007a120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a130: 2020 2020 2067 7466 5f6c 696e 6573 2c20       gtf_lines, 
+0007a140: 6864 725f 6c69 6e65 7320 3d20 6c6f 6164  hdr_lines = load
+0007a150: 5f67 7466 2867 7466 2c20 7665 7262 6f73  _gtf(gtf, verbos
+0007a160: 6520 3d20 5472 7565 290a 2020 2020 2020  e = True).      
+0007a170: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+0007a180: 5f6c 7374 2c20 6368 7273 203d 2067 6574  _lst, chrs = get
+0007a190: 5f67 656e 655f 6465 7363 7269 7074 6f72  _gene_descriptor
+0007a1a0: 2867 7466 5f6c 696e 6573 2c20 6765 6e6f  (gtf_lines, geno
+0007a1b0: 6d65 203d 2067 656e 6f6d 652c 2066 696c  me = genome, fil
+0007a1c0: 6c20 3d20 4661 6c73 652c 205c 0a20 2020  l = False, \.   
+0007a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0007a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a1f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0007a200: 2020 2020 2020 2020 2020 6774 665f 6c69            gtf_li
-0007a210: 6e65 732c 2068 6472 5f6c 696e 6573 203d  nes, hdr_lines =
-0007a220: 206c 6f61 645f 6774 6628 6774 662c 2076   load_gtf(gtf, v
-0007a230: 6572 626f 7365 203d 2054 7275 6529 0a20  erbose = True). 
-0007a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a250: 2020 2067 645f 6c73 742c 2063 6872 7320     gd_lst, chrs 
-0007a260: 3d20 6765 745f 6765 6e65 5f64 6573 6372  = get_gene_descr
-0007a270: 6970 746f 7228 6774 665f 6c69 6e65 732c  iptor(gtf_lines,
-0007a280: 2067 656e 6f6d 6520 3d20 6765 6e6f 6d65   genome = genome
-0007a290: 2c20 6669 6c6c 203d 2046 616c 7365 2c20  , fill = False, 
-0007a2a0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0007a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a2e0: 2020 2076 6572 626f 7365 203d 2054 7275     verbose = Tru
-0007a2f0: 652c 206e 5f63 6f72 6573 203d 206e 5f63  e, n_cores = n_c
-0007a300: 6f72 6573 290a 2020 2020 2020 2020 2020  ores).          
-0007a310: 2020 2020 2020 2020 2020 6465 6c20 6774            del gt
-0007a320: 665f 6c69 6e65 730a 2020 2020 2020 2020  f_lines.        
-0007a330: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0007a340: 7428 2753 6176 696e 6720 4754 4678 202e  t('Saving GTFx .
-0007a350: 2e20 272c 2065 6e64 203d 2027 2027 2c20  . ', end = ' ', 
-0007a360: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-0007a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a380: 2020 7769 7468 206f 7065 6e28 6774 6620    with open(gtf 
-0007a390: 2b20 272e 6774 7827 2c20 2777 6227 2920  + '.gtx', 'wb') 
-0007a3a0: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-0007a3b0: 2020 2020 2020 2020 2020 2020 2020 7069                pi
-0007a3c0: 636b 6c65 2e64 756d 7028 2028 6764 5f6c  ckle.dump( (gd_l
-0007a3d0: 7374 2c20 6368 7273 292c 2066 2029 0a20  st, chrs), f ). 
+0007a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a200: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+0007a210: 7262 6f73 6520 3d20 5472 7565 2c20 6e5f  rbose = True, n_
+0007a220: 636f 7265 7320 3d20 6e5f 636f 7265 7329  cores = n_cores)
+0007a230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a240: 2020 2020 2064 656c 2067 7466 5f6c 696e       del gtf_lin
+0007a250: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0007a260: 2020 2020 2020 2070 7269 6e74 2827 5361         print('Sa
+0007a270: 7669 6e67 2047 5446 7820 2e2e 2027 2c20  ving GTFx .. ', 
+0007a280: 656e 6420 3d20 2720 272c 2066 6c75 7368  end = ' ', flush
+0007a290: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+0007a2a0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+0007a2b0: 6820 6f70 656e 2867 7466 202b 2027 2e67  h open(gtf + '.g
+0007a2c0: 7478 272c 2027 7762 2729 2061 7320 663a  tx', 'wb') as f:
+0007a2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a2e0: 2020 2020 2020 2020 2070 6963 6b6c 652e           pickle.
+0007a2f0: 6475 6d70 2820 2867 645f 6c73 742c 2063  dump( (gd_lst, c
+0007a300: 6872 7329 2c20 6620 290a 2020 2020 2020  hrs), f ).      
+0007a310: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0007a320: 696e 7428 2764 6f6e 652e 2027 290a 0a20  int('done. ').. 
+0007a330: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0007a340: 645f 6c73 745f 6f66 5f6c 7374 2c20 6368  d_lst_of_lst, ch
+0007a350: 725f 6c73 7420 3d20 7061 636b 5f67 656e  r_lst = pack_gen
+0007a360: 655f 6465 7363 7269 7074 6f72 2820 6764  e_descriptor( gd
+0007a370: 5f6c 7374 2c20 6368 7273 2029 2020 2020  _lst, chrs )    
+0007a380: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0007a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a3a0: 6764 732c 2072 676e 735f 6c73 745f 6d69  gds, rgns_lst_mi
+0007a3b0: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
+0007a3c0: 676e 735f 6c73 745f 7374 2c20 6764 735f  gns_lst_st, gds_
+0007a3d0: 756e 6d61 7070 6564 203d 205c 0a20 2020  unmapped = \.   
 0007a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a3f0: 2020 2070 7269 6e74 2827 646f 6e65 2e20     print('done. 
-0007a400: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-0007a410: 2020 2020 6764 5f6c 7374 5f6f 665f 6c73      gd_lst_of_ls
-0007a420: 742c 2063 6872 5f6c 7374 203d 2070 6163  t, chr_lst = pac
-0007a430: 6b5f 6765 6e65 5f64 6573 6372 6970 746f  k_gene_descripto
-0007a440: 7228 2067 645f 6c73 742c 2063 6872 7320  r( gd_lst, chrs 
-0007a450: 2920 2020 2020 2020 2020 2020 2020 2020  )               
-0007a460: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007a470: 2020 2020 2067 6473 2c20 7267 6e73 5f6c       gds, rgns_l
-0007a480: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
-0007a490: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
-0007a4a0: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
-0007a4b0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0007a4c0: 2020 2020 2020 7061 7273 655f 616e 645f        parse_and_
-0007a4d0: 636f 6d62 696e 655f 6765 6e65 735f 616e  combine_genes_an
-0007a4e0: 645f 7267 6e73 2867 645f 6c73 745f 6f66  d_rgns(gd_lst_of
-0007a4f0: 5f6c 7374 2c20 6368 725f 6c73 742c 2072  _lst, chr_lst, r
-0007a500: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
-0007a510: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
-0007a520: 745f 7374 2c20 5c0a 2020 2020 2020 2020  t_st, \.        
-0007a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a550: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
-0007a560: 6f72 6573 203d 206e 5f63 6f72 6573 2c20  ores = n_cores, 
-0007a570: 6765 6e6f 6d65 203d 2067 656e 6f6d 652c  genome = genome,
-0007a580: 2076 6572 626f 7365 203d 2054 7275 6520   verbose = True 
-0007a590: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007a5a0: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
-0007a5b0: 2020 2020 2020 2020 4e74 7273 203d 2030          Ntrs = 0
-0007a5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a5d0: 204e 7472 7332 203d 2030 0a20 2020 2020   Ntrs2 = 0.     
-0007a5e0: 2020 2020 2020 2020 2020 2066 6f72 2067             for g
-0007a5f0: 6420 696e 2067 6473 3a0a 2020 2020 2020  d in gds:.      
-0007a600: 2020 2020 2020 2020 2020 2020 2020 4e74                Nt
-0007a610: 7273 202b 3d20 6764 2e6e 7472 0a20 2020  rs += gd.ntr.   
-0007a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a630: 2066 6f72 2074 6420 696e 2067 642e 7464   for td in gd.td
-0007a640: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
-0007a650: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0007a660: 206c 656e 2874 642e 7465 5f74 6f5f 6765   len(td.te_to_ge
-0007a670: 5f6d 6170 2920 3e20 303a 204e 7472 7332  _map) > 0: Ntrs2
-0007a680: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0007a690: 2020 2020 2020 7072 696e 7428 274e 7472        print('Ntr
-0007a6a0: 7320 3d20 2569 2c20 2569 2027 2025 2028  s = %i, %i ' % (
-0007a6b0: 4e74 7273 2c20 4e74 7273 3229 2029 0a20  Ntrs, Ntrs2) ). 
-0007a6c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0007a6d0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
-0007a6e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0007a6f0: 2020 2020 2020 6764 7320 3d20 4e6f 6e65        gds = None
-0007a700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a710: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
-0007a720: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0007a730: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
-0007a740: 6966 2073 6176 5f72 676e 3a0a 2020 2020  if sav_rgn:.    
-0007a750: 2020 2020 2020 2020 2320 2020 2020 7361          #     sa
-0007a760: 7665 5f72 676e 735f 6f62 6a28 666e 616d  ve_rgns_obj(fnam
-0007a770: 6520 2b20 275f 7365 6c65 6374 6564 2e72  e + '_selected.r
-0007a780: 676e 7327 2c20 7267 6e73 5f6c 7374 5f6d  gns', rgns_lst_m
-0007a790: 692c 2072 676e 735f 6c73 745f 6e64 2c20  i, rgns_lst_nd, 
-0007a7a0: 7267 6e73 5f6c 7374 5f73 742c 2072 645f  rgns_lst_st, rd_
-0007a7b0: 6c65 6e2c 206e 5f72 6561 6473 2029 0a20  len, n_reads ). 
-0007a7c0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0007a7d0: 2020 2020 2020 2020 6966 206e 5f63 6f72          if n_cor
-0007a7e0: 6573 203d 3d20 313a 0a20 2020 2020 2020  es == 1:.       
-0007a7f0: 2020 2020 2020 2020 2054 725f 6c73 742c           Tr_lst,
-0007a800: 2049 735f 6c73 742c 2047 5446 5f6c 7374   Is_lst, GTF_lst
-0007a810: 2c20 6d6e 5f6c 7374 2c20 6772 705f 6c73  , mn_lst, grp_ls
-0007a820: 742c 2067 6473 2c20 6574 732c 2065 7478  t, gds, ets, etx
-0007a830: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
-0007a840: 2020 2020 2020 2020 2020 2020 2067 6574               get
-0007a850: 5f74 7261 6e73 6372 6970 7473 2820 7267  _transcripts( rg
-0007a860: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
-0007a870: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
-0007a880: 5f73 742c 2072 645f 6c65 6e2c 205c 0a20  _st, rd_len, \. 
-0007a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a8b0: 2020 2020 2020 2020 6764 732c 206c 656e          gds, len
-0007a8c0: 5f74 682c 206d 6574 686f 642c 204e 7265  _th, method, Nre
-0007a8d0: 632c 2073 7461 7274 203d 2053 7461 7274  c, start = Start
-0007a8e0: 2c20 7665 7262 6f73 653d 5472 7565 2029  , verbose=True )
-0007a8f0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0007a900: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0007a910: 2020 2054 725f 6c73 742c 2049 735f 6c73     Tr_lst, Is_ls
-0007a920: 742c 2047 5446 5f6c 7374 2c20 6d6e 5f6c  t, GTF_lst, mn_l
-0007a930: 7374 2c20 6772 705f 6c73 742c 2067 6473  st, grp_lst, gds
-0007a940: 2c20 6574 732c 2065 7478 203d 205c 0a20  , ets, etx = \. 
-0007a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a960: 2020 2020 2020 2067 6574 5f74 7261 6e73         get_trans
-0007a970: 6372 6970 7473 5f6d 6328 2072 676e 735f  cripts_mc( rgns_
-0007a980: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
-0007a990: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
-0007a9a0: 2c20 7264 5f6c 656e 2c20 5c0a 2020 2020  , rd_len, \.    
-0007a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a9d0: 2020 2020 2020 2020 6764 732c 206e 5f63          gds, n_c
-0007a9e0: 6f72 6573 2c20 6c65 6e5f 7468 2c20 6d65  ores, len_th, me
-0007a9f0: 7468 6f64 2c20 4e72 6563 2c20 7374 6172  thod, Nrec, star
-0007aa00: 7420 3d20 5374 6172 742c 2076 6572 626f  t = Start, verbo
-0007aa10: 7365 3d54 7275 6520 290a 2020 2020 2020  se=True ).      
-0007aa20: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0007aa30: 2020 2065 7473 203d 206e 702e 6172 7261     ets = np.arra
-0007aa40: 7928 6574 732c 2064 7479 7065 203d 2069  y(ets, dtype = i
-0007aa50: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0007aa60: 6574 7820 3d20 6e70 2e61 7272 6179 2865  etx = np.array(e
-0007aa70: 7478 2c20 6474 7970 6520 3d20 696e 7429  tx, dtype = int)
-0007aa80: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-0007aa90: 7269 6e74 2827 456c 6170 6165 6420 7469  rint('Elapaed ti
-0007aaa0: 6d65 733a 2027 2c20 6574 732c 2065 7478  mes: ', ets, etx
-0007aab0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0007aac0: 6170 7365 645f 7469 6d65 3220 3d20 7469  apsed_time2 = ti
-0007aad0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-0007aae0: 745f 7469 6d65 310a 2020 2020 2020 2020  t_time1.        
-0007aaf0: 2020 2020 6e5f 6368 756e 6b73 203d 206c      n_chunks = l
-0007ab00: 656e 2872 676e 735f 6c73 745f 6d69 290a  en(rgns_lst_mi).
-0007ab10: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-0007ab20: 2072 676e 735f 6c73 745f 6d69 0a20 2020   rgns_lst_mi.   
-0007ab30: 2020 2020 2020 2020 2064 656c 2072 676e           del rgn
-0007ab40: 735f 6c73 745f 6e64 0a20 2020 2020 2020  s_lst_nd.       
-0007ab50: 2020 2020 2064 656c 2072 676e 735f 6c73       del rgns_ls
-0007ab60: 745f 7374 0a0a 2020 2020 2020 2020 2020  t_st..          
-0007ab70: 2020 2327 2727 0a20 2020 2020 2020 2020    #'''.         
-0007ab80: 2020 2069 6620 6774 6620 6973 206e 6f74     if gtf is not
-0007ab90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0007aba0: 2020 2020 2020 204e 7472 7320 3d20 300a         Ntrs = 0.
-0007abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007abc0: 4e74 7273 3220 3d20 300a 2020 2020 2020  Ntrs2 = 0.      
-0007abd0: 2020 2020 2020 2020 2020 4e74 7273 3320            Ntrs3 
-0007abe0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0007abf0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
-0007ac00: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0007ac10: 2020 2020 2020 204e 7472 7320 2b3d 2067         Ntrs += g
-0007ac20: 642e 6e74 720a 2020 2020 2020 2020 2020  d.ntr.          
-0007ac30: 2020 2020 2020 2020 2020 666f 7220 7464            for td
-0007ac40: 2069 6e20 6764 2e74 645f 6c73 743a 0a20   in gd.td_lst:. 
-0007ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ac60: 2020 2020 2020 2069 6620 6c65 6e28 7464         if len(td
-0007ac70: 2e74 655f 746f 5f67 655f 6d61 7029 203e  .te_to_ge_map) >
-0007ac80: 2030 3a20 4e74 7273 3220 2b3d 2031 0a20   0: Ntrs2 += 1. 
-0007ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007aca0: 2020 2020 2020 2069 6620 6c65 6e28 7464         if len(td
-0007acb0: 2e74 725f 746f 5f67 725f 6d61 7029 203e  .tr_to_gr_map) >
-0007acc0: 2030 3a20 4e74 7273 3320 2b3d 2031 0a0a   0: Ntrs3 += 1..
-0007acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ace0: 2020 2020 6e5f 6e65 6720 3d20 300a 2020      n_neg = 0.  
-0007acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ad00: 2020 666f 7220 7464 2069 6e20 6764 2e74    for td in gd.t
-0007ad10: 645f 6c73 743a 0a20 2020 2020 2020 2020  d_lst:.         
-0007ad20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0007ad30: 6620 7464 2e61 626e 203c 2030 3a20 6e5f  f td.abn < 0: n_
-0007ad40: 6e65 6720 2b3d 2031 0a0a 2020 2020 2020  neg += 1..      
-0007ad50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0007ad60: 2720 2020 2569 2c20 2569 2c20 2569 2028  '   %i, %i, %i (
-0007ad70: 2569 2920 7472 7320 6672 6f6d 2025 6920  %i) trs from %i 
-0007ad80: 6368 756e 636b 732f 6765 6e65 7320 2825  chuncks/genes (%
-0007ad90: 6929 2720 2520 284e 7472 732c 204e 7472  i)' % (Ntrs, Ntr
-0007ada0: 7332 2c20 4e74 7273 332c 206e 5f6e 6567  s2, Ntrs3, n_neg
-0007adb0: 2c20 6e5f 6368 756e 6b73 2c20 696e 7428  , n_chunks, int(
-0007adc0: 656c 6170 7365 645f 7469 6d65 3229 2920  elapsed_time2)) 
-0007add0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0007ade0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
-0007adf0: 2027 5f73 6125 6927 2025 2073 610a 2020   '_sa%i' % sa.  
-0007ae00: 2020 2020 2020 2020 2020 666e 616d 655f            fname_
-0007ae10: 7472 203d 2066 6e61 6d65 202b 2027 5f74  tr = fname + '_t
-0007ae20: 7261 6e73 6372 6970 746f 6d65 2e66 6127  ranscriptome.fa'
-0007ae30: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
-0007ae40: 6d65 5f70 7220 3d20 666e 616d 6520 2b20  me_pr = fname + 
-0007ae50: 275f 7072 6f74 656f 6d65 2e66 6127 0a20  '_proteome.fa'. 
-0007ae60: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-0007ae70: 5f67 6666 203d 2066 6e61 6d65 202b 2027  _gff = fname + '
-0007ae80: 2e67 6666 270a 2020 2020 2020 2020 2020  .gff'.          
-0007ae90: 2020 666e 616d 655f 6578 7020 3d20 666e    fname_exp = fn
-0007aea0: 616d 6520 2b20 275f 6578 705f 7072 6f66  ame + '_exp_prof
-0007aeb0: 696c 652e 7473 7627 0a20 2020 2020 2020  ile.tsv'.       
-0007aec0: 2020 2020 2066 6e61 6d65 5f73 6e76 203d       fname_snv =
-0007aed0: 2066 6e61 6d65 202b 2027 5f73 6e76 5f73   fname + '_snv_s
-0007aee0: 756d 6d61 7279 2e74 7376 270a 0a20 2020  ummary.tsv'..   
-0007aef0: 2020 2020 2020 2020 2069 6620 6764 7320           if gds 
-0007af00: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0007af10: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0007af20: 2020 2020 2020 2020 2020 2020 2020 745f                t_
-0007af30: 6162 6e20 3d20 300a 2020 2020 2020 2020  abn = 0.        
-0007af40: 2020 2020 2020 2020 666f 7220 6764 2069          for gd i
-0007af50: 6e20 6764 733a 0a20 2020 2020 2020 2020  n gds:.         
-0007af60: 2020 2020 2020 2020 2020 2067 642e 7365             gd.se
-0007af70: 745f 636f 765f 6e5f 6162 6e5f 7468 2820  t_cov_n_abn_th( 
-0007af80: 4d49 4e5f 434f 565f 544f 5f53 454c 2c20  MIN_COV_TO_SEL, 
-0007af90: 4d49 4e5f 4142 4e5f 544f 5f53 454c 2029  MIN_ABN_TO_SEL )
-0007afa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007afb0: 2020 2020 206e 7472 2c20 6e70 722c 206e       ntr, npr, n
-0007afc0: 6520 3d20 6764 2e75 7064 6174 655f 7464  e = gd.update_td
-0007afd0: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
-0007afe0: 2020 2020 2020 2020 2020 2020 745f 6162              t_ab
-0007aff0: 6e20 2b3d 2067 642e 6765 745f 746f 7461  n += gd.get_tota
-0007b000: 6c5f 6162 6e28 290a 2020 2020 2020 2020  l_abn().        
-0007b010: 2020 2020 2020 2020 6966 2074 5f61 626e          if t_abn
-0007b020: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0007b030: 2020 2020 2020 2020 2020 2074 5f61 626e             t_abn
-0007b040: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
-0007b050: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0007b060: 546f 7461 6c20 766f 6c75 6d65 203d 2025  Total volume = %
-0007b070: 6927 2025 2074 5f61 626e 290a 2020 2020  i' % t_abn).    
-0007b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007b0a0: 206e 6620 3d20 3130 3030 3030 302f 745f   nf = 1000000/t_
-0007b0b0: 6162 6e0a 2020 2020 2020 2020 2020 2020  abn.            
-0007b0c0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
-0007b0d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0007b0e0: 2020 2020 2020 2067 642e 7365 745f 7472         gd.set_tr
-0007b0f0: 5f69 6e66 6f28 206e 6620 290a 0a20 2020  _info( nf )..   
-0007b100: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007b110: 6764 735f 756e 6d61 7070 6564 2069 7320  gds_unmapped is 
-0007b120: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0007b130: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0007b140: 2028 4d49 4e5f 434f 565f 544f 5f53 454c   (MIN_COV_TO_SEL
-0007b150: 203d 3d20 3029 2026 2028 6c65 6e28 6764   == 0) & (len(gd
-0007b160: 735f 756e 6d61 7070 6564 2920 3e20 3029  s_unmapped) > 0)
-0007b170: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0007b180: 2020 2020 2020 2020 2020 206e 7472 203d             ntr =
-0007b190: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-0007b1a0: 2020 2020 2020 2020 2020 2066 6f72 2067             for g
-0007b1b0: 6420 696e 2067 6473 5f75 6e6d 6170 7065  d in gds_unmappe
-0007b1c0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0007b1d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0007b1e0: 7472 202b 3d20 6764 2e6e 7472 0a20 2020  tr += gd.ntr.   
-0007b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b200: 2020 2020 2020 2020 2067 642e 7365 745f           gd.set_
-0007b210: 636f 765f 6e5f 6162 6e5f 7468 2820 4d49  cov_n_abn_th( MI
-0007b220: 4e5f 434f 565f 544f 5f53 454c 2c20 4d49  N_COV_TO_SEL, MI
-0007b230: 4e5f 4142 4e5f 544f 5f53 454c 2029 0a20  N_ABN_TO_SEL ). 
-0007b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b250: 2020 2020 2020 2020 2020 2067 642e 7570             gd.up
-0007b260: 6461 7465 5f74 645f 696e 666f 2829 0a20  date_td_info(). 
-0007b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b280: 2020 2020 2020 2067 6473 203d 2067 6473         gds = gds
-0007b290: 202b 2067 6473 5f75 6e6d 6170 7065 640a   + gds_unmapped.
-0007b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b2b0: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-0007b2c0: 2020 2569 2c25 6920 756e 6d61 7070 6564    %i,%i unmapped
-0007b2d0: 2067 656e 6573 2f74 7273 2077 6572 6520   genes/trs were 
-0007b2e0: 6164 6465 642e 2720 2520 286c 656e 2867  added.' % (len(g
-0007b2f0: 6473 5f75 6e6d 6170 7065 6429 2c20 6e74  ds_unmapped), nt
-0007b300: 7229 2029 0a20 2020 2020 2020 2020 2020  r) ).           
-0007b310: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007b320: 2020 2020 2020 2020 2020 6764 7320 3d20            gds = 
-0007b330: 736f 7274 5f64 6573 6372 6970 746f 725f  sort_descriptor_
-0007b340: 6c73 7428 6764 7329 0a0a 2020 2020 2020  lst(gds)..      
-0007b350: 2020 2020 2020 2020 2020 2327 2727 0a20            #'''. 
-0007b360: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0007b370: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
-0007b380: 2e74 696d 6528 290a 2020 2020 2020 2020  .time().        
-0007b390: 2020 2020 2020 2020 7072 696e 7428 2747          print('G
-0007b3a0: 656e 6572 6174 696e 6720 696e 7465 726d  enerating interm
-0007b3b0: 6564 6961 7465 2047 4646 2061 6e64 2054  ediate GFF and T
-0007b3c0: 7261 6e73 6372 6970 746f 6d65 202e 2e20  ranscriptome .. 
-0007b3d0: 272c 2065 6e64 3d27 2020 2020 2729 0a20  ', end='    '). 
-0007b3e0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0007b3f0: 7466 5f6c 696e 6573 203d 205b 5d0a 2020  tf_lines = [].  
-0007b400: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-0007b410: 7374 615f 6c69 6e65 7320 3d20 5b5d 0a20  sta_lines = []. 
-0007b420: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007b430: 6173 7461 5f6c 696e 6573 3220 3d20 5b5d  asta_lines2 = []
-0007b440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007b450: 2063 6e74 5f6e 6f6e 6520 3d20 300a 0a20   cnt_none = 0.. 
-0007b460: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0007b470: 6472 5f6c 696e 6573 203d 205b 5d0a 2020  dr_lines = [].  
-0007b480: 2020 2020 2020 2020 2020 2020 2020 6864                hd
-0007b490: 725f 6c69 6e65 732e 6170 7065 6e64 2827  r_lines.append('
-0007b4a0: 5374 7269 6e67 4669 7820 7665 7273 696f  StringFix versio
-0007b4b0: 6e20 2573 2720 2520 5374 7269 6e67 4669  n %s' % StringFi
-0007b4c0: 785f 7665 7273 696f 6e20 290a 2020 2020  x_version ).    
-0007b4d0: 2020 2020 2020 2020 2020 2020 6864 725f              hdr_
-0007b4e0: 6c69 6e65 732e 6170 7065 6e64 2827 496e  lines.append('In
-0007b4f0: 7075 7420 5341 4d2f 4241 4d3a 2025 7327  put SAM/BAM: %s'
-0007b500: 2025 2073 616d 5f66 696c 6529 0a20 2020   % sam_file).   
-0007b510: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007b520: 6774 6620 6973 206e 6f74 204e 6f6e 653a  gtf is not None:
-0007b530: 2068 6472 5f6c 696e 6573 2e61 7070 656e   hdr_lines.appen
-0007b540: 6428 2752 6566 2e20 4754 462f 4746 463a  d('Ref. GTF/GFF:
-0007b550: 2025 7327 2025 2067 7466 290a 2020 2020   %s' % gtf).    
-0007b560: 2020 2020 2020 2020 2020 2020 6864 725f              hdr_
-0007b570: 6c69 6e65 732e 6170 7065 6e64 2827 5265  lines.append('Re
-0007b580: 6164 206c 656e 6774 683a 2025 6927 2025  ad length: %i' %
-0007b590: 2072 645f 6c65 6e29 0a20 2020 2020 2020   rd_len).       
-0007b5a0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007b5b0: 2020 2020 2020 2020 2020 665f 6774 6620            f_gtf 
-0007b5c0: 3d20 7361 7665 5f67 7466 3228 666e 616d  = save_gtf2(fnam
-0007b5d0: 655f 6766 662c 2067 7466 5f6c 696e 655f  e_gff, gtf_line_
-0007b5e0: 6c73 7420 3d20 4e6f 6e65 2c20 6864 7220  lst = None, hdr 
-0007b5f0: 3d20 6864 725f 6c69 6e65 7329 0a20 2020  = hdr_lines).   
-0007b600: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007b610: 6f75 745f 7472 3a0a 2020 2020 2020 2020  out_tr:.        
-0007b620: 2020 2020 2020 2020 2020 2020 7374 6172              star
-0007b630: 745f 7469 6d65 203d 2074 696d 652e 7469  t_time = time.ti
-0007b640: 6d65 2829 0a20 2020 2020 2020 2020 2020  me().           
-0007b650: 2020 2020 2020 2020 2066 5f74 203d 206f           f_t = o
-0007b660: 7065 6e28 666e 616d 655f 7472 2c20 2777  pen(fname_tr, 'w
-0007b670: 2b27 290a 2020 2020 2020 2020 2020 2020  +').            
-0007b680: 2020 2020 2020 2020 2320 6966 2028 6774          # if (gt
-0007b690: 6620 6973 204e 6f6e 6529 3a20 665f 7020  f is None): f_p 
-0007b6a0: 3d20 6f70 656e 2866 6e61 6d65 5f70 722c  = open(fname_pr,
-0007b6b0: 2027 772b 2729 0a0a 2020 2020 2020 2020   'w+')..        
-0007b6c0: 2020 2020 2020 2020 6966 206e 5f63 6f72          if n_cor
-0007b6d0: 6573 203d 3d20 313a 0a20 2020 2020 2020  es == 1:.       
-0007b6e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0007b6f0: 206d 2c20 6764 2069 6e20 656e 756d 6572   m, gd in enumer
-0007b700: 6174 6528 6764 7329 3a0a 2020 2020 2020  ate(gds):.      
-0007b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b720: 2020 6966 206d 2531 3030 203d 3d20 303a    if m%100 == 0:
-0007b730: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
-0007b740: 7469 6e67 2069 6e74 6572 6d65 6469 6174  ting intermediat
-0007b750: 6520 4754 4620 616e 6420 7472 616e 7363  e GTF and transc
-0007b760: 7269 7074 6f6d 6520 2e2e 2025 692f 2569  riptome .. %i/%i
-0007b770: 2720 2520 286d 2c20 6c65 6e28 6764 7329  ' % (m, len(gds)
-0007b780: 292c 2065 6e64 203d 2027 2020 2027 290a  ), end = '   ').
+0007a3f0: 2070 6172 7365 5f61 6e64 5f63 6f6d 6269   parse_and_combi
+0007a400: 6e65 5f67 656e 6573 5f61 6e64 5f72 676e  ne_genes_and_rgn
+0007a410: 7328 6764 5f6c 7374 5f6f 665f 6c73 742c  s(gd_lst_of_lst,
+0007a420: 2063 6872 5f6c 7374 2c20 7267 6e73 5f6c   chr_lst, rgns_l
+0007a430: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
+0007a440: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
+0007a450: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0007a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a480: 2020 2020 2020 2020 6e5f 636f 7265 7320          n_cores 
+0007a490: 3d20 6e5f 636f 7265 732c 2067 656e 6f6d  = n_cores, genom
+0007a4a0: 6520 3d20 6765 6e6f 6d65 2c20 7665 7262  e = genome, verb
+0007a4b0: 6f73 6520 3d20 5472 7565 2029 0a0a 2020  ose = True )..  
+0007a4c0: 2020 2020 2020 2020 2020 2020 2020 2327                #'
+0007a4d0: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+0007a4e0: 2020 204e 7472 7320 3d20 300a 2020 2020     Ntrs = 0.    
+0007a4f0: 2020 2020 2020 2020 2020 2020 4e74 7273              Ntrs
+0007a500: 3220 3d20 300a 2020 2020 2020 2020 2020  2 = 0.          
+0007a510: 2020 2020 2020 666f 7220 6764 2069 6e20        for gd in 
+0007a520: 6764 733a 0a20 2020 2020 2020 2020 2020  gds:.           
+0007a530: 2020 2020 2020 2020 204e 7472 7320 2b3d           Ntrs +=
+0007a540: 2067 642e 6e74 720a 2020 2020 2020 2020   gd.ntr.        
+0007a550: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0007a560: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
+0007a570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a580: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0007a590: 7464 2e74 655f 746f 5f67 655f 6d61 7029  td.te_to_ge_map)
+0007a5a0: 203e 2030 3a20 4e74 7273 3220 2b3d 2031   > 0: Ntrs2 += 1
+0007a5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a5c0: 2070 7269 6e74 2827 4e74 7273 203d 2025   print('Ntrs = %
+0007a5d0: 692c 2025 6920 2720 2520 284e 7472 732c  i, %i ' % (Ntrs,
+0007a5e0: 204e 7472 7332 2920 290a 2020 2020 2020   Ntrs2) ).      
+0007a5f0: 2020 2020 2020 2020 2020 2327 2727 0a20            #'''. 
+0007a600: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0007a610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a620: 2067 6473 203d 204e 6f6e 650a 2020 2020   gds = None.    
+0007a630: 2020 2020 2020 2020 2020 2020 6764 735f              gds_
+0007a640: 756e 6d61 7070 6564 203d 204e 6f6e 650a  unmapped = None.
+0007a650: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0007a660: 2020 2020 2020 2020 2023 2069 6620 7361           # if sa
+0007a670: 765f 7267 6e3a 0a20 2020 2020 2020 2020  v_rgn:.         
+0007a680: 2020 2023 2020 2020 2073 6176 655f 7267     #     save_rg
+0007a690: 6e73 5f6f 626a 2866 6e61 6d65 202b 2027  ns_obj(fname + '
+0007a6a0: 5f73 656c 6563 7465 642e 7267 6e73 272c  _selected.rgns',
+0007a6b0: 2072 676e 735f 6c73 745f 6d69 2c20 7267   rgns_lst_mi, rg
+0007a6c0: 6e73 5f6c 7374 5f6e 642c 2072 676e 735f  ns_lst_nd, rgns_
+0007a6d0: 6c73 745f 7374 2c20 7264 5f6c 656e 2c20  lst_st, rd_len, 
+0007a6e0: 6e5f 7265 6164 7320 290a 2020 2020 2020  n_reads ).      
+0007a6f0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0007a700: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
+0007a710: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0007a720: 2020 2020 5472 5f6c 7374 2c20 4973 5f6c      Tr_lst, Is_l
+0007a730: 7374 2c20 4754 465f 6c73 742c 206d 6e5f  st, GTF_lst, mn_
+0007a740: 6c73 742c 2067 7270 5f6c 7374 2c20 6764  lst, grp_lst, gd
+0007a750: 732c 2065 7473 2c20 6574 7820 3d20 5c0a  s, ets, etx = \.
+0007a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a770: 2020 2020 2020 2020 6765 745f 7472 616e          get_tran
+0007a780: 7363 7269 7074 7328 2072 676e 735f 6c73  scripts( rgns_ls
+0007a790: 745f 6d69 2c20 7267 6e73 5f6c 7374 5f6e  t_mi, rgns_lst_n
+0007a7a0: 642c 2072 676e 735f 6c73 745f 7374 2c20  d, rgns_lst_st, 
+0007a7b0: 7264 5f6c 656e 2c20 5c0a 2020 2020 2020  rd_len, \.      
+0007a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a7e0: 2020 2067 6473 2c20 6c65 6e5f 7468 2c20     gds, len_th, 
+0007a7f0: 6d65 7468 6f64 2c20 4e72 6563 2c20 7374  method, Nrec, st
+0007a800: 6172 7420 3d20 5374 6172 742c 2076 6572  art = Start, ver
+0007a810: 626f 7365 3d54 7275 6520 290a 2020 2020  bose=True ).    
+0007a820: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0007a830: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
+0007a840: 5f6c 7374 2c20 4973 5f6c 7374 2c20 4754  _lst, Is_lst, GT
+0007a850: 465f 6c73 742c 206d 6e5f 6c73 742c 2067  F_lst, mn_lst, g
+0007a860: 7270 5f6c 7374 2c20 6764 732c 2065 7473  rp_lst, gds, ets
+0007a870: 2c20 6574 7820 3d20 5c0a 2020 2020 2020  , etx = \.      
+0007a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a890: 2020 6765 745f 7472 616e 7363 7269 7074    get_transcript
+0007a8a0: 735f 6d63 2820 7267 6e73 5f6c 7374 5f6d  s_mc( rgns_lst_m
+0007a8b0: 692c 2072 676e 735f 6c73 745f 6e64 2c20  i, rgns_lst_nd, 
+0007a8c0: 7267 6e73 5f6c 7374 5f73 742c 2072 645f  rgns_lst_st, rd_
+0007a8d0: 6c65 6e2c 205c 0a20 2020 2020 2020 2020  len, \.         
+0007a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a900: 2020 2067 6473 2c20 6e5f 636f 7265 732c     gds, n_cores,
+0007a910: 206c 656e 5f74 682c 206d 6574 686f 642c   len_th, method,
+0007a920: 204e 7265 632c 2073 7461 7274 203d 2053   Nrec, start = S
+0007a930: 7461 7274 2c20 7665 7262 6f73 653d 5472  tart, verbose=Tr
+0007a940: 7565 2029 0a20 2020 2020 2020 2020 2020  ue ).           
+0007a950: 200a 2020 2020 2020 2020 2020 2020 6574   .            et
+0007a960: 7320 3d20 6e70 2e61 7272 6179 2865 7473  s = np.array(ets
+0007a970: 2c20 6474 7970 6520 3d20 696e 7429 0a20  , dtype = int). 
+0007a980: 2020 2020 2020 2020 2020 2065 7478 203d             etx =
+0007a990: 206e 702e 6172 7261 7928 6574 782c 2064   np.array(etx, d
+0007a9a0: 7479 7065 203d 2069 6e74 290a 2020 2020  type = int).    
+0007a9b0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+0007a9c0: 2745 6c61 7061 6564 2074 696d 6573 3a20  'Elapaed times: 
+0007a9d0: 272c 2065 7473 2c20 6574 7829 0a20 2020  ', ets, etx).   
+0007a9e0: 2020 2020 2020 2020 2065 6c61 7073 6564           elapsed
+0007a9f0: 5f74 696d 6532 203d 2074 696d 652e 7469  _time2 = time.ti
+0007aa00: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
+0007aa10: 6531 0a20 2020 2020 2020 2020 2020 206e  e1.            n
+0007aa20: 5f63 6875 6e6b 7320 3d20 6c65 6e28 7267  _chunks = len(rg
+0007aa30: 6e73 5f6c 7374 5f6d 6929 0a0a 2020 2020  ns_lst_mi)..    
+0007aa40: 2020 2020 2020 2020 6465 6c20 7267 6e73          del rgns
+0007aa50: 5f6c 7374 5f6d 690a 2020 2020 2020 2020  _lst_mi.        
+0007aa60: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
+0007aa70: 5f6e 640a 2020 2020 2020 2020 2020 2020  _nd.            
+0007aa80: 6465 6c20 7267 6e73 5f6c 7374 5f73 740a  del rgns_lst_st.
+0007aa90: 0a20 2020 2020 2020 2020 2020 2023 2727  .            #''
+0007aaa0: 270a 2020 2020 2020 2020 2020 2020 6966  '.            if
+0007aab0: 2067 7466 2069 7320 6e6f 7420 4e6f 6e65   gtf is not None
+0007aac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007aad0: 2020 4e74 7273 203d 2030 0a20 2020 2020    Ntrs = 0.     
+0007aae0: 2020 2020 2020 2020 2020 204e 7472 7332             Ntrs2
+0007aaf0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0007ab00: 2020 2020 204e 7472 7333 203d 2030 0a20       Ntrs3 = 0. 
+0007ab10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007ab20: 6f72 2067 6420 696e 2067 6473 3a0a 2020  or gd in gds:.  
+0007ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ab40: 2020 4e74 7273 202b 3d20 6764 2e6e 7472    Ntrs += gd.ntr
+0007ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007ab60: 2020 2020 2066 6f72 2074 6420 696e 2067       for td in g
+0007ab70: 642e 7464 5f6c 7374 3a0a 2020 2020 2020  d.td_lst:.      
+0007ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ab90: 2020 6966 206c 656e 2874 642e 7465 5f74    if len(td.te_t
+0007aba0: 6f5f 6765 5f6d 6170 2920 3e20 303a 204e  o_ge_map) > 0: N
+0007abb0: 7472 7332 202b 3d20 310a 2020 2020 2020  trs2 += 1.      
+0007abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007abd0: 2020 6966 206c 656e 2874 642e 7472 5f74    if len(td.tr_t
+0007abe0: 6f5f 6772 5f6d 6170 2920 3e20 303a 204e  o_gr_map) > 0: N
+0007abf0: 7472 7333 202b 3d20 310a 0a20 2020 2020  trs3 += 1..     
+0007ac00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0007ac10: 5f6e 6567 203d 2030 0a20 2020 2020 2020  _neg = 0.       
+0007ac20: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0007ac30: 2074 6420 696e 2067 642e 7464 5f6c 7374   td in gd.td_lst
+0007ac40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007ac50: 2020 2020 2020 2020 2020 6966 2074 642e            if td.
+0007ac60: 6162 6e20 3c20 303a 206e 5f6e 6567 202b  abn < 0: n_neg +
+0007ac70: 3d20 310a 0a20 2020 2020 2020 2020 2020  = 1..           
+0007ac80: 2020 2020 2070 7269 6e74 2827 2020 2025       print('   %
+0007ac90: 692c 2025 692c 2025 6920 2825 6929 2074  i, %i, %i (%i) t
+0007aca0: 7273 2066 726f 6d20 2569 2063 6875 6e63  rs from %i chunc
+0007acb0: 6b73 2f67 656e 6573 2028 2569 2927 2025  ks/genes (%i)' %
+0007acc0: 2028 4e74 7273 2c20 4e74 7273 322c 204e   (Ntrs, Ntrs2, N
+0007acd0: 7472 7333 2c20 6e5f 6e65 672c 206e 5f63  trs3, n_neg, n_c
+0007ace0: 6875 6e6b 732c 2069 6e74 2865 6c61 7073  hunks, int(elaps
+0007acf0: 6564 5f74 696d 6532 2929 2029 0a0a 2020  ed_time2)) )..  
+0007ad00: 2020 2020 2020 2020 2020 2320 666e 616d            # fnam
+0007ad10: 6520 3d20 666e 616d 6520 2b20 275f 7361  e = fname + '_sa
+0007ad20: 2569 2720 2520 7361 0a20 2020 2020 2020  %i' % sa.       
+0007ad30: 2020 2020 2066 6e61 6d65 5f74 7220 3d20       fname_tr = 
+0007ad40: 666e 616d 6520 2b20 275f 7472 616e 7363  fname + '_transc
+0007ad50: 7269 7074 6f6d 652e 6661 270a 2020 2020  riptome.fa'.    
+0007ad60: 2020 2020 2020 2020 666e 616d 655f 7072          fname_pr
+0007ad70: 203d 2066 6e61 6d65 202b 2027 5f70 726f   = fname + '_pro
+0007ad80: 7465 6f6d 652e 6661 270a 2020 2020 2020  teome.fa'.      
+0007ad90: 2020 2020 2020 666e 616d 655f 6766 6620        fname_gff 
+0007ada0: 3d20 666e 616d 6520 2b20 272e 6766 6627  = fname + '.gff'
+0007adb0: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
+0007adc0: 6d65 5f65 7870 203d 2066 6e61 6d65 202b  me_exp = fname +
+0007add0: 2027 5f65 7870 5f70 726f 6669 6c65 2e74   '_exp_profile.t
+0007ade0: 7376 270a 2020 2020 2020 2020 2020 2020  sv'.            
+0007adf0: 666e 616d 655f 736e 7620 3d20 666e 616d  fname_snv = fnam
+0007ae00: 6520 2b20 275f 736e 765f 7375 6d6d 6172  e + '_snv_summar
+0007ae10: 792e 7473 7627 0a0a 2020 2020 2020 2020  y.tsv'..        
+0007ae20: 2020 2020 6966 2067 6473 2069 7320 6e6f      if gds is no
+0007ae30: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0007ae40: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0007ae50: 2020 2020 2020 2020 2074 5f61 626e 203d           t_abn =
+0007ae60: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+0007ae70: 2020 2066 6f72 2067 6420 696e 2067 6473     for gd in gds
+0007ae80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007ae90: 2020 2020 2020 6764 2e73 6574 5f63 6f76        gd.set_cov
+0007aea0: 5f6e 5f61 626e 5f74 6828 204d 494e 5f43  _n_abn_th( MIN_C
+0007aeb0: 4f56 5f54 4f5f 5345 4c2c 204d 494e 5f41  OV_TO_SEL, MIN_A
+0007aec0: 424e 5f54 4f5f 5345 4c20 290a 2020 2020  BN_TO_SEL ).    
+0007aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007aee0: 6e74 722c 206e 7072 2c20 6e65 203d 2067  ntr, npr, ne = g
+0007aef0: 642e 7570 6461 7465 5f74 645f 696e 666f  d.update_td_info
+0007af00: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0007af10: 2020 2020 2020 2074 5f61 626e 202b 3d20         t_abn += 
+0007af20: 6764 2e67 6574 5f74 6f74 616c 5f61 626e  gd.get_total_abn
+0007af30: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0007af40: 2020 2069 6620 745f 6162 6e20 3d3d 2030     if t_abn == 0
+0007af50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007af60: 2020 2020 2020 745f 6162 6e20 3d20 310a        t_abn = 1.
+0007af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007af80: 2020 2020 7072 696e 7428 2754 6f74 616c      print('Total
+0007af90: 2076 6f6c 756d 6520 3d20 2569 2720 2520   volume = %i' % 
+0007afa0: 745f 6162 6e29 0a20 2020 2020 2020 2020  t_abn).         
+0007afb0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0007afc0: 2020 2020 2020 2020 2020 2020 6e66 203d              nf =
+0007afd0: 2031 3030 3030 3030 2f74 5f61 626e 0a20   1000000/t_abn. 
+0007afe0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007aff0: 6f72 2067 6420 696e 2067 6473 3a0a 2020  or gd in gds:.  
+0007b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b010: 2020 6764 2e73 6574 5f74 725f 696e 666f    gd.set_tr_info
+0007b020: 2820 6e66 2029 0a0a 2020 2020 2020 2020  ( nf )..        
+0007b030: 2020 2020 2020 2020 6966 2067 6473 5f75          if gds_u
+0007b040: 6e6d 6170 7065 6420 6973 206e 6f74 204e  nmapped is not N
+0007b050: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0007b060: 2020 2020 2020 2020 2069 6620 284d 494e           if (MIN
+0007b070: 5f43 4f56 5f54 4f5f 5345 4c20 3d3d 2030  _COV_TO_SEL == 0
+0007b080: 2920 2620 286c 656e 2867 6473 5f75 6e6d  ) & (len(gds_unm
+0007b090: 6170 7065 6429 203e 2030 293a 200a 2020  apped) > 0): .  
+0007b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b0b0: 2020 2020 2020 6e74 7220 3d20 300a 2020        ntr = 0.  
+0007b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b0d0: 2020 2020 2020 666f 7220 6764 2069 6e20        for gd in 
+0007b0e0: 6764 735f 756e 6d61 7070 6564 3a0a 2020  gds_unmapped:.  
+0007b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b100: 2020 2020 2020 2020 2020 6e74 7220 2b3d            ntr +=
+0007b110: 2067 642e 6e74 720a 2020 2020 2020 2020   gd.ntr.        
+0007b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b130: 2020 2020 6764 2e73 6574 5f63 6f76 5f6e      gd.set_cov_n
+0007b140: 5f61 626e 5f74 6828 204d 494e 5f43 4f56  _abn_th( MIN_COV
+0007b150: 5f54 4f5f 5345 4c2c 204d 494e 5f41 424e  _TO_SEL, MIN_ABN
+0007b160: 5f54 4f5f 5345 4c20 290a 2020 2020 2020  _TO_SEL ).      
+0007b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b180: 2020 2020 2020 6764 2e75 7064 6174 655f        gd.update_
+0007b190: 7464 5f69 6e66 6f28 290a 2020 2020 2020  td_info().      
+0007b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b1b0: 2020 6764 7320 3d20 6764 7320 2b20 6764    gds = gds + gd
+0007b1c0: 735f 756e 6d61 7070 6564 0a20 2020 2020  s_unmapped.     
+0007b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b1e0: 2020 2070 7269 6e74 2827 2020 2025 692c     print('   %i,
+0007b1f0: 2569 2075 6e6d 6170 7065 6420 6765 6e65  %i unmapped gene
+0007b200: 732f 7472 7320 7765 7265 2061 6464 6564  s/trs were added
+0007b210: 2e27 2025 2028 6c65 6e28 6764 735f 756e  .' % (len(gds_un
+0007b220: 6d61 7070 6564 292c 206e 7472 2920 290a  mapped), ntr) ).
+0007b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b240: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007b250: 2020 2020 2067 6473 203d 2073 6f72 745f       gds = sort_
+0007b260: 6465 7363 7269 7074 6f72 5f6c 7374 2867  descriptor_lst(g
+0007b270: 6473 290a 0a20 2020 2020 2020 2020 2020  ds)..           
+0007b280: 2020 2020 2023 2727 270a 2020 2020 2020       #'''.      
+0007b290: 2020 2020 2020 2020 2020 7374 6172 745f            start_
+0007b2a0: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+0007b2b0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0007b2c0: 2020 2070 7269 6e74 2827 4765 6e65 7261     print('Genera
+0007b2d0: 7469 6e67 2069 6e74 6572 6d65 6469 6174  ting intermediat
+0007b2e0: 6520 4746 4620 616e 6420 5472 616e 7363  e GFF and Transc
+0007b2f0: 7269 7074 6f6d 6520 2e2e 2027 2c20 656e  riptome .. ', en
+0007b300: 643d 2720 2020 2027 290a 2020 2020 2020  d='    ').      
+0007b310: 2020 2020 2020 2020 2020 6774 665f 6c69            gtf_li
+0007b320: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
+0007b330: 2020 2020 2020 2020 2066 6173 7461 5f6c           fasta_l
+0007b340: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
+0007b350: 2020 2020 2020 2020 2020 6661 7374 615f            fasta_
+0007b360: 6c69 6e65 7332 203d 205b 5d0a 2020 2020  lines2 = [].    
+0007b370: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+0007b380: 6e6f 6e65 203d 2030 0a0a 2020 2020 2020  none = 0..      
+0007b390: 2020 2020 2020 2020 2020 6864 725f 6c69            hdr_li
+0007b3a0: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
+0007b3b0: 2020 2020 2020 2020 2068 6472 5f6c 696e           hdr_lin
+0007b3c0: 6573 2e61 7070 656e 6428 2753 7472 696e  es.append('Strin
+0007b3d0: 6746 6978 2076 6572 7369 6f6e 2025 7327  gFix version %s'
+0007b3e0: 2025 2053 7472 696e 6746 6978 5f76 6572   % StringFix_ver
+0007b3f0: 7369 6f6e 2029 0a20 2020 2020 2020 2020  sion ).         
+0007b400: 2020 2020 2020 2068 6472 5f6c 696e 6573         hdr_lines
+0007b410: 2e61 7070 656e 6428 2749 6e70 7574 2053  .append('Input S
+0007b420: 414d 2f42 414d 3a20 2573 2720 2520 7361  AM/BAM: %s' % sa
+0007b430: 6d5f 6669 6c65 290a 2020 2020 2020 2020  m_file).        
+0007b440: 2020 2020 2020 2020 6966 2067 7466 2069          if gtf i
+0007b450: 7320 6e6f 7420 4e6f 6e65 3a20 6864 725f  s not None: hdr_
+0007b460: 6c69 6e65 732e 6170 7065 6e64 2827 5265  lines.append('Re
+0007b470: 662e 2047 5446 2f47 4646 3a20 2573 2720  f. GTF/GFF: %s' 
+0007b480: 2520 6774 6629 0a20 2020 2020 2020 2020  % gtf).         
+0007b490: 2020 2020 2020 2068 6472 5f6c 696e 6573         hdr_lines
+0007b4a0: 2e61 7070 656e 6428 2752 6561 6420 6c65  .append('Read le
+0007b4b0: 6e67 7468 3a20 2569 2720 2520 7264 5f6c  ngth: %i' % rd_l
+0007b4c0: 656e 290a 2020 2020 2020 2020 2020 2020  en).            
+0007b4d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007b4e0: 2020 2020 2066 5f67 7466 203d 2073 6176       f_gtf = sav
+0007b4f0: 655f 6774 6632 2866 6e61 6d65 5f67 6666  e_gtf2(fname_gff
+0007b500: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
+0007b510: 204e 6f6e 652c 2068 6472 203d 2068 6472   None, hdr = hdr
+0007b520: 5f6c 696e 6573 290a 2020 2020 2020 2020  _lines).        
+0007b530: 2020 2020 2020 2020 6966 206f 7574 5f74          if out_t
+0007b540: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0007b550: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
+0007b560: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
+0007b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b580: 2020 2020 665f 7420 3d20 6f70 656e 2866      f_t = open(f
+0007b590: 6e61 6d65 5f74 722c 2027 772b 2729 0a20  name_tr, 'w+'). 
+0007b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b5b0: 2020 2023 2069 6620 2867 7466 2069 7320     # if (gtf is 
+0007b5c0: 4e6f 6e65 293a 2066 5f70 203d 206f 7065  None): f_p = ope
+0007b5d0: 6e28 666e 616d 655f 7072 2c20 2777 2b27  n(fname_pr, 'w+'
+0007b5e0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0007b5f0: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
+0007b600: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0007b610: 2020 2020 2020 2020 666f 7220 6d2c 2067          for m, g
+0007b620: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
+0007b630: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
+0007b640: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007b650: 6d25 3130 3020 3d3d 2030 3a20 7072 696e  m%100 == 0: prin
+0007b660: 7428 275c 7247 656e 6572 6174 696e 6720  t('\rGenerating 
+0007b670: 696e 7465 726d 6564 6961 7465 2047 5446  intermediate GTF
+0007b680: 2061 6e64 2074 7261 6e73 6372 6970 746f   and transcripto
+0007b690: 6d65 202e 2e20 2569 2f25 6927 2025 2028  me .. %i/%i' % (
+0007b6a0: 6d2c 206c 656e 2867 6473 2929 2c20 656e  m, len(gds)), en
+0007b6b0: 6420 3d20 2720 2020 2729 0a20 2020 2020  d = '   ').     
+0007b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b6d0: 2020 2023 206e 7472 2c20 6e70 722c 206e     # ntr, npr, n
+0007b6e0: 6520 3d20 6764 2e75 7064 6174 655f 7464  e = gd.update_td
+0007b6f0: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
+0007b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b710: 6774 666c 2c20 636e 203d 2067 642e 6765  gtfl, cn = gd.ge
+0007b720: 745f 6774 665f 6c69 6e65 735f 6672 6f6d  t_gtf_lines_from
+0007b730: 5f65 786f 6e73 2829 0a20 2020 2020 2020  _exons().       
+0007b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b750: 2066 5f67 7466 203d 2073 6176 655f 6774   f_gtf = save_gt
+0007b760: 6632 2866 6e61 6d65 5f67 6666 2c20 6774  f2(fname_gff, gt
+0007b770: 665f 6c69 6e65 5f6c 7374 203d 2067 7466  f_line_lst = gtf
+0007b780: 6c2c 2066 6f20 3d20 665f 6774 6629 0a0a  l, fo = f_gtf)..
 0007b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b7a0: 2020 2020 2020 2020 2320 6e74 722c 206e          # ntr, n
-0007b7b0: 7072 2c20 6e65 203d 2067 642e 7570 6461  pr, ne = gd.upda
-0007b7c0: 7465 5f74 645f 696e 666f 2829 0a20 2020  te_td_info().   
-0007b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b7e0: 2020 2020 2067 7466 6c2c 2063 6e20 3d20       gtfl, cn = 
-0007b7f0: 6764 2e67 6574 5f67 7466 5f6c 696e 6573  gd.get_gtf_lines
-0007b800: 5f66 726f 6d5f 6578 6f6e 7328 290a 2020  _from_exons().  
-0007b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b820: 2020 2020 2020 665f 6774 6620 3d20 7361        f_gtf = sa
-0007b830: 7665 5f67 7466 3228 666e 616d 655f 6766  ve_gtf2(fname_gf
-0007b840: 662c 2067 7466 5f6c 696e 655f 6c73 7420  f, gtf_line_lst 
-0007b850: 3d20 6774 666c 2c20 666f 203d 2066 5f67  = gtfl, fo = f_g
-0007b860: 7466 290a 0a20 2020 2020 2020 2020 2020  tf)..           
-0007b870: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
-0007b880: 5f6e 6f6e 6520 2b3d 2063 6e0a 2020 2020  _none += cn.    
-0007b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b8a0: 2020 2020 6966 206f 7574 5f74 723a 0a20      if out_tr:. 
-0007b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b8c0: 2020 2020 2020 2020 2020 206c 312c 206c             l1, l
-0007b8d0: 3220 3d20 6764 2e67 6574 5f66 6173 7461  2 = gd.get_fasta
-0007b8e0: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
-0007b8f0: 7328 7065 7074 6964 6520 3d20 4661 6c73  s(peptide = Fals
-0007b900: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0007b910: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007b920: 5f74 2e77 7269 7465 6c69 6e65 7328 2727  _t.writelines(''
-0007b930: 2e6a 6f69 6e28 6c31 2929 0a20 2020 2020  .join(l1)).     
-0007b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b950: 2020 2020 2020 2023 2069 6620 2867 7466         # if (gtf
-0007b960: 2069 7320 4e6f 6e65 293a 2066 5f70 2e77   is None): f_p.w
-0007b970: 7269 7465 6c69 6e65 7328 2727 2e6a 6f69  ritelines(''.joi
-0007b980: 6e28 6c32 2929 0a20 2020 2020 2020 2020  n(l2)).         
-0007b990: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0007b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b9b0: 206e 756d 5f63 6f72 6520 3d20 6d69 6e28   num_core = min(
-0007b9c0: 206e 5f63 6f72 6573 2c20 2863 7075 5f63   n_cores, (cpu_c
-0007b9d0: 6f75 6e74 2829 202d 2031 2920 290a 2020  ount() - 1) ).  
-0007b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b9f0: 2020 706f 6f6c 203d 2050 6f6f 6c28 6e75    pool = Pool(nu
-0007ba00: 6d5f 636f 7265 290a 2020 2020 2020 2020  m_core).        
-0007ba10: 2020 2020 2020 2020 2020 2020 6d20 3d20              m = 
-0007ba20: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-0007ba30: 2020 2020 2020 666f 7220 6774 666c 2c20        for gtfl, 
-0007ba40: 6c31 2c20 6c32 2c20 6e65 2c20 636e 2069  l1, l2, ne, cn i
-0007ba50: 6e20 706f 6f6c 2e6d 6170 286d 635f 636f  n pool.map(mc_co
-0007ba60: 7265 5f67 6574 5f67 7466 5f61 6e64 5f66  re_get_gtf_and_f
-0007ba70: 6173 7461 5f70 662c 2067 6473 293a 0a20  asta_pf, gds):. 
-0007ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ba90: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0007baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bab0: 6966 206d 2531 3030 203d 3d20 303a 2070  if m%100 == 0: p
-0007bac0: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
-0007bad0: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
-0007bae0: 4754 4620 616e 6420 7472 616e 7363 7269  GTF and transcri
-0007baf0: 7074 6f6d 6520 2e2e 2025 692f 2569 2720  ptome .. %i/%i' 
-0007bb00: 2520 286d 2c20 6c65 6e28 6764 7329 292c  % (m, len(gds)),
-0007bb10: 2065 6e64 203d 2027 2020 2027 290a 2020   end = '   ').  
-0007bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bb30: 2020 2020 2020 6d20 2b3d 2031 0a20 2020        m += 1.   
-0007bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bb50: 2020 2020 2066 5f67 7466 203d 2073 6176       f_gtf = sav
-0007bb60: 655f 6774 6632 2866 6e61 6d65 5f67 6666  e_gtf2(fname_gff
-0007bb70: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
-0007bb80: 2067 7466 6c2c 2066 6f20 3d20 665f 6774   gtfl, fo = f_gt
-0007bb90: 6629 0a0a 2020 2020 2020 2020 2020 2020  f)..            
-0007bba0: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-0007bbb0: 6e6f 6e65 202b 3d20 636e 0a20 2020 2020  none += cn.     
-0007bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bbd0: 2020 2069 6620 6f75 745f 7472 3a0a 2020     if out_tr:.  
-0007bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bbf0: 2020 2020 2020 2020 2020 665f 742e 7772            f_t.wr
-0007bc00: 6974 656c 696e 6573 2827 272e 6a6f 696e  itelines(''.join
-0007bc10: 286c 3129 290a 2020 2020 2020 2020 2020  (l1)).          
-0007bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bc30: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0007bc40: 2020 2020 2020 2070 6f6f 6c2e 636c 6f73         pool.clos
-0007bc50: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0007bc60: 2020 2020 2020 2020 706f 6f6c 2e6a 6f69          pool.joi
-0007bc70: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
-0007bc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007bc90: 2073 6176 655f 6774 6632 2866 6e61 6d65   save_gtf2(fname
-0007bca0: 5f67 6666 2c20 6774 665f 6c69 6e65 5f6c  _gff, gtf_line_l
-0007bcb0: 7374 203d 204e 6f6e 652c 2066 6f20 3d20  st = None, fo = 
-0007bcc0: 665f 6774 662c 2063 6c6f 7365 203d 2054  f_gtf, close = T
-0007bcd0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0007bce0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0007bcf0: 2020 2020 2020 6966 206f 7574 5f74 723a        if out_tr:
-0007bd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007bd10: 2020 2020 2066 5f74 2e63 6c6f 7365 2829       f_t.close()
-0007bd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007bd30: 2020 2020 2023 2069 6620 2867 7466 2069       # if (gtf i
-0007bd40: 7320 4e6f 6e65 293a 2066 5f70 2e63 6c6f  s None): f_p.clo
-0007bd50: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
-0007bd60: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007bd70: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
-0007bd80: 645f 7469 6d65 3220 3d20 7469 6d65 2e74  d_time2 = time.t
-0007bd90: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
-0007bda0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0007bdb0: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
-0007bdc0: 7261 7469 6e67 2069 6e74 6572 6d65 6469  rating intermedi
-0007bdd0: 6174 6520 4754 4620 616e 6420 7472 616e  ate GTF and tran
-0007bde0: 7363 7269 7074 6f6d 6520 2e2e 2025 692c  scriptome .. %i,
-0007bdf0: 2025 692c 2025 6920 646f 6e65 2028 2569   %i, %i done (%i
-0007be00: 2920 2027 205c 0a20 2020 2020 2020 2020  )  ' \.         
-0007be10: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-0007be20: 286c 656e 2866 6173 7461 5f6c 696e 6573  (len(fasta_lines
-0007be30: 292f 322c 206c 656e 2867 6473 292c 2063  )/2, len(gds), c
-0007be40: 6e74 5f6e 6f6e 652c 2065 6c61 7073 6564  nt_none, elapsed
-0007be50: 5f74 696d 6532 2929 0a20 2020 2020 2020  _time2)).       
-0007be60: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007be70: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
-0007be80: 645f 7469 6d65 3320 3d20 7469 6d65 2e74  d_time3 = time.t
-0007be90: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
-0007bea0: 6d65 0a0a 2020 2020 2020 2020 2020 2020  me..            
-0007beb0: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
-0007bec0: 2028 2569 2927 2025 2028 666e 616d 655f   (%i)' % (fname_
-0007bed0: 6766 662c 2065 6c61 7073 6564 5f74 696d  gff, elapsed_tim
-0007bee0: 6533 2920 290a 0a20 2020 2020 2020 2020  e3) )..         
-0007bef0: 2020 2020 2020 2069 6620 5472 7565 3a20         if True: 
-0007bf00: 2320 2867 656e 6f6d 655f 6669 6c65 2069  # (genome_file i
-0007bf10: 7320 4e6f 6e65 2920 2620 2867 7466 2069  s None) & (gtf i
-0007bf20: 7320 4e6f 6e65 290a 0a20 2020 2020 2020  s None)..       
-0007bf30: 2020 2020 2020 2020 2020 2020 206e 765f               nv_
-0007bf40: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
-0007bf50: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0007bf60: 2067 6420 696e 2067 6473 3a0a 2020 2020   gd in gds:.    
-0007bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bf80: 2020 2020 6764 2e66 696e 645f 736e 705f      gd.find_snp_
-0007bf90: 6672 6f6d 5f72 676e 7328 290a 2020 2020  from_rgns().    
-0007bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bfb0: 2020 2020 6e76 5f6c 7374 203d 206e 765f      nv_lst = nv_
-0007bfc0: 6c73 7420 2b20 6764 2e67 6574 5f67 656e  lst + gd.get_gen
-0007bfd0: 655f 6c65 7665 6c5f 6e76 5f69 6e66 6f28  e_level_nv_info(
-0007bfe0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007bff0: 2020 2020 2020 2064 6620 3d20 7064 2e44         df = pd.D
-0007c000: 6174 6146 7261 6d65 286e 765f 6c73 7429  ataFrame(nv_lst)
-0007c010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c020: 2020 2020 2064 665f 736e 7620 3d20 6466       df_snv = df
-0007c030: 5b5b 2763 6872 272c 2027 706f 735f 7265  [['chr', 'pos_re
-0007c040: 6627 2c20 2772 6566 5f73 6571 272c 2027  f', 'ref_seq', '
-0007c050: 616c 745f 7365 7127 2c20 2763 7667 5f64  alt_seq', 'cvg_d
-0007c060: 6570 7468 272c 2027 6376 675f 6672 6163  epth', 'cvg_frac
-0007c070: 272c 2027 765f 7479 7065 272c 2027 765f  ', 'v_type', 'v_
-0007c080: 6c65 6e27 2c20 2776 5f63 6c61 7373 272c  len', 'v_class',
-0007c090: 2027 765f 636c 6173 735f 7472 275d 5d0a   'v_class_tr']].
-0007c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c0b0: 2020 2020 6466 5f73 6e76 2e74 6f5f 6373      df_snv.to_cs
-0007c0c0: 7628 666e 616d 655f 736e 762c 2073 6570  v(fname_snv, sep
-0007c0d0: 3d27 5c74 2729 0a20 2020 2020 2020 2020  ='\t').         
-0007c0e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0007c0f0: 2827 534e 5620 7375 6d6d 6172 7920 7361  ('SNV summary sa
-0007c100: 7665 6420 746f 205c 6e20 2020 2573 2720  ved to \n   %s' 
-0007c110: 2520 666e 616d 655f 736e 7629 0a20 2020  % fname_snv).   
-0007c120: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0007c130: 2020 2020 2020 2020 2020 2020 2020 7464                td
-0007c140: 5f65 7870 5f69 6e66 6f20 3d20 5b5d 0a20  _exp_info = []. 
-0007c150: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007c160: 6f72 206d 2c20 6764 2069 6e20 656e 756d  or m, gd in enum
-0007c170: 6572 6174 6528 6764 7329 3a0a 2020 2020  erate(gds):.    
+0007b7a0: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
+0007b7b0: 202b 3d20 636e 0a20 2020 2020 2020 2020   += cn.         
+0007b7c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0007b7d0: 6620 6f75 745f 7472 3a0a 2020 2020 2020  f out_tr:.      
+0007b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b7f0: 2020 2020 2020 6c31 2c20 6c32 203d 2067        l1, l2 = g
+0007b800: 642e 6765 745f 6661 7374 615f 6c69 6e65  d.get_fasta_line
+0007b810: 735f 6672 6f6d 5f65 786f 6e73 2870 6570  s_from_exons(pep
+0007b820: 7469 6465 203d 2046 616c 7365 290a 2020  tide = False).  
+0007b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b840: 2020 2020 2020 2020 2020 665f 742e 7772            f_t.wr
+0007b850: 6974 656c 696e 6573 2827 272e 6a6f 696e  itelines(''.join
+0007b860: 286c 3129 290a 2020 2020 2020 2020 2020  (l1)).          
+0007b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b880: 2020 2320 6966 2028 6774 6620 6973 204e    # if (gtf is N
+0007b890: 6f6e 6529 3a20 665f 702e 7772 6974 656c  one): f_p.writel
+0007b8a0: 696e 6573 2827 272e 6a6f 696e 286c 3229  ines(''.join(l2)
+0007b8b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007b8c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0007b8d0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+0007b8e0: 636f 7265 203d 206d 696e 2820 6e5f 636f  core = min( n_co
+0007b8f0: 7265 732c 2028 6370 755f 636f 756e 7428  res, (cpu_count(
+0007b900: 2920 2d20 3129 2029 0a20 2020 2020 2020  ) - 1) ).       
+0007b910: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
+0007b920: 6c20 3d20 506f 6f6c 286e 756d 5f63 6f72  l = Pool(num_cor
+0007b930: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0007b940: 2020 2020 2020 206d 203d 2031 0a20 2020         m = 1.   
+0007b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b960: 2066 6f72 2067 7466 6c2c 206c 312c 206c   for gtfl, l1, l
+0007b970: 322c 206e 652c 2063 6e20 696e 2070 6f6f  2, ne, cn in poo
+0007b980: 6c2e 6d61 7028 6d63 5f63 6f72 655f 6765  l.map(mc_core_ge
+0007b990: 745f 6774 665f 616e 645f 6661 7374 615f  t_gtf_and_fasta_
+0007b9a0: 7066 2c20 6764 7329 3a0a 2020 2020 2020  pf, gds):.      
+0007b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b9c0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007b9d0: 2020 2020 2020 2020 2020 2069 6620 6d25             if m%
+0007b9e0: 3130 3020 3d3d 2030 3a20 7072 696e 7428  100 == 0: print(
+0007b9f0: 275c 7247 656e 6572 6174 696e 6720 696e  '\rGenerating in
+0007ba00: 7465 726d 6564 6961 7465 2047 5446 2061  termediate GTF a
+0007ba10: 6e64 2074 7261 6e73 6372 6970 746f 6d65  nd transcriptome
+0007ba20: 202e 2e20 2569 2f25 6927 2025 2028 6d2c   .. %i/%i' % (m,
+0007ba30: 206c 656e 2867 6473 2929 2c20 656e 6420   len(gds)), end 
+0007ba40: 3d20 2720 2020 2729 0a20 2020 2020 2020  = '   ').       
+0007ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ba60: 206d 202b 3d20 310a 2020 2020 2020 2020   m += 1.        
+0007ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ba80: 665f 6774 6620 3d20 7361 7665 5f67 7466  f_gtf = save_gtf
+0007ba90: 3228 666e 616d 655f 6766 662c 2067 7466  2(fname_gff, gtf
+0007baa0: 5f6c 696e 655f 6c73 7420 3d20 6774 666c  _line_lst = gtfl
+0007bab0: 2c20 666f 203d 2066 5f67 7466 290a 0a20  , fo = f_gtf).. 
+0007bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bad0: 2020 2020 2020 2063 6e74 5f6e 6f6e 6520         cnt_none 
+0007bae0: 2b3d 2063 6e0a 2020 2020 2020 2020 2020  += cn.          
+0007baf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0007bb00: 206f 7574 5f74 723a 0a20 2020 2020 2020   out_tr:.       
+0007bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bb20: 2020 2020 2066 5f74 2e77 7269 7465 6c69       f_t.writeli
+0007bb30: 6e65 7328 2727 2e6a 6f69 6e28 6c31 2929  nes(''.join(l1))
+0007bb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007bb50: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0007bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bb70: 2020 706f 6f6c 2e63 6c6f 7365 2829 0a20    pool.close(). 
+0007bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bb90: 2020 2070 6f6f 6c2e 6a6f 696e 2829 0a20     pool.join(). 
+0007bba0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0007bbb0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+0007bbc0: 5f67 7466 3228 666e 616d 655f 6766 662c  _gtf2(fname_gff,
+0007bbd0: 2067 7466 5f6c 696e 655f 6c73 7420 3d20   gtf_line_lst = 
+0007bbe0: 4e6f 6e65 2c20 666f 203d 2066 5f67 7466  None, fo = f_gtf
+0007bbf0: 2c20 636c 6f73 6520 3d20 5472 7565 290a  , close = True).
+0007bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007bc20: 2069 6620 6f75 745f 7472 3a0a 2020 2020   if out_tr:.    
+0007bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bc40: 665f 742e 636c 6f73 6528 290a 2020 2020  f_t.close().    
+0007bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bc60: 2320 6966 2028 6774 6620 6973 204e 6f6e  # if (gtf is Non
+0007bc70: 6529 3a20 665f 702e 636c 6f73 6528 290a  e): f_p.close().
+0007bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bc90: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007bca0: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
+0007bcb0: 6532 203d 2074 696d 652e 7469 6d65 2829  e2 = time.time()
+0007bcc0: 202d 2073 7461 7274 5f74 696d 650a 2020   - start_time.  
+0007bcd0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0007bce0: 696e 7428 275c 7247 656e 6572 6174 696e  int('\rGeneratin
+0007bcf0: 6720 696e 7465 726d 6564 6961 7465 2047  g intermediate G
+0007bd00: 5446 2061 6e64 2074 7261 6e73 6372 6970  TF and transcrip
+0007bd10: 746f 6d65 202e 2e20 2569 2c20 2569 2c20  tome .. %i, %i, 
+0007bd20: 2569 2064 6f6e 6520 2825 6929 2020 2720  %i done (%i)  ' 
+0007bd30: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0007bd40: 2020 2020 2020 2020 2025 2028 6c65 6e28           % (len(
+0007bd50: 6661 7374 615f 6c69 6e65 7329 2f32 2c20  fasta_lines)/2, 
+0007bd60: 6c65 6e28 6764 7329 2c20 636e 745f 6e6f  len(gds), cnt_no
+0007bd70: 6e65 2c20 656c 6170 7365 645f 7469 6d65  ne, elapsed_time
+0007bd80: 3229 290a 2020 2020 2020 2020 2020 2020  2)).            
+0007bd90: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007bda0: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
+0007bdb0: 6533 203d 2074 696d 652e 7469 6d65 2829  e3 = time.time()
+0007bdc0: 202d 2073 7461 7274 5f74 696d 650a 0a20   - start_time.. 
+0007bdd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007bde0: 7269 6e74 2827 2020 2025 7320 2825 6929  rint('   %s (%i)
+0007bdf0: 2720 2520 2866 6e61 6d65 5f67 6666 2c20  ' % (fname_gff, 
+0007be00: 656c 6170 7365 645f 7469 6d65 3329 2029  elapsed_time3) )
+0007be10: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0007be20: 2020 6966 2054 7275 653a 2023 2028 6765    if True: # (ge
+0007be30: 6e6f 6d65 5f66 696c 6520 6973 204e 6f6e  nome_file is Non
+0007be40: 6529 2026 2028 6774 6620 6973 204e 6f6e  e) & (gtf is Non
+0007be50: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+0007be60: 2020 2020 2020 2020 6e76 5f6c 7374 203d          nv_lst =
+0007be70: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0007be80: 2020 2020 2020 2020 636e 745f 6520 3d20          cnt_e = 
+0007be90: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+0007bea0: 2020 2020 2020 666f 7220 6764 2069 6e20        for gd in 
+0007beb0: 6764 733a 0a20 2020 2020 2020 2020 2020  gds:.           
+0007bec0: 2020 2020 2020 2020 2020 2020 2067 642e               gd.
+0007bed0: 6669 6e64 5f73 6e70 5f66 726f 6d5f 7267  find_snp_from_rg
+0007bee0: 6e73 2829 0a20 2020 2020 2020 2020 2020  ns().           
+0007bef0: 2020 2020 2020 2020 2020 2020 206e 765f               nv_
+0007bf00: 6c73 745f 746d 702c 2063 6e74 5f65 203d  lst_tmp, cnt_e =
+0007bf10: 2067 642e 6765 745f 6765 6e65 5f6c 6576   gd.get_gene_lev
+0007bf20: 656c 5f6e 765f 696e 666f 2863 6e74 5f65  el_nv_info(cnt_e
+0007bf30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007bf40: 2020 2020 2020 2020 2020 6e76 5f6c 7374            nv_lst
+0007bf50: 203d 206e 765f 6c73 7420 2b20 6e76 5f6c   = nv_lst + nv_l
+0007bf60: 7374 5f74 6d70 0a0a 2020 2020 2020 2020  st_tmp..        
+0007bf70: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+0007bf80: 2070 642e 4461 7461 4672 616d 6528 6e76   pd.DataFrame(nv
+0007bf90: 5f6c 7374 290a 2020 2020 2020 2020 2020  _lst).          
+0007bfa0: 2020 2020 2020 2020 2020 6466 5f73 6e76            df_snv
+0007bfb0: 203d 2064 665b 5b27 6368 7227 2c20 2770   = df[['chr', 'p
+0007bfc0: 6f73 5f72 6566 272c 2027 7265 665f 7365  os_ref', 'ref_se
+0007bfd0: 7127 2c20 2761 6c74 5f73 6571 272c 2027  q', 'alt_seq', '
+0007bfe0: 6376 675f 6465 7074 6827 2c20 2763 7667  cvg_depth', 'cvg
+0007bff0: 5f66 7261 6327 2c20 2776 5f74 7970 6527  _frac', 'v_type'
+0007c000: 2c20 2776 5f6c 656e 272c 2027 765f 636c  , 'v_len', 'v_cl
+0007c010: 6173 7327 2c20 2776 5f63 6c61 7373 5f74  ass', 'v_class_t
+0007c020: 7227 5d5d 0a20 2020 2020 2020 2020 2020  r']].           
+0007c030: 2020 2020 2020 2020 2064 665f 736e 762e           df_snv.
+0007c040: 746f 5f63 7376 2866 6e61 6d65 5f73 6e76  to_csv(fname_snv
+0007c050: 2c20 7365 703d 275c 7427 290a 2020 2020  , sep='\t').    
+0007c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c070: 7072 696e 7428 2753 4e56 2073 756d 6d61  print('SNV summa
+0007c080: 7279 2073 6176 6564 2074 6f20 2850 4520  ry saved to (PE 
+0007c090: 2569 2920 5c6e 2020 2025 7327 2025 2028  %i) \n   %s' % (
+0007c0a0: 636e 745f 652c 2066 6e61 6d65 5f73 6e76  cnt_e, fname_snv
+0007c0b0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0007c0c0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0007c0d0: 2020 2020 7464 5f65 7870 5f69 6e66 6f20      td_exp_info 
+0007c0e0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0007c0f0: 2020 2020 2066 6f72 206d 2c20 6764 2069       for m, gd i
+0007c100: 6e20 656e 756d 6572 6174 6528 6764 7329  n enumerate(gds)
+0007c110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007c120: 2020 2020 2020 7469 7320 3d20 6764 2e67        tis = gd.g
+0007c130: 6574 5f74 645f 6578 705f 696e 666f 2829  et_td_exp_info()
+0007c140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c150: 2020 2020 2074 645f 6578 705f 696e 666f       td_exp_info
+0007c160: 203d 2074 645f 6578 705f 696e 666f 202b   = td_exp_info +
+0007c170: 2074 6973 0a20 2020 2020 2020 200a 2020   tis.        .  
 0007c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c190: 7469 7320 3d20 6764 2e67 6574 5f74 645f  tis = gd.get_td_
-0007c1a0: 6578 705f 696e 666f 2829 0a20 2020 2020  exp_info().     
-0007c1b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0007c1c0: 645f 6578 705f 696e 666f 203d 2074 645f  d_exp_info = td_
-0007c1d0: 6578 705f 696e 666f 202b 2074 6973 0a20  exp_info + tis. 
-0007c1e0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0007c1f0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007c200: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0007c210: 7464 5f65 7870 5f69 6e66 6f20 3d20 7064  td_exp_info = pd
-0007c220: 2e44 6174 6146 7261 6d65 2874 645f 6578  .DataFrame(td_ex
-0007c230: 705f 696e 666f 290a 2020 2020 2020 2020  p_info).        
-0007c240: 2020 2020 2020 2020 6162 6e5f 7375 6d20          abn_sum 
-0007c250: 3d20 6466 5f74 645f 6578 705f 696e 666f  = df_td_exp_info
-0007c260: 5b27 6162 6e27 5d2e 7375 6d28 290a 2020  ['abn'].sum().  
-0007c270: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0007c280: 2061 626e 5f73 756d 203e 2030 3a0a 2020   abn_sum > 0:.  
-0007c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c2a0: 2020 6e66 203d 2031 3030 3030 3030 2f61    nf = 1000000/a
-0007c2b0: 626e 5f73 756d 0a20 2020 2020 2020 2020  bn_sum.         
-0007c2c0: 2020 2020 2020 2020 2020 2064 665f 7464             df_td
-0007c2d0: 5f65 7870 5f69 6e66 6f5b 2774 706d 275d  _exp_info['tpm']
-0007c2e0: 203d 2064 665f 7464 5f65 7870 5f69 6e66   = df_td_exp_inf
-0007c2f0: 6f5b 2761 626e 275d 2a6e 660a 2020 2020  o['abn']*nf.    
-0007c300: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007c310: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0007c320: 7464 5f65 7870 5f69 6e66 6f2e 746f 5f63  td_exp_info.to_c
-0007c330: 7376 2866 6e61 6d65 5f65 7870 2c20 7365  sv(fname_exp, se
-0007c340: 703d 275c 7427 290a 2020 2020 2020 2020  p='\t').        
-0007c350: 2020 2020 2020 2020 7072 696e 7428 2754          print('T
-0007c360: 7261 6e73 6372 6970 7420 6578 7072 6573  ranscript expres
-0007c370: 7369 6f6e 2070 726f 6669 6c65 2073 6176  sion profile sav
-0007c380: 6564 2074 6f20 5c6e 2020 2025 7327 2025  ed to \n   %s' %
-0007c390: 2066 6e61 6d65 5f65 7870 290a 0a20 2020   fname_exp)..   
-0007c3a0: 2020 2020 2020 2020 2069 6620 2867 7466           if (gtf
-0007c3b0: 2069 7320 4e6f 6e65 293a 0a0a 2020 2020   is None):..    
-0007c3c0: 2020 2020 2020 2020 2020 2020 5472 5f6c              Tr_l
-0007c3d0: 7374 203d 2054 725f 6c73 7420 2b20 4973  st = Tr_lst + Is
-0007c3e0: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
-0007c3f0: 2020 2020 2074 725f 7365 6c20 3d20 5b5d       tr_sel = []
-0007c400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c410: 2069 6620 6c65 6e28 5472 5f6c 7374 2920   if len(Tr_lst) 
-0007c420: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0007c430: 2020 2020 2020 2020 2066 6f72 2074 7220           for tr 
-0007c440: 696e 2054 725f 6c73 743a 200a 2020 2020  in Tr_lst: .    
-0007c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c460: 2020 2020 6966 2028 6c65 6e28 7472 2e73      if (len(tr.s
-0007c470: 6571 2920 3e3d 206c 656e 5f74 6829 3a0a  eq) >= len_th):.
-0007c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c490: 2020 2020 2020 2020 2020 2020 7472 5f73              tr_s
-0007c4a0: 656c 2e61 7070 656e 6428 7472 290a 0a20  el.append(tr).. 
-0007c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c4c0: 2020 2074 725f 7365 6c20 3d20 6765 745f     tr_sel = get_
-0007c4d0: 7470 6d28 7472 5f73 656c 290a 0a20 2020  tpm(tr_sel)..   
-0007c4e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007c4f0: 6c65 6e28 7472 5f73 656c 2920 3e20 303a  len(tr_sel) > 0:
-0007c500: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007c510: 2020 2020 2020 6966 2054 525f 4649 4c54        if TR_FILT
-0007c520: 4552 5f53 454c 203d 3d20 313a 0a20 2020  ER_SEL == 1:.   
-0007c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c540: 2020 2020 2074 725f 7365 6c20 3d20 6669       tr_sel = fi
-0007c550: 6c74 6572 5f74 7273 5f31 2820 7472 5f73  lter_trs_1( tr_s
-0007c560: 656c 2c20 7264 5f6c 656e 2c20 675f 7468  el, rd_len, g_th
-0007c570: 203d 204d 494e 5f4e 5f52 4453 5f50 4552   = MIN_N_RDS_PER
-0007c580: 5f47 454e 452c 2061 626e 5f74 685f 7420  _GENE, abn_th_t 
-0007c590: 3d20 4d49 4e5f 4142 4e5f 544f 5f53 454c  = MIN_ABN_TO_SEL
-0007c5a0: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-0007c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c5d0: 2020 2061 626e 5f74 685f 6920 3d20 4d49     abn_th_i = MI
-0007c5e0: 4e5f 4142 4e5f 544f 5f53 454c 2c20 6973  N_ABN_TO_SEL, is
-0007c5f0: 6f5f 6672 6163 5f74 6820 3d20 4d49 4e5f  o_frac_th = MIN_
-0007c600: 4953 4f5f 4652 4143 2c20 6c65 6e5f 7468  ISO_FRAC, len_th
-0007c610: 203d 204d 494e 5f54 525f 4c45 4e47 5448   = MIN_TR_LENGTH
-0007c620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007c630: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0007c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c650: 2020 2020 7472 5f73 656c 203d 2066 696c      tr_sel = fil
-0007c660: 7465 725f 7472 735f 3228 2074 725f 7365  ter_trs_2( tr_se
-0007c670: 6c2c 2072 645f 6c65 6e2c 2067 5f74 6820  l, rd_len, g_th 
-0007c680: 3d20 4d49 4e5f 4e5f 5244 535f 5045 525f  = MIN_N_RDS_PER_
-0007c690: 4745 4e45 2c20 6162 6e5f 7468 5f74 203d  GENE, abn_th_t =
-0007c6a0: 204d 494e 5f41 424e 5f54 4f5f 5345 4c2c   MIN_ABN_TO_SEL,
-0007c6b0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0007c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c6e0: 2020 6162 6e5f 7468 5f69 203d 204d 494e    abn_th_i = MIN
-0007c6f0: 5f41 424e 5f54 4f5f 5345 4c2c 2069 736f  _ABN_TO_SEL, iso
-0007c700: 5f66 7261 635f 7468 203d 204d 494e 5f49  _frac_th = MIN_I
-0007c710: 534f 5f46 5241 432c 206c 656e 5f74 6820  SO_FRAC, len_th 
-0007c720: 3d20 4d49 4e5f 5452 5f4c 454e 4754 4829  = MIN_TR_LENGTH)
-0007c730: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007c740: 2020 2020 2020 666e 616d 655f 7472 203d        fname_tr =
-0007c750: 2066 6e61 6d65 202b 2027 5f74 7261 6e73   fname + '_trans
-0007c760: 6372 6970 746f 6d65 2e66 6127 0a20 2020  criptome.fa'.   
-0007c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c780: 2066 6e61 6d65 5f70 7220 3d20 666e 616d   fname_pr = fnam
-0007c790: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
-0007c7a0: 6127 0a20 2020 2020 2020 2020 2020 200a  a'.            .
-0007c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c7c0: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
-0007c7d0: 6720 2e2e 2027 2c20 656e 6420 3d20 2727  g .. ', end = ''
-0007c7e0: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-0007c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c800: 2020 2020 7361 7665 5f74 7261 6e73 6372      save_transcr
-0007c810: 6970 7473 3228 2066 6e61 6d65 5f74 722c  ipts2( fname_tr,
-0007c820: 2074 725f 7365 6c20 290a 0a20 2020 2020   tr_sel )..     
-0007c830: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0007c840: 6472 5f6c 7374 2c20 7473 6571 5f6c 7374  dr_lst, tseq_lst
-0007c850: 203d 206c 6f61 645f 6661 7374 6131 2820   = load_fasta1( 
-0007c860: 666e 616d 655f 7472 2c20 7665 7262 6f73  fname_tr, verbos
-0007c870: 6520 3d20 4661 6c73 6529 0a20 2020 2020  e = False).     
-0007c880: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0007c890: 616e 645f 636e 7420 3d20 6c65 6e28 7473  and_cnt = len(ts
-0007c8a0: 6571 5f6c 7374 290a 0a20 2020 2020 2020  eq_lst)..       
-0007c8b0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-0007c8c0: 6573 203d 2067 656e 5f70 726f 7465 6f6d  es = gen_proteom
-0007c8d0: 655f 6672 6f6d 5f74 7261 7363 7269 7074  e_from_trascript
-0007c8e0: 6f6d 6528 6864 725f 6c73 742c 2074 7365  ome(hdr_lst, tse
-0007c8f0: 715f 6c73 742c 206c 656e 5f74 6820 3d20  q_lst, len_th = 
-0007c900: 4d49 4e5f 5052 5f4c 454e 4754 482c 2076  MIN_PR_LENGTH, v
-0007c910: 6572 626f 7365 203d 2046 616c 7365 2c20  erbose = False, 
-0007c920: 7472 6172 6563 6f20 3d20 4661 6c73 6529  trareco = False)
-0007c930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c940: 2020 2020 2070 5f63 616e 645f 636e 7420       p_cand_cnt 
-0007c950: 3d20 6c65 6e28 6c69 6e65 7329 2f32 0a20  = len(lines)/2. 
-0007c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c970: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0007c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c990: 6620 3d20 6f70 656e 2866 6e61 6d65 5f70  f = open(fname_p
-0007c9a0: 722c 2777 2b27 290a 2020 2020 2020 2020  r,'w+').        
-0007c9b0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-0007c9c0: 6974 656c 696e 6573 286c 696e 6573 290a  itelines(lines).
-0007c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c9e0: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
-0007c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ca00: 2020 2070 7269 6e74 2827 2064 6f6e 652e     print(' done.
-0007ca10: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0007ca20: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-0007ca30: 2025 7327 2025 2028 666e 616d 655f 7472   %s' % (fname_tr
-0007ca40: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0007ca50: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-0007ca60: 2020 2573 2720 2520 2866 6e61 6d65 5f70    %s' % (fname_p
-0007ca70: 7229 2029 0a20 2020 2020 2020 2020 2020  r) ).           
-0007ca80: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0007ca90: 2020 2025 7327 2025 2028 666e 616d 655f     %s' % (fname_
-0007caa0: 6766 6629 2029 0a0a 2020 2020 2320 7072  gff) )..    # pr
-0007cab0: 696e 7428 2753 7472 696e 6746 6978 5f61  int('StringFix_a
-0007cac0: 6e61 6c79 7369 7320 6669 6e69 7368 6564  nalysis finished
-0007cad0: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
-0007cae0: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
-0007caf0: 2072 6574 7572 6e20 666e 616d 652c 2067   return fname, g
-0007cb00: 6473 200a 0a0a 4765 6e65 5f54 725f 696e  ds ...Gene_Tr_in
-0007cb10: 666f 203d 2063 6f6c 6c65 6374 696f 6e73  fo = collections
-0007cb20: 2e6e 616d 6564 7475 706c 6528 2747 656e  .namedtuple('Gen
-0007cb30: 655f 5472 5f69 6e66 6f27 2c20 2774 725f  e_Tr_info', 'tr_
-0007cb40: 6964 2c20 7472 5f6e 616d 652c 2067 656e  id, tr_name, gen
-0007cb50: 655f 6964 2c20 6765 6e65 5f6e 616d 652c  e_id, gene_name,
-0007cb60: 2062 696f 7479 7065 2c20 6368 722c 2073   biotype, chr, s
-0007cb70: 7461 7274 2c20 656e 642c 2073 7472 616e  tart, end, stran
-0007cb80: 642c 2063 6f64 696e 672c 206e 756d 5f65  d, coding, num_e
-0007cb90: 786f 6e73 2c20 7472 5f6c 656e 2720 290a  xons, tr_len' ).
-0007cba0: 0a64 6566 2062 7569 6c64 5f67 656e 655f  .def build_gene_
-0007cbb0: 7472 616e 7363 7269 7074 5f74 6162 6c65  transcript_table
-0007cbc0: 2820 6774 665f 6669 6c65 2029 3a0a 0a20  ( gtf_file ):.. 
-0007cbd0: 2020 2067 7466 5f6c 696e 6573 2c20 6864     gtf_lines, hd
-0007cbe0: 725f 6c69 6e65 7320 3d20 6c6f 6164 5f67  r_lines = load_g
-0007cbf0: 7466 2820 6774 665f 6669 6c65 2c20 7665  tf( gtf_file, ve
-0007cc00: 7262 6f73 6520 3d20 5472 7565 290a 2020  rbose = True).  
-0007cc10: 2020 6764 5f6c 7374 2c20 6368 7273 203d    gd_lst, chrs =
-0007cc20: 2067 6574 5f67 656e 655f 6465 7363 7269   get_gene_descri
-0007cc30: 7074 6f72 2867 7466 5f6c 696e 6573 2c20  ptor(gtf_lines, 
-0007cc40: 6765 6e6f 6d65 203d 204e 6f6e 652c 2066  genome = None, f
-0007cc50: 696c 6c20 3d20 4661 6c73 652c 205c 0a20  ill = False, \. 
-0007cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cc90: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-0007cca0: 626f 7365 203d 2054 7275 652c 206e 5f63  bose = True, n_c
-0007ccb0: 6f72 6573 203d 2031 290a 2020 2020 6465  ores = 1).    de
-0007ccc0: 6c20 6774 665f 6c69 6e65 730a 0a20 2020  l gtf_lines..   
-0007ccd0: 2063 6872 5f6c 7374 203d 206c 6973 7428   chr_lst = list(
-0007cce0: 7365 7428 6368 7273 2929 0a20 2020 2063  set(chrs)).    c
-0007ccf0: 6872 5f6c 7374 2e73 6f72 7428 290a 2020  hr_lst.sort().  
-0007cd00: 2020 6368 7273 203d 206e 702e 6172 7261    chrs = np.arra
-0007cd10: 7928 6368 7273 290a 0a20 2020 2067 745f  y(chrs)..    gt_
-0007cd20: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
-0007cd30: 2063 6872 6d20 696e 2063 6872 5f6c 7374   chrm in chr_lst
-0007cd40: 3a0a 2020 2020 2020 2020 7768 203d 2077  :.        wh = w
-0007cd50: 6869 6368 2863 6872 7320 3d3d 2063 6872  hich(chrs == chr
-0007cd60: 6d29 0a0a 2020 2020 2020 2020 735f 706f  m)..        s_po
-0007cd70: 7320 3d20 6e70 2e7a 6572 6f73 286c 656e  s = np.zeros(len
-0007cd80: 2877 6829 290a 2020 2020 2020 2020 666f  (wh)).        fo
-0007cd90: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
-0007cda0: 2877 6829 293a 200a 2020 2020 2020 2020  (wh)): .        
-0007cdb0: 2020 2020 735f 706f 735b 6b5d 203d 2067      s_pos[k] = g
-0007cdc0: 645f 6c73 745b 7768 5b6b 5d5d 2e62 6567  d_lst[wh[k]].beg
-0007cdd0: 696e 0a20 2020 2020 2020 206f 6472 203d  in.        odr =
-0007cde0: 2073 5f70 6f73 2e61 7267 736f 7274 2829   s_pos.argsort()
-0007cdf0: 0a0a 2020 2020 2020 2020 6764 5f73 656c  ..        gd_sel
-0007ce00: 5f6f 7264 6572 6564 203d 205b 6764 5f6c  _ordered = [gd_l
-0007ce10: 7374 5b77 685b 6f64 725b 6b5d 5d5d 2066  st[wh[odr[k]]] f
-0007ce20: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
-0007ce30: 6e28 7768 2929 5d0a 0a20 2020 2020 2020  n(wh))]..       
-0007ce40: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
-0007ce50: 756d 6572 6174 6528 6764 5f73 656c 5f6f  umerate(gd_sel_o
-0007ce60: 7264 6572 6564 293a 0a20 2020 2020 2020  rdered):.       
-0007ce70: 2020 2020 2066 6f72 206d 2c20 7464 2069       for m, td i
-0007ce80: 6e20 656e 756d 6572 6174 6528 6764 2e74  n enumerate(gd.t
-0007ce90: 645f 6c73 7429 3a0a 2020 2020 2020 2020  d_lst):.        
-0007cea0: 2020 2020 2020 2020 7469 6420 3d20 7464          tid = td
-0007ceb0: 2e74 6964 0a20 2020 2020 2020 2020 2020  .tid.           
-0007cec0: 2020 2020 2074 6e61 6d65 203d 2074 642e       tname = td.
-0007ced0: 746e 616d 650a 2020 2020 2020 2020 2020  tname.          
-0007cee0: 2020 2020 2020 6769 6420 3d20 7464 2e67        gid = td.g
-0007cef0: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
-0007cf00: 2020 2067 6e61 6d65 203d 2074 642e 676e     gname = td.gn
-0007cf10: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0007cf20: 2020 2020 6269 6f74 7970 6520 3d20 7464      biotype = td
-0007cf30: 2e62 696f 7479 7065 0a20 2020 2020 2020  .biotype.       
-0007cf40: 2020 2020 2020 2020 2073 7461 7274 203d           start =
-0007cf50: 2074 642e 6265 6769 6e0a 2020 2020 2020   td.begin.      
-0007cf60: 2020 2020 2020 2020 2020 656e 6420 3d20            end = 
-0007cf70: 7464 2e65 6e64 0a20 2020 2020 2020 2020  td.end.         
-0007cf80: 2020 2020 2020 206e 5f65 7820 3d20 7464         n_ex = td
-0007cf90: 2e6e 6578 6f6e 730a 2020 2020 2020 2020  .nexons.        
-0007cfa0: 2020 2020 2020 2020 746c 656e 203d 2074          tlen = t
-0007cfb0: 642e 746c 656e 0a20 2020 2020 2020 2020  d.tlen.         
-0007cfc0: 2020 2020 2020 2073 7472 616e 6420 3d20         strand = 
-0007cfd0: 6765 745f 635f 6672 6f6d 5f69 7374 7261  get_c_from_istra
-0007cfe0: 6e64 2820 7464 2e69 7374 7261 6e64 2029  nd( td.istrand )
-0007cff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007d000: 2063 6473 203d 2067 6574 5f73 7472 5f66   cds = get_str_f
-0007d010: 726f 6d5f 6963 646e 6728 2074 642e 6963  rom_icdng( td.ic
-0007d020: 6473 2029 0a0a 2020 2020 2020 2020 2020  ds )..          
-0007d030: 2020 2020 2020 6774 6520 3d20 4765 6e65        gte = Gene
-0007d040: 5f54 725f 696e 666f 2820 7469 642c 2074  _Tr_info( tid, t
-0007d050: 6e61 6d65 2c20 6769 642c 2067 6e61 6d65  name, gid, gname
-0007d060: 2c20 6269 6f74 7970 652c 2063 6872 6d2c  , biotype, chrm,
-0007d070: 2073 7461 7274 2c20 656e 642c 2073 7472   start, end, str
-0007d080: 616e 642c 2063 6473 2c20 6e5f 6578 2c20  and, cds, n_ex, 
-0007d090: 746c 656e 2029 0a20 2020 2020 2020 2020  tlen ).         
-0007d0a0: 2020 2020 2020 2067 745f 6c73 742e 6170         gt_lst.ap
-0007d0b0: 7065 6e64 2867 7465 290a 0a20 2020 2070  pend(gte)..    p
-0007d0c0: 7269 6e74 2827 5c6e 5361 7669 6e67 202e  rint('\nSaving .
-0007d0d0: 2e20 2027 2c20 656e 6420 3d20 2727 290a  .  ', end = '').
-0007d0e0: 2020 2020 6466 203d 2070 642e 4461 7461      df = pd.Data
-0007d0f0: 4672 616d 6528 6774 5f6c 7374 290a 2020  Frame(gt_lst).  
-0007d100: 2020 6669 6c65 5f6f 7574 203d 2067 7466    file_out = gtf
-0007d110: 5f66 696c 6520 2b20 272e 7472 616e 7363  _file + '.transc
-0007d120: 7269 7074 5f69 6e66 6f2e 7473 7627 0a20  ript_info.tsv'. 
-0007d130: 2020 2064 662e 746f 5f63 7376 2866 696c     df.to_csv(fil
-0007d140: 655f 6f75 742c 2073 6570 203d 2027 5c74  e_out, sep = '\t
-0007d150: 2729 0a20 2020 2070 7269 6e74 2827 646f  ').    print('do
-0007d160: 6e65 2e27 290a 0a20 2020 2070 7269 6e74  ne.')..    print
-0007d170: 2827 5472 616e 7363 7269 7074 2069 6e66  ('Transcript inf
-0007d180: 6f2e 2073 6176 6564 2074 6f20 2573 2720  o. saved to %s' 
-0007d190: 2520 6669 6c65 5f6f 7574 290a 0a20 2020  % file_out)..   
-0007d1a0: 2072 6574 7572 6e20 6774 5f6c 7374 0a0a   return gt_lst..
-0007d1b0: 2727 270a 6465 6620 4765 6e65 7261 7465  '''.def Generate
-0007d1c0: 5f50 726f 7465 6f6d 6528 7472 5f66 612c  _Proteome(tr_fa,
-0007d1d0: 206c 656e 5f74 6820 3d20 4d49 4e5f 5052   len_th = MIN_PR
-0007d1e0: 5f4c 454e 4754 482c 2076 6572 626f 7365  _LENGTH, verbose
-0007d1f0: 203d 2054 7275 652c 206d 785f 636e 7420   = True, mx_cnt 
-0007d200: 3d20 302c 2074 7261 7265 636f 203d 2046  = 0, trareco = F
-0007d210: 616c 7365 2c20 666e 616d 655f 6f75 7420  alse, fname_out 
-0007d220: 3d20 4e6f 6e65 293a 0a20 2020 200a 2020  = None):.    .  
-0007d230: 2020 6669 6c65 5f6e 616d 6520 3d20 7472    file_name = tr
-0007d240: 5f66 612e 7370 6c69 7428 272f 2729 5b2d  _fa.split('/')[-
-0007d250: 315d 0a20 2020 2066 6e73 203d 2066 696c  1].    fns = fil
-0007d260: 655f 6e61 6d65 2e73 706c 6974 2827 2e27  e_name.split('.'
-0007d270: 295b 3a2d 315d 0a20 2020 2066 6e61 6d65  )[:-1].    fname
-0007d280: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
-0007d290: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
-0007d2a0: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
-0007d2b0: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
-0007d2c0: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-0007d2d0: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
-0007d2e0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
-0007d2f0: 2066 6e0a 2020 2020 0a20 2020 2068 6472   fn.    .    hdr
-0007d300: 5f6c 7374 2c20 7473 6571 5f6c 7374 203d  _lst, tseq_lst =
-0007d310: 206c 6f61 645f 6661 7374 6131 2874 725f   load_fasta1(tr_
-0007d320: 6661 2c20 7665 7262 6f73 6520 3d20 4661  fa, verbose = Fa
-0007d330: 6c73 6529 0a20 2020 2063 616e 645f 636e  lse).    cand_cn
-0007d340: 7420 3d20 6c65 6e28 7473 6571 5f6c 7374  t = len(tseq_lst
-0007d350: 290a 0a20 2020 206c 696e 6573 203d 2067  )..    lines = g
-0007d360: 656e 5f70 726f 7465 6f6d 655f 6672 6f6d  en_proteome_from
-0007d370: 5f74 7261 7363 7269 7074 6f6d 6528 6864  _trascriptome(hd
-0007d380: 725f 6c73 742c 2074 7365 715f 6c73 742c  r_lst, tseq_lst,
-0007d390: 206c 656e 5f74 6820 3d20 6c65 6e5f 7468   len_th = len_th
-0007d3a0: 2c20 7665 7262 6f73 6520 3d20 7665 7262  , verbose = verb
-0007d3b0: 6f73 652c 2074 7261 7265 636f 203d 2074  ose, trareco = t
-0007d3c0: 7261 7265 636f 290a 2020 2020 705f 6361  rareco).    p_ca
-0007d3d0: 6e64 5f63 6e74 203d 206c 656e 286c 696e  nd_cnt = len(lin
-0007d3e0: 6573 292f 320a 2020 2020 2020 2020 2020  es)/2.          
-0007d3f0: 2020 0a20 2020 2069 6620 666e 616d 655f    .    if fname_
-0007d400: 6f75 7420 6973 204e 6f6e 653a 2066 6e61  out is None: fna
-0007d410: 6d65 5f6f 7574 203d 2066 6e61 6d65 202b  me_out = fname +
-0007d420: 2027 5f70 726f 7465 6f6d 652e 6661 270a   '_proteome.fa'.
-0007d430: 2020 2020 6620 3d20 6f70 656e 2866 6e61      f = open(fna
-0007d440: 6d65 5f6f 7574 2c27 772b 2729 0a20 2020  me_out,'w+').   
-0007d450: 2066 2e77 7269 7465 6c69 6e65 7328 6c69   f.writelines(li
-0007d460: 6e65 7329 0a20 2020 2066 2e63 6c6f 7365  nes).    f.close
-0007d470: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0007d480: 2020 200a 2020 2020 6966 2076 6572 626f     .    if verbo
-0007d490: 7365 3a20 0a20 2020 2020 2020 2070 7269  se: .        pri
-0007d4a0: 6e74 2827 4141 5365 7120 7361 7665 6420  nt('AASeq saved 
-0007d4b0: 746f 2025 7327 2025 2028 666e 616d 655f  to %s' % (fname_
-0007d4c0: 6f75 7429 290a 2020 2020 2020 2020 0a20  out)).        . 
-0007d4d0: 2020 2072 6574 7572 6e20 666e 616d 655f     return fname_
-0007d4e0: 6f75 740a 2727 270a 0a23 2323 2323 2323  out.'''..#######
+0007c190: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007c1a0: 2020 2064 665f 7464 5f65 7870 5f69 6e66     df_td_exp_inf
+0007c1b0: 6f20 3d20 7064 2e44 6174 6146 7261 6d65  o = pd.DataFrame
+0007c1c0: 2874 645f 6578 705f 696e 666f 290a 2020  (td_exp_info).  
+0007c1d0: 2020 2020 2020 2020 2020 2020 2020 6162                ab
+0007c1e0: 6e5f 7375 6d20 3d20 6466 5f74 645f 6578  n_sum = df_td_ex
+0007c1f0: 705f 696e 666f 5b27 6162 6e27 5d2e 7375  p_info['abn'].su
+0007c200: 6d28 290a 2020 2020 2020 2020 2020 2020  m().            
+0007c210: 2020 2020 6966 2061 626e 5f73 756d 203e      if abn_sum >
+0007c220: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0007c230: 2020 2020 2020 2020 6e66 203d 2031 3030          nf = 100
+0007c240: 3030 3030 2f61 626e 5f73 756d 0a20 2020  0000/abn_sum.   
+0007c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c260: 2064 665f 7464 5f65 7870 5f69 6e66 6f5b   df_td_exp_info[
+0007c270: 2774 706d 275d 203d 2064 665f 7464 5f65  'tpm'] = df_td_e
+0007c280: 7870 5f69 6e66 6f5b 2761 626e 275d 2a6e  xp_info['abn']*n
+0007c290: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+0007c2a0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007c2b0: 2020 2064 665f 7464 5f65 7870 5f69 6e66     df_td_exp_inf
+0007c2c0: 6f2e 746f 5f63 7376 2866 6e61 6d65 5f65  o.to_csv(fname_e
+0007c2d0: 7870 2c20 7365 703d 275c 7427 290a 2020  xp, sep='\t').  
+0007c2e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0007c2f0: 696e 7428 2754 7261 6e73 6372 6970 7420  int('Transcript 
+0007c300: 6578 7072 6573 7369 6f6e 2070 726f 6669  expression profi
+0007c310: 6c65 2073 6176 6564 2074 6f20 5c6e 2020  le saved to \n  
+0007c320: 2025 7327 2025 2066 6e61 6d65 5f65 7870   %s' % fname_exp
+0007c330: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0007c340: 6620 2867 7466 2069 7320 4e6f 6e65 293a  f (gtf is None):
+0007c350: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0007c360: 2020 5472 5f6c 7374 203d 2054 725f 6c73    Tr_lst = Tr_ls
+0007c370: 7420 2b20 4973 5f6c 7374 0a20 2020 2020  t + Is_lst.     
+0007c380: 2020 2020 2020 2020 2020 2074 725f 7365             tr_se
+0007c390: 6c20 3d20 5b5d 0a20 2020 2020 2020 2020  l = [].         
+0007c3a0: 2020 2020 2020 2069 6620 6c65 6e28 5472         if len(Tr
+0007c3b0: 5f6c 7374 2920 3e20 303a 0a20 2020 2020  _lst) > 0:.     
+0007c3c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007c3d0: 6f72 2074 7220 696e 2054 725f 6c73 743a  or tr in Tr_lst:
+0007c3e0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0007c3f0: 2020 2020 2020 2020 2020 6966 2028 6c65            if (le
+0007c400: 6e28 7472 2e73 6571 2920 3e3d 206c 656e  n(tr.seq) >= len
+0007c410: 5f74 6829 3a0a 2020 2020 2020 2020 2020  _th):.          
+0007c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c430: 2020 7472 5f73 656c 2e61 7070 656e 6428    tr_sel.append(
+0007c440: 7472 290a 0a20 2020 2020 2020 2020 2020  tr)..           
+0007c450: 2020 2020 2020 2020 2074 725f 7365 6c20           tr_sel 
+0007c460: 3d20 6765 745f 7470 6d28 7472 5f73 656c  = get_tpm(tr_sel
+0007c470: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0007c480: 2020 2069 6620 6c65 6e28 7472 5f73 656c     if len(tr_sel
+0007c490: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
+0007c4a0: 2020 2020 2020 2020 2020 2020 6966 2054              if T
+0007c4b0: 525f 4649 4c54 4552 5f53 454c 203d 3d20  R_FILTER_SEL == 
+0007c4c0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+0007c4d0: 2020 2020 2020 2020 2020 2074 725f 7365             tr_se
+0007c4e0: 6c20 3d20 6669 6c74 6572 5f74 7273 5f31  l = filter_trs_1
+0007c4f0: 2820 7472 5f73 656c 2c20 7264 5f6c 656e  ( tr_sel, rd_len
+0007c500: 2c20 675f 7468 203d 204d 494e 5f4e 5f52  , g_th = MIN_N_R
+0007c510: 4453 5f50 4552 5f47 454e 452c 2061 626e  DS_PER_GENE, abn
+0007c520: 5f74 685f 7420 3d20 4d49 4e5f 4142 4e5f  _th_t = MIN_ABN_
+0007c530: 544f 5f53 454c 2c20 5c0a 2020 2020 2020  TO_SEL, \.      
+0007c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c560: 2020 2020 2020 2020 2061 626e 5f74 685f           abn_th_
+0007c570: 6920 3d20 4d49 4e5f 4142 4e5f 544f 5f53  i = MIN_ABN_TO_S
+0007c580: 454c 2c20 6973 6f5f 6672 6163 5f74 6820  EL, iso_frac_th 
+0007c590: 3d20 4d49 4e5f 4953 4f5f 4652 4143 2c20  = MIN_ISO_FRAC, 
+0007c5a0: 6c65 6e5f 7468 203d 204d 494e 5f54 525f  len_th = MIN_TR_
+0007c5b0: 4c45 4e47 5448 290a 2020 2020 2020 2020  LENGTH).        
+0007c5c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0007c5d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007c5e0: 2020 2020 2020 2020 2020 7472 5f73 656c            tr_sel
+0007c5f0: 203d 2066 696c 7465 725f 7472 735f 3228   = filter_trs_2(
+0007c600: 2074 725f 7365 6c2c 2072 645f 6c65 6e2c   tr_sel, rd_len,
+0007c610: 2067 5f74 6820 3d20 4d49 4e5f 4e5f 5244   g_th = MIN_N_RD
+0007c620: 535f 5045 525f 4745 4e45 2c20 6162 6e5f  S_PER_GENE, abn_
+0007c630: 7468 5f74 203d 204d 494e 5f41 424e 5f54  th_t = MIN_ABN_T
+0007c640: 4f5f 5345 4c2c 205c 0a20 2020 2020 2020  O_SEL, \.       
+0007c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c670: 2020 2020 2020 2020 6162 6e5f 7468 5f69          abn_th_i
+0007c680: 203d 204d 494e 5f41 424e 5f54 4f5f 5345   = MIN_ABN_TO_SE
+0007c690: 4c2c 2069 736f 5f66 7261 635f 7468 203d  L, iso_frac_th =
+0007c6a0: 204d 494e 5f49 534f 5f46 5241 432c 206c   MIN_ISO_FRAC, l
+0007c6b0: 656e 5f74 6820 3d20 4d49 4e5f 5452 5f4c  en_th = MIN_TR_L
+0007c6c0: 454e 4754 4829 0a0a 2020 2020 2020 2020  ENGTH)..        
+0007c6d0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+0007c6e0: 655f 7472 203d 2066 6e61 6d65 202b 2027  e_tr = fname + '
+0007c6f0: 5f74 7261 6e73 6372 6970 746f 6d65 2e66  _transcriptome.f
+0007c700: 6127 0a20 2020 2020 2020 2020 2020 2020  a'.             
+0007c710: 2020 2020 2020 2066 6e61 6d65 5f70 7220         fname_pr 
+0007c720: 3d20 666e 616d 6520 2b20 275f 7072 6f74  = fname + '_prot
+0007c730: 656f 6d65 2e66 6127 0a20 2020 2020 2020  eome.fa'.       
+0007c740: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0007c750: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0007c760: 2753 6176 696e 6720 2e2e 2027 2c20 656e  'Saving .. ', en
+0007c770: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
+0007c780: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0007c790: 2020 2020 2020 2020 2020 7361 7665 5f74            save_t
+0007c7a0: 7261 6e73 6372 6970 7473 3228 2066 6e61  ranscripts2( fna
+0007c7b0: 6d65 5f74 722c 2074 725f 7365 6c20 290a  me_tr, tr_sel ).
+0007c7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c7d0: 2020 2020 2068 6472 5f6c 7374 2c20 7473       hdr_lst, ts
+0007c7e0: 6571 5f6c 7374 203d 206c 6f61 645f 6661  eq_lst = load_fa
+0007c7f0: 7374 6131 2820 666e 616d 655f 7472 2c20  sta1( fname_tr, 
+0007c800: 7665 7262 6f73 6520 3d20 4661 6c73 6529  verbose = False)
+0007c810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c820: 2020 2020 2063 616e 645f 636e 7420 3d20       cand_cnt = 
+0007c830: 6c65 6e28 7473 6571 5f6c 7374 290a 0a20  len(tseq_lst).. 
+0007c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c850: 2020 206c 696e 6573 203d 2067 656e 5f70     lines = gen_p
+0007c860: 726f 7465 6f6d 655f 6672 6f6d 5f74 7261  roteome_from_tra
+0007c870: 7363 7269 7074 6f6d 6528 6864 725f 6c73  scriptome(hdr_ls
+0007c880: 742c 2074 7365 715f 6c73 742c 206c 656e  t, tseq_lst, len
+0007c890: 5f74 6820 3d20 4d49 4e5f 5052 5f4c 454e  _th = MIN_PR_LEN
+0007c8a0: 4754 482c 2076 6572 626f 7365 203d 2046  GTH, verbose = F
+0007c8b0: 616c 7365 2c20 7472 6172 6563 6f20 3d20  alse, trareco = 
+0007c8c0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0007c8d0: 2020 2020 2020 2020 2020 2070 5f63 616e             p_can
+0007c8e0: 645f 636e 7420 3d20 6c65 6e28 6c69 6e65  d_cnt = len(line
+0007c8f0: 7329 2f32 0a20 2020 2020 2020 2020 2020  s)/2.           
+0007c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c910: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0007c920: 2020 2020 2020 6620 3d20 6f70 656e 2866        f = open(f
+0007c930: 6e61 6d65 5f70 722c 2777 2b27 290a 2020  name_pr,'w+').  
+0007c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c950: 2020 662e 7772 6974 656c 696e 6573 286c    f.writelines(l
+0007c960: 696e 6573 290a 2020 2020 2020 2020 2020  ines).          
+0007c970: 2020 2020 2020 2020 2020 662e 636c 6f73            f.clos
+0007c980: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
+0007c990: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0007c9a0: 2064 6f6e 652e 2729 0a20 2020 2020 2020   done.').       
+0007c9b0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0007c9c0: 6e74 2827 2020 2025 7327 2025 2028 666e  nt('   %s' % (fn
+0007c9d0: 616d 655f 7472 2920 290a 2020 2020 2020  ame_tr) ).      
+0007c9e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0007c9f0: 696e 7428 2720 2020 2573 2720 2520 2866  int('   %s' % (f
+0007ca00: 6e61 6d65 5f70 7229 2029 0a20 2020 2020  name_pr) ).     
+0007ca10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007ca20: 7269 6e74 2827 2020 2025 7327 2025 2028  rint('   %s' % (
+0007ca30: 666e 616d 655f 6766 6629 2029 0a0a 2020  fname_gff) )..  
+0007ca40: 2020 2320 7072 696e 7428 2753 7472 696e    # print('Strin
+0007ca50: 6746 6978 5f61 6e61 6c79 7369 7320 6669  gFix_analysis fi
+0007ca60: 6e69 7368 6564 2027 2c20 6461 7465 7469  nished ', dateti
+0007ca70: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
+0007ca80: 2929 0a20 2020 2072 6574 7572 6e20 666e  )).    return fn
+0007ca90: 616d 652c 2067 6473 200a 0a0a 4765 6e65  ame, gds ...Gene
+0007caa0: 5f54 725f 696e 666f 203d 2063 6f6c 6c65  _Tr_info = colle
+0007cab0: 6374 696f 6e73 2e6e 616d 6564 7475 706c  ctions.namedtupl
+0007cac0: 6528 2747 656e 655f 5472 5f69 6e66 6f27  e('Gene_Tr_info'
+0007cad0: 2c20 2774 725f 6964 2c20 7472 5f6e 616d  , 'tr_id, tr_nam
+0007cae0: 652c 2067 656e 655f 6964 2c20 6765 6e65  e, gene_id, gene
+0007caf0: 5f6e 616d 652c 2062 696f 7479 7065 2c20  _name, biotype, 
+0007cb00: 6368 722c 2073 7461 7274 2c20 656e 642c  chr, start, end,
+0007cb10: 2073 7472 616e 642c 2063 6f64 696e 672c   strand, coding,
+0007cb20: 206e 756d 5f65 786f 6e73 2c20 7472 5f6c   num_exons, tr_l
+0007cb30: 656e 2720 290a 0a64 6566 2062 7569 6c64  en' )..def build
+0007cb40: 5f67 656e 655f 7472 616e 7363 7269 7074  _gene_transcript
+0007cb50: 5f74 6162 6c65 2820 6774 665f 6669 6c65  _table( gtf_file
+0007cb60: 2029 3a0a 0a20 2020 2067 7466 5f6c 696e   ):..    gtf_lin
+0007cb70: 6573 2c20 6864 725f 6c69 6e65 7320 3d20  es, hdr_lines = 
+0007cb80: 6c6f 6164 5f67 7466 2820 6774 665f 6669  load_gtf( gtf_fi
+0007cb90: 6c65 2c20 7665 7262 6f73 6520 3d20 5472  le, verbose = Tr
+0007cba0: 7565 290a 2020 2020 6764 5f6c 7374 2c20  ue).    gd_lst, 
+0007cbb0: 6368 7273 203d 2067 6574 5f67 656e 655f  chrs = get_gene_
+0007cbc0: 6465 7363 7269 7074 6f72 2867 7466 5f6c  descriptor(gtf_l
+0007cbd0: 696e 6573 2c20 6765 6e6f 6d65 203d 204e  ines, genome = N
+0007cbe0: 6f6e 652c 2066 696c 6c20 3d20 4661 6c73  one, fill = Fals
+0007cbf0: 652c 205c 0a20 2020 2020 2020 2020 2020  e, \.           
+0007cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cc30: 2020 2076 6572 626f 7365 203d 2054 7275     verbose = Tru
+0007cc40: 652c 206e 5f63 6f72 6573 203d 2031 290a  e, n_cores = 1).
+0007cc50: 2020 2020 6465 6c20 6774 665f 6c69 6e65      del gtf_line
+0007cc60: 730a 0a20 2020 2063 6872 5f6c 7374 203d  s..    chr_lst =
+0007cc70: 206c 6973 7428 7365 7428 6368 7273 2929   list(set(chrs))
+0007cc80: 0a20 2020 2063 6872 5f6c 7374 2e73 6f72  .    chr_lst.sor
+0007cc90: 7428 290a 2020 2020 6368 7273 203d 206e  t().    chrs = n
+0007cca0: 702e 6172 7261 7928 6368 7273 290a 0a20  p.array(chrs).. 
+0007ccb0: 2020 2067 745f 6c73 7420 3d20 5b5d 0a20     gt_lst = []. 
+0007ccc0: 2020 2066 6f72 2063 6872 6d20 696e 2063     for chrm in c
+0007ccd0: 6872 5f6c 7374 3a0a 2020 2020 2020 2020  hr_lst:.        
+0007cce0: 7768 203d 2077 6869 6368 2863 6872 7320  wh = which(chrs 
+0007ccf0: 3d3d 2063 6872 6d29 0a0a 2020 2020 2020  == chrm)..      
+0007cd00: 2020 735f 706f 7320 3d20 6e70 2e7a 6572    s_pos = np.zer
+0007cd10: 6f73 286c 656e 2877 6829 290a 2020 2020  os(len(wh)).    
+0007cd20: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
+0007cd30: 6765 286c 656e 2877 6829 293a 200a 2020  ge(len(wh)): .  
+0007cd40: 2020 2020 2020 2020 2020 735f 706f 735b            s_pos[
+0007cd50: 6b5d 203d 2067 645f 6c73 745b 7768 5b6b  k] = gd_lst[wh[k
+0007cd60: 5d5d 2e62 6567 696e 0a20 2020 2020 2020  ]].begin.       
+0007cd70: 206f 6472 203d 2073 5f70 6f73 2e61 7267   odr = s_pos.arg
+0007cd80: 736f 7274 2829 0a0a 2020 2020 2020 2020  sort()..        
+0007cd90: 6764 5f73 656c 5f6f 7264 6572 6564 203d  gd_sel_ordered =
+0007cda0: 205b 6764 5f6c 7374 5b77 685b 6f64 725b   [gd_lst[wh[odr[
+0007cdb0: 6b5d 5d5d 2066 6f72 206b 2069 6e20 7261  k]]] for k in ra
+0007cdc0: 6e67 6528 6c65 6e28 7768 2929 5d0a 0a20  nge(len(wh))].. 
+0007cdd0: 2020 2020 2020 2066 6f72 206b 2c20 6764         for k, gd
+0007cde0: 2069 6e20 656e 756d 6572 6174 6528 6764   in enumerate(gd
+0007cdf0: 5f73 656c 5f6f 7264 6572 6564 293a 0a20  _sel_ordered):. 
+0007ce00: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+0007ce10: 2c20 7464 2069 6e20 656e 756d 6572 6174  , td in enumerat
+0007ce20: 6528 6764 2e74 645f 6c73 7429 3a0a 2020  e(gd.td_lst):.  
+0007ce30: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0007ce40: 6420 3d20 7464 2e74 6964 0a20 2020 2020  d = td.tid.     
+0007ce50: 2020 2020 2020 2020 2020 2074 6e61 6d65             tname
+0007ce60: 203d 2074 642e 746e 616d 650a 2020 2020   = td.tname.    
+0007ce70: 2020 2020 2020 2020 2020 2020 6769 6420              gid 
+0007ce80: 3d20 7464 2e67 6964 0a20 2020 2020 2020  = td.gid.       
+0007ce90: 2020 2020 2020 2020 2067 6e61 6d65 203d           gname =
+0007cea0: 2074 642e 676e 616d 650a 2020 2020 2020   td.gname.      
+0007ceb0: 2020 2020 2020 2020 2020 6269 6f74 7970            biotyp
+0007cec0: 6520 3d20 7464 2e62 696f 7479 7065 0a20  e = td.biotype. 
+0007ced0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0007cee0: 7461 7274 203d 2074 642e 6265 6769 6e0a  tart = td.begin.
+0007cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cf00: 656e 6420 3d20 7464 2e65 6e64 0a20 2020  end = td.end.   
+0007cf10: 2020 2020 2020 2020 2020 2020 206e 5f65               n_e
+0007cf20: 7820 3d20 7464 2e6e 6578 6f6e 730a 2020  x = td.nexons.  
+0007cf30: 2020 2020 2020 2020 2020 2020 2020 746c                tl
+0007cf40: 656e 203d 2074 642e 746c 656e 0a20 2020  en = td.tlen.   
+0007cf50: 2020 2020 2020 2020 2020 2020 2073 7472               str
+0007cf60: 616e 6420 3d20 6765 745f 635f 6672 6f6d  and = get_c_from
+0007cf70: 5f69 7374 7261 6e64 2820 7464 2e69 7374  _istrand( td.ist
+0007cf80: 7261 6e64 2029 0a20 2020 2020 2020 2020  rand ).         
+0007cf90: 2020 2020 2020 2063 6473 203d 2067 6574         cds = get
+0007cfa0: 5f73 7472 5f66 726f 6d5f 6963 646e 6728  _str_from_icdng(
+0007cfb0: 2074 642e 6963 6473 2029 0a0a 2020 2020   td.icds )..    
+0007cfc0: 2020 2020 2020 2020 2020 2020 6774 6520              gte 
+0007cfd0: 3d20 4765 6e65 5f54 725f 696e 666f 2820  = Gene_Tr_info( 
+0007cfe0: 7469 642c 2074 6e61 6d65 2c20 6769 642c  tid, tname, gid,
+0007cff0: 2067 6e61 6d65 2c20 6269 6f74 7970 652c   gname, biotype,
+0007d000: 2063 6872 6d2c 2073 7461 7274 2c20 656e   chrm, start, en
+0007d010: 642c 2073 7472 616e 642c 2063 6473 2c20  d, strand, cds, 
+0007d020: 6e5f 6578 2c20 746c 656e 2029 0a20 2020  n_ex, tlen ).   
+0007d030: 2020 2020 2020 2020 2020 2020 2067 745f               gt_
+0007d040: 6c73 742e 6170 7065 6e64 2867 7465 290a  lst.append(gte).
+0007d050: 0a20 2020 2070 7269 6e74 2827 5c6e 5361  .    print('\nSa
+0007d060: 7669 6e67 202e 2e20 2027 2c20 656e 6420  ving ..  ', end 
+0007d070: 3d20 2727 290a 2020 2020 6466 203d 2070  = '').    df = p
+0007d080: 642e 4461 7461 4672 616d 6528 6774 5f6c  d.DataFrame(gt_l
+0007d090: 7374 290a 2020 2020 6669 6c65 5f6f 7574  st).    file_out
+0007d0a0: 203d 2067 7466 5f66 696c 6520 2b20 272e   = gtf_file + '.
+0007d0b0: 7472 616e 7363 7269 7074 5f69 6e66 6f2e  transcript_info.
+0007d0c0: 7473 7627 0a20 2020 2064 662e 746f 5f63  tsv'.    df.to_c
+0007d0d0: 7376 2866 696c 655f 6f75 742c 2073 6570  sv(file_out, sep
+0007d0e0: 203d 2027 5c74 2729 0a20 2020 2070 7269   = '\t').    pri
+0007d0f0: 6e74 2827 646f 6e65 2e27 290a 0a20 2020  nt('done.')..   
+0007d100: 2070 7269 6e74 2827 5472 616e 7363 7269   print('Transcri
+0007d110: 7074 2069 6e66 6f2e 2073 6176 6564 2074  pt info. saved t
+0007d120: 6f20 2573 2720 2520 6669 6c65 5f6f 7574  o %s' % file_out
+0007d130: 290a 0a20 2020 2072 6574 7572 6e20 6774  )..    return gt
+0007d140: 5f6c 7374 0a0a 2727 270a 6465 6620 4765  _lst..'''.def Ge
+0007d150: 6e65 7261 7465 5f50 726f 7465 6f6d 6528  nerate_Proteome(
+0007d160: 7472 5f66 612c 206c 656e 5f74 6820 3d20  tr_fa, len_th = 
+0007d170: 4d49 4e5f 5052 5f4c 454e 4754 482c 2076  MIN_PR_LENGTH, v
+0007d180: 6572 626f 7365 203d 2054 7275 652c 206d  erbose = True, m
+0007d190: 785f 636e 7420 3d20 302c 2074 7261 7265  x_cnt = 0, trare
+0007d1a0: 636f 203d 2046 616c 7365 2c20 666e 616d  co = False, fnam
+0007d1b0: 655f 6f75 7420 3d20 4e6f 6e65 293a 0a20  e_out = None):. 
+0007d1c0: 2020 200a 2020 2020 6669 6c65 5f6e 616d     .    file_nam
+0007d1d0: 6520 3d20 7472 5f66 612e 7370 6c69 7428  e = tr_fa.split(
+0007d1e0: 272f 2729 5b2d 315d 0a20 2020 2066 6e73  '/')[-1].    fns
+0007d1f0: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
+0007d200: 6974 2827 2e27 295b 3a2d 315d 0a20 2020  it('.')[:-1].   
+0007d210: 2066 6e61 6d65 203d 2027 270a 2020 2020   fname = ''.    
+0007d220: 666f 7220 6b2c 2066 6e20 696e 2065 6e75  for k, fn in enu
+0007d230: 6d65 7261 7465 2866 6e73 293a 0a20 2020  merate(fns):.   
+0007d240: 2020 2020 2069 6620 6b20 3e20 303a 0a20       if k > 0:. 
+0007d250: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
+0007d260: 203d 2066 6e61 6d65 202b 2027 2e27 0a20   = fname + '.'. 
+0007d270: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
+0007d280: 6e61 6d65 202b 2066 6e0a 2020 2020 0a20  name + fn.    . 
+0007d290: 2020 2068 6472 5f6c 7374 2c20 7473 6571     hdr_lst, tseq
+0007d2a0: 5f6c 7374 203d 206c 6f61 645f 6661 7374  _lst = load_fast
+0007d2b0: 6131 2874 725f 6661 2c20 7665 7262 6f73  a1(tr_fa, verbos
+0007d2c0: 6520 3d20 4661 6c73 6529 0a20 2020 2063  e = False).    c
+0007d2d0: 616e 645f 636e 7420 3d20 6c65 6e28 7473  and_cnt = len(ts
+0007d2e0: 6571 5f6c 7374 290a 0a20 2020 206c 696e  eq_lst)..    lin
+0007d2f0: 6573 203d 2067 656e 5f70 726f 7465 6f6d  es = gen_proteom
+0007d300: 655f 6672 6f6d 5f74 7261 7363 7269 7074  e_from_trascript
+0007d310: 6f6d 6528 6864 725f 6c73 742c 2074 7365  ome(hdr_lst, tse
+0007d320: 715f 6c73 742c 206c 656e 5f74 6820 3d20  q_lst, len_th = 
+0007d330: 6c65 6e5f 7468 2c20 7665 7262 6f73 6520  len_th, verbose 
+0007d340: 3d20 7665 7262 6f73 652c 2074 7261 7265  = verbose, trare
+0007d350: 636f 203d 2074 7261 7265 636f 290a 2020  co = trareco).  
+0007d360: 2020 705f 6361 6e64 5f63 6e74 203d 206c    p_cand_cnt = l
+0007d370: 656e 286c 696e 6573 292f 320a 2020 2020  en(lines)/2.    
+0007d380: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
+0007d390: 666e 616d 655f 6f75 7420 6973 204e 6f6e  fname_out is Non
+0007d3a0: 653a 2066 6e61 6d65 5f6f 7574 203d 2066  e: fname_out = f
+0007d3b0: 6e61 6d65 202b 2027 5f70 726f 7465 6f6d  name + '_proteom
+0007d3c0: 652e 6661 270a 2020 2020 6620 3d20 6f70  e.fa'.    f = op
+0007d3d0: 656e 2866 6e61 6d65 5f6f 7574 2c27 772b  en(fname_out,'w+
+0007d3e0: 2729 0a20 2020 2066 2e77 7269 7465 6c69  ').    f.writeli
+0007d3f0: 6e65 7328 6c69 6e65 7329 0a20 2020 2066  nes(lines).    f
+0007d400: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+0007d410: 2020 2020 2020 2020 200a 2020 2020 6966           .    if
+0007d420: 2076 6572 626f 7365 3a20 0a20 2020 2020   verbose: .     
+0007d430: 2020 2070 7269 6e74 2827 4141 5365 7120     print('AASeq 
+0007d440: 7361 7665 6420 746f 2025 7327 2025 2028  saved to %s' % (
+0007d450: 666e 616d 655f 6f75 7429 290a 2020 2020  fname_out)).    
+0007d460: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
+0007d470: 666e 616d 655f 6f75 740a 2727 270a 0a23  fname_out.'''..#
+0007d480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d4a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d4c0: 2323 2323 2323 2323 230a 2323 2053 7472  #########.## Str
+0007d4d0: 696e 6746 6978 2061 6464 6f6e 2773 0a23  ingFix addon's.#
+0007d4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d520: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d530: 2323 230a 2323 2053 7472 696e 6746 6978  ###.## StringFix
-0007d540: 2061 6464 6f6e 2773 0a23 2323 2323 2323   addon's.#######
-0007d550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d590: 2323 230a 0a64 6566 2074 7269 6d5f 6865  ###..def trim_he
-0007d5a0: 6164 6572 2866 6e61 6d65 5f66 6129 3a0a  ader(fname_fa):.
-0007d5b0: 2020 2020 0a20 2020 2066 203d 206f 7065      .    f = ope
-0007d5c0: 6e28 666e 616d 655f 6661 2c20 2772 2729  n(fname_fa, 'r')
-0007d5d0: 0a20 2020 206c 696e 6573 203d 205b 5d0a  .    lines = [].
-0007d5e0: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
-0007d5f0: 666f 7220 6c69 6e65 2069 6e20 663a 0a20  for line in f:. 
-0007d600: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
-0007d610: 5d20 3d3d 2027 3e27 3a0a 2020 2020 2020  ] == '>':.      
-0007d620: 2020 2020 2020 6864 7220 3d20 6c69 6e65        hdr = line
-0007d630: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
-0007d640: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
-0007d650: 7065 6e64 2868 6472 5b30 5d2b 275c 6e27  pend(hdr[0]+'\n'
-0007d660: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0007d670: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0007d680: 732e 6170 7065 6e64 286c 696e 6529 0a20  s.append(line). 
-0007d690: 2020 2066 2e63 6c6f 7365 2829 0a20 2020     f.close().   
-0007d6a0: 200a 2020 2020 6620 3d20 6f70 656e 2866   .    f = open(f
-0007d6b0: 6e61 6d65 5f66 612c 2027 772b 2729 0a20  name_fa, 'w+'). 
-0007d6c0: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
-0007d6d0: 6c69 6e65 7329 0a20 2020 2066 2e63 6c6f  lines).    f.clo
-0007d6e0: 7365 2829 0a20 2020 200a 2020 2020 0a64  se().    .    .d
-0007d6f0: 6566 2074 7269 6d5f 6865 6164 6572 5f61  ef trim_header_a
-0007d700: 6e64 5f61 6464 5f73 7472 616e 645f 696e  nd_add_strand_in
-0007d710: 666f 2866 6e61 6d65 5f66 612c 2067 6666  fo(fname_fa, gff
-0007d720: 5f66 696c 6529 3a0a 2020 2020 0a20 2020  _file):.    .   
-0007d730: 2067 7466 5f6c 696e 6573 2c20 6864 725f   gtf_lines, hdr_
-0007d740: 6c69 6e65 7320 3d20 6c6f 6164 5f67 7466  lines = load_gtf
-0007d750: 2867 6666 5f66 696c 652c 2076 6572 626f  (gff_file, verbo
-0007d760: 7365 203d 2054 7275 6529 0a20 2020 2067  se = True).    g
-0007d770: 7466 5f6c 696e 6573 5f6c 7374 203d 2070  tf_lines_lst = p
-0007d780: 6172 7365 5f67 7466 5f6c 696e 6573 5f61  arse_gtf_lines_a
-0007d790: 6e64 5f73 706c 6974 5f69 6e74 6f5f 6765  nd_split_into_ge
-0007d7a0: 6e65 7328 2067 7466 5f6c 696e 6573 2c20  nes( gtf_lines, 
-0007d7b0: 675f 6f72 5f74 203d 2027 7472 616e 7363  g_or_t = 'transc
-0007d7c0: 7269 7074 272c 2076 6572 626f 7365 203d  ript', verbose =
-0007d7d0: 2046 616c 7365 2029 2020 2020 0a20 2020   False )    .   
-0007d7e0: 2074 645f 6c73 7420 3d20 5b5d 0a20 2020   td_lst = [].   
-0007d7f0: 2066 6f72 206c 696e 6573 2069 6e20 6774   for lines in gt
-0007d800: 665f 6c69 6e65 735f 6c73 743a 0a20 2020  f_lines_lst:.   
-0007d810: 2020 2020 2074 6420 3d20 7472 616e 7363       td = transc
-0007d820: 7269 7074 5f64 6573 6372 6970 746f 7228  ript_descriptor(
-0007d830: 6c69 6e65 7329 0a20 2020 2020 2020 2074  lines).        t
-0007d840: 645f 6c73 742e 6170 7065 6e64 2874 6429  d_lst.append(td)
-0007d850: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0007d860: 2020 6620 3d20 6f70 656e 2866 6e61 6d65    f = open(fname
-0007d870: 5f66 612c 2027 7227 290a 2020 2020 6c69  _fa, 'r').    li
-0007d880: 6e65 7320 3d20 5b5d 0a20 2020 2063 6e74  nes = [].    cnt
-0007d890: 203d 2030 0a20 2020 2066 6f72 206c 696e   = 0.    for lin
-0007d8a0: 6520 696e 2066 3a0a 2020 2020 2020 2020  e in f:.        
-0007d8b0: 6966 206c 696e 655b 305d 203d 3d20 273e  if line[0] == '>
-0007d8c0: 273a 0a20 2020 2020 2020 2020 2020 2068  ':.            h
-0007d8d0: 6472 203d 206c 696e 652e 7370 6c69 7428  dr = line.split(
-0007d8e0: 2720 2729 0a20 2020 2020 2020 2020 2020  ' ').           
-0007d8f0: 206c 696e 6573 2e61 7070 656e 6428 6864   lines.append(hd
-0007d900: 725b 305d 2b27 2073 7472 616e 643a 2569  r[0]+' strand:%i
-0007d910: 5c6e 2720 2520 7464 5f6c 7374 5b63 6e74  \n' % td_lst[cnt
-0007d920: 5d2e 7374 7261 6e64 2029 0a20 2020 2020  ].strand ).     
-0007d930: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
-0007d940: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0007d950: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
-0007d960: 6170 7065 6e64 286c 696e 6529 0a20 2020  append(line).   
-0007d970: 2066 2e63 6c6f 7365 2829 0a20 2020 200a   f.close().    .
-0007d980: 2020 2020 6620 3d20 6f70 656e 2866 6e61      f = open(fna
-0007d990: 6d65 5f66 612c 2027 772b 2729 0a20 2020  me_fa, 'w+').   
-0007d9a0: 2066 2e77 7269 7465 6c69 6e65 7328 6c69   f.writelines(li
-0007d9b0: 6e65 7329 0a20 2020 2066 2e63 6c6f 7365  nes).    f.close
-0007d9c0: 2829 0a0a 2020 2020 6966 2063 6e74 203d  ()..    if cnt =
-0007d9d0: 3d20 6c65 6e28 7464 5f6c 7374 293a 0a20  = len(td_lst):. 
-0007d9e0: 2020 2020 2020 2070 7269 6e74 2827 4641         print('FA
-0007d9f0: 5354 4120 6669 6c65 2067 656e 6572 6174  STA file generat
-0007da00: 6564 2073 7563 6365 7373 6675 6c6c 7927  ed successfully'
-0007da10: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-0007da20: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
-0007da30: 4e47 3a20 2569 207e 3d20 2569 2720 2520  NG: %i ~= %i' % 
-0007da40: 2863 6e74 2c20 6c65 6e28 7464 5f6c 7374  (cnt, len(td_lst
-0007da50: 2929 2029 0a20 2020 2020 2020 200a 2020  )) ).        .  
-0007da60: 2020 2020 2020 0a64 6566 2053 7472 696e        .def Strin
-0007da70: 6746 6978 5f47 4646 5265 6164 2867 7466  gFix_GFFRead(gtf
-0007da80: 5f66 696c 652c 2067 656e 6f6d 655f 6669  _file, genome_fi
-0007da90: 6c65 2c20 6e5f 636f 7265 7320 3d20 3129  le, n_cores = 1)
-0007daa0: 3a0a 2020 2020 0a20 2020 2066 696c 655f  :.    .    file_
-0007dab0: 6e61 6d65 7320 3d20 6774 665f 6669 6c65  names = gtf_file
-0007dac0: 2e73 706c 6974 2827 2e27 290a 2020 2020  .split('.').    
-0007dad0: 666e 616d 6520 3d20 2727 2e6a 6f69 6e28  fname = ''.join(
-0007dae0: 7374 2066 6f72 2073 7420 696e 2066 696c  st for st in fil
-0007daf0: 655f 6e61 6d65 735b 3a2d 315d 2029 0a20  e_names[:-1] ). 
-0007db00: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
-0007db10: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
-0007db20: 6f61 645f 6774 6628 6774 665f 6669 6c65  oad_gtf(gtf_file
-0007db30: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
-0007db40: 290a 2020 2020 6764 5f6c 7374 2c20 6368  ).    gd_lst, ch
-0007db50: 7273 203d 2067 6574 5f67 656e 655f 6465  rs = get_gene_de
-0007db60: 7363 7269 7074 6f72 2867 7466 5f6c 696e  scriptor(gtf_lin
-0007db70: 6573 2c20 6765 6e6f 6d65 203d 204e 6f6e  es, genome = Non
-0007db80: 652c 2066 696c 6c20 3d20 4661 6c73 652c  e, fill = False,
-0007db90: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
-0007dba0: 206e 5f63 6f72 6573 203d 2031 290a 2020   n_cores = 1).  
-0007dbb0: 2020 6764 5f6c 7374 732c 2063 6872 5f6c    gd_lsts, chr_l
-0007dbc0: 7374 203d 2070 6163 6b5f 6765 6e65 5f64  st = pack_gene_d
-0007dbd0: 6573 6372 6970 746f 7228 2067 645f 6c73  escriptor( gd_ls
-0007dbe0: 742c 2063 6872 7320 290a 0a20 2020 2069  t, chrs )..    i
-0007dbf0: 6620 6765 6e6f 6d65 5f66 696c 6520 6973  f genome_file is
-0007dc00: 204e 6f6e 653a 2067 656e 6f6d 6520 3d20   None: genome = 
-0007dc10: 4e6f 6e65 0a20 2020 2065 6c73 653a 2067  None.    else: g
-0007dc20: 656e 6f6d 6520 3d20 6c6f 6164 5f67 656e  enome = load_gen
-0007dc30: 6f6d 6528 6765 6e6f 6d65 5f66 696c 652c  ome(genome_file,
-0007dc40: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
-0007dc50: 0a0a 2020 2020 6661 7374 615f 6c69 6e65  ..    fasta_line
-0007dc60: 7332 203d 205b 5d0a 2020 2020 6661 7374  s2 = [].    fast
-0007dc70: 615f 6c69 6e65 7320 3d20 5b5d 0a20 2020  a_lines = [].   
-0007dc80: 2067 6473 203d 205b 5d0a 2020 2020 666f   gds = [].    fo
-0007dc90: 7220 6764 6c20 696e 2067 645f 6c73 7473  r gdl in gd_lsts
-0007dca0: 3a20 6764 7320 3d20 6764 7320 2b20 6764  : gds = gds + gd
-0007dcb0: 6c0a 2020 2020 2020 2020 0a20 2020 2073  l.        .    s
-0007dcc0: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
-0007dcd0: 2e74 696d 6528 290a 2020 2020 7072 696e  .time().    prin
-0007dce0: 7428 2747 656e 6572 6174 696e 6720 7472  t('Generating tr
-0007dcf0: 616e 7363 7269 7074 6f6d 6520 2e2e 2027  anscriptome .. '
-0007dd00: 2c20 656e 643d 2720 2020 2027 290a 2020  , end='    ').  
-0007dd10: 2020 636e 745f 7472 203d 2030 0a20 2020    cnt_tr = 0.   
-0007dd20: 2063 6e74 5f70 7220 3d20 300a 2020 2020   cnt_pr = 0.    
-0007dd30: 666f 7220 6d2c 2067 6420 696e 2065 6e75  for m, gd in enu
-0007dd40: 6d65 7261 7465 2867 6473 293a 0a20 2020  merate(gds):.   
-0007dd50: 2020 2020 2063 6e74 5f74 2c20 636e 745f       cnt_t, cnt_
-0007dd60: 702c 2063 6e74 5f65 203d 2067 642e 7570  p, cnt_e = gd.up
-0007dd70: 6461 7465 5f74 645f 696e 666f 2867 656e  date_td_info(gen
-0007dd80: 6f6d 652c 2073 656c 203d 2032 2c20 7065  ome, sel = 2, pe
-0007dd90: 7074 6964 6520 3d20 5472 7565 290a 2020  ptide = True).  
-0007dda0: 2020 2020 2020 636e 745f 7472 202b 3d20        cnt_tr += 
-0007ddb0: 636e 745f 740a 2020 2020 2020 2020 636e  cnt_t.        cn
-0007ddc0: 745f 7072 202b 3d20 636e 745f 700a 2020  t_pr += cnt_p.  
-0007ddd0: 2020 2020 2020 2320 6764 2e6f 7264 6572        # gd.order
-0007dde0: 2829 0a20 2020 2020 2020 206c 312c 206c  ().        l1, l
-0007ddf0: 3220 3d20 6764 2e67 6574 5f66 6173 7461  2 = gd.get_fasta
-0007de00: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
-0007de10: 7328 6765 6e6f 6d65 2c20 7365 6c20 3d20  s(genome, sel = 
-0007de20: 322c 2070 6570 7469 6465 203d 2054 7275  2, peptide = Tru
-0007de30: 6529 0a20 2020 2020 2020 2066 6173 7461  e).        fasta
-0007de40: 5f6c 696e 6573 203d 2066 6173 7461 5f6c  _lines = fasta_l
-0007de50: 696e 6573 202b 206c 310a 2020 2020 2020  ines + l1.      
-0007de60: 2020 6661 7374 615f 6c69 6e65 7332 203d    fasta_lines2 =
-0007de70: 2066 6173 7461 5f6c 696e 6573 3220 2b20   fasta_lines2 + 
-0007de80: 6c32 0a20 2020 2020 2020 2069 6620 6d25  l2.        if m%
-0007de90: 3130 3020 3d3d 2030 3a20 7072 696e 7428  100 == 0: print(
-0007dea0: 275c 7247 656e 6572 6174 696e 6720 7472  '\rGenerating tr
-0007deb0: 616e 7363 7269 7074 6f6d 6520 2e2e 2025  anscriptome .. %
-0007dec0: 692f 2569 2028 2569 2c25 6929 2720 2520  i/%i (%i,%i)' % 
-0007ded0: 286d 2c20 6c65 6e28 6764 7329 2c20 636e  (m, len(gds), cn
-0007dee0: 745f 7472 2c20 636e 745f 7072 292c 2065  t_tr, cnt_pr), e
-0007def0: 6e64 3d27 2020 2020 2729 0a20 2020 2065  nd='    ').    e
-0007df00: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
-0007df10: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-0007df20: 745f 7469 6d65 0a20 2020 2070 7269 6e74  t_time.    print
-0007df30: 2827 5c72 4765 6e65 7261 7469 6e67 2074  ('\rGenerating t
-0007df40: 7261 6e73 6372 6970 746f 6d65 202e 2e20  ranscriptome .. 
-0007df50: 2569 2064 6f6e 6520 696e 2025 6928 7329  %i done in %i(s)
-0007df60: 2028 2569 2c25 6929 2720 2520 286c 656e   (%i,%i)' % (len
-0007df70: 2867 6473 292c 2065 6c61 7073 6564 5f74  (gds), elapsed_t
-0007df80: 696d 652c 2063 6e74 5f74 722c 2063 6e74  ime, cnt_tr, cnt
-0007df90: 5f70 7229 290a 0a20 2020 2070 7269 6e74  _pr))..    print
-0007dfa0: 2827 5361 7669 6e67 202e 2e20 2569 2074  ('Saving .. %i t
-0007dfb0: 7273 2c20 2569 2070 7273 2720 2520 286c  rs, %i prs' % (l
-0007dfc0: 656e 2866 6173 7461 5f6c 696e 6573 292f  en(fasta_lines)/
-0007dfd0: 322c 206c 656e 2866 6173 7461 5f6c 696e  2, len(fasta_lin
-0007dfe0: 6573 3229 2f32 2920 2c20 656e 6420 3d20  es2)/2) , end = 
-0007dff0: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-0007e000: 290a 2020 2020 666e 616d 655f 7472 203d  ).    fname_tr =
-0007e010: 2066 6e61 6d65 202b 2027 5f74 7261 6e73   fname + '_trans
-0007e020: 6372 6970 746f 6d65 2e66 6127 0a20 2020  criptome.fa'.   
-0007e030: 2066 203d 206f 7065 6e28 666e 616d 655f   f = open(fname_
-0007e040: 7472 2c20 2777 2b27 290a 2020 2020 662e  tr, 'w+').    f.
-0007e050: 7772 6974 656c 696e 6573 2866 6173 7461  writelines(fasta
-0007e060: 5f6c 696e 6573 290a 2020 2020 662e 636c  _lines).    f.cl
-0007e070: 6f73 6528 290a 0a20 2020 2066 6e61 6d65  ose()..    fname
-0007e080: 5f70 7220 3d20 666e 616d 6520 2b20 275f  _pr = fname + '_
-0007e090: 7072 6f74 656f 6d65 2e66 6127 0a20 2020  proteome.fa'.   
-0007e0a0: 2066 203d 206f 7065 6e28 666e 616d 655f   f = open(fname_
-0007e0b0: 7072 2c20 2777 2b27 290a 2020 2020 662e  pr, 'w+').    f.
-0007e0c0: 7772 6974 656c 696e 6573 2866 6173 7461  writelines(fasta
-0007e0d0: 5f6c 696e 6573 3229 0a20 2020 2066 2e63  _lines2).    f.c
-0007e0e0: 6c6f 7365 2829 0a0a 2020 2020 7072 696e  lose()..    prin
-0007e0f0: 7428 2720 646f 6e65 2e27 290a 2020 2020  t(' done.').    
-0007e100: 7072 696e 7428 2720 2020 2573 2720 2520  print('   %s' % 
-0007e110: 2866 6e61 6d65 5f74 7229 2029 0a20 2020  (fname_tr) ).   
-0007e120: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
-0007e130: 2028 666e 616d 655f 7072 2920 290a 0a20   (fname_pr) ).. 
-0007e140: 2020 2072 6574 7572 6e28 666e 616d 6529     return(fname)
-0007e150: 0a0a 0a23 2323 2323 2323 2323 2323 2323  ...#############
+0007d520: 2323 2323 2323 2323 230a 0a64 6566 2074  #########..def t
+0007d530: 7269 6d5f 6865 6164 6572 2866 6e61 6d65  rim_header(fname
+0007d540: 5f66 6129 3a0a 2020 2020 0a20 2020 2066  _fa):.    .    f
+0007d550: 203d 206f 7065 6e28 666e 616d 655f 6661   = open(fname_fa
+0007d560: 2c20 2772 2729 0a20 2020 206c 696e 6573  , 'r').    lines
+0007d570: 203d 205b 5d0a 2020 2020 636e 7420 3d20   = [].    cnt = 
+0007d580: 300a 2020 2020 666f 7220 6c69 6e65 2069  0.    for line i
+0007d590: 6e20 663a 0a20 2020 2020 2020 2069 6620  n f:.        if 
+0007d5a0: 6c69 6e65 5b30 5d20 3d3d 2027 3e27 3a0a  line[0] == '>':.
+0007d5b0: 2020 2020 2020 2020 2020 2020 6864 7220              hdr 
+0007d5c0: 3d20 6c69 6e65 2e73 706c 6974 2827 2027  = line.split(' '
+0007d5d0: 290a 2020 2020 2020 2020 2020 2020 6c69  ).            li
+0007d5e0: 6e65 732e 6170 7065 6e64 2868 6472 5b30  nes.append(hdr[0
+0007d5f0: 5d2b 275c 6e27 290a 2020 2020 2020 2020  ]+'\n').        
+0007d600: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0007d610: 2020 6c69 6e65 732e 6170 7065 6e64 286c    lines.append(l
+0007d620: 696e 6529 0a20 2020 2066 2e63 6c6f 7365  ine).    f.close
+0007d630: 2829 0a20 2020 200a 2020 2020 6620 3d20  ().    .    f = 
+0007d640: 6f70 656e 2866 6e61 6d65 5f66 612c 2027  open(fname_fa, '
+0007d650: 772b 2729 0a20 2020 2066 2e77 7269 7465  w+').    f.write
+0007d660: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
+0007d670: 2066 2e63 6c6f 7365 2829 0a20 2020 200a   f.close().    .
+0007d680: 2020 2020 0a64 6566 2074 7269 6d5f 6865      .def trim_he
+0007d690: 6164 6572 5f61 6e64 5f61 6464 5f73 7472  ader_and_add_str
+0007d6a0: 616e 645f 696e 666f 2866 6e61 6d65 5f66  and_info(fname_f
+0007d6b0: 612c 2067 6666 5f66 696c 6529 3a0a 2020  a, gff_file):.  
+0007d6c0: 2020 0a20 2020 2067 7466 5f6c 696e 6573    .    gtf_lines
+0007d6d0: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
+0007d6e0: 6164 5f67 7466 2867 6666 5f66 696c 652c  ad_gtf(gff_file,
+0007d6f0: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
+0007d700: 0a20 2020 2067 7466 5f6c 696e 6573 5f6c  .    gtf_lines_l
+0007d710: 7374 203d 2070 6172 7365 5f67 7466 5f6c  st = parse_gtf_l
+0007d720: 696e 6573 5f61 6e64 5f73 706c 6974 5f69  ines_and_split_i
+0007d730: 6e74 6f5f 6765 6e65 7328 2067 7466 5f6c  nto_genes( gtf_l
+0007d740: 696e 6573 2c20 675f 6f72 5f74 203d 2027  ines, g_or_t = '
+0007d750: 7472 616e 7363 7269 7074 272c 2076 6572  transcript', ver
+0007d760: 626f 7365 203d 2046 616c 7365 2029 2020  bose = False )  
+0007d770: 2020 0a20 2020 2074 645f 6c73 7420 3d20    .    td_lst = 
+0007d780: 5b5d 0a20 2020 2066 6f72 206c 696e 6573  [].    for lines
+0007d790: 2069 6e20 6774 665f 6c69 6e65 735f 6c73   in gtf_lines_ls
+0007d7a0: 743a 0a20 2020 2020 2020 2074 6420 3d20  t:.        td = 
+0007d7b0: 7472 616e 7363 7269 7074 5f64 6573 6372  transcript_descr
+0007d7c0: 6970 746f 7228 6c69 6e65 7329 0a20 2020  iptor(lines).   
+0007d7d0: 2020 2020 2074 645f 6c73 742e 6170 7065       td_lst.appe
+0007d7e0: 6e64 2874 6429 0a20 2020 2020 2020 2020  nd(td).         
+0007d7f0: 2020 200a 2020 2020 6620 3d20 6f70 656e     .    f = open
+0007d800: 2866 6e61 6d65 5f66 612c 2027 7227 290a  (fname_fa, 'r').
+0007d810: 2020 2020 6c69 6e65 7320 3d20 5b5d 0a20      lines = []. 
+0007d820: 2020 2063 6e74 203d 2030 0a20 2020 2066     cnt = 0.    f
+0007d830: 6f72 206c 696e 6520 696e 2066 3a0a 2020  or line in f:.  
+0007d840: 2020 2020 2020 6966 206c 696e 655b 305d        if line[0]
+0007d850: 203d 3d20 273e 273a 0a20 2020 2020 2020   == '>':.       
+0007d860: 2020 2020 2068 6472 203d 206c 696e 652e       hdr = line.
+0007d870: 7370 6c69 7428 2720 2729 0a20 2020 2020  split(' ').     
+0007d880: 2020 2020 2020 206c 696e 6573 2e61 7070         lines.app
+0007d890: 656e 6428 6864 725b 305d 2b27 2073 7472  end(hdr[0]+' str
+0007d8a0: 616e 643a 2569 5c6e 2720 2520 7464 5f6c  and:%i\n' % td_l
+0007d8b0: 7374 5b63 6e74 5d2e 7374 7261 6e64 2029  st[cnt].strand )
+0007d8c0: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
+0007d8d0: 202b 3d20 310a 2020 2020 2020 2020 656c   += 1.        el
+0007d8e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0007d8f0: 6c69 6e65 732e 6170 7065 6e64 286c 696e  lines.append(lin
+0007d900: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
+0007d910: 0a20 2020 200a 2020 2020 6620 3d20 6f70  .    .    f = op
+0007d920: 656e 2866 6e61 6d65 5f66 612c 2027 772b  en(fname_fa, 'w+
+0007d930: 2729 0a20 2020 2066 2e77 7269 7465 6c69  ').    f.writeli
+0007d940: 6e65 7328 6c69 6e65 7329 0a20 2020 2066  nes(lines).    f
+0007d950: 2e63 6c6f 7365 2829 0a0a 2020 2020 6966  .close()..    if
+0007d960: 2063 6e74 203d 3d20 6c65 6e28 7464 5f6c   cnt == len(td_l
+0007d970: 7374 293a 0a20 2020 2020 2020 2070 7269  st):.        pri
+0007d980: 6e74 2827 4641 5354 4120 6669 6c65 2067  nt('FASTA file g
+0007d990: 656e 6572 6174 6564 2073 7563 6365 7373  enerated success
+0007d9a0: 6675 6c6c 7927 290a 2020 2020 656c 7365  fully').    else
+0007d9b0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+0007d9c0: 2757 4152 4e49 4e47 3a20 2569 207e 3d20  'WARNING: %i ~= 
+0007d9d0: 2569 2720 2520 2863 6e74 2c20 6c65 6e28  %i' % (cnt, len(
+0007d9e0: 7464 5f6c 7374 2929 2029 0a20 2020 2020  td_lst)) ).     
+0007d9f0: 2020 200a 2020 2020 2020 2020 0a64 6566     .        .def
+0007da00: 2053 7472 696e 6746 6978 5f47 4646 5265   StringFix_GFFRe
+0007da10: 6164 2867 7466 5f66 696c 652c 2067 656e  ad(gtf_file, gen
+0007da20: 6f6d 655f 6669 6c65 2c20 6e5f 636f 7265  ome_file, n_core
+0007da30: 7320 3d20 3129 3a0a 2020 2020 0a20 2020  s = 1):.    .   
+0007da40: 2066 696c 655f 6e61 6d65 7320 3d20 6774   file_names = gt
+0007da50: 665f 6669 6c65 2e73 706c 6974 2827 2e27  f_file.split('.'
+0007da60: 290a 2020 2020 666e 616d 6520 3d20 2727  ).    fname = ''
+0007da70: 2e6a 6f69 6e28 7374 2066 6f72 2073 7420  .join(st for st 
+0007da80: 696e 2066 696c 655f 6e61 6d65 735b 3a2d  in file_names[:-
+0007da90: 315d 2029 0a20 2020 200a 2020 2020 6774  1] ).    .    gt
+0007daa0: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
+0007dab0: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
+0007dac0: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
+0007dad0: 3d20 5472 7565 290a 2020 2020 6764 5f6c  = True).    gd_l
+0007dae0: 7374 2c20 6368 7273 203d 2067 6574 5f67  st, chrs = get_g
+0007daf0: 656e 655f 6465 7363 7269 7074 6f72 2867  ene_descriptor(g
+0007db00: 7466 5f6c 696e 6573 2c20 6765 6e6f 6d65  tf_lines, genome
+0007db10: 203d 204e 6f6e 652c 2066 696c 6c20 3d20   = None, fill = 
+0007db20: 4661 6c73 652c 2076 6572 626f 7365 203d  False, verbose =
+0007db30: 2054 7275 652c 206e 5f63 6f72 6573 203d   True, n_cores =
+0007db40: 2031 290a 2020 2020 6764 5f6c 7374 732c   1).    gd_lsts,
+0007db50: 2063 6872 5f6c 7374 203d 2070 6163 6b5f   chr_lst = pack_
+0007db60: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
+0007db70: 2067 645f 6c73 742c 2063 6872 7320 290a   gd_lst, chrs ).
+0007db80: 0a20 2020 2069 6620 6765 6e6f 6d65 5f66  .    if genome_f
+0007db90: 696c 6520 6973 204e 6f6e 653a 2067 656e  ile is None: gen
+0007dba0: 6f6d 6520 3d20 4e6f 6e65 0a20 2020 2065  ome = None.    e
+0007dbb0: 6c73 653a 2067 656e 6f6d 6520 3d20 6c6f  lse: genome = lo
+0007dbc0: 6164 5f67 656e 6f6d 6528 6765 6e6f 6d65  ad_genome(genome
+0007dbd0: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
+0007dbe0: 2054 7275 6529 0a0a 2020 2020 6661 7374   True)..    fast
+0007dbf0: 615f 6c69 6e65 7332 203d 205b 5d0a 2020  a_lines2 = [].  
+0007dc00: 2020 6661 7374 615f 6c69 6e65 7320 3d20    fasta_lines = 
+0007dc10: 5b5d 0a20 2020 2067 6473 203d 205b 5d0a  [].    gds = [].
+0007dc20: 2020 2020 666f 7220 6764 6c20 696e 2067      for gdl in g
+0007dc30: 645f 6c73 7473 3a20 6764 7320 3d20 6764  d_lsts: gds = gd
+0007dc40: 7320 2b20 6764 6c0a 2020 2020 2020 2020  s + gdl.        
+0007dc50: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
+0007dc60: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
+0007dc70: 2020 7072 696e 7428 2747 656e 6572 6174    print('Generat
+0007dc80: 696e 6720 7472 616e 7363 7269 7074 6f6d  ing transcriptom
+0007dc90: 6520 2e2e 2027 2c20 656e 643d 2720 2020  e .. ', end='   
+0007dca0: 2027 290a 2020 2020 636e 745f 7472 203d   ').    cnt_tr =
+0007dcb0: 2030 0a20 2020 2063 6e74 5f70 7220 3d20   0.    cnt_pr = 
+0007dcc0: 300a 2020 2020 666f 7220 6d2c 2067 6420  0.    for m, gd 
+0007dcd0: 696e 2065 6e75 6d65 7261 7465 2867 6473  in enumerate(gds
+0007dce0: 293a 0a20 2020 2020 2020 2063 6e74 5f74  ):.        cnt_t
+0007dcf0: 2c20 636e 745f 702c 2063 6e74 5f65 203d  , cnt_p, cnt_e =
+0007dd00: 2067 642e 7570 6461 7465 5f74 645f 696e   gd.update_td_in
+0007dd10: 666f 2867 656e 6f6d 652c 2073 656c 203d  fo(genome, sel =
+0007dd20: 2032 2c20 7065 7074 6964 6520 3d20 5472   2, peptide = Tr
+0007dd30: 7565 290a 2020 2020 2020 2020 636e 745f  ue).        cnt_
+0007dd40: 7472 202b 3d20 636e 745f 740a 2020 2020  tr += cnt_t.    
+0007dd50: 2020 2020 636e 745f 7072 202b 3d20 636e      cnt_pr += cn
+0007dd60: 745f 700a 2020 2020 2020 2020 2320 6764  t_p.        # gd
+0007dd70: 2e6f 7264 6572 2829 0a20 2020 2020 2020  .order().       
+0007dd80: 206c 312c 206c 3220 3d20 6764 2e67 6574   l1, l2 = gd.get
+0007dd90: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
+0007dda0: 6d5f 6578 6f6e 7328 6765 6e6f 6d65 2c20  m_exons(genome, 
+0007ddb0: 7365 6c20 3d20 322c 2070 6570 7469 6465  sel = 2, peptide
+0007ddc0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+0007ddd0: 2066 6173 7461 5f6c 696e 6573 203d 2066   fasta_lines = f
+0007dde0: 6173 7461 5f6c 696e 6573 202b 206c 310a  asta_lines + l1.
+0007ddf0: 2020 2020 2020 2020 6661 7374 615f 6c69          fasta_li
+0007de00: 6e65 7332 203d 2066 6173 7461 5f6c 696e  nes2 = fasta_lin
+0007de10: 6573 3220 2b20 6c32 0a20 2020 2020 2020  es2 + l2.       
+0007de20: 2069 6620 6d25 3130 3020 3d3d 2030 3a20   if m%100 == 0: 
+0007de30: 7072 696e 7428 275c 7247 656e 6572 6174  print('\rGenerat
+0007de40: 696e 6720 7472 616e 7363 7269 7074 6f6d  ing transcriptom
+0007de50: 6520 2e2e 2025 692f 2569 2028 2569 2c25  e .. %i/%i (%i,%
+0007de60: 6929 2720 2520 286d 2c20 6c65 6e28 6764  i)' % (m, len(gd
+0007de70: 7329 2c20 636e 745f 7472 2c20 636e 745f  s), cnt_tr, cnt_
+0007de80: 7072 292c 2065 6e64 3d27 2020 2020 2729  pr), end='    ')
+0007de90: 0a20 2020 2065 6c61 7073 6564 5f74 696d  .    elapsed_tim
+0007dea0: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
+0007deb0: 2d20 7374 6172 745f 7469 6d65 0a20 2020  - start_time.   
+0007dec0: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
+0007ded0: 7469 6e67 2074 7261 6e73 6372 6970 746f  ting transcripto
+0007dee0: 6d65 202e 2e20 2569 2064 6f6e 6520 696e  me .. %i done in
+0007def0: 2025 6928 7329 2028 2569 2c25 6929 2720   %i(s) (%i,%i)' 
+0007df00: 2520 286c 656e 2867 6473 292c 2065 6c61  % (len(gds), ela
+0007df10: 7073 6564 5f74 696d 652c 2063 6e74 5f74  psed_time, cnt_t
+0007df20: 722c 2063 6e74 5f70 7229 290a 0a20 2020  r, cnt_pr))..   
+0007df30: 2070 7269 6e74 2827 5361 7669 6e67 202e   print('Saving .
+0007df40: 2e20 2569 2074 7273 2c20 2569 2070 7273  . %i trs, %i prs
+0007df50: 2720 2520 286c 656e 2866 6173 7461 5f6c  ' % (len(fasta_l
+0007df60: 696e 6573 292f 322c 206c 656e 2866 6173  ines)/2, len(fas
+0007df70: 7461 5f6c 696e 6573 3229 2f32 2920 2c20  ta_lines2)/2) , 
+0007df80: 656e 6420 3d20 2727 2c20 666c 7573 6820  end = '', flush 
+0007df90: 3d20 5472 7565 290a 2020 2020 666e 616d  = True).    fnam
+0007dfa0: 655f 7472 203d 2066 6e61 6d65 202b 2027  e_tr = fname + '
+0007dfb0: 5f74 7261 6e73 6372 6970 746f 6d65 2e66  _transcriptome.f
+0007dfc0: 6127 0a20 2020 2066 203d 206f 7065 6e28  a'.    f = open(
+0007dfd0: 666e 616d 655f 7472 2c20 2777 2b27 290a  fname_tr, 'w+').
+0007dfe0: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
+0007dff0: 2866 6173 7461 5f6c 696e 6573 290a 2020  (fasta_lines).  
+0007e000: 2020 662e 636c 6f73 6528 290a 0a20 2020    f.close()..   
+0007e010: 2066 6e61 6d65 5f70 7220 3d20 666e 616d   fname_pr = fnam
+0007e020: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
+0007e030: 6127 0a20 2020 2066 203d 206f 7065 6e28  a'.    f = open(
+0007e040: 666e 616d 655f 7072 2c20 2777 2b27 290a  fname_pr, 'w+').
+0007e050: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
+0007e060: 2866 6173 7461 5f6c 696e 6573 3229 0a20  (fasta_lines2). 
+0007e070: 2020 2066 2e63 6c6f 7365 2829 0a0a 2020     f.close()..  
+0007e080: 2020 7072 696e 7428 2720 646f 6e65 2e27    print(' done.'
+0007e090: 290a 2020 2020 7072 696e 7428 2720 2020  ).    print('   
+0007e0a0: 2573 2720 2520 2866 6e61 6d65 5f74 7229  %s' % (fname_tr)
+0007e0b0: 2029 0a20 2020 2070 7269 6e74 2827 2020   ).    print('  
+0007e0c0: 2025 7327 2025 2028 666e 616d 655f 7072   %s' % (fname_pr
+0007e0d0: 2920 290a 0a20 2020 2072 6574 7572 6e28  ) )..    return(
+0007e0e0: 666e 616d 6529 0a0a 0a23 2323 2323 2323  fname)...#######
+0007e0f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e130: 2323 230a 2323 2053 7472 696e 6746 6978  ###.## StringFix
+0007e140: 2d73 796e 7468 6573 6973 0a23 2323 2323  -synthesis.#####
+0007e150: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e160: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e190: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
-0007e1a0: 2053 7472 696e 6746 6978 2d73 796e 7468   StringFix-synth
-0007e1b0: 6573 6973 0a23 2323 2323 2323 2323 2323  esis.###########
-0007e1c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e1d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e1e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e1f0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-0007e200: 0a53 4e56 5f69 6e66 6f20 3d20 636f 6c6c  .SNV_info = coll
-0007e210: 6563 7469 6f6e 732e 6e61 6d65 6474 7570  ections.namedtup
-0007e220: 6c65 2827 534e 565f 696e 666f 272c 2027  le('SNV_info', '
-0007e230: 6368 722c 2070 6f73 5f72 6566 2c20 706f  chr, pos_ref, po
-0007e240: 735f 6e65 772c 2067 656e 655f 6964 2c20  s_new, gene_id, 
-0007e250: 6765 6e65 5f6e 616d 652c 2076 5f74 7970  gene_name, v_typ
-0007e260: 652c 2076 5f6c 656e 2c20 6376 675f 6465  e, v_len, cvg_de
-0007e270: 7074 682c 2063 7667 5f66 7261 632c 205c  pth, cvg_frac, \
-0007e280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e2a0: 2020 2020 7265 665f 7072 6576 2c20 7265      ref_prev, re
-0007e2b0: 665f 7365 712c 2072 6566 5f6e 6578 742c  f_seq, ref_next,
-0007e2c0: 2061 6c74 5f70 7265 762c 2061 6c74 5f73   alt_prev, alt_s
-0007e2d0: 6571 2c20 616c 745f 6e65 7874 2729 2023  eq, alt_next') #
-0007e2e0: 206f 6e65 2d62 6173 650a 0a4e 5749 4e20   one-base..NWIN 
-0007e2f0: 3d20 330a 6465 6620 6669 6e64 5f73 6e70  = 3.def find_snp
-0007e300: 5f6f 6c64 2873 672c 2073 722c 2063 722c  _old(sg, sr, cr,
-0007e310: 2063 6872 6d2c 2070 6f73 5f61 6273 2c20   chrm, pos_abs, 
-0007e320: 6f73 2c20 6769 6e29 3a0a 2020 2020 0a20  os, gin):.    . 
-0007e330: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
-0007e340: 3d20 5b5d 0a20 2020 206c 656e 5f74 6f5f  = [].    len_to_
-0007e350: 7465 7374 203d 206d 696e 286c 656e 2873  test = min(len(s
-0007e360: 7229 2c6c 656e 2873 6729 290a 0a20 2020  r),len(sg))..   
-0007e370: 2073 7461 7274 203d 2030 0a20 2020 2065   start = 0.    e
-0007e380: 6e64 203d 206d 696e 2820 3130 302c 206c  nd = min( 100, l
-0007e390: 656e 5f74 6f5f 7465 7374 2029 0a20 2020  en_to_test ).   
-0007e3a0: 204e 203d 2069 6e74 286e 702e 6365 696c   N = int(np.ceil
-0007e3b0: 2820 6c65 6e5f 746f 5f74 6573 742f 3130  ( len_to_test/10
-0007e3c0: 3020 2929 0a20 2020 2023 2727 270a 2020  0 )).    #'''.  
-0007e3d0: 2020 666f 7220 6e20 696e 2072 616e 6765    for n in range
-0007e3e0: 284e 293a 0a20 2020 2020 2020 200a 2020  (N):.        .  
-0007e3f0: 2020 2020 2020 6966 2073 675b 7374 6172        if sg[star
-0007e400: 743a 656e 645d 2021 3d20 7372 5b73 7461  t:end] != sr[sta
-0007e410: 7274 3a65 6e64 5d3a 0a0a 2020 2020 2020  rt:end]:..      
-0007e420: 2020 2020 2020 7020 3d20 300a 2020 2020        p = 0.    
-0007e430: 2020 2020 2020 2020 706f 735f 6c73 7420          pos_lst 
-0007e440: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0007e450: 206c 656e 5f6c 7374 203d 205b 5d0a 2020   len_lst = [].  
-0007e460: 2020 2020 2020 2020 2020 6376 675f 6c73            cvg_ls
-0007e470: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
-0007e480: 2020 2073 6e70 5f6c 7374 203d 205b 5d0a     snp_lst = [].
-0007e490: 2020 2020 2020 2020 2020 2020 736e 705f              snp_
-0007e4a0: 6f72 675f 6c73 7420 3d20 5b5d 0a20 2020  org_lst = [].   
-0007e4b0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007e4c0: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
-0007e4d0: 616e 6765 2873 7461 7274 2c20 656e 6429  ange(start, end)
-0007e4e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007e4f0: 2020 6966 2073 725b 6b5d 2021 3d20 7367    if sr[k] != sg
-0007e500: 5b6b 5d3a 0a20 2020 2020 2020 2020 2020  [k]:.           
-0007e510: 2020 2020 2020 2020 2069 6620 7020 3d3d           if p ==
-0007e520: 2030 3a20 706f 7320 3d20 6b0a 2020 2020   0: pos = k.    
-0007e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e540: 7020 2b3d 2031 0a20 2020 2020 2020 2020  p += 1.         
-0007e550: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0007e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e570: 2069 6620 7020 3e20 303a 0a20 2020 2020   if p > 0:.     
-0007e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e590: 2020 2023 2063 7667 5f6c 7374 2e61 7070     # cvg_lst.app
-0007e5a0: 656e 6428 6e70 2e6d 6561 6e28 2063 725b  end(np.mean( cr[
-0007e5b0: 706f 733a 2870 6f73 2b70 295d 2029 2029  pos:(pos+p)] ) )
-0007e5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e5d0: 2020 2020 2020 2020 2023 2073 6e70 5f6c           # snp_l
-0007e5e0: 7374 2e61 7070 656e 6428 7372 5b70 6f73  st.append(sr[pos
-0007e5f0: 3a28 706f 732b 7029 5d29 0a20 2020 2020  :(pos+p)]).     
-0007e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e610: 2020 2070 6f73 5f6c 7374 2e61 7070 656e     pos_lst.appen
-0007e620: 6428 706f 7329 0a20 2020 2020 2020 2020  d(pos).         
-0007e630: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0007e640: 656e 5f6c 7374 2e61 7070 656e 6428 7029  en_lst.append(p)
-0007e650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e660: 2020 2020 2020 2020 2023 2073 6e70 5f6f           # snp_o
-0007e670: 7267 5f6c 7374 2e61 7070 656e 6428 7367  rg_lst.append(sg
-0007e680: 5b70 6f73 3a28 706f 732b 7029 5d29 0a20  [pos:(pos+p)]). 
-0007e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e6a0: 2020 2020 2020 2070 203d 2030 0a20 2020         p = 0.   
-0007e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e6c0: 200a 2020 2020 2020 2020 2020 2020 666f   .            fo
-0007e6d0: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
-0007e6e0: 2870 6f73 5f6c 7374 2929 3a0a 2020 2020  (pos_lst)):.    
-0007e6f0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007e700: 2020 2020 2020 2020 2020 2020 2070 3120               p1 
-0007e710: 3d20 6d61 7828 302c 2870 6f73 5f6c 7374  = max(0,(pos_lst
-0007e720: 5b6b 5d2d 4e57 494e 2929 0a20 2020 2020  [k]-NWIN)).     
-0007e730: 2020 2020 2020 2020 2020 2070 3220 3d20             p2 = 
-0007e740: 6d69 6e28 6c65 6e5f 746f 5f74 6573 742c  min(len_to_test,
-0007e750: 2870 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f  (pos_lst[k]+len_
-0007e760: 6c73 745b 6b5d 2b4e 5749 4e29 290a 2020  lst[k]+NWIN)).  
-0007e770: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0007e780: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0007e790: 6f70 203d 2073 675b 7031 3a70 6f73 5f6c  op = sg[p1:pos_l
-0007e7a0: 7374 5b6b 5d5d 0a20 2020 2020 2020 2020  st[k]].         
-0007e7b0: 2020 2020 2020 2073 6f63 203d 2073 675b         soc = sg[
-0007e7c0: 706f 735f 6c73 745b 6b5d 3a28 706f 735f  pos_lst[k]:(pos_
-0007e7d0: 6c73 745b 6b5d 2b6c 656e 5f6c 7374 5b6b  lst[k]+len_lst[k
-0007e7e0: 5d29 5d0a 2020 2020 2020 2020 2020 2020  ])].            
-0007e7f0: 2020 2020 736f 6e20 3d20 7367 5b28 706f      son = sg[(po
-0007e800: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
-0007e810: 5b6b 5d29 3a70 325d 0a20 2020 2020 2020  [k]):p2].       
-0007e820: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007e830: 2020 2020 2020 2020 2020 736e 7020 3d20            snp = 
-0007e840: 7372 5b70 313a 706f 735f 6c73 745b 6b5d  sr[p1:pos_lst[k]
-0007e850: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0007e860: 2020 736e 6320 3d20 7372 5b70 6f73 5f6c    snc = sr[pos_l
-0007e870: 7374 5b6b 5d3a 2870 6f73 5f6c 7374 5b6b  st[k]:(pos_lst[k
-0007e880: 5d2b 6c65 6e5f 6c73 745b 6b5d 295d 0a20  ]+len_lst[k])]. 
-0007e890: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0007e8a0: 6e6e 203d 2073 725b 2870 6f73 5f6c 7374  nn = sr[(pos_lst
-0007e8b0: 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d 293a  [k]+len_lst[k]):
-0007e8c0: 7032 5d0a 2020 2020 2020 2020 2020 2020  p2].            
-0007e8d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007e8e0: 2020 2020 2073 6920 3d20 534e 565f 696e       si = SNV_in
-0007e8f0: 666f 2863 6872 6d2c 2070 6f73 5f6c 7374  fo(chrm, pos_lst
-0007e900: 5b6b 5d2b 706f 735f 6162 732c 2070 6f73  [k]+pos_abs, pos
-0007e910: 5f6c 7374 5b6b 5d2b 706f 735f 6162 732b  _lst[k]+pos_abs+
-0007e920: 6f73 2c20 6769 6e5b 305d 2c20 6769 6e5b  os, gin[0], gin[
-0007e930: 315d 2c20 2756 272c 206c 656e 5f6c 7374  1], 'V', len_lst
-0007e940: 5b6b 5d2c 205c 0a20 2020 2020 2020 2020  [k], \.         
-0007e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e960: 2020 2020 2069 6e74 2863 725b 706f 735f       int(cr[pos_
-0007e970: 6c73 745b 6b5d 5d29 2c20 312c 2073 6f70  lst[k]]), 1, sop
-0007e980: 2c20 736f 632c 2073 6f6e 2c20 736e 702c  , soc, son, snp,
-0007e990: 2073 6e63 2c20 736e 6e20 290a 2020 2020   snc, snn ).    
-0007e9a0: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
-0007e9b0: 696e 666f 5f6c 7374 2e61 7070 656e 6428  info_lst.append(
-0007e9c0: 7369 290a 0a20 2020 2020 2020 2073 7461  si)..        sta
-0007e9d0: 7274 203d 2065 6e64 0a20 2020 2020 2020  rt = end.       
-0007e9e0: 2065 6e64 203d 206d 696e 2820 656e 6420   end = min( end 
-0007e9f0: 2b20 3130 302c 206c 656e 5f74 6f5f 7465  + 100, len_to_te
-0007ea00: 7374 2029 0a20 2020 2023 2727 2720 2020  st ).    #'''   
-0007ea10: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-0007ea20: 6e28 736e 765f 696e 666f 5f6c 7374 290a  n(snv_info_lst).
-0007ea30: 0a0a 6465 6620 6669 6e64 5f73 6e70 2873  ..def find_snp(s
-0007ea40: 672c 2073 722c 2063 6d61 742c 2063 6872  g, sr, cmat, chr
-0007ea50: 6d2c 2070 6f73 5f61 6273 2c20 6f73 2c20  m, pos_abs, os, 
-0007ea60: 6769 6e29 3a0a 2020 2020 0a20 2020 2073  gin):.    .    s
-0007ea70: 6e76 5f69 6e66 6f5f 6c73 7420 3d20 5b5d  nv_info_lst = []
-0007ea80: 0a20 2020 206c 656e 5f74 6f5f 7465 7374  .    len_to_test
-0007ea90: 203d 206d 696e 286c 656e 2873 7229 2c6c   = min(len(sr),l
-0007eaa0: 656e 2873 6729 290a 0a20 2020 2063 7220  en(sg))..    cr 
-0007eab0: 3d20 636d 6174 2e73 756d 2861 7869 7320  = cmat.sum(axis 
-0007eac0: 3d20 3029 0a20 2020 206e 7320 3d20 6e70  = 0).    ns = np
-0007ead0: 2e61 7267 6d61 7828 2063 6d61 742c 2061  .argmax( cmat, a
-0007eae0: 7869 733d 3020 290a 2020 2020 7072 203d  xis=0 ).    pr =
-0007eaf0: 2063 6d61 745b 6e73 2c6e 702e 6172 616e   cmat[ns,np.aran
-0007eb00: 6765 286c 656e 286e 7329 295d 2f63 720a  ge(len(ns))]/cr.
-0007eb10: 0a20 2020 2070 203d 2030 0a20 2020 2070  .    p = 0.    p
-0007eb20: 6f73 5f6c 7374 203d 205b 5d0a 2020 2020  os_lst = [].    
-0007eb30: 6c65 6e5f 6c73 7420 3d20 5b5d 0a20 2020  len_lst = [].   
-0007eb40: 2063 7667 5f6c 7374 203d 205b 5d0a 2020   cvg_lst = [].  
-0007eb50: 2020 6366 725f 6c73 7420 3d20 5b5d 0a20    cfr_lst = []. 
-0007eb60: 2020 2073 6e70 5f6c 7374 203d 205b 5d0a     snp_lst = [].
-0007eb70: 2020 2020 736e 705f 6f72 675f 6c73 7420      snp_org_lst 
-0007eb80: 3d20 5b5d 0a20 2020 200a 2020 2020 666f  = [].    .    fo
-0007eb90: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
-0007eba0: 5f74 6f5f 7465 7374 293a 0a20 2020 2020  _to_test):.     
-0007ebb0: 2020 2069 6620 7372 5b6b 5d20 213d 2073     if sr[k] != s
-0007ebc0: 675b 6b5d 3a0a 2020 2020 2020 2020 2020  g[k]:.          
-0007ebd0: 2020 6966 2070 203d 3d20 303a 2070 6f73    if p == 0: pos
-0007ebe0: 203d 206b 0a20 2020 2020 2020 2020 2020   = k.           
-0007ebf0: 2070 202b 3d20 310a 2020 2020 2020 2020   p += 1.        
-0007ec00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0007ec10: 2020 6966 2070 203e 2030 3a0a 2020 2020    if p > 0:.    
-0007ec20: 2020 2020 2020 2020 2020 2020 2320 6376              # cv
-0007ec30: 675f 6c73 742e 6170 7065 6e64 286e 702e  g_lst.append(np.
-0007ec40: 6d65 616e 2820 6372 5b70 6f73 3a28 706f  mean( cr[pos:(po
-0007ec50: 732b 7029 5d20 2920 290a 2020 2020 2020  s+p)] ) ).      
-0007ec60: 2020 2020 2020 2020 2020 2320 736e 705f            # snp_
-0007ec70: 6c73 742e 6170 7065 6e64 2873 725b 706f  lst.append(sr[po
-0007ec80: 733a 2870 6f73 2b70 295d 290a 2020 2020  s:(pos+p)]).    
-0007ec90: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
-0007eca0: 6c73 742e 6170 7065 6e64 2870 6f73 290a  lst.append(pos).
-0007ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ecc0: 6c65 6e5f 6c73 742e 6170 7065 6e64 2870  len_lst.append(p
-0007ecd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007ece0: 2020 2320 736e 705f 6f72 675f 6c73 742e    # snp_org_lst.
-0007ecf0: 6170 7065 6e64 2873 675b 706f 733a 2870  append(sg[pos:(p
-0007ed00: 6f73 2b70 295d 290a 2020 2020 2020 2020  os+p)]).        
-0007ed10: 2020 2020 2020 2020 7020 3d20 300a 2020          p = 0.  
-0007ed20: 2020 2020 2020 2020 2020 0a20 2020 2066            .    f
-0007ed30: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
-0007ed40: 6e28 706f 735f 6c73 7429 293a 0a20 2020  n(pos_lst)):.   
-0007ed50: 2020 2020 200a 2020 2020 2020 2020 7031       .        p1
-0007ed60: 203d 206d 6178 2830 2c28 706f 735f 6c73   = max(0,(pos_ls
-0007ed70: 745b 6b5d 2d4e 5749 4e29 290a 2020 2020  t[k]-NWIN)).    
-0007ed80: 2020 2020 7032 203d 206d 696e 286c 656e      p2 = min(len
-0007ed90: 5f74 6f5f 7465 7374 2c28 706f 735f 6c73  _to_test,(pos_ls
-0007eda0: 745b 6b5d 2b6c 656e 5f6c 7374 5b6b 5d2b  t[k]+len_lst[k]+
-0007edb0: 4e57 494e 2929 0a20 2020 2020 2020 200a  NWIN)).        .
-0007edc0: 2020 2020 2020 2020 736f 7020 3d20 7367          sop = sg
-0007edd0: 5b70 313a 706f 735f 6c73 745b 6b5d 5d0a  [p1:pos_lst[k]].
-0007ede0: 2020 2020 2020 2020 736f 6320 3d20 7367          soc = sg
-0007edf0: 5b70 6f73 5f6c 7374 5b6b 5d3a 2870 6f73  [pos_lst[k]:(pos
-0007ee00: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
-0007ee10: 6b5d 295d 0a20 2020 2020 2020 2073 6f6e  k])].        son
-0007ee20: 203d 2073 675b 2870 6f73 5f6c 7374 5b6b   = sg[(pos_lst[k
-0007ee30: 5d2b 6c65 6e5f 6c73 745b 6b5d 293a 7032  ]+len_lst[k]):p2
-0007ee40: 5d0a 2020 2020 2020 2020 0a20 2020 2020  ].        .     
-0007ee50: 2020 2073 6e70 203d 2073 725b 7031 3a70     snp = sr[p1:p
-0007ee60: 6f73 5f6c 7374 5b6b 5d5d 0a20 2020 2020  os_lst[k]].     
-0007ee70: 2020 2073 6e63 203d 2073 725b 706f 735f     snc = sr[pos_
-0007ee80: 6c73 745b 6b5d 3a28 706f 735f 6c73 745b  lst[k]:(pos_lst[
-0007ee90: 6b5d 2b6c 656e 5f6c 7374 5b6b 5d29 5d0a  k]+len_lst[k])].
-0007eea0: 2020 2020 2020 2020 736e 6e20 3d20 7372          snn = sr
-0007eeb0: 5b28 706f 735f 6c73 745b 6b5d 2b6c 656e  [(pos_lst[k]+len
-0007eec0: 5f6c 7374 5b6b 5d29 3a70 325d 0a20 2020  _lst[k]):p2].   
-0007eed0: 2020 2020 200a 2020 2020 2020 2020 7369       .        si
-0007eee0: 203d 2053 4e56 5f69 6e66 6f28 6368 726d   = SNV_info(chrm
-0007eef0: 2c20 706f 735f 6c73 745b 6b5d 2b70 6f73  , pos_lst[k]+pos
-0007ef00: 5f61 6273 2c20 706f 735f 6c73 745b 6b5d  _abs, pos_lst[k]
-0007ef10: 2b70 6f73 5f61 6273 2b6f 732c 2067 696e  +pos_abs+os, gin
-0007ef20: 5b30 5d2c 2067 696e 5b31 5d2c 2027 5627  [0], gin[1], 'V'
-0007ef30: 2c20 6c65 6e5f 6c73 745b 6b5d 2c20 5c0a  , len_lst[k], \.
-0007ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ef50: 2020 2020 2020 696e 7428 6372 5b70 6f73        int(cr[pos
-0007ef60: 5f6c 7374 5b6b 5d5d 292c 206e 702e 726f  _lst[k]]), np.ro
-0007ef70: 756e 6428 7072 5b70 6f73 5f6c 7374 5b6b  und(pr[pos_lst[k
-0007ef80: 5d5d 2c33 292c 2073 6f70 2c20 736f 632c  ]],3), sop, soc,
-0007ef90: 2073 6f6e 2c20 736e 702c 2073 6e63 2c20   son, snp, snc, 
-0007efa0: 736e 6e20 290a 2020 2020 2020 2020 736e  snn ).        sn
-0007efb0: 765f 696e 666f 5f6c 7374 2e61 7070 656e  v_info_lst.appen
-0007efc0: 6428 7369 290a 0a20 2020 2072 6574 7572  d(si)..    retur
-0007efd0: 6e28 736e 765f 696e 666f 5f6c 7374 290a  n(snv_info_lst).
-0007efe0: 0a0a 6465 6620 636f 6d70 6172 655f 7365  ..def compare_se
-0007eff0: 7132 2820 7331 2c20 7332 2029 3a0a 2020  q2( s1, s2 ):.  
-0007f000: 2020 636e 7420 3d20 300a 2020 2020 666f    cnt = 0.    fo
-0007f010: 7220 6920 696e 2072 616e 6765 286d 696e  r i in range(min
-0007f020: 286c 656e 2873 3129 2c6c 656e 2873 3229  (len(s1),len(s2)
-0007f030: 2929 3a0a 2020 2020 2020 2020 636e 7420  )):.        cnt 
-0007f040: 2b3d 2028 7331 5b69 5d20 213d 2073 325b  += (s1[i] != s2[
-0007f050: 695d 290a 2020 2020 2320 6966 206c 656e  i]).    # if len
-0007f060: 2873 3129 2021 3d20 6c65 6e28 7332 293a  (s1) != len(s2):
-0007f070: 2070 7269 6e74 2827 5741 524e 494e 4720   print('WARNING 
-0007f080: 696e 2063 6f6d 7061 7265 5f73 6571 323a  in compare_seq2:
-0007f090: 2025 6920 213d 2025 6927 2025 2028 6c65   %i != %i' % (le
-0007f0a0: 6e28 7331 292c 6c65 6e28 7332 2929 2029  n(s1),len(s2)) )
-0007f0b0: 0a20 2020 2072 6574 7572 6e20 636e 740a  .    return cnt.
-0007f0c0: 0a0a 4f53 5f69 6e66 6f20 3d20 636f 6c6c  ..OS_info = coll
-0007f0d0: 6563 7469 6f6e 732e 6e61 6d65 6474 7570  ections.namedtup
-0007f0e0: 6c65 2827 4f53 5f69 6e66 6f27 2c20 276f  le('OS_info', 'o
-0007f0f0: 732c 2073 7461 7274 2c20 656e 6427 2920  s, start, end') 
-0007f100: 2320 6f6e 652d 6261 7365 0a0a 636c 6173  # one-base..clas
-0007f110: 7320 6f66 6673 6574 5f66 696e 6465 723a  s offset_finder:
-0007f120: 0a20 2020 200a 2020 2020 6465 6620 5f5f  .    .    def __
-0007f130: 696e 6974 5f5f 2873 656c 6629 3a0a 2020  init__(self):.  
-0007f140: 2020 2020 2020 7365 6c66 2e6f 7369 5f6c        self.osi_l
-0007f150: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-0007f160: 7365 6c66 2e6f 735f 6d61 7020 3d20 4e6f  self.os_map = No
-0007f170: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-0007f180: 6f73 5f70 7265 7620 3d20 300a 2020 2020  os_prev = 0.    
-0007f190: 2020 2020 0a20 2020 2064 6566 2061 6464      .    def add
-0007f1a0: 2820 7365 6c66 2c20 6f73 2c20 7374 6172  ( self, os, star
-0007f1b0: 742c 2065 6e64 293a 0a20 2020 2020 2020  t, end):.       
-0007f1c0: 2073 656c 662e 6f73 695f 6c73 742e 6170   self.osi_lst.ap
-0007f1d0: 7065 6e64 2820 4f53 5f69 6e66 6f28 6f73  pend( OS_info(os
-0007f1e0: 2c20 7374 6172 742c 2065 6e64 2920 290a  , start, end) ).
-0007f1f0: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
-0007f200: 2066 696e 645f 6f73 2820 7365 6c66 2c20   find_os( self, 
-0007f210: 706f 7320 293a 0a20 2020 2020 2020 206f  pos ):.        o
-0007f220: 7320 3d20 300a 2020 2020 2020 2020 666f  s = 0.        fo
-0007f230: 7220 6f73 6920 696e 2073 656c 662e 6f73  r osi in self.os
-0007f240: 695f 6c73 743a 0a20 2020 2020 2020 2020  i_lst:.         
-0007f250: 2020 2069 6620 2870 6f73 203e 3d20 6f73     if (pos >= os
-0007f260: 692e 7374 6172 7429 2026 2028 706f 7320  i.start) & (pos 
-0007f270: 3c20 6f73 692e 656e 6429 3a20 0a20 2020  < osi.end): .   
-0007f280: 2020 2020 2020 2020 2020 2020 206f 7320               os 
-0007f290: 3d20 6f73 692e 6f73 0a20 2020 2020 2020  = osi.os.       
-0007f2a0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-0007f2b0: 2020 2020 2020 2072 6574 7572 6e20 6f73         return os
-0007f2c0: 0a0a 2020 2020 0a20 2020 2064 6566 2066  ..    .    def f
-0007f2d0: 696e 645f 6f73 5f73 6571 2820 7365 6c66  ind_os_seq( self
-0007f2e0: 2c20 706f 732c 2070 7265 765f 692c 206d  , pos, prev_i, m
-0007f2f0: 6172 6b20 3d20 2727 2029 3a0a 2020 2020  ark = '' ):.    
-0007f300: 2020 2020 6f73 203d 204e 6f6e 650a 2020      os = None.  
-0007f310: 2020 2020 2020 6e65 7874 5f69 203d 2030        next_i = 0
-0007f320: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-0007f330: 6f73 6920 696e 2065 6e75 6d65 7261 7465  osi in enumerate
-0007f340: 2873 656c 662e 6f73 695f 6c73 745b 7072  (self.osi_lst[pr
-0007f350: 6576 5f69 3a5d 293a 0a20 2020 2020 2020  ev_i:]):.       
-0007f360: 2020 2020 2069 6620 2870 6f73 203e 3d20       if (pos >= 
-0007f370: 6f73 692e 7374 6172 7429 2026 2028 706f  osi.start) & (po
-0007f380: 7320 3c20 6f73 692e 656e 6429 3a20 0a20  s < osi.end): . 
-0007f390: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0007f3a0: 7320 3d20 6f73 692e 6f73 0a20 2020 2020  s = osi.os.     
-0007f3b0: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-0007f3c0: 6920 3d20 6b20 2b20 7072 6576 5f69 200a  i = k + prev_i .
-0007f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007f3e0: 6272 6561 6b0a 2020 2020 2020 2020 6966  break.        if
-0007f3f0: 206f 7320 6973 204e 6f6e 653a 0a20 2020   os is None:.   
-0007f400: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
-0007f410: 6f73 6920 696e 2065 6e75 6d65 7261 7465  osi in enumerate
-0007f420: 2873 656c 662e 6f73 695f 6c73 745b 3a70  (self.osi_lst[:p
-0007f430: 7265 765f 695d 293a 0a20 2020 2020 2020  rev_i]):.       
-0007f440: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
-0007f450: 203e 3d20 6f73 692e 7374 6172 7429 2026   >= osi.start) &
-0007f460: 2028 706f 7320 3c20 6f73 692e 656e 6429   (pos < osi.end)
-0007f470: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0007f480: 2020 2020 2020 206f 7320 3d20 6f73 692e         os = osi.
-0007f490: 6f73 0a20 2020 2020 2020 2020 2020 2020  os.             
-0007f4a0: 2020 2020 2020 206e 6578 745f 6920 3d20         next_i = 
-0007f4b0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0007f4c0: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
-0007f4d0: 2020 2020 2069 6620 6f73 2069 7320 4e6f       if os is No
-0007f4e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0007f4f0: 6f73 203d 2073 656c 662e 6f73 5f70 7265  os = self.os_pre
-0007f500: 760a 2020 2020 2020 2020 2020 2020 2320  v.            # 
-0007f510: 7072 696e 7428 2745 5252 4f52 2069 6e20  print('ERROR in 
-0007f520: 6669 6e64 5f6f 735f 7365 713a 206f 7320  find_os_seq: os 
-0007f530: 6973 204e 6f6e 6520 2573 2720 2520 6d61  is None %s' % ma
-0007f540: 726b 2029 0a20 2020 2020 2020 2065 6c73  rk ).        els
-0007f550: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0007f560: 656c 662e 6f73 5f70 7265 7620 3d20 6f73  elf.os_prev = os
-0007f570: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0007f580: 2020 2020 2020 7265 7475 726e 206f 732c        return os,
-0007f590: 206e 6578 745f 690a 2020 2020 0a20 2020   next_i.    .   
-0007f5a0: 200a 2020 2020 6465 6620 6d61 6b65 5f69   .    def make_i
-0007f5b0: 745f 636f 6d70 6163 7428 2073 656c 6620  t_compact( self 
-0007f5c0: 293a 0a0a 2020 2020 2020 2020 666f 7220  ):..        for 
-0007f5d0: 6b20 696e 2072 6576 6572 7365 6428 7261  k in reversed(ra
-0007f5e0: 6e67 6528 312c 6c65 6e28 7365 6c66 2e6f  nge(1,len(self.o
-0007f5f0: 7369 5f6c 7374 2929 293a 0a20 2020 2020  si_lst))):.     
-0007f600: 2020 2020 2020 2069 6620 7365 6c66 2e6f         if self.o
-0007f610: 7369 5f6c 7374 5b6b 5d2e 6f73 203d 3d20  si_lst[k].os == 
-0007f620: 7365 6c66 2e6f 7369 5f6c 7374 5b6b 2d31  self.osi_lst[k-1
-0007f630: 5d2e 6f73 3a0a 2020 2020 2020 2020 2020  ].os:.          
-0007f640: 2020 2020 2020 7365 6c66 2e6f 7369 5f6c        self.osi_l
-0007f650: 7374 5b6b 2d31 5d20 3d20 4f53 5f69 6e66  st[k-1] = OS_inf
-0007f660: 6f28 2073 656c 662e 6f73 695f 6c73 745b  o( self.osi_lst[
-0007f670: 6b2d 315d 2e6f 732c 2073 656c 662e 6f73  k-1].os, self.os
-0007f680: 695f 6c73 745b 6b2d 315d 2e73 7461 7274  i_lst[k-1].start
-0007f690: 2c20 7365 6c66 2e6f 7369 5f6c 7374 5b6b  , self.osi_lst[k
-0007f6a0: 5d2e 656e 6420 290a 2020 2020 2020 2020  ].end ).        
-0007f6b0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
-0007f6c0: 2e6f 7369 5f6c 7374 5b6b 5d0a 2020 2020  .osi_lst[k].    
-0007f6d0: 2020 2020 0a20 2020 2064 6566 2067 6574      .    def get
-0007f6e0: 5f62 6e64 7279 2820 7365 6c66 2c20 706f  _bndry( self, po
-0007f6f0: 7320 293a 0a20 2020 2020 2020 206f 7320  s ):.        os 
-0007f700: 3d20 300a 2020 2020 2020 2020 666f 7220  = 0.        for 
-0007f710: 6f73 6920 696e 2073 656c 662e 6f73 695f  osi in self.osi_
-0007f720: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
-0007f730: 2069 6620 2870 6f73 203e 3d20 6f73 692e   if (pos >= osi.
-0007f740: 7374 6172 7429 3a20 0a20 2020 2020 2020  start): .       
-0007f750: 2020 2020 2020 2020 206f 7320 3d20 6f73           os = os
-0007f760: 692e 7374 6172 740a 2020 2020 2020 2020  i.start.        
-0007f770: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0007f780: 2020 2020 2020 7265 7475 726e 206f 730a        return os.
-0007f790: 2020 2020 0a20 2020 2064 6566 2067 6574      .    def get
-0007f7a0: 5f62 6e64 7279 5f73 6571 2820 7365 6c66  _bndry_seq( self
-0007f7b0: 2c20 706f 732c 2070 7265 765f 6920 293a  , pos, prev_i ):
-0007f7c0: 0a20 2020 2020 2020 206f 7320 3d20 4e6f  .        os = No
-0007f7d0: 6e65 0a20 2020 2020 2020 206e 6578 745f  ne.        next_
-0007f7e0: 6920 3d20 300a 2020 2020 2020 2020 666f  i = 0.        fo
-0007f7f0: 7220 6b2c 206f 7369 2069 6e20 656e 756d  r k, osi in enum
-0007f800: 6572 6174 6528 7365 6c66 2e6f 7369 5f6c  erate(self.osi_l
-0007f810: 7374 5b70 7265 765f 693a 5d29 3a0a 2020  st[prev_i:]):.  
-0007f820: 2020 2020 2020 2020 2020 6966 2028 706f            if (po
-0007f830: 7320 3e3d 206f 7369 2e73 7461 7274 2920  s >= osi.start) 
-0007f840: 2620 2870 6f73 203c 206f 7369 2e65 6e64  & (pos < osi.end
-0007f850: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
-0007f860: 2020 2020 6f73 203d 206f 7369 2e73 7461      os = osi.sta
-0007f870: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-0007f880: 2020 206e 6578 745f 6920 3d20 6b20 2b20     next_i = k + 
-0007f890: 7072 6576 5f69 200a 2020 2020 2020 2020  prev_i .        
-0007f8a0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0007f8b0: 2020 2020 2020 6966 206f 7320 6973 204e        if os is N
-0007f8c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0007f8d0: 2066 6f72 206b 2c20 6f73 6920 696e 2065   for k, osi in e
-0007f8e0: 6e75 6d65 7261 7465 2873 656c 662e 6f73  numerate(self.os
-0007f8f0: 695f 6c73 745b 3a70 7265 765f 695d 293a  i_lst[:prev_i]):
-0007f900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f910: 2069 6620 2870 6f73 203e 3d20 6f73 692e   if (pos >= osi.
-0007f920: 7374 6172 7429 2026 2028 706f 7320 3c20  start) & (pos < 
-0007f930: 6f73 692e 656e 6429 3a20 0a20 2020 2020  osi.end): .     
-0007f940: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0007f950: 7320 3d20 6f73 692e 7374 6172 740a 2020  s = osi.start.  
-0007f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007f970: 2020 6e65 7874 5f69 203d 206b 0a20 2020    next_i = k.   
-0007f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007f990: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-0007f9a0: 2020 200a 2020 2020 2020 2020 6966 206f     .        if o
-0007f9b0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0007f9c0: 2020 2020 2020 206f 7320 3d20 300a 2020         os = 0.  
-0007f9d0: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
-0007f9e0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0007f9f0: 2070 7269 6e74 2827 4552 524f 5220 696e   print('ERROR in
-0007fa00: 2067 6574 5f62 6e64 7279 5f73 6571 3a20   get_bndry_seq: 
-0007fa10: 6f73 2069 7320 4e6f 6e65 2729 0a20 2020  os is None').   
-0007fa20: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
-0007fa30: 7072 696e 7428 290a 2020 2020 2020 2020  print().        
-0007fa40: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
-0007fa50: 7572 6e20 6f73 2c20 6e65 7874 5f69 0a20  urn os, next_i. 
-0007fa60: 2020 200a 2020 2020 0a20 2020 2064 6566     .    .    def
-0007fa70: 2070 7269 6e74 2873 656c 6629 3a0a 2020   print(self):.  
-0007fa80: 2020 2020 2020 666f 7220 6f73 6920 696e        for osi in
-0007fa90: 2073 656c 662e 6f73 695f 6c73 743a 0a20   self.osi_lst:. 
-0007faa0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0007fab0: 2827 2569 202d 2025 693a 2025 6927 2025  ('%i - %i: %i' %
-0007fac0: 2028 6f73 692e 7374 6172 742c 206f 7369   (osi.start, osi
-0007fad0: 2e65 6e64 2c20 6f73 692e 6f73 2929 0a0a  .end, osi.os))..
-0007fae0: 2020 2020 2020 2020 2020 2020 0a64 6566              .def
-0007faf0: 2047 656e 6572 6174 655f 5265 6665 7265   Generate_Refere
-0007fb00: 6e63 6528 6774 665f 6669 6c65 2c20 6765  nce(gtf_file, ge
-0007fb10: 6e6f 6d65 5f66 696c 652c 2070 6570 7469  nome_file, pepti
-0007fb20: 6465 203d 2054 7275 652c 206f 7574 5f64  de = True, out_d
-0007fb30: 6972 203d 204e 6f6e 652c 2073 7566 6669  ir = None, suffi
-0007fb40: 7820 3d20 4e6f 6e65 293a 0a0a 2020 2020  x = None):..    
-0007fb50: 6765 6e6f 6d65 203d 206c 6f61 645f 6765  genome = load_ge
-0007fb60: 6e6f 6d65 2867 656e 6f6d 655f 6669 6c65  nome(genome_file
-0007fb70: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
-0007fb80: 290a 0a20 2020 2067 7466 5f6c 696e 6573  )..    gtf_lines
-0007fb90: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
-0007fba0: 6164 5f67 7466 2867 7466 5f66 696c 652c  ad_gtf(gtf_file,
-0007fbb0: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
-0007fbc0: 0a20 2020 2067 645f 6c73 742c 2063 6872  .    gd_lst, chr
-0007fbd0: 7320 3d20 6765 745f 6765 6e65 5f64 6573  s = get_gene_des
-0007fbe0: 6372 6970 746f 7228 6774 665f 6c69 6e65  criptor(gtf_line
-0007fbf0: 732c 2067 656e 6f6d 6520 3d20 4e6f 6e65  s, genome = None
-0007fc00: 2c20 6669 6c6c 203d 2046 616c 7365 2c20  , fill = False, 
-0007fc10: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0007fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007fc30: 2020 2020 2020 2020 2020 2020 2063 6720               cg 
-0007fc40: 3d20 4661 6c73 652c 2076 6572 626f 7365  = False, verbose
-0007fc50: 203d 2054 7275 652c 206e 5f63 6f72 6573   = True, n_cores
-0007fc60: 203d 2031 290a 2020 2020 6764 5f6c 7374   = 1).    gd_lst
-0007fc70: 732c 2063 6872 5f6c 7374 203d 2070 6163  s, chr_lst = pac
-0007fc80: 6b5f 6765 6e65 5f64 6573 6372 6970 746f  k_gene_descripto
-0007fc90: 7228 2067 645f 6c73 742c 2063 6872 7320  r( gd_lst, chrs 
-0007fca0: 290a 2020 2020 0a0a 2020 2020 2320 6669  ).    ..    # fi
-0007fcb0: 6c65 5f6e 616d 6520 3d20 6774 665f 6669  le_name = gtf_fi
-0007fcc0: 6c65 2e73 706c 6974 2827 2f27 295b 2d31  le.split('/')[-1
-0007fcd0: 5d0a 2020 2020 2320 666e 7320 3d20 6669  ].    # fns = fi
-0007fce0: 6c65 5f6e 616d 652e 7370 6c69 7428 272e  le_name.split('.
-0007fcf0: 2729 5b3a 2d31 5d0a 2020 2020 666e 7320  ')[:-1].    fns 
-0007fd00: 3d20 6774 665f 6669 6c65 2e73 706c 6974  = gtf_file.split
-0007fd10: 2827 2e27 295b 3a2d 315d 0a20 2020 2066  ('.')[:-1].    f
-0007fd20: 6e61 6d65 203d 2027 270a 2020 2020 666f  name = ''.    fo
-0007fd30: 7220 6b2c 2066 6e20 696e 2065 6e75 6d65  r k, fn in enume
-0007fd40: 7261 7465 2866 6e73 293a 0a20 2020 2020  rate(fns):.     
-0007fd50: 2020 2069 6620 6b20 3e20 303a 0a20 2020     if k > 0:.   
-0007fd60: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
-0007fd70: 2066 6e61 6d65 202b 2027 2e27 0a20 2020   fname + '.'.   
-0007fd80: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-0007fd90: 6d65 202b 2066 6e0a 2020 2020 6966 206f  me + fn.    if o
-0007fda0: 7574 5f64 6972 2069 7320 6e6f 7420 4e6f  ut_dir is not No
-0007fdb0: 6e65 3a0a 2020 2020 2020 2020 6966 206f  ne:.        if o
-0007fdc0: 7574 5f64 6972 5b2d 315d 203d 3d20 272f  ut_dir[-1] == '/
-0007fdd0: 273a 0a20 2020 2020 2020 2020 2020 2066  ':.            f
-0007fde0: 6e61 6d65 203d 206f 7574 5f64 6972 202b  name = out_dir +
-0007fdf0: 2066 6e61 6d65 0a20 2020 2020 2020 2065   fname.        e
-0007fe00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0007fe10: 2066 6e61 6d65 203d 206f 7574 5f64 6972   fname = out_dir
-0007fe20: 202b 2027 2f27 202b 2066 6e61 6d65 0a0a   + '/' + fname..
-0007fe30: 2020 2020 6966 2073 7566 6669 7820 6973      if suffix is
-0007fe40: 204e 6f6e 653a 2020 2020 0a20 2020 2020   None:    .     
-0007fe50: 2020 2066 615f 6669 6c65 5f74 7220 3d20     fa_file_tr = 
-0007fe60: 666e 616d 6520 2b20 275f 7472 616e 7363  fname + '_transc
-0007fe70: 7269 7074 6f6d 652e 6661 270a 2020 2020  riptome.fa'.    
-0007fe80: 2020 2020 6661 5f66 696c 655f 7072 203d      fa_file_pr =
-0007fe90: 2066 6e61 6d65 202b 2027 5f70 726f 7465   fname + '_prote
-0007fea0: 6f6d 652e 6661 270a 2020 2020 656c 7365  ome.fa'.    else
-0007feb0: 3a0a 2020 2020 2020 2020 6661 5f66 696c  :.        fa_fil
-0007fec0: 655f 7472 203d 2066 6e61 6d65 202b 2027  e_tr = fname + '
-0007fed0: 5f25 735f 7472 616e 7363 7269 7074 6f6d  _%s_transcriptom
-0007fee0: 652e 6661 2720 2520 7375 6666 6978 0a20  e.fa' % suffix. 
-0007fef0: 2020 2020 2020 2066 615f 6669 6c65 5f70         fa_file_p
-0007ff00: 7220 3d20 666e 616d 6520 2b20 275f 2573  r = fname + '_%s
-0007ff10: 5f70 726f 7465 6f6d 652e 6661 2720 2520  _proteome.fa' % 
-0007ff20: 7375 6666 6978 0a0a 2020 2020 6661 5f74  suffix..    fa_t
-0007ff30: 7220 3d20 5b5d 0a20 2020 2066 615f 7072  r = [].    fa_pr
-0007ff40: 203d 205b 5d0a 2020 2020 0a20 2020 2073   = [].    .    s
-0007ff50: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
-0007ff60: 2e74 696d 6528 290a 2020 2020 6e74 7220  .time().    ntr 
-0007ff70: 3d20 300a 0a20 2020 206d 6178 5f61 626e  = 0..    max_abn
-0007ff80: 203d 2030 0a20 2020 206d 6178 5f63 6f76   = 0.    max_cov
-0007ff90: 203d 2030 0a20 2020 2066 6f72 206b 6b2c   = 0.    for kk,
-0007ffa0: 2063 6872 6d20 696e 2065 6e75 6d65 7261   chrm in enumera
-0007ffb0: 7465 2863 6872 5f6c 7374 293a 0a20 2020  te(chr_lst):.   
-0007ffc0: 2020 2020 2066 6f72 2067 6420 696e 2067       for gd in g
-0007ffd0: 645f 6c73 7473 5b6b 6b5d 3a0a 2020 2020  d_lsts[kk]:.    
-0007ffe0: 2020 2020 2020 2020 666f 7220 7464 2069          for td i
-0007fff0: 6e20 6764 2e74 645f 6c73 743a 0a20 2020  n gd.td_lst:.   
-00080000: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00080010: 7464 2e61 626e 203e 2030 3a20 6d61 785f  td.abn > 0: max_
-00080020: 6162 6e20 3d20 6d61 7828 206d 6178 5f61  abn = max( max_a
-00080030: 626e 2c20 7464 2e61 626e 2029 0a20 2020  bn, td.abn ).   
-00080040: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00080050: 7464 2e63 6f76 203e 2030 3a20 6d61 785f  td.cov > 0: max_
-00080060: 636f 7620 3d20 6d61 7828 206d 6178 5f63  cov = max( max_c
-00080070: 6f76 2c20 7464 2e63 6f76 2029 0a0a 2020  ov, td.cov )..  
-00080080: 2020 6966 206d 6178 5f61 626e 203e 2030    if max_abn > 0
-00080090: 3a20 6162 6e5f 7468 203d 204d 494e 5f41  : abn_th = MIN_A
-000800a0: 424e 5f54 4f5f 5345 4c0a 2020 2020 656c  BN_TO_SEL.    el
-000800b0: 7365 3a20 6162 6e5f 7468 203d 2030 0a20  se: abn_th = 0. 
-000800c0: 2020 2069 6620 6d61 785f 636f 7620 3e20     if max_cov > 
-000800d0: 303a 2063 6f76 5f74 6820 3d20 4d49 4e5f  0: cov_th = MIN_
-000800e0: 434f 565f 544f 5f53 454c 0a20 2020 2065  COV_TO_SEL.    e
-000800f0: 6c73 653a 2063 6f76 5f74 6820 3d20 300a  lse: cov_th = 0.
-00080100: 2020 2020 7072 696e 7428 2743 7574 6f66      print('Cutof
-00080110: 663a 2041 203d 2025 352e 3266 2c20 4320  f: A = %5.2f, C 
-00080120: 3d20 2535 2e32 6620 2720 2520 2861 626e  = %5.2f ' % (abn
-00080130: 5f74 682c 2063 6f76 5f74 6829 290a 0a20  _th, cov_th)).. 
-00080140: 2020 2066 6f72 206b 6b2c 2063 6872 6d20     for kk, chrm 
-00080150: 696e 2065 6e75 6d65 7261 7465 2863 6872  in enumerate(chr
-00080160: 5f6c 7374 293a 0a0a 2020 2020 2020 2020  _lst):..        
-00080170: 7072 696e 7428 275c 7227 202b 2027 2027  print('\r' + ' '
-00080180: 2a31 3030 2c20 656e 643d 2727 2c20 666c  *100, end='', fl
-00080190: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-000801a0: 2020 2020 7072 696e 7428 275c 7247 656e      print('\rGen
-000801b0: 6572 6174 696e 6720 7265 6665 7265 6e63  erating referenc
-000801c0: 6573 202e 2e20 2573 2020 2720 2520 2863  es .. %s  ' % (c
-000801d0: 6872 6d29 2c20 656e 6420 3d20 2727 2c20  hrm), end = '', 
-000801e0: 666c 7573 6820 3d20 5472 7565 290a 0a20  flush = True).. 
-000801f0: 2020 2020 2020 2066 6f72 2067 6420 696e         for gd in
-00080200: 2067 645f 6c73 7473 5b6b 6b5d 3a0a 2020   gd_lsts[kk]:.  
-00080210: 2020 2020 2020 2020 2020 2320 6764 2e6f            # gd.o
-00080220: 7264 6572 2829 0a20 2020 2020 2020 2020  rder().         
-00080230: 2020 206e 7472 202b 3d20 6764 2e6e 7472     ntr += gd.ntr
-00080240: 0a20 2020 2020 2020 2020 2020 2066 615f  .            fa_
-00080250: 742c 2066 615f 7020 3d20 6764 2e67 6574  t, fa_p = gd.get
-00080260: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
-00080270: 6d5f 6765 6e6f 6d65 2867 656e 6f6d 652c  m_genome(genome,
-00080280: 2061 626e 5f74 6820 3d20 6162 6e5f 7468   abn_th = abn_th
-00080290: 2c20 636f 765f 7468 203d 2063 6f76 5f74  , cov_th = cov_t
-000802a0: 682c 206c 656e 5f74 685f 743d 204d 494e  h, len_th_t= MIN
-000802b0: 5f54 525f 4c45 4e47 5448 2c20 6c65 6e5f  _TR_LENGTH, len_
-000802c0: 7468 5f70 203d 204d 494e 5f50 525f 4c45  th_p = MIN_PR_LE
-000802d0: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
-000802e0: 2020 0a20 2020 2020 2020 2020 2020 2023    .            #
-000802f0: 2066 615f 7420 3d20 6669 6c74 6572 5f74   fa_t = filter_t
-00080300: 7273 5f6c 656e 2866 615f 742c 206d 696e  rs_len(fa_t, min
-00080310: 5f6c 656e 203d 204d 494e 5f54 525f 4c45  _len = MIN_TR_LE
-00080320: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
-00080330: 2020 2320 6661 5f70 203d 2066 696c 7465    # fa_p = filte
-00080340: 725f 7472 735f 6c65 6e28 6661 5f70 2c20  r_trs_len(fa_p, 
-00080350: 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f 5052  min_len = MIN_PR
-00080360: 5f4c 454e 4754 4829 0a20 2020 2020 2020  _LENGTH).       
-00080370: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00080380: 2020 6661 5f74 7220 3d20 6661 5f74 7220    fa_tr = fa_tr 
-00080390: 2b20 6661 5f74 0a20 2020 2020 2020 2020  + fa_t.         
-000803a0: 2020 2066 615f 7072 203d 2066 615f 7072     fa_pr = fa_pr
-000803b0: 202b 2066 615f 700a 2020 2020 2020 2020   + fa_p.        
-000803c0: 2020 2020 0a20 2020 200a 2020 2020 6966      .    .    if
-000803d0: 2028 6c65 6e28 6661 5f70 7229 203d 3d20   (len(fa_pr) == 
-000803e0: 3029 2026 2028 7065 7074 6964 6529 3a0a  0) & (peptide):.
-000803f0: 2020 2020 2020 2020 6864 725f 6c73 742c          hdr_lst,
-00080400: 2074 7365 715f 6c73 7420 3d20 5b5d 2c20   tseq_lst = [], 
-00080410: 5b5d 0a20 2020 2020 2020 2066 6f72 206c  [].        for l
-00080420: 696e 6520 696e 2066 615f 7472 3a0a 2020  ine in fa_tr:.  
-00080430: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
-00080440: 655b 305d 203d 3d20 273e 273a 2068 6472  e[0] == '>': hdr
-00080450: 5f6c 7374 2e61 7070 656e 6428 6c69 6e65  _lst.append(line
-00080460: 5b31 3a2d 315d 290a 2020 2020 2020 2020  [1:-1]).        
-00080470: 2020 2020 656c 7365 3a20 7473 6571 5f6c      else: tseq_l
-00080480: 7374 2e61 7070 656e 6428 6c69 6e65 5b30  st.append(line[0
-00080490: 3a2d 315d 290a 0a20 2020 2020 2020 2066  :-1])..        f
-000804a0: 615f 7072 203d 2067 656e 5f70 726f 7465  a_pr = gen_prote
-000804b0: 6f6d 655f 6672 6f6d 5f74 7261 7363 7269  ome_from_trascri
-000804c0: 7074 6f6d 6528 6864 725f 6c73 742c 2074  ptome(hdr_lst, t
-000804d0: 7365 715f 6c73 742c 206c 656e 5f74 6820  seq_lst, len_th 
-000804e0: 3d20 4d49 4e5f 5052 5f4c 454e 4754 482c  = MIN_PR_LENGTH,
-000804f0: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
-00080500: 2074 7261 7265 636f 203d 2046 616c 7365   trareco = False
-00080510: 290a 2020 2020 2020 2020 705f 6361 6e64  ).        p_cand
-00080520: 5f63 6e74 203d 206c 656e 2866 615f 7072  _cnt = len(fa_pr
-00080530: 292f 320a 0a20 2020 2020 2020 2070 7269  )/2..        pri
+0007e190: 2323 2323 230a 0a53 4e56 5f69 6e66 6f20  #####..SNV_info 
+0007e1a0: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
+0007e1b0: 6d65 6474 7570 6c65 2827 534e 565f 696e  medtuple('SNV_in
+0007e1c0: 666f 272c 2027 6368 722c 2070 6f73 5f72  fo', 'chr, pos_r
+0007e1d0: 6566 2c20 706f 735f 6e65 772c 2067 656e  ef, pos_new, gen
+0007e1e0: 655f 6964 2c20 6765 6e65 5f6e 616d 652c  e_id, gene_name,
+0007e1f0: 2076 5f74 7970 652c 2076 5f6c 656e 2c20   v_type, v_len, 
+0007e200: 6376 675f 6465 7074 682c 2063 7667 5f66  cvg_depth, cvg_f
+0007e210: 7261 632c 205c 0a20 2020 2020 2020 2020  rac, \.         
+0007e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e230: 2020 2020 2020 2020 2020 7265 665f 7072            ref_pr
+0007e240: 6576 2c20 7265 665f 7365 712c 2072 6566  ev, ref_seq, ref
+0007e250: 5f6e 6578 742c 2061 6c74 5f70 7265 762c  _next, alt_prev,
+0007e260: 2061 6c74 5f73 6571 2c20 616c 745f 6e65   alt_seq, alt_ne
+0007e270: 7874 2729 2023 206f 6e65 2d62 6173 650a  xt') # one-base.
+0007e280: 0a4e 5749 4e20 3d20 330a 6465 6620 6669  .NWIN = 3.def fi
+0007e290: 6e64 5f73 6e70 5f6f 6c64 2873 672c 2073  nd_snp_old(sg, s
+0007e2a0: 722c 2063 722c 2063 6872 6d2c 2070 6f73  r, cr, chrm, pos
+0007e2b0: 5f61 6273 2c20 6f73 2c20 6769 6e29 3a0a  _abs, os, gin):.
+0007e2c0: 2020 2020 0a20 2020 2073 6e76 5f69 6e66      .    snv_inf
+0007e2d0: 6f5f 6c73 7420 3d20 5b5d 0a20 2020 206c  o_lst = [].    l
+0007e2e0: 656e 5f74 6f5f 7465 7374 203d 206d 696e  en_to_test = min
+0007e2f0: 286c 656e 2873 7229 2c6c 656e 2873 6729  (len(sr),len(sg)
+0007e300: 290a 0a20 2020 2073 7461 7274 203d 2030  )..    start = 0
+0007e310: 0a20 2020 2065 6e64 203d 206d 696e 2820  .    end = min( 
+0007e320: 3130 302c 206c 656e 5f74 6f5f 7465 7374  100, len_to_test
+0007e330: 2029 0a20 2020 204e 203d 2069 6e74 286e   ).    N = int(n
+0007e340: 702e 6365 696c 2820 6c65 6e5f 746f 5f74  p.ceil( len_to_t
+0007e350: 6573 742f 3130 3020 2929 0a20 2020 2023  est/100 )).    #
+0007e360: 2727 270a 2020 2020 666f 7220 6e20 696e  '''.    for n in
+0007e370: 2072 616e 6765 284e 293a 0a20 2020 2020   range(N):.     
+0007e380: 2020 200a 2020 2020 2020 2020 6966 2073     .        if s
+0007e390: 675b 7374 6172 743a 656e 645d 2021 3d20  g[start:end] != 
+0007e3a0: 7372 5b73 7461 7274 3a65 6e64 5d3a 0a0a  sr[start:end]:..
+0007e3b0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
+0007e3c0: 300a 2020 2020 2020 2020 2020 2020 706f  0.            po
+0007e3d0: 735f 6c73 7420 3d20 5b5d 0a20 2020 2020  s_lst = [].     
+0007e3e0: 2020 2020 2020 206c 656e 5f6c 7374 203d         len_lst =
+0007e3f0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0007e400: 6376 675f 6c73 7420 3d20 5b5d 0a20 2020  cvg_lst = [].   
+0007e410: 2020 2020 2020 2020 2073 6e70 5f6c 7374           snp_lst
+0007e420: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0007e430: 2020 736e 705f 6f72 675f 6c73 7420 3d20    snp_org_lst = 
+0007e440: 5b5d 0a20 2020 2020 2020 2020 2020 200a  [].            .
+0007e450: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0007e460: 6b20 696e 2072 616e 6765 2873 7461 7274  k in range(start
+0007e470: 2c20 656e 6429 3a0a 2020 2020 2020 2020  , end):.        
+0007e480: 2020 2020 2020 2020 6966 2073 725b 6b5d          if sr[k]
+0007e490: 2021 3d20 7367 5b6b 5d3a 0a20 2020 2020   != sg[k]:.     
+0007e4a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0007e4b0: 6620 7020 3d3d 2030 3a20 706f 7320 3d20  f p == 0: pos = 
+0007e4c0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0007e4d0: 2020 2020 2020 7020 2b3d 2031 0a20 2020        p += 1.   
+0007e4e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0007e4f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0007e500: 2020 2020 2020 2069 6620 7020 3e20 303a         if p > 0:
+0007e510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e520: 2020 2020 2020 2020 2023 2063 7667 5f6c           # cvg_l
+0007e530: 7374 2e61 7070 656e 6428 6e70 2e6d 6561  st.append(np.mea
+0007e540: 6e28 2063 725b 706f 733a 2870 6f73 2b70  n( cr[pos:(pos+p
+0007e550: 295d 2029 2029 0a20 2020 2020 2020 2020  )] ) ).         
+0007e560: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0007e570: 2073 6e70 5f6c 7374 2e61 7070 656e 6428   snp_lst.append(
+0007e580: 7372 5b70 6f73 3a28 706f 732b 7029 5d29  sr[pos:(pos+p)])
+0007e590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e5a0: 2020 2020 2020 2020 2070 6f73 5f6c 7374           pos_lst
+0007e5b0: 2e61 7070 656e 6428 706f 7329 0a20 2020  .append(pos).   
+0007e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e5d0: 2020 2020 206c 656e 5f6c 7374 2e61 7070       len_lst.app
+0007e5e0: 656e 6428 7029 0a20 2020 2020 2020 2020  end(p).         
+0007e5f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0007e600: 2073 6e70 5f6f 7267 5f6c 7374 2e61 7070   snp_org_lst.app
+0007e610: 656e 6428 7367 5b70 6f73 3a28 706f 732b  end(sg[pos:(pos+
+0007e620: 7029 5d29 0a20 2020 2020 2020 2020 2020  p)]).           
+0007e630: 2020 2020 2020 2020 2020 2020 2070 203d               p =
+0007e640: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+0007e650: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0007e660: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
+0007e670: 6765 286c 656e 2870 6f73 5f6c 7374 2929  ge(len(pos_lst))
+0007e680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007e690: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007e6a0: 2020 2070 3120 3d20 6d61 7828 302c 2870     p1 = max(0,(p
+0007e6b0: 6f73 5f6c 7374 5b6b 5d2d 4e57 494e 2929  os_lst[k]-NWIN))
+0007e6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e6d0: 2070 3220 3d20 6d69 6e28 6c65 6e5f 746f   p2 = min(len_to
+0007e6e0: 5f74 6573 742c 2870 6f73 5f6c 7374 5b6b  _test,(pos_lst[k
+0007e6f0: 5d2b 6c65 6e5f 6c73 745b 6b5d 2b4e 5749  ]+len_lst[k]+NWI
+0007e700: 4e29 290a 2020 2020 2020 2020 2020 2020  N)).            
+0007e710: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007e720: 2020 2020 2073 6f70 203d 2073 675b 7031       sop = sg[p1
+0007e730: 3a70 6f73 5f6c 7374 5b6b 5d5d 0a20 2020  :pos_lst[k]].   
+0007e740: 2020 2020 2020 2020 2020 2020 2073 6f63               soc
+0007e750: 203d 2073 675b 706f 735f 6c73 745b 6b5d   = sg[pos_lst[k]
+0007e760: 3a28 706f 735f 6c73 745b 6b5d 2b6c 656e  :(pos_lst[k]+len
+0007e770: 5f6c 7374 5b6b 5d29 5d0a 2020 2020 2020  _lst[k])].      
+0007e780: 2020 2020 2020 2020 2020 736f 6e20 3d20            son = 
+0007e790: 7367 5b28 706f 735f 6c73 745b 6b5d 2b6c  sg[(pos_lst[k]+l
+0007e7a0: 656e 5f6c 7374 5b6b 5d29 3a70 325d 0a20  en_lst[k]):p2]. 
+0007e7b0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0007e7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e7d0: 736e 7020 3d20 7372 5b70 313a 706f 735f  snp = sr[p1:pos_
+0007e7e0: 6c73 745b 6b5d 5d0a 2020 2020 2020 2020  lst[k]].        
+0007e7f0: 2020 2020 2020 2020 736e 6320 3d20 7372          snc = sr
+0007e800: 5b70 6f73 5f6c 7374 5b6b 5d3a 2870 6f73  [pos_lst[k]:(pos
+0007e810: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
+0007e820: 6b5d 295d 0a20 2020 2020 2020 2020 2020  k])].           
+0007e830: 2020 2020 2073 6e6e 203d 2073 725b 2870       snn = sr[(p
+0007e840: 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73  os_lst[k]+len_ls
+0007e850: 745b 6b5d 293a 7032 5d0a 2020 2020 2020  t[k]):p2].      
+0007e860: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0007e870: 2020 2020 2020 2020 2020 2073 6920 3d20             si = 
+0007e880: 534e 565f 696e 666f 2863 6872 6d2c 2070  SNV_info(chrm, p
+0007e890: 6f73 5f6c 7374 5b6b 5d2b 706f 735f 6162  os_lst[k]+pos_ab
+0007e8a0: 732c 2070 6f73 5f6c 7374 5b6b 5d2b 706f  s, pos_lst[k]+po
+0007e8b0: 735f 6162 732b 6f73 2c20 6769 6e5b 305d  s_abs+os, gin[0]
+0007e8c0: 2c20 6769 6e5b 315d 2c20 2756 272c 206c  , gin[1], 'V', l
+0007e8d0: 656e 5f6c 7374 5b6b 5d2c 205c 0a20 2020  en_lst[k], \.   
+0007e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e8f0: 2020 2020 2020 2020 2020 2069 6e74 2863             int(c
+0007e900: 725b 706f 735f 6c73 745b 6b5d 5d29 2c20  r[pos_lst[k]]), 
+0007e910: 312c 2073 6f70 2c20 736f 632c 2073 6f6e  1, sop, soc, son
+0007e920: 2c20 736e 702c 2073 6e63 2c20 736e 6e20  , snp, snc, snn 
+0007e930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007e940: 2020 736e 765f 696e 666f 5f6c 7374 2e61    snv_info_lst.a
+0007e950: 7070 656e 6428 7369 290a 0a20 2020 2020  ppend(si)..     
+0007e960: 2020 2073 7461 7274 203d 2065 6e64 0a20     start = end. 
+0007e970: 2020 2020 2020 2065 6e64 203d 206d 696e         end = min
+0007e980: 2820 656e 6420 2b20 3130 302c 206c 656e  ( end + 100, len
+0007e990: 5f74 6f5f 7465 7374 2029 0a20 2020 2023  _to_test ).    #
+0007e9a0: 2727 2720 2020 2020 2020 2020 0a20 2020  '''         .   
+0007e9b0: 2072 6574 7572 6e28 736e 765f 696e 666f   return(snv_info
+0007e9c0: 5f6c 7374 290a 0a0a 6465 6620 6669 6e64  _lst)...def find
+0007e9d0: 5f73 6e70 2873 672c 2073 722c 2063 6d61  _snp(sg, sr, cma
+0007e9e0: 742c 2063 6872 6d2c 2070 6f73 5f61 6273  t, chrm, pos_abs
+0007e9f0: 2c20 6f73 2c20 6769 6e29 3a0a 2020 2020  , os, gin):.    
+0007ea00: 0a20 2020 2073 6e76 5f69 6e66 6f5f 6c73  .    snv_info_ls
+0007ea10: 7420 3d20 5b5d 0a20 2020 206c 656e 5f74  t = [].    len_t
+0007ea20: 6f5f 7465 7374 203d 206d 696e 286c 656e  o_test = min(len
+0007ea30: 2873 7229 2c6c 656e 2873 6729 290a 0a20  (sr),len(sg)).. 
+0007ea40: 2020 2063 7220 3d20 636d 6174 2e73 756d     cr = cmat.sum
+0007ea50: 2861 7869 7320 3d20 3029 0a20 2020 206e  (axis = 0).    n
+0007ea60: 7320 3d20 6e70 2e61 7267 6d61 7828 2063  s = np.argmax( c
+0007ea70: 6d61 742c 2061 7869 733d 3020 290a 2020  mat, axis=0 ).  
+0007ea80: 2020 7072 203d 2063 6d61 745b 6e73 2c6e    pr = cmat[ns,n
+0007ea90: 702e 6172 616e 6765 286c 656e 286e 7329  p.arange(len(ns)
+0007eaa0: 295d 2f63 720a 0a20 2020 2070 203d 2030  )]/cr..    p = 0
+0007eab0: 0a20 2020 2070 6f73 5f6c 7374 203d 205b  .    pos_lst = [
+0007eac0: 5d0a 2020 2020 6c65 6e5f 6c73 7420 3d20  ].    len_lst = 
+0007ead0: 5b5d 0a20 2020 2063 7667 5f6c 7374 203d  [].    cvg_lst =
+0007eae0: 205b 5d0a 2020 2020 6366 725f 6c73 7420   [].    cfr_lst 
+0007eaf0: 3d20 5b5d 0a20 2020 2073 6e70 5f6c 7374  = [].    snp_lst
+0007eb00: 203d 205b 5d0a 2020 2020 736e 705f 6f72   = [].    snp_or
+0007eb10: 675f 6c73 7420 3d20 5b5d 0a20 2020 200a  g_lst = [].    .
+0007eb20: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
+0007eb30: 6765 286c 656e 5f74 6f5f 7465 7374 293a  ge(len_to_test):
+0007eb40: 0a20 2020 2020 2020 2069 6620 7372 5b6b  .        if sr[k
+0007eb50: 5d20 213d 2073 675b 6b5d 3a0a 2020 2020  ] != sg[k]:.    
+0007eb60: 2020 2020 2020 2020 6966 2070 203d 3d20          if p == 
+0007eb70: 303a 2070 6f73 203d 206b 0a20 2020 2020  0: pos = k.     
+0007eb80: 2020 2020 2020 2070 202b 3d20 310a 2020         p += 1.  
+0007eb90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0007eba0: 2020 2020 2020 2020 6966 2070 203e 2030          if p > 0
+0007ebb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007ebc0: 2020 2320 6376 675f 6c73 742e 6170 7065    # cvg_lst.appe
+0007ebd0: 6e64 286e 702e 6d65 616e 2820 6372 5b70  nd(np.mean( cr[p
+0007ebe0: 6f73 3a28 706f 732b 7029 5d20 2920 290a  os:(pos+p)] ) ).
+0007ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ec00: 2320 736e 705f 6c73 742e 6170 7065 6e64  # snp_lst.append
+0007ec10: 2873 725b 706f 733a 2870 6f73 2b70 295d  (sr[pos:(pos+p)]
+0007ec20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007ec30: 2020 706f 735f 6c73 742e 6170 7065 6e64    pos_lst.append
+0007ec40: 2870 6f73 290a 2020 2020 2020 2020 2020  (pos).          
+0007ec50: 2020 2020 2020 6c65 6e5f 6c73 742e 6170        len_lst.ap
+0007ec60: 7065 6e64 2870 290a 2020 2020 2020 2020  pend(p).        
+0007ec70: 2020 2020 2020 2020 2320 736e 705f 6f72          # snp_or
+0007ec80: 675f 6c73 742e 6170 7065 6e64 2873 675b  g_lst.append(sg[
+0007ec90: 706f 733a 2870 6f73 2b70 295d 290a 2020  pos:(pos+p)]).  
+0007eca0: 2020 2020 2020 2020 2020 2020 2020 7020                p 
+0007ecb0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0007ecc0: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
+0007ecd0: 6e67 6528 6c65 6e28 706f 735f 6c73 7429  nge(len(pos_lst)
+0007ece0: 293a 0a20 2020 2020 2020 200a 2020 2020  ):.        .    
+0007ecf0: 2020 2020 7031 203d 206d 6178 2830 2c28      p1 = max(0,(
+0007ed00: 706f 735f 6c73 745b 6b5d 2d4e 5749 4e29  pos_lst[k]-NWIN)
+0007ed10: 290a 2020 2020 2020 2020 7032 203d 206d  ).        p2 = m
+0007ed20: 696e 286c 656e 5f74 6f5f 7465 7374 2c28  in(len_to_test,(
+0007ed30: 706f 735f 6c73 745b 6b5d 2b6c 656e 5f6c  pos_lst[k]+len_l
+0007ed40: 7374 5b6b 5d2b 4e57 494e 2929 0a20 2020  st[k]+NWIN)).   
+0007ed50: 2020 2020 200a 2020 2020 2020 2020 736f       .        so
+0007ed60: 7020 3d20 7367 5b70 313a 706f 735f 6c73  p = sg[p1:pos_ls
+0007ed70: 745b 6b5d 5d0a 2020 2020 2020 2020 736f  t[k]].        so
+0007ed80: 6320 3d20 7367 5b70 6f73 5f6c 7374 5b6b  c = sg[pos_lst[k
+0007ed90: 5d3a 2870 6f73 5f6c 7374 5b6b 5d2b 6c65  ]:(pos_lst[k]+le
+0007eda0: 6e5f 6c73 745b 6b5d 295d 0a20 2020 2020  n_lst[k])].     
+0007edb0: 2020 2073 6f6e 203d 2073 675b 2870 6f73     son = sg[(pos
+0007edc0: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
+0007edd0: 6b5d 293a 7032 5d0a 2020 2020 2020 2020  k]):p2].        
+0007ede0: 0a20 2020 2020 2020 2073 6e70 203d 2073  .        snp = s
+0007edf0: 725b 7031 3a70 6f73 5f6c 7374 5b6b 5d5d  r[p1:pos_lst[k]]
+0007ee00: 0a20 2020 2020 2020 2073 6e63 203d 2073  .        snc = s
+0007ee10: 725b 706f 735f 6c73 745b 6b5d 3a28 706f  r[pos_lst[k]:(po
+0007ee20: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
+0007ee30: 5b6b 5d29 5d0a 2020 2020 2020 2020 736e  [k])].        sn
+0007ee40: 6e20 3d20 7372 5b28 706f 735f 6c73 745b  n = sr[(pos_lst[
+0007ee50: 6b5d 2b6c 656e 5f6c 7374 5b6b 5d29 3a70  k]+len_lst[k]):p
+0007ee60: 325d 0a20 2020 2020 2020 200a 2020 2020  2].        .    
+0007ee70: 2020 2020 7369 203d 2053 4e56 5f69 6e66      si = SNV_inf
+0007ee80: 6f28 6368 726d 2c20 706f 735f 6c73 745b  o(chrm, pos_lst[
+0007ee90: 6b5d 2b70 6f73 5f61 6273 2c20 706f 735f  k]+pos_abs, pos_
+0007eea0: 6c73 745b 6b5d 2b70 6f73 5f61 6273 2b6f  lst[k]+pos_abs+o
+0007eeb0: 732c 2067 696e 5b30 5d2c 2067 696e 5b31  s, gin[0], gin[1
+0007eec0: 5d2c 2027 5627 2c20 6c65 6e5f 6c73 745b  ], 'V', len_lst[
+0007eed0: 6b5d 2c20 5c0a 2020 2020 2020 2020 2020  k], \.          
+0007eee0: 2020 2020 2020 2020 2020 2020 696e 7428              int(
+0007eef0: 6372 5b70 6f73 5f6c 7374 5b6b 5d5d 292c  cr[pos_lst[k]]),
+0007ef00: 206e 702e 726f 756e 6428 7072 5b70 6f73   np.round(pr[pos
+0007ef10: 5f6c 7374 5b6b 5d5d 2c33 292c 2073 6f70  _lst[k]],3), sop
+0007ef20: 2c20 736f 632c 2073 6f6e 2c20 736e 702c  , soc, son, snp,
+0007ef30: 2073 6e63 2c20 736e 6e20 290a 2020 2020   snc, snn ).    
+0007ef40: 2020 2020 736e 765f 696e 666f 5f6c 7374      snv_info_lst
+0007ef50: 2e61 7070 656e 6428 7369 290a 0a20 2020  .append(si)..   
+0007ef60: 2072 6574 7572 6e28 736e 765f 696e 666f   return(snv_info
+0007ef70: 5f6c 7374 290a 0a0a 6465 6620 636f 6d70  _lst)...def comp
+0007ef80: 6172 655f 7365 7132 2820 7331 2c20 7332  are_seq2( s1, s2
+0007ef90: 2029 3a0a 2020 2020 636e 7420 3d20 300a   ):.    cnt = 0.
+0007efa0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0007efb0: 6765 286d 696e 286c 656e 2873 3129 2c6c  ge(min(len(s1),l
+0007efc0: 656e 2873 3229 2929 3a0a 2020 2020 2020  en(s2))):.      
+0007efd0: 2020 636e 7420 2b3d 2028 7331 5b69 5d20    cnt += (s1[i] 
+0007efe0: 213d 2073 325b 695d 290a 2020 2020 2320  != s2[i]).    # 
+0007eff0: 6966 206c 656e 2873 3129 2021 3d20 6c65  if len(s1) != le
+0007f000: 6e28 7332 293a 2070 7269 6e74 2827 5741  n(s2): print('WA
+0007f010: 524e 494e 4720 696e 2063 6f6d 7061 7265  RNING in compare
+0007f020: 5f73 6571 323a 2025 6920 213d 2025 6927  _seq2: %i != %i'
+0007f030: 2025 2028 6c65 6e28 7331 292c 6c65 6e28   % (len(s1),len(
+0007f040: 7332 2929 2029 0a20 2020 2072 6574 7572  s2)) ).    retur
+0007f050: 6e20 636e 740a 0a0a 4f53 5f69 6e66 6f20  n cnt...OS_info 
+0007f060: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
+0007f070: 6d65 6474 7570 6c65 2827 4f53 5f69 6e66  medtuple('OS_inf
+0007f080: 6f27 2c20 276f 732c 2073 7461 7274 2c20  o', 'os, start, 
+0007f090: 656e 6427 2920 2320 6f6e 652d 6261 7365  end') # one-base
+0007f0a0: 0a0a 636c 6173 7320 6f66 6673 6574 5f66  ..class offset_f
+0007f0b0: 696e 6465 723a 0a20 2020 200a 2020 2020  inder:.    .    
+0007f0c0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0007f0d0: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+0007f0e0: 2e6f 7369 5f6c 7374 203d 205b 5d0a 2020  .osi_lst = [].  
+0007f0f0: 2020 2020 2020 7365 6c66 2e6f 735f 6d61        self.os_ma
+0007f100: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
+0007f110: 2073 656c 662e 6f73 5f70 7265 7620 3d20   self.os_prev = 
+0007f120: 300a 2020 2020 2020 2020 0a20 2020 2064  0.        .    d
+0007f130: 6566 2061 6464 2820 7365 6c66 2c20 6f73  ef add( self, os
+0007f140: 2c20 7374 6172 742c 2065 6e64 293a 0a20  , start, end):. 
+0007f150: 2020 2020 2020 2073 656c 662e 6f73 695f         self.osi_
+0007f160: 6c73 742e 6170 7065 6e64 2820 4f53 5f69  lst.append( OS_i
+0007f170: 6e66 6f28 6f73 2c20 7374 6172 742c 2065  nfo(os, start, e
+0007f180: 6e64 2920 290a 2020 2020 2020 2020 0a20  nd) ).        . 
+0007f190: 2020 2064 6566 2066 696e 645f 6f73 2820     def find_os( 
+0007f1a0: 7365 6c66 2c20 706f 7320 293a 0a20 2020  self, pos ):.   
+0007f1b0: 2020 2020 206f 7320 3d20 300a 2020 2020       os = 0.    
+0007f1c0: 2020 2020 666f 7220 6f73 6920 696e 2073      for osi in s
+0007f1d0: 656c 662e 6f73 695f 6c73 743a 0a20 2020  elf.osi_lst:.   
+0007f1e0: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
+0007f1f0: 203e 3d20 6f73 692e 7374 6172 7429 2026   >= osi.start) &
+0007f200: 2028 706f 7320 3c20 6f73 692e 656e 6429   (pos < osi.end)
+0007f210: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0007f220: 2020 206f 7320 3d20 6f73 692e 6f73 0a20     os = osi.os. 
+0007f230: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0007f240: 7265 616b 0a20 2020 2020 2020 2072 6574  reak.        ret
+0007f250: 7572 6e20 6f73 0a0a 2020 2020 0a20 2020  urn os..    .   
+0007f260: 2064 6566 2066 696e 645f 6f73 5f73 6571   def find_os_seq
+0007f270: 2820 7365 6c66 2c20 706f 732c 2070 7265  ( self, pos, pre
+0007f280: 765f 692c 206d 6172 6b20 3d20 2727 2029  v_i, mark = '' )
+0007f290: 3a0a 2020 2020 2020 2020 6f73 203d 204e  :.        os = N
+0007f2a0: 6f6e 650a 2020 2020 2020 2020 6e65 7874  one.        next
+0007f2b0: 5f69 203d 2030 0a20 2020 2020 2020 2066  _i = 0.        f
+0007f2c0: 6f72 206b 2c20 6f73 6920 696e 2065 6e75  or k, osi in enu
+0007f2d0: 6d65 7261 7465 2873 656c 662e 6f73 695f  merate(self.osi_
+0007f2e0: 6c73 745b 7072 6576 5f69 3a5d 293a 0a20  lst[prev_i:]):. 
+0007f2f0: 2020 2020 2020 2020 2020 2069 6620 2870             if (p
+0007f300: 6f73 203e 3d20 6f73 692e 7374 6172 7429  os >= osi.start)
+0007f310: 2026 2028 706f 7320 3c20 6f73 692e 656e   & (pos < osi.en
+0007f320: 6429 3a20 0a20 2020 2020 2020 2020 2020  d): .           
+0007f330: 2020 2020 206f 7320 3d20 6f73 692e 6f73       os = osi.os
+0007f340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007f350: 206e 6578 745f 6920 3d20 6b20 2b20 7072   next_i = k + pr
+0007f360: 6576 5f69 200a 2020 2020 2020 2020 2020  ev_i .          
+0007f370: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0007f380: 2020 2020 6966 206f 7320 6973 204e 6f6e      if os is Non
+0007f390: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+0007f3a0: 6f72 206b 2c20 6f73 6920 696e 2065 6e75  or k, osi in enu
+0007f3b0: 6d65 7261 7465 2873 656c 662e 6f73 695f  merate(self.osi_
+0007f3c0: 6c73 745b 3a70 7265 765f 695d 293a 0a20  lst[:prev_i]):. 
+0007f3d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0007f3e0: 6620 2870 6f73 203e 3d20 6f73 692e 7374  f (pos >= osi.st
+0007f3f0: 6172 7429 2026 2028 706f 7320 3c20 6f73  art) & (pos < os
+0007f400: 692e 656e 6429 3a20 0a20 2020 2020 2020  i.end): .       
+0007f410: 2020 2020 2020 2020 2020 2020 206f 7320               os 
+0007f420: 3d20 6f73 692e 6f73 0a20 2020 2020 2020  = osi.os.       
+0007f430: 2020 2020 2020 2020 2020 2020 206e 6578               nex
+0007f440: 745f 6920 3d20 6b0a 2020 2020 2020 2020  t_i = k.        
+0007f450: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0007f460: 6b0a 0a20 2020 2020 2020 2069 6620 6f73  k..        if os
+0007f470: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0007f480: 2020 2020 2020 6f73 203d 2073 656c 662e        os = self.
+0007f490: 6f73 5f70 7265 760a 2020 2020 2020 2020  os_prev.        
+0007f4a0: 2020 2020 2320 7072 696e 7428 2745 5252      # print('ERR
+0007f4b0: 4f52 2069 6e20 6669 6e64 5f6f 735f 7365  OR in find_os_se
+0007f4c0: 713a 206f 7320 6973 204e 6f6e 6520 2573  q: os is None %s
+0007f4d0: 2720 2520 6d61 726b 2029 0a20 2020 2020  ' % mark ).     
+0007f4e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0007f4f0: 2020 2020 2073 656c 662e 6f73 5f70 7265       self.os_pre
+0007f500: 7620 3d20 6f73 0a20 2020 2020 2020 2020  v = os.         
+0007f510: 2020 200a 2020 2020 2020 2020 7265 7475     .        retu
+0007f520: 726e 206f 732c 206e 6578 745f 690a 2020  rn os, next_i.  
+0007f530: 2020 0a20 2020 200a 2020 2020 6465 6620    .    .    def 
+0007f540: 6d61 6b65 5f69 745f 636f 6d70 6163 7428  make_it_compact(
+0007f550: 2073 656c 6620 293a 0a0a 2020 2020 2020   self ):..      
+0007f560: 2020 666f 7220 6b20 696e 2072 6576 6572    for k in rever
+0007f570: 7365 6428 7261 6e67 6528 312c 6c65 6e28  sed(range(1,len(
+0007f580: 7365 6c66 2e6f 7369 5f6c 7374 2929 293a  self.osi_lst))):
+0007f590: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0007f5a0: 7365 6c66 2e6f 7369 5f6c 7374 5b6b 5d2e  self.osi_lst[k].
+0007f5b0: 6f73 203d 3d20 7365 6c66 2e6f 7369 5f6c  os == self.osi_l
+0007f5c0: 7374 5b6b 2d31 5d2e 6f73 3a0a 2020 2020  st[k-1].os:.    
+0007f5d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0007f5e0: 2e6f 7369 5f6c 7374 5b6b 2d31 5d20 3d20  .osi_lst[k-1] = 
+0007f5f0: 4f53 5f69 6e66 6f28 2073 656c 662e 6f73  OS_info( self.os
+0007f600: 695f 6c73 745b 6b2d 315d 2e6f 732c 2073  i_lst[k-1].os, s
+0007f610: 656c 662e 6f73 695f 6c73 745b 6b2d 315d  elf.osi_lst[k-1]
+0007f620: 2e73 7461 7274 2c20 7365 6c66 2e6f 7369  .start, self.osi
+0007f630: 5f6c 7374 5b6b 5d2e 656e 6420 290a 2020  _lst[k].end ).  
+0007f640: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0007f650: 6c20 7365 6c66 2e6f 7369 5f6c 7374 5b6b  l self.osi_lst[k
+0007f660: 5d0a 2020 2020 2020 2020 0a20 2020 2064  ].        .    d
+0007f670: 6566 2067 6574 5f62 6e64 7279 2820 7365  ef get_bndry( se
+0007f680: 6c66 2c20 706f 7320 293a 0a20 2020 2020  lf, pos ):.     
+0007f690: 2020 206f 7320 3d20 300a 2020 2020 2020     os = 0.      
+0007f6a0: 2020 666f 7220 6f73 6920 696e 2073 656c    for osi in sel
+0007f6b0: 662e 6f73 695f 6c73 743a 0a20 2020 2020  f.osi_lst:.     
+0007f6c0: 2020 2020 2020 2069 6620 2870 6f73 203e         if (pos >
+0007f6d0: 3d20 6f73 692e 7374 6172 7429 3a20 0a20  = osi.start): . 
+0007f6e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0007f6f0: 7320 3d20 6f73 692e 7374 6172 740a 2020  s = osi.start.  
+0007f700: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0007f710: 6561 6b0a 2020 2020 2020 2020 7265 7475  eak.        retu
+0007f720: 726e 206f 730a 2020 2020 0a20 2020 2064  rn os.    .    d
+0007f730: 6566 2067 6574 5f62 6e64 7279 5f73 6571  ef get_bndry_seq
+0007f740: 2820 7365 6c66 2c20 706f 732c 2070 7265  ( self, pos, pre
+0007f750: 765f 6920 293a 0a20 2020 2020 2020 206f  v_i ):.        o
+0007f760: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
+0007f770: 206e 6578 745f 6920 3d20 300a 2020 2020   next_i = 0.    
+0007f780: 2020 2020 666f 7220 6b2c 206f 7369 2069      for k, osi i
+0007f790: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
+0007f7a0: 2e6f 7369 5f6c 7374 5b70 7265 765f 693a  .osi_lst[prev_i:
+0007f7b0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0007f7c0: 6966 2028 706f 7320 3e3d 206f 7369 2e73  if (pos >= osi.s
+0007f7d0: 7461 7274 2920 2620 2870 6f73 203c 206f  tart) & (pos < o
+0007f7e0: 7369 2e65 6e64 293a 200a 2020 2020 2020  si.end): .      
+0007f7f0: 2020 2020 2020 2020 2020 6f73 203d 206f            os = o
+0007f800: 7369 2e73 7461 7274 0a20 2020 2020 2020  si.start.       
+0007f810: 2020 2020 2020 2020 206e 6578 745f 6920           next_i 
+0007f820: 3d20 6b20 2b20 7072 6576 5f69 200a 2020  = k + prev_i .  
+0007f830: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0007f840: 6561 6b0a 2020 2020 2020 2020 6966 206f  eak.        if o
+0007f850: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+0007f860: 2020 2020 2020 2066 6f72 206b 2c20 6f73         for k, os
+0007f870: 6920 696e 2065 6e75 6d65 7261 7465 2873  i in enumerate(s
+0007f880: 656c 662e 6f73 695f 6c73 745b 3a70 7265  elf.osi_lst[:pre
+0007f890: 765f 695d 293a 0a20 2020 2020 2020 2020  v_i]):.         
+0007f8a0: 2020 2020 2020 2069 6620 2870 6f73 203e         if (pos >
+0007f8b0: 3d20 6f73 692e 7374 6172 7429 2026 2028  = osi.start) & (
+0007f8c0: 706f 7320 3c20 6f73 692e 656e 6429 3a20  pos < osi.end): 
+0007f8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007f8e0: 2020 2020 206f 7320 3d20 6f73 692e 7374       os = osi.st
+0007f8f0: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
+0007f900: 2020 2020 2020 2020 6e65 7874 5f69 203d          next_i =
+0007f910: 206b 0a20 2020 2020 2020 2020 2020 2020   k.             
+0007f920: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0007f930: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007f940: 2020 6966 206f 7320 6973 204e 6f6e 653a    if os is None:
+0007f950: 0a20 2020 2020 2020 2020 2020 206f 7320  .            os 
+0007f960: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0007f970: 6e65 7874 5f69 203d 2030 0a20 2020 2020  next_i = 0.     
+0007f980: 2020 2020 2020 2070 7269 6e74 2827 4552         print('ER
+0007f990: 524f 5220 696e 2067 6574 5f62 6e64 7279  ROR in get_bndry
+0007f9a0: 5f73 6571 3a20 6f73 2069 7320 4e6f 6e65  _seq: os is None
+0007f9b0: 2729 0a20 2020 2020 2020 2020 2020 2023  ').            #
+0007f9c0: 2073 656c 662e 7072 696e 7428 290a 2020   self.print().  
+0007f9d0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0007f9e0: 2020 2072 6574 7572 6e20 6f73 2c20 6e65     return os, ne
+0007f9f0: 7874 5f69 0a20 2020 200a 2020 2020 0a20  xt_i.    .    . 
+0007fa00: 2020 2064 6566 2070 7269 6e74 2873 656c     def print(sel
+0007fa10: 6629 3a0a 2020 2020 2020 2020 666f 7220  f):.        for 
+0007fa20: 6f73 6920 696e 2073 656c 662e 6f73 695f  osi in self.osi_
+0007fa30: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
+0007fa40: 2070 7269 6e74 2827 2569 202d 2025 693a   print('%i - %i:
+0007fa50: 2025 6927 2025 2028 6f73 692e 7374 6172   %i' % (osi.star
+0007fa60: 742c 206f 7369 2e65 6e64 2c20 6f73 692e  t, osi.end, osi.
+0007fa70: 6f73 2929 0a0a 2020 2020 2020 2020 2020  os))..          
+0007fa80: 2020 0a64 6566 2047 656e 6572 6174 655f    .def Generate_
+0007fa90: 5265 6665 7265 6e63 6528 6774 665f 6669  Reference(gtf_fi
+0007faa0: 6c65 2c20 6765 6e6f 6d65 5f66 696c 652c  le, genome_file,
+0007fab0: 2070 6570 7469 6465 203d 2054 7275 652c   peptide = True,
+0007fac0: 206f 7574 5f64 6972 203d 204e 6f6e 652c   out_dir = None,
+0007fad0: 2073 7566 6669 7820 3d20 4e6f 6e65 293a   suffix = None):
+0007fae0: 0a0a 2020 2020 6765 6e6f 6d65 203d 206c  ..    genome = l
+0007faf0: 6f61 645f 6765 6e6f 6d65 2867 656e 6f6d  oad_genome(genom
+0007fb00: 655f 6669 6c65 2c20 7665 7262 6f73 6520  e_file, verbose 
+0007fb10: 3d20 5472 7565 290a 0a20 2020 2067 7466  = True)..    gtf
+0007fb20: 5f6c 696e 6573 2c20 6864 725f 6c69 6e65  _lines, hdr_line
+0007fb30: 7320 3d20 6c6f 6164 5f67 7466 2867 7466  s = load_gtf(gtf
+0007fb40: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
+0007fb50: 2054 7275 6529 0a20 2020 2067 645f 6c73   True).    gd_ls
+0007fb60: 742c 2063 6872 7320 3d20 6765 745f 6765  t, chrs = get_ge
+0007fb70: 6e65 5f64 6573 6372 6970 746f 7228 6774  ne_descriptor(gt
+0007fb80: 665f 6c69 6e65 732c 2067 656e 6f6d 6520  f_lines, genome 
+0007fb90: 3d20 4e6f 6e65 2c20 6669 6c6c 203d 2046  = None, fill = F
+0007fba0: 616c 7365 2c20 5c0a 2020 2020 2020 2020  alse, \.        
+0007fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007fbd0: 2020 2063 6720 3d20 4661 6c73 652c 2076     cg = False, v
+0007fbe0: 6572 626f 7365 203d 2054 7275 652c 206e  erbose = True, n
+0007fbf0: 5f63 6f72 6573 203d 2031 290a 2020 2020  _cores = 1).    
+0007fc00: 6764 5f6c 7374 732c 2063 6872 5f6c 7374  gd_lsts, chr_lst
+0007fc10: 203d 2070 6163 6b5f 6765 6e65 5f64 6573   = pack_gene_des
+0007fc20: 6372 6970 746f 7228 2067 645f 6c73 742c  criptor( gd_lst,
+0007fc30: 2063 6872 7320 290a 2020 2020 0a0a 2020   chrs ).    ..  
+0007fc40: 2020 2320 6669 6c65 5f6e 616d 6520 3d20    # file_name = 
+0007fc50: 6774 665f 6669 6c65 2e73 706c 6974 2827  gtf_file.split('
+0007fc60: 2f27 295b 2d31 5d0a 2020 2020 2320 666e  /')[-1].    # fn
+0007fc70: 7320 3d20 6669 6c65 5f6e 616d 652e 7370  s = file_name.sp
+0007fc80: 6c69 7428 272e 2729 5b3a 2d31 5d0a 2020  lit('.')[:-1].  
+0007fc90: 2020 666e 7320 3d20 6774 665f 6669 6c65    fns = gtf_file
+0007fca0: 2e73 706c 6974 2827 2e27 295b 3a2d 315d  .split('.')[:-1]
+0007fcb0: 0a20 2020 2066 6e61 6d65 203d 2027 270a  .    fname = ''.
+0007fcc0: 2020 2020 666f 7220 6b2c 2066 6e20 696e      for k, fn in
+0007fcd0: 2065 6e75 6d65 7261 7465 2866 6e73 293a   enumerate(fns):
+0007fce0: 0a20 2020 2020 2020 2069 6620 6b20 3e20  .        if k > 
+0007fcf0: 303a 0a20 2020 2020 2020 2020 2020 2066  0:.            f
+0007fd00: 6e61 6d65 203d 2066 6e61 6d65 202b 2027  name = fname + '
+0007fd10: 2e27 0a20 2020 2020 2020 2066 6e61 6d65  .'.        fname
+0007fd20: 203d 2066 6e61 6d65 202b 2066 6e0a 2020   = fname + fn.  
+0007fd30: 2020 6966 206f 7574 5f64 6972 2069 7320    if out_dir is 
+0007fd40: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0007fd50: 2020 6966 206f 7574 5f64 6972 5b2d 315d    if out_dir[-1]
+0007fd60: 203d 3d20 272f 273a 0a20 2020 2020 2020   == '/':.       
+0007fd70: 2020 2020 2066 6e61 6d65 203d 206f 7574       fname = out
+0007fd80: 5f64 6972 202b 2066 6e61 6d65 0a20 2020  _dir + fname.   
+0007fd90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0007fda0: 2020 2020 2020 2066 6e61 6d65 203d 206f         fname = o
+0007fdb0: 7574 5f64 6972 202b 2027 2f27 202b 2066  ut_dir + '/' + f
+0007fdc0: 6e61 6d65 0a0a 2020 2020 6966 2073 7566  name..    if suf
+0007fdd0: 6669 7820 6973 204e 6f6e 653a 2020 2020  fix is None:    
+0007fde0: 0a20 2020 2020 2020 2066 615f 6669 6c65  .        fa_file
+0007fdf0: 5f74 7220 3d20 666e 616d 6520 2b20 275f  _tr = fname + '_
+0007fe00: 7472 616e 7363 7269 7074 6f6d 652e 6661  transcriptome.fa
+0007fe10: 270a 2020 2020 2020 2020 6661 5f66 696c  '.        fa_fil
+0007fe20: 655f 7072 203d 2066 6e61 6d65 202b 2027  e_pr = fname + '
+0007fe30: 5f70 726f 7465 6f6d 652e 6661 270a 2020  _proteome.fa'.  
+0007fe40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0007fe50: 6661 5f66 696c 655f 7472 203d 2066 6e61  fa_file_tr = fna
+0007fe60: 6d65 202b 2027 5f25 735f 7472 616e 7363  me + '_%s_transc
+0007fe70: 7269 7074 6f6d 652e 6661 2720 2520 7375  riptome.fa' % su
+0007fe80: 6666 6978 0a20 2020 2020 2020 2066 615f  ffix.        fa_
+0007fe90: 6669 6c65 5f70 7220 3d20 666e 616d 6520  file_pr = fname 
+0007fea0: 2b20 275f 2573 5f70 726f 7465 6f6d 652e  + '_%s_proteome.
+0007feb0: 6661 2720 2520 7375 6666 6978 0a0a 2020  fa' % suffix..  
+0007fec0: 2020 6661 5f74 7220 3d20 5b5d 0a20 2020    fa_tr = [].   
+0007fed0: 2066 615f 7072 203d 205b 5d0a 2020 2020   fa_pr = [].    
+0007fee0: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
+0007fef0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
+0007ff00: 2020 6e74 7220 3d20 300a 0a20 2020 206d    ntr = 0..    m
+0007ff10: 6178 5f61 626e 203d 2030 0a20 2020 206d  ax_abn = 0.    m
+0007ff20: 6178 5f63 6f76 203d 2030 0a20 2020 2066  ax_cov = 0.    f
+0007ff30: 6f72 206b 6b2c 2063 6872 6d20 696e 2065  or kk, chrm in e
+0007ff40: 6e75 6d65 7261 7465 2863 6872 5f6c 7374  numerate(chr_lst
+0007ff50: 293a 0a20 2020 2020 2020 2066 6f72 2067  ):.        for g
+0007ff60: 6420 696e 2067 645f 6c73 7473 5b6b 6b5d  d in gd_lsts[kk]
+0007ff70: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+0007ff80: 7220 7464 2069 6e20 6764 2e74 645f 6c73  r td in gd.td_ls
+0007ff90: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0007ffa0: 2020 2069 6620 7464 2e61 626e 203e 2030     if td.abn > 0
+0007ffb0: 3a20 6d61 785f 6162 6e20 3d20 6d61 7828  : max_abn = max(
+0007ffc0: 206d 6178 5f61 626e 2c20 7464 2e61 626e   max_abn, td.abn
+0007ffd0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0007ffe0: 2020 2069 6620 7464 2e63 6f76 203e 2030     if td.cov > 0
+0007fff0: 3a20 6d61 785f 636f 7620 3d20 6d61 7828  : max_cov = max(
+00080000: 206d 6178 5f63 6f76 2c20 7464 2e63 6f76   max_cov, td.cov
+00080010: 2029 0a0a 2020 2020 6966 206d 6178 5f61   )..    if max_a
+00080020: 626e 203e 2030 3a20 6162 6e5f 7468 203d  bn > 0: abn_th =
+00080030: 204d 494e 5f41 424e 5f54 4f5f 5345 4c0a   MIN_ABN_TO_SEL.
+00080040: 2020 2020 656c 7365 3a20 6162 6e5f 7468      else: abn_th
+00080050: 203d 2030 0a20 2020 2069 6620 6d61 785f   = 0.    if max_
+00080060: 636f 7620 3e20 303a 2063 6f76 5f74 6820  cov > 0: cov_th 
+00080070: 3d20 4d49 4e5f 434f 565f 544f 5f53 454c  = MIN_COV_TO_SEL
+00080080: 0a20 2020 2065 6c73 653a 2063 6f76 5f74  .    else: cov_t
+00080090: 6820 3d20 300a 2020 2020 7072 696e 7428  h = 0.    print(
+000800a0: 2743 7574 6f66 663a 2041 203d 2025 352e  'Cutoff: A = %5.
+000800b0: 3266 2c20 4320 3d20 2535 2e32 6620 2720  2f, C = %5.2f ' 
+000800c0: 2520 2861 626e 5f74 682c 2063 6f76 5f74  % (abn_th, cov_t
+000800d0: 6829 290a 0a20 2020 2066 6f72 206b 6b2c  h))..    for kk,
+000800e0: 2063 6872 6d20 696e 2065 6e75 6d65 7261   chrm in enumera
+000800f0: 7465 2863 6872 5f6c 7374 293a 0a0a 2020  te(chr_lst):..  
+00080100: 2020 2020 2020 7072 696e 7428 275c 7227        print('\r'
+00080110: 202b 2027 2027 2a31 3030 2c20 656e 643d   + ' '*100, end=
+00080120: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
+00080130: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00080140: 275c 7247 656e 6572 6174 696e 6720 7265  '\rGenerating re
+00080150: 6665 7265 6e63 6573 202e 2e20 2573 2020  ferences .. %s  
+00080160: 2720 2520 2863 6872 6d29 2c20 656e 6420  ' % (chrm), end 
+00080170: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
+00080180: 7565 290a 0a20 2020 2020 2020 2066 6f72  ue)..        for
+00080190: 2067 6420 696e 2067 645f 6c73 7473 5b6b   gd in gd_lsts[k
+000801a0: 6b5d 3a0a 2020 2020 2020 2020 2020 2020  k]:.            
+000801b0: 2320 6764 2e6f 7264 6572 2829 0a20 2020  # gd.order().   
+000801c0: 2020 2020 2020 2020 206e 7472 202b 3d20           ntr += 
+000801d0: 6764 2e6e 7472 0a20 2020 2020 2020 2020  gd.ntr.         
+000801e0: 2020 2066 615f 742c 2066 615f 7020 3d20     fa_t, fa_p = 
+000801f0: 6764 2e67 6574 5f66 6173 7461 5f6c 696e  gd.get_fasta_lin
+00080200: 6573 5f66 726f 6d5f 6765 6e6f 6d65 2867  es_from_genome(g
+00080210: 656e 6f6d 652c 2061 626e 5f74 6820 3d20  enome, abn_th = 
+00080220: 6162 6e5f 7468 2c20 636f 765f 7468 203d  abn_th, cov_th =
+00080230: 2063 6f76 5f74 682c 206c 656e 5f74 685f   cov_th, len_th_
+00080240: 743d 204d 494e 5f54 525f 4c45 4e47 5448  t= MIN_TR_LENGTH
+00080250: 2c20 6c65 6e5f 7468 5f70 203d 204d 494e  , len_th_p = MIN
+00080260: 5f50 525f 4c45 4e47 5448 290a 2020 2020  _PR_LENGTH).    
+00080270: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00080280: 2020 2020 2023 2066 615f 7420 3d20 6669       # fa_t = fi
+00080290: 6c74 6572 5f74 7273 5f6c 656e 2866 615f  lter_trs_len(fa_
+000802a0: 742c 206d 696e 5f6c 656e 203d 204d 494e  t, min_len = MIN
+000802b0: 5f54 525f 4c45 4e47 5448 290a 2020 2020  _TR_LENGTH).    
+000802c0: 2020 2020 2020 2020 2320 6661 5f70 203d          # fa_p =
+000802d0: 2066 696c 7465 725f 7472 735f 6c65 6e28   filter_trs_len(
+000802e0: 6661 5f70 2c20 6d69 6e5f 6c65 6e20 3d20  fa_p, min_len = 
+000802f0: 4d49 4e5f 5052 5f4c 454e 4754 4829 0a20  MIN_PR_LENGTH). 
+00080300: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00080310: 2020 2020 2020 2020 6661 5f74 7220 3d20          fa_tr = 
+00080320: 6661 5f74 7220 2b20 6661 5f74 0a20 2020  fa_tr + fa_t.   
+00080330: 2020 2020 2020 2020 2066 615f 7072 203d           fa_pr =
+00080340: 2066 615f 7072 202b 2066 615f 700a 2020   fa_pr + fa_p.  
+00080350: 2020 2020 2020 2020 2020 0a20 2020 200a            .    .
+00080360: 2020 2020 6966 2028 6c65 6e28 6661 5f70      if (len(fa_p
+00080370: 7229 203d 3d20 3029 2026 2028 7065 7074  r) == 0) & (pept
+00080380: 6964 6529 3a0a 2020 2020 2020 2020 6864  ide):.        hd
+00080390: 725f 6c73 742c 2074 7365 715f 6c73 7420  r_lst, tseq_lst 
+000803a0: 3d20 5b5d 2c20 5b5d 0a20 2020 2020 2020  = [], [].       
+000803b0: 2066 6f72 206c 696e 6520 696e 2066 615f   for line in fa_
+000803c0: 7472 3a0a 2020 2020 2020 2020 2020 2020  tr:.            
+000803d0: 6966 206c 696e 655b 305d 203d 3d20 273e  if line[0] == '>
+000803e0: 273a 2068 6472 5f6c 7374 2e61 7070 656e  ': hdr_lst.appen
+000803f0: 6428 6c69 6e65 5b31 3a2d 315d 290a 2020  d(line[1:-1]).  
+00080400: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
+00080410: 7473 6571 5f6c 7374 2e61 7070 656e 6428  tseq_lst.append(
+00080420: 6c69 6e65 5b30 3a2d 315d 290a 0a20 2020  line[0:-1])..   
+00080430: 2020 2020 2066 615f 7072 203d 2067 656e       fa_pr = gen
+00080440: 5f70 726f 7465 6f6d 655f 6672 6f6d 5f74  _proteome_from_t
+00080450: 7261 7363 7269 7074 6f6d 6528 6864 725f  rascriptome(hdr_
+00080460: 6c73 742c 2074 7365 715f 6c73 742c 206c  lst, tseq_lst, l
+00080470: 656e 5f74 6820 3d20 4d49 4e5f 5052 5f4c  en_th = MIN_PR_L
+00080480: 454e 4754 482c 2076 6572 626f 7365 203d  ENGTH, verbose =
+00080490: 2054 7275 652c 2074 7261 7265 636f 203d   True, trareco =
+000804a0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+000804b0: 705f 6361 6e64 5f63 6e74 203d 206c 656e  p_cand_cnt = len
+000804c0: 2866 615f 7072 292f 320a 0a20 2020 2020  (fa_pr)/2..     
+000804d0: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
+000804e0: 7261 7469 6e67 2072 6566 6572 656e 6365  rating reference
+000804f0: 7320 2e2e 2064 6f6e 652e 2025 6920 2d3e  s .. done. %i ->
+00080500: 2025 692c 2569 2720 2520 286e 7472 2c20   %i,%i' % (ntr, 
+00080510: 6c65 6e28 6661 5f74 7229 2f32 2c20 705f  len(fa_tr)/2, p_
+00080520: 6361 6e64 5f63 6e74 2929 0a20 2020 2065  cand_cnt)).    e
+00080530: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
 00080540: 6e74 2827 5c72 4765 6e65 7261 7469 6e67  nt('\rGenerating
 00080550: 2072 6566 6572 656e 6365 7320 2e2e 2064   references .. d
-00080560: 6f6e 652e 2025 6920 2d3e 2025 692c 2569  one. %i -> %i,%i
-00080570: 2720 2520 286e 7472 2c20 6c65 6e28 6661  ' % (ntr, len(fa
-00080580: 5f74 7229 2f32 2c20 705f 6361 6e64 5f63  _tr)/2, p_cand_c
-00080590: 6e74 2929 0a20 2020 2065 6c73 653a 0a20  nt)).    else:. 
-000805a0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-000805b0: 4765 6e65 7261 7469 6e67 2072 6566 6572  Generating refer
-000805c0: 656e 6365 7320 2e2e 2064 6f6e 652e 2025  ences .. done. %
-000805d0: 6920 2d3e 2025 6927 2025 2028 6e74 722c  i -> %i' % (ntr,
-000805e0: 206c 656e 2866 615f 7472 292f 3229 290a   len(fa_tr)/2)).
-000805f0: 0a20 2020 2070 7269 6e74 2827 5361 7669  .    print('Savi
-00080600: 6e67 2046 4153 5441 202e 2e27 2c20 656e  ng FASTA ..', en
-00080610: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
-00080620: 5472 7565 290a 2020 2020 6620 3d20 6f70  True).    f = op
-00080630: 656e 2866 615f 6669 6c65 5f74 722c 2027  en(fa_file_tr, '
-00080640: 772b 2729 0a20 2020 2066 2e77 7269 7465  w+').    f.write
-00080650: 6c69 6e65 7328 6661 5f74 7229 0a20 2020  lines(fa_tr).   
-00080660: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
-00080670: 6966 2070 6570 7469 6465 3a0a 2020 2020  if peptide:.    
-00080680: 2020 2020 7072 696e 7428 272e 272c 2065      print('.', e
-00080690: 6e64 3d27 2729 0a20 2020 2020 2020 2066  nd='').        f
-000806a0: 203d 206f 7065 6e28 6661 5f66 696c 655f   = open(fa_file_
-000806b0: 7072 2c20 2777 2b27 290a 2020 2020 2020  pr, 'w+').      
-000806c0: 2020 662e 7772 6974 656c 696e 6573 2866    f.writelines(f
-000806d0: 615f 7072 290a 2020 2020 2020 2020 662e  a_pr).        f.
-000806e0: 636c 6f73 6528 290a 0a20 2020 2065 6c61  close()..    ela
-000806f0: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
-00080700: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-00080710: 7469 6d65 0a20 2020 2070 7269 6e74 2827  time.    print('
-00080720: 2064 6f6e 652e 2028 2569 2920 2720 2520   done. (%i) ' % 
-00080730: 2865 6c61 7073 6564 5f74 696d 6529 290a  (elapsed_time)).
-00080740: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
-00080750: 2720 2520 6661 5f66 696c 655f 7472 2029  ' % fa_file_tr )
-00080760: 0a20 2020 2069 6620 7065 7074 6964 653a  .    if peptide:
-00080770: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
-00080780: 2066 615f 6669 6c65 5f70 7220 290a 2020   fa_file_pr ).  
-00080790: 2020 0a20 2020 2072 6574 7572 6e20 6661    .    return fa
-000807a0: 5f66 696c 655f 7472 2c20 6661 5f66 696c  _file_tr, fa_fil
-000807b0: 655f 7072 0a20 2020 200a 0a64 6566 206d  e_pr.    ..def m
-000807c0: 635f 636f 7265 5f72 6563 6f6e 7374 7275  c_core_reconstru
-000807d0: 6374 696f 6e28 6767 635f 7475 706c 6529  ction(ggc_tuple)
-000807e0: 3a0a 2020 2020 0a20 2020 2067 645f 7365  :.    .    gd_se
-000807f0: 6c20 3d20 6767 635f 7475 706c 655b 305d  l = ggc_tuple[0]
-00080800: 0a20 2020 2073 6571 5f6f 7267 203d 2067  .    seq_org = g
-00080810: 6763 5f74 7570 6c65 5b31 5d0a 2020 2020  gc_tuple[1].    
-00080820: 6368 726d 203d 2067 6763 5f74 7570 6c65  chrm = ggc_tuple
-00080830: 5b32 5d0a 2020 2020 0a20 2020 2023 2067  [2].    .    # g
-00080840: 645f 7365 6c20 3d20 736f 7274 5f64 6573  d_sel = sort_des
-00080850: 6372 6970 746f 725f 6c73 7428 6764 5f73  criptor_lst(gd_s
-00080860: 656c 290a 2020 2020 6e5f 6764 203d 206c  el).    n_gd = l
-00080870: 656e 2867 645f 7365 6c29 0a0a 2020 2020  en(gd_sel)..    
-00080880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000808a0: 2323 230a 2020 2020 2323 2063 6f6c 6c65  ###.    ## colle
-000808b0: 6374 2072 676e 7320 616e 6420 6d61 726b  ct rgns and mark
-000808c0: 2074 6865 6972 2070 6f73 0a20 2020 200a   their pos.    .
-000808d0: 2020 2020 7374 6172 745f 7469 6d65 203d      start_time =
-000808e0: 2074 696d 652e 7469 6d65 2829 0a20 2020   time.time().   
-000808f0: 206c 6f63 5f6f 7320 3d20 6e70 2e7a 6572   loc_os = np.zer
-00080900: 6f73 286e 5f67 642c 6474 7970 653d 6e70  os(n_gd,dtype=np
-00080910: 2e66 6c6f 6174 3332 290a 2020 2020 6e75  .float32).    nu
-00080920: 6d5f 6f73 203d 206e 702e 7a65 726f 7328  m_os = np.zeros(
-00080930: 6e5f 6764 2c64 7479 7065 3d6e 702e 666c  n_gd,dtype=np.fl
-00080940: 6f61 7433 3229 0a20 2020 2072 616c 6c20  oat32).    rall 
-00080950: 3d20 7265 6769 6f6e 7328 290a 2020 2020  = regions().    
-00080960: 4765 6e65 5f69 645f 6e61 6d65 203d 205b  Gene_id_name = [
-00080970: 5d0a 2020 2020 6764 5f69 6478 5f6f 665f  ].    gd_idx_of_
-00080980: 7267 6e20 3d20 5b5d 0a20 2020 206f 735f  rgn = [].    os_
-00080990: 6375 7220 3d20 300a 2020 2020 725f 706f  cur = 0.    r_po
-000809a0: 7320 3d20 5b5d 0a20 2020 2066 6f72 206b  s = [].    for k
-000809b0: 2c20 6764 2069 6e20 656e 756d 6572 6174  , gd in enumerat
-000809c0: 6528 6764 5f73 656c 293a 0a0a 2020 2020  e(gd_sel):..    
-000809d0: 2020 2020 2323 2063 6865 636b 2069 6620      ## check if 
-000809e0: 616e 7920 4420 6f72 2049 206c 6965 7320  any D or I lies 
-000809f0: 7769 7468 696e 2061 6e20 6578 6f6e 0a20  within an exon. 
-00080a00: 2020 2020 2020 2066 6f72 2065 2069 6e20         for e in 
-00080a10: 6764 2e65 786f 6e73 2e72 676e 733a 0a20  gd.exons.rgns:. 
-00080a20: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
-00080a30: 7479 7065 203d 3d20 2764 656c 6574 696f  type == 'deletio
-00080a40: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-00080a50: 2020 2020 6220 3d20 4661 6c73 650a 2020      b = False.  
-00080a60: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00080a70: 7220 6320 696e 2067 642e 6578 6f6e 732e  r c in gd.exons.
-00080a80: 7267 6e73 3a0a 2020 2020 2020 2020 2020  rgns:.          
-00080a90: 2020 2020 2020 2020 2020 6966 2028 632e            if (c.
-00080aa0: 7479 7065 203d 3d20 2765 786f 6e27 293a  type == 'exon'):
-00080ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00080ac0: 2020 2020 2020 2020 2069 6620 652e 6861           if e.ha
-00080ad0: 735f 6578 745f 696e 7465 7273 6563 7469  s_ext_intersecti
-00080ae0: 6f6e 5f77 6974 6828 6329 3a0a 2020 2020  on_with(c):.    
-00080af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080b00: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
-00080b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00080b20: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00080b30: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00080b40: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
-00080b50: 2020 2020 2020 2069 6620 623a 0a20 2020         if b:.   
-00080b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080b70: 2070 7269 6e74 2827 5741 524e 494e 473a   print('WARNING:
-00080b80: 2044 2825 733a 2569 2d25 6929 206f 7665   D(%s:%i-%i) ove
-00080b90: 726c 6170 7320 7769 7468 2045 2825 733a  rlaps with E(%s:
-00080ba0: 2569 2d25 6929 2720 2520 5c0a 2020 2020  %i-%i)' % \.    
-00080bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080bc0: 2020 2020 2020 2865 2e63 6872 2c20 652e        (e.chr, e.
-00080bd0: 7374 6172 742c 2065 2e65 6e64 2c20 632e  start, e.end, c.
-00080be0: 6368 722c 2063 2e73 7461 7274 2c20 632e  chr, c.start, c.
-00080bf0: 656e 6429 290a 2020 2020 2020 2020 2020  end)).          
-00080c00: 2020 2020 2020 2727 2720 2020 200a 2020        '''    .  
-00080c10: 2020 2020 2020 2020 2020 656c 6966 2065            elif e
-00080c20: 2e74 7970 6520 3d3d 2027 696e 7365 7273  .type == 'insers
-00080c30: 696f 6e27 3a0a 2020 2020 2020 2020 2020  ion':.          
-00080c40: 2020 2020 2020 6220 3d20 4661 6c73 650a        b = False.
-00080c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080c60: 666f 7220 6320 696e 2067 642e 6578 6f6e  for c in gd.exon
-00080c70: 732e 7267 6e73 3a0a 2020 2020 2020 2020  s.rgns:.        
-00080c80: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00080c90: 632e 7479 7065 203d 3d20 2765 786f 6e27  c.type == 'exon'
-00080ca0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00080cb0: 2020 2020 2020 2020 2020 2069 6620 2865             if (e
-00080cc0: 2e73 7461 7274 203e 2063 2e73 7461 7274  .start > c.start
-00080cd0: 2920 2620 2865 2e73 7461 7274 203c 2063  ) & (e.start < c
-00080ce0: 2e65 6e64 293a 0a20 2020 2020 2020 2020  .end):.         
-00080cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080d00: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
-00080d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080d20: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00080d30: 2020 2020 2020 2020 2020 2020 2020 2727                ''
-00080d40: 2720 2020 200a 2020 2020 2020 2020 2020  '    .          
-00080d50: 2020 2020 2020 6966 2062 3a0a 2020 2020        if b:.    
-00080d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080d70: 7072 696e 7428 2757 4152 4e49 4e47 3a20  print('WARNING: 
-00080d80: 4928 2573 3a25 692d 2569 2920 6f76 6572  I(%s:%i-%i) over
-00080d90: 6c61 7073 2077 6974 6820 4528 2573 3a25  laps with E(%s:%
-00080da0: 692d 2569 2927 2025 205c 0a20 2020 2020  i-%i)' % \.     
-00080db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080dc0: 2020 2020 2028 652e 6368 722c 2065 2e73       (e.chr, e.s
-00080dd0: 7461 7274 2c20 652e 656e 642c 2063 2e63  tart, e.end, c.c
-00080de0: 6872 2c20 632e 7374 6172 742c 2063 2e65  hr, c.start, c.e
-00080df0: 6e64 2929 0a20 2020 2020 2020 2020 2020  nd)).           
-00080e00: 2020 2020 2027 2727 2020 2020 0a0a 2020       '''    ..  
-00080e10: 2020 2020 2020 6c6f 635f 6f73 5b6b 5d20        loc_os[k] 
-00080e20: 3d20 6f73 5f63 7572 0a20 2020 2020 2020  = os_cur.       
-00080e30: 206e 756d 5f6f 735b 6b5d 203d 206c 656e   num_os[k] = len
-00080e40: 2867 642e 6578 6f6e 732e 7267 6e73 290a  (gd.exons.rgns).
-00080e50: 2020 2020 2020 2020 7261 6c6c 2e72 676e          rall.rgn
-00080e60: 7320 3d20 7261 6c6c 2e72 676e 7320 2b20  s = rall.rgns + 
-00080e70: 6764 2e65 786f 6e73 2e72 676e 730a 2020  gd.exons.rgns.  
-00080e80: 2020 2020 2020 675f 6964 5f6e 5f6e 616d        g_id_n_nam
-00080e90: 655f 6c73 7420 3d20 6764 2e67 6574 5f67  e_lst = gd.get_g
-00080ea0: 6964 5f6e 5f67 6e61 6d65 5f6c 6973 7428  id_n_gname_list(
-00080eb0: 290a 2020 2020 2020 2020 4765 6e65 5f69  ).        Gene_i
-00080ec0: 645f 6e61 6d65 203d 2047 656e 655f 6964  d_name = Gene_id
-00080ed0: 5f6e 616d 6520 2b20 675f 6964 5f6e 5f6e  _name + g_id_n_n
-00080ee0: 616d 655f 6c73 740a 2020 2020 2020 2020  ame_lst.        
-00080ef0: 6764 5f69 6478 5f6f 665f 7267 6e20 3d20  gd_idx_of_rgn = 
-00080f00: 6764 5f69 6478 5f6f 665f 7267 6e20 2b20  gd_idx_of_rgn + 
-00080f10: 5b6b 5d2a 6c65 6e28 6764 2e65 786f 6e73  [k]*len(gd.exons
-00080f20: 2e72 676e 7329 0a20 2020 2020 2020 206f  .rgns).        o
-00080f30: 735f 6375 7220 2b3d 206c 656e 2867 642e  s_cur += len(gd.
-00080f40: 6578 6f6e 732e 7267 6e73 290a 0a20 2020  exons.rgns)..   
-00080f50: 2020 2020 2066 6f72 2072 2069 6e20 6764       for r in gd
-00080f60: 2e65 786f 6e73 2e72 676e 733a 0a20 2020  .exons.rgns:.   
-00080f70: 2020 2020 2020 2020 2023 2072 5f70 6f73           # r_pos
-00080f80: 2e61 7070 656e 6428 722e 656e 6429 0a20  .append(r.end). 
-00080f90: 2020 2020 2020 2020 2020 2072 5f70 6f73             r_pos
-00080fa0: 2e61 7070 656e 6428 722e 7374 6172 7429  .append(r.start)
-00080fb0: 0a0a 2020 2020 2323 2323 2323 2323 2323  ..    ##########
-00080fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080fd0: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
-00080fe0: 2067 6574 206f 7264 6572 2061 6363 6f72   get order accor
-00080ff0: 6469 6e67 2074 6f20 6c6f 6361 7469 6f6e  ding to location
-00081000: 0a20 2020 2072 5f70 6f73 203d 206e 702e  .    r_pos = np.
-00081010: 6172 7261 7928 725f 706f 7329 0a20 2020  array(r_pos).   
-00081020: 206f 6472 203d 2072 5f70 6f73 2e61 7267   odr = r_pos.arg
-00081030: 736f 7274 2829 0a0a 2020 2020 666f 7220  sort()..    for 
-00081040: 6b2c 206f 2069 6e20 656e 756d 6572 6174  k, o in enumerat
-00081050: 6528 6f64 7229 3a0a 2020 2020 2020 2020  e(odr):.        
-00081060: 7220 3d20 7261 6c6c 2e72 676e 735b 6f5d  r = rall.rgns[o]
-00081070: 0a20 2020 2020 2020 2069 6620 722e 7479  .        if r.ty
-00081080: 7065 203d 3d20 2769 6e73 6572 7369 6f6e  pe == 'insersion
-00081090: 273a 0a20 2020 2020 2020 2020 2020 2072  ':.            r
-000810a0: 7020 3d20 7261 6c6c 2e72 676e 735b 6f64  p = rall.rgns[od
-000810b0: 725b 6b2d 315d 5d0a 2020 2020 2020 2020  r[k-1]].        
-000810c0: 2020 2020 6966 2028 722e 7374 6172 7420      if (r.start 
-000810d0: 3d3d 2072 702e 7374 6172 7429 2026 2028  == rp.start) & (
-000810e0: 7270 2e74 7970 6520 3d3d 2027 6578 6f6e  rp.type == 'exon
-000810f0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00081100: 2020 2020 6f70 203d 206f 6472 5b6b 2d31      op = odr[k-1
-00081110: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00081120: 2020 6f64 725b 6b2d 315d 203d 206f 6472    odr[k-1] = odr
-00081130: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
-00081140: 2020 2020 6f64 725b 6b5d 203d 206f 700a      odr[k] = op.
-00081150: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00081160: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00081170: 2020 726e 203d 2072 616c 6c2e 7267 6e73    rn = rall.rgns
-00081180: 5b6f 6472 5b6b 2b31 5d5d 0a20 2020 2020  [odr[k+1]].     
-00081190: 2020 2020 2020 2020 2020 2069 6620 2872             if (r
-000811a0: 6e2e 7374 6172 7420 3d3d 2072 2e73 7461  n.start == r.sta
-000811b0: 7274 2920 2620 2872 6e2e 7479 7065 203d  rt) & (rn.type =
-000811c0: 3d20 2765 786f 6e27 293a 0a20 2020 2020  = 'exon'):.     
-000811d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000811e0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-000811f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00081200: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00081210: 696e 7428 2745 5252 4f52 2025 693a 204e  int('ERROR %i: N
-00081220: 6f20 636f 6e6e 6563 7469 6f6e 2066 6f75  o connection fou
-00081230: 6e64 2066 6f72 2049 2025 692c 2573 2d25  nd for I %i,%s-%
-00081240: 692c 2573 2d25 692c 2573 2720 2520 5c0a  i,%s-%i,%s' % \.
-00081250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081260: 2020 2020 2020 2020 2020 286b 2c20 7270            (k, rp
-00081270: 2e73 7461 7274 2c72 702e 7479 7065 2c20  .start,rp.type, 
-00081280: 722e 7374 6172 742c 722e 7479 7065 2c20  r.start,r.type, 
-00081290: 726e 2e73 7461 7274 2c20 726e 2e74 7970  rn.start, rn.typ
-000812a0: 6529 2029 0a0a 2020 2020 656c 6170 7365  e) )..    elapse
-000812b0: 645f 7469 6d65 203d 2074 696d 652e 7469  d_time = time.ti
-000812c0: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
-000812d0: 650a 2020 2020 2320 7072 696e 7428 2720  e.    # print(' 
-000812e0: 2020 312e 2064 6f6e 6520 2825 6929 2020    1. done (%i)  
-000812f0: 2720 2520 2865 6c61 7073 6564 5f74 696d  ' % (elapsed_tim
-00081300: 6529 2c20 666c 7573 6820 3d20 5472 7565  e), flush = True
-00081310: 290a 2020 2020 2327 2727 0a0a 2020 2020  ).    #'''..    
-00081320: 2327 2727 0a20 2020 2023 2323 2323 2323  #'''.    #######
-00081330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081350: 2323 0a20 2020 2023 2320 6765 7420 206f  ##.    ## get  o
-00081360: 6666 7365 745f 6669 6e64 6572 2061 6e64  ffset_finder and
-00081370: 206e 6577 2067 656e 6f6d 6520 7365 710a   new genome seq.
-00081380: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
-00081390: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-000813a0: 290a 2020 2020 6f66 203d 206f 6666 7365  ).    of = offse
-000813b0: 745f 6669 6e64 6572 2829 0a20 2020 206f  t_finder().    o
-000813c0: 735f 6375 7220 3d20 300a 2020 2020 7072  s_cur = 0.    pr
-000813d0: 6576 5f70 6f73 203d 2031 2023 206f 6e65  ev_pos = 1 # one
-000813e0: 2d62 6173 650a 2020 2020 6c61 7374 5f70  -base.    last_p
-000813f0: 6f73 203d 2031 2023 206f 6e65 2d62 6173  os = 1 # one-bas
-00081400: 650a 0a20 2020 2073 6571 5f6c 7374 203d  e..    seq_lst =
-00081410: 205b 5d0a 0a20 2020 2066 6f72 206d 2c20   []..    for m, 
-00081420: 6b20 696e 2065 6e75 6d65 7261 7465 286f  k in enumerate(o
-00081430: 6472 293a 0a20 2020 2020 2020 2072 203d  dr):.        r =
-00081440: 2072 616c 6c2e 7267 6e73 5b6b 5d0a 0a20   rall.rgns[k].. 
-00081450: 2020 2020 2020 2069 6620 722e 7479 7065         if r.type
-00081460: 203d 3d20 2765 786f 6e27 3a0a 2020 2020   == 'exon':.    
-00081470: 2020 2020 2020 2020 6966 2028 722e 7374          if (r.st
-00081480: 6172 7429 203c 2028 7072 6576 5f70 6f73  art) < (prev_pos
-00081490: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000814a0: 2020 2069 6620 722e 656e 6420 3c20 7072     if r.end < pr
-000814b0: 6576 5f70 6f73 3a0a 2020 2020 2020 2020  ev_pos:.        
-000814c0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-000814d0: 696e 7428 2725 6920 5741 524e 494e 4720  int('%i WARNING 
-000814e0: 2845 4129 3a20 2573 2c20 2569 2d25 6920  (EA): %s, %i-%i 
-000814f0: 3c3d 2025 692c 2025 692f 2569 2720 2520  <= %i, %i/%i' % 
-00081500: 286d 2c20 722e 6368 722c 2072 2e73 7461  (m, r.chr, r.sta
-00081510: 7274 2c20 722e 656e 642c 2070 7265 765f  rt, r.end, prev_
-00081520: 706f 732c 206d 2c20 6c65 6e28 6f64 7229  pos, m, len(odr)
-00081530: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-00081540: 2020 2020 2020 2020 735f 6f72 6720 3d20          s_org = 
-00081550: 7365 715f 6f72 675b 2872 2e73 7461 7274  seq_org[(r.start
-00081560: 2d31 293a 2872 2e65 6e64 295d 0a20 2020  -1):(r.end)].   
-00081570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081580: 2072 2e63 6f6d 7061 7265 5f61 6e64 5f72   r.compare_and_r
-00081590: 6570 6c61 6365 5f4e 2873 5f6f 7267 290a  eplace_N(s_org).
-000815a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000815b0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-000815c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00080560: 6f6e 652e 2025 6920 2d3e 2025 6927 2025  one. %i -> %i' %
+00080570: 2028 6e74 722c 206c 656e 2866 615f 7472   (ntr, len(fa_tr
+00080580: 292f 3229 290a 0a20 2020 2070 7269 6e74  )/2))..    print
+00080590: 2827 5361 7669 6e67 2046 4153 5441 202e  ('Saving FASTA .
+000805a0: 2e27 2c20 656e 6420 3d20 2727 2c20 666c  .', end = '', fl
+000805b0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+000805c0: 6620 3d20 6f70 656e 2866 615f 6669 6c65  f = open(fa_file
+000805d0: 5f74 722c 2027 772b 2729 0a20 2020 2066  _tr, 'w+').    f
+000805e0: 2e77 7269 7465 6c69 6e65 7328 6661 5f74  .writelines(fa_t
+000805f0: 7229 0a20 2020 2066 2e63 6c6f 7365 2829  r).    f.close()
+00080600: 0a0a 2020 2020 6966 2070 6570 7469 6465  ..    if peptide
+00080610: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00080620: 272e 272c 2065 6e64 3d27 2729 0a20 2020  '.', end='').   
+00080630: 2020 2020 2066 203d 206f 7065 6e28 6661       f = open(fa
+00080640: 5f66 696c 655f 7072 2c20 2777 2b27 290a  _file_pr, 'w+').
+00080650: 2020 2020 2020 2020 662e 7772 6974 656c          f.writel
+00080660: 696e 6573 2866 615f 7072 290a 2020 2020  ines(fa_pr).    
+00080670: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
+00080680: 2020 2065 6c61 7073 6564 5f74 696d 6520     elapsed_time 
+00080690: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
+000806a0: 7374 6172 745f 7469 6d65 0a20 2020 2070  start_time.    p
+000806b0: 7269 6e74 2827 2064 6f6e 652e 2028 2569  rint(' done. (%i
+000806c0: 2920 2720 2520 2865 6c61 7073 6564 5f74  ) ' % (elapsed_t
+000806d0: 696d 6529 290a 2020 2020 7072 696e 7428  ime)).    print(
+000806e0: 2720 2020 2573 2720 2520 6661 5f66 696c  '   %s' % fa_fil
+000806f0: 655f 7472 2029 0a20 2020 2069 6620 7065  e_tr ).    if pe
+00080700: 7074 6964 653a 2070 7269 6e74 2827 2020  ptide: print('  
+00080710: 2025 7327 2025 2066 615f 6669 6c65 5f70   %s' % fa_file_p
+00080720: 7220 290a 2020 2020 0a20 2020 2072 6574  r ).    .    ret
+00080730: 7572 6e20 6661 5f66 696c 655f 7472 2c20  urn fa_file_tr, 
+00080740: 6661 5f66 696c 655f 7072 0a20 2020 200a  fa_file_pr.    .
+00080750: 0a64 6566 206d 635f 636f 7265 5f72 6563  .def mc_core_rec
+00080760: 6f6e 7374 7275 6374 696f 6e28 6767 635f  onstruction(ggc_
+00080770: 7475 706c 6529 3a0a 2020 2020 0a20 2020  tuple):.    .   
+00080780: 2067 645f 7365 6c20 3d20 6767 635f 7475   gd_sel = ggc_tu
+00080790: 706c 655b 305d 0a20 2020 2073 6571 5f6f  ple[0].    seq_o
+000807a0: 7267 203d 2067 6763 5f74 7570 6c65 5b31  rg = ggc_tuple[1
+000807b0: 5d0a 2020 2020 6368 726d 203d 2067 6763  ].    chrm = ggc
+000807c0: 5f74 7570 6c65 5b32 5d0a 2020 2020 0a20  _tuple[2].    . 
+000807d0: 2020 2023 2067 645f 7365 6c20 3d20 736f     # gd_sel = so
+000807e0: 7274 5f64 6573 6372 6970 746f 725f 6c73  rt_descriptor_ls
+000807f0: 7428 6764 5f73 656c 290a 2020 2020 6e5f  t(gd_sel).    n_
+00080800: 6764 203d 206c 656e 2867 645f 7365 6c29  gd = len(gd_sel)
+00080810: 0a0a 2020 2020 2323 2323 2323 2323 2323  ..    ##########
+00080820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080830: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00080840: 2063 6f6c 6c65 6374 2072 676e 7320 616e   collect rgns an
+00080850: 6420 6d61 726b 2074 6865 6972 2070 6f73  d mark their pos
+00080860: 0a20 2020 200a 2020 2020 7374 6172 745f  .    .    start_
+00080870: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+00080880: 2829 0a20 2020 206c 6f63 5f6f 7320 3d20  ().    loc_os = 
+00080890: 6e70 2e7a 6572 6f73 286e 5f67 642c 6474  np.zeros(n_gd,dt
+000808a0: 7970 653d 6e70 2e66 6c6f 6174 3332 290a  ype=np.float32).
+000808b0: 2020 2020 6e75 6d5f 6f73 203d 206e 702e      num_os = np.
+000808c0: 7a65 726f 7328 6e5f 6764 2c64 7479 7065  zeros(n_gd,dtype
+000808d0: 3d6e 702e 666c 6f61 7433 3229 0a20 2020  =np.float32).   
+000808e0: 2072 616c 6c20 3d20 7265 6769 6f6e 7328   rall = regions(
+000808f0: 290a 2020 2020 4765 6e65 5f69 645f 6e61  ).    Gene_id_na
+00080900: 6d65 203d 205b 5d0a 2020 2020 6764 5f69  me = [].    gd_i
+00080910: 6478 5f6f 665f 7267 6e20 3d20 5b5d 0a20  dx_of_rgn = []. 
+00080920: 2020 206f 735f 6375 7220 3d20 300a 2020     os_cur = 0.  
+00080930: 2020 725f 706f 7320 3d20 5b5d 0a20 2020    r_pos = [].   
+00080940: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
+00080950: 756d 6572 6174 6528 6764 5f73 656c 293a  umerate(gd_sel):
+00080960: 0a0a 2020 2020 2020 2020 2323 2063 6865  ..        ## che
+00080970: 636b 2069 6620 616e 7920 4420 6f72 2049  ck if any D or I
+00080980: 206c 6965 7320 7769 7468 696e 2061 6e20   lies within an 
+00080990: 6578 6f6e 0a20 2020 2020 2020 2066 6f72  exon.        for
+000809a0: 2065 2069 6e20 6764 2e65 786f 6e73 2e72   e in gd.exons.r
+000809b0: 676e 733a 0a20 2020 2020 2020 2020 2020  gns:.           
+000809c0: 2069 6620 652e 7479 7065 203d 3d20 2764   if e.type == 'd
+000809d0: 656c 6574 696f 6e27 3a0a 2020 2020 2020  eletion':.      
+000809e0: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
+000809f0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00080a00: 2020 2020 666f 7220 6320 696e 2067 642e      for c in gd.
+00080a10: 6578 6f6e 732e 7267 6e73 3a0a 2020 2020  exons.rgns:.    
+00080a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080a30: 6966 2028 632e 7479 7065 203d 3d20 2765  if (c.type == 'e
+00080a40: 786f 6e27 293a 0a20 2020 2020 2020 2020  xon'):.         
+00080a50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00080a60: 6620 652e 6861 735f 6578 745f 696e 7465  f e.has_ext_inte
+00080a70: 7273 6563 7469 6f6e 5f77 6974 6828 6329  rsection_with(c)
+00080a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00080a90: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+00080aa0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00080ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080ac0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00080ad0: 2020 2020 2020 2020 2027 2727 0a20 2020           '''.   
+00080ae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00080af0: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
+00080b00: 2020 2020 2020 2070 7269 6e74 2827 5741         print('WA
+00080b10: 524e 494e 473a 2044 2825 733a 2569 2d25  RNING: D(%s:%i-%
+00080b20: 6929 206f 7665 726c 6170 7320 7769 7468  i) overlaps with
+00080b30: 2045 2825 733a 2569 2d25 6929 2720 2520   E(%s:%i-%i)' % 
+00080b40: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00080b50: 2020 2020 2020 2020 2020 2020 2865 2e63              (e.c
+00080b60: 6872 2c20 652e 7374 6172 742c 2065 2e65  hr, e.start, e.e
+00080b70: 6e64 2c20 632e 6368 722c 2063 2e73 7461  nd, c.chr, c.sta
+00080b80: 7274 2c20 632e 656e 6429 290a 2020 2020  rt, c.end)).    
+00080b90: 2020 2020 2020 2020 2020 2020 2727 2720              ''' 
+00080ba0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00080bb0: 656c 6966 2065 2e74 7970 6520 3d3d 2027  elif e.type == '
+00080bc0: 696e 7365 7273 696f 6e27 3a0a 2020 2020  insersion':.    
+00080bd0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+00080be0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00080bf0: 2020 2020 2020 666f 7220 6320 696e 2067        for c in g
+00080c00: 642e 6578 6f6e 732e 7267 6e73 3a0a 2020  d.exons.rgns:.  
+00080c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080c20: 2020 6966 2028 632e 7479 7065 203d 3d20    if (c.type == 
+00080c30: 2765 786f 6e27 293a 0a20 2020 2020 2020  'exon'):.       
+00080c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080c50: 2069 6620 2865 2e73 7461 7274 203e 2063   if (e.start > c
+00080c60: 2e73 7461 7274 2920 2620 2865 2e73 7461  .start) & (e.sta
+00080c70: 7274 203c 2063 2e65 6e64 293a 0a20 2020  rt < c.end):.   
+00080c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080c90: 2020 2020 2020 2020 2062 203d 2054 7275           b = Tru
+00080ca0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00080cb0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00080cc0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00080cd0: 2020 2020 2727 2720 2020 200a 2020 2020      '''    .    
+00080ce0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+00080cf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00080d00: 2020 2020 2020 7072 696e 7428 2757 4152        print('WAR
+00080d10: 4e49 4e47 3a20 4928 2573 3a25 692d 2569  NING: I(%s:%i-%i
+00080d20: 2920 6f76 6572 6c61 7073 2077 6974 6820  ) overlaps with 
+00080d30: 4528 2573 3a25 692d 2569 2927 2025 205c  E(%s:%i-%i)' % \
+00080d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00080d50: 2020 2020 2020 2020 2020 2028 652e 6368             (e.ch
+00080d60: 722c 2065 2e73 7461 7274 2c20 652e 656e  r, e.start, e.en
+00080d70: 642c 2063 2e63 6872 2c20 632e 7374 6172  d, c.chr, c.star
+00080d80: 742c 2063 2e65 6e64 2929 0a20 2020 2020  t, c.end)).     
+00080d90: 2020 2020 2020 2020 2020 2027 2727 2020             '''  
+00080da0: 2020 0a0a 2020 2020 2020 2020 6c6f 635f    ..        loc_
+00080db0: 6f73 5b6b 5d20 3d20 6f73 5f63 7572 0a20  os[k] = os_cur. 
+00080dc0: 2020 2020 2020 206e 756d 5f6f 735b 6b5d         num_os[k]
+00080dd0: 203d 206c 656e 2867 642e 6578 6f6e 732e   = len(gd.exons.
+00080de0: 7267 6e73 290a 2020 2020 2020 2020 7261  rgns).        ra
+00080df0: 6c6c 2e72 676e 7320 3d20 7261 6c6c 2e72  ll.rgns = rall.r
+00080e00: 676e 7320 2b20 6764 2e65 786f 6e73 2e72  gns + gd.exons.r
+00080e10: 676e 730a 2020 2020 2020 2020 675f 6964  gns.        g_id
+00080e20: 5f6e 5f6e 616d 655f 6c73 7420 3d20 6764  _n_name_lst = gd
+00080e30: 2e67 6574 5f67 6964 5f6e 5f67 6e61 6d65  .get_gid_n_gname
+00080e40: 5f6c 6973 7428 290a 2020 2020 2020 2020  _list().        
+00080e50: 4765 6e65 5f69 645f 6e61 6d65 203d 2047  Gene_id_name = G
+00080e60: 656e 655f 6964 5f6e 616d 6520 2b20 675f  ene_id_name + g_
+00080e70: 6964 5f6e 5f6e 616d 655f 6c73 740a 2020  id_n_name_lst.  
+00080e80: 2020 2020 2020 6764 5f69 6478 5f6f 665f        gd_idx_of_
+00080e90: 7267 6e20 3d20 6764 5f69 6478 5f6f 665f  rgn = gd_idx_of_
+00080ea0: 7267 6e20 2b20 5b6b 5d2a 6c65 6e28 6764  rgn + [k]*len(gd
+00080eb0: 2e65 786f 6e73 2e72 676e 7329 0a20 2020  .exons.rgns).   
+00080ec0: 2020 2020 206f 735f 6375 7220 2b3d 206c       os_cur += l
+00080ed0: 656e 2867 642e 6578 6f6e 732e 7267 6e73  en(gd.exons.rgns
+00080ee0: 290a 0a20 2020 2020 2020 2066 6f72 2072  )..        for r
+00080ef0: 2069 6e20 6764 2e65 786f 6e73 2e72 676e   in gd.exons.rgn
+00080f00: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
+00080f10: 2072 5f70 6f73 2e61 7070 656e 6428 722e   r_pos.append(r.
+00080f20: 656e 6429 0a20 2020 2020 2020 2020 2020  end).           
+00080f30: 2072 5f70 6f73 2e61 7070 656e 6428 722e   r_pos.append(r.
+00080f40: 7374 6172 7429 0a0a 2020 2020 2323 2323  start)..    ####
+00080f50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080f60: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00080f70: 2020 2020 2323 2067 6574 206f 7264 6572      ## get order
+00080f80: 2061 6363 6f72 6469 6e67 2074 6f20 6c6f   according to lo
+00080f90: 6361 7469 6f6e 0a20 2020 2072 5f70 6f73  cation.    r_pos
+00080fa0: 203d 206e 702e 6172 7261 7928 725f 706f   = np.array(r_po
+00080fb0: 7329 0a20 2020 206f 6472 203d 2072 5f70  s).    odr = r_p
+00080fc0: 6f73 2e61 7267 736f 7274 2829 0a0a 2020  os.argsort()..  
+00080fd0: 2020 666f 7220 6b2c 206f 2069 6e20 656e    for k, o in en
+00080fe0: 756d 6572 6174 6528 6f64 7229 3a0a 2020  umerate(odr):.  
+00080ff0: 2020 2020 2020 7220 3d20 7261 6c6c 2e72        r = rall.r
+00081000: 676e 735b 6f5d 0a20 2020 2020 2020 2069  gns[o].        i
+00081010: 6620 722e 7479 7065 203d 3d20 2769 6e73  f r.type == 'ins
+00081020: 6572 7369 6f6e 273a 0a20 2020 2020 2020  ersion':.       
+00081030: 2020 2020 2072 7020 3d20 7261 6c6c 2e72       rp = rall.r
+00081040: 676e 735b 6f64 725b 6b2d 315d 5d0a 2020  gns[odr[k-1]].  
+00081050: 2020 2020 2020 2020 2020 6966 2028 722e            if (r.
+00081060: 7374 6172 7420 3d3d 2072 702e 7374 6172  start == rp.star
+00081070: 7429 2026 2028 7270 2e74 7970 6520 3d3d  t) & (rp.type ==
+00081080: 2027 6578 6f6e 2729 3a0a 2020 2020 2020   'exon'):.      
+00081090: 2020 2020 2020 2020 2020 6f70 203d 206f            op = o
+000810a0: 6472 5b6b 2d31 5d0a 2020 2020 2020 2020  dr[k-1].        
+000810b0: 2020 2020 2020 2020 6f64 725b 6b2d 315d          odr[k-1]
+000810c0: 203d 206f 6472 5b6b 5d0a 2020 2020 2020   = odr[k].      
+000810d0: 2020 2020 2020 2020 2020 6f64 725b 6b5d            odr[k]
+000810e0: 203d 206f 700a 2020 2020 2020 2020 2020   = op.          
+000810f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00081100: 2020 2020 2020 2020 726e 203d 2072 616c          rn = ral
+00081110: 6c2e 7267 6e73 5b6f 6472 5b6b 2b31 5d5d  l.rgns[odr[k+1]]
+00081120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081130: 2069 6620 2872 6e2e 7374 6172 7420 3d3d   if (rn.start ==
+00081140: 2072 2e73 7461 7274 2920 2620 2872 6e2e   r.start) & (rn.
+00081150: 7479 7065 203d 3d20 2765 786f 6e27 293a  type == 'exon'):
+00081160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081170: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00081180: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00081190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000811a0: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
+000811b0: 2025 693a 204e 6f20 636f 6e6e 6563 7469   %i: No connecti
+000811c0: 6f6e 2066 6f75 6e64 2066 6f72 2049 2025  on found for I %
+000811d0: 692c 2573 2d25 692c 2573 2d25 692c 2573  i,%s-%i,%s-%i,%s
+000811e0: 2720 2520 5c0a 2020 2020 2020 2020 2020  ' % \.          
+000811f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081200: 286b 2c20 7270 2e73 7461 7274 2c72 702e  (k, rp.start,rp.
+00081210: 7479 7065 2c20 722e 7374 6172 742c 722e  type, r.start,r.
+00081220: 7479 7065 2c20 726e 2e73 7461 7274 2c20  type, rn.start, 
+00081230: 726e 2e74 7970 6529 2029 0a0a 2020 2020  rn.type) )..    
+00081240: 656c 6170 7365 645f 7469 6d65 203d 2074  elapsed_time = t
+00081250: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
+00081260: 7274 5f74 696d 650a 2020 2020 2320 7072  rt_time.    # pr
+00081270: 696e 7428 2720 2020 312e 2064 6f6e 6520  int('   1. done 
+00081280: 2825 6929 2020 2720 2520 2865 6c61 7073  (%i)  ' % (elaps
+00081290: 6564 5f74 696d 6529 2c20 666c 7573 6820  ed_time), flush 
+000812a0: 3d20 5472 7565 290a 2020 2020 2327 2727  = True).    #'''
+000812b0: 0a0a 2020 2020 2327 2727 0a20 2020 2023  ..    #'''.    #
+000812c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000812d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000812e0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
+000812f0: 6765 7420 206f 6666 7365 745f 6669 6e64  get  offset_find
+00081300: 6572 2061 6e64 206e 6577 2067 656e 6f6d  er and new genom
+00081310: 6520 7365 710a 2020 2020 0a20 2020 2073  e seq.    .    s
+00081320: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
+00081330: 2e74 696d 6528 290a 2020 2020 6f66 203d  .time().    of =
+00081340: 206f 6666 7365 745f 6669 6e64 6572 2829   offset_finder()
+00081350: 0a20 2020 206f 735f 6375 7220 3d20 300a  .    os_cur = 0.
+00081360: 2020 2020 7072 6576 5f70 6f73 203d 2031      prev_pos = 1
+00081370: 2023 206f 6e65 2d62 6173 650a 2020 2020   # one-base.    
+00081380: 6c61 7374 5f70 6f73 203d 2031 2023 206f  last_pos = 1 # o
+00081390: 6e65 2d62 6173 650a 0a20 2020 2073 6571  ne-base..    seq
+000813a0: 5f6c 7374 203d 205b 5d0a 0a20 2020 2066  _lst = []..    f
+000813b0: 6f72 206d 2c20 6b20 696e 2065 6e75 6d65  or m, k in enume
+000813c0: 7261 7465 286f 6472 293a 0a20 2020 2020  rate(odr):.     
+000813d0: 2020 2072 203d 2072 616c 6c2e 7267 6e73     r = rall.rgns
+000813e0: 5b6b 5d0a 0a20 2020 2020 2020 2069 6620  [k]..        if 
+000813f0: 722e 7479 7065 203d 3d20 2765 786f 6e27  r.type == 'exon'
+00081400: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00081410: 2028 722e 7374 6172 7429 203c 2028 7072   (r.start) < (pr
+00081420: 6576 5f70 6f73 293a 0a20 2020 2020 2020  ev_pos):.       
+00081430: 2020 2020 2020 2020 2069 6620 722e 656e           if r.en
+00081440: 6420 3c20 7072 6576 5f70 6f73 3a0a 2020  d < prev_pos:.  
+00081450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081460: 2020 2320 7072 696e 7428 2725 6920 5741    # print('%i WA
+00081470: 524e 494e 4720 2845 4129 3a20 2573 2c20  RNING (EA): %s, 
+00081480: 2569 2d25 6920 3c3d 2025 692c 2025 692f  %i-%i <= %i, %i/
+00081490: 2569 2720 2520 286d 2c20 722e 6368 722c  %i' % (m, r.chr,
+000814a0: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
+000814b0: 2070 7265 765f 706f 732c 206d 2c20 6c65   prev_pos, m, le
+000814c0: 6e28 6f64 7229 2920 290a 2020 2020 2020  n(odr)) ).      
+000814d0: 2020 2020 2020 2020 2020 2020 2020 735f                s_
+000814e0: 6f72 6720 3d20 7365 715f 6f72 675b 2872  org = seq_org[(r
+000814f0: 2e73 7461 7274 2d31 293a 2872 2e65 6e64  .start-1):(r.end
+00081500: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+00081510: 2020 2020 2020 2072 2e63 6f6d 7061 7265         r.compare
+00081520: 5f61 6e64 5f72 6570 6c61 6365 5f4e 2873  _and_replace_N(s
+00081530: 5f6f 7267 290a 2020 2020 2020 2020 2020  _org).          
+00081540: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00081550: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00081560: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00081570: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
+00081580: 2827 2569 2057 4152 4e49 4e47 2028 4542  ('%i WARNING (EB
+00081590: 293a 2025 732c 2025 692d 2569 203c 3d20  ): %s, %i-%i <= 
+000815a0: 2569 2720 2520 286d 2c20 722e 6368 722c  %i' % (m, r.chr,
+000815b0: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
+000815c0: 2070 7265 765f 706f 7329 2029 0a20 2020   prev_pos) ).   
 000815d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000815e0: 2020 2023 2070 7269 6e74 2827 2569 2057     # print('%i W
-000815f0: 4152 4e49 4e47 2028 4542 293a 2025 732c  ARNING (EB): %s,
-00081600: 2025 692d 2569 203c 3d20 2569 2720 2520   %i-%i <= %i' % 
-00081610: 286d 2c20 722e 6368 722c 2072 2e73 7461  (m, r.chr, r.sta
-00081620: 7274 2c20 722e 656e 642c 2070 7265 765f  rt, r.end, prev_
-00081630: 706f 7329 2029 0a20 2020 2020 2020 2020  pos) ).         
-00081640: 2020 2020 2020 2020 2020 2073 5f6f 7267             s_org
-00081650: 203d 2073 6571 5f6f 7267 5b28 722e 7374   = seq_org[(r.st
-00081660: 6172 742d 3129 3a28 722e 656e 6429 5d0a  art-1):(r.end)].
-00081670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081680: 2020 2020 722e 636f 6d70 6172 655f 616e      r.compare_an
-00081690: 645f 7265 706c 6163 655f 4e28 735f 6f72  d_replace_N(s_or
-000816a0: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
-000816b0: 2020 2020 2020 2073 7020 3d20 2870 7265         sp = (pre
-000816c0: 765f 706f 732d 722e 7374 6172 7429 0a20  v_pos-r.start). 
+000815e0: 2073 5f6f 7267 203d 2073 6571 5f6f 7267   s_org = seq_org
+000815f0: 5b28 722e 7374 6172 742d 3129 3a28 722e  [(r.start-1):(r.
+00081600: 656e 6429 5d0a 2020 2020 2020 2020 2020  end)].          
+00081610: 2020 2020 2020 2020 2020 722e 636f 6d70            r.comp
+00081620: 6172 655f 616e 645f 7265 706c 6163 655f  are_and_replace_
+00081630: 4e28 735f 6f72 6729 0a20 2020 2020 2020  N(s_org).       
+00081640: 2020 2020 2020 2020 2020 2020 2073 7020               sp 
+00081650: 3d20 2870 7265 765f 706f 732d 722e 7374  = (prev_pos-r.st
+00081660: 6172 7429 0a20 2020 2020 2020 2020 2020  art).           
+00081670: 2020 2020 2020 2020 2073 6571 5f6c 7374           seq_lst
+00081680: 2e61 7070 656e 6428 722e 7365 715b 7370  .append(r.seq[sp
+00081690: 3a5d 290a 0a20 2020 2020 2020 2020 2020  :])..           
+000816a0: 2020 2020 2020 2020 206f 662e 6164 6428           of.add(
+000816b0: 206f 735f 6375 722c 2070 7265 765f 706f   os_cur, prev_po
+000816c0: 732c 2072 2e65 6e64 2b31 2029 0a20 2020  s, r.end+1 ).   
 000816d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000816e0: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
-000816f0: 6428 722e 7365 715b 7370 3a5d 290a 0a20  d(r.seq[sp:]).. 
-00081700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081710: 2020 206f 662e 6164 6428 206f 735f 6375     of.add( os_cu
-00081720: 722c 2070 7265 765f 706f 732c 2072 2e65  r, prev_pos, r.e
-00081730: 6e64 2b31 2029 0a20 2020 2020 2020 2020  nd+1 ).         
-00081740: 2020 2020 2020 2020 2020 2070 7265 765f             prev_
-00081750: 706f 7320 3d20 722e 656e 642b 310a 0a20  pos = r.end+1.. 
-00081760: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00081770: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00081780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081790: 735f 6f72 6720 3d20 7365 715f 6f72 675b  s_org = seq_org[
-000817a0: 2872 2e73 7461 7274 2d31 293a 2872 2e65  (r.start-1):(r.e
-000817b0: 6e64 295d 0a20 2020 2020 2020 2020 2020  nd)].           
-000817c0: 2020 2020 2023 6966 206c 656e 2873 5f6f       #if len(s_o
-000817d0: 7267 2920 3d3d 206c 656e 2872 2e73 6571  rg) == len(r.seq
-000817e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000817f0: 2020 2072 2e63 6f6d 7061 7265 5f61 6e64     r.compare_and
-00081800: 5f72 6570 6c61 6365 5f4e 2873 5f6f 7267  _replace_N(s_org
-00081810: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081820: 2020 2320 656c 7365 3a20 2070 7269 6e74    # else:  print
-00081830: 2820 2757 4152 4e49 4e47 3a20 2569 2d25  ( 'WARNING: %i-%
-00081840: 6920 696e 2025 6920 7e3d 2025 6927 2025  i in %i ~= %i' %
-00081850: 2028 722e 7374 6172 742c 2072 2e65 6e64   (r.start, r.end
-00081860: 2c20 6c65 6e28 735f 6f72 6729 2c20 6c65  , len(s_org), le
-00081870: 6e28 722e 7365 7129 2920 290a 0a20 2020  n(r.seq)) )..   
-00081880: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00081890: 722e 7374 6172 7420 3e20 7072 6576 5f70  r.start > prev_p
-000818a0: 6f73 3a0a 2020 2020 2020 2020 2020 2020  os:.            
-000818b0: 2020 2020 2020 2020 7365 715f 6c73 742e          seq_lst.
-000818c0: 6170 7065 6e64 2873 6571 5f6f 7267 5b28  append(seq_org[(
-000818d0: 7072 6576 5f70 6f73 2d31 293a 2872 2e73  prev_pos-1):(r.s
-000818e0: 7461 7274 2d31 295d 290a 2020 2020 2020  tart-1)]).      
-000818f0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00081900: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00081910: 6571 5f6c 7374 2e61 7070 656e 6428 722e  eq_lst.append(r.
-00081920: 7365 7129 0a20 2020 2020 2020 2020 2020  seq).           
-00081930: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00081940: 2020 2020 2020 2020 2020 6f66 2e61 6464            of.add
-00081950: 2820 6f73 5f63 7572 2c20 7072 6576 5f70  ( os_cur, prev_p
-00081960: 6f73 2c20 722e 656e 642b 3120 290a 2020  os, r.end+1 ).  
-00081970: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00081980: 6576 5f70 6f73 203d 2072 2e65 6e64 2b31  ev_pos = r.end+1
-00081990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000819a0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-000819b0: 2020 2020 2020 6966 206c 656e 2872 2e73        if len(r.s
-000819c0: 6571 2920 213d 206c 656e 2873 5f6f 7267  eq) != len(s_org
-000819d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000819e0: 2020 2020 2020 2023 2070 7269 6e74 2820         # print( 
-000819f0: 2757 4152 4e49 4e47 3a20 2573 3a20 2569  'WARNING: %s: %i
-00081a00: 2d25 6920 696e 2025 6920 7e3d 2025 6927  -%i in %i ~= %i'
-00081a10: 2025 2028 722e 6368 722c 2072 2e73 7461   % (r.chr, r.sta
-00081a20: 7274 2c20 722e 656e 642c 206c 656e 2873  rt, r.end, len(s
-00081a30: 5f6f 7267 292c 206c 656e 2872 2e73 6571  _org), len(r.seq
-00081a40: 2929 2029 0a20 2020 2020 2020 2020 2020  )) ).           
-00081a50: 2020 2020 2020 2020 2023 2073 6571 5f6c           # seq_l
-00081a60: 7374 2e61 7070 656e 6428 735f 6f72 6729  st.append(s_org)
-00081a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081a80: 2020 2020 2023 2072 2e73 6571 203d 2072       # r.seq = r
-00081a90: 6567 696f 6e28 722e 6368 722c 2072 2e73  egion(r.chr, r.s
-00081aa0: 7461 7274 2c20 722e 656e 642c 2072 2e74  tart, r.end, r.t
-00081ab0: 7970 652c 2073 5f6f 7267 2c20 6376 675f  ype, s_org, cvg_
-00081ac0: 6465 7020 3d20 4356 475f 4445 5054 485f  dep = CVG_DEPTH_
-00081ad0: 544d 5020 290a 2020 2020 2020 2020 2020  TMP ).          
-00081ae0: 2020 2020 2020 2020 2020 2320 722e 6765            # r.ge
-00081af0: 745f 6376 6728 290a 2020 2020 2020 2020  t_cvg().        
-00081b00: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00081b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081b20: 2020 2020 200a 0a20 2020 2020 2020 2065       ..        e
-00081b30: 6c69 6620 2872 2e74 7970 6520 3d3d 2027  lif (r.type == '
-00081b40: 696e 7365 7273 696f 6e27 2920 7c20 2872  insersion') | (r
-00081b50: 2e74 7970 6520 3d3d 2027 4927 2029 3a0a  .type == 'I' ):.
-00081b60: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00081b70: 722e 7374 6172 7429 203c 2028 7072 6576  r.start) < (prev
-00081b80: 5f70 6f73 293a 0a20 2020 2020 2020 2020  _pos):.         
-00081b90: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
-00081ba0: 5741 524e 494e 4720 2849 293a 2025 6920  WARNING (I): %i 
-00081bb0: 2d20 2573 2c20 2569 203c 2025 6927 2025  - %s, %i < %i' %
-00081bc0: 2028 6d2c 2072 2e63 6872 2c20 722e 7374   (m, r.chr, r.st
-00081bd0: 6172 742c 2070 7265 765f 706f 7329 2029  art, prev_pos) )
-00081be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081bf0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-00081c00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00081c10: 2020 2020 2020 2020 6f66 2e61 6464 2820          of.add( 
-00081c20: 6f73 5f63 7572 2c20 7072 6576 5f70 6f73  os_cur, prev_pos
-00081c30: 2c20 722e 7374 6172 7420 290a 2020 2020  , r.start ).    
-00081c40: 2020 2020 2020 2020 2020 2020 6f73 5f63              os_c
-00081c50: 7572 202b 3d20 2872 2e65 6e64 202d 2072  ur += (r.end - r
-00081c60: 2e73 7461 7274 202b 2031 290a 0a20 2020  .start + 1)..   
-00081c70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00081c80: 722e 7374 6172 7420 3e20 7072 6576 5f70  r.start > prev_p
-00081c90: 6f73 3a0a 2020 2020 2020 2020 2020 2020  os:.            
-00081ca0: 2020 2020 2020 2020 7365 715f 6c73 742e          seq_lst.
-00081cb0: 6170 7065 6e64 2873 6571 5f6f 7267 5b28  append(seq_org[(
-00081cc0: 7072 6576 5f70 6f73 2d31 293a 2872 2e73  prev_pos-1):(r.s
-00081cd0: 7461 7274 2d31 295d 290a 2020 2020 2020  tart-1)]).      
-00081ce0: 2020 2020 2020 2020 2020 7365 715f 6c73            seq_ls
-00081cf0: 742e 6170 7065 6e64 2872 2e73 6571 290a  t.append(r.seq).
-00081d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081d10: 2070 7265 765f 706f 7320 3d20 722e 7374   prev_pos = r.st
-00081d20: 6172 740a 0a20 2020 2020 2020 2065 6c69  art..        eli
-00081d30: 6620 2872 2e74 7970 6520 3d3d 2027 6465  f (r.type == 'de
-00081d40: 6c65 7469 6f6e 2729 207c 2028 722e 7479  letion') | (r.ty
-00081d50: 7065 203d 3d20 2744 2720 293a 0a20 2020  pe == 'D' ):.   
-00081d60: 2020 2020 2020 2020 2069 6620 2872 2e73           if (r.s
-00081d70: 7461 7274 2920 3c20 2870 7265 765f 706f  tart) < (prev_po
-00081d80: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00081d90: 2020 2020 2320 7072 696e 7428 2757 4152      # print('WAR
-00081da0: 4e49 4e47 2028 4429 3a20 2569 202d 2025  NING (D): %i - %
-00081db0: 732c 2025 6920 3c3d 2025 6927 2025 2028  s, %i <= %i' % (
-00081dc0: 6d2c 2072 2e63 6872 2c20 722e 7374 6172  m, r.chr, r.star
-00081dd0: 742c 2070 7265 765f 706f 7329 2029 0a20  t, prev_pos) ). 
-00081de0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00081df0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-00081e00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00081e10: 2020 2020 2020 6f66 2e61 6464 2820 6f73        of.add( os
-00081e20: 5f63 7572 2c20 7072 6576 5f70 6f73 2c20  _cur, prev_pos, 
-00081e30: 722e 7374 6172 7420 290a 2020 2020 2020  r.start ).      
-00081e40: 2020 2020 2020 2020 2020 6f73 5f63 7572            os_cur
-00081e50: 202d 3d20 2872 2e65 6e64 202d 2072 2e73   -= (r.end - r.s
-00081e60: 7461 7274 202b 2031 290a 2020 2020 2020  tart + 1).      
-00081e70: 2020 2020 2020 2020 2020 7072 6576 5f70            prev_p
-00081e80: 6f73 203d 2072 2e73 7461 7274 0a0a 2020  os = r.start..  
-00081e90: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-00081ea0: 2e61 6464 2820 6f73 5f63 7572 2c20 7072  .add( os_cur, pr
-00081eb0: 6576 5f70 6f73 2c20 722e 656e 642b 3120  ev_pos, r.end+1 
-00081ec0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081ed0: 2020 7072 6576 5f70 6f73 203d 2072 2e65    prev_pos = r.e
-00081ee0: 6e64 2b31 0a0a 2020 2020 2020 2020 6c61  nd+1..        la
-00081ef0: 7374 5f70 6f73 203d 2072 2e65 6e64 0a0a  st_pos = r.end..
-00081f00: 2020 2020 7365 715f 6c73 742e 6170 7065      seq_lst.appe
-00081f10: 6e64 2873 6571 5f6f 7267 5b28 7072 6576  nd(seq_org[(prev
-00081f20: 5f70 6f73 2d31 293a 5d29 0a20 2020 2073  _pos-1):]).    s
-00081f30: 6571 5f6e 6577 203d 2027 272e 6a6f 696e  eq_new = ''.join
-00081f40: 2873 6571 5f6c 7374 290a 0a20 2020 2023  (seq_lst)..    #
-00081f50: 2069 6620 6c61 7374 5f70 6f73 203e 2070   if last_pos > p
-00081f60: 7265 765f 706f 733a 0a20 2020 206f 662e  rev_pos:.    of.
-00081f70: 6164 6428 206f 735f 6375 722c 2070 7265  add( os_cur, pre
-00081f80: 765f 706f 732c 206c 656e 2873 6571 5f6f  v_pos, len(seq_o
-00081f90: 7267 2920 2b20 3130 3030 3030 2029 0a0a  rg) + 100000 )..
-00081fa0: 2020 2020 656c 6170 7365 645f 7469 6d65      elapsed_time
-00081fb0: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
-00081fc0: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
-00081fd0: 2320 7072 696e 7428 2720 2020 322e 2064  # print('   2. d
-00081fe0: 6f6e 6520 2825 6929 2020 2720 2520 2865  one (%i)  ' % (e
-00081ff0: 6c61 7073 6564 5f74 696d 6529 2c20 666c  lapsed_time), fl
-00082000: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-00082010: 2327 2727 0a0a 2020 2020 2323 2323 2323  #'''..    ######
-00082020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00082030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00082040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00082050: 2323 0a20 2020 2023 2320 5573 6520 6f66  ##.    ## Use of
-00082060: 6673 6574 5f66 696e 6465 7220 746f 2063  fset_finder to c
-00082070: 6f72 7265 6374 2070 6f73 6974 696f 6e73  orrect positions
-00082080: 2069 6e20 4754 4620 656e 7472 6965 730a   in GTF entries.
-00082090: 2020 2020 2323 2061 6c73 6f20 6765 7420      ## also get 
-000820a0: 7267 6e73 2066 7261 676d 656e 7473 2077  rgns fragments w
-000820b0: 6865 6e20 7370 6c69 7420 6973 2072 6571  hen split is req
-000820c0: 7569 7265 640a 0a20 2020 206f 662e 6d61  uired..    of.ma
-000820d0: 6b65 5f69 745f 636f 6d70 6163 7428 290a  ke_it_compact().
-000820e0: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
-000820f0: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-00082100: 290a 2020 2020 725f 746f 5f61 6464 203d  ).    r_to_add =
-00082110: 205b 5d0a 2020 2020 706f 735f 746f 5f61   [].    pos_to_a
-00082120: 6464 203d 205b 5d0a 2020 2020 736e 765f  dd = [].    snv_
-00082130: 696e 666f 5f63 6872 203d 205b 5d0a 0a20  info_chr = [].. 
-00082140: 2020 2066 6f72 2067 6420 696e 2067 645f     for gd in gd_
-00082150: 7365 6c3a 0a20 2020 2020 2020 2067 642e  sel:.        gd.
-00082160: 6e76 5f69 6e66 6f5f 6c73 7420 3d20 5b5d  nv_info_lst = []
-00082170: 0a0a 2020 2020 7072 6576 5f6f 6669 203d  ..    prev_ofi =
-00082180: 2030 0a20 2020 2076 5f63 6e74 203d 2030   0.    v_cnt = 0
-00082190: 0a20 2020 2023 666f 7220 6b2c 2072 2069  .    #for k, r i
-000821a0: 6e20 656e 756d 6572 6174 6528 7261 6c6c  n enumerate(rall
-000821b0: 2e72 676e 7329 3a0a 2020 2020 666f 7220  .rgns):.    for 
-000821c0: 6d2c 206b 2069 6e20 656e 756d 6572 6174  m, k in enumerat
-000821d0: 6528 6f64 7229 3a0a 2020 2020 2020 2020  e(odr):.        
-000821e0: 7220 3d20 7261 6c6c 2e72 676e 735b 6b5d  r = rall.rgns[k]
-000821f0: 0a20 2020 2020 2020 2067 696e 203d 2047  .        gin = G
-00082200: 656e 655f 6964 5f6e 616d 655b 6b5d 0a20  ene_id_name[k]. 
-00082210: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00082220: 6f73 732c 2070 7265 765f 6f66 3120 3d20  oss, prev_of1 = 
-00082230: 6f66 2e66 696e 645f 6f73 5f73 6571 2872  of.find_os_seq(r
-00082240: 2e73 7461 7274 2c20 7072 6576 5f6f 6669  .start, prev_ofi
-00082250: 290a 2020 2020 2020 2020 2320 6f73 6520  ).        # ose 
-00082260: 3d20 6f73 730a 2020 2020 2020 2020 6f73  = oss.        os
-00082270: 652c 2070 7265 765f 6f66 3220 3d20 6f66  e, prev_of2 = of
-00082280: 2e66 696e 645f 6f73 5f73 6571 2872 2e65  .find_os_seq(r.e
-00082290: 6e64 2c20 7072 6576 5f6f 6669 290a 200a  nd, prev_ofi). .
-000822a0: 2020 2020 2020 2020 722e 6765 745f 6376          r.get_cv
-000822b0: 6728 290a 2020 2020 2020 2020 2320 6966  g().        # if
-000822c0: 2072 2e63 7667 2069 7320 4e6f 6e65 3a20   r.cvg is None: 
-000822d0: 722e 6376 6720 3d20 6e70 2e6f 6e65 7328  r.cvg = np.ones(
-000822e0: 6c65 6e28 722e 7365 7129 290a 0a20 2020  len(r.seq))..   
-000822f0: 2020 2020 2069 6620 722e 7479 7065 203d       if r.type =
-00082300: 3d20 2765 786f 6e27 3a0a 2020 2020 2020  = 'exon':.      
-00082310: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00082320: 2020 2069 6620 286f 7373 203d 3d20 6f73     if (oss == os
-00082330: 6529 3a0a 0a20 2020 2020 2020 2020 2020  e):..           
-00082340: 2020 2020 2023 2073 695f 6c73 7420 3d20       # si_lst = 
-00082350: 6669 6e64 5f73 6e70 2873 6571 5f6f 7267  find_snp(seq_org
-00082360: 5b28 722e 7374 6172 742d 3129 3a72 2e65  [(r.start-1):r.e
-00082370: 6e64 5d2c 2072 2e73 6571 2c20 722e 6765  nd], r.seq, r.ge
-00082380: 745f 6376 6728 292c 2063 6872 6d2c 2072  t_cvg(), chrm, r
-00082390: 2e73 7461 7274 2c20 6f73 7329 0a20 2020  .start, oss).   
-000823a0: 2020 2020 2020 2020 2020 2020 2073 695f               si_
-000823b0: 6c73 7420 3d20 6669 6e64 5f73 6e70 2873  lst = find_snp(s
-000823c0: 6571 5f6f 7267 5b28 722e 7374 6172 742d  eq_org[(r.start-
-000823d0: 3129 3a72 2e65 6e64 5d2c 2072 2e73 6571  1):r.end], r.seq
-000823e0: 2c20 722e 636d 6174 2c20 6368 726d 2c20  , r.cmat, chrm, 
-000823f0: 722e 7374 6172 742c 206f 7373 2c20 6769  r.start, oss, gi
-00082400: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
-00082410: 2020 2073 6e76 5f69 6e66 6f5f 6368 7220     snv_info_chr 
-00082420: 3d20 736e 765f 696e 666f 5f63 6872 202b  = snv_info_chr +
-00082430: 2073 695f 6c73 740a 2020 2020 2020 2020   si_lst.        
-00082440: 2020 2020 2020 2020 6764 5f69 6478 203d          gd_idx =
-00082450: 2067 645f 6964 785f 6f66 5f72 676e 5b6b   gd_idx_of_rgn[k
-00082460: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00082470: 2020 6764 5f73 656c 5b67 645f 6964 785d    gd_sel[gd_idx]
-00082480: 2e6e 765f 696e 666f 5f6c 7374 203d 2067  .nv_info_lst = g
-00082490: 645f 7365 6c5b 6764 5f69 6478 5d2e 6e76  d_sel[gd_idx].nv
-000824a0: 5f69 6e66 6f5f 6c73 7420 2b20 7369 5f6c  _info_lst + si_l
-000824b0: 7374 0a0a 2020 2020 2020 2020 2020 2020  st..            
-000824c0: 2020 2020 722e 7374 6172 7420 2b3d 206f      r.start += o
-000824d0: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
-000824e0: 2020 2072 2e65 6e64 202b 3d20 6f73 650a     r.end += ose.
-000824f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082500: 7261 6c6c 2e72 676e 735b 6b5d 203d 2072  rall.rgns[k] = r
-00082510: 2023 202e 636f 7079 2829 0a0a 0a20 2020   # .copy()...   
-00082520: 2020 2020 2020 2020 2065 6c69 6620 286f           elif (o
-00082530: 7373 203c 206f 7365 293a 2023 2049 6e73  ss < ose): # Ins
-00082540: 6572 7369 6f6e 2069 6e20 6265 7477 6565  ersion in betwee
-00082550: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
-00082560: 2020 2070 7269 6e74 2827 2020 2025 6920     print('   %i 
-00082570: 6f73 7320 3c20 6f73 6527 2025 206b 290a  oss < ose' % k).
-00082580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082590: 2320 722e 7072 696e 745f 7368 6f72 7428  # r.print_short(
-000825a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000825b0: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
-000825c0: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
-000825d0: 286f 7365 2c20 7072 6576 5f6f 6669 290a  (ose, prev_ofi).
-000825e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000825f0: 2023 2320 7370 6c69 740a 2020 2020 2020   ## split.      
-00082600: 2020 2020 2020 2020 2020 4c72 203d 2072            Lr = r
-00082610: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
-00082620: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00082630: 2020 4c6e 203d 2072 2e65 6e64 202d 2070    Ln = r.end - p
-00082640: 202b 2031 0a20 2020 2020 2020 2020 2020   + 1.           
-00082650: 2020 2020 2072 676e 5f6e 6577 203d 2072       rgn_new = r
-00082660: 6567 696f 6e28 2072 2e63 6872 2c20 702b  egion( r.chr, p+
-00082670: 6f73 652c 2072 2e65 6e64 2b6f 7365 2c20  ose, r.end+ose, 
-00082680: 722e 7479 7065 2c20 722e 636d 6174 5b3a  r.type, r.cmat[:
-00082690: 2c2d 4c6e 3a5d 2c20 7873 203d 2072 2e78  ,-Ln:], xs = r.x
-000826a0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-000826b0: 2020 2072 676e 5f6e 6577 2e67 6574 5f63     rgn_new.get_c
-000826c0: 7667 2829 0a20 2020 2020 2020 2020 2020  vg().           
-000826d0: 2020 2020 2072 5f74 6f5f 6164 642e 6170       r_to_add.ap
-000826e0: 7065 6e64 2872 676e 5f6e 6577 290a 2020  pend(rgn_new).  
-000826f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00082700: 735f 746f 5f61 6464 2e61 7070 656e 6428  s_to_add.append(
-00082710: 6b2b 3129 0a0a 2020 2020 2020 2020 2020  k+1)..          
-00082720: 2020 2020 2020 2320 7369 5f6c 7374 203d        # si_lst =
-00082730: 2066 696e 645f 736e 7028 7365 715f 6f72   find_snp(seq_or
-00082740: 675b 2870 2d31 293a 722e 656e 645d 2c20  g[(p-1):r.end], 
-00082750: 7267 6e5f 6e65 772e 7365 712c 2072 676e  rgn_new.seq, rgn
-00082760: 5f6e 6577 2e67 6574 5f63 7667 2829 2c20  _new.get_cvg(), 
-00082770: 6368 726d 2c20 702c 206f 7365 290a 2020  chrm, p, ose).  
-00082780: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00082790: 5f6c 7374 203d 2066 696e 645f 736e 7028  _lst = find_snp(
-000827a0: 7365 715f 6f72 675b 2870 2d31 293a 722e  seq_org[(p-1):r.
-000827b0: 656e 645d 2c20 7267 6e5f 6e65 772e 7365  end], rgn_new.se
-000827c0: 712c 2072 676e 5f6e 6577 2e63 6d61 742c  q, rgn_new.cmat,
-000827d0: 2063 6872 6d2c 2070 2c20 6f73 652c 2067   chrm, p, ose, g
-000827e0: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
-000827f0: 2020 2020 736e 765f 696e 666f 5f63 6872      snv_info_chr
-00082800: 203d 2073 6e76 5f69 6e66 6f5f 6368 7220   = snv_info_chr 
-00082810: 2b20 7369 5f6c 7374 0a20 2020 2020 2020  + si_lst.       
-00082820: 2020 2020 2020 2020 2067 645f 6964 7820           gd_idx 
-00082830: 3d20 6764 5f69 6478 5f6f 665f 7267 6e5b  = gd_idx_of_rgn[
-00082840: 6b5d 0a20 2020 2020 2020 2020 2020 2020  k].             
-00082850: 2020 2067 645f 7365 6c5b 6764 5f69 6478     gd_sel[gd_idx
-00082860: 5d2e 6e76 5f69 6e66 6f5f 6c73 7420 3d20  ].nv_info_lst = 
-00082870: 6764 5f73 656c 5b67 645f 6964 785d 2e6e  gd_sel[gd_idx].n
-00082880: 765f 696e 666f 5f6c 7374 202b 2073 695f  v_info_lst + si_
-00082890: 6c73 740a 0a20 2020 2020 2020 2020 2020  lst..           
-000828a0: 2020 2020 2072 2e65 6e64 203d 2070 2d31       r.end = p-1
-000828b0: 2b6f 7373 0a20 2020 2020 2020 2020 2020  +oss.           
-000828c0: 2020 2020 2072 2e73 7461 7274 202b 3d20       r.start += 
-000828d0: 6f73 730a 2020 2020 2020 2020 2020 2020  oss.            
-000828e0: 2020 2020 4c6e 203d 2072 2e65 6e64 202d      Ln = r.end -
-000828f0: 2072 2e73 7461 7274 202b 310a 2020 2020   r.start +1.    
-00082900: 2020 2020 2020 2020 2020 2020 722e 636d              r.cm
-00082910: 6174 203d 2072 2e63 6d61 745b 3a2c 3a4c  at = r.cmat[:,:L
-00082920: 6e5d 0a20 2020 2020 2020 2020 2020 2020  n].             
-00082930: 2020 2072 2e73 6571 203d 2072 2e73 6571     r.seq = r.seq
-00082940: 5b3a 4c6e 5d0a 2020 2020 2020 2020 2020  [:Ln].          
-00082950: 2020 2020 2020 722e 6376 6720 3d20 722e        r.cvg = r.
-00082960: 6376 675b 3a4c 6e5d 0a20 2020 2020 2020  cvg[:Ln].       
-00082970: 2020 2020 2020 2020 2023 2072 2e67 6574           # r.get
-00082980: 5f63 7667 2829 0a20 2020 2020 2020 2020  _cvg().         
-00082990: 2020 2020 2020 2072 616c 6c2e 7267 6e73         rall.rgns
-000829a0: 5b6b 5d20 3d20 7220 2320 2e63 6f70 7928  [k] = r # .copy(
-000829b0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-000829c0: 2020 2023 2073 695f 6c73 7420 3d20 6669     # si_lst = fi
+000816e0: 2070 7265 765f 706f 7320 3d20 722e 656e   prev_pos = r.en
+000816f0: 642b 310a 0a20 2020 2020 2020 2020 2020  d+1..           
+00081700: 2065 6c73 653a 2020 2020 2020 2020 2020   else:          
+00081710: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00081720: 2020 2020 2020 735f 6f72 6720 3d20 7365        s_org = se
+00081730: 715f 6f72 675b 2872 2e73 7461 7274 2d31  q_org[(r.start-1
+00081740: 293a 2872 2e65 6e64 295d 0a20 2020 2020  ):(r.end)].     
+00081750: 2020 2020 2020 2020 2020 2023 6966 206c             #if l
+00081760: 656e 2873 5f6f 7267 2920 3d3d 206c 656e  en(s_org) == len
+00081770: 2872 2e73 6571 293a 0a20 2020 2020 2020  (r.seq):.       
+00081780: 2020 2020 2020 2020 2072 2e63 6f6d 7061           r.compa
+00081790: 7265 5f61 6e64 5f72 6570 6c61 6365 5f4e  re_and_replace_N
+000817a0: 2873 5f6f 7267 290a 2020 2020 2020 2020  (s_org).        
+000817b0: 2020 2020 2020 2020 2320 656c 7365 3a20          # else: 
+000817c0: 2070 7269 6e74 2820 2757 4152 4e49 4e47   print( 'WARNING
+000817d0: 3a20 2569 2d25 6920 696e 2025 6920 7e3d  : %i-%i in %i ~=
+000817e0: 2025 6927 2025 2028 722e 7374 6172 742c   %i' % (r.start,
+000817f0: 2072 2e65 6e64 2c20 6c65 6e28 735f 6f72   r.end, len(s_or
+00081800: 6729 2c20 6c65 6e28 722e 7365 7129 2920  g), len(r.seq)) 
+00081810: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00081820: 2020 2069 6620 722e 7374 6172 7420 3e20     if r.start > 
+00081830: 7072 6576 5f70 6f73 3a0a 2020 2020 2020  prev_pos:.      
+00081840: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00081850: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
+00081860: 5f6f 7267 5b28 7072 6576 5f70 6f73 2d31  _org[(prev_pos-1
+00081870: 293a 2872 2e73 7461 7274 2d31 295d 290a  ):(r.start-1)]).
+00081880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081890: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+000818a0: 2020 2020 2073 6571 5f6c 7374 2e61 7070       seq_lst.app
+000818b0: 656e 6428 722e 7365 7129 0a20 2020 2020  end(r.seq).     
+000818c0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+000818d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000818e0: 6f66 2e61 6464 2820 6f73 5f63 7572 2c20  of.add( os_cur, 
+000818f0: 7072 6576 5f70 6f73 2c20 722e 656e 642b  prev_pos, r.end+
+00081900: 3120 290a 2020 2020 2020 2020 2020 2020  1 ).            
+00081910: 2020 2020 7072 6576 5f70 6f73 203d 2072      prev_pos = r
+00081920: 2e65 6e64 2b31 0a20 2020 2020 2020 2020  .end+1.         
+00081930: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00081940: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00081950: 656e 2872 2e73 6571 2920 213d 206c 656e  en(r.seq) != len
+00081960: 2873 5f6f 7267 293a 0a20 2020 2020 2020  (s_org):.       
+00081970: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+00081980: 7269 6e74 2820 2757 4152 4e49 4e47 3a20  rint( 'WARNING: 
+00081990: 2573 3a20 2569 2d25 6920 696e 2025 6920  %s: %i-%i in %i 
+000819a0: 7e3d 2025 6927 2025 2028 722e 6368 722c  ~= %i' % (r.chr,
+000819b0: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
+000819c0: 206c 656e 2873 5f6f 7267 292c 206c 656e   len(s_org), len
+000819d0: 2872 2e73 6571 2929 2029 0a20 2020 2020  (r.seq)) ).     
+000819e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000819f0: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
+00081a00: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
+00081a10: 2020 2020 2020 2020 2020 2023 2072 2e73             # r.s
+00081a20: 6571 203d 2072 6567 696f 6e28 722e 6368  eq = region(r.ch
+00081a30: 722c 2072 2e73 7461 7274 2c20 722e 656e  r, r.start, r.en
+00081a40: 642c 2072 2e74 7970 652c 2073 5f6f 7267  d, r.type, s_org
+00081a50: 2c20 6376 675f 6465 7020 3d20 4356 475f  , cvg_dep = CVG_
+00081a60: 4445 5054 485f 544d 5020 290a 2020 2020  DEPTH_TMP ).    
+00081a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081a80: 2320 722e 6765 745f 6376 6728 290a 2020  # r.get_cvg().  
+00081a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081aa0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+00081ab0: 2020 2020 2020 2020 2020 200a 0a20 2020             ..   
+00081ac0: 2020 2020 2065 6c69 6620 2872 2e74 7970       elif (r.typ
+00081ad0: 6520 3d3d 2027 696e 7365 7273 696f 6e27  e == 'insersion'
+00081ae0: 2920 7c20 2872 2e74 7970 6520 3d3d 2027  ) | (r.type == '
+00081af0: 4927 2029 3a0a 2020 2020 2020 2020 2020  I' ):.          
+00081b00: 2020 6966 2028 722e 7374 6172 7429 203c    if (r.start) <
+00081b10: 2028 7072 6576 5f70 6f73 293a 0a20 2020   (prev_pos):.   
+00081b20: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+00081b30: 7269 6e74 2827 5741 524e 494e 4720 2849  rint('WARNING (I
+00081b40: 293a 2025 6920 2d20 2573 2c20 2569 203c  ): %i - %s, %i <
+00081b50: 2025 6927 2025 2028 6d2c 2072 2e63 6872   %i' % (m, r.chr
+00081b60: 2c20 722e 7374 6172 742c 2070 7265 765f  , r.start, prev_
+00081b70: 706f 7329 2029 0a20 2020 2020 2020 2020  pos) ).         
+00081b80: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00081b90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00081ba0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+00081bb0: 2e61 6464 2820 6f73 5f63 7572 2c20 7072  .add( os_cur, pr
+00081bc0: 6576 5f70 6f73 2c20 722e 7374 6172 7420  ev_pos, r.start 
+00081bd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00081be0: 2020 6f73 5f63 7572 202b 3d20 2872 2e65    os_cur += (r.e
+00081bf0: 6e64 202d 2072 2e73 7461 7274 202b 2031  nd - r.start + 1
+00081c00: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00081c10: 2020 2069 6620 722e 7374 6172 7420 3e20     if r.start > 
+00081c20: 7072 6576 5f70 6f73 3a0a 2020 2020 2020  prev_pos:.      
+00081c30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00081c40: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
+00081c50: 5f6f 7267 5b28 7072 6576 5f70 6f73 2d31  _org[(prev_pos-1
+00081c60: 293a 2872 2e73 7461 7274 2d31 295d 290a  ):(r.start-1)]).
+00081c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081c80: 7365 715f 6c73 742e 6170 7065 6e64 2872  seq_lst.append(r
+00081c90: 2e73 6571 290a 0a20 2020 2020 2020 2020  .seq)..         
+00081ca0: 2020 2020 2020 2070 7265 765f 706f 7320         prev_pos 
+00081cb0: 3d20 722e 7374 6172 740a 0a20 2020 2020  = r.start..     
+00081cc0: 2020 2065 6c69 6620 2872 2e74 7970 6520     elif (r.type 
+00081cd0: 3d3d 2027 6465 6c65 7469 6f6e 2729 207c  == 'deletion') |
+00081ce0: 2028 722e 7479 7065 203d 3d20 2744 2720   (r.type == 'D' 
+00081cf0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00081d00: 6620 2872 2e73 7461 7274 2920 3c20 2870  f (r.start) < (p
+00081d10: 7265 765f 706f 7329 3a0a 2020 2020 2020  rev_pos):.      
+00081d20: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+00081d30: 7428 2757 4152 4e49 4e47 2028 4429 3a20  t('WARNING (D): 
+00081d40: 2569 202d 2025 732c 2025 6920 3c3d 2025  %i - %s, %i <= %
+00081d50: 6927 2025 2028 6d2c 2072 2e63 6872 2c20  i' % (m, r.chr, 
+00081d60: 722e 7374 6172 742c 2070 7265 765f 706f  r.start, prev_po
+00081d70: 7329 2029 0a20 2020 2020 2020 2020 2020  s) ).           
+00081d80: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00081d90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00081da0: 2020 2020 2020 2020 2020 2020 6f66 2e61              of.a
+00081db0: 6464 2820 6f73 5f63 7572 2c20 7072 6576  dd( os_cur, prev
+00081dc0: 5f70 6f73 2c20 722e 7374 6172 7420 290a  _pos, r.start ).
+00081dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081de0: 6f73 5f63 7572 202d 3d20 2872 2e65 6e64  os_cur -= (r.end
+00081df0: 202d 2072 2e73 7461 7274 202b 2031 290a   - r.start + 1).
+00081e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081e10: 7072 6576 5f70 6f73 203d 2072 2e73 7461  prev_pos = r.sta
+00081e20: 7274 0a0a 2020 2020 2020 2020 2020 2020  rt..            
+00081e30: 2020 2020 6f66 2e61 6464 2820 6f73 5f63      of.add( os_c
+00081e40: 7572 2c20 7072 6576 5f70 6f73 2c20 722e  ur, prev_pos, r.
+00081e50: 656e 642b 3120 290a 2020 2020 2020 2020  end+1 ).        
+00081e60: 2020 2020 2020 2020 7072 6576 5f70 6f73          prev_pos
+00081e70: 203d 2072 2e65 6e64 2b31 0a0a 2020 2020   = r.end+1..    
+00081e80: 2020 2020 6c61 7374 5f70 6f73 203d 2072      last_pos = r
+00081e90: 2e65 6e64 0a0a 2020 2020 7365 715f 6c73  .end..    seq_ls
+00081ea0: 742e 6170 7065 6e64 2873 6571 5f6f 7267  t.append(seq_org
+00081eb0: 5b28 7072 6576 5f70 6f73 2d31 293a 5d29  [(prev_pos-1):])
+00081ec0: 0a20 2020 2073 6571 5f6e 6577 203d 2027  .    seq_new = '
+00081ed0: 272e 6a6f 696e 2873 6571 5f6c 7374 290a  '.join(seq_lst).
+00081ee0: 0a20 2020 2023 2069 6620 6c61 7374 5f70  .    # if last_p
+00081ef0: 6f73 203e 2070 7265 765f 706f 733a 0a20  os > prev_pos:. 
+00081f00: 2020 206f 662e 6164 6428 206f 735f 6375     of.add( os_cu
+00081f10: 722c 2070 7265 765f 706f 732c 206c 656e  r, prev_pos, len
+00081f20: 2873 6571 5f6f 7267 2920 2b20 3130 3030  (seq_org) + 1000
+00081f30: 3030 2029 0a0a 2020 2020 656c 6170 7365  00 )..    elapse
+00081f40: 645f 7469 6d65 203d 2074 696d 652e 7469  d_time = time.ti
+00081f50: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
+00081f60: 650a 2020 2020 2320 7072 696e 7428 2720  e.    # print(' 
+00081f70: 2020 322e 2064 6f6e 6520 2825 6929 2020    2. done (%i)  
+00081f80: 2720 2520 2865 6c61 7073 6564 5f74 696d  ' % (elapsed_tim
+00081f90: 6529 2c20 666c 7573 6820 3d20 5472 7565  e), flush = True
+00081fa0: 290a 2020 2020 2327 2727 0a0a 2020 2020  ).    #'''..    
+00081fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081fe0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
+00081ff0: 5573 6520 6f66 6673 6574 5f66 696e 6465  Use offset_finde
+00082000: 7220 746f 2063 6f72 7265 6374 2070 6f73  r to correct pos
+00082010: 6974 696f 6e73 2069 6e20 4754 4620 656e  itions in GTF en
+00082020: 7472 6965 730a 2020 2020 2323 2061 6c73  tries.    ## als
+00082030: 6f20 6765 7420 7267 6e73 2066 7261 676d  o get rgns fragm
+00082040: 656e 7473 2077 6865 6e20 7370 6c69 7420  ents when split 
+00082050: 6973 2072 6571 7569 7265 640a 0a20 2020  is required..   
+00082060: 206f 662e 6d61 6b65 5f69 745f 636f 6d70   of.make_it_comp
+00082070: 6163 7428 290a 2020 2020 0a20 2020 2073  act().    .    s
+00082080: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
+00082090: 2e74 696d 6528 290a 2020 2020 725f 746f  .time().    r_to
+000820a0: 5f61 6464 203d 205b 5d0a 2020 2020 706f  _add = [].    po
+000820b0: 735f 746f 5f61 6464 203d 205b 5d0a 2020  s_to_add = [].  
+000820c0: 2020 736e 765f 696e 666f 5f63 6872 203d    snv_info_chr =
+000820d0: 205b 5d0a 0a20 2020 2066 6f72 2067 6420   []..    for gd 
+000820e0: 696e 2067 645f 7365 6c3a 0a20 2020 2020  in gd_sel:.     
+000820f0: 2020 2067 642e 6e76 5f69 6e66 6f5f 6c73     gd.nv_info_ls
+00082100: 7420 3d20 5b5d 0a0a 2020 2020 7072 6576  t = []..    prev
+00082110: 5f6f 6669 203d 2030 0a20 2020 2076 5f63  _ofi = 0.    v_c
+00082120: 6e74 203d 2030 0a20 2020 2023 666f 7220  nt = 0.    #for 
+00082130: 6b2c 2072 2069 6e20 656e 756d 6572 6174  k, r in enumerat
+00082140: 6528 7261 6c6c 2e72 676e 7329 3a0a 2020  e(rall.rgns):.  
+00082150: 2020 666f 7220 6d2c 206b 2069 6e20 656e    for m, k in en
+00082160: 756d 6572 6174 6528 6f64 7229 3a0a 2020  umerate(odr):.  
+00082170: 2020 2020 2020 7220 3d20 7261 6c6c 2e72        r = rall.r
+00082180: 676e 735b 6b5d 0a20 2020 2020 2020 2067  gns[k].        g
+00082190: 696e 203d 2047 656e 655f 6964 5f6e 616d  in = Gene_id_nam
+000821a0: 655b 6b5d 0a20 2020 2020 2020 200a 2020  e[k].        .  
+000821b0: 2020 2020 2020 6f73 732c 2070 7265 765f        oss, prev_
+000821c0: 6f66 3120 3d20 6f66 2e66 696e 645f 6f73  of1 = of.find_os
+000821d0: 5f73 6571 2872 2e73 7461 7274 2c20 7072  _seq(r.start, pr
+000821e0: 6576 5f6f 6669 290a 2020 2020 2020 2020  ev_ofi).        
+000821f0: 2320 6f73 6520 3d20 6f73 730a 2020 2020  # ose = oss.    
+00082200: 2020 2020 6f73 652c 2070 7265 765f 6f66      ose, prev_of
+00082210: 3220 3d20 6f66 2e66 696e 645f 6f73 5f73  2 = of.find_os_s
+00082220: 6571 2872 2e65 6e64 2c20 7072 6576 5f6f  eq(r.end, prev_o
+00082230: 6669 290a 200a 2020 2020 2020 2020 722e  fi). .        r.
+00082240: 6765 745f 6376 6728 290a 2020 2020 2020  get_cvg().      
+00082250: 2020 2320 6966 2072 2e63 7667 2069 7320    # if r.cvg is 
+00082260: 4e6f 6e65 3a20 722e 6376 6720 3d20 6e70  None: r.cvg = np
+00082270: 2e6f 6e65 7328 6c65 6e28 722e 7365 7129  .ones(len(r.seq)
+00082280: 290a 0a20 2020 2020 2020 2069 6620 722e  )..        if r.
+00082290: 7479 7065 203d 3d20 2765 786f 6e27 3a0a  type == 'exon':.
+000822a0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000822b0: 2020 2020 2020 2020 2069 6620 286f 7373           if (oss
+000822c0: 203d 3d20 6f73 6529 3a0a 0a20 2020 2020   == ose):..     
+000822d0: 2020 2020 2020 2020 2020 2023 2073 695f             # si_
+000822e0: 6c73 7420 3d20 6669 6e64 5f73 6e70 2873  lst = find_snp(s
+000822f0: 6571 5f6f 7267 5b28 722e 7374 6172 742d  eq_org[(r.start-
+00082300: 3129 3a72 2e65 6e64 5d2c 2072 2e73 6571  1):r.end], r.seq
+00082310: 2c20 722e 6765 745f 6376 6728 292c 2063  , r.get_cvg(), c
+00082320: 6872 6d2c 2072 2e73 7461 7274 2c20 6f73  hrm, r.start, os
+00082330: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00082340: 2020 2073 695f 6c73 7420 3d20 6669 6e64     si_lst = find
+00082350: 5f73 6e70 2873 6571 5f6f 7267 5b28 722e  _snp(seq_org[(r.
+00082360: 7374 6172 742d 3129 3a72 2e65 6e64 5d2c  start-1):r.end],
+00082370: 2072 2e73 6571 2c20 722e 636d 6174 2c20   r.seq, r.cmat, 
+00082380: 6368 726d 2c20 722e 7374 6172 742c 206f  chrm, r.start, o
+00082390: 7373 2c20 6769 6e29 0a20 2020 2020 2020  ss, gin).       
+000823a0: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
+000823b0: 6f5f 6368 7220 3d20 736e 765f 696e 666f  o_chr = snv_info
+000823c0: 5f63 6872 202b 2073 695f 6c73 740a 2020  _chr + si_lst.  
+000823d0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+000823e0: 5f69 6478 203d 2067 645f 6964 785f 6f66  _idx = gd_idx_of
+000823f0: 5f72 676e 5b6b 5d0a 2020 2020 2020 2020  _rgn[k].        
+00082400: 2020 2020 2020 2020 6764 5f73 656c 5b67          gd_sel[g
+00082410: 645f 6964 785d 2e6e 765f 696e 666f 5f6c  d_idx].nv_info_l
+00082420: 7374 203d 2067 645f 7365 6c5b 6764 5f69  st = gd_sel[gd_i
+00082430: 6478 5d2e 6e76 5f69 6e66 6f5f 6c73 7420  dx].nv_info_lst 
+00082440: 2b20 7369 5f6c 7374 0a0a 2020 2020 2020  + si_lst..      
+00082450: 2020 2020 2020 2020 2020 722e 7374 6172            r.star
+00082460: 7420 2b3d 206f 7373 0a20 2020 2020 2020  t += oss.       
+00082470: 2020 2020 2020 2020 2072 2e65 6e64 202b           r.end +
+00082480: 3d20 6f73 650a 2020 2020 2020 2020 2020  = ose.          
+00082490: 2020 2020 2020 7261 6c6c 2e72 676e 735b        rall.rgns[
+000824a0: 6b5d 203d 2072 2023 202e 636f 7079 2829  k] = r # .copy()
+000824b0: 0a0a 0a20 2020 2020 2020 2020 2020 2065  ...            e
+000824c0: 6c69 6620 286f 7373 203c 206f 7365 293a  lif (oss < ose):
+000824d0: 2023 2049 6e73 6572 7369 6f6e 2069 6e20   # Insersion in 
+000824e0: 6265 7477 6565 6e0a 0a20 2020 2020 2020  between..       
+000824f0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00082500: 2020 2025 6920 6f73 7320 3c20 6f73 6527     %i oss < ose'
+00082510: 2025 206b 290a 2020 2020 2020 2020 2020   % k).          
+00082520: 2020 2020 2020 2320 722e 7072 696e 745f        # r.print_
+00082530: 7368 6f72 7428 290a 2020 2020 2020 2020  short().        
+00082540: 2020 2020 2020 2020 702c 2070 7265 765f          p, prev_
+00082550: 6f66 3220 3d20 6f66 2e67 6574 5f62 6e64  of2 = of.get_bnd
+00082560: 7279 5f73 6571 286f 7365 2c20 7072 6576  ry_seq(ose, prev
+00082570: 5f6f 6669 290a 0a20 2020 2020 2020 2020  _ofi)..         
+00082580: 2020 2020 2020 2023 2320 7370 6c69 740a         ## split.
+00082590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000825a0: 4c72 203d 2072 2e65 6e64 202d 2072 2e73  Lr = r.end - r.s
+000825b0: 7461 7274 202b 310a 2020 2020 2020 2020  tart +1.        
+000825c0: 2020 2020 2020 2020 4c6e 203d 2072 2e65          Ln = r.e
+000825d0: 6e64 202d 2070 202b 2031 0a20 2020 2020  nd - p + 1.     
+000825e0: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
+000825f0: 6577 203d 2072 6567 696f 6e28 2072 2e63  ew = region( r.c
+00082600: 6872 2c20 702b 6f73 652c 2072 2e65 6e64  hr, p+ose, r.end
+00082610: 2b6f 7365 2c20 722e 7479 7065 2c20 722e  +ose, r.type, r.
+00082620: 636d 6174 5b3a 2c2d 4c6e 3a5d 2c20 7873  cmat[:,-Ln:], xs
+00082630: 203d 2072 2e78 7329 0a20 2020 2020 2020   = r.xs).       
+00082640: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
+00082650: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
+00082660: 2020 2020 2020 2020 2020 2072 5f74 6f5f             r_to_
+00082670: 6164 642e 6170 7065 6e64 2872 676e 5f6e  add.append(rgn_n
+00082680: 6577 290a 2020 2020 2020 2020 2020 2020  ew).            
+00082690: 2020 2020 706f 735f 746f 5f61 6464 2e61      pos_to_add.a
+000826a0: 7070 656e 6428 6b2b 3129 0a0a 2020 2020  ppend(k+1)..    
+000826b0: 2020 2020 2020 2020 2020 2020 2320 7369              # si
+000826c0: 5f6c 7374 203d 2066 696e 645f 736e 7028  _lst = find_snp(
+000826d0: 7365 715f 6f72 675b 2870 2d31 293a 722e  seq_org[(p-1):r.
+000826e0: 656e 645d 2c20 7267 6e5f 6e65 772e 7365  end], rgn_new.se
+000826f0: 712c 2072 676e 5f6e 6577 2e67 6574 5f63  q, rgn_new.get_c
+00082700: 7667 2829 2c20 6368 726d 2c20 702c 206f  vg(), chrm, p, o
+00082710: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00082720: 2020 2020 7369 5f6c 7374 203d 2066 696e      si_lst = fin
+00082730: 645f 736e 7028 7365 715f 6f72 675b 2870  d_snp(seq_org[(p
+00082740: 2d31 293a 722e 656e 645d 2c20 7267 6e5f  -1):r.end], rgn_
+00082750: 6e65 772e 7365 712c 2072 676e 5f6e 6577  new.seq, rgn_new
+00082760: 2e63 6d61 742c 2063 6872 6d2c 2070 2c20  .cmat, chrm, p, 
+00082770: 6f73 652c 2067 696e 290a 2020 2020 2020  ose, gin).      
+00082780: 2020 2020 2020 2020 2020 736e 765f 696e            snv_in
+00082790: 666f 5f63 6872 203d 2073 6e76 5f69 6e66  fo_chr = snv_inf
+000827a0: 6f5f 6368 7220 2b20 7369 5f6c 7374 0a20  o_chr + si_lst. 
+000827b0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+000827c0: 645f 6964 7820 3d20 6764 5f69 6478 5f6f  d_idx = gd_idx_o
+000827d0: 665f 7267 6e5b 6b5d 0a20 2020 2020 2020  f_rgn[k].       
+000827e0: 2020 2020 2020 2020 2067 645f 7365 6c5b           gd_sel[
+000827f0: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
+00082800: 6c73 7420 3d20 6764 5f73 656c 5b67 645f  lst = gd_sel[gd_
+00082810: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
+00082820: 202b 2073 695f 6c73 740a 0a20 2020 2020   + si_lst..     
+00082830: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
+00082840: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
+00082850: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
+00082860: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
+00082870: 2020 2020 2020 2020 2020 4c6e 203d 2072            Ln = r
+00082880: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
+00082890: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+000828a0: 2020 722e 636d 6174 203d 2072 2e63 6d61    r.cmat = r.cma
+000828b0: 745b 3a2c 3a4c 6e5d 0a20 2020 2020 2020  t[:,:Ln].       
+000828c0: 2020 2020 2020 2020 2072 2e73 6571 203d           r.seq =
+000828d0: 2072 2e73 6571 5b3a 4c6e 5d0a 2020 2020   r.seq[:Ln].    
+000828e0: 2020 2020 2020 2020 2020 2020 722e 6376              r.cv
+000828f0: 6720 3d20 722e 6376 675b 3a4c 6e5d 0a20  g = r.cvg[:Ln]. 
+00082900: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00082910: 2072 2e67 6574 5f63 7667 2829 0a20 2020   r.get_cvg().   
+00082920: 2020 2020 2020 2020 2020 2020 2072 616c               ral
+00082930: 6c2e 7267 6e73 5b6b 5d20 3d20 7220 2320  l.rgns[k] = r # 
+00082940: 2e63 6f70 7928 290a 0a20 2020 2020 2020  .copy()..       
+00082950: 2020 2020 2020 2020 2023 2073 695f 6c73           # si_ls
+00082960: 7420 3d20 6669 6e64 5f73 6e70 2873 6571  t = find_snp(seq
+00082970: 5f6f 7267 5b28 722e 7374 6172 742d 6f73  _org[(r.start-os
+00082980: 732d 3129 3a70 5d2c 2072 2e73 6571 2c20  s-1):p], r.seq, 
+00082990: 722e 6765 745f 6376 6728 292c 2063 6872  r.get_cvg(), chr
+000829a0: 6d2c 2072 2e73 7461 7274 2d6f 7373 2c20  m, r.start-oss, 
+000829b0: 6f73 7329 0a20 2020 2020 2020 2020 2020  oss).           
+000829c0: 2020 2020 2073 695f 6c73 7420 3d20 6669       si_lst = fi
 000829d0: 6e64 5f73 6e70 2873 6571 5f6f 7267 5b28  nd_snp(seq_org[(
 000829e0: 722e 7374 6172 742d 6f73 732d 3129 3a70  r.start-oss-1):p
-000829f0: 5d2c 2072 2e73 6571 2c20 722e 6765 745f  ], r.seq, r.get_
-00082a00: 6376 6728 292c 2063 6872 6d2c 2072 2e73  cvg(), chrm, r.s
-00082a10: 7461 7274 2d6f 7373 2c20 6f73 7329 0a20  tart-oss, oss). 
+000829f0: 5d2c 2072 2e73 6571 2c20 722e 636d 6174  ], r.seq, r.cmat
+00082a00: 2c20 6368 726d 2c20 722e 7374 6172 742d  , chrm, r.start-
+00082a10: 6f73 732c 206f 7373 2c20 6769 6e29 0a20  oss, oss, gin). 
 00082a20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00082a30: 695f 6c73 7420 3d20 6669 6e64 5f73 6e70  i_lst = find_snp
-00082a40: 2873 6571 5f6f 7267 5b28 722e 7374 6172  (seq_org[(r.star
-00082a50: 742d 6f73 732d 3129 3a70 5d2c 2072 2e73  t-oss-1):p], r.s
-00082a60: 6571 2c20 722e 636d 6174 2c20 6368 726d  eq, r.cmat, chrm
-00082a70: 2c20 722e 7374 6172 742d 6f73 732c 206f  , r.start-oss, o
-00082a80: 7373 2c20 6769 6e29 0a20 2020 2020 2020  ss, gin).       
-00082a90: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
-00082aa0: 6f5f 6368 7220 3d20 736e 765f 696e 666f  o_chr = snv_info
-00082ab0: 5f63 6872 202b 2073 695f 6c73 740a 2020  _chr + si_lst.  
-00082ac0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-00082ad0: 5f69 6478 203d 2067 645f 6964 785f 6f66  _idx = gd_idx_of
-00082ae0: 5f72 676e 5b6b 5d0a 2020 2020 2020 2020  _rgn[k].        
-00082af0: 2020 2020 2020 2020 6764 5f73 656c 5b67          gd_sel[g
-00082b00: 645f 6964 785d 2e6e 765f 696e 666f 5f6c  d_idx].nv_info_l
-00082b10: 7374 203d 2067 645f 7365 6c5b 6764 5f69  st = gd_sel[gd_i
-00082b20: 6478 5d2e 6e76 5f69 6e66 6f5f 6c73 7420  dx].nv_info_lst 
-00082b30: 2b20 7369 5f6c 7374 0a0a 2020 2020 2020  + si_lst..      
-00082b40: 2020 2020 2020 656c 6966 2028 6f73 7320        elif (oss 
-00082b50: 3e20 6f73 6529 3a20 2320 6465 6c65 7469  > ose): # deleti
-00082b60: 6f6e 2069 6e20 6265 7477 6565 6e0a 0a20  on in between.. 
-00082b70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00082b80: 7269 6e74 2827 2020 2025 6920 6f73 7320  rint('   %i oss 
-00082b90: 3e20 6f73 6527 2025 206b 290a 2020 2020  > ose' % k).    
-00082ba0: 2020 2020 2020 2020 2020 2020 2320 722e              # r.
-00082bb0: 7072 696e 745f 7368 6f72 7428 290a 2020  print_short().  
-00082bc0: 2020 2020 2020 2020 2020 2020 2020 702c                p,
-00082bd0: 2070 7265 765f 6f66 3220 3d20 6f66 2e67   prev_of2 = of.g
-00082be0: 6574 5f62 6e64 7279 5f73 6571 286f 7365  et_bndry_seq(ose
-00082bf0: 2c20 7072 6576 5f6f 6669 290a 2020 2020  , prev_ofi).    
-00082c00: 2020 2020 2020 2020 2020 2020 4c64 203d              Ld =
-00082c10: 206f 7373 202d 206f 7365 0a0a 2020 2020   oss - ose..    
-00082c20: 2020 2020 2020 2020 2020 2020 2323 2073              ## s
-00082c30: 706c 6974 2028 666f 7220 4344 5320 6f6e  plit (for CDS on
-00082c40: 6c79 290a 2020 2020 2020 2020 2020 2020  ly).            
-00082c50: 2020 2020 4c72 203d 2072 2e65 6e64 202d      Lr = r.end -
-00082c60: 2072 2e73 7461 7274 202b 310a 2020 2020   r.start +1.    
-00082c70: 2020 2020 2020 2020 2020 2020 4c6e 203d              Ln =
-00082c80: 2072 2e65 6e64 202d 2070 202b 2031 202d   r.end - p + 1 -
-00082c90: 204c 640a 2020 2020 2020 2020 2020 2020   Ld.            
-00082ca0: 2020 2020 7267 6e5f 6e65 7720 3d20 7265      rgn_new = re
-00082cb0: 6769 6f6e 2820 722e 6368 722c 2070 2b4c  gion( r.chr, p+L
-00082cc0: 642b 6f73 652c 2072 2e65 6e64 2b6f 7365  d+ose, r.end+ose
-00082cd0: 2c20 722e 7479 7065 2c20 722e 636d 6174  , r.type, r.cmat
-00082ce0: 5b3a 2c2d 4c6e 3a5d 2c20 7873 203d 2072  [:,-Ln:], xs = r
-00082cf0: 2e78 7329 0a20 2020 2020 2020 2020 2020  .xs).           
-00082d00: 2020 2020 2072 676e 5f6e 6577 2e67 6574       rgn_new.get
-00082d10: 5f63 7667 2829 0a20 2020 2020 2020 2020  _cvg().         
-00082d20: 2020 2020 2020 2072 5f74 6f5f 6164 642e         r_to_add.
-00082d30: 6170 7065 6e64 2872 676e 5f6e 6577 290a  append(rgn_new).
-00082d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082d50: 706f 735f 746f 5f61 6464 2e61 7070 656e  pos_to_add.appen
-00082d60: 6428 6b2b 3129 0a0a 2020 2020 2020 2020  d(k+1)..        
-00082d70: 2020 2020 2020 2020 2320 7369 5f6c 7374          # si_lst
-00082d80: 203d 2066 696e 645f 736e 7028 7365 715f   = find_snp(seq_
-00082d90: 6e65 775b 2872 676e 5f6e 6577 2e73 7461  new[(rgn_new.sta
-00082da0: 7274 2d31 293a 7267 6e5f 6e65 772e 656e  rt-1):rgn_new.en
-00082db0: 645d 2c20 7267 6e5f 6e65 772e 7365 712c  d], rgn_new.seq,
-00082dc0: 2072 676e 5f6e 6577 2e67 6574 5f63 7667   rgn_new.get_cvg
-00082dd0: 2829 2c20 6368 726d 2c20 702c 206f 7365  (), chrm, p, ose
-00082de0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00082df0: 2020 7369 5f6c 7374 203d 2066 696e 645f    si_lst = find_
-00082e00: 736e 7028 7365 715f 6e65 775b 2872 676e  snp(seq_new[(rgn
-00082e10: 5f6e 6577 2e73 7461 7274 2d31 293a 7267  _new.start-1):rg
-00082e20: 6e5f 6e65 772e 656e 645d 2c20 7267 6e5f  n_new.end], rgn_
-00082e30: 6e65 772e 7365 712c 2072 676e 5f6e 6577  new.seq, rgn_new
-00082e40: 2e63 6d61 742c 2063 6872 6d2c 2070 2c20  .cmat, chrm, p, 
-00082e50: 6f73 652c 2067 696e 290a 2020 2020 2020  ose, gin).      
-00082e60: 2020 2020 2020 2020 2020 736e 765f 696e            snv_in
-00082e70: 666f 5f63 6872 203d 2073 6e76 5f69 6e66  fo_chr = snv_inf
-00082e80: 6f5f 6368 7220 2b20 7369 5f6c 7374 0a20  o_chr + si_lst. 
-00082e90: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00082ea0: 645f 6964 7820 3d20 6764 5f69 6478 5f6f  d_idx = gd_idx_o
-00082eb0: 665f 7267 6e5b 6b5d 0a20 2020 2020 2020  f_rgn[k].       
-00082ec0: 2020 2020 2020 2020 2067 645f 7365 6c5b           gd_sel[
-00082ed0: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
-00082ee0: 6c73 7420 3d20 6764 5f73 656c 5b67 645f  lst = gd_sel[gd_
-00082ef0: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
-00082f00: 202b 2073 695f 6c73 740a 0a20 2020 2020   + si_lst..     
-00082f10: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
-00082f20: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
-00082f30: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
-00082f40: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
-00082f50: 2020 2020 2020 2020 2020 4c6e 203d 2072            Ln = r
-00082f60: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
-00082f70: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00082f80: 2020 722e 636d 6174 203d 2072 2e63 6d61    r.cmat = r.cma
-00082f90: 745b 3a2c 3a4c 6e5d 0a20 2020 2020 2020  t[:,:Ln].       
-00082fa0: 2020 2020 2020 2020 2072 2e73 6571 203d           r.seq =
-00082fb0: 2072 2e73 6571 5b3a 4c6e 5d0a 2020 2020   r.seq[:Ln].    
-00082fc0: 2020 2020 2020 2020 2020 2020 722e 6376              r.cv
-00082fd0: 6720 3d20 722e 6376 675b 3a4c 6e5d 0a20  g = r.cvg[:Ln]. 
-00082fe0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00082ff0: 2072 2e67 6574 5f63 7667 2829 0a20 2020   r.get_cvg().   
-00083000: 2020 2020 2020 2020 2020 2020 2072 616c               ral
-00083010: 6c2e 7267 6e73 5b6b 5d20 3d20 7220 2320  l.rgns[k] = r # 
-00083020: 2e63 6f70 7928 290a 0a20 2020 2020 2020  .copy()..       
-00083030: 2020 2020 2020 2020 2023 2073 695f 6c73           # si_ls
+00082a30: 6e76 5f69 6e66 6f5f 6368 7220 3d20 736e  nv_info_chr = sn
+00082a40: 765f 696e 666f 5f63 6872 202b 2073 695f  v_info_chr + si_
+00082a50: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
+00082a60: 2020 2020 6764 5f69 6478 203d 2067 645f      gd_idx = gd_
+00082a70: 6964 785f 6f66 5f72 676e 5b6b 5d0a 2020  idx_of_rgn[k].  
+00082a80: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+00082a90: 5f73 656c 5b67 645f 6964 785d 2e6e 765f  _sel[gd_idx].nv_
+00082aa0: 696e 666f 5f6c 7374 203d 2067 645f 7365  info_lst = gd_se
+00082ab0: 6c5b 6764 5f69 6478 5d2e 6e76 5f69 6e66  l[gd_idx].nv_inf
+00082ac0: 6f5f 6c73 7420 2b20 7369 5f6c 7374 0a0a  o_lst + si_lst..
+00082ad0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00082ae0: 2028 6f73 7320 3e20 6f73 6529 3a20 2320   (oss > ose): # 
+00082af0: 6465 6c65 7469 6f6e 2069 6e20 6265 7477  deletion in betw
+00082b00: 6565 6e0a 0a20 2020 2020 2020 2020 2020  een..           
+00082b10: 2020 2020 2070 7269 6e74 2827 2020 2025       print('   %
+00082b20: 6920 6f73 7320 3e20 6f73 6527 2025 206b  i oss > ose' % k
+00082b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00082b40: 2020 2320 722e 7072 696e 745f 7368 6f72    # r.print_shor
+00082b50: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00082b60: 2020 2020 702c 2070 7265 765f 6f66 3220      p, prev_of2 
+00082b70: 3d20 6f66 2e67 6574 5f62 6e64 7279 5f73  = of.get_bndry_s
+00082b80: 6571 286f 7365 2c20 7072 6576 5f6f 6669  eq(ose, prev_ofi
+00082b90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00082ba0: 2020 4c64 203d 206f 7373 202d 206f 7365    Ld = oss - ose
+00082bb0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00082bc0: 2020 2323 2073 706c 6974 2028 666f 7220    ## split (for 
+00082bd0: 4344 5320 6f6e 6c79 290a 2020 2020 2020  CDS only).      
+00082be0: 2020 2020 2020 2020 2020 4c72 203d 2072            Lr = r
+00082bf0: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
+00082c00: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00082c10: 2020 4c6e 203d 2072 2e65 6e64 202d 2070    Ln = r.end - p
+00082c20: 202b 2031 202d 204c 640a 2020 2020 2020   + 1 - Ld.      
+00082c30: 2020 2020 2020 2020 2020 7267 6e5f 6e65            rgn_ne
+00082c40: 7720 3d20 7265 6769 6f6e 2820 722e 6368  w = region( r.ch
+00082c50: 722c 2070 2b4c 642b 6f73 652c 2072 2e65  r, p+Ld+ose, r.e
+00082c60: 6e64 2b6f 7365 2c20 722e 7479 7065 2c20  nd+ose, r.type, 
+00082c70: 722e 636d 6174 5b3a 2c2d 4c6e 3a5d 2c20  r.cmat[:,-Ln:], 
+00082c80: 7873 203d 2072 2e78 7329 0a20 2020 2020  xs = r.xs).     
+00082c90: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
+00082ca0: 6577 2e67 6574 5f63 7667 2829 0a20 2020  ew.get_cvg().   
+00082cb0: 2020 2020 2020 2020 2020 2020 2072 5f74               r_t
+00082cc0: 6f5f 6164 642e 6170 7065 6e64 2872 676e  o_add.append(rgn
+00082cd0: 5f6e 6577 290a 2020 2020 2020 2020 2020  _new).          
+00082ce0: 2020 2020 2020 706f 735f 746f 5f61 6464        pos_to_add
+00082cf0: 2e61 7070 656e 6428 6b2b 3129 0a0a 2020  .append(k+1)..  
+00082d00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00082d10: 7369 5f6c 7374 203d 2066 696e 645f 736e  si_lst = find_sn
+00082d20: 7028 7365 715f 6e65 775b 2872 676e 5f6e  p(seq_new[(rgn_n
+00082d30: 6577 2e73 7461 7274 2d31 293a 7267 6e5f  ew.start-1):rgn_
+00082d40: 6e65 772e 656e 645d 2c20 7267 6e5f 6e65  new.end], rgn_ne
+00082d50: 772e 7365 712c 2072 676e 5f6e 6577 2e67  w.seq, rgn_new.g
+00082d60: 6574 5f63 7667 2829 2c20 6368 726d 2c20  et_cvg(), chrm, 
+00082d70: 702c 206f 7365 290a 2020 2020 2020 2020  p, ose).        
+00082d80: 2020 2020 2020 2020 7369 5f6c 7374 203d          si_lst =
+00082d90: 2066 696e 645f 736e 7028 7365 715f 6e65   find_snp(seq_ne
+00082da0: 775b 2872 676e 5f6e 6577 2e73 7461 7274  w[(rgn_new.start
+00082db0: 2d31 293a 7267 6e5f 6e65 772e 656e 645d  -1):rgn_new.end]
+00082dc0: 2c20 7267 6e5f 6e65 772e 7365 712c 2072  , rgn_new.seq, r
+00082dd0: 676e 5f6e 6577 2e63 6d61 742c 2063 6872  gn_new.cmat, chr
+00082de0: 6d2c 2070 2c20 6f73 652c 2067 696e 290a  m, p, ose, gin).
+00082df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082e00: 736e 765f 696e 666f 5f63 6872 203d 2073  snv_info_chr = s
+00082e10: 6e76 5f69 6e66 6f5f 6368 7220 2b20 7369  nv_info_chr + si
+00082e20: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+00082e30: 2020 2020 2067 645f 6964 7820 3d20 6764       gd_idx = gd
+00082e40: 5f69 6478 5f6f 665f 7267 6e5b 6b5d 0a20  _idx_of_rgn[k]. 
+00082e50: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00082e60: 645f 7365 6c5b 6764 5f69 6478 5d2e 6e76  d_sel[gd_idx].nv
+00082e70: 5f69 6e66 6f5f 6c73 7420 3d20 6764 5f73  _info_lst = gd_s
+00082e80: 656c 5b67 645f 6964 785d 2e6e 765f 696e  el[gd_idx].nv_in
+00082e90: 666f 5f6c 7374 202b 2073 695f 6c73 740a  fo_lst + si_lst.
+00082ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00082eb0: 2072 2e65 6e64 203d 2070 2d31 2b6f 7373   r.end = p-1+oss
+00082ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00082ed0: 2072 2e73 7461 7274 202b 3d20 6f73 730a   r.start += oss.
+00082ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082ef0: 4c6e 203d 2072 2e65 6e64 202d 2072 2e73  Ln = r.end - r.s
+00082f00: 7461 7274 202b 310a 2020 2020 2020 2020  tart +1.        
+00082f10: 2020 2020 2020 2020 722e 636d 6174 203d          r.cmat =
+00082f20: 2072 2e63 6d61 745b 3a2c 3a4c 6e5d 0a20   r.cmat[:,:Ln]. 
+00082f30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00082f40: 2e73 6571 203d 2072 2e73 6571 5b3a 4c6e  .seq = r.seq[:Ln
+00082f50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00082f60: 2020 722e 6376 6720 3d20 722e 6376 675b    r.cvg = r.cvg[
+00082f70: 3a4c 6e5d 0a20 2020 2020 2020 2020 2020  :Ln].           
+00082f80: 2020 2020 2023 2072 2e67 6574 5f63 7667       # r.get_cvg
+00082f90: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00082fa0: 2020 2072 616c 6c2e 7267 6e73 5b6b 5d20     rall.rgns[k] 
+00082fb0: 3d20 7220 2320 2e63 6f70 7928 290a 0a20  = r # .copy().. 
+00082fc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00082fd0: 2073 695f 6c73 7420 3d20 6669 6e64 5f73   si_lst = find_s
+00082fe0: 6e70 2873 6571 5f6f 7267 5b28 722e 7374  np(seq_org[(r.st
+00082ff0: 6172 742d 6f73 732d 3129 3a70 5d2c 2072  art-oss-1):p], r
+00083000: 2e73 6571 2c20 722e 6765 745f 6376 6728  .seq, r.get_cvg(
+00083010: 292c 2063 6872 6d2c 2072 2e73 7461 7274  ), chrm, r.start
+00083020: 2d6f 7373 2c20 6f73 7329 0a20 2020 2020  -oss, oss).     
+00083030: 2020 2020 2020 2020 2020 2073 695f 6c73             si_ls
 00083040: 7420 3d20 6669 6e64 5f73 6e70 2873 6571  t = find_snp(seq
 00083050: 5f6f 7267 5b28 722e 7374 6172 742d 6f73  _org[(r.start-os
 00083060: 732d 3129 3a70 5d2c 2072 2e73 6571 2c20  s-1):p], r.seq, 
-00083070: 722e 6765 745f 6376 6728 292c 2063 6872  r.get_cvg(), chr
-00083080: 6d2c 2072 2e73 7461 7274 2d6f 7373 2c20  m, r.start-oss, 
-00083090: 6f73 7329 0a20 2020 2020 2020 2020 2020  oss).           
-000830a0: 2020 2020 2073 695f 6c73 7420 3d20 6669       si_lst = fi
-000830b0: 6e64 5f73 6e70 2873 6571 5f6f 7267 5b28  nd_snp(seq_org[(
-000830c0: 722e 7374 6172 742d 6f73 732d 3129 3a70  r.start-oss-1):p
-000830d0: 5d2c 2072 2e73 6571 2c20 722e 636d 6174  ], r.seq, r.cmat
-000830e0: 2c20 6368 726d 2c20 722e 7374 6172 742d  , chrm, r.start-
-000830f0: 6f73 732c 206f 7373 2c20 6769 6e29 0a20  oss, oss, gin). 
-00083100: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00083110: 6e76 5f69 6e66 6f5f 6368 7220 3d20 736e  nv_info_chr = sn
-00083120: 765f 696e 666f 5f63 6872 202b 2073 695f  v_info_chr + si_
-00083130: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
-00083140: 2020 2020 6764 5f69 6478 203d 2067 645f      gd_idx = gd_
-00083150: 6964 785f 6f66 5f72 676e 5b6b 5d0a 2020  idx_of_rgn[k].  
-00083160: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-00083170: 5f73 656c 5b67 645f 6964 785d 2e6e 765f  _sel[gd_idx].nv_
-00083180: 696e 666f 5f6c 7374 203d 2067 645f 7365  info_lst = gd_se
-00083190: 6c5b 6764 5f69 6478 5d2e 6e76 5f69 6e66  l[gd_idx].nv_inf
-000831a0: 6f5f 6c73 7420 2b20 7369 5f6c 7374 0a20  o_lst + si_lst. 
-000831b0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-000831c0: 2020 2020 2020 2020 656c 6966 2072 2e74          elif r.t
-000831d0: 7970 6520 3d3d 2027 696e 7365 7273 696f  ype == 'insersio
-000831e0: 6e27 3a0a 0a20 2020 2020 2020 2020 2020  n':..           
-000831f0: 206f 7373 702c 2070 7265 765f 6f66 3120   ossp, prev_of1 
-00083200: 3d20 6f66 2e66 696e 645f 6f73 5f73 6571  = of.find_os_seq
-00083210: 2872 2e73 7461 7274 2d31 2c20 7072 6576  (r.start-1, prev
-00083220: 5f6f 6669 2c20 6d61 726b 203d 2027 4927  _ofi, mark = 'I'
-00083230: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00083240: 6f70 203d 2073 6571 5f6f 7267 5b69 6e74  op = seq_org[int
-00083250: 2872 2e73 7461 7274 2d28 4e57 494e 2b31  (r.start-(NWIN+1
-00083260: 2929 3a69 6e74 2872 2e73 7461 7274 2d31  )):int(r.start-1
-00083270: 295d 0a20 2020 2020 2020 2020 2020 2073  )].            s
-00083280: 6f63 203d 2027 2d27 0a20 2020 2020 2020  oc = '-'.       
-00083290: 2020 2020 2073 6f6e 203d 2073 6571 5f6f       son = seq_o
-000832a0: 7267 5b69 6e74 2872 2e73 7461 7274 2d31  rg[int(r.start-1
-000832b0: 293a 696e 7428 722e 7374 6172 742b 284e  ):int(r.start+(N
-000832c0: 5749 4e2d 3129 295d 0a20 2020 2020 2020  WIN-1))].       
-000832d0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-000832e0: 2020 736e 7020 3d20 7365 715f 6e65 775b    snp = seq_new[
-000832f0: 696e 7428 722e 7374 6172 742b 6f73 7370  int(r.start+ossp
-00083300: 2d28 4e57 494e 2b31 2929 3a69 6e74 2872  -(NWIN+1)):int(r
-00083310: 2e73 7461 7274 2b6f 7373 702d 3129 5d0a  .start+ossp-1)].
-00083320: 2020 2020 2020 2020 2020 2020 736e 6320              snc 
-00083330: 3d20 722e 7365 710a 2020 2020 2020 2020  = r.seq.        
-00083340: 2020 2020 736e 6e20 3d20 7365 715f 6e65      snn = seq_ne
-00083350: 775b 696e 7428 722e 7374 6172 742b 6f73  w[int(r.start+os
-00083360: 732d 3129 3a69 6e74 2872 2e73 7461 7274  s-1):int(r.start
-00083370: 2b6f 7373 2b28 4e57 494e 2d31 2929 5d0a  +oss+(NWIN-1))].
-00083380: 2020 2020 2020 2020 2020 2020 7369 203d              si =
-00083390: 2053 4e56 5f69 6e66 6f28 6368 726d 2c20   SNV_info(chrm, 
-000833a0: 722e 7374 6172 742c 2072 2e73 7461 7274  r.start, r.start
-000833b0: 2b6f 7373 2c20 6769 6e5b 305d 2c20 6769  +oss, gin[0], gi
-000833c0: 6e5b 315d 2c20 2749 272c 2072 2e67 6574  n[1], 'I', r.get
-000833d0: 5f6c 656e 2829 2c20 696e 7428 722e 6176  _len(), int(r.av
-000833e0: 655f 6376 675f 6465 7074 6828 2929 2c20  e_cvg_depth()), 
-000833f0: 722e 6376 675f 6672 6163 2c20 736f 702c  r.cvg_frac, sop,
-00083400: 2073 6f63 2c20 736f 6e2c 2073 6e70 2c20   soc, son, snp, 
-00083410: 736e 632c 2073 6e6e 2029 0a20 2020 2020  snc, snn ).     
-00083420: 2020 2020 2020 2073 6e76 5f69 6e66 6f5f         snv_info_
-00083430: 6368 722e 6170 7065 6e64 2873 6929 0a20  chr.append(si). 
-00083440: 2020 2020 2020 2020 2020 2067 645f 6964             gd_id
-00083450: 7820 3d20 6764 5f69 6478 5f6f 665f 7267  x = gd_idx_of_rg
-00083460: 6e5b 6b5d 0a20 2020 2020 2020 2020 2020  n[k].           
-00083470: 2067 645f 7365 6c5b 6764 5f69 6478 5d2e   gd_sel[gd_idx].
-00083480: 6e76 5f69 6e66 6f5f 6c73 742e 6170 7065  nv_info_lst.appe
-00083490: 6e64 2873 6929 0a0a 2020 2020 2020 2020  nd(si)..        
-000834a0: 2020 2020 722e 7374 6172 7420 2b3d 206f      r.start += o
-000834b0: 7373 700a 2020 2020 2020 2020 2020 2020  ssp.            
-000834c0: 722e 656e 6420 2b3d 206f 7373 7020 200a  r.end += ossp  .
-000834d0: 2020 2020 2020 2020 2020 2020 7261 6c6c              rall
-000834e0: 2e72 676e 735b 6b5d 203d 2072 2023 202e  .rgns[k] = r # .
-000834f0: 636f 7079 2829 0a0a 2020 2020 2020 2020  copy()..        
-00083500: 656c 6966 2072 2e74 7970 6520 3d3d 2027  elif r.type == '
-00083510: 6465 6c65 7469 6f6e 273a 0a0a 2020 2020  deletion':..    
-00083520: 2020 2020 2020 2020 6f73 7370 2c20 7072          ossp, pr
-00083530: 6576 5f6f 6631 203d 206f 662e 6669 6e64  ev_of1 = of.find
-00083540: 5f6f 735f 7365 7128 722e 7374 6172 742d  _os_seq(r.start-
-00083550: 312c 2070 7265 765f 6f66 692c 206d 6172  1, prev_ofi, mar
-00083560: 6b20 3d20 2744 2729 0a0a 2020 2020 2020  k = 'D')..      
-00083570: 2020 2020 2020 736f 7020 3d20 7365 715f        sop = seq_
-00083580: 6f72 675b 696e 7428 722e 7374 6172 742d  org[int(r.start-
-00083590: 284e 5749 4e2b 3129 293a 696e 7428 722e  (NWIN+1)):int(r.
-000835a0: 7374 6172 742d 3129 5d0a 2020 2020 2020  start-1)].      
-000835b0: 2020 2020 2020 736f 6320 3d20 7365 715f        soc = seq_
-000835c0: 6f72 675b 696e 7428 722e 7374 6172 742d  org[int(r.start-
-000835d0: 3129 3a69 6e74 2872 2e65 6e64 295d 0a20  1):int(r.end)]. 
-000835e0: 2020 2020 2020 2020 2020 2073 6f6e 203d             son =
-000835f0: 2073 6571 5f6f 7267 5b69 6e74 2872 2e65   seq_org[int(r.e
-00083600: 6e64 293a 696e 7428 722e 656e 642b 284e  nd):int(r.end+(N
-00083610: 5749 4e29 295d 0a20 2020 2020 2020 2020  WIN))].         
-00083620: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00083630: 2320 736f 7020 3d20 7261 6c6c 2e72 676e  # sop = rall.rgn
-00083640: 735b 6f64 725b 6d2d 315d 5d2e 7365 715b  s[odr[m-1]].seq[
-00083650: 2d4e 5749 4e3a 5d0a 2020 2020 2020 2020  -NWIN:].        
-00083660: 2020 2020 736e 7020 3d20 7365 715f 6e65      snp = seq_ne
-00083670: 775b 696e 7428 722e 7374 6172 742b 6f73  w[int(r.start+os
-00083680: 7370 2d28 4e57 494e 2b31 2929 3a69 6e74  sp-(NWIN+1)):int
-00083690: 2872 2e73 7461 7274 2b6f 7373 702d 3129  (r.start+ossp-1)
-000836a0: 5d0a 2020 2020 2020 2020 2020 2020 736e  ].            sn
-000836b0: 6320 3d20 272d 270a 2020 2020 2020 2020  c = '-'.        
-000836c0: 2020 2020 2320 736f 6e20 3d20 7261 6c6c      # son = rall
-000836d0: 2e72 676e 735b 6f64 725b 6d2b 315d 5d2e  .rgns[odr[m+1]].
-000836e0: 7365 715b 3a4e 5749 4e5d 0a20 2020 2020  seq[:NWIN].     
-000836f0: 2020 2020 2020 2073 6e6e 203d 2073 6571         snn = seq
-00083700: 5f6e 6577 5b69 6e74 2872 2e73 7461 7274  _new[int(r.start
-00083710: 2b6f 7373 702d 3129 3a69 6e74 2872 2e73  +ossp-1):int(r.s
-00083720: 7461 7274 2b6f 7373 702b 284e 5749 4e2d  tart+ossp+(NWIN-
-00083730: 3129 295d 0a20 2020 2020 2020 2020 2020  1))].           
-00083740: 2073 6920 3d20 534e 565f 696e 666f 2863   si = SNV_info(c
-00083750: 6872 6d2c 2072 2e73 7461 7274 2c20 722e  hrm, r.start, r.
-00083760: 7374 6172 742b 6f73 732c 2067 696e 5b30  start+oss, gin[0
-00083770: 5d2c 2067 696e 5b31 5d2c 2027 4427 2c20  ], gin[1], 'D', 
-00083780: 722e 6765 745f 6c65 6e28 292c 2069 6e74  r.get_len(), int
-00083790: 2872 2e61 7665 5f63 7667 5f64 6570 7468  (r.ave_cvg_depth
-000837a0: 2829 292c 2072 2e63 7667 5f66 7261 632c  ()), r.cvg_frac,
-000837b0: 2073 6f70 2c20 736f 632c 2073 6f6e 2c20   sop, soc, son, 
-000837c0: 736e 702c 2073 6e63 2c20 736e 6e20 290a  snp, snc, snn ).
-000837d0: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
-000837e0: 696e 666f 5f63 6872 2e61 7070 656e 6428  info_chr.append(
-000837f0: 7369 290a 2020 2020 2020 2020 2020 2020  si).            
-00083800: 6764 5f69 6478 203d 2067 645f 6964 785f  gd_idx = gd_idx_
-00083810: 6f66 5f72 676e 5b6b 5d0a 2020 2020 2020  of_rgn[k].      
-00083820: 2020 2020 2020 6764 5f73 656c 5b67 645f        gd_sel[gd_
-00083830: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
-00083840: 2e61 7070 656e 6428 7369 290a 0a20 2020  .append(si)..   
-00083850: 2020 2020 2020 2020 2072 2e73 7461 7274           r.start
-00083860: 202b 3d20 6f73 7370 0a20 2020 2020 2020   += ossp.       
-00083870: 2020 2020 2072 2e65 6e64 202b 3d20 6f73       r.end += os
-00083880: 7370 2020 200a 2020 2020 2020 2020 2020  sp   .          
-00083890: 2020 7261 6c6c 2e72 676e 735b 6b5d 203d    rall.rgns[k] =
-000838a0: 2072 2023 202e 636f 7079 2829 0a0a 2020   r # .copy()..  
-000838b0: 2020 2020 2020 7072 6576 5f6f 6669 203d        prev_ofi =
-000838c0: 2070 7265 765f 6f66 310a 0a20 2020 2065   prev_of1..    e
-000838d0: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
-000838e0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-000838f0: 745f 7469 6d65 0a20 2020 2023 2070 7269  t_time.    # pri
-00083900: 6e74 2827 2020 2033 2e20 646f 6e65 2028  nt('   3. done (
-00083910: 2569 2920 2025 6927 2025 2028 656c 6170  %i)  %i' % (elap
-00083920: 7365 645f 7469 6d65 2c20 6c65 6e28 6f66  sed_time, len(of
-00083930: 2e6f 7369 5f6c 7374 2929 2c20 666c 7573  .osi_lst)), flus
-00083940: 6820 3d20 5472 7565 290a 2020 2020 0a20  h = True).    . 
-00083950: 2020 206e 765f 6c73 7420 3d20 5b5d 0a20     nv_lst = []. 
-00083960: 2020 2066 6f72 2067 6420 696e 2067 645f     for gd in gd_
-00083970: 7365 6c3a 0a20 2020 2020 2020 2066 6f72  sel:.        for
-00083980: 2074 6420 696e 2067 642e 7464 5f6c 7374   td in gd.td_lst
-00083990: 3a0a 2020 2020 2020 2020 2020 2020 7464  :.            td
-000839a0: 2e67 6574 5f6f 7267 5f63 6f64 696e 675f  .get_org_coding_
-000839b0: 7365 7128 2067 642e 6364 732e 7267 6e73  seq( gd.cds.rgns
-000839c0: 2c20 7365 715f 6f72 6720 290a 2020 2020  , seq_org ).    
-000839d0: 2020 2020 6e76 5f6c 7374 203d 206e 765f      nv_lst = nv_
-000839e0: 6c73 7420 2b20 6764 2e67 6574 5f67 656e  lst + gd.get_gen
-000839f0: 655f 6c65 7665 6c5f 6e76 5f69 6e66 6f28  e_level_nv_info(
-00083a00: 290a 2020 2020 736e 765f 696e 666f 5f63  ).    snv_info_c
-00083a10: 6872 203d 206e 765f 6c73 740a 2020 2020  hr = nv_lst.    
-00083a20: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00083a30: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00083a40: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00083a50: 2323 2070 7574 2072 676e 7320 6261 636b  ## put rgns back
-00083a60: 2074 6f20 6764 5f73 656c 0a20 2020 2023   to gd_sel.    #
-00083a70: 2320 616e 6420 616c 736f 2061 6464 206e  # and also add n
-00083a80: 6577 2072 676e 7320 0a0a 2020 2020 7374  ew rgns ..    st
-00083a90: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
-00083aa0: 7469 6d65 2829 0a20 2020 2070 6f73 5f74  time().    pos_t
-00083ab0: 6f5f 6164 6420 3d20 6e70 2e61 7272 6179  o_add = np.array
-00083ac0: 2870 6f73 5f74 6f5f 6164 6429 0a20 2020  (pos_to_add).   
-00083ad0: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
-00083ae0: 756d 6572 6174 6528 6764 5f73 656c 293a  umerate(gd_sel):
-00083af0: 200a 0a20 2020 2020 2020 2070 3120 3d20   ..        p1 = 
-00083b00: 696e 7428 6c6f 635f 6f73 5b6b 5d29 0a20  int(loc_os[k]). 
-00083b10: 2020 2020 2020 2070 3220 3d20 696e 7428         p2 = int(
-00083b20: 7031 202b 206e 756d 5f6f 735b 6b5d 290a  p1 + num_os[k]).
-00083b30: 2020 2020 2020 2020 2320 6764 2e65 786f          # gd.exo
-00083b40: 6e73 2e72 676e 7320 3d20 7261 6c6c 2e72  ns.rgns = rall.r
-00083b50: 676e 735b 7031 3a70 325d 0a20 2020 2020  gns[p1:p2].     
-00083b60: 2020 2067 642e 6578 6f6e 732e 7267 6e73     gd.exons.rgns
-00083b70: 203d 205b 7261 6c6c 2e72 676e 735b 7031   = [rall.rgns[p1
-00083b80: 2b6d 5d20 666f 7220 6d20 696e 2072 616e  +m] for m in ran
-00083b90: 6765 2870 322d 7031 295d 0a20 2020 2020  ge(p2-p1)].     
-00083ba0: 2020 2077 6820 3d20 7768 6963 6828 2028     wh = which( (
-00083bb0: 706f 735f 746f 5f61 6464 203e 3d20 7031  pos_to_add >= p1
-00083bc0: 2920 2620 2870 6f73 5f74 6f5f 6164 6420  ) & (pos_to_add 
-00083bd0: 3c20 7032 2920 290a 2020 2020 2020 2020  < p2) ).        
-00083be0: 6966 206c 656e 2877 6829 203e 2030 3a0a  if len(wh) > 0:.
-00083bf0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00083c00: 7720 696e 2077 683a 2067 642e 6578 6f6e  w in wh: gd.exon
-00083c10: 732e 7267 6e73 2e61 7070 656e 6428 725f  s.rgns.append(r_
-00083c20: 746f 5f61 6464 5b77 5d29 0a0a 2020 2020  to_add[w])..    
-00083c30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083c40: 2323 2323 2323 230a 2020 2020 2323 2072  #######.    ## r
-00083c50: 656d 6f76 6520 6964 656c 6574 696f 6e20  emove ideletion 
-00083c60: 0a20 2020 2023 2320 636f 6d62 696e 6520  .    ## combine 
-00083c70: 7469 6c65 6420 6578 6f6e 730a 2020 2020  tiled exons.    
-00083c80: 0a20 2020 2066 6f72 2067 6420 696e 2067  .    for gd in g
-00083c90: 645f 7365 6c3a 0a20 2020 2020 2020 2067  d_sel:.        g
-00083ca0: 642e 7265 6d6f 7665 5f69 6e64 656c 5f61  d.remove_indel_a
-00083cb0: 6e64 5f63 6f6d 6269 6e65 5f66 7261 6773  nd_combine_frags
-00083cc0: 2829 0a0a 2020 2020 2327 2727 0a20 2020  ()..    #'''.   
-00083cd0: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
-00083ce0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00083cf0: 6172 745f 7469 6d65 0a20 2020 2023 2070  art_time.    # p
-00083d00: 7269 6e74 2827 2020 2033 622e 2064 6f6e  rint('   3b. don
-00083d10: 6520 2825 6929 2020 2720 2520 2865 6c61  e (%i)  ' % (ela
-00083d20: 7073 6564 5f74 696d 6529 2c20 666c 7573  psed_time), flus
-00083d30: 6820 3d20 5472 7565 290a 2020 2020 0a0a  h = True).    ..
-00083d40: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-00083d50: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-00083d60: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00083d70: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
-00083d80: 2063 6f64 696e 6720 7265 6769 6f6e 2075   coding region u
-00083d90: 7064 6174 650a 0a20 2020 2073 7461 7274  pdate..    start
-00083da0: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
-00083db0: 6528 290a 2020 2020 0a20 2020 2023 2320  e().    .    ## 
-00083dc0: 636f 6c6c 6563 7420 7267 6e73 2061 6e64  collect rgns and
-00083dd0: 206d 6172 6b20 7468 6569 7220 706f 730a   mark their pos.
-00083de0: 2020 2020 6c6f 635f 6f73 203d 206e 702e      loc_os = np.
-00083df0: 7a65 726f 7328 6e5f 6764 290a 2020 2020  zeros(n_gd).    
-00083e00: 6e75 6d5f 6f73 203d 206e 702e 7a65 726f  num_os = np.zero
-00083e10: 7328 6e5f 6764 2c64 7479 7065 3d6e 702e  s(n_gd,dtype=np.
-00083e20: 666c 6f61 7433 3229 0a20 2020 2063 616c  float32).    cal
-00083e30: 6c20 3d20 7265 6769 6f6e 7328 290a 2020  l = regions().  
-00083e40: 2020 6f73 5f63 7572 203d 2030 0a20 2020    os_cur = 0.   
-00083e50: 2063 5f70 6f73 203d 205b 5d0a 2020 2020   c_pos = [].    
-00083e60: 666f 7220 6b2c 2067 6420 696e 2065 6e75  for k, gd in enu
-00083e70: 6d65 7261 7465 2867 645f 7365 6c29 3a0a  merate(gd_sel):.
-00083e80: 2020 2020 2020 2020 6c6f 635f 6f73 5b6b          loc_os[k
-00083e90: 5d20 3d20 6f73 5f63 7572 0a20 2020 2020  ] = os_cur.     
-00083ea0: 2020 206e 756d 5f6f 735b 6b5d 203d 206c     num_os[k] = l
-00083eb0: 656e 2867 642e 6364 732e 7267 6e73 290a  en(gd.cds.rgns).
-00083ec0: 2020 2020 2020 2020 6361 6c6c 2e72 676e          call.rgn
-00083ed0: 7320 3d20 6361 6c6c 2e72 676e 7320 2b20  s = call.rgns + 
-00083ee0: 6764 2e63 6473 2e72 676e 730a 2020 2020  gd.cds.rgns.    
-00083ef0: 2020 2020 6f73 5f63 7572 202b 3d20 6c65      os_cur += le
-00083f00: 6e28 6764 2e63 6473 2e72 676e 7329 0a0a  n(gd.cds.rgns)..
-00083f10: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
-00083f20: 2067 642e 6364 732e 7267 6e73 3a0a 2020   gd.cds.rgns:.  
-00083f30: 2020 2020 2020 2020 2020 635f 706f 732e            c_pos.
-00083f40: 6170 7065 6e64 2872 2e73 7461 7274 290a  append(r.start).
-00083f50: 0a20 2020 2023 2320 6765 7420 6f72 6465  .    ## get orde
-00083f60: 7220 6163 636f 7264 696e 6720 746f 206c  r according to l
-00083f70: 6f63 6174 696f 6e0a 2020 2020 635f 706f  ocation.    c_po
-00083f80: 7320 3d20 6e70 2e61 7272 6179 2863 5f70  s = np.array(c_p
-00083f90: 6f73 290a 2020 2020 6f64 7220 3d20 635f  os).    odr = c_
-00083fa0: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
-00083fb0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00083fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083fe0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00083ff0: 2323 2055 7365 206f 6666 7365 745f 6669  ## Use offset_fi
-00084000: 6e64 6572 2074 6f20 636f 7272 6563 7420  nder to correct 
-00084010: 706f 7369 7469 6f6e 7320 696e 2047 5446  positions in GTF
-00084020: 2065 6e74 7269 6573 0a20 2020 2023 2320   entries.    ## 
-00084030: 616c 736f 2067 6574 2072 676e 7320 6672  also get rgns fr
-00084040: 6167 6d65 6e74 7320 7768 656e 2073 706c  agments when spl
-00084050: 6974 2069 7320 7265 7175 6972 6564 0a0a  it is required..
-00084060: 2020 2020 635f 746f 5f61 6464 203d 205b      c_to_add = [
-00084070: 5d0a 2020 2020 706f 735f 746f 5f61 6464  ].    pos_to_add
-00084080: 203d 205b 5d0a 0a20 2020 2070 7265 765f   = []..    prev_
-00084090: 6f66 6920 3d20 300a 2020 2020 2320 666f  ofi = 0.    # fo
-000840a0: 7220 6b2c 2072 2069 6e20 656e 756d 6572  r k, r in enumer
-000840b0: 6174 6528 6361 6c6c 2e72 676e 7329 3a0a  ate(call.rgns):.
-000840c0: 2020 2020 666f 7220 6d2c 206b 2069 6e20      for m, k in 
-000840d0: 656e 756d 6572 6174 6528 6f64 7229 3a0a  enumerate(odr):.
-000840e0: 2020 2020 2020 2020 7220 3d20 6361 6c6c          r = call
-000840f0: 2e72 676e 735b 6b5d 0a20 2020 2020 2020  .rgns[k].       
-00084100: 200a 2020 2020 2020 2020 2320 6f73 7320   .        # oss 
-00084110: 3d20 6f66 2e66 696e 645f 6f73 2872 2e73  = of.find_os(r.s
-00084120: 7461 7274 290a 2020 2020 2020 2020 2320  tart).        # 
-00084130: 6f73 6520 3d20 6f66 2e66 696e 645f 6f73  ose = of.find_os
-00084140: 2872 2e65 6e64 290a 2020 2020 2020 2020  (r.end).        
-00084150: 6f73 732c 2070 7265 765f 6f66 3120 3d20  oss, prev_of1 = 
-00084160: 6f66 2e66 696e 645f 6f73 5f73 6571 2872  of.find_os_seq(r
-00084170: 2e73 7461 7274 2c20 7072 6576 5f6f 6669  .start, prev_ofi
-00084180: 2c20 6d61 726b 203d 2027 4227 290a 2020  , mark = 'B').  
-00084190: 2020 2020 2020 6f73 652c 2070 7265 765f        ose, prev_
-000841a0: 6f66 3220 3d20 6f66 2e66 696e 645f 6f73  of2 = of.find_os
-000841b0: 5f73 6571 2872 2e65 6e64 2c20 7072 6576  _seq(r.end, prev
-000841c0: 5f6f 6669 2c20 6d61 726b 203d 2027 4327  _ofi, mark = 'C'
-000841d0: 290a 2020 2020 2020 2020 7072 6576 5f6f  ).        prev_o
-000841e0: 6669 203d 2070 7265 765f 6f66 310a 0a20  fi = prev_of1.. 
-000841f0: 2020 2020 2020 2069 6620 2872 2e74 7970         if (r.typ
-00084200: 652e 6c6f 7765 7228 2920 3d3d 2027 7374  e.lower() == 'st
-00084210: 6172 745f 636f 646f 6e27 2920 7c20 2872  art_codon') | (r
-00084220: 2e74 7970 652e 6c6f 7765 7228 2920 3d3d  .type.lower() ==
-00084230: 2027 7374 6f70 5f63 6f64 6f6e 2729 3a0a   'stop_codon'):.
-00084240: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
-00084250: 6172 7420 2b3d 206f 7373 0a20 2020 2020  art += oss.     
-00084260: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
-00084270: 6f73 7320 2020 0a20 2020 2020 2020 2020  oss   .         
-00084280: 2020 2063 616c 6c2e 7267 6e73 5b6b 5d20     call.rgns[k] 
-00084290: 3d20 722e 636f 7079 2875 7064 6174 653d  = r.copy(update=
-000842a0: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
-000842b0: 656c 7365 3a20 2023 2043 4453 2c20 6669  else:  # CDS, fi
-000842c0: 7665 5f70 7269 6d65 5f75 7472 2c20 7468  ve_prime_utr, th
-000842d0: 7265 655f 7072 696d 655f 7574 722c 202e  ree_prime_utr, .
-000842e0: 2e2e 0a20 2020 2020 2020 2020 2020 2069  ...            i
-000842f0: 6620 286f 7373 203d 3d20 6f73 6529 3a0a  f (oss == ose):.
-00084300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084310: 722e 7374 6172 7420 2b3d 206f 7373 0a20  r.start += oss. 
-00084320: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00084330: 2e65 6e64 202b 3d20 6f73 650a 2020 2020  .end += ose.    
-00084340: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00084350: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
-00084360: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
-00084370: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00084380: 6620 286f 7373 203c 206f 7365 293a 2023  f (oss < ose): #
-00084390: 2049 6e73 6572 7369 6f6e 206f 7220 6465   Insersion or de
-000843a0: 6c65 7469 6f6e 2069 6e20 6265 7477 6565  letion in betwee
-000843b0: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
-000843c0: 2020 2023 2070 7269 6e74 2827 2020 2025     # print('   %
-000843d0: 6920 6f73 7320 3c20 6f73 6527 2025 206b  i oss < ose' % k
-000843e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000843f0: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
-00084400: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
-00084410: 2872 2e65 6e64 2c20 7072 6576 5f6f 6669  (r.end, prev_ofi
-00084420: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00084430: 2020 2023 2320 7370 6c69 740a 2020 2020     ## split.    
-00084440: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
-00084450: 6e65 7720 3d20 7265 6769 6f6e 2820 722e  new = region( r.
-00084460: 6368 722c 2070 2b6f 7365 2c20 722e 656e  chr, p+ose, r.en
-00084470: 642b 6f73 652c 2072 2e74 7970 652c 2078  d+ose, r.type, x
-00084480: 7320 3d20 722e 7873 290a 2020 2020 2020  s = r.xs).      
-00084490: 2020 2020 2020 2020 2020 635f 746f 5f61            c_to_a
-000844a0: 6464 2e61 7070 656e 6428 7267 6e5f 6e65  dd.append(rgn_ne
-000844b0: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
-000844c0: 2020 2070 6f73 5f74 6f5f 6164 642e 6170     pos_to_add.ap
-000844d0: 7065 6e64 286b 2b31 290a 0a20 2020 2020  pend(k+1)..     
-000844e0: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
-000844f0: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
-00084500: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
-00084510: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
-00084520: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
-00084530: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
-00084540: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
-00084550: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00084560: 286f 7373 203e 206f 7365 293a 2023 2064  (oss > ose): # d
-00084570: 656c 6574 696f 6e20 696e 2062 6574 7765  eletion in betwe
-00084580: 656e 0a0a 2020 2020 2020 2020 2020 2020  en..            
-00084590: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
-000845a0: 2569 206f 7373 203e 206f 7365 2720 2520  %i oss > ose' % 
-000845b0: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
-000845c0: 2020 2070 2c20 7072 6576 5f6f 6632 203d     p, prev_of2 =
-000845d0: 206f 662e 6765 745f 626e 6472 795f 7365   of.get_bndry_se
-000845e0: 7128 722e 656e 642c 2070 7265 765f 6f66  q(r.end, prev_of
-000845f0: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
-00084600: 2020 204c 6420 3d20 6f73 7320 2d20 6f73     Ld = oss - os
-00084610: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00084620: 2020 2023 2320 7370 6c69 7420 2866 6f72     ## split (for
-00084630: 2043 4453 206f 6e6c 7929 0a20 2020 2020   CDS only).     
-00084640: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
-00084650: 6577 203d 2072 6567 696f 6e28 2072 2e63  ew = region( r.c
-00084660: 6872 2c20 702b 4c64 2b6f 7365 2c20 722e  hr, p+Ld+ose, r.
-00084670: 656e 642b 6f73 652c 2072 2e74 7970 652c  end+ose, r.type,
-00084680: 2078 7320 3d20 722e 7873 290a 2020 2020   xs = r.xs).    
-00084690: 2020 2020 2020 2020 2020 2020 635f 746f              c_to
-000846a0: 5f61 6464 2e61 7070 656e 6428 7267 6e5f  _add.append(rgn_
-000846b0: 6e65 7729 0a20 2020 2020 2020 2020 2020  new).           
-000846c0: 2020 2020 2070 6f73 5f74 6f5f 6164 642e       pos_to_add.
-000846d0: 6170 7065 6e64 286b 2b31 290a 0a20 2020  append(k+1)..   
-000846e0: 2020 2020 2020 2020 2020 2020 2072 2e65               r.e
-000846f0: 6e64 203d 2070 2d31 2b6f 7373 0a20 2020  nd = p-1+oss.   
-00084700: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
-00084710: 7461 7274 202b 3d20 6f73 730a 2020 2020  tart += oss.    
-00084720: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00084730: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
-00084740: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
-00084750: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
-00084760: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00084770: 2020 2020 2323 2070 7574 2072 676e 7320      ## put rgns 
-00084780: 6261 636b 2074 6f20 6764 5f73 656c 0a20  back to gd_sel. 
-00084790: 2020 2023 2320 616e 6420 616c 736f 2061     ## and also a
-000847a0: 6464 206e 6577 2072 676e 7320 0a0a 2020  dd new rgns ..  
-000847b0: 2020 706f 735f 746f 5f61 6464 203d 206e    pos_to_add = n
-000847c0: 702e 6172 7261 7928 706f 735f 746f 5f61  p.array(pos_to_a
-000847d0: 6464 290a 2020 2020 666f 7220 6b2c 2067  dd).    for k, g
-000847e0: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
-000847f0: 645f 7365 6c29 3a20 0a0a 2020 2020 2020  d_sel): ..      
-00084800: 2020 7031 203d 2069 6e74 286c 6f63 5f6f    p1 = int(loc_o
-00084810: 735b 6b5d 290a 2020 2020 2020 2020 7032  s[k]).        p2
-00084820: 203d 2069 6e74 2870 3120 2b20 6e75 6d5f   = int(p1 + num_
-00084830: 6f73 5b6b 5d29 0a20 2020 2020 2020 2067  os[k]).        g
-00084840: 642e 6364 732e 7267 6e73 203d 205b 6361  d.cds.rgns = [ca
-00084850: 6c6c 2e72 676e 735b 7031 2b6d 5d20 666f  ll.rgns[p1+m] fo
-00084860: 7220 6d20 696e 2072 616e 6765 2870 322d  r m in range(p2-
-00084870: 7031 295d 0a20 2020 2020 2020 2077 6820  p1)].        wh 
-00084880: 3d20 7768 6963 6828 2028 706f 735f 746f  = which( (pos_to
-00084890: 5f61 6464 203e 3d20 7031 2920 2620 2870  _add >= p1) & (p
-000848a0: 6f73 5f74 6f5f 6164 6420 3c20 7032 2920  os_to_add < p2) 
-000848b0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-000848c0: 2877 6829 203e 2030 3a0a 2020 2020 2020  (wh) > 0:.      
-000848d0: 2020 2020 2020 666f 7220 7720 696e 2077        for w in w
-000848e0: 683a 2067 642e 6364 732e 7267 6e73 2e61  h: gd.cds.rgns.a
-000848f0: 7070 656e 6428 635f 746f 5f61 6464 5b77  ppend(c_to_add[w
-00084900: 5d29 0a0a 2020 2020 656c 6170 7365 645f  ])..    elapsed_
-00084910: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-00084920: 2829 202d 2073 7461 7274 5f74 696d 650a  () - start_time.
-00084930: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
-00084940: 342e 2064 6f6e 6520 2825 6929 2020 2720  4. done (%i)  ' 
-00084950: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
-00084960: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-00084970: 2020 2020 0a20 2020 2023 2323 2323 2323      .    #######
-00084980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00084990: 230a 2020 2020 2323 2063 6f64 696e 6720  #.    ## coding 
-000849a0: 7265 6769 6f6e 2075 7064 6174 650a 2020  region update.  
-000849b0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-000849c0: 2323 2323 2323 2323 2323 0a0a 2020 2020  ##########..    
-000849d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000849e0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
-000849f0: 496e 7465 6772 6974 7920 6368 6563 6b0a  Integrity check.
-00084a00: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
-00084a10: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-00084a20: 290a 2020 2020 6e5f 6261 7365 735f 746f  ).    n_bases_to
-00084a30: 7461 6c20 3d20 300a 2020 2020 6e5f 6572  tal = 0.    n_er
-00084a40: 5f62 6173 6573 203d 2030 0a20 2020 206e  _bases = 0.    n
-00084a50: 5f62 6c6b 5f74 6f74 616c 203d 2030 0a20  _blk_total = 0. 
-00084a60: 2020 206e 5f65 725f 626c 6b20 3d20 300a     n_er_blk = 0.
-00084a70: 2020 2020 6e70 6520 3d20 300a 2020 2020      npe = 0.    
-00084a80: 6e70 7420 3d20 300a 2020 2020 666f 7220  npt = 0.    for 
-00084a90: 6764 2069 6e20 6764 5f73 656c 3a0a 2020  gd in gd_sel:.  
-00084aa0: 2020 2020 2020 666f 7220 7220 696e 2067        for r in g
-00084ab0: 642e 6578 6f6e 732e 7267 6e73 3a0a 2020  d.exons.rgns:.  
-00084ac0: 2020 2020 2020 2020 2020 6966 2072 2e74            if r.t
-00084ad0: 7970 6520 213d 2027 6465 6c65 7469 6f6e  ype != 'deletion
-00084ae0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00084af0: 2020 2073 3120 3d20 722e 7365 710a 2020     s1 = r.seq.  
-00084b00: 2020 2020 2020 2020 2020 2020 2020 7332                s2
-00084b10: 203d 2073 6571 5f6e 6577 5b28 722e 7374   = seq_new[(r.st
-00084b20: 6172 742d 3129 3a72 2e65 6e64 5d20 2320  art-1):r.end] # 
-00084b30: 6765 6e6f 6d65 5b72 2e63 6872 5d2e 7365  genome[r.chr].se
-00084b40: 715b 2872 2e73 7461 7274 2d31 293a 722e  q[(r.start-1):r.
-00084b50: 656e 645d 0a20 2020 2020 2020 2020 2020  end].           
-00084b60: 2020 2020 206e 5f65 7220 3d20 636f 6d70       n_er = comp
-00084b70: 6172 655f 7365 7132 2820 7331 2c20 7332  are_seq2( s1, s2
-00084b80: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00084b90: 2020 2023 2069 6620 6e5f 6572 203e 2030     # if n_er > 0
-00084ba0: 3a20 7072 696e 7428 275c 6e53 313a 2025  : print('\nS1: %
-00084bb0: 735c 6e53 323a 2025 7327 2025 2028 7331  s\nS2: %s' % (s1
-00084bc0: 2c73 3229 290a 2020 2020 2020 2020 2020  ,s2)).          
-00084bd0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00084be0: 2020 2020 2020 2020 2020 206e 5f62 6173             n_bas
-00084bf0: 6573 5f74 6f74 616c 202b 3d20 6c65 6e28  es_total += len(
-00084c00: 7331 290a 2020 2020 2020 2020 2020 2020  s1).            
-00084c10: 2020 2020 6e5f 6572 5f62 6173 6573 202b      n_er_bases +
-00084c20: 3d20 6e5f 6572 0a20 2020 2020 2020 2020  = n_er.         
-00084c30: 2020 2020 2020 206e 5f62 6c6b 5f74 6f74         n_blk_tot
-00084c40: 616c 202b 3d20 310a 2020 2020 2020 2020  al += 1.        
-00084c50: 2020 2020 2020 2020 6966 206e 5f65 7220          if n_er 
-00084c60: 3e20 303a 206e 5f65 725f 626c 6b20 2b3d  > 0: n_er_blk +=
-00084c70: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00084c80: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00084c90: 6e74 722c 206e 7072 2c20 6e65 7220 3d20  ntr, npr, ner = 
-00084ca0: 6764 2e75 7064 6174 655f 7464 5f69 6e66  gd.update_td_inf
-00084cb0: 6f28 7365 6c20 3d20 312c 2070 6570 7469  o(sel = 1, pepti
-00084cc0: 6465 203d 2054 7275 6529 0a20 2020 2020  de = True).     
-00084cd0: 2020 206e 652c 206e 7420 3d20 6764 2e63     ne, nt = gd.c
-00084ce0: 6f6d 7061 7265 5f73 6571 735f 6672 6f6d  ompare_seqs_from
-00084cf0: 5f63 6473 5f61 6e64 5f67 656e 6f6d 6528  _cds_and_genome(
-00084d00: 7365 715f 6e65 7729 2023 2067 656e 6f6d  seq_new) # genom
-00084d10: 655b 6764 2e63 6872 5d2e 7365 7129 0a20  e[gd.chr].seq). 
-00084d20: 2020 2020 2020 206e 7065 202b 3d20 6e65         npe += ne
-00084d30: 0a20 2020 2020 2020 206e 7074 202b 3d20  .        npt += 
-00084d40: 6e74 0a0a 2020 2020 2020 2020 2320 6966  nt..        # if
-00084d50: 206e 6572 203e 2030 3a20 7072 696e 7428   ner > 0: print(
-00084d60: 2749 6e74 6567 7269 7479 2063 6865 636b  'Integrity check
-00084d70: 2065 7272 6f72 2041 2069 6e20 2573 3a20   error A in %s: 
-00084d80: 2569 202d 2025 692f 2569 2c20 2569 2f25  %i - %i/%i, %i/%
-00084d90: 692c 2025 692f 2569 2720 2520 2863 6872  i, %i/%i' % (chr
-00084da0: 6d2c 206e 6572 2c20 6e5f 6572 5f62 6173  m, ner, n_er_bas
-00084db0: 6573 2c20 6e5f 6261 7365 735f 746f 7461  es, n_bases_tota
-00084dc0: 6c2c 206e 5f65 725f 626c 6b2c 206e 5f62  l, n_er_blk, n_b
-00084dd0: 6c6b 5f74 6f74 616c 2c20 6e70 652c 206e  lk_total, npe, n
-00084de0: 7074 2920 290a 2020 2020 2020 2020 2320  pt) ).        # 
-00084df0: 6966 206e 5f65 7220 3e20 303a 2070 7269  if n_er > 0: pri
-00084e00: 6e74 2827 496e 7465 6772 6974 7920 6368  nt('Integrity ch
-00084e10: 6563 6b20 6572 726f 7220 696e 2025 733a  eck error in %s:
-00084e20: 2025 6920 2d20 2569 2f25 692c 2025 692f   %i - %i/%i, %i/
-00084e30: 2569 2c20 2569 2f25 6927 2025 2028 6368  %i, %i/%i' % (ch
-00084e40: 726d 2c20 6e5f 6572 2c20 6e5f 6572 5f62  rm, n_er, n_er_b
-00084e50: 6173 6573 2c20 6e5f 6261 7365 735f 746f  ases, n_bases_to
-00084e60: 7461 6c2c 206e 5f65 725f 626c 6b2c 206e  tal, n_er_blk, n
-00084e70: 5f62 6c6b 5f74 6f74 616c 2c20 6e70 652c  _blk_total, npe,
-00084e80: 206e 7074 2920 290a 0a20 2020 2065 6c61   npt) )..    ela
-00084e90: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
-00084ea0: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-00084eb0: 7469 6d65 0a20 2020 2023 2070 7269 6e74  time.    # print
-00084ec0: 2827 2020 2035 2e20 646f 6e65 2028 2569  ('   5. done (%i
-00084ed0: 2920 2027 2025 2028 656c 6170 7365 645f  )  ' % (elapsed_
-00084ee0: 7469 6d65 292c 2066 6c75 7368 203d 2054  time), flush = T
-00084ef0: 7275 6529 0a20 2020 200a 2020 2020 6573  rue).    .    es
-00084f00: 7461 7420 3d20 286e 5f62 6173 6573 5f74  tat = (n_bases_t
-00084f10: 6f74 616c 2c20 6e5f 6572 5f62 6173 6573  otal, n_er_bases
-00084f20: 2c20 6e5f 626c 6b5f 746f 7461 6c2c 206e  , n_blk_total, n
-00084f30: 5f65 725f 626c 6b2c 206e 7074 2c20 6e70  _er_blk, npt, np
-00084f40: 6529 0a20 2020 200a 2020 2020 7265 7475  e).    .    retu
-00084f50: 726e 2067 645f 7365 6c2c 2073 6571 5f6e  rn gd_sel, seq_n
-00084f60: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
-00084f70: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
-00084f80: 740a 0a27 2727 0a4e 565f 696e 666f 5f65  t..'''.NV_info_e
-00084f90: 7874 5f74 7220 3d20 636f 6c6c 6563 7469  xt_tr = collecti
-00084fa0: 6f6e 732e 6e61 6d65 6474 7570 6c65 2827  ons.namedtuple('
-00084fb0: 4e56 5f69 6e66 6f5f 6578 745f 7472 272c  NV_info_ext_tr',
-00084fc0: 2027 6368 722c 2070 6f73 5f72 6566 2c20   'chr, pos_ref, 
-00084fd0: 706f 735f 6e65 772c 2067 656e 655f 6964  pos_new, gene_id
-00084fe0: 2c20 6765 6e65 5f6e 616d 652c 2076 5f74  , gene_name, v_t
-00084ff0: 7970 652c 2076 5f6c 656e 2c20 6376 675f  ype, v_len, cvg_
-00085000: 6465 7074 682c 2063 7667 5f66 7261 632c  depth, cvg_frac,
-00085010: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00085020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085030: 2020 2020 2072 6566 5f70 7265 762c 2072       ref_prev, r
-00085040: 6566 5f73 6571 2c20 7265 665f 6e65 7874  ef_seq, ref_next
-00085050: 2c20 616c 745f 7072 6576 2c20 616c 745f  , alt_prev, alt_
-00085060: 7365 712c 2061 6c74 5f6e 6578 742c 2076  seq, alt_next, v
-00085070: 5f63 6c61 7373 2c20 5c0a 2020 2020 2020  _class, \.      
-00085080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085090: 2020 2020 2020 2020 2020 2020 765f 636c              v_cl
-000850a0: 6173 735f 7472 2c20 7374 7261 6e64 2c20  ass_tr, strand, 
-000850b0: 6344 4e41 5f63 6861 6e67 652c 2043 6f64  cDNA_change, Cod
-000850c0: 6f6e 5f63 6861 6e67 652c 2050 726f 7465  on_change, Prote
-000850d0: 696e 5f63 6861 6e67 652c 2050 726f 7465  in_change, Prote
-000850e0: 696e 5f63 6861 6e67 6532 2c20 4368 6563  in_change2, Chec
-000850f0: 6b27 2920 2023 206f 6e65 2d62 6173 650a  k')  # one-base.
-00085100: 0a64 6566 2077 7269 7465 5f74 6f5f 7663  .def write_to_vc
-00085110: 6628 2073 6e76 5f69 6e66 6f5f 6c73 742c  f( snv_info_lst,
-00085120: 2066 696c 655f 6e61 6d65 2029 3a0a 0a20   file_name ):.. 
-00085130: 2020 2069 6620 6c65 6e28 736e 765f 696e     if len(snv_in
-00085140: 666f 5f6c 7374 2920 3d3d 2030 3a0a 2020  fo_lst) == 0:.  
-00085150: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00085160: 200a 2020 2020 6966 206c 656e 2873 6e76   .    if len(snv
-00085170: 5f69 6e66 6f5f 6c73 745b 305d 2920 3c3d  _info_lst[0]) <=
-00085180: 2032 303a 0a20 2020 2020 2020 2070 6173   20:.        pas
-00085190: 730a 2020 2020 656c 7365 3a0a 2020 2020  s.    else:.    
-000851a0: 2020 2020 6620 3d20 6f70 656e 2820 666e      f = open( fn
-000851b0: 616d 655f 7663 662c 2027 7774 2b27 2029  ame_vcf, 'wt+' )
-000851c0: 0a0a 2020 2020 2020 2020 6c69 6e65 7320  ..        lines 
-000851d0: 3d20 5b27 2343 4852 4f4d 5c74 504f 535c  = ['#CHROM\tPOS\
-000851e0: 7449 445c 7452 4546 5c74 414c 545c 7451  tID\tREF\tALT\tQ
-000851f0: 5541 4c5c 7446 494c 5445 525c 7449 4e46  UAL\tFILTER\tINF
-00085200: 4f27 5d0a 2020 2020 2020 2020 666f 7220  O'].        for 
-00085210: 6e69 2069 6e20 736e 765f 696e 666f 5f6c  ni in snv_info_l
-00085220: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00085230: 6d69 6420 3d0a 2020 2020 2020 2020 2020  mid =.          
-00085240: 2020 5175 616c 203d 0a20 2020 2020 2020    Qual =.       
-00085250: 2020 2020 2046 696c 7465 7220 3d0a 2020       Filter =.  
-00085260: 2020 2020 2020 2020 2020 696e 666f 203d            info =
-00085270: 2027 4143 3d25 693b 4146 270a 2020 2020   'AC=%i;AF'.    
-00085280: 2020 2020 2020 2020 2725 735c 7425 695c          '%s\t%i\
-00085290: 7425 735c 7425 735c 7425 735c 7425 695c  t%s\t%s\t%s\t%i\
-000852a0: 7425 735c 7425 735c 6e27 2025 2028 6e69  t%s\t%s\n' % (ni
-000852b0: 2e63 6872 2c20 6e69 2e70 6f73 5f72 6566  .chr, ni.pos_ref
-000852c0: 2c20 6d69 642c 206e 692e 7265 665f 7365  , mid, ni.ref_se
-000852d0: 712c 206e 692e 616c 745f 7365 712c 2051  q, ni.alt_seq, Q
-000852e0: 7561 6c2c 2069 6e66 6f29 0a0a 2020 2020  ual, info)..    
-000852f0: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
-00085300: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-00085310: 6e0a 2727 270a 0a64 6566 206d 635f 636f  n.'''..def mc_co
-00085320: 7265 5f67 6574 5f67 7466 5f61 6e64 5f66  re_get_gtf_and_f
-00085330: 6173 7461 5f70 7428 6764 293a 0a20 2020  asta_pt(gd):.   
-00085340: 200a 2020 2020 6e74 722c 206e 7072 2c20   .    ntr, npr, 
-00085350: 6e65 7220 3d20 6764 2e75 7064 6174 655f  ner = gd.update_
-00085360: 7464 5f69 6e66 6f28 7365 6c20 3d20 312c  td_info(sel = 1,
-00085370: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
-00085380: 0a20 2020 2067 7466 5f6c 696e 652c 2063  .    gtf_line, c
-00085390: 6e20 3d20 6764 2e67 6574 5f67 7466 5f6c  n = gd.get_gtf_l
-000853a0: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
-000853b0: 7365 6c20 3d20 312c 2061 6464 5f73 6571  sel = 1, add_seq
-000853c0: 203d 2046 616c 7365 2c20 636f 6e6e 6563   = False, connec
-000853d0: 7420 3d20 5472 7565 290a 2020 2020 6c74  t = True).    lt
-000853e0: 2c20 6c70 203d 2067 642e 6765 745f 6661  , lp = gd.get_fa
-000853f0: 7374 615f 6c69 6e65 735f 6672 6f6d 5f65  sta_lines_from_e
-00085400: 786f 6e73 2873 656c 203d 2031 2c20 7065  xons(sel = 1, pe
-00085410: 7074 6964 6520 3d20 5472 7565 290a 2020  ptide = True).  
-00085420: 2020 7265 7475 726e 2067 7466 5f6c 696e    return gtf_lin
-00085430: 652c 206c 742c 206c 702c 2067 642e 6368  e, lt, lp, gd.ch
-00085440: 722c 206e 6572 2c20 636e 0a0a 0a27 2727  r, ner, cn...'''
-00085450: 0a4e 565f 696e 666f 5f65 7874 5f74 7220  .NV_info_ext_tr 
-00085460: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
-00085470: 6d65 6474 7570 6c65 2827 4e56 5f69 6e66  medtuple('NV_inf
-00085480: 6f5f 6578 745f 7472 272c 2027 6368 722c  o_ext_tr', 'chr,
-00085490: 2070 6f73 5f72 6566 2c20 706f 735f 6e65   pos_ref, pos_ne
-000854a0: 772c 2067 656e 655f 6964 2c20 6765 6e65  w, gene_id, gene
-000854b0: 5f6e 616d 652c 2076 5f74 7970 652c 2076  _name, v_type, v
-000854c0: 5f6c 656e 2c20 6376 675f 6465 7074 682c  _len, cvg_depth,
-000854d0: 2063 7667 5f66 7261 632c 205c 0a20 2020   cvg_frac, \.   
-000854e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000854f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00085500: 6566 5f70 7265 762c 2072 6566 5f73 6571  ef_prev, ref_seq
-00085510: 2c20 7265 665f 6e65 7874 2c20 616c 745f  , ref_next, alt_
-00085520: 7072 6576 2c20 616c 745f 7365 712c 2061  prev, alt_seq, a
-00085530: 6c74 5f6e 6578 742c 2076 5f63 6c61 7373  lt_next, v_class
-00085540: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00085550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085560: 2020 2020 2020 765f 636c 6173 735f 7472        v_class_tr
-00085570: 2c20 7374 7261 6e64 2c20 6344 4e41 5f63  , strand, cDNA_c
-00085580: 6861 6e67 652c 2043 6f64 6f6e 5f63 6861  hange, Codon_cha
-00085590: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
-000855a0: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
-000855b0: 6e67 6532 2729 2023 2c20 4368 6563 6b27  nge2') #, Check'
-000855c0: 2920 2023 206f 6e65 2d62 6173 650a 2727  )  # one-base.''
-000855d0: 270a 0a4e 565f 696e 666f 5f74 7220 3d20  '..NV_info_tr = 
-000855e0: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
-000855f0: 6474 7570 6c65 2827 4e56 5f69 6e66 6f5f  dtuple('NV_info_
-00085600: 6578 745f 7472 272c 2027 6368 722c 2070  ext_tr', 'chr, p
-00085610: 6f73 5f72 6566 2c20 6765 6e65 5f6e 616d  os_ref, gene_nam
-00085620: 652c 2067 656e 655f 6964 2c20 765f 7479  e, gene_id, v_ty
-00085630: 7065 2c20 765f 6c65 6e2c 205c 0a20 2020  pe, v_len, \.   
-00085640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085650: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00085660: 7667 5f64 6570 7468 2c20 6376 675f 6672  vg_depth, cvg_fr
-00085670: 6163 2c20 7265 665f 7365 712c 2061 6c74  ac, ref_seq, alt
-00085680: 5f73 6571 2c20 5c0a 2020 2020 2020 2020  _seq, \.        
-00085690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000856a0: 2020 2020 2020 2020 2020 7374 7261 6e64            strand
-000856b0: 2c20 6344 4e41 5f63 6861 6e67 652c 2043  , cDNA_change, C
-000856c0: 6f64 6f6e 5f63 6861 6e67 652c 2050 726f  odon_change, Pro
-000856d0: 7465 696e 5f63 6861 6e67 652c 2050 726f  tein_change, Pro
-000856e0: 7465 696e 5f63 6861 6e67 6532 2c20 765f  tein_change2, v_
-000856f0: 636c 6173 7327 2920 0a0a 6465 6620 746f  class') ..def to
-00085700: 5f6e 765f 7369 6d70 6c65 2820 6e76 2029  _nv_simple( nv )
-00085710: 3a0a 0a20 2020 206e 7669 203d 204e 565f  :..    nvi = NV_
-00085720: 696e 666f 5f74 7228 206e 762e 6368 722c  info_tr( nv.chr,
-00085730: 206e 762e 706f 735f 7265 662c 206e 762e   nv.pos_ref, nv.
-00085740: 6765 6e65 5f6e 616d 652c 206e 762e 6765  gene_name, nv.ge
-00085750: 6e65 5f69 642c 206e 762e 765f 7479 7065  ne_id, nv.v_type
-00085760: 2c20 6e76 2e76 5f6c 656e 2c20 5c0a 2020  , nv.v_len, \.  
-00085770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085780: 2020 2020 2020 2020 2020 2020 2020 6e76                nv
-00085790: 2e63 7667 5f64 6570 7468 2c20 6e76 2e63  .cvg_depth, nv.c
-000857a0: 7667 5f66 7261 632c 206e 762e 7265 665f  vg_frac, nv.ref_
-000857b0: 7365 712c 206e 762e 616c 745f 7365 712c  seq, nv.alt_seq,
-000857c0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-000857d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000857e0: 2020 206e 762e 7374 7261 6e64 2c20 6e76     nv.strand, nv
-000857f0: 2e63 444e 415f 6368 616e 6765 2c20 6e76  .cDNA_change, nv
-00085800: 2e43 6f64 6f6e 5f63 6861 6e67 652c 205c  .Codon_change, \
-00085810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00085820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085830: 206e 762e 5072 6f74 6569 6e5f 6368 616e   nv.Protein_chan
-00085840: 6765 2c20 6e76 2e50 726f 7465 696e 5f63  ge, nv.Protein_c
-00085850: 6861 6e67 6532 2c20 6e76 2e76 5f63 6c61  hange2, nv.v_cla
-00085860: 7373 5f74 7220 290a 2020 2020 7265 7475  ss_tr ).    retu
-00085870: 726e 206e 7669 0a0a 6465 6620 5374 7269  rn nvi..def Stri
-00085880: 6e67 4669 785f 7379 6e74 6865 7369 7328  ngFix_synthesis(
-00085890: 6774 665f 6669 6c65 2c20 6765 6e6f 6d65  gtf_file, genome
-000858a0: 5f66 696c 652c 2072 6576 203d 2054 7275  _file, rev = Tru
-000858b0: 652c 206e 5f63 6f72 6573 203d 2031 2c20  e, n_cores = 1, 
-000858c0: 6f75 745f 6469 7220 3d20 4e6f 6e65 2c20  out_dir = None, 
-000858d0: 6764 7320 3d20 4e6f 6e65 293a 0a0a 2020  gds = None):..  
-000858e0: 2020 2320 7072 696e 7428 2753 7472 696e    # print('Strin
-000858f0: 6746 6978 5f73 796e 7468 6573 6973 2073  gFix_synthesis s
-00085900: 7461 7274 6564 2027 2c20 6461 7465 7469  tarted ', dateti
-00085910: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
-00085920: 2929 0a20 2020 200a 2020 2020 6966 2069  )).    .    if i
-00085930: 7369 6e73 7461 6e63 6528 6765 6e6f 6d65  sinstance(genome
-00085940: 5f66 696c 652c 2073 7472 293a 0a20 2020  _file, str):.   
-00085950: 2020 2020 2067 656e 6f6d 6520 3d20 6c6f       genome = lo
-00085960: 6164 5f67 656e 6f6d 6528 6765 6e6f 6d65  ad_genome(genome
-00085970: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
-00085980: 2054 7275 6529 0a20 2020 2065 6c73 653a   True).    else:
-00085990: 0a20 2020 2020 2020 2067 656e 6f6d 6520  .        genome 
-000859a0: 3d20 6765 6e6f 6d65 5f66 696c 650a 0a20  = genome_file.. 
-000859b0: 2020 2069 6620 6764 7320 6973 204e 6f6e     if gds is Non
-000859c0: 653a 0a20 2020 2020 2020 2067 7466 5f6c  e:.        gtf_l
-000859d0: 696e 6573 2c20 6864 725f 6c69 6e65 7320  ines, hdr_lines 
-000859e0: 3d20 6c6f 6164 5f67 7466 2867 7466 5f66  = load_gtf(gtf_f
-000859f0: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
-00085a00: 7275 6529 0a20 2020 2020 2020 2067 645f  rue).        gd_
-00085a10: 6c73 742c 2063 6872 7320 3d20 6765 745f  lst, chrs = get_
-00085a20: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
-00085a30: 6774 665f 6c69 6e65 732c 2067 656e 6f6d  gtf_lines, genom
-00085a40: 6520 3d20 4e6f 6e65 2c20 6669 6c6c 203d  e = None, fill =
-00085a50: 2054 7275 652c 205c 0a20 2020 2020 2020   True, \.       
-00085a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085a80: 2020 2020 2020 2020 6367 203d 2054 7275          cg = Tru
-00085a90: 652c 2076 6572 626f 7365 203d 2054 7275  e, verbose = Tru
-00085aa0: 652c 206e 5f63 6f72 6573 203d 2031 290a  e, n_cores = 1).
-00085ab0: 2020 2020 2020 2020 6764 5f6c 7374 732c          gd_lsts,
-00085ac0: 2063 6872 5f6c 7374 203d 2070 6163 6b5f   chr_lst = pack_
-00085ad0: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
-00085ae0: 2067 645f 6c73 742c 2063 6872 7320 290a   gd_lst, chrs ).
-00085af0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00085b00: 2066 6f72 2067 646c 2069 6e20 6764 5f6c   for gdl in gd_l
-00085b10: 7374 733a 200a 2020 2020 2020 2020 2020  sts: .          
-00085b20: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
-00085b30: 6e75 6d65 7261 7465 2867 646c 293a 0a20  numerate(gdl):. 
-00085b40: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00085b50: 642e 7365 745f 636f 765f 6e5f 6162 6e5f  d.set_cov_n_abn_
-00085b60: 7468 2820 4d49 4e5f 434f 565f 544f 5f53  th( MIN_COV_TO_S
-00085b70: 454c 2c20 4d49 4e5f 4142 4e5f 544f 5f53  EL, MIN_ABN_TO_S
-00085b80: 454c 2029 0a0a 2020 2020 2020 2020 6e74  EL )..        nt
-00085b90: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
-00085ba0: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
-00085bb0: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
-00085bc0: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
-00085bd0: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
-00085be0: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
-00085bf0: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
-00085c00: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
-00085c10: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
-00085c20: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00085c30: 725f 6c73 745f 6e65 772e 6170 7065 6e64  r_lst_new.append
-00085c40: 2863 6872 6d29 0a20 2020 2020 2020 2020  (chrm).         
-00085c50: 2020 2020 2020 2067 6763 5f74 7570 6c65         ggc_tuple
-00085c60: 2e61 7070 656e 6428 2028 6764 5f6c 7374  .append( (gd_lst
-00085c70: 735b 6b6b 5d2c 2067 656e 6f6d 655b 6368  s[kk], genome[ch
-00085c80: 726d 5d2e 7365 712c 2063 6872 6d29 2029  rm].seq, chrm) )
-00085c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00085ca0: 2066 6f72 2067 6420 696e 2067 645f 6c73   for gd in gd_ls
-00085cb0: 7473 5b6b 6b5d 3a0a 2020 2020 2020 2020  ts[kk]:.        
-00085cc0: 2020 2020 2020 2020 2020 2020 6e74 725f              ntr_
-00085cd0: 7661 6c69 6420 2b3d 2067 642e 6e74 720a  valid += gd.ntr.
-00085ce0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-00085cf0: 274e 5f74 7273 2076 616c 6964 203d 2025  'N_trs valid = %
-00085d00: 6927 2025 206e 7472 5f76 616c 6964 290a  i' % ntr_valid).
-00085d10: 2020 2020 2020 2020 6465 6c20 6764 5f6c          del gd_l
-00085d20: 7374 730a 0a20 2020 2065 6c73 653a 0a20  sts..    else:. 
-00085d30: 2020 2020 2020 2067 7466 5f6c 696e 6573         gtf_lines
-00085d40: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
-00085d50: 6164 5f67 7466 2867 7466 5f66 696c 652c  ad_gtf(gtf_file,
-00085d60: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
-00085d70: 2c20 686f 203d 2054 7275 6529 0a0a 2020  , ho = True)..  
-00085d80: 2020 2020 2020 666d 203d 207b 274d 273a        fm = {'M':
-00085d90: 2027 6578 6f6e 272c 2027 4927 3a20 2769   'exon', 'I': 'i
-00085da0: 6e73 6572 7369 6f6e 272c 2027 4427 3a20  nsersion', 'D': 
-00085db0: 2764 656c 6574 696f 6e27 7d0a 2020 2020  'deletion'}.    
-00085dc0: 2020 2020 666f 7220 6d2c 2067 6420 696e      for m, gd in
-00085dd0: 2065 6e75 6d65 7261 7465 2867 6473 293a   enumerate(gds):
-00085de0: 0a20 2020 2020 2020 2020 2020 2067 642e  .            gd.
-00085df0: 7365 745f 636f 765f 6e5f 6162 6e5f 7468  set_cov_n_abn_th
-00085e00: 2820 4d49 4e5f 434f 565f 544f 5f53 454c  ( MIN_COV_TO_SEL
-00085e10: 2c20 4d49 4e5f 4142 4e5f 544f 5f53 454c  , MIN_ABN_TO_SEL
-00085e20: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
-00085e30: 6620 286c 656e 2867 642e 7267 6e73 2e72  f (len(gd.rgns.r
-00085e40: 676e 7329 203e 2030 293a 0a20 2020 2020  gns) > 0):.     
-00085e50: 2020 2020 2020 2020 2020 2067 642e 6578             gd.ex
-00085e60: 6f6e 732e 7267 6e73 2c20 6764 2e72 676e  ons.rgns, gd.rgn
-00085e70: 732e 7267 6e73 203d 2067 642e 7267 6e73  s.rgns = gd.rgns
-00085e80: 2e72 676e 732c 2067 642e 6578 6f6e 732e  .rgns, gd.exons.
-00085e90: 7267 6e73 0a20 2020 2020 2020 2020 2020  rgns.           
-00085ea0: 2020 2020 2067 642e 7465 5f74 6f5f 6765       gd.te_to_ge
-00085eb0: 5f6d 6170 732c 2067 642e 7472 5f74 6f5f  _maps, gd.tr_to_
-00085ec0: 6772 5f6d 6170 7320 3d20 6764 2e74 725f  gr_maps = gd.tr_
-00085ed0: 746f 5f67 725f 6d61 7073 2c20 6764 2e74  to_gr_maps, gd.t
-00085ee0: 655f 746f 5f67 655f 6d61 7073 0a20 2020  e_to_ge_maps.   
-00085ef0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00085f00: 2020 2020 2020 2020 2020 666f 7220 7220            for r 
-00085f10: 696e 2067 642e 6578 6f6e 732e 7267 6e73  in gd.exons.rgns
-00085f20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00085f30: 2020 6966 2072 2e74 7970 6520 696e 2066    if r.type in f
-00085f40: 6d2e 6b65 7973 2829 3a0a 2020 2020 2020  m.keys():.      
-00085f50: 2020 2020 2020 2020 2020 2020 2020 722e                r.
-00085f60: 7479 7065 203d 2066 6d5b 722e 7479 7065  type = fm[r.type
-00085f70: 5d0a 0a20 2020 2020 2020 2063 6872 7320  ]..        chrs 
-00085f80: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-00085f90: 2067 6420 696e 2067 6473 3a20 0a20 2020   gd in gds: .   
-00085fa0: 2020 2020 2020 2020 2063 6872 732e 6170           chrs.ap
-00085fb0: 7065 6e64 2867 642e 6368 7229 0a0a 2020  pend(gd.chr)..  
-00085fc0: 2020 2020 2020 6368 725f 6c73 7420 3d20        chr_lst = 
-00085fd0: 6c69 7374 2873 6574 2863 6872 7329 290a  list(set(chrs)).
-00085fe0: 2020 2020 2020 2020 6368 725f 6c73 742e          chr_lst.
-00085ff0: 736f 7274 2829 0a20 2020 2020 2020 2063  sort().        c
-00086000: 6872 7320 3d20 6e70 2e61 7272 6179 2863  hrs = np.array(c
-00086010: 6872 7329 0a0a 2020 2020 2020 2020 6e74  hrs)..        nt
-00086020: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
-00086030: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
-00086040: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
-00086050: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
-00086060: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
-00086070: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
-00086080: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
-00086090: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
-000860a0: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
-000860b0: 2020 2020 2020 2020 2020 2020 2020 7768                wh
-000860c0: 203d 2077 6869 6368 2863 6872 7320 3d3d   = which(chrs ==
-000860d0: 2063 6872 6d29 0a20 2020 2020 2020 2020   chrm).         
-000860e0: 2020 2020 2020 2069 6620 6c65 6e28 7768         if len(wh
-000860f0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-00086100: 2020 2020 2020 2020 2020 2073 5f70 6f73             s_pos
-00086110: 203d 206e 702e 7a65 726f 7328 6c65 6e28   = np.zeros(len(
-00086120: 7768 292c 6474 7970 653d 6e70 2e66 6c6f  wh),dtype=np.flo
-00086130: 6174 3332 290a 2020 2020 2020 2020 2020  at32).          
-00086140: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-00086150: 696e 2072 616e 6765 286c 656e 2877 6829  in range(len(wh)
-00086160: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
-00086170: 2020 2020 2020 2020 2020 2020 735f 706f              s_po
-00086180: 735b 6b5d 203d 2067 6473 5b77 685b 6b5d  s[k] = gds[wh[k]
-00086190: 5d2e 6265 6769 6e0a 2020 2020 2020 2020  ].begin.        
-000861a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000861b0: 6e74 725f 7661 6c69 6420 2b3d 2067 642e  ntr_valid += gd.
-000861c0: 6e74 720a 2020 2020 2020 2020 2020 2020  ntr.            
-000861d0: 2020 2020 2020 2020 6f64 7220 3d20 735f          odr = s_
-000861e0: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
+00083070: 722e 636d 6174 2c20 6368 726d 2c20 722e  r.cmat, chrm, r.
+00083080: 7374 6172 742d 6f73 732c 206f 7373 2c20  start-oss, oss, 
+00083090: 6769 6e29 0a20 2020 2020 2020 2020 2020  gin).           
+000830a0: 2020 2020 2073 6e76 5f69 6e66 6f5f 6368       snv_info_ch
+000830b0: 7220 3d20 736e 765f 696e 666f 5f63 6872  r = snv_info_chr
+000830c0: 202b 2073 695f 6c73 740a 2020 2020 2020   + si_lst.      
+000830d0: 2020 2020 2020 2020 2020 6764 5f69 6478            gd_idx
+000830e0: 203d 2067 645f 6964 785f 6f66 5f72 676e   = gd_idx_of_rgn
+000830f0: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
+00083100: 2020 2020 6764 5f73 656c 5b67 645f 6964      gd_sel[gd_id
+00083110: 785d 2e6e 765f 696e 666f 5f6c 7374 203d  x].nv_info_lst =
+00083120: 2067 645f 7365 6c5b 6764 5f69 6478 5d2e   gd_sel[gd_idx].
+00083130: 6e76 5f69 6e66 6f5f 6c73 7420 2b20 7369  nv_info_lst + si
+00083140: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+00083150: 2020 2020 200a 2020 2020 2020 2020 656c       .        el
+00083160: 6966 2072 2e74 7970 6520 3d3d 2027 696e  if r.type == 'in
+00083170: 7365 7273 696f 6e27 3a0a 0a20 2020 2020  sersion':..     
+00083180: 2020 2020 2020 206f 7373 702c 2070 7265         ossp, pre
+00083190: 765f 6f66 3120 3d20 6f66 2e66 696e 645f  v_of1 = of.find_
+000831a0: 6f73 5f73 6571 2872 2e73 7461 7274 2d31  os_seq(r.start-1
+000831b0: 2c20 7072 6576 5f6f 6669 2c20 6d61 726b  , prev_ofi, mark
+000831c0: 203d 2027 4927 290a 0a20 2020 2020 2020   = 'I')..       
+000831d0: 2020 2020 2073 6f70 203d 2073 6571 5f6f       sop = seq_o
+000831e0: 7267 5b69 6e74 2872 2e73 7461 7274 2d28  rg[int(r.start-(
+000831f0: 4e57 494e 2b31 2929 3a69 6e74 2872 2e73  NWIN+1)):int(r.s
+00083200: 7461 7274 2d31 295d 0a20 2020 2020 2020  tart-1)].       
+00083210: 2020 2020 2073 6f63 203d 2027 2d27 0a20       soc = '-'. 
+00083220: 2020 2020 2020 2020 2020 2073 6f6e 203d             son =
+00083230: 2073 6571 5f6f 7267 5b69 6e74 2872 2e73   seq_org[int(r.s
+00083240: 7461 7274 2d31 293a 696e 7428 722e 7374  tart-1):int(r.st
+00083250: 6172 742b 284e 5749 4e2d 3129 295d 0a20  art+(NWIN-1))]. 
+00083260: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00083270: 2020 2020 2020 2020 736e 7020 3d20 7365          snp = se
+00083280: 715f 6e65 775b 696e 7428 722e 7374 6172  q_new[int(r.star
+00083290: 742b 6f73 7370 2d28 4e57 494e 2b31 2929  t+ossp-(NWIN+1))
+000832a0: 3a69 6e74 2872 2e73 7461 7274 2b6f 7373  :int(r.start+oss
+000832b0: 702d 3129 5d0a 2020 2020 2020 2020 2020  p-1)].          
+000832c0: 2020 736e 6320 3d20 722e 7365 710a 2020    snc = r.seq.  
+000832d0: 2020 2020 2020 2020 2020 736e 6e20 3d20            snn = 
+000832e0: 7365 715f 6e65 775b 696e 7428 722e 7374  seq_new[int(r.st
+000832f0: 6172 742b 6f73 732d 3129 3a69 6e74 2872  art+oss-1):int(r
+00083300: 2e73 7461 7274 2b6f 7373 2b28 4e57 494e  .start+oss+(NWIN
+00083310: 2d31 2929 5d0a 2020 2020 2020 2020 2020  -1))].          
+00083320: 2020 7369 203d 2053 4e56 5f69 6e66 6f28    si = SNV_info(
+00083330: 6368 726d 2c20 722e 7374 6172 742c 2072  chrm, r.start, r
+00083340: 2e73 7461 7274 2b6f 7373 2c20 6769 6e5b  .start+oss, gin[
+00083350: 305d 2c20 6769 6e5b 315d 2c20 2749 272c  0], gin[1], 'I',
+00083360: 2072 2e67 6574 5f6c 656e 2829 2c20 696e   r.get_len(), in
+00083370: 7428 722e 6176 655f 6376 675f 6465 7074  t(r.ave_cvg_dept
+00083380: 6828 2929 2c20 722e 6376 675f 6672 6163  h()), r.cvg_frac
+00083390: 2c20 736f 702c 2073 6f63 2c20 736f 6e2c  , sop, soc, son,
+000833a0: 2073 6e70 2c20 736e 632c 2073 6e6e 2029   snp, snc, snn )
+000833b0: 0a20 2020 2020 2020 2020 2020 2073 6e76  .            snv
+000833c0: 5f69 6e66 6f5f 6368 722e 6170 7065 6e64  _info_chr.append
+000833d0: 2873 6929 0a20 2020 2020 2020 2020 2020  (si).           
+000833e0: 2067 645f 6964 7820 3d20 6764 5f69 6478   gd_idx = gd_idx
+000833f0: 5f6f 665f 7267 6e5b 6b5d 0a20 2020 2020  _of_rgn[k].     
+00083400: 2020 2020 2020 2067 645f 7365 6c5b 6764         gd_sel[gd
+00083410: 5f69 6478 5d2e 6e76 5f69 6e66 6f5f 6c73  _idx].nv_info_ls
+00083420: 742e 6170 7065 6e64 2873 6929 0a0a 2020  t.append(si)..  
+00083430: 2020 2020 2020 2020 2020 722e 7374 6172            r.star
+00083440: 7420 2b3d 206f 7373 700a 2020 2020 2020  t += ossp.      
+00083450: 2020 2020 2020 722e 656e 6420 2b3d 206f        r.end += o
+00083460: 7373 7020 200a 2020 2020 2020 2020 2020  ssp  .          
+00083470: 2020 7261 6c6c 2e72 676e 735b 6b5d 203d    rall.rgns[k] =
+00083480: 2072 2023 202e 636f 7079 2829 0a0a 2020   r # .copy()..  
+00083490: 2020 2020 2020 656c 6966 2072 2e74 7970        elif r.typ
+000834a0: 6520 3d3d 2027 6465 6c65 7469 6f6e 273a  e == 'deletion':
+000834b0: 0a0a 2020 2020 2020 2020 2020 2020 6f73  ..            os
+000834c0: 7370 2c20 7072 6576 5f6f 6631 203d 206f  sp, prev_of1 = o
+000834d0: 662e 6669 6e64 5f6f 735f 7365 7128 722e  f.find_os_seq(r.
+000834e0: 7374 6172 742d 312c 2070 7265 765f 6f66  start-1, prev_of
+000834f0: 692c 206d 6172 6b20 3d20 2744 2729 0a0a  i, mark = 'D')..
+00083500: 2020 2020 2020 2020 2020 2020 736f 7020              sop 
+00083510: 3d20 7365 715f 6f72 675b 696e 7428 722e  = seq_org[int(r.
+00083520: 7374 6172 742d 284e 5749 4e2b 3129 293a  start-(NWIN+1)):
+00083530: 696e 7428 722e 7374 6172 742d 3129 5d0a  int(r.start-1)].
+00083540: 2020 2020 2020 2020 2020 2020 736f 6320              soc 
+00083550: 3d20 7365 715f 6f72 675b 696e 7428 722e  = seq_org[int(r.
+00083560: 7374 6172 742d 3129 3a69 6e74 2872 2e65  start-1):int(r.e
+00083570: 6e64 295d 0a20 2020 2020 2020 2020 2020  nd)].           
+00083580: 2073 6f6e 203d 2073 6571 5f6f 7267 5b69   son = seq_org[i
+00083590: 6e74 2872 2e65 6e64 293a 696e 7428 722e  nt(r.end):int(r.
+000835a0: 656e 642b 284e 5749 4e29 295d 0a20 2020  end+(NWIN))].   
+000835b0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+000835c0: 2020 2020 2020 2320 736f 7020 3d20 7261        # sop = ra
+000835d0: 6c6c 2e72 676e 735b 6f64 725b 6d2d 315d  ll.rgns[odr[m-1]
+000835e0: 5d2e 7365 715b 2d4e 5749 4e3a 5d0a 2020  ].seq[-NWIN:].  
+000835f0: 2020 2020 2020 2020 2020 736e 7020 3d20            snp = 
+00083600: 7365 715f 6e65 775b 696e 7428 722e 7374  seq_new[int(r.st
+00083610: 6172 742b 6f73 7370 2d28 4e57 494e 2b31  art+ossp-(NWIN+1
+00083620: 2929 3a69 6e74 2872 2e73 7461 7274 2b6f  )):int(r.start+o
+00083630: 7373 702d 3129 5d0a 2020 2020 2020 2020  ssp-1)].        
+00083640: 2020 2020 736e 6320 3d20 272d 270a 2020      snc = '-'.  
+00083650: 2020 2020 2020 2020 2020 2320 736f 6e20            # son 
+00083660: 3d20 7261 6c6c 2e72 676e 735b 6f64 725b  = rall.rgns[odr[
+00083670: 6d2b 315d 5d2e 7365 715b 3a4e 5749 4e5d  m+1]].seq[:NWIN]
+00083680: 0a20 2020 2020 2020 2020 2020 2073 6e6e  .            snn
+00083690: 203d 2073 6571 5f6e 6577 5b69 6e74 2872   = seq_new[int(r
+000836a0: 2e73 7461 7274 2b6f 7373 702d 3129 3a69  .start+ossp-1):i
+000836b0: 6e74 2872 2e73 7461 7274 2b6f 7373 702b  nt(r.start+ossp+
+000836c0: 284e 5749 4e2d 3129 295d 0a20 2020 2020  (NWIN-1))].     
+000836d0: 2020 2020 2020 2073 6920 3d20 534e 565f         si = SNV_
+000836e0: 696e 666f 2863 6872 6d2c 2072 2e73 7461  info(chrm, r.sta
+000836f0: 7274 2c20 722e 7374 6172 742b 6f73 732c  rt, r.start+oss,
+00083700: 2067 696e 5b30 5d2c 2067 696e 5b31 5d2c   gin[0], gin[1],
+00083710: 2027 4427 2c20 722e 6765 745f 6c65 6e28   'D', r.get_len(
+00083720: 292c 2069 6e74 2872 2e61 7665 5f63 7667  ), int(r.ave_cvg
+00083730: 5f64 6570 7468 2829 292c 2072 2e63 7667  _depth()), r.cvg
+00083740: 5f66 7261 632c 2073 6f70 2c20 736f 632c  _frac, sop, soc,
+00083750: 2073 6f6e 2c20 736e 702c 2073 6e63 2c20   son, snp, snc, 
+00083760: 736e 6e20 290a 2020 2020 2020 2020 2020  snn ).          
+00083770: 2020 736e 765f 696e 666f 5f63 6872 2e61    snv_info_chr.a
+00083780: 7070 656e 6428 7369 290a 2020 2020 2020  ppend(si).      
+00083790: 2020 2020 2020 6764 5f69 6478 203d 2067        gd_idx = g
+000837a0: 645f 6964 785f 6f66 5f72 676e 5b6b 5d0a  d_idx_of_rgn[k].
+000837b0: 2020 2020 2020 2020 2020 2020 6764 5f73              gd_s
+000837c0: 656c 5b67 645f 6964 785d 2e6e 765f 696e  el[gd_idx].nv_in
+000837d0: 666f 5f6c 7374 2e61 7070 656e 6428 7369  fo_lst.append(si
+000837e0: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+000837f0: 2e73 7461 7274 202b 3d20 6f73 7370 0a20  .start += ossp. 
+00083800: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
+00083810: 202b 3d20 6f73 7370 2020 200a 2020 2020   += ossp   .    
+00083820: 2020 2020 2020 2020 7261 6c6c 2e72 676e          rall.rgn
+00083830: 735b 6b5d 203d 2072 2023 202e 636f 7079  s[k] = r # .copy
+00083840: 2829 0a0a 2020 2020 2020 2020 7072 6576  ()..        prev
+00083850: 5f6f 6669 203d 2070 7265 765f 6f66 310a  _ofi = prev_of1.
+00083860: 0a20 2020 2065 6c61 7073 6564 5f74 696d  .    elapsed_tim
+00083870: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
+00083880: 2d20 7374 6172 745f 7469 6d65 0a20 2020  - start_time.   
+00083890: 2023 2070 7269 6e74 2827 2020 2033 2e20   # print('   3. 
+000838a0: 646f 6e65 2028 2569 2920 2025 6927 2025  done (%i)  %i' %
+000838b0: 2028 656c 6170 7365 645f 7469 6d65 2c20   (elapsed_time, 
+000838c0: 6c65 6e28 6f66 2e6f 7369 5f6c 7374 2929  len(of.osi_lst))
+000838d0: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+000838e0: 2020 2020 0a20 2020 206e 765f 6c73 7420      .    nv_lst 
+000838f0: 3d20 5b5d 0a20 2020 2063 6e74 5f65 203d  = [].    cnt_e =
+00083900: 2030 0a20 2020 2066 6f72 2067 6420 696e   0.    for gd in
+00083910: 2067 645f 7365 6c3a 0a20 2020 2020 2020   gd_sel:.       
+00083920: 2066 6f72 2074 6420 696e 2067 642e 7464   for td in gd.td
+00083930: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
+00083940: 2020 7464 2e67 6574 5f6f 7267 5f63 6f64    td.get_org_cod
+00083950: 696e 675f 7365 7128 2067 642e 6364 732e  ing_seq( gd.cds.
+00083960: 7267 6e73 2c20 7365 715f 6f72 6720 290a  rgns, seq_org ).
+00083970: 2020 2020 2020 2020 6e76 5f6c 7374 5f74          nv_lst_t
+00083980: 6d70 2c20 636e 745f 6520 3d20 6764 2e67  mp, cnt_e = gd.g
+00083990: 6574 5f67 656e 655f 6c65 7665 6c5f 6e76  et_gene_level_nv
+000839a0: 5f69 6e66 6f28 636e 745f 6529 0a20 2020  _info(cnt_e).   
+000839b0: 2020 2020 206e 765f 6c73 7420 3d20 6e76       nv_lst = nv
+000839c0: 5f6c 7374 202b 206e 765f 6c73 745f 746d  _lst + nv_lst_tm
+000839d0: 700a 2020 2020 736e 765f 696e 666f 5f63  p.    snv_info_c
+000839e0: 6872 203d 206e 765f 6c73 740a 2020 2020  hr = nv_lst.    
+000839f0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00083a00: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00083a10: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
+00083a20: 2323 2070 7574 2072 676e 7320 6261 636b  ## put rgns back
+00083a30: 2074 6f20 6764 5f73 656c 0a20 2020 2023   to gd_sel.    #
+00083a40: 2320 616e 6420 616c 736f 2061 6464 206e  # and also add n
+00083a50: 6577 2072 676e 7320 0a0a 2020 2020 7374  ew rgns ..    st
+00083a60: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
+00083a70: 7469 6d65 2829 0a20 2020 2070 6f73 5f74  time().    pos_t
+00083a80: 6f5f 6164 6420 3d20 6e70 2e61 7272 6179  o_add = np.array
+00083a90: 2870 6f73 5f74 6f5f 6164 6429 0a20 2020  (pos_to_add).   
+00083aa0: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
+00083ab0: 756d 6572 6174 6528 6764 5f73 656c 293a  umerate(gd_sel):
+00083ac0: 200a 0a20 2020 2020 2020 2070 3120 3d20   ..        p1 = 
+00083ad0: 696e 7428 6c6f 635f 6f73 5b6b 5d29 0a20  int(loc_os[k]). 
+00083ae0: 2020 2020 2020 2070 3220 3d20 696e 7428         p2 = int(
+00083af0: 7031 202b 206e 756d 5f6f 735b 6b5d 290a  p1 + num_os[k]).
+00083b00: 2020 2020 2020 2020 2320 6764 2e65 786f          # gd.exo
+00083b10: 6e73 2e72 676e 7320 3d20 7261 6c6c 2e72  ns.rgns = rall.r
+00083b20: 676e 735b 7031 3a70 325d 0a20 2020 2020  gns[p1:p2].     
+00083b30: 2020 2067 642e 6578 6f6e 732e 7267 6e73     gd.exons.rgns
+00083b40: 203d 205b 7261 6c6c 2e72 676e 735b 7031   = [rall.rgns[p1
+00083b50: 2b6d 5d20 666f 7220 6d20 696e 2072 616e  +m] for m in ran
+00083b60: 6765 2870 322d 7031 295d 0a20 2020 2020  ge(p2-p1)].     
+00083b70: 2020 2077 6820 3d20 7768 6963 6828 2028     wh = which( (
+00083b80: 706f 735f 746f 5f61 6464 203e 3d20 7031  pos_to_add >= p1
+00083b90: 2920 2620 2870 6f73 5f74 6f5f 6164 6420  ) & (pos_to_add 
+00083ba0: 3c20 7032 2920 290a 2020 2020 2020 2020  < p2) ).        
+00083bb0: 6966 206c 656e 2877 6829 203e 2030 3a0a  if len(wh) > 0:.
+00083bc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00083bd0: 7720 696e 2077 683a 2067 642e 6578 6f6e  w in wh: gd.exon
+00083be0: 732e 7267 6e73 2e61 7070 656e 6428 725f  s.rgns.append(r_
+00083bf0: 746f 5f61 6464 5b77 5d29 0a0a 2020 2020  to_add[w])..    
+00083c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083c10: 2323 2323 2323 230a 2020 2020 2323 2072  #######.    ## r
+00083c20: 656d 6f76 6520 6964 656c 6574 696f 6e20  emove ideletion 
+00083c30: 0a20 2020 2023 2320 636f 6d62 696e 6520  .    ## combine 
+00083c40: 7469 6c65 6420 6578 6f6e 730a 2020 2020  tiled exons.    
+00083c50: 0a20 2020 2066 6f72 2067 6420 696e 2067  .    for gd in g
+00083c60: 645f 7365 6c3a 0a20 2020 2020 2020 2067  d_sel:.        g
+00083c70: 642e 7265 6d6f 7665 5f69 6e64 656c 5f61  d.remove_indel_a
+00083c80: 6e64 5f63 6f6d 6269 6e65 5f66 7261 6773  nd_combine_frags
+00083c90: 2829 0a0a 2020 2020 2327 2727 0a20 2020  ()..    #'''.   
+00083ca0: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
+00083cb0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+00083cc0: 6172 745f 7469 6d65 0a20 2020 2023 2070  art_time.    # p
+00083cd0: 7269 6e74 2827 2020 2033 622e 2064 6f6e  rint('   3b. don
+00083ce0: 6520 2825 6929 2020 2720 2520 2865 6c61  e (%i)  ' % (ela
+00083cf0: 7073 6564 5f74 696d 6529 2c20 666c 7573  psed_time), flus
+00083d00: 6820 3d20 5472 7565 290a 2020 2020 0a0a  h = True).    ..
+00083d10: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+00083d20: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00083d30: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00083d40: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00083d50: 2063 6f64 696e 6720 7265 6769 6f6e 2075   coding region u
+00083d60: 7064 6174 650a 0a20 2020 2073 7461 7274  pdate..    start
+00083d70: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
+00083d80: 6528 290a 2020 2020 0a20 2020 2023 2320  e().    .    ## 
+00083d90: 636f 6c6c 6563 7420 7267 6e73 2061 6e64  collect rgns and
+00083da0: 206d 6172 6b20 7468 6569 7220 706f 730a   mark their pos.
+00083db0: 2020 2020 6c6f 635f 6f73 203d 206e 702e      loc_os = np.
+00083dc0: 7a65 726f 7328 6e5f 6764 290a 2020 2020  zeros(n_gd).    
+00083dd0: 6e75 6d5f 6f73 203d 206e 702e 7a65 726f  num_os = np.zero
+00083de0: 7328 6e5f 6764 2c64 7479 7065 3d6e 702e  s(n_gd,dtype=np.
+00083df0: 666c 6f61 7433 3229 0a20 2020 2063 616c  float32).    cal
+00083e00: 6c20 3d20 7265 6769 6f6e 7328 290a 2020  l = regions().  
+00083e10: 2020 6f73 5f63 7572 203d 2030 0a20 2020    os_cur = 0.   
+00083e20: 2063 5f70 6f73 203d 205b 5d0a 2020 2020   c_pos = [].    
+00083e30: 666f 7220 6b2c 2067 6420 696e 2065 6e75  for k, gd in enu
+00083e40: 6d65 7261 7465 2867 645f 7365 6c29 3a0a  merate(gd_sel):.
+00083e50: 2020 2020 2020 2020 6c6f 635f 6f73 5b6b          loc_os[k
+00083e60: 5d20 3d20 6f73 5f63 7572 0a20 2020 2020  ] = os_cur.     
+00083e70: 2020 206e 756d 5f6f 735b 6b5d 203d 206c     num_os[k] = l
+00083e80: 656e 2867 642e 6364 732e 7267 6e73 290a  en(gd.cds.rgns).
+00083e90: 2020 2020 2020 2020 6361 6c6c 2e72 676e          call.rgn
+00083ea0: 7320 3d20 6361 6c6c 2e72 676e 7320 2b20  s = call.rgns + 
+00083eb0: 6764 2e63 6473 2e72 676e 730a 2020 2020  gd.cds.rgns.    
+00083ec0: 2020 2020 6f73 5f63 7572 202b 3d20 6c65      os_cur += le
+00083ed0: 6e28 6764 2e63 6473 2e72 676e 7329 0a0a  n(gd.cds.rgns)..
+00083ee0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+00083ef0: 2067 642e 6364 732e 7267 6e73 3a0a 2020   gd.cds.rgns:.  
+00083f00: 2020 2020 2020 2020 2020 635f 706f 732e            c_pos.
+00083f10: 6170 7065 6e64 2872 2e73 7461 7274 290a  append(r.start).
+00083f20: 0a20 2020 2023 2320 6765 7420 6f72 6465  .    ## get orde
+00083f30: 7220 6163 636f 7264 696e 6720 746f 206c  r according to l
+00083f40: 6f63 6174 696f 6e0a 2020 2020 635f 706f  ocation.    c_po
+00083f50: 7320 3d20 6e70 2e61 7272 6179 2863 5f70  s = np.array(c_p
+00083f60: 6f73 290a 2020 2020 6f64 7220 3d20 635f  os).    odr = c_
+00083f70: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
+00083f80: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00083f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083fb0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
+00083fc0: 2323 2055 7365 206f 6666 7365 745f 6669  ## Use offset_fi
+00083fd0: 6e64 6572 2074 6f20 636f 7272 6563 7420  nder to correct 
+00083fe0: 706f 7369 7469 6f6e 7320 696e 2047 5446  positions in GTF
+00083ff0: 2065 6e74 7269 6573 0a20 2020 2023 2320   entries.    ## 
+00084000: 616c 736f 2067 6574 2072 676e 7320 6672  also get rgns fr
+00084010: 6167 6d65 6e74 7320 7768 656e 2073 706c  agments when spl
+00084020: 6974 2069 7320 7265 7175 6972 6564 0a0a  it is required..
+00084030: 2020 2020 635f 746f 5f61 6464 203d 205b      c_to_add = [
+00084040: 5d0a 2020 2020 706f 735f 746f 5f61 6464  ].    pos_to_add
+00084050: 203d 205b 5d0a 0a20 2020 2070 7265 765f   = []..    prev_
+00084060: 6f66 6920 3d20 300a 2020 2020 2320 666f  ofi = 0.    # fo
+00084070: 7220 6b2c 2072 2069 6e20 656e 756d 6572  r k, r in enumer
+00084080: 6174 6528 6361 6c6c 2e72 676e 7329 3a0a  ate(call.rgns):.
+00084090: 2020 2020 666f 7220 6d2c 206b 2069 6e20      for m, k in 
+000840a0: 656e 756d 6572 6174 6528 6f64 7229 3a0a  enumerate(odr):.
+000840b0: 2020 2020 2020 2020 7220 3d20 6361 6c6c          r = call
+000840c0: 2e72 676e 735b 6b5d 0a20 2020 2020 2020  .rgns[k].       
+000840d0: 200a 2020 2020 2020 2020 2320 6f73 7320   .        # oss 
+000840e0: 3d20 6f66 2e66 696e 645f 6f73 2872 2e73  = of.find_os(r.s
+000840f0: 7461 7274 290a 2020 2020 2020 2020 2320  tart).        # 
+00084100: 6f73 6520 3d20 6f66 2e66 696e 645f 6f73  ose = of.find_os
+00084110: 2872 2e65 6e64 290a 2020 2020 2020 2020  (r.end).        
+00084120: 6f73 732c 2070 7265 765f 6f66 3120 3d20  oss, prev_of1 = 
+00084130: 6f66 2e66 696e 645f 6f73 5f73 6571 2872  of.find_os_seq(r
+00084140: 2e73 7461 7274 2c20 7072 6576 5f6f 6669  .start, prev_ofi
+00084150: 2c20 6d61 726b 203d 2027 4227 290a 2020  , mark = 'B').  
+00084160: 2020 2020 2020 6f73 652c 2070 7265 765f        ose, prev_
+00084170: 6f66 3220 3d20 6f66 2e66 696e 645f 6f73  of2 = of.find_os
+00084180: 5f73 6571 2872 2e65 6e64 2c20 7072 6576  _seq(r.end, prev
+00084190: 5f6f 6669 2c20 6d61 726b 203d 2027 4327  _ofi, mark = 'C'
+000841a0: 290a 2020 2020 2020 2020 7072 6576 5f6f  ).        prev_o
+000841b0: 6669 203d 2070 7265 765f 6f66 310a 0a20  fi = prev_of1.. 
+000841c0: 2020 2020 2020 2069 6620 2872 2e74 7970         if (r.typ
+000841d0: 652e 6c6f 7765 7228 2920 3d3d 2027 7374  e.lower() == 'st
+000841e0: 6172 745f 636f 646f 6e27 2920 7c20 2872  art_codon') | (r
+000841f0: 2e74 7970 652e 6c6f 7765 7228 2920 3d3d  .type.lower() ==
+00084200: 2027 7374 6f70 5f63 6f64 6f6e 2729 3a0a   'stop_codon'):.
+00084210: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
+00084220: 6172 7420 2b3d 206f 7373 0a20 2020 2020  art += oss.     
+00084230: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
+00084240: 6f73 7320 2020 0a20 2020 2020 2020 2020  oss   .         
+00084250: 2020 2063 616c 6c2e 7267 6e73 5b6b 5d20     call.rgns[k] 
+00084260: 3d20 722e 636f 7079 2875 7064 6174 653d  = r.copy(update=
+00084270: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+00084280: 656c 7365 3a20 2023 2043 4453 2c20 6669  else:  # CDS, fi
+00084290: 7665 5f70 7269 6d65 5f75 7472 2c20 7468  ve_prime_utr, th
+000842a0: 7265 655f 7072 696d 655f 7574 722c 202e  ree_prime_utr, .
+000842b0: 2e2e 0a20 2020 2020 2020 2020 2020 2069  ...            i
+000842c0: 6620 286f 7373 203d 3d20 6f73 6529 3a0a  f (oss == ose):.
+000842d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000842e0: 722e 7374 6172 7420 2b3d 206f 7373 0a20  r.start += oss. 
+000842f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00084300: 2e65 6e64 202b 3d20 6f73 650a 2020 2020  .end += ose.    
+00084310: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+00084320: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
+00084330: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
+00084340: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00084350: 6620 286f 7373 203c 206f 7365 293a 2023  f (oss < ose): #
+00084360: 2049 6e73 6572 7369 6f6e 206f 7220 6465   Insersion or de
+00084370: 6c65 7469 6f6e 2069 6e20 6265 7477 6565  letion in betwee
+00084380: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+00084390: 2020 2023 2070 7269 6e74 2827 2020 2025     # print('   %
+000843a0: 6920 6f73 7320 3c20 6f73 6527 2025 206b  i oss < ose' % k
+000843b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000843c0: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
+000843d0: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
+000843e0: 2872 2e65 6e64 2c20 7072 6576 5f6f 6669  (r.end, prev_ofi
+000843f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00084400: 2020 2023 2320 7370 6c69 740a 2020 2020     ## split.    
+00084410: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
+00084420: 6e65 7720 3d20 7265 6769 6f6e 2820 722e  new = region( r.
+00084430: 6368 722c 2070 2b6f 7365 2c20 722e 656e  chr, p+ose, r.en
+00084440: 642b 6f73 652c 2072 2e74 7970 652c 2078  d+ose, r.type, x
+00084450: 7320 3d20 722e 7873 290a 2020 2020 2020  s = r.xs).      
+00084460: 2020 2020 2020 2020 2020 635f 746f 5f61            c_to_a
+00084470: 6464 2e61 7070 656e 6428 7267 6e5f 6e65  dd.append(rgn_ne
+00084480: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
+00084490: 2020 2070 6f73 5f74 6f5f 6164 642e 6170     pos_to_add.ap
+000844a0: 7065 6e64 286b 2b31 290a 0a20 2020 2020  pend(k+1)..     
+000844b0: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
+000844c0: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
+000844d0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
+000844e0: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
+000844f0: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
+00084500: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
+00084510: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
+00084520: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00084530: 286f 7373 203e 206f 7365 293a 2023 2064  (oss > ose): # d
+00084540: 656c 6574 696f 6e20 696e 2062 6574 7765  eletion in betwe
+00084550: 656e 0a0a 2020 2020 2020 2020 2020 2020  en..            
+00084560: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
+00084570: 2569 206f 7373 203e 206f 7365 2720 2520  %i oss > ose' % 
+00084580: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+00084590: 2020 2070 2c20 7072 6576 5f6f 6632 203d     p, prev_of2 =
+000845a0: 206f 662e 6765 745f 626e 6472 795f 7365   of.get_bndry_se
+000845b0: 7128 722e 656e 642c 2070 7265 765f 6f66  q(r.end, prev_of
+000845c0: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
+000845d0: 2020 204c 6420 3d20 6f73 7320 2d20 6f73     Ld = oss - os
+000845e0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+000845f0: 2020 2023 2320 7370 6c69 7420 2866 6f72     ## split (for
+00084600: 2043 4453 206f 6e6c 7929 0a20 2020 2020   CDS only).     
+00084610: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
+00084620: 6577 203d 2072 6567 696f 6e28 2072 2e63  ew = region( r.c
+00084630: 6872 2c20 702b 4c64 2b6f 7365 2c20 722e  hr, p+Ld+ose, r.
+00084640: 656e 642b 6f73 652c 2072 2e74 7970 652c  end+ose, r.type,
+00084650: 2078 7320 3d20 722e 7873 290a 2020 2020   xs = r.xs).    
+00084660: 2020 2020 2020 2020 2020 2020 635f 746f              c_to
+00084670: 5f61 6464 2e61 7070 656e 6428 7267 6e5f  _add.append(rgn_
+00084680: 6e65 7729 0a20 2020 2020 2020 2020 2020  new).           
+00084690: 2020 2020 2070 6f73 5f74 6f5f 6164 642e       pos_to_add.
+000846a0: 6170 7065 6e64 286b 2b31 290a 0a20 2020  append(k+1)..   
+000846b0: 2020 2020 2020 2020 2020 2020 2072 2e65               r.e
+000846c0: 6e64 203d 2070 2d31 2b6f 7373 0a20 2020  nd = p-1+oss.   
+000846d0: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
+000846e0: 7461 7274 202b 3d20 6f73 730a 2020 2020  tart += oss.    
+000846f0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+00084700: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
+00084710: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
+00084720: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
+00084730: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00084740: 2020 2020 2323 2070 7574 2072 676e 7320      ## put rgns 
+00084750: 6261 636b 2074 6f20 6764 5f73 656c 0a20  back to gd_sel. 
+00084760: 2020 2023 2320 616e 6420 616c 736f 2061     ## and also a
+00084770: 6464 206e 6577 2072 676e 7320 0a0a 2020  dd new rgns ..  
+00084780: 2020 706f 735f 746f 5f61 6464 203d 206e    pos_to_add = n
+00084790: 702e 6172 7261 7928 706f 735f 746f 5f61  p.array(pos_to_a
+000847a0: 6464 290a 2020 2020 666f 7220 6b2c 2067  dd).    for k, g
+000847b0: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
+000847c0: 645f 7365 6c29 3a20 0a0a 2020 2020 2020  d_sel): ..      
+000847d0: 2020 7031 203d 2069 6e74 286c 6f63 5f6f    p1 = int(loc_o
+000847e0: 735b 6b5d 290a 2020 2020 2020 2020 7032  s[k]).        p2
+000847f0: 203d 2069 6e74 2870 3120 2b20 6e75 6d5f   = int(p1 + num_
+00084800: 6f73 5b6b 5d29 0a20 2020 2020 2020 2067  os[k]).        g
+00084810: 642e 6364 732e 7267 6e73 203d 205b 6361  d.cds.rgns = [ca
+00084820: 6c6c 2e72 676e 735b 7031 2b6d 5d20 666f  ll.rgns[p1+m] fo
+00084830: 7220 6d20 696e 2072 616e 6765 2870 322d  r m in range(p2-
+00084840: 7031 295d 0a20 2020 2020 2020 2077 6820  p1)].        wh 
+00084850: 3d20 7768 6963 6828 2028 706f 735f 746f  = which( (pos_to
+00084860: 5f61 6464 203e 3d20 7031 2920 2620 2870  _add >= p1) & (p
+00084870: 6f73 5f74 6f5f 6164 6420 3c20 7032 2920  os_to_add < p2) 
+00084880: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+00084890: 2877 6829 203e 2030 3a0a 2020 2020 2020  (wh) > 0:.      
+000848a0: 2020 2020 2020 666f 7220 7720 696e 2077        for w in w
+000848b0: 683a 2067 642e 6364 732e 7267 6e73 2e61  h: gd.cds.rgns.a
+000848c0: 7070 656e 6428 635f 746f 5f61 6464 5b77  ppend(c_to_add[w
+000848d0: 5d29 0a0a 2020 2020 656c 6170 7365 645f  ])..    elapsed_
+000848e0: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+000848f0: 2829 202d 2073 7461 7274 5f74 696d 650a  () - start_time.
+00084900: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
+00084910: 342e 2064 6f6e 6520 2825 6929 2020 2720  4. done (%i)  ' 
+00084920: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
+00084930: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+00084940: 2020 2020 0a20 2020 2023 2323 2323 2323      .    #######
+00084950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00084960: 230a 2020 2020 2323 2063 6f64 696e 6720  #.    ## coding 
+00084970: 7265 6769 6f6e 2075 7064 6174 650a 2020  region update.  
+00084980: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+00084990: 2323 2323 2323 2323 2323 0a0a 2020 2020  ##########..    
+000849a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000849b0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
+000849c0: 496e 7465 6772 6974 7920 6368 6563 6b0a  Integrity check.
+000849d0: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
+000849e0: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+000849f0: 290a 2020 2020 6e5f 6261 7365 735f 746f  ).    n_bases_to
+00084a00: 7461 6c20 3d20 300a 2020 2020 6e5f 6572  tal = 0.    n_er
+00084a10: 5f62 6173 6573 203d 2030 0a20 2020 206e  _bases = 0.    n
+00084a20: 5f62 6c6b 5f74 6f74 616c 203d 2030 0a20  _blk_total = 0. 
+00084a30: 2020 206e 5f65 725f 626c 6b20 3d20 300a     n_er_blk = 0.
+00084a40: 2020 2020 6e70 6520 3d20 300a 2020 2020      npe = 0.    
+00084a50: 6e70 7420 3d20 300a 2020 2020 666f 7220  npt = 0.    for 
+00084a60: 6764 2069 6e20 6764 5f73 656c 3a0a 2020  gd in gd_sel:.  
+00084a70: 2020 2020 2020 666f 7220 7220 696e 2067        for r in g
+00084a80: 642e 6578 6f6e 732e 7267 6e73 3a0a 2020  d.exons.rgns:.  
+00084a90: 2020 2020 2020 2020 2020 6966 2072 2e74            if r.t
+00084aa0: 7970 6520 213d 2027 6465 6c65 7469 6f6e  ype != 'deletion
+00084ab0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00084ac0: 2020 2073 3120 3d20 722e 7365 710a 2020     s1 = r.seq.  
+00084ad0: 2020 2020 2020 2020 2020 2020 2020 7332                s2
+00084ae0: 203d 2073 6571 5f6e 6577 5b28 722e 7374   = seq_new[(r.st
+00084af0: 6172 742d 3129 3a72 2e65 6e64 5d20 2320  art-1):r.end] # 
+00084b00: 6765 6e6f 6d65 5b72 2e63 6872 5d2e 7365  genome[r.chr].se
+00084b10: 715b 2872 2e73 7461 7274 2d31 293a 722e  q[(r.start-1):r.
+00084b20: 656e 645d 0a20 2020 2020 2020 2020 2020  end].           
+00084b30: 2020 2020 206e 5f65 7220 3d20 636f 6d70       n_er = comp
+00084b40: 6172 655f 7365 7132 2820 7331 2c20 7332  are_seq2( s1, s2
+00084b50: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00084b60: 2020 2023 2069 6620 6e5f 6572 203e 2030     # if n_er > 0
+00084b70: 3a20 7072 696e 7428 275c 6e53 313a 2025  : print('\nS1: %
+00084b80: 735c 6e53 323a 2025 7327 2025 2028 7331  s\nS2: %s' % (s1
+00084b90: 2c73 3229 290a 2020 2020 2020 2020 2020  ,s2)).          
+00084ba0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00084bb0: 2020 2020 2020 2020 2020 206e 5f62 6173             n_bas
+00084bc0: 6573 5f74 6f74 616c 202b 3d20 6c65 6e28  es_total += len(
+00084bd0: 7331 290a 2020 2020 2020 2020 2020 2020  s1).            
+00084be0: 2020 2020 6e5f 6572 5f62 6173 6573 202b      n_er_bases +
+00084bf0: 3d20 6e5f 6572 0a20 2020 2020 2020 2020  = n_er.         
+00084c00: 2020 2020 2020 206e 5f62 6c6b 5f74 6f74         n_blk_tot
+00084c10: 616c 202b 3d20 310a 2020 2020 2020 2020  al += 1.        
+00084c20: 2020 2020 2020 2020 6966 206e 5f65 7220          if n_er 
+00084c30: 3e20 303a 206e 5f65 725f 626c 6b20 2b3d  > 0: n_er_blk +=
+00084c40: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00084c50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00084c60: 6e74 722c 206e 7072 2c20 6e65 7220 3d20  ntr, npr, ner = 
+00084c70: 6764 2e75 7064 6174 655f 7464 5f69 6e66  gd.update_td_inf
+00084c80: 6f28 7365 6c20 3d20 312c 2070 6570 7469  o(sel = 1, pepti
+00084c90: 6465 203d 2054 7275 6529 0a20 2020 2020  de = True).     
+00084ca0: 2020 206e 652c 206e 7420 3d20 6764 2e63     ne, nt = gd.c
+00084cb0: 6f6d 7061 7265 5f73 6571 735f 6672 6f6d  ompare_seqs_from
+00084cc0: 5f63 6473 5f61 6e64 5f67 656e 6f6d 6528  _cds_and_genome(
+00084cd0: 7365 715f 6e65 7729 2023 2067 656e 6f6d  seq_new) # genom
+00084ce0: 655b 6764 2e63 6872 5d2e 7365 7129 0a20  e[gd.chr].seq). 
+00084cf0: 2020 2020 2020 206e 7065 202b 3d20 6e65         npe += ne
+00084d00: 0a20 2020 2020 2020 206e 7074 202b 3d20  .        npt += 
+00084d10: 6e74 0a0a 2020 2020 2020 2020 2320 6966  nt..        # if
+00084d20: 206e 6572 203e 2030 3a20 7072 696e 7428   ner > 0: print(
+00084d30: 2749 6e74 6567 7269 7479 2063 6865 636b  'Integrity check
+00084d40: 2065 7272 6f72 2041 2069 6e20 2573 3a20   error A in %s: 
+00084d50: 2569 202d 2025 692f 2569 2c20 2569 2f25  %i - %i/%i, %i/%
+00084d60: 692c 2025 692f 2569 2720 2520 2863 6872  i, %i/%i' % (chr
+00084d70: 6d2c 206e 6572 2c20 6e5f 6572 5f62 6173  m, ner, n_er_bas
+00084d80: 6573 2c20 6e5f 6261 7365 735f 746f 7461  es, n_bases_tota
+00084d90: 6c2c 206e 5f65 725f 626c 6b2c 206e 5f62  l, n_er_blk, n_b
+00084da0: 6c6b 5f74 6f74 616c 2c20 6e70 652c 206e  lk_total, npe, n
+00084db0: 7074 2920 290a 2020 2020 2020 2020 2320  pt) ).        # 
+00084dc0: 6966 206e 5f65 7220 3e20 303a 2070 7269  if n_er > 0: pri
+00084dd0: 6e74 2827 496e 7465 6772 6974 7920 6368  nt('Integrity ch
+00084de0: 6563 6b20 6572 726f 7220 696e 2025 733a  eck error in %s:
+00084df0: 2025 6920 2d20 2569 2f25 692c 2025 692f   %i - %i/%i, %i/
+00084e00: 2569 2c20 2569 2f25 6927 2025 2028 6368  %i, %i/%i' % (ch
+00084e10: 726d 2c20 6e5f 6572 2c20 6e5f 6572 5f62  rm, n_er, n_er_b
+00084e20: 6173 6573 2c20 6e5f 6261 7365 735f 746f  ases, n_bases_to
+00084e30: 7461 6c2c 206e 5f65 725f 626c 6b2c 206e  tal, n_er_blk, n
+00084e40: 5f62 6c6b 5f74 6f74 616c 2c20 6e70 652c  _blk_total, npe,
+00084e50: 206e 7074 2920 290a 0a20 2020 2065 6c61   npt) )..    ela
+00084e60: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
+00084e70: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
+00084e80: 7469 6d65 0a20 2020 2023 2070 7269 6e74  time.    # print
+00084e90: 2827 2020 2035 2e20 646f 6e65 2028 2569  ('   5. done (%i
+00084ea0: 2920 2027 2025 2028 656c 6170 7365 645f  )  ' % (elapsed_
+00084eb0: 7469 6d65 292c 2066 6c75 7368 203d 2054  time), flush = T
+00084ec0: 7275 6529 0a20 2020 200a 2020 2020 6573  rue).    .    es
+00084ed0: 7461 7420 3d20 286e 5f62 6173 6573 5f74  tat = (n_bases_t
+00084ee0: 6f74 616c 2c20 6e5f 6572 5f62 6173 6573  otal, n_er_bases
+00084ef0: 2c20 6e5f 626c 6b5f 746f 7461 6c2c 206e  , n_blk_total, n
+00084f00: 5f65 725f 626c 6b2c 206e 7074 2c20 6e70  _er_blk, npt, np
+00084f10: 6529 0a20 2020 200a 2020 2020 7265 7475  e).    .    retu
+00084f20: 726e 2067 645f 7365 6c2c 2073 6571 5f6e  rn gd_sel, seq_n
+00084f30: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
+00084f40: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
+00084f50: 740a 0a27 2727 0a4e 565f 696e 666f 5f65  t..'''.NV_info_e
+00084f60: 7874 5f74 7220 3d20 636f 6c6c 6563 7469  xt_tr = collecti
+00084f70: 6f6e 732e 6e61 6d65 6474 7570 6c65 2827  ons.namedtuple('
+00084f80: 4e56 5f69 6e66 6f5f 6578 745f 7472 272c  NV_info_ext_tr',
+00084f90: 2027 6368 722c 2070 6f73 5f72 6566 2c20   'chr, pos_ref, 
+00084fa0: 706f 735f 6e65 772c 2067 656e 655f 6964  pos_new, gene_id
+00084fb0: 2c20 6765 6e65 5f6e 616d 652c 2076 5f74  , gene_name, v_t
+00084fc0: 7970 652c 2076 5f6c 656e 2c20 6376 675f  ype, v_len, cvg_
+00084fd0: 6465 7074 682c 2063 7667 5f66 7261 632c  depth, cvg_frac,
+00084fe0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00084ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085000: 2020 2020 2072 6566 5f70 7265 762c 2072       ref_prev, r
+00085010: 6566 5f73 6571 2c20 7265 665f 6e65 7874  ef_seq, ref_next
+00085020: 2c20 616c 745f 7072 6576 2c20 616c 745f  , alt_prev, alt_
+00085030: 7365 712c 2061 6c74 5f6e 6578 742c 2076  seq, alt_next, v
+00085040: 5f63 6c61 7373 2c20 5c0a 2020 2020 2020  _class, \.      
+00085050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085060: 2020 2020 2020 2020 2020 2020 765f 636c              v_cl
+00085070: 6173 735f 7472 2c20 7374 7261 6e64 2c20  ass_tr, strand, 
+00085080: 6344 4e41 5f63 6861 6e67 652c 2043 6f64  cDNA_change, Cod
+00085090: 6f6e 5f63 6861 6e67 652c 2050 726f 7465  on_change, Prote
+000850a0: 696e 5f63 6861 6e67 652c 2050 726f 7465  in_change, Prote
+000850b0: 696e 5f63 6861 6e67 6532 2c20 4368 6563  in_change2, Chec
+000850c0: 6b27 2920 2023 206f 6e65 2d62 6173 650a  k')  # one-base.
+000850d0: 0a64 6566 2077 7269 7465 5f74 6f5f 7663  .def write_to_vc
+000850e0: 6628 2073 6e76 5f69 6e66 6f5f 6c73 742c  f( snv_info_lst,
+000850f0: 2066 696c 655f 6e61 6d65 2029 3a0a 0a20   file_name ):.. 
+00085100: 2020 2069 6620 6c65 6e28 736e 765f 696e     if len(snv_in
+00085110: 666f 5f6c 7374 2920 3d3d 2030 3a0a 2020  fo_lst) == 0:.  
+00085120: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00085130: 200a 2020 2020 6966 206c 656e 2873 6e76   .    if len(snv
+00085140: 5f69 6e66 6f5f 6c73 745b 305d 2920 3c3d  _info_lst[0]) <=
+00085150: 2032 303a 0a20 2020 2020 2020 2070 6173   20:.        pas
+00085160: 730a 2020 2020 656c 7365 3a0a 2020 2020  s.    else:.    
+00085170: 2020 2020 6620 3d20 6f70 656e 2820 666e      f = open( fn
+00085180: 616d 655f 7663 662c 2027 7774 2b27 2029  ame_vcf, 'wt+' )
+00085190: 0a0a 2020 2020 2020 2020 6c69 6e65 7320  ..        lines 
+000851a0: 3d20 5b27 2343 4852 4f4d 5c74 504f 535c  = ['#CHROM\tPOS\
+000851b0: 7449 445c 7452 4546 5c74 414c 545c 7451  tID\tREF\tALT\tQ
+000851c0: 5541 4c5c 7446 494c 5445 525c 7449 4e46  UAL\tFILTER\tINF
+000851d0: 4f27 5d0a 2020 2020 2020 2020 666f 7220  O'].        for 
+000851e0: 6e69 2069 6e20 736e 765f 696e 666f 5f6c  ni in snv_info_l
+000851f0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00085200: 6d69 6420 3d0a 2020 2020 2020 2020 2020  mid =.          
+00085210: 2020 5175 616c 203d 0a20 2020 2020 2020    Qual =.       
+00085220: 2020 2020 2046 696c 7465 7220 3d0a 2020       Filter =.  
+00085230: 2020 2020 2020 2020 2020 696e 666f 203d            info =
+00085240: 2027 4143 3d25 693b 4146 270a 2020 2020   'AC=%i;AF'.    
+00085250: 2020 2020 2020 2020 2725 735c 7425 695c          '%s\t%i\
+00085260: 7425 735c 7425 735c 7425 735c 7425 695c  t%s\t%s\t%s\t%i\
+00085270: 7425 735c 7425 735c 6e27 2025 2028 6e69  t%s\t%s\n' % (ni
+00085280: 2e63 6872 2c20 6e69 2e70 6f73 5f72 6566  .chr, ni.pos_ref
+00085290: 2c20 6d69 642c 206e 692e 7265 665f 7365  , mid, ni.ref_se
+000852a0: 712c 206e 692e 616c 745f 7365 712c 2051  q, ni.alt_seq, Q
+000852b0: 7561 6c2c 2069 6e66 6f29 0a0a 2020 2020  ual, info)..    
+000852c0: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
+000852d0: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
+000852e0: 6e0a 2727 270a 0a64 6566 206d 635f 636f  n.'''..def mc_co
+000852f0: 7265 5f67 6574 5f67 7466 5f61 6e64 5f66  re_get_gtf_and_f
+00085300: 6173 7461 5f70 7428 6764 293a 0a20 2020  asta_pt(gd):.   
+00085310: 200a 2020 2020 6e74 722c 206e 7072 2c20   .    ntr, npr, 
+00085320: 6e65 7220 3d20 6764 2e75 7064 6174 655f  ner = gd.update_
+00085330: 7464 5f69 6e66 6f28 7365 6c20 3d20 312c  td_info(sel = 1,
+00085340: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
+00085350: 0a20 2020 2067 7466 5f6c 696e 652c 2063  .    gtf_line, c
+00085360: 6e20 3d20 6764 2e67 6574 5f67 7466 5f6c  n = gd.get_gtf_l
+00085370: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
+00085380: 7365 6c20 3d20 312c 2061 6464 5f73 6571  sel = 1, add_seq
+00085390: 203d 2046 616c 7365 2c20 636f 6e6e 6563   = False, connec
+000853a0: 7420 3d20 5472 7565 290a 2020 2020 6c74  t = True).    lt
+000853b0: 2c20 6c70 203d 2067 642e 6765 745f 6661  , lp = gd.get_fa
+000853c0: 7374 615f 6c69 6e65 735f 6672 6f6d 5f65  sta_lines_from_e
+000853d0: 786f 6e73 2873 656c 203d 2031 2c20 7065  xons(sel = 1, pe
+000853e0: 7074 6964 6520 3d20 5472 7565 290a 2020  ptide = True).  
+000853f0: 2020 7265 7475 726e 2067 7466 5f6c 696e    return gtf_lin
+00085400: 652c 206c 742c 206c 702c 2067 642e 6368  e, lt, lp, gd.ch
+00085410: 722c 206e 6572 2c20 636e 0a0a 0a27 2727  r, ner, cn...'''
+00085420: 0a4e 565f 696e 666f 5f65 7874 5f74 7220  .NV_info_ext_tr 
+00085430: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
+00085440: 6d65 6474 7570 6c65 2827 4e56 5f69 6e66  medtuple('NV_inf
+00085450: 6f5f 6578 745f 7472 272c 2027 6368 722c  o_ext_tr', 'chr,
+00085460: 2070 6f73 5f72 6566 2c20 706f 735f 6e65   pos_ref, pos_ne
+00085470: 772c 2067 656e 655f 6964 2c20 6765 6e65  w, gene_id, gene
+00085480: 5f6e 616d 652c 2076 5f74 7970 652c 2076  _name, v_type, v
+00085490: 5f6c 656e 2c20 6376 675f 6465 7074 682c  _len, cvg_depth,
+000854a0: 2063 7667 5f66 7261 632c 205c 0a20 2020   cvg_frac, \.   
+000854b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000854c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000854d0: 6566 5f70 7265 762c 2072 6566 5f73 6571  ef_prev, ref_seq
+000854e0: 2c20 7265 665f 6e65 7874 2c20 616c 745f  , ref_next, alt_
+000854f0: 7072 6576 2c20 616c 745f 7365 712c 2061  prev, alt_seq, a
+00085500: 6c74 5f6e 6578 742c 2076 5f63 6c61 7373  lt_next, v_class
+00085510: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00085520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085530: 2020 2020 2020 765f 636c 6173 735f 7472        v_class_tr
+00085540: 2c20 7374 7261 6e64 2c20 6344 4e41 5f63  , strand, cDNA_c
+00085550: 6861 6e67 652c 2043 6f64 6f6e 5f63 6861  hange, Codon_cha
+00085560: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
+00085570: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
+00085580: 6e67 6532 2729 2023 2c20 4368 6563 6b27  nge2') #, Check'
+00085590: 2920 2023 206f 6e65 2d62 6173 650a 2727  )  # one-base.''
+000855a0: 270a 0a4e 565f 696e 666f 5f74 7220 3d20  '..NV_info_tr = 
+000855b0: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
+000855c0: 6474 7570 6c65 2827 4e56 5f69 6e66 6f5f  dtuple('NV_info_
+000855d0: 6578 745f 7472 272c 2027 6368 722c 2070  ext_tr', 'chr, p
+000855e0: 6f73 5f72 6566 2c20 6765 6e65 5f6e 616d  os_ref, gene_nam
+000855f0: 652c 2067 656e 655f 6964 2c20 765f 7479  e, gene_id, v_ty
+00085600: 7065 2c20 765f 6c65 6e2c 205c 0a20 2020  pe, v_len, \.   
+00085610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085620: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00085630: 7667 5f64 6570 7468 2c20 6376 675f 6672  vg_depth, cvg_fr
+00085640: 6163 2c20 7265 665f 7365 712c 2061 6c74  ac, ref_seq, alt
+00085650: 5f73 6571 2c20 5c0a 2020 2020 2020 2020  _seq, \.        
+00085660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085670: 2020 2020 2020 2020 2020 7374 7261 6e64            strand
+00085680: 2c20 6344 4e41 5f63 6861 6e67 652c 2043  , cDNA_change, C
+00085690: 6f64 6f6e 5f63 6861 6e67 652c 2050 726f  odon_change, Pro
+000856a0: 7465 696e 5f63 6861 6e67 652c 2050 726f  tein_change, Pro
+000856b0: 7465 696e 5f63 6861 6e67 6532 2c20 765f  tein_change2, v_
+000856c0: 636c 6173 7327 2920 0a0a 6465 6620 746f  class') ..def to
+000856d0: 5f6e 765f 7369 6d70 6c65 2820 6e76 2029  _nv_simple( nv )
+000856e0: 3a0a 0a20 2020 206e 7669 203d 204e 565f  :..    nvi = NV_
+000856f0: 696e 666f 5f74 7228 206e 762e 6368 722c  info_tr( nv.chr,
+00085700: 206e 762e 706f 735f 7265 662c 206e 762e   nv.pos_ref, nv.
+00085710: 6765 6e65 5f6e 616d 652c 206e 762e 6765  gene_name, nv.ge
+00085720: 6e65 5f69 642c 206e 762e 765f 7479 7065  ne_id, nv.v_type
+00085730: 2c20 6e76 2e76 5f6c 656e 2c20 5c0a 2020  , nv.v_len, \.  
+00085740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085750: 2020 2020 2020 2020 2020 2020 2020 6e76                nv
+00085760: 2e63 7667 5f64 6570 7468 2c20 6e76 2e63  .cvg_depth, nv.c
+00085770: 7667 5f66 7261 632c 206e 762e 7265 665f  vg_frac, nv.ref_
+00085780: 7365 712c 206e 762e 616c 745f 7365 712c  seq, nv.alt_seq,
+00085790: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+000857a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000857b0: 2020 206e 762e 7374 7261 6e64 2c20 6e76     nv.strand, nv
+000857c0: 2e63 444e 415f 6368 616e 6765 2c20 6e76  .cDNA_change, nv
+000857d0: 2e43 6f64 6f6e 5f63 6861 6e67 652c 205c  .Codon_change, \
+000857e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000857f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085800: 206e 762e 5072 6f74 6569 6e5f 6368 616e   nv.Protein_chan
+00085810: 6765 2c20 6e76 2e50 726f 7465 696e 5f63  ge, nv.Protein_c
+00085820: 6861 6e67 6532 2c20 6e76 2e76 5f63 6c61  hange2, nv.v_cla
+00085830: 7373 5f74 7220 290a 2020 2020 7265 7475  ss_tr ).    retu
+00085840: 726e 206e 7669 0a0a 6465 6620 5374 7269  rn nvi..def Stri
+00085850: 6e67 4669 785f 7379 6e74 6865 7369 7328  ngFix_synthesis(
+00085860: 6774 665f 6669 6c65 2c20 6765 6e6f 6d65  gtf_file, genome
+00085870: 5f66 696c 652c 2072 6576 203d 2054 7275  _file, rev = Tru
+00085880: 652c 206e 5f63 6f72 6573 203d 2031 2c20  e, n_cores = 1, 
+00085890: 6f75 745f 6469 7220 3d20 4e6f 6e65 2c20  out_dir = None, 
+000858a0: 6764 7320 3d20 4e6f 6e65 293a 0a0a 2020  gds = None):..  
+000858b0: 2020 2320 7072 696e 7428 2753 7472 696e    # print('Strin
+000858c0: 6746 6978 5f73 796e 7468 6573 6973 2073  gFix_synthesis s
+000858d0: 7461 7274 6564 2027 2c20 6461 7465 7469  tarted ', dateti
+000858e0: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
+000858f0: 2929 0a20 2020 200a 2020 2020 6966 2069  )).    .    if i
+00085900: 7369 6e73 7461 6e63 6528 6765 6e6f 6d65  sinstance(genome
+00085910: 5f66 696c 652c 2073 7472 293a 0a20 2020  _file, str):.   
+00085920: 2020 2020 2067 656e 6f6d 6520 3d20 6c6f       genome = lo
+00085930: 6164 5f67 656e 6f6d 6528 6765 6e6f 6d65  ad_genome(genome
+00085940: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
+00085950: 2054 7275 6529 0a20 2020 2065 6c73 653a   True).    else:
+00085960: 0a20 2020 2020 2020 2067 656e 6f6d 6520  .        genome 
+00085970: 3d20 6765 6e6f 6d65 5f66 696c 650a 0a20  = genome_file.. 
+00085980: 2020 2069 6620 6764 7320 6973 204e 6f6e     if gds is Non
+00085990: 653a 0a20 2020 2020 2020 2067 7466 5f6c  e:.        gtf_l
+000859a0: 696e 6573 2c20 6864 725f 6c69 6e65 7320  ines, hdr_lines 
+000859b0: 3d20 6c6f 6164 5f67 7466 2867 7466 5f66  = load_gtf(gtf_f
+000859c0: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
+000859d0: 7275 6529 0a20 2020 2020 2020 2067 645f  rue).        gd_
+000859e0: 6c73 742c 2063 6872 7320 3d20 6765 745f  lst, chrs = get_
+000859f0: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
+00085a00: 6774 665f 6c69 6e65 732c 2067 656e 6f6d  gtf_lines, genom
+00085a10: 6520 3d20 4e6f 6e65 2c20 6669 6c6c 203d  e = None, fill =
+00085a20: 2054 7275 652c 205c 0a20 2020 2020 2020   True, \.       
+00085a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085a50: 2020 2020 2020 2020 6367 203d 2054 7275          cg = Tru
+00085a60: 652c 2076 6572 626f 7365 203d 2054 7275  e, verbose = Tru
+00085a70: 652c 206e 5f63 6f72 6573 203d 2031 290a  e, n_cores = 1).
+00085a80: 2020 2020 2020 2020 6764 5f6c 7374 732c          gd_lsts,
+00085a90: 2063 6872 5f6c 7374 203d 2070 6163 6b5f   chr_lst = pack_
+00085aa0: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
+00085ab0: 2067 645f 6c73 742c 2063 6872 7320 290a   gd_lst, chrs ).
+00085ac0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00085ad0: 2066 6f72 2067 646c 2069 6e20 6764 5f6c   for gdl in gd_l
+00085ae0: 7374 733a 200a 2020 2020 2020 2020 2020  sts: .          
+00085af0: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
+00085b00: 6e75 6d65 7261 7465 2867 646c 293a 0a20  numerate(gdl):. 
+00085b10: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00085b20: 642e 7365 745f 636f 765f 6e5f 6162 6e5f  d.set_cov_n_abn_
+00085b30: 7468 2820 4d49 4e5f 434f 565f 544f 5f53  th( MIN_COV_TO_S
+00085b40: 454c 2c20 4d49 4e5f 4142 4e5f 544f 5f53  EL, MIN_ABN_TO_S
+00085b50: 454c 2029 0a0a 2020 2020 2020 2020 6e74  EL )..        nt
+00085b60: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
+00085b70: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
+00085b80: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
+00085b90: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
+00085ba0: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
+00085bb0: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
+00085bc0: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
+00085bd0: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
+00085be0: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
+00085bf0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00085c00: 725f 6c73 745f 6e65 772e 6170 7065 6e64  r_lst_new.append
+00085c10: 2863 6872 6d29 0a20 2020 2020 2020 2020  (chrm).         
+00085c20: 2020 2020 2020 2067 6763 5f74 7570 6c65         ggc_tuple
+00085c30: 2e61 7070 656e 6428 2028 6764 5f6c 7374  .append( (gd_lst
+00085c40: 735b 6b6b 5d2c 2067 656e 6f6d 655b 6368  s[kk], genome[ch
+00085c50: 726d 5d2e 7365 712c 2063 6872 6d29 2029  rm].seq, chrm) )
+00085c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00085c70: 2066 6f72 2067 6420 696e 2067 645f 6c73   for gd in gd_ls
+00085c80: 7473 5b6b 6b5d 3a0a 2020 2020 2020 2020  ts[kk]:.        
+00085c90: 2020 2020 2020 2020 2020 2020 6e74 725f              ntr_
+00085ca0: 7661 6c69 6420 2b3d 2067 642e 6e74 720a  valid += gd.ntr.
+00085cb0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00085cc0: 274e 5f74 7273 2076 616c 6964 203d 2025  'N_trs valid = %
+00085cd0: 6927 2025 206e 7472 5f76 616c 6964 290a  i' % ntr_valid).
+00085ce0: 2020 2020 2020 2020 6465 6c20 6764 5f6c          del gd_l
+00085cf0: 7374 730a 0a20 2020 2065 6c73 653a 0a20  sts..    else:. 
+00085d00: 2020 2020 2020 2067 7466 5f6c 696e 6573         gtf_lines
+00085d10: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
+00085d20: 6164 5f67 7466 2867 7466 5f66 696c 652c  ad_gtf(gtf_file,
+00085d30: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
+00085d40: 2c20 686f 203d 2054 7275 6529 0a0a 2020  , ho = True)..  
+00085d50: 2020 2020 2020 666d 203d 207b 274d 273a        fm = {'M':
+00085d60: 2027 6578 6f6e 272c 2027 4927 3a20 2769   'exon', 'I': 'i
+00085d70: 6e73 6572 7369 6f6e 272c 2027 4427 3a20  nsersion', 'D': 
+00085d80: 2764 656c 6574 696f 6e27 7d0a 2020 2020  'deletion'}.    
+00085d90: 2020 2020 666f 7220 6d2c 2067 6420 696e      for m, gd in
+00085da0: 2065 6e75 6d65 7261 7465 2867 6473 293a   enumerate(gds):
+00085db0: 0a20 2020 2020 2020 2020 2020 2067 642e  .            gd.
+00085dc0: 7365 745f 636f 765f 6e5f 6162 6e5f 7468  set_cov_n_abn_th
+00085dd0: 2820 4d49 4e5f 434f 565f 544f 5f53 454c  ( MIN_COV_TO_SEL
+00085de0: 2c20 4d49 4e5f 4142 4e5f 544f 5f53 454c  , MIN_ABN_TO_SEL
+00085df0: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+00085e00: 6620 286c 656e 2867 642e 7267 6e73 2e72  f (len(gd.rgns.r
+00085e10: 676e 7329 203e 2030 293a 0a20 2020 2020  gns) > 0):.     
+00085e20: 2020 2020 2020 2020 2020 2067 642e 6578             gd.ex
+00085e30: 6f6e 732e 7267 6e73 2c20 6764 2e72 676e  ons.rgns, gd.rgn
+00085e40: 732e 7267 6e73 203d 2067 642e 7267 6e73  s.rgns = gd.rgns
+00085e50: 2e72 676e 732c 2067 642e 6578 6f6e 732e  .rgns, gd.exons.
+00085e60: 7267 6e73 0a20 2020 2020 2020 2020 2020  rgns.           
+00085e70: 2020 2020 2067 642e 7465 5f74 6f5f 6765       gd.te_to_ge
+00085e80: 5f6d 6170 732c 2067 642e 7472 5f74 6f5f  _maps, gd.tr_to_
+00085e90: 6772 5f6d 6170 7320 3d20 6764 2e74 725f  gr_maps = gd.tr_
+00085ea0: 746f 5f67 725f 6d61 7073 2c20 6764 2e74  to_gr_maps, gd.t
+00085eb0: 655f 746f 5f67 655f 6d61 7073 0a20 2020  e_to_ge_maps.   
+00085ec0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00085ed0: 2020 2020 2020 2020 2020 666f 7220 7220            for r 
+00085ee0: 696e 2067 642e 6578 6f6e 732e 7267 6e73  in gd.exons.rgns
+00085ef0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00085f00: 2020 6966 2072 2e74 7970 6520 696e 2066    if r.type in f
+00085f10: 6d2e 6b65 7973 2829 3a0a 2020 2020 2020  m.keys():.      
+00085f20: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+00085f30: 7479 7065 203d 2066 6d5b 722e 7479 7065  type = fm[r.type
+00085f40: 5d0a 0a20 2020 2020 2020 2063 6872 7320  ]..        chrs 
+00085f50: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00085f60: 2067 6420 696e 2067 6473 3a20 0a20 2020   gd in gds: .   
+00085f70: 2020 2020 2020 2020 2063 6872 732e 6170           chrs.ap
+00085f80: 7065 6e64 2867 642e 6368 7229 0a0a 2020  pend(gd.chr)..  
+00085f90: 2020 2020 2020 6368 725f 6c73 7420 3d20        chr_lst = 
+00085fa0: 6c69 7374 2873 6574 2863 6872 7329 290a  list(set(chrs)).
+00085fb0: 2020 2020 2020 2020 6368 725f 6c73 742e          chr_lst.
+00085fc0: 736f 7274 2829 0a20 2020 2020 2020 2063  sort().        c
+00085fd0: 6872 7320 3d20 6e70 2e61 7272 6179 2863  hrs = np.array(c
+00085fe0: 6872 7329 0a0a 2020 2020 2020 2020 6e74  hrs)..        nt
+00085ff0: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
+00086000: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
+00086010: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
+00086020: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
+00086030: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
+00086040: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
+00086050: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
+00086060: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
+00086070: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
+00086080: 2020 2020 2020 2020 2020 2020 2020 7768                wh
+00086090: 203d 2077 6869 6368 2863 6872 7320 3d3d   = which(chrs ==
+000860a0: 2063 6872 6d29 0a20 2020 2020 2020 2020   chrm).         
+000860b0: 2020 2020 2020 2069 6620 6c65 6e28 7768         if len(wh
+000860c0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+000860d0: 2020 2020 2020 2020 2020 2073 5f70 6f73             s_pos
+000860e0: 203d 206e 702e 7a65 726f 7328 6c65 6e28   = np.zeros(len(
+000860f0: 7768 292c 6474 7970 653d 6e70 2e66 6c6f  wh),dtype=np.flo
+00086100: 6174 3332 290a 2020 2020 2020 2020 2020  at32).          
+00086110: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
+00086120: 696e 2072 616e 6765 286c 656e 2877 6829  in range(len(wh)
+00086130: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
+00086140: 2020 2020 2020 2020 2020 2020 735f 706f              s_po
+00086150: 735b 6b5d 203d 2067 6473 5b77 685b 6b5d  s[k] = gds[wh[k]
+00086160: 5d2e 6265 6769 6e0a 2020 2020 2020 2020  ].begin.        
+00086170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086180: 6e74 725f 7661 6c69 6420 2b3d 2067 642e  ntr_valid += gd.
+00086190: 6e74 720a 2020 2020 2020 2020 2020 2020  ntr.            
+000861a0: 2020 2020 2020 2020 6f64 7220 3d20 735f          odr = s_
+000861b0: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
+000861c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000861d0: 2020 2063 6872 5f6c 7374 5f6e 6577 2e61     chr_lst_new.a
+000861e0: 7070 656e 6428 6368 726d 290a 2020 2020  ppend(chrm).    
 000861f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086200: 2020 2063 6872 5f6c 7374 5f6e 6577 2e61     chr_lst_new.a
-00086210: 7070 656e 6428 6368 726d 290a 2020 2020  ppend(chrm).    
-00086220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086230: 6767 635f 7475 706c 652e 6170 7065 6e64  ggc_tuple.append
-00086240: 2820 285b 2067 6473 5b77 685b 6f64 725b  ( ([ gds[wh[odr[
-00086250: 6b5d 5d5d 2066 6f72 206b 2069 6e20 7261  k]]] for k in ra
-00086260: 6e67 6528 6c65 6e28 7768 2929 205d 2c20  nge(len(wh)) ], 
-00086270: 6765 6e6f 6d65 5b63 6872 6d5d 2e73 6571  genome[chrm].seq
-00086280: 2c20 6368 726d 2920 290a 0a20 2020 2020  , chrm) )..     
-00086290: 2020 2023 2070 7269 6e74 2827 4e5f 7472     # print('N_tr
-000862a0: 7320 7661 6c69 6420 3d20 2569 2720 2520  s valid = %i' % 
-000862b0: 6e74 725f 7661 6c69 6429 0a20 2020 2020  ntr_valid).     
-000862c0: 2020 2064 656c 2067 6473 0a0a 0a20 2020     del gds...   
-000862d0: 2066 696c 655f 6e61 6d65 203d 2067 7466   file_name = gtf
-000862e0: 5f66 696c 652e 7370 6c69 7428 272f 2729  _file.split('/')
-000862f0: 5b2d 315d 0a20 2020 2023 2066 6e61 6d65  [-1].    # fname
-00086300: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
-00086310: 6974 2827 2e27 295b 305d 0a20 2020 2066  it('.')[0].    f
-00086320: 6e73 203d 2066 696c 655f 6e61 6d65 2e73  ns = file_name.s
-00086330: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
-00086340: 2020 2066 6e61 6d65 203d 2027 270a 2020     fname = ''.  
-00086350: 2020 666f 7220 6b2c 2066 6e20 696e 2065    for k, fn in e
-00086360: 6e75 6d65 7261 7465 2866 6e73 293a 0a20  numerate(fns):. 
-00086370: 2020 2020 2020 2069 6620 6b20 3e20 303a         if k > 0:
-00086380: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
-00086390: 6d65 203d 2066 6e61 6d65 202b 2027 2e27  me = fname + '.'
-000863a0: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
-000863b0: 2066 6e61 6d65 202b 2066 6e0a 0a20 2020   fname + fn..   
-000863c0: 2069 6620 6f75 745f 6469 7220 6973 206e   if out_dir is n
-000863d0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000863e0: 2069 6620 6f75 745f 6469 725b 2d31 5d20   if out_dir[-1] 
-000863f0: 3d3d 2027 2f27 3a0a 2020 2020 2020 2020  == '/':.        
-00086400: 2020 2020 666e 616d 6520 3d20 6f75 745f      fname = out_
-00086410: 6469 7220 2b20 666e 616d 650a 2020 2020  dir + fname.    
-00086420: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00086430: 2020 2020 2020 666e 616d 6520 3d20 6f75        fname = ou
-00086440: 745f 6469 7220 2b20 272f 2720 2b20 666e  t_dir + '/' + fn
-00086450: 616d 650a 0a20 2020 2067 656e 6f6d 655f  ame..    genome_
-00086460: 6669 6c65 5f6e 6577 203d 2066 6e61 6d65  file_new = fname
-00086470: 202b 2027 5f63 7573 746f 6d69 7a65 645f   + '_customized_
-00086480: 6765 6e6f 6d65 2e66 6127 0a20 2020 2067  genome.fa'.    g
-00086490: 7466 5f66 696c 655f 6e65 7720 3d20 666e  tf_file_new = fn
-000864a0: 616d 6520 2b20 275f 6375 7374 6f6d 697a  ame + '_customiz
-000864b0: 6564 2e67 7466 270a 2020 2020 6661 5f66  ed.gtf'.    fa_f
-000864c0: 696c 655f 7472 5f6e 6577 203d 2066 6e61  ile_tr_new = fna
-000864d0: 6d65 202b 2027 5f74 7261 6e73 6372 6970  me + '_transcrip
-000864e0: 746f 6d65 2e66 6127 0a20 2020 2066 615f  tome.fa'.    fa_
-000864f0: 6669 6c65 5f70 725f 6e65 7720 3d20 666e  file_pr_new = fn
-00086500: 616d 6520 2b20 275f 7072 6f74 656f 6d65  ame + '_proteome
-00086510: 2e66 6127 0a20 2020 2066 6e61 6d65 5f73  .fa'.    fname_s
-00086520: 6e76 203d 2066 6e61 6d65 202b 2027 5f73  nv = fname + '_s
-00086530: 6e76 5f73 756d 6d61 7279 2e74 7376 270a  nv_summary.tsv'.
-00086540: 2020 2020 666e 616d 655f 7663 6620 3d20      fname_vcf = 
-00086550: 666e 616d 6520 2b20 275f 736e 765f 7375  fname + '_snv_su
-00086560: 6d6d 6172 792e 7663 6627 0a0a 2020 2020  mmary.vcf'..    
-00086570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000865a0: 2323 2323 2323 0a20 2020 2063 6872 5f6c  ######.    chr_l
-000865b0: 7374 203d 2063 6872 5f6c 7374 5f6e 6577  st = chr_lst_new
-000865c0: 0a0a 2020 2020 6f66 5f64 6963 7420 3d20  ..    of_dict = 
-000865d0: 7b7d 0a20 2020 2023 2067 6473 5f6c 7374  {}.    # gds_lst
-000865e0: 203d 205b 5d0a 2020 2020 2320 736e 765f   = [].    # snv_
-000865f0: 6c73 7420 3d20 5b5d 0a20 2020 2067 6473  lst = [].    gds
-00086600: 5f6e 6577 203d 205b 5d0a 2020 2020 736e  _new = [].    sn
-00086610: 765f 696e 666f 5f6c 7374 203d 205b 5d0a  v_info_lst = [].
-00086620: 0a20 2020 206e 5f62 6173 6573 5f74 6f74  .    n_bases_tot
-00086630: 616c 203d 2030 0a20 2020 206e 5f65 725f  al = 0.    n_er_
-00086640: 6261 7365 7320 3d20 300a 2020 2020 6e5f  bases = 0.    n_
-00086650: 626c 6b5f 746f 7461 6c20 3d20 300a 2020  blk_total = 0.  
-00086660: 2020 6e5f 6572 5f62 6c6b 203d 2030 0a20    n_er_blk = 0. 
-00086670: 2020 206e 7074 203d 2030 0a20 2020 206e     npt = 0.    n
-00086680: 7065 203d 2030 0a20 2020 200a 2020 2020  pe = 0.    .    
-00086690: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
-000866a0: 652e 7469 6d65 2829 0a20 2020 2069 6620  e.time().    if 
-000866b0: 286e 5f63 6f72 6573 203d 3d20 3129 207c  (n_cores == 1) |
-000866c0: 2028 6c65 6e28 6368 725f 6c73 7429 203d   (len(chr_lst) =
-000866d0: 3d20 3129 3a0a 2020 2020 2020 2020 666f  = 1):.        fo
-000866e0: 7220 6b6b 2069 6e20 7261 6e67 6528 6c65  r kk in range(le
-000866f0: 6e28 6368 725f 6c73 7429 293a 0a20 2020  n(chr_lst)):.   
-00086700: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00086710: 5c72 2720 2b20 2720 272a 3130 302c 2065  \r' + ' '*100, e
-00086720: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
-00086730: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00086740: 2070 7269 6e74 2827 5c72 5265 636f 6e73   print('\rRecons
-00086750: 7472 7563 7469 6e67 202e 2e20 2569 2f25  tructing .. %i/%
-00086760: 6920 2825 7329 2027 2025 2028 6b6b 2b31  i (%s) ' % (kk+1
-00086770: 2c20 6c65 6e28 6368 725f 6c73 7429 2c20  , len(chr_lst), 
-00086780: 6368 725f 6c73 745b 6b6b 5d29 2c20 656e  chr_lst[kk]), en
-00086790: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
-000867a0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000867b0: 2020 6764 5f73 656c 2c20 7365 715f 6e65    gd_sel, seq_ne
-000867c0: 772c 2073 6e76 5f69 6e66 6f5f 6368 722c  w, snv_info_chr,
-000867d0: 206f 662c 2063 6872 6d2c 2065 7374 6174   of, chrm, estat
-000867e0: 203d 206d 635f 636f 7265 5f72 6563 6f6e   = mc_core_recon
-000867f0: 7374 7275 6374 696f 6e28 6767 635f 7475  struction(ggc_tu
-00086800: 706c 655b 6b6b 5d29 0a20 2020 2020 2020  ple[kk]).       
-00086810: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00086820: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00086830: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
-00086840: 6d65 5b63 6872 6d5d 2e73 6571 203d 2073  me[chrm].seq = s
-00086850: 6571 5f6e 6577 0a20 2020 2020 2020 2020  eq_new.         
-00086860: 2020 206f 665f 6469 6374 5b63 6872 6d5d     of_dict[chrm]
-00086870: 203d 206f 660a 2020 2020 2020 2020 2020   = of.          
-00086880: 2020 2320 6764 735f 6c73 742e 6170 7065    # gds_lst.appe
-00086890: 6e64 2867 645f 7365 6c29 0a20 2020 2020  nd(gd_sel).     
-000868a0: 2020 2020 2020 2023 2073 6e76 5f6c 7374         # snv_lst
-000868b0: 2e61 7070 656e 6428 736e 765f 696e 666f  .append(snv_info
-000868c0: 5f63 6872 290a 2020 2020 2020 2020 2020  _chr).          
-000868d0: 2020 6764 735f 6e65 7720 3d20 6764 735f    gds_new = gds_
-000868e0: 6e65 7720 2b20 6764 5f73 656c 0a20 2020  new + gd_sel.   
-000868f0: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
-00086900: 6f5f 6c73 7420 3d20 736e 765f 696e 666f  o_lst = snv_info
-00086910: 5f6c 7374 202b 2073 6e76 5f69 6e66 6f5f  _lst + snv_info_
-00086920: 6368 720a 0a20 2020 2020 2020 2020 2020  chr..           
-00086930: 206e 6274 2c20 6e62 652c 206e 6c74 2c20   nbt, nbe, nlt, 
-00086940: 6e6c 652c 206e 742c 206e 653d 2065 7374  nle, nt, ne= est
-00086950: 6174 0a20 2020 2020 2020 2020 2020 206e  at.            n
-00086960: 5f62 6173 6573 5f74 6f74 616c 202b 3d20  _bases_total += 
-00086970: 6e62 740a 2020 2020 2020 2020 2020 2020  nbt.            
-00086980: 6e5f 6572 5f62 6173 6573 202b 3d20 6e62  n_er_bases += nb
-00086990: 650a 2020 2020 2020 2020 2020 2020 6e5f  e.            n_
-000869a0: 626c 6b5f 746f 7461 6c20 2b3d 206e 6c74  blk_total += nlt
-000869b0: 0a20 2020 2020 2020 2020 2020 206e 5f65  .            n_e
-000869c0: 725f 626c 6b20 2b3d 206e 6c65 0a20 2020  r_blk += nle.   
-000869d0: 2020 2020 2020 2020 206e 7074 202b 3d20           npt += 
-000869e0: 6e74 0a20 2020 2020 2020 2020 2020 206e  nt.            n
-000869f0: 7065 202b 3d20 6e65 0a20 2020 2020 2020  pe += ne.       
-00086a00: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00086a10: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00086a20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00086a30: 2020 6e75 6d5f 636f 7265 203d 206d 696e    num_core = min
-00086a40: 2820 6e5f 636f 7265 732c 2028 6370 755f  ( n_cores, (cpu_
-00086a50: 636f 756e 7428 2920 2d20 3129 2029 0a20  count() - 1) ). 
-00086a60: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
-00086a70: 6e75 6d20 636f 7265 7320 746f 2075 7365  num cores to use
-00086a80: 203d 207b 7d22 2e66 6f72 6d61 7428 6e75   = {}".format(nu
-00086a90: 6d5f 636f 7265 2929 0a20 2020 2020 2020  m_core)).       
-00086aa0: 2070 6f6f 6c20 3d20 506f 6f6c 286e 756d   pool = Pool(num
-00086ab0: 5f63 6f72 6529 0a20 2020 2020 2020 2063  _core).        c
-00086ac0: 6e74 203d 2031 0a20 2020 2020 2020 2066  nt = 1.        f
-00086ad0: 6f72 2067 645f 7365 6c2c 2073 6571 5f6e  or gd_sel, seq_n
-00086ae0: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
-00086af0: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
-00086b00: 7420 696e 205c 0a20 2020 2020 2020 2020  t in \.         
-00086b10: 2020 2070 6f6f 6c2e 696d 6170 5f75 6e6f     pool.imap_uno
-00086b20: 7264 6572 6564 286d 635f 636f 7265 5f72  rdered(mc_core_r
-00086b30: 6563 6f6e 7374 7275 6374 696f 6e2c 2067  econstruction, g
-00086b40: 6763 5f74 7570 6c65 293a 0a20 2020 2020  gc_tuple):.     
-00086b50: 2020 2020 2020 2023 2074 7164 6d2e 7471         # tqdm.tq
-00086b60: 646d 5f6e 6f74 6562 6f6f 6b28 706f 6f6c  dm_notebook(pool
-00086b70: 2e69 6d61 705f 756e 6f72 6465 7265 6428  .imap_unordered(
-00086b80: 6d63 5f63 6f72 655f 7265 636f 6e73 7472  mc_core_reconstr
-00086b90: 7563 7469 6f6e 2c20 6767 635f 7475 706c  uction, ggc_tupl
-00086ba0: 6529 2c20 746f 7461 6c3d 6c65 6e28 6767  e), total=len(gg
-00086bb0: 635f 7475 706c 6529 293a 0a20 2020 2020  c_tuple)):.     
-00086bc0: 2020 2020 2020 2023 2323 2323 2323 2323         #########
-00086bd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086be0: 230a 2020 2020 2020 2020 2020 2020 6765  #.            ge
-00086bf0: 6e6f 6d65 5b63 6872 6d5d 2e73 6571 203d  nome[chrm].seq =
-00086c00: 2073 6571 5f6e 6577 0a20 2020 2020 2020   seq_new.       
-00086c10: 2020 2020 206f 665f 6469 6374 5b63 6872       of_dict[chr
-00086c20: 6d5d 203d 206f 660a 2020 2020 2020 2020  m] = of.        
-00086c30: 2020 2020 2320 6764 735f 6c73 742e 6170      # gds_lst.ap
-00086c40: 7065 6e64 2867 645f 7365 6c29 0a20 2020  pend(gd_sel).   
-00086c50: 2020 2020 2020 2020 2023 2073 6e76 5f6c           # snv_l
-00086c60: 7374 2e61 7070 656e 6428 736e 765f 696e  st.append(snv_in
-00086c70: 666f 5f63 6872 290a 2020 2020 2020 2020  fo_chr).        
-00086c80: 2020 2020 6764 735f 6e65 7720 3d20 6764      gds_new = gd
-00086c90: 735f 6e65 7720 2b20 6764 5f73 656c 0a20  s_new + gd_sel. 
-00086ca0: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
-00086cb0: 6e66 6f5f 6c73 7420 3d20 736e 765f 696e  nfo_lst = snv_in
-00086cc0: 666f 5f6c 7374 202b 2073 6e76 5f69 6e66  fo_lst + snv_inf
-00086cd0: 6f5f 6368 720a 2020 2020 2020 2020 2020  o_chr.          
-00086ce0: 2020 0a20 2020 2020 2020 2020 2020 206e    .            n
-00086cf0: 6274 2c20 6e62 652c 206e 6c74 2c20 6e6c  bt, nbe, nlt, nl
-00086d00: 652c 206e 742c 206e 653d 2065 7374 6174  e, nt, ne= estat
-00086d10: 0a20 2020 2020 2020 2020 2020 206e 5f62  .            n_b
-00086d20: 6173 6573 5f74 6f74 616c 202b 3d20 6e62  ases_total += nb
-00086d30: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
-00086d40: 6572 5f62 6173 6573 202b 3d20 6e62 650a  er_bases += nbe.
-00086d50: 2020 2020 2020 2020 2020 2020 6e5f 626c              n_bl
-00086d60: 6b5f 746f 7461 6c20 2b3d 206e 6c74 0a20  k_total += nlt. 
-00086d70: 2020 2020 2020 2020 2020 206e 5f65 725f             n_er_
-00086d80: 626c 6b20 2b3d 206e 6c65 0a20 2020 2020  blk += nle.     
-00086d90: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
-00086da0: 0a20 2020 2020 2020 2020 2020 206e 7065  .            npe
-00086db0: 202b 3d20 6e65 0a20 2020 2020 2020 2020   += ne.         
-00086dc0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00086dd0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00086de0: 2020 2020 2020 2020 2020 636e 7420 2b3d            cnt +=
-00086df0: 2031 0a20 2020 2020 2020 2020 2020 2070   1.            p
-00086e00: 7269 6e74 2827 5c72 5265 636f 6e73 7472  rint('\rReconstr
-00086e10: 7563 7469 6e67 2028 2569 2920 2e2e 2025  ucting (%i) .. %
-00086e20: 692f 2569 2028 2573 2920 2020 2020 2020  i/%i (%s)       
-00086e30: 2020 2020 2027 2025 2028 6e75 6d5f 636f       ' % (num_co
-00086e40: 7265 2c20 636e 742c 206c 656e 2867 6763  re, cnt, len(ggc
-00086e50: 5f74 7570 6c65 292c 2063 6872 6d29 2c20  _tuple), chrm), 
-00086e60: 656e 6420 3d20 2720 2020 2020 2020 2020  end = '         
-00086e70: 2020 2020 2020 2020 2020 2020 2729 0a20              '). 
-00086e80: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00086e90: 2020 2020 706f 6f6c 2e63 6c6f 7365 2829      pool.close()
-00086ea0: 0a20 2020 2020 2020 2070 6f6f 6c2e 6a6f  .        pool.jo
-00086eb0: 696e 2829 0a20 2020 2020 2020 200a 2020  in().        .  
-00086ec0: 2020 2727 270a 2020 2020 6764 735f 6e65    '''.    gds_ne
-00086ed0: 7720 3d20 5b5d 0a20 2020 2073 6e76 5f69  w = [].    snv_i
-00086ee0: 6e66 6f5f 6c73 7420 3d20 5b5d 0a20 2020  nfo_lst = [].   
-00086ef0: 2066 6f72 206b 6b2c 2063 6872 6d20 696e   for kk, chrm in
-00086f00: 2065 6e75 6d65 7261 7465 2863 6872 5f6c   enumerate(chr_l
-00086f10: 7374 293a 0a20 2020 2020 2020 2067 6473  st):.        gds
-00086f20: 5f6e 6577 203d 2067 6473 5f6e 6577 202b  _new = gds_new +
-00086f30: 2067 6473 5f6c 7374 5b6b 6b5d 0a20 2020   gds_lst[kk].   
-00086f40: 2020 2020 2073 6e76 5f69 6e66 6f5f 6c73       snv_info_ls
-00086f50: 7420 3d20 736e 765f 696e 666f 5f6c 7374  t = snv_info_lst
-00086f60: 202b 2073 6e76 5f6c 7374 5b6b 6b5d 0a0a   + snv_lst[kk]..
-00086f70: 2020 2020 6465 6c20 6764 735f 6c73 740a      del gds_lst.
-00086f80: 2020 2020 2327 2727 0a20 2020 2020 0a20      #'''.     . 
-00086f90: 2020 2065 6c61 7073 6564 5f74 696d 6532     elapsed_time2
-00086fa0: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
-00086fb0: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
-00086fc0: 7072 696e 7428 275c 7252 6563 6f6e 7374  print('\rReconst
-00086fd0: 7275 6374 696f 6e20 2e2e 2064 6f6e 652e  ruction .. done.
-00086fe0: 2028 2569 2920 2020 2020 2020 2020 2020   (%i)           
-00086ff0: 2027 2025 2028 656c 6170 7365 645f 7469   ' % (elapsed_ti
-00087000: 6d65 3229 2c20 666c 7573 6820 3d20 5472  me2), flush = Tr
-00087010: 7565 290a 2020 2020 7072 696e 7428 2749  ue).    print('I
-00087020: 6e74 6567 7269 7479 2063 6865 636b 3a20  ntegrity check: 
-00087030: 2025 692f 2569 2c20 2569 2f25 692c 2025   %i/%i, %i/%i, %
-00087040: 692f 2569 2720 2520 5c0a 2020 2020 2020  i/%i' % \.      
-00087050: 2020 2020 286e 5f65 725f 6261 7365 732c      (n_er_bases,
-00087060: 206e 5f62 6173 6573 5f74 6f74 616c 2c20   n_bases_total, 
-00087070: 6e5f 6572 5f62 6c6b 2c20 6e5f 626c 6b5f  n_er_blk, n_blk_
-00087080: 746f 7461 6c2c 206e 7065 2c20 6e70 7429  total, npe, npt)
-00087090: 2c20 666c 7573 6820 3d20 5472 7565 2029  , flush = True )
-000870a0: 0a20 2020 2020 200a 2020 2020 2727 2720  .      .    ''' 
-000870b0: 200a 2020 2020 4e74 725f 616c 6c20 3d20   .    Ntr_all = 
-000870c0: 300a 2020 2020 666f 7220 6764 2069 6e20  0.    for gd in 
-000870d0: 6764 735f 6e65 773a 204e 7472 5f61 6c6c  gds_new: Ntr_all
-000870e0: 202b 3d20 6764 2e6e 7472 0a20 2020 2070   += gd.ntr.    p
-000870f0: 7269 6e74 2827 4e5f 7472 2028 6166 7465  rint('N_tr (afte
-00087100: 7229 203d 2025 6927 2025 204e 7472 5f61  r) = %i' % Ntr_a
-00087110: 6c6c 290a 0a20 2020 206e 5f74 7220 3d20  ll)..    n_tr = 
-00087120: 300a 2020 2020 6e5f 6e65 675f 636f 7620  0.    n_neg_cov 
-00087130: 3d20 300a 2020 2020 6e5f 706f 735f 636f  = 0.    n_pos_co
-00087140: 7620 3d20 300a 2020 2020 666f 7220 6764  v = 0.    for gd
-00087150: 2069 6e20 6764 735f 6e65 773a 0a20 2020   in gds_new:.   
-00087160: 2020 2020 206e 5f74 7220 2b3d 2067 642e       n_tr += gd.
-00087170: 6e74 720a 2020 2020 2020 2020 666f 7220  ntr.        for 
-00087180: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
-00087190: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000871a0: 7464 2e63 6f76 203c 3d20 303a 206e 5f6e  td.cov <= 0: n_n
-000871b0: 6567 5f63 6f76 202b 3d20 310a 2020 2020  eg_cov += 1.    
-000871c0: 2020 2020 2020 2020 656c 6966 2074 642e          elif td.
-000871d0: 636f 7620 3e20 303a 206e 5f70 6f73 5f63  cov > 0: n_pos_c
-000871e0: 6f76 202b 3d20 310a 2020 2020 7072 696e  ov += 1.    prin
-000871f0: 7428 274e 5f74 7273 203d 2025 692c 2025  t('N_trs = %i, %
-00087200: 692c 2025 6927 2025 2028 6e5f 7472 2c20  i, %i' % (n_tr, 
-00087210: 6e5f 6e65 675f 636f 762c 206e 5f70 6f73  n_neg_cov, n_pos
-00087220: 5f63 6f76 2929 0a20 2020 2023 2727 270a  _cov)).    #'''.
-00087230: 2020 2020 2020 2020 0a20 2020 2073 7461          .    sta
-00087240: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
-00087250: 696d 6528 290a 2020 2020 6774 665f 6c69  ime().    gtf_li
-00087260: 6e65 7320 3d20 5b5d 0a20 2020 2066 615f  nes = [].    fa_
-00087270: 6c69 6e65 735f 7472 203d 205b 5d0a 2020  lines_tr = [].  
-00087280: 2020 6661 5f6c 696e 6573 5f70 7220 3d20    fa_lines_pr = 
-00087290: 5b5d 0a0a 2020 2020 2320 7361 7665 5f67  []..    # save_g
-000872a0: 7466 3228 2066 6e61 6d65 2c20 6774 665f  tf2( fname, gtf_
-000872b0: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
-000872c0: 2068 6472 203d 204e 6f6e 652c 2066 6f20   hdr = None, fo 
-000872d0: 3d20 4e6f 6e65 2063 6c6f 7365 203d 2046  = None close = F
-000872e0: 616c 7365 2029 0a20 2020 200a 2020 2020  alse ).    .    
-000872f0: 6966 2072 6576 3a20 0a20 2020 2020 2020  if rev: .       
-00087300: 2068 6472 5f6c 696e 6573 2e61 7070 656e   hdr_lines.appen
-00087310: 6428 2752 6566 2e20 6765 6e6f 6d65 3a20  d('Ref. genome: 
-00087320: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
-00087330: 6529 0a20 2020 2020 2020 2066 5f67 7466  e).        f_gtf
-00087340: 203d 2073 6176 655f 6774 6632 2820 6774   = save_gtf2( gt
-00087350: 665f 6669 6c65 5f6e 6577 2c20 6774 665f  f_file_new, gtf_
-00087360: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
-00087370: 2068 6472 203d 2068 6472 5f6c 696e 6573   hdr = hdr_lines
-00087380: 2029 0a0a 2020 2020 6674 203d 206f 7065   )..    ft = ope
-00087390: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
-000873a0: 2c20 2777 2b27 290a 2020 2020 6670 203d  , 'w+').    fp =
-000873b0: 206f 7065 6e28 6661 5f66 696c 655f 7072   open(fa_file_pr
-000873c0: 5f6e 6577 2c20 2777 2b27 290a 0a20 2020  _new, 'w+')..   
-000873d0: 2067 6473 5f6e 6577 203d 2073 6f72 745f   gds_new = sort_
-000873e0: 6465 7363 7269 7074 6f72 5f6c 7374 2867  descriptor_lst(g
-000873f0: 6473 5f6e 6577 290a 2020 2020 636e 745f  ds_new).    cnt_
-00087400: 6e6f 6e65 203d 2030 0a20 2020 2070 7269  none = 0.    pri
-00087410: 6e74 2827 4765 6e65 7261 7469 6e67 2047  nt('Generating G
-00087420: 5446 2061 6e64 2054 7261 6e73 6372 6970  TF and Transcrip
-00087430: 746f 6d65 2f50 726f 7465 6f6d 6520 2e2e  tome/Proteome ..
-00087440: 2027 2c20 656e 643d 2720 2020 2027 290a   ', end='    ').
-00087450: 0a20 2020 2069 6620 6e5f 636f 7265 7320  .    if n_cores 
-00087460: 3d3d 2031 3a0a 2020 2020 2020 2020 636e  == 1:.        cn
-00087470: 745f 7420 3d20 300a 2020 2020 2020 2020  t_t = 0.        
-00087480: 636e 745f 7020 3d20 300a 2020 2020 2020  cnt_p = 0.      
-00087490: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
-000874a0: 6e75 6d65 7261 7465 2867 6473 5f6e 6577  numerate(gds_new
-000874b0: 293a 0a20 2020 2020 2020 2020 2020 200a  ):.            .
-000874c0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000874d0: 6d2b 3129 2531 3030 203d 3d20 303a 2070  m+1)%100 == 0: p
-000874e0: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
-000874f0: 6e67 2047 5446 2061 6e64 2054 7261 6e73  ng GTF and Trans
-00087500: 6372 6970 746f 6d65 2f50 726f 7465 6f6d  criptome/Proteom
-00087510: 6520 2e2e 2025 692f 2569 2720 2520 286d  e .. %i/%i' % (m
-00087520: 2c20 6c65 6e28 6764 735f 6e65 7729 292c  , len(gds_new)),
-00087530: 2065 6e64 203d 2027 2020 2027 2c20 666c   end = '   ', fl
-00087540: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-00087550: 2020 2020 2020 2020 6e74 722c 206e 7072          ntr, npr
-00087560: 2c20 6e65 7220 3d20 6764 2e75 7064 6174  , ner = gd.updat
-00087570: 655f 7464 5f69 6e66 6f28 7365 6c20 3d20  e_td_info(sel = 
-00087580: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
-00087590: 6529 2020 2020 2020 2020 2020 2020 0a20  e)            . 
-000875a0: 2020 2020 2020 2020 2020 2067 7466 6c2c             gtfl,
-000875b0: 2063 6e20 3d20 6764 2e67 6574 5f67 7466   cn = gd.get_gtf
-000875c0: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
-000875d0: 7328 7365 6c20 3d20 312c 2061 6464 5f73  s(sel = 1, add_s
-000875e0: 6571 203d 2046 616c 7365 2c20 636f 6e6e  eq = False, conn
-000875f0: 6563 7420 3d20 5472 7565 290a 2020 2020  ect = True).    
-00087600: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
-00087610: 202b 3d20 636e 0a20 2020 2020 2020 2020   += cn.         
-00087620: 2020 206c 742c 206c 7020 3d20 6764 2e67     lt, lp = gd.g
-00087630: 6574 5f66 6173 7461 5f6c 696e 6573 5f66  et_fasta_lines_f
-00087640: 726f 6d5f 6578 6f6e 7328 7365 6c20 3d20  rom_exons(sel = 
-00087650: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
-00087660: 6529 0a20 2020 2020 2020 2020 2020 206c  e).            l
-00087670: 7420 3d20 6669 6c74 6572 5f74 7273 5f6c  t = filter_trs_l
-00087680: 656e 286c 742c 206d 696e 5f6c 656e 203d  en(lt, min_len =
-00087690: 204d 494e 5f54 525f 4c45 4e47 5448 290a   MIN_TR_LENGTH).
-000876a0: 2020 2020 2020 2020 2020 2020 6c70 203d              lp =
-000876b0: 2066 696c 7465 725f 7472 735f 6c65 6e28   filter_trs_len(
-000876c0: 6c70 2c20 6d69 6e5f 6c65 6e20 3d20 4d49  lp, min_len = MI
-000876d0: 4e5f 5052 5f4c 454e 4754 4829 0a20 2020  N_PR_LENGTH).   
-000876e0: 2020 2020 2020 2020 2069 6620 7265 763a           if rev:
-000876f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00087700: 2066 5f67 7466 203d 2073 6176 655f 6774   f_gtf = save_gt
-00087710: 6632 2820 6774 665f 6669 6c65 5f6e 6577  f2( gtf_file_new
-00087720: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
-00087730: 2067 7466 6c2c 2066 6f20 3d20 665f 6774   gtfl, fo = f_gt
-00087740: 6620 2920 0a20 2020 2020 2020 2020 2020  f ) .           
-00087750: 2020 2020 2023 2067 7466 5f6c 696e 6573       # gtf_lines
-00087760: 203d 2067 7466 5f6c 696e 6573 202b 2067   = gtf_lines + g
-00087770: 7466 6c0a 2020 2020 2020 2020 0a20 2020  tfl.        .   
-00087780: 2020 2020 2020 2020 2066 742e 7772 6974           ft.writ
-00087790: 656c 696e 6573 286c 7429 0a20 2020 2020  elines(lt).     
-000877a0: 2020 2020 2020 2066 702e 7772 6974 656c         fp.writel
-000877b0: 696e 6573 286c 7029 0a20 2020 2020 2020  ines(lp).       
-000877c0: 2020 2020 2023 2066 615f 6c69 6e65 735f       # fa_lines_
-000877d0: 7472 203d 2066 615f 6c69 6e65 735f 7472  tr = fa_lines_tr
-000877e0: 202b 206c 740a 2020 2020 2020 2020 2020   + lt.          
-000877f0: 2020 2320 6661 5f6c 696e 6573 5f70 7220    # fa_lines_pr 
-00087800: 3d20 6661 5f6c 696e 6573 5f70 7220 2b20  = fa_lines_pr + 
-00087810: 6c70 0a20 2020 2020 2020 2020 2020 2063  lp.            c
-00087820: 6e74 5f74 202b 3d20 6c65 6e28 6c74 290a  nt_t += len(lt).
-00087830: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-00087840: 7020 2b3d 206c 656e 286c 7029 0a20 2020  p += len(lp).   
-00087850: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00087860: 2020 656c 6170 7365 645f 7469 6d65 3220    elapsed_time2 
-00087870: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
-00087880: 7374 6172 745f 7469 6d65 0a20 2020 2020  start_time.     
-00087890: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
-000878a0: 7261 7469 6e67 2047 5446 2061 6e64 2054  rating GTF and T
-000878b0: 7261 6e73 6372 6970 746f 6d65 2f50 726f  ranscriptome/Pro
-000878c0: 7465 6f6d 6520 2e2e 2025 692c 2025 6920  teome .. %i, %i 
-000878d0: 646f 6e65 2e20 2825 6929 2027 2025 2028  done. (%i) ' % (
-000878e0: 6c65 6e28 6764 735f 6e65 7729 2c20 636e  len(gds_new), cn
-000878f0: 745f 6e6f 6e65 2c20 656c 6170 7365 645f  t_none, elapsed_
-00087900: 7469 6d65 3229 2c20 666c 7573 6820 3d20  time2), flush = 
-00087910: 5472 7565 290a 0a20 2020 2065 6c73 653a  True)..    else:
-00087920: 0a20 2020 2020 2020 206e 756d 5f63 6f72  .        num_cor
-00087930: 6520 3d20 6d69 6e28 206e 5f63 6f72 6573  e = min( n_cores
-00087940: 2c20 2863 7075 5f63 6f75 6e74 2829 202d  , (cpu_count() -
-00087950: 2031 2920 290a 2020 2020 2020 2020 2320   1) ).        # 
-00087960: 7072 696e 7428 226e 756d 2063 6f72 6573  print("num cores
-00087970: 2074 6f20 7573 6520 3d20 7b7d 222e 666f   to use = {}".fo
-00087980: 726d 6174 286e 756d 5f63 6f72 6529 290a  rmat(num_core)).
-00087990: 2020 2020 2020 2020 706f 6f6c 203d 2050          pool = P
-000879a0: 6f6f 6c28 6e75 6d5f 636f 7265 290a 2020  ool(num_core).  
-000879b0: 2020 2020 2020 636e 7420 3d20 310a 2020        cnt = 1.  
-000879c0: 2020 2020 2020 636e 745f 7420 3d20 300a        cnt_t = 0.
-000879d0: 2020 2020 2020 2020 636e 745f 7020 3d20          cnt_p = 
-000879e0: 300a 2020 2020 2020 2020 666f 7220 6774  0.        for gt
-000879f0: 666c 2c20 6c74 2c20 6c70 2c20 6368 726d  fl, lt, lp, chrm
-00087a00: 2c20 6e65 2c20 636e 2069 6e20 706f 6f6c  , ne, cn in pool
-00087a10: 2e6d 6170 286d 635f 636f 7265 5f67 6574  .map(mc_core_get
-00087a20: 5f67 7466 5f61 6e64 5f66 6173 7461 5f70  _gtf_and_fasta_p
-00087a30: 742c 2067 6473 5f6e 6577 293a 0a20 2020  t, gds_new):.   
-00087a40: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00087a50: 2020 2020 2020 636e 745f 6e6f 6e65 202b        cnt_none +
-00087a60: 3d20 636e 0a20 2020 2020 2020 2020 2020  = cn.           
-00087a70: 2069 6620 2863 6e74 2b31 2925 3130 3020   if (cnt+1)%100 
-00087a80: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00087a90: 2020 2020 2020 7072 696e 7428 275c 7247        print('\rG
-00087aa0: 656e 6572 6174 696e 6720 4754 4620 616e  enerating GTF an
-00087ab0: 6420 5472 616e 7363 7269 7074 6f6d 652f  d Transcriptome/
-00087ac0: 5072 6f74 656f 6d65 202e 2e20 2569 2f25  Proteome .. %i/%
-00087ad0: 6927 2025 2028 636e 742c 206c 656e 2867  i' % (cnt, len(g
-00087ae0: 6473 5f6e 6577 2929 2c20 656e 6420 3d20  ds_new)), end = 
-00087af0: 2720 2020 2729 0a20 2020 2020 2020 2020  '   ').         
-00087b00: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00087b10: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
-00087b20: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00087b30: 2020 2020 2020 2020 2020 6c74 203d 2066            lt = f
-00087b40: 696c 7465 725f 7472 735f 6c65 6e28 6c74  ilter_trs_len(lt
-00087b50: 2c20 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f  , min_len = MIN_
-00087b60: 5452 5f4c 454e 4754 4829 0a20 2020 2020  TR_LENGTH).     
-00087b70: 2020 2020 2020 206c 7020 3d20 6669 6c74         lp = filt
-00087b80: 6572 5f74 7273 5f6c 656e 286c 702c 206d  er_trs_len(lp, m
-00087b90: 696e 5f6c 656e 203d 204d 494e 5f50 525f  in_len = MIN_PR_
-00087ba0: 4c45 4e47 5448 290a 2020 2020 2020 2020  LENGTH).        
-00087bb0: 2020 2020 6966 2072 6576 3a0a 2020 2020      if rev:.    
-00087bc0: 2020 2020 2020 2020 2020 2020 665f 6774              f_gt
-00087bd0: 6620 3d20 7361 7665 5f67 7466 3228 2067  f = save_gtf2( g
-00087be0: 7466 5f66 696c 655f 6e65 772c 2067 7466  tf_file_new, gtf
-00087bf0: 5f6c 696e 655f 6c73 7420 3d20 6774 666c  _line_lst = gtfl
-00087c00: 2c20 666f 203d 2066 5f67 7466 2029 2020  , fo = f_gtf )  
-00087c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00087c20: 2023 2067 7466 5f6c 696e 6573 203d 2067   # gtf_lines = g
-00087c30: 7466 5f6c 696e 6573 202b 2067 7466 6c0a  tf_lines + gtfl.
-00087c40: 0a20 2020 2020 2020 2020 2020 2066 742e  .            ft.
-00087c50: 7772 6974 656c 696e 6573 286c 7429 0a20  writelines(lt). 
-00087c60: 2020 2020 2020 2020 2020 2066 702e 7772             fp.wr
-00087c70: 6974 656c 696e 6573 286c 7029 0a20 2020  itelines(lp).   
-00087c80: 2020 2020 2020 2020 2023 2066 615f 6c69           # fa_li
-00087c90: 6e65 735f 7472 203d 2066 615f 6c69 6e65  nes_tr = fa_line
-00087ca0: 735f 7472 202b 206c 740a 2020 2020 2020  s_tr + lt.      
-00087cb0: 2020 2020 2020 2320 6661 5f6c 696e 6573        # fa_lines
-00087cc0: 5f70 7220 3d20 6661 5f6c 696e 6573 5f70  _pr = fa_lines_p
-00087cd0: 7220 2b20 6c70 0a20 2020 2020 2020 2020  r + lp.         
-00087ce0: 2020 2063 6e74 5f74 202b 3d20 6c65 6e28     cnt_t += len(
-00087cf0: 6c74 290a 2020 2020 2020 2020 2020 2020  lt).            
-00087d00: 636e 745f 7020 2b3d 206c 656e 286c 7029  cnt_p += len(lp)
-00087d10: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00087d20: 2020 2020 2020 706f 6f6c 2e63 6c6f 7365        pool.close
-00087d30: 2829 0a20 2020 2020 2020 2070 6f6f 6c2e  ().        pool.
-00087d40: 6a6f 696e 2829 0a0a 2020 2020 2020 2020  join()..        
-00087d50: 656c 6170 7365 645f 7469 6d65 3220 3d20  elapsed_time2 = 
-00087d60: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00087d70: 6172 745f 7469 6d65 0a20 2020 2020 2020  art_time.       
-00087d80: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
-00087d90: 7469 6e67 2047 5446 2061 6e64 2054 7261  ting GTF and Tra
-00087da0: 6e73 6372 6970 746f 6d65 2f50 726f 7465  nscriptome/Prote
-00087db0: 6f6d 6520 2e2e 2064 6f6e 652e 2025 692c  ome .. done. %i,
-00087dc0: 2025 692c 2025 6920 2825 6929 2027 2025   %i, %i (%i) ' %
-00087dd0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00087de0: 2028 636e 745f 6e6f 6e65 2c20 696e 7428   (cnt_none, int(
-00087df0: 636e 745f 742f 3229 2c20 696e 7428 636e  cnt_t/2), int(cn
-00087e00: 745f 702f 3229 2c20 656c 6170 7365 645f  t_p/2), elapsed_
-00087e10: 7469 6d65 3229 290a 2020 2020 2020 2020  time2)).        
-00087e20: 0a20 2020 2069 6620 7265 763a 2073 6176  .    if rev: sav
-00087e30: 655f 6774 6632 2820 6774 665f 6669 6c65  e_gtf2( gtf_file
-00087e40: 5f6e 6577 2c20 6774 665f 6c69 6e65 5f6c  _new, gtf_line_l
-00087e50: 7374 203d 204e 6f6e 652c 2066 6f20 3d20  st = None, fo = 
-00087e60: 665f 6774 662c 2063 6c6f 7365 203d 2054  f_gtf, close = T
-00087e70: 7275 6520 290a 2020 2020 6674 2e63 6c6f  rue ).    ft.clo
-00087e80: 7365 2829 0a20 2020 2066 702e 636c 6f73  se().    fp.clos
-00087e90: 6528 290a 0a20 2020 2023 2064 656c 2067  e()..    # del g
-00087ea0: 6473 5f6e 6577 0a0a 2020 2020 2727 2720  ds_new..    ''' 
-00087eb0: 2020 200a 2020 2020 7374 6172 745f 7469     .    start_ti
-00087ec0: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00087ed0: 0a20 2020 2070 7269 6e74 2827 5361 7669  .    print('Savi
-00087ee0: 6e67 2046 4153 5441 2028 2569 2c20 2569  ng FASTA (%i, %i
-00087ef0: 202f 2025 6929 202e 2e27 2025 2028 6c65   / %i) ..' % (le
-00087f00: 6e28 6661 5f6c 696e 6573 5f74 7229 2f32  n(fa_lines_tr)/2
-00087f10: 2c20 6c65 6e28 6661 5f6c 696e 6573 5f70  , len(fa_lines_p
-00087f20: 7229 2f32 2c20 6e5f 7472 292c 2065 6e64  r)/2, n_tr), end
-00087f30: 203d 2027 272c 2066 6c75 7368 203d 2054   = '', flush = T
-00087f40: 7275 6529 0a20 2020 2066 203d 206f 7065  rue).    f = ope
-00087f50: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
-00087f60: 2c20 2777 2b27 290a 2020 2020 662e 7772  , 'w+').    f.wr
-00087f70: 6974 656c 696e 6573 2866 615f 6c69 6e65  itelines(fa_line
-00087f80: 735f 7472 290a 2020 2020 662e 636c 6f73  s_tr).    f.clos
-00087f90: 6528 290a 0a20 2020 2070 7269 6e74 2827  e()..    print('
-00087fa0: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
-00087fb0: 6620 3d20 6f70 656e 2866 615f 6669 6c65  f = open(fa_file
-00087fc0: 5f70 725f 6e65 772c 2027 772b 2729 0a20  _pr_new, 'w+'). 
-00087fd0: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
-00087fe0: 6661 5f6c 696e 6573 5f70 7229 0a20 2020  fa_lines_pr).   
-00087ff0: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
-00088000: 656c 6170 7365 645f 7469 6d65 203d 2074  elapsed_time = t
-00088010: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00088020: 7274 5f74 696d 650a 2020 2020 7072 696e  rt_time.    prin
-00088030: 7428 2720 646f 6e65 2e20 2825 6929 2720  t(' done. (%i)' 
-00088040: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
-00088050: 290a 2020 2020 2727 270a 0a20 2020 2070  ).    '''..    p
-00088060: 7269 6e74 2827 2020 2025 7327 2025 2066  rint('   %s' % f
-00088070: 615f 6669 6c65 5f74 725f 6e65 7720 290a  a_file_tr_new ).
-00088080: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
-00088090: 2720 2520 6661 5f66 696c 655f 7072 5f6e  ' % fa_file_pr_n
-000880a0: 6577 2029 0a20 2020 2069 6620 7265 763a  ew ).    if rev:
-000880b0: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
-000880c0: 2067 7466 5f66 696c 655f 6e65 7729 0a0a   gtf_file_new)..
-000880d0: 2020 2020 736e 765f 6c73 7420 3d20 5b5d      snv_lst = []
-000880e0: 0a20 2020 2066 6f72 2073 6e76 2069 6e20  .    for snv in 
-000880f0: 736e 765f 696e 666f 5f6c 7374 3a0a 2020  snv_info_lst:.  
-00088100: 2020 2020 2020 6e76 6920 3d20 746f 5f6e        nvi = to_n
-00088110: 765f 7369 6d70 6c65 2820 736e 7620 290a  v_simple( snv ).
-00088120: 2020 2020 2020 2020 736e 765f 6c73 742e          snv_lst.
-00088130: 6170 7065 6e64 286e 7669 290a 2020 2020  append(nvi).    
-00088140: 2020 2020 0a20 2020 2064 665f 736e 7620      .    df_snv 
-00088150: 3d20 7064 2e44 6174 6146 7261 6d65 2873  = pd.DataFrame(s
-00088160: 6e76 5f6c 7374 290a 2020 2020 6466 5f73  nv_lst).    df_s
-00088170: 6e76 2e74 6f5f 6373 7628 666e 616d 655f  nv.to_csv(fname_
-00088180: 736e 762c 2073 6570 203d 2027 5c74 2729  snv, sep = '\t')
-00088190: 0a20 2020 2070 7269 6e74 2827 534e 5620  .    print('SNV 
-000881a0: 7375 6d6d 6172 7920 7361 7665 6420 746f  summary saved to
-000881b0: 205c 6e20 2020 2573 2720 2520 666e 616d   \n   %s' % fnam
-000881c0: 655f 736e 7629 0a20 2020 2023 2077 7269  e_snv).    # wri
-000881d0: 7465 5f74 6f5f 7663 6628 2073 6e76 5f69  te_to_vcf( snv_i
-000881e0: 6e66 6f5f 6c73 742c 2066 6e61 6d65 5f76  nfo_lst, fname_v
-000881f0: 6366 2029 0a0a 2020 2020 2327 2727 2020  cf )..    #'''  
-00088200: 2020 0a20 2020 2069 6620 7265 763a 0a20    .    if rev:. 
-00088210: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
-00088220: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-00088230: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-00088240: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
-00088250: 6720 6375 7374 6f6d 697a 6564 2067 656e  g customized gen
-00088260: 6f6d 6520 2e2e 2027 2c20 656e 6420 3d20  ome .. ', end = 
-00088270: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-00088280: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-00088290: 2020 2023 2068 6472 5f6c 696e 6573 2e61     # hdr_lines.a
-000882a0: 7070 656e 6428 2752 6566 2e20 6765 6e6f  ppend('Ref. geno
-000882b0: 6d65 3a20 2573 2720 2520 6765 6e6f 6d65  me: %s' % genome
-000882c0: 5f66 696c 6529 0a20 2020 2020 2020 2023  _file).        #
-000882d0: 2073 6176 655f 6774 6628 6774 665f 6669   save_gtf(gtf_fi
-000882e0: 6c65 5f6e 6577 2c20 6774 665f 6c69 6e65  le_new, gtf_line
-000882f0: 732c 2068 6472 5f6c 696e 6573 290a 2020  s, hdr_lines).  
-00088300: 2020 2020 2020 0a20 2020 2020 2020 2065        .        e
-00088310: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
-00088320: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-00088330: 745f 7469 6d65 0a20 2020 2020 2020 2070  t_time.        p
-00088340: 7269 6e74 2827 2064 6f6e 652e 2025 6928  rint(' done. %i(
-00088350: 7329 205c 6e20 2020 2573 2720 2520 2865  s) \n   %s' % (e
-00088360: 6c61 7073 6564 5f74 696d 652c 2067 7466  lapsed_time, gtf
-00088370: 5f66 696c 655f 6e65 7729 290a 2020 2020  _file_new)).    
-00088380: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-00088390: 2323 2053 6176 6520 6765 6e6f 6d65 2063  ## Save genome c
-000883a0: 6f72 7265 6374 6564 0a20 2020 2020 2020  orrected.       
-000883b0: 2070 7269 6e74 2827 596f 7520 6172 6520   print('You are 
-000883c0: 616c 6d6f 7374 2064 6f6e 652e 205c 6e4c  almost done. \nL
-000883d0: 6173 7420 7374 6570 2069 7320 746f 2073  ast step is to s
-000883e0: 6176 6520 7468 6520 6669 7865 6420 6765  ave the fixed ge
-000883f0: 6e6f 6d65 2e20 2729 0a20 2020 2020 2020  nome. ').       
-00088400: 2073 6176 655f 6765 6e6f 6d65 2820 6765   save_genome( ge
-00088410: 6e6f 6d65 5f66 696c 655f 6e65 772c 2067  nome_file_new, g
-00088420: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
-00088430: 2054 7275 652c 2074 6974 6c65 203d 2027   True, title = '
-00088440: 4765 6e6f 6d65 2d72 6576 2720 290a 2020  Genome-rev' ).  
-00088450: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-00088460: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
-00088470: 655f 6e65 7720 290a 0a20 2020 2070 7269  e_new )..    pri
-00088480: 6e74 2827 5374 7269 6e67 4669 7820 6669  nt('StringFix fi
-00088490: 6e69 7368 6564 2027 2c20 6461 7465 7469  nished ', dateti
-000884a0: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
-000884b0: 2929 0a0a 2020 2020 7265 7475 726e 2066  ))..    return f
-000884c0: 6e61 6d65 2c20 6765 6e6f 6d65 5f66 696c  name, genome_fil
-000884d0: 655f 6e65 7720 232c 2067 6473 5f6e 6577  e_new #, gds_new
-000884e0: 0a20 2020 2023 2727 2720 2020 200a 0a64  .    #'''    ..d
-000884f0: 6566 2053 7472 696e 6746 6978 5f61 7373  ef StringFix_ass
-00088500: 656d 626c 6528 2049 6e70 7574 203d 204e  emble( Input = N
-00088510: 6f6e 652c 2067 656e 6f6d 655f 6661 203d  one, genome_fa =
-00088520: 204e 6f6e 652c 2061 6e6e 6f74 5f67 7466   None, annot_gtf
-00088530: 203d 204e 6f6e 652c 206f 7574 5f64 6972   = None, out_dir
-00088540: 203d 2027 5346 6978 5f6f 7574 272c 205c   = 'SFix_out', \
-00088550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00088560: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
-00088570: 203d 2034 2c20 6f75 745f 6375 7374 6f6d   = 4, out_custom
-00088580: 5f67 656e 6f6d 6520 3d20 4661 6c73 652c  _genome = False,
-00088590: 2073 7566 6669 7820 3d20 4e6f 6e65 2c20   suffix = None, 
-000885a0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-000885b0: 2020 2020 2020 2020 2020 6d63 7620 3d20            mcv = 
-000885c0: 302e 352c 206d 6364 203d 2031 2c20 6d74  0.5, mcd = 1, mt
-000885d0: 6c20 3d20 3230 302c 206d 706c 203d 2035  l = 200, mpl = 5
-000885e0: 302c 206d 6469 203d 2032 2c20 6d64 6420  0, mdi = 2, mdd 
-000885f0: 3d20 322c 206d 6470 203d 2033 2c20 5c0a  = 2, mdp = 3, \.
-00088600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088610: 2020 2020 2020 2020 6d64 6620 3d20 302e          mdf = 0.
-00088620: 322c 206e 5f70 203d 2031 362c 2078 7361  2, n_p = 16, xsa
-00088630: 203d 2054 7275 652c 206a 756d 705f 746f   = True, jump_to
-00088640: 203d 2030 2029 3a0a 0a20 2020 2070 7269   = 0 ):..    pri
-00088650: 6e74 2827 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('+-----------
-00088660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00088670: 2d2d 2d2b 2729 0a20 2020 2070 7269 6e74  ---+').    print
-00088680: 2827 7c20 2020 2020 2053 7472 696e 6766  ('|      Stringf
-00088690: 6978 2076 2e25 7320 2020 2020 2020 7c27  ix v.%s       |'
-000886a0: 2025 2053 7472 696e 6746 6978 5f76 6572   % StringFix_ver
-000886b0: 7369 6f6e 290a 2020 2020 7072 696e 7428  sion).    print(
-000886c0: 272b 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '+--------------
-000886d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000886e0: 2b27 290a 0a20 2020 2069 6620 496e 7075  +')..    if Inpu
-000886f0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
-00088700: 2020 2070 7269 6e74 2827 5573 6167 653a     print('Usage:
-00088710: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
-00088720: 2827 2531 3273 3a20 2720 2520 2761 7267  ('%12s: ' % 'arg
-00088730: 756d 656e 7427 2c20 2764 6573 6372 6970  ument', 'descrip
-00088740: 7469 6f6e 2720 290a 2020 2020 2020 2020  tion' ).        
-00088750: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
-00088760: 2027 496e 7075 7427 2c20 2749 6e70 7574   'Input', 'Input
-00088770: 2053 414d 206f 7220 4241 4d20 6669 6c65   SAM or BAM file
-00088780: 2e20 7079 6261 6d2e 7079 2069 7320 7265  . pybam.py is re
-00088790: 7175 6972 6564 2066 6f72 2042 414d 2069  quired for BAM i
-000887a0: 6e70 7574 2e27 2029 0a20 2020 2020 2020  nput.' ).       
-000887b0: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-000887c0: 2520 2767 656e 6f6d 655f 6661 272c 2065  % 'genome_fa', e
-000887d0: 6e64 203d 2027 2729 0a20 2020 2020 2020  nd = '').       
-000887e0: 2070 7269 6e74 2827 2047 656e 6f6d 6520   print(' Genome 
-000887f0: 6661 7374 6120 6669 6c65 2075 7365 6420  fasta file used 
-00088800: 746f 2067 656e 6572 6174 6520 7468 6520  to generate the 
-00088810: 696e 7075 7420 5341 4d2f 4241 4d2e 2027  input SAM/BAM. '
-00088820: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
-00088830: 2827 2531 3273 2020 2049 7420 6973 2075  ('%12s   It is u
-00088840: 7365 6420 746f 2063 6f72 7265 6374 2073  sed to correct s
-00088850: 6571 7565 6e63 6573 206e 6f74 2063 6f76  equences not cov
-00088860: 6572 6564 2062 7920 7265 6164 732c 2027  ered by reads, '
-00088870: 2025 2027 2729 0a20 2020 2020 2020 2070   % '').        p
-00088880: 7269 6e74 2827 2531 3273 2020 2074 6f20  rint('%12s   to 
-00088890: 6964 656e 7469 6679 2053 4e50 7320 616e  identify SNPs an
-000888a0: 6420 746f 2067 656e 6572 6174 6520 6375  d to generate cu
-000888b0: 7374 6f6d 697a 6564 2067 656e 6f6d 652e  stomized genome.
-000888c0: 2027 2020 2520 2727 290a 2020 2020 2020   '  % '').      
-000888d0: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
-000888e0: 2025 2027 616e 6e6f 745f 6774 6627 2c20   % 'annot_gtf', 
-000888f0: 2747 5446 2f47 4646 2066 696c 6520 746f  'GTF/GFF file to
-00088900: 2062 6520 7573 6564 2066 6f72 2067 7569   be used for gui
-00088910: 6465 2061 6e6e 6f74 6174 696f 6e27 2029  de annotation' )
-00088920: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088930: 2531 3273 3a20 2720 2520 276f 7574 5f64  %12s: ' % 'out_d
-00088940: 6972 272c 2027 4f75 7470 7574 2064 6972  ir', 'Output dir
-00088950: 6563 746f 7279 2720 290a 2020 2020 2020  ectory' ).      
-00088960: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
-00088970: 2025 2027 6e5f 636f 7265 7327 2c20 274e   % 'n_cores', 'N
-00088980: 756d 6265 7220 6f66 2063 6f72 6573 2074  umber of cores t
-00088990: 6f20 7573 6527 2029 0a20 2020 2020 2020  o use' ).       
-000889a0: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-000889b0: 2520 2773 7566 6669 7827 2c20 2753 7566  % 'suffix', 'Suf
-000889c0: 6669 7820 746f 2062 6520 7573 6564 2066  fix to be used f
-000889d0: 6f72 206f 7574 7075 7420 6669 6c65 206e  or output file n
-000889e0: 616d 6573 2720 290a 2020 2020 2020 2020  ames' ).        
-000889f0: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
-00088a00: 2027 6d63 7627 2c20 274d 696e 696d 756d   'mcv', 'Minimum
-00088a10: 2072 6561 6420 636f 7665 7261 6765 2066   read coverage f
-00088a20: 6f72 2069 6e63 6c75 7369 6f6e 2069 6e20  or inclusion in 
-00088a30: 7468 6520 6f75 7470 7574 2047 5446 2f47  the output GTF/G
-00088a40: 4646 2720 290a 2020 2020 2020 2020 7072  FF' ).        pr
-00088a50: 696e 7428 2725 3132 7320 2020 616e 6420  int('%12s   and 
-00088a60: 7472 616e 7363 7269 7074 6f6d 652f 7072  transcriptome/pr
-00088a70: 6f74 656f 6d65 205b 307e 315d 2e20 466f  oteome [0~1]. Fo
-00088a80: 7220 6120 6c65 6e67 7468 204c 2074 7261  r a length L tra
-00088a90: 6e73 6372 6970 742c 2027 2025 2027 2729  nscript, ' % '')
-00088aa0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088ab0: 2531 3273 2020 2069 7420 7769 6c6c 2062  %12s   it will b
-00088ac0: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
-00088ad0: 6520 6f75 7470 7574 2069 6620 6174 206c  e output if at l
-00088ae0: 6561 7374 206d 6376 2a4c 2062 6173 6573  east mcv*L bases
-00088af0: 2061 7265 2063 6f76 6572 6564 2062 7920   are covered by 
-00088b00: 7265 6164 7320 2720 2025 2027 2729 0a20  reads '  % ''). 
-00088b10: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
-00088b20: 3273 3a20 2720 2520 276d 6364 272c 2027  2s: ' % 'mcd', '
-00088b30: 4d69 6e69 6d75 6d20 6261 7365 2063 6f76  Minimum base cov
-00088b40: 6572 6167 6520 6465 7074 6820 666f 7220  erage depth for 
-00088b50: 696e 636c 7573 696f 6e20 696e 2074 6865  inclusion in the
-00088b60: 206f 7574 7075 7427 2029 0a20 2020 2020   output' ).     
-00088b70: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
-00088b80: 2720 2520 276d 746c 272c 2027 4d69 6e69  ' % 'mtl', 'Mini
-00088b90: 6d75 6d20 7472 616e 7363 7269 7074 206c  mum transcript l
-00088ba0: 656e 6774 6820 696e 2062 6173 6573 2720  ength in bases' 
-00088bb0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00088bc0: 2725 3132 733a 2027 2025 2027 6d70 6c27  '%12s: ' % 'mpl'
-00088bd0: 2c20 274d 696e 696d 756d 2070 726f 7465  , 'Minimum prote
-00088be0: 696e 2028 616d 696e 6f20 6163 6964 2073  in (amino acid s
-00088bf0: 6571 7565 6e63 6529 206c 656e 6774 6827  equence) length'
-00088c00: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
-00088c10: 2827 2531 3273 3a20 2720 2520 276d 6469  ('%12s: ' % 'mdi
-00088c20: 272c 2027 4d69 6e69 6d75 6d20 636f 7665  ', 'Minimum cove
-00088c30: 7261 6765 2064 6570 7468 2066 6f72 2061  rage depth for a
-00088c40: 6e20 696e 7365 7273 696f 6e20 746f 2062  n insersion to b
-00088c50: 6520 636f 6e73 6964 6572 6564 2076 616c  e considered val
-00088c60: 6964 205b 3e3d 312e 305d 2720 290a 2020  id [>=1.0]' ).  
-00088c70: 2020 2020 2020 7072 696e 7428 2725 3132        print('%12
-00088c80: 733a 2027 2025 2027 6d64 6427 2c20 274d  s: ' % 'mdd', 'M
-00088c90: 696e 696d 756d 2063 6f76 6572 6167 6520  inimum coverage 
-00088ca0: 6465 7074 6820 666f 7220 6120 6465 6c65  depth for a dele
-00088cb0: 7469 6f6e 2074 6f20 6265 2063 6f6e 7369  tion to be consi
-00088cc0: 6465 7265 6420 7661 6c69 6420 5b3e 3d31  dered valid [>=1
-00088cd0: 2e30 5d27 2029 0a20 2020 2020 2020 2070  .0]' ).        p
-00088ce0: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
-00088cf0: 276d 6470 272c 2027 4d69 6e69 6d75 6d20  'mdp', 'Minimum 
-00088d00: 636f 7665 7261 6765 2064 6570 7468 2066  coverage depth f
-00088d10: 6f72 2053 4e50 2063 6f72 7265 6374 696f  or SNP correctio
-00088d20: 6e20 5b3e 3d31 2e30 5d27 2029 0a20 2020  n [>=1.0]' ).   
-00088d30: 2020 2020 2070 7269 6e74 2827 2531 3273       print('%12s
-00088d40: 3a20 2720 2520 276d 6466 272c 2027 4d69  : ' % 'mdf', 'Mi
-00088d50: 6e69 6d75 6d20 636f 7665 7261 6765 2064  nimum coverage d
-00088d60: 6570 7468 2066 7261 6374 696f 6e20 666f  epth fraction fo
-00088d70: 7220 696e 7365 7273 696f 6e20 616e 6420  r insersion and 
-00088d80: 6465 6c65 7469 6f6e 2074 6f20 6265 2063  deletion to be c
-00088d90: 6f6e 7369 6465 7265 6420 7661 6c69 6420  onsidered valid 
-00088da0: 2830 7e31 2927 2029 0a20 2020 2020 2020  (0~1)' ).       
-00088db0: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-00088dc0: 2520 276a 756d 705f 746f 272c 2027 4a75  % 'jump_to', 'Ju
-00088dd0: 6d70 2074 6f20 7374 6570 206a 205b 3020  mp to step j [0 
-00088de0: 6f72 2031 206f 7220 325d 2720 290a 2020  or 1 or 2]' ).  
-00088df0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00088e00: 2020 7361 6d5f 6669 6c65 203d 2049 6e70    sam_file = Inp
-00088e10: 7574 0a20 2020 2067 7466 5f66 696c 6520  ut.    gtf_file 
-00088e20: 3d20 616e 6e6f 745f 6774 660a 0a20 2020  = annot_gtf..   
-00088e30: 2069 6620 5059 4241 4d5f 4552 523a 0a20   if PYBAM_ERR:. 
-00088e40: 2020 2020 2020 2070 7269 6e74 2827 5374         print('St
-00088e50: 7269 6e67 4669 7820 5741 524e 494e 473a  ringFix WARNING:
-00088e60: 2070 7962 616d 206e 6f74 2061 7661 696c   pybam not avail
-00088e70: 6162 6c65 2e20 4163 6365 7074 2053 414d  able. Accept SAM
-00088e80: 2066 696c 6520 6f6e 6c79 2e27 290a 0a20   file only.').. 
-00088e90: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
-00088ea0: 2069 7320 6e6f 7420 4e6f 6e65 2920 2620   is not None) & 
-00088eb0: 2867 7466 5f66 696c 6520 6973 206e 6f74  (gtf_file is not
-00088ec0: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
-00088ed0: 7072 696e 7428 2753 7472 696e 6746 6978  print('StringFix
-00088ee0: 2069 7320 7275 6e6e 696e 6720 696e 2061   is running in a
-00088ef0: 6e6e 6f74 6174 696f 6e20 6775 6964 6564  nnotation guided
-00088f00: 206d 6f64 6520 7769 7468 2073 6571 7565   mode with seque
-00088f10: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
-00088f20: 290a 2020 2020 656c 6966 2028 6765 6e6f  ).    elif (geno
-00088f30: 6d65 5f66 6120 6973 206e 6f74 204e 6f6e  me_fa is not Non
-00088f40: 6529 2026 2028 6774 665f 6669 6c65 2069  e) & (gtf_file i
-00088f50: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
-00088f60: 2070 7269 6e74 2827 5374 7269 6e67 4669   print('StringFi
-00088f70: 7820 6973 2072 756e 6e69 6e67 2069 6e20  x is running in 
-00088f80: 6765 6e6f 6d65 2067 7569 6465 6420 6d6f  genome guided mo
-00088f90: 6465 2077 6974 6820 7365 7175 656e 6365  de with sequence
-00088fa0: 2063 6f72 7265 6374 696f 6e2e 2729 0a20   correction.'). 
-00088fb0: 2020 2065 6c69 6620 2867 656e 6f6d 655f     elif (genome_
-00088fc0: 6661 2069 7320 4e6f 6e65 2920 2620 2867  fa is None) & (g
-00088fd0: 7466 5f66 696c 6520 6973 204e 6f6e 6529  tf_file is None)
-00088fe0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00088ff0: 2753 7472 696e 6746 6978 2069 7320 7275  'StringFix is ru
-00089000: 6e6e 696e 6720 696e 2067 656e 6f6d 6520  nning in genome 
-00089010: 6775 6964 6564 206d 6f64 6520 7769 7468  guided mode with
-00089020: 6f75 7420 7365 7175 656e 6365 2063 6f72  out sequence cor
-00089030: 7265 6374 696f 6e2e 2729 0a20 2020 2065  rection.').    e
-00089040: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
-00089050: 6e74 2827 5374 7269 6e67 4669 7820 6973  nt('StringFix is
-00089060: 2072 756e 6e69 6e67 2069 6e20 616e 6e6f   running in anno
-00089070: 7461 7469 6f6e 2067 7569 6465 6420 6d6f  tation guided mo
-00089080: 6465 2077 6974 686f 7574 2073 6571 7565  de without seque
-00089090: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
-000890a0: 290a 2020 2020 0a0a 2020 2020 2320 7265  ).    ..    # re
-000890b0: 7620 3d20 4661 6c73 650a 2020 2020 7265  v = False.    re
-000890c0: 7620 3d20 6f75 745f 6375 7374 6f6d 5f67  v = out_custom_g
-000890d0: 656e 6f6d 650a 2020 2020 6362 7963 203d  enome.    cbyc =
-000890e0: 2054 7275 6520 0a20 2020 2073 6120 3d20   True .    sa = 
-000890f0: 320a 2020 2020 6966 2078 7361 3a20 7361  2.    if xsa: sa
-00089100: 203d 2030 0a0a 2020 2020 4d49 4e5f 4356   = 0..    MIN_CV
-00089110: 475f 464f 525f 534e 505f 434f 5252 4543  G_FOR_SNP_CORREC
-00089120: 5449 4f4e 203d 2069 6e74 286d 6470 290a  TION = int(mdp).
-00089130: 2020 2020 495f 5641 4c49 445f 4356 4720      I_VALID_CVG 
-00089140: 3d20 6d61 7828 312c 206e 702e 666c 6f61  = max(1, np.floa
-00089150: 7428 6d64 6929 290a 2020 2020 445f 5641  t(mdi)).    D_VA
-00089160: 4c49 445f 4356 4720 3d20 6d61 7828 312c  LID_CVG = max(1,
-00089170: 206e 702e 666c 6f61 7428 6d64 6429 290a   np.float(mdd)).
-00089180: 2020 2020 495f 5641 4c49 445f 4346 5241      I_VALID_CFRA
-00089190: 4320 3d20 666c 6f61 7428 6d64 6629 0a20  C = float(mdf). 
-000891a0: 2020 2044 5f56 414c 4944 5f43 4652 4143     D_VALID_CFRAC
-000891b0: 203d 2066 6c6f 6174 286d 6466 290a 2020   = float(mdf).  
-000891c0: 2020 4d49 4e5f 434f 565f 544f 5f53 454c    MIN_COV_TO_SEL
-000891d0: 203d 206e 702e 666c 6f61 7428 6d63 7629   = np.float(mcv)
-000891e0: 0a20 2020 204d 494e 5f41 424e 5f54 4f5f  .    MIN_ABN_TO_
-000891f0: 5345 4c20 3d20 6e70 2e66 6c6f 6174 286d  SEL = np.float(m
-00089200: 6364 290a 2020 2020 4d49 4e5f 5452 5f4c  cd).    MIN_TR_L
-00089210: 454e 4754 4820 3d20 696e 7428 6d74 6c29  ENGTH = int(mtl)
-00089220: 0a20 2020 204d 494e 5f50 525f 4c45 4e47  .    MIN_PR_LENG
-00089230: 5448 203d 2069 6e74 286d 706c 290a 2020  TH = int(mpl).  
-00089240: 2020 4d41 585f 4e55 4d5f 5041 5448 5320    MAX_NUM_PATHS 
-00089250: 3d20 696e 7428 6e5f 7029 0a20 2020 2047  = int(n_p).    G
-00089260: 454e 5f41 4153 5f55 4e53 5045 4320 3d20  EN_AAS_UNSPEC = 
-00089270: 5472 7565 0a0a 2020 2020 6966 2067 7466  True..    if gtf
-00089280: 5f66 696c 6520 6973 204e 6f6e 653a 0a20  _file is None:. 
-00089290: 2020 2020 2020 204d 4158 5f4e 554d 5f50         MAX_NUM_P
-000892a0: 4154 4853 203d 2032 300a 2020 2020 2020  ATHS = 20.      
-000892b0: 2020 4d49 4e5f 4e5f 5244 535f 5045 525f    MIN_N_RDS_PER_
-000892c0: 4745 4e45 203d 2033 300a 2020 2020 2020  GENE = 30.      
-000892d0: 2020 5452 5f46 494c 5445 525f 5345 4c20    TR_FILTER_SEL 
-000892e0: 3d20 320a 0a20 2020 2069 6620 6f75 745f  = 2..    if out_
-000892f0: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
-00089300: 200a 2020 2020 2020 2020 6966 206e 6f74   .        if not
-00089310: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00089320: 6f75 745f 6469 7229 3a20 6f73 2e6d 6b64  out_dir): os.mkd
-00089330: 6972 286f 7574 5f64 6972 290a 0a20 2020  ir(out_dir)..   
-00089340: 2066 696c 655f 6f75 742c 2067 6473 2c20   file_out, gds, 
-00089350: 6765 6e6f 6d65 203d 2053 7472 696e 6746  genome = StringF
-00089360: 6978 5f61 6e61 6c79 7369 7328 7361 6d5f  ix_analysis(sam_
-00089370: 6669 6c65 2c20 6774 6620 3d20 6774 665f  file, gtf = gtf_
-00089380: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
-00089390: 6520 3d20 6765 6e6f 6d65 5f66 612c 206a  e = genome_fa, j
-000893a0: 756d 7020 3d20 6a75 6d70 5f74 6f2c 205c  ump = jump_to, \
-000893b0: 0a20 2020 2020 2020 2020 2020 206e 5f63  .            n_c
-000893c0: 6f72 6573 3d6e 5f63 6f72 6573 2c20 6f75  ores=n_cores, ou
-000893d0: 745f 7472 203d 2054 7275 652c 2063 6279  t_tr = True, cby
-000893e0: 6320 3d20 6362 7963 2c20 7375 6666 6978  c = cbyc, suffix
-000893f0: 203d 2073 7566 6669 782c 206f 7574 5f64   = suffix, out_d
-00089400: 6972 203d 206f 7574 5f64 6972 2c20 7361  ir = out_dir, sa
-00089410: 203d 2073 6120 2920 0a0a 2020 2020 6966   = sa ) ..    if
-00089420: 2028 6764 7320 6973 206e 6f74 204e 6f6e   (gds is not Non
-00089430: 6529 2026 2028 6a75 6d70 5f74 6f20 3c20  e) & (jump_to < 
-00089440: 3229 3a0a 2020 2020 2020 2020 7072 696e  2):.        prin
-00089450: 7428 2753 6176 696e 6720 6765 6e65 2064  t('Saving gene d
-00089460: 6573 6372 6970 746f 7220 2e2e 2027 2c20  escriptor .. ', 
-00089470: 656e 6420 3d20 2720 272c 2066 6c75 7368  end = ' ', flush
-00089480: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-00089490: 2077 6974 6820 6f70 656e 2866 696c 655f   with open(file_
-000894a0: 6f75 7420 2b20 272e 6764 7327 2c20 2777  out + '.gds', 'w
-000894b0: 6227 2920 6173 2066 3a0a 2020 2020 2020  b') as f:.      
-000894c0: 2020 2020 2020 7069 636b 6c65 2e64 756d        pickle.dum
-000894d0: 7028 2028 6764 7329 2c20 6620 290a 2020  p( (gds), f ).  
-000894e0: 2020 2020 2020 7072 696e 7428 2764 6f6e        print('don
-000894f0: 652e 2027 290a 2020 2020 656c 7365 3a0a  e. ').    else:.
-00089500: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-00089510: 7472 696e 6746 6978 2073 7461 7274 6564  tringFix started
-00089520: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
-00089530: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
-00089540: 2020 2020 2070 7269 6e74 2827 4c6f 6164       print('Load
-00089550: 696e 6720 6765 6e65 2064 6573 6372 6970  ing gene descrip
-00089560: 746f 7220 2e2e 2027 2c20 656e 6420 3d20  tor .. ', end = 
-00089570: 2720 272c 2066 6c75 7368 203d 2054 7275  ' ', flush = Tru
-00089580: 6529 0a20 2020 2020 2020 2077 6974 6820  e).        with 
-00089590: 6f70 656e 2866 696c 655f 6f75 7420 2b20  open(file_out + 
-000895a0: 272e 6764 7327 2c20 2772 6227 2920 6173  '.gds', 'rb') as
-000895b0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-000895c0: 6764 7320 3d20 7069 636b 6c65 2e6c 6f61  gds = pickle.loa
-000895d0: 6428 2066 2029 0a20 2020 2020 2020 2067  d( f ).        g
-000895e0: 656e 6f6d 6520 3d20 6765 6e6f 6d65 5f66  enome = genome_f
-000895f0: 610a 2020 2020 2020 2020 7072 696e 7428  a.        print(
-00089600: 2764 6f6e 652e 2027 290a 2020 2020 0a20  'done. ').    . 
-00089610: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
-00089620: 2069 7320 4e6f 6e65 293a 0a20 2020 2020   is None):.     
-00089630: 2020 2070 7269 6e74 2827 5374 7269 6e67     print('String
-00089640: 4669 7820 6669 6e69 7368 6564 2027 2c20  Fix finished ', 
-00089650: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-00089660: 652e 6e6f 7728 2929 0a20 2020 2065 6c73  e.now()).    els
-00089670: 653a 0a20 2020 2020 2020 2066 696c 655f  e:.        file_
-00089680: 6f75 742c 2066 696c 655f 6f75 745f 6765  out, file_out_ge
-00089690: 6e6f 6d65 203d 2053 7472 696e 6746 6978  nome = StringFix
-000896a0: 5f73 796e 7468 6573 6973 2820 6669 6c65  _synthesis( file
-000896b0: 5f6f 7574 202b 2027 2e67 6666 272c 2067  _out + '.gff', g
-000896c0: 656e 6f6d 652c 205c 0a20 2020 2020 2020  enome, \.       
-000896d0: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
-000896e0: 3d6e 5f63 6f72 6573 2c20 7265 7620 3d20  =n_cores, rev = 
-000896f0: 7265 762c 206f 7574 5f64 6972 203d 206f  rev, out_dir = o
-00089700: 7574 5f64 6972 2c20 6764 7320 3d20 6764  ut_dir, gds = gd
-00089710: 7320 290a 2020 2020 2020 2020 0a20 2020  s ).        .   
-00089720: 2072 6574 7572 6e20 6669 6c65 5f6f 7574   return file_out
-00089730: 0a20 2020 2020 2020 200a 0a23 2323 2323  .        ..#####
-00089740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089760: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089770: 2323 2323 0a23 2320 5374 7269 6e67 4669  ####.## StringFi
-00089780: 782d 6164 646f 6e20 2020 2020 2020 2020  x-addon         
+00086200: 6767 635f 7475 706c 652e 6170 7065 6e64  ggc_tuple.append
+00086210: 2820 285b 2067 6473 5b77 685b 6f64 725b  ( ([ gds[wh[odr[
+00086220: 6b5d 5d5d 2066 6f72 206b 2069 6e20 7261  k]]] for k in ra
+00086230: 6e67 6528 6c65 6e28 7768 2929 205d 2c20  nge(len(wh)) ], 
+00086240: 6765 6e6f 6d65 5b63 6872 6d5d 2e73 6571  genome[chrm].seq
+00086250: 2c20 6368 726d 2920 290a 0a20 2020 2020  , chrm) )..     
+00086260: 2020 2023 2070 7269 6e74 2827 4e5f 7472     # print('N_tr
+00086270: 7320 7661 6c69 6420 3d20 2569 2720 2520  s valid = %i' % 
+00086280: 6e74 725f 7661 6c69 6429 0a20 2020 2020  ntr_valid).     
+00086290: 2020 2064 656c 2067 6473 0a0a 0a20 2020     del gds...   
+000862a0: 2066 696c 655f 6e61 6d65 203d 2067 7466   file_name = gtf
+000862b0: 5f66 696c 652e 7370 6c69 7428 272f 2729  _file.split('/')
+000862c0: 5b2d 315d 0a20 2020 2023 2066 6e61 6d65  [-1].    # fname
+000862d0: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
+000862e0: 6974 2827 2e27 295b 305d 0a20 2020 2066  it('.')[0].    f
+000862f0: 6e73 203d 2066 696c 655f 6e61 6d65 2e73  ns = file_name.s
+00086300: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
+00086310: 2020 2066 6e61 6d65 203d 2027 270a 2020     fname = ''.  
+00086320: 2020 666f 7220 6b2c 2066 6e20 696e 2065    for k, fn in e
+00086330: 6e75 6d65 7261 7465 2866 6e73 293a 0a20  numerate(fns):. 
+00086340: 2020 2020 2020 2069 6620 6b20 3e20 303a         if k > 0:
+00086350: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
+00086360: 6d65 203d 2066 6e61 6d65 202b 2027 2e27  me = fname + '.'
+00086370: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
+00086380: 2066 6e61 6d65 202b 2066 6e0a 0a20 2020   fname + fn..   
+00086390: 2069 6620 6f75 745f 6469 7220 6973 206e   if out_dir is n
+000863a0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000863b0: 2069 6620 6f75 745f 6469 725b 2d31 5d20   if out_dir[-1] 
+000863c0: 3d3d 2027 2f27 3a0a 2020 2020 2020 2020  == '/':.        
+000863d0: 2020 2020 666e 616d 6520 3d20 6f75 745f      fname = out_
+000863e0: 6469 7220 2b20 666e 616d 650a 2020 2020  dir + fname.    
+000863f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00086400: 2020 2020 2020 666e 616d 6520 3d20 6f75        fname = ou
+00086410: 745f 6469 7220 2b20 272f 2720 2b20 666e  t_dir + '/' + fn
+00086420: 616d 650a 0a20 2020 2067 656e 6f6d 655f  ame..    genome_
+00086430: 6669 6c65 5f6e 6577 203d 2066 6e61 6d65  file_new = fname
+00086440: 202b 2027 5f63 7573 746f 6d69 7a65 645f   + '_customized_
+00086450: 6765 6e6f 6d65 2e66 6127 0a20 2020 2067  genome.fa'.    g
+00086460: 7466 5f66 696c 655f 6e65 7720 3d20 666e  tf_file_new = fn
+00086470: 616d 6520 2b20 275f 6375 7374 6f6d 697a  ame + '_customiz
+00086480: 6564 2e67 7466 270a 2020 2020 6661 5f66  ed.gtf'.    fa_f
+00086490: 696c 655f 7472 5f6e 6577 203d 2066 6e61  ile_tr_new = fna
+000864a0: 6d65 202b 2027 5f74 7261 6e73 6372 6970  me + '_transcrip
+000864b0: 746f 6d65 2e66 6127 0a20 2020 2066 615f  tome.fa'.    fa_
+000864c0: 6669 6c65 5f70 725f 6e65 7720 3d20 666e  file_pr_new = fn
+000864d0: 616d 6520 2b20 275f 7072 6f74 656f 6d65  ame + '_proteome
+000864e0: 2e66 6127 0a20 2020 2066 6e61 6d65 5f73  .fa'.    fname_s
+000864f0: 6e76 203d 2066 6e61 6d65 202b 2027 5f73  nv = fname + '_s
+00086500: 6e76 5f73 756d 6d61 7279 2e74 7376 270a  nv_summary.tsv'.
+00086510: 2020 2020 666e 616d 655f 7663 6620 3d20      fname_vcf = 
+00086520: 666e 616d 6520 2b20 275f 736e 765f 7375  fname + '_snv_su
+00086530: 6d6d 6172 792e 7663 6627 0a0a 2020 2020  mmary.vcf'..    
+00086540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086570: 2323 2323 2323 0a20 2020 2063 6872 5f6c  ######.    chr_l
+00086580: 7374 203d 2063 6872 5f6c 7374 5f6e 6577  st = chr_lst_new
+00086590: 0a0a 2020 2020 6f66 5f64 6963 7420 3d20  ..    of_dict = 
+000865a0: 7b7d 0a20 2020 2023 2067 6473 5f6c 7374  {}.    # gds_lst
+000865b0: 203d 205b 5d0a 2020 2020 2320 736e 765f   = [].    # snv_
+000865c0: 6c73 7420 3d20 5b5d 0a20 2020 2067 6473  lst = [].    gds
+000865d0: 5f6e 6577 203d 205b 5d0a 2020 2020 736e  _new = [].    sn
+000865e0: 765f 696e 666f 5f6c 7374 203d 205b 5d0a  v_info_lst = [].
+000865f0: 0a20 2020 206e 5f62 6173 6573 5f74 6f74  .    n_bases_tot
+00086600: 616c 203d 2030 0a20 2020 206e 5f65 725f  al = 0.    n_er_
+00086610: 6261 7365 7320 3d20 300a 2020 2020 6e5f  bases = 0.    n_
+00086620: 626c 6b5f 746f 7461 6c20 3d20 300a 2020  blk_total = 0.  
+00086630: 2020 6e5f 6572 5f62 6c6b 203d 2030 0a20    n_er_blk = 0. 
+00086640: 2020 206e 7074 203d 2030 0a20 2020 206e     npt = 0.    n
+00086650: 7065 203d 2030 0a20 2020 200a 2020 2020  pe = 0.    .    
+00086660: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
+00086670: 652e 7469 6d65 2829 0a20 2020 2069 6620  e.time().    if 
+00086680: 286e 5f63 6f72 6573 203d 3d20 3129 207c  (n_cores == 1) |
+00086690: 2028 6c65 6e28 6368 725f 6c73 7429 203d   (len(chr_lst) =
+000866a0: 3d20 3129 3a0a 2020 2020 2020 2020 666f  = 1):.        fo
+000866b0: 7220 6b6b 2069 6e20 7261 6e67 6528 6c65  r kk in range(le
+000866c0: 6e28 6368 725f 6c73 7429 293a 0a20 2020  n(chr_lst)):.   
+000866d0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000866e0: 5c72 2720 2b20 2720 272a 3130 302c 2065  \r' + ' '*100, e
+000866f0: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
+00086700: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00086710: 2070 7269 6e74 2827 5c72 5265 636f 6e73   print('\rRecons
+00086720: 7472 7563 7469 6e67 202e 2e20 2569 2f25  tructing .. %i/%
+00086730: 6920 2825 7329 2027 2025 2028 6b6b 2b31  i (%s) ' % (kk+1
+00086740: 2c20 6c65 6e28 6368 725f 6c73 7429 2c20  , len(chr_lst), 
+00086750: 6368 725f 6c73 745b 6b6b 5d29 2c20 656e  chr_lst[kk]), en
+00086760: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
+00086770: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00086780: 2020 6764 5f73 656c 2c20 7365 715f 6e65    gd_sel, seq_ne
+00086790: 772c 2073 6e76 5f69 6e66 6f5f 6368 722c  w, snv_info_chr,
+000867a0: 206f 662c 2063 6872 6d2c 2065 7374 6174   of, chrm, estat
+000867b0: 203d 206d 635f 636f 7265 5f72 6563 6f6e   = mc_core_recon
+000867c0: 7374 7275 6374 696f 6e28 6767 635f 7475  struction(ggc_tu
+000867d0: 706c 655b 6b6b 5d29 0a20 2020 2020 2020  ple[kk]).       
+000867e0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+000867f0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00086800: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
+00086810: 6d65 5b63 6872 6d5d 2e73 6571 203d 2073  me[chrm].seq = s
+00086820: 6571 5f6e 6577 0a20 2020 2020 2020 2020  eq_new.         
+00086830: 2020 206f 665f 6469 6374 5b63 6872 6d5d     of_dict[chrm]
+00086840: 203d 206f 660a 2020 2020 2020 2020 2020   = of.          
+00086850: 2020 2320 6764 735f 6c73 742e 6170 7065    # gds_lst.appe
+00086860: 6e64 2867 645f 7365 6c29 0a20 2020 2020  nd(gd_sel).     
+00086870: 2020 2020 2020 2023 2073 6e76 5f6c 7374         # snv_lst
+00086880: 2e61 7070 656e 6428 736e 765f 696e 666f  .append(snv_info
+00086890: 5f63 6872 290a 2020 2020 2020 2020 2020  _chr).          
+000868a0: 2020 6764 735f 6e65 7720 3d20 6764 735f    gds_new = gds_
+000868b0: 6e65 7720 2b20 6764 5f73 656c 0a20 2020  new + gd_sel.   
+000868c0: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
+000868d0: 6f5f 6c73 7420 3d20 736e 765f 696e 666f  o_lst = snv_info
+000868e0: 5f6c 7374 202b 2073 6e76 5f69 6e66 6f5f  _lst + snv_info_
+000868f0: 6368 720a 0a20 2020 2020 2020 2020 2020  chr..           
+00086900: 206e 6274 2c20 6e62 652c 206e 6c74 2c20   nbt, nbe, nlt, 
+00086910: 6e6c 652c 206e 742c 206e 653d 2065 7374  nle, nt, ne= est
+00086920: 6174 0a20 2020 2020 2020 2020 2020 206e  at.            n
+00086930: 5f62 6173 6573 5f74 6f74 616c 202b 3d20  _bases_total += 
+00086940: 6e62 740a 2020 2020 2020 2020 2020 2020  nbt.            
+00086950: 6e5f 6572 5f62 6173 6573 202b 3d20 6e62  n_er_bases += nb
+00086960: 650a 2020 2020 2020 2020 2020 2020 6e5f  e.            n_
+00086970: 626c 6b5f 746f 7461 6c20 2b3d 206e 6c74  blk_total += nlt
+00086980: 0a20 2020 2020 2020 2020 2020 206e 5f65  .            n_e
+00086990: 725f 626c 6b20 2b3d 206e 6c65 0a20 2020  r_blk += nle.   
+000869a0: 2020 2020 2020 2020 206e 7074 202b 3d20           npt += 
+000869b0: 6e74 0a20 2020 2020 2020 2020 2020 206e  nt.            n
+000869c0: 7065 202b 3d20 6e65 0a20 2020 2020 2020  pe += ne.       
+000869d0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+000869e0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+000869f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00086a00: 2020 6e75 6d5f 636f 7265 203d 206d 696e    num_core = min
+00086a10: 2820 6e5f 636f 7265 732c 2028 6370 755f  ( n_cores, (cpu_
+00086a20: 636f 756e 7428 2920 2d20 3129 2029 0a20  count() - 1) ). 
+00086a30: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
+00086a40: 6e75 6d20 636f 7265 7320 746f 2075 7365  num cores to use
+00086a50: 203d 207b 7d22 2e66 6f72 6d61 7428 6e75   = {}".format(nu
+00086a60: 6d5f 636f 7265 2929 0a20 2020 2020 2020  m_core)).       
+00086a70: 2070 6f6f 6c20 3d20 506f 6f6c 286e 756d   pool = Pool(num
+00086a80: 5f63 6f72 6529 0a20 2020 2020 2020 2063  _core).        c
+00086a90: 6e74 203d 2031 0a20 2020 2020 2020 2066  nt = 1.        f
+00086aa0: 6f72 2067 645f 7365 6c2c 2073 6571 5f6e  or gd_sel, seq_n
+00086ab0: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
+00086ac0: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
+00086ad0: 7420 696e 205c 0a20 2020 2020 2020 2020  t in \.         
+00086ae0: 2020 2070 6f6f 6c2e 696d 6170 5f75 6e6f     pool.imap_uno
+00086af0: 7264 6572 6564 286d 635f 636f 7265 5f72  rdered(mc_core_r
+00086b00: 6563 6f6e 7374 7275 6374 696f 6e2c 2067  econstruction, g
+00086b10: 6763 5f74 7570 6c65 293a 0a20 2020 2020  gc_tuple):.     
+00086b20: 2020 2020 2020 2023 2074 7164 6d2e 7471         # tqdm.tq
+00086b30: 646d 5f6e 6f74 6562 6f6f 6b28 706f 6f6c  dm_notebook(pool
+00086b40: 2e69 6d61 705f 756e 6f72 6465 7265 6428  .imap_unordered(
+00086b50: 6d63 5f63 6f72 655f 7265 636f 6e73 7472  mc_core_reconstr
+00086b60: 7563 7469 6f6e 2c20 6767 635f 7475 706c  uction, ggc_tupl
+00086b70: 6529 2c20 746f 7461 6c3d 6c65 6e28 6767  e), total=len(gg
+00086b80: 635f 7475 706c 6529 293a 0a20 2020 2020  c_tuple)):.     
+00086b90: 2020 2020 2020 2023 2323 2323 2323 2323         #########
+00086ba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086bb0: 230a 2020 2020 2020 2020 2020 2020 6765  #.            ge
+00086bc0: 6e6f 6d65 5b63 6872 6d5d 2e73 6571 203d  nome[chrm].seq =
+00086bd0: 2073 6571 5f6e 6577 0a20 2020 2020 2020   seq_new.       
+00086be0: 2020 2020 206f 665f 6469 6374 5b63 6872       of_dict[chr
+00086bf0: 6d5d 203d 206f 660a 2020 2020 2020 2020  m] = of.        
+00086c00: 2020 2020 2320 6764 735f 6c73 742e 6170      # gds_lst.ap
+00086c10: 7065 6e64 2867 645f 7365 6c29 0a20 2020  pend(gd_sel).   
+00086c20: 2020 2020 2020 2020 2023 2073 6e76 5f6c           # snv_l
+00086c30: 7374 2e61 7070 656e 6428 736e 765f 696e  st.append(snv_in
+00086c40: 666f 5f63 6872 290a 2020 2020 2020 2020  fo_chr).        
+00086c50: 2020 2020 6764 735f 6e65 7720 3d20 6764      gds_new = gd
+00086c60: 735f 6e65 7720 2b20 6764 5f73 656c 0a20  s_new + gd_sel. 
+00086c70: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
+00086c80: 6e66 6f5f 6c73 7420 3d20 736e 765f 696e  nfo_lst = snv_in
+00086c90: 666f 5f6c 7374 202b 2073 6e76 5f69 6e66  fo_lst + snv_inf
+00086ca0: 6f5f 6368 720a 2020 2020 2020 2020 2020  o_chr.          
+00086cb0: 2020 0a20 2020 2020 2020 2020 2020 206e    .            n
+00086cc0: 6274 2c20 6e62 652c 206e 6c74 2c20 6e6c  bt, nbe, nlt, nl
+00086cd0: 652c 206e 742c 206e 653d 2065 7374 6174  e, nt, ne= estat
+00086ce0: 0a20 2020 2020 2020 2020 2020 206e 5f62  .            n_b
+00086cf0: 6173 6573 5f74 6f74 616c 202b 3d20 6e62  ases_total += nb
+00086d00: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
+00086d10: 6572 5f62 6173 6573 202b 3d20 6e62 650a  er_bases += nbe.
+00086d20: 2020 2020 2020 2020 2020 2020 6e5f 626c              n_bl
+00086d30: 6b5f 746f 7461 6c20 2b3d 206e 6c74 0a20  k_total += nlt. 
+00086d40: 2020 2020 2020 2020 2020 206e 5f65 725f             n_er_
+00086d50: 626c 6b20 2b3d 206e 6c65 0a20 2020 2020  blk += nle.     
+00086d60: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
+00086d70: 0a20 2020 2020 2020 2020 2020 206e 7065  .            npe
+00086d80: 202b 3d20 6e65 0a20 2020 2020 2020 2020   += ne.         
+00086d90: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00086da0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00086db0: 2020 2020 2020 2020 2020 636e 7420 2b3d            cnt +=
+00086dc0: 2031 0a20 2020 2020 2020 2020 2020 2070   1.            p
+00086dd0: 7269 6e74 2827 5c72 5265 636f 6e73 7472  rint('\rReconstr
+00086de0: 7563 7469 6e67 2028 2569 2920 2e2e 2025  ucting (%i) .. %
+00086df0: 692f 2569 2028 2573 2920 2020 2020 2020  i/%i (%s)       
+00086e00: 2020 2020 2027 2025 2028 6e75 6d5f 636f       ' % (num_co
+00086e10: 7265 2c20 636e 742c 206c 656e 2867 6763  re, cnt, len(ggc
+00086e20: 5f74 7570 6c65 292c 2063 6872 6d29 2c20  _tuple), chrm), 
+00086e30: 656e 6420 3d20 2720 2020 2020 2020 2020  end = '         
+00086e40: 2020 2020 2020 2020 2020 2020 2729 0a20              '). 
+00086e50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00086e60: 2020 2020 706f 6f6c 2e63 6c6f 7365 2829      pool.close()
+00086e70: 0a20 2020 2020 2020 2070 6f6f 6c2e 6a6f  .        pool.jo
+00086e80: 696e 2829 0a20 2020 2020 2020 200a 2020  in().        .  
+00086e90: 2020 2727 270a 2020 2020 6764 735f 6e65    '''.    gds_ne
+00086ea0: 7720 3d20 5b5d 0a20 2020 2073 6e76 5f69  w = [].    snv_i
+00086eb0: 6e66 6f5f 6c73 7420 3d20 5b5d 0a20 2020  nfo_lst = [].   
+00086ec0: 2066 6f72 206b 6b2c 2063 6872 6d20 696e   for kk, chrm in
+00086ed0: 2065 6e75 6d65 7261 7465 2863 6872 5f6c   enumerate(chr_l
+00086ee0: 7374 293a 0a20 2020 2020 2020 2067 6473  st):.        gds
+00086ef0: 5f6e 6577 203d 2067 6473 5f6e 6577 202b  _new = gds_new +
+00086f00: 2067 6473 5f6c 7374 5b6b 6b5d 0a20 2020   gds_lst[kk].   
+00086f10: 2020 2020 2073 6e76 5f69 6e66 6f5f 6c73       snv_info_ls
+00086f20: 7420 3d20 736e 765f 696e 666f 5f6c 7374  t = snv_info_lst
+00086f30: 202b 2073 6e76 5f6c 7374 5b6b 6b5d 0a0a   + snv_lst[kk]..
+00086f40: 2020 2020 6465 6c20 6764 735f 6c73 740a      del gds_lst.
+00086f50: 2020 2020 2327 2727 0a20 2020 2020 0a20      #'''.     . 
+00086f60: 2020 2065 6c61 7073 6564 5f74 696d 6532     elapsed_time2
+00086f70: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+00086f80: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
+00086f90: 7072 696e 7428 275c 7252 6563 6f6e 7374  print('\rReconst
+00086fa0: 7275 6374 696f 6e20 2e2e 2064 6f6e 652e  ruction .. done.
+00086fb0: 2028 2569 2920 2020 2020 2020 2020 2020   (%i)           
+00086fc0: 2027 2025 2028 656c 6170 7365 645f 7469   ' % (elapsed_ti
+00086fd0: 6d65 3229 2c20 666c 7573 6820 3d20 5472  me2), flush = Tr
+00086fe0: 7565 290a 2020 2020 7072 696e 7428 2749  ue).    print('I
+00086ff0: 6e74 6567 7269 7479 2063 6865 636b 3a20  ntegrity check: 
+00087000: 2025 692f 2569 2c20 2569 2f25 692c 2025   %i/%i, %i/%i, %
+00087010: 692f 2569 2720 2520 5c0a 2020 2020 2020  i/%i' % \.      
+00087020: 2020 2020 286e 5f65 725f 6261 7365 732c      (n_er_bases,
+00087030: 206e 5f62 6173 6573 5f74 6f74 616c 2c20   n_bases_total, 
+00087040: 6e5f 6572 5f62 6c6b 2c20 6e5f 626c 6b5f  n_er_blk, n_blk_
+00087050: 746f 7461 6c2c 206e 7065 2c20 6e70 7429  total, npe, npt)
+00087060: 2c20 666c 7573 6820 3d20 5472 7565 2029  , flush = True )
+00087070: 0a20 2020 2020 200a 2020 2020 2727 2720  .      .    ''' 
+00087080: 200a 2020 2020 4e74 725f 616c 6c20 3d20   .    Ntr_all = 
+00087090: 300a 2020 2020 666f 7220 6764 2069 6e20  0.    for gd in 
+000870a0: 6764 735f 6e65 773a 204e 7472 5f61 6c6c  gds_new: Ntr_all
+000870b0: 202b 3d20 6764 2e6e 7472 0a20 2020 2070   += gd.ntr.    p
+000870c0: 7269 6e74 2827 4e5f 7472 2028 6166 7465  rint('N_tr (afte
+000870d0: 7229 203d 2025 6927 2025 204e 7472 5f61  r) = %i' % Ntr_a
+000870e0: 6c6c 290a 0a20 2020 206e 5f74 7220 3d20  ll)..    n_tr = 
+000870f0: 300a 2020 2020 6e5f 6e65 675f 636f 7620  0.    n_neg_cov 
+00087100: 3d20 300a 2020 2020 6e5f 706f 735f 636f  = 0.    n_pos_co
+00087110: 7620 3d20 300a 2020 2020 666f 7220 6764  v = 0.    for gd
+00087120: 2069 6e20 6764 735f 6e65 773a 0a20 2020   in gds_new:.   
+00087130: 2020 2020 206e 5f74 7220 2b3d 2067 642e       n_tr += gd.
+00087140: 6e74 720a 2020 2020 2020 2020 666f 7220  ntr.        for 
+00087150: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
+00087160: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00087170: 7464 2e63 6f76 203c 3d20 303a 206e 5f6e  td.cov <= 0: n_n
+00087180: 6567 5f63 6f76 202b 3d20 310a 2020 2020  eg_cov += 1.    
+00087190: 2020 2020 2020 2020 656c 6966 2074 642e          elif td.
+000871a0: 636f 7620 3e20 303a 206e 5f70 6f73 5f63  cov > 0: n_pos_c
+000871b0: 6f76 202b 3d20 310a 2020 2020 7072 696e  ov += 1.    prin
+000871c0: 7428 274e 5f74 7273 203d 2025 692c 2025  t('N_trs = %i, %
+000871d0: 692c 2025 6927 2025 2028 6e5f 7472 2c20  i, %i' % (n_tr, 
+000871e0: 6e5f 6e65 675f 636f 762c 206e 5f70 6f73  n_neg_cov, n_pos
+000871f0: 5f63 6f76 2929 0a20 2020 2023 2727 270a  _cov)).    #'''.
+00087200: 2020 2020 2020 2020 0a20 2020 2073 7461          .    sta
+00087210: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
+00087220: 696d 6528 290a 2020 2020 6774 665f 6c69  ime().    gtf_li
+00087230: 6e65 7320 3d20 5b5d 0a20 2020 2066 615f  nes = [].    fa_
+00087240: 6c69 6e65 735f 7472 203d 205b 5d0a 2020  lines_tr = [].  
+00087250: 2020 6661 5f6c 696e 6573 5f70 7220 3d20    fa_lines_pr = 
+00087260: 5b5d 0a0a 2020 2020 2320 7361 7665 5f67  []..    # save_g
+00087270: 7466 3228 2066 6e61 6d65 2c20 6774 665f  tf2( fname, gtf_
+00087280: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
+00087290: 2068 6472 203d 204e 6f6e 652c 2066 6f20   hdr = None, fo 
+000872a0: 3d20 4e6f 6e65 2063 6c6f 7365 203d 2046  = None close = F
+000872b0: 616c 7365 2029 0a20 2020 200a 2020 2020  alse ).    .    
+000872c0: 6966 2072 6576 3a20 0a20 2020 2020 2020  if rev: .       
+000872d0: 2068 6472 5f6c 696e 6573 2e61 7070 656e   hdr_lines.appen
+000872e0: 6428 2752 6566 2e20 6765 6e6f 6d65 3a20  d('Ref. genome: 
+000872f0: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
+00087300: 6529 0a20 2020 2020 2020 2066 5f67 7466  e).        f_gtf
+00087310: 203d 2073 6176 655f 6774 6632 2820 6774   = save_gtf2( gt
+00087320: 665f 6669 6c65 5f6e 6577 2c20 6774 665f  f_file_new, gtf_
+00087330: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
+00087340: 2068 6472 203d 2068 6472 5f6c 696e 6573   hdr = hdr_lines
+00087350: 2029 0a0a 2020 2020 6674 203d 206f 7065   )..    ft = ope
+00087360: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
+00087370: 2c20 2777 2b27 290a 2020 2020 6670 203d  , 'w+').    fp =
+00087380: 206f 7065 6e28 6661 5f66 696c 655f 7072   open(fa_file_pr
+00087390: 5f6e 6577 2c20 2777 2b27 290a 0a20 2020  _new, 'w+')..   
+000873a0: 2067 6473 5f6e 6577 203d 2073 6f72 745f   gds_new = sort_
+000873b0: 6465 7363 7269 7074 6f72 5f6c 7374 2867  descriptor_lst(g
+000873c0: 6473 5f6e 6577 290a 2020 2020 636e 745f  ds_new).    cnt_
+000873d0: 6e6f 6e65 203d 2030 0a20 2020 2070 7269  none = 0.    pri
+000873e0: 6e74 2827 4765 6e65 7261 7469 6e67 2047  nt('Generating G
+000873f0: 5446 2061 6e64 2054 7261 6e73 6372 6970  TF and Transcrip
+00087400: 746f 6d65 2f50 726f 7465 6f6d 6520 2e2e  tome/Proteome ..
+00087410: 2027 2c20 656e 643d 2720 2020 2027 290a   ', end='    ').
+00087420: 0a20 2020 2069 6620 6e5f 636f 7265 7320  .    if n_cores 
+00087430: 3d3d 2031 3a0a 2020 2020 2020 2020 636e  == 1:.        cn
+00087440: 745f 7420 3d20 300a 2020 2020 2020 2020  t_t = 0.        
+00087450: 636e 745f 7020 3d20 300a 2020 2020 2020  cnt_p = 0.      
+00087460: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
+00087470: 6e75 6d65 7261 7465 2867 6473 5f6e 6577  numerate(gds_new
+00087480: 293a 0a20 2020 2020 2020 2020 2020 200a  ):.            .
+00087490: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000874a0: 6d2b 3129 2531 3030 203d 3d20 303a 2070  m+1)%100 == 0: p
+000874b0: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
+000874c0: 6e67 2047 5446 2061 6e64 2054 7261 6e73  ng GTF and Trans
+000874d0: 6372 6970 746f 6d65 2f50 726f 7465 6f6d  criptome/Proteom
+000874e0: 6520 2e2e 2025 692f 2569 2720 2520 286d  e .. %i/%i' % (m
+000874f0: 2c20 6c65 6e28 6764 735f 6e65 7729 292c  , len(gds_new)),
+00087500: 2065 6e64 203d 2027 2020 2027 2c20 666c   end = '   ', fl
+00087510: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+00087520: 2020 2020 2020 2020 6e74 722c 206e 7072          ntr, npr
+00087530: 2c20 6e65 7220 3d20 6764 2e75 7064 6174  , ner = gd.updat
+00087540: 655f 7464 5f69 6e66 6f28 7365 6c20 3d20  e_td_info(sel = 
+00087550: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
+00087560: 6529 2020 2020 2020 2020 2020 2020 0a20  e)            . 
+00087570: 2020 2020 2020 2020 2020 2067 7466 6c2c             gtfl,
+00087580: 2063 6e20 3d20 6764 2e67 6574 5f67 7466   cn = gd.get_gtf
+00087590: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
+000875a0: 7328 7365 6c20 3d20 312c 2061 6464 5f73  s(sel = 1, add_s
+000875b0: 6571 203d 2046 616c 7365 2c20 636f 6e6e  eq = False, conn
+000875c0: 6563 7420 3d20 5472 7565 290a 2020 2020  ect = True).    
+000875d0: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
+000875e0: 202b 3d20 636e 0a20 2020 2020 2020 2020   += cn.         
+000875f0: 2020 206c 742c 206c 7020 3d20 6764 2e67     lt, lp = gd.g
+00087600: 6574 5f66 6173 7461 5f6c 696e 6573 5f66  et_fasta_lines_f
+00087610: 726f 6d5f 6578 6f6e 7328 7365 6c20 3d20  rom_exons(sel = 
+00087620: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
+00087630: 6529 0a20 2020 2020 2020 2020 2020 206c  e).            l
+00087640: 7420 3d20 6669 6c74 6572 5f74 7273 5f6c  t = filter_trs_l
+00087650: 656e 286c 742c 206d 696e 5f6c 656e 203d  en(lt, min_len =
+00087660: 204d 494e 5f54 525f 4c45 4e47 5448 290a   MIN_TR_LENGTH).
+00087670: 2020 2020 2020 2020 2020 2020 6c70 203d              lp =
+00087680: 2066 696c 7465 725f 7472 735f 6c65 6e28   filter_trs_len(
+00087690: 6c70 2c20 6d69 6e5f 6c65 6e20 3d20 4d49  lp, min_len = MI
+000876a0: 4e5f 5052 5f4c 454e 4754 4829 0a20 2020  N_PR_LENGTH).   
+000876b0: 2020 2020 2020 2020 2069 6620 7265 763a           if rev:
+000876c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000876d0: 2066 5f67 7466 203d 2073 6176 655f 6774   f_gtf = save_gt
+000876e0: 6632 2820 6774 665f 6669 6c65 5f6e 6577  f2( gtf_file_new
+000876f0: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
+00087700: 2067 7466 6c2c 2066 6f20 3d20 665f 6774   gtfl, fo = f_gt
+00087710: 6620 2920 0a20 2020 2020 2020 2020 2020  f ) .           
+00087720: 2020 2020 2023 2067 7466 5f6c 696e 6573       # gtf_lines
+00087730: 203d 2067 7466 5f6c 696e 6573 202b 2067   = gtf_lines + g
+00087740: 7466 6c0a 2020 2020 2020 2020 0a20 2020  tfl.        .   
+00087750: 2020 2020 2020 2020 2066 742e 7772 6974           ft.writ
+00087760: 656c 696e 6573 286c 7429 0a20 2020 2020  elines(lt).     
+00087770: 2020 2020 2020 2066 702e 7772 6974 656c         fp.writel
+00087780: 696e 6573 286c 7029 0a20 2020 2020 2020  ines(lp).       
+00087790: 2020 2020 2023 2066 615f 6c69 6e65 735f       # fa_lines_
+000877a0: 7472 203d 2066 615f 6c69 6e65 735f 7472  tr = fa_lines_tr
+000877b0: 202b 206c 740a 2020 2020 2020 2020 2020   + lt.          
+000877c0: 2020 2320 6661 5f6c 696e 6573 5f70 7220    # fa_lines_pr 
+000877d0: 3d20 6661 5f6c 696e 6573 5f70 7220 2b20  = fa_lines_pr + 
+000877e0: 6c70 0a20 2020 2020 2020 2020 2020 2063  lp.            c
+000877f0: 6e74 5f74 202b 3d20 6c65 6e28 6c74 290a  nt_t += len(lt).
+00087800: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+00087810: 7020 2b3d 206c 656e 286c 7029 0a20 2020  p += len(lp).   
+00087820: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00087830: 2020 656c 6170 7365 645f 7469 6d65 3220    elapsed_time2 
+00087840: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
+00087850: 7374 6172 745f 7469 6d65 0a20 2020 2020  start_time.     
+00087860: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
+00087870: 7261 7469 6e67 2047 5446 2061 6e64 2054  rating GTF and T
+00087880: 7261 6e73 6372 6970 746f 6d65 2f50 726f  ranscriptome/Pro
+00087890: 7465 6f6d 6520 2e2e 2025 692c 2025 6920  teome .. %i, %i 
+000878a0: 646f 6e65 2e20 2825 6929 2027 2025 2028  done. (%i) ' % (
+000878b0: 6c65 6e28 6764 735f 6e65 7729 2c20 636e  len(gds_new), cn
+000878c0: 745f 6e6f 6e65 2c20 656c 6170 7365 645f  t_none, elapsed_
+000878d0: 7469 6d65 3229 2c20 666c 7573 6820 3d20  time2), flush = 
+000878e0: 5472 7565 290a 0a20 2020 2065 6c73 653a  True)..    else:
+000878f0: 0a20 2020 2020 2020 206e 756d 5f63 6f72  .        num_cor
+00087900: 6520 3d20 6d69 6e28 206e 5f63 6f72 6573  e = min( n_cores
+00087910: 2c20 2863 7075 5f63 6f75 6e74 2829 202d  , (cpu_count() -
+00087920: 2031 2920 290a 2020 2020 2020 2020 2320   1) ).        # 
+00087930: 7072 696e 7428 226e 756d 2063 6f72 6573  print("num cores
+00087940: 2074 6f20 7573 6520 3d20 7b7d 222e 666f   to use = {}".fo
+00087950: 726d 6174 286e 756d 5f63 6f72 6529 290a  rmat(num_core)).
+00087960: 2020 2020 2020 2020 706f 6f6c 203d 2050          pool = P
+00087970: 6f6f 6c28 6e75 6d5f 636f 7265 290a 2020  ool(num_core).  
+00087980: 2020 2020 2020 636e 7420 3d20 310a 2020        cnt = 1.  
+00087990: 2020 2020 2020 636e 745f 7420 3d20 300a        cnt_t = 0.
+000879a0: 2020 2020 2020 2020 636e 745f 7020 3d20          cnt_p = 
+000879b0: 300a 2020 2020 2020 2020 666f 7220 6774  0.        for gt
+000879c0: 666c 2c20 6c74 2c20 6c70 2c20 6368 726d  fl, lt, lp, chrm
+000879d0: 2c20 6e65 2c20 636e 2069 6e20 706f 6f6c  , ne, cn in pool
+000879e0: 2e6d 6170 286d 635f 636f 7265 5f67 6574  .map(mc_core_get
+000879f0: 5f67 7466 5f61 6e64 5f66 6173 7461 5f70  _gtf_and_fasta_p
+00087a00: 742c 2067 6473 5f6e 6577 293a 0a20 2020  t, gds_new):.   
+00087a10: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00087a20: 2020 2020 2020 636e 745f 6e6f 6e65 202b        cnt_none +
+00087a30: 3d20 636e 0a20 2020 2020 2020 2020 2020  = cn.           
+00087a40: 2069 6620 2863 6e74 2b31 2925 3130 3020   if (cnt+1)%100 
+00087a50: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00087a60: 2020 2020 2020 7072 696e 7428 275c 7247        print('\rG
+00087a70: 656e 6572 6174 696e 6720 4754 4620 616e  enerating GTF an
+00087a80: 6420 5472 616e 7363 7269 7074 6f6d 652f  d Transcriptome/
+00087a90: 5072 6f74 656f 6d65 202e 2e20 2569 2f25  Proteome .. %i/%
+00087aa0: 6927 2025 2028 636e 742c 206c 656e 2867  i' % (cnt, len(g
+00087ab0: 6473 5f6e 6577 2929 2c20 656e 6420 3d20  ds_new)), end = 
+00087ac0: 2720 2020 2729 0a20 2020 2020 2020 2020  '   ').         
+00087ad0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00087ae0: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
+00087af0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00087b00: 2020 2020 2020 2020 2020 6c74 203d 2066            lt = f
+00087b10: 696c 7465 725f 7472 735f 6c65 6e28 6c74  ilter_trs_len(lt
+00087b20: 2c20 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f  , min_len = MIN_
+00087b30: 5452 5f4c 454e 4754 4829 0a20 2020 2020  TR_LENGTH).     
+00087b40: 2020 2020 2020 206c 7020 3d20 6669 6c74         lp = filt
+00087b50: 6572 5f74 7273 5f6c 656e 286c 702c 206d  er_trs_len(lp, m
+00087b60: 696e 5f6c 656e 203d 204d 494e 5f50 525f  in_len = MIN_PR_
+00087b70: 4c45 4e47 5448 290a 2020 2020 2020 2020  LENGTH).        
+00087b80: 2020 2020 6966 2072 6576 3a0a 2020 2020      if rev:.    
+00087b90: 2020 2020 2020 2020 2020 2020 665f 6774              f_gt
+00087ba0: 6620 3d20 7361 7665 5f67 7466 3228 2067  f = save_gtf2( g
+00087bb0: 7466 5f66 696c 655f 6e65 772c 2067 7466  tf_file_new, gtf
+00087bc0: 5f6c 696e 655f 6c73 7420 3d20 6774 666c  _line_lst = gtfl
+00087bd0: 2c20 666f 203d 2066 5f67 7466 2029 2020  , fo = f_gtf )  
+00087be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00087bf0: 2023 2067 7466 5f6c 696e 6573 203d 2067   # gtf_lines = g
+00087c00: 7466 5f6c 696e 6573 202b 2067 7466 6c0a  tf_lines + gtfl.
+00087c10: 0a20 2020 2020 2020 2020 2020 2066 742e  .            ft.
+00087c20: 7772 6974 656c 696e 6573 286c 7429 0a20  writelines(lt). 
+00087c30: 2020 2020 2020 2020 2020 2066 702e 7772             fp.wr
+00087c40: 6974 656c 696e 6573 286c 7029 0a20 2020  itelines(lp).   
+00087c50: 2020 2020 2020 2020 2023 2066 615f 6c69           # fa_li
+00087c60: 6e65 735f 7472 203d 2066 615f 6c69 6e65  nes_tr = fa_line
+00087c70: 735f 7472 202b 206c 740a 2020 2020 2020  s_tr + lt.      
+00087c80: 2020 2020 2020 2320 6661 5f6c 696e 6573        # fa_lines
+00087c90: 5f70 7220 3d20 6661 5f6c 696e 6573 5f70  _pr = fa_lines_p
+00087ca0: 7220 2b20 6c70 0a20 2020 2020 2020 2020  r + lp.         
+00087cb0: 2020 2063 6e74 5f74 202b 3d20 6c65 6e28     cnt_t += len(
+00087cc0: 6c74 290a 2020 2020 2020 2020 2020 2020  lt).            
+00087cd0: 636e 745f 7020 2b3d 206c 656e 286c 7029  cnt_p += len(lp)
+00087ce0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00087cf0: 2020 2020 2020 706f 6f6c 2e63 6c6f 7365        pool.close
+00087d00: 2829 0a20 2020 2020 2020 2070 6f6f 6c2e  ().        pool.
+00087d10: 6a6f 696e 2829 0a0a 2020 2020 2020 2020  join()..        
+00087d20: 656c 6170 7365 645f 7469 6d65 3220 3d20  elapsed_time2 = 
+00087d30: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+00087d40: 6172 745f 7469 6d65 0a20 2020 2020 2020  art_time.       
+00087d50: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
+00087d60: 7469 6e67 2047 5446 2061 6e64 2054 7261  ting GTF and Tra
+00087d70: 6e73 6372 6970 746f 6d65 2f50 726f 7465  nscriptome/Prote
+00087d80: 6f6d 6520 2e2e 2064 6f6e 652e 2025 692c  ome .. done. %i,
+00087d90: 2025 692c 2025 6920 2825 6929 2027 2025   %i, %i (%i) ' %
+00087da0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00087db0: 2028 636e 745f 6e6f 6e65 2c20 696e 7428   (cnt_none, int(
+00087dc0: 636e 745f 742f 3229 2c20 696e 7428 636e  cnt_t/2), int(cn
+00087dd0: 745f 702f 3229 2c20 656c 6170 7365 645f  t_p/2), elapsed_
+00087de0: 7469 6d65 3229 290a 2020 2020 2020 2020  time2)).        
+00087df0: 0a20 2020 2069 6620 7265 763a 2073 6176  .    if rev: sav
+00087e00: 655f 6774 6632 2820 6774 665f 6669 6c65  e_gtf2( gtf_file
+00087e10: 5f6e 6577 2c20 6774 665f 6c69 6e65 5f6c  _new, gtf_line_l
+00087e20: 7374 203d 204e 6f6e 652c 2066 6f20 3d20  st = None, fo = 
+00087e30: 665f 6774 662c 2063 6c6f 7365 203d 2054  f_gtf, close = T
+00087e40: 7275 6520 290a 2020 2020 6674 2e63 6c6f  rue ).    ft.clo
+00087e50: 7365 2829 0a20 2020 2066 702e 636c 6f73  se().    fp.clos
+00087e60: 6528 290a 0a20 2020 2023 2064 656c 2067  e()..    # del g
+00087e70: 6473 5f6e 6577 0a0a 2020 2020 2727 2720  ds_new..    ''' 
+00087e80: 2020 200a 2020 2020 7374 6172 745f 7469     .    start_ti
+00087e90: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+00087ea0: 0a20 2020 2070 7269 6e74 2827 5361 7669  .    print('Savi
+00087eb0: 6e67 2046 4153 5441 2028 2569 2c20 2569  ng FASTA (%i, %i
+00087ec0: 202f 2025 6929 202e 2e27 2025 2028 6c65   / %i) ..' % (le
+00087ed0: 6e28 6661 5f6c 696e 6573 5f74 7229 2f32  n(fa_lines_tr)/2
+00087ee0: 2c20 6c65 6e28 6661 5f6c 696e 6573 5f70  , len(fa_lines_p
+00087ef0: 7229 2f32 2c20 6e5f 7472 292c 2065 6e64  r)/2, n_tr), end
+00087f00: 203d 2027 272c 2066 6c75 7368 203d 2054   = '', flush = T
+00087f10: 7275 6529 0a20 2020 2066 203d 206f 7065  rue).    f = ope
+00087f20: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
+00087f30: 2c20 2777 2b27 290a 2020 2020 662e 7772  , 'w+').    f.wr
+00087f40: 6974 656c 696e 6573 2866 615f 6c69 6e65  itelines(fa_line
+00087f50: 735f 7472 290a 2020 2020 662e 636c 6f73  s_tr).    f.clos
+00087f60: 6528 290a 0a20 2020 2070 7269 6e74 2827  e()..    print('
+00087f70: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+00087f80: 6620 3d20 6f70 656e 2866 615f 6669 6c65  f = open(fa_file
+00087f90: 5f70 725f 6e65 772c 2027 772b 2729 0a20  _pr_new, 'w+'). 
+00087fa0: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
+00087fb0: 6661 5f6c 696e 6573 5f70 7229 0a20 2020  fa_lines_pr).   
+00087fc0: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
+00087fd0: 656c 6170 7365 645f 7469 6d65 203d 2074  elapsed_time = t
+00087fe0: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
+00087ff0: 7274 5f74 696d 650a 2020 2020 7072 696e  rt_time.    prin
+00088000: 7428 2720 646f 6e65 2e20 2825 6929 2720  t(' done. (%i)' 
+00088010: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
+00088020: 290a 2020 2020 2727 270a 0a20 2020 2070  ).    '''..    p
+00088030: 7269 6e74 2827 2020 2025 7327 2025 2066  rint('   %s' % f
+00088040: 615f 6669 6c65 5f74 725f 6e65 7720 290a  a_file_tr_new ).
+00088050: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
+00088060: 2720 2520 6661 5f66 696c 655f 7072 5f6e  ' % fa_file_pr_n
+00088070: 6577 2029 0a20 2020 2069 6620 7265 763a  ew ).    if rev:
+00088080: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
+00088090: 2067 7466 5f66 696c 655f 6e65 7729 0a0a   gtf_file_new)..
+000880a0: 2020 2020 736e 765f 6c73 7420 3d20 5b5d      snv_lst = []
+000880b0: 0a20 2020 2066 6f72 2073 6e76 2069 6e20  .    for snv in 
+000880c0: 736e 765f 696e 666f 5f6c 7374 3a0a 2020  snv_info_lst:.  
+000880d0: 2020 2020 2020 6e76 6920 3d20 746f 5f6e        nvi = to_n
+000880e0: 765f 7369 6d70 6c65 2820 736e 7620 290a  v_simple( snv ).
+000880f0: 2020 2020 2020 2020 736e 765f 6c73 742e          snv_lst.
+00088100: 6170 7065 6e64 286e 7669 290a 2020 2020  append(nvi).    
+00088110: 2020 2020 0a20 2020 2064 665f 736e 7620      .    df_snv 
+00088120: 3d20 7064 2e44 6174 6146 7261 6d65 2873  = pd.DataFrame(s
+00088130: 6e76 5f6c 7374 290a 2020 2020 6466 5f73  nv_lst).    df_s
+00088140: 6e76 2e74 6f5f 6373 7628 666e 616d 655f  nv.to_csv(fname_
+00088150: 736e 762c 2073 6570 203d 2027 5c74 2729  snv, sep = '\t')
+00088160: 0a20 2020 2070 7269 6e74 2827 534e 5620  .    print('SNV 
+00088170: 7375 6d6d 6172 7920 7361 7665 6420 746f  summary saved to
+00088180: 205c 6e20 2020 2573 2720 2520 666e 616d   \n   %s' % fnam
+00088190: 655f 736e 7629 0a20 2020 2023 2077 7269  e_snv).    # wri
+000881a0: 7465 5f74 6f5f 7663 6628 2073 6e76 5f69  te_to_vcf( snv_i
+000881b0: 6e66 6f5f 6c73 742c 2066 6e61 6d65 5f76  nfo_lst, fname_v
+000881c0: 6366 2029 0a0a 2020 2020 2327 2727 2020  cf )..    #'''  
+000881d0: 2020 0a20 2020 2069 6620 7265 763a 0a20    .    if rev:. 
+000881e0: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
+000881f0: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
+00088200: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
+00088210: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
+00088220: 6720 6375 7374 6f6d 697a 6564 2067 656e  g customized gen
+00088230: 6f6d 6520 2e2e 2027 2c20 656e 6420 3d20  ome .. ', end = 
+00088240: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
+00088250: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
+00088260: 2020 2023 2068 6472 5f6c 696e 6573 2e61     # hdr_lines.a
+00088270: 7070 656e 6428 2752 6566 2e20 6765 6e6f  ppend('Ref. geno
+00088280: 6d65 3a20 2573 2720 2520 6765 6e6f 6d65  me: %s' % genome
+00088290: 5f66 696c 6529 0a20 2020 2020 2020 2023  _file).        #
+000882a0: 2073 6176 655f 6774 6628 6774 665f 6669   save_gtf(gtf_fi
+000882b0: 6c65 5f6e 6577 2c20 6774 665f 6c69 6e65  le_new, gtf_line
+000882c0: 732c 2068 6472 5f6c 696e 6573 290a 2020  s, hdr_lines).  
+000882d0: 2020 2020 2020 0a20 2020 2020 2020 2065        .        e
+000882e0: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
+000882f0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+00088300: 745f 7469 6d65 0a20 2020 2020 2020 2070  t_time.        p
+00088310: 7269 6e74 2827 2064 6f6e 652e 2025 6928  rint(' done. %i(
+00088320: 7329 205c 6e20 2020 2573 2720 2520 2865  s) \n   %s' % (e
+00088330: 6c61 7073 6564 5f74 696d 652c 2067 7466  lapsed_time, gtf
+00088340: 5f66 696c 655f 6e65 7729 290a 2020 2020  _file_new)).    
+00088350: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
+00088360: 2323 2053 6176 6520 6765 6e6f 6d65 2063  ## Save genome c
+00088370: 6f72 7265 6374 6564 0a20 2020 2020 2020  orrected.       
+00088380: 2070 7269 6e74 2827 596f 7520 6172 6520   print('You are 
+00088390: 616c 6d6f 7374 2064 6f6e 652e 205c 6e4c  almost done. \nL
+000883a0: 6173 7420 7374 6570 2069 7320 746f 2073  ast step is to s
+000883b0: 6176 6520 7468 6520 6669 7865 6420 6765  ave the fixed ge
+000883c0: 6e6f 6d65 2e20 2729 0a20 2020 2020 2020  nome. ').       
+000883d0: 2073 6176 655f 6765 6e6f 6d65 2820 6765   save_genome( ge
+000883e0: 6e6f 6d65 5f66 696c 655f 6e65 772c 2067  nome_file_new, g
+000883f0: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
+00088400: 2054 7275 652c 2074 6974 6c65 203d 2027   True, title = '
+00088410: 4765 6e6f 6d65 2d72 6576 2720 290a 2020  Genome-rev' ).  
+00088420: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+00088430: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
+00088440: 655f 6e65 7720 290a 0a20 2020 2070 7269  e_new )..    pri
+00088450: 6e74 2827 5374 7269 6e67 4669 7820 6669  nt('StringFix fi
+00088460: 6e69 7368 6564 2027 2c20 6461 7465 7469  nished ', dateti
+00088470: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
+00088480: 2929 0a0a 2020 2020 7265 7475 726e 2066  ))..    return f
+00088490: 6e61 6d65 2c20 6765 6e6f 6d65 5f66 696c  name, genome_fil
+000884a0: 655f 6e65 7720 232c 2067 6473 5f6e 6577  e_new #, gds_new
+000884b0: 0a20 2020 2023 2727 2720 2020 200a 0a64  .    #'''    ..d
+000884c0: 6566 2053 7472 696e 6746 6978 5f61 7373  ef StringFix_ass
+000884d0: 656d 626c 6528 2049 6e70 7574 203d 204e  emble( Input = N
+000884e0: 6f6e 652c 2067 656e 6f6d 655f 6661 203d  one, genome_fa =
+000884f0: 204e 6f6e 652c 2061 6e6e 6f74 5f67 7466   None, annot_gtf
+00088500: 203d 204e 6f6e 652c 206f 7574 5f64 6972   = None, out_dir
+00088510: 203d 2027 5346 6978 5f6f 7574 272c 205c   = 'SFix_out', \
+00088520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00088530: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
+00088540: 203d 2034 2c20 6f75 745f 6375 7374 6f6d   = 4, out_custom
+00088550: 5f67 656e 6f6d 6520 3d20 4661 6c73 652c  _genome = False,
+00088560: 2073 7566 6669 7820 3d20 4e6f 6e65 2c20   suffix = None, 
+00088570: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00088580: 2020 2020 2020 2020 2020 6d63 7620 3d20            mcv = 
+00088590: 302e 352c 206d 6364 203d 2031 2c20 6d74  0.5, mcd = 1, mt
+000885a0: 6c20 3d20 3230 302c 206d 706c 203d 2035  l = 200, mpl = 5
+000885b0: 302c 206d 6469 203d 2032 2c20 6d64 6420  0, mdi = 2, mdd 
+000885c0: 3d20 322c 206d 6470 203d 2033 2c20 5c0a  = 2, mdp = 3, \.
+000885d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000885e0: 2020 2020 2020 2020 6d64 6620 3d20 302e          mdf = 0.
+000885f0: 322c 206e 5f70 203d 2031 362c 2078 7361  2, n_p = 16, xsa
+00088600: 203d 2054 7275 652c 206a 756d 705f 746f   = True, jump_to
+00088610: 203d 2030 2029 3a0a 0a20 2020 2070 7269   = 0 ):..    pri
+00088620: 6e74 2827 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('+-----------
+00088630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00088640: 2d2d 2d2b 2729 0a20 2020 2070 7269 6e74  ---+').    print
+00088650: 2827 7c20 2020 2020 2053 7472 696e 6766  ('|      Stringf
+00088660: 6978 2076 2e25 7320 2020 2020 2020 7c27  ix v.%s       |'
+00088670: 2025 2053 7472 696e 6746 6978 5f76 6572   % StringFix_ver
+00088680: 7369 6f6e 290a 2020 2020 7072 696e 7428  sion).    print(
+00088690: 272b 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '+--------------
+000886a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000886b0: 2b27 290a 0a20 2020 2069 6620 496e 7075  +')..    if Inpu
+000886c0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+000886d0: 2020 2070 7269 6e74 2827 5573 6167 653a     print('Usage:
+000886e0: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
+000886f0: 2827 2531 3273 3a20 2720 2520 2761 7267  ('%12s: ' % 'arg
+00088700: 756d 656e 7427 2c20 2764 6573 6372 6970  ument', 'descrip
+00088710: 7469 6f6e 2720 290a 2020 2020 2020 2020  tion' ).        
+00088720: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
+00088730: 2027 496e 7075 7427 2c20 2749 6e70 7574   'Input', 'Input
+00088740: 2053 414d 206f 7220 4241 4d20 6669 6c65   SAM or BAM file
+00088750: 2e20 7079 6261 6d2e 7079 2069 7320 7265  . pybam.py is re
+00088760: 7175 6972 6564 2066 6f72 2042 414d 2069  quired for BAM i
+00088770: 6e70 7574 2e27 2029 0a20 2020 2020 2020  nput.' ).       
+00088780: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088790: 2520 2767 656e 6f6d 655f 6661 272c 2065  % 'genome_fa', e
+000887a0: 6e64 203d 2027 2729 0a20 2020 2020 2020  nd = '').       
+000887b0: 2070 7269 6e74 2827 2047 656e 6f6d 6520   print(' Genome 
+000887c0: 6661 7374 6120 6669 6c65 2075 7365 6420  fasta file used 
+000887d0: 746f 2067 656e 6572 6174 6520 7468 6520  to generate the 
+000887e0: 696e 7075 7420 5341 4d2f 4241 4d2e 2027  input SAM/BAM. '
+000887f0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
+00088800: 2827 2531 3273 2020 2049 7420 6973 2075  ('%12s   It is u
+00088810: 7365 6420 746f 2063 6f72 7265 6374 2073  sed to correct s
+00088820: 6571 7565 6e63 6573 206e 6f74 2063 6f76  equences not cov
+00088830: 6572 6564 2062 7920 7265 6164 732c 2027  ered by reads, '
+00088840: 2025 2027 2729 0a20 2020 2020 2020 2070   % '').        p
+00088850: 7269 6e74 2827 2531 3273 2020 2074 6f20  rint('%12s   to 
+00088860: 6964 656e 7469 6679 2053 4e50 7320 616e  identify SNPs an
+00088870: 6420 746f 2067 656e 6572 6174 6520 6375  d to generate cu
+00088880: 7374 6f6d 697a 6564 2067 656e 6f6d 652e  stomized genome.
+00088890: 2027 2020 2520 2727 290a 2020 2020 2020   '  % '').      
+000888a0: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
+000888b0: 2025 2027 616e 6e6f 745f 6774 6627 2c20   % 'annot_gtf', 
+000888c0: 2747 5446 2f47 4646 2066 696c 6520 746f  'GTF/GFF file to
+000888d0: 2062 6520 7573 6564 2066 6f72 2067 7569   be used for gui
+000888e0: 6465 2061 6e6e 6f74 6174 696f 6e27 2029  de annotation' )
+000888f0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088900: 2531 3273 3a20 2720 2520 276f 7574 5f64  %12s: ' % 'out_d
+00088910: 6972 272c 2027 4f75 7470 7574 2064 6972  ir', 'Output dir
+00088920: 6563 746f 7279 2720 290a 2020 2020 2020  ectory' ).      
+00088930: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
+00088940: 2025 2027 6e5f 636f 7265 7327 2c20 274e   % 'n_cores', 'N
+00088950: 756d 6265 7220 6f66 2063 6f72 6573 2074  umber of cores t
+00088960: 6f20 7573 6527 2029 0a20 2020 2020 2020  o use' ).       
+00088970: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088980: 2520 2773 7566 6669 7827 2c20 2753 7566  % 'suffix', 'Suf
+00088990: 6669 7820 746f 2062 6520 7573 6564 2066  fix to be used f
+000889a0: 6f72 206f 7574 7075 7420 6669 6c65 206e  or output file n
+000889b0: 616d 6573 2720 290a 2020 2020 2020 2020  ames' ).        
+000889c0: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
+000889d0: 2027 6d63 7627 2c20 274d 696e 696d 756d   'mcv', 'Minimum
+000889e0: 2072 6561 6420 636f 7665 7261 6765 2066   read coverage f
+000889f0: 6f72 2069 6e63 6c75 7369 6f6e 2069 6e20  or inclusion in 
+00088a00: 7468 6520 6f75 7470 7574 2047 5446 2f47  the output GTF/G
+00088a10: 4646 2720 290a 2020 2020 2020 2020 7072  FF' ).        pr
+00088a20: 696e 7428 2725 3132 7320 2020 616e 6420  int('%12s   and 
+00088a30: 7472 616e 7363 7269 7074 6f6d 652f 7072  transcriptome/pr
+00088a40: 6f74 656f 6d65 205b 307e 315d 2e20 466f  oteome [0~1]. Fo
+00088a50: 7220 6120 6c65 6e67 7468 204c 2074 7261  r a length L tra
+00088a60: 6e73 6372 6970 742c 2027 2025 2027 2729  nscript, ' % '')
+00088a70: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088a80: 2531 3273 2020 2069 7420 7769 6c6c 2062  %12s   it will b
+00088a90: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
+00088aa0: 6520 6f75 7470 7574 2069 6620 6174 206c  e output if at l
+00088ab0: 6561 7374 206d 6376 2a4c 2062 6173 6573  east mcv*L bases
+00088ac0: 2061 7265 2063 6f76 6572 6564 2062 7920   are covered by 
+00088ad0: 7265 6164 7320 2720 2025 2027 2729 0a20  reads '  % ''). 
+00088ae0: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
+00088af0: 3273 3a20 2720 2520 276d 6364 272c 2027  2s: ' % 'mcd', '
+00088b00: 4d69 6e69 6d75 6d20 6261 7365 2063 6f76  Minimum base cov
+00088b10: 6572 6167 6520 6465 7074 6820 666f 7220  erage depth for 
+00088b20: 696e 636c 7573 696f 6e20 696e 2074 6865  inclusion in the
+00088b30: 206f 7574 7075 7427 2029 0a20 2020 2020   output' ).     
+00088b40: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
+00088b50: 2720 2520 276d 746c 272c 2027 4d69 6e69  ' % 'mtl', 'Mini
+00088b60: 6d75 6d20 7472 616e 7363 7269 7074 206c  mum transcript l
+00088b70: 656e 6774 6820 696e 2062 6173 6573 2720  ength in bases' 
+00088b80: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00088b90: 2725 3132 733a 2027 2025 2027 6d70 6c27  '%12s: ' % 'mpl'
+00088ba0: 2c20 274d 696e 696d 756d 2070 726f 7465  , 'Minimum prote
+00088bb0: 696e 2028 616d 696e 6f20 6163 6964 2073  in (amino acid s
+00088bc0: 6571 7565 6e63 6529 206c 656e 6774 6827  equence) length'
+00088bd0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
+00088be0: 2827 2531 3273 3a20 2720 2520 276d 6469  ('%12s: ' % 'mdi
+00088bf0: 272c 2027 4d69 6e69 6d75 6d20 636f 7665  ', 'Minimum cove
+00088c00: 7261 6765 2064 6570 7468 2066 6f72 2061  rage depth for a
+00088c10: 6e20 696e 7365 7273 696f 6e20 746f 2062  n insersion to b
+00088c20: 6520 636f 6e73 6964 6572 6564 2076 616c  e considered val
+00088c30: 6964 205b 3e3d 312e 305d 2720 290a 2020  id [>=1.0]' ).  
+00088c40: 2020 2020 2020 7072 696e 7428 2725 3132        print('%12
+00088c50: 733a 2027 2025 2027 6d64 6427 2c20 274d  s: ' % 'mdd', 'M
+00088c60: 696e 696d 756d 2063 6f76 6572 6167 6520  inimum coverage 
+00088c70: 6465 7074 6820 666f 7220 6120 6465 6c65  depth for a dele
+00088c80: 7469 6f6e 2074 6f20 6265 2063 6f6e 7369  tion to be consi
+00088c90: 6465 7265 6420 7661 6c69 6420 5b3e 3d31  dered valid [>=1
+00088ca0: 2e30 5d27 2029 0a20 2020 2020 2020 2070  .0]' ).        p
+00088cb0: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
+00088cc0: 276d 6470 272c 2027 4d69 6e69 6d75 6d20  'mdp', 'Minimum 
+00088cd0: 636f 7665 7261 6765 2064 6570 7468 2066  coverage depth f
+00088ce0: 6f72 2053 4e50 2063 6f72 7265 6374 696f  or SNP correctio
+00088cf0: 6e20 5b3e 3d31 2e30 5d27 2029 0a20 2020  n [>=1.0]' ).   
+00088d00: 2020 2020 2070 7269 6e74 2827 2531 3273       print('%12s
+00088d10: 3a20 2720 2520 276d 6466 272c 2027 4d69  : ' % 'mdf', 'Mi
+00088d20: 6e69 6d75 6d20 636f 7665 7261 6765 2064  nimum coverage d
+00088d30: 6570 7468 2066 7261 6374 696f 6e20 666f  epth fraction fo
+00088d40: 7220 696e 7365 7273 696f 6e20 616e 6420  r insersion and 
+00088d50: 6465 6c65 7469 6f6e 2074 6f20 6265 2063  deletion to be c
+00088d60: 6f6e 7369 6465 7265 6420 7661 6c69 6420  onsidered valid 
+00088d70: 2830 7e31 2927 2029 0a20 2020 2020 2020  (0~1)' ).       
+00088d80: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088d90: 2520 276a 756d 705f 746f 272c 2027 4a75  % 'jump_to', 'Ju
+00088da0: 6d70 2074 6f20 7374 6570 206a 205b 3020  mp to step j [0 
+00088db0: 6f72 2031 206f 7220 325d 2720 290a 2020  or 1 or 2]' ).  
+00088dc0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00088dd0: 2020 7361 6d5f 6669 6c65 203d 2049 6e70    sam_file = Inp
+00088de0: 7574 0a20 2020 2067 7466 5f66 696c 6520  ut.    gtf_file 
+00088df0: 3d20 616e 6e6f 745f 6774 660a 0a20 2020  = annot_gtf..   
+00088e00: 2069 6620 5059 4241 4d5f 4552 523a 0a20   if PYBAM_ERR:. 
+00088e10: 2020 2020 2020 2070 7269 6e74 2827 5374         print('St
+00088e20: 7269 6e67 4669 7820 5741 524e 494e 473a  ringFix WARNING:
+00088e30: 2070 7962 616d 206e 6f74 2061 7661 696c   pybam not avail
+00088e40: 6162 6c65 2e20 4163 6365 7074 2053 414d  able. Accept SAM
+00088e50: 2066 696c 6520 6f6e 6c79 2e27 290a 0a20   file only.').. 
+00088e60: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
+00088e70: 2069 7320 6e6f 7420 4e6f 6e65 2920 2620   is not None) & 
+00088e80: 2867 7466 5f66 696c 6520 6973 206e 6f74  (gtf_file is not
+00088e90: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
+00088ea0: 7072 696e 7428 2753 7472 696e 6746 6978  print('StringFix
+00088eb0: 2069 7320 7275 6e6e 696e 6720 696e 2061   is running in a
+00088ec0: 6e6e 6f74 6174 696f 6e20 6775 6964 6564  nnotation guided
+00088ed0: 206d 6f64 6520 7769 7468 2073 6571 7565   mode with seque
+00088ee0: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
+00088ef0: 290a 2020 2020 656c 6966 2028 6765 6e6f  ).    elif (geno
+00088f00: 6d65 5f66 6120 6973 206e 6f74 204e 6f6e  me_fa is not Non
+00088f10: 6529 2026 2028 6774 665f 6669 6c65 2069  e) & (gtf_file i
+00088f20: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
+00088f30: 2070 7269 6e74 2827 5374 7269 6e67 4669   print('StringFi
+00088f40: 7820 6973 2072 756e 6e69 6e67 2069 6e20  x is running in 
+00088f50: 6765 6e6f 6d65 2067 7569 6465 6420 6d6f  genome guided mo
+00088f60: 6465 2077 6974 6820 7365 7175 656e 6365  de with sequence
+00088f70: 2063 6f72 7265 6374 696f 6e2e 2729 0a20   correction.'). 
+00088f80: 2020 2065 6c69 6620 2867 656e 6f6d 655f     elif (genome_
+00088f90: 6661 2069 7320 4e6f 6e65 2920 2620 2867  fa is None) & (g
+00088fa0: 7466 5f66 696c 6520 6973 204e 6f6e 6529  tf_file is None)
+00088fb0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00088fc0: 2753 7472 696e 6746 6978 2069 7320 7275  'StringFix is ru
+00088fd0: 6e6e 696e 6720 696e 2067 656e 6f6d 6520  nning in genome 
+00088fe0: 6775 6964 6564 206d 6f64 6520 7769 7468  guided mode with
+00088ff0: 6f75 7420 7365 7175 656e 6365 2063 6f72  out sequence cor
+00089000: 7265 6374 696f 6e2e 2729 0a20 2020 2065  rection.').    e
+00089010: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
+00089020: 6e74 2827 5374 7269 6e67 4669 7820 6973  nt('StringFix is
+00089030: 2072 756e 6e69 6e67 2069 6e20 616e 6e6f   running in anno
+00089040: 7461 7469 6f6e 2067 7569 6465 6420 6d6f  tation guided mo
+00089050: 6465 2077 6974 686f 7574 2073 6571 7565  de without seque
+00089060: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
+00089070: 290a 2020 2020 0a0a 2020 2020 2320 7265  ).    ..    # re
+00089080: 7620 3d20 4661 6c73 650a 2020 2020 7265  v = False.    re
+00089090: 7620 3d20 6f75 745f 6375 7374 6f6d 5f67  v = out_custom_g
+000890a0: 656e 6f6d 650a 2020 2020 6362 7963 203d  enome.    cbyc =
+000890b0: 2054 7275 6520 0a20 2020 2073 6120 3d20   True .    sa = 
+000890c0: 320a 2020 2020 6966 2078 7361 3a20 7361  2.    if xsa: sa
+000890d0: 203d 2030 0a0a 2020 2020 4d49 4e5f 4356   = 0..    MIN_CV
+000890e0: 475f 464f 525f 534e 505f 434f 5252 4543  G_FOR_SNP_CORREC
+000890f0: 5449 4f4e 203d 2069 6e74 286d 6470 290a  TION = int(mdp).
+00089100: 2020 2020 495f 5641 4c49 445f 4356 4720      I_VALID_CVG 
+00089110: 3d20 6d61 7828 312c 206e 702e 666c 6f61  = max(1, np.floa
+00089120: 7428 6d64 6929 290a 2020 2020 445f 5641  t(mdi)).    D_VA
+00089130: 4c49 445f 4356 4720 3d20 6d61 7828 312c  LID_CVG = max(1,
+00089140: 206e 702e 666c 6f61 7428 6d64 6429 290a   np.float(mdd)).
+00089150: 2020 2020 495f 5641 4c49 445f 4346 5241      I_VALID_CFRA
+00089160: 4320 3d20 666c 6f61 7428 6d64 6629 0a20  C = float(mdf). 
+00089170: 2020 2044 5f56 414c 4944 5f43 4652 4143     D_VALID_CFRAC
+00089180: 203d 2066 6c6f 6174 286d 6466 290a 2020   = float(mdf).  
+00089190: 2020 4d49 4e5f 434f 565f 544f 5f53 454c    MIN_COV_TO_SEL
+000891a0: 203d 206e 702e 666c 6f61 7428 6d63 7629   = np.float(mcv)
+000891b0: 0a20 2020 204d 494e 5f41 424e 5f54 4f5f  .    MIN_ABN_TO_
+000891c0: 5345 4c20 3d20 6e70 2e66 6c6f 6174 286d  SEL = np.float(m
+000891d0: 6364 290a 2020 2020 4d49 4e5f 5452 5f4c  cd).    MIN_TR_L
+000891e0: 454e 4754 4820 3d20 696e 7428 6d74 6c29  ENGTH = int(mtl)
+000891f0: 0a20 2020 204d 494e 5f50 525f 4c45 4e47  .    MIN_PR_LENG
+00089200: 5448 203d 2069 6e74 286d 706c 290a 2020  TH = int(mpl).  
+00089210: 2020 4d41 585f 4e55 4d5f 5041 5448 5320    MAX_NUM_PATHS 
+00089220: 3d20 696e 7428 6e5f 7029 0a20 2020 2047  = int(n_p).    G
+00089230: 454e 5f41 4153 5f55 4e53 5045 4320 3d20  EN_AAS_UNSPEC = 
+00089240: 5472 7565 0a0a 2020 2020 6966 2067 7466  True..    if gtf
+00089250: 5f66 696c 6520 6973 204e 6f6e 653a 0a20  _file is None:. 
+00089260: 2020 2020 2020 204d 4158 5f4e 554d 5f50         MAX_NUM_P
+00089270: 4154 4853 203d 2032 300a 2020 2020 2020  ATHS = 20.      
+00089280: 2020 4d49 4e5f 4e5f 5244 535f 5045 525f    MIN_N_RDS_PER_
+00089290: 4745 4e45 203d 2033 300a 2020 2020 2020  GENE = 30.      
+000892a0: 2020 5452 5f46 494c 5445 525f 5345 4c20    TR_FILTER_SEL 
+000892b0: 3d20 320a 0a20 2020 2069 6620 6f75 745f  = 2..    if out_
+000892c0: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
+000892d0: 200a 2020 2020 2020 2020 6966 206e 6f74   .        if not
+000892e0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000892f0: 6f75 745f 6469 7229 3a20 6f73 2e6d 6b64  out_dir): os.mkd
+00089300: 6972 286f 7574 5f64 6972 290a 0a20 2020  ir(out_dir)..   
+00089310: 2066 696c 655f 6f75 742c 2067 6473 2c20   file_out, gds, 
+00089320: 6765 6e6f 6d65 203d 2053 7472 696e 6746  genome = StringF
+00089330: 6978 5f61 6e61 6c79 7369 7328 7361 6d5f  ix_analysis(sam_
+00089340: 6669 6c65 2c20 6774 6620 3d20 6774 665f  file, gtf = gtf_
+00089350: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
+00089360: 6520 3d20 6765 6e6f 6d65 5f66 612c 206a  e = genome_fa, j
+00089370: 756d 7020 3d20 6a75 6d70 5f74 6f2c 205c  ump = jump_to, \
+00089380: 0a20 2020 2020 2020 2020 2020 206e 5f63  .            n_c
+00089390: 6f72 6573 3d6e 5f63 6f72 6573 2c20 6f75  ores=n_cores, ou
+000893a0: 745f 7472 203d 2054 7275 652c 2063 6279  t_tr = True, cby
+000893b0: 6320 3d20 6362 7963 2c20 7375 6666 6978  c = cbyc, suffix
+000893c0: 203d 2073 7566 6669 782c 206f 7574 5f64   = suffix, out_d
+000893d0: 6972 203d 206f 7574 5f64 6972 2c20 7361  ir = out_dir, sa
+000893e0: 203d 2073 6120 2920 0a0a 2020 2020 6966   = sa ) ..    if
+000893f0: 2028 6764 7320 6973 206e 6f74 204e 6f6e   (gds is not Non
+00089400: 6529 2026 2028 6a75 6d70 5f74 6f20 3c20  e) & (jump_to < 
+00089410: 3229 3a0a 2020 2020 2020 2020 7072 696e  2):.        prin
+00089420: 7428 2753 6176 696e 6720 6765 6e65 2064  t('Saving gene d
+00089430: 6573 6372 6970 746f 7220 2e2e 2027 2c20  escriptor .. ', 
+00089440: 656e 6420 3d20 2720 272c 2066 6c75 7368  end = ' ', flush
+00089450: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+00089460: 2077 6974 6820 6f70 656e 2866 696c 655f   with open(file_
+00089470: 6f75 7420 2b20 272e 6764 7327 2c20 2777  out + '.gds', 'w
+00089480: 6227 2920 6173 2066 3a0a 2020 2020 2020  b') as f:.      
+00089490: 2020 2020 2020 7069 636b 6c65 2e64 756d        pickle.dum
+000894a0: 7028 2028 6764 7329 2c20 6620 290a 2020  p( (gds), f ).  
+000894b0: 2020 2020 2020 7072 696e 7428 2764 6f6e        print('don
+000894c0: 652e 2027 290a 2020 2020 656c 7365 3a0a  e. ').    else:.
+000894d0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+000894e0: 7472 696e 6746 6978 2073 7461 7274 6564  tringFix started
+000894f0: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
+00089500: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
+00089510: 2020 2020 2070 7269 6e74 2827 4c6f 6164       print('Load
+00089520: 696e 6720 6765 6e65 2064 6573 6372 6970  ing gene descrip
+00089530: 746f 7220 2e2e 2027 2c20 656e 6420 3d20  tor .. ', end = 
+00089540: 2720 272c 2066 6c75 7368 203d 2054 7275  ' ', flush = Tru
+00089550: 6529 0a20 2020 2020 2020 2077 6974 6820  e).        with 
+00089560: 6f70 656e 2866 696c 655f 6f75 7420 2b20  open(file_out + 
+00089570: 272e 6764 7327 2c20 2772 6227 2920 6173  '.gds', 'rb') as
+00089580: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00089590: 6764 7320 3d20 7069 636b 6c65 2e6c 6f61  gds = pickle.loa
+000895a0: 6428 2066 2029 0a20 2020 2020 2020 2067  d( f ).        g
+000895b0: 656e 6f6d 6520 3d20 6765 6e6f 6d65 5f66  enome = genome_f
+000895c0: 610a 2020 2020 2020 2020 7072 696e 7428  a.        print(
+000895d0: 2764 6f6e 652e 2027 290a 2020 2020 0a20  'done. ').    . 
+000895e0: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
+000895f0: 2069 7320 4e6f 6e65 293a 0a20 2020 2020   is None):.     
+00089600: 2020 2070 7269 6e74 2827 5374 7269 6e67     print('String
+00089610: 4669 7820 6669 6e69 7368 6564 2027 2c20  Fix finished ', 
+00089620: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+00089630: 652e 6e6f 7728 2929 0a20 2020 2065 6c73  e.now()).    els
+00089640: 653a 0a20 2020 2020 2020 2066 696c 655f  e:.        file_
+00089650: 6f75 742c 2066 696c 655f 6f75 745f 6765  out, file_out_ge
+00089660: 6e6f 6d65 203d 2053 7472 696e 6746 6978  nome = StringFix
+00089670: 5f73 796e 7468 6573 6973 2820 6669 6c65  _synthesis( file
+00089680: 5f6f 7574 202b 2027 2e67 6666 272c 2067  _out + '.gff', g
+00089690: 656e 6f6d 652c 205c 0a20 2020 2020 2020  enome, \.       
+000896a0: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
+000896b0: 3d6e 5f63 6f72 6573 2c20 7265 7620 3d20  =n_cores, rev = 
+000896c0: 7265 762c 206f 7574 5f64 6972 203d 206f  rev, out_dir = o
+000896d0: 7574 5f64 6972 2c20 6764 7320 3d20 6764  ut_dir, gds = gd
+000896e0: 7320 290a 2020 2020 2020 2020 0a20 2020  s ).        .   
+000896f0: 2072 6574 7572 6e20 6669 6c65 5f6f 7574   return file_out
+00089700: 0a20 2020 2020 2020 200a 0a23 2323 2323  .        ..#####
+00089710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089730: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089740: 2323 2323 0a23 2320 5374 7269 6e67 4669  ####.## StringFi
+00089750: 782d 6164 646f 6e20 2020 2020 2020 2020  x-addon         
+00089760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089780: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00089790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000897a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000897b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000897c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000897d0: 2020 2020 2023 230a 2323 2064 6576 656c       ##.## devel
-000897e0: 6f70 6564 2062 7920 5365 6f6b 6879 756e  oped by Seokhyun
-000897f0: 2059 6f6f 6e20 2873 796f 6f6e 4064 6b75   Yoon (syoon@dku
-00089800: 2e65 6475 2920 4f63 742e 2030 342c 2032  .edu) Oct. 04, 2
-00089810: 3032 3020 2020 2323 0a23 2323 2323 2323  020   ##.#######
-00089820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089850: 2323 0a0a 6465 6620 7768 6963 6828 2061  ##..def which( a
-00089860: 692c 2076 616c 7565 203d 2054 7275 6520  i, value = True 
-00089870: 2920 3a0a 2020 2020 7768 203d 205b 5d0a  ) :.    wh = [].
-00089880: 2020 2020 6120 3d20 6c69 7374 2861 6929      a = list(ai)
-00089890: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
-000898a0: 6e67 6528 6c65 6e28 6129 293a 200a 2020  nge(len(a)): .  
-000898b0: 2020 2020 2020 6966 2061 5b6b 5d20 3d3d        if a[k] ==
-000898c0: 2076 616c 7565 3a20 0a20 2020 2020 2020   value: .       
-000898d0: 2020 2020 2077 682e 6170 7065 6e64 286b       wh.append(k
-000898e0: 2920 0a20 2020 2072 6574 7572 6e28 7768  ) .    return(wh
-000898f0: 290a 0a64 6566 2067 6574 5f69 6e66 6f5f  )..def get_info_
-00089900: 6672 6f6d 5f74 725f 6e61 6d65 2820 746e  from_tr_name( tn
-00089910: 7320 293a 0a20 2020 200a 2020 2020 6162  s ):.    .    ab
-00089920: 6e5f 6520 3d20 5b5d 0a20 2020 2074 706d  n_e = [].    tpm
-00089930: 5f65 203d 205b 5d0a 2020 2020 6966 7261  _e = [].    ifra
-00089940: 6320 3d20 5b5d 0a20 2020 2073 6964 7820  c = [].    sidx 
-00089950: 3d20 5b5d 0a20 2020 2067 5f73 697a 6520  = [].    g_size 
-00089960: 3d20 5b5d 0a20 2020 206e 5f65 786f 6e73  = [].    n_exons
-00089970: 203d 205b 5d0a 2020 2020 675f 766f 6c20   = [].    g_vol 
-00089980: 3d20 5b5d 0a20 2020 2069 636e 7420 3d20  = [].    icnt = 
-00089990: 5b5d 0a20 2020 2074 5f6c 656e 203d 205b  [].    t_len = [
-000899a0: 5d0a 2020 2020 7374 726e 6420 3d20 5b5d  ].    strnd = []
-000899b0: 0a20 2020 2063 646e 6720 3d20 5b5d 0a20  .    cdng = []. 
-000899c0: 2020 2066 6f72 206b 2c20 746e 2069 6e20     for k, tn in 
-000899d0: 656e 756d 6572 6174 6528 746e 7329 3a0a  enumerate(tns):.
-000899e0: 2020 2020 2020 2020 6864 7220 3d20 746e          hdr = tn
-000899f0: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
-00089a00: 2020 2020 6974 656d 7320 3d20 6864 725b      items = hdr[
-00089a10: 305d 2e73 706c 6974 2827 5f27 290a 2020  0].split('_').  
-00089a20: 2020 2020 2020 7374 726e 642e 6170 7065        strnd.appe
-00089a30: 6e64 2820 6974 656d 735b 325d 290a 2020  nd( items[2]).  
-00089a40: 2020 2020 2020 6364 6e67 2e61 7070 656e        cdng.appen
-00089a50: 6428 2069 7465 6d73 5b33 5d29 0a20 2020  d( items[3]).   
-00089a60: 2020 2020 2073 6964 782e 6170 7065 6e64       sidx.append
-00089a70: 2820 2869 7465 6d73 5b34 5d29 2029 0a20  ( (items[4]) ). 
-00089a80: 2020 2020 2020 2067 5f73 697a 652e 6170         g_size.ap
-00089a90: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
-00089aa0: 355d 2920 290a 2020 2020 2020 2020 6963  5]) ).        ic
-00089ab0: 6e74 2e61 7070 656e 6428 2069 6e74 2869  nt.append( int(i
-00089ac0: 7465 6d73 5b36 5d29 2029 0a20 2020 2020  tems[6]) ).     
-00089ad0: 2020 2076 616c 203d 2069 7465 6d73 5b37     val = items[7
-00089ae0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-00089af0: 2020 2020 2061 626e 5f65 2e61 7070 656e       abn_e.appen
-00089b00: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
-00089b10: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-00089b20: 2069 7465 6d73 5b38 5d2e 7370 6c69 7428   items[8].split(
-00089b30: 273a 2729 0a20 2020 2020 2020 2074 706d  ':').        tpm
-00089b40: 5f65 2e61 7070 656e 6428 2066 6c6f 6174  _e.append( float
-00089b50: 2876 616c 5b31 5d29 2029 0a20 2020 2020  (val[1]) ).     
-00089b60: 2020 2076 616c 203d 2069 7465 6d73 5b39     val = items[9
-00089b70: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-00089b80: 2020 2020 2069 6672 6163 2e61 7070 656e       ifrac.appen
-00089b90: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
-00089ba0: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-00089bb0: 2069 7465 6d73 5b31 315d 2e73 706c 6974   items[11].split
-00089bc0: 2827 3a27 290a 2020 2020 2020 2020 6e5f  (':').        n_
-00089bd0: 6578 6f6e 732e 6170 7065 6e64 2820 696e  exons.append( in
-00089be0: 7428 7661 6c5b 315d 2920 290a 2020 2020  t(val[1]) ).    
-00089bf0: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
-00089c00: 3132 5d2e 7370 6c69 7428 273a 2729 0a20  12].split(':'). 
-00089c10: 2020 2020 2020 2067 5f76 6f6c 2e61 7070         g_vol.app
-00089c20: 656e 6428 2069 6e74 2876 616c 5b31 5d29  end( int(val[1])
-00089c30: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-00089c40: 2069 7465 6d73 5b31 335d 2e73 706c 6974   items[13].split
-00089c50: 2827 3a27 290a 2020 2020 2020 2020 745f  (':').        t_
-00089c60: 6c65 6e2e 6170 7065 6e64 2820 696e 7428  len.append( int(
-00089c70: 7661 6c5b 315d 2920 290a 2020 2020 0a20  val[1]) ).    . 
-00089c80: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
-00089c90: 7261 6d65 2829 0a20 2020 200a 2020 2020  rame().    .    
-00089ca0: 6466 5b27 7472 5f6e 616d 6527 5d20 3d20  df['tr_name'] = 
-00089cb0: 746e 730a 2020 2020 6466 5b27 6162 6e5f  tns.    df['abn_
-00089cc0: 6573 7427 5d20 3d20 6162 6e5f 650a 2020  est'] = abn_e.  
-00089cd0: 2020 6466 5b27 7470 6d5f 6573 7427 5d20    df['tpm_est'] 
-00089ce0: 3d20 7470 6d5f 650a 2020 2020 6466 5b27  = tpm_e.    df['
-00089cf0: 6769 6478 275d 203d 2073 6964 780a 2020  gidx'] = sidx.  
-00089d00: 2020 6466 5b27 6969 6478 275d 203d 2069    df['iidx'] = i
-00089d10: 636e 740a 2020 2020 6466 5b27 675f 7369  cnt.    df['g_si
-00089d20: 7a65 275d 203d 2067 5f73 697a 650a 2020  ze'] = g_size.  
-00089d30: 2020 6466 5b27 6973 6f5f 6672 6163 275d    df['iso_frac']
-00089d40: 203d 2069 6672 6163 0a20 2020 2064 665b   = ifrac.    df[
-00089d50: 276e 5f65 786f 6e73 275d 203d 206e 5f65  'n_exons'] = n_e
-00089d60: 786f 6e73 0a20 2020 2064 665b 2767 5f76  xons.    df['g_v
-00089d70: 6f6c 275d 203d 2067 5f76 6f6c 0a20 2020  ol'] = g_vol.   
-00089d80: 2064 665b 276c 656e 6774 6827 5d20 3d20   df['length'] = 
-00089d90: 745f 6c65 6e0a 2020 2020 6466 5b27 7374  t_len.    df['st
-00089da0: 7261 6e64 275d 203d 2073 7472 6e64 0a20  rand'] = strnd. 
-00089db0: 2020 2064 665b 2743 5f6f 725f 4e27 5d20     df['C_or_N'] 
-00089dc0: 3d20 6364 6e67 0a20 2020 200a 2020 2020  = cdng.    .    
-00089dd0: 6466 203d 2064 662e 7365 745f 696e 6465  df = df.set_inde
-00089de0: 7828 2774 725f 6e61 6d65 2729 0a20 2020  x('tr_name').   
-00089df0: 200a 2020 2020 7265 7475 726e 2064 660a   .    return df.
-00089e00: 0a64 6566 2067 6574 5f70 6572 666f 726d  .def get_perform
-00089e10: 616e 6365 2874 7269 6e66 6f2c 2063 7667  ance(trinfo, cvg
-00089e20: 5f74 6820 3d20 5b38 302c 3930 2c39 355d  _th = [80,90,95]
-00089e30: 2c20 665f 746f 5f73 6176 6520 3d20 4e6f  , f_to_save = No
-00089e40: 6e65 2c20 7265 6620 3d20 302c 2076 6572  ne, ref = 0, ver
-00089e50: 626f 7365 203d 2046 616c 7365 293a 0a20  bose = False):. 
-00089e60: 2020 200a 2020 2020 2327 2727 0a20 2020     .    #'''.   
-00089e70: 2069 6620 7265 6620 3d3d 2030 3a0a 2020   if ref == 0:.  
-00089e80: 2020 2020 2020 715f 6376 6720 3d20 2771        q_cvg = 'q
-00089e90: 6376 6727 0a20 2020 2020 2020 2071 5f6c  cvg'.        q_l
-00089ea0: 656e 203d 2027 716c 656e 270a 2020 2020  en = 'qlen'.    
-00089eb0: 2020 2020 715f 6964 203d 2027 7169 6427      q_id = 'qid'
-00089ec0: 0a20 2020 2020 2020 2073 5f73 7461 7274  .        s_start
-00089ed0: 203d 2027 7373 7461 7274 270a 2020 2020   = 'sstart'.    
-00089ee0: 2020 2020 735f 656e 6420 3d20 2773 656e      s_end = 'sen
-00089ef0: 6427 0a20 2020 2020 2020 2073 5f69 6420  d'.        s_id 
-00089f00: 3d20 2773 6964 270a 2020 2020 656c 7365  = 'sid'.    else
-00089f10: 3a0a 2020 2020 2020 2020 715f 6376 6720  :.        q_cvg 
-00089f20: 3d20 2773 6376 6727 0a20 2020 2020 2020  = 'scvg'.       
-00089f30: 2071 5f6c 656e 203d 2027 736c 656e 270a   q_len = 'slen'.
-00089f40: 2020 2020 2020 2020 715f 6964 203d 2027          q_id = '
-00089f50: 7369 6427 0a20 2020 2020 2020 2073 5f73  sid'.        s_s
-00089f60: 7461 7274 203d 2027 7173 7461 7274 270a  tart = 'qstart'.
-00089f70: 2020 2020 2020 2020 735f 656e 6420 3d20          s_end = 
-00089f80: 2771 656e 6427 0a20 2020 2020 2020 2073  'qend'.        s
-00089f90: 5f69 6420 3d20 2771 6964 270a 2020 2020  _id = 'qid'.    
-00089fa0: 2327 2727 0a20 2020 200a 2020 2020 7169  #'''.    .    qi
-00089fb0: 6473 203d 2070 642e 756e 6971 7565 2874  ds = pd.unique(t
-00089fc0: 7269 6e66 6f5b 715f 6964 5d29 0a20 2020  rinfo[q_id]).   
-00089fd0: 2073 6964 7320 3d20 7064 2e75 6e69 7175   sids = pd.uniqu
-00089fe0: 6528 7472 696e 666f 5b73 5f69 645d 290a  e(trinfo[s_id]).
-00089ff0: 2020 2020 7767 7420 3d20 6e70 2e7a 6572      wgt = np.zer
-0008a000: 6f73 285b 6c65 6e28 7169 6473 292c 6c65  os([len(qids),le
-0008a010: 6e28 7369 6473 295d 290a 2020 2020 6966  n(sids)]).    if
-0008a020: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
-0008a030: 274d 6174 6368 696e 6720 2825 692c 2569  'Matching (%i,%i
-0008a040: 2920 2720 2520 2877 6774 2e73 6861 7065  ) ' % (wgt.shape
-0008a050: 292c 2065 6e64 3d27 2729 0a0a 2020 2020  ), end='')..    
-0008a060: 7169 6478 203d 206e 702e 6675 6c6c 2874  qidx = np.full(t
-0008a070: 7269 6e66 6f2e 7368 6170 655b 305d 2c2d  rinfo.shape[0],-
-0008a080: 312c 6474 7970 653d 696e 7429 0a20 2020  1,dtype=int).   
-0008a090: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
-0008a0a0: 6c65 6e28 7169 6473 2929 203a 0a20 2020  len(qids)) :.   
-0008a0b0: 2020 2020 2071 6964 203d 2071 6964 735b       qid = qids[
-0008a0c0: 6b5d 0a20 2020 2020 2020 2077 6820 3d20  k].        wh = 
-0008a0d0: 7768 6963 6828 2074 7269 6e66 6f5b 715f  which( trinfo[q_
-0008a0e0: 6964 5d20 3d3d 2071 6964 2029 0a20 2020  id] == qid ).   
-0008a0f0: 2020 2020 2071 6964 785b 7768 5d20 3d20       qidx[wh] = 
-0008a100: 6b0a 2020 2020 2020 2020 0a20 2020 2069  k.        .    i
-0008a110: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
-0008a120: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
-0008a130: 2020 7369 6478 203d 206e 702e 6675 6c6c    sidx = np.full
-0008a140: 2874 7269 6e66 6f2e 7368 6170 655b 305d  (trinfo.shape[0]
-0008a150: 2c2d 312c 6474 7970 653d 696e 7429 0a20  ,-1,dtype=int). 
-0008a160: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-0008a170: 6528 6c65 6e28 7369 6473 2929 203a 0a20  e(len(sids)) :. 
-0008a180: 2020 2020 2020 2073 6964 203d 2073 6964         sid = sid
-0008a190: 735b 6b5d 0a20 2020 2020 2020 2077 6820  s[k].        wh 
-0008a1a0: 3d20 7768 6963 6828 2074 7269 6e66 6f5b  = which( trinfo[
-0008a1b0: 735f 6964 5d20 3d3d 2073 6964 2029 0a20  s_id] == sid ). 
-0008a1c0: 2020 2020 2020 2073 6964 785b 7768 5d20         sidx[wh] 
-0008a1d0: 3d20 6b0a 2020 2020 2020 2020 0a20 2020  = k.        .   
-0008a1e0: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
-0008a1f0: 6e74 2827 2e27 2c20 656e 643d 2727 290a  nt('.', end='').
-0008a200: 2020 2020 666f 7220 7720 696e 2072 616e      for w in ran
-0008a210: 6765 286c 656e 2871 6964 7829 293a 0a20  ge(len(qidx)):. 
-0008a220: 2020 2020 2020 2077 6774 5b69 6e74 2871         wgt[int(q
-0008a230: 6964 785b 775d 292c 2069 6e74 2873 6964  idx[w]), int(sid
-0008a240: 785b 775d 295d 203d 202d 7472 696e 666f  x[w])] = -trinfo
-0008a250: 5b71 5f63 7667 5d5b 775d 0a0a 2020 2020  [q_cvg][w]..    
-0008a260: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0008a270: 7428 275f 272c 2065 6e64 3d27 2729 0a20  t('_', end=''). 
-0008a280: 2020 2023 2070 7269 6e74 2877 6774 2e73     # print(wgt.s
-0008a290: 6861 7065 290a 2020 2020 726f 775f 6964  hape).    row_id
-0008a2a0: 782c 2063 6f6c 5f69 6478 203d 206f 7074  x, col_idx = opt
-0008a2b0: 696d 697a 652e 6c69 6e65 6172 5f73 756d  imize.linear_sum
-0008a2c0: 5f61 7373 6967 6e6d 656e 7428 7767 7429  _assignment(wgt)
-0008a2d0: 0a20 2020 200a 2020 2020 6966 2076 6572  .    .    if ver
-0008a2e0: 626f 7365 3a20 7072 696e 7428 272e 272c  bose: print('.',
-0008a2f0: 2065 6e64 3d27 2729 0a20 2020 2064 665f   end='').    df_
-0008a300: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
-0008a310: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
-0008a320: 636f 6c5f 6964 7829 2920 3a0a 2020 2020  col_idx)) :.    
-0008a330: 2020 2020 7369 203d 2063 6f6c 5f69 6478      si = col_idx
-0008a340: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
-0008a350: 2077 6869 6368 2873 6964 7820 3d3d 2073   which(sidx == s
-0008a360: 6929 0a20 2020 2020 2020 2077 203d 2077  i).        w = w
-0008a370: 6869 6368 2820 7169 6478 5b77 685d 203d  hich( qidx[wh] =
-0008a380: 3d20 726f 775f 6964 785b 6b5d 2029 0a20  = row_idx[k] ). 
-0008a390: 2020 2020 2020 2069 6620 6c65 6e28 7729         if len(w)
-0008a3a0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0008a3b0: 2020 6966 206c 656e 2877 2920 3e20 313a    if len(w) > 1:
-0008a3c0: 2070 7269 6e74 2827 4552 524f 5220 696e   print('ERROR in
-0008a3d0: 2067 6574 5f70 6572 666f 726d 616e 6365   get_performance
-0008a3e0: 2829 3a20 4c65 6e28 7729 203d 2025 6927  (): Len(w) = %i'
-0008a3f0: 2025 206c 656e 2877 2920 290a 2020 2020   % len(w) ).    
-0008a400: 2020 2020 2020 2020 6964 7820 3d20 7768          idx = wh
-0008a410: 5b77 5b30 5d5d 0a20 2020 2020 2020 2020  [w[0]].         
-0008a420: 2020 2064 665f 6c73 742e 6170 7065 6e64     df_lst.append
-0008a430: 2874 7269 6e66 6f2e 696c 6f63 5b69 6478  (trinfo.iloc[idx
-0008a440: 5d29 0a20 2020 2020 2020 200a 2020 2020  ]).        .    
-0008a450: 6466 5f73 656c 203d 2070 642e 4461 7461  df_sel = pd.Data
-0008a460: 4672 616d 6528 6466 5f6c 7374 290a 2020  Frame(df_lst).  
-0008a470: 2020 6966 2066 5f74 6f5f 7361 7665 2069    if f_to_save i
-0008a480: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0008a490: 2020 2020 666e 616d 6520 3d20 2725 735f      fname = '%s_
-0008a4a0: 626c 6173 745f 7265 7375 6c74 2e74 7376  blast_result.tsv
-0008a4b0: 2720 2520 665f 746f 5f73 6176 650a 2020  ' % f_to_save.  
-0008a4c0: 2020 2020 2020 6466 5f73 656c 2e74 6f5f        df_sel.to_
-0008a4d0: 6373 7628 666e 616d 652c 2068 6561 6465  csv(fname, heade
-0008a4e0: 723d 5472 7565 2c20 696e 6465 783d 4661  r=True, index=Fa
-0008a4f0: 6c73 652c 2073 6570 3d27 5c74 2729 0a20  lse, sep='\t'). 
-0008a500: 2020 2020 2020 2023 2069 6620 7665 7262         # if verb
-0008a510: 6f73 653a 2070 7269 6e74 2827 2025 732e  ose: print(' %s.
-0008a520: 2720 2520 666e 616d 652c 2065 6e64 3d27  ' % fname, end='
-0008a530: 2720 290a 2020 2020 0a20 2020 2069 6620  ' ).    .    if 
-0008a540: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-0008a550: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
-0008a560: 636e 7420 3d20 6e70 2e7a 6572 6f73 286c  cnt = np.zeros(l
-0008a570: 656e 2863 7667 5f74 6829 290a 2020 2020  en(cvg_th)).    
-0008a580: 666f 7220 6b20 696e 2072 616e 6765 286c  for k in range(l
-0008a590: 656e 2863 7667 5f74 6829 293a 0a20 2020  en(cvg_th)):.   
-0008a5a0: 2020 2020 2074 6820 3d20 6376 675f 7468       th = cvg_th
-0008a5b0: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
-0008a5c0: 2077 6869 6368 2820 6466 5f73 656c 5b71   which( df_sel[q
-0008a5d0: 5f63 7667 5d2a 3130 3020 3e3d 2074 6820  _cvg]*100 >= th 
-0008a5e0: 290a 2020 2020 2020 2020 636e 745b 6b5d  ).        cnt[k]
-0008a5f0: 203d 206e 702e 696e 7428 6c65 6e28 7768   = np.int(len(wh
-0008a600: 2929 0a20 2020 2020 2020 200a 2020 2020  )).        .    
-0008a610: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0008a620: 7428 2720 646f 6e65 2e27 290a 0a20 2020  t(' done.')..   
-0008a630: 2064 203d 207b 2763 7667 5f74 6827 3a20   d = {'cvg_th': 
-0008a640: 6376 675f 7468 2c20 274e 5f72 6563 6f76  cvg_th, 'N_recov
-0008a650: 6572 6564 273a 2063 6e74 2e61 7374 7970  ered': cnt.astyp
-0008a660: 6528 696e 7429 2c20 2770 7265 6369 7369  e(int), 'precisi
-0008a670: 6f6e 273a 206e 702e 726f 756e 6428 3130  on': np.round(10
-0008a680: 302a 636e 742f 6c65 6e28 7369 6473 292c  0*cnt/len(sids),
-0008a690: 3129 7d0a 2020 2020 6466 5f70 6572 6620  1)}.    df_perf 
-0008a6a0: 3d20 7064 2e44 6174 6146 7261 6d65 2864  = pd.DataFrame(d
-0008a6b0: 6174 6120 3d20 6429 2023 2c20 636f 6c75  ata = d) #, colu
-0008a6c0: 6d6e 7320 3d20 5b27 6376 675f 7468 272c  mns = ['cvg_th',
-0008a6d0: 276e 5f72 6563 6f76 6572 6564 272c 2770  'n_recovered','p
-0008a6e0: 7265 6369 7369 6f6e 275d 290a 2020 2020  recision']).    
-0008a6f0: 0a20 2020 2072 6574 7572 6e28 6466 5f70  .    return(df_p
-0008a700: 6572 662c 2064 665f 7365 6c29 0a0a 2020  erf, df_sel)..  
-0008a710: 2020 0a64 6566 2072 756e 5f62 6c61 7374    .def run_blast
-0008a720: 2820 696e 7074 5f66 612c 2072 6566 5f66  ( inpt_fa, ref_f
-0008a730: 612c 2070 6174 685f 746f 5f62 6c61 7374  a, path_to_blast
-0008a740: 203d 204e 6f6e 652c 2074 7261 7265 636f   = None, trareco
-0008a750: 203d 2046 616c 7365 2c20 7265 665f 696e   = False, ref_in
-0008a760: 666f 203d 2046 616c 7365 2c20 5c0a 2020  fo = False, \.  
-0008a770: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0008a780: 6274 7970 6520 3d20 276e 7563 6c27 2c20  btype = 'nucl', 
-0008a790: 7265 6620 3d20 302c 2073 6469 7620 3d20  ref = 0, sdiv = 
-0008a7a0: 3130 2c20 6d78 5f6e 6361 6e64 203d 2036  10, mx_ncand = 6
-0008a7b0: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
-0008a7c0: 6529 3a0a 0a20 2020 2023 2727 270a 2020  e):..    #'''.  
-0008a7d0: 2020 6966 2072 6566 203d 3d20 303a 0a20    if ref == 0:. 
-0008a7e0: 2020 2020 2020 2072 6566 5f74 7220 3d20         ref_tr = 
-0008a7f0: 7265 665f 6661 0a20 2020 2020 2020 2069  ref_fa.        i
-0008a800: 6e70 745f 7472 203d 2069 6e70 745f 6661  npt_tr = inpt_fa
-0008a810: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0008a820: 2020 715f 6376 6720 3d20 2771 6376 6727    q_cvg = 'qcvg'
-0008a830: 0a20 2020 2020 2020 2071 5f6c 656e 203d  .        q_len =
-0008a840: 2027 716c 656e 270a 2020 2020 2020 2020   'qlen'.        
-0008a850: 715f 6964 203d 2027 7169 6427 0a20 2020  q_id = 'qid'.   
-0008a860: 2020 2020 2073 5f73 7461 7274 203d 2027       s_start = '
-0008a870: 7373 7461 7274 270a 2020 2020 2020 2020  sstart'.        
-0008a880: 735f 656e 6420 3d20 2773 656e 6427 0a20  s_end = 'send'. 
-0008a890: 2020 2020 2020 2073 5f69 6420 3d20 2773         s_id = 's
-0008a8a0: 6964 270a 2020 2020 656c 7365 3a0a 2020  id'.    else:.  
-0008a8b0: 2020 2020 2020 7265 665f 7472 203d 2069        ref_tr = i
-0008a8c0: 6e70 745f 6661 0a20 2020 2020 2020 2069  npt_fa.        i
-0008a8d0: 6e70 745f 7472 203d 2072 6566 5f66 610a  npt_tr = ref_fa.
-0008a8e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0008a8f0: 2071 5f63 7667 203d 2027 7363 7667 270a   q_cvg = 'scvg'.
-0008a900: 2020 2020 2020 2020 715f 6c65 6e20 3d20          q_len = 
-0008a910: 2773 6c65 6e27 0a20 2020 2020 2020 2071  'slen'.        q
-0008a920: 5f69 6420 3d20 2773 6964 270a 2020 2020  _id = 'sid'.    
-0008a930: 2020 2020 735f 7374 6172 7420 3d20 2771      s_start = 'q
-0008a940: 7374 6172 7427 0a20 2020 2020 2020 2073  start'.        s
-0008a950: 5f65 6e64 203d 2027 7165 6e64 270a 2020  _end = 'qend'.  
-0008a960: 2020 2020 2020 735f 6964 203d 2027 7169        s_id = 'qi
-0008a970: 6427 0a20 2020 2023 2727 270a 2020 2020  d'.    #'''.    
-0008a980: 0a20 2020 2066 696c 655f 6e61 6d65 7320  .    file_names 
-0008a990: 3d20 696e 7074 5f74 722e 7370 6c69 7428  = inpt_tr.split(
-0008a9a0: 272e 2729 0a20 2020 2066 6e61 6d65 203d  '.').    fname =
-0008a9b0: 2027 272e 6a6f 696e 2873 7420 666f 7220   ''.join(st for 
-0008a9c0: 7374 2069 6e20 6669 6c65 5f6e 616d 6573  st in file_names
-0008a9d0: 5b3a 2d31 5d20 290a 0a20 2020 2074 6e5f  [:-1] )..    tn_
-0008a9e0: 696e 203d 205b 5d0a 2020 2020 6620 3d20  in = [].    f = 
-0008a9f0: 6f70 656e 2869 6e70 745f 7472 2c27 7227  open(inpt_tr,'r'
-0008aa00: 290a 2020 2020 6361 6e64 5f63 6e74 203d  ).    cand_cnt =
-0008aa10: 2030 0a20 2020 2066 6f72 206c 696e 6520   0.    for line 
-0008aa20: 696e 2066 3a0a 2020 2020 2020 2020 6966  in f:.        if
-0008aa30: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
-0008aa40: 0a20 2020 2020 2020 2020 2020 2074 6e5f  .            tn_
-0008aa50: 696e 2e61 7070 656e 6428 6c69 6e65 5b31  in.append(line[1
-0008aa60: 3a2d 315d 290a 2020 2020 2020 2020 2020  :-1]).          
-0008aa70: 2020 6361 6e64 5f63 6e74 202b 3d20 310a    cand_cnt += 1.
-0008aa80: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
-0008aa90: 2020 0a20 2020 2074 6e5f 7265 6620 3d20    .    tn_ref = 
-0008aaa0: 5b5d 0a20 2020 2066 203d 206f 7065 6e28  [].    f = open(
-0008aab0: 7265 665f 7472 2c27 7227 290a 2020 2020  ref_tr,'r').    
-0008aac0: 7265 665f 636e 7420 3d20 300a 2020 2020  ref_cnt = 0.    
-0008aad0: 666f 7220 6c69 6e65 2069 6e20 663a 0a20  for line in f:. 
-0008aae0: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
-0008aaf0: 5d20 3d3d 2027 3e27 3a0a 2020 2020 2020  ] == '>':.      
-0008ab00: 2020 2020 2020 746e 5f72 6566 2e61 7070        tn_ref.app
-0008ab10: 656e 6428 6c69 6e65 5b31 3a2d 315d 290a  end(line[1:-1]).
-0008ab20: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
-0008ab30: 636e 7420 2b3d 2031 0a20 2020 2066 2e63  cnt += 1.    f.c
-0008ab40: 6c6f 7365 2829 0a20 2020 2023 2070 7269  lose().    # pri
-0008ab50: 6e74 2827 4c65 6e3a 2025 692c 204e 753d  nt('Len: %i, Nu=
-0008ab60: 2025 6927 2025 2028 6c65 6e28 746e 292c   %i' % (len(tn),
-0008ab70: 206c 656e 2870 642e 756e 6971 7565 2874   len(pd.unique(t
-0008ab80: 6e29 2929 2c20 656e 643d 2727 2029 0a20  n))), end='' ). 
-0008ab90: 2020 200a 2020 2020 6966 2072 6566 203d     .    if ref =
-0008aba0: 3d20 303a 0a20 2020 2020 2020 2074 6e20  = 0:.        tn 
-0008abb0: 3d20 746e 5f69 6e0a 2020 2020 2020 2020  = tn_in.        
-0008abc0: 6e5f 6d61 785f 6361 6e64 7320 3d20 310a  n_max_cands = 1.
-0008abd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0008abe0: 2020 746e 203d 2074 6e5f 7265 660a 2020    tn = tn_ref.  
-0008abf0: 2020 2020 2020 6e5f 6d61 785f 6361 6e64        n_max_cand
-0008ac00: 7320 3d20 206d 785f 6e63 616e 640a 2020  s =  mx_ncand.  
-0008ac10: 2020 2020 2020 746d 7020 3d20 6361 6e64        tmp = cand
-0008ac20: 5f63 6e74 0a20 2020 2020 2020 2063 616e  _cnt.        can
-0008ac30: 645f 636e 7420 3d20 7265 665f 636e 740a  d_cnt = ref_cnt.
-0008ac40: 2020 2020 2020 2020 7265 665f 636e 7420          ref_cnt 
-0008ac50: 3d20 746d 700a 2020 2020 0a20 2020 2023  = tmp.    .    #
-0008ac60: 2320 6d61 6b65 2062 6c61 7374 2064 6220  # make blast db 
-0008ac70: 7769 7468 2069 6e70 7574 5f74 720a 2020  with input_tr.  
-0008ac80: 2020 6966 2070 6174 685f 746f 5f62 6c61    if path_to_bla
-0008ac90: 7374 2069 7320 4e6f 6e65 3a0a 2020 2020  st is None:.    
-0008aca0: 2020 2020 636d 6420 3d20 276d 616b 6562      cmd = 'makeb
-0008acb0: 6c61 7374 6462 202d 696e 2025 7320 2d64  lastdb -in %s -d
-0008acc0: 6274 7970 6520 2573 2720 2520 2869 6e70  btype %s' % (inp
-0008acd0: 745f 7472 2c20 6462 7479 7065 290a 2020  t_tr, dbtype).  
-0008ace0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008acf0: 636d 6420 3d20 2725 732f 6d61 6b65 626c  cmd = '%s/makebl
-0008ad00: 6173 7464 6220 2d69 6e20 2573 202d 6462  astdb -in %s -db
-0008ad10: 7479 7065 2025 7327 2025 2028 7061 7468  type %s' % (path
-0008ad20: 5f74 6f5f 626c 6173 742c 2069 6e70 745f  _to_blast, inpt_
-0008ad30: 7472 2c20 6462 7479 7065 290a 2020 2020  tr, dbtype).    
-0008ad40: 7265 7320 3d20 7375 6270 726f 6365 7373  res = subprocess
-0008ad50: 2e63 6865 636b 5f6f 7574 7075 7428 636d  .check_output(cm
-0008ad60: 642c 2073 6865 6c6c 3d54 7275 6529 0a20  d, shell=True). 
-0008ad70: 2020 2023 2070 7269 6e74 2872 6573 2e64     # print(res.d
-0008ad80: 6563 6f64 6528 2777 696e 646f 7773 2d31  ecode('windows-1
-0008ad90: 3235 3227 2929 0a20 0a20 2020 2073 7472  252')). .    str
-0008ada0: 5f6f 7074 696f 6e20 3d20 272d 6f75 7466  _option = '-outf
-0008adb0: 6d74 2022 3620 7173 6571 6964 2073 7365  mt "6 qseqid sse
-0008adc0: 7169 6420 716c 656e 206c 656e 6774 6820  qid qlen length 
-0008add0: 736c 656e 2071 7374 6172 7420 7165 6e64  slen qstart qend
-0008ade0: 2073 7374 6172 7420 7365 6e64 206e 6964   sstart send nid
-0008adf0: 656e 7420 6d69 736d 6174 6368 2067 6170  ent mismatch gap
-0008ae00: 6f70 656e 2071 636f 7673 2071 636f 7668  open qcovs qcovh
-0008ae10: 7370 2062 6974 7363 6f72 6522 202d 6e75  sp bitscore" -nu
-0008ae20: 6d5f 7468 7265 6164 7320 3420 2d6d 6178  m_threads 4 -max
-0008ae30: 5f74 6172 6765 745f 7365 7173 2025 6927  _target_seqs %i'
-0008ae40: 2025 206e 5f6d 6178 5f63 616e 6473 0a0a   % n_max_cands..
-0008ae50: 2020 2020 6966 2064 6274 7970 6520 3d3d      if dbtype ==
-0008ae60: 2027 6e75 636c 273a 2070 7266 7820 3d20   'nucl': prfx = 
-0008ae70: 276e 270a 2020 2020 656c 7365 3a20 7072  'n'.    else: pr
-0008ae80: 6678 203d 2027 7027 0a20 2020 2020 2020  fx = 'p'.       
-0008ae90: 200a 2020 2020 6966 2070 6174 685f 746f   .    if path_to
-0008aea0: 5f62 6c61 7374 2069 7320 4e6f 6e65 3a0a  _blast is None:.
-0008aeb0: 2020 2020 2020 2020 636d 6420 3d20 2762          cmd = 'b
-0008aec0: 6c61 7374 2573 2025 7320 2d64 6220 2573  last%s %s -db %s
-0008aed0: 202d 7175 6572 7920 2573 202d 6f75 7420   -query %s -out 
-0008aee0: 2573 2e74 626c 7374 2720 2520 2870 7266  %s.tblst' % (prf
-0008aef0: 782c 2073 7472 5f6f 7074 696f 6e2c 2069  x, str_option, i
-0008af00: 6e70 745f 7472 2c20 7265 665f 7472 2c20  npt_tr, ref_tr, 
-0008af10: 666e 616d 6529 0a20 2020 2065 6c73 653a  fname).    else:
-0008af20: 0a20 2020 2020 2020 2063 6d64 203d 2027  .        cmd = '
-0008af30: 2573 2f62 6c61 7374 2573 2025 7320 2d64  %s/blast%s %s -d
-0008af40: 6220 2573 202d 7175 6572 7920 2573 202d  b %s -query %s -
-0008af50: 6f75 7420 2573 2e74 626c 7374 2720 2520  out %s.tblst' % 
-0008af60: 2870 6174 685f 746f 5f62 6c61 7374 2c20  (path_to_blast, 
-0008af70: 7072 6678 2c20 7374 725f 6f70 7469 6f6e  prfx, str_option
-0008af80: 2c20 696e 7074 5f74 722c 2072 6566 5f74  , inpt_tr, ref_t
-0008af90: 722c 2066 6e61 6d65 290a 2020 2020 2020  r, fname).      
-0008afa0: 2020 0a20 2020 2069 6620 7665 7262 6f73    .    if verbos
-0008afb0: 653a 2070 7269 6e74 2822 5275 6e6e 696e  e: print("Runnin
-0008afc0: 6720 426c 6173 742d 2573 2077 6974 6820  g Blast-%s with 
-0008afd0: 2569 2063 616e 642e 2025 6920 7265 662e  %i cand. %i ref.
-0008afe0: 202e 2e2e 2022 2025 2028 6462 7479 7065   ... " % (dbtype
-0008aff0: 5b30 5d2e 7570 7065 7228 292c 6361 6e64  [0].upper(),cand
-0008b000: 5f63 6e74 2c20 7265 665f 636e 7429 2c20  _cnt, ref_cnt), 
-0008b010: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
-0008b020: 7565 293b 0a20 2020 2072 6573 203d 2073  ue);.    res = s
-0008b030: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
-0008b040: 6f75 7470 7574 2863 6d64 2c20 7368 656c  output(cmd, shel
-0008b050: 6c3d 5472 7565 290a 2020 2020 2320 7072  l=True).    # pr
-0008b060: 696e 7428 7265 732e 6465 636f 6465 2827  int(res.decode('
-0008b070: 7769 6e64 6f77 732d 3132 3532 2729 290a  windows-1252')).
-0008b080: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
-0008b090: 7072 696e 7428 2764 6f6e 652e 2729 0a20  print('done.'). 
-0008b0a0: 2020 200a 2020 2020 6f73 2e72 656d 6f76     .    os.remov
-0008b0b0: 6528 2027 2573 2e25 7368 7227 2025 2028  e( '%s.%shr' % (
-0008b0c0: 696e 7074 5f74 722c 2070 7266 7829 2029  inpt_tr, prfx) )
-0008b0d0: 0a20 2020 206f 732e 7265 6d6f 7665 2820  .    os.remove( 
-0008b0e0: 2725 732e 2573 696e 2720 2520 2869 6e70  '%s.%sin' % (inp
-0008b0f0: 745f 7472 2c20 7072 6678 2920 290a 2020  t_tr, prfx) ).  
-0008b100: 2020 6f73 2e72 656d 6f76 6528 2027 2573    os.remove( '%s
-0008b110: 2e25 7373 7127 2025 2028 696e 7074 5f74  .%ssq' % (inpt_t
-0008b120: 722c 2070 7266 7829 2029 0a20 2020 0a20  r, prfx) ).   . 
-0008b130: 2020 2063 6f6c 6e61 6d65 7320 3d20 5b27     colnames = ['
-0008b140: 7169 6427 2c20 2773 6964 272c 2027 716c  qid', 'sid', 'ql
-0008b150: 656e 272c 2027 616c 656e 272c 2027 736c  en', 'alen', 'sl
-0008b160: 656e 272c 2027 7173 7461 7274 272c 2027  en', 'qstart', '
-0008b170: 7165 6e64 272c 2027 7373 7461 7274 272c  qend', 'sstart',
-0008b180: 2027 7365 6e64 272c 205c 0a20 2020 2020   'send', \.     
-0008b190: 2020 2020 2020 2020 2020 2027 6e69 6465             'nide
-0008b1a0: 6e74 272c 2027 6d69 736d 6174 6368 272c  nt', 'mismatch',
-0008b1b0: 2027 6761 706f 7065 6e27 2c20 2771 636f   'gapopen', 'qco
-0008b1c0: 7673 272c 2027 7163 6f76 6873 7027 2c20  vs', 'qcovhsp', 
-0008b1d0: 2762 6974 7363 6f72 6527 5d0a 2020 2020  'bitscore'].    
-0008b1e0: 7462 6c73 7420 3d20 2725 732e 7462 6c73  tblst = '%s.tbls
-0008b1f0: 7427 2025 2066 6e61 6d65 0a20 2020 2064  t' % fname.    d
-0008b200: 6620 3d20 7064 2e72 6561 645f 6373 7628  f = pd.read_csv(
-0008b210: 7462 6c73 742c 2068 6561 6465 7220 3d20  tblst, header = 
-0008b220: 2769 6e66 6572 272c 206e 616d 6573 203d  'infer', names =
-0008b230: 2063 6f6c 6e61 6d65 732c 2073 6570 3d27   colnames, sep='
-0008b240: 5c74 2729 0a20 2020 200a 2020 2020 6f73  \t').    .    os
-0008b250: 2e72 656d 6f76 6528 2027 2573 2720 2520  .remove( '%s' % 
-0008b260: 2874 626c 7374 2920 290a 2020 2020 0a20  (tblst) ).    . 
-0008b270: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
-0008b280: 7269 6e74 2827 4e2e 6361 6e64 3a20 2569  rint('N.cand: %i
-0008b290: 2c20 4e2e 7375 626a 6563 742e 756e 6971  , N.subject.uniq
-0008b2a0: 7565 3a20 2569 2720 2520 286c 656e 2874  ue: %i' % (len(t
-0008b2b0: 6e29 2c20 6c65 6e28 7064 2e75 6e69 7175  n), len(pd.uniqu
-0008b2c0: 6528 6466 5b27 7369 6427 5d29 2929 2029  e(df['sid']))) )
-0008b2d0: 0a0a 2020 2020 6466 5b27 7363 7667 275d  ..    df['scvg']
-0008b2e0: 203d 2064 665b 2761 6c65 6e27 5d2f 6466   = df['alen']/df
-0008b2f0: 5b27 736c 656e 275d 0a20 2020 2064 665b  ['slen'].    df[
-0008b300: 2771 6376 6727 5d20 3d20 6466 5b27 616c  'qcvg'] = df['al
-0008b310: 656e 275d 2f64 665b 2771 6c65 6e27 5d0a  en']/df['qlen'].
-0008b320: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
-0008b330: 7472 6172 6563 6f20 3d3d 2054 7275 653a  trareco == True:
-0008b340: 0a20 2020 2020 2020 2061 626e 5f65 203d  .        abn_e =
-0008b350: 205b 5d0a 2020 2020 2020 2020 7470 6d5f   [].        tpm_
-0008b360: 6520 3d20 5b5d 0a20 2020 2020 2020 2069  e = [].        i
-0008b370: 6672 6163 203d 205b 5d0a 2020 2020 2020  frac = [].      
-0008b380: 2020 7369 6478 203d 205b 5d0a 2020 2020    sidx = [].    
-0008b390: 2020 2020 675f 7369 7a65 203d 205b 5d0a      g_size = [].
-0008b3a0: 2020 2020 2020 2020 6e5f 6578 6f6e 7320          n_exons 
-0008b3b0: 3d20 5b5d 0a20 2020 2020 2020 2067 5f76  = [].        g_v
-0008b3c0: 6f6c 203d 205b 5d0a 2020 2020 2020 2020  ol = [].        
-0008b3d0: 6963 6e74 203d 205b 5d0a 2020 2020 2020  icnt = [].      
-0008b3e0: 2020 7374 726e 6420 3d20 5b5d 0a20 2020    strnd = [].   
-0008b3f0: 2020 2020 2063 646e 6720 3d20 5b5d 0a20       cdng = []. 
-0008b400: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-0008b410: 7261 6e67 6528 6466 2e73 6861 7065 5b30  range(df.shape[0
-0008b420: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-0008b430: 2320 7320 3d20 273e 2573 5f43 6872 2573  # s = '>%s_Chr%s
-0008b440: 3a25 692d 2569 5f25 695f 2569 5f25 695f  :%i-%i_%i_%i_%i_
-0008b450: 4162 6e3a 2534 2e33 665f 5450 4d3a 2534  Abn:%4.3f_TPM:%4
-0008b460: 2e32 665f 4946 7261 633a 2533 2e32 665c  .2f_IFrac:%3.2f\
-0008b470: 6e27 200a 2020 2020 2020 2020 2020 2020  n' .            
-0008b480: 2320 2520 2874 722e 7072 6566 6978 2c20  # % (tr.prefix, 
-0008b490: 7472 2e63 6872 2c20 7472 2e73 7461 7274  tr.chr, tr.start
-0008b4a0: 2c20 7472 2e65 6e64 2c20 7472 2e67 6964  , tr.end, tr.gid
-0008b4b0: 782c 2074 722e 6772 705f 7369 7a65 2c20  x, tr.grp_size, 
-0008b4c0: 7472 2e69 636e 742c 2074 722e 6162 6e2c  tr.icnt, tr.abn,
-0008b4d0: 2074 722e 7470 6d2c 2074 722e 6973 6f5f   tr.tpm, tr.iso_
-0008b4e0: 6672 6163 290a 2020 2020 2020 2020 2020  frac).          
-0008b4f0: 2020 6864 7220 3d20 6466 5b73 5f69 645d    hdr = df[s_id]
-0008b500: 5b6b 5d2e 7370 6c69 7428 2720 2729 0a20  [k].split(' '). 
-0008b510: 2020 2020 2020 2020 2020 2069 7465 6d73             items
-0008b520: 203d 2068 6472 5b30 5d2e 7370 6c69 7428   = hdr[0].split(
-0008b530: 275f 2729 0a20 2020 2020 2020 2020 2020  '_').           
-0008b540: 2073 7472 6e64 2e61 7070 656e 6428 2069   strnd.append( i
-0008b550: 7465 6d73 5b32 5d29 0a20 2020 2020 2020  tems[2]).       
-0008b560: 2020 2020 2063 646e 672e 6170 7065 6e64       cdng.append
-0008b570: 2820 6974 656d 735b 335d 290a 2020 2020  ( items[3]).    
-0008b580: 2020 2020 2020 2020 7369 6478 2e61 7070          sidx.app
-0008b590: 656e 6428 2028 6974 656d 735b 345d 2920  end( (items[4]) 
-0008b5a0: 290a 2020 2020 2020 2020 2020 2020 675f  ).            g_
-0008b5b0: 7369 7a65 2e61 7070 656e 6428 2069 6e74  size.append( int
-0008b5c0: 2869 7465 6d73 5b35 5d29 2029 0a20 2020  (items[5]) ).   
-0008b5d0: 2020 2020 2020 2020 2069 636e 742e 6170           icnt.ap
-0008b5e0: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
-0008b5f0: 365d 2920 290a 2020 2020 2020 2020 2020  6]) ).          
-0008b600: 2020 7661 6c20 3d20 6974 656d 735b 375d    val = items[7]
-0008b610: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0008b620: 2020 2020 2020 2020 6162 6e5f 652e 6170          abn_e.ap
-0008b630: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
-0008b640: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
-0008b650: 2020 7661 6c20 3d20 6974 656d 735b 385d    val = items[8]
-0008b660: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0008b670: 2020 2020 2020 2020 7470 6d5f 652e 6170          tpm_e.ap
-0008b680: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
-0008b690: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
-0008b6a0: 2020 7661 6c20 3d20 6974 656d 735b 395d    val = items[9]
-0008b6b0: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0008b6c0: 2020 2020 2020 2020 6966 7261 632e 6170          ifrac.ap
-0008b6d0: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
-0008b6e0: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
-0008b6f0: 2020 7661 6c20 3d20 6974 656d 735b 3131    val = items[11
-0008b700: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-0008b710: 2020 2020 2020 2020 206e 5f65 786f 6e73           n_exons
-0008b720: 2e61 7070 656e 6428 2069 6e74 2876 616c  .append( int(val
-0008b730: 5b31 5d29 2029 0a20 2020 2020 2020 2020  [1]) ).         
-0008b740: 2020 2076 616c 203d 2069 7465 6d73 5b31     val = items[1
-0008b750: 325d 2e73 706c 6974 2827 3a27 290a 2020  2].split(':').  
-0008b760: 2020 2020 2020 2020 2020 675f 766f 6c2e            g_vol.
-0008b770: 6170 7065 6e64 2820 696e 7428 7661 6c5b  append( int(val[
-0008b780: 315d 2920 290a 2020 2020 656c 7365 3a0a  1]) ).    else:.
-0008b790: 2020 2020 2020 2020 6162 6e5f 6520 3d20          abn_e = 
-0008b7a0: 6e70 2e7a 6572 6f73 2864 662e 7368 6170  np.zeros(df.shap
-0008b7b0: 655b 305d 290a 2020 2020 2020 2020 7470  e[0]).        tp
-0008b7c0: 6d5f 6520 3d20 6e70 2e7a 6572 6f73 2864  m_e = np.zeros(d
-0008b7d0: 662e 7368 6170 655b 305d 290a 2020 2020  f.shape[0]).    
-0008b7e0: 2020 2020 6966 7261 6320 3d20 6e70 2e7a      ifrac = np.z
-0008b7f0: 6572 6f73 2864 662e 7368 6170 655b 305d  eros(df.shape[0]
-0008b800: 290a 2020 2020 2020 2020 7369 6478 203d  ).        sidx =
-0008b810: 206e 702e 6675 6c6c 2864 662e 7368 6170   np.full(df.shap
-0008b820: 655b 305d 2c20 2727 290a 2020 2020 2020  e[0], '').      
-0008b830: 2020 675f 7369 7a65 203d 206e 702e 7a65    g_size = np.ze
-0008b840: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
-0008b850: 0a20 2020 2020 2020 206e 5f65 786f 6e73  .        n_exons
-0008b860: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
-0008b870: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
-0008b880: 2067 5f76 6f6c 203d 206e 702e 7a65 726f   g_vol = np.zero
-0008b890: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
-0008b8a0: 2020 2020 2020 2069 636e 7420 3d20 6e70         icnt = np
-0008b8b0: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
-0008b8c0: 305d 290a 2020 2020 2020 2020 7374 726e  0]).        strn
-0008b8d0: 6420 3d20 6e70 2e7a 6572 6f73 2864 662e  d = np.zeros(df.
-0008b8e0: 7368 6170 655b 305d 290a 2020 2020 2020  shape[0]).      
-0008b8f0: 2020 6364 6e67 203d 206e 702e 7a65 726f    cdng = np.zero
-0008b900: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
-0008b910: 2020 2020 2020 200a 2020 2020 2327 2727         .    #'''
-0008b920: 0a20 2020 2072 6566 5f69 6e66 6f20 3d20  .    ref_info = 
-0008b930: 4661 6c73 650a 2020 2020 6966 206c 656e  False.    if len
-0008b940: 2864 665b 715f 6964 5d5b 305d 2e73 706c  (df[q_id][0].spl
-0008b950: 6974 2827 3a27 2929 203d 3d20 343a 200a  it(':')) == 4: .
-0008b960: 2020 2020 2020 2020 7265 665f 696e 666f          ref_info
-0008b970: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0008b980: 2320 7072 696e 7428 2752 6566 5f69 6e66  # print('Ref_inf
-0008b990: 6f20 6973 2074 7275 6527 290a 2020 2020  o is true').    
-0008b9a0: 2020 2020 0a20 2020 2069 6620 7265 665f      .    if ref_
-0008b9b0: 696e 666f 203d 3d20 5472 7565 3a0a 2020  info == True:.  
-0008b9c0: 2020 2020 2020 6769 6420 3d20 5b5d 0a20        gid = []. 
-0008b9d0: 2020 2020 2020 2063 7667 203d 205b 5d0a         cvg = [].
-0008b9e0: 2020 2020 2020 2020 6162 6e5f 7420 3d20          abn_t = 
-0008b9f0: 5b5d 0a20 2020 2020 2020 2074 706d 5f74  [].        tpm_t
-0008ba00: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-0008ba10: 7220 6b20 696e 2072 616e 6765 2864 662e  r k in range(df.
-0008ba20: 7368 6170 655b 305d 293a 0a20 2020 2020  shape[0]):.     
-0008ba30: 2020 2020 2020 2069 7465 6d73 203d 2064         items = d
-0008ba40: 665b 715f 6964 5d5b 6b5d 2e73 706c 6974  f[q_id][k].split
-0008ba50: 2827 3a27 290a 2020 2020 2020 2020 2020  (':').          
-0008ba60: 2020 6769 642e 6170 7065 6e64 2820 6974    gid.append( it
-0008ba70: 656d 735b 305d 2029 0a20 2020 2020 2020  ems[0] ).       
-0008ba80: 2020 2020 2063 7667 2e61 7070 656e 6428       cvg.append(
-0008ba90: 2066 6c6f 6174 2869 7465 6d73 5b31 5d29   float(items[1])
-0008baa0: 2029 0a20 2020 2020 2020 2020 2020 2061   ).            a
-0008bab0: 626e 5f74 2e61 7070 656e 6428 2066 6c6f  bn_t.append( flo
-0008bac0: 6174 2869 7465 6d73 5b32 5d29 2029 0a20  at(items[2]) ). 
-0008bad0: 2020 2020 2020 2020 2020 2074 706d 5f74             tpm_t
-0008bae0: 2e61 7070 656e 6428 2066 6c6f 6174 2869  .append( float(i
-0008baf0: 7465 6d73 5b33 5d29 2029 0a20 2020 2065  tems[3]) ).    e
-0008bb00: 6c73 653a 0a20 2020 2020 2020 2067 6964  lse:.        gid
-0008bb10: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
-0008bb20: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
-0008bb30: 2063 7667 203d 206e 702e 7a65 726f 7328   cvg = np.zeros(
-0008bb40: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
-0008bb50: 2020 2020 2061 626e 5f74 203d 206e 702e       abn_t = np.
-0008bb60: 7a65 726f 7328 6466 2e73 6861 7065 5b30  zeros(df.shape[0
-0008bb70: 5d29 0a20 2020 2020 2020 2074 706d 5f74  ]).        tpm_t
-0008bb80: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
-0008bb90: 6861 7065 5b30 5d29 0a0a 2020 2020 2327  hape[0])..    #'
-0008bba0: 2727 0a20 2020 2064 665b 2765 7870 5f63  ''.    df['exp_c
-0008bbb0: 7667 275d 203d 2063 7667 0a20 2020 2064  vg'] = cvg.    d
-0008bbc0: 665b 2761 626e 5f74 7275 6527 5d20 3d20  f['abn_true'] = 
-0008bbd0: 6162 6e5f 740a 2020 2020 6466 5b27 6162  abn_t.    df['ab
-0008bbe0: 6e5f 6573 7427 5d20 3d20 6162 6e5f 650a  n_est'] = abn_e.
-0008bbf0: 2020 2020 6466 5b27 7470 6d5f 7472 7565      df['tpm_true
-0008bc00: 275d 203d 2074 706d 5f74 0a20 2020 2064  '] = tpm_t.    d
-0008bc10: 665b 2774 706d 5f65 7374 275d 203d 2074  f['tpm_est'] = t
-0008bc20: 706d 5f65 0a20 2020 2064 665b 2767 6964  pm_e.    df['gid
-0008bc30: 7827 5d20 3d20 7369 6478 0a20 2020 2064  x'] = sidx.    d
-0008bc40: 665b 2769 6964 7827 5d20 3d20 6963 6e74  f['iidx'] = icnt
-0008bc50: 0a20 2020 2064 665b 2767 5f73 697a 6527  .    df['g_size'
-0008bc60: 5d20 3d20 675f 7369 7a65 0a20 2020 2064  ] = g_size.    d
-0008bc70: 665b 2769 736f 5f66 7261 6327 5d20 3d20  f['iso_frac'] = 
-0008bc80: 6966 7261 630a 2020 2020 6466 5b27 6e5f  ifrac.    df['n_
-0008bc90: 6578 6f6e 7327 5d20 3d20 6e5f 6578 6f6e  exons'] = n_exon
-0008bca0: 730a 2020 2020 6466 5b27 675f 766f 6c27  s.    df['g_vol'
-0008bcb0: 5d20 3d20 675f 766f 6c0a 2020 2020 6466  ] = g_vol.    df
-0008bcc0: 5b27 7374 7261 6e64 275d 203d 2073 7472  ['strand'] = str
-0008bcd0: 6e64 0a20 2020 2064 665b 2743 5f6f 725f  nd.    df['C_or_
-0008bce0: 4e27 5d20 3d20 6364 6e67 0a20 2020 2020  N'] = cdng.     
-0008bcf0: 2020 200a 2020 2020 6220 3d20 6466 5b71     .    b = df[q
-0008bd00: 5f63 7667 5d20 3e3d 2030 2e38 0a20 2020  _cvg] >= 0.8.   
-0008bd10: 2064 665f 6e65 7720 3d20 6466 2e6c 6f63   df_new = df.loc
-0008bd20: 5b62 2c3a 5d0a 2020 2020 6466 203d 2064  [b,:].    df = d
-0008bd30: 665f 6e65 770a 2020 2020 0a20 2020 2066  f_new.    .    f
-0008bd40: 756c 6c5f 6e61 6d65 7320 3d20 6466 5b71  ull_names = df[q
-0008bd50: 5f69 645d 202b 2064 665b 735f 6964 5d0a  _id] + df[s_id].
-0008bd60: 2020 2020 666e 7320 3d20 7064 2e75 6e69      fns = pd.uni
-0008bd70: 7175 6528 6675 6c6c 5f6e 616d 6573 290a  que(full_names).
-0008bd80: 2020 2020 6b20 3d20 300a 2020 2020 6466      k = 0.    df
-0008bd90: 5f6c 7374 203d 205b 5d0a 2020 2020 666f  _lst = [].    fo
-0008bda0: 7220 666e 2069 6e20 666e 733a 0a20 2020  r fn in fns:.   
-0008bdb0: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
-0008bdc0: 6675 6c6c 5f6e 616d 6573 203d 3d20 666e  full_names == fn
-0008bdd0: 290a 2020 2020 2020 2020 6466 5f74 6d70  ).        df_tmp
-0008bde0: 203d 2064 662e 696c 6f63 5b77 685d 0a20   = df.iloc[wh]. 
-0008bdf0: 2020 2020 2020 2071 6376 6720 3d20 6e70         qcvg = np
-0008be00: 2e61 7272 6179 2820 6466 5f74 6d70 5b71  .array( df_tmp[q
-0008be10: 5f63 7667 5d20 290a 2020 2020 2020 2020  _cvg] ).        
-0008be20: 6f64 7220 3d20 7163 7667 2e61 7267 736f  odr = qcvg.argso
-0008be30: 7274 2829 0a20 2020 2020 2020 2064 665f  rt().        df_
-0008be40: 6c73 742e 6170 7065 6e64 2864 665f 746d  lst.append(df_tm
-0008be50: 702e 696c 6f63 5b6f 6472 5b2d 315d 5d29  p.iloc[odr[-1]])
-0008be60: 200a 2020 2020 2020 2020 6b20 2b3d 2031   .        k += 1
-0008be70: 0a0a 2020 2020 6966 206c 656e 2864 665f  ..    if len(df_
-0008be80: 6c73 7429 203e 2030 3a0a 2020 2020 2020  lst) > 0:.      
-0008be90: 2020 6466 5f73 656c 203d 2070 642e 4461    df_sel = pd.Da
-0008bea0: 7461 4672 616d 6528 6466 5f6c 7374 290a  taFrame(df_lst).
-0008beb0: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
-0008bec0: 2020 2020 2074 7269 6e66 6f20 3d20 2725       trinfo = '%
-0008bed0: 735f 626c 6173 745f 7265 7375 6c74 2e74  s_blast_result.t
-0008bee0: 7376 2720 2520 666e 616d 650a 2020 2020  sv' % fname.    
-0008bef0: 2020 2020 6466 5f73 656c 2e74 6f5f 6373      df_sel.to_cs
-0008bf00: 7628 7472 696e 666f 2c20 6865 6164 6572  v(trinfo, header
-0008bf10: 3d54 7275 652c 2069 6e64 6578 3d46 616c  =True, index=Fal
-0008bf20: 7365 2c20 7365 703d 275c 7427 290a 2020  se, sep='\t').  
-0008bf30: 2020 2020 2020 2320 6966 2076 6572 626f        # if verbo
-0008bf40: 7365 3a20 7072 696e 7428 2754 7261 6e73  se: print('Trans
-0008bf50: 6372 6970 746f 6d65 2049 6e66 6f2e 2077  criptome Info. w
-0008bf60: 7269 7474 656e 2074 6f20 5c6e 2020 2025  ritten to \n   %
-0008bf70: 732e 2720 2520 7472 696e 666f 2029 0a0a  s.' % trinfo )..
-0008bf80: 2020 2020 2020 2020 6466 5f73 656c 203d          df_sel =
-0008bf90: 2070 642e 7265 6164 5f63 7376 2874 7269   pd.read_csv(tri
-0008bfa0: 6e66 6f2c 2073 6570 3d27 5c74 2729 0a20  nfo, sep='\t'). 
-0008bfb0: 2020 2020 2020 2023 2727 270a 0a20 2020         #'''..   
-0008bfc0: 2020 2020 2064 665f 7065 7266 2c20 6466       df_perf, df
-0008bfd0: 5f73 656c 203d 2067 6574 5f70 6572 666f  _sel = get_perfo
-0008bfe0: 726d 616e 6365 2864 665f 7365 6c2c 2066  rmance(df_sel, f
-0008bff0: 5f74 6f5f 7361 7665 3d66 6e61 6d65 2c20  _to_save=fname, 
-0008c000: 7265 6620 3d20 7265 662c 2076 6572 626f  ref = ref, verbo
-0008c010: 7365 3d76 6572 626f 7365 290a 2020 2020  se=verbose).    
-0008c020: 2020 2020 6466 5f70 6572 665b 2770 7265      df_perf['pre
-0008c030: 6369 7369 6f6e 275d 203d 2072 6f75 6e64  cision'] = round
-0008c040: 2864 665f 7065 7266 5b27 4e5f 7265 636f  (df_perf['N_reco
-0008c050: 7665 7265 6427 5d2a 3130 302f 6361 6e64  vered']*100/cand
-0008c060: 5f63 6e74 2c31 290a 2020 2020 2020 2020  _cnt,1).        
-0008c070: 6466 5f70 6572 665b 2773 656e 7369 7469  df_perf['sensiti
-0008c080: 7669 7479 275d 203d 2072 6f75 6e64 2864  vity'] = round(d
-0008c090: 665f 7065 7266 5b27 4e5f 7265 636f 7665  f_perf['N_recove
-0008c0a0: 7265 6427 5d2a 3130 302f 7265 665f 636e  red']*100/ref_cn
-0008c0b0: 742c 3129 0a20 2020 2020 2020 2023 2069  t,1).        # i
-0008c0c0: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
-0008c0d0: 2864 665f 7065 7266 290a 2020 2020 2020  (df_perf).      
-0008c0e0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-0008c0f0: 2074 7261 7265 636f 203d 3d20 5472 7565   trareco == True
-0008c100: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-0008c110: 5f74 7220 3d20 6765 745f 696e 666f 5f66  _tr = get_info_f
-0008c120: 726f 6d5f 7472 5f6e 616d 6528 2074 6e20  rom_tr_name( tn 
-0008c130: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0008c140: 5f74 725b 2764 6574 6563 7465 6427 5d20  _tr['detected'] 
-0008c150: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0008c160: 2020 2020 6466 5f74 722e 6c6f 635b 6c69      df_tr.loc[li
-0008c170: 7374 2864 665f 7365 6c5b 735f 6964 5d29  st(df_sel[s_id])
-0008c180: 2c27 6465 7465 6374 6564 275d 203d 2054  ,'detected'] = T
-0008c190: 7275 6520 0a20 2020 2020 2020 2020 2020  rue .           
-0008c1a0: 2064 665f 7472 5b71 5f6c 656e 5d20 3d20   df_tr[q_len] = 
-0008c1b0: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
-0008c1c0: 7220 6d2c 2073 6964 2069 6e20 656e 756d  r m, sid in enum
-0008c1d0: 6572 6174 6528 6466 5f73 656c 5b73 5f69  erate(df_sel[s_i
-0008c1e0: 645d 293a 0a20 2020 2020 2020 2020 2020  d]):.           
-0008c1f0: 2020 2020 2064 665f 7472 2e6c 6f63 5b73       df_tr.loc[s
-0008c200: 6964 2c71 5f6c 656e 5d20 3d20 6e70 2e72  id,q_len] = np.r
-0008c210: 6f75 6e64 2864 665f 7365 6c2e 696c 6f63  ound(df_sel.iloc
-0008c220: 5b6d 5d2e 716c 656e 290a 2020 2020 2020  [m].qlen).      
-0008c230: 2020 2020 2020 6466 5f74 725b 735f 7374        df_tr[s_st
-0008c240: 6172 745d 203d 2030 0a20 2020 2020 2020  art] = 0.       
-0008c250: 2020 2020 2023 2064 665f 7472 2e6c 6f63       # df_tr.loc
-0008c260: 5b6c 6973 7428 6466 5f73 656c 5b27 7369  [list(df_sel['si
-0008c270: 6427 5d29 2c27 7363 7667 275d 203d 2064  d']),'scvg'] = d
-0008c280: 665f 7365 6c2e 6c6f 635b 3a2c 2773 6376  f_sel.loc[:,'scv
-0008c290: 6727 5d20 0a20 2020 2020 2020 2020 2020  g'] .           
-0008c2a0: 2066 6f72 206d 2c20 7369 6420 696e 2065   for m, sid in e
-0008c2b0: 6e75 6d65 7261 7465 2864 665f 7365 6c5b  numerate(df_sel[
-0008c2c0: 735f 6964 5d29 3a0a 2020 2020 2020 2020  s_id]):.        
-0008c2d0: 2020 2020 2020 2020 6466 5f74 722e 6c6f          df_tr.lo
-0008c2e0: 635b 7369 642c 735f 7374 6172 745d 203d  c[sid,s_start] =
-0008c2f0: 206e 702e 726f 756e 6428 6466 5f73 656c   np.round(df_sel
-0008c300: 2e69 6c6f 635b 6d5d 2e73 7374 6172 7429  .iloc[m].sstart)
-0008c310: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-0008c320: 7472 5b73 5f65 6e64 5d20 3d20 300a 2020  tr[s_end] = 0.  
-0008c330: 2020 2020 2020 2020 2020 2320 6466 5f74            # df_t
-0008c340: 722e 6c6f 635b 6c69 7374 2864 665f 7365  r.loc[list(df_se
-0008c350: 6c5b 2773 6964 275d 292c 2773 6376 6727  l['sid']),'scvg'
-0008c360: 5d20 3d20 6466 5f73 656c 2e6c 6f63 5b3a  ] = df_sel.loc[:
-0008c370: 2c27 7363 7667 275d 200a 2020 2020 2020  ,'scvg'] .      
-0008c380: 2020 2020 2020 666f 7220 6d2c 2073 6964        for m, sid
-0008c390: 2069 6e20 656e 756d 6572 6174 6528 6466   in enumerate(df
-0008c3a0: 5f73 656c 5b73 5f69 645d 293a 0a20 2020  _sel[s_id]):.   
-0008c3b0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0008c3c0: 7472 2e6c 6f63 5b73 6964 2c73 5f65 6e64  tr.loc[sid,s_end
-0008c3d0: 5d20 3d20 6e70 2e72 6f75 6e64 2864 665f  ] = np.round(df_
-0008c3e0: 7365 6c2e 696c 6f63 5b6d 5d2e 7365 6e64  sel.iloc[m].send
-0008c3f0: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0008c400: 5f74 7220 3d20 6466 5f74 722e 7265 7365  _tr = df_tr.rese
-0008c410: 745f 696e 6465 7828 290a 2020 2020 2020  t_index().      
-0008c420: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008c430: 2020 2020 6466 5f74 7220 3d20 4e6f 6e65      df_tr = None
-0008c440: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0008c450: 2020 2020 2020 7265 7475 726e 2864 665f        return(df_
-0008c460: 7065 7266 2c20 6466 5f73 656c 2c20 6466  perf, df_sel, df
-0008c470: 5f74 7229 0a20 2020 200a 2020 2020 656c  _tr).    .    el
-0008c480: 7365 3a0a 2020 2020 2020 2020 6966 2076  se:.        if v
-0008c490: 6572 626f 7365 3a20 7072 696e 7428 274e  erbose: print('N
-0008c4a0: 6f20 7472 2066 6f75 6e64 2e20 2729 0a20  o tr found. '). 
-0008c4b0: 2020 2020 2020 2072 6574 7572 6e28 4e6f         return(No
-0008c4c0: 6e65 2c4e 6f6e 652c 4e6f 6e65 290a 2020  ne,None,None).  
-0008c4d0: 2020 0a0a 2323 2323 2323 2323 2323 2323    ..############
+000897a0: 2020 2020 2023 230a 2323 2064 6576 656c       ##.## devel
+000897b0: 6f70 6564 2062 7920 5365 6f6b 6879 756e  oped by Seokhyun
+000897c0: 2059 6f6f 6e20 2873 796f 6f6e 4064 6b75   Yoon (syoon@dku
+000897d0: 2e65 6475 2920 4f63 742e 2030 342c 2032  .edu) Oct. 04, 2
+000897e0: 3032 3020 2020 2323 0a23 2323 2323 2323  020   ##.#######
+000897f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089820: 2323 0a0a 6465 6620 7768 6963 6828 2061  ##..def which( a
+00089830: 692c 2076 616c 7565 203d 2054 7275 6520  i, value = True 
+00089840: 2920 3a0a 2020 2020 7768 203d 205b 5d0a  ) :.    wh = [].
+00089850: 2020 2020 6120 3d20 6c69 7374 2861 6929      a = list(ai)
+00089860: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
+00089870: 6e67 6528 6c65 6e28 6129 293a 200a 2020  nge(len(a)): .  
+00089880: 2020 2020 2020 6966 2061 5b6b 5d20 3d3d        if a[k] ==
+00089890: 2076 616c 7565 3a20 0a20 2020 2020 2020   value: .       
+000898a0: 2020 2020 2077 682e 6170 7065 6e64 286b       wh.append(k
+000898b0: 2920 0a20 2020 2072 6574 7572 6e28 7768  ) .    return(wh
+000898c0: 290a 0a64 6566 2067 6574 5f69 6e66 6f5f  )..def get_info_
+000898d0: 6672 6f6d 5f74 725f 6e61 6d65 2820 746e  from_tr_name( tn
+000898e0: 7320 293a 0a20 2020 200a 2020 2020 6162  s ):.    .    ab
+000898f0: 6e5f 6520 3d20 5b5d 0a20 2020 2074 706d  n_e = [].    tpm
+00089900: 5f65 203d 205b 5d0a 2020 2020 6966 7261  _e = [].    ifra
+00089910: 6320 3d20 5b5d 0a20 2020 2073 6964 7820  c = [].    sidx 
+00089920: 3d20 5b5d 0a20 2020 2067 5f73 697a 6520  = [].    g_size 
+00089930: 3d20 5b5d 0a20 2020 206e 5f65 786f 6e73  = [].    n_exons
+00089940: 203d 205b 5d0a 2020 2020 675f 766f 6c20   = [].    g_vol 
+00089950: 3d20 5b5d 0a20 2020 2069 636e 7420 3d20  = [].    icnt = 
+00089960: 5b5d 0a20 2020 2074 5f6c 656e 203d 205b  [].    t_len = [
+00089970: 5d0a 2020 2020 7374 726e 6420 3d20 5b5d  ].    strnd = []
+00089980: 0a20 2020 2063 646e 6720 3d20 5b5d 0a20  .    cdng = []. 
+00089990: 2020 2066 6f72 206b 2c20 746e 2069 6e20     for k, tn in 
+000899a0: 656e 756d 6572 6174 6528 746e 7329 3a0a  enumerate(tns):.
+000899b0: 2020 2020 2020 2020 6864 7220 3d20 746e          hdr = tn
+000899c0: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
+000899d0: 2020 2020 6974 656d 7320 3d20 6864 725b      items = hdr[
+000899e0: 305d 2e73 706c 6974 2827 5f27 290a 2020  0].split('_').  
+000899f0: 2020 2020 2020 7374 726e 642e 6170 7065        strnd.appe
+00089a00: 6e64 2820 6974 656d 735b 325d 290a 2020  nd( items[2]).  
+00089a10: 2020 2020 2020 6364 6e67 2e61 7070 656e        cdng.appen
+00089a20: 6428 2069 7465 6d73 5b33 5d29 0a20 2020  d( items[3]).   
+00089a30: 2020 2020 2073 6964 782e 6170 7065 6e64       sidx.append
+00089a40: 2820 2869 7465 6d73 5b34 5d29 2029 0a20  ( (items[4]) ). 
+00089a50: 2020 2020 2020 2067 5f73 697a 652e 6170         g_size.ap
+00089a60: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
+00089a70: 355d 2920 290a 2020 2020 2020 2020 6963  5]) ).        ic
+00089a80: 6e74 2e61 7070 656e 6428 2069 6e74 2869  nt.append( int(i
+00089a90: 7465 6d73 5b36 5d29 2029 0a20 2020 2020  tems[6]) ).     
+00089aa0: 2020 2076 616c 203d 2069 7465 6d73 5b37     val = items[7
+00089ab0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
+00089ac0: 2020 2020 2061 626e 5f65 2e61 7070 656e       abn_e.appen
+00089ad0: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
+00089ae0: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
+00089af0: 2069 7465 6d73 5b38 5d2e 7370 6c69 7428   items[8].split(
+00089b00: 273a 2729 0a20 2020 2020 2020 2074 706d  ':').        tpm
+00089b10: 5f65 2e61 7070 656e 6428 2066 6c6f 6174  _e.append( float
+00089b20: 2876 616c 5b31 5d29 2029 0a20 2020 2020  (val[1]) ).     
+00089b30: 2020 2076 616c 203d 2069 7465 6d73 5b39     val = items[9
+00089b40: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
+00089b50: 2020 2020 2069 6672 6163 2e61 7070 656e       ifrac.appen
+00089b60: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
+00089b70: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
+00089b80: 2069 7465 6d73 5b31 315d 2e73 706c 6974   items[11].split
+00089b90: 2827 3a27 290a 2020 2020 2020 2020 6e5f  (':').        n_
+00089ba0: 6578 6f6e 732e 6170 7065 6e64 2820 696e  exons.append( in
+00089bb0: 7428 7661 6c5b 315d 2920 290a 2020 2020  t(val[1]) ).    
+00089bc0: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
+00089bd0: 3132 5d2e 7370 6c69 7428 273a 2729 0a20  12].split(':'). 
+00089be0: 2020 2020 2020 2067 5f76 6f6c 2e61 7070         g_vol.app
+00089bf0: 656e 6428 2069 6e74 2876 616c 5b31 5d29  end( int(val[1])
+00089c00: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
+00089c10: 2069 7465 6d73 5b31 335d 2e73 706c 6974   items[13].split
+00089c20: 2827 3a27 290a 2020 2020 2020 2020 745f  (':').        t_
+00089c30: 6c65 6e2e 6170 7065 6e64 2820 696e 7428  len.append( int(
+00089c40: 7661 6c5b 315d 2920 290a 2020 2020 0a20  val[1]) ).    . 
+00089c50: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
+00089c60: 7261 6d65 2829 0a20 2020 200a 2020 2020  rame().    .    
+00089c70: 6466 5b27 7472 5f6e 616d 6527 5d20 3d20  df['tr_name'] = 
+00089c80: 746e 730a 2020 2020 6466 5b27 6162 6e5f  tns.    df['abn_
+00089c90: 6573 7427 5d20 3d20 6162 6e5f 650a 2020  est'] = abn_e.  
+00089ca0: 2020 6466 5b27 7470 6d5f 6573 7427 5d20    df['tpm_est'] 
+00089cb0: 3d20 7470 6d5f 650a 2020 2020 6466 5b27  = tpm_e.    df['
+00089cc0: 6769 6478 275d 203d 2073 6964 780a 2020  gidx'] = sidx.  
+00089cd0: 2020 6466 5b27 6969 6478 275d 203d 2069    df['iidx'] = i
+00089ce0: 636e 740a 2020 2020 6466 5b27 675f 7369  cnt.    df['g_si
+00089cf0: 7a65 275d 203d 2067 5f73 697a 650a 2020  ze'] = g_size.  
+00089d00: 2020 6466 5b27 6973 6f5f 6672 6163 275d    df['iso_frac']
+00089d10: 203d 2069 6672 6163 0a20 2020 2064 665b   = ifrac.    df[
+00089d20: 276e 5f65 786f 6e73 275d 203d 206e 5f65  'n_exons'] = n_e
+00089d30: 786f 6e73 0a20 2020 2064 665b 2767 5f76  xons.    df['g_v
+00089d40: 6f6c 275d 203d 2067 5f76 6f6c 0a20 2020  ol'] = g_vol.   
+00089d50: 2064 665b 276c 656e 6774 6827 5d20 3d20   df['length'] = 
+00089d60: 745f 6c65 6e0a 2020 2020 6466 5b27 7374  t_len.    df['st
+00089d70: 7261 6e64 275d 203d 2073 7472 6e64 0a20  rand'] = strnd. 
+00089d80: 2020 2064 665b 2743 5f6f 725f 4e27 5d20     df['C_or_N'] 
+00089d90: 3d20 6364 6e67 0a20 2020 200a 2020 2020  = cdng.    .    
+00089da0: 6466 203d 2064 662e 7365 745f 696e 6465  df = df.set_inde
+00089db0: 7828 2774 725f 6e61 6d65 2729 0a20 2020  x('tr_name').   
+00089dc0: 200a 2020 2020 7265 7475 726e 2064 660a   .    return df.
+00089dd0: 0a64 6566 2067 6574 5f70 6572 666f 726d  .def get_perform
+00089de0: 616e 6365 2874 7269 6e66 6f2c 2063 7667  ance(trinfo, cvg
+00089df0: 5f74 6820 3d20 5b38 302c 3930 2c39 355d  _th = [80,90,95]
+00089e00: 2c20 665f 746f 5f73 6176 6520 3d20 4e6f  , f_to_save = No
+00089e10: 6e65 2c20 7265 6620 3d20 302c 2076 6572  ne, ref = 0, ver
+00089e20: 626f 7365 203d 2046 616c 7365 293a 0a20  bose = False):. 
+00089e30: 2020 200a 2020 2020 2327 2727 0a20 2020     .    #'''.   
+00089e40: 2069 6620 7265 6620 3d3d 2030 3a0a 2020   if ref == 0:.  
+00089e50: 2020 2020 2020 715f 6376 6720 3d20 2771        q_cvg = 'q
+00089e60: 6376 6727 0a20 2020 2020 2020 2071 5f6c  cvg'.        q_l
+00089e70: 656e 203d 2027 716c 656e 270a 2020 2020  en = 'qlen'.    
+00089e80: 2020 2020 715f 6964 203d 2027 7169 6427      q_id = 'qid'
+00089e90: 0a20 2020 2020 2020 2073 5f73 7461 7274  .        s_start
+00089ea0: 203d 2027 7373 7461 7274 270a 2020 2020   = 'sstart'.    
+00089eb0: 2020 2020 735f 656e 6420 3d20 2773 656e      s_end = 'sen
+00089ec0: 6427 0a20 2020 2020 2020 2073 5f69 6420  d'.        s_id 
+00089ed0: 3d20 2773 6964 270a 2020 2020 656c 7365  = 'sid'.    else
+00089ee0: 3a0a 2020 2020 2020 2020 715f 6376 6720  :.        q_cvg 
+00089ef0: 3d20 2773 6376 6727 0a20 2020 2020 2020  = 'scvg'.       
+00089f00: 2071 5f6c 656e 203d 2027 736c 656e 270a   q_len = 'slen'.
+00089f10: 2020 2020 2020 2020 715f 6964 203d 2027          q_id = '
+00089f20: 7369 6427 0a20 2020 2020 2020 2073 5f73  sid'.        s_s
+00089f30: 7461 7274 203d 2027 7173 7461 7274 270a  tart = 'qstart'.
+00089f40: 2020 2020 2020 2020 735f 656e 6420 3d20          s_end = 
+00089f50: 2771 656e 6427 0a20 2020 2020 2020 2073  'qend'.        s
+00089f60: 5f69 6420 3d20 2771 6964 270a 2020 2020  _id = 'qid'.    
+00089f70: 2327 2727 0a20 2020 200a 2020 2020 7169  #'''.    .    qi
+00089f80: 6473 203d 2070 642e 756e 6971 7565 2874  ds = pd.unique(t
+00089f90: 7269 6e66 6f5b 715f 6964 5d29 0a20 2020  rinfo[q_id]).   
+00089fa0: 2073 6964 7320 3d20 7064 2e75 6e69 7175   sids = pd.uniqu
+00089fb0: 6528 7472 696e 666f 5b73 5f69 645d 290a  e(trinfo[s_id]).
+00089fc0: 2020 2020 7767 7420 3d20 6e70 2e7a 6572      wgt = np.zer
+00089fd0: 6f73 285b 6c65 6e28 7169 6473 292c 6c65  os([len(qids),le
+00089fe0: 6e28 7369 6473 295d 290a 2020 2020 6966  n(sids)]).    if
+00089ff0: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
+0008a000: 274d 6174 6368 696e 6720 2825 692c 2569  'Matching (%i,%i
+0008a010: 2920 2720 2520 2877 6774 2e73 6861 7065  ) ' % (wgt.shape
+0008a020: 292c 2065 6e64 3d27 2729 0a0a 2020 2020  ), end='')..    
+0008a030: 7169 6478 203d 206e 702e 6675 6c6c 2874  qidx = np.full(t
+0008a040: 7269 6e66 6f2e 7368 6170 655b 305d 2c2d  rinfo.shape[0],-
+0008a050: 312c 6474 7970 653d 696e 7429 0a20 2020  1,dtype=int).   
+0008a060: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
+0008a070: 6c65 6e28 7169 6473 2929 203a 0a20 2020  len(qids)) :.   
+0008a080: 2020 2020 2071 6964 203d 2071 6964 735b       qid = qids[
+0008a090: 6b5d 0a20 2020 2020 2020 2077 6820 3d20  k].        wh = 
+0008a0a0: 7768 6963 6828 2074 7269 6e66 6f5b 715f  which( trinfo[q_
+0008a0b0: 6964 5d20 3d3d 2071 6964 2029 0a20 2020  id] == qid ).   
+0008a0c0: 2020 2020 2071 6964 785b 7768 5d20 3d20       qidx[wh] = 
+0008a0d0: 6b0a 2020 2020 2020 2020 0a20 2020 2069  k.        .    i
+0008a0e0: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
+0008a0f0: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
+0008a100: 2020 7369 6478 203d 206e 702e 6675 6c6c    sidx = np.full
+0008a110: 2874 7269 6e66 6f2e 7368 6170 655b 305d  (trinfo.shape[0]
+0008a120: 2c2d 312c 6474 7970 653d 696e 7429 0a20  ,-1,dtype=int). 
+0008a130: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
+0008a140: 6528 6c65 6e28 7369 6473 2929 203a 0a20  e(len(sids)) :. 
+0008a150: 2020 2020 2020 2073 6964 203d 2073 6964         sid = sid
+0008a160: 735b 6b5d 0a20 2020 2020 2020 2077 6820  s[k].        wh 
+0008a170: 3d20 7768 6963 6828 2074 7269 6e66 6f5b  = which( trinfo[
+0008a180: 735f 6964 5d20 3d3d 2073 6964 2029 0a20  s_id] == sid ). 
+0008a190: 2020 2020 2020 2073 6964 785b 7768 5d20         sidx[wh] 
+0008a1a0: 3d20 6b0a 2020 2020 2020 2020 0a20 2020  = k.        .   
+0008a1b0: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
+0008a1c0: 6e74 2827 2e27 2c20 656e 643d 2727 290a  nt('.', end='').
+0008a1d0: 2020 2020 666f 7220 7720 696e 2072 616e      for w in ran
+0008a1e0: 6765 286c 656e 2871 6964 7829 293a 0a20  ge(len(qidx)):. 
+0008a1f0: 2020 2020 2020 2077 6774 5b69 6e74 2871         wgt[int(q
+0008a200: 6964 785b 775d 292c 2069 6e74 2873 6964  idx[w]), int(sid
+0008a210: 785b 775d 295d 203d 202d 7472 696e 666f  x[w])] = -trinfo
+0008a220: 5b71 5f63 7667 5d5b 775d 0a0a 2020 2020  [q_cvg][w]..    
+0008a230: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
+0008a240: 7428 275f 272c 2065 6e64 3d27 2729 0a20  t('_', end=''). 
+0008a250: 2020 2023 2070 7269 6e74 2877 6774 2e73     # print(wgt.s
+0008a260: 6861 7065 290a 2020 2020 726f 775f 6964  hape).    row_id
+0008a270: 782c 2063 6f6c 5f69 6478 203d 206f 7074  x, col_idx = opt
+0008a280: 696d 697a 652e 6c69 6e65 6172 5f73 756d  imize.linear_sum
+0008a290: 5f61 7373 6967 6e6d 656e 7428 7767 7429  _assignment(wgt)
+0008a2a0: 0a20 2020 200a 2020 2020 6966 2076 6572  .    .    if ver
+0008a2b0: 626f 7365 3a20 7072 696e 7428 272e 272c  bose: print('.',
+0008a2c0: 2065 6e64 3d27 2729 0a20 2020 2064 665f   end='').    df_
+0008a2d0: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
+0008a2e0: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
+0008a2f0: 636f 6c5f 6964 7829 2920 3a0a 2020 2020  col_idx)) :.    
+0008a300: 2020 2020 7369 203d 2063 6f6c 5f69 6478      si = col_idx
+0008a310: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
+0008a320: 2077 6869 6368 2873 6964 7820 3d3d 2073   which(sidx == s
+0008a330: 6929 0a20 2020 2020 2020 2077 203d 2077  i).        w = w
+0008a340: 6869 6368 2820 7169 6478 5b77 685d 203d  hich( qidx[wh] =
+0008a350: 3d20 726f 775f 6964 785b 6b5d 2029 0a20  = row_idx[k] ). 
+0008a360: 2020 2020 2020 2069 6620 6c65 6e28 7729         if len(w)
+0008a370: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0008a380: 2020 6966 206c 656e 2877 2920 3e20 313a    if len(w) > 1:
+0008a390: 2070 7269 6e74 2827 4552 524f 5220 696e   print('ERROR in
+0008a3a0: 2067 6574 5f70 6572 666f 726d 616e 6365   get_performance
+0008a3b0: 2829 3a20 4c65 6e28 7729 203d 2025 6927  (): Len(w) = %i'
+0008a3c0: 2025 206c 656e 2877 2920 290a 2020 2020   % len(w) ).    
+0008a3d0: 2020 2020 2020 2020 6964 7820 3d20 7768          idx = wh
+0008a3e0: 5b77 5b30 5d5d 0a20 2020 2020 2020 2020  [w[0]].         
+0008a3f0: 2020 2064 665f 6c73 742e 6170 7065 6e64     df_lst.append
+0008a400: 2874 7269 6e66 6f2e 696c 6f63 5b69 6478  (trinfo.iloc[idx
+0008a410: 5d29 0a20 2020 2020 2020 200a 2020 2020  ]).        .    
+0008a420: 6466 5f73 656c 203d 2070 642e 4461 7461  df_sel = pd.Data
+0008a430: 4672 616d 6528 6466 5f6c 7374 290a 2020  Frame(df_lst).  
+0008a440: 2020 6966 2066 5f74 6f5f 7361 7665 2069    if f_to_save i
+0008a450: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0008a460: 2020 2020 666e 616d 6520 3d20 2725 735f      fname = '%s_
+0008a470: 626c 6173 745f 7265 7375 6c74 2e74 7376  blast_result.tsv
+0008a480: 2720 2520 665f 746f 5f73 6176 650a 2020  ' % f_to_save.  
+0008a490: 2020 2020 2020 6466 5f73 656c 2e74 6f5f        df_sel.to_
+0008a4a0: 6373 7628 666e 616d 652c 2068 6561 6465  csv(fname, heade
+0008a4b0: 723d 5472 7565 2c20 696e 6465 783d 4661  r=True, index=Fa
+0008a4c0: 6c73 652c 2073 6570 3d27 5c74 2729 0a20  lse, sep='\t'). 
+0008a4d0: 2020 2020 2020 2023 2069 6620 7665 7262         # if verb
+0008a4e0: 6f73 653a 2070 7269 6e74 2827 2025 732e  ose: print(' %s.
+0008a4f0: 2720 2520 666e 616d 652c 2065 6e64 3d27  ' % fname, end='
+0008a500: 2720 290a 2020 2020 0a20 2020 2069 6620  ' ).    .    if 
+0008a510: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
+0008a520: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+0008a530: 636e 7420 3d20 6e70 2e7a 6572 6f73 286c  cnt = np.zeros(l
+0008a540: 656e 2863 7667 5f74 6829 290a 2020 2020  en(cvg_th)).    
+0008a550: 666f 7220 6b20 696e 2072 616e 6765 286c  for k in range(l
+0008a560: 656e 2863 7667 5f74 6829 293a 0a20 2020  en(cvg_th)):.   
+0008a570: 2020 2020 2074 6820 3d20 6376 675f 7468       th = cvg_th
+0008a580: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
+0008a590: 2077 6869 6368 2820 6466 5f73 656c 5b71   which( df_sel[q
+0008a5a0: 5f63 7667 5d2a 3130 3020 3e3d 2074 6820  _cvg]*100 >= th 
+0008a5b0: 290a 2020 2020 2020 2020 636e 745b 6b5d  ).        cnt[k]
+0008a5c0: 203d 206e 702e 696e 7428 6c65 6e28 7768   = np.int(len(wh
+0008a5d0: 2929 0a20 2020 2020 2020 200a 2020 2020  )).        .    
+0008a5e0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
+0008a5f0: 7428 2720 646f 6e65 2e27 290a 0a20 2020  t(' done.')..   
+0008a600: 2064 203d 207b 2763 7667 5f74 6827 3a20   d = {'cvg_th': 
+0008a610: 6376 675f 7468 2c20 274e 5f72 6563 6f76  cvg_th, 'N_recov
+0008a620: 6572 6564 273a 2063 6e74 2e61 7374 7970  ered': cnt.astyp
+0008a630: 6528 696e 7429 2c20 2770 7265 6369 7369  e(int), 'precisi
+0008a640: 6f6e 273a 206e 702e 726f 756e 6428 3130  on': np.round(10
+0008a650: 302a 636e 742f 6c65 6e28 7369 6473 292c  0*cnt/len(sids),
+0008a660: 3129 7d0a 2020 2020 6466 5f70 6572 6620  1)}.    df_perf 
+0008a670: 3d20 7064 2e44 6174 6146 7261 6d65 2864  = pd.DataFrame(d
+0008a680: 6174 6120 3d20 6429 2023 2c20 636f 6c75  ata = d) #, colu
+0008a690: 6d6e 7320 3d20 5b27 6376 675f 7468 272c  mns = ['cvg_th',
+0008a6a0: 276e 5f72 6563 6f76 6572 6564 272c 2770  'n_recovered','p
+0008a6b0: 7265 6369 7369 6f6e 275d 290a 2020 2020  recision']).    
+0008a6c0: 0a20 2020 2072 6574 7572 6e28 6466 5f70  .    return(df_p
+0008a6d0: 6572 662c 2064 665f 7365 6c29 0a0a 2020  erf, df_sel)..  
+0008a6e0: 2020 0a64 6566 2072 756e 5f62 6c61 7374    .def run_blast
+0008a6f0: 2820 696e 7074 5f66 612c 2072 6566 5f66  ( inpt_fa, ref_f
+0008a700: 612c 2070 6174 685f 746f 5f62 6c61 7374  a, path_to_blast
+0008a710: 203d 204e 6f6e 652c 2074 7261 7265 636f   = None, trareco
+0008a720: 203d 2046 616c 7365 2c20 7265 665f 696e   = False, ref_in
+0008a730: 666f 203d 2046 616c 7365 2c20 5c0a 2020  fo = False, \.  
+0008a740: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0008a750: 6274 7970 6520 3d20 276e 7563 6c27 2c20  btype = 'nucl', 
+0008a760: 7265 6620 3d20 302c 2073 6469 7620 3d20  ref = 0, sdiv = 
+0008a770: 3130 2c20 6d78 5f6e 6361 6e64 203d 2036  10, mx_ncand = 6
+0008a780: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
+0008a790: 6529 3a0a 0a20 2020 2023 2727 270a 2020  e):..    #'''.  
+0008a7a0: 2020 6966 2072 6566 203d 3d20 303a 0a20    if ref == 0:. 
+0008a7b0: 2020 2020 2020 2072 6566 5f74 7220 3d20         ref_tr = 
+0008a7c0: 7265 665f 6661 0a20 2020 2020 2020 2069  ref_fa.        i
+0008a7d0: 6e70 745f 7472 203d 2069 6e70 745f 6661  npt_tr = inpt_fa
+0008a7e0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0008a7f0: 2020 715f 6376 6720 3d20 2771 6376 6727    q_cvg = 'qcvg'
+0008a800: 0a20 2020 2020 2020 2071 5f6c 656e 203d  .        q_len =
+0008a810: 2027 716c 656e 270a 2020 2020 2020 2020   'qlen'.        
+0008a820: 715f 6964 203d 2027 7169 6427 0a20 2020  q_id = 'qid'.   
+0008a830: 2020 2020 2073 5f73 7461 7274 203d 2027       s_start = '
+0008a840: 7373 7461 7274 270a 2020 2020 2020 2020  sstart'.        
+0008a850: 735f 656e 6420 3d20 2773 656e 6427 0a20  s_end = 'send'. 
+0008a860: 2020 2020 2020 2073 5f69 6420 3d20 2773         s_id = 's
+0008a870: 6964 270a 2020 2020 656c 7365 3a0a 2020  id'.    else:.  
+0008a880: 2020 2020 2020 7265 665f 7472 203d 2069        ref_tr = i
+0008a890: 6e70 745f 6661 0a20 2020 2020 2020 2069  npt_fa.        i
+0008a8a0: 6e70 745f 7472 203d 2072 6566 5f66 610a  npt_tr = ref_fa.
+0008a8b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0008a8c0: 2071 5f63 7667 203d 2027 7363 7667 270a   q_cvg = 'scvg'.
+0008a8d0: 2020 2020 2020 2020 715f 6c65 6e20 3d20          q_len = 
+0008a8e0: 2773 6c65 6e27 0a20 2020 2020 2020 2071  'slen'.        q
+0008a8f0: 5f69 6420 3d20 2773 6964 270a 2020 2020  _id = 'sid'.    
+0008a900: 2020 2020 735f 7374 6172 7420 3d20 2771      s_start = 'q
+0008a910: 7374 6172 7427 0a20 2020 2020 2020 2073  start'.        s
+0008a920: 5f65 6e64 203d 2027 7165 6e64 270a 2020  _end = 'qend'.  
+0008a930: 2020 2020 2020 735f 6964 203d 2027 7169        s_id = 'qi
+0008a940: 6427 0a20 2020 2023 2727 270a 2020 2020  d'.    #'''.    
+0008a950: 0a20 2020 2066 696c 655f 6e61 6d65 7320  .    file_names 
+0008a960: 3d20 696e 7074 5f74 722e 7370 6c69 7428  = inpt_tr.split(
+0008a970: 272e 2729 0a20 2020 2066 6e61 6d65 203d  '.').    fname =
+0008a980: 2027 272e 6a6f 696e 2873 7420 666f 7220   ''.join(st for 
+0008a990: 7374 2069 6e20 6669 6c65 5f6e 616d 6573  st in file_names
+0008a9a0: 5b3a 2d31 5d20 290a 0a20 2020 2074 6e5f  [:-1] )..    tn_
+0008a9b0: 696e 203d 205b 5d0a 2020 2020 6620 3d20  in = [].    f = 
+0008a9c0: 6f70 656e 2869 6e70 745f 7472 2c27 7227  open(inpt_tr,'r'
+0008a9d0: 290a 2020 2020 6361 6e64 5f63 6e74 203d  ).    cand_cnt =
+0008a9e0: 2030 0a20 2020 2066 6f72 206c 696e 6520   0.    for line 
+0008a9f0: 696e 2066 3a0a 2020 2020 2020 2020 6966  in f:.        if
+0008aa00: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
+0008aa10: 0a20 2020 2020 2020 2020 2020 2074 6e5f  .            tn_
+0008aa20: 696e 2e61 7070 656e 6428 6c69 6e65 5b31  in.append(line[1
+0008aa30: 3a2d 315d 290a 2020 2020 2020 2020 2020  :-1]).          
+0008aa40: 2020 6361 6e64 5f63 6e74 202b 3d20 310a    cand_cnt += 1.
+0008aa50: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
+0008aa60: 2020 0a20 2020 2074 6e5f 7265 6620 3d20    .    tn_ref = 
+0008aa70: 5b5d 0a20 2020 2066 203d 206f 7065 6e28  [].    f = open(
+0008aa80: 7265 665f 7472 2c27 7227 290a 2020 2020  ref_tr,'r').    
+0008aa90: 7265 665f 636e 7420 3d20 300a 2020 2020  ref_cnt = 0.    
+0008aaa0: 666f 7220 6c69 6e65 2069 6e20 663a 0a20  for line in f:. 
+0008aab0: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
+0008aac0: 5d20 3d3d 2027 3e27 3a0a 2020 2020 2020  ] == '>':.      
+0008aad0: 2020 2020 2020 746e 5f72 6566 2e61 7070        tn_ref.app
+0008aae0: 656e 6428 6c69 6e65 5b31 3a2d 315d 290a  end(line[1:-1]).
+0008aaf0: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
+0008ab00: 636e 7420 2b3d 2031 0a20 2020 2066 2e63  cnt += 1.    f.c
+0008ab10: 6c6f 7365 2829 0a20 2020 2023 2070 7269  lose().    # pri
+0008ab20: 6e74 2827 4c65 6e3a 2025 692c 204e 753d  nt('Len: %i, Nu=
+0008ab30: 2025 6927 2025 2028 6c65 6e28 746e 292c   %i' % (len(tn),
+0008ab40: 206c 656e 2870 642e 756e 6971 7565 2874   len(pd.unique(t
+0008ab50: 6e29 2929 2c20 656e 643d 2727 2029 0a20  n))), end='' ). 
+0008ab60: 2020 200a 2020 2020 6966 2072 6566 203d     .    if ref =
+0008ab70: 3d20 303a 0a20 2020 2020 2020 2074 6e20  = 0:.        tn 
+0008ab80: 3d20 746e 5f69 6e0a 2020 2020 2020 2020  = tn_in.        
+0008ab90: 6e5f 6d61 785f 6361 6e64 7320 3d20 310a  n_max_cands = 1.
+0008aba0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008abb0: 2020 746e 203d 2074 6e5f 7265 660a 2020    tn = tn_ref.  
+0008abc0: 2020 2020 2020 6e5f 6d61 785f 6361 6e64        n_max_cand
+0008abd0: 7320 3d20 206d 785f 6e63 616e 640a 2020  s =  mx_ncand.  
+0008abe0: 2020 2020 2020 746d 7020 3d20 6361 6e64        tmp = cand
+0008abf0: 5f63 6e74 0a20 2020 2020 2020 2063 616e  _cnt.        can
+0008ac00: 645f 636e 7420 3d20 7265 665f 636e 740a  d_cnt = ref_cnt.
+0008ac10: 2020 2020 2020 2020 7265 665f 636e 7420          ref_cnt 
+0008ac20: 3d20 746d 700a 2020 2020 0a20 2020 2023  = tmp.    .    #
+0008ac30: 2320 6d61 6b65 2062 6c61 7374 2064 6220  # make blast db 
+0008ac40: 7769 7468 2069 6e70 7574 5f74 720a 2020  with input_tr.  
+0008ac50: 2020 6966 2070 6174 685f 746f 5f62 6c61    if path_to_bla
+0008ac60: 7374 2069 7320 4e6f 6e65 3a0a 2020 2020  st is None:.    
+0008ac70: 2020 2020 636d 6420 3d20 276d 616b 6562      cmd = 'makeb
+0008ac80: 6c61 7374 6462 202d 696e 2025 7320 2d64  lastdb -in %s -d
+0008ac90: 6274 7970 6520 2573 2720 2520 2869 6e70  btype %s' % (inp
+0008aca0: 745f 7472 2c20 6462 7479 7065 290a 2020  t_tr, dbtype).  
+0008acb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008acc0: 636d 6420 3d20 2725 732f 6d61 6b65 626c  cmd = '%s/makebl
+0008acd0: 6173 7464 6220 2d69 6e20 2573 202d 6462  astdb -in %s -db
+0008ace0: 7479 7065 2025 7327 2025 2028 7061 7468  type %s' % (path
+0008acf0: 5f74 6f5f 626c 6173 742c 2069 6e70 745f  _to_blast, inpt_
+0008ad00: 7472 2c20 6462 7479 7065 290a 2020 2020  tr, dbtype).    
+0008ad10: 7265 7320 3d20 7375 6270 726f 6365 7373  res = subprocess
+0008ad20: 2e63 6865 636b 5f6f 7574 7075 7428 636d  .check_output(cm
+0008ad30: 642c 2073 6865 6c6c 3d54 7275 6529 0a20  d, shell=True). 
+0008ad40: 2020 2023 2070 7269 6e74 2872 6573 2e64     # print(res.d
+0008ad50: 6563 6f64 6528 2777 696e 646f 7773 2d31  ecode('windows-1
+0008ad60: 3235 3227 2929 0a20 0a20 2020 2073 7472  252')). .    str
+0008ad70: 5f6f 7074 696f 6e20 3d20 272d 6f75 7466  _option = '-outf
+0008ad80: 6d74 2022 3620 7173 6571 6964 2073 7365  mt "6 qseqid sse
+0008ad90: 7169 6420 716c 656e 206c 656e 6774 6820  qid qlen length 
+0008ada0: 736c 656e 2071 7374 6172 7420 7165 6e64  slen qstart qend
+0008adb0: 2073 7374 6172 7420 7365 6e64 206e 6964   sstart send nid
+0008adc0: 656e 7420 6d69 736d 6174 6368 2067 6170  ent mismatch gap
+0008add0: 6f70 656e 2071 636f 7673 2071 636f 7668  open qcovs qcovh
+0008ade0: 7370 2062 6974 7363 6f72 6522 202d 6e75  sp bitscore" -nu
+0008adf0: 6d5f 7468 7265 6164 7320 3420 2d6d 6178  m_threads 4 -max
+0008ae00: 5f74 6172 6765 745f 7365 7173 2025 6927  _target_seqs %i'
+0008ae10: 2025 206e 5f6d 6178 5f63 616e 6473 0a0a   % n_max_cands..
+0008ae20: 2020 2020 6966 2064 6274 7970 6520 3d3d      if dbtype ==
+0008ae30: 2027 6e75 636c 273a 2070 7266 7820 3d20   'nucl': prfx = 
+0008ae40: 276e 270a 2020 2020 656c 7365 3a20 7072  'n'.    else: pr
+0008ae50: 6678 203d 2027 7027 0a20 2020 2020 2020  fx = 'p'.       
+0008ae60: 200a 2020 2020 6966 2070 6174 685f 746f   .    if path_to
+0008ae70: 5f62 6c61 7374 2069 7320 4e6f 6e65 3a0a  _blast is None:.
+0008ae80: 2020 2020 2020 2020 636d 6420 3d20 2762          cmd = 'b
+0008ae90: 6c61 7374 2573 2025 7320 2d64 6220 2573  last%s %s -db %s
+0008aea0: 202d 7175 6572 7920 2573 202d 6f75 7420   -query %s -out 
+0008aeb0: 2573 2e74 626c 7374 2720 2520 2870 7266  %s.tblst' % (prf
+0008aec0: 782c 2073 7472 5f6f 7074 696f 6e2c 2069  x, str_option, i
+0008aed0: 6e70 745f 7472 2c20 7265 665f 7472 2c20  npt_tr, ref_tr, 
+0008aee0: 666e 616d 6529 0a20 2020 2065 6c73 653a  fname).    else:
+0008aef0: 0a20 2020 2020 2020 2063 6d64 203d 2027  .        cmd = '
+0008af00: 2573 2f62 6c61 7374 2573 2025 7320 2d64  %s/blast%s %s -d
+0008af10: 6220 2573 202d 7175 6572 7920 2573 202d  b %s -query %s -
+0008af20: 6f75 7420 2573 2e74 626c 7374 2720 2520  out %s.tblst' % 
+0008af30: 2870 6174 685f 746f 5f62 6c61 7374 2c20  (path_to_blast, 
+0008af40: 7072 6678 2c20 7374 725f 6f70 7469 6f6e  prfx, str_option
+0008af50: 2c20 696e 7074 5f74 722c 2072 6566 5f74  , inpt_tr, ref_t
+0008af60: 722c 2066 6e61 6d65 290a 2020 2020 2020  r, fname).      
+0008af70: 2020 0a20 2020 2069 6620 7665 7262 6f73    .    if verbos
+0008af80: 653a 2070 7269 6e74 2822 5275 6e6e 696e  e: print("Runnin
+0008af90: 6720 426c 6173 742d 2573 2077 6974 6820  g Blast-%s with 
+0008afa0: 2569 2063 616e 642e 2025 6920 7265 662e  %i cand. %i ref.
+0008afb0: 202e 2e2e 2022 2025 2028 6462 7479 7065   ... " % (dbtype
+0008afc0: 5b30 5d2e 7570 7065 7228 292c 6361 6e64  [0].upper(),cand
+0008afd0: 5f63 6e74 2c20 7265 665f 636e 7429 2c20  _cnt, ref_cnt), 
+0008afe0: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
+0008aff0: 7565 293b 0a20 2020 2072 6573 203d 2073  ue);.    res = s
+0008b000: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
+0008b010: 6f75 7470 7574 2863 6d64 2c20 7368 656c  output(cmd, shel
+0008b020: 6c3d 5472 7565 290a 2020 2020 2320 7072  l=True).    # pr
+0008b030: 696e 7428 7265 732e 6465 636f 6465 2827  int(res.decode('
+0008b040: 7769 6e64 6f77 732d 3132 3532 2729 290a  windows-1252')).
+0008b050: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+0008b060: 7072 696e 7428 2764 6f6e 652e 2729 0a20  print('done.'). 
+0008b070: 2020 200a 2020 2020 6f73 2e72 656d 6f76     .    os.remov
+0008b080: 6528 2027 2573 2e25 7368 7227 2025 2028  e( '%s.%shr' % (
+0008b090: 696e 7074 5f74 722c 2070 7266 7829 2029  inpt_tr, prfx) )
+0008b0a0: 0a20 2020 206f 732e 7265 6d6f 7665 2820  .    os.remove( 
+0008b0b0: 2725 732e 2573 696e 2720 2520 2869 6e70  '%s.%sin' % (inp
+0008b0c0: 745f 7472 2c20 7072 6678 2920 290a 2020  t_tr, prfx) ).  
+0008b0d0: 2020 6f73 2e72 656d 6f76 6528 2027 2573    os.remove( '%s
+0008b0e0: 2e25 7373 7127 2025 2028 696e 7074 5f74  .%ssq' % (inpt_t
+0008b0f0: 722c 2070 7266 7829 2029 0a20 2020 0a20  r, prfx) ).   . 
+0008b100: 2020 2063 6f6c 6e61 6d65 7320 3d20 5b27     colnames = ['
+0008b110: 7169 6427 2c20 2773 6964 272c 2027 716c  qid', 'sid', 'ql
+0008b120: 656e 272c 2027 616c 656e 272c 2027 736c  en', 'alen', 'sl
+0008b130: 656e 272c 2027 7173 7461 7274 272c 2027  en', 'qstart', '
+0008b140: 7165 6e64 272c 2027 7373 7461 7274 272c  qend', 'sstart',
+0008b150: 2027 7365 6e64 272c 205c 0a20 2020 2020   'send', \.     
+0008b160: 2020 2020 2020 2020 2020 2027 6e69 6465             'nide
+0008b170: 6e74 272c 2027 6d69 736d 6174 6368 272c  nt', 'mismatch',
+0008b180: 2027 6761 706f 7065 6e27 2c20 2771 636f   'gapopen', 'qco
+0008b190: 7673 272c 2027 7163 6f76 6873 7027 2c20  vs', 'qcovhsp', 
+0008b1a0: 2762 6974 7363 6f72 6527 5d0a 2020 2020  'bitscore'].    
+0008b1b0: 7462 6c73 7420 3d20 2725 732e 7462 6c73  tblst = '%s.tbls
+0008b1c0: 7427 2025 2066 6e61 6d65 0a20 2020 2064  t' % fname.    d
+0008b1d0: 6620 3d20 7064 2e72 6561 645f 6373 7628  f = pd.read_csv(
+0008b1e0: 7462 6c73 742c 2068 6561 6465 7220 3d20  tblst, header = 
+0008b1f0: 2769 6e66 6572 272c 206e 616d 6573 203d  'infer', names =
+0008b200: 2063 6f6c 6e61 6d65 732c 2073 6570 3d27   colnames, sep='
+0008b210: 5c74 2729 0a20 2020 200a 2020 2020 6f73  \t').    .    os
+0008b220: 2e72 656d 6f76 6528 2027 2573 2720 2520  .remove( '%s' % 
+0008b230: 2874 626c 7374 2920 290a 2020 2020 0a20  (tblst) ).    . 
+0008b240: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
+0008b250: 7269 6e74 2827 4e2e 6361 6e64 3a20 2569  rint('N.cand: %i
+0008b260: 2c20 4e2e 7375 626a 6563 742e 756e 6971  , N.subject.uniq
+0008b270: 7565 3a20 2569 2720 2520 286c 656e 2874  ue: %i' % (len(t
+0008b280: 6e29 2c20 6c65 6e28 7064 2e75 6e69 7175  n), len(pd.uniqu
+0008b290: 6528 6466 5b27 7369 6427 5d29 2929 2029  e(df['sid']))) )
+0008b2a0: 0a0a 2020 2020 6466 5b27 7363 7667 275d  ..    df['scvg']
+0008b2b0: 203d 2064 665b 2761 6c65 6e27 5d2f 6466   = df['alen']/df
+0008b2c0: 5b27 736c 656e 275d 0a20 2020 2064 665b  ['slen'].    df[
+0008b2d0: 2771 6376 6727 5d20 3d20 6466 5b27 616c  'qcvg'] = df['al
+0008b2e0: 656e 275d 2f64 665b 2771 6c65 6e27 5d0a  en']/df['qlen'].
+0008b2f0: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
+0008b300: 7472 6172 6563 6f20 3d3d 2054 7275 653a  trareco == True:
+0008b310: 0a20 2020 2020 2020 2061 626e 5f65 203d  .        abn_e =
+0008b320: 205b 5d0a 2020 2020 2020 2020 7470 6d5f   [].        tpm_
+0008b330: 6520 3d20 5b5d 0a20 2020 2020 2020 2069  e = [].        i
+0008b340: 6672 6163 203d 205b 5d0a 2020 2020 2020  frac = [].      
+0008b350: 2020 7369 6478 203d 205b 5d0a 2020 2020    sidx = [].    
+0008b360: 2020 2020 675f 7369 7a65 203d 205b 5d0a      g_size = [].
+0008b370: 2020 2020 2020 2020 6e5f 6578 6f6e 7320          n_exons 
+0008b380: 3d20 5b5d 0a20 2020 2020 2020 2067 5f76  = [].        g_v
+0008b390: 6f6c 203d 205b 5d0a 2020 2020 2020 2020  ol = [].        
+0008b3a0: 6963 6e74 203d 205b 5d0a 2020 2020 2020  icnt = [].      
+0008b3b0: 2020 7374 726e 6420 3d20 5b5d 0a20 2020    strnd = [].   
+0008b3c0: 2020 2020 2063 646e 6720 3d20 5b5d 0a20       cdng = []. 
+0008b3d0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+0008b3e0: 7261 6e67 6528 6466 2e73 6861 7065 5b30  range(df.shape[0
+0008b3f0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0008b400: 2320 7320 3d20 273e 2573 5f43 6872 2573  # s = '>%s_Chr%s
+0008b410: 3a25 692d 2569 5f25 695f 2569 5f25 695f  :%i-%i_%i_%i_%i_
+0008b420: 4162 6e3a 2534 2e33 665f 5450 4d3a 2534  Abn:%4.3f_TPM:%4
+0008b430: 2e32 665f 4946 7261 633a 2533 2e32 665c  .2f_IFrac:%3.2f\
+0008b440: 6e27 200a 2020 2020 2020 2020 2020 2020  n' .            
+0008b450: 2320 2520 2874 722e 7072 6566 6978 2c20  # % (tr.prefix, 
+0008b460: 7472 2e63 6872 2c20 7472 2e73 7461 7274  tr.chr, tr.start
+0008b470: 2c20 7472 2e65 6e64 2c20 7472 2e67 6964  , tr.end, tr.gid
+0008b480: 782c 2074 722e 6772 705f 7369 7a65 2c20  x, tr.grp_size, 
+0008b490: 7472 2e69 636e 742c 2074 722e 6162 6e2c  tr.icnt, tr.abn,
+0008b4a0: 2074 722e 7470 6d2c 2074 722e 6973 6f5f   tr.tpm, tr.iso_
+0008b4b0: 6672 6163 290a 2020 2020 2020 2020 2020  frac).          
+0008b4c0: 2020 6864 7220 3d20 6466 5b73 5f69 645d    hdr = df[s_id]
+0008b4d0: 5b6b 5d2e 7370 6c69 7428 2720 2729 0a20  [k].split(' '). 
+0008b4e0: 2020 2020 2020 2020 2020 2069 7465 6d73             items
+0008b4f0: 203d 2068 6472 5b30 5d2e 7370 6c69 7428   = hdr[0].split(
+0008b500: 275f 2729 0a20 2020 2020 2020 2020 2020  '_').           
+0008b510: 2073 7472 6e64 2e61 7070 656e 6428 2069   strnd.append( i
+0008b520: 7465 6d73 5b32 5d29 0a20 2020 2020 2020  tems[2]).       
+0008b530: 2020 2020 2063 646e 672e 6170 7065 6e64       cdng.append
+0008b540: 2820 6974 656d 735b 335d 290a 2020 2020  ( items[3]).    
+0008b550: 2020 2020 2020 2020 7369 6478 2e61 7070          sidx.app
+0008b560: 656e 6428 2028 6974 656d 735b 345d 2920  end( (items[4]) 
+0008b570: 290a 2020 2020 2020 2020 2020 2020 675f  ).            g_
+0008b580: 7369 7a65 2e61 7070 656e 6428 2069 6e74  size.append( int
+0008b590: 2869 7465 6d73 5b35 5d29 2029 0a20 2020  (items[5]) ).   
+0008b5a0: 2020 2020 2020 2020 2069 636e 742e 6170           icnt.ap
+0008b5b0: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
+0008b5c0: 365d 2920 290a 2020 2020 2020 2020 2020  6]) ).          
+0008b5d0: 2020 7661 6c20 3d20 6974 656d 735b 375d    val = items[7]
+0008b5e0: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0008b5f0: 2020 2020 2020 2020 6162 6e5f 652e 6170          abn_e.ap
+0008b600: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
+0008b610: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
+0008b620: 2020 7661 6c20 3d20 6974 656d 735b 385d    val = items[8]
+0008b630: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0008b640: 2020 2020 2020 2020 7470 6d5f 652e 6170          tpm_e.ap
+0008b650: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
+0008b660: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
+0008b670: 2020 7661 6c20 3d20 6974 656d 735b 395d    val = items[9]
+0008b680: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0008b690: 2020 2020 2020 2020 6966 7261 632e 6170          ifrac.ap
+0008b6a0: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
+0008b6b0: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
+0008b6c0: 2020 7661 6c20 3d20 6974 656d 735b 3131    val = items[11
+0008b6d0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
+0008b6e0: 2020 2020 2020 2020 206e 5f65 786f 6e73           n_exons
+0008b6f0: 2e61 7070 656e 6428 2069 6e74 2876 616c  .append( int(val
+0008b700: 5b31 5d29 2029 0a20 2020 2020 2020 2020  [1]) ).         
+0008b710: 2020 2076 616c 203d 2069 7465 6d73 5b31     val = items[1
+0008b720: 325d 2e73 706c 6974 2827 3a27 290a 2020  2].split(':').  
+0008b730: 2020 2020 2020 2020 2020 675f 766f 6c2e            g_vol.
+0008b740: 6170 7065 6e64 2820 696e 7428 7661 6c5b  append( int(val[
+0008b750: 315d 2920 290a 2020 2020 656c 7365 3a0a  1]) ).    else:.
+0008b760: 2020 2020 2020 2020 6162 6e5f 6520 3d20          abn_e = 
+0008b770: 6e70 2e7a 6572 6f73 2864 662e 7368 6170  np.zeros(df.shap
+0008b780: 655b 305d 290a 2020 2020 2020 2020 7470  e[0]).        tp
+0008b790: 6d5f 6520 3d20 6e70 2e7a 6572 6f73 2864  m_e = np.zeros(d
+0008b7a0: 662e 7368 6170 655b 305d 290a 2020 2020  f.shape[0]).    
+0008b7b0: 2020 2020 6966 7261 6320 3d20 6e70 2e7a      ifrac = np.z
+0008b7c0: 6572 6f73 2864 662e 7368 6170 655b 305d  eros(df.shape[0]
+0008b7d0: 290a 2020 2020 2020 2020 7369 6478 203d  ).        sidx =
+0008b7e0: 206e 702e 6675 6c6c 2864 662e 7368 6170   np.full(df.shap
+0008b7f0: 655b 305d 2c20 2727 290a 2020 2020 2020  e[0], '').      
+0008b800: 2020 675f 7369 7a65 203d 206e 702e 7a65    g_size = np.ze
+0008b810: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
+0008b820: 0a20 2020 2020 2020 206e 5f65 786f 6e73  .        n_exons
+0008b830: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
+0008b840: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
+0008b850: 2067 5f76 6f6c 203d 206e 702e 7a65 726f   g_vol = np.zero
+0008b860: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
+0008b870: 2020 2020 2020 2069 636e 7420 3d20 6e70         icnt = np
+0008b880: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
+0008b890: 305d 290a 2020 2020 2020 2020 7374 726e  0]).        strn
+0008b8a0: 6420 3d20 6e70 2e7a 6572 6f73 2864 662e  d = np.zeros(df.
+0008b8b0: 7368 6170 655b 305d 290a 2020 2020 2020  shape[0]).      
+0008b8c0: 2020 6364 6e67 203d 206e 702e 7a65 726f    cdng = np.zero
+0008b8d0: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
+0008b8e0: 2020 2020 2020 200a 2020 2020 2327 2727         .    #'''
+0008b8f0: 0a20 2020 2072 6566 5f69 6e66 6f20 3d20  .    ref_info = 
+0008b900: 4661 6c73 650a 2020 2020 6966 206c 656e  False.    if len
+0008b910: 2864 665b 715f 6964 5d5b 305d 2e73 706c  (df[q_id][0].spl
+0008b920: 6974 2827 3a27 2929 203d 3d20 343a 200a  it(':')) == 4: .
+0008b930: 2020 2020 2020 2020 7265 665f 696e 666f          ref_info
+0008b940: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0008b950: 2320 7072 696e 7428 2752 6566 5f69 6e66  # print('Ref_inf
+0008b960: 6f20 6973 2074 7275 6527 290a 2020 2020  o is true').    
+0008b970: 2020 2020 0a20 2020 2069 6620 7265 665f      .    if ref_
+0008b980: 696e 666f 203d 3d20 5472 7565 3a0a 2020  info == True:.  
+0008b990: 2020 2020 2020 6769 6420 3d20 5b5d 0a20        gid = []. 
+0008b9a0: 2020 2020 2020 2063 7667 203d 205b 5d0a         cvg = [].
+0008b9b0: 2020 2020 2020 2020 6162 6e5f 7420 3d20          abn_t = 
+0008b9c0: 5b5d 0a20 2020 2020 2020 2074 706d 5f74  [].        tpm_t
+0008b9d0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+0008b9e0: 7220 6b20 696e 2072 616e 6765 2864 662e  r k in range(df.
+0008b9f0: 7368 6170 655b 305d 293a 0a20 2020 2020  shape[0]):.     
+0008ba00: 2020 2020 2020 2069 7465 6d73 203d 2064         items = d
+0008ba10: 665b 715f 6964 5d5b 6b5d 2e73 706c 6974  f[q_id][k].split
+0008ba20: 2827 3a27 290a 2020 2020 2020 2020 2020  (':').          
+0008ba30: 2020 6769 642e 6170 7065 6e64 2820 6974    gid.append( it
+0008ba40: 656d 735b 305d 2029 0a20 2020 2020 2020  ems[0] ).       
+0008ba50: 2020 2020 2063 7667 2e61 7070 656e 6428       cvg.append(
+0008ba60: 2066 6c6f 6174 2869 7465 6d73 5b31 5d29   float(items[1])
+0008ba70: 2029 0a20 2020 2020 2020 2020 2020 2061   ).            a
+0008ba80: 626e 5f74 2e61 7070 656e 6428 2066 6c6f  bn_t.append( flo
+0008ba90: 6174 2869 7465 6d73 5b32 5d29 2029 0a20  at(items[2]) ). 
+0008baa0: 2020 2020 2020 2020 2020 2074 706d 5f74             tpm_t
+0008bab0: 2e61 7070 656e 6428 2066 6c6f 6174 2869  .append( float(i
+0008bac0: 7465 6d73 5b33 5d29 2029 0a20 2020 2065  tems[3]) ).    e
+0008bad0: 6c73 653a 0a20 2020 2020 2020 2067 6964  lse:.        gid
+0008bae0: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
+0008baf0: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
+0008bb00: 2063 7667 203d 206e 702e 7a65 726f 7328   cvg = np.zeros(
+0008bb10: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
+0008bb20: 2020 2020 2061 626e 5f74 203d 206e 702e       abn_t = np.
+0008bb30: 7a65 726f 7328 6466 2e73 6861 7065 5b30  zeros(df.shape[0
+0008bb40: 5d29 0a20 2020 2020 2020 2074 706d 5f74  ]).        tpm_t
+0008bb50: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
+0008bb60: 6861 7065 5b30 5d29 0a0a 2020 2020 2327  hape[0])..    #'
+0008bb70: 2727 0a20 2020 2064 665b 2765 7870 5f63  ''.    df['exp_c
+0008bb80: 7667 275d 203d 2063 7667 0a20 2020 2064  vg'] = cvg.    d
+0008bb90: 665b 2761 626e 5f74 7275 6527 5d20 3d20  f['abn_true'] = 
+0008bba0: 6162 6e5f 740a 2020 2020 6466 5b27 6162  abn_t.    df['ab
+0008bbb0: 6e5f 6573 7427 5d20 3d20 6162 6e5f 650a  n_est'] = abn_e.
+0008bbc0: 2020 2020 6466 5b27 7470 6d5f 7472 7565      df['tpm_true
+0008bbd0: 275d 203d 2074 706d 5f74 0a20 2020 2064  '] = tpm_t.    d
+0008bbe0: 665b 2774 706d 5f65 7374 275d 203d 2074  f['tpm_est'] = t
+0008bbf0: 706d 5f65 0a20 2020 2064 665b 2767 6964  pm_e.    df['gid
+0008bc00: 7827 5d20 3d20 7369 6478 0a20 2020 2064  x'] = sidx.    d
+0008bc10: 665b 2769 6964 7827 5d20 3d20 6963 6e74  f['iidx'] = icnt
+0008bc20: 0a20 2020 2064 665b 2767 5f73 697a 6527  .    df['g_size'
+0008bc30: 5d20 3d20 675f 7369 7a65 0a20 2020 2064  ] = g_size.    d
+0008bc40: 665b 2769 736f 5f66 7261 6327 5d20 3d20  f['iso_frac'] = 
+0008bc50: 6966 7261 630a 2020 2020 6466 5b27 6e5f  ifrac.    df['n_
+0008bc60: 6578 6f6e 7327 5d20 3d20 6e5f 6578 6f6e  exons'] = n_exon
+0008bc70: 730a 2020 2020 6466 5b27 675f 766f 6c27  s.    df['g_vol'
+0008bc80: 5d20 3d20 675f 766f 6c0a 2020 2020 6466  ] = g_vol.    df
+0008bc90: 5b27 7374 7261 6e64 275d 203d 2073 7472  ['strand'] = str
+0008bca0: 6e64 0a20 2020 2064 665b 2743 5f6f 725f  nd.    df['C_or_
+0008bcb0: 4e27 5d20 3d20 6364 6e67 0a20 2020 2020  N'] = cdng.     
+0008bcc0: 2020 200a 2020 2020 6220 3d20 6466 5b71     .    b = df[q
+0008bcd0: 5f63 7667 5d20 3e3d 2030 2e38 0a20 2020  _cvg] >= 0.8.   
+0008bce0: 2064 665f 6e65 7720 3d20 6466 2e6c 6f63   df_new = df.loc
+0008bcf0: 5b62 2c3a 5d0a 2020 2020 6466 203d 2064  [b,:].    df = d
+0008bd00: 665f 6e65 770a 2020 2020 0a20 2020 2066  f_new.    .    f
+0008bd10: 756c 6c5f 6e61 6d65 7320 3d20 6466 5b71  ull_names = df[q
+0008bd20: 5f69 645d 202b 2064 665b 735f 6964 5d0a  _id] + df[s_id].
+0008bd30: 2020 2020 666e 7320 3d20 7064 2e75 6e69      fns = pd.uni
+0008bd40: 7175 6528 6675 6c6c 5f6e 616d 6573 290a  que(full_names).
+0008bd50: 2020 2020 6b20 3d20 300a 2020 2020 6466      k = 0.    df
+0008bd60: 5f6c 7374 203d 205b 5d0a 2020 2020 666f  _lst = [].    fo
+0008bd70: 7220 666e 2069 6e20 666e 733a 0a20 2020  r fn in fns:.   
+0008bd80: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
+0008bd90: 6675 6c6c 5f6e 616d 6573 203d 3d20 666e  full_names == fn
+0008bda0: 290a 2020 2020 2020 2020 6466 5f74 6d70  ).        df_tmp
+0008bdb0: 203d 2064 662e 696c 6f63 5b77 685d 0a20   = df.iloc[wh]. 
+0008bdc0: 2020 2020 2020 2071 6376 6720 3d20 6e70         qcvg = np
+0008bdd0: 2e61 7272 6179 2820 6466 5f74 6d70 5b71  .array( df_tmp[q
+0008bde0: 5f63 7667 5d20 290a 2020 2020 2020 2020  _cvg] ).        
+0008bdf0: 6f64 7220 3d20 7163 7667 2e61 7267 736f  odr = qcvg.argso
+0008be00: 7274 2829 0a20 2020 2020 2020 2064 665f  rt().        df_
+0008be10: 6c73 742e 6170 7065 6e64 2864 665f 746d  lst.append(df_tm
+0008be20: 702e 696c 6f63 5b6f 6472 5b2d 315d 5d29  p.iloc[odr[-1]])
+0008be30: 200a 2020 2020 2020 2020 6b20 2b3d 2031   .        k += 1
+0008be40: 0a0a 2020 2020 6966 206c 656e 2864 665f  ..    if len(df_
+0008be50: 6c73 7429 203e 2030 3a0a 2020 2020 2020  lst) > 0:.      
+0008be60: 2020 6466 5f73 656c 203d 2070 642e 4461    df_sel = pd.Da
+0008be70: 7461 4672 616d 6528 6466 5f6c 7374 290a  taFrame(df_lst).
+0008be80: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
+0008be90: 2020 2020 2074 7269 6e66 6f20 3d20 2725       trinfo = '%
+0008bea0: 735f 626c 6173 745f 7265 7375 6c74 2e74  s_blast_result.t
+0008beb0: 7376 2720 2520 666e 616d 650a 2020 2020  sv' % fname.    
+0008bec0: 2020 2020 6466 5f73 656c 2e74 6f5f 6373      df_sel.to_cs
+0008bed0: 7628 7472 696e 666f 2c20 6865 6164 6572  v(trinfo, header
+0008bee0: 3d54 7275 652c 2069 6e64 6578 3d46 616c  =True, index=Fal
+0008bef0: 7365 2c20 7365 703d 275c 7427 290a 2020  se, sep='\t').  
+0008bf00: 2020 2020 2020 2320 6966 2076 6572 626f        # if verbo
+0008bf10: 7365 3a20 7072 696e 7428 2754 7261 6e73  se: print('Trans
+0008bf20: 6372 6970 746f 6d65 2049 6e66 6f2e 2077  criptome Info. w
+0008bf30: 7269 7474 656e 2074 6f20 5c6e 2020 2025  ritten to \n   %
+0008bf40: 732e 2720 2520 7472 696e 666f 2029 0a0a  s.' % trinfo )..
+0008bf50: 2020 2020 2020 2020 6466 5f73 656c 203d          df_sel =
+0008bf60: 2070 642e 7265 6164 5f63 7376 2874 7269   pd.read_csv(tri
+0008bf70: 6e66 6f2c 2073 6570 3d27 5c74 2729 0a20  nfo, sep='\t'). 
+0008bf80: 2020 2020 2020 2023 2727 270a 0a20 2020         #'''..   
+0008bf90: 2020 2020 2064 665f 7065 7266 2c20 6466       df_perf, df
+0008bfa0: 5f73 656c 203d 2067 6574 5f70 6572 666f  _sel = get_perfo
+0008bfb0: 726d 616e 6365 2864 665f 7365 6c2c 2066  rmance(df_sel, f
+0008bfc0: 5f74 6f5f 7361 7665 3d66 6e61 6d65 2c20  _to_save=fname, 
+0008bfd0: 7265 6620 3d20 7265 662c 2076 6572 626f  ref = ref, verbo
+0008bfe0: 7365 3d76 6572 626f 7365 290a 2020 2020  se=verbose).    
+0008bff0: 2020 2020 6466 5f70 6572 665b 2770 7265      df_perf['pre
+0008c000: 6369 7369 6f6e 275d 203d 2072 6f75 6e64  cision'] = round
+0008c010: 2864 665f 7065 7266 5b27 4e5f 7265 636f  (df_perf['N_reco
+0008c020: 7665 7265 6427 5d2a 3130 302f 6361 6e64  vered']*100/cand
+0008c030: 5f63 6e74 2c31 290a 2020 2020 2020 2020  _cnt,1).        
+0008c040: 6466 5f70 6572 665b 2773 656e 7369 7469  df_perf['sensiti
+0008c050: 7669 7479 275d 203d 2072 6f75 6e64 2864  vity'] = round(d
+0008c060: 665f 7065 7266 5b27 4e5f 7265 636f 7665  f_perf['N_recove
+0008c070: 7265 6427 5d2a 3130 302f 7265 665f 636e  red']*100/ref_cn
+0008c080: 742c 3129 0a20 2020 2020 2020 2023 2069  t,1).        # i
+0008c090: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
+0008c0a0: 2864 665f 7065 7266 290a 2020 2020 2020  (df_perf).      
+0008c0b0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
+0008c0c0: 2074 7261 7265 636f 203d 3d20 5472 7565   trareco == True
+0008c0d0: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
+0008c0e0: 5f74 7220 3d20 6765 745f 696e 666f 5f66  _tr = get_info_f
+0008c0f0: 726f 6d5f 7472 5f6e 616d 6528 2074 6e20  rom_tr_name( tn 
+0008c100: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+0008c110: 5f74 725b 2764 6574 6563 7465 6427 5d20  _tr['detected'] 
+0008c120: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0008c130: 2020 2020 6466 5f74 722e 6c6f 635b 6c69      df_tr.loc[li
+0008c140: 7374 2864 665f 7365 6c5b 735f 6964 5d29  st(df_sel[s_id])
+0008c150: 2c27 6465 7465 6374 6564 275d 203d 2054  ,'detected'] = T
+0008c160: 7275 6520 0a20 2020 2020 2020 2020 2020  rue .           
+0008c170: 2064 665f 7472 5b71 5f6c 656e 5d20 3d20   df_tr[q_len] = 
+0008c180: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
+0008c190: 7220 6d2c 2073 6964 2069 6e20 656e 756d  r m, sid in enum
+0008c1a0: 6572 6174 6528 6466 5f73 656c 5b73 5f69  erate(df_sel[s_i
+0008c1b0: 645d 293a 0a20 2020 2020 2020 2020 2020  d]):.           
+0008c1c0: 2020 2020 2064 665f 7472 2e6c 6f63 5b73       df_tr.loc[s
+0008c1d0: 6964 2c71 5f6c 656e 5d20 3d20 6e70 2e72  id,q_len] = np.r
+0008c1e0: 6f75 6e64 2864 665f 7365 6c2e 696c 6f63  ound(df_sel.iloc
+0008c1f0: 5b6d 5d2e 716c 656e 290a 2020 2020 2020  [m].qlen).      
+0008c200: 2020 2020 2020 6466 5f74 725b 735f 7374        df_tr[s_st
+0008c210: 6172 745d 203d 2030 0a20 2020 2020 2020  art] = 0.       
+0008c220: 2020 2020 2023 2064 665f 7472 2e6c 6f63       # df_tr.loc
+0008c230: 5b6c 6973 7428 6466 5f73 656c 5b27 7369  [list(df_sel['si
+0008c240: 6427 5d29 2c27 7363 7667 275d 203d 2064  d']),'scvg'] = d
+0008c250: 665f 7365 6c2e 6c6f 635b 3a2c 2773 6376  f_sel.loc[:,'scv
+0008c260: 6727 5d20 0a20 2020 2020 2020 2020 2020  g'] .           
+0008c270: 2066 6f72 206d 2c20 7369 6420 696e 2065   for m, sid in e
+0008c280: 6e75 6d65 7261 7465 2864 665f 7365 6c5b  numerate(df_sel[
+0008c290: 735f 6964 5d29 3a0a 2020 2020 2020 2020  s_id]):.        
+0008c2a0: 2020 2020 2020 2020 6466 5f74 722e 6c6f          df_tr.lo
+0008c2b0: 635b 7369 642c 735f 7374 6172 745d 203d  c[sid,s_start] =
+0008c2c0: 206e 702e 726f 756e 6428 6466 5f73 656c   np.round(df_sel
+0008c2d0: 2e69 6c6f 635b 6d5d 2e73 7374 6172 7429  .iloc[m].sstart)
+0008c2e0: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+0008c2f0: 7472 5b73 5f65 6e64 5d20 3d20 300a 2020  tr[s_end] = 0.  
+0008c300: 2020 2020 2020 2020 2020 2320 6466 5f74            # df_t
+0008c310: 722e 6c6f 635b 6c69 7374 2864 665f 7365  r.loc[list(df_se
+0008c320: 6c5b 2773 6964 275d 292c 2773 6376 6727  l['sid']),'scvg'
+0008c330: 5d20 3d20 6466 5f73 656c 2e6c 6f63 5b3a  ] = df_sel.loc[:
+0008c340: 2c27 7363 7667 275d 200a 2020 2020 2020  ,'scvg'] .      
+0008c350: 2020 2020 2020 666f 7220 6d2c 2073 6964        for m, sid
+0008c360: 2069 6e20 656e 756d 6572 6174 6528 6466   in enumerate(df
+0008c370: 5f73 656c 5b73 5f69 645d 293a 0a20 2020  _sel[s_id]):.   
+0008c380: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+0008c390: 7472 2e6c 6f63 5b73 6964 2c73 5f65 6e64  tr.loc[sid,s_end
+0008c3a0: 5d20 3d20 6e70 2e72 6f75 6e64 2864 665f  ] = np.round(df_
+0008c3b0: 7365 6c2e 696c 6f63 5b6d 5d2e 7365 6e64  sel.iloc[m].send
+0008c3c0: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+0008c3d0: 5f74 7220 3d20 6466 5f74 722e 7265 7365  _tr = df_tr.rese
+0008c3e0: 745f 696e 6465 7828 290a 2020 2020 2020  t_index().      
+0008c3f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008c400: 2020 2020 6466 5f74 7220 3d20 4e6f 6e65      df_tr = None
+0008c410: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0008c420: 2020 2020 2020 7265 7475 726e 2864 665f        return(df_
+0008c430: 7065 7266 2c20 6466 5f73 656c 2c20 6466  perf, df_sel, df
+0008c440: 5f74 7229 0a20 2020 200a 2020 2020 656c  _tr).    .    el
+0008c450: 7365 3a0a 2020 2020 2020 2020 6966 2076  se:.        if v
+0008c460: 6572 626f 7365 3a20 7072 696e 7428 274e  erbose: print('N
+0008c470: 6f20 7472 2066 6f75 6e64 2e20 2729 0a20  o tr found. '). 
+0008c480: 2020 2020 2020 2072 6574 7572 6e28 4e6f         return(No
+0008c490: 6e65 2c4e 6f6e 652c 4e6f 6e65 290a 2020  ne,None,None).  
+0008c4a0: 2020 0a0a 2323 2323 2323 2323 2323 2323    ..############
+0008c4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c4d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008c4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c520: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
-0008c530: 6f6e 7320 746f 2028 3129 2073 656c 6563  ons to (1) selec
-0008c540: 7420 7370 6563 6966 6963 2063 6872 6d20  t specific chrm 
-0008c550: 616e 6420 2832 2920 6f6e 6c79 2063 6f64  and (2) only cod
-0008c560: 696e 6720 6765 6e65 7320 696e 2061 2047  ing genes in a G
-0008c570: 5446 0a23 2323 2323 2323 2323 2323 2323  TF.#############
+0008c4f0: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
+0008c500: 6f6e 7320 746f 2028 3129 2073 656c 6563  ons to (1) selec
+0008c510: 7420 7370 6563 6966 6963 2063 6872 6d20  t specific chrm 
+0008c520: 616e 6420 2832 2920 6f6e 6c79 2063 6f64  and (2) only cod
+0008c530: 696e 6720 6765 6e65 7320 696e 2061 2047  ing genes in a G
+0008c540: 5446 0a23 2323 2323 2323 2323 2323 2323  TF.#############
+0008c550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008c580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c5a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c5b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c5c0: 2323 2323 230a 0a64 6566 2073 6f72 745f  #####..def sort_
-0008c5d0: 6774 665f 6c69 6e65 735f 6c73 7428 6774  gtf_lines_lst(gt
-0008c5e0: 665f 6c69 6e65 735f 6c73 7429 3a0a 2020  f_lines_lst):.  
-0008c5f0: 2020 0a20 2020 2063 6872 7320 3d20 5b5d    .    chrs = []
-0008c600: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
-0008c610: 6e20 6774 665f 6c69 6e65 735f 6c73 743a  n gtf_lines_lst:
-0008c620: 0a20 2020 2020 2020 2066 6972 7374 5f6c  .        first_l
-0008c630: 696e 6520 3d20 6c69 6e65 735b 305d 0a20  ine = lines[0]. 
-0008c640: 2020 2020 2020 2063 6872 732e 6170 7065         chrs.appe
-0008c650: 6e64 2866 6972 7374 5f6c 696e 652e 6368  nd(first_line.ch
-0008c660: 7229 0a0a 2020 2020 6368 725f 7365 7420  r)..    chr_set 
-0008c670: 3d20 6c69 7374 2873 6574 2863 6872 7329  = list(set(chrs)
-0008c680: 290a 2020 2020 6368 725f 7365 742e 736f  ).    chr_set.so
-0008c690: 7274 2829 0a20 2020 2063 6872 7320 3d20  rt().    chrs = 
-0008c6a0: 6e70 2e61 7272 6179 2863 6872 7329 0a0a  np.array(chrs)..
-0008c6b0: 2020 2020 6774 665f 6c73 745f 6e65 7720      gtf_lst_new 
-0008c6c0: 3d20 5b5d 0a20 2020 2066 6f72 2063 2069  = [].    for c i
-0008c6d0: 6e20 6368 725f 7365 743a 0a20 2020 2020  n chr_set:.     
-0008c6e0: 2020 2077 6820 3d20 7768 6963 6828 6368     wh = which(ch
-0008c6f0: 7273 203d 3d20 6329 0a20 2020 2020 2020  rs == c).       
-0008c700: 2070 7320 3d20 6e70 2e61 7272 6179 2820   ps = np.array( 
-0008c710: 5b67 7466 5f6c 696e 6573 5f6c 7374 5b77  [gtf_lines_lst[w
-0008c720: 5d5b 305d 2e73 7461 7274 2066 6f72 2077  ][0].start for w
-0008c730: 2069 6e20 7768 5d20 290a 2020 2020 2020   in wh] ).      
-0008c740: 2020 6f64 7232 203d 2070 732e 6172 6773    odr2 = ps.args
-0008c750: 6f72 7428 290a 2020 2020 2020 2020 666f  ort().        fo
-0008c760: 7220 6f20 696e 206f 6472 323a 0a20 2020  r o in odr2:.   
-0008c770: 2020 2020 2020 2020 2077 203d 2077 685b           w = wh[
-0008c780: 6f5d 0a20 2020 2020 2020 2020 2020 2067  o].            g
-0008c790: 7466 5f6c 7374 5f6e 6577 2e61 7070 656e  tf_lst_new.appen
-0008c7a0: 6428 6774 665f 6c69 6e65 735f 6c73 745b  d(gtf_lines_lst[
-0008c7b0: 775d 290a 2020 2020 2020 2020 0a20 2020  w]).        .   
-0008c7c0: 2072 6574 7572 6e20 6774 665f 6c73 745f   return gtf_lst_
-0008c7d0: 6e65 770a 0a0a 6465 6620 7365 6c65 6374  new...def select
-0008c7e0: 5f63 6f64 696e 675f 6765 6e65 735f 6672  _coding_genes_fr
-0008c7f0: 6f6d 5f67 7466 5f66 696c 6528 6774 665f  om_gtf_file(gtf_
-0008c800: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
-0008c810: 6529 3a0a 0a20 2020 2066 6e73 203d 2067  e):..    fns = g
-0008c820: 7466 5f66 696c 652e 7370 6c69 7428 272e  tf_file.split('.
-0008c830: 2729 5b3a 2d31 5d0a 2020 2020 666e 616d  ')[:-1].    fnam
-0008c840: 6520 3d20 2727 0a20 2020 2066 6f72 206b  e = ''.    for k
-0008c850: 2c20 666e 2069 6e20 656e 756d 6572 6174  , fn in enumerat
-0008c860: 6528 666e 7329 3a0a 2020 2020 2020 2020  e(fns):.        
-0008c870: 6966 206b 203e 2030 3a0a 2020 2020 2020  if k > 0:.      
-0008c880: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
-0008c890: 616d 6520 2b20 272e 270a 2020 2020 2020  ame + '.'.      
-0008c8a0: 2020 666e 616d 6520 3d20 666e 616d 6520    fname = fname 
-0008c8b0: 2b20 666e 0a20 2020 200a 2020 2020 6774  + fn.    .    gt
-0008c8c0: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
-0008c8d0: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
-0008c8e0: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
-0008c8f0: 3d20 5472 7565 290a 2020 2020 0a20 2020  = True).    .   
-0008c900: 2062 6173 655f 6364 7320 3d20 6765 745f   base_cds = get_
-0008c910: 6261 7365 5f63 6473 5f66 726f 6d5f 6774  base_cds_from_gt
-0008c920: 665f 6c69 6e65 7328 6774 665f 6c69 6e65  f_lines(gtf_line
-0008c930: 7329 0a20 2020 2069 6620 6261 7365 5f63  s).    if base_c
-0008c940: 6473 203c 2030 3a0a 2020 2020 2020 2020  ds < 0:.        
-0008c950: 7072 696e 7428 2749 4e46 4f3a 204e 6f20  print('INFO: No 
-0008c960: 636f 6469 6e67 2069 6e66 6f72 6d61 7469  coding informati
-0008c970: 6f6e 2070 726f 7669 6465 6420 696e 2074  on provided in t
-0008c980: 6865 2047 5446 2f47 4646 2e27 290a 2020  he GTF/GFF.').  
-0008c990: 2020 0a20 2020 2067 7466 5f6c 696e 6573    .    gtf_lines
-0008c9a0: 5f6c 7374 203d 2070 6172 7365 5f67 7466  _lst = parse_gtf
-0008c9b0: 5f6c 696e 6573 5f61 6e64 5f73 706c 6974  _lines_and_split
-0008c9c0: 5f69 6e74 6f5f 6765 6e65 7328 2067 7466  _into_genes( gtf
-0008c9d0: 5f6c 696e 6573 2029 0a20 2020 2067 656e  _lines ).    gen
-0008c9e0: 6f6d 6520 3d20 6c6f 6164 5f67 656e 6f6d  ome = load_genom
-0008c9f0: 6528 6765 6e6f 6d65 5f66 696c 6529 0a20  e(genome_file). 
-0008ca00: 2020 2063 6872 7320 3d20 6765 6e6f 6d65     chrs = genome
-0008ca10: 2e6b 6579 7328 290a 0a20 2020 2067 7466  .keys()..    gtf
-0008ca20: 5f6c 696e 6573 5f6c 7374 5f6e 6577 203d  _lines_lst_new =
-0008ca30: 205b 5d0a 2020 2020 6363 6e74 203d 2030   [].    ccnt = 0
-0008ca40: 0a20 2020 2067 636e 7420 3d20 300a 2020  .    gcnt = 0.  
-0008ca50: 2020 666f 7220 6b2c 2067 6c69 6e65 7320    for k, glines 
-0008ca60: 696e 2065 6e75 6d65 7261 7465 2867 7466  in enumerate(gtf
-0008ca70: 5f6c 696e 6573 5f6c 7374 293a 0a0a 2020  _lines_lst):..  
-0008ca80: 2020 2020 2020 6966 2020 676c 696e 6573        if  glines
-0008ca90: 5b30 5d2e 6368 7220 696e 2063 6872 733a  [0].chr in chrs:
-0008caa0: 0a20 2020 2020 2020 2020 2020 2074 725f  .            tr_
-0008cab0: 6c69 6e65 735f 6c73 7420 3d20 7061 7273  lines_lst = pars
-0008cac0: 655f 6774 665f 6c69 6e65 735f 616e 645f  e_gtf_lines_and_
-0008cad0: 7370 6c69 745f 696e 746f 5f67 656e 6573  split_into_genes
-0008cae0: 2820 676c 696e 6573 2c20 2774 7261 6e73  ( glines, 'trans
-0008caf0: 6372 6970 7427 2029 0a20 2020 2020 2020  cript' ).       
-0008cb00: 2020 2020 206c 696e 6573 5f6e 6577 203d       lines_new =
-0008cb10: 205b 5d0a 0a20 2020 2020 2020 2020 2020   []..           
-0008cb20: 2066 6f72 206c 696e 6573 2069 6e20 7472   for lines in tr
-0008cb30: 5f6c 696e 6573 5f6c 7374 3a0a 2020 2020  _lines_lst:.    
-0008cb40: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-0008cb50: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0008cb60: 2020 2020 2020 636e 7420 3d20 5b30 2c30        cnt = [0,0
-0008cb70: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0008cb80: 2020 666f 7220 6774 666c 696e 6520 696e    for gtfline in
-0008cb90: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
-0008cba0: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-0008cbb0: 7466 6c69 6e65 2e66 6561 7475 7265 203d  tfline.feature =
-0008cbc0: 3d20 2773 7461 7274 5f63 6f64 6f6e 273a  = 'start_codon':
-0008cbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008cbe0: 2020 2020 2020 2020 2063 6e74 5b30 5d20           cnt[0] 
-0008cbf0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-0008cc00: 2020 2020 2020 2020 2069 6620 6774 666c           if gtfl
-0008cc10: 696e 652e 6665 6174 7572 6520 3d3d 2027  ine.feature == '
-0008cc20: 7374 6f70 5f63 6f64 6f6e 273a 0a20 2020  stop_codon':.   
-0008cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cc40: 2020 2020 2063 6e74 5b31 5d20 2b3d 2031       cnt[1] += 1
-0008cc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008cc60: 2020 2020 2069 6620 2863 6e74 5b30 5d20       if (cnt[0] 
-0008cc70: 3e20 3029 2026 2028 636e 745b 315d 203e  > 0) & (cnt[1] >
-0008cc80: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
-0008cc90: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-0008cca0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0008ccb0: 2020 2020 2020 2020 2020 2020 2020 6363                cc
-0008ccc0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cce0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0008ccf0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0008cd00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0008cd10: 6620 623a 206c 696e 6573 5f6e 6577 203d  f b: lines_new =
-0008cd20: 206c 696e 6573 5f6e 6577 202b 206c 696e   lines_new + lin
-0008cd30: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0008cd40: 2020 2067 636e 7420 2b3d 2031 0a20 2020     gcnt += 1.   
-0008cd50: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0008cd60: 2020 2020 2020 6966 206c 656e 286c 696e        if len(lin
-0008cd70: 6573 5f6e 6577 2920 3e20 303a 0a20 2020  es_new) > 0:.   
-0008cd80: 2020 2020 2020 2020 2020 2020 2067 7466               gtf
-0008cd90: 5f6c 696e 6573 5f6c 7374 5f6e 6577 2e61  _lines_lst_new.a
-0008cda0: 7070 656e 6428 6c69 6e65 735f 6e65 7729  ppend(lines_new)
-0008cdb0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0008cdc0: 2020 2020 2020 6966 206b 2531 3030 203d        if k%100 =
-0008cdd0: 3d20 303a 2070 7269 6e74 2827 5c72 7061  = 0: print('\rpa
-0008cde0: 7273 696e 6720 2e2e 2025 692f 2569 2028  rsing .. %i/%i (
-0008cdf0: 2569 2f25 6929 2720 2520 286b 2c20 6c65  %i/%i)' % (k, le
-0008ce00: 6e28 6774 665f 6c69 6e65 735f 6c73 7429  n(gtf_lines_lst)
-0008ce10: 2c20 6363 6e74 2c20 6763 6e74 292c 2065  , ccnt, gcnt), e
-0008ce20: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
-0008ce30: 7275 6520 290a 0a20 2020 2070 7269 6e74  rue )..    print
-0008ce40: 2827 5c72 7061 7273 696e 6720 2e2e 2025  ('\rparsing .. %
-0008ce50: 692f 2569 2028 2569 2f25 6929 2720 2520  i/%i (%i/%i)' % 
-0008ce60: 286b 2c20 6c65 6e28 6774 665f 6c69 6e65  (k, len(gtf_line
-0008ce70: 735f 6c73 7429 2c20 6363 6e74 2c20 6763  s_lst), ccnt, gc
-0008ce80: 6e74 292c 2066 6c75 7368 203d 2054 7275  nt), flush = Tru
-0008ce90: 6520 290a 2020 2020 7072 696e 7428 2753  e ).    print('S
-0008cea0: 6f72 7469 6e67 202e 2e20 272c 2065 6e64  orting .. ', end
-0008ceb0: 3d27 2729 0a20 2020 2067 7466 5f6c 696e  ='').    gtf_lin
-0008cec0: 6573 5f6c 7374 5f6e 6577 203d 2073 6f72  es_lst_new = sor
-0008ced0: 745f 6774 665f 6c69 6e65 735f 6c73 7428  t_gtf_lines_lst(
-0008cee0: 6774 665f 6c69 6e65 735f 6c73 745f 6e65  gtf_lines_lst_ne
-0008cef0: 7729 0a20 2020 2070 7269 6e74 2827 5c72  w).    print('\r
-0008cf00: 536f 7274 696e 6720 2e2e 2064 6f6e 6527  Sorting .. done'
-0008cf10: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
-0008cf20: 2020 2067 7466 5f6c 696e 6573 5f6e 6577     gtf_lines_new
-0008cf30: 203d 205b 5d0a 2020 2020 666f 7220 6c69   = [].    for li
-0008cf40: 6e65 7320 696e 2067 7466 5f6c 696e 6573  nes in gtf_lines
-0008cf50: 5f6c 7374 5f6e 6577 3a0a 2020 2020 2020  _lst_new:.      
-0008cf60: 2020 6774 665f 6c69 6e65 735f 6e65 7720    gtf_lines_new 
-0008cf70: 3d20 6774 665f 6c69 6e65 735f 6e65 7720  = gtf_lines_new 
-0008cf80: 2b20 6c69 6e65 730a 2020 2020 2020 2020  + lines.        
-0008cf90: 0a20 2020 2066 6e61 6d65 203d 2066 6e61  .    fname = fna
-0008cfa0: 6d65 202b 2027 5f63 6473 2e67 7466 270a  me + '_cds.gtf'.
-0008cfb0: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
-0008cfc0: 6720 2e2e 2027 2c20 656e 643d 2727 290a  g .. ', end='').
-0008cfd0: 2020 2020 7361 7665 5f67 7466 2820 666e      save_gtf( fn
-0008cfe0: 616d 652c 2067 7466 5f6c 696e 6573 5f6e  ame, gtf_lines_n
-0008cff0: 6577 2c20 6864 725f 6c69 6e65 7320 290a  ew, hdr_lines ).
-0008d000: 2020 2020 7072 696e 7428 275c 7253 6176      print('\rSav
-0008d010: 696e 6720 2e2e 2064 6f6e 6527 290a 2020  ing .. done').  
-0008d020: 2020 0a20 2020 2072 6574 7572 6e20 666e    .    return fn
-0008d030: 616d 650a 2020 2020 0a0a 6465 6620 7365  ame.    ..def se
-0008d040: 6c65 6374 5f63 6872 5f66 726f 6d5f 6774  lect_chr_from_gt
-0008d050: 665f 6669 6c65 2867 7466 5f66 696c 652c  f_file(gtf_file,
-0008d060: 2063 6872 6d73 203d 205b 5d29 3a0a 0a20   chrms = []):.. 
-0008d070: 2020 2066 6e73 203d 2067 7466 5f66 696c     fns = gtf_fil
-0008d080: 652e 7370 6c69 7428 272e 2729 5b3a 2d31  e.split('.')[:-1
-0008d090: 5d0a 2020 2020 666e 616d 6520 3d20 2727  ].    fname = ''
-0008d0a0: 0a20 2020 2066 6f72 206b 2c20 666e 2069  .    for k, fn i
-0008d0b0: 6e20 656e 756d 6572 6174 6528 666e 7329  n enumerate(fns)
-0008d0c0: 3a0a 2020 2020 2020 2020 6966 206b 203e  :.        if k >
-0008d0d0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0008d0e0: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
-0008d0f0: 272e 270a 2020 2020 2020 2020 666e 616d  '.'.        fnam
-0008d100: 6520 3d20 666e 616d 6520 2b20 666e 0a20  e = fname + fn. 
-0008d110: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
-0008d120: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
-0008d130: 6f61 645f 6774 6628 6774 665f 6669 6c65  oad_gtf(gtf_file
-0008d140: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
-0008d150: 290a 2020 2020 0a20 2020 2067 7466 5f6c  ).    .    gtf_l
-0008d160: 696e 6573 5f6c 7374 203d 2070 6172 7365  ines_lst = parse
-0008d170: 5f67 7466 5f6c 696e 6573 5f61 6e64 5f73  _gtf_lines_and_s
-0008d180: 706c 6974 5f69 6e74 6f5f 6765 6e65 7328  plit_into_genes(
-0008d190: 2067 7466 5f6c 696e 6573 2029 0a0a 2020   gtf_lines )..  
-0008d1a0: 2020 6774 665f 6c69 6e65 735f 6c73 745f    gtf_lines_lst_
-0008d1b0: 6e65 7720 3d20 5b5d 0a20 2020 2063 636e  new = [].    ccn
-0008d1c0: 7420 3d20 300a 2020 2020 6763 6e74 203d  t = 0.    gcnt =
-0008d1d0: 2030 0a20 2020 2069 6620 6973 696e 7374   0.    if isinst
-0008d1e0: 616e 6365 2863 6872 6d73 2c20 7374 7229  ance(chrms, str)
-0008d1f0: 3a0a 2020 2020 2020 2020 666f 7220 6b2c  :.        for k,
-0008d200: 206c 696e 6573 2069 6e20 656e 756d 6572   lines in enumer
-0008d210: 6174 6528 6774 665f 6c69 6e65 735f 6c73  ate(gtf_lines_ls
-0008d220: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0008d230: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
-0008d240: 2020 2020 2020 6966 206c 696e 6573 5b30        if lines[0
-0008d250: 5d2e 6368 7220 3d3d 2063 6872 6d3a 200a  ].chr == chrm: .
-0008d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d270: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
-0008d280: 2020 2020 2020 2020 2063 636e 7420 2b3d           ccnt +=
-0008d290: 2031 0a20 2020 2020 2020 2020 2020 2067   1.            g
-0008d2a0: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
-0008d2b0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0008d2c0: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
-0008d2d0: 2070 7269 6e74 2827 5c72 7061 7273 696e   print('\rparsin
-0008d2e0: 6720 2e2e 2025 692f 2569 2028 2569 2f25  g .. %i/%i (%i/%
-0008d2f0: 6929 2720 2520 286b 2c20 6c65 6e28 6774  i)' % (k, len(gt
-0008d300: 665f 6c69 6e65 735f 6c73 7429 2c20 6363  f_lines_lst), cc
-0008d310: 6e74 2c20 6763 6e74 292c 2065 6e64 3d27  nt, gcnt), end='
-0008d320: 272c 2066 6c75 7368 203d 2054 7275 6520  ', flush = True 
-0008d330: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0008d340: 2062 3a20 0a20 2020 2020 2020 2020 2020   b: .           
-0008d350: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
-0008d360: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
-0008d370: 6e65 7329 0a20 2020 2065 6c73 653a 0a20  nes).    else:. 
-0008d380: 2020 2020 2020 2066 6f72 2063 6872 6d20         for chrm 
-0008d390: 696e 2063 6872 6d73 3a0a 2020 2020 2020  in chrms:.      
-0008d3a0: 2020 2020 2020 666f 7220 6b2c 206c 696e        for k, lin
-0008d3b0: 6573 2069 6e20 656e 756d 6572 6174 6528  es in enumerate(
-0008d3c0: 6774 665f 6c69 6e65 735f 6c73 7429 3a0a  gtf_lines_lst):.
-0008d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d3e0: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
-0008d3f0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
-0008d400: 6573 5b30 5d2e 6368 7220 3d3d 2063 6872  es[0].chr == chr
-0008d410: 6d3a 200a 2020 2020 2020 2020 2020 2020  m: .            
-0008d420: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
-0008d430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d440: 2020 2020 2063 636e 7420 2b3d 2031 0a20       ccnt += 1. 
-0008d450: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0008d460: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
-0008d470: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0008d480: 2020 2020 2020 2020 2020 6966 206b 2531            if k%1
-0008d490: 3030 203d 3d20 303a 2070 7269 6e74 2827  00 == 0: print('
-0008d4a0: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
-0008d4b0: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
-0008d4c0: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
-0008d4d0: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
-0008d4e0: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
-0008d4f0: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
-0008d500: 2020 2020 2020 2020 2020 6966 2062 3a20            if b: 
-0008d510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d520: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
-0008d530: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
-0008d540: 6e65 7329 0a20 2020 2020 2020 2063 6872  nes).        chr
-0008d550: 6d20 3d20 6368 726d 735b 305d 0a20 2020  m = chrms[0].   
-0008d560: 2020 2020 2066 6f72 2063 2069 6e20 6368       for c in ch
-0008d570: 726d 735b 313a 5d3a 0a20 2020 2020 2020  rms[1:]:.       
-0008d580: 2020 2020 2063 6872 6d20 3d20 6368 726d       chrm = chrm
-0008d590: 202b 2027 2c25 7327 2025 2063 0a20 2020   + ',%s' % c.   
-0008d5a0: 2020 2020 2020 2020 200a 2020 2020 7072           .    pr
-0008d5b0: 696e 7428 275c 7270 6172 7369 6e67 202e  int('\rparsing .
-0008d5c0: 2e20 646f 6e65 2025 692f 2569 2028 2569  . done %i/%i (%i
-0008d5d0: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
-0008d5e0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
-0008d5f0: 6363 6e74 2c20 6763 6e74 292c 2066 6c75  ccnt, gcnt), flu
-0008d600: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
-0008d610: 0a20 2020 2070 7269 6e74 2827 536f 7274  .    print('Sort
-0008d620: 696e 6720 2e2e 2027 2c20 656e 643d 2727  ing .. ', end=''
-0008d630: 290a 2020 2020 6774 665f 6c69 6e65 735f  ).    gtf_lines_
-0008d640: 6c73 745f 6e65 7720 3d20 736f 7274 5f67  lst_new = sort_g
-0008d650: 7466 5f6c 696e 6573 5f6c 7374 2867 7466  tf_lines_lst(gtf
-0008d660: 5f6c 696e 6573 5f6c 7374 5f6e 6577 290a  _lines_lst_new).
-0008d670: 2020 2020 7072 696e 7428 275c 7253 6f72      print('\rSor
-0008d680: 7469 6e67 202e 2e20 646f 6e65 2729 0a20  ting .. done'). 
-0008d690: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0008d6a0: 6774 665f 6c69 6e65 735f 6e65 7720 3d20  gtf_lines_new = 
-0008d6b0: 5b5d 0a20 2020 2066 6f72 206c 696e 6573  [].    for lines
-0008d6c0: 2069 6e20 6774 665f 6c69 6e65 735f 6c73   in gtf_lines_ls
-0008d6d0: 745f 6e65 773a 0a20 2020 2020 2020 2067  t_new:.        g
-0008d6e0: 7466 5f6c 696e 6573 5f6e 6577 203d 2067  tf_lines_new = g
-0008d6f0: 7466 5f6c 696e 6573 5f6e 6577 202b 206c  tf_lines_new + l
-0008d700: 696e 6573 0a20 2020 200a 2020 2020 7072  ines.    .    pr
-0008d710: 696e 7428 2753 6176 696e 6720 2e2e 2027  int('Saving .. '
-0008d720: 2c20 656e 643d 2727 290a 2020 2020 666e  , end='').    fn
-0008d730: 616d 6520 3d20 666e 616d 6520 2b20 275f  ame = fname + '_
-0008d740: 7365 6c5f 2573 2e67 7466 2720 2520 6368  sel_%s.gtf' % ch
-0008d750: 726d 0a20 2020 2073 6176 655f 6774 6628  rm.    save_gtf(
-0008d760: 2066 6e61 6d65 2c20 6774 665f 6c69 6e65   fname, gtf_line
-0008d770: 735f 6e65 772c 2068 6472 5f6c 696e 6573  s_new, hdr_lines
-0008d780: 2029 0a20 2020 2070 7269 6e74 2827 5c72   ).    print('\r
-0008d790: 5361 7669 6e67 202e 2e20 646f 6e65 2729  Saving .. done')
-0008d7a0: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
-0008d7b0: 2066 6e61 6d65 0a20 2020 200a 0a23 2323   fname.    ..###
+0008c590: 2323 2323 230a 0a64 6566 2073 6f72 745f  #####..def sort_
+0008c5a0: 6774 665f 6c69 6e65 735f 6c73 7428 6774  gtf_lines_lst(gt
+0008c5b0: 665f 6c69 6e65 735f 6c73 7429 3a0a 2020  f_lines_lst):.  
+0008c5c0: 2020 0a20 2020 2063 6872 7320 3d20 5b5d    .    chrs = []
+0008c5d0: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
+0008c5e0: 6e20 6774 665f 6c69 6e65 735f 6c73 743a  n gtf_lines_lst:
+0008c5f0: 0a20 2020 2020 2020 2066 6972 7374 5f6c  .        first_l
+0008c600: 696e 6520 3d20 6c69 6e65 735b 305d 0a20  ine = lines[0]. 
+0008c610: 2020 2020 2020 2063 6872 732e 6170 7065         chrs.appe
+0008c620: 6e64 2866 6972 7374 5f6c 696e 652e 6368  nd(first_line.ch
+0008c630: 7229 0a0a 2020 2020 6368 725f 7365 7420  r)..    chr_set 
+0008c640: 3d20 6c69 7374 2873 6574 2863 6872 7329  = list(set(chrs)
+0008c650: 290a 2020 2020 6368 725f 7365 742e 736f  ).    chr_set.so
+0008c660: 7274 2829 0a20 2020 2063 6872 7320 3d20  rt().    chrs = 
+0008c670: 6e70 2e61 7272 6179 2863 6872 7329 0a0a  np.array(chrs)..
+0008c680: 2020 2020 6774 665f 6c73 745f 6e65 7720      gtf_lst_new 
+0008c690: 3d20 5b5d 0a20 2020 2066 6f72 2063 2069  = [].    for c i
+0008c6a0: 6e20 6368 725f 7365 743a 0a20 2020 2020  n chr_set:.     
+0008c6b0: 2020 2077 6820 3d20 7768 6963 6828 6368     wh = which(ch
+0008c6c0: 7273 203d 3d20 6329 0a20 2020 2020 2020  rs == c).       
+0008c6d0: 2070 7320 3d20 6e70 2e61 7272 6179 2820   ps = np.array( 
+0008c6e0: 5b67 7466 5f6c 696e 6573 5f6c 7374 5b77  [gtf_lines_lst[w
+0008c6f0: 5d5b 305d 2e73 7461 7274 2066 6f72 2077  ][0].start for w
+0008c700: 2069 6e20 7768 5d20 290a 2020 2020 2020   in wh] ).      
+0008c710: 2020 6f64 7232 203d 2070 732e 6172 6773    odr2 = ps.args
+0008c720: 6f72 7428 290a 2020 2020 2020 2020 666f  ort().        fo
+0008c730: 7220 6f20 696e 206f 6472 323a 0a20 2020  r o in odr2:.   
+0008c740: 2020 2020 2020 2020 2077 203d 2077 685b           w = wh[
+0008c750: 6f5d 0a20 2020 2020 2020 2020 2020 2067  o].            g
+0008c760: 7466 5f6c 7374 5f6e 6577 2e61 7070 656e  tf_lst_new.appen
+0008c770: 6428 6774 665f 6c69 6e65 735f 6c73 745b  d(gtf_lines_lst[
+0008c780: 775d 290a 2020 2020 2020 2020 0a20 2020  w]).        .   
+0008c790: 2072 6574 7572 6e20 6774 665f 6c73 745f   return gtf_lst_
+0008c7a0: 6e65 770a 0a0a 6465 6620 7365 6c65 6374  new...def select
+0008c7b0: 5f63 6f64 696e 675f 6765 6e65 735f 6672  _coding_genes_fr
+0008c7c0: 6f6d 5f67 7466 5f66 696c 6528 6774 665f  om_gtf_file(gtf_
+0008c7d0: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
+0008c7e0: 6529 3a0a 0a20 2020 2066 6e73 203d 2067  e):..    fns = g
+0008c7f0: 7466 5f66 696c 652e 7370 6c69 7428 272e  tf_file.split('.
+0008c800: 2729 5b3a 2d31 5d0a 2020 2020 666e 616d  ')[:-1].    fnam
+0008c810: 6520 3d20 2727 0a20 2020 2066 6f72 206b  e = ''.    for k
+0008c820: 2c20 666e 2069 6e20 656e 756d 6572 6174  , fn in enumerat
+0008c830: 6528 666e 7329 3a0a 2020 2020 2020 2020  e(fns):.        
+0008c840: 6966 206b 203e 2030 3a0a 2020 2020 2020  if k > 0:.      
+0008c850: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
+0008c860: 616d 6520 2b20 272e 270a 2020 2020 2020  ame + '.'.      
+0008c870: 2020 666e 616d 6520 3d20 666e 616d 6520    fname = fname 
+0008c880: 2b20 666e 0a20 2020 200a 2020 2020 6774  + fn.    .    gt
+0008c890: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
+0008c8a0: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
+0008c8b0: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
+0008c8c0: 3d20 5472 7565 290a 2020 2020 0a20 2020  = True).    .   
+0008c8d0: 2062 6173 655f 6364 7320 3d20 6765 745f   base_cds = get_
+0008c8e0: 6261 7365 5f63 6473 5f66 726f 6d5f 6774  base_cds_from_gt
+0008c8f0: 665f 6c69 6e65 7328 6774 665f 6c69 6e65  f_lines(gtf_line
+0008c900: 7329 0a20 2020 2069 6620 6261 7365 5f63  s).    if base_c
+0008c910: 6473 203c 2030 3a0a 2020 2020 2020 2020  ds < 0:.        
+0008c920: 7072 696e 7428 2749 4e46 4f3a 204e 6f20  print('INFO: No 
+0008c930: 636f 6469 6e67 2069 6e66 6f72 6d61 7469  coding informati
+0008c940: 6f6e 2070 726f 7669 6465 6420 696e 2074  on provided in t
+0008c950: 6865 2047 5446 2f47 4646 2e27 290a 2020  he GTF/GFF.').  
+0008c960: 2020 0a20 2020 2067 7466 5f6c 696e 6573    .    gtf_lines
+0008c970: 5f6c 7374 203d 2070 6172 7365 5f67 7466  _lst = parse_gtf
+0008c980: 5f6c 696e 6573 5f61 6e64 5f73 706c 6974  _lines_and_split
+0008c990: 5f69 6e74 6f5f 6765 6e65 7328 2067 7466  _into_genes( gtf
+0008c9a0: 5f6c 696e 6573 2029 0a20 2020 2067 656e  _lines ).    gen
+0008c9b0: 6f6d 6520 3d20 6c6f 6164 5f67 656e 6f6d  ome = load_genom
+0008c9c0: 6528 6765 6e6f 6d65 5f66 696c 6529 0a20  e(genome_file). 
+0008c9d0: 2020 2063 6872 7320 3d20 6765 6e6f 6d65     chrs = genome
+0008c9e0: 2e6b 6579 7328 290a 0a20 2020 2067 7466  .keys()..    gtf
+0008c9f0: 5f6c 696e 6573 5f6c 7374 5f6e 6577 203d  _lines_lst_new =
+0008ca00: 205b 5d0a 2020 2020 6363 6e74 203d 2030   [].    ccnt = 0
+0008ca10: 0a20 2020 2067 636e 7420 3d20 300a 2020  .    gcnt = 0.  
+0008ca20: 2020 666f 7220 6b2c 2067 6c69 6e65 7320    for k, glines 
+0008ca30: 696e 2065 6e75 6d65 7261 7465 2867 7466  in enumerate(gtf
+0008ca40: 5f6c 696e 6573 5f6c 7374 293a 0a0a 2020  _lines_lst):..  
+0008ca50: 2020 2020 2020 6966 2020 676c 696e 6573        if  glines
+0008ca60: 5b30 5d2e 6368 7220 696e 2063 6872 733a  [0].chr in chrs:
+0008ca70: 0a20 2020 2020 2020 2020 2020 2074 725f  .            tr_
+0008ca80: 6c69 6e65 735f 6c73 7420 3d20 7061 7273  lines_lst = pars
+0008ca90: 655f 6774 665f 6c69 6e65 735f 616e 645f  e_gtf_lines_and_
+0008caa0: 7370 6c69 745f 696e 746f 5f67 656e 6573  split_into_genes
+0008cab0: 2820 676c 696e 6573 2c20 2774 7261 6e73  ( glines, 'trans
+0008cac0: 6372 6970 7427 2029 0a20 2020 2020 2020  cript' ).       
+0008cad0: 2020 2020 206c 696e 6573 5f6e 6577 203d       lines_new =
+0008cae0: 205b 5d0a 0a20 2020 2020 2020 2020 2020   []..           
+0008caf0: 2066 6f72 206c 696e 6573 2069 6e20 7472   for lines in tr
+0008cb00: 5f6c 696e 6573 5f6c 7374 3a0a 2020 2020  _lines_lst:.    
+0008cb10: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+0008cb20: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0008cb30: 2020 2020 2020 636e 7420 3d20 5b30 2c30        cnt = [0,0
+0008cb40: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0008cb50: 2020 666f 7220 6774 666c 696e 6520 696e    for gtfline in
+0008cb60: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
+0008cb70: 2020 2020 2020 2020 2020 2020 6966 2067              if g
+0008cb80: 7466 6c69 6e65 2e66 6561 7475 7265 203d  tfline.feature =
+0008cb90: 3d20 2773 7461 7274 5f63 6f64 6f6e 273a  = 'start_codon':
+0008cba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008cbb0: 2020 2020 2020 2020 2063 6e74 5b30 5d20           cnt[0] 
+0008cbc0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0008cbd0: 2020 2020 2020 2020 2069 6620 6774 666c           if gtfl
+0008cbe0: 696e 652e 6665 6174 7572 6520 3d3d 2027  ine.feature == '
+0008cbf0: 7374 6f70 5f63 6f64 6f6e 273a 0a20 2020  stop_codon':.   
+0008cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cc10: 2020 2020 2063 6e74 5b31 5d20 2b3d 2031       cnt[1] += 1
+0008cc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008cc30: 2020 2020 2069 6620 2863 6e74 5b30 5d20       if (cnt[0] 
+0008cc40: 3e20 3029 2026 2028 636e 745b 315d 203e  > 0) & (cnt[1] >
+0008cc50: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+0008cc60: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+0008cc70: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0008cc80: 2020 2020 2020 2020 2020 2020 2020 6363                cc
+0008cc90: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0008cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008ccb0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0008ccc0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0008ccd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0008cce0: 6620 623a 206c 696e 6573 5f6e 6577 203d  f b: lines_new =
+0008ccf0: 206c 696e 6573 5f6e 6577 202b 206c 696e   lines_new + lin
+0008cd00: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0008cd10: 2020 2067 636e 7420 2b3d 2031 0a20 2020     gcnt += 1.   
+0008cd20: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0008cd30: 2020 2020 2020 6966 206c 656e 286c 696e        if len(lin
+0008cd40: 6573 5f6e 6577 2920 3e20 303a 0a20 2020  es_new) > 0:.   
+0008cd50: 2020 2020 2020 2020 2020 2020 2067 7466               gtf
+0008cd60: 5f6c 696e 6573 5f6c 7374 5f6e 6577 2e61  _lines_lst_new.a
+0008cd70: 7070 656e 6428 6c69 6e65 735f 6e65 7729  ppend(lines_new)
+0008cd80: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0008cd90: 2020 2020 2020 6966 206b 2531 3030 203d        if k%100 =
+0008cda0: 3d20 303a 2070 7269 6e74 2827 5c72 7061  = 0: print('\rpa
+0008cdb0: 7273 696e 6720 2e2e 2025 692f 2569 2028  rsing .. %i/%i (
+0008cdc0: 2569 2f25 6929 2720 2520 286b 2c20 6c65  %i/%i)' % (k, le
+0008cdd0: 6e28 6774 665f 6c69 6e65 735f 6c73 7429  n(gtf_lines_lst)
+0008cde0: 2c20 6363 6e74 2c20 6763 6e74 292c 2065  , ccnt, gcnt), e
+0008cdf0: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
+0008ce00: 7275 6520 290a 0a20 2020 2070 7269 6e74  rue )..    print
+0008ce10: 2827 5c72 7061 7273 696e 6720 2e2e 2025  ('\rparsing .. %
+0008ce20: 692f 2569 2028 2569 2f25 6929 2720 2520  i/%i (%i/%i)' % 
+0008ce30: 286b 2c20 6c65 6e28 6774 665f 6c69 6e65  (k, len(gtf_line
+0008ce40: 735f 6c73 7429 2c20 6363 6e74 2c20 6763  s_lst), ccnt, gc
+0008ce50: 6e74 292c 2066 6c75 7368 203d 2054 7275  nt), flush = Tru
+0008ce60: 6520 290a 2020 2020 7072 696e 7428 2753  e ).    print('S
+0008ce70: 6f72 7469 6e67 202e 2e20 272c 2065 6e64  orting .. ', end
+0008ce80: 3d27 2729 0a20 2020 2067 7466 5f6c 696e  ='').    gtf_lin
+0008ce90: 6573 5f6c 7374 5f6e 6577 203d 2073 6f72  es_lst_new = sor
+0008cea0: 745f 6774 665f 6c69 6e65 735f 6c73 7428  t_gtf_lines_lst(
+0008ceb0: 6774 665f 6c69 6e65 735f 6c73 745f 6e65  gtf_lines_lst_ne
+0008cec0: 7729 0a20 2020 2070 7269 6e74 2827 5c72  w).    print('\r
+0008ced0: 536f 7274 696e 6720 2e2e 2064 6f6e 6527  Sorting .. done'
+0008cee0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+0008cef0: 2020 2067 7466 5f6c 696e 6573 5f6e 6577     gtf_lines_new
+0008cf00: 203d 205b 5d0a 2020 2020 666f 7220 6c69   = [].    for li
+0008cf10: 6e65 7320 696e 2067 7466 5f6c 696e 6573  nes in gtf_lines
+0008cf20: 5f6c 7374 5f6e 6577 3a0a 2020 2020 2020  _lst_new:.      
+0008cf30: 2020 6774 665f 6c69 6e65 735f 6e65 7720    gtf_lines_new 
+0008cf40: 3d20 6774 665f 6c69 6e65 735f 6e65 7720  = gtf_lines_new 
+0008cf50: 2b20 6c69 6e65 730a 2020 2020 2020 2020  + lines.        
+0008cf60: 0a20 2020 2066 6e61 6d65 203d 2066 6e61  .    fname = fna
+0008cf70: 6d65 202b 2027 5f63 6473 2e67 7466 270a  me + '_cds.gtf'.
+0008cf80: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
+0008cf90: 6720 2e2e 2027 2c20 656e 643d 2727 290a  g .. ', end='').
+0008cfa0: 2020 2020 7361 7665 5f67 7466 2820 666e      save_gtf( fn
+0008cfb0: 616d 652c 2067 7466 5f6c 696e 6573 5f6e  ame, gtf_lines_n
+0008cfc0: 6577 2c20 6864 725f 6c69 6e65 7320 290a  ew, hdr_lines ).
+0008cfd0: 2020 2020 7072 696e 7428 275c 7253 6176      print('\rSav
+0008cfe0: 696e 6720 2e2e 2064 6f6e 6527 290a 2020  ing .. done').  
+0008cff0: 2020 0a20 2020 2072 6574 7572 6e20 666e    .    return fn
+0008d000: 616d 650a 2020 2020 0a0a 6465 6620 7365  ame.    ..def se
+0008d010: 6c65 6374 5f63 6872 5f66 726f 6d5f 6774  lect_chr_from_gt
+0008d020: 665f 6669 6c65 2867 7466 5f66 696c 652c  f_file(gtf_file,
+0008d030: 2063 6872 6d73 203d 205b 5d29 3a0a 0a20   chrms = []):.. 
+0008d040: 2020 2066 6e73 203d 2067 7466 5f66 696c     fns = gtf_fil
+0008d050: 652e 7370 6c69 7428 272e 2729 5b3a 2d31  e.split('.')[:-1
+0008d060: 5d0a 2020 2020 666e 616d 6520 3d20 2727  ].    fname = ''
+0008d070: 0a20 2020 2066 6f72 206b 2c20 666e 2069  .    for k, fn i
+0008d080: 6e20 656e 756d 6572 6174 6528 666e 7329  n enumerate(fns)
+0008d090: 3a0a 2020 2020 2020 2020 6966 206b 203e  :.        if k >
+0008d0a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0008d0b0: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
+0008d0c0: 272e 270a 2020 2020 2020 2020 666e 616d  '.'.        fnam
+0008d0d0: 6520 3d20 666e 616d 6520 2b20 666e 0a20  e = fname + fn. 
+0008d0e0: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
+0008d0f0: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
+0008d100: 6f61 645f 6774 6628 6774 665f 6669 6c65  oad_gtf(gtf_file
+0008d110: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
+0008d120: 290a 2020 2020 0a20 2020 2067 7466 5f6c  ).    .    gtf_l
+0008d130: 696e 6573 5f6c 7374 203d 2070 6172 7365  ines_lst = parse
+0008d140: 5f67 7466 5f6c 696e 6573 5f61 6e64 5f73  _gtf_lines_and_s
+0008d150: 706c 6974 5f69 6e74 6f5f 6765 6e65 7328  plit_into_genes(
+0008d160: 2067 7466 5f6c 696e 6573 2029 0a0a 2020   gtf_lines )..  
+0008d170: 2020 6774 665f 6c69 6e65 735f 6c73 745f    gtf_lines_lst_
+0008d180: 6e65 7720 3d20 5b5d 0a20 2020 2063 636e  new = [].    ccn
+0008d190: 7420 3d20 300a 2020 2020 6763 6e74 203d  t = 0.    gcnt =
+0008d1a0: 2030 0a20 2020 2069 6620 6973 696e 7374   0.    if isinst
+0008d1b0: 616e 6365 2863 6872 6d73 2c20 7374 7229  ance(chrms, str)
+0008d1c0: 3a0a 2020 2020 2020 2020 666f 7220 6b2c  :.        for k,
+0008d1d0: 206c 696e 6573 2069 6e20 656e 756d 6572   lines in enumer
+0008d1e0: 6174 6528 6774 665f 6c69 6e65 735f 6c73  ate(gtf_lines_ls
+0008d1f0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0008d200: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
+0008d210: 2020 2020 2020 6966 206c 696e 6573 5b30        if lines[0
+0008d220: 5d2e 6368 7220 3d3d 2063 6872 6d3a 200a  ].chr == chrm: .
+0008d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d240: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
+0008d250: 2020 2020 2020 2020 2063 636e 7420 2b3d           ccnt +=
+0008d260: 2031 0a20 2020 2020 2020 2020 2020 2067   1.            g
+0008d270: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
+0008d280: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0008d290: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
+0008d2a0: 2070 7269 6e74 2827 5c72 7061 7273 696e   print('\rparsin
+0008d2b0: 6720 2e2e 2025 692f 2569 2028 2569 2f25  g .. %i/%i (%i/%
+0008d2c0: 6929 2720 2520 286b 2c20 6c65 6e28 6774  i)' % (k, len(gt
+0008d2d0: 665f 6c69 6e65 735f 6c73 7429 2c20 6363  f_lines_lst), cc
+0008d2e0: 6e74 2c20 6763 6e74 292c 2065 6e64 3d27  nt, gcnt), end='
+0008d2f0: 272c 2066 6c75 7368 203d 2054 7275 6520  ', flush = True 
+0008d300: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0008d310: 2062 3a20 0a20 2020 2020 2020 2020 2020   b: .           
+0008d320: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
+0008d330: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
+0008d340: 6e65 7329 0a20 2020 2065 6c73 653a 0a20  nes).    else:. 
+0008d350: 2020 2020 2020 2066 6f72 2063 6872 6d20         for chrm 
+0008d360: 696e 2063 6872 6d73 3a0a 2020 2020 2020  in chrms:.      
+0008d370: 2020 2020 2020 666f 7220 6b2c 206c 696e        for k, lin
+0008d380: 6573 2069 6e20 656e 756d 6572 6174 6528  es in enumerate(
+0008d390: 6774 665f 6c69 6e65 735f 6c73 7429 3a0a  gtf_lines_lst):.
+0008d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d3b0: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
+0008d3c0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
+0008d3d0: 6573 5b30 5d2e 6368 7220 3d3d 2063 6872  es[0].chr == chr
+0008d3e0: 6d3a 200a 2020 2020 2020 2020 2020 2020  m: .            
+0008d3f0: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
+0008d400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d410: 2020 2020 2063 636e 7420 2b3d 2031 0a20       ccnt += 1. 
+0008d420: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0008d430: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
+0008d440: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0008d450: 2020 2020 2020 2020 2020 6966 206b 2531            if k%1
+0008d460: 3030 203d 3d20 303a 2070 7269 6e74 2827  00 == 0: print('
+0008d470: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
+0008d480: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
+0008d490: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
+0008d4a0: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
+0008d4b0: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
+0008d4c0: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
+0008d4d0: 2020 2020 2020 2020 2020 6966 2062 3a20            if b: 
+0008d4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d4f0: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
+0008d500: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
+0008d510: 6e65 7329 0a20 2020 2020 2020 2063 6872  nes).        chr
+0008d520: 6d20 3d20 6368 726d 735b 305d 0a20 2020  m = chrms[0].   
+0008d530: 2020 2020 2066 6f72 2063 2069 6e20 6368       for c in ch
+0008d540: 726d 735b 313a 5d3a 0a20 2020 2020 2020  rms[1:]:.       
+0008d550: 2020 2020 2063 6872 6d20 3d20 6368 726d       chrm = chrm
+0008d560: 202b 2027 2c25 7327 2025 2063 0a20 2020   + ',%s' % c.   
+0008d570: 2020 2020 2020 2020 200a 2020 2020 7072           .    pr
+0008d580: 696e 7428 275c 7270 6172 7369 6e67 202e  int('\rparsing .
+0008d590: 2e20 646f 6e65 2025 692f 2569 2028 2569  . done %i/%i (%i
+0008d5a0: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
+0008d5b0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
+0008d5c0: 6363 6e74 2c20 6763 6e74 292c 2066 6c75  ccnt, gcnt), flu
+0008d5d0: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
+0008d5e0: 0a20 2020 2070 7269 6e74 2827 536f 7274  .    print('Sort
+0008d5f0: 696e 6720 2e2e 2027 2c20 656e 643d 2727  ing .. ', end=''
+0008d600: 290a 2020 2020 6774 665f 6c69 6e65 735f  ).    gtf_lines_
+0008d610: 6c73 745f 6e65 7720 3d20 736f 7274 5f67  lst_new = sort_g
+0008d620: 7466 5f6c 696e 6573 5f6c 7374 2867 7466  tf_lines_lst(gtf
+0008d630: 5f6c 696e 6573 5f6c 7374 5f6e 6577 290a  _lines_lst_new).
+0008d640: 2020 2020 7072 696e 7428 275c 7253 6f72      print('\rSor
+0008d650: 7469 6e67 202e 2e20 646f 6e65 2729 0a20  ting .. done'). 
+0008d660: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0008d670: 6774 665f 6c69 6e65 735f 6e65 7720 3d20  gtf_lines_new = 
+0008d680: 5b5d 0a20 2020 2066 6f72 206c 696e 6573  [].    for lines
+0008d690: 2069 6e20 6774 665f 6c69 6e65 735f 6c73   in gtf_lines_ls
+0008d6a0: 745f 6e65 773a 0a20 2020 2020 2020 2067  t_new:.        g
+0008d6b0: 7466 5f6c 696e 6573 5f6e 6577 203d 2067  tf_lines_new = g
+0008d6c0: 7466 5f6c 696e 6573 5f6e 6577 202b 206c  tf_lines_new + l
+0008d6d0: 696e 6573 0a20 2020 200a 2020 2020 7072  ines.    .    pr
+0008d6e0: 696e 7428 2753 6176 696e 6720 2e2e 2027  int('Saving .. '
+0008d6f0: 2c20 656e 643d 2727 290a 2020 2020 666e  , end='').    fn
+0008d700: 616d 6520 3d20 666e 616d 6520 2b20 275f  ame = fname + '_
+0008d710: 7365 6c5f 2573 2e67 7466 2720 2520 6368  sel_%s.gtf' % ch
+0008d720: 726d 0a20 2020 2073 6176 655f 6774 6628  rm.    save_gtf(
+0008d730: 2066 6e61 6d65 2c20 6774 665f 6c69 6e65   fname, gtf_line
+0008d740: 735f 6e65 772c 2068 6472 5f6c 696e 6573  s_new, hdr_lines
+0008d750: 2029 0a20 2020 2070 7269 6e74 2827 5c72   ).    print('\r
+0008d760: 5361 7669 6e67 202e 2e20 646f 6e65 2729  Saving .. done')
+0008d770: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
+0008d780: 2066 6e61 6d65 0a20 2020 200a 0a23 2323   fname.    ..###
+0008d790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008d7c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d800: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-0008d810: 2323 2046 756e 6374 696f 6e73 2074 6f20  ## Functions to 
-0008d820: 6861 6e64 6c65 2073 696d 756c 6174 6564  handle simulated
-0008d830: 2072 6561 6473 2028 6164 6420 7472 6172   reads (add trar
-0008d840: 6563 6f20 6865 6164 6572 2c20 7370 6c69  eco header, spli
-0008d850: 7420 6661 7374 5129 0a23 2323 2323 2323  t fastQ).#######
+0008d7d0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0008d7e0: 2323 2046 756e 6374 696f 6e73 2074 6f20  ## Functions to 
+0008d7f0: 6861 6e64 6c65 2073 696d 756c 6174 6564  handle simulated
+0008d800: 2072 6561 6473 2028 6164 6420 7472 6172   reads (add trar
+0008d810: 6563 6f20 6865 6164 6572 2c20 7370 6c69  eco header, spli
+0008d820: 7420 6661 7374 5129 0a23 2323 2323 2323  t fastQ).#######
+0008d830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008d860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d8a0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-0008d8b0: 2066 6173 7461 5f61 6464 5f74 7261 7265   fasta_add_trare
-0008d8c0: 636f 5f68 6561 6465 7228 2072 6566 5f74  co_header( ref_t
-0008d8d0: 722c 2073 696d 5f70 726f 6669 6c65 2c20  r, sim_profile, 
-0008d8e0: 7265 6164 5f6c 656e 2c20 7375 6666 6978  read_len, suffix
-0008d8f0: 203d 204e 6f6e 652c 2063 6f76 5f74 6820   = None, cov_th 
-0008d900: 3d20 302e 3820 293a 0a20 2020 200a 2020  = 0.8 ):.    .  
-0008d910: 2020 636f 6c6e 616d 6573 203d 205b 276c    colnames = ['l
-0008d920: 6f63 272c 2027 7469 6427 2c20 2763 6f64  oc', 'tid', 'cod
-0008d930: 696e 6727 2c20 276c 656e 6774 6827 2c20  ing', 'length', 
-0008d940: 2765 7870 5f66 7261 6327 2c20 2765 7870  'exp_frac', 'exp
-0008d950: 5f6e 756d 272c 2027 6c69 625f 6672 6163  _num', 'lib_frac
-0008d960: 272c 2027 6c69 625f 6e75 6d27 2c20 5c0a  ', 'lib_num', \.
-0008d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d980: 2773 6571 5f66 7261 6327 2c20 2773 6571  'seq_frac', 'seq
-0008d990: 5f6e 756d 272c 2027 636f 765f 6672 6163  _num', 'cov_frac
-0008d9a0: 272c 2027 6368 6932 272c 2027 5663 6f65  ', 'chi2', 'Vcoe
-0008d9b0: 6627 5d0a 2020 2020 6466 5f70 726f 203d  f'].    df_pro =
-0008d9c0: 2070 642e 7265 6164 5f63 7376 2873 696d   pd.read_csv(sim
-0008d9d0: 5f70 726f 6669 6c65 2c20 7365 703d 275c  _profile, sep='\
-0008d9e0: 7427 2c20 6865 6164 6572 203d 204e 6f6e  t', header = Non
-0008d9f0: 652c 2069 6e64 6578 5f63 6f6c 203d 2031  e, index_col = 1
-0008da00: 2c20 6e61 6d65 7320 3d20 636f 6c6e 616d  , names = colnam
-0008da10: 6573 290a 0a20 2020 2072 6566 203d 206c  es)..    ref = l
-0008da20: 6f61 645f 6661 7374 6128 7265 665f 7472  oad_fasta(ref_tr
-0008da30: 290a 0a20 2020 2064 665f 7072 6f5b 2761  )..    df_pro['a
-0008da40: 626e 275d 203d 2064 665f 7072 6f5b 2773  bn'] = df_pro['s
-0008da50: 6571 5f6e 756d 275d 2a72 6561 645f 6c65  eq_num']*read_le
-0008da60: 6e2f 6466 5f70 726f 5b27 6c65 6e67 7468  n/df_pro['length
-0008da70: 275d 0a20 2020 2064 665f 7072 6f5b 2774  '].    df_pro['t
-0008da80: 706d 275d 203d 2064 665f 7072 6f5b 2761  pm'] = df_pro['a
-0008da90: 626e 275d 2a31 3030 3030 3030 2f28 6466  bn']*1000000/(df
-0008daa0: 5f70 726f 5b27 6162 6e27 5d2e 7375 6d28  _pro['abn'].sum(
-0008dab0: 2929 0a0a 2020 2020 6466 5f69 6478 203d  ))..    df_idx =
-0008dac0: 206e 702e 6172 7261 7928 6466 5f70 726f   np.array(df_pro
-0008dad0: 2e69 6e64 6578 2e76 616c 7565 732e 746f  .index.values.to
-0008dae0: 6c69 7374 2829 290a 2020 2020 636e 745f  list()).    cnt_
-0008daf0: 6475 7020 3d20 300a 2020 2020 666f 7220  dup = 0.    for 
-0008db00: 6b65 7920 696e 206c 6973 7428 7265 662e  key in list(ref.
-0008db10: 6b65 7973 2829 293a 0a20 2020 2020 2020  keys()):.       
-0008db20: 2069 6620 286b 6579 2069 6e20 6466 5f69   if (key in df_i
-0008db30: 6478 2920 2620 286e 702e 7375 6d28 6466  dx) & (np.sum(df
-0008db40: 5f69 6478 203d 3d20 6b65 7929 203d 3d20  _idx == key) == 
-0008db50: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-0008db60: 6966 2064 665f 7072 6f2e 6c6f 635b 6b65  if df_pro.loc[ke
-0008db70: 795d 2e63 6f76 5f66 7261 6320 3e3d 2063  y].cov_frac >= c
-0008db80: 6f76 5f74 683a 0a20 2020 2020 2020 2020  ov_th:.         
-0008db90: 2020 2020 2020 2072 6566 5b6b 6579 5d2e         ref[key].
-0008dba0: 6865 6164 6572 203d 2027 2573 2063 6f76  header = '%s cov
-0008dbb0: 5f66 7261 633a 2566 2061 626e 3a25 6620  _frac:%f abn:%f 
-0008dbc0: 7470 6d3a 2566 2720 2520 2872 6566 5b6b  tpm:%f' % (ref[k
-0008dbd0: 6579 5d2e 6865 6164 6572 2c20 6466 5f70  ey].header, df_p
-0008dbe0: 726f 2e6c 6f63 5b6b 6579 5d2e 636f 765f  ro.loc[key].cov_
-0008dbf0: 6672 6163 2c20 6466 5f70 726f 2e6c 6f63  frac, df_pro.loc
-0008dc00: 5b6b 6579 5d2e 6162 6e2c 2064 665f 7072  [key].abn, df_pr
-0008dc10: 6f2e 6c6f 635b 6b65 795d 2e74 706d 290a  o.loc[key].tpm).
-0008dc20: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0008dc30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0008dc40: 2020 7265 662e 706f 7028 6b65 7929 0a20    ref.pop(key). 
-0008dc50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0008dc60: 2020 2020 2020 2020 2069 6620 6466 5f70           if df_p
-0008dc70: 726f 2e6c 6f63 5b6b 6579 5d2e 7368 6170  ro.loc[key].shap
-0008dc80: 655b 305d 203e 2031 3a20 636e 745f 6475  e[0] > 1: cnt_du
-0008dc90: 7020 2b3d 2031 0a20 2020 2020 2020 2020  p += 1.         
-0008dca0: 2020 2072 6566 2e70 6f70 286b 6579 290a     ref.pop(key).
-0008dcb0: 0a20 2020 2066 6e61 6d65 2c20 6578 7420  .    fname, ext 
-0008dcc0: 3d20 6765 745f 6669 6c65 5f6e 616d 6528  = get_file_name(
-0008dcd0: 7265 665f 7472 290a 2020 2020 6966 2073  ref_tr).    if s
-0008dce0: 7566 6669 7820 6973 204e 6f6e 653a 0a20  uffix is None:. 
-0008dcf0: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
-0008dd00: 6e61 6d65 202b 2027 5f63 6f76 2569 2e27  name + '_cov%i.'
-0008dd10: 2025 2069 6e74 2863 6f76 5f74 682a 3130   % int(cov_th*10
-0008dd20: 3029 202b 2065 7874 0a20 2020 2065 6c73  0) + ext.    els
-0008dd30: 653a 0a20 2020 2020 2020 2066 6e61 6d65  e:.        fname
-0008dd40: 203d 2066 6e61 6d65 202b 2027 5f25 735f   = fname + '_%s_
-0008dd50: 636f 7625 692e 2720 2520 2873 7566 6669  cov%i.' % (suffi
-0008dd60: 782c 2069 6e74 2863 6f76 5f74 682a 3130  x, int(cov_th*10
-0008dd70: 3029 2920 2b20 6578 740a 0a20 2020 2073  0)) + ext..    s
-0008dd80: 6176 655f 6661 7374 6128 666e 616d 652c  ave_fasta(fname,
-0008dd90: 2072 6566 2c20 7469 746c 6520 3d20 666e   ref, title = fn
-0008dda0: 616d 6529 0a20 2020 200a 0a64 6566 206c  ame).    ..def l
-0008ddb0: 6f61 645f 6661 7374 7128 6669 6c65 5f67  oad_fastq(file_g
-0008ddc0: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
-0008ddd0: 2046 616c 7365 2029 3a0a 0a20 2020 2067   False ):..    g
-0008dde0: 656e 6f6d 6520 3d20 6469 6374 2829 0a20  enome = dict(). 
-0008ddf0: 2020 2066 203d 206f 7065 6e28 6669 6c65     f = open(file
-0008de00: 5f67 656e 6f6d 652c 2027 7227 290a 2020  _genome, 'r').  
-0008de10: 2020 7363 6e74 203d 2030 0a20 2020 2070    scnt = 0.    p
-0008de20: 7269 6e74 2827 5c72 4c6f 6164 696e 6720  rint('\rLoading 
-0008de30: 6661 7374 5120 2e2e 2027 2c20 656e 643d  fastQ .. ', end=
-0008de40: 2727 2c20 666c 7573 683d 5472 7565 290a  '', flush=True).
-0008de50: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
-0008de60: 666f 7220 6c69 6e65 2069 6e20 6620 3a0a  for line in f :.
-0008de70: 2020 2020 2020 2020 6966 206c 696e 655b          if line[
-0008de80: 305d 203d 3d20 2740 273a 0a20 2020 2020  0] == '@':.     
-0008de90: 2020 2020 2020 2069 6620 636e 7420 3d3d         if cnt ==
-0008dea0: 2034 3a0a 2020 2020 2020 2020 2020 2020   4:.            
-0008deb0: 2020 2020 6765 6e6f 6d65 5b73 636e 745d      genome[scnt]
-0008dec0: 203d 2047 656e 6f6d 6528 6864 722c 2073   = Genome(hdr, s
-0008ded0: 6571 2c20 7175 616c 290a 2020 2020 2020  eq, qual).      
-0008dee0: 2020 2020 2020 2020 2020 7363 6e74 202b            scnt +
-0008def0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0008df00: 636e 7420 3d20 300a 2020 2020 2020 2020  cnt = 0.        
-0008df10: 2020 2020 6864 7220 3d20 6c69 6e65 5b31      hdr = line[1
-0008df20: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
-0008df30: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
-0008df40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008df50: 2020 2020 6966 2063 6e74 203d 3d20 313a      if cnt == 1:
-0008df60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008df70: 2073 6571 203d 206c 696e 655b 3a2d 315d   seq = line[:-1]
-0008df80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008df90: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
-0008dfa0: 2020 2020 2020 656c 6966 2063 6e74 203d        elif cnt =
-0008dfb0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-0008dfc0: 2020 2020 2069 6620 6c69 6e65 5b30 5d20       if line[0] 
-0008dfd0: 3d3d 2027 2b27 3a0a 2020 2020 2020 2020  == '+':.        
-0008dfe0: 2020 2020 2020 2020 2020 2020 6964 7220              idr 
-0008dff0: 3d20 6c69 6e65 5b31 3a2d 315d 0a20 2020  = line[1:-1].   
+0008d870: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
+0008d880: 2066 6173 7461 5f61 6464 5f74 7261 7265   fasta_add_trare
+0008d890: 636f 5f68 6561 6465 7228 2072 6566 5f74  co_header( ref_t
+0008d8a0: 722c 2073 696d 5f70 726f 6669 6c65 2c20  r, sim_profile, 
+0008d8b0: 7265 6164 5f6c 656e 2c20 7375 6666 6978  read_len, suffix
+0008d8c0: 203d 204e 6f6e 652c 2063 6f76 5f74 6820   = None, cov_th 
+0008d8d0: 3d20 302e 3820 293a 0a20 2020 200a 2020  = 0.8 ):.    .  
+0008d8e0: 2020 636f 6c6e 616d 6573 203d 205b 276c    colnames = ['l
+0008d8f0: 6f63 272c 2027 7469 6427 2c20 2763 6f64  oc', 'tid', 'cod
+0008d900: 696e 6727 2c20 276c 656e 6774 6827 2c20  ing', 'length', 
+0008d910: 2765 7870 5f66 7261 6327 2c20 2765 7870  'exp_frac', 'exp
+0008d920: 5f6e 756d 272c 2027 6c69 625f 6672 6163  _num', 'lib_frac
+0008d930: 272c 2027 6c69 625f 6e75 6d27 2c20 5c0a  ', 'lib_num', \.
+0008d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d950: 2773 6571 5f66 7261 6327 2c20 2773 6571  'seq_frac', 'seq
+0008d960: 5f6e 756d 272c 2027 636f 765f 6672 6163  _num', 'cov_frac
+0008d970: 272c 2027 6368 6932 272c 2027 5663 6f65  ', 'chi2', 'Vcoe
+0008d980: 6627 5d0a 2020 2020 6466 5f70 726f 203d  f'].    df_pro =
+0008d990: 2070 642e 7265 6164 5f63 7376 2873 696d   pd.read_csv(sim
+0008d9a0: 5f70 726f 6669 6c65 2c20 7365 703d 275c  _profile, sep='\
+0008d9b0: 7427 2c20 6865 6164 6572 203d 204e 6f6e  t', header = Non
+0008d9c0: 652c 2069 6e64 6578 5f63 6f6c 203d 2031  e, index_col = 1
+0008d9d0: 2c20 6e61 6d65 7320 3d20 636f 6c6e 616d  , names = colnam
+0008d9e0: 6573 290a 0a20 2020 2072 6566 203d 206c  es)..    ref = l
+0008d9f0: 6f61 645f 6661 7374 6128 7265 665f 7472  oad_fasta(ref_tr
+0008da00: 290a 0a20 2020 2064 665f 7072 6f5b 2761  )..    df_pro['a
+0008da10: 626e 275d 203d 2064 665f 7072 6f5b 2773  bn'] = df_pro['s
+0008da20: 6571 5f6e 756d 275d 2a72 6561 645f 6c65  eq_num']*read_le
+0008da30: 6e2f 6466 5f70 726f 5b27 6c65 6e67 7468  n/df_pro['length
+0008da40: 275d 0a20 2020 2064 665f 7072 6f5b 2774  '].    df_pro['t
+0008da50: 706d 275d 203d 2064 665f 7072 6f5b 2761  pm'] = df_pro['a
+0008da60: 626e 275d 2a31 3030 3030 3030 2f28 6466  bn']*1000000/(df
+0008da70: 5f70 726f 5b27 6162 6e27 5d2e 7375 6d28  _pro['abn'].sum(
+0008da80: 2929 0a0a 2020 2020 6466 5f69 6478 203d  ))..    df_idx =
+0008da90: 206e 702e 6172 7261 7928 6466 5f70 726f   np.array(df_pro
+0008daa0: 2e69 6e64 6578 2e76 616c 7565 732e 746f  .index.values.to
+0008dab0: 6c69 7374 2829 290a 2020 2020 636e 745f  list()).    cnt_
+0008dac0: 6475 7020 3d20 300a 2020 2020 666f 7220  dup = 0.    for 
+0008dad0: 6b65 7920 696e 206c 6973 7428 7265 662e  key in list(ref.
+0008dae0: 6b65 7973 2829 293a 0a20 2020 2020 2020  keys()):.       
+0008daf0: 2069 6620 286b 6579 2069 6e20 6466 5f69   if (key in df_i
+0008db00: 6478 2920 2620 286e 702e 7375 6d28 6466  dx) & (np.sum(df
+0008db10: 5f69 6478 203d 3d20 6b65 7929 203d 3d20  _idx == key) == 
+0008db20: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
+0008db30: 6966 2064 665f 7072 6f2e 6c6f 635b 6b65  if df_pro.loc[ke
+0008db40: 795d 2e63 6f76 5f66 7261 6320 3e3d 2063  y].cov_frac >= c
+0008db50: 6f76 5f74 683a 0a20 2020 2020 2020 2020  ov_th:.         
+0008db60: 2020 2020 2020 2072 6566 5b6b 6579 5d2e         ref[key].
+0008db70: 6865 6164 6572 203d 2027 2573 2063 6f76  header = '%s cov
+0008db80: 5f66 7261 633a 2566 2061 626e 3a25 6620  _frac:%f abn:%f 
+0008db90: 7470 6d3a 2566 2720 2520 2872 6566 5b6b  tpm:%f' % (ref[k
+0008dba0: 6579 5d2e 6865 6164 6572 2c20 6466 5f70  ey].header, df_p
+0008dbb0: 726f 2e6c 6f63 5b6b 6579 5d2e 636f 765f  ro.loc[key].cov_
+0008dbc0: 6672 6163 2c20 6466 5f70 726f 2e6c 6f63  frac, df_pro.loc
+0008dbd0: 5b6b 6579 5d2e 6162 6e2c 2064 665f 7072  [key].abn, df_pr
+0008dbe0: 6f2e 6c6f 635b 6b65 795d 2e74 706d 290a  o.loc[key].tpm).
+0008dbf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0008dc00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0008dc10: 2020 7265 662e 706f 7028 6b65 7929 0a20    ref.pop(key). 
+0008dc20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0008dc30: 2020 2020 2020 2020 2069 6620 6466 5f70           if df_p
+0008dc40: 726f 2e6c 6f63 5b6b 6579 5d2e 7368 6170  ro.loc[key].shap
+0008dc50: 655b 305d 203e 2031 3a20 636e 745f 6475  e[0] > 1: cnt_du
+0008dc60: 7020 2b3d 2031 0a20 2020 2020 2020 2020  p += 1.         
+0008dc70: 2020 2072 6566 2e70 6f70 286b 6579 290a     ref.pop(key).
+0008dc80: 0a20 2020 2066 6e61 6d65 2c20 6578 7420  .    fname, ext 
+0008dc90: 3d20 6765 745f 6669 6c65 5f6e 616d 6528  = get_file_name(
+0008dca0: 7265 665f 7472 290a 2020 2020 6966 2073  ref_tr).    if s
+0008dcb0: 7566 6669 7820 6973 204e 6f6e 653a 0a20  uffix is None:. 
+0008dcc0: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
+0008dcd0: 6e61 6d65 202b 2027 5f63 6f76 2569 2e27  name + '_cov%i.'
+0008dce0: 2025 2069 6e74 2863 6f76 5f74 682a 3130   % int(cov_th*10
+0008dcf0: 3029 202b 2065 7874 0a20 2020 2065 6c73  0) + ext.    els
+0008dd00: 653a 0a20 2020 2020 2020 2066 6e61 6d65  e:.        fname
+0008dd10: 203d 2066 6e61 6d65 202b 2027 5f25 735f   = fname + '_%s_
+0008dd20: 636f 7625 692e 2720 2520 2873 7566 6669  cov%i.' % (suffi
+0008dd30: 782c 2069 6e74 2863 6f76 5f74 682a 3130  x, int(cov_th*10
+0008dd40: 3029 2920 2b20 6578 740a 0a20 2020 2073  0)) + ext..    s
+0008dd50: 6176 655f 6661 7374 6128 666e 616d 652c  ave_fasta(fname,
+0008dd60: 2072 6566 2c20 7469 746c 6520 3d20 666e   ref, title = fn
+0008dd70: 616d 6529 0a20 2020 200a 0a64 6566 206c  ame).    ..def l
+0008dd80: 6f61 645f 6661 7374 7128 6669 6c65 5f67  oad_fastq(file_g
+0008dd90: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
+0008dda0: 2046 616c 7365 2029 3a0a 0a20 2020 2067   False ):..    g
+0008ddb0: 656e 6f6d 6520 3d20 6469 6374 2829 0a20  enome = dict(). 
+0008ddc0: 2020 2066 203d 206f 7065 6e28 6669 6c65     f = open(file
+0008ddd0: 5f67 656e 6f6d 652c 2027 7227 290a 2020  _genome, 'r').  
+0008dde0: 2020 7363 6e74 203d 2030 0a20 2020 2070    scnt = 0.    p
+0008ddf0: 7269 6e74 2827 5c72 4c6f 6164 696e 6720  rint('\rLoading 
+0008de00: 6661 7374 5120 2e2e 2027 2c20 656e 643d  fastQ .. ', end=
+0008de10: 2727 2c20 666c 7573 683d 5472 7565 290a  '', flush=True).
+0008de20: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
+0008de30: 666f 7220 6c69 6e65 2069 6e20 6620 3a0a  for line in f :.
+0008de40: 2020 2020 2020 2020 6966 206c 696e 655b          if line[
+0008de50: 305d 203d 3d20 2740 273a 0a20 2020 2020  0] == '@':.     
+0008de60: 2020 2020 2020 2069 6620 636e 7420 3d3d         if cnt ==
+0008de70: 2034 3a0a 2020 2020 2020 2020 2020 2020   4:.            
+0008de80: 2020 2020 6765 6e6f 6d65 5b73 636e 745d      genome[scnt]
+0008de90: 203d 2047 656e 6f6d 6528 6864 722c 2073   = Genome(hdr, s
+0008dea0: 6571 2c20 7175 616c 290a 2020 2020 2020  eq, qual).      
+0008deb0: 2020 2020 2020 2020 2020 7363 6e74 202b            scnt +
+0008dec0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0008ded0: 636e 7420 3d20 300a 2020 2020 2020 2020  cnt = 0.        
+0008dee0: 2020 2020 6864 7220 3d20 6c69 6e65 5b31      hdr = line[1
+0008def0: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
+0008df00: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
+0008df10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008df20: 2020 2020 6966 2063 6e74 203d 3d20 313a      if cnt == 1:
+0008df30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008df40: 2073 6571 203d 206c 696e 655b 3a2d 315d   seq = line[:-1]
+0008df50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008df60: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
+0008df70: 2020 2020 2020 656c 6966 2063 6e74 203d        elif cnt =
+0008df80: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+0008df90: 2020 2020 2069 6620 6c69 6e65 5b30 5d20       if line[0] 
+0008dfa0: 3d3d 2027 2b27 3a0a 2020 2020 2020 2020  == '+':.        
+0008dfb0: 2020 2020 2020 2020 2020 2020 6964 7220              idr 
+0008dfc0: 3d20 6c69 6e65 5b31 3a2d 315d 0a20 2020  = line[1:-1].   
+0008dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008dfe0: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
+0008dff0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 0008e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e010: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
-0008e020: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0008e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e040: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
-0008e050: 2069 6e20 6661 7374 5120 6669 6c65 2729   in fastQ file')
-0008e060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008e070: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0008e080: 2020 2020 2020 2065 6c69 6620 636e 7420         elif cnt 
-0008e090: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
-0008e0a0: 2020 2020 2020 7175 616c 203d 206c 696e        qual = lin
-0008e0b0: 655b 3a2d 315d 0a20 2020 2020 2020 2020  e[:-1].         
-0008e0c0: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
-0008e0d0: 2020 2020 6966 2063 6e74 203e 2030 3a0a      if cnt > 0:.
-0008e0e0: 2020 2020 2020 2020 6765 6e6f 6d65 5b73          genome[s
-0008e0f0: 636e 745d 203d 2047 656e 6f6d 6528 6864  cnt] = Genome(hd
-0008e100: 722c 2073 6571 2c20 7175 616c 290a 2020  r, seq, qual).  
-0008e110: 2020 2020 2020 7363 6e74 202b 3d20 310a        scnt += 1.
-0008e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e130: 0a20 2020 2070 7269 6e74 2827 5c72 4c6f  .    print('\rLo
-0008e140: 6164 696e 6720 6661 7374 5120 2e2e 2064  ading fastQ .. d
-0008e150: 6f6e 652e 2020 4e75 6d2e 5365 7120 3d20  one.  Num.Seq = 
-0008e160: 272c 2073 636e 742c 2027 2020 2027 2c20  ', scnt, '   ', 
-0008e170: 666c 7573 683d 5472 7565 290a 2020 2020  flush=True).    
-0008e180: 662e 636c 6f73 6528 290a 2020 2020 7265  f.close().    re
-0008e190: 7475 726e 2867 656e 6f6d 6529 0a0a 0a64  turn(genome)...d
-0008e1a0: 6566 2073 6176 655f 6661 7374 7128 2066  ef save_fastq( f
-0008e1b0: 696c 655f 6765 6e6f 6d65 2c20 6765 6e6f  ile_genome, geno
-0008e1c0: 6d65 5f64 6963 742c 2076 6572 626f 7365  me_dict, verbose
-0008e1d0: 203d 2046 616c 7365 2c20 7469 746c 6520   = False, title 
-0008e1e0: 3d20 2766 6173 7451 2720 293a 0a0a 2020  = 'fastQ' ):..  
-0008e1f0: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
-0008e200: 2573 202e 2e27 2025 2074 6974 6c65 2c20  %s ..' % title, 
-0008e210: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
-0008e220: 7565 290a 2020 2020 2320 666f 7220 6720  ue).    # for g 
-0008e230: 696e 2067 656e 6f6d 655f 6c73 7420 3a0a  in genome_lst :.
-0008e240: 2020 2020 4b65 7973 203d 2067 656e 6f6d      Keys = genom
-0008e250: 655f 6469 6374 2e6b 6579 7328 290a 2020  e_dict.keys().  
-0008e260: 2020 6620 3d20 6f70 656e 2866 696c 655f    f = open(file_
-0008e270: 6765 6e6f 6d65 2c20 2777 742b 2729 0a20  genome, 'wt+'). 
-0008e280: 2020 206c 696e 655f 6c73 7420 3d20 5b5d     line_lst = []
-0008e290: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
-0008e2a0: 4b65 7973 3a0a 2020 2020 2020 2020 2320  Keys:.        # 
-0008e2b0: 7072 696e 7428 275c 7253 6176 696e 6720  print('\rSaving 
-0008e2c0: 2573 202e 2e20 2573 2720 2520 2874 6974  %s .. %s' % (tit
-0008e2d0: 6c65 2c20 6b65 7929 2c20 656e 643d 2720  le, key), end=' 
-0008e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e2f0: 2020 2027 290a 2020 2020 2020 2020 6720     ').        g 
-0008e300: 3d20 6765 6e6f 6d65 5f64 6963 745b 6b65  = genome_dict[ke
-0008e310: 795d 0a20 2020 2020 2020 2073 203d 2027  y].        s = '
-0008e320: 4025 735c 6e27 2025 2067 2e68 6561 6465  @%s\n' % g.heade
-0008e330: 720a 2020 2020 2020 2020 6c69 6e65 5f6c  r.        line_l
-0008e340: 7374 2e61 7070 656e 6428 7329 0a20 2020  st.append(s).   
-0008e350: 2020 2020 206c 696e 655f 6c73 742e 6170       line_lst.ap
-0008e360: 7065 6e64 2867 2e73 6571 2e75 7070 6572  pend(g.seq.upper
-0008e370: 2829 202b 2027 5c6e 2729 0a20 2020 2020  () + '\n').     
-0008e380: 2020 206c 696e 655f 6c73 742e 6170 7065     line_lst.appe
-0008e390: 6e64 2827 2b5c 6e27 290a 2020 2020 2020  nd('+\n').      
-0008e3a0: 2020 6c69 6e65 5f6c 7374 2e61 7070 656e    line_lst.appen
-0008e3b0: 6428 672e 7175 616c 202b 2027 5c6e 2729  d(g.qual + '\n')
-0008e3c0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0008e3d0: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
-0008e3e0: 696e 7428 272e 272c 2065 6e64 3d27 272c  int('.', end='',
-0008e3f0: 2066 6c75 7368 3d54 7275 6529 0a0a 2020   flush=True)..  
-0008e400: 2020 662e 7772 6974 656c 696e 6573 2827    f.writelines('
-0008e410: 272e 6a6f 696e 286c 696e 655f 6c73 7429  '.join(line_lst)
-0008e420: 290a 2020 2020 2020 2020 0a20 2020 2070  ).        .    p
-0008e430: 7269 6e74 2827 5c72 5361 7669 6e67 2025  rint('\rSaving %
-0008e440: 7320 2e2e 2064 6f6e 652e 2028 2569 2920  s .. done. (%i) 
-0008e450: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0008e460: 2025 2028 7469 746c 652c 206c 656e 284b   % (title, len(K
-0008e470: 6579 7329 292c 2066 6c75 7368 3d54 7275  eys)), flush=Tru
-0008e480: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
-0008e490: 0a20 2020 200a 0a20 2020 200a 6465 6620  .    ..    .def 
-0008e4a0: 6661 7374 615f 7369 6d5f 7265 6164 5f73  fasta_sim_read_s
-0008e4b0: 706c 6974 2820 7369 6d5f 7265 6164 2c20  plit( sim_read, 
-0008e4c0: 6473 7220 3d20 3120 293a 0a20 2020 200a  dsr = 1 ):.    .
-0008e4d0: 2020 2020 666e 616d 652c 2065 7874 203d      fname, ext =
-0008e4e0: 2067 6574 5f70 6174 685f 6e61 6d65 2873   get_path_name(s
-0008e4f0: 696d 5f72 6561 6429 0a0a 2020 2020 6661  im_read)..    fa
-0008e500: 5f61 6c6c 203d 206c 6f61 645f 6661 7374  _all = load_fast
-0008e510: 7128 7369 6d5f 7265 6164 290a 2020 2020  q(sim_read).    
-0008e520: 0a20 2020 2066 6131 203d 207b 7d0a 2020  .    fa1 = {}.  
-0008e530: 2020 6661 3220 3d20 7b7d 0a20 2020 2063    fa2 = {}.    c
-0008e540: 6e74 203d 2030 0a20 2020 2063 6e74 5f31  nt = 0.    cnt_1
-0008e550: 203d 2030 0a20 2020 2063 6e74 5f32 203d   = 0.    cnt_2 =
-0008e560: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
-0008e570: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
-0008e580: 0a20 2020 2020 2020 2066 615f 616c 6c5b  .        fa_all[
-0008e590: 6b65 795d 2e68 6561 6465 7220 3d20 6661  key].header = fa
-0008e5a0: 5f61 6c6c 5b6b 6579 5d2e 6865 6164 6572  _all[key].header
-0008e5b0: 5b3a 2d34 5d0a 2020 2020 2020 2020 6966  [:-4].        if
-0008e5c0: 2063 6e74 2532 203d 3d20 303a 0a20 2020   cnt%2 == 0:.   
-0008e5d0: 2020 2020 2020 2020 2069 6620 636e 745f           if cnt_
-0008e5e0: 3125 6473 7220 3d3d 2030 3a0a 2020 2020  1%dsr == 0:.    
-0008e5f0: 2020 2020 2020 2020 2020 2020 6661 5f61              fa_a
-0008e600: 6c6c 5b6b 6579 5d2e 6865 6164 6572 203d  ll[key].header =
-0008e610: 2066 615f 616c 6c5b 6b65 795d 2e68 6561   fa_all[key].hea
-0008e620: 6465 722e 7370 6c69 7428 2720 2729 5b30  der.split(' ')[0
-0008e630: 5d20 2b20 272f 3127 0a20 2020 2020 2020  ] + '/1'.       
-0008e640: 2020 2020 2020 2020 2066 6131 5b6b 6579           fa1[key
-0008e650: 5d20 3d20 6661 5f61 6c6c 5b6b 6579 5d0a  ] = fa_all[key].
-0008e660: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-0008e670: 3120 2b3d 2031 0a20 2020 2020 2020 2065  1 += 1.        e
-0008e680: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0008e690: 2069 6620 636e 745f 3225 6473 7220 3d3d   if cnt_2%dsr ==
-0008e6a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0008e6b0: 2020 2020 6661 5f61 6c6c 5b6b 6579 5d2e      fa_all[key].
-0008e6c0: 6865 6164 6572 203d 2066 615f 616c 6c5b  header = fa_all[
-0008e6d0: 6b65 795d 2e68 6561 6465 722e 7370 6c69  key].header.spli
-0008e6e0: 7428 2720 2729 5b30 5d20 2b20 272f 3227  t(' ')[0] + '/2'
-0008e6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008e700: 2066 6132 5b6b 6579 5d20 3d20 6661 5f61   fa2[key] = fa_a
-0008e710: 6c6c 5b6b 6579 5d0a 2020 2020 2020 2020  ll[key].        
-0008e720: 2020 2020 636e 745f 3220 2b3d 2031 0a0a      cnt_2 += 1..
-0008e730: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
-0008e740: 0a0a 2020 2020 6966 2064 7372 203d 3d20  ..    if dsr == 
-0008e750: 313a 0a20 2020 2020 2020 2066 6e31 203d  1:.        fn1 =
-0008e760: 2066 6e61 6d65 202b 2027 5f31 2e27 202b   fname + '_1.' +
-0008e770: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
-0008e780: 203d 2066 6e61 6d65 202b 2027 5f32 2e27   = fname + '_2.'
-0008e790: 202b 2065 7874 0a20 2020 2065 6c73 653a   + ext.    else:
-0008e7a0: 0a20 2020 2020 2020 2066 6e31 203d 2066  .        fn1 = f
-0008e7b0: 6e61 6d65 202b 2028 275f 6473 2569 2720  name + ('_ds%i' 
-0008e7c0: 2520 6473 7229 202b 2027 5f31 2e27 202b  % dsr) + '_1.' +
-0008e7d0: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
-0008e7e0: 203d 2066 6e61 6d65 202b 2028 275f 6473   = fname + ('_ds
-0008e7f0: 2569 2720 2520 6473 7229 202b 2027 5f32  %i' % dsr) + '_2
-0008e800: 2e27 202b 2065 7874 0a20 2020 2073 6176  .' + ext.    sav
-0008e810: 655f 6661 7374 7128 666e 312c 2066 6131  e_fastq(fn1, fa1
-0008e820: 290a 2020 2020 7361 7665 5f66 6173 7471  ).    save_fastq
-0008e830: 2866 6e32 2c20 6661 3229 0a20 2020 200a  (fn2, fa2).    .
-0008e840: 0a64 6566 2066 6173 7461 5f73 696d 5f72  .def fasta_sim_r
-0008e850: 6561 645f 646f 776e 7361 6d70 6c65 2820  ead_downsample( 
-0008e860: 7369 6d5f 7265 6164 2c20 6473 7220 3d20  sim_read, dsr = 
-0008e870: 3120 293a 0a20 2020 200a 2020 2020 666e  1 ):.    .    fn
-0008e880: 616d 652c 2065 7874 203d 2067 6574 5f70  ame, ext = get_p
-0008e890: 6174 685f 6e61 6d65 2873 696d 5f72 6561  ath_name(sim_rea
-0008e8a0: 6429 0a0a 2020 2020 6661 5f61 6c6c 203d  d)..    fa_all =
-0008e8b0: 206c 6f61 645f 6661 7374 7128 7369 6d5f   load_fastq(sim_
-0008e8c0: 7265 6164 290a 2020 2020 0a20 2020 2066  read).    .    f
-0008e8d0: 6120 3d20 7b7d 0a20 2020 2063 6e74 203d  a = {}.    cnt =
-0008e8e0: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
-0008e8f0: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
-0008e900: 0a20 2020 2020 2020 2023 2066 615f 616c  .        # fa_al
-0008e910: 6c5b 6b65 795d 2e68 6561 6465 7220 3d20  l[key].header = 
-0008e920: 6661 5f61 6c6c 5b6b 6579 5d2e 6865 6164  fa_all[key].head
-0008e930: 6572 5b3a 2d34 5d0a 2020 2020 2020 2020  er[:-4].        
-0008e940: 6966 2063 6e74 2564 7372 203d 3d20 303a  if cnt%dsr == 0:
-0008e950: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-0008e960: 615f 616c 6c5b 6b65 795d 2e68 6561 6465  a_all[key].heade
-0008e970: 7220 3d20 6661 5f61 6c6c 5b6b 6579 5d2e  r = fa_all[key].
-0008e980: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-0008e990: 2020 2066 615b 6b65 795d 203d 2066 615f     fa[key] = fa_
-0008e9a0: 616c 6c5b 6b65 795d 0a20 2020 2020 2020  all[key].       
-0008e9b0: 2063 6e74 202b 3d20 310a 0a20 2020 2066   cnt += 1..    f
-0008e9c0: 6e20 3d20 666e 616d 6520 2b20 2827 5f64  n = fname + ('_d
-0008e9d0: 7325 692e 2720 2520 6473 7229 202b 2065  s%i.' % dsr) + e
-0008e9e0: 7874 0a20 2020 2073 6176 655f 6661 7374  xt.    save_fast
-0008e9f0: 7128 666e 2c20 6661 290a 2020 2020 0a20  q(fn, fa).    . 
-0008ea00: 2020 200a 2323 2323 2323 2323 2323 2323     .############
+0008e010: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
+0008e020: 2069 6e20 6661 7374 5120 6669 6c65 2729   in fastQ file')
+0008e030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008e040: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+0008e050: 2020 2020 2020 2065 6c69 6620 636e 7420         elif cnt 
+0008e060: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
+0008e070: 2020 2020 2020 7175 616c 203d 206c 696e        qual = lin
+0008e080: 655b 3a2d 315d 0a20 2020 2020 2020 2020  e[:-1].         
+0008e090: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
+0008e0a0: 2020 2020 6966 2063 6e74 203e 2030 3a0a      if cnt > 0:.
+0008e0b0: 2020 2020 2020 2020 6765 6e6f 6d65 5b73          genome[s
+0008e0c0: 636e 745d 203d 2047 656e 6f6d 6528 6864  cnt] = Genome(hd
+0008e0d0: 722c 2073 6571 2c20 7175 616c 290a 2020  r, seq, qual).  
+0008e0e0: 2020 2020 2020 7363 6e74 202b 3d20 310a        scnt += 1.
+0008e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008e100: 0a20 2020 2070 7269 6e74 2827 5c72 4c6f  .    print('\rLo
+0008e110: 6164 696e 6720 6661 7374 5120 2e2e 2064  ading fastQ .. d
+0008e120: 6f6e 652e 2020 4e75 6d2e 5365 7120 3d20  one.  Num.Seq = 
+0008e130: 272c 2073 636e 742c 2027 2020 2027 2c20  ', scnt, '   ', 
+0008e140: 666c 7573 683d 5472 7565 290a 2020 2020  flush=True).    
+0008e150: 662e 636c 6f73 6528 290a 2020 2020 7265  f.close().    re
+0008e160: 7475 726e 2867 656e 6f6d 6529 0a0a 0a64  turn(genome)...d
+0008e170: 6566 2073 6176 655f 6661 7374 7128 2066  ef save_fastq( f
+0008e180: 696c 655f 6765 6e6f 6d65 2c20 6765 6e6f  ile_genome, geno
+0008e190: 6d65 5f64 6963 742c 2076 6572 626f 7365  me_dict, verbose
+0008e1a0: 203d 2046 616c 7365 2c20 7469 746c 6520   = False, title 
+0008e1b0: 3d20 2766 6173 7451 2720 293a 0a0a 2020  = 'fastQ' ):..  
+0008e1c0: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
+0008e1d0: 2573 202e 2e27 2025 2074 6974 6c65 2c20  %s ..' % title, 
+0008e1e0: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
+0008e1f0: 7565 290a 2020 2020 2320 666f 7220 6720  ue).    # for g 
+0008e200: 696e 2067 656e 6f6d 655f 6c73 7420 3a0a  in genome_lst :.
+0008e210: 2020 2020 4b65 7973 203d 2067 656e 6f6d      Keys = genom
+0008e220: 655f 6469 6374 2e6b 6579 7328 290a 2020  e_dict.keys().  
+0008e230: 2020 6620 3d20 6f70 656e 2866 696c 655f    f = open(file_
+0008e240: 6765 6e6f 6d65 2c20 2777 742b 2729 0a20  genome, 'wt+'). 
+0008e250: 2020 206c 696e 655f 6c73 7420 3d20 5b5d     line_lst = []
+0008e260: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
+0008e270: 4b65 7973 3a0a 2020 2020 2020 2020 2320  Keys:.        # 
+0008e280: 7072 696e 7428 275c 7253 6176 696e 6720  print('\rSaving 
+0008e290: 2573 202e 2e20 2573 2720 2520 2874 6974  %s .. %s' % (tit
+0008e2a0: 6c65 2c20 6b65 7929 2c20 656e 643d 2720  le, key), end=' 
+0008e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008e2c0: 2020 2027 290a 2020 2020 2020 2020 6720     ').        g 
+0008e2d0: 3d20 6765 6e6f 6d65 5f64 6963 745b 6b65  = genome_dict[ke
+0008e2e0: 795d 0a20 2020 2020 2020 2073 203d 2027  y].        s = '
+0008e2f0: 4025 735c 6e27 2025 2067 2e68 6561 6465  @%s\n' % g.heade
+0008e300: 720a 2020 2020 2020 2020 6c69 6e65 5f6c  r.        line_l
+0008e310: 7374 2e61 7070 656e 6428 7329 0a20 2020  st.append(s).   
+0008e320: 2020 2020 206c 696e 655f 6c73 742e 6170       line_lst.ap
+0008e330: 7065 6e64 2867 2e73 6571 2e75 7070 6572  pend(g.seq.upper
+0008e340: 2829 202b 2027 5c6e 2729 0a20 2020 2020  () + '\n').     
+0008e350: 2020 206c 696e 655f 6c73 742e 6170 7065     line_lst.appe
+0008e360: 6e64 2827 2b5c 6e27 290a 2020 2020 2020  nd('+\n').      
+0008e370: 2020 6c69 6e65 5f6c 7374 2e61 7070 656e    line_lst.appen
+0008e380: 6428 672e 7175 616c 202b 2027 5c6e 2729  d(g.qual + '\n')
+0008e390: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0008e3a0: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
+0008e3b0: 696e 7428 272e 272c 2065 6e64 3d27 272c  int('.', end='',
+0008e3c0: 2066 6c75 7368 3d54 7275 6529 0a0a 2020   flush=True)..  
+0008e3d0: 2020 662e 7772 6974 656c 696e 6573 2827    f.writelines('
+0008e3e0: 272e 6a6f 696e 286c 696e 655f 6c73 7429  '.join(line_lst)
+0008e3f0: 290a 2020 2020 2020 2020 0a20 2020 2070  ).        .    p
+0008e400: 7269 6e74 2827 5c72 5361 7669 6e67 2025  rint('\rSaving %
+0008e410: 7320 2e2e 2064 6f6e 652e 2028 2569 2920  s .. done. (%i) 
+0008e420: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0008e430: 2025 2028 7469 746c 652c 206c 656e 284b   % (title, len(K
+0008e440: 6579 7329 292c 2066 6c75 7368 3d54 7275  eys)), flush=Tru
+0008e450: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
+0008e460: 0a20 2020 200a 0a20 2020 200a 6465 6620  .    ..    .def 
+0008e470: 6661 7374 615f 7369 6d5f 7265 6164 5f73  fasta_sim_read_s
+0008e480: 706c 6974 2820 7369 6d5f 7265 6164 2c20  plit( sim_read, 
+0008e490: 6473 7220 3d20 3120 293a 0a20 2020 200a  dsr = 1 ):.    .
+0008e4a0: 2020 2020 666e 616d 652c 2065 7874 203d      fname, ext =
+0008e4b0: 2067 6574 5f70 6174 685f 6e61 6d65 2873   get_path_name(s
+0008e4c0: 696d 5f72 6561 6429 0a0a 2020 2020 6661  im_read)..    fa
+0008e4d0: 5f61 6c6c 203d 206c 6f61 645f 6661 7374  _all = load_fast
+0008e4e0: 7128 7369 6d5f 7265 6164 290a 2020 2020  q(sim_read).    
+0008e4f0: 0a20 2020 2066 6131 203d 207b 7d0a 2020  .    fa1 = {}.  
+0008e500: 2020 6661 3220 3d20 7b7d 0a20 2020 2063    fa2 = {}.    c
+0008e510: 6e74 203d 2030 0a20 2020 2063 6e74 5f31  nt = 0.    cnt_1
+0008e520: 203d 2030 0a20 2020 2063 6e74 5f32 203d   = 0.    cnt_2 =
+0008e530: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
+0008e540: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
+0008e550: 0a20 2020 2020 2020 2066 615f 616c 6c5b  .        fa_all[
+0008e560: 6b65 795d 2e68 6561 6465 7220 3d20 6661  key].header = fa
+0008e570: 5f61 6c6c 5b6b 6579 5d2e 6865 6164 6572  _all[key].header
+0008e580: 5b3a 2d34 5d0a 2020 2020 2020 2020 6966  [:-4].        if
+0008e590: 2063 6e74 2532 203d 3d20 303a 0a20 2020   cnt%2 == 0:.   
+0008e5a0: 2020 2020 2020 2020 2069 6620 636e 745f           if cnt_
+0008e5b0: 3125 6473 7220 3d3d 2030 3a0a 2020 2020  1%dsr == 0:.    
+0008e5c0: 2020 2020 2020 2020 2020 2020 6661 5f61              fa_a
+0008e5d0: 6c6c 5b6b 6579 5d2e 6865 6164 6572 203d  ll[key].header =
+0008e5e0: 2066 615f 616c 6c5b 6b65 795d 2e68 6561   fa_all[key].hea
+0008e5f0: 6465 722e 7370 6c69 7428 2720 2729 5b30  der.split(' ')[0
+0008e600: 5d20 2b20 272f 3127 0a20 2020 2020 2020  ] + '/1'.       
+0008e610: 2020 2020 2020 2020 2066 6131 5b6b 6579           fa1[key
+0008e620: 5d20 3d20 6661 5f61 6c6c 5b6b 6579 5d0a  ] = fa_all[key].
+0008e630: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+0008e640: 3120 2b3d 2031 0a20 2020 2020 2020 2065  1 += 1.        e
+0008e650: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0008e660: 2069 6620 636e 745f 3225 6473 7220 3d3d   if cnt_2%dsr ==
+0008e670: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0008e680: 2020 2020 6661 5f61 6c6c 5b6b 6579 5d2e      fa_all[key].
+0008e690: 6865 6164 6572 203d 2066 615f 616c 6c5b  header = fa_all[
+0008e6a0: 6b65 795d 2e68 6561 6465 722e 7370 6c69  key].header.spli
+0008e6b0: 7428 2720 2729 5b30 5d20 2b20 272f 3227  t(' ')[0] + '/2'
+0008e6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008e6d0: 2066 6132 5b6b 6579 5d20 3d20 6661 5f61   fa2[key] = fa_a
+0008e6e0: 6c6c 5b6b 6579 5d0a 2020 2020 2020 2020  ll[key].        
+0008e6f0: 2020 2020 636e 745f 3220 2b3d 2031 0a0a      cnt_2 += 1..
+0008e700: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
+0008e710: 0a0a 2020 2020 6966 2064 7372 203d 3d20  ..    if dsr == 
+0008e720: 313a 0a20 2020 2020 2020 2066 6e31 203d  1:.        fn1 =
+0008e730: 2066 6e61 6d65 202b 2027 5f31 2e27 202b   fname + '_1.' +
+0008e740: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
+0008e750: 203d 2066 6e61 6d65 202b 2027 5f32 2e27   = fname + '_2.'
+0008e760: 202b 2065 7874 0a20 2020 2065 6c73 653a   + ext.    else:
+0008e770: 0a20 2020 2020 2020 2066 6e31 203d 2066  .        fn1 = f
+0008e780: 6e61 6d65 202b 2028 275f 6473 2569 2720  name + ('_ds%i' 
+0008e790: 2520 6473 7229 202b 2027 5f31 2e27 202b  % dsr) + '_1.' +
+0008e7a0: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
+0008e7b0: 203d 2066 6e61 6d65 202b 2028 275f 6473   = fname + ('_ds
+0008e7c0: 2569 2720 2520 6473 7229 202b 2027 5f32  %i' % dsr) + '_2
+0008e7d0: 2e27 202b 2065 7874 0a20 2020 2073 6176  .' + ext.    sav
+0008e7e0: 655f 6661 7374 7128 666e 312c 2066 6131  e_fastq(fn1, fa1
+0008e7f0: 290a 2020 2020 7361 7665 5f66 6173 7471  ).    save_fastq
+0008e800: 2866 6e32 2c20 6661 3229 0a20 2020 200a  (fn2, fa2).    .
+0008e810: 0a64 6566 2066 6173 7461 5f73 696d 5f72  .def fasta_sim_r
+0008e820: 6561 645f 646f 776e 7361 6d70 6c65 2820  ead_downsample( 
+0008e830: 7369 6d5f 7265 6164 2c20 6473 7220 3d20  sim_read, dsr = 
+0008e840: 3120 293a 0a20 2020 200a 2020 2020 666e  1 ):.    .    fn
+0008e850: 616d 652c 2065 7874 203d 2067 6574 5f70  ame, ext = get_p
+0008e860: 6174 685f 6e61 6d65 2873 696d 5f72 6561  ath_name(sim_rea
+0008e870: 6429 0a0a 2020 2020 6661 5f61 6c6c 203d  d)..    fa_all =
+0008e880: 206c 6f61 645f 6661 7374 7128 7369 6d5f   load_fastq(sim_
+0008e890: 7265 6164 290a 2020 2020 0a20 2020 2066  read).    .    f
+0008e8a0: 6120 3d20 7b7d 0a20 2020 2063 6e74 203d  a = {}.    cnt =
+0008e8b0: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
+0008e8c0: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
+0008e8d0: 0a20 2020 2020 2020 2023 2066 615f 616c  .        # fa_al
+0008e8e0: 6c5b 6b65 795d 2e68 6561 6465 7220 3d20  l[key].header = 
+0008e8f0: 6661 5f61 6c6c 5b6b 6579 5d2e 6865 6164  fa_all[key].head
+0008e900: 6572 5b3a 2d34 5d0a 2020 2020 2020 2020  er[:-4].        
+0008e910: 6966 2063 6e74 2564 7372 203d 3d20 303a  if cnt%dsr == 0:
+0008e920: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
+0008e930: 615f 616c 6c5b 6b65 795d 2e68 6561 6465  a_all[key].heade
+0008e940: 7220 3d20 6661 5f61 6c6c 5b6b 6579 5d2e  r = fa_all[key].
+0008e950: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+0008e960: 2020 2066 615b 6b65 795d 203d 2066 615f     fa[key] = fa_
+0008e970: 616c 6c5b 6b65 795d 0a20 2020 2020 2020  all[key].       
+0008e980: 2063 6e74 202b 3d20 310a 0a20 2020 2066   cnt += 1..    f
+0008e990: 6e20 3d20 666e 616d 6520 2b20 2827 5f64  n = fname + ('_d
+0008e9a0: 7325 692e 2720 2520 6473 7229 202b 2065  s%i.' % dsr) + e
+0008e9b0: 7874 0a20 2020 2073 6176 655f 6661 7374  xt.    save_fast
+0008e9c0: 7128 666e 2c20 6661 290a 2020 2020 0a20  q(fn, fa).    . 
+0008e9d0: 2020 200a 2323 2323 2323 2323 2323 2323     .############
+0008e9e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008e9f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008ea00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008ea10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea50: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
-0008ea60: 6f6e 7320 746f 2061 6464 2053 4e56 2069  ons to add SNV i
-0008ea70: 6e74 6f20 6120 6765 6e6f 6d65 0a23 2323  nto a genome.###
+0008ea20: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
+0008ea30: 6f6e 7320 746f 2061 6464 2053 4e56 2069  ons to add SNV i
+0008ea40: 6e74 6f20 6120 6765 6e6f 6d65 0a23 2323  nto a genome.###
+0008ea50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008ea60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008ea70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008ea80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008eaa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008eab0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008eac0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-0008ead0: 0a53 4e56 203d 2063 6f6c 6c65 6374 696f  .SNV = collectio
-0008eae0: 6e73 2e6e 616d 6564 7475 706c 6528 2753  ns.namedtuple('S
-0008eaf0: 4e56 272c 2027 6368 722c 2070 6f73 5f6e  NV', 'chr, pos_n
-0008eb00: 6577 2c20 706f 735f 6f72 672c 2074 7970  ew, pos_org, typ
-0008eb10: 652c 206c 656e 2c20 7365 715f 6e65 772c  e, len, seq_new,
-0008eb20: 2073 6571 5f6f 7267 2c20 6578 5f73 7461   seq_org, ex_sta
-0008eb30: 7274 2c20 6578 5f65 6e64 2729 0a0a 6465  rt, ex_end')..de
-0008eb40: 6620 6765 745f 736e 765f 7479 7065 2870  f get_snv_type(p
-0008eb50: 692c 2070 6429 3a0a 2020 2020 0a20 2020  i, pd):.    .   
-0008eb60: 2072 6e20 3d20 6e70 2e72 616e 646f 6d2e   rn = np.random.
-0008eb70: 756e 6966 6f72 6d28 3130 3029 0a20 2020  uniform(100).   
-0008eb80: 2069 6620 726e 203c 2028 7069 2a31 3030   if rn < (pi*100
-0008eb90: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0008eba0: 6e28 3129 0a20 2020 2065 6c69 6620 726e  n(1).    elif rn
-0008ebb0: 203c 2028 7069 2b70 6929 2a31 3030 3a0a   < (pi+pi)*100:.
-0008ebc0: 2020 2020 2020 2020 7265 7475 726e 2832          return(2
-0008ebd0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-0008ebe0: 2020 2020 7265 7475 726e 2830 290a 2020      return(0).  
-0008ebf0: 2020 0a64 6566 2072 616e 645f 6e75 636c    .def rand_nucl
-0008ec00: 656f 7469 6465 5f65 7863 6570 7428 6e74  eotide_except(nt
-0008ec10: 7329 3a0a 2020 2020 0a20 2020 206e 7473  s):.    .    nts
-0008ec20: 5f6f 7574 203d 2027 270a 2020 2020 666f  _out = ''.    fo
-0008ec30: 7220 6e74 2069 6e20 6e74 733a 0a20 2020  r nt in nts:.   
-0008ec40: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-0008ec50: 0a20 2020 2020 2020 2020 2020 2072 6e20  .            rn 
-0008ec60: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-0008ec70: 696e 7428 302c 342c 3129 5b30 5d0a 2020  int(0,4,1)[0].  
-0008ec80: 2020 2020 2020 2020 2020 6e74 5f6e 6577            nt_new
-0008ec90: 203d 204e 545f 6c73 745b 696e 7428 726e   = NT_lst[int(rn
-0008eca0: 295d 0a20 2020 2020 2020 2020 2020 2069  )].            i
-0008ecb0: 6620 6e74 5f6e 6577 2021 3d20 6e74 3a20  f nt_new != nt: 
-0008ecc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008ecd0: 206e 7473 5f6f 7574 203d 206e 7473 5f6f   nts_out = nts_o
-0008ece0: 7574 202b 206e 745f 6e65 770a 2020 2020  ut + nt_new.    
-0008ecf0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0008ed00: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0008ed10: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-0008ed20: 6e28 6e74 735f 6f75 7429 0a20 2020 2020  n(nts_out).     
-0008ed30: 2020 200a 6465 6620 7261 6e64 5f6e 7563     .def rand_nuc
-0008ed40: 6c65 6f74 6964 6573 286e 756d 293a 0a20  leotides(num):. 
-0008ed50: 2020 200a 2020 2020 6e75 6d5f 7365 7120     .    num_seq 
-0008ed60: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-0008ed70: 696e 7428 302c 342c 6e75 6d29 0a20 2020  int(0,4,num).   
-0008ed80: 206e 745f 7374 7220 3d20 2727 2e6a 6f69   nt_str = ''.joi
-0008ed90: 6e28 5b4e 545f 6c73 745b 6e5d 2066 6f72  n([NT_lst[n] for
-0008eda0: 206e 2069 6e20 6e75 6d5f 7365 715d 290a   n in num_seq]).
-0008edb0: 2020 2020 7265 7475 726e 286e 745f 7374      return(nt_st
-0008edc0: 7229 0a0a 0a64 6566 2073 6176 655f 736e  r)...def save_sn
-0008edd0: 765f 696e 666f 5f6f 6c64 2820 6669 6c65  v_info_old( file
-0008ede0: 5f6e 616d 652c 2073 6e76 5f6c 7374 2c20  _name, snv_lst, 
-0008edf0: 7665 7262 6f73 6520 3d20 4661 6c73 6520  verbose = False 
-0008ee00: 293a 0a20 2020 200a 2020 2020 6620 3d20  ):.    .    f = 
-0008ee10: 6f70 656e 2866 696c 655f 6e61 6d65 2c20  open(file_name, 
-0008ee20: 2777 742b 2729 0a20 2020 2070 7269 6e74  'wt+').    print
-0008ee30: 2827 5361 7669 6e67 2053 4e56 2069 6e66  ('Saving SNV inf
-0008ee40: 6f2e 2027 2c20 656e 643d 2727 290a 2020  o. ', end='').  
-0008ee50: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
-0008ee60: 286c 656e 2873 6e76 5f6c 7374 292f 3230  (len(snv_lst)/20
-0008ee70: 290a 2020 2020 666f 7220 6b20 696e 2072  ).    for k in r
-0008ee80: 616e 6765 286c 656e 2873 6e76 5f6c 7374  ange(len(snv_lst
-0008ee90: 2929 203a 0a20 2020 2020 2020 2073 6e76  )) :.        snv
-0008eea0: 203d 2073 6e76 5f6c 7374 5b6b 5d0a 2020   = snv_lst[k].  
-0008eeb0: 2020 2020 2020 7320 3d20 2725 732c 2569        s = '%s,%i
-0008eec0: 2c25 692c 2573 2c25 692c 2573 2c25 735c  ,%i,%s,%i,%s,%s\
-0008eed0: 6e27 2025 205c 0a20 2020 2020 2020 2028  n' % \.        (
-0008eee0: 736e 762e 6368 722c 2073 6e76 2e70 6f73  snv.chr, snv.pos
-0008eef0: 5f6e 6577 2c20 736e 762e 706f 735f 6f72  _new, snv.pos_or
-0008ef00: 672c 2073 6e76 2e74 7970 652c 2073 6e76  g, snv.type, snv
-0008ef10: 2e6c 656e 2c20 736e 762e 7365 715f 6e65  .len, snv.seq_ne
-0008ef20: 772c 2073 6e76 2e73 6571 5f6f 7267 2029  w, snv.seq_org )
-0008ef30: 0a20 2020 2020 2020 2066 2e77 7269 7465  .        f.write
-0008ef40: 6c69 6e65 7328 7329 0a20 2020 2020 2020  lines(s).       
-0008ef50: 2069 6620 6b25 7374 6570 203d 3d20 303a   if k%step == 0:
-0008ef60: 2070 7269 6e74 2827 2e27 2c65 6e64 3d27   print('.',end='
-0008ef70: 2729 0a20 2020 2020 2020 200a 2020 2020  ').        .    
-0008ef80: 7072 696e 7428 2720 646f 6e65 2e20 2569  print(' done. %i
-0008ef90: 2073 6e76 732e 2720 2520 6c65 6e28 736e   snvs.' % len(sn
-0008efa0: 765f 6c73 7429 2029 0a20 2020 2066 2e63  v_lst) ).    f.c
-0008efb0: 6c6f 7365 2829 0a0a 2020 2020 0a64 6566  lose()..    .def
-0008efc0: 2073 6176 655f 736e 765f 696e 666f 2820   save_snv_info( 
-0008efd0: 6669 6c65 5f6e 616d 652c 2073 6e76 5f6c  file_name, snv_l
-0008efe0: 7374 2c20 7665 7262 6f73 6520 3d20 4661  st, verbose = Fa
-0008eff0: 6c73 6520 293a 0a0a 2020 2020 6466 203d  lse ):..    df =
-0008f000: 2070 642e 4461 7461 4672 616d 6528 736e   pd.DataFrame(sn
-0008f010: 765f 6c73 7429 0a20 2020 2064 662e 746f  v_lst).    df.to
-0008f020: 5f63 7376 2866 696c 655f 6e61 6d65 2c20  _csv(file_name, 
-0008f030: 696e 6465 783d 4661 6c73 652c 2073 6570  index=False, sep
-0008f040: 3d27 5c74 2729 0a0a 2020 2020 0a64 6566  ='\t')..    .def
-0008f050: 2067 656e 6572 6174 655f 736e 765f 7769   generate_snv_wi
-0008f060: 7468 5f67 7466 2820 6765 6e6f 6d65 2c20  th_gtf( genome, 
-0008f070: 6774 665f 6c69 6e65 735f 736f 7274 6564  gtf_lines_sorted
-0008f080: 2c20 6d75 203d 2032 3030 2c20 6c69 203d  , mu = 200, li =
-0008f090: 2033 2c20 6c64 203d 2033 2c20 6c76 203d   3, ld = 3, lv =
-0008f0a0: 2032 2c20 7069 203d 2030 2e31 2c20 7064   2, pi = 0.1, pd
-0008f0b0: 203d 2030 2e31 2029 3a0a 2020 2020 0a20   = 0.1 ):.    . 
-0008f0c0: 2020 2070 7620 3d20 3120 2d20 7069 202d     pv = 1 - pi -
-0008f0d0: 2070 640a 2020 2020 7072 696e 7428 6765   pd.    print(ge
-0008f0e0: 6e6f 6d65 2e6e 616d 652c 2065 6e64 3d27  nome.name, end='
-0008f0f0: 2027 290a 2020 2020 736e 765f 6c73 7420   ').    snv_lst 
-0008f100: 3d20 5b5d 0a20 2020 2063 7572 5f70 6f73  = [].    cur_pos
-0008f110: 5f6f 7267 203d 2030 0a20 2020 2063 7572  _org = 0.    cur
-0008f120: 5f70 6f73 5f6e 6577 203d 2063 7572 5f70  _pos_new = cur_p
-0008f130: 6f73 5f6f 7267 0a20 2020 2073 6571 5f6e  os_org.    seq_n
-0008f140: 6577 203d 2027 270a 2020 2020 7365 715f  ew = ''.    seq_
-0008f150: 6c73 7420 3d20 5b5d 0a20 2020 204d 6172  lst = [].    Mar
-0008f160: 6769 6e20 3d20 6d61 7828 6c69 2c6d 6178  gin = max(li,max
-0008f170: 286c 642c 6c76 2929 0a20 2020 200a 2020  (ld,lv)).    .  
-0008f180: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
-0008f190: 2867 656e 6f6d 652e 6c65 6e2f 6d75 2f32  (genome.len/mu/2
-0008f1a0: 3030 290a 2020 2020 0a20 2020 2063 6e74  00).    .    cnt
-0008f1b0: 203d 2030 0a20 2020 2066 6f72 206c 696e   = 0.    for lin
-0008f1c0: 6520 696e 2067 7466 5f6c 696e 6573 5f73  e in gtf_lines_s
-0008f1d0: 6f72 7465 643a 0a20 2020 2020 2020 200a  orted:.        .
-0008f1e0: 2020 2020 2020 2020 2320 6469 6666 203d          # diff =
-0008f1f0: 2063 7572 5f70 6f73 5f6e 6577 202d 2063   cur_pos_new - c
-0008f200: 7572 5f70 6f73 5f6f 7267 0a20 2020 2020  ur_pos_org.     
-0008f210: 2020 2053 7461 7274 203d 206c 696e 652e     Start = line.
-0008f220: 7374 6172 740a 2020 2020 2020 2020 456e  start.        En
-0008f230: 6420 3d20 6c69 6e65 2e65 6e64 0a20 2020  d = line.end.   
-0008f240: 2020 2020 204c 203d 206e 702e 7261 6e64       L = np.rand
-0008f250: 6f6d 2e72 616e 6469 6e74 2830 2c6d 752f  om.randint(0,mu/
-0008f260: 322c 3129 5b30 5d0a 2020 2020 2020 2020  2,1)[0].        
-0008f270: 6966 2063 7572 5f70 6f73 5f6f 7267 203c  if cur_pos_org <
-0008f280: 2028 6c69 6e65 2e73 7461 7274 2d31 2b4c   (line.start-1+L
-0008f290: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0008f2a0: 6578 745f 706f 735f 6f72 6720 3d20 6c69  ext_pos_org = li
-0008f2b0: 6e65 2e73 7461 7274 2d31 2b4c 0a20 2020  ne.start-1+L.   
-0008f2c0: 2020 2020 2020 2020 2073 6571 5f6c 7374           seq_lst
-0008f2d0: 2e61 7070 656e 6428 6765 6e6f 6d65 2e73  .append(genome.s
-0008f2e0: 6571 5b69 6e74 2863 7572 5f70 6f73 5f6f  eq[int(cur_pos_o
-0008f2f0: 7267 293a 696e 7428 6e65 7874 5f70 6f73  rg):int(next_pos
-0008f300: 5f6f 7267 295d 290a 2020 2020 2020 2020  _org)]).        
-0008f310: 2020 2020 6375 725f 706f 735f 6e65 7720      cur_pos_new 
-0008f320: 2b3d 2028 6e65 7874 5f70 6f73 5f6f 7267  += (next_pos_org
-0008f330: 2d63 7572 5f70 6f73 5f6f 7267 290a 2020  -cur_pos_org).  
-0008f340: 2020 2020 2020 2020 2020 6375 725f 706f            cur_po
-0008f350: 735f 6f72 6720 3d20 6e65 7874 5f70 6f73  s_org = next_pos
-0008f360: 5f6f 7267 0a20 2020 2020 2020 200a 2020  _org.        .  
-0008f370: 2020 2020 2020 7768 696c 6520 2863 7572        while (cur
-0008f380: 5f70 6f73 5f6f 7267 203c 2028 6c69 6e65  _pos_org < (line
-0008f390: 2e65 6e64 2d4d 6172 6769 6e29 2920 2620  .end-Margin)) & 
-0008f3a0: 2863 7572 5f70 6f73 5f6f 7267 203e 2028  (cur_pos_org > (
-0008f3b0: 6c69 6e65 2e73 7461 7274 2b4d 6172 6769  line.start+Margi
-0008f3c0: 6e29 293a 0a0a 2020 2020 2020 2020 2020  n)):..          
-0008f3d0: 2020 736e 765f 7479 7065 203d 2067 6574    snv_type = get
-0008f3e0: 5f73 6e76 5f74 7970 6528 7069 2c20 7076  _snv_type(pi, pv
-0008f3f0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0008f400: 6620 736e 765f 7479 7065 203d 3d20 313a  f snv_type == 1:
-0008f410: 2023 2049 6e73 6572 7469 6f6e 0a20 2020   # Insertion.   
-0008f420: 2020 2020 2020 2020 2020 2020 206e 203d               n =
-0008f430: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
-0008f440: 6e74 2830 2c6c 692c 2031 295b 305d 2b31  nt(0,li, 1)[0]+1
-0008f450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008f460: 2073 6571 5f66 7261 6720 3d20 7261 6e64   seq_frag = rand
-0008f470: 5f6e 7563 6c65 6f74 6964 6573 286e 290a  _nucleotides(n).
-0008f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f490: 2320 7365 715f 6e65 7720 3d20 7365 715f  # seq_new = seq_
-0008f4a0: 6e65 7720 2b20 7365 715f 6672 6167 0a20  new + seq_frag. 
-0008f4b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f4c0: 6571 5f6c 7374 2e61 7070 656e 6428 7365  eq_lst.append(se
-0008f4d0: 715f 6672 6167 290a 2020 2020 2020 2020  q_frag).        
-0008f4e0: 2020 2020 2020 2020 736e 7620 3d20 534e          snv = SN
-0008f4f0: 5628 2067 656e 6f6d 652e 6e61 6d65 2c20  V( genome.name, 
-0008f500: 6375 725f 706f 735f 6e65 772b 312c 2063  cur_pos_new+1, c
-0008f510: 7572 5f70 6f73 5f6f 7267 2b31 2c20 2749  ur_pos_org+1, 'I
-0008f520: 272c 206e 2c20 7365 715f 6672 6167 2c20  ', n, seq_frag, 
-0008f530: 272d 272c 2053 7461 7274 2c20 456e 6420  '-', Start, End 
-0008f540: 2920 2320 6d61 6b65 2069 7420 6f6e 652d  ) # make it one-
-0008f550: 6261 7365 2070 6f73 6974 696f 6e0a 2020  base position.  
-0008f560: 2020 2020 2020 2020 2020 2020 2020 736e                sn
-0008f570: 765f 6c73 742e 6170 7065 6e64 2873 6e76  v_lst.append(snv
-0008f580: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0008f590: 2020 6375 725f 706f 735f 6e65 7720 2b3d    cur_pos_new +=
-0008f5a0: 206c 656e 2873 6571 5f66 7261 6729 0a0a   len(seq_frag)..
-0008f5b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0008f5c0: 2073 6e76 5f74 7970 6520 3d3d 2032 3a20   snv_type == 2: 
-0008f5d0: 2320 4465 6c65 7469 6f6e 0a20 2020 2020  # Deletion.     
-0008f5e0: 2020 2020 2020 2020 2020 206e 203d 206e             n = n
-0008f5f0: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
-0008f600: 2830 2c6c 642c 2031 295b 305d 2b31 0a20  (0,ld, 1)[0]+1. 
-0008f610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f620: 6571 5f66 7261 6720 3d20 6765 6e6f 6d65  eq_frag = genome
-0008f630: 2e73 6571 5b69 6e74 2863 7572 5f70 6f73  .seq[int(cur_pos
-0008f640: 5f6f 7267 293a 696e 7428 6375 725f 706f  _org):int(cur_po
-0008f650: 735f 6f72 672b 6e29 5d0a 2020 2020 2020  s_org+n)].      
-0008f660: 2020 2020 2020 2020 2020 736e 7620 3d20            snv = 
-0008f670: 534e 5628 2067 656e 6f6d 652e 6e61 6d65  SNV( genome.name
-0008f680: 2c20 6375 725f 706f 735f 6e65 772b 312c  , cur_pos_new+1,
-0008f690: 2063 7572 5f70 6f73 5f6f 7267 2b31 2c20   cur_pos_org+1, 
-0008f6a0: 2744 272c 206e 2c20 272d 272c 2073 6571  'D', n, '-', seq
-0008f6b0: 5f66 7261 672c 2053 7461 7274 2c20 456e  _frag, Start, En
-0008f6c0: 6420 2920 2320 6d61 6b65 2069 7420 6f6e  d ) # make it on
-0008f6d0: 652d 6261 7365 2070 6f73 6974 696f 6e0a  e-base position.
-0008f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f6f0: 736e 765f 6c73 742e 6170 7065 6e64 2873  snv_lst.append(s
-0008f700: 6e76 290a 2020 2020 2020 2020 2020 2020  nv).            
-0008f710: 2020 2020 6375 725f 706f 735f 6f72 6720      cur_pos_org 
-0008f720: 2b3d 206e 0a0a 2020 2020 2020 2020 2020  += n..          
-0008f730: 2020 656c 7365 3a20 2320 534e 500a 2020    else: # SNP.  
-0008f740: 2020 2020 2020 2020 2020 2020 2020 6e20                n 
-0008f750: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-0008f760: 696e 7428 302c 6c76 2c20 3129 5b30 5d2b  int(0,lv, 1)[0]+
-0008f770: 3120 2020 2020 2020 200a 2020 2020 2020  1        .      
-0008f780: 2020 2020 2020 2020 2020 7365 715f 746d            seq_tm
-0008f790: 7020 3d20 6765 6e6f 6d65 2e73 6571 5b69  p = genome.seq[i
-0008f7a0: 6e74 2863 7572 5f70 6f73 5f6f 7267 293a  nt(cur_pos_org):
-0008f7b0: 696e 7428 6375 725f 706f 735f 6f72 672b  int(cur_pos_org+
-0008f7c0: 6e29 5d0a 2020 2020 2020 2020 2020 2020  n)].            
-0008f7d0: 2020 2020 7365 715f 6672 6167 203d 2072      seq_frag = r
-0008f7e0: 616e 645f 6e75 636c 656f 7469 6465 5f65  and_nucleotide_e
-0008f7f0: 7863 6570 7428 7365 715f 746d 7029 0a20  xcept(seq_tmp). 
-0008f800: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0008f810: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
-0008f820: 6577 202b 2073 6571 5f66 7261 670a 2020  ew + seq_frag.  
-0008f830: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0008f840: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
-0008f850: 5f66 7261 6729 0a20 2020 2020 2020 2020  _frag).         
-0008f860: 2020 2020 2020 2073 6e76 203d 2053 4e56         snv = SNV
-0008f870: 2820 6765 6e6f 6d65 2e6e 616d 652c 2063  ( genome.name, c
-0008f880: 7572 5f70 6f73 5f6e 6577 2b31 2c20 6375  ur_pos_new+1, cu
-0008f890: 725f 706f 735f 6f72 672b 312c 2027 5627  r_pos_org+1, 'V'
-0008f8a0: 2c20 6e2c 2073 6571 5f66 7261 672c 2073  , n, seq_frag, s
-0008f8b0: 6571 5f74 6d70 2c20 5374 6172 742c 2045  eq_tmp, Start, E
-0008f8c0: 6e64 2029 2023 206d 616b 6520 6974 206f  nd ) # make it o
-0008f8d0: 6e65 2d62 6173 6520 706f 7369 7469 6f6e  ne-base position
-0008f8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008f8f0: 2073 6e76 5f6c 7374 2e61 7070 656e 6428   snv_lst.append(
-0008f900: 736e 7629 0a20 2020 2020 2020 2020 2020  snv).           
-0008f910: 2020 2020 2063 7572 5f70 6f73 5f6e 6577       cur_pos_new
-0008f920: 202b 3d20 6e0a 2020 2020 2020 2020 2020   += n.          
-0008f930: 2020 2020 2020 6375 725f 706f 735f 6f72        cur_pos_or
-0008f940: 6720 2b3d 206e 0a0a 2020 2020 2020 2020  g += n..        
-0008f950: 2020 2020 4c20 3d20 6e70 2e72 616e 646f      L = np.rando
-0008f960: 6d2e 7261 6e64 696e 7428 3230 2c6d 752c  m.randint(20,mu,
-0008f970: 3129 5b30 5d20 2320 7365 7061 7261 7465  1)[0] # separate
-0008f980: 2053 4e56 2061 7420 6c65 6173 7420 3230   SNV at least 20
-0008f990: 2062 6173 6573 0a20 2020 2020 2020 2020   bases.         
-0008f9a0: 2020 206e 6578 745f 706f 735f 6f72 6720     next_pos_org 
-0008f9b0: 3d20 6375 725f 706f 735f 6f72 6720 2b20  = cur_pos_org + 
-0008f9c0: 4c0a 2020 2020 2020 2020 2020 2020 6966  L.            if
-0008f9d0: 206e 6578 745f 706f 735f 6f72 6720 3e3d   next_pos_org >=
-0008f9e0: 206c 696e 652e 656e 643a 2023 2028 6765   line.end: # (ge
-0008f9f0: 6e6f 6d65 2e6c 656e 2d31 3030 293a 0a20  nome.len-100):. 
-0008fa00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0008fa10: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
-0008fa20: 6577 202b 2067 656e 6f6d 652e 7365 715b  ew + genome.seq[
-0008fa30: 696e 7428 6375 725f 706f 735f 6f72 6729  int(cur_pos_org)
-0008fa40: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-0008fa50: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
-0008fa60: 6428 6765 6e6f 6d65 2e73 6571 5b69 6e74  d(genome.seq[int
-0008fa70: 2863 7572 5f70 6f73 5f6f 7267 293a 286c  (cur_pos_org):(l
-0008fa80: 696e 652e 656e 642b 3129 5d29 0a20 2020  ine.end+1)]).   
-0008fa90: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0008faa0: 5f70 6f73 5f6e 6577 202b 3d20 2828 6c69  _pos_new += ((li
-0008fab0: 6e65 2e65 6e64 2b31 292d 6375 725f 706f  ne.end+1)-cur_po
-0008fac0: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
-0008fad0: 2020 2020 2020 2063 7572 5f70 6f73 5f6f         cur_pos_o
-0008fae0: 7267 203d 2028 6c69 6e65 2e65 6e64 2b31  rg = (line.end+1
-0008faf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0008fb00: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0008fb10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0008fb20: 2020 2020 2020 2020 2020 2320 7365 715f            # seq_
-0008fb30: 6e65 7720 3d20 7365 715f 6e65 7720 2b20  new = seq_new + 
-0008fb40: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
-0008fb50: 7572 5f70 6f73 5f6f 7267 293a 696e 7428  ur_pos_org):int(
-0008fb60: 6e65 7874 5f70 6f73 5f6f 7267 295d 0a20  next_pos_org)]. 
-0008fb70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008fb80: 6571 5f6c 7374 2e61 7070 656e 6428 6765  eq_lst.append(ge
-0008fb90: 6e6f 6d65 2e73 6571 5b69 6e74 2863 7572  nome.seq[int(cur
-0008fba0: 5f70 6f73 5f6f 7267 293a 696e 7428 6e65  _pos_org):int(ne
-0008fbb0: 7874 5f70 6f73 5f6f 7267 295d 290a 2020  xt_pos_org)]).  
-0008fbc0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0008fbd0: 725f 706f 735f 6e65 7720 2b3d 2028 6e65  r_pos_new += (ne
-0008fbe0: 7874 5f70 6f73 5f6f 7267 2d63 7572 5f70  xt_pos_org-cur_p
-0008fbf0: 6f73 5f6f 7267 290a 2020 2020 2020 2020  os_org).        
-0008fc00: 2020 2020 2020 2020 6375 725f 706f 735f          cur_pos_
-0008fc10: 6f72 6720 3d20 6e65 7874 5f70 6f73 5f6f  org = next_pos_o
-0008fc20: 7267 0a20 2020 2020 2020 2020 2020 2063  rg.            c
-0008fc30: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008fc40: 2020 2020 6966 2063 6e74 2573 7465 7020      if cnt%step 
-0008fc50: 3d3d 2030 3a20 0a20 2020 2020 2020 2020  == 0: .         
-0008fc60: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-0008fc70: 2573 202d 2025 692c 2025 692c 2025 6920  %s - %i, %i, %i 
-0008fc80: 2720 2520 2867 656e 6f6d 652e 6e61 6d65  ' % (genome.name
-0008fc90: 2c20 6375 725f 706f 735f 6f72 672c 2067  , cur_pos_org, g
-0008fca0: 656e 6f6d 652e 6c65 6e2c 2063 7572 5f70  enome.len, cur_p
-0008fcb0: 6f73 5f6e 6577 292c 2065 6e64 3d27 2729  os_new), end='')
-0008fcc0: 0a20 2020 2020 2020 0a20 2020 2069 6620  .       .    if 
-0008fcd0: 6375 725f 706f 735f 6f72 6720 3c20 6765  cur_pos_org < ge
-0008fce0: 6e6f 6d65 2e6c 656e 3a0a 2020 2020 2020  nome.len:.      
-0008fcf0: 2020 7365 715f 6c73 742e 6170 7065 6e64    seq_lst.append
-0008fd00: 2867 656e 6f6d 652e 7365 715b 696e 7428  (genome.seq[int(
-0008fd10: 6375 725f 706f 735f 6f72 6729 3a5d 290a  cur_pos_org):]).
-0008fd20: 2020 2020 0a20 2020 2073 6571 5f6e 6577      .    seq_new
-0008fd30: 203d 2027 272e 6a6f 696e 2873 6571 5f6c   = ''.join(seq_l
-0008fd40: 7374 290a 2020 2020 2320 7375 6666 6978  st).    # suffix
-0008fd50: 203d 2027 2d4c 2569 2d49 2569 2d44 2569   = '-L%i-I%i-D%i
-0008fd60: 2d56 2569 2720 2520 286d 752c 6c69 2c6c  -V%i' % (mu,li,l
-0008fd70: 642c 6c76 290a 2020 2020 2320 6765 6e6f  d,lv).    # geno
-0008fd80: 6d65 5f6e 6577 203d 2047 656e 6f6d 6528  me_new = Genome(
-0008fd90: 2067 656e 6f6d 652e 6865 6164 6572 202b   genome.header +
-0008fda0: 2073 7566 6669 782c 2073 6571 5f6e 6577   suffix, seq_new
-0008fdb0: 2029 0a20 2020 2067 656e 6f6d 655f 6e65   ).    genome_ne
-0008fdc0: 7720 3d20 4765 6e6f 6d65 2820 6765 6e6f  w = Genome( geno
-0008fdd0: 6d65 2e68 6561 6465 722c 2073 6571 5f6e  me.header, seq_n
-0008fde0: 6577 2029 0a20 2020 2070 7269 6e74 2827  ew ).    print('
-0008fdf0: 2064 6f6e 652e 2729 0a20 2020 2020 2020   done.').       
-0008fe00: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
-0008fe10: 2867 656e 6f6d 655f 6e65 772c 2073 6e76  (genome_new, snv
-0008fe20: 5f6c 7374 290a 2020 2020 0a23 2323 2323  _lst).    .#####
-0008fe30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008fe40: 2323 2323 2323 2323 2323 230a 2323 2050  ###########.## P
-0008fe50: 6172 616d 6574 6572 7320 666f 7220 534e  arameters for SN
-0008fe60: 5620 6765 6e65 7261 7469 6f6e 0a0a 505f  V generation..P_
-0008fe70: 494e 5320 3d20 302e 3135 0a50 5f44 454c  INS = 0.15.P_DEL
-0008fe80: 203d 2030 2e31 350a 505f 534e 5020 3d20   = 0.15.P_SNP = 
-0008fe90: 3120 2d20 505f 494e 5320 2d20 505f 4445  1 - P_INS - P_DE
-0008fea0: 4c0a 0a4c 4920 3d20 330a 4c44 203d 2033  L..LI = 3.LD = 3
-0008feb0: 0a4c 5620 3d20 320a 4c5f 494e 5445 525f  .LV = 2.L_INTER_
-0008fec0: 534e 5620 3d20 3230 300a 0a23 2323 2323  SNV = 200..#####
-0008fed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008fee0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-0008fef0: 2067 656e 6572 6174 655f 736e 7628 6765   generate_snv(ge
-0008ff00: 6e6f 6d65 2c20 6774 665f 6c69 6e65 732c  nome, gtf_lines,
-0008ff10: 206c 5f69 6e74 6572 5f73 6e76 203d 204c   l_inter_snv = L
-0008ff20: 5f49 4e54 4552 5f53 4e56 2c20 5c0a 2020  _INTER_SNV, \.  
-0008ff30: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0008ff40: 6920 3d20 4c49 2c20 6c64 203d 204c 442c  i = LI, ld = LD,
-0008ff50: 206c 7620 3d20 4c56 2c20 7069 203d 2050   lv = LV, pi = P
-0008ff60: 5f49 4e53 2c20 7064 203d 2050 5f44 454c  _INS, pd = P_DEL
-0008ff70: 293a 0a20 2020 200a 2020 2020 7076 203d  ):.    .    pv =
-0008ff80: 2031 202d 2070 6920 2d20 7064 0a20 2020   1 - pi - pd.   
-0008ff90: 206e 702e 7261 6e64 6f6d 2e73 6565 6428   np.random.seed(
-0008ffa0: 3029 0a20 2020 2070 7269 6e74 2827 4765  0).    print('Ge
-0008ffb0: 6e65 7261 7469 6e67 2053 4e56 2027 2c65  nerating SNV ',e
-0008ffc0: 6e64 3d27 2729 0a20 2020 2046 6561 7475  nd='').    Featu
-0008ffd0: 7265 7320 3d20 6765 745f 636f 6c28 6774  res = get_col(gt
-0008ffe0: 665f 6c69 6e65 732c 2032 290a 2020 2020  f_lines, 2).    
-0008fff0: 7768 203d 2077 6869 6368 2820 4665 6174  wh = which( Feat
-00090000: 7572 6573 2c20 2765 786f 6e27 2029 0a20  ures, 'exon' ). 
-00090010: 2020 2067 7466 5f65 786f 6e73 203d 205b     gtf_exons = [
-00090020: 6774 665f 6c69 6e65 735b 775d 2066 6f72  gtf_lines[w] for
-00090030: 2077 2069 6e20 7768 5d20 0a0a 2020 2020   w in wh] ..    
-00090040: 2320 7072 696e 7428 6c65 6e28 4665 6174  # print(len(Feat
-00090050: 7572 6573 2929 0a20 2020 2043 6872 7320  ures)).    Chrs 
-00090060: 3d20 6765 745f 636f 6c28 6774 665f 6578  = get_col(gtf_ex
-00090070: 6f6e 732c 2030 290a 2020 2020 4368 725f  ons, 0).    Chr_
-00090080: 6e61 6d65 7320 3d20 736f 7274 6564 2873  names = sorted(s
-00090090: 6574 2843 6872 7329 290a 0a20 2020 2073  et(Chrs))..    s
-000900a0: 6e76 5f6c 7374 5f61 6c6c 203d 205b 5d0a  nv_lst_all = [].
-000900b0: 2020 2020 6765 6e6f 6d65 5f6e 6577 203d      genome_new =
-000900c0: 207b 7d0a 2020 2020 666f 7220 4368 7220   {}.    for Chr 
-000900d0: 696e 2043 6872 5f6e 616d 6573 3a0a 2020  in Chr_names:.  
-000900e0: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
-000900f0: 6620 4368 7220 696e 2067 656e 6f6d 652e  f Chr in genome.
-00090100: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-00090110: 2020 2020 7768 203d 2077 6869 6368 2820      wh = which( 
-00090120: 4368 7273 2c20 4368 7220 290a 2020 2020  Chrs, Chr ).    
-00090130: 2020 2020 2020 2020 6774 665f 6368 7220          gtf_chr 
-00090140: 3d20 5b67 7466 5f65 786f 6e73 5b77 5d20  = [gtf_exons[w] 
-00090150: 666f 7220 7720 696e 2077 685d 0a20 2020  for w in wh].   
-00090160: 2020 2020 2020 2020 2050 6f73 5f73 7461           Pos_sta
-00090170: 7274 203d 206e 702e 6172 7261 7928 2067  rt = np.array( g
-00090180: 6574 5f63 6f6c 2867 7466 5f63 6872 2c20  et_col(gtf_chr, 
-00090190: 3329 2029 0a20 2020 2020 2020 2020 2020  3) ).           
-000901a0: 206f 6472 203d 2050 6f73 5f73 7461 7274   odr = Pos_start
-000901b0: 2e61 7267 736f 7274 2829 0a0a 2020 2020  .argsort()..    
-000901c0: 2020 2020 2020 2020 6774 665f 6368 725f          gtf_chr_
-000901d0: 736f 7274 6564 203d 205b 5d0a 2020 2020  sorted = [].    
-000901e0: 2020 2020 2020 2020 7070 203d 2030 0a20          pp = 0. 
-000901f0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00090200: 2069 6e20 7261 6e67 6528 6c65 6e28 6774   in range(len(gt
-00090210: 665f 6368 7229 293a 0a20 2020 2020 2020  f_chr)):.       
-00090220: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-00090230: 6774 665f 6368 725b 6f64 725b 6b5d 5d0a  gtf_chr[odr[k]].
-00090240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090250: 6774 665f 6368 725f 736f 7274 6564 2e61  gtf_chr_sorted.a
-00090260: 7070 656e 6428 6c69 6e65 290a 2020 2020  ppend(line).    
-00090270: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00090280: 696e 652e 7374 6172 7420 3c20 7070 3a20  ine.start < pp: 
-00090290: 7072 696e 7428 6c69 6e65 290a 2020 2020  print(line).    
-000902a0: 2020 2020 2020 2020 2020 2020 7070 203d              pp =
-000902b0: 206c 696e 652e 7374 6172 740a 0a20 2020   line.start..   
-000902c0: 2020 2020 2020 2020 2067 6e6d 2c20 736e           gnm, sn
-000902d0: 765f 6c73 7420 3d20 6765 6e65 7261 7465  v_lst = generate
-000902e0: 5f73 6e76 5f77 6974 685f 6774 6628 2067  _snv_with_gtf( g
-000902f0: 656e 6f6d 655b 4368 725d 2c20 6774 665f  enome[Chr], gtf_
-00090300: 6368 725f 736f 7274 6564 2c20 6d75 203d  chr_sorted, mu =
-00090310: 206c 5f69 6e74 6572 5f73 6e76 2c20 5c0a   l_inter_snv, \.
-00090320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090350: 2020 6c69 203d 206c 692c 206c 6420 3d20    li = li, ld = 
-00090360: 6c64 2c20 6c76 203d 206c 762c 2070 6920  ld, lv = lv, pi 
-00090370: 3d20 7069 2c20 7064 203d 2070 6420 290a  = pi, pd = pd ).
-00090380: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
-00090390: 6c73 745f 616c 6c20 3d20 736e 765f 6c73  lst_all = snv_ls
-000903a0: 745f 616c 6c20 2b20 736e 765f 6c73 740a  t_all + snv_lst.
-000903b0: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
-000903c0: 6d65 5f6e 6577 5b43 6872 5d20 3d20 676e  me_new[Chr] = gn
-000903d0: 6d0a 2020 2020 200a 2020 2020 7265 7475  m.     .    retu
-000903e0: 726e 2867 656e 6f6d 655f 6e65 772c 2073  rn(genome_new, s
-000903f0: 6e76 5f6c 7374 5f61 6c6c 2c20 4665 6174  nv_lst_all, Feat
-00090400: 7572 6573 290a 2020 2020 0a23 2323 2323  ures).    .#####
+0008ea90: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0008eaa0: 0a53 4e56 203d 2063 6f6c 6c65 6374 696f  .SNV = collectio
+0008eab0: 6e73 2e6e 616d 6564 7475 706c 6528 2753  ns.namedtuple('S
+0008eac0: 4e56 272c 2027 6368 722c 2070 6f73 5f6e  NV', 'chr, pos_n
+0008ead0: 6577 2c20 706f 735f 6f72 672c 2074 7970  ew, pos_org, typ
+0008eae0: 652c 206c 656e 2c20 7365 715f 6e65 772c  e, len, seq_new,
+0008eaf0: 2073 6571 5f6f 7267 2c20 6578 5f73 7461   seq_org, ex_sta
+0008eb00: 7274 2c20 6578 5f65 6e64 2729 0a0a 6465  rt, ex_end')..de
+0008eb10: 6620 6765 745f 736e 765f 7479 7065 2870  f get_snv_type(p
+0008eb20: 692c 2070 6429 3a0a 2020 2020 0a20 2020  i, pd):.    .   
+0008eb30: 2072 6e20 3d20 6e70 2e72 616e 646f 6d2e   rn = np.random.
+0008eb40: 756e 6966 6f72 6d28 3130 3029 0a20 2020  uniform(100).   
+0008eb50: 2069 6620 726e 203c 2028 7069 2a31 3030   if rn < (pi*100
+0008eb60: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0008eb70: 6e28 3129 0a20 2020 2065 6c69 6620 726e  n(1).    elif rn
+0008eb80: 203c 2028 7069 2b70 6929 2a31 3030 3a0a   < (pi+pi)*100:.
+0008eb90: 2020 2020 2020 2020 7265 7475 726e 2832          return(2
+0008eba0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+0008ebb0: 2020 2020 7265 7475 726e 2830 290a 2020      return(0).  
+0008ebc0: 2020 0a64 6566 2072 616e 645f 6e75 636c    .def rand_nucl
+0008ebd0: 656f 7469 6465 5f65 7863 6570 7428 6e74  eotide_except(nt
+0008ebe0: 7329 3a0a 2020 2020 0a20 2020 206e 7473  s):.    .    nts
+0008ebf0: 5f6f 7574 203d 2027 270a 2020 2020 666f  _out = ''.    fo
+0008ec00: 7220 6e74 2069 6e20 6e74 733a 0a20 2020  r nt in nts:.   
+0008ec10: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+0008ec20: 0a20 2020 2020 2020 2020 2020 2072 6e20  .            rn 
+0008ec30: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+0008ec40: 696e 7428 302c 342c 3129 5b30 5d0a 2020  int(0,4,1)[0].  
+0008ec50: 2020 2020 2020 2020 2020 6e74 5f6e 6577            nt_new
+0008ec60: 203d 204e 545f 6c73 745b 696e 7428 726e   = NT_lst[int(rn
+0008ec70: 295d 0a20 2020 2020 2020 2020 2020 2069  )].            i
+0008ec80: 6620 6e74 5f6e 6577 2021 3d20 6e74 3a20  f nt_new != nt: 
+0008ec90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008eca0: 206e 7473 5f6f 7574 203d 206e 7473 5f6f   nts_out = nts_o
+0008ecb0: 7574 202b 206e 745f 6e65 770a 2020 2020  ut + nt_new.    
+0008ecc0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0008ecd0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0008ece0: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
+0008ecf0: 6e28 6e74 735f 6f75 7429 0a20 2020 2020  n(nts_out).     
+0008ed00: 2020 200a 6465 6620 7261 6e64 5f6e 7563     .def rand_nuc
+0008ed10: 6c65 6f74 6964 6573 286e 756d 293a 0a20  leotides(num):. 
+0008ed20: 2020 200a 2020 2020 6e75 6d5f 7365 7120     .    num_seq 
+0008ed30: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+0008ed40: 696e 7428 302c 342c 6e75 6d29 0a20 2020  int(0,4,num).   
+0008ed50: 206e 745f 7374 7220 3d20 2727 2e6a 6f69   nt_str = ''.joi
+0008ed60: 6e28 5b4e 545f 6c73 745b 6e5d 2066 6f72  n([NT_lst[n] for
+0008ed70: 206e 2069 6e20 6e75 6d5f 7365 715d 290a   n in num_seq]).
+0008ed80: 2020 2020 7265 7475 726e 286e 745f 7374      return(nt_st
+0008ed90: 7229 0a0a 0a64 6566 2073 6176 655f 736e  r)...def save_sn
+0008eda0: 765f 696e 666f 5f6f 6c64 2820 6669 6c65  v_info_old( file
+0008edb0: 5f6e 616d 652c 2073 6e76 5f6c 7374 2c20  _name, snv_lst, 
+0008edc0: 7665 7262 6f73 6520 3d20 4661 6c73 6520  verbose = False 
+0008edd0: 293a 0a20 2020 200a 2020 2020 6620 3d20  ):.    .    f = 
+0008ede0: 6f70 656e 2866 696c 655f 6e61 6d65 2c20  open(file_name, 
+0008edf0: 2777 742b 2729 0a20 2020 2070 7269 6e74  'wt+').    print
+0008ee00: 2827 5361 7669 6e67 2053 4e56 2069 6e66  ('Saving SNV inf
+0008ee10: 6f2e 2027 2c20 656e 643d 2727 290a 2020  o. ', end='').  
+0008ee20: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
+0008ee30: 286c 656e 2873 6e76 5f6c 7374 292f 3230  (len(snv_lst)/20
+0008ee40: 290a 2020 2020 666f 7220 6b20 696e 2072  ).    for k in r
+0008ee50: 616e 6765 286c 656e 2873 6e76 5f6c 7374  ange(len(snv_lst
+0008ee60: 2929 203a 0a20 2020 2020 2020 2073 6e76  )) :.        snv
+0008ee70: 203d 2073 6e76 5f6c 7374 5b6b 5d0a 2020   = snv_lst[k].  
+0008ee80: 2020 2020 2020 7320 3d20 2725 732c 2569        s = '%s,%i
+0008ee90: 2c25 692c 2573 2c25 692c 2573 2c25 735c  ,%i,%s,%i,%s,%s\
+0008eea0: 6e27 2025 205c 0a20 2020 2020 2020 2028  n' % \.        (
+0008eeb0: 736e 762e 6368 722c 2073 6e76 2e70 6f73  snv.chr, snv.pos
+0008eec0: 5f6e 6577 2c20 736e 762e 706f 735f 6f72  _new, snv.pos_or
+0008eed0: 672c 2073 6e76 2e74 7970 652c 2073 6e76  g, snv.type, snv
+0008eee0: 2e6c 656e 2c20 736e 762e 7365 715f 6e65  .len, snv.seq_ne
+0008eef0: 772c 2073 6e76 2e73 6571 5f6f 7267 2029  w, snv.seq_org )
+0008ef00: 0a20 2020 2020 2020 2066 2e77 7269 7465  .        f.write
+0008ef10: 6c69 6e65 7328 7329 0a20 2020 2020 2020  lines(s).       
+0008ef20: 2069 6620 6b25 7374 6570 203d 3d20 303a   if k%step == 0:
+0008ef30: 2070 7269 6e74 2827 2e27 2c65 6e64 3d27   print('.',end='
+0008ef40: 2729 0a20 2020 2020 2020 200a 2020 2020  ').        .    
+0008ef50: 7072 696e 7428 2720 646f 6e65 2e20 2569  print(' done. %i
+0008ef60: 2073 6e76 732e 2720 2520 6c65 6e28 736e   snvs.' % len(sn
+0008ef70: 765f 6c73 7429 2029 0a20 2020 2066 2e63  v_lst) ).    f.c
+0008ef80: 6c6f 7365 2829 0a0a 2020 2020 0a64 6566  lose()..    .def
+0008ef90: 2073 6176 655f 736e 765f 696e 666f 2820   save_snv_info( 
+0008efa0: 6669 6c65 5f6e 616d 652c 2073 6e76 5f6c  file_name, snv_l
+0008efb0: 7374 2c20 7665 7262 6f73 6520 3d20 4661  st, verbose = Fa
+0008efc0: 6c73 6520 293a 0a0a 2020 2020 6466 203d  lse ):..    df =
+0008efd0: 2070 642e 4461 7461 4672 616d 6528 736e   pd.DataFrame(sn
+0008efe0: 765f 6c73 7429 0a20 2020 2064 662e 746f  v_lst).    df.to
+0008eff0: 5f63 7376 2866 696c 655f 6e61 6d65 2c20  _csv(file_name, 
+0008f000: 696e 6465 783d 4661 6c73 652c 2073 6570  index=False, sep
+0008f010: 3d27 5c74 2729 0a0a 2020 2020 0a64 6566  ='\t')..    .def
+0008f020: 2067 656e 6572 6174 655f 736e 765f 7769   generate_snv_wi
+0008f030: 7468 5f67 7466 2820 6765 6e6f 6d65 2c20  th_gtf( genome, 
+0008f040: 6774 665f 6c69 6e65 735f 736f 7274 6564  gtf_lines_sorted
+0008f050: 2c20 6d75 203d 2032 3030 2c20 6c69 203d  , mu = 200, li =
+0008f060: 2033 2c20 6c64 203d 2033 2c20 6c76 203d   3, ld = 3, lv =
+0008f070: 2032 2c20 7069 203d 2030 2e31 2c20 7064   2, pi = 0.1, pd
+0008f080: 203d 2030 2e31 2029 3a0a 2020 2020 0a20   = 0.1 ):.    . 
+0008f090: 2020 2070 7620 3d20 3120 2d20 7069 202d     pv = 1 - pi -
+0008f0a0: 2070 640a 2020 2020 7072 696e 7428 6765   pd.    print(ge
+0008f0b0: 6e6f 6d65 2e6e 616d 652c 2065 6e64 3d27  nome.name, end='
+0008f0c0: 2027 290a 2020 2020 736e 765f 6c73 7420   ').    snv_lst 
+0008f0d0: 3d20 5b5d 0a20 2020 2063 7572 5f70 6f73  = [].    cur_pos
+0008f0e0: 5f6f 7267 203d 2030 0a20 2020 2063 7572  _org = 0.    cur
+0008f0f0: 5f70 6f73 5f6e 6577 203d 2063 7572 5f70  _pos_new = cur_p
+0008f100: 6f73 5f6f 7267 0a20 2020 2073 6571 5f6e  os_org.    seq_n
+0008f110: 6577 203d 2027 270a 2020 2020 7365 715f  ew = ''.    seq_
+0008f120: 6c73 7420 3d20 5b5d 0a20 2020 204d 6172  lst = [].    Mar
+0008f130: 6769 6e20 3d20 6d61 7828 6c69 2c6d 6178  gin = max(li,max
+0008f140: 286c 642c 6c76 2929 0a20 2020 200a 2020  (ld,lv)).    .  
+0008f150: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
+0008f160: 2867 656e 6f6d 652e 6c65 6e2f 6d75 2f32  (genome.len/mu/2
+0008f170: 3030 290a 2020 2020 0a20 2020 2063 6e74  00).    .    cnt
+0008f180: 203d 2030 0a20 2020 2066 6f72 206c 696e   = 0.    for lin
+0008f190: 6520 696e 2067 7466 5f6c 696e 6573 5f73  e in gtf_lines_s
+0008f1a0: 6f72 7465 643a 0a20 2020 2020 2020 200a  orted:.        .
+0008f1b0: 2020 2020 2020 2020 2320 6469 6666 203d          # diff =
+0008f1c0: 2063 7572 5f70 6f73 5f6e 6577 202d 2063   cur_pos_new - c
+0008f1d0: 7572 5f70 6f73 5f6f 7267 0a20 2020 2020  ur_pos_org.     
+0008f1e0: 2020 2053 7461 7274 203d 206c 696e 652e     Start = line.
+0008f1f0: 7374 6172 740a 2020 2020 2020 2020 456e  start.        En
+0008f200: 6420 3d20 6c69 6e65 2e65 6e64 0a20 2020  d = line.end.   
+0008f210: 2020 2020 204c 203d 206e 702e 7261 6e64       L = np.rand
+0008f220: 6f6d 2e72 616e 6469 6e74 2830 2c6d 752f  om.randint(0,mu/
+0008f230: 322c 3129 5b30 5d0a 2020 2020 2020 2020  2,1)[0].        
+0008f240: 6966 2063 7572 5f70 6f73 5f6f 7267 203c  if cur_pos_org <
+0008f250: 2028 6c69 6e65 2e73 7461 7274 2d31 2b4c   (line.start-1+L
+0008f260: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
+0008f270: 6578 745f 706f 735f 6f72 6720 3d20 6c69  ext_pos_org = li
+0008f280: 6e65 2e73 7461 7274 2d31 2b4c 0a20 2020  ne.start-1+L.   
+0008f290: 2020 2020 2020 2020 2073 6571 5f6c 7374           seq_lst
+0008f2a0: 2e61 7070 656e 6428 6765 6e6f 6d65 2e73  .append(genome.s
+0008f2b0: 6571 5b69 6e74 2863 7572 5f70 6f73 5f6f  eq[int(cur_pos_o
+0008f2c0: 7267 293a 696e 7428 6e65 7874 5f70 6f73  rg):int(next_pos
+0008f2d0: 5f6f 7267 295d 290a 2020 2020 2020 2020  _org)]).        
+0008f2e0: 2020 2020 6375 725f 706f 735f 6e65 7720      cur_pos_new 
+0008f2f0: 2b3d 2028 6e65 7874 5f70 6f73 5f6f 7267  += (next_pos_org
+0008f300: 2d63 7572 5f70 6f73 5f6f 7267 290a 2020  -cur_pos_org).  
+0008f310: 2020 2020 2020 2020 2020 6375 725f 706f            cur_po
+0008f320: 735f 6f72 6720 3d20 6e65 7874 5f70 6f73  s_org = next_pos
+0008f330: 5f6f 7267 0a20 2020 2020 2020 200a 2020  _org.        .  
+0008f340: 2020 2020 2020 7768 696c 6520 2863 7572        while (cur
+0008f350: 5f70 6f73 5f6f 7267 203c 2028 6c69 6e65  _pos_org < (line
+0008f360: 2e65 6e64 2d4d 6172 6769 6e29 2920 2620  .end-Margin)) & 
+0008f370: 2863 7572 5f70 6f73 5f6f 7267 203e 2028  (cur_pos_org > (
+0008f380: 6c69 6e65 2e73 7461 7274 2b4d 6172 6769  line.start+Margi
+0008f390: 6e29 293a 0a0a 2020 2020 2020 2020 2020  n)):..          
+0008f3a0: 2020 736e 765f 7479 7065 203d 2067 6574    snv_type = get
+0008f3b0: 5f73 6e76 5f74 7970 6528 7069 2c20 7076  _snv_type(pi, pv
+0008f3c0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0008f3d0: 6620 736e 765f 7479 7065 203d 3d20 313a  f snv_type == 1:
+0008f3e0: 2023 2049 6e73 6572 7469 6f6e 0a20 2020   # Insertion.   
+0008f3f0: 2020 2020 2020 2020 2020 2020 206e 203d               n =
+0008f400: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
+0008f410: 6e74 2830 2c6c 692c 2031 295b 305d 2b31  nt(0,li, 1)[0]+1
+0008f420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008f430: 2073 6571 5f66 7261 6720 3d20 7261 6e64   seq_frag = rand
+0008f440: 5f6e 7563 6c65 6f74 6964 6573 286e 290a  _nucleotides(n).
+0008f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f460: 2320 7365 715f 6e65 7720 3d20 7365 715f  # seq_new = seq_
+0008f470: 6e65 7720 2b20 7365 715f 6672 6167 0a20  new + seq_frag. 
+0008f480: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008f490: 6571 5f6c 7374 2e61 7070 656e 6428 7365  eq_lst.append(se
+0008f4a0: 715f 6672 6167 290a 2020 2020 2020 2020  q_frag).        
+0008f4b0: 2020 2020 2020 2020 736e 7620 3d20 534e          snv = SN
+0008f4c0: 5628 2067 656e 6f6d 652e 6e61 6d65 2c20  V( genome.name, 
+0008f4d0: 6375 725f 706f 735f 6e65 772b 312c 2063  cur_pos_new+1, c
+0008f4e0: 7572 5f70 6f73 5f6f 7267 2b31 2c20 2749  ur_pos_org+1, 'I
+0008f4f0: 272c 206e 2c20 7365 715f 6672 6167 2c20  ', n, seq_frag, 
+0008f500: 272d 272c 2053 7461 7274 2c20 456e 6420  '-', Start, End 
+0008f510: 2920 2320 6d61 6b65 2069 7420 6f6e 652d  ) # make it one-
+0008f520: 6261 7365 2070 6f73 6974 696f 6e0a 2020  base position.  
+0008f530: 2020 2020 2020 2020 2020 2020 2020 736e                sn
+0008f540: 765f 6c73 742e 6170 7065 6e64 2873 6e76  v_lst.append(snv
+0008f550: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0008f560: 2020 6375 725f 706f 735f 6e65 7720 2b3d    cur_pos_new +=
+0008f570: 206c 656e 2873 6571 5f66 7261 6729 0a0a   len(seq_frag)..
+0008f580: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0008f590: 2073 6e76 5f74 7970 6520 3d3d 2032 3a20   snv_type == 2: 
+0008f5a0: 2320 4465 6c65 7469 6f6e 0a20 2020 2020  # Deletion.     
+0008f5b0: 2020 2020 2020 2020 2020 206e 203d 206e             n = n
+0008f5c0: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
+0008f5d0: 2830 2c6c 642c 2031 295b 305d 2b31 0a20  (0,ld, 1)[0]+1. 
+0008f5e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008f5f0: 6571 5f66 7261 6720 3d20 6765 6e6f 6d65  eq_frag = genome
+0008f600: 2e73 6571 5b69 6e74 2863 7572 5f70 6f73  .seq[int(cur_pos
+0008f610: 5f6f 7267 293a 696e 7428 6375 725f 706f  _org):int(cur_po
+0008f620: 735f 6f72 672b 6e29 5d0a 2020 2020 2020  s_org+n)].      
+0008f630: 2020 2020 2020 2020 2020 736e 7620 3d20            snv = 
+0008f640: 534e 5628 2067 656e 6f6d 652e 6e61 6d65  SNV( genome.name
+0008f650: 2c20 6375 725f 706f 735f 6e65 772b 312c  , cur_pos_new+1,
+0008f660: 2063 7572 5f70 6f73 5f6f 7267 2b31 2c20   cur_pos_org+1, 
+0008f670: 2744 272c 206e 2c20 272d 272c 2073 6571  'D', n, '-', seq
+0008f680: 5f66 7261 672c 2053 7461 7274 2c20 456e  _frag, Start, En
+0008f690: 6420 2920 2320 6d61 6b65 2069 7420 6f6e  d ) # make it on
+0008f6a0: 652d 6261 7365 2070 6f73 6974 696f 6e0a  e-base position.
+0008f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f6c0: 736e 765f 6c73 742e 6170 7065 6e64 2873  snv_lst.append(s
+0008f6d0: 6e76 290a 2020 2020 2020 2020 2020 2020  nv).            
+0008f6e0: 2020 2020 6375 725f 706f 735f 6f72 6720      cur_pos_org 
+0008f6f0: 2b3d 206e 0a0a 2020 2020 2020 2020 2020  += n..          
+0008f700: 2020 656c 7365 3a20 2320 534e 500a 2020    else: # SNP.  
+0008f710: 2020 2020 2020 2020 2020 2020 2020 6e20                n 
+0008f720: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+0008f730: 696e 7428 302c 6c76 2c20 3129 5b30 5d2b  int(0,lv, 1)[0]+
+0008f740: 3120 2020 2020 2020 200a 2020 2020 2020  1        .      
+0008f750: 2020 2020 2020 2020 2020 7365 715f 746d            seq_tm
+0008f760: 7020 3d20 6765 6e6f 6d65 2e73 6571 5b69  p = genome.seq[i
+0008f770: 6e74 2863 7572 5f70 6f73 5f6f 7267 293a  nt(cur_pos_org):
+0008f780: 696e 7428 6375 725f 706f 735f 6f72 672b  int(cur_pos_org+
+0008f790: 6e29 5d0a 2020 2020 2020 2020 2020 2020  n)].            
+0008f7a0: 2020 2020 7365 715f 6672 6167 203d 2072      seq_frag = r
+0008f7b0: 616e 645f 6e75 636c 656f 7469 6465 5f65  and_nucleotide_e
+0008f7c0: 7863 6570 7428 7365 715f 746d 7029 0a20  xcept(seq_tmp). 
+0008f7d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0008f7e0: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
+0008f7f0: 6577 202b 2073 6571 5f66 7261 670a 2020  ew + seq_frag.  
+0008f800: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0008f810: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
+0008f820: 5f66 7261 6729 0a20 2020 2020 2020 2020  _frag).         
+0008f830: 2020 2020 2020 2073 6e76 203d 2053 4e56         snv = SNV
+0008f840: 2820 6765 6e6f 6d65 2e6e 616d 652c 2063  ( genome.name, c
+0008f850: 7572 5f70 6f73 5f6e 6577 2b31 2c20 6375  ur_pos_new+1, cu
+0008f860: 725f 706f 735f 6f72 672b 312c 2027 5627  r_pos_org+1, 'V'
+0008f870: 2c20 6e2c 2073 6571 5f66 7261 672c 2073  , n, seq_frag, s
+0008f880: 6571 5f74 6d70 2c20 5374 6172 742c 2045  eq_tmp, Start, E
+0008f890: 6e64 2029 2023 206d 616b 6520 6974 206f  nd ) # make it o
+0008f8a0: 6e65 2d62 6173 6520 706f 7369 7469 6f6e  ne-base position
+0008f8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008f8c0: 2073 6e76 5f6c 7374 2e61 7070 656e 6428   snv_lst.append(
+0008f8d0: 736e 7629 0a20 2020 2020 2020 2020 2020  snv).           
+0008f8e0: 2020 2020 2063 7572 5f70 6f73 5f6e 6577       cur_pos_new
+0008f8f0: 202b 3d20 6e0a 2020 2020 2020 2020 2020   += n.          
+0008f900: 2020 2020 2020 6375 725f 706f 735f 6f72        cur_pos_or
+0008f910: 6720 2b3d 206e 0a0a 2020 2020 2020 2020  g += n..        
+0008f920: 2020 2020 4c20 3d20 6e70 2e72 616e 646f      L = np.rando
+0008f930: 6d2e 7261 6e64 696e 7428 3230 2c6d 752c  m.randint(20,mu,
+0008f940: 3129 5b30 5d20 2320 7365 7061 7261 7465  1)[0] # separate
+0008f950: 2053 4e56 2061 7420 6c65 6173 7420 3230   SNV at least 20
+0008f960: 2062 6173 6573 0a20 2020 2020 2020 2020   bases.         
+0008f970: 2020 206e 6578 745f 706f 735f 6f72 6720     next_pos_org 
+0008f980: 3d20 6375 725f 706f 735f 6f72 6720 2b20  = cur_pos_org + 
+0008f990: 4c0a 2020 2020 2020 2020 2020 2020 6966  L.            if
+0008f9a0: 206e 6578 745f 706f 735f 6f72 6720 3e3d   next_pos_org >=
+0008f9b0: 206c 696e 652e 656e 643a 2023 2028 6765   line.end: # (ge
+0008f9c0: 6e6f 6d65 2e6c 656e 2d31 3030 293a 0a20  nome.len-100):. 
+0008f9d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0008f9e0: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
+0008f9f0: 6577 202b 2067 656e 6f6d 652e 7365 715b  ew + genome.seq[
+0008fa00: 696e 7428 6375 725f 706f 735f 6f72 6729  int(cur_pos_org)
+0008fa10: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+0008fa20: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
+0008fa30: 6428 6765 6e6f 6d65 2e73 6571 5b69 6e74  d(genome.seq[int
+0008fa40: 2863 7572 5f70 6f73 5f6f 7267 293a 286c  (cur_pos_org):(l
+0008fa50: 696e 652e 656e 642b 3129 5d29 0a20 2020  ine.end+1)]).   
+0008fa60: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0008fa70: 5f70 6f73 5f6e 6577 202b 3d20 2828 6c69  _pos_new += ((li
+0008fa80: 6e65 2e65 6e64 2b31 292d 6375 725f 706f  ne.end+1)-cur_po
+0008fa90: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
+0008faa0: 2020 2020 2020 2063 7572 5f70 6f73 5f6f         cur_pos_o
+0008fab0: 7267 203d 2028 6c69 6e65 2e65 6e64 2b31  rg = (line.end+1
+0008fac0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0008fad0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0008fae0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008faf0: 2020 2020 2020 2020 2020 2320 7365 715f            # seq_
+0008fb00: 6e65 7720 3d20 7365 715f 6e65 7720 2b20  new = seq_new + 
+0008fb10: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
+0008fb20: 7572 5f70 6f73 5f6f 7267 293a 696e 7428  ur_pos_org):int(
+0008fb30: 6e65 7874 5f70 6f73 5f6f 7267 295d 0a20  next_pos_org)]. 
+0008fb40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008fb50: 6571 5f6c 7374 2e61 7070 656e 6428 6765  eq_lst.append(ge
+0008fb60: 6e6f 6d65 2e73 6571 5b69 6e74 2863 7572  nome.seq[int(cur
+0008fb70: 5f70 6f73 5f6f 7267 293a 696e 7428 6e65  _pos_org):int(ne
+0008fb80: 7874 5f70 6f73 5f6f 7267 295d 290a 2020  xt_pos_org)]).  
+0008fb90: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0008fba0: 725f 706f 735f 6e65 7720 2b3d 2028 6e65  r_pos_new += (ne
+0008fbb0: 7874 5f70 6f73 5f6f 7267 2d63 7572 5f70  xt_pos_org-cur_p
+0008fbc0: 6f73 5f6f 7267 290a 2020 2020 2020 2020  os_org).        
+0008fbd0: 2020 2020 2020 2020 6375 725f 706f 735f          cur_pos_
+0008fbe0: 6f72 6720 3d20 6e65 7874 5f70 6f73 5f6f  org = next_pos_o
+0008fbf0: 7267 0a20 2020 2020 2020 2020 2020 2063  rg.            c
+0008fc00: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0008fc10: 2020 2020 6966 2063 6e74 2573 7465 7020      if cnt%step 
+0008fc20: 3d3d 2030 3a20 0a20 2020 2020 2020 2020  == 0: .         
+0008fc30: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+0008fc40: 2573 202d 2025 692c 2025 692c 2025 6920  %s - %i, %i, %i 
+0008fc50: 2720 2520 2867 656e 6f6d 652e 6e61 6d65  ' % (genome.name
+0008fc60: 2c20 6375 725f 706f 735f 6f72 672c 2067  , cur_pos_org, g
+0008fc70: 656e 6f6d 652e 6c65 6e2c 2063 7572 5f70  enome.len, cur_p
+0008fc80: 6f73 5f6e 6577 292c 2065 6e64 3d27 2729  os_new), end='')
+0008fc90: 0a20 2020 2020 2020 0a20 2020 2069 6620  .       .    if 
+0008fca0: 6375 725f 706f 735f 6f72 6720 3c20 6765  cur_pos_org < ge
+0008fcb0: 6e6f 6d65 2e6c 656e 3a0a 2020 2020 2020  nome.len:.      
+0008fcc0: 2020 7365 715f 6c73 742e 6170 7065 6e64    seq_lst.append
+0008fcd0: 2867 656e 6f6d 652e 7365 715b 696e 7428  (genome.seq[int(
+0008fce0: 6375 725f 706f 735f 6f72 6729 3a5d 290a  cur_pos_org):]).
+0008fcf0: 2020 2020 0a20 2020 2073 6571 5f6e 6577      .    seq_new
+0008fd00: 203d 2027 272e 6a6f 696e 2873 6571 5f6c   = ''.join(seq_l
+0008fd10: 7374 290a 2020 2020 2320 7375 6666 6978  st).    # suffix
+0008fd20: 203d 2027 2d4c 2569 2d49 2569 2d44 2569   = '-L%i-I%i-D%i
+0008fd30: 2d56 2569 2720 2520 286d 752c 6c69 2c6c  -V%i' % (mu,li,l
+0008fd40: 642c 6c76 290a 2020 2020 2320 6765 6e6f  d,lv).    # geno
+0008fd50: 6d65 5f6e 6577 203d 2047 656e 6f6d 6528  me_new = Genome(
+0008fd60: 2067 656e 6f6d 652e 6865 6164 6572 202b   genome.header +
+0008fd70: 2073 7566 6669 782c 2073 6571 5f6e 6577   suffix, seq_new
+0008fd80: 2029 0a20 2020 2067 656e 6f6d 655f 6e65   ).    genome_ne
+0008fd90: 7720 3d20 4765 6e6f 6d65 2820 6765 6e6f  w = Genome( geno
+0008fda0: 6d65 2e68 6561 6465 722c 2073 6571 5f6e  me.header, seq_n
+0008fdb0: 6577 2029 0a20 2020 2070 7269 6e74 2827  ew ).    print('
+0008fdc0: 2064 6f6e 652e 2729 0a20 2020 2020 2020   done.').       
+0008fdd0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
+0008fde0: 2867 656e 6f6d 655f 6e65 772c 2073 6e76  (genome_new, snv
+0008fdf0: 5f6c 7374 290a 2020 2020 0a23 2323 2323  _lst).    .#####
+0008fe00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008fe10: 2323 2323 2323 2323 2323 230a 2323 2050  ###########.## P
+0008fe20: 6172 616d 6574 6572 7320 666f 7220 534e  arameters for SN
+0008fe30: 5620 6765 6e65 7261 7469 6f6e 0a0a 505f  V generation..P_
+0008fe40: 494e 5320 3d20 302e 3135 0a50 5f44 454c  INS = 0.15.P_DEL
+0008fe50: 203d 2030 2e31 350a 505f 534e 5020 3d20   = 0.15.P_SNP = 
+0008fe60: 3120 2d20 505f 494e 5320 2d20 505f 4445  1 - P_INS - P_DE
+0008fe70: 4c0a 0a4c 4920 3d20 330a 4c44 203d 2033  L..LI = 3.LD = 3
+0008fe80: 0a4c 5620 3d20 320a 4c5f 494e 5445 525f  .LV = 2.L_INTER_
+0008fe90: 534e 5620 3d20 3230 300a 0a23 2323 2323  SNV = 200..#####
+0008fea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008feb0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
+0008fec0: 2067 656e 6572 6174 655f 736e 7628 6765   generate_snv(ge
+0008fed0: 6e6f 6d65 2c20 6774 665f 6c69 6e65 732c  nome, gtf_lines,
+0008fee0: 206c 5f69 6e74 6572 5f73 6e76 203d 204c   l_inter_snv = L
+0008fef0: 5f49 4e54 4552 5f53 4e56 2c20 5c0a 2020  _INTER_SNV, \.  
+0008ff00: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0008ff10: 6920 3d20 4c49 2c20 6c64 203d 204c 442c  i = LI, ld = LD,
+0008ff20: 206c 7620 3d20 4c56 2c20 7069 203d 2050   lv = LV, pi = P
+0008ff30: 5f49 4e53 2c20 7064 203d 2050 5f44 454c  _INS, pd = P_DEL
+0008ff40: 293a 0a20 2020 200a 2020 2020 7076 203d  ):.    .    pv =
+0008ff50: 2031 202d 2070 6920 2d20 7064 0a20 2020   1 - pi - pd.   
+0008ff60: 206e 702e 7261 6e64 6f6d 2e73 6565 6428   np.random.seed(
+0008ff70: 3029 0a20 2020 2070 7269 6e74 2827 4765  0).    print('Ge
+0008ff80: 6e65 7261 7469 6e67 2053 4e56 2027 2c65  nerating SNV ',e
+0008ff90: 6e64 3d27 2729 0a20 2020 2046 6561 7475  nd='').    Featu
+0008ffa0: 7265 7320 3d20 6765 745f 636f 6c28 6774  res = get_col(gt
+0008ffb0: 665f 6c69 6e65 732c 2032 290a 2020 2020  f_lines, 2).    
+0008ffc0: 7768 203d 2077 6869 6368 2820 4665 6174  wh = which( Feat
+0008ffd0: 7572 6573 2c20 2765 786f 6e27 2029 0a20  ures, 'exon' ). 
+0008ffe0: 2020 2067 7466 5f65 786f 6e73 203d 205b     gtf_exons = [
+0008fff0: 6774 665f 6c69 6e65 735b 775d 2066 6f72  gtf_lines[w] for
+00090000: 2077 2069 6e20 7768 5d20 0a0a 2020 2020   w in wh] ..    
+00090010: 2320 7072 696e 7428 6c65 6e28 4665 6174  # print(len(Feat
+00090020: 7572 6573 2929 0a20 2020 2043 6872 7320  ures)).    Chrs 
+00090030: 3d20 6765 745f 636f 6c28 6774 665f 6578  = get_col(gtf_ex
+00090040: 6f6e 732c 2030 290a 2020 2020 4368 725f  ons, 0).    Chr_
+00090050: 6e61 6d65 7320 3d20 736f 7274 6564 2873  names = sorted(s
+00090060: 6574 2843 6872 7329 290a 0a20 2020 2073  et(Chrs))..    s
+00090070: 6e76 5f6c 7374 5f61 6c6c 203d 205b 5d0a  nv_lst_all = [].
+00090080: 2020 2020 6765 6e6f 6d65 5f6e 6577 203d      genome_new =
+00090090: 207b 7d0a 2020 2020 666f 7220 4368 7220   {}.    for Chr 
+000900a0: 696e 2043 6872 5f6e 616d 6573 3a0a 2020  in Chr_names:.  
+000900b0: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
+000900c0: 6620 4368 7220 696e 2067 656e 6f6d 652e  f Chr in genome.
+000900d0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+000900e0: 2020 2020 7768 203d 2077 6869 6368 2820      wh = which( 
+000900f0: 4368 7273 2c20 4368 7220 290a 2020 2020  Chrs, Chr ).    
+00090100: 2020 2020 2020 2020 6774 665f 6368 7220          gtf_chr 
+00090110: 3d20 5b67 7466 5f65 786f 6e73 5b77 5d20  = [gtf_exons[w] 
+00090120: 666f 7220 7720 696e 2077 685d 0a20 2020  for w in wh].   
+00090130: 2020 2020 2020 2020 2050 6f73 5f73 7461           Pos_sta
+00090140: 7274 203d 206e 702e 6172 7261 7928 2067  rt = np.array( g
+00090150: 6574 5f63 6f6c 2867 7466 5f63 6872 2c20  et_col(gtf_chr, 
+00090160: 3329 2029 0a20 2020 2020 2020 2020 2020  3) ).           
+00090170: 206f 6472 203d 2050 6f73 5f73 7461 7274   odr = Pos_start
+00090180: 2e61 7267 736f 7274 2829 0a0a 2020 2020  .argsort()..    
+00090190: 2020 2020 2020 2020 6774 665f 6368 725f          gtf_chr_
+000901a0: 736f 7274 6564 203d 205b 5d0a 2020 2020  sorted = [].    
+000901b0: 2020 2020 2020 2020 7070 203d 2030 0a20          pp = 0. 
+000901c0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+000901d0: 2069 6e20 7261 6e67 6528 6c65 6e28 6774   in range(len(gt
+000901e0: 665f 6368 7229 293a 0a20 2020 2020 2020  f_chr)):.       
+000901f0: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
+00090200: 6774 665f 6368 725b 6f64 725b 6b5d 5d0a  gtf_chr[odr[k]].
+00090210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090220: 6774 665f 6368 725f 736f 7274 6564 2e61  gtf_chr_sorted.a
+00090230: 7070 656e 6428 6c69 6e65 290a 2020 2020  ppend(line).    
+00090240: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00090250: 696e 652e 7374 6172 7420 3c20 7070 3a20  ine.start < pp: 
+00090260: 7072 696e 7428 6c69 6e65 290a 2020 2020  print(line).    
+00090270: 2020 2020 2020 2020 2020 2020 7070 203d              pp =
+00090280: 206c 696e 652e 7374 6172 740a 0a20 2020   line.start..   
+00090290: 2020 2020 2020 2020 2067 6e6d 2c20 736e           gnm, sn
+000902a0: 765f 6c73 7420 3d20 6765 6e65 7261 7465  v_lst = generate
+000902b0: 5f73 6e76 5f77 6974 685f 6774 6628 2067  _snv_with_gtf( g
+000902c0: 656e 6f6d 655b 4368 725d 2c20 6774 665f  enome[Chr], gtf_
+000902d0: 6368 725f 736f 7274 6564 2c20 6d75 203d  chr_sorted, mu =
+000902e0: 206c 5f69 6e74 6572 5f73 6e76 2c20 5c0a   l_inter_snv, \.
+000902f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090320: 2020 6c69 203d 206c 692c 206c 6420 3d20    li = li, ld = 
+00090330: 6c64 2c20 6c76 203d 206c 762c 2070 6920  ld, lv = lv, pi 
+00090340: 3d20 7069 2c20 7064 203d 2070 6420 290a  = pi, pd = pd ).
+00090350: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
+00090360: 6c73 745f 616c 6c20 3d20 736e 765f 6c73  lst_all = snv_ls
+00090370: 745f 616c 6c20 2b20 736e 765f 6c73 740a  t_all + snv_lst.
+00090380: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
+00090390: 6d65 5f6e 6577 5b43 6872 5d20 3d20 676e  me_new[Chr] = gn
+000903a0: 6d0a 2020 2020 200a 2020 2020 7265 7475  m.     .    retu
+000903b0: 726e 2867 656e 6f6d 655f 6e65 772c 2073  rn(genome_new, s
+000903c0: 6e76 5f6c 7374 5f61 6c6c 2c20 4665 6174  nv_lst_all, Feat
+000903d0: 7572 6573 290a 2020 2020 0a23 2323 2323  ures).    .#####
+000903e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000903f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00090410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090450: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
-00090460: 2046 756e 6374 696f 6e73 2066 6f72 2065   Functions for e
-00090470: 7661 6c75 6174 696f 6e20 6f66 2053 4e56  valuation of SNV
-00090480: 2064 6574 6563 7469 6f6e 0a23 2323 2323   detection.#####
+00090420: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
+00090430: 2046 756e 6374 696f 6e73 2066 6f72 2065   Functions for e
+00090440: 7661 6c75 6174 696f 6e20 6f66 2053 4e56  valuation of SNV
+00090450: 2064 6574 6563 7469 6f6e 0a23 2323 2323   detection.#####
+00090460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00090490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000904a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000904b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000904c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000904d0: 2323 2323 2323 2323 2323 2323 230a 0a64  #############..d
-000904e0: 6566 2067 6574 5f73 7061 6e5f 6c73 7428  ef get_span_lst(
-000904f0: 7267 6e73 5f6c 7374 5f6d 692c 2054 7970  rgns_lst_mi, Typ
-00090500: 6520 3d20 274d 2729 3a0a 2020 2020 0a20  e = 'M'):.    . 
-00090510: 2020 2073 7061 6e5f 6c73 7420 3d20 5b5d     span_lst = []
-00090520: 0a20 2020 2066 6f72 2072 5f6d 2069 6e20  .    for r_m in 
-00090530: 7267 6e73 5f6c 7374 5f6d 693a 0a20 2020  rgns_lst_mi:.   
-00090540: 2020 2020 2073 706e 203d 2072 5f6d 2e67       spn = r_m.g
-00090550: 6574 5f73 7061 6e28 290a 2020 2020 2020  et_span().      
-00090560: 2020 7370 6e2e 7479 7065 203d 2054 7970    spn.type = Typ
-00090570: 650a 2020 2020 2020 2020 7370 616e 5f6c  e.        span_l
-00090580: 7374 2e61 7070 656e 6428 2073 706e 2029  st.append( spn )
-00090590: 0a20 2020 2072 6574 7572 6e28 7370 616e  .    return(span
-000905a0: 5f6c 7374 290a 0a23 2320 5365 6c65 6374  _lst)..## Select
-000905b0: 2053 4e56 2773 2074 6861 7420 6661 6c6c   SNV's that fall
-000905c0: 7320 7769 7468 696e 2074 6865 2063 6f76  s within the cov
-000905d0: 6572 6564 2072 6567 696f 6e0a 6465 6620  ered region.def 
-000905e0: 7365 6c65 6374 5f73 6e76 7328 2064 665f  select_snvs( df_
-000905f0: 736e 762c 2073 7061 6e5f 6c73 742c 2072  snv, span_lst, r
-00090600: 676e 735f 6c73 745f 6d69 2c20 5479 7065  gns_lst_mi, Type
-00090610: 203d 2027 4d27 2c20 6d64 6576 203d 2031   = 'M', mdev = 1
-00090620: 3220 293a 0a20 2020 200a 2020 2020 7072  2 ):.    .    pr
-00090630: 696e 7428 2743 6865 636b 696e 6720 696e  int('Checking in
-00090640: 7465 7273 6563 7469 6f6e 202e 2e20 272c  tersection .. ',
-00090650: 2065 6e64 3d27 2729 0a20 2020 2073 7465   end='').    ste
-00090660: 7020 3d20 6e70 2e63 6569 6c28 6466 5f73  p = np.ceil(df_s
-00090670: 6e76 2e73 6861 7065 5b30 5d2f 3230 290a  nv.shape[0]/20).
-00090680: 2020 2020 0a20 2020 2064 665f 736e 765b      .    df_snv[
-00090690: 2773 7461 7274 275d 203d 2064 665f 736e  'start'] = df_sn
-000906a0: 765b 2770 6f73 5f6f 7267 275d 202d 206d  v['pos_org'] - m
-000906b0: 6465 760a 2020 2020 6466 5f73 6e76 5b27  dev.    df_snv['
-000906c0: 656e 6427 5d20 3d20 6466 5f73 6e76 5b27  end'] = df_snv['
-000906d0: 706f 735f 6f72 6727 5d20 2b20 6466 5f73  pos_org'] + df_s
-000906e0: 6e76 5b27 6c65 6e27 5d20 2b20 6d64 6576  nv['len'] + mdev
-000906f0: 0a20 2020 2064 665f 736e 765b 2763 7667  .    df_snv['cvg
-00090700: 275d 203d 2030 0a0a 2020 2020 625f 7072  '] = 0..    b_pr
-00090710: 6f63 203d 206e 702e 6675 6c6c 2864 665f  oc = np.full(df_
-00090720: 736e 762e 7368 6170 655b 305d 2c20 4661  snv.shape[0], Fa
-00090730: 6c73 6529 0a20 2020 2066 6f72 206b 2c20  lse).    for k, 
-00090740: 7370 616e 2069 6e20 656e 756d 6572 6174  span in enumerat
-00090750: 6528 7370 616e 5f6c 7374 293a 0a20 2020  e(span_lst):.   
-00090760: 2020 2020 2062 3020 3d20 6466 5f73 6e76       b0 = df_snv
-00090770: 5b27 6368 7227 5d20 3d3d 2073 7061 6e2e  ['chr'] == span.
-00090780: 6368 720a 2020 2020 2020 2020 6231 203d  chr.        b1 =
-00090790: 2028 6466 5f73 6e76 5b27 7374 6172 7427   (df_snv['start'
-000907a0: 5d20 3e3d 2073 7061 6e2e 7374 6172 7429  ] >= span.start)
-000907b0: 2026 2028 2864 665f 736e 765b 2773 7461   & ((df_snv['sta
-000907c0: 7274 275d 203c 3d20 7370 616e 2e65 6e64  rt'] <= span.end
-000907d0: 2929 0a20 2020 2020 2020 2062 3220 3d20  )).        b2 = 
-000907e0: 2864 665f 736e 765b 2765 6e64 275d 203e  (df_snv['end'] >
-000907f0: 3d20 7370 616e 2e73 7461 7274 2920 2620  = span.start) & 
-00090800: 2828 6466 5f73 6e76 5b27 656e 6427 5d20  ((df_snv['end'] 
-00090810: 3c3d 2073 7061 6e2e 656e 6429 290a 2020  <= span.end)).  
-00090820: 2020 2020 2020 6220 3d20 6230 2026 2028        b = b0 & (
-00090830: 6231 207c 2062 3229 2026 2028 625f 7072  b1 | b2) & (b_pr
-00090840: 6f63 203d 3d20 4661 6c73 6529 0a20 2020  oc == False).   
-00090850: 2020 2020 2064 665f 736e 765f 746d 7020       df_snv_tmp 
-00090860: 3d20 6466 5f73 6e76 5b62 5d0a 2020 2020  = df_snv[b].    
-00090870: 2020 2020 666f 7220 6d2c 2072 6f77 2069      for m, row i
-00090880: 6e20 6466 5f73 6e76 5f74 6d70 2e69 7465  n df_snv_tmp.ite
-00090890: 7272 6f77 7328 293a 0a20 2020 2020 2020  rrows():.       
-000908a0: 2020 2020 2072 676e 203d 2072 6567 696f       rgn = regio
-000908b0: 6e28 2072 6f77 2e63 6872 2c20 726f 772e  n( row.chr, row.
-000908c0: 7374 6172 742c 2072 6f77 2e65 6e64 2c20  start, row.end, 
-000908d0: 5479 7065 2029 0a20 2020 2020 2020 2020  Type ).         
-000908e0: 2020 2062 622c 2063 6320 3d20 7267 6e73     bb, cc = rgns
-000908f0: 5f6c 7374 5f6d 695b 6b5d 2e67 6574 5f69  _lst_mi[k].get_i
-00090900: 6e74 6572 7365 6374 696f 6e5f 6376 6728  ntersection_cvg(
-00090910: 7267 6e29 200a 2020 2020 2020 2020 2020  rgn) .          
-00090920: 2020 6966 2062 623a 200a 2020 2020 2020    if bb: .      
-00090930: 2020 2020 2020 2020 2020 625f 7072 6f63            b_proc
-00090940: 5b6d 5d20 3d20 5472 7565 0a20 2020 2020  [m] = True.     
-00090950: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
-00090960: 762e 6c6f 635b 6d2c 2763 7667 275d 203d  v.loc[m,'cvg'] =
-00090970: 2063 630a 2020 2020 2020 2020 2020 2020   cc.            
-00090980: 2020 2020 0a20 2020 2020 2020 2023 2069      .        # i
-00090990: 6620 6b25 7374 6570 203d 3d20 303a 2070  f k%step == 0: p
-000909a0: 7269 6e74 2827 2e27 2c65 6e64 3d27 2729  rint('.',end='')
-000909b0: 0a20 2020 2020 2020 2069 6620 6b25 3130  .        if k%10
-000909c0: 203d 3d20 303a 2020 2020 0a20 2020 2020   == 0:    .     
-000909d0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-000909e0: 4368 6563 6b69 6e67 2069 6e74 6572 7365  Checking interse
-000909f0: 6374 696f 6e20 2e2e 2025 692f 2569 2028  ction .. %i/%i (
-00090a00: 2569 2927 2025 2028 6b2c 206c 656e 2873  %i)' % (k, len(s
-00090a10: 7061 6e5f 6c73 7429 2c20 6e70 2e73 756d  pan_lst), np.sum
-00090a20: 2862 5f70 726f 6329 292c 2065 6e64 3d27  (b_proc)), end='
-00090a30: 2720 290a 0a20 2020 2070 7269 6e74 2827  ' )..    print('
-00090a40: 5c72 4368 6563 6b69 6e67 2069 6e74 6572  \rChecking inter
-00090a50: 7365 6374 696f 6e20 2e2e 2064 6f6e 652e  section .. done.
-00090a60: 2025 6920 2d3e 2025 6927 2025 2028 6466   %i -> %i' % (df
-00090a70: 5f73 6e76 2e73 6861 7065 5b30 5d2c 206e  _snv.shape[0], n
-00090a80: 702e 7375 6d28 625f 7072 6f63 2929 2029  p.sum(b_proc)) )
-00090a90: 0a20 2020 200a 2020 2020 6466 5f73 6e76  .    .    df_snv
-00090aa0: 5f73 656c 203d 2028 6466 5f73 6e76 2e69  _sel = (df_snv.i
-00090ab0: 6c6f 635b 625f 7072 6f63 5d29 2e63 6f70  loc[b_proc]).cop
-00090ac0: 7928 6465 6570 203d 2054 7275 6529 0a20  y(deep = True). 
-00090ad0: 2020 200a 2020 2020 7265 7475 726e 2864     .    return(d
-00090ae0: 665f 736e 765f 7365 6c29 0a0a 0a64 6566  f_snv_sel)...def
-00090af0: 206d 6174 6368 696e 675f 736e 7673 2820   matching_snvs( 
-00090b00: 6466 5f73 6e76 5f73 656c 2c20 6466 5f64  df_snv_sel, df_d
-00090b10: 6574 6563 7465 642c 2064 6576 5f74 6f6c  etected, dev_tol
-00090b20: 203d 2033 2029 3a0a 2020 2020 0a20 2020   = 3 ):.    .   
-00090b30: 2023 2320 7468 6520 6461 7461 6672 616d   ## the datafram
-00090b40: 6573 206d 7573 6820 6265 2073 6f72 7465  es mush be sorte
-00090b50: 6420 6163 636f 7264 696e 6720 746f 2074  d according to t
-00090b60: 6865 2070 6f73 6974 696f 6e20 2870 6f73  he position (pos
-00090b70: 5f6e 6577 2c20 7374 6172 7429 0a20 2020  _new, start).   
-00090b80: 2064 665f 745f 616c 6c20 3d20 6466 5f73   df_t_all = df_s
-00090b90: 6e76 5f73 656c 0a20 2020 2064 665f 645f  nv_sel.    df_d_
-00090ba0: 616c 6c20 3d20 6466 5f64 6574 6563 7465  all = df_detecte
-00090bb0: 640a 0a20 2020 2063 6e74 203d 2030 0a20  d..    cnt = 0. 
-00090bc0: 2020 2063 6872 6d73 203d 2064 665f 745f     chrms = df_t_
-00090bd0: 616c 6c5b 2763 6872 275d 0a20 2020 2063  all['chr'].    c
-00090be0: 6872 5f6c 7374 203d 206c 6973 7428 7365  hr_lst = list(se
-00090bf0: 7428 6368 726d 7329 290a 2020 2020 6368  t(chrms)).    ch
-00090c00: 725f 6c73 742e 736f 7274 2829 0a0a 2020  r_lst.sort()..  
-00090c10: 2020 636e 7420 3d20 300a 2020 2020 4e5f    cnt = 0.    N_
-00090c20: 7420 3d20 300a 2020 2020 4e5f 6420 3d20  t = 0.    N_d = 
-00090c30: 300a 2020 2020 666f 7220 6e2c 2063 6872  0.    for n, chr
-00090c40: 6d20 696e 2065 6e75 6d65 7261 7465 2863  m in enumerate(c
-00090c50: 6872 5f6c 7374 293a 0a20 2020 2020 2020  hr_lst):.       
-00090c60: 200a 2020 2020 2020 2020 6231 203d 2028   .        b1 = (
-00090c70: 6466 5f74 5f61 6c6c 5b27 6368 7227 5d20  df_t_all['chr'] 
-00090c80: 3d3d 2063 6872 6d29 0a20 2020 2020 2020  == chrm).       
-00090c90: 2062 3220 3d20 2864 665f 645f 616c 6c5b   b2 = (df_d_all[
-00090ca0: 2763 6872 275d 203d 3d20 6368 726d 290a  'chr'] == chrm).
-00090cb0: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
-00090cc0: 286e 702e 7375 6d28 6231 2920 3d3d 2030  (np.sum(b1) == 0
-00090cd0: 2920 7c20 286e 702e 7375 6d28 6232 2920  ) | (np.sum(b2) 
-00090ce0: 3d3d 2030 293a 2020 2020 2020 2020 0a20  == 0):        . 
-00090cf0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00090d00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00090d10: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00090d20: 2020 2020 2020 2064 665f 7420 3d20 6466         df_t = df
-00090d30: 5f74 5f61 6c6c 2e6c 6f63 5b62 312c 3a5d  _t_all.loc[b1,:]
-00090d40: 2e63 6f70 7928 6465 6570 203d 2054 7275  .copy(deep = Tru
-00090d50: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
-00090d60: 665f 6420 3d20 6466 5f64 5f61 6c6c 2e6c  f_d = df_d_all.l
-00090d70: 6f63 5b62 322c 3a5d 2e63 6f70 7928 6465  oc[b2,:].copy(de
-00090d80: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
-00090d90: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00090da0: 2020 2020 6e5f 7461 7267 6574 203d 2064      n_target = d
-00090db0: 665f 742e 7368 6170 655b 305d 0a20 2020  f_t.shape[0].   
-00090dc0: 2020 2020 2020 2020 206e 5f64 6574 6563           n_detec
-00090dd0: 7465 6420 3d20 6466 5f64 2e73 6861 7065  ted = df_d.shape
-00090de0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00090df0: 0a20 2020 2020 2020 2020 2020 204e 5f74  .            N_t
-00090e00: 202b 3d20 6e5f 7461 7267 6574 0a20 2020   += n_target.   
-00090e10: 2020 2020 2020 2020 204e 5f64 202b 3d20           N_d += 
-00090e20: 6e5f 6465 7465 6374 6564 0a20 2020 2020  n_detected.     
-00090e30: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00090e40: 2020 2020 2320 7072 696e 7428 275c 724d      # print('\rM
-00090e50: 6174 6368 696e 6720 2573 2027 2025 2028  atching %s ' % (
-00090e60: 6368 726d 2920 2c20 656e 643d 2727 290a  chrm) , end='').
-00090e70: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-00090e80: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-00090e90: 2020 636e 745f 6420 3d20 300a 2020 2020    cnt_d = 0.    
-00090ea0: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-00090eb0: 6e70 2e66 756c 6c28 6e5f 7461 7267 6574  np.full(n_target
-00090ec0: 2c20 2d31 290a 2020 2020 2020 2020 2020  , -1).          
-00090ed0: 2020 6469 7374 203d 206e 702e 6675 6c6c    dist = np.full
-00090ee0: 286e 5f74 6172 6765 742c 2030 290a 2020  (n_target, 0).  
-00090ef0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00090f00: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
-00090f10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00090f20: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00090f30: 2020 2020 6966 2028 636e 745f 6420 3e3d      if (cnt_d >=
-00090f40: 206e 5f64 6574 6563 7465 6429 207c 2028   n_detected) | (
-00090f50: 636e 745f 7420 3e3d 206e 5f74 6172 6765  cnt_t >= n_targe
-00090f60: 7429 3a20 6272 6561 6b0a 2020 2020 2020  t): break.      
-00090f70: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00090f80: 275c 724d 6174 6368 696e 6720 2573 2c20  '\rMatching %s, 
-00090f90: 2569 2f25 6920 2e2e 2025 692f 2569 2c20  %i/%i .. %i/%i, 
-00090fa0: 2569 2f25 6920 2720 2520 5c0a 2020 2020  %i/%i ' % \.    
-00090fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090fc0: 2020 2863 6872 6d2c 206e 2c20 6c65 6e28    (chrm, n, len(
-00090fd0: 6368 725f 6c73 7429 2c20 636e 745f 742c  chr_lst), cnt_t,
-00090fe0: 206e 5f74 6172 6765 742c 2063 6e74 5f64   n_target, cnt_d
-00090ff0: 2c20 6e5f 6465 7465 6374 6564 2920 2c20  , n_detected) , 
-00091000: 656e 643d 2727 290a 0a20 2020 2020 2020  end='')..       
-00091010: 2020 2020 2020 2020 2070 5f74 203d 2064           p_t = d
-00091020: 665f 742e 696c 6f63 5b63 6e74 5f74 5d2e  f_t.iloc[cnt_t].
-00091030: 706f 735f 6f72 670a 2020 2020 2020 2020  pos_org.        
-00091040: 2020 2020 2020 2020 705f 6420 3d20 6466          p_d = df
-00091050: 5f64 2e69 6c6f 635b 636e 745f 645d 2e70  _d.iloc[cnt_d].p
-00091060: 6f73 5f6f 7267 0a20 2020 2020 2020 2020  os_org.         
-00091070: 2020 2020 2020 2074 5f74 203d 2064 665f         t_t = df_
-00091080: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7479  t.iloc[cnt_t].ty
-00091090: 7065 0a20 2020 2020 2020 2020 2020 2020  pe.             
-000910a0: 2020 2074 5f64 203d 2064 665f 642e 696c     t_d = df_d.il
-000910b0: 6f63 5b63 6e74 5f64 5d2e 7479 7065 0a20  oc[cnt_d].type. 
-000910c0: 2020 2020 2020 2020 2020 2020 2020 204c                 L
-000910d0: 5f74 203d 206d 6178 286c 656e 2864 665f  _t = max(len(df_
-000910e0: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7365  t.iloc[cnt_t].se
-000910f0: 715f 6f72 6729 2c20 6c65 6e28 6466 5f74  q_org), len(df_t
-00091100: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
-00091110: 5f6e 6577 2929 0a20 2020 2020 2020 2020  _new)).         
-00091120: 2020 2020 2020 204c 5f64 203d 206d 6178         L_d = max
-00091130: 286c 656e 2864 665f 642e 696c 6f63 5b63  (len(df_d.iloc[c
-00091140: 6e74 5f64 5d2e 7365 715f 6f72 6729 2c20  nt_d].seq_org), 
-00091150: 6c65 6e28 6466 5f64 2e69 6c6f 635b 636e  len(df_d.iloc[cn
-00091160: 745f 645d 2e73 6571 5f6e 6577 2929 0a0a  t_d].seq_new))..
-00091170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091180: 6966 2028 705f 7429 203e 2028 705f 6420  if (p_t) > (p_d 
-00091190: 2b20 4c5f 6420 2b20 6465 765f 746f 6c29  + L_d + dev_tol)
-000911a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000911b0: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
-000911c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000911d0: 2020 2020 2069 6620 636e 745f 6420 3e3d       if cnt_d >=
-000911e0: 206e 5f64 6574 6563 7465 643a 2062 7265   n_detected: bre
-000911f0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00091200: 2020 2065 6c69 6620 2870 5f74 202b 204c     elif (p_t + L
-00091210: 5f74 202b 2064 6576 5f74 6f6c 2920 3c20  _t + dev_tol) < 
-00091220: 2870 5f64 293a 0a20 2020 2020 2020 2020  (p_d):.         
-00091230: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
-00091240: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091250: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
-00091260: 5f74 203e 3d20 6e5f 7461 7267 6574 3a20  _t >= n_target: 
-00091270: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00091280: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00091290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000912a0: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
-000912b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000912c0: 2874 5f74 203d 3d20 2756 2729 2026 2028  (t_t == 'V') & (
-000912d0: 745f 6420 3d3d 2027 5627 293a 0a20 2020  t_d == 'V'):.   
-000912e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000912f0: 2020 2020 2069 6620 6c65 6e28 6466 5f74       if len(df_t
-00091300: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
-00091310: 5f6e 6577 2920 3d3d 206c 656e 2864 665f  _new) == len(df_
-00091320: 642e 696c 6f63 5b63 6e74 5f64 5d2e 7365  d.iloc[cnt_d].se
-00091330: 715f 6e65 7729 3a0a 2020 2020 2020 2020  q_new):.        
-00091340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091350: 2020 2020 6966 2028 705f 7420 3d3d 2070      if (p_t == p
-00091360: 5f64 2920 2620 2864 665f 742e 696c 6f63  _d) & (df_t.iloc
-00091370: 5b63 6e74 5f74 5d2e 7365 715f 6e65 7720  [cnt_t].seq_new 
-00091380: 3d3d 2064 665f 642e 696c 6f63 5b63 6e74  == df_d.iloc[cnt
-00091390: 5f64 5d2e 7365 715f 6e65 7729 3a0a 2020  _d].seq_new):.  
-000913a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000913b0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-000913c0: 7463 685b 636e 745f 745d 203d 2063 6e74  tch[cnt_t] = cnt
-000913d0: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
+000904a0: 2323 2323 2323 2323 2323 2323 230a 0a64  #############..d
+000904b0: 6566 2067 6574 5f73 7061 6e5f 6c73 7428  ef get_span_lst(
+000904c0: 7267 6e73 5f6c 7374 5f6d 692c 2054 7970  rgns_lst_mi, Typ
+000904d0: 6520 3d20 274d 2729 3a0a 2020 2020 0a20  e = 'M'):.    . 
+000904e0: 2020 2073 7061 6e5f 6c73 7420 3d20 5b5d     span_lst = []
+000904f0: 0a20 2020 2066 6f72 2072 5f6d 2069 6e20  .    for r_m in 
+00090500: 7267 6e73 5f6c 7374 5f6d 693a 0a20 2020  rgns_lst_mi:.   
+00090510: 2020 2020 2073 706e 203d 2072 5f6d 2e67       spn = r_m.g
+00090520: 6574 5f73 7061 6e28 290a 2020 2020 2020  et_span().      
+00090530: 2020 7370 6e2e 7479 7065 203d 2054 7970    spn.type = Typ
+00090540: 650a 2020 2020 2020 2020 7370 616e 5f6c  e.        span_l
+00090550: 7374 2e61 7070 656e 6428 2073 706e 2029  st.append( spn )
+00090560: 0a20 2020 2072 6574 7572 6e28 7370 616e  .    return(span
+00090570: 5f6c 7374 290a 0a23 2320 5365 6c65 6374  _lst)..## Select
+00090580: 2053 4e56 2773 2074 6861 7420 6661 6c6c   SNV's that fall
+00090590: 7320 7769 7468 696e 2074 6865 2063 6f76  s within the cov
+000905a0: 6572 6564 2072 6567 696f 6e0a 6465 6620  ered region.def 
+000905b0: 7365 6c65 6374 5f73 6e76 7328 2064 665f  select_snvs( df_
+000905c0: 736e 762c 2073 7061 6e5f 6c73 742c 2072  snv, span_lst, r
+000905d0: 676e 735f 6c73 745f 6d69 2c20 5479 7065  gns_lst_mi, Type
+000905e0: 203d 2027 4d27 2c20 6d64 6576 203d 2031   = 'M', mdev = 1
+000905f0: 3220 293a 0a20 2020 200a 2020 2020 7072  2 ):.    .    pr
+00090600: 696e 7428 2743 6865 636b 696e 6720 696e  int('Checking in
+00090610: 7465 7273 6563 7469 6f6e 202e 2e20 272c  tersection .. ',
+00090620: 2065 6e64 3d27 2729 0a20 2020 2073 7465   end='').    ste
+00090630: 7020 3d20 6e70 2e63 6569 6c28 6466 5f73  p = np.ceil(df_s
+00090640: 6e76 2e73 6861 7065 5b30 5d2f 3230 290a  nv.shape[0]/20).
+00090650: 2020 2020 0a20 2020 2064 665f 736e 765b      .    df_snv[
+00090660: 2773 7461 7274 275d 203d 2064 665f 736e  'start'] = df_sn
+00090670: 765b 2770 6f73 5f6f 7267 275d 202d 206d  v['pos_org'] - m
+00090680: 6465 760a 2020 2020 6466 5f73 6e76 5b27  dev.    df_snv['
+00090690: 656e 6427 5d20 3d20 6466 5f73 6e76 5b27  end'] = df_snv['
+000906a0: 706f 735f 6f72 6727 5d20 2b20 6466 5f73  pos_org'] + df_s
+000906b0: 6e76 5b27 6c65 6e27 5d20 2b20 6d64 6576  nv['len'] + mdev
+000906c0: 0a20 2020 2064 665f 736e 765b 2763 7667  .    df_snv['cvg
+000906d0: 275d 203d 2030 0a0a 2020 2020 625f 7072  '] = 0..    b_pr
+000906e0: 6f63 203d 206e 702e 6675 6c6c 2864 665f  oc = np.full(df_
+000906f0: 736e 762e 7368 6170 655b 305d 2c20 4661  snv.shape[0], Fa
+00090700: 6c73 6529 0a20 2020 2066 6f72 206b 2c20  lse).    for k, 
+00090710: 7370 616e 2069 6e20 656e 756d 6572 6174  span in enumerat
+00090720: 6528 7370 616e 5f6c 7374 293a 0a20 2020  e(span_lst):.   
+00090730: 2020 2020 2062 3020 3d20 6466 5f73 6e76       b0 = df_snv
+00090740: 5b27 6368 7227 5d20 3d3d 2073 7061 6e2e  ['chr'] == span.
+00090750: 6368 720a 2020 2020 2020 2020 6231 203d  chr.        b1 =
+00090760: 2028 6466 5f73 6e76 5b27 7374 6172 7427   (df_snv['start'
+00090770: 5d20 3e3d 2073 7061 6e2e 7374 6172 7429  ] >= span.start)
+00090780: 2026 2028 2864 665f 736e 765b 2773 7461   & ((df_snv['sta
+00090790: 7274 275d 203c 3d20 7370 616e 2e65 6e64  rt'] <= span.end
+000907a0: 2929 0a20 2020 2020 2020 2062 3220 3d20  )).        b2 = 
+000907b0: 2864 665f 736e 765b 2765 6e64 275d 203e  (df_snv['end'] >
+000907c0: 3d20 7370 616e 2e73 7461 7274 2920 2620  = span.start) & 
+000907d0: 2828 6466 5f73 6e76 5b27 656e 6427 5d20  ((df_snv['end'] 
+000907e0: 3c3d 2073 7061 6e2e 656e 6429 290a 2020  <= span.end)).  
+000907f0: 2020 2020 2020 6220 3d20 6230 2026 2028        b = b0 & (
+00090800: 6231 207c 2062 3229 2026 2028 625f 7072  b1 | b2) & (b_pr
+00090810: 6f63 203d 3d20 4661 6c73 6529 0a20 2020  oc == False).   
+00090820: 2020 2020 2064 665f 736e 765f 746d 7020       df_snv_tmp 
+00090830: 3d20 6466 5f73 6e76 5b62 5d0a 2020 2020  = df_snv[b].    
+00090840: 2020 2020 666f 7220 6d2c 2072 6f77 2069      for m, row i
+00090850: 6e20 6466 5f73 6e76 5f74 6d70 2e69 7465  n df_snv_tmp.ite
+00090860: 7272 6f77 7328 293a 0a20 2020 2020 2020  rrows():.       
+00090870: 2020 2020 2072 676e 203d 2072 6567 696f       rgn = regio
+00090880: 6e28 2072 6f77 2e63 6872 2c20 726f 772e  n( row.chr, row.
+00090890: 7374 6172 742c 2072 6f77 2e65 6e64 2c20  start, row.end, 
+000908a0: 5479 7065 2029 0a20 2020 2020 2020 2020  Type ).         
+000908b0: 2020 2062 622c 2063 6320 3d20 7267 6e73     bb, cc = rgns
+000908c0: 5f6c 7374 5f6d 695b 6b5d 2e67 6574 5f69  _lst_mi[k].get_i
+000908d0: 6e74 6572 7365 6374 696f 6e5f 6376 6728  ntersection_cvg(
+000908e0: 7267 6e29 200a 2020 2020 2020 2020 2020  rgn) .          
+000908f0: 2020 6966 2062 623a 200a 2020 2020 2020    if bb: .      
+00090900: 2020 2020 2020 2020 2020 625f 7072 6f63            b_proc
+00090910: 5b6d 5d20 3d20 5472 7565 0a20 2020 2020  [m] = True.     
+00090920: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
+00090930: 762e 6c6f 635b 6d2c 2763 7667 275d 203d  v.loc[m,'cvg'] =
+00090940: 2063 630a 2020 2020 2020 2020 2020 2020   cc.            
+00090950: 2020 2020 0a20 2020 2020 2020 2023 2069      .        # i
+00090960: 6620 6b25 7374 6570 203d 3d20 303a 2070  f k%step == 0: p
+00090970: 7269 6e74 2827 2e27 2c65 6e64 3d27 2729  rint('.',end='')
+00090980: 0a20 2020 2020 2020 2069 6620 6b25 3130  .        if k%10
+00090990: 203d 3d20 303a 2020 2020 0a20 2020 2020   == 0:    .     
+000909a0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+000909b0: 4368 6563 6b69 6e67 2069 6e74 6572 7365  Checking interse
+000909c0: 6374 696f 6e20 2e2e 2025 692f 2569 2028  ction .. %i/%i (
+000909d0: 2569 2927 2025 2028 6b2c 206c 656e 2873  %i)' % (k, len(s
+000909e0: 7061 6e5f 6c73 7429 2c20 6e70 2e73 756d  pan_lst), np.sum
+000909f0: 2862 5f70 726f 6329 292c 2065 6e64 3d27  (b_proc)), end='
+00090a00: 2720 290a 0a20 2020 2070 7269 6e74 2827  ' )..    print('
+00090a10: 5c72 4368 6563 6b69 6e67 2069 6e74 6572  \rChecking inter
+00090a20: 7365 6374 696f 6e20 2e2e 2064 6f6e 652e  section .. done.
+00090a30: 2025 6920 2d3e 2025 6927 2025 2028 6466   %i -> %i' % (df
+00090a40: 5f73 6e76 2e73 6861 7065 5b30 5d2c 206e  _snv.shape[0], n
+00090a50: 702e 7375 6d28 625f 7072 6f63 2929 2029  p.sum(b_proc)) )
+00090a60: 0a20 2020 200a 2020 2020 6466 5f73 6e76  .    .    df_snv
+00090a70: 5f73 656c 203d 2028 6466 5f73 6e76 2e69  _sel = (df_snv.i
+00090a80: 6c6f 635b 625f 7072 6f63 5d29 2e63 6f70  loc[b_proc]).cop
+00090a90: 7928 6465 6570 203d 2054 7275 6529 0a20  y(deep = True). 
+00090aa0: 2020 200a 2020 2020 7265 7475 726e 2864     .    return(d
+00090ab0: 665f 736e 765f 7365 6c29 0a0a 0a64 6566  f_snv_sel)...def
+00090ac0: 206d 6174 6368 696e 675f 736e 7673 2820   matching_snvs( 
+00090ad0: 6466 5f73 6e76 5f73 656c 2c20 6466 5f64  df_snv_sel, df_d
+00090ae0: 6574 6563 7465 642c 2064 6576 5f74 6f6c  etected, dev_tol
+00090af0: 203d 2033 2029 3a0a 2020 2020 0a20 2020   = 3 ):.    .   
+00090b00: 2023 2320 7468 6520 6461 7461 6672 616d   ## the datafram
+00090b10: 6573 206d 7573 6820 6265 2073 6f72 7465  es mush be sorte
+00090b20: 6420 6163 636f 7264 696e 6720 746f 2074  d according to t
+00090b30: 6865 2070 6f73 6974 696f 6e20 2870 6f73  he position (pos
+00090b40: 5f6e 6577 2c20 7374 6172 7429 0a20 2020  _new, start).   
+00090b50: 2064 665f 745f 616c 6c20 3d20 6466 5f73   df_t_all = df_s
+00090b60: 6e76 5f73 656c 0a20 2020 2064 665f 645f  nv_sel.    df_d_
+00090b70: 616c 6c20 3d20 6466 5f64 6574 6563 7465  all = df_detecte
+00090b80: 640a 0a20 2020 2063 6e74 203d 2030 0a20  d..    cnt = 0. 
+00090b90: 2020 2063 6872 6d73 203d 2064 665f 745f     chrms = df_t_
+00090ba0: 616c 6c5b 2763 6872 275d 0a20 2020 2063  all['chr'].    c
+00090bb0: 6872 5f6c 7374 203d 206c 6973 7428 7365  hr_lst = list(se
+00090bc0: 7428 6368 726d 7329 290a 2020 2020 6368  t(chrms)).    ch
+00090bd0: 725f 6c73 742e 736f 7274 2829 0a0a 2020  r_lst.sort()..  
+00090be0: 2020 636e 7420 3d20 300a 2020 2020 4e5f    cnt = 0.    N_
+00090bf0: 7420 3d20 300a 2020 2020 4e5f 6420 3d20  t = 0.    N_d = 
+00090c00: 300a 2020 2020 666f 7220 6e2c 2063 6872  0.    for n, chr
+00090c10: 6d20 696e 2065 6e75 6d65 7261 7465 2863  m in enumerate(c
+00090c20: 6872 5f6c 7374 293a 0a20 2020 2020 2020  hr_lst):.       
+00090c30: 200a 2020 2020 2020 2020 6231 203d 2028   .        b1 = (
+00090c40: 6466 5f74 5f61 6c6c 5b27 6368 7227 5d20  df_t_all['chr'] 
+00090c50: 3d3d 2063 6872 6d29 0a20 2020 2020 2020  == chrm).       
+00090c60: 2062 3220 3d20 2864 665f 645f 616c 6c5b   b2 = (df_d_all[
+00090c70: 2763 6872 275d 203d 3d20 6368 726d 290a  'chr'] == chrm).
+00090c80: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+00090c90: 286e 702e 7375 6d28 6231 2920 3d3d 2030  (np.sum(b1) == 0
+00090ca0: 2920 7c20 286e 702e 7375 6d28 6232 2920  ) | (np.sum(b2) 
+00090cb0: 3d3d 2030 293a 2020 2020 2020 2020 0a20  == 0):        . 
+00090cc0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00090cd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00090ce0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00090cf0: 2020 2020 2020 2064 665f 7420 3d20 6466         df_t = df
+00090d00: 5f74 5f61 6c6c 2e6c 6f63 5b62 312c 3a5d  _t_all.loc[b1,:]
+00090d10: 2e63 6f70 7928 6465 6570 203d 2054 7275  .copy(deep = Tru
+00090d20: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
+00090d30: 665f 6420 3d20 6466 5f64 5f61 6c6c 2e6c  f_d = df_d_all.l
+00090d40: 6f63 5b62 322c 3a5d 2e63 6f70 7928 6465  oc[b2,:].copy(de
+00090d50: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
+00090d60: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00090d70: 2020 2020 6e5f 7461 7267 6574 203d 2064      n_target = d
+00090d80: 665f 742e 7368 6170 655b 305d 0a20 2020  f_t.shape[0].   
+00090d90: 2020 2020 2020 2020 206e 5f64 6574 6563           n_detec
+00090da0: 7465 6420 3d20 6466 5f64 2e73 6861 7065  ted = df_d.shape
+00090db0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00090dc0: 0a20 2020 2020 2020 2020 2020 204e 5f74  .            N_t
+00090dd0: 202b 3d20 6e5f 7461 7267 6574 0a20 2020   += n_target.   
+00090de0: 2020 2020 2020 2020 204e 5f64 202b 3d20           N_d += 
+00090df0: 6e5f 6465 7465 6374 6564 0a20 2020 2020  n_detected.     
+00090e00: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00090e10: 2020 2020 2320 7072 696e 7428 275c 724d      # print('\rM
+00090e20: 6174 6368 696e 6720 2573 2027 2025 2028  atching %s ' % (
+00090e30: 6368 726d 2920 2c20 656e 643d 2727 290a  chrm) , end='').
+00090e40: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+00090e50: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
+00090e60: 2020 636e 745f 6420 3d20 300a 2020 2020    cnt_d = 0.    
+00090e70: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
+00090e80: 6e70 2e66 756c 6c28 6e5f 7461 7267 6574  np.full(n_target
+00090e90: 2c20 2d31 290a 2020 2020 2020 2020 2020  , -1).          
+00090ea0: 2020 6469 7374 203d 206e 702e 6675 6c6c    dist = np.full
+00090eb0: 286e 5f74 6172 6765 742c 2030 290a 2020  (n_target, 0).  
+00090ec0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00090ed0: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
+00090ee0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00090ef0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00090f00: 2020 2020 6966 2028 636e 745f 6420 3e3d      if (cnt_d >=
+00090f10: 206e 5f64 6574 6563 7465 6429 207c 2028   n_detected) | (
+00090f20: 636e 745f 7420 3e3d 206e 5f74 6172 6765  cnt_t >= n_targe
+00090f30: 7429 3a20 6272 6561 6b0a 2020 2020 2020  t): break.      
+00090f40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00090f50: 275c 724d 6174 6368 696e 6720 2573 2c20  '\rMatching %s, 
+00090f60: 2569 2f25 6920 2e2e 2025 692f 2569 2c20  %i/%i .. %i/%i, 
+00090f70: 2569 2f25 6920 2720 2520 5c0a 2020 2020  %i/%i ' % \.    
+00090f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090f90: 2020 2863 6872 6d2c 206e 2c20 6c65 6e28    (chrm, n, len(
+00090fa0: 6368 725f 6c73 7429 2c20 636e 745f 742c  chr_lst), cnt_t,
+00090fb0: 206e 5f74 6172 6765 742c 2063 6e74 5f64   n_target, cnt_d
+00090fc0: 2c20 6e5f 6465 7465 6374 6564 2920 2c20  , n_detected) , 
+00090fd0: 656e 643d 2727 290a 0a20 2020 2020 2020  end='')..       
+00090fe0: 2020 2020 2020 2020 2070 5f74 203d 2064           p_t = d
+00090ff0: 665f 742e 696c 6f63 5b63 6e74 5f74 5d2e  f_t.iloc[cnt_t].
+00091000: 706f 735f 6f72 670a 2020 2020 2020 2020  pos_org.        
+00091010: 2020 2020 2020 2020 705f 6420 3d20 6466          p_d = df
+00091020: 5f64 2e69 6c6f 635b 636e 745f 645d 2e70  _d.iloc[cnt_d].p
+00091030: 6f73 5f6f 7267 0a20 2020 2020 2020 2020  os_org.         
+00091040: 2020 2020 2020 2074 5f74 203d 2064 665f         t_t = df_
+00091050: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7479  t.iloc[cnt_t].ty
+00091060: 7065 0a20 2020 2020 2020 2020 2020 2020  pe.             
+00091070: 2020 2074 5f64 203d 2064 665f 642e 696c     t_d = df_d.il
+00091080: 6f63 5b63 6e74 5f64 5d2e 7479 7065 0a20  oc[cnt_d].type. 
+00091090: 2020 2020 2020 2020 2020 2020 2020 204c                 L
+000910a0: 5f74 203d 206d 6178 286c 656e 2864 665f  _t = max(len(df_
+000910b0: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7365  t.iloc[cnt_t].se
+000910c0: 715f 6f72 6729 2c20 6c65 6e28 6466 5f74  q_org), len(df_t
+000910d0: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
+000910e0: 5f6e 6577 2929 0a20 2020 2020 2020 2020  _new)).         
+000910f0: 2020 2020 2020 204c 5f64 203d 206d 6178         L_d = max
+00091100: 286c 656e 2864 665f 642e 696c 6f63 5b63  (len(df_d.iloc[c
+00091110: 6e74 5f64 5d2e 7365 715f 6f72 6729 2c20  nt_d].seq_org), 
+00091120: 6c65 6e28 6466 5f64 2e69 6c6f 635b 636e  len(df_d.iloc[cn
+00091130: 745f 645d 2e73 6571 5f6e 6577 2929 0a0a  t_d].seq_new))..
+00091140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091150: 6966 2028 705f 7429 203e 2028 705f 6420  if (p_t) > (p_d 
+00091160: 2b20 4c5f 6420 2b20 6465 765f 746f 6c29  + L_d + dev_tol)
+00091170: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00091180: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
+00091190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000911a0: 2020 2020 2069 6620 636e 745f 6420 3e3d       if cnt_d >=
+000911b0: 206e 5f64 6574 6563 7465 643a 2062 7265   n_detected: bre
+000911c0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+000911d0: 2020 2065 6c69 6620 2870 5f74 202b 204c     elif (p_t + L
+000911e0: 5f74 202b 2064 6576 5f74 6f6c 2920 3c20  _t + dev_tol) < 
+000911f0: 2870 5f64 293a 0a20 2020 2020 2020 2020  (p_d):.         
+00091200: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
+00091210: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00091220: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
+00091230: 5f74 203e 3d20 6e5f 7461 7267 6574 3a20  _t >= n_target: 
+00091240: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00091250: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00091260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091270: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
+00091280: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00091290: 2874 5f74 203d 3d20 2756 2729 2026 2028  (t_t == 'V') & (
+000912a0: 745f 6420 3d3d 2027 5627 293a 0a20 2020  t_d == 'V'):.   
+000912b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000912c0: 2020 2020 2069 6620 6c65 6e28 6466 5f74       if len(df_t
+000912d0: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
+000912e0: 5f6e 6577 2920 3d3d 206c 656e 2864 665f  _new) == len(df_
+000912f0: 642e 696c 6f63 5b63 6e74 5f64 5d2e 7365  d.iloc[cnt_d].se
+00091300: 715f 6e65 7729 3a0a 2020 2020 2020 2020  q_new):.        
+00091310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091320: 2020 2020 6966 2028 705f 7420 3d3d 2070      if (p_t == p
+00091330: 5f64 2920 2620 2864 665f 742e 696c 6f63  _d) & (df_t.iloc
+00091340: 5b63 6e74 5f74 5d2e 7365 715f 6e65 7720  [cnt_t].seq_new 
+00091350: 3d3d 2064 665f 642e 696c 6f63 5b63 6e74  == df_d.iloc[cnt
+00091360: 5f64 5d2e 7365 715f 6e65 7729 3a0a 2020  _d].seq_new):.  
+00091370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091380: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00091390: 7463 685b 636e 745f 745d 203d 2063 6e74  tch[cnt_t] = cnt
+000913a0: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
+000913b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000913c0: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
+000913d0: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
 000913e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000913f0: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
-00091400: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
+000913f0: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
+00091400: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
 00091410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091420: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
-00091430: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00091420: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
+00091430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00091440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091450: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
-00091460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091480: 2062 203d 2046 616c 7365 0a20 2020 2020   b = False.     
-00091490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00091450: 2062 203d 2046 616c 7365 0a20 2020 2020   b = False.     
+00091460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091470: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00091480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091490: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+000914a0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
 000914b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914c0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-000914d0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000914e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914f0: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
+000914c0: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
+000914d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000914e0: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
+000914f0: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
 00091500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091510: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
-00091520: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
-00091530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091540: 2020 2020 2020 2020 2020 2064 6973 745b             dist[
-00091550: 636e 745f 745d 203d 2070 5f74 202d 2070  cnt_t] = p_t - p
-00091560: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
-00091570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091580: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
+00091510: 2020 2020 2020 2020 2020 2064 6973 745b             dist[
+00091520: 636e 745f 745d 203d 2070 5f74 202d 2070  cnt_t] = p_t - p
+00091530: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
+00091540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091550: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
+00091560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091570: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+00091580: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
 00091590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000915a0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-000915b0: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
+000915a0: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
+000915b0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
 000915c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000915d0: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
-000915e0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-000915f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091600: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
-00091610: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00091620: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000915d0: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+000915e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000915f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00091600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091610: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00091620: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
 00091630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091640: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-00091650: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00091660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091670: 2020 2020 2020 2069 6620 623a 0a20 2020         if b:.   
+00091640: 2020 2020 2020 2069 6620 623a 0a20 2020         if b:.   
+00091650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091660: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
+00091670: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
 00091680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091690: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
-000916a0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-000916b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000916c0: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
-000916d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000916e0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000916f0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00091700: 2028 745f 7420 3d3d 2027 4927 2920 2620   (t_t == 'I') & 
-00091710: 2874 5f64 203d 3d20 2744 2729 3a0a 2020  (t_d == 'D'):.  
+00091690: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
+000916a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000916b0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000916c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000916d0: 2028 745f 7420 3d3d 2027 4927 2920 2620   (t_t == 'I') & 
+000916e0: 2874 5f64 203d 3d20 2744 2729 3a0a 2020  (t_d == 'D'):.  
+000916f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091700: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
+00091710: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
 00091720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091730: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
-00091740: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
+00091730: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
+00091740: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
 00091750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091760: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
-00091770: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
-00091780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091790: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
-000917a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000917b0: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
-000917c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000917d0: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
-000917e0: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
-000917f0: 2020 2020 2020 2020 656c 6966 2028 745f          elif (t_
-00091800: 7420 3d3d 2027 4427 2920 2620 2874 5f64  t == 'D') & (t_d
-00091810: 203d 3d20 2749 2729 3a0a 2020 2020 2020   == 'I'):.      
-00091820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091830: 2020 6d61 7463 685b 636e 745f 745d 203d    match[cnt_t] =
-00091840: 2063 6e74 5f64 0a20 2020 2020 2020 2020   cnt_d.         
-00091850: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00091860: 6973 745b 636e 745f 745d 203d 2070 5f74  ist[cnt_t] = p_t
-00091870: 202d 2070 5f64 0a20 2020 2020 2020 2020   - p_d.         
-00091880: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00091890: 6e74 5f74 202b 3d20 310a 2020 2020 2020  nt_t += 1.      
-000918a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918b0: 2020 636e 745f 6420 2b3d 2031 0a20 2020    cnt_d += 1.   
-000918c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918d0: 2020 2020 2062 203d 2046 616c 7365 0a20       b = False. 
-000918e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00091900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091910: 2023 2063 6e74 5f74 202b 3d20 310a 2020   # cnt_t += 1.  
-00091920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091930: 2020 2020 2020 2320 636e 745f 6420 2b3d        # cnt_d +=
-00091940: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00091950: 2020 2020 2020 2020 2020 2069 6620 2863             if (c
-00091960: 6e74 5f64 203e 3d20 6e5f 6465 7465 6374  nt_d >= n_detect
-00091970: 6564 2920 7c20 2863 6e74 5f74 203e 3d20  ed) | (cnt_t >= 
-00091980: 6e5f 7461 7267 6574 293a 2062 7265 616b  n_target): break
-00091990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000919a0: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
-000919b0: 2020 2020 2020 2062 203d 206d 6174 6368         b = match
-000919c0: 203e 3d20 300a 2020 2020 2020 2020 2020   >= 0.          
-000919d0: 2020 7768 5f74 203d 2077 6869 6368 2862    wh_t = which(b
-000919e0: 290a 2020 2020 2020 2020 2020 2020 7768  ).            wh
-000919f0: 5f64 203d 206d 6174 6368 5b77 685f 745d  _d = match[wh_t]
-00091a00: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00091a10: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00091a20: 2877 685f 7429 203e 2030 3a0a 2020 2020  (wh_t) > 0:.    
-00091a30: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00091a40: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
-00091a50: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00091a60: 745b 2764 6973 7427 5d20 3d20 6469 7374  t['dist'] = dist
-00091a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091a80: 2020 2020 2064 6631 203d 2064 665f 742e       df1 = df_t.
-00091a90: 696c 6f63 5b77 685f 745d 2e63 6f70 7928  iloc[wh_t].copy(
-00091aa0: 6465 6570 203d 2054 7275 6529 0a20 2020  deep = True).   
-00091ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091ac0: 2064 6632 203d 2064 665f 642e 696c 6f63   df2 = df_d.iloc
-00091ad0: 5b77 685f 645d 2e63 6f70 7928 6465 6570  [wh_d].copy(deep
-00091ae0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-00091af0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
-00091b00: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091b10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00091b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091b30: 6466 5f74 5b27 6469 7374 275d 203d 2064  df_t['dist'] = d
-00091b40: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-00091b50: 2020 2020 2020 2020 6466 3120 3d20 7064          df1 = pd
-00091b60: 2e63 6f6e 6361 7428 5b64 6631 2c20 6466  .concat([df1, df
-00091b70: 5f74 2e69 6c6f 635b 7768 5f74 5d2e 636f  _t.iloc[wh_t].co
-00091b80: 7079 2864 6565 7020 3d20 5472 7565 295d  py(deep = True)]
-00091b90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00091ba0: 2020 2020 2020 6466 3220 3d20 7064 2e63        df2 = pd.c
-00091bb0: 6f6e 6361 7428 5b64 6632 2c20 6466 5f64  oncat([df2, df_d
-00091bc0: 2e69 6c6f 635b 7768 5f64 5d2e 636f 7079  .iloc[wh_d].copy
-00091bd0: 2864 6565 7020 3d20 5472 7565 295d 290a  (deep = True)]).
-00091be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091bf0: 2020 2020 636e 7420 2b3d 2031 0a20 2020      cnt += 1.   
-00091c00: 2020 2020 2020 2020 0a20 2020 2070 7269          .    pri
-00091c10: 6e74 2827 5c72 4d61 7463 6869 6e67 202e  nt('\rMatching .
-00091c20: 2e20 646f 6e65 2e20 272c 2065 6e64 203d  . done. ', end =
-00091c30: 2027 2729 0a20 2020 2069 6620 636e 7420   '').    if cnt 
-00091c40: 3e20 303a 0a20 2020 2020 2020 2064 6632  > 0:.        df2
-00091c50: 203d 2064 6632 2e72 656e 616d 6528 2063   = df2.rename( c
-00091c60: 6f6c 756d 6e73 203d 207b 2763 6872 273a  olumns = {'chr':
-00091c70: 2027 6368 725f 6427 2c20 2774 7970 6527   'chr_d', 'type'
-00091c80: 3a20 2774 7970 655f 6427 2c20 2770 6f73  : 'type_d', 'pos
-00091c90: 5f6f 7267 273a 2027 706f 735f 6f72 675f  _org': 'pos_org_
-00091ca0: 6427 2c20 5c0a 2020 2020 2020 2020 2020  d', \.          
-00091cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091cc0: 2020 2020 2020 2773 6571 5f6f 7267 273a        'seq_org':
-00091cd0: 2027 7365 715f 6f72 675f 6427 2c20 2773   'seq_org_d', 's
-00091ce0: 6571 5f6e 6577 273a 2027 7365 715f 6e65  eq_new': 'seq_ne
-00091cf0: 775f 6427 7d20 290a 2020 2020 2020 2020  w_d'} ).        
-00091d00: 7365 6c5f 636f 6c5f 7420 3d20 5b27 6368  sel_col_t = ['ch
-00091d10: 7227 2c20 2774 7970 6527 2c20 2770 6f73  r', 'type', 'pos
-00091d20: 5f6f 7267 272c 2027 7365 715f 6f72 6727  _org', 'seq_org'
-00091d30: 2c20 2773 6571 5f6e 6577 272c 2027 6469  , 'seq_new', 'di
-00091d40: 7374 275d 0a20 2020 2020 2020 2073 656c  st'].        sel
-00091d50: 5f63 6f6c 5f64 203d 205b 2769 6427 2c20  _col_d = ['id', 
-00091d60: 2763 6872 5f64 272c 2027 7479 7065 5f64  'chr_d', 'type_d
-00091d70: 272c 2027 706f 735f 6f72 675f 6427 2c20  ', 'pos_org_d', 
-00091d80: 2773 6571 5f6f 7267 5f64 272c 2027 7365  'seq_org_d', 'se
-00091d90: 715f 6e65 775f 6427 5d0a 2020 2020 2020  q_new_d'].      
-00091da0: 2020 6466 312e 696e 6465 7820 3d20 7064    df1.index = pd
-00091db0: 2e49 6e64 6578 285b 6b20 666f 7220 6b20  .Index([k for k 
-00091dc0: 696e 2072 616e 6765 2864 6631 2e73 6861  in range(df1.sha
-00091dd0: 7065 5b30 5d29 5d29 0a20 2020 2020 2020  pe[0])]).       
-00091de0: 2064 6632 2e69 6e64 6578 203d 2070 642e   df2.index = pd.
-00091df0: 496e 6465 7828 5b6b 2066 6f72 206b 2069  Index([k for k i
-00091e00: 6e20 7261 6e67 6528 6466 322e 7368 6170  n range(df2.shap
-00091e10: 655b 305d 295d 290a 2020 2020 2020 2020  e[0])]).        
-00091e20: 6466 203d 2070 642e 636f 6e63 6174 2820  df = pd.concat( 
-00091e30: 5b64 6631 5b73 656c 5f63 6f6c 5f74 5d2c  [df1[sel_col_t],
-00091e40: 2064 6632 5b73 656c 5f63 6f6c 5f64 5d5d   df2[sel_col_d]]
-00091e50: 2c20 6178 6973 203d 2031 2c20 736f 7274  , axis = 1, sort
-00091e60: 3d46 616c 7365 2029 2020 2020 2020 2020  =False )        
-00091e70: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00091e80: 2020 2020 2020 7365 6e73 203d 2031 3030        sens = 100
-00091e90: 2a64 662e 7368 6170 655b 305d 2f4e 5f74  *df.shape[0]/N_t
-00091ea0: 0a20 2020 2020 2020 2070 7265 6320 3d20  .        prec = 
-00091eb0: 3130 302a 6466 2e73 6861 7065 5b30 5d2f  100*df.shape[0]/
-00091ec0: 4e5f 640a 2020 2020 2020 2020 7072 696e  N_d.        prin
-00091ed0: 7428 2720 4e5f 743a 2025 692c 204e 5f64  t(' N_t: %i, N_d
-00091ee0: 3a20 2569 202d 3e20 2569 2028 7365 6e73  : %i -> %i (sens
-00091ef0: 3a20 2534 2e31 662c 2070 7265 633a 2025  : %4.1f, prec: %
-00091f00: 342e 3166 2920 2720 2520 5c0a 2020 2020  4.1f) ' % \.    
-00091f10: 2020 2020 2020 2020 2020 284e 5f74 2c20            (N_t, 
-00091f20: 4e5f 642c 2064 662e 7368 6170 655b 305d  N_d, df.shape[0]
-00091f30: 2c20 7365 6e73 2c20 7072 6563 2929 0a20  , sens, prec)). 
-00091f40: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-00091f50: 2c20 7072 6563 2c20 7365 6e73 2c20 6466  , prec, sens, df
-00091f60: 2e73 6861 7065 5b30 5d2c 204e 5f64 2c20  .shape[0], N_d, 
-00091f70: 4e5f 740a 2020 2020 656c 7365 3a0a 2020  N_t.    else:.  
-00091f80: 2020 2020 2020 7072 696e 7428 2720 2729        print(' ')
-00091f90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00091fa0: 4e6f 6e65 2c20 302c 2030 2c20 302c 2030  None, 0, 0, 0, 0
-00091fb0: 2c20 300a 2020 2020 2020 2020 2020 2020  , 0.            
-00091fc0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-00091fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091fe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091ff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092000: 2323 2323 2323 2323 2323 230a 2323 2053  ###########.## S
-00092010: 656f 6b68 7975 6e20 596f 6f6e 2028 7379  eokhyun Yoon (sy
-00092020: 6f6f 6e40 646b 752e 6564 7529 204f 6374  oon@dku.edu) Oct
-00092030: 2e20 3034 2c20 3230 3230 0a23 2323 2323  . 04, 2020.#####
+00091760: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
+00091770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091780: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
+00091790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000917a0: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
+000917b0: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
+000917c0: 2020 2020 2020 2020 656c 6966 2028 745f          elif (t_
+000917d0: 7420 3d3d 2027 4427 2920 2620 2874 5f64  t == 'D') & (t_d
+000917e0: 203d 3d20 2749 2729 3a0a 2020 2020 2020   == 'I'):.      
+000917f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091800: 2020 6d61 7463 685b 636e 745f 745d 203d    match[cnt_t] =
+00091810: 2063 6e74 5f64 0a20 2020 2020 2020 2020   cnt_d.         
+00091820: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00091830: 6973 745b 636e 745f 745d 203d 2070 5f74  ist[cnt_t] = p_t
+00091840: 202d 2070 5f64 0a20 2020 2020 2020 2020   - p_d.         
+00091850: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00091860: 6e74 5f74 202b 3d20 310a 2020 2020 2020  nt_t += 1.      
+00091870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091880: 2020 636e 745f 6420 2b3d 2031 0a20 2020    cnt_d += 1.   
+00091890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000918a0: 2020 2020 2062 203d 2046 616c 7365 0a20       b = False. 
+000918b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000918c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000918d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000918e0: 2023 2063 6e74 5f74 202b 3d20 310a 2020   # cnt_t += 1.  
+000918f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091900: 2020 2020 2020 2320 636e 745f 6420 2b3d        # cnt_d +=
+00091910: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00091920: 2020 2020 2020 2020 2020 2069 6620 2863             if (c
+00091930: 6e74 5f64 203e 3d20 6e5f 6465 7465 6374  nt_d >= n_detect
+00091940: 6564 2920 7c20 2863 6e74 5f74 203e 3d20  ed) | (cnt_t >= 
+00091950: 6e5f 7461 7267 6574 293a 2062 7265 616b  n_target): break
+00091960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091970: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
+00091980: 2020 2020 2020 2062 203d 206d 6174 6368         b = match
+00091990: 203e 3d20 300a 2020 2020 2020 2020 2020   >= 0.          
+000919a0: 2020 7768 5f74 203d 2077 6869 6368 2862    wh_t = which(b
+000919b0: 290a 2020 2020 2020 2020 2020 2020 7768  ).            wh
+000919c0: 5f64 203d 206d 6174 6368 5b77 685f 745d  _d = match[wh_t]
+000919d0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+000919e0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000919f0: 2877 685f 7429 203e 2030 3a0a 2020 2020  (wh_t) > 0:.    
+00091a00: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00091a10: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
+00091a20: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00091a30: 745b 2764 6973 7427 5d20 3d20 6469 7374  t['dist'] = dist
+00091a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091a50: 2020 2020 2064 6631 203d 2064 665f 742e       df1 = df_t.
+00091a60: 696c 6f63 5b77 685f 745d 2e63 6f70 7928  iloc[wh_t].copy(
+00091a70: 6465 6570 203d 2054 7275 6529 0a20 2020  deep = True).   
+00091a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091a90: 2064 6632 203d 2064 665f 642e 696c 6f63   df2 = df_d.iloc
+00091aa0: 5b77 685f 645d 2e63 6f70 7928 6465 6570  [wh_d].copy(deep
+00091ab0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+00091ac0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
+00091ad0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00091ae0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00091af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091b00: 6466 5f74 5b27 6469 7374 275d 203d 2064  df_t['dist'] = d
+00091b10: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+00091b20: 2020 2020 2020 2020 6466 3120 3d20 7064          df1 = pd
+00091b30: 2e63 6f6e 6361 7428 5b64 6631 2c20 6466  .concat([df1, df
+00091b40: 5f74 2e69 6c6f 635b 7768 5f74 5d2e 636f  _t.iloc[wh_t].co
+00091b50: 7079 2864 6565 7020 3d20 5472 7565 295d  py(deep = True)]
+00091b60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00091b70: 2020 2020 2020 6466 3220 3d20 7064 2e63        df2 = pd.c
+00091b80: 6f6e 6361 7428 5b64 6632 2c20 6466 5f64  oncat([df2, df_d
+00091b90: 2e69 6c6f 635b 7768 5f64 5d2e 636f 7079  .iloc[wh_d].copy
+00091ba0: 2864 6565 7020 3d20 5472 7565 295d 290a  (deep = True)]).
+00091bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091bc0: 2020 2020 636e 7420 2b3d 2031 0a20 2020      cnt += 1.   
+00091bd0: 2020 2020 2020 2020 0a20 2020 2070 7269          .    pri
+00091be0: 6e74 2827 5c72 4d61 7463 6869 6e67 202e  nt('\rMatching .
+00091bf0: 2e20 646f 6e65 2e20 272c 2065 6e64 203d  . done. ', end =
+00091c00: 2027 2729 0a20 2020 2069 6620 636e 7420   '').    if cnt 
+00091c10: 3e20 303a 0a20 2020 2020 2020 2064 6632  > 0:.        df2
+00091c20: 203d 2064 6632 2e72 656e 616d 6528 2063   = df2.rename( c
+00091c30: 6f6c 756d 6e73 203d 207b 2763 6872 273a  olumns = {'chr':
+00091c40: 2027 6368 725f 6427 2c20 2774 7970 6527   'chr_d', 'type'
+00091c50: 3a20 2774 7970 655f 6427 2c20 2770 6f73  : 'type_d', 'pos
+00091c60: 5f6f 7267 273a 2027 706f 735f 6f72 675f  _org': 'pos_org_
+00091c70: 6427 2c20 5c0a 2020 2020 2020 2020 2020  d', \.          
+00091c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091c90: 2020 2020 2020 2773 6571 5f6f 7267 273a        'seq_org':
+00091ca0: 2027 7365 715f 6f72 675f 6427 2c20 2773   'seq_org_d', 's
+00091cb0: 6571 5f6e 6577 273a 2027 7365 715f 6e65  eq_new': 'seq_ne
+00091cc0: 775f 6427 7d20 290a 2020 2020 2020 2020  w_d'} ).        
+00091cd0: 7365 6c5f 636f 6c5f 7420 3d20 5b27 6368  sel_col_t = ['ch
+00091ce0: 7227 2c20 2774 7970 6527 2c20 2770 6f73  r', 'type', 'pos
+00091cf0: 5f6f 7267 272c 2027 7365 715f 6f72 6727  _org', 'seq_org'
+00091d00: 2c20 2773 6571 5f6e 6577 272c 2027 6469  , 'seq_new', 'di
+00091d10: 7374 275d 0a20 2020 2020 2020 2073 656c  st'].        sel
+00091d20: 5f63 6f6c 5f64 203d 205b 2769 6427 2c20  _col_d = ['id', 
+00091d30: 2763 6872 5f64 272c 2027 7479 7065 5f64  'chr_d', 'type_d
+00091d40: 272c 2027 706f 735f 6f72 675f 6427 2c20  ', 'pos_org_d', 
+00091d50: 2773 6571 5f6f 7267 5f64 272c 2027 7365  'seq_org_d', 'se
+00091d60: 715f 6e65 775f 6427 5d0a 2020 2020 2020  q_new_d'].      
+00091d70: 2020 6466 312e 696e 6465 7820 3d20 7064    df1.index = pd
+00091d80: 2e49 6e64 6578 285b 6b20 666f 7220 6b20  .Index([k for k 
+00091d90: 696e 2072 616e 6765 2864 6631 2e73 6861  in range(df1.sha
+00091da0: 7065 5b30 5d29 5d29 0a20 2020 2020 2020  pe[0])]).       
+00091db0: 2064 6632 2e69 6e64 6578 203d 2070 642e   df2.index = pd.
+00091dc0: 496e 6465 7828 5b6b 2066 6f72 206b 2069  Index([k for k i
+00091dd0: 6e20 7261 6e67 6528 6466 322e 7368 6170  n range(df2.shap
+00091de0: 655b 305d 295d 290a 2020 2020 2020 2020  e[0])]).        
+00091df0: 6466 203d 2070 642e 636f 6e63 6174 2820  df = pd.concat( 
+00091e00: 5b64 6631 5b73 656c 5f63 6f6c 5f74 5d2c  [df1[sel_col_t],
+00091e10: 2064 6632 5b73 656c 5f63 6f6c 5f64 5d5d   df2[sel_col_d]]
+00091e20: 2c20 6178 6973 203d 2031 2c20 736f 7274  , axis = 1, sort
+00091e30: 3d46 616c 7365 2029 2020 2020 2020 2020  =False )        
+00091e40: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00091e50: 2020 2020 2020 7365 6e73 203d 2031 3030        sens = 100
+00091e60: 2a64 662e 7368 6170 655b 305d 2f4e 5f74  *df.shape[0]/N_t
+00091e70: 0a20 2020 2020 2020 2070 7265 6320 3d20  .        prec = 
+00091e80: 3130 302a 6466 2e73 6861 7065 5b30 5d2f  100*df.shape[0]/
+00091e90: 4e5f 640a 2020 2020 2020 2020 7072 696e  N_d.        prin
+00091ea0: 7428 2720 4e5f 743a 2025 692c 204e 5f64  t(' N_t: %i, N_d
+00091eb0: 3a20 2569 202d 3e20 2569 2028 7365 6e73  : %i -> %i (sens
+00091ec0: 3a20 2534 2e31 662c 2070 7265 633a 2025  : %4.1f, prec: %
+00091ed0: 342e 3166 2920 2720 2520 5c0a 2020 2020  4.1f) ' % \.    
+00091ee0: 2020 2020 2020 2020 2020 284e 5f74 2c20            (N_t, 
+00091ef0: 4e5f 642c 2064 662e 7368 6170 655b 305d  N_d, df.shape[0]
+00091f00: 2c20 7365 6e73 2c20 7072 6563 2929 0a20  , sens, prec)). 
+00091f10: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
+00091f20: 2c20 7072 6563 2c20 7365 6e73 2c20 6466  , prec, sens, df
+00091f30: 2e73 6861 7065 5b30 5d2c 204e 5f64 2c20  .shape[0], N_d, 
+00091f40: 4e5f 740a 2020 2020 656c 7365 3a0a 2020  N_t.    else:.  
+00091f50: 2020 2020 2020 7072 696e 7428 2720 2729        print(' ')
+00091f60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00091f70: 4e6f 6e65 2c20 302c 2030 2c20 302c 2030  None, 0, 0, 0, 0
+00091f80: 2c20 300a 2020 2020 2020 2020 2020 2020  , 0.            
+00091f90: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00091fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091fd0: 2323 2323 2323 2323 2323 230a 2323 2053  ###########.## S
+00091fe0: 656f 6b68 7975 6e20 596f 6f6e 2028 7379  eokhyun Yoon (sy
+00091ff0: 6f6f 6e40 646b 752e 6564 7529 204f 6374  oon@dku.edu) Oct
+00092000: 2e20 3034 2c20 3230 3230 0a23 2323 2323  . 04, 2020.#####
+00092010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00092040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092080: 2323 2323 230a 0a0a 0a0a 2020 2020 2020  #####.....      
-00092090: 2020 0a                                    .
+00092050: 2323 2323 230a 0a0a 0a0a 2020 2020 2020  #####.....      
+00092060: 2020 0a                                    .
```

### Comparing `StringFix-0.6.5/StringFix/pybam.py` & `StringFix-0.6.7/StringFix/pybam.py`

 * *Files identical despite different names*

### Comparing `StringFix-0.6.5/StringFix/run_sfix.py` & `StringFix-0.6.7/StringFix/run_sfix.py`

 * *Files 0% similar despite different names*

```diff
@@ -64,15 +64,15 @@
     args = parser.parse_args()
     return args, parser
 
 
 def main():
 
     print('+------------------------------+')
-    print('|      Stringfix v.0.6.5       |')
+    print('|      Stringfix v.0.6.6       |')
     print('+------------------------------+')
 
     args, parser = get_args()
 
     if (args.input is None): # | (args.gtf is None) | (args.gnm is None):
         parser.print_help()
         return
```

### Comparing `StringFix-0.6.5/StringFix.egg-info/PKG-INFO` & `StringFix-0.6.7/StringFix.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.6.5
+Version: 0.6.7
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.6.5/setup.py` & `StringFix-0.6.7/setup.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from setuptools import setup, find_packages
 
 setup(
     # 배포할 패키지의 이름을 적어줍니다. setup.py파일을 가지는 폴더 이름과 동일하게 합니다.
     name                = 'StringFix',
     # 배포할 패키지의 버전을 적어줍니다. 첫 등록이므로 0.1 또는 0.0.1을 사용합니다.
-    version             = '0.6.5',
+    version             = '0.6.7',
     # 배포할 패키지에 대한 설명을 작성합니다.
     description         = 'Annotation guided transcriptome assembly program.',
     # 배포하는 사람의 이름을 작성합니다.
     author              = 'Joongho Lee, Seokhyun Yoon',
     # 배포하는 사람의 메일주소를 작성합니다.
     author_email        = 'syoon@dku.edu',
     # 배포하는 패키지의 url을 적어줍니다. 보통 github 링크를 적습니다.
```

