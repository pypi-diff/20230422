# Comparing `tmp/StringFix-0.6.7.tar.gz` & `tmp/StringFix-0.6.8.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "StringFix-0.6.7.tar", last modified: Sat Apr 22 03:59:17 2023, max compression
+gzip compressed data, was "StringFix-0.6.8.tar", last modified: Sat Apr 22 05:29:11 2023, max compression
```

## Comparing `StringFix-0.6.7.tar` & `StringFix-0.6.8.tar`

### file list

```diff
@@ -1,19 +1,19 @@
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 03:59:17.490205 StringFix-0.6.7/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.6.7/LICENSE
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.6.7/MANIFEST.in
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 03:59:17.490205 StringFix-0.6.7/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.6.7/README.md
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 03:59:17.490205 StringFix-0.6.7/StringFix/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.6.7/StringFix/__init__.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)   598115 2023-04-22 03:59:03.000000 StringFix-0.6.7/StringFix/core.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)    53685 2023-04-22 02:22:03.000000 StringFix-0.6.7/StringFix/pybam.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     7641 2023-04-22 03:48:29.000000 StringFix-0.6.7/StringFix/run_sfix.py
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 03:59:17.490205 StringFix-0.6.7/StringFix.egg-info/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/SOURCES.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/dependency_links.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/not-zip-safe
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/requires.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       10 2023-04-22 03:59:17.000000 StringFix-0.6.7/StringFix.egg-info/top_level.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-22 03:59:17.490205 StringFix-0.6.7/setup.cfg
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-22 03:59:12.000000 StringFix-0.6.7/setup.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 05:29:11.708037 StringFix-0.6.8/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.6.8/LICENSE
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.6.8/MANIFEST.in
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 05:29:11.708037 StringFix-0.6.8/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.6.8/README.md
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 05:29:11.708037 StringFix-0.6.8/StringFix/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.6.8/StringFix/__init__.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)   598129 2023-04-22 05:28:21.000000 StringFix-0.6.8/StringFix/core.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    53685 2023-04-22 02:22:03.000000 StringFix-0.6.8/StringFix/pybam.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     7641 2023-04-22 03:48:29.000000 StringFix-0.6.8/StringFix/run_sfix.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 05:29:11.708037 StringFix-0.6.8/StringFix.egg-info/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 05:29:11.000000 StringFix-0.6.8/StringFix.egg-info/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-22 05:29:11.000000 StringFix-0.6.8/StringFix.egg-info/SOURCES.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 05:29:11.000000 StringFix-0.6.8/StringFix.egg-info/dependency_links.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 05:29:11.000000 StringFix-0.6.8/StringFix.egg-info/not-zip-safe
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-22 05:29:11.000000 StringFix-0.6.8/StringFix.egg-info/requires.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       10 2023-04-22 05:29:11.000000 StringFix-0.6.8/StringFix.egg-info/top_level.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-22 05:29:11.708037 StringFix-0.6.8/setup.cfg
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-22 05:28:55.000000 StringFix-0.6.8/setup.py
```

### Comparing `StringFix-0.6.7/LICENSE` & `StringFix-0.6.8/LICENSE`

 * *Files identical despite different names*

### Comparing `StringFix-0.6.7/PKG-INFO` & `StringFix-0.6.8/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.6.7
+Version: 0.6.8
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.6.7/StringFix/core.py` & `StringFix-0.6.8/StringFix/core.py`

 * *Files 0% similar despite different names*

```diff
@@ -29540,7844 +29540,7845 @@
 00073630: 0a20 2020 2020 2020 2020 2020 2074 5f74  .            t_t
 00073640: 696d 6520 3d20 656c 6170 7365 645f 7469  ime = elapsed_ti
 00073650: 6d65 2a6c 656e 2872 735f 7475 706c 655f  me*len(rs_tuple_
 00073660: 6c73 7429 2f6d 0a20 2020 2020 2020 2020  lst)/m.         
 00073670: 2020 2072 5f74 696d 6520 3d20 745f 7469     r_time = t_ti
 00073680: 6d65 202d 2065 6c61 7073 6564 5f74 696d  me - elapsed_tim
 00073690: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-000736a0: 206d 2531 3030 203d 3d20 303a 0a20 2020   m%100 == 0:.   
-000736b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000736c0: 616e 6e6f 7420 6973 204e 6f6e 653a 0a20  annot is None:. 
-000736d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000736e0: 2020 2070 7269 6e74 2827 5c72 5365 6172     print('\rSear
-000736f0: 6368 2069 736f 666f 726d 7320 2620 6573  ch isoforms & es
-00073700: 7420 6162 756e 6461 6e63 6573 202e 2e2e  t abundances ...
-00073710: 2e2e 2025 692f 2569 2020 2027 205c 0a20  .. %i/%i   ' \. 
-00073720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073730: 2020 2020 2020 2020 2020 2520 286d 2c20            % (m, 
-00073740: 6c65 6e28 7273 5f74 7570 6c65 5f6c 7374  len(rs_tuple_lst
-00073750: 2929 2c20 656e 643d 2727 290a 2020 2020  )), end='').    
-00073760: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00073770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00073780: 2020 2020 2020 7072 696e 7428 275c 7252        print('\rR
-00073790: 6563 6f76 6572 696e 6720 6973 6f66 6f72  ecovering isofor
-000737a0: 6d73 2026 2065 7374 2061 6275 6e64 616e  ms & est abundan
-000737b0: 6365 7320 2e2e 2e2e 2e20 2569 2f25 6920  ces ..... %i/%i 
-000737c0: 2020 2720 5c0a 2020 2020 2020 2020 2020    ' \.          
-000737d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000737e0: 2025 2028 6d2c 206c 656e 2872 735f 7475   % (m, len(rs_tu
-000737f0: 706c 655f 6c73 7429 292c 2065 6e64 3d27  ple_lst)), end='
-00073800: 2729 0a20 2020 2020 2020 2020 2020 206d  ').            m
-00073810: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00073820: 2020 0a20 2020 2070 6f6f 6c2e 636c 6f73    .    pool.clos
-00073830: 6528 290a 2020 2020 706f 6f6c 2e6a 6f69  e().    pool.joi
-00073840: 6e28 290a 2020 2020 0a20 2020 2069 6620  n().    .    if 
-00073850: 7665 7262 6f73 653a 200a 0a20 2020 2020  verbose: ..     
-00073860: 2020 206e 5f63 6f76 5f65 6820 3d20 300a     n_cov_eh = 0.
-00073870: 2020 2020 2020 2020 2320 6966 2067 6420          # if gd 
-00073880: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00073890: 2020 2020 2069 6620 6c65 6e28 6764 5f6c       if len(gd_l
-000738a0: 7374 2920 3e20 303a 0a20 2020 2020 2020  st) > 0:.       
-000738b0: 2020 2020 2066 6f72 2067 6420 696e 2067       for gd in g
-000738c0: 645f 6c73 743a 0a20 2020 2020 2020 2020  d_lst:.         
-000738d0: 2020 2020 2020 2066 6f72 2074 6420 696e         for td in
-000738e0: 2067 642e 7464 5f6c 7374 3a0a 2020 2020   gd.td_lst:.    
-000738f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073900: 6966 2074 642e 636f 7620 3e20 312e 313a  if td.cov > 1.1:
-00073910: 206e 5f63 6f76 5f65 6820 2b3d 2031 0a0a   n_cov_eh += 1..
-00073920: 2020 2020 2020 2020 656c 6170 7365 645f          elapsed_
-00073930: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
-00073940: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
-00073950: 310a 2020 2020 2020 2020 6966 2061 6e6e  1.        if ann
-00073960: 6f74 2069 7320 4e6f 6e65 3a20 0a20 2020  ot is None: .   
-00073970: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00073980: 5c72 5365 6172 6368 2069 736f 666f 726d  \rSearch isoform
-00073990: 7320 2620 6573 7420 6162 756e 6461 6e63  s & est abundanc
-000739a0: 6573 202e 2e2e 2e2e 2064 6f6e 6520 2825  es ..... done (%
-000739b0: 6929 2020 2020 2020 2020 2020 2020 2020  i)              
-000739c0: 2020 2027 2025 2028 696e 7428 656c 6170     ' % (int(elap
-000739d0: 7365 645f 7469 6d65 3129 2929 0a20 2020  sed_time1))).   
-000739e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000739f0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-00073a00: 5265 636f 7665 7269 6e67 2069 736f 666f  Recovering isofo
-00073a10: 726d 7320 2620 6573 7420 6162 756e 6461  rms & est abunda
-00073a20: 6e63 6573 202e 2e2e 2e2e 2064 6f6e 6520  nces ..... done 
-00073a30: 2825 692c 2025 6929 2020 2020 2020 2020  (%i, %i)        
-00073a40: 2020 2020 2020 2020 2027 2025 2028 696e           ' % (in
-00073a50: 7428 656c 6170 7365 645f 7469 6d65 3129  t(elapsed_time1)
-00073a60: 2c20 6e5f 636f 765f 6568 2929 0a20 2020  , n_cov_eh)).   
-00073a70: 200a 2020 2020 6420 3d20 7b27 6773 697a   .    d = {'gsiz
-00073a80: 6527 3a20 6773 697a 652c 2027 6776 6f6c  e': gsize, 'gvol
-00073a90: 273a 2067 766f 6c2c 2027 6364 5f74 6827  ': gvol, 'cd_th'
-00073aa0: 3a20 6364 5f74 682c 2027 775f 636e 7427  : cd_th, 'w_cnt'
-00073ab0: 3a20 775f 636e 7420 7d0a 2020 2020 6466  : w_cnt }.    df
-00073ac0: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
-00073ad0: 6461 7461 203d 2064 290a 2020 2020 0a20  data = d).    . 
-00073ae0: 2020 2072 6574 7572 6e20 5472 5f6c 7374     return Tr_lst
-00073af0: 2c20 4973 5f6c 7374 2c20 4754 465f 6c73  , Is_lst, GTF_ls
-00073b00: 742c 2064 662c 2067 7270 5f6c 7374 2c20  t, df, grp_lst, 
-00073b10: 6764 5f6c 7374 2c20 6574 735f 7375 6d2c  gd_lst, ets_sum,
-00073b20: 2065 7478 5f73 756d 2023 206d 6e5f 6c73   etx_sum # mn_ls
-00073b30: 740a 0a0a 6465 6620 6765 745f 7472 616e  t...def get_tran
-00073b40: 7363 7269 7074 7328 2072 676e 735f 6c73  scripts( rgns_ls
-00073b50: 745f 6d69 2c20 7267 6e73 5f6c 7374 5f6e  t_mi, rgns_lst_n
-00073b60: 642c 2072 676e 735f 6c73 745f 7374 2c20  d, rgns_lst_st, 
-00073b70: 7265 6164 5f6c 656e 2c20 616e 6e6f 7420  read_len, annot 
-00073b80: 3d20 4e6f 6e65 2c20 6c65 6e5f 7468 203d  = None, len_th =
-00073b90: 204d 494e 5f54 525f 4c45 4e47 5448 2c20   MIN_TR_LENGTH, 
-00073ba0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00073bb0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
-00073bc0: 276c 6173 736f 272c 206e 7265 6320 3d20  'lasso', nrec = 
-00073bd0: 302c 2073 7461 7274 203d 2030 2c20 7665  0, start = 0, ve
-00073be0: 7262 6f73 6520 3d20 5472 7565 2c20 7364  rbose = True, sd
-00073bf0: 6976 203d 2032 3020 293a 0a0a 2020 2020  iv = 20 ):..    
-00073c00: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
-00073c10: 652e 7469 6d65 2829 0a20 2020 2063 6e74  e.time().    cnt
-00073c20: 7020 3d20 303b 2063 6e74 6e20 3d20 303b  p = 0; cntn = 0;
-00073c30: 2063 6e74 3020 3d20 303b 2063 6e74 6620   cnt0 = 0; cntf 
-00073c40: 3d20 303b 2063 6e74 6720 3d20 300a 2020  = 0; cntg = 0.  
-00073c50: 2020 6670 203d 2030 3b20 666e 203d 2030    fp = 0; fn = 0
-00073c60: 3b20 6630 203d 2030 3b20 6666 203d 2030  ; f0 = 0; ff = 0
-00073c70: 0a0a 2020 2020 6e5f 7472 203d 2030 0a20  ..    n_tr = 0. 
-00073c80: 2020 2047 5446 5f6c 7374 203d 205b 5d0a     GTF_lst = [].
-00073c90: 2020 2020 5472 5f6c 7374 203d 205b 5d0a      Tr_lst = [].
-00073ca0: 2020 2020 4973 5f6c 7374 203d 205b 5d0a      Is_lst = [].
-00073cb0: 2020 2020 6d6e 5f6c 7374 203d 205b 5d0a      mn_lst = [].
-00073cc0: 2020 2020 6772 705f 6c73 7420 3d20 5b5d      grp_lst = []
-00073cd0: 0a20 2020 2067 645f 6c73 7420 3d20 5b5d  .    gd_lst = []
-00073ce0: 0a20 2020 2063 645f 7468 203d 206e 702e  .    cd_th = np.
-00073cf0: 7a65 726f 7328 6c65 6e28 7267 6e73 5f6c  zeros(len(rgns_l
-00073d00: 7374 5f6d 6929 2c20 6474 7970 653d 696e  st_mi), dtype=in
-00073d10: 7429 0a20 2020 2077 5f63 6e74 203d 206e  t).    w_cnt = n
-00073d20: 702e 7a65 726f 7328 6c65 6e28 7267 6e73  p.zeros(len(rgns
-00073d30: 5f6c 7374 5f6d 6929 2c20 6474 7970 653d  _lst_mi), dtype=
-00073d40: 696e 7429 0a20 2020 2067 7369 7a65 203d  int).    gsize =
-00073d50: 206e 702e 7a65 726f 7328 6c65 6e28 7267   np.zeros(len(rg
-00073d60: 6e73 5f6c 7374 5f6d 6929 2c20 6474 7970  ns_lst_mi), dtyp
-00073d70: 653d 696e 7429 0a20 2020 2067 766f 6c20  e=int).    gvol 
-00073d80: 3d20 6e70 2e7a 6572 6f73 286c 656e 2872  = np.zeros(len(r
-00073d90: 676e 735f 6c73 745f 6d69 292c 2064 7479  gns_lst_mi), dty
-00073da0: 7065 3d69 6e74 290a 0a20 2020 2067 636e  pe=int)..    gcn
-00073db0: 7420 3d20 300a 2020 2020 7374 6172 745f  t = 0.    start_
-00073dc0: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
-00073dd0: 6528 290a 2020 2020 6966 2076 6572 626f  e().    if verbo
-00073de0: 7365 3a20 0a20 2020 2020 2020 2069 6620  se: .        if 
-00073df0: 616e 6e6f 7420 6973 204e 6f6e 653a 2070  annot is None: p
-00073e00: 7269 6e74 2827 5c72 5365 6172 6368 2069  rint('\rSearch i
-00073e10: 736f 666f 726d 7320 2620 6573 7420 6162  soforms & est ab
-00073e20: 756e 6461 6e63 6573 202e 2e2e 2e2e 2027  undances ..... '
-00073e30: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
-00073e40: 2020 656c 7365 3a20 7072 696e 7428 275c    else: print('\
-00073e50: 7252 6563 6f76 6572 696e 6720 6973 6f66  rRecovering isof
-00073e60: 6f72 6d73 2026 2065 7374 2061 6275 6e64  orms & est abund
-00073e70: 616e 6365 7320 2e2e 2e2e 2e20 272c 2065  ances ..... ', e
-00073e80: 6e64 3d27 2729 0a20 2020 2020 2020 200a  nd='').        .
-00073e90: 2020 2020 2327 2727 0a20 2020 2067 7620      #'''.    gv 
-00073ea0: 3d20 6e70 2e7a 6572 6f73 286c 656e 2872  = np.zeros(len(r
-00073eb0: 676e 735f 6c73 745f 6e64 292c 2064 7479  gns_lst_nd), dty
-00073ec0: 7065 3d6e 702e 666c 6f61 7433 3229 0a20  pe=np.float32). 
-00073ed0: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-00073ee0: 6528 6c65 6e28 7267 6e73 5f6c 7374 5f6e  e(len(rgns_lst_n
-00073ef0: 6429 293a 0a20 2020 2020 2020 2067 765b  d)):.        gv[
-00073f00: 6b5d 203d 202d 6c65 6e28 7267 6e73 5f6c  k] = -len(rgns_l
-00073f10: 7374 5f6e 645b 6b5d 2e72 676e 7329 2023  st_nd[k].rgns) #
-00073f20: 202d 7267 6e73 5f6c 7374 5f6d 695b 6b5d   -rgns_lst_mi[k]
-00073f30: 2e67 6574 5f76 6f6c 756d 6528 290a 2020  .get_volume().  
-00073f40: 2020 6f64 7220 3d20 6776 2e61 7267 736f    odr = gv.argso
-00073f50: 7274 2829 0a20 2020 2023 2727 270a 2020  rt().    #'''.  
-00073f60: 2020 0a20 2020 2072 735f 7475 706c 655f    .    rs_tuple_
-00073f70: 6c73 7420 3d20 5b5d 0a20 2020 2069 6620  lst = [].    if 
-00073f80: 7374 6172 7420 3d3d 2030 3a0a 2020 2020  start == 0:.    
-00073f90: 2020 2020 6966 206e 7265 6320 3d3d 2030      if nrec == 0
-00073fa0: 3a20 4e72 6563 203d 206c 656e 2872 676e  : Nrec = len(rgn
-00073fb0: 735f 6c73 745f 6d69 290a 2020 2020 2020  s_lst_mi).      
-00073fc0: 2020 656c 7365 3a20 4e72 6563 203d 206e    else: Nrec = n
-00073fd0: 7265 630a 2020 2020 656c 7365 3a0a 2020  rec.    else:.  
-00073fe0: 2020 2020 2020 4e72 6563 203d 206c 656e        Nrec = len
-00073ff0: 2872 676e 735f 6c73 745f 6d69 290a 2020  (rgns_lst_mi).  
-00074000: 2020 2020 2020 6966 2073 7461 7274 203e        if start >
-00074010: 3d20 4e72 6563 3a20 7374 6172 7420 3d20  = Nrec: start = 
-00074020: 4e72 6563 2d31 0a0a 2020 2020 666f 7220  Nrec-1..    for 
-00074030: 6d20 696e 2072 616e 6765 284e 7265 632d  m in range(Nrec-
-00074040: 7374 6172 7429 3a0a 2020 2020 2020 2020  start):.        
-00074050: 6b20 3d20 6f64 725b 6d2b 7374 6172 745d  k = odr[m+start]
-00074060: 0a20 2020 2020 2020 2067 6420 3d20 4e6f  .        gd = No
-00074070: 6e65 0a20 2020 2020 2020 2069 6620 2861  ne.        if (a
-00074080: 6e6e 6f74 2069 7320 6e6f 7420 4e6f 6e65  nnot is not None
-00074090: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
-000740a0: 6966 206b 203c 206c 656e 2861 6e6e 6f74  if k < len(annot
-000740b0: 293a 2067 6420 3d20 616e 6e6f 745b 6b5d  ): gd = annot[k]
-000740c0: 0a20 2020 2020 2020 2072 735f 7475 706c  .        rs_tupl
-000740d0: 655f 6c73 742e 6170 7065 6e64 2820 2872  e_lst.append( (r
-000740e0: 676e 735f 6c73 745f 6d69 5b6b 5d2c 2072  gns_lst_mi[k], r
-000740f0: 676e 735f 6c73 745f 6e64 5b6b 5d2c 2072  gns_lst_nd[k], r
-00074100: 676e 735f 6c73 745f 7374 5b6b 5d2c 206b  gns_lst_st[k], k
-00074110: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00074120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074130: 2020 6c65 6e5f 7468 2c20 6d65 7468 6f64    len_th, method
-00074140: 2c20 7265 6164 5f6c 656e 2c20 6764 2920  , read_len, gd) 
-00074150: 290a 0a20 2020 2065 7473 5f73 756d 203d  )..    ets_sum =
-00074160: 2030 2020 2020 2020 2020 0a20 2020 2065   0        .    e
-00074170: 7478 5f73 756d 203d 2030 2020 2020 2020  tx_sum = 0      
-00074180: 2020 0a20 2020 2066 6f72 206d 2069 6e20    .    for m in 
-00074190: 7261 6e67 6528 6c65 6e28 7273 5f74 7570  range(len(rs_tup
-000741a0: 6c65 5f6c 7374 2929 3a0a 2020 2020 2020  le_lst)):.      
-000741b0: 2020 0a20 2020 2020 2020 2074 6c73 742c    .        tlst,
-000741c0: 2069 6c73 742c 2067 7466 5f6c 696e 6573   ilst, gtf_lines
-000741d0: 2c20 6773 2c20 6776 2c20 6d6e 2c20 6374  , gs, gv, mn, ct
-000741e0: 2c20 6772 702c 206b 2c20 6764 2c20 6574  , grp, k, gd, et
-000741f0: 732c 2065 7478 203d 206d 635f 636f 7265  s, etx = mc_core
-00074200: 5f67 6574 5f74 7228 7273 5f74 7570 6c65  _get_tr(rs_tuple
-00074210: 5f6c 7374 5b6d 5d29 0a20 2020 2020 2020  _lst[m]).       
-00074220: 200a 2020 2020 2020 2020 6574 735f 7375   .        ets_su
-00074230: 6d20 3d20 6574 735f 7375 6d20 2b20 6574  m = ets_sum + et
-00074240: 730a 2020 2020 2020 2020 6574 785f 7375  s.        etx_su
-00074250: 6d20 3d20 6574 785f 7375 6d20 2b20 6574  m = etx_sum + et
-00074260: 780a 0a20 2020 2020 2020 2054 725f 6c73  x..        Tr_ls
-00074270: 7420 3d20 5472 5f6c 7374 202b 2074 6c73  t = Tr_lst + tls
-00074280: 740a 2020 2020 2020 2020 4973 5f6c 7374  t.        Is_lst
-00074290: 203d 2049 735f 6c73 7420 2b20 696c 7374   = Is_lst + ilst
-000742a0: 0a20 2020 2020 2020 2047 5446 5f6c 7374  .        GTF_lst
-000742b0: 203d 2047 5446 5f6c 7374 202b 2067 7466   = GTF_lst + gtf
-000742c0: 5f6c 696e 6573 0a20 2020 2020 2020 2067  _lines.        g
-000742d0: 7369 7a65 5b6b 5d20 3d20 6773 0a20 2020  size[k] = gs.   
-000742e0: 2020 2020 2067 766f 6c5b 6b5d 203d 2067       gvol[k] = g
-000742f0: 760a 2020 2020 2020 2020 6364 5f74 685b  v.        cd_th[
-00074300: 6b5d 203d 206d 6e0a 2020 2020 2020 2020  k] = mn.        
-00074310: 775f 636e 745b 6b5d 203d 2063 740a 2020  w_cnt[k] = ct.  
-00074320: 2020 2020 2020 6966 2067 7270 2069 7320        if grp is 
-00074330: 6e6f 7420 4e6f 6e65 3a20 0a20 2020 2020  not None: .     
-00074340: 2020 2020 2020 2067 7270 5f6c 7374 2e61         grp_lst.a
-00074350: 7070 656e 6428 6772 7029 0a20 2020 2020  ppend(grp).     
-00074360: 2020 2020 2020 2067 645f 6c73 742e 6170         gd_lst.ap
-00074370: 7065 6e64 2867 6429 0a0a 2020 2020 2020  pend(gd)..      
-00074380: 2020 6966 2076 6572 626f 7365 3a20 0a20    if verbose: . 
-00074390: 2020 2020 2020 2020 2020 2069 6620 6d20             if m 
-000743a0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-000743b0: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
-000743c0: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
-000743d0: 2d20 7374 6172 745f 7469 6d65 310a 2020  - start_time1.  
-000743e0: 2020 2020 2020 2020 2020 2020 2020 745f                t_
-000743f0: 7469 6d65 203d 2065 6c61 7073 6564 5f74  time = elapsed_t
-00074400: 696d 652a 6c65 6e28 7273 5f74 7570 6c65  ime*len(rs_tuple
-00074410: 5f6c 7374 292f 6d0a 2020 2020 2020 2020  _lst)/m.        
-00074420: 2020 2020 2020 2020 725f 7469 6d65 203d          r_time =
-00074430: 2074 5f74 696d 6520 2d20 656c 6170 7365   t_time - elapse
-00074440: 645f 7469 6d65 0a20 2020 2020 2020 2020  d_time.         
-00074450: 2020 2020 2020 2069 6620 6d25 3130 3020         if m%100 
-00074460: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00074470: 2020 2020 2020 2020 2020 6966 2061 6e6e            if ann
-00074480: 6f74 2069 7320 4e6f 6e65 3a0a 2020 2020  ot is None:.    
-00074490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000744a0: 2020 2020 7072 696e 7428 275c 7253 6561      print('\rSea
-000744b0: 7263 6820 6973 6f66 6f72 6d73 2026 2065  rch isoforms & e
-000744c0: 7374 2061 6275 6e64 616e 6365 7320 2e2e  st abundances ..
-000744d0: 2e2e 2e20 2569 2f25 6920 2020 2720 5c0a  ... %i/%i   ' \.
-000744e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000744f0: 2020 2020 2020 2020 2020 2020 2020 2025                 %
-00074500: 2028 696e 7428 725f 7469 6d65 292c 206d   (int(r_time), m
-00074510: 2c20 6c65 6e28 7273 5f74 7570 6c65 5f6c  , len(rs_tuple_l
-00074520: 7374 2929 2c20 656e 643d 2727 290a 2020  st)), end='').  
-00074530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074540: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00074550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074560: 7072 696e 7428 275c 7252 6563 6f76 6572  print('\rRecover
-00074570: 696e 6720 6973 6f66 6f72 6d73 2026 2065  ing isoforms & e
-00074580: 7374 2061 6275 6e64 616e 6365 7320 2e2e  st abundances ..
-00074590: 2e2e 2e20 2569 2f25 6920 2020 2720 5c0a  ... %i/%i   ' \.
-000745a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000745b0: 2020 2020 2020 2020 2020 2020 2020 2025                 %
-000745c0: 2028 6d2c 206c 656e 2872 735f 7475 706c   (m, len(rs_tupl
-000745d0: 655f 6c73 7429 292c 2065 6e64 3d27 2729  e_lst)), end='')
-000745e0: 0a20 2020 200a 2020 2020 6966 2076 6572  .    .    if ver
-000745f0: 626f 7365 3a20 0a20 2020 2020 2020 2065  bose: .        e
-00074600: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
-00074610: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00074620: 7274 5f74 696d 6531 0a20 2020 2020 2020  rt_time1.       
-00074630: 2069 6620 616e 6e6f 7420 6973 204e 6f6e   if annot is Non
-00074640: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-00074650: 7072 696e 7428 275c 7253 6561 7263 6820  print('\rSearch 
-00074660: 6973 6f66 6f72 6d73 2026 2065 7374 2061  isoforms & est a
-00074670: 6275 6e64 616e 6365 7320 2e2e 2e2e 2e20  bundances ..... 
-00074680: 646f 6e65 2028 2569 2920 2020 2020 2020  done (%i)       
-00074690: 2020 2020 2020 2020 2720 2520 2869 6e74          ' % (int
-000746a0: 2865 6c61 7073 6564 5f74 696d 6531 2929  (elapsed_time1))
-000746b0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-000746c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000746d0: 7428 275c 7252 6563 6f76 6572 696e 6720  t('\rRecovering 
-000746e0: 6973 6f66 6f72 6d73 2026 2065 7374 2061  isoforms & est a
-000746f0: 6275 6e64 616e 6365 7320 2e2e 2e2e 2e20  bundances ..... 
-00074700: 646f 6e65 2028 2569 2920 2020 2020 2020  done (%i)       
-00074710: 2020 2020 2020 2020 2720 2520 2869 6e74          ' % (int
-00074720: 2865 6c61 7073 6564 5f74 696d 6531 2929  (elapsed_time1))
-00074730: 290a 2020 2020 0a20 2020 2064 203d 207b  ).    .    d = {
-00074740: 2767 7369 7a65 273a 2067 7369 7a65 2c20  'gsize': gsize, 
-00074750: 2767 766f 6c27 3a20 6776 6f6c 2c20 2763  'gvol': gvol, 'c
-00074760: 645f 7468 273a 2063 645f 7468 2c20 2777  d_th': cd_th, 'w
-00074770: 5f63 6e74 273a 2077 5f63 6e74 207d 0a20  _cnt': w_cnt }. 
-00074780: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
-00074790: 7261 6d65 2864 6174 6120 3d20 6429 0a20  rame(data = d). 
-000747a0: 2020 200a 2020 2020 7265 7475 726e 2054     .    return T
-000747b0: 725f 6c73 742c 2049 735f 6c73 742c 2047  r_lst, Is_lst, G
-000747c0: 5446 5f6c 7374 2c20 6466 2c20 6772 705f  TF_lst, df, grp_
-000747d0: 6c73 742c 2067 645f 6c73 742c 2065 7473  lst, gd_lst, ets
-000747e0: 5f73 756d 2c20 6574 785f 7375 6d20 2320  _sum, etx_sum # 
-000747f0: 6d6e 5f6c 7374 0a0a 0a23 2323 2323 2323  mn_lst...#######
-00074800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00074810: 2323 2323 230a 2323 2323 2053 7472 696e  #####.#### Strin
-00074820: 6746 6978 206d 6169 6e20 2323 2323 2323  gFix main ######
-00074830: 2323 0a0a 6465 6620 6765 745f 7470 6d28  ##..def get_tpm(
-00074840: 7472 5f6c 7374 293a 0a20 2020 200a 2020  tr_lst):.    .  
-00074850: 2020 6162 6e5f 746f 7461 6c20 3d20 300a    abn_total = 0.
-00074860: 2020 2020 666f 7220 7472 2069 6e20 7472      for tr in tr
-00074870: 5f6c 7374 3a0a 2020 2020 2020 2020 6162  _lst:.        ab
-00074880: 6e5f 746f 7461 6c20 2b3d 2074 722e 6162  n_total += tr.ab
-00074890: 6e0a 2020 2020 6e66 203d 2031 3030 3030  n.    nf = 10000
-000748a0: 3030 2f61 626e 5f74 6f74 616c 0a0a 2020  00/abn_total..  
-000748b0: 2020 7472 5f6c 7374 5f6f 7574 203d 205b    tr_lst_out = [
-000748c0: 5d0a 2020 2020 666f 7220 7420 696e 2074  ].    for t in t
-000748d0: 725f 6c73 743a 0a20 2020 2020 2020 2054  r_lst:.        T
-000748e0: 504d 203d 2074 2e74 706d 2a6e 660a 2020  PM = t.tpm*nf.  
-000748f0: 2020 2020 2020 7472 203d 2054 7261 6e73        tr = Trans
-00074900: 6372 6970 7428 742e 7072 6566 6978 2c74  cript(t.prefix,t
-00074910: 2e67 6964 782c 742e 6772 705f 7369 7a65  .gidx,t.grp_size
-00074920: 2c74 2e69 636e 742c 742e 6368 722c 742e  ,t.icnt,t.chr,t.
-00074930: 7374 6172 742c 742e 656e 642c 742e 7374  start,t.end,t.st
-00074940: 7261 6e64 2c20 742e 6364 6e67 2c20 5c0a  rand, t.cdng, \.
-00074950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074960: 2020 2020 2020 2020 742e 7365 712c 742e          t.seq,t.
-00074970: 6162 6e2c 2054 504d 2c20 742e 6973 6f5f  abn, TPM, t.iso_
-00074980: 6672 6163 2c20 742e 7072 6f62 2c20 742e  frac, t.prob, t.
-00074990: 6e65 7873 2c20 742e 6776 6f6c 290a 2020  nexs, t.gvol).  
-000749a0: 2020 2020 2020 7472 5f6c 7374 5f6f 7574        tr_lst_out
-000749b0: 2e61 7070 656e 6428 7472 290a 2020 2020  .append(tr).    
-000749c0: 2020 2020 0a20 2020 2072 6574 7572 6e28      .    return(
-000749d0: 7472 5f6c 7374 5f6f 7574 290a 0a64 6566  tr_lst_out)..def
-000749e0: 2066 696c 7465 725f 7267 6e73 2820 725f   filter_rgns( r_
-000749f0: 6c73 745f 6d2c 2072 5f6c 7374 5f6e 642c  lst_m, r_lst_nd,
-00074a00: 2072 5f6c 7374 5f73 7469 2c20 766f 6c5f   r_lst_sti, vol_
-00074a10: 7468 2c20 735f 7468 203d 2030 2e39 2029  th, s_th = 0.9 )
-00074a20: 3a0a 2020 2020 0a20 2020 2074 6f5f 6465  :.    .    to_de
-00074a30: 6c20 3d20 5b5d 0a20 2020 2066 6f72 206b  l = [].    for k
-00074a40: 2c20 7220 696e 2065 6e75 6d65 7261 7465  , r in enumerate
-00074a50: 2872 5f6c 7374 5f6d 293a 0a20 2020 2020  (r_lst_m):.     
-00074a60: 2020 2076 6f6c 203d 2072 2e67 6574 5f76     vol = r.get_v
-00074a70: 6f6c 756d 6528 2920 2320 2b20 722e 6765  olume() # + r.ge
-00074a80: 745f 766f 6c75 6d65 2829 0a20 2020 2020  t_volume().     
-00074a90: 2020 2069 6620 2876 6f6c 203c 2076 6f6c     if (vol < vol
-00074aa0: 5f74 6829 3a0a 2020 2020 2020 2020 2020  _th):.          
-00074ab0: 2020 746f 5f64 656c 2e61 7070 656e 6428    to_del.append(
-00074ac0: 6b29 0a20 2020 2020 2020 2065 6c73 653a  k).        else:
-00074ad0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00074ae0: 722e 636e 745f 7220 3e20 303a 0a20 2020  r.cnt_r > 0:.   
-00074af0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00074b00: 722e 636e 745f 732f 722e 636e 745f 7220  r.cnt_s/r.cnt_r 
-00074b10: 3e20 735f 7468 3a20 746f 5f64 656c 2e61  > s_th: to_del.a
-00074b20: 7070 656e 6428 6b29 0a20 2020 2020 2020  ppend(k).       
-00074b30: 2020 2020 200a 2020 2020 6966 206c 656e       .    if len
-00074b40: 2874 6f5f 6465 6c29 203e 2030 3a0a 2020  (to_del) > 0:.  
-00074b50: 2020 2020 2020 746f 5f64 656c 2e73 6f72        to_del.sor
-00074b60: 7428 7265 7665 7273 653d 5472 7565 290a  t(reverse=True).
-00074b70: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
-00074b80: 2074 6f5f 6465 6c3a 200a 2020 2020 2020   to_del: .      
-00074b90: 2020 2020 2020 6465 6c20 725f 6c73 745f        del r_lst_
-00074ba0: 6d5b 6b5d 0a20 2020 2020 2020 2020 2020  m[k].           
-00074bb0: 2064 656c 2072 5f6c 7374 5f6e 645b 6b5d   del r_lst_nd[k]
-00074bc0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-00074bd0: 2072 5f6c 7374 5f73 7469 5b6b 5d0a 2020   r_lst_sti[k].  
-00074be0: 2020 0a20 2020 2072 6574 7572 6e28 725f    .    return(r_
-00074bf0: 6c73 745f 6d2c 2072 5f6c 7374 5f6e 642c  lst_m, r_lst_nd,
-00074c00: 2072 5f6c 7374 5f73 7469 290a 0a0a 6465   r_lst_sti)...de
-00074c10: 6620 6669 6c74 6572 5f72 676e 735f 6f6c  f filter_rgns_ol
-00074c20: 6428 2072 5f6c 7374 5f6d 2c20 725f 6c73  d( r_lst_m, r_ls
-00074c30: 745f 6e64 2c20 766f 6c5f 7468 2029 3a0a  t_nd, vol_th ):.
-00074c40: 2020 2020 0a20 2020 2074 6f5f 6465 6c20      .    to_del 
-00074c50: 3d20 5b5d 0a20 2020 2066 6f72 206b 2069  = [].    for k i
-00074c60: 6e20 7261 6e67 6528 6c65 6e28 725f 6c73  n range(len(r_ls
-00074c70: 745f 6d29 293a 0a20 2020 2020 2020 2076  t_m)):.        v
-00074c80: 6f6c 203d 2072 5f6c 7374 5f6d 5b6b 5d2e  ol = r_lst_m[k].
-00074c90: 6765 745f 766f 6c75 6d65 2829 0a20 2020  get_volume().   
-00074ca0: 2020 2020 2069 6620 766f 6c20 3c20 766f       if vol < vo
-00074cb0: 6c5f 7468 3a0a 2020 2020 2020 2020 2020  l_th:.          
-00074cc0: 2020 746f 5f64 656c 2e61 7070 656e 6428    to_del.append(
-00074cd0: 6b29 0a20 2020 2020 2020 2020 2020 200a  k).            .
-00074ce0: 2020 2020 6966 206c 656e 2874 6f5f 6465      if len(to_de
-00074cf0: 6c29 203e 2030 3a0a 2020 2020 2020 2020  l) > 0:.        
-00074d00: 746f 5f64 656c 2e73 6f72 7428 7265 7665  to_del.sort(reve
-00074d10: 7273 653d 5472 7565 290a 2020 2020 2020  rse=True).      
-00074d20: 2020 666f 7220 6b20 696e 2074 6f5f 6465    for k in to_de
-00074d30: 6c3a 200a 2020 2020 2020 2020 2020 2020  l: .            
-00074d40: 6465 6c20 725f 6c73 745f 6d5b 6b5d 0a20  del r_lst_m[k]. 
-00074d50: 2020 2020 2020 2020 2020 2064 656c 2072             del r
-00074d60: 5f6c 7374 5f6e 645b 6b5d 0a20 2020 200a  _lst_nd[k].    .
-00074d70: 2020 2020 7265 7475 726e 2872 5f6c 7374      return(r_lst
-00074d80: 5f6d 2c20 725f 6c73 745f 6e64 290a 0a0a  _m, r_lst_nd)...
-00074d90: 2323 2320 4465 6661 756c 7420 5472 7320  ### Default Trs 
-00074da0: 4669 6c74 6572 2070 6172 616d 6574 6572  Filter parameter
-00074db0: 730a 6465 6620 6368 6563 6b5f 7267 6e73  s.def check_rgns
-00074dc0: 2820 7267 6e73 5f6c 7374 5f6d 692c 2072  ( rgns_lst_mi, r
-00074dd0: 676e 735f 6c73 745f 6e64 2029 3a0a 0a20  gns_lst_nd ):.. 
-00074de0: 2020 2063 6e74 203d 2030 0a20 2020 2076     cnt = 0.    v
-00074df0: 5f74 6f74 203d 2030 0a20 2020 2076 5f68  _tot = 0.    v_h
-00074e00: 7962 203d 2030 0a20 2020 2066 6f72 206b  yb = 0.    for k
-00074e10: 2069 6e20 7261 6e67 6528 6c65 6e28 7267   in range(len(rg
-00074e20: 6e73 5f6c 7374 5f6d 6929 293a 0a20 2020  ns_lst_mi)):.   
-00074e30: 2020 2020 2063 766f 6c20 3d20 7267 6e73       cvol = rgns
-00074e40: 5f6c 7374 5f6d 695b 6b5d 2e67 6574 5f76  _lst_mi[k].get_v
-00074e50: 6f6c 756d 6528 290a 2020 2020 2020 2020  olume().        
-00074e60: 765f 746f 7420 2b3d 2063 766f 6c0a 2020  v_tot += cvol.  
-00074e70: 2020 2020 2020 6370 203d 2030 0a20 2020        cp = 0.   
-00074e80: 2020 2020 2063 6e20 3d20 300a 2020 2020       cn = 0.    
-00074e90: 2020 2020 666f 7220 6d20 696e 2072 616e      for m in ran
-00074ea0: 6765 286c 656e 2872 676e 735f 6c73 745f  ge(len(rgns_lst_
-00074eb0: 6e64 5b6b 5d2e 7267 6e73 2929 3a0a 2020  nd[k].rgns)):.  
-00074ec0: 2020 2020 2020 2020 2020 6966 2072 676e            if rgn
-00074ed0: 735f 6c73 745f 6e64 5b6b 5d2e 7267 6e73  s_lst_nd[k].rgns
-00074ee0: 5b6d 5d2e 7873 203c 2030 3a20 636e 202b  [m].xs < 0: cn +
-00074ef0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00074f00: 656c 6966 2072 676e 735f 6c73 745f 6e64  elif rgns_lst_nd
-00074f10: 5b6b 5d2e 7267 6e73 5b6d 5d2e 7873 203e  [k].rgns[m].xs >
-00074f20: 2030 3a20 6370 202b 3d20 310a 2020 2020   0: cp += 1.    
-00074f30: 2020 2020 6966 2028 6370 203e 2030 2920      if (cp > 0) 
-00074f40: 2620 2863 6e20 3e20 3029 3a0a 2020 2020  & (cn > 0):.    
-00074f50: 2020 2020 2020 2020 765f 6879 6220 2b3d          v_hyb +=
-00074f60: 2063 766f 6c0a 2020 2020 2020 2020 2020   cvol.          
-00074f70: 2020 636e 7420 2b3d 2031 0a20 2020 2020    cnt += 1.     
-00074f80: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
-00074f90: 3d3d 3d20 2569 203d 3d3d 2720 2520 6b29  === %i ===' % k)
-00074fa0: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
-00074fb0: 676e 735f 6c73 745f 6d69 5b6b 5d2e 7072  gns_lst_mi[k].pr
-00074fc0: 696e 745f 7368 6f72 7428 290a 2020 2020  int_short().    
-00074fd0: 2020 2020 2020 2020 2320 7267 6e73 5f6c          # rgns_l
-00074fe0: 7374 5f6e 645b 6b5d 2e70 7269 6e74 5f73  st_nd[k].print_s
-00074ff0: 686f 7274 2829 0a20 2020 2020 2020 2020  hort().         
-00075000: 2020 200a 2020 2020 7265 7475 726e 2063     .    return c
-00075010: 6e74 2c20 765f 6879 622c 2076 5f74 6f74  nt, v_hyb, v_tot
-00075020: 0a20 2020 200a 0a27 2727 0a4c 494e 455f  .    ..'''.LINE_
-00075030: 5641 4c49 4420 3d20 300a 4e4f 5f4d 4f52  VALID = 0.NO_MOR
-00075040: 455f 4c49 4e45 203d 2034 0a4c 494e 455f  E_LINE = 4.LINE_
-00075050: 494e 5641 4c49 4420 3d20 320a 0a43 4f4e  INVALID = 2..CON
-00075060: 5449 4e55 4544 203d 2030 0a4e 4557 5f43  TINUED = 0.NEW_C
-00075070: 4852 4d20 3d20 310a 2320 4c49 4e45 5f49  HRM = 1.# LINE_I
-00075080: 4e56 414c 4944 203d 2032 0a4e 4f54 5f53  NVALID = 2.NOT_S
-00075090: 4f52 5445 4420 3d20 330a 2727 270a 0a64  ORTED = 3.'''..d
-000750a0: 6566 2063 6865 636b 5f73 7472 616e 6428  ef check_strand(
-000750b0: 2072 5f6d 5f6c 7374 2c20 725f 6e64 5f6c   r_m_lst, r_nd_l
-000750c0: 7374 2029 3a0a 2020 2020 0a20 2020 2070  st ):.    .    p
-000750d0: 6f73 203d 2030 0a20 2020 206e 6567 203d  os = 0.    neg =
-000750e0: 2030 0a20 2020 2066 6f72 2072 2069 6e20   0.    for r in 
-000750f0: 725f 6e64 5f6c 7374 3a0a 2020 2020 2020  r_nd_lst:.      
-00075100: 2020 6966 206c 656e 2872 2e72 676e 7329    if len(r.rgns)
-00075110: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-00075120: 2020 6966 2072 2e72 676e 735b 305d 2e78    if r.rgns[0].x
-00075130: 7320 3e20 303a 2070 6f73 202b 3d20 310a  s > 0: pos += 1.
-00075140: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00075150: 2072 2e72 676e 735b 305d 2e78 7320 3c20   r.rgns[0].xs < 
-00075160: 303a 206e 6567 202b 3d20 310a 2020 2020  0: neg += 1.    
-00075170: 2020 2020 2020 2020 0a20 2020 2066 6f72          .    for
-00075180: 2072 2069 6e20 725f 6d5f 6c73 743a 0a20   r in r_m_lst:. 
-00075190: 2020 2020 2020 2069 6620 6c65 6e28 722e         if len(r.
-000751a0: 7267 6e73 2920 3e20 303a 0a20 2020 2020  rgns) > 0:.     
-000751b0: 2020 2020 2020 2069 6620 722e 7267 6e73         if r.rgns
-000751c0: 5b30 5d2e 7873 203e 2030 3a20 706f 7320  [0].xs > 0: pos 
-000751d0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-000751e0: 2065 6c69 6620 722e 7267 6e73 5b30 5d2e   elif r.rgns[0].
-000751f0: 7873 203c 2030 3a20 6e65 6720 2b3d 2031  xs < 0: neg += 1
-00075200: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00075210: 2020 7265 7475 726e 2070 6f73 2c20 6e65    return pos, ne
-00075220: 670a 0a0a 6465 6620 6d63 5f63 6f72 655f  g...def mc_core_
-00075230: 6275 696c 645f 636e 7467 2873 616d 5f6c  build_cntg(sam_l
-00075240: 7374 5f6e 5f73 6129 3a0a 2020 2020 0a20  st_n_sa):.    . 
-00075250: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
-00075260: 7361 6d5f 6c73 742c 2073 6120 3d20 7361  sam_lst, sa = sa
-00075270: 6d5f 6c73 745f 6e5f 7361 5b3a 2d31 5d2c  m_lst_n_sa[:-1],
-00075280: 2073 616d 5f6c 7374 5f6e 5f73 615b 2d31   sam_lst_n_sa[-1
-00075290: 5d20 2020 2020 2020 200a 2020 2020 6966  ]        .    if
-000752a0: 2028 6c65 6e28 7361 6d5f 6c73 7429 203e   (len(sam_lst) >
-000752b0: 3d20 4d49 4e5f 4e5f 5244 535f 5045 525f  = MIN_N_RDS_PER_
-000752c0: 4745 4e45 293a 2023 204d 494e 5f52 445f  GENE): # MIN_RD_
-000752d0: 4e55 4d5f 5045 525f 4745 4e45 293a 2023  NUM_PER_GENE): #
-000752e0: 2026 2028 2863 703d 3d30 2920 7c20 2863   & ((cp==0) | (c
-000752f0: 6e3d 3d30 2929 3a0a 0a20 2020 2020 2020  n==0)):..       
-00075300: 2072 5f6c 7374 5f6d 2c20 725f 6c73 745f   r_lst_m, r_lst_
-00075310: 6e64 2c20 725f 6c73 745f 7374 692c 2072  nd, r_lst_sti, r
-00075320: 676e 5f69 6478 203d 205c 0a20 2020 2020  gn_idx = \.     
-00075330: 2020 2020 2020 2067 6574 5f72 6567 696f         get_regio
-00075340: 6e73 5f61 6c6c 5f66 726f 6d5f 7361 6d28  ns_all_from_sam(
-00075350: 2073 616d 5f6c 7374 2c20 7361 203d 2073   sam_lst, sa = s
-00075360: 6120 290a 2020 2020 2020 2020 6220 3d20  a ).        b = 
-00075370: 4661 6c73 650a 2020 2020 2020 2020 7361  False.        sa
-00075380: 6d5f 6c73 7420 3d20 4e6f 6e65 2023 205b  m_lst = None # [
-00075390: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
-000753a0: 2020 2069 6620 623a 0a20 2020 2020 2020     if b:.       
-000753b0: 2072 5f6c 7374 5f6d 203d 205b 5d0a 2020   r_lst_m = [].  
-000753c0: 2020 2020 2020 725f 6c73 745f 6e64 203d        r_lst_nd =
-000753d0: 205b 5d0a 2020 2020 2020 2020 725f 6c73   [].        r_ls
-000753e0: 745f 7374 6920 3d20 5b5d 0a20 2020 200a  t_sti = [].    .
-000753f0: 2020 2020 7265 7475 726e 2072 5f6c 7374      return r_lst
-00075400: 5f6d 2c20 725f 6c73 745f 6e64 2c20 725f  _m, r_lst_nd, r_
-00075410: 6c73 745f 7374 690a 0a0a 6465 6620 6275  lst_sti...def bu
-00075420: 696c 645f 636f 6e74 6967 7328 735f 6c73  ild_contigs(s_ls
-00075430: 745f 6f66 5f6c 7374 2c20 7469 746c 6520  t_of_lst, title 
-00075440: 3d20 2727 293a 0a20 2020 200a 2020 2020  = ''):.    .    
-00075450: 7267 6e73 5f6c 7374 5f6d 6920 3d20 5b5d  rgns_lst_mi = []
-00075460: 0a20 2020 2072 676e 735f 6c73 745f 6e64  .    rgns_lst_nd
-00075470: 203d 205b 5d0a 2020 2020 7267 6e73 5f6c   = [].    rgns_l
-00075480: 7374 5f73 7420 3d20 5b5d 0a20 2020 200a  st_st = [].    .
-00075490: 2020 2020 666f 7220 6b2c 2073 5f6c 7374      for k, s_lst
-000754a0: 2069 6e20 656e 756d 6572 6174 6528 735f   in enumerate(s_
-000754b0: 6c73 745f 6f66 5f6c 7374 293a 0a20 2020  lst_of_lst):.   
-000754c0: 2020 2020 200a 2020 2020 2020 2020 725f       .        r_
-000754d0: 6c73 745f 6d69 2c20 725f 6c73 745f 6e64  lst_mi, r_lst_nd
-000754e0: 2c20 725f 6c73 745f 7374 203d 206d 635f  , r_lst_st = mc_
-000754f0: 636f 7265 5f62 7569 6c64 5f63 6e74 6728  core_build_cntg(
-00075500: 735f 6c73 7429 0a20 2020 2020 2020 2072  s_lst).        r
-00075510: 676e 735f 6c73 745f 6d69 203d 2072 676e  gns_lst_mi = rgn
-00075520: 735f 6c73 745f 6d69 202b 2072 5f6c 7374  s_lst_mi + r_lst
-00075530: 5f6d 690a 2020 2020 2020 2020 7267 6e73  _mi.        rgns
-00075540: 5f6c 7374 5f6e 6420 3d20 7267 6e73 5f6c  _lst_nd = rgns_l
-00075550: 7374 5f6e 6420 2b20 725f 6c73 745f 6e64  st_nd + r_lst_nd
-00075560: 0a20 2020 2020 2020 2072 676e 735f 6c73  .        rgns_ls
-00075570: 745f 7374 203d 2072 676e 735f 6c73 745f  t_st = rgns_lst_
-00075580: 7374 202b 2072 5f6c 7374 5f73 740a 0a20  st + r_lst_st.. 
-00075590: 2020 2020 2020 2069 6620 6b25 3130 3020         if k%100 
-000755a0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-000755b0: 2020 2320 7072 696e 7428 275c 7242 7569    # print('\rBui
-000755c0: 6c64 696e 6720 6c6f 6369 2026 2043 4d61  lding loci & CMa
-000755d0: 7420 2e2e 2e20 2825 692f 2569 6729 2020  t ... (%i/%ig)  
-000755e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000755f0: 2020 2020 2020 2720 5c0a 2020 2020 2020        ' \.      
-00075600: 2020 2020 2020 2320 2020 2020 2020 2520        #       % 
-00075610: 286b 2c20 6c65 6e28 735f 6c73 745f 6f66  (k, len(s_lst_of
-00075620: 5f6c 7374 2929 2c20 656e 643d 2727 290a  _lst)), end='').
-00075630: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00075640: 7428 275c 7227 202b 2027 2027 2a31 3030  t('\r' + ' '*100
-00075650: 2c20 656e 643d 2727 2c20 666c 7573 6820  , end='', flush 
-00075660: 3d20 5472 7565 290a 2020 2020 2020 2020  = True).        
-00075670: 2020 2020 6966 206c 656e 2874 6974 6c65      if len(title
-00075680: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00075690: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-000756a0: 7242 7569 6c64 696e 6720 6c6f 6369 2026  rBuilding loci &
-000756b0: 2043 4d61 7420 2e2e 2e20 2825 692f 2569   CMat ... (%i/%i
-000756c0: 6329 2027 205c 0a20 2020 2020 2020 2020  c) ' \.         
-000756d0: 2020 2020 2020 2020 2020 2020 2025 2028               % (
-000756e0: 6b2c 206c 656e 2873 5f6c 7374 5f6f 665f  k, len(s_lst_of_
-000756f0: 6c73 7429 292c 2065 6e64 3d27 272c 2066  lst)), end='', f
-00075700: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
-00075710: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00075720: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00075730: 7269 6e74 2827 5c72 2020 2070 726f 6365  rint('\r   proce
-00075740: 7373 696e 6720 2573 2028 2569 2f25 6963  ssing %s (%i/%ic
-00075750: 2920 2720 5c0a 2020 2020 2020 2020 2020  ) ' \.          
-00075760: 2020 2020 2020 2020 2020 2020 2520 2874              % (t
-00075770: 6974 6c65 2c20 6b2c 206c 656e 2873 5f6c  itle, k, len(s_l
-00075780: 7374 5f6f 665f 6c73 7429 292c 2065 6e64  st_of_lst)), end
-00075790: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
-000757a0: 6529 0a20 2020 200a 2020 2020 2320 7072  e).    .    # pr
-000757b0: 696e 7428 275c 7242 7569 6c64 696e 6720  int('\rBuilding 
-000757c0: 6c6f 6369 2026 2043 4d61 7420 2e2e 2e20  loci & CMat ... 
-000757d0: 646f 6e65 2028 2569 6729 2020 2020 2020  done (%ig)      
-000757e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000757f0: 2020 2720 2520 286c 656e 2873 5f6c 7374    ' % (len(s_lst
-00075800: 5f6f 665f 6c73 7429 292c 2065 6e64 3d27  _of_lst)), end='
-00075810: 2729 0a20 2020 2072 6574 7572 6e20 7267  ').    return rg
-00075820: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
-00075830: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
-00075840: 5f73 740a 0a0a 6465 6620 6275 696c 645f  _st...def build_
-00075850: 636f 6e74 6967 735f 6d63 2873 5f6c 7374  contigs_mc(s_lst
-00075860: 5f6f 665f 6c73 742c 206e 5f63 6f72 6573  _of_lst, n_cores
-00075870: 203d 204e 554d 5f43 4f52 4553 2c20 7469   = NUM_CORES, ti
-00075880: 746c 6520 3d20 2727 293a 0a20 2020 200a  tle = ''):.    .
-00075890: 2020 2020 7267 6e73 5f6c 7374 5f6d 6920      rgns_lst_mi 
-000758a0: 3d20 5b5d 0a20 2020 2072 676e 735f 6c73  = [].    rgns_ls
-000758b0: 745f 6e64 203d 205b 5d0a 2020 2020 7267  t_nd = [].    rg
-000758c0: 6e73 5f6c 7374 5f73 7420 3d20 5b5d 0a20  ns_lst_st = []. 
-000758d0: 2020 200a 2020 2020 6e75 6d5f 636f 7265     .    num_core
-000758e0: 203d 206d 6178 2820 6d69 6e28 206e 5f63   = max( min( n_c
-000758f0: 6f72 6573 2c20 2863 7075 5f63 6f75 6e74  ores, (cpu_count
-00075900: 2829 202d 2031 2920 292c 2031 290a 2020  () - 1) ), 1).  
-00075910: 2020 706f 6f6c 203d 2050 6f6f 6c28 6e75    pool = Pool(nu
-00075920: 6d5f 636f 7265 290a 2020 2020 746f 7461  m_core).    tota
-00075930: 6c5f 6974 6572 6174 696f 6e20 3d20 6c65  l_iteration = le
-00075940: 6e28 735f 6c73 745f 6f66 5f6c 7374 290a  n(s_lst_of_lst).
-00075950: 2020 2020 0a20 2020 2069 6620 5472 7565      .    if True
-00075960: 3a20 2320 6e6f 7420 5451 444d 3a0a 2020  : # not TQDM:.  
-00075970: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
-00075980: 5f6c 7374 5f6f 665f 6c73 742e 736f 7274  _lst_of_lst.sort
-00075990: 2872 6576 6572 7365 203d 2054 7275 652c  (reverse = True,
-000759a0: 206b 6579 3d6c 656e 290a 0a20 2020 2020   key=len)..     
-000759b0: 2020 2070 7269 6e74 2827 5c72 2720 2b20     print('\r' + 
-000759c0: 2720 272a 3130 302c 2065 6e64 3d27 272c  ' '*100, end='',
-000759d0: 2066 6c75 7368 203d 2054 7275 6529 0a20   flush = True). 
-000759e0: 2020 2020 2020 2069 6620 6c65 6e28 7469         if len(ti
-000759f0: 746c 6529 203d 3d20 303a 0a20 2020 2020  tle) == 0:.     
-00075a00: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-00075a10: 4275 696c 6469 6e67 206c 6f63 6920 2620  Building loci & 
-00075a20: 434d 6174 202e 2e2e 2020 272c 2065 6e64  CMat ...  ', end
-00075a30: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
-00075a40: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
-00075a50: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00075a60: 6e74 2827 5c72 2020 2070 726f 6365 7373  nt('\r   process
-00075a70: 696e 6720 2573 202e 2e2e 2027 2025 2028  ing %s ... ' % (
-00075a80: 7469 746c 6529 2c20 656e 643d 2727 2c20  title), end='', 
-00075a90: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-00075aa0: 2020 2020 2020 6b20 3d20 300a 2020 2020        k = 0.    
-00075ab0: 2020 2020 666f 7220 725f 6c73 745f 6d69      for r_lst_mi
-00075ac0: 2c20 725f 6c73 745f 6e64 2c20 725f 6c73  , r_lst_nd, r_ls
-00075ad0: 745f 7374 2069 6e20 706f 6f6c 2e69 6d61  t_st in pool.ima
-00075ae0: 705f 756e 6f72 6465 7265 6428 6d63 5f63  p_unordered(mc_c
-00075af0: 6f72 655f 6275 696c 645f 636e 7467 2c20  ore_build_cntg, 
-00075b00: 735f 6c73 745f 6f66 5f6c 7374 293a 0a20  s_lst_of_lst):. 
-00075b10: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
-00075b20: 6c73 745f 6d69 203d 2072 676e 735f 6c73  lst_mi = rgns_ls
-00075b30: 745f 6d69 202b 2072 5f6c 7374 5f6d 690a  t_mi + r_lst_mi.
-00075b40: 2020 2020 2020 2020 2020 2020 7267 6e73              rgns
-00075b50: 5f6c 7374 5f6e 6420 3d20 7267 6e73 5f6c  _lst_nd = rgns_l
-00075b60: 7374 5f6e 6420 2b20 725f 6c73 745f 6e64  st_nd + r_lst_nd
-00075b70: 0a20 2020 2020 2020 2020 2020 2072 676e  .            rgn
-00075b80: 735f 6c73 745f 7374 203d 2072 676e 735f  s_lst_st = rgns_
-00075b90: 6c73 745f 7374 202b 2072 5f6c 7374 5f73  lst_st + r_lst_s
-00075ba0: 7420 2020 200a 2020 2020 2020 2020 2020  t    .          
-00075bb0: 2020 0a20 2020 2020 2020 2020 2020 206b    .            k
-00075bc0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00075bd0: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
-00075be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00075bf0: 2070 7269 6e74 2827 5c72 2720 2b20 2720   print('\r' + ' 
-00075c00: 272a 3130 302c 2065 6e64 3d27 272c 2066  '*100, end='', f
-00075c10: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
-00075c20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00075c30: 6c65 6e28 7469 746c 6529 203d 3d20 303a  len(title) == 0:
-00075c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00075c50: 2020 2020 2070 7269 6e74 2827 5c72 4275       print('\rBu
-00075c60: 696c 6469 6e67 206c 6f63 6920 2620 434d  ilding loci & CM
-00075c70: 6174 202e 2e2e 2028 2569 2f25 6963 2920  at ... (%i/%ic) 
-00075c80: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-00075c90: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-00075ca0: 286b 2c20 746f 7461 6c5f 6974 6572 6174  (k, total_iterat
-00075cb0: 696f 6e29 2c20 656e 643d 2727 2c20 666c  ion), end='', fl
-00075cc0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-00075cd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00075ce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00075cf0: 2020 2020 2020 7072 696e 7428 275c 7220        print('\r 
-00075d00: 2020 7072 6f63 6573 7369 6e67 2025 7320    processing %s 
-00075d10: 2e2e 2e20 2825 692f 2569 6329 2027 205c  ... (%i/%ic) ' \
-00075d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00075d30: 2020 2020 2020 2020 2020 2025 2028 7469             % (ti
-00075d40: 746c 652c 206b 2c20 746f 7461 6c5f 6974  tle, k, total_it
-00075d50: 6572 6174 696f 6e29 2c20 656e 643d 2727  eration), end=''
-00075d60: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-00075d70: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00075d80: 2070 6f6f 6c2e 636c 6f73 6528 290a 2020   pool.close().  
-00075d90: 2020 706f 6f6c 2e6a 6f69 6e28 290a 2020    pool.join().  
-00075da0: 2020 0a20 2020 2072 6574 7572 6e20 7267    .    return rg
-00075db0: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
-00075dc0: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
-00075dd0: 5f73 740a 0a0a 6465 6620 7072 6f63 5f72  _st...def proc_r
-00075de0: 6561 645f 7361 6d28 2073 616d 5f6f 626a  ead_sam( sam_obj
-00075df0: 2c20 7120 293a 0a20 2020 200a 2020 2020  , q ):.    .    
-00075e00: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-00075e10: 2020 2020 6572 5f63 6f64 652c 2073 616d      er_code, sam
-00075e20: 5f6c 7374 2c20 6e75 6d5f 7265 6164 7320  _lst, num_reads 
-00075e30: 3d20 7361 6d5f 6f62 6a2e 6765 745f 6f6e  = sam_obj.get_on
-00075e40: 655f 6f76 6572 6c61 7065 645f 7361 6d28  e_overlaped_sam(
-00075e50: 2920 2020 2020 2020 200a 2020 2020 2020  )        .      
-00075e60: 2020 712e 7075 7428 2028 6572 5f63 6f64    q.put( (er_cod
-00075e70: 652c 2073 616d 5f6c 7374 2c20 7361 6d5f  e, sam_lst, sam_
-00075e80: 6f62 6a2e 6e75 6d5f 7265 6164 7329 2029  obj.num_reads) )
-00075e90: 0a20 2020 2020 2020 2069 6620 6572 5f63  .        if er_c
-00075ea0: 6f64 6520 3d3d 204e 4f5f 4d4f 5245 5f4c  ode == NO_MORE_L
-00075eb0: 494e 453a 2062 7265 616b 0a20 2020 2020  INE: break.     
-00075ec0: 2020 200a 0a64 6566 2073 6176 655f 7267     ..def save_rg
-00075ed0: 6e73 5f6f 626a 2866 696c 656e 616d 652c  ns_obj(filename,
-00075ee0: 2072 676e 735f 6c73 745f 6d2c 2072 676e   rgns_lst_m, rgn
-00075ef0: 735f 6c73 745f 6e64 2c20 7267 6e73 5f6c  s_lst_nd, rgns_l
-00075f00: 7374 5f73 7469 2c20 7264 5f6c 656e 2c20  st_sti, rd_len, 
-00075f10: 6e5f 7264 732c 206d 6564 5f66 7261 675f  n_rds, med_frag_
-00075f20: 6c65 6e20 293a 0a20 2020 200a 2020 2020  len ):.    .    
-00075f30: 7769 7468 206f 7065 6e28 6669 6c65 6e61  with open(filena
-00075f40: 6d65 2c20 2777 6227 2920 6173 2066 3a0a  me, 'wb') as f:.
-00075f50: 2020 2020 2020 2020 7069 636b 6c65 2e64          pickle.d
-00075f60: 756d 7028 2028 7267 6e73 5f6c 7374 5f6d  ump( (rgns_lst_m
-00075f70: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
-00075f80: 676e 735f 6c73 745f 7374 692c 2072 645f  gns_lst_sti, rd_
-00075f90: 6c65 6e2c 206e 5f72 6473 2c20 6d65 645f  len, n_rds, med_
-00075fa0: 6672 6167 5f6c 656e 292c 2066 2029 0a20  frag_len), f ). 
-00075fb0: 2020 2020 2020 200a 6465 6620 6c6f 6164         .def load
-00075fc0: 5f72 676e 735f 6f62 6a28 6669 6c65 6e61  _rgns_obj(filena
-00075fd0: 6d65 293a 0a20 2020 200a 2020 2020 7769  me):.    .    wi
-00075fe0: 7468 206f 7065 6e28 6669 6c65 6e61 6d65  th open(filename
-00075ff0: 2c20 2772 6227 2920 6173 2066 3a0a 2020  , 'rb') as f:.  
-00076000: 2020 2020 2020 6461 7461 203d 2070 6963        data = pic
-00076010: 6b6c 652e 6c6f 6164 2820 6620 290a 2020  kle.load( f ).  
-00076020: 2020 2020 2020 2320 7267 6e73 5f6c 7374        # rgns_lst
-00076030: 5f6d 2c20 7267 6e73 5f6c 7374 5f6e 642c  _m, rgns_lst_nd,
-00076040: 2072 676e 735f 6c73 745f 7374 692c 2072   rgns_lst_sti, r
-00076050: 645f 6c65 6e2c 206e 5f72 6473 2c20 6d65  d_len, n_rds, me
-00076060: 645f 6672 6167 5f6c 656e 203d 2070 6963  d_frag_len = pic
-00076070: 6b6c 652e 6c6f 6164 2820 6620 290a 2020  kle.load( f ).  
-00076080: 2020 2320 7265 7475 726e 2072 676e 735f    # return rgns_
-00076090: 6c73 745f 6d2c 2072 676e 735f 6c73 745f  lst_m, rgns_lst_
-000760a0: 6e64 2c20 7267 6e73 5f6c 7374 5f73 7469  nd, rgns_lst_sti
-000760b0: 2c20 7264 5f6c 656e 2c20 6e5f 7264 732c  , rd_len, n_rds,
-000760c0: 206d 6564 5f66 7261 675f 6c65 6e0a 2020   med_frag_len.  
-000760d0: 2020 7265 7475 726e 2064 6174 610a 200a    return data. .
-000760e0: 6465 6620 7361 7665 5f6f 626a 2866 696c  def save_obj(fil
-000760f0: 656e 616d 652c 206f 626a 2029 3a0a 2020  ename, obj ):.  
-00076100: 2020 0a20 2020 2077 6974 6820 6f70 656e    .    with open
-00076110: 2866 696c 656e 616d 652c 2027 7762 2729  (filename, 'wb')
-00076120: 2061 7320 663a 0a20 2020 2020 2020 2070   as f:.        p
-00076130: 6963 6b6c 652e 6475 6d70 2820 286f 626a  ickle.dump( (obj
-00076140: 292c 2066 2029 0a20 2020 2020 2020 200a  ), f ).        .
-00076150: 6465 6620 6c6f 6164 5f6f 626a 2866 696c  def load_obj(fil
-00076160: 656e 616d 6529 3a0a 2020 2020 0a20 2020  ename):.    .   
-00076170: 2077 6974 6820 6f70 656e 2866 696c 656e   with open(filen
-00076180: 616d 652c 2027 7262 2729 2061 7320 663a  ame, 'rb') as f:
-00076190: 0a20 2020 2020 2020 206f 626a 203d 2070  .        obj = p
-000761a0: 6963 6b6c 652e 6c6f 6164 2820 6620 290a  ickle.load( f ).
-000761b0: 2020 2020 7265 7475 726e 206f 626a 0a0a      return obj..
-000761c0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+000736a0: 2028 6d25 3130 3020 3d3d 2030 2920 7c20   (m%100 == 0) | 
+000736b0: 286d 203c 2031 3030 293a 0a20 2020 2020  (m < 100):.     
+000736c0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
+000736d0: 6e6f 7420 6973 204e 6f6e 653a 0a20 2020  not is None:.   
+000736e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000736f0: 2070 7269 6e74 2827 5c72 5365 6172 6368   print('\rSearch
+00073700: 2069 736f 666f 726d 7320 2620 6573 7420   isoforms & est 
+00073710: 6162 756e 6461 6e63 6573 202e 2e2e 2e2e  abundances .....
+00073720: 2025 692f 2569 2020 2027 205c 0a20 2020   %i/%i   ' \.   
+00073730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073740: 2020 2020 2020 2020 2520 286d 2c20 6c65          % (m, le
+00073750: 6e28 7273 5f74 7570 6c65 5f6c 7374 2929  n(rs_tuple_lst))
+00073760: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
+00073770: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00073780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073790: 2020 2020 7072 696e 7428 275c 7252 6563      print('\rRec
+000737a0: 6f76 6572 696e 6720 6973 6f66 6f72 6d73  overing isoforms
+000737b0: 2026 2065 7374 2061 6275 6e64 616e 6365   & est abundance
+000737c0: 7320 2e2e 2e2e 2e20 2569 2f25 6920 2020  s ..... %i/%i   
+000737d0: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
+000737e0: 2020 2020 2020 2020 2020 2020 2020 2025                 %
+000737f0: 2028 6d2c 206c 656e 2872 735f 7475 706c   (m, len(rs_tupl
+00073800: 655f 6c73 7429 292c 2065 6e64 3d27 2729  e_lst)), end='')
+00073810: 0a20 2020 2020 2020 2020 2020 206d 202b  .            m +
+00073820: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00073830: 0a20 2020 2070 6f6f 6c2e 636c 6f73 6528  .    pool.close(
+00073840: 290a 2020 2020 706f 6f6c 2e6a 6f69 6e28  ).    pool.join(
+00073850: 290a 2020 2020 0a20 2020 2069 6620 7665  ).    .    if ve
+00073860: 7262 6f73 653a 200a 0a20 2020 2020 2020  rbose: ..       
+00073870: 206e 5f63 6f76 5f65 6820 3d20 300a 2020   n_cov_eh = 0.  
+00073880: 2020 2020 2020 2320 6966 2067 6420 6973        # if gd is
+00073890: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000738a0: 2020 2069 6620 6c65 6e28 6764 5f6c 7374     if len(gd_lst
+000738b0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+000738c0: 2020 2066 6f72 2067 6420 696e 2067 645f     for gd in gd_
+000738d0: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
+000738e0: 2020 2020 2066 6f72 2074 6420 696e 2067       for td in g
+000738f0: 642e 7464 5f6c 7374 3a0a 2020 2020 2020  d.td_lst:.      
+00073900: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00073910: 2074 642e 636f 7620 3e20 312e 313a 206e   td.cov > 1.1: n
+00073920: 5f63 6f76 5f65 6820 2b3d 2031 0a0a 2020  _cov_eh += 1..  
+00073930: 2020 2020 2020 656c 6170 7365 645f 7469        elapsed_ti
+00073940: 6d65 3120 3d20 7469 6d65 2e74 696d 6528  me1 = time.time(
+00073950: 2920 2d20 7374 6172 745f 7469 6d65 310a  ) - start_time1.
+00073960: 2020 2020 2020 2020 6966 2061 6e6e 6f74          if annot
+00073970: 2069 7320 4e6f 6e65 3a20 0a20 2020 2020   is None: .     
+00073980: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+00073990: 5365 6172 6368 2069 736f 666f 726d 7320  Search isoforms 
+000739a0: 2620 6573 7420 6162 756e 6461 6e63 6573  & est abundances
+000739b0: 202e 2e2e 2e2e 2064 6f6e 6520 2825 6929   ..... done (%i)
+000739c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000739d0: 2027 2025 2028 696e 7428 656c 6170 7365   ' % (int(elapse
+000739e0: 645f 7469 6d65 3129 2929 0a20 2020 2020  d_time1))).     
+000739f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00073a00: 2020 2020 2070 7269 6e74 2827 5c72 5265       print('\rRe
+00073a10: 636f 7665 7269 6e67 2069 736f 666f 726d  covering isoform
+00073a20: 7320 2620 6573 7420 6162 756e 6461 6e63  s & est abundanc
+00073a30: 6573 202e 2e2e 2e2e 2064 6f6e 6520 2825  es ..... done (%
+00073a40: 692c 2025 6929 2020 2020 2020 2020 2020  i, %i)          
+00073a50: 2020 2020 2020 2027 2025 2028 696e 7428         ' % (int(
+00073a60: 656c 6170 7365 645f 7469 6d65 3129 2c20  elapsed_time1), 
+00073a70: 6e5f 636f 765f 6568 2929 0a20 2020 200a  n_cov_eh)).    .
+00073a80: 2020 2020 6420 3d20 7b27 6773 697a 6527      d = {'gsize'
+00073a90: 3a20 6773 697a 652c 2027 6776 6f6c 273a  : gsize, 'gvol':
+00073aa0: 2067 766f 6c2c 2027 6364 5f74 6827 3a20   gvol, 'cd_th': 
+00073ab0: 6364 5f74 682c 2027 775f 636e 7427 3a20  cd_th, 'w_cnt': 
+00073ac0: 775f 636e 7420 7d0a 2020 2020 6466 203d  w_cnt }.    df =
+00073ad0: 2070 642e 4461 7461 4672 616d 6528 6461   pd.DataFrame(da
+00073ae0: 7461 203d 2064 290a 2020 2020 0a20 2020  ta = d).    .   
+00073af0: 2072 6574 7572 6e20 5472 5f6c 7374 2c20   return Tr_lst, 
+00073b00: 4973 5f6c 7374 2c20 4754 465f 6c73 742c  Is_lst, GTF_lst,
+00073b10: 2064 662c 2067 7270 5f6c 7374 2c20 6764   df, grp_lst, gd
+00073b20: 5f6c 7374 2c20 6574 735f 7375 6d2c 2065  _lst, ets_sum, e
+00073b30: 7478 5f73 756d 2023 206d 6e5f 6c73 740a  tx_sum # mn_lst.
+00073b40: 0a0a 6465 6620 6765 745f 7472 616e 7363  ..def get_transc
+00073b50: 7269 7074 7328 2072 676e 735f 6c73 745f  ripts( rgns_lst_
+00073b60: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 642c  mi, rgns_lst_nd,
+00073b70: 2072 676e 735f 6c73 745f 7374 2c20 7265   rgns_lst_st, re
+00073b80: 6164 5f6c 656e 2c20 616e 6e6f 7420 3d20  ad_len, annot = 
+00073b90: 4e6f 6e65 2c20 6c65 6e5f 7468 203d 204d  None, len_th = M
+00073ba0: 494e 5f54 525f 4c45 4e47 5448 2c20 5c0a  IN_TR_LENGTH, \.
+00073bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073bc0: 2020 2020 206d 6574 686f 6420 3d20 276c       method = 'l
+00073bd0: 6173 736f 272c 206e 7265 6320 3d20 302c  asso', nrec = 0,
+00073be0: 2073 7461 7274 203d 2030 2c20 7665 7262   start = 0, verb
+00073bf0: 6f73 6520 3d20 5472 7565 2c20 7364 6976  ose = True, sdiv
+00073c00: 203d 2032 3020 293a 0a0a 2020 2020 7374   = 20 ):..    st
+00073c10: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
+00073c20: 7469 6d65 2829 0a20 2020 2063 6e74 7020  time().    cntp 
+00073c30: 3d20 303b 2063 6e74 6e20 3d20 303b 2063  = 0; cntn = 0; c
+00073c40: 6e74 3020 3d20 303b 2063 6e74 6620 3d20  nt0 = 0; cntf = 
+00073c50: 303b 2063 6e74 6720 3d20 300a 2020 2020  0; cntg = 0.    
+00073c60: 6670 203d 2030 3b20 666e 203d 2030 3b20  fp = 0; fn = 0; 
+00073c70: 6630 203d 2030 3b20 6666 203d 2030 0a0a  f0 = 0; ff = 0..
+00073c80: 2020 2020 6e5f 7472 203d 2030 0a20 2020      n_tr = 0.   
+00073c90: 2047 5446 5f6c 7374 203d 205b 5d0a 2020   GTF_lst = [].  
+00073ca0: 2020 5472 5f6c 7374 203d 205b 5d0a 2020    Tr_lst = [].  
+00073cb0: 2020 4973 5f6c 7374 203d 205b 5d0a 2020    Is_lst = [].  
+00073cc0: 2020 6d6e 5f6c 7374 203d 205b 5d0a 2020    mn_lst = [].  
+00073cd0: 2020 6772 705f 6c73 7420 3d20 5b5d 0a20    grp_lst = []. 
+00073ce0: 2020 2067 645f 6c73 7420 3d20 5b5d 0a20     gd_lst = []. 
+00073cf0: 2020 2063 645f 7468 203d 206e 702e 7a65     cd_th = np.ze
+00073d00: 726f 7328 6c65 6e28 7267 6e73 5f6c 7374  ros(len(rgns_lst
+00073d10: 5f6d 6929 2c20 6474 7970 653d 696e 7429  _mi), dtype=int)
+00073d20: 0a20 2020 2077 5f63 6e74 203d 206e 702e  .    w_cnt = np.
+00073d30: 7a65 726f 7328 6c65 6e28 7267 6e73 5f6c  zeros(len(rgns_l
+00073d40: 7374 5f6d 6929 2c20 6474 7970 653d 696e  st_mi), dtype=in
+00073d50: 7429 0a20 2020 2067 7369 7a65 203d 206e  t).    gsize = n
+00073d60: 702e 7a65 726f 7328 6c65 6e28 7267 6e73  p.zeros(len(rgns
+00073d70: 5f6c 7374 5f6d 6929 2c20 6474 7970 653d  _lst_mi), dtype=
+00073d80: 696e 7429 0a20 2020 2067 766f 6c20 3d20  int).    gvol = 
+00073d90: 6e70 2e7a 6572 6f73 286c 656e 2872 676e  np.zeros(len(rgn
+00073da0: 735f 6c73 745f 6d69 292c 2064 7479 7065  s_lst_mi), dtype
+00073db0: 3d69 6e74 290a 0a20 2020 2067 636e 7420  =int)..    gcnt 
+00073dc0: 3d20 300a 2020 2020 7374 6172 745f 7469  = 0.    start_ti
+00073dd0: 6d65 3120 3d20 7469 6d65 2e74 696d 6528  me1 = time.time(
+00073de0: 290a 2020 2020 6966 2076 6572 626f 7365  ).    if verbose
+00073df0: 3a20 0a20 2020 2020 2020 2069 6620 616e  : .        if an
+00073e00: 6e6f 7420 6973 204e 6f6e 653a 2070 7269  not is None: pri
+00073e10: 6e74 2827 5c72 5365 6172 6368 2069 736f  nt('\rSearch iso
+00073e20: 666f 726d 7320 2620 6573 7420 6162 756e  forms & est abun
+00073e30: 6461 6e63 6573 202e 2e2e 2e2e 2027 2c20  dances ..... ', 
+00073e40: 656e 643d 2727 290a 2020 2020 2020 2020  end='').        
+00073e50: 656c 7365 3a20 7072 696e 7428 275c 7252  else: print('\rR
+00073e60: 6563 6f76 6572 696e 6720 6973 6f66 6f72  ecovering isofor
+00073e70: 6d73 2026 2065 7374 2061 6275 6e64 616e  ms & est abundan
+00073e80: 6365 7320 2e2e 2e2e 2e20 272c 2065 6e64  ces ..... ', end
+00073e90: 3d27 2729 0a20 2020 2020 2020 200a 2020  ='').        .  
+00073ea0: 2020 2327 2727 0a20 2020 2067 7620 3d20    #'''.    gv = 
+00073eb0: 6e70 2e7a 6572 6f73 286c 656e 2872 676e  np.zeros(len(rgn
+00073ec0: 735f 6c73 745f 6e64 292c 2064 7479 7065  s_lst_nd), dtype
+00073ed0: 3d6e 702e 666c 6f61 7433 3229 0a20 2020  =np.float32).   
+00073ee0: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
+00073ef0: 6c65 6e28 7267 6e73 5f6c 7374 5f6e 6429  len(rgns_lst_nd)
+00073f00: 293a 0a20 2020 2020 2020 2067 765b 6b5d  ):.        gv[k]
+00073f10: 203d 202d 6c65 6e28 7267 6e73 5f6c 7374   = -len(rgns_lst
+00073f20: 5f6e 645b 6b5d 2e72 676e 7329 2023 202d  _nd[k].rgns) # -
+00073f30: 7267 6e73 5f6c 7374 5f6d 695b 6b5d 2e67  rgns_lst_mi[k].g
+00073f40: 6574 5f76 6f6c 756d 6528 290a 2020 2020  et_volume().    
+00073f50: 6f64 7220 3d20 6776 2e61 7267 736f 7274  odr = gv.argsort
+00073f60: 2829 0a20 2020 2023 2727 270a 2020 2020  ().    #'''.    
+00073f70: 0a20 2020 2072 735f 7475 706c 655f 6c73  .    rs_tuple_ls
+00073f80: 7420 3d20 5b5d 0a20 2020 2069 6620 7374  t = [].    if st
+00073f90: 6172 7420 3d3d 2030 3a0a 2020 2020 2020  art == 0:.      
+00073fa0: 2020 6966 206e 7265 6320 3d3d 2030 3a20    if nrec == 0: 
+00073fb0: 4e72 6563 203d 206c 656e 2872 676e 735f  Nrec = len(rgns_
+00073fc0: 6c73 745f 6d69 290a 2020 2020 2020 2020  lst_mi).        
+00073fd0: 656c 7365 3a20 4e72 6563 203d 206e 7265  else: Nrec = nre
+00073fe0: 630a 2020 2020 656c 7365 3a0a 2020 2020  c.    else:.    
+00073ff0: 2020 2020 4e72 6563 203d 206c 656e 2872      Nrec = len(r
+00074000: 676e 735f 6c73 745f 6d69 290a 2020 2020  gns_lst_mi).    
+00074010: 2020 2020 6966 2073 7461 7274 203e 3d20      if start >= 
+00074020: 4e72 6563 3a20 7374 6172 7420 3d20 4e72  Nrec: start = Nr
+00074030: 6563 2d31 0a0a 2020 2020 666f 7220 6d20  ec-1..    for m 
+00074040: 696e 2072 616e 6765 284e 7265 632d 7374  in range(Nrec-st
+00074050: 6172 7429 3a0a 2020 2020 2020 2020 6b20  art):.        k 
+00074060: 3d20 6f64 725b 6d2b 7374 6172 745d 0a20  = odr[m+start]. 
+00074070: 2020 2020 2020 2067 6420 3d20 4e6f 6e65         gd = None
+00074080: 0a20 2020 2020 2020 2069 6620 2861 6e6e  .        if (ann
+00074090: 6f74 2069 7320 6e6f 7420 4e6f 6e65 293a  ot is not None):
+000740a0: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+000740b0: 206b 203c 206c 656e 2861 6e6e 6f74 293a   k < len(annot):
+000740c0: 2067 6420 3d20 616e 6e6f 745b 6b5d 0a20   gd = annot[k]. 
+000740d0: 2020 2020 2020 2072 735f 7475 706c 655f         rs_tuple_
+000740e0: 6c73 742e 6170 7065 6e64 2820 2872 676e  lst.append( (rgn
+000740f0: 735f 6c73 745f 6d69 5b6b 5d2c 2072 676e  s_lst_mi[k], rgn
+00074100: 735f 6c73 745f 6e64 5b6b 5d2c 2072 676e  s_lst_nd[k], rgn
+00074110: 735f 6c73 745f 7374 5b6b 5d2c 206b 2c20  s_lst_st[k], k, 
+00074120: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00074130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074140: 6c65 6e5f 7468 2c20 6d65 7468 6f64 2c20  len_th, method, 
+00074150: 7265 6164 5f6c 656e 2c20 6764 2920 290a  read_len, gd) ).
+00074160: 0a20 2020 2065 7473 5f73 756d 203d 2030  .    ets_sum = 0
+00074170: 2020 2020 2020 2020 0a20 2020 2065 7478          .    etx
+00074180: 5f73 756d 203d 2030 2020 2020 2020 2020  _sum = 0        
+00074190: 0a20 2020 2066 6f72 206d 2069 6e20 7261  .    for m in ra
+000741a0: 6e67 6528 6c65 6e28 7273 5f74 7570 6c65  nge(len(rs_tuple
+000741b0: 5f6c 7374 2929 3a0a 2020 2020 2020 2020  _lst)):.        
+000741c0: 0a20 2020 2020 2020 2074 6c73 742c 2069  .        tlst, i
+000741d0: 6c73 742c 2067 7466 5f6c 696e 6573 2c20  lst, gtf_lines, 
+000741e0: 6773 2c20 6776 2c20 6d6e 2c20 6374 2c20  gs, gv, mn, ct, 
+000741f0: 6772 702c 206b 2c20 6764 2c20 6574 732c  grp, k, gd, ets,
+00074200: 2065 7478 203d 206d 635f 636f 7265 5f67   etx = mc_core_g
+00074210: 6574 5f74 7228 7273 5f74 7570 6c65 5f6c  et_tr(rs_tuple_l
+00074220: 7374 5b6d 5d29 0a20 2020 2020 2020 200a  st[m]).        .
+00074230: 2020 2020 2020 2020 6574 735f 7375 6d20          ets_sum 
+00074240: 3d20 6574 735f 7375 6d20 2b20 6574 730a  = ets_sum + ets.
+00074250: 2020 2020 2020 2020 6574 785f 7375 6d20          etx_sum 
+00074260: 3d20 6574 785f 7375 6d20 2b20 6574 780a  = etx_sum + etx.
+00074270: 0a20 2020 2020 2020 2054 725f 6c73 7420  .        Tr_lst 
+00074280: 3d20 5472 5f6c 7374 202b 2074 6c73 740a  = Tr_lst + tlst.
+00074290: 2020 2020 2020 2020 4973 5f6c 7374 203d          Is_lst =
+000742a0: 2049 735f 6c73 7420 2b20 696c 7374 0a20   Is_lst + ilst. 
+000742b0: 2020 2020 2020 2047 5446 5f6c 7374 203d         GTF_lst =
+000742c0: 2047 5446 5f6c 7374 202b 2067 7466 5f6c   GTF_lst + gtf_l
+000742d0: 696e 6573 0a20 2020 2020 2020 2067 7369  ines.        gsi
+000742e0: 7a65 5b6b 5d20 3d20 6773 0a20 2020 2020  ze[k] = gs.     
+000742f0: 2020 2067 766f 6c5b 6b5d 203d 2067 760a     gvol[k] = gv.
+00074300: 2020 2020 2020 2020 6364 5f74 685b 6b5d          cd_th[k]
+00074310: 203d 206d 6e0a 2020 2020 2020 2020 775f   = mn.        w_
+00074320: 636e 745b 6b5d 203d 2063 740a 2020 2020  cnt[k] = ct.    
+00074330: 2020 2020 6966 2067 7270 2069 7320 6e6f      if grp is no
+00074340: 7420 4e6f 6e65 3a20 0a20 2020 2020 2020  t None: .       
+00074350: 2020 2020 2067 7270 5f6c 7374 2e61 7070       grp_lst.app
+00074360: 656e 6428 6772 7029 0a20 2020 2020 2020  end(grp).       
+00074370: 2020 2020 2067 645f 6c73 742e 6170 7065       gd_lst.appe
+00074380: 6e64 2867 6429 0a0a 2020 2020 2020 2020  nd(gd)..        
+00074390: 6966 2076 6572 626f 7365 3a20 0a20 2020  if verbose: .   
+000743a0: 2020 2020 2020 2020 2069 6620 6d20 3e20           if m > 
+000743b0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000743c0: 2020 2065 6c61 7073 6564 5f74 696d 6520     elapsed_time 
+000743d0: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
+000743e0: 7374 6172 745f 7469 6d65 310a 2020 2020  start_time1.    
+000743f0: 2020 2020 2020 2020 2020 2020 745f 7469              t_ti
+00074400: 6d65 203d 2065 6c61 7073 6564 5f74 696d  me = elapsed_tim
+00074410: 652a 6c65 6e28 7273 5f74 7570 6c65 5f6c  e*len(rs_tuple_l
+00074420: 7374 292f 6d0a 2020 2020 2020 2020 2020  st)/m.          
+00074430: 2020 2020 2020 725f 7469 6d65 203d 2074        r_time = t
+00074440: 5f74 696d 6520 2d20 656c 6170 7365 645f  _time - elapsed_
+00074450: 7469 6d65 0a20 2020 2020 2020 2020 2020  time.           
+00074460: 2020 2020 2069 6620 6d25 3130 3020 3d3d       if m%100 ==
+00074470: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00074480: 2020 2020 2020 2020 6966 2061 6e6e 6f74          if annot
+00074490: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000744a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000744b0: 2020 7072 696e 7428 275c 7253 6561 7263    print('\rSearc
+000744c0: 6820 6973 6f66 6f72 6d73 2026 2065 7374  h isoforms & est
+000744d0: 2061 6275 6e64 616e 6365 7320 2e2e 2e2e   abundances ....
+000744e0: 2e20 2569 2f25 6920 2020 2720 5c0a 2020  . %i/%i   ' \.  
+000744f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074500: 2020 2020 2020 2020 2020 2020 2025 2028               % (
+00074510: 696e 7428 725f 7469 6d65 292c 206d 2c20  int(r_time), m, 
+00074520: 6c65 6e28 7273 5f74 7570 6c65 5f6c 7374  len(rs_tuple_lst
+00074530: 2929 2c20 656e 643d 2727 290a 2020 2020  )), end='').    
+00074540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074550: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00074560: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00074570: 696e 7428 275c 7252 6563 6f76 6572 696e  int('\rRecoverin
+00074580: 6720 6973 6f66 6f72 6d73 2026 2065 7374  g isoforms & est
+00074590: 2061 6275 6e64 616e 6365 7320 2e2e 2e2e   abundances ....
+000745a0: 2e20 2569 2f25 6920 2020 2720 5c0a 2020  . %i/%i   ' \.  
+000745b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000745c0: 2020 2020 2020 2020 2020 2020 2025 2028               % (
+000745d0: 6d2c 206c 656e 2872 735f 7475 706c 655f  m, len(rs_tuple_
+000745e0: 6c73 7429 292c 2065 6e64 3d27 2729 0a20  lst)), end=''). 
+000745f0: 2020 200a 2020 2020 6966 2076 6572 626f     .    if verbo
+00074600: 7365 3a20 0a20 2020 2020 2020 2065 6c61  se: .        ela
+00074610: 7073 6564 5f74 696d 6531 203d 2074 696d  psed_time1 = tim
+00074620: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
+00074630: 5f74 696d 6531 0a20 2020 2020 2020 2069  _time1.        i
+00074640: 6620 616e 6e6f 7420 6973 204e 6f6e 653a  f annot is None:
+00074650: 200a 2020 2020 2020 2020 2020 2020 7072   .            pr
+00074660: 696e 7428 275c 7253 6561 7263 6820 6973  int('\rSearch is
+00074670: 6f66 6f72 6d73 2026 2065 7374 2061 6275  oforms & est abu
+00074680: 6e64 616e 6365 7320 2e2e 2e2e 2e20 646f  ndances ..... do
+00074690: 6e65 2028 2569 2920 2020 2020 2020 2020  ne (%i)         
+000746a0: 2020 2020 2020 2720 2520 2869 6e74 2865        ' % (int(e
+000746b0: 6c61 7073 6564 5f74 696d 6531 2929 290a  lapsed_time1))).
+000746c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000746d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000746e0: 275c 7252 6563 6f76 6572 696e 6720 6973  '\rRecovering is
+000746f0: 6f66 6f72 6d73 2026 2065 7374 2061 6275  oforms & est abu
+00074700: 6e64 616e 6365 7320 2e2e 2e2e 2e20 646f  ndances ..... do
+00074710: 6e65 2028 2569 2920 2020 2020 2020 2020  ne (%i)         
+00074720: 2020 2020 2020 2720 2520 2869 6e74 2865        ' % (int(e
+00074730: 6c61 7073 6564 5f74 696d 6531 2929 290a  lapsed_time1))).
+00074740: 2020 2020 0a20 2020 2064 203d 207b 2767      .    d = {'g
+00074750: 7369 7a65 273a 2067 7369 7a65 2c20 2767  size': gsize, 'g
+00074760: 766f 6c27 3a20 6776 6f6c 2c20 2763 645f  vol': gvol, 'cd_
+00074770: 7468 273a 2063 645f 7468 2c20 2777 5f63  th': cd_th, 'w_c
+00074780: 6e74 273a 2077 5f63 6e74 207d 0a20 2020  nt': w_cnt }.   
+00074790: 2064 6620 3d20 7064 2e44 6174 6146 7261   df = pd.DataFra
+000747a0: 6d65 2864 6174 6120 3d20 6429 0a20 2020  me(data = d).   
+000747b0: 200a 2020 2020 7265 7475 726e 2054 725f   .    return Tr_
+000747c0: 6c73 742c 2049 735f 6c73 742c 2047 5446  lst, Is_lst, GTF
+000747d0: 5f6c 7374 2c20 6466 2c20 6772 705f 6c73  _lst, df, grp_ls
+000747e0: 742c 2067 645f 6c73 742c 2065 7473 5f73  t, gd_lst, ets_s
+000747f0: 756d 2c20 6574 785f 7375 6d20 2320 6d6e  um, etx_sum # mn
+00074800: 5f6c 7374 0a0a 0a23 2323 2323 2323 2323  _lst...#########
+00074810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00074820: 2323 230a 2323 2323 2053 7472 696e 6746  ###.#### StringF
+00074830: 6978 206d 6169 6e20 2323 2323 2323 2323  ix main ########
+00074840: 0a0a 6465 6620 6765 745f 7470 6d28 7472  ..def get_tpm(tr
+00074850: 5f6c 7374 293a 0a20 2020 200a 2020 2020  _lst):.    .    
+00074860: 6162 6e5f 746f 7461 6c20 3d20 300a 2020  abn_total = 0.  
+00074870: 2020 666f 7220 7472 2069 6e20 7472 5f6c    for tr in tr_l
+00074880: 7374 3a0a 2020 2020 2020 2020 6162 6e5f  st:.        abn_
+00074890: 746f 7461 6c20 2b3d 2074 722e 6162 6e0a  total += tr.abn.
+000748a0: 2020 2020 6e66 203d 2031 3030 3030 3030      nf = 1000000
+000748b0: 2f61 626e 5f74 6f74 616c 0a0a 2020 2020  /abn_total..    
+000748c0: 7472 5f6c 7374 5f6f 7574 203d 205b 5d0a  tr_lst_out = [].
+000748d0: 2020 2020 666f 7220 7420 696e 2074 725f      for t in tr_
+000748e0: 6c73 743a 0a20 2020 2020 2020 2054 504d  lst:.        TPM
+000748f0: 203d 2074 2e74 706d 2a6e 660a 2020 2020   = t.tpm*nf.    
+00074900: 2020 2020 7472 203d 2054 7261 6e73 6372      tr = Transcr
+00074910: 6970 7428 742e 7072 6566 6978 2c74 2e67  ipt(t.prefix,t.g
+00074920: 6964 782c 742e 6772 705f 7369 7a65 2c74  idx,t.grp_size,t
+00074930: 2e69 636e 742c 742e 6368 722c 742e 7374  .icnt,t.chr,t.st
+00074940: 6172 742c 742e 656e 642c 742e 7374 7261  art,t.end,t.stra
+00074950: 6e64 2c20 742e 6364 6e67 2c20 5c0a 2020  nd, t.cdng, \.  
+00074960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074970: 2020 2020 2020 742e 7365 712c 742e 6162        t.seq,t.ab
+00074980: 6e2c 2054 504d 2c20 742e 6973 6f5f 6672  n, TPM, t.iso_fr
+00074990: 6163 2c20 742e 7072 6f62 2c20 742e 6e65  ac, t.prob, t.ne
+000749a0: 7873 2c20 742e 6776 6f6c 290a 2020 2020  xs, t.gvol).    
+000749b0: 2020 2020 7472 5f6c 7374 5f6f 7574 2e61      tr_lst_out.a
+000749c0: 7070 656e 6428 7472 290a 2020 2020 2020  ppend(tr).      
+000749d0: 2020 0a20 2020 2072 6574 7572 6e28 7472    .    return(tr
+000749e0: 5f6c 7374 5f6f 7574 290a 0a64 6566 2066  _lst_out)..def f
+000749f0: 696c 7465 725f 7267 6e73 2820 725f 6c73  ilter_rgns( r_ls
+00074a00: 745f 6d2c 2072 5f6c 7374 5f6e 642c 2072  t_m, r_lst_nd, r
+00074a10: 5f6c 7374 5f73 7469 2c20 766f 6c5f 7468  _lst_sti, vol_th
+00074a20: 2c20 735f 7468 203d 2030 2e39 2029 3a0a  , s_th = 0.9 ):.
+00074a30: 2020 2020 0a20 2020 2074 6f5f 6465 6c20      .    to_del 
+00074a40: 3d20 5b5d 0a20 2020 2066 6f72 206b 2c20  = [].    for k, 
+00074a50: 7220 696e 2065 6e75 6d65 7261 7465 2872  r in enumerate(r
+00074a60: 5f6c 7374 5f6d 293a 0a20 2020 2020 2020  _lst_m):.       
+00074a70: 2076 6f6c 203d 2072 2e67 6574 5f76 6f6c   vol = r.get_vol
+00074a80: 756d 6528 2920 2320 2b20 722e 6765 745f  ume() # + r.get_
+00074a90: 766f 6c75 6d65 2829 0a20 2020 2020 2020  volume().       
+00074aa0: 2069 6620 2876 6f6c 203c 2076 6f6c 5f74   if (vol < vol_t
+00074ab0: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00074ac0: 746f 5f64 656c 2e61 7070 656e 6428 6b29  to_del.append(k)
+00074ad0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00074ae0: 2020 2020 2020 2020 2020 2069 6620 722e             if r.
+00074af0: 636e 745f 7220 3e20 303a 0a20 2020 2020  cnt_r > 0:.     
+00074b00: 2020 2020 2020 2020 2020 2069 6620 722e             if r.
+00074b10: 636e 745f 732f 722e 636e 745f 7220 3e20  cnt_s/r.cnt_r > 
+00074b20: 735f 7468 3a20 746f 5f64 656c 2e61 7070  s_th: to_del.app
+00074b30: 656e 6428 6b29 0a20 2020 2020 2020 2020  end(k).         
+00074b40: 2020 200a 2020 2020 6966 206c 656e 2874     .    if len(t
+00074b50: 6f5f 6465 6c29 203e 2030 3a0a 2020 2020  o_del) > 0:.    
+00074b60: 2020 2020 746f 5f64 656c 2e73 6f72 7428      to_del.sort(
+00074b70: 7265 7665 7273 653d 5472 7565 290a 2020  reverse=True).  
+00074b80: 2020 2020 2020 666f 7220 6b20 696e 2074        for k in t
+00074b90: 6f5f 6465 6c3a 200a 2020 2020 2020 2020  o_del: .        
+00074ba0: 2020 2020 6465 6c20 725f 6c73 745f 6d5b      del r_lst_m[
+00074bb0: 6b5d 0a20 2020 2020 2020 2020 2020 2064  k].            d
+00074bc0: 656c 2072 5f6c 7374 5f6e 645b 6b5d 0a20  el r_lst_nd[k]. 
+00074bd0: 2020 2020 2020 2020 2020 2064 656c 2072             del r
+00074be0: 5f6c 7374 5f73 7469 5b6b 5d0a 2020 2020  _lst_sti[k].    
+00074bf0: 0a20 2020 2072 6574 7572 6e28 725f 6c73  .    return(r_ls
+00074c00: 745f 6d2c 2072 5f6c 7374 5f6e 642c 2072  t_m, r_lst_nd, r
+00074c10: 5f6c 7374 5f73 7469 290a 0a0a 6465 6620  _lst_sti)...def 
+00074c20: 6669 6c74 6572 5f72 676e 735f 6f6c 6428  filter_rgns_old(
+00074c30: 2072 5f6c 7374 5f6d 2c20 725f 6c73 745f   r_lst_m, r_lst_
+00074c40: 6e64 2c20 766f 6c5f 7468 2029 3a0a 2020  nd, vol_th ):.  
+00074c50: 2020 0a20 2020 2074 6f5f 6465 6c20 3d20    .    to_del = 
+00074c60: 5b5d 0a20 2020 2066 6f72 206b 2069 6e20  [].    for k in 
+00074c70: 7261 6e67 6528 6c65 6e28 725f 6c73 745f  range(len(r_lst_
+00074c80: 6d29 293a 0a20 2020 2020 2020 2076 6f6c  m)):.        vol
+00074c90: 203d 2072 5f6c 7374 5f6d 5b6b 5d2e 6765   = r_lst_m[k].ge
+00074ca0: 745f 766f 6c75 6d65 2829 0a20 2020 2020  t_volume().     
+00074cb0: 2020 2069 6620 766f 6c20 3c20 766f 6c5f     if vol < vol_
+00074cc0: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+00074cd0: 746f 5f64 656c 2e61 7070 656e 6428 6b29  to_del.append(k)
+00074ce0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00074cf0: 2020 6966 206c 656e 2874 6f5f 6465 6c29    if len(to_del)
+00074d00: 203e 2030 3a0a 2020 2020 2020 2020 746f   > 0:.        to
+00074d10: 5f64 656c 2e73 6f72 7428 7265 7665 7273  _del.sort(revers
+00074d20: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00074d30: 666f 7220 6b20 696e 2074 6f5f 6465 6c3a  for k in to_del:
+00074d40: 200a 2020 2020 2020 2020 2020 2020 6465   .            de
+00074d50: 6c20 725f 6c73 745f 6d5b 6b5d 0a20 2020  l r_lst_m[k].   
+00074d60: 2020 2020 2020 2020 2064 656c 2072 5f6c           del r_l
+00074d70: 7374 5f6e 645b 6b5d 0a20 2020 200a 2020  st_nd[k].    .  
+00074d80: 2020 7265 7475 726e 2872 5f6c 7374 5f6d    return(r_lst_m
+00074d90: 2c20 725f 6c73 745f 6e64 290a 0a0a 2323  , r_lst_nd)...##
+00074da0: 2320 4465 6661 756c 7420 5472 7320 4669  # Default Trs Fi
+00074db0: 6c74 6572 2070 6172 616d 6574 6572 730a  lter parameters.
+00074dc0: 6465 6620 6368 6563 6b5f 7267 6e73 2820  def check_rgns( 
+00074dd0: 7267 6e73 5f6c 7374 5f6d 692c 2072 676e  rgns_lst_mi, rgn
+00074de0: 735f 6c73 745f 6e64 2029 3a0a 0a20 2020  s_lst_nd ):..   
+00074df0: 2063 6e74 203d 2030 0a20 2020 2076 5f74   cnt = 0.    v_t
+00074e00: 6f74 203d 2030 0a20 2020 2076 5f68 7962  ot = 0.    v_hyb
+00074e10: 203d 2030 0a20 2020 2066 6f72 206b 2069   = 0.    for k i
+00074e20: 6e20 7261 6e67 6528 6c65 6e28 7267 6e73  n range(len(rgns
+00074e30: 5f6c 7374 5f6d 6929 293a 0a20 2020 2020  _lst_mi)):.     
+00074e40: 2020 2063 766f 6c20 3d20 7267 6e73 5f6c     cvol = rgns_l
+00074e50: 7374 5f6d 695b 6b5d 2e67 6574 5f76 6f6c  st_mi[k].get_vol
+00074e60: 756d 6528 290a 2020 2020 2020 2020 765f  ume().        v_
+00074e70: 746f 7420 2b3d 2063 766f 6c0a 2020 2020  tot += cvol.    
+00074e80: 2020 2020 6370 203d 2030 0a20 2020 2020      cp = 0.     
+00074e90: 2020 2063 6e20 3d20 300a 2020 2020 2020     cn = 0.      
+00074ea0: 2020 666f 7220 6d20 696e 2072 616e 6765    for m in range
+00074eb0: 286c 656e 2872 676e 735f 6c73 745f 6e64  (len(rgns_lst_nd
+00074ec0: 5b6b 5d2e 7267 6e73 2929 3a0a 2020 2020  [k].rgns)):.    
+00074ed0: 2020 2020 2020 2020 6966 2072 676e 735f          if rgns_
+00074ee0: 6c73 745f 6e64 5b6b 5d2e 7267 6e73 5b6d  lst_nd[k].rgns[m
+00074ef0: 5d2e 7873 203c 2030 3a20 636e 202b 3d20  ].xs < 0: cn += 
+00074f00: 310a 2020 2020 2020 2020 2020 2020 656c  1.            el
+00074f10: 6966 2072 676e 735f 6c73 745f 6e64 5b6b  if rgns_lst_nd[k
+00074f20: 5d2e 7267 6e73 5b6d 5d2e 7873 203e 2030  ].rgns[m].xs > 0
+00074f30: 3a20 6370 202b 3d20 310a 2020 2020 2020  : cp += 1.      
+00074f40: 2020 6966 2028 6370 203e 2030 2920 2620    if (cp > 0) & 
+00074f50: 2863 6e20 3e20 3029 3a0a 2020 2020 2020  (cn > 0):.      
+00074f60: 2020 2020 2020 765f 6879 6220 2b3d 2063        v_hyb += c
+00074f70: 766f 6c0a 2020 2020 2020 2020 2020 2020  vol.            
+00074f80: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
+00074f90: 2020 2020 2023 2070 7269 6e74 2827 3d3d       # print('==
+00074fa0: 3d20 2569 203d 3d3d 2720 2520 6b29 0a20  = %i ===' % k). 
+00074fb0: 2020 2020 2020 2020 2020 2023 2072 676e             # rgn
+00074fc0: 735f 6c73 745f 6d69 5b6b 5d2e 7072 696e  s_lst_mi[k].prin
+00074fd0: 745f 7368 6f72 7428 290a 2020 2020 2020  t_short().      
+00074fe0: 2020 2020 2020 2320 7267 6e73 5f6c 7374        # rgns_lst
+00074ff0: 5f6e 645b 6b5d 2e70 7269 6e74 5f73 686f  _nd[k].print_sho
+00075000: 7274 2829 0a20 2020 2020 2020 2020 2020  rt().           
+00075010: 200a 2020 2020 7265 7475 726e 2063 6e74   .    return cnt
+00075020: 2c20 765f 6879 622c 2076 5f74 6f74 0a20  , v_hyb, v_tot. 
+00075030: 2020 200a 0a27 2727 0a4c 494e 455f 5641     ..'''.LINE_VA
+00075040: 4c49 4420 3d20 300a 4e4f 5f4d 4f52 455f  LID = 0.NO_MORE_
+00075050: 4c49 4e45 203d 2034 0a4c 494e 455f 494e  LINE = 4.LINE_IN
+00075060: 5641 4c49 4420 3d20 320a 0a43 4f4e 5449  VALID = 2..CONTI
+00075070: 4e55 4544 203d 2030 0a4e 4557 5f43 4852  NUED = 0.NEW_CHR
+00075080: 4d20 3d20 310a 2320 4c49 4e45 5f49 4e56  M = 1.# LINE_INV
+00075090: 414c 4944 203d 2032 0a4e 4f54 5f53 4f52  ALID = 2.NOT_SOR
+000750a0: 5445 4420 3d20 330a 2727 270a 0a64 6566  TED = 3.'''..def
+000750b0: 2063 6865 636b 5f73 7472 616e 6428 2072   check_strand( r
+000750c0: 5f6d 5f6c 7374 2c20 725f 6e64 5f6c 7374  _m_lst, r_nd_lst
+000750d0: 2029 3a0a 2020 2020 0a20 2020 2070 6f73   ):.    .    pos
+000750e0: 203d 2030 0a20 2020 206e 6567 203d 2030   = 0.    neg = 0
+000750f0: 0a20 2020 2066 6f72 2072 2069 6e20 725f  .    for r in r_
+00075100: 6e64 5f6c 7374 3a0a 2020 2020 2020 2020  nd_lst:.        
+00075110: 6966 206c 656e 2872 2e72 676e 7329 203e  if len(r.rgns) >
+00075120: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00075130: 6966 2072 2e72 676e 735b 305d 2e78 7320  if r.rgns[0].xs 
+00075140: 3e20 303a 2070 6f73 202b 3d20 310a 2020  > 0: pos += 1.  
+00075150: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
+00075160: 2e72 676e 735b 305d 2e78 7320 3c20 303a  .rgns[0].xs < 0:
+00075170: 206e 6567 202b 3d20 310a 2020 2020 2020   neg += 1.      
+00075180: 2020 2020 2020 0a20 2020 2066 6f72 2072        .    for r
+00075190: 2069 6e20 725f 6d5f 6c73 743a 0a20 2020   in r_m_lst:.   
+000751a0: 2020 2020 2069 6620 6c65 6e28 722e 7267       if len(r.rg
+000751b0: 6e73 2920 3e20 303a 0a20 2020 2020 2020  ns) > 0:.       
+000751c0: 2020 2020 2069 6620 722e 7267 6e73 5b30       if r.rgns[0
+000751d0: 5d2e 7873 203e 2030 3a20 706f 7320 2b3d  ].xs > 0: pos +=
+000751e0: 2031 0a20 2020 2020 2020 2020 2020 2065   1.            e
+000751f0: 6c69 6620 722e 7267 6e73 5b30 5d2e 7873  lif r.rgns[0].xs
+00075200: 203c 2030 3a20 6e65 6720 2b3d 2031 0a20   < 0: neg += 1. 
+00075210: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00075220: 7265 7475 726e 2070 6f73 2c20 6e65 670a  return pos, neg.
+00075230: 0a0a 6465 6620 6d63 5f63 6f72 655f 6275  ..def mc_core_bu
+00075240: 696c 645f 636e 7467 2873 616d 5f6c 7374  ild_cntg(sam_lst
+00075250: 5f6e 5f73 6129 3a0a 2020 2020 0a20 2020  _n_sa):.    .   
+00075260: 2062 203d 2054 7275 650a 2020 2020 7361   b = True.    sa
+00075270: 6d5f 6c73 742c 2073 6120 3d20 7361 6d5f  m_lst, sa = sam_
+00075280: 6c73 745f 6e5f 7361 5b3a 2d31 5d2c 2073  lst_n_sa[:-1], s
+00075290: 616d 5f6c 7374 5f6e 5f73 615b 2d31 5d20  am_lst_n_sa[-1] 
+000752a0: 2020 2020 2020 200a 2020 2020 6966 2028         .    if (
+000752b0: 6c65 6e28 7361 6d5f 6c73 7429 203e 3d20  len(sam_lst) >= 
+000752c0: 4d49 4e5f 4e5f 5244 535f 5045 525f 4745  MIN_N_RDS_PER_GE
+000752d0: 4e45 293a 2023 204d 494e 5f52 445f 4e55  NE): # MIN_RD_NU
+000752e0: 4d5f 5045 525f 4745 4e45 293a 2023 2026  M_PER_GENE): # &
+000752f0: 2028 2863 703d 3d30 2920 7c20 2863 6e3d   ((cp==0) | (cn=
+00075300: 3d30 2929 3a0a 0a20 2020 2020 2020 2072  =0)):..        r
+00075310: 5f6c 7374 5f6d 2c20 725f 6c73 745f 6e64  _lst_m, r_lst_nd
+00075320: 2c20 725f 6c73 745f 7374 692c 2072 676e  , r_lst_sti, rgn
+00075330: 5f69 6478 203d 205c 0a20 2020 2020 2020  _idx = \.       
+00075340: 2020 2020 2067 6574 5f72 6567 696f 6e73       get_regions
+00075350: 5f61 6c6c 5f66 726f 6d5f 7361 6d28 2073  _all_from_sam( s
+00075360: 616d 5f6c 7374 2c20 7361 203d 2073 6120  am_lst, sa = sa 
+00075370: 290a 2020 2020 2020 2020 6220 3d20 4661  ).        b = Fa
+00075380: 6c73 650a 2020 2020 2020 2020 7361 6d5f  lse.        sam_
+00075390: 6c73 7420 3d20 4e6f 6e65 2023 205b 5d0a  lst = None # [].
+000753a0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000753b0: 2069 6620 623a 0a20 2020 2020 2020 2072   if b:.        r
+000753c0: 5f6c 7374 5f6d 203d 205b 5d0a 2020 2020  _lst_m = [].    
+000753d0: 2020 2020 725f 6c73 745f 6e64 203d 205b      r_lst_nd = [
+000753e0: 5d0a 2020 2020 2020 2020 725f 6c73 745f  ].        r_lst_
+000753f0: 7374 6920 3d20 5b5d 0a20 2020 200a 2020  sti = [].    .  
+00075400: 2020 7265 7475 726e 2072 5f6c 7374 5f6d    return r_lst_m
+00075410: 2c20 725f 6c73 745f 6e64 2c20 725f 6c73  , r_lst_nd, r_ls
+00075420: 745f 7374 690a 0a0a 6465 6620 6275 696c  t_sti...def buil
+00075430: 645f 636f 6e74 6967 7328 735f 6c73 745f  d_contigs(s_lst_
+00075440: 6f66 5f6c 7374 2c20 7469 746c 6520 3d20  of_lst, title = 
+00075450: 2727 293a 0a20 2020 200a 2020 2020 7267  ''):.    .    rg
+00075460: 6e73 5f6c 7374 5f6d 6920 3d20 5b5d 0a20  ns_lst_mi = []. 
+00075470: 2020 2072 676e 735f 6c73 745f 6e64 203d     rgns_lst_nd =
+00075480: 205b 5d0a 2020 2020 7267 6e73 5f6c 7374   [].    rgns_lst
+00075490: 5f73 7420 3d20 5b5d 0a20 2020 200a 2020  _st = [].    .  
+000754a0: 2020 666f 7220 6b2c 2073 5f6c 7374 2069    for k, s_lst i
+000754b0: 6e20 656e 756d 6572 6174 6528 735f 6c73  n enumerate(s_ls
+000754c0: 745f 6f66 5f6c 7374 293a 0a20 2020 2020  t_of_lst):.     
+000754d0: 2020 200a 2020 2020 2020 2020 725f 6c73     .        r_ls
+000754e0: 745f 6d69 2c20 725f 6c73 745f 6e64 2c20  t_mi, r_lst_nd, 
+000754f0: 725f 6c73 745f 7374 203d 206d 635f 636f  r_lst_st = mc_co
+00075500: 7265 5f62 7569 6c64 5f63 6e74 6728 735f  re_build_cntg(s_
+00075510: 6c73 7429 0a20 2020 2020 2020 2072 676e  lst).        rgn
+00075520: 735f 6c73 745f 6d69 203d 2072 676e 735f  s_lst_mi = rgns_
+00075530: 6c73 745f 6d69 202b 2072 5f6c 7374 5f6d  lst_mi + r_lst_m
+00075540: 690a 2020 2020 2020 2020 7267 6e73 5f6c  i.        rgns_l
+00075550: 7374 5f6e 6420 3d20 7267 6e73 5f6c 7374  st_nd = rgns_lst
+00075560: 5f6e 6420 2b20 725f 6c73 745f 6e64 0a20  _nd + r_lst_nd. 
+00075570: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
+00075580: 7374 203d 2072 676e 735f 6c73 745f 7374  st = rgns_lst_st
+00075590: 202b 2072 5f6c 7374 5f73 740a 0a20 2020   + r_lst_st..   
+000755a0: 2020 2020 2069 6620 6b25 3130 3020 3d3d       if k%100 ==
+000755b0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000755c0: 2320 7072 696e 7428 275c 7242 7569 6c64  # print('\rBuild
+000755d0: 696e 6720 6c6f 6369 2026 2043 4d61 7420  ing loci & CMat 
+000755e0: 2e2e 2e20 2825 692f 2569 6729 2020 2020  ... (%i/%ig)    
+000755f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075600: 2020 2020 2720 5c0a 2020 2020 2020 2020      ' \.        
+00075610: 2020 2020 2320 2020 2020 2020 2520 286b      #       % (k
+00075620: 2c20 6c65 6e28 735f 6c73 745f 6f66 5f6c  , len(s_lst_of_l
+00075630: 7374 2929 2c20 656e 643d 2727 290a 2020  st)), end='').  
+00075640: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00075650: 275c 7227 202b 2027 2027 2a31 3030 2c20  '\r' + ' '*100, 
+00075660: 656e 643d 2727 2c20 666c 7573 6820 3d20  end='', flush = 
+00075670: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00075680: 2020 6966 206c 656e 2874 6974 6c65 2920    if len(title) 
+00075690: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+000756a0: 2020 2020 2020 7072 696e 7428 275c 7242        print('\rB
+000756b0: 7569 6c64 696e 6720 6c6f 6369 2026 2043  uilding loci & C
+000756c0: 4d61 7420 2e2e 2e20 2825 692f 2569 6329  Mat ... (%i/%ic)
+000756d0: 2027 205c 0a20 2020 2020 2020 2020 2020   ' \.           
+000756e0: 2020 2020 2020 2020 2020 2025 2028 6b2c             % (k,
+000756f0: 206c 656e 2873 5f6c 7374 5f6f 665f 6c73   len(s_lst_of_ls
+00075700: 7429 292c 2065 6e64 3d27 272c 2066 6c75  t)), end='', flu
+00075710: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
+00075720: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00075730: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00075740: 6e74 2827 5c72 2020 2070 726f 6365 7373  nt('\r   process
+00075750: 696e 6720 2573 2028 2569 2f25 6963 2920  ing %s (%i/%ic) 
+00075760: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
+00075770: 2020 2020 2020 2020 2020 2520 2874 6974            % (tit
+00075780: 6c65 2c20 6b2c 206c 656e 2873 5f6c 7374  le, k, len(s_lst
+00075790: 5f6f 665f 6c73 7429 292c 2065 6e64 3d27  _of_lst)), end='
+000757a0: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
+000757b0: 0a20 2020 200a 2020 2020 2320 7072 696e  .    .    # prin
+000757c0: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
+000757d0: 6369 2026 2043 4d61 7420 2e2e 2e20 646f  ci & CMat ... do
+000757e0: 6e65 2028 2569 6729 2020 2020 2020 2020  ne (%ig)        
+000757f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075800: 2720 2520 286c 656e 2873 5f6c 7374 5f6f  ' % (len(s_lst_o
+00075810: 665f 6c73 7429 292c 2065 6e64 3d27 2729  f_lst)), end='')
+00075820: 0a20 2020 2072 6574 7572 6e20 7267 6e73  .    return rgns
+00075830: 5f6c 7374 5f6d 692c 2072 676e 735f 6c73  _lst_mi, rgns_ls
+00075840: 745f 6e64 2c20 7267 6e73 5f6c 7374 5f73  t_nd, rgns_lst_s
+00075850: 740a 0a0a 6465 6620 6275 696c 645f 636f  t...def build_co
+00075860: 6e74 6967 735f 6d63 2873 5f6c 7374 5f6f  ntigs_mc(s_lst_o
+00075870: 665f 6c73 742c 206e 5f63 6f72 6573 203d  f_lst, n_cores =
+00075880: 204e 554d 5f43 4f52 4553 2c20 7469 746c   NUM_CORES, titl
+00075890: 6520 3d20 2727 293a 0a20 2020 200a 2020  e = ''):.    .  
+000758a0: 2020 7267 6e73 5f6c 7374 5f6d 6920 3d20    rgns_lst_mi = 
+000758b0: 5b5d 0a20 2020 2072 676e 735f 6c73 745f  [].    rgns_lst_
+000758c0: 6e64 203d 205b 5d0a 2020 2020 7267 6e73  nd = [].    rgns
+000758d0: 5f6c 7374 5f73 7420 3d20 5b5d 0a20 2020  _lst_st = [].   
+000758e0: 200a 2020 2020 6e75 6d5f 636f 7265 203d   .    num_core =
+000758f0: 206d 6178 2820 6d69 6e28 206e 5f63 6f72   max( min( n_cor
+00075900: 6573 2c20 2863 7075 5f63 6f75 6e74 2829  es, (cpu_count()
+00075910: 202d 2031 2920 292c 2031 290a 2020 2020   - 1) ), 1).    
+00075920: 706f 6f6c 203d 2050 6f6f 6c28 6e75 6d5f  pool = Pool(num_
+00075930: 636f 7265 290a 2020 2020 746f 7461 6c5f  core).    total_
+00075940: 6974 6572 6174 696f 6e20 3d20 6c65 6e28  iteration = len(
+00075950: 735f 6c73 745f 6f66 5f6c 7374 290a 2020  s_lst_of_lst).  
+00075960: 2020 0a20 2020 2069 6620 5472 7565 3a20    .    if True: 
+00075970: 2320 6e6f 7420 5451 444d 3a0a 2020 2020  # not TQDM:.    
+00075980: 2020 2020 0a20 2020 2020 2020 2073 5f6c      .        s_l
+00075990: 7374 5f6f 665f 6c73 742e 736f 7274 2872  st_of_lst.sort(r
+000759a0: 6576 6572 7365 203d 2054 7275 652c 206b  everse = True, k
+000759b0: 6579 3d6c 656e 290a 0a20 2020 2020 2020  ey=len)..       
+000759c0: 2070 7269 6e74 2827 5c72 2720 2b20 2720   print('\r' + ' 
+000759d0: 272a 3130 302c 2065 6e64 3d27 272c 2066  '*100, end='', f
+000759e0: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
+000759f0: 2020 2020 2069 6620 6c65 6e28 7469 746c       if len(titl
+00075a00: 6529 203d 3d20 303a 0a20 2020 2020 2020  e) == 0:.       
+00075a10: 2020 2020 2070 7269 6e74 2827 5c72 4275       print('\rBu
+00075a20: 696c 6469 6e67 206c 6f63 6920 2620 434d  ilding loci & CM
+00075a30: 6174 202e 2e2e 2020 272c 2065 6e64 3d27  at ...  ', end='
+00075a40: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
+00075a50: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00075a60: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00075a70: 2827 5c72 2020 2070 726f 6365 7373 696e  ('\r   processin
+00075a80: 6720 2573 202e 2e2e 2027 2025 2028 7469  g %s ... ' % (ti
+00075a90: 746c 6529 2c20 656e 643d 2727 2c20 666c  tle), end='', fl
+00075aa0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+00075ab0: 2020 2020 6b20 3d20 300a 2020 2020 2020      k = 0.      
+00075ac0: 2020 666f 7220 725f 6c73 745f 6d69 2c20    for r_lst_mi, 
+00075ad0: 725f 6c73 745f 6e64 2c20 725f 6c73 745f  r_lst_nd, r_lst_
+00075ae0: 7374 2069 6e20 706f 6f6c 2e69 6d61 705f  st in pool.imap_
+00075af0: 756e 6f72 6465 7265 6428 6d63 5f63 6f72  unordered(mc_cor
+00075b00: 655f 6275 696c 645f 636e 7467 2c20 735f  e_build_cntg, s_
+00075b10: 6c73 745f 6f66 5f6c 7374 293a 0a20 2020  lst_of_lst):.   
+00075b20: 2020 2020 2020 2020 2072 676e 735f 6c73           rgns_ls
+00075b30: 745f 6d69 203d 2072 676e 735f 6c73 745f  t_mi = rgns_lst_
+00075b40: 6d69 202b 2072 5f6c 7374 5f6d 690a 2020  mi + r_lst_mi.  
+00075b50: 2020 2020 2020 2020 2020 7267 6e73 5f6c            rgns_l
+00075b60: 7374 5f6e 6420 3d20 7267 6e73 5f6c 7374  st_nd = rgns_lst
+00075b70: 5f6e 6420 2b20 725f 6c73 745f 6e64 0a20  _nd + r_lst_nd. 
+00075b80: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
+00075b90: 6c73 745f 7374 203d 2072 676e 735f 6c73  lst_st = rgns_ls
+00075ba0: 745f 7374 202b 2072 5f6c 7374 5f73 7420  t_st + r_lst_st 
+00075bb0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00075bc0: 0a20 2020 2020 2020 2020 2020 206b 202b  .            k +
+00075bd0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00075be0: 6966 206b 2531 3030 203d 3d20 303a 0a20  if k%100 == 0:. 
+00075bf0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00075c00: 7269 6e74 2827 5c72 2720 2b20 2720 272a  rint('\r' + ' '*
+00075c10: 3130 302c 2065 6e64 3d27 272c 2066 6c75  100, end='', flu
+00075c20: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
+00075c30: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00075c40: 6e28 7469 746c 6529 203d 3d20 303a 0a20  n(title) == 0:. 
+00075c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075c60: 2020 2070 7269 6e74 2827 5c72 4275 696c     print('\rBuil
+00075c70: 6469 6e67 206c 6f63 6920 2620 434d 6174  ding loci & CMat
+00075c80: 202e 2e2e 2028 2569 2f25 6963 2920 2720   ... (%i/%ic) ' 
+00075c90: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00075ca0: 2020 2020 2020 2020 2020 2020 2520 286b              % (k
+00075cb0: 2c20 746f 7461 6c5f 6974 6572 6174 696f  , total_iteratio
+00075cc0: 6e29 2c20 656e 643d 2727 2c20 666c 7573  n), end='', flus
+00075cd0: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
+00075ce0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00075cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075d00: 2020 2020 7072 696e 7428 275c 7220 2020      print('\r   
+00075d10: 7072 6f63 6573 7369 6e67 2025 7320 2e2e  processing %s ..
+00075d20: 2e20 2825 692f 2569 6329 2027 205c 0a20  . (%i/%ic) ' \. 
+00075d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075d40: 2020 2020 2020 2020 2025 2028 7469 746c           % (titl
+00075d50: 652c 206b 2c20 746f 7461 6c5f 6974 6572  e, k, total_iter
+00075d60: 6174 696f 6e29 2c20 656e 643d 2727 2c20  ation), end='', 
+00075d70: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
+00075d80: 2020 2020 2020 2020 2020 0a20 2020 2070            .    p
+00075d90: 6f6f 6c2e 636c 6f73 6528 290a 2020 2020  ool.close().    
+00075da0: 706f 6f6c 2e6a 6f69 6e28 290a 2020 2020  pool.join().    
+00075db0: 0a20 2020 2072 6574 7572 6e20 7267 6e73  .    return rgns
+00075dc0: 5f6c 7374 5f6d 692c 2072 676e 735f 6c73  _lst_mi, rgns_ls
+00075dd0: 745f 6e64 2c20 7267 6e73 5f6c 7374 5f73  t_nd, rgns_lst_s
+00075de0: 740a 0a0a 6465 6620 7072 6f63 5f72 6561  t...def proc_rea
+00075df0: 645f 7361 6d28 2073 616d 5f6f 626a 2c20  d_sam( sam_obj, 
+00075e00: 7120 293a 0a20 2020 200a 2020 2020 7768  q ):.    .    wh
+00075e10: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
+00075e20: 2020 6572 5f63 6f64 652c 2073 616d 5f6c    er_code, sam_l
+00075e30: 7374 2c20 6e75 6d5f 7265 6164 7320 3d20  st, num_reads = 
+00075e40: 7361 6d5f 6f62 6a2e 6765 745f 6f6e 655f  sam_obj.get_one_
+00075e50: 6f76 6572 6c61 7065 645f 7361 6d28 2920  overlaped_sam() 
+00075e60: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00075e70: 712e 7075 7428 2028 6572 5f63 6f64 652c  q.put( (er_code,
+00075e80: 2073 616d 5f6c 7374 2c20 7361 6d5f 6f62   sam_lst, sam_ob
+00075e90: 6a2e 6e75 6d5f 7265 6164 7329 2029 0a20  j.num_reads) ). 
+00075ea0: 2020 2020 2020 2069 6620 6572 5f63 6f64         if er_cod
+00075eb0: 6520 3d3d 204e 4f5f 4d4f 5245 5f4c 494e  e == NO_MORE_LIN
+00075ec0: 453a 2062 7265 616b 0a20 2020 2020 2020  E: break.       
+00075ed0: 200a 0a64 6566 2073 6176 655f 7267 6e73   ..def save_rgns
+00075ee0: 5f6f 626a 2866 696c 656e 616d 652c 2072  _obj(filename, r
+00075ef0: 676e 735f 6c73 745f 6d2c 2072 676e 735f  gns_lst_m, rgns_
+00075f00: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
+00075f10: 5f73 7469 2c20 7264 5f6c 656e 2c20 6e5f  _sti, rd_len, n_
+00075f20: 7264 732c 206d 6564 5f66 7261 675f 6c65  rds, med_frag_le
+00075f30: 6e20 293a 0a20 2020 200a 2020 2020 7769  n ):.    .    wi
+00075f40: 7468 206f 7065 6e28 6669 6c65 6e61 6d65  th open(filename
+00075f50: 2c20 2777 6227 2920 6173 2066 3a0a 2020  , 'wb') as f:.  
+00075f60: 2020 2020 2020 7069 636b 6c65 2e64 756d        pickle.dum
+00075f70: 7028 2028 7267 6e73 5f6c 7374 5f6d 2c20  p( (rgns_lst_m, 
+00075f80: 7267 6e73 5f6c 7374 5f6e 642c 2072 676e  rgns_lst_nd, rgn
+00075f90: 735f 6c73 745f 7374 692c 2072 645f 6c65  s_lst_sti, rd_le
+00075fa0: 6e2c 206e 5f72 6473 2c20 6d65 645f 6672  n, n_rds, med_fr
+00075fb0: 6167 5f6c 656e 292c 2066 2029 0a20 2020  ag_len), f ).   
+00075fc0: 2020 2020 200a 6465 6620 6c6f 6164 5f72       .def load_r
+00075fd0: 676e 735f 6f62 6a28 6669 6c65 6e61 6d65  gns_obj(filename
+00075fe0: 293a 0a20 2020 200a 2020 2020 7769 7468  ):.    .    with
+00075ff0: 206f 7065 6e28 6669 6c65 6e61 6d65 2c20   open(filename, 
+00076000: 2772 6227 2920 6173 2066 3a0a 2020 2020  'rb') as f:.    
+00076010: 2020 2020 6461 7461 203d 2070 6963 6b6c      data = pickl
+00076020: 652e 6c6f 6164 2820 6620 290a 2020 2020  e.load( f ).    
+00076030: 2020 2020 2320 7267 6e73 5f6c 7374 5f6d      # rgns_lst_m
+00076040: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
+00076050: 676e 735f 6c73 745f 7374 692c 2072 645f  gns_lst_sti, rd_
+00076060: 6c65 6e2c 206e 5f72 6473 2c20 6d65 645f  len, n_rds, med_
+00076070: 6672 6167 5f6c 656e 203d 2070 6963 6b6c  frag_len = pickl
+00076080: 652e 6c6f 6164 2820 6620 290a 2020 2020  e.load( f ).    
+00076090: 2320 7265 7475 726e 2072 676e 735f 6c73  # return rgns_ls
+000760a0: 745f 6d2c 2072 676e 735f 6c73 745f 6e64  t_m, rgns_lst_nd
+000760b0: 2c20 7267 6e73 5f6c 7374 5f73 7469 2c20  , rgns_lst_sti, 
+000760c0: 7264 5f6c 656e 2c20 6e5f 7264 732c 206d  rd_len, n_rds, m
+000760d0: 6564 5f66 7261 675f 6c65 6e0a 2020 2020  ed_frag_len.    
+000760e0: 7265 7475 726e 2064 6174 610a 200a 6465  return data. .de
+000760f0: 6620 7361 7665 5f6f 626a 2866 696c 656e  f save_obj(filen
+00076100: 616d 652c 206f 626a 2029 3a0a 2020 2020  ame, obj ):.    
+00076110: 0a20 2020 2077 6974 6820 6f70 656e 2866  .    with open(f
+00076120: 696c 656e 616d 652c 2027 7762 2729 2061  ilename, 'wb') a
+00076130: 7320 663a 0a20 2020 2020 2020 2070 6963  s f:.        pic
+00076140: 6b6c 652e 6475 6d70 2820 286f 626a 292c  kle.dump( (obj),
+00076150: 2066 2029 0a20 2020 2020 2020 200a 6465   f ).        .de
+00076160: 6620 6c6f 6164 5f6f 626a 2866 696c 656e  f load_obj(filen
+00076170: 616d 6529 3a0a 2020 2020 0a20 2020 2077  ame):.    .    w
+00076180: 6974 6820 6f70 656e 2866 696c 656e 616d  ith open(filenam
+00076190: 652c 2027 7262 2729 2061 7320 663a 0a20  e, 'rb') as f:. 
+000761a0: 2020 2020 2020 206f 626a 203d 2070 6963         obj = pic
+000761b0: 6b6c 652e 6c6f 6164 2820 6620 290a 2020  kle.load( f ).  
+000761c0: 2020 7265 7475 726e 206f 626a 0a0a 0a23    return obj...#
 000761d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000761e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000761f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00076200: 2323 2323 2323 2323 2323 230a 2323 2053  ###########.## S
-00076210: 7472 696e 6746 6978 2d41 6e61 6c79 7369  tringFix-Analysi
-00076220: 730a 2323 2323 2323 2323 2323 2323 2323  s.##############
+00076200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00076210: 2323 2323 2323 2323 230a 2323 2053 7472  #########.## Str
+00076220: 696e 6746 6978 2d41 6e61 6c79 7369 730a  ingFix-Analysis.
 00076230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00076240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00076250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00076260: 2323 2323 2323 2323 2323 2323 0a0a 6465  ############..de
-00076270: 6620 6669 6c74 6572 5f74 7273 5f6c 656e  f filter_trs_len
-00076280: 2820 6661 5f6c 696e 6573 5f6c 6973 742c  ( fa_lines_list,
-00076290: 206d 696e 5f6c 656e 203d 2030 2029 3a0a   min_len = 0 ):.
-000762a0: 0a20 2020 204c 656e 2020 3d20 6c65 6e28  .    Len  = len(
-000762b0: 6661 5f6c 696e 6573 5f6c 6973 7429 0a20  fa_lines_list). 
-000762c0: 2020 2069 6620 4c65 6e25 3220 213d 2030     if Len%2 != 0
-000762d0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-000762e0: 2745 5252 4f52 2069 6e20 6669 6c74 6572  'ERROR in filter
-000762f0: 5f74 7273 5f6c 656e 3a20 4e75 6d20 6c69  _trs_len: Num li
-00076300: 6e65 7320 3d20 2569 2027 2025 204c 656e  nes = %i ' % Len
-00076310: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00076320: 6e20 5b5d 0a20 2020 2065 6c73 653a 0a20  n [].    else:. 
-00076330: 2020 2020 2020 2066 615f 6c69 6e65 735f         fa_lines_
-00076340: 6f75 7420 3d20 5b5d 0a20 2020 2020 2020  out = [].       
-00076350: 204e 756d 203d 206e 702e 696e 7428 4c65   Num = np.int(Le
-00076360: 6e2f 3229 0a20 2020 2020 2020 2066 6f72  n/2).        for
-00076370: 206b 2069 6e20 7261 6e67 6528 4e75 6d29   k in range(Num)
-00076380: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00076390: 206c 656e 2866 615f 6c69 6e65 735f 6c69   len(fa_lines_li
-000763a0: 7374 5b20 6b2a 322b 3120 5d29 203e 206d  st[ k*2+1 ]) > m
-000763b0: 696e 5f6c 656e 3a20 2320 696e 636c 7564  in_len: # includ
-000763c0: 696e 6720 275c 6e27 0a20 2020 2020 2020  ing '\n'.       
-000763d0: 2020 2020 2020 2020 2066 615f 6c69 6e65           fa_line
-000763e0: 735f 6f75 742e 6170 7065 6e64 2820 6661  s_out.append( fa
-000763f0: 5f6c 696e 6573 5f6c 6973 745b 206b 2a32  _lines_list[ k*2
-00076400: 205d 2029 0a20 2020 2020 2020 2020 2020   ] ).           
-00076410: 2020 2020 2066 615f 6c69 6e65 735f 6f75       fa_lines_ou
-00076420: 742e 6170 7065 6e64 2820 6661 5f6c 696e  t.append( fa_lin
-00076430: 6573 5f6c 6973 745b 206b 2a32 2b31 205d  es_list[ k*2+1 ]
-00076440: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00076450: 6e20 6661 5f6c 696e 6573 5f6f 7574 0a0a  n fa_lines_out..
-00076460: 0a64 6566 2066 696c 7465 725f 7472 735f  .def filter_trs_
-00076470: 3128 7472 732c 2066 7261 675f 6c65 6e20  1(trs, frag_len 
-00076480: 3d20 3830 2c20 675f 7468 203d 2031 302c  = 80, g_th = 10,
-00076490: 2061 626e 5f74 685f 7420 3d20 312c 2061   abn_th_t = 1, a
-000764a0: 626e 5f74 685f 6920 3d20 312c 205c 0a20  bn_th_i = 1, \. 
-000764b0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-000764c0: 6f5f 6672 6163 5f74 6820 3d20 302e 3031  o_frac_th = 0.01
-000764d0: 2c20 6c65 6e5f 7468 203d 2032 3030 2c20  , len_th = 200, 
-000764e0: 7665 7262 6f73 6520 3d20 5472 7565 2029  verbose = True )
-000764f0: 3a0a 2020 2020 0a20 2020 2069 6620 7665  :.    .    if ve
-00076500: 7262 6f73 6520 3d3d 2054 7275 6520 3a20  rbose == True : 
-00076510: 7072 696e 7428 2746 696c 7465 7269 6e67  print('Filtering
-00076520: 202e 2e2e 2027 2c20 656e 643d 2727 2029   ... ', end='' )
-00076530: 0a20 2020 2074 7273 5f6f 7574 203d 205b  .    trs_out = [
-00076540: 5d0a 2020 2020 6973 666d 5f6f 7574 203d  ].    isfm_out =
-00076550: 205b 5d0a 2020 2020 6e74 6920 3d20 300a   [].    nti = 0.
-00076560: 2020 2020 6e69 6920 3d20 300a 2020 2020      nii = 0.    
-00076570: 6e74 6f20 3d20 300a 2020 2020 6e69 6f20  nto = 0.    nio 
-00076580: 3d20 300a 2020 2020 666f 7220 7472 2069  = 0.    for tr i
-00076590: 6e20 7472 733a 0a20 2020 2020 2020 2069  n trs:.        i
-000765a0: 6620 7472 2e70 7265 6669 7820 3d3d 2027  f tr.prefix == '
-000765b0: 5427 3a0a 2020 2020 2020 2020 2020 2020  T':.            
-000765c0: 6e74 6920 2b3d 2031 0a20 2020 2020 2020  nti += 1.       
-000765d0: 2020 2020 2069 6620 7472 2e6e 6578 7320       if tr.nexs 
-000765e0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-000765f0: 2020 2020 2020 6966 2028 7472 2e67 766f        if (tr.gvo
-00076600: 6c20 3e3d 2067 5f74 682a 6672 6167 5f6c  l >= g_th*frag_l
-00076610: 656e 2a31 2920 2620 2874 722e 6162 6e20  en*1) & (tr.abn 
-00076620: 3e3d 2061 626e 5f74 685f 742a 342e 3529  >= abn_th_t*4.5)
-00076630: 2026 2028 6c65 6e28 7472 2e73 6571 2920   & (len(tr.seq) 
-00076640: 3e3d 206c 656e 5f74 6829 3a20 0a20 2020  >= len_th): .   
-00076650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076660: 206e 746f 202b 3d20 310a 2020 2020 2020   nto += 1.      
-00076670: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00076680: 735f 6f75 742e 6170 7065 6e64 2874 7229  s_out.append(tr)
-00076690: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000766a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000766b0: 2020 2069 6620 2874 722e 6e65 7873 203e     if (tr.nexs >
-000766c0: 3d20 3429 3a0a 2020 2020 2020 2020 2020  = 4):.          
-000766d0: 2020 2020 2020 2020 2020 6966 2028 7472            if (tr
-000766e0: 2e67 766f 6c20 3e3d 2067 5f74 682a 6672  .gvol >= g_th*fr
-000766f0: 6167 5f6c 656e 2920 2620 2874 722e 6162  ag_len) & (tr.ab
-00076700: 6e20 3e3d 2061 626e 5f74 685f 7429 2026  n >= abn_th_t) &
-00076710: 2028 6c65 6e28 7472 2e73 6571 2920 3e3d   (len(tr.seq) >=
-00076720: 206c 656e 5f74 6829 3a20 0a20 2020 2020   len_th): .     
-00076730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076740: 2020 206e 746f 202b 3d20 310a 2020 2020     nto += 1.    
-00076750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076760: 2020 2020 7472 735f 6f75 742e 6170 7065      trs_out.appe
-00076770: 6e64 2874 7229 0a20 2020 2020 2020 2020  nd(tr).         
-00076780: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00076790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000767a0: 2069 6620 2874 722e 6776 6f6c 203e 3d20   if (tr.gvol >= 
-000767b0: 675f 7468 2a66 7261 675f 6c65 6e29 2026  g_th*frag_len) &
-000767c0: 2028 7472 2e61 626e 203e 3d20 6162 6e5f   (tr.abn >= abn_
-000767d0: 7468 5f74 2920 2620 286c 656e 2874 722e  th_t) & (len(tr.
-000767e0: 7365 7129 203e 3d20 6c65 6e5f 7468 293a  seq) >= len_th):
-000767f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00076800: 2020 2020 2020 2020 2020 6e74 6f20 2b3d            nto +=
-00076810: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00076820: 2020 2020 2020 2020 2020 2074 7273 5f6f             trs_o
-00076830: 7574 2e61 7070 656e 6428 7472 290a 2020  ut.append(tr).  
-00076840: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00076850: 2020 2020 2020 2020 6e69 6920 2b3d 2031          nii += 1
-00076860: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00076870: 2874 722e 6776 6f6c 203e 3d20 675f 7468  (tr.gvol >= g_th
-00076880: 2a66 7261 675f 6c65 6e29 2026 2028 7472  *frag_len) & (tr
-00076890: 2e61 626e 203e 3d20 6162 6e5f 7468 5f69  .abn >= abn_th_i
-000768a0: 2920 2620 2874 722e 6973 6f5f 6672 6163  ) & (tr.iso_frac
-000768b0: 203e 3d20 6973 6f5f 6672 6163 5f74 6829   >= iso_frac_th)
-000768c0: 2026 2028 6c65 6e28 7472 2e73 6571 2920   & (len(tr.seq) 
-000768d0: 3e3d 206c 656e 5f74 6829 3a20 0a20 2020  >= len_th): .   
-000768e0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-000768f0: 7366 6d5f 6f75 742e 6170 7065 6e64 2874  sfm_out.append(t
-00076900: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00076910: 2020 2074 7273 5f6f 7574 2e61 7070 656e     trs_out.appen
-00076920: 6428 7472 290a 2020 2020 2020 2020 2020  d(tr).          
-00076930: 2020 2020 2020 6e69 6f20 2b3d 2031 0a20        nio += 1. 
-00076940: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00076950: 2020 2020 6966 2076 6572 626f 7365 203d      if verbose =
-00076960: 3d20 5472 7565 203a 2070 7269 6e74 2827  = True : print('
-00076970: 4e75 6d2e 5472 7320 3d20 2569 2025 6920  Num.Trs = %i %i 
-00076980: 2825 6929 202d 3e20 2569 2c20 2569 2028  (%i) -> %i, %i (
-00076990: 2569 2920 2720 2520 286e 7469 2c6e 6969  %i) ' % (nti,nii
-000769a0: 2c6e 7469 2b6e 6969 2c6e 746f 2c6e 696f  ,nti+nii,nto,nio
-000769b0: 2c6e 746f 2b6e 696f 2929 0a20 2020 2023  ,nto+nio)).    #
-000769c0: 2072 6574 7572 6e28 7472 735f 6f75 742c   return(trs_out,
-000769d0: 2069 7366 6d5f 6f75 7429 0a20 2020 2072   isfm_out).    r
-000769e0: 6574 7572 6e28 7472 735f 6f75 7429 0a0a  eturn(trs_out)..
-000769f0: 0a64 6566 2066 696c 7465 725f 7472 735f  .def filter_trs_
-00076a00: 3228 7472 732c 2066 7261 675f 6c65 6e20  2(trs, frag_len 
-00076a10: 3d20 3830 2c20 675f 7468 203d 2031 302c  = 80, g_th = 10,
-00076a20: 2061 626e 5f74 685f 7420 3d20 312c 2061   abn_th_t = 1, a
-00076a30: 626e 5f74 685f 6920 3d20 312c 205c 0a20  bn_th_i = 1, \. 
-00076a40: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00076a50: 6f5f 6672 6163 5f74 6820 3d20 302e 3031  o_frac_th = 0.01
-00076a60: 2c20 6c65 6e5f 7468 203d 2032 3030 2c20  , len_th = 200, 
-00076a70: 6e65 5f74 6820 3d20 342c 2076 6572 626f  ne_th = 4, verbo
-00076a80: 7365 203d 2054 7275 6529 3a0a 2020 2020  se = True):.    
-00076a90: 0a20 2020 2069 6620 7665 7262 6f73 6520  .    if verbose 
-00076aa0: 3d3d 2054 7275 6520 3a20 7072 696e 7428  == True : print(
-00076ab0: 2746 696c 7465 7269 6e67 202e 2e2e 2027  'Filtering ... '
-00076ac0: 2c20 656e 643d 2727 2029 0a20 2020 2074  , end='' ).    t
-00076ad0: 7273 5f6f 7574 203d 205b 5d0a 2020 2020  rs_out = [].    
-00076ae0: 6973 666d 5f6f 7574 203d 205b 5d0a 2020  isfm_out = [].  
-00076af0: 2020 6e74 6920 3d20 300a 2020 2020 6e69    nti = 0.    ni
-00076b00: 6920 3d20 300a 2020 2020 6e74 6f20 3d20  i = 0.    nto = 
-00076b10: 300a 2020 2020 6e69 6f20 3d20 300a 2020  0.    nio = 0.  
-00076b20: 2020 675f 7468 203d 2067 5f74 6820 2a20    g_th = g_th * 
-00076b30: 6162 6e5f 7468 5f69 0a20 2020 2072 6566  abn_th_i.    ref
-00076b40: 5f74 6820 3d20 6e65 5f74 682a 675f 7468  _th = ne_th*g_th
-00076b50: 2a66 7261 675f 6c65 6e2a 6162 6e5f 7468  *frag_len*abn_th
-00076b60: 5f69 0a20 2020 206d 696e 5f61 626e 203d  _i.    min_abn =
-00076b70: 2031 3030 3030 3030 300a 2020 2020 6d69   10000000.    mi
-00076b80: 6e5f 6776 6f6c 203d 2031 3030 3030 3030  n_gvol = 1000000
-00076b90: 300a 2020 2020 6d69 6e5f 6973 6620 3d20  0.    min_isf = 
-00076ba0: 320a 2020 2020 666f 7220 7472 2069 6e20  2.    for tr in 
-00076bb0: 7472 733a 0a20 2020 2020 2020 206d 6574  trs:.        met
-00076bc0: 203d 206d 696e 2874 722e 6772 705f 7369   = min(tr.grp_si
-00076bd0: 7a65 2c20 3429 2a6d 696e 2874 722e 6e65  ze, 4)*min(tr.ne
-00076be0: 7873 2c34 292a 6d69 6e28 7472 2e67 766f  xs,4)*min(tr.gvo
-00076bf0: 6c2c 2034 3030 290a 2020 2020 2020 2020  l, 400).        
-00076c00: 7468 7220 3d20 7265 665f 7468 2f6d 6574  thr = ref_th/met
-00076c10: 0a20 2020 2020 2020 2072 203d 2031 0a20  .        r = 1. 
-00076c20: 2020 2020 2020 2023 2069 6620 7468 7220         # if thr 
-00076c30: 3e20 313a 2072 203d 2031 2e35 0a20 2020  > 1: r = 1.5.   
-00076c40: 2020 2020 2069 6620 7472 2e6e 6578 7320       if tr.nexs 
-00076c50: 3d3d 2031 3a20 7468 7220 2a3d 2034 0a20  == 1: thr *= 4. 
-00076c60: 2020 2020 2020 2069 6620 2874 722e 6776         if (tr.gv
-00076c70: 6f6c 203e 2067 5f74 682a 6672 6167 5f6c  ol > g_th*frag_l
-00076c80: 656e 2a74 6872 2920 2620 2874 722e 6162  en*thr) & (tr.ab
-00076c90: 6e20 3e3d 2061 626e 5f74 685f 692a 7468  n >= abn_th_i*th
-00076ca0: 7229 2026 2028 7472 2e69 736f 5f66 7261  r) & (tr.iso_fra
-00076cb0: 6320 3e3d 2069 736f 5f66 7261 635f 7468  c >= iso_frac_th
-00076cc0: 2920 2620 286c 656e 2874 722e 7473 6571  ) & (len(tr.tseq
-00076cd0: 2920 3e3d 206c 656e 5f74 682a 7229 3a20  ) >= len_th*r): 
-00076ce0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00076cf0: 7472 2e70 7265 6669 7820 3d3d 2027 5427  tr.prefix == 'T'
-00076d00: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-00076d10: 2020 2074 7273 5f6f 7574 2e61 7070 656e     trs_out.appen
-00076d20: 6428 7472 290a 2020 2020 2020 2020 2020  d(tr).          
-00076d30: 2020 2020 2020 6e74 6f20 2b3d 2031 0a20        nto += 1. 
-00076d40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00076d50: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00076d60: 2020 2320 6973 666d 5f6f 7574 2e61 7070    # isfm_out.app
-00076d70: 656e 6428 7472 290a 2020 2020 2020 2020  end(tr).        
-00076d80: 2020 2020 2020 2020 7472 735f 6f75 742e          trs_out.
-00076d90: 6170 7065 6e64 2874 7229 0a20 2020 2020  append(tr).     
-00076da0: 2020 2020 2020 2020 2020 206e 696f 202b             nio +
-00076db0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00076dc0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00076dd0: 206d 696e 5f61 626e 203d 206d 696e 286d   min_abn = min(m
-00076de0: 696e 5f61 626e 2c74 722e 6162 6e29 0a20  in_abn,tr.abn). 
-00076df0: 2020 2020 2020 2020 2020 206d 696e 5f67             min_g
-00076e00: 766f 6c20 3d20 6d69 6e28 6d69 6e5f 6776  vol = min(min_gv
-00076e10: 6f6c 2c74 722e 6776 6f6c 290a 2020 2020  ol,tr.gvol).    
-00076e20: 2020 2020 2020 2020 6d69 6e5f 6973 6620          min_isf 
-00076e30: 3d20 6d69 6e28 6d69 6e5f 6973 662c 7472  = min(min_isf,tr
-00076e40: 2e69 736f 5f66 7261 6329 0a20 2020 2020  .iso_frac).     
-00076e50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00076e60: 6966 2074 722e 7072 6566 6978 203d 3d20  if tr.prefix == 
-00076e70: 2754 273a 206e 7469 202b 3d20 310a 2020  'T': nti += 1.  
-00076e80: 2020 2020 2020 656c 7365 3a20 6e69 6920        else: nii 
-00076e90: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00076ea0: 200a 2020 2020 6966 2076 6572 626f 7365   .    if verbose
-00076eb0: 203d 3d20 5472 7565 203a 200a 2020 2020   == True : .    
-00076ec0: 2020 2020 7072 696e 7428 274e 756d 2e54      print('Num.T
-00076ed0: 7273 203d 2025 6920 2569 2028 2569 2920  rs = %i %i (%i) 
-00076ee0: 2d3e 2025 692c 2025 6920 2825 6929 2720  -> %i, %i (%i)' 
-00076ef0: 2520 286e 7469 2c6e 6969 2c6e 7469 2b6e  % (nti,nii,nti+n
-00076f00: 6969 2c6e 746f 2c6e 696f 2c6e 746f 2b6e  ii,nto,nio,nto+n
-00076f10: 696f 2920 290a 2020 2020 2020 2020 7072  io) ).        pr
-00076f20: 696e 7428 274d 696e 2e41 626e 203d 2025  int('Min.Abn = %
-00076f30: 662c 204d 696e 2e49 736f 4672 6163 203d  f, Min.IsoFrac =
-00076f40: 2025 662c 204d 696e 2e47 566f 6c20 3d20   %f, Min.GVol = 
-00076f50: 2534 2e31 6627 2025 2028 6d69 6e5f 6162  %4.1f' % (min_ab
-00076f60: 6e2c 206d 696e 5f69 7366 2c20 6d69 6e5f  n, min_isf, min_
-00076f70: 6776 6f6c 2920 290a 2020 2020 2020 2020  gvol) ).        
-00076f80: 0a20 2020 2020 2320 7265 7475 726e 2874  .     # return(t
-00076f90: 7273 5f6f 7574 2c20 6973 666d 5f6f 7574  rs_out, isfm_out
-00076fa0: 290a 2020 2020 7265 7475 726e 2874 7273  ).    return(trs
-00076fb0: 5f6f 7574 290a 0a0a 6465 6620 6765 745f  _out)...def get_
-00076fc0: 6669 6c65 5f6e 616d 6528 2070 6174 685f  file_name( path_
-00076fd0: 6669 6c65 5f6e 616d 6520 293a 0a0a 2020  file_name ):..  
-00076fe0: 2020 6669 6c65 5f6e 616d 6573 203d 2070    file_names = p
-00076ff0: 6174 685f 6669 6c65 5f6e 616d 652e 7370  ath_file_name.sp
-00077000: 6c69 7428 272f 2729 5b2d 315d 0a20 2020  lit('/')[-1].   
-00077010: 2066 6e73 203d 2066 696c 655f 6e61 6d65   fns = file_name
-00077020: 732e 7370 6c69 7428 272e 2729 0a20 2020  s.split('.').   
-00077030: 2065 7874 203d 2066 6e73 5b2d 315d 0a20   ext = fns[-1]. 
-00077040: 2020 2066 6e73 203d 2066 6e73 5b3a 2d31     fns = fns[:-1
-00077050: 5d0a 2020 2020 666e 616d 6520 3d20 2727  ].    fname = ''
-00077060: 0a20 2020 2066 6f72 206b 2c20 666e 2069  .    for k, fn i
-00077070: 6e20 656e 756d 6572 6174 6528 666e 7329  n enumerate(fns)
-00077080: 3a0a 2020 2020 2020 2020 6966 206b 203e  :.        if k >
-00077090: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-000770a0: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
-000770b0: 272e 270a 2020 2020 2020 2020 666e 616d  '.'.        fnam
-000770c0: 6520 3d20 666e 616d 6520 2b20 666e 0a0a  e = fname + fn..
-000770d0: 2020 2020 7265 7475 726e 2066 6e61 6d65      return fname
-000770e0: 2c20 6578 740a 0a0a 6465 6620 6765 745f  , ext...def get_
-000770f0: 7061 7468 5f6e 616d 6528 2070 6174 685f  path_name( path_
-00077100: 6669 6c65 5f6e 616d 6520 293a 0a0a 2020  file_name ):..  
-00077110: 2020 666e 7320 3d20 7061 7468 5f66 696c    fns = path_fil
-00077120: 655f 6e61 6d65 2e73 706c 6974 2827 2e27  e_name.split('.'
-00077130: 290a 2020 2020 6578 7420 3d20 666e 735b  ).    ext = fns[
-00077140: 2d31 5d0a 2020 2020 666e 7320 3d20 666e  -1].    fns = fn
-00077150: 735b 3a2d 315d 0a20 2020 2066 6e61 6d65  s[:-1].    fname
-00077160: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
-00077170: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
-00077180: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
-00077190: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
-000771a0: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-000771b0: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
-000771c0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
-000771d0: 2066 6e0a 0a20 2020 2072 6574 7572 6e20   fn..    return 
-000771e0: 666e 616d 652c 2065 7874 0a0a 0a64 6566  fname, ext...def
-000771f0: 206d 635f 636f 7265 5f67 6574 5f67 7466   mc_core_get_gtf
-00077200: 5f61 6e64 5f66 6173 7461 5f70 6628 6764  _and_fasta_pf(gd
-00077210: 293a 0a0a 2020 2020 6e65 203d 2030 0a20  ):..    ne = 0. 
-00077220: 2020 2023 206e 7472 2c20 6e70 722c 206e     # ntr, npr, n
-00077230: 6520 3d20 6764 2e75 7064 6174 655f 7464  e = gd.update_td
-00077240: 5f69 6e66 6f28 290a 2020 2020 6774 665f  _info().    gtf_
-00077250: 6c69 6e65 2c20 636e 203d 2067 642e 6765  line, cn = gd.ge
-00077260: 745f 6774 665f 6c69 6e65 735f 6672 6f6d  t_gtf_lines_from
-00077270: 5f65 786f 6e73 2829 0a20 2020 206c 742c  _exons().    lt,
-00077280: 206c 7020 3d20 6764 2e67 6574 5f66 6173   lp = gd.get_fas
-00077290: 7461 5f6c 696e 6573 5f66 726f 6d5f 6578  ta_lines_from_ex
-000772a0: 6f6e 7328 7065 7074 6964 6520 3d20 4661  ons(peptide = Fa
-000772b0: 6c73 6529 0a0a 2020 2020 2727 270a 2020  lse)..    '''.  
-000772c0: 2020 6966 206c 656e 286c 7429 2021 3d20    if len(lt) != 
-000772d0: 6e74 722a 323a 0a20 2020 2020 2020 2070  ntr*2:.        p
-000772e0: 7269 6e74 2827 4552 524f 5220 696e 206d  rint('ERROR in m
-000772f0: 635f 636f 7265 5f67 6574 5f67 7466 5f61  c_core_get_gtf_a
-00077300: 6e64 5f66 6173 7461 5f70 663a 2025 6920  nd_fasta_pf: %i 
-00077310: 213d 2025 6920 2720 2520 286e 7472 2c20  != %i ' % (ntr, 
-00077320: 6c65 6e28 6c74 292f 3229 2029 0a20 2020  len(lt)/2) ).   
-00077330: 2069 6620 6c65 6e28 6c70 2920 213d 206e   if len(lp) != n
-00077340: 7072 2a32 3a0a 2020 2020 2020 2020 7072  pr*2:.        pr
-00077350: 696e 7428 2745 5252 4f52 2069 6e20 6d63  int('ERROR in mc
-00077360: 5f63 6f72 655f 6765 745f 6774 665f 616e  _core_get_gtf_an
-00077370: 645f 6661 7374 615f 7066 3a20 2569 2021  d_fasta_pf: %i !
-00077380: 3d20 2569 2027 2025 2028 6e70 722c 206c  = %i ' % (npr, l
-00077390: 656e 286c 7029 2f32 2920 290a 2020 2020  en(lp)/2) ).    
-000773a0: 2327 2727 0a20 2020 2072 6574 7572 6e20  #'''.    return 
-000773b0: 6774 665f 6c69 6e65 2c20 6c74 2c20 6c70  gtf_line, lt, lp
-000773c0: 2c20 6e65 2c20 636e 0a0a 0a64 6566 2053  , ne, cn...def S
-000773d0: 7472 696e 6746 6978 5f61 6e61 6c79 7369  tringFix_analysi
-000773e0: 7328 7361 6d5f 6669 6c65 2c20 6774 6620  s(sam_file, gtf 
-000773f0: 3d20 4e6f 6e65 2c20 6765 6e6f 6d65 5f66  = None, genome_f
-00077400: 696c 6520 3d20 4e6f 6e65 2c20 7375 6666  ile = None, suff
-00077410: 6978 203d 204e 6f6e 652c 206a 756d 7020  ix = None, jump 
-00077420: 3d20 302c 2073 6120 3d20 322c 2063 6279  = 0, sa = 2, cby
-00077430: 6320 3d20 4661 6c73 652c 205c 0a20 2020  c = False, \.   
-00077440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077450: 2020 2020 6e5f 636f 7265 7320 3d20 312c      n_cores = 1,
-00077460: 206d 696e 5f66 7261 6773 5f70 6572 5f67   min_frags_per_g
-00077470: 656e 6520 3d20 322c 206c 656e 5f74 6820  ene = 2, len_th 
-00077480: 3d20 4d49 4e5f 5452 5f4c 454e 4754 482c  = MIN_TR_LENGTH,
-00077490: 206f 7574 5f74 7220 3d20 4661 6c73 652c   out_tr = False,
-000774a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000774b0: 2020 2020 2020 2020 7361 765f 7267 6e20          sav_rgn 
-000774c0: 3d20 4661 6c73 652c 206f 7574 5f64 6972  = False, out_dir
-000774d0: 203d 204e 6f6e 6520 293a 0a20 2020 2027   = None ):.    '
-000774e0: 2727 0a20 2020 2069 6620 6774 6620 6973  ''.    if gtf is
-000774f0: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
-00077500: 7269 6e74 2827 4552 524f 523a 204e 6f20  rint('ERROR: No 
-00077510: 4754 462f 4746 4620 6669 6c65 2070 726f  GTF/GFF file pro
-00077520: 7669 6465 642e 2729 0a20 2020 2020 2020  vided.').       
-00077530: 2072 6574 7572 6e0a 2020 2020 2327 2727   return.    #'''
-00077540: 0a20 2020 200a 2020 2020 6d65 7468 6f64  .    .    method
-00077550: 203d 2027 6c61 7373 6f27 0a20 2020 204e   = 'lasso'.    N
-00077560: 7265 6320 3d20 300a 2020 2020 5374 6172  rec = 0.    Star
-00077570: 7420 3d20 300a 2020 2020 0a20 2020 2066  t = 0.    .    f
-00077580: 696c 655f 6e61 6d65 7320 3d20 7361 6d5f  ile_names = sam_
-00077590: 6669 6c65 2e73 706c 6974 2827 2f27 295b  file.split('/')[
-000775a0: 2d31 5d0a 2020 2020 666e 7320 3d20 6669  -1].    fns = fi
-000775b0: 6c65 5f6e 616d 6573 2e73 706c 6974 2827  le_names.split('
-000775c0: 2e27 295b 3a2d 315d 0a20 2020 2066 6e61  .')[:-1].    fna
-000775d0: 6d65 203d 2027 270a 2020 2020 666f 7220  me = ''.    for 
-000775e0: 6b2c 2066 6e20 696e 2065 6e75 6d65 7261  k, fn in enumera
-000775f0: 7465 2866 6e73 293a 0a20 2020 2020 2020  te(fns):.       
-00077600: 2069 6620 6b20 3e20 303a 0a20 2020 2020   if k > 0:.     
-00077610: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
-00077620: 6e61 6d65 202b 2027 2e27 0a20 2020 2020  name + '.'.     
-00077630: 2020 2066 6e61 6d65 203d 2066 6e61 6d65     fname = fname
-00077640: 202b 2066 6e0a 0a20 2020 2069 6620 6f75   + fn..    if ou
-00077650: 745f 6469 7220 6973 206e 6f74 204e 6f6e  t_dir is not Non
-00077660: 653a 0a20 2020 2020 2020 2069 6620 6f75  e:.        if ou
-00077670: 745f 6469 725b 2d31 5d20 3d3d 2027 2f27  t_dir[-1] == '/'
-00077680: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
-00077690: 616d 6520 3d20 6f75 745f 6469 7220 2b20  ame = out_dir + 
-000776a0: 666e 616d 650a 2020 2020 2020 2020 656c  fname.        el
-000776b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000776c0: 666e 616d 6520 3d20 6f75 745f 6469 7220  fname = out_dir 
-000776d0: 2b20 272f 2720 2b20 666e 616d 650a 0a20  + '/' + fname.. 
-000776e0: 2020 2069 6620 7375 6666 6978 2069 7320     if suffix is 
-000776f0: 6e6f 7420 4e6f 6e65 3a20 2020 200a 2020  not None:    .  
-00077700: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
-00077710: 616d 6520 2b20 275f 2720 2b20 7375 6666  ame + '_' + suff
-00077720: 6978 0a0a 2020 2020 6966 206a 756d 7020  ix..    if jump 
-00077730: 3e20 313a 2072 6574 7572 6e20 666e 616d  > 1: return fnam
-00077740: 652c 204e 6f6e 652c 204e 6f6e 650a 0a20  e, None, None.. 
-00077750: 2020 204e 554d 5f43 4f52 4553 203d 206e     NUM_CORES = n
-00077760: 5f63 6f72 6573 0a20 2020 2073 7461 7274  _cores.    start
-00077770: 5f74 696d 6531 203d 2074 696d 652e 7469  _time1 = time.ti
-00077780: 6d65 2829 0a20 2020 2073 7461 7274 5f74  me().    start_t
-00077790: 696d 6532 203d 2074 696d 652e 7469 6d65  ime2 = time.time
-000777a0: 2829 0a20 2020 2069 6620 6a75 6d70 2532  ().    if jump%2
-000777b0: 203d 3d20 303a 0a0a 2020 2020 2020 2020   == 0:..        
-000777c0: 4754 465f 6c73 7420 3d20 5b5d 0a20 2020  GTF_lst = [].   
-000777d0: 2020 2020 2072 676e 735f 6c73 745f 6d69       rgns_lst_mi
-000777e0: 203d 205b 5d0a 2020 2020 2020 2020 7267   = [].        rg
-000777f0: 6e73 5f6c 7374 5f6e 6420 3d20 5b5d 0a20  ns_lst_nd = []. 
-00077800: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
-00077810: 7374 203d 205b 5d0a 0a20 2020 2020 2020  st = []..       
-00077820: 2063 6e74 203d 2030 0a20 2020 2020 2020   cnt = 0.       
-00077830: 206d 785f 6c65 6e20 3d20 3132 0a20 2020   mx_len = 12.   
-00077840: 2020 2020 2065 725f 636f 6465 203d 2030       er_code = 0
-00077850: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00077860: 2020 7072 696e 7428 2753 7472 696e 6746    print('StringF
-00077870: 6978 2073 7461 7274 6564 2027 2c20 6461  ix started ', da
-00077880: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-00077890: 6e6f 7728 2929 0a20 2020 2020 2020 2073  now()).        s
-000778a0: 6f20 3d20 7361 6d5f 6f62 6a28 7361 6d5f  o = sam_obj(sam_
-000778b0: 6669 6c65 2c20 7361 203d 2073 6129 0a20  file, sa = sa). 
-000778c0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000778d0: 6966 206e 5f63 6f72 6573 203d 3d20 313a  if n_cores == 1:
-000778e0: 206e 756d 5f70 6172 616c 6c65 6c5f 6368   num_parallel_ch
-000778f0: 756e 6b73 203d 2034 0a20 2020 2020 2020  unks = 4.       
-00077900: 2065 6c73 653a 206e 756d 5f70 6172 616c   else: num_paral
-00077910: 6c65 6c5f 6368 756e 6b73 203d 204e 554d  lel_chunks = NUM
-00077920: 5f50 4152 414c 4c45 4c5f 4348 554e 4b53  _PARALLEL_CHUNKS
-00077930: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00077940: 2020 625f 636e 7420 3d20 300a 2020 2020    b_cnt = 0.    
-00077950: 2020 2020 725f 6c73 745f 6f66 5f6c 7374      r_lst_of_lst
-00077960: 203d 205b 5d0a 2020 2020 2020 2020 0a20   = [].        . 
-00077970: 2020 2020 2020 2023 2323 2323 2323 2323         #########
-00077980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00076260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00076270: 2323 2323 2323 2323 2323 0a0a 6465 6620  ##########..def 
+00076280: 6669 6c74 6572 5f74 7273 5f6c 656e 2820  filter_trs_len( 
+00076290: 6661 5f6c 696e 6573 5f6c 6973 742c 206d  fa_lines_list, m
+000762a0: 696e 5f6c 656e 203d 2030 2029 3a0a 0a20  in_len = 0 ):.. 
+000762b0: 2020 204c 656e 2020 3d20 6c65 6e28 6661     Len  = len(fa
+000762c0: 5f6c 696e 6573 5f6c 6973 7429 0a20 2020  _lines_list).   
+000762d0: 2069 6620 4c65 6e25 3220 213d 2030 3a0a   if Len%2 != 0:.
+000762e0: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
+000762f0: 5252 4f52 2069 6e20 6669 6c74 6572 5f74  RROR in filter_t
+00076300: 7273 5f6c 656e 3a20 4e75 6d20 6c69 6e65  rs_len: Num line
+00076310: 7320 3d20 2569 2027 2025 204c 656e 2029  s = %i ' % Len )
+00076320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00076330: 5b5d 0a20 2020 2065 6c73 653a 0a20 2020  [].    else:.   
+00076340: 2020 2020 2066 615f 6c69 6e65 735f 6f75       fa_lines_ou
+00076350: 7420 3d20 5b5d 0a20 2020 2020 2020 204e  t = [].        N
+00076360: 756d 203d 206e 702e 696e 7428 4c65 6e2f  um = np.int(Len/
+00076370: 3229 0a20 2020 2020 2020 2066 6f72 206b  2).        for k
+00076380: 2069 6e20 7261 6e67 6528 4e75 6d29 3a0a   in range(Num):.
+00076390: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000763a0: 656e 2866 615f 6c69 6e65 735f 6c69 7374  en(fa_lines_list
+000763b0: 5b20 6b2a 322b 3120 5d29 203e 206d 696e  [ k*2+1 ]) > min
+000763c0: 5f6c 656e 3a20 2320 696e 636c 7564 696e  _len: # includin
+000763d0: 6720 275c 6e27 0a20 2020 2020 2020 2020  g '\n'.         
+000763e0: 2020 2020 2020 2066 615f 6c69 6e65 735f         fa_lines_
+000763f0: 6f75 742e 6170 7065 6e64 2820 6661 5f6c  out.append( fa_l
+00076400: 696e 6573 5f6c 6973 745b 206b 2a32 205d  ines_list[ k*2 ]
+00076410: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00076420: 2020 2066 615f 6c69 6e65 735f 6f75 742e     fa_lines_out.
+00076430: 6170 7065 6e64 2820 6661 5f6c 696e 6573  append( fa_lines
+00076440: 5f6c 6973 745b 206b 2a32 2b31 205d 2029  _list[ k*2+1 ] )
+00076450: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00076460: 6661 5f6c 696e 6573 5f6f 7574 0a0a 0a64  fa_lines_out...d
+00076470: 6566 2066 696c 7465 725f 7472 735f 3128  ef filter_trs_1(
+00076480: 7472 732c 2066 7261 675f 6c65 6e20 3d20  trs, frag_len = 
+00076490: 3830 2c20 675f 7468 203d 2031 302c 2061  80, g_th = 10, a
+000764a0: 626e 5f74 685f 7420 3d20 312c 2061 626e  bn_th_t = 1, abn
+000764b0: 5f74 685f 6920 3d20 312c 205c 0a20 2020  _th_i = 1, \.   
+000764c0: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
+000764d0: 6672 6163 5f74 6820 3d20 302e 3031 2c20  frac_th = 0.01, 
+000764e0: 6c65 6e5f 7468 203d 2032 3030 2c20 7665  len_th = 200, ve
+000764f0: 7262 6f73 6520 3d20 5472 7565 2029 3a0a  rbose = True ):.
+00076500: 2020 2020 0a20 2020 2069 6620 7665 7262      .    if verb
+00076510: 6f73 6520 3d3d 2054 7275 6520 3a20 7072  ose == True : pr
+00076520: 696e 7428 2746 696c 7465 7269 6e67 202e  int('Filtering .
+00076530: 2e2e 2027 2c20 656e 643d 2727 2029 0a20  .. ', end='' ). 
+00076540: 2020 2074 7273 5f6f 7574 203d 205b 5d0a     trs_out = [].
+00076550: 2020 2020 6973 666d 5f6f 7574 203d 205b      isfm_out = [
+00076560: 5d0a 2020 2020 6e74 6920 3d20 300a 2020  ].    nti = 0.  
+00076570: 2020 6e69 6920 3d20 300a 2020 2020 6e74    nii = 0.    nt
+00076580: 6f20 3d20 300a 2020 2020 6e69 6f20 3d20  o = 0.    nio = 
+00076590: 300a 2020 2020 666f 7220 7472 2069 6e20  0.    for tr in 
+000765a0: 7472 733a 0a20 2020 2020 2020 2069 6620  trs:.        if 
+000765b0: 7472 2e70 7265 6669 7820 3d3d 2027 5427  tr.prefix == 'T'
+000765c0: 3a0a 2020 2020 2020 2020 2020 2020 6e74  :.            nt
+000765d0: 6920 2b3d 2031 0a20 2020 2020 2020 2020  i += 1.         
+000765e0: 2020 2069 6620 7472 2e6e 6578 7320 3d3d     if tr.nexs ==
+000765f0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00076600: 2020 2020 6966 2028 7472 2e67 766f 6c20      if (tr.gvol 
+00076610: 3e3d 2067 5f74 682a 6672 6167 5f6c 656e  >= g_th*frag_len
+00076620: 2a31 2920 2620 2874 722e 6162 6e20 3e3d  *1) & (tr.abn >=
+00076630: 2061 626e 5f74 685f 742a 342e 3529 2026   abn_th_t*4.5) &
+00076640: 2028 6c65 6e28 7472 2e73 6571 2920 3e3d   (len(tr.seq) >=
+00076650: 206c 656e 5f74 6829 3a20 0a20 2020 2020   len_th): .     
+00076660: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00076670: 746f 202b 3d20 310a 2020 2020 2020 2020  to += 1.        
+00076680: 2020 2020 2020 2020 2020 2020 7472 735f              trs_
+00076690: 6f75 742e 6170 7065 6e64 2874 7229 0a20  out.append(tr). 
+000766a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000766b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000766c0: 2069 6620 2874 722e 6e65 7873 203e 3d20   if (tr.nexs >= 
+000766d0: 3429 3a0a 2020 2020 2020 2020 2020 2020  4):.            
+000766e0: 2020 2020 2020 2020 6966 2028 7472 2e67          if (tr.g
+000766f0: 766f 6c20 3e3d 2067 5f74 682a 6672 6167  vol >= g_th*frag
+00076700: 5f6c 656e 2920 2620 2874 722e 6162 6e20  _len) & (tr.abn 
+00076710: 3e3d 2061 626e 5f74 685f 7429 2026 2028  >= abn_th_t) & (
+00076720: 6c65 6e28 7472 2e73 6571 2920 3e3d 206c  len(tr.seq) >= l
+00076730: 656e 5f74 6829 3a20 0a20 2020 2020 2020  en_th): .       
+00076740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076750: 206e 746f 202b 3d20 310a 2020 2020 2020   nto += 1.      
+00076760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076770: 2020 7472 735f 6f75 742e 6170 7065 6e64    trs_out.append
+00076780: 2874 7229 0a20 2020 2020 2020 2020 2020  (tr).           
+00076790: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000767a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000767b0: 6620 2874 722e 6776 6f6c 203e 3d20 675f  f (tr.gvol >= g_
+000767c0: 7468 2a66 7261 675f 6c65 6e29 2026 2028  th*frag_len) & (
+000767d0: 7472 2e61 626e 203e 3d20 6162 6e5f 7468  tr.abn >= abn_th
+000767e0: 5f74 2920 2620 286c 656e 2874 722e 7365  _t) & (len(tr.se
+000767f0: 7129 203e 3d20 6c65 6e5f 7468 293a 200a  q) >= len_th): .
+00076800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076810: 2020 2020 2020 2020 6e74 6f20 2b3d 2031          nto += 1
+00076820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00076830: 2020 2020 2020 2020 2074 7273 5f6f 7574           trs_out
+00076840: 2e61 7070 656e 6428 7472 290a 2020 2020  .append(tr).    
+00076850: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00076860: 2020 2020 2020 6e69 6920 2b3d 2031 0a20        nii += 1. 
+00076870: 2020 2020 2020 2020 2020 2069 6620 2874             if (t
+00076880: 722e 6776 6f6c 203e 3d20 675f 7468 2a66  r.gvol >= g_th*f
+00076890: 7261 675f 6c65 6e29 2026 2028 7472 2e61  rag_len) & (tr.a
+000768a0: 626e 203e 3d20 6162 6e5f 7468 5f69 2920  bn >= abn_th_i) 
+000768b0: 2620 2874 722e 6973 6f5f 6672 6163 203e  & (tr.iso_frac >
+000768c0: 3d20 6973 6f5f 6672 6163 5f74 6829 2026  = iso_frac_th) &
+000768d0: 2028 6c65 6e28 7472 2e73 6571 2920 3e3d   (len(tr.seq) >=
+000768e0: 206c 656e 5f74 6829 3a20 0a20 2020 2020   len_th): .     
+000768f0: 2020 2020 2020 2020 2020 2023 2069 7366             # isf
+00076900: 6d5f 6f75 742e 6170 7065 6e64 2874 7229  m_out.append(tr)
+00076910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00076920: 2074 7273 5f6f 7574 2e61 7070 656e 6428   trs_out.append(
+00076930: 7472 290a 2020 2020 2020 2020 2020 2020  tr).            
+00076940: 2020 2020 6e69 6f20 2b3d 2031 0a20 2020      nio += 1.   
+00076950: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00076960: 2020 6966 2076 6572 626f 7365 203d 3d20    if verbose == 
+00076970: 5472 7565 203a 2070 7269 6e74 2827 4e75  True : print('Nu
+00076980: 6d2e 5472 7320 3d20 2569 2025 6920 2825  m.Trs = %i %i (%
+00076990: 6929 202d 3e20 2569 2c20 2569 2028 2569  i) -> %i, %i (%i
+000769a0: 2920 2720 2520 286e 7469 2c6e 6969 2c6e  ) ' % (nti,nii,n
+000769b0: 7469 2b6e 6969 2c6e 746f 2c6e 696f 2c6e  ti+nii,nto,nio,n
+000769c0: 746f 2b6e 696f 2929 0a20 2020 2023 2072  to+nio)).    # r
+000769d0: 6574 7572 6e28 7472 735f 6f75 742c 2069  eturn(trs_out, i
+000769e0: 7366 6d5f 6f75 7429 0a20 2020 2072 6574  sfm_out).    ret
+000769f0: 7572 6e28 7472 735f 6f75 7429 0a0a 0a64  urn(trs_out)...d
+00076a00: 6566 2066 696c 7465 725f 7472 735f 3228  ef filter_trs_2(
+00076a10: 7472 732c 2066 7261 675f 6c65 6e20 3d20  trs, frag_len = 
+00076a20: 3830 2c20 675f 7468 203d 2031 302c 2061  80, g_th = 10, a
+00076a30: 626e 5f74 685f 7420 3d20 312c 2061 626e  bn_th_t = 1, abn
+00076a40: 5f74 685f 6920 3d20 312c 205c 0a20 2020  _th_i = 1, \.   
+00076a50: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
+00076a60: 6672 6163 5f74 6820 3d20 302e 3031 2c20  frac_th = 0.01, 
+00076a70: 6c65 6e5f 7468 203d 2032 3030 2c20 6e65  len_th = 200, ne
+00076a80: 5f74 6820 3d20 342c 2076 6572 626f 7365  _th = 4, verbose
+00076a90: 203d 2054 7275 6529 3a0a 2020 2020 0a20   = True):.    . 
+00076aa0: 2020 2069 6620 7665 7262 6f73 6520 3d3d     if verbose ==
+00076ab0: 2054 7275 6520 3a20 7072 696e 7428 2746   True : print('F
+00076ac0: 696c 7465 7269 6e67 202e 2e2e 2027 2c20  iltering ... ', 
+00076ad0: 656e 643d 2727 2029 0a20 2020 2074 7273  end='' ).    trs
+00076ae0: 5f6f 7574 203d 205b 5d0a 2020 2020 6973  _out = [].    is
+00076af0: 666d 5f6f 7574 203d 205b 5d0a 2020 2020  fm_out = [].    
+00076b00: 6e74 6920 3d20 300a 2020 2020 6e69 6920  nti = 0.    nii 
+00076b10: 3d20 300a 2020 2020 6e74 6f20 3d20 300a  = 0.    nto = 0.
+00076b20: 2020 2020 6e69 6f20 3d20 300a 2020 2020      nio = 0.    
+00076b30: 675f 7468 203d 2067 5f74 6820 2a20 6162  g_th = g_th * ab
+00076b40: 6e5f 7468 5f69 0a20 2020 2072 6566 5f74  n_th_i.    ref_t
+00076b50: 6820 3d20 6e65 5f74 682a 675f 7468 2a66  h = ne_th*g_th*f
+00076b60: 7261 675f 6c65 6e2a 6162 6e5f 7468 5f69  rag_len*abn_th_i
+00076b70: 0a20 2020 206d 696e 5f61 626e 203d 2031  .    min_abn = 1
+00076b80: 3030 3030 3030 300a 2020 2020 6d69 6e5f  0000000.    min_
+00076b90: 6776 6f6c 203d 2031 3030 3030 3030 300a  gvol = 10000000.
+00076ba0: 2020 2020 6d69 6e5f 6973 6620 3d20 320a      min_isf = 2.
+00076bb0: 2020 2020 666f 7220 7472 2069 6e20 7472      for tr in tr
+00076bc0: 733a 0a20 2020 2020 2020 206d 6574 203d  s:.        met =
+00076bd0: 206d 696e 2874 722e 6772 705f 7369 7a65   min(tr.grp_size
+00076be0: 2c20 3429 2a6d 696e 2874 722e 6e65 7873  , 4)*min(tr.nexs
+00076bf0: 2c34 292a 6d69 6e28 7472 2e67 766f 6c2c  ,4)*min(tr.gvol,
+00076c00: 2034 3030 290a 2020 2020 2020 2020 7468   400).        th
+00076c10: 7220 3d20 7265 665f 7468 2f6d 6574 0a20  r = ref_th/met. 
+00076c20: 2020 2020 2020 2072 203d 2031 0a20 2020         r = 1.   
+00076c30: 2020 2020 2023 2069 6620 7468 7220 3e20       # if thr > 
+00076c40: 313a 2072 203d 2031 2e35 0a20 2020 2020  1: r = 1.5.     
+00076c50: 2020 2069 6620 7472 2e6e 6578 7320 3d3d     if tr.nexs ==
+00076c60: 2031 3a20 7468 7220 2a3d 2034 0a20 2020   1: thr *= 4.   
+00076c70: 2020 2020 2069 6620 2874 722e 6776 6f6c       if (tr.gvol
+00076c80: 203e 2067 5f74 682a 6672 6167 5f6c 656e   > g_th*frag_len
+00076c90: 2a74 6872 2920 2620 2874 722e 6162 6e20  *thr) & (tr.abn 
+00076ca0: 3e3d 2061 626e 5f74 685f 692a 7468 7229  >= abn_th_i*thr)
+00076cb0: 2026 2028 7472 2e69 736f 5f66 7261 6320   & (tr.iso_frac 
+00076cc0: 3e3d 2069 736f 5f66 7261 635f 7468 2920  >= iso_frac_th) 
+00076cd0: 2620 286c 656e 2874 722e 7473 6571 2920  & (len(tr.tseq) 
+00076ce0: 3e3d 206c 656e 5f74 682a 7229 3a20 0a20  >= len_th*r): . 
+00076cf0: 2020 2020 2020 2020 2020 2069 6620 7472             if tr
+00076d00: 2e70 7265 6669 7820 3d3d 2027 5427 3a20  .prefix == 'T': 
+00076d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00076d20: 2074 7273 5f6f 7574 2e61 7070 656e 6428   trs_out.append(
+00076d30: 7472 290a 2020 2020 2020 2020 2020 2020  tr).            
+00076d40: 2020 2020 6e74 6f20 2b3d 2031 0a20 2020      nto += 1.   
+00076d50: 2020 2020 2020 2020 2065 6c73 653a 200a           else: .
+00076d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076d70: 2320 6973 666d 5f6f 7574 2e61 7070 656e  # isfm_out.appen
+00076d80: 6428 7472 290a 2020 2020 2020 2020 2020  d(tr).          
+00076d90: 2020 2020 2020 7472 735f 6f75 742e 6170        trs_out.ap
+00076da0: 7065 6e64 2874 7229 0a20 2020 2020 2020  pend(tr).       
+00076db0: 2020 2020 2020 2020 206e 696f 202b 3d20           nio += 
+00076dc0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00076dd0: 2020 0a20 2020 2020 2020 2020 2020 206d    .            m
+00076de0: 696e 5f61 626e 203d 206d 696e 286d 696e  in_abn = min(min
+00076df0: 5f61 626e 2c74 722e 6162 6e29 0a20 2020  _abn,tr.abn).   
+00076e00: 2020 2020 2020 2020 206d 696e 5f67 766f           min_gvo
+00076e10: 6c20 3d20 6d69 6e28 6d69 6e5f 6776 6f6c  l = min(min_gvol
+00076e20: 2c74 722e 6776 6f6c 290a 2020 2020 2020  ,tr.gvol).      
+00076e30: 2020 2020 2020 6d69 6e5f 6973 6620 3d20        min_isf = 
+00076e40: 6d69 6e28 6d69 6e5f 6973 662c 7472 2e69  min(min_isf,tr.i
+00076e50: 736f 5f66 7261 6329 0a20 2020 2020 2020  so_frac).       
+00076e60: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
+00076e70: 2074 722e 7072 6566 6978 203d 3d20 2754   tr.prefix == 'T
+00076e80: 273a 206e 7469 202b 3d20 310a 2020 2020  ': nti += 1.    
+00076e90: 2020 2020 656c 7365 3a20 6e69 6920 2b3d      else: nii +=
+00076ea0: 2031 0a20 2020 2020 2020 2020 2020 200a   1.            .
+00076eb0: 2020 2020 6966 2076 6572 626f 7365 203d      if verbose =
+00076ec0: 3d20 5472 7565 203a 200a 2020 2020 2020  = True : .      
+00076ed0: 2020 7072 696e 7428 274e 756d 2e54 7273    print('Num.Trs
+00076ee0: 203d 2025 6920 2569 2028 2569 2920 2d3e   = %i %i (%i) ->
+00076ef0: 2025 692c 2025 6920 2825 6929 2720 2520   %i, %i (%i)' % 
+00076f00: 286e 7469 2c6e 6969 2c6e 7469 2b6e 6969  (nti,nii,nti+nii
+00076f10: 2c6e 746f 2c6e 696f 2c6e 746f 2b6e 696f  ,nto,nio,nto+nio
+00076f20: 2920 290a 2020 2020 2020 2020 7072 696e  ) ).        prin
+00076f30: 7428 274d 696e 2e41 626e 203d 2025 662c  t('Min.Abn = %f,
+00076f40: 204d 696e 2e49 736f 4672 6163 203d 2025   Min.IsoFrac = %
+00076f50: 662c 204d 696e 2e47 566f 6c20 3d20 2534  f, Min.GVol = %4
+00076f60: 2e31 6627 2025 2028 6d69 6e5f 6162 6e2c  .1f' % (min_abn,
+00076f70: 206d 696e 5f69 7366 2c20 6d69 6e5f 6776   min_isf, min_gv
+00076f80: 6f6c 2920 290a 2020 2020 2020 2020 0a20  ol) ).        . 
+00076f90: 2020 2020 2320 7265 7475 726e 2874 7273      # return(trs
+00076fa0: 5f6f 7574 2c20 6973 666d 5f6f 7574 290a  _out, isfm_out).
+00076fb0: 2020 2020 7265 7475 726e 2874 7273 5f6f      return(trs_o
+00076fc0: 7574 290a 0a0a 6465 6620 6765 745f 6669  ut)...def get_fi
+00076fd0: 6c65 5f6e 616d 6528 2070 6174 685f 6669  le_name( path_fi
+00076fe0: 6c65 5f6e 616d 6520 293a 0a0a 2020 2020  le_name ):..    
+00076ff0: 6669 6c65 5f6e 616d 6573 203d 2070 6174  file_names = pat
+00077000: 685f 6669 6c65 5f6e 616d 652e 7370 6c69  h_file_name.spli
+00077010: 7428 272f 2729 5b2d 315d 0a20 2020 2066  t('/')[-1].    f
+00077020: 6e73 203d 2066 696c 655f 6e61 6d65 732e  ns = file_names.
+00077030: 7370 6c69 7428 272e 2729 0a20 2020 2065  split('.').    e
+00077040: 7874 203d 2066 6e73 5b2d 315d 0a20 2020  xt = fns[-1].   
+00077050: 2066 6e73 203d 2066 6e73 5b3a 2d31 5d0a   fns = fns[:-1].
+00077060: 2020 2020 666e 616d 6520 3d20 2727 0a20      fname = ''. 
+00077070: 2020 2066 6f72 206b 2c20 666e 2069 6e20     for k, fn in 
+00077080: 656e 756d 6572 6174 6528 666e 7329 3a0a  enumerate(fns):.
+00077090: 2020 2020 2020 2020 6966 206b 203e 2030          if k > 0
+000770a0: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
+000770b0: 616d 6520 3d20 666e 616d 6520 2b20 272e  ame = fname + '.
+000770c0: 270a 2020 2020 2020 2020 666e 616d 6520  '.        fname 
+000770d0: 3d20 666e 616d 6520 2b20 666e 0a0a 2020  = fname + fn..  
+000770e0: 2020 7265 7475 726e 2066 6e61 6d65 2c20    return fname, 
+000770f0: 6578 740a 0a0a 6465 6620 6765 745f 7061  ext...def get_pa
+00077100: 7468 5f6e 616d 6528 2070 6174 685f 6669  th_name( path_fi
+00077110: 6c65 5f6e 616d 6520 293a 0a0a 2020 2020  le_name ):..    
+00077120: 666e 7320 3d20 7061 7468 5f66 696c 655f  fns = path_file_
+00077130: 6e61 6d65 2e73 706c 6974 2827 2e27 290a  name.split('.').
+00077140: 2020 2020 6578 7420 3d20 666e 735b 2d31      ext = fns[-1
+00077150: 5d0a 2020 2020 666e 7320 3d20 666e 735b  ].    fns = fns[
+00077160: 3a2d 315d 0a20 2020 2066 6e61 6d65 203d  :-1].    fname =
+00077170: 2027 270a 2020 2020 666f 7220 6b2c 2066   ''.    for k, f
+00077180: 6e20 696e 2065 6e75 6d65 7261 7465 2866  n in enumerate(f
+00077190: 6e73 293a 0a20 2020 2020 2020 2069 6620  ns):.        if 
+000771a0: 6b20 3e20 303a 0a20 2020 2020 2020 2020  k > 0:.         
+000771b0: 2020 2066 6e61 6d65 203d 2066 6e61 6d65     fname = fname
+000771c0: 202b 2027 2e27 0a20 2020 2020 2020 2066   + '.'.        f
+000771d0: 6e61 6d65 203d 2066 6e61 6d65 202b 2066  name = fname + f
+000771e0: 6e0a 0a20 2020 2072 6574 7572 6e20 666e  n..    return fn
+000771f0: 616d 652c 2065 7874 0a0a 0a64 6566 206d  ame, ext...def m
+00077200: 635f 636f 7265 5f67 6574 5f67 7466 5f61  c_core_get_gtf_a
+00077210: 6e64 5f66 6173 7461 5f70 6628 6764 293a  nd_fasta_pf(gd):
+00077220: 0a0a 2020 2020 6e65 203d 2030 0a20 2020  ..    ne = 0.   
+00077230: 2023 206e 7472 2c20 6e70 722c 206e 6520   # ntr, npr, ne 
+00077240: 3d20 6764 2e75 7064 6174 655f 7464 5f69  = gd.update_td_i
+00077250: 6e66 6f28 290a 2020 2020 6774 665f 6c69  nfo().    gtf_li
+00077260: 6e65 2c20 636e 203d 2067 642e 6765 745f  ne, cn = gd.get_
+00077270: 6774 665f 6c69 6e65 735f 6672 6f6d 5f65  gtf_lines_from_e
+00077280: 786f 6e73 2829 0a20 2020 206c 742c 206c  xons().    lt, l
+00077290: 7020 3d20 6764 2e67 6574 5f66 6173 7461  p = gd.get_fasta
+000772a0: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
+000772b0: 7328 7065 7074 6964 6520 3d20 4661 6c73  s(peptide = Fals
+000772c0: 6529 0a0a 2020 2020 2727 270a 2020 2020  e)..    '''.    
+000772d0: 6966 206c 656e 286c 7429 2021 3d20 6e74  if len(lt) != nt
+000772e0: 722a 323a 0a20 2020 2020 2020 2070 7269  r*2:.        pri
+000772f0: 6e74 2827 4552 524f 5220 696e 206d 635f  nt('ERROR in mc_
+00077300: 636f 7265 5f67 6574 5f67 7466 5f61 6e64  core_get_gtf_and
+00077310: 5f66 6173 7461 5f70 663a 2025 6920 213d  _fasta_pf: %i !=
+00077320: 2025 6920 2720 2520 286e 7472 2c20 6c65   %i ' % (ntr, le
+00077330: 6e28 6c74 292f 3229 2029 0a20 2020 2069  n(lt)/2) ).    i
+00077340: 6620 6c65 6e28 6c70 2920 213d 206e 7072  f len(lp) != npr
+00077350: 2a32 3a0a 2020 2020 2020 2020 7072 696e  *2:.        prin
+00077360: 7428 2745 5252 4f52 2069 6e20 6d63 5f63  t('ERROR in mc_c
+00077370: 6f72 655f 6765 745f 6774 665f 616e 645f  ore_get_gtf_and_
+00077380: 6661 7374 615f 7066 3a20 2569 2021 3d20  fasta_pf: %i != 
+00077390: 2569 2027 2025 2028 6e70 722c 206c 656e  %i ' % (npr, len
+000773a0: 286c 7029 2f32 2920 290a 2020 2020 2327  (lp)/2) ).    #'
+000773b0: 2727 0a20 2020 2072 6574 7572 6e20 6774  ''.    return gt
+000773c0: 665f 6c69 6e65 2c20 6c74 2c20 6c70 2c20  f_line, lt, lp, 
+000773d0: 6e65 2c20 636e 0a0a 0a64 6566 2053 7472  ne, cn...def Str
+000773e0: 696e 6746 6978 5f61 6e61 6c79 7369 7328  ingFix_analysis(
+000773f0: 7361 6d5f 6669 6c65 2c20 6774 6620 3d20  sam_file, gtf = 
+00077400: 4e6f 6e65 2c20 6765 6e6f 6d65 5f66 696c  None, genome_fil
+00077410: 6520 3d20 4e6f 6e65 2c20 7375 6666 6978  e = None, suffix
+00077420: 203d 204e 6f6e 652c 206a 756d 7020 3d20   = None, jump = 
+00077430: 302c 2073 6120 3d20 322c 2063 6279 6320  0, sa = 2, cbyc 
+00077440: 3d20 4661 6c73 652c 205c 0a20 2020 2020  = False, \.     
+00077450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077460: 2020 6e5f 636f 7265 7320 3d20 312c 206d    n_cores = 1, m
+00077470: 696e 5f66 7261 6773 5f70 6572 5f67 656e  in_frags_per_gen
+00077480: 6520 3d20 322c 206c 656e 5f74 6820 3d20  e = 2, len_th = 
+00077490: 4d49 4e5f 5452 5f4c 454e 4754 482c 206f  MIN_TR_LENGTH, o
+000774a0: 7574 5f74 7220 3d20 4661 6c73 652c 0a20  ut_tr = False,. 
+000774b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000774c0: 2020 2020 2020 7361 765f 7267 6e20 3d20        sav_rgn = 
+000774d0: 4661 6c73 652c 206f 7574 5f64 6972 203d  False, out_dir =
+000774e0: 204e 6f6e 6520 293a 0a20 2020 2027 2727   None ):.    '''
+000774f0: 0a20 2020 2069 6620 6774 6620 6973 204e  .    if gtf is N
+00077500: 6f6e 653a 0a20 2020 2020 2020 2070 7269  one:.        pri
+00077510: 6e74 2827 4552 524f 523a 204e 6f20 4754  nt('ERROR: No GT
+00077520: 462f 4746 4620 6669 6c65 2070 726f 7669  F/GFF file provi
+00077530: 6465 642e 2729 0a20 2020 2020 2020 2072  ded.').        r
+00077540: 6574 7572 6e0a 2020 2020 2327 2727 0a20  eturn.    #'''. 
+00077550: 2020 200a 2020 2020 6d65 7468 6f64 203d     .    method =
+00077560: 2027 6c61 7373 6f27 0a20 2020 204e 7265   'lasso'.    Nre
+00077570: 6320 3d20 300a 2020 2020 5374 6172 7420  c = 0.    Start 
+00077580: 3d20 300a 2020 2020 0a20 2020 2066 696c  = 0.    .    fil
+00077590: 655f 6e61 6d65 7320 3d20 7361 6d5f 6669  e_names = sam_fi
+000775a0: 6c65 2e73 706c 6974 2827 2f27 295b 2d31  le.split('/')[-1
+000775b0: 5d0a 2020 2020 666e 7320 3d20 6669 6c65  ].    fns = file
+000775c0: 5f6e 616d 6573 2e73 706c 6974 2827 2e27  _names.split('.'
+000775d0: 295b 3a2d 315d 0a20 2020 2066 6e61 6d65  )[:-1].    fname
+000775e0: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
+000775f0: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
+00077600: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
+00077610: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
+00077620: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
+00077630: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
+00077640: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
+00077650: 2066 6e0a 0a20 2020 2069 6620 6f75 745f   fn..    if out_
+00077660: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
+00077670: 0a20 2020 2020 2020 2069 6620 6f75 745f  .        if out_
+00077680: 6469 725b 2d31 5d20 3d3d 2027 2f27 3a0a  dir[-1] == '/':.
+00077690: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+000776a0: 6520 3d20 6f75 745f 6469 7220 2b20 666e  e = out_dir + fn
+000776b0: 616d 650a 2020 2020 2020 2020 656c 7365  ame.        else
+000776c0: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
+000776d0: 616d 6520 3d20 6f75 745f 6469 7220 2b20  ame = out_dir + 
+000776e0: 272f 2720 2b20 666e 616d 650a 0a20 2020  '/' + fname..   
+000776f0: 2069 6620 7375 6666 6978 2069 7320 6e6f   if suffix is no
+00077700: 7420 4e6f 6e65 3a20 2020 200a 2020 2020  t None:    .    
+00077710: 2020 2020 666e 616d 6520 3d20 666e 616d      fname = fnam
+00077720: 6520 2b20 275f 2720 2b20 7375 6666 6978  e + '_' + suffix
+00077730: 0a0a 2020 2020 6966 206a 756d 7020 3e20  ..    if jump > 
+00077740: 313a 2072 6574 7572 6e20 666e 616d 652c  1: return fname,
+00077750: 204e 6f6e 652c 204e 6f6e 650a 0a20 2020   None, None..   
+00077760: 204e 554d 5f43 4f52 4553 203d 206e 5f63   NUM_CORES = n_c
+00077770: 6f72 6573 0a20 2020 2073 7461 7274 5f74  ores.    start_t
+00077780: 696d 6531 203d 2074 696d 652e 7469 6d65  ime1 = time.time
+00077790: 2829 0a20 2020 2073 7461 7274 5f74 696d  ().    start_tim
+000777a0: 6532 203d 2074 696d 652e 7469 6d65 2829  e2 = time.time()
+000777b0: 0a20 2020 2069 6620 6a75 6d70 2532 203d  .    if jump%2 =
+000777c0: 3d20 303a 0a0a 2020 2020 2020 2020 4754  = 0:..        GT
+000777d0: 465f 6c73 7420 3d20 5b5d 0a20 2020 2020  F_lst = [].     
+000777e0: 2020 2072 676e 735f 6c73 745f 6d69 203d     rgns_lst_mi =
+000777f0: 205b 5d0a 2020 2020 2020 2020 7267 6e73   [].        rgns
+00077800: 5f6c 7374 5f6e 6420 3d20 5b5d 0a20 2020  _lst_nd = [].   
+00077810: 2020 2020 2072 676e 735f 6c73 745f 7374       rgns_lst_st
+00077820: 203d 205b 5d0a 0a20 2020 2020 2020 2063   = []..        c
+00077830: 6e74 203d 2030 0a20 2020 2020 2020 206d  nt = 0.        m
+00077840: 785f 6c65 6e20 3d20 3132 0a20 2020 2020  x_len = 12.     
+00077850: 2020 2065 725f 636f 6465 203d 2030 0a20     er_code = 0. 
+00077860: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00077870: 7072 696e 7428 2753 7472 696e 6746 6978  print('StringFix
+00077880: 2073 7461 7274 6564 2027 2c20 6461 7465   started ', date
+00077890: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
+000778a0: 7728 2929 0a20 2020 2020 2020 2073 6f20  w()).        so 
+000778b0: 3d20 7361 6d5f 6f62 6a28 7361 6d5f 6669  = sam_obj(sam_fi
+000778c0: 6c65 2c20 7361 203d 2073 6129 0a20 2020  le, sa = sa).   
+000778d0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
+000778e0: 206e 5f63 6f72 6573 203d 3d20 313a 206e   n_cores == 1: n
+000778f0: 756d 5f70 6172 616c 6c65 6c5f 6368 756e  um_parallel_chun
+00077900: 6b73 203d 2034 0a20 2020 2020 2020 2065  ks = 4.        e
+00077910: 6c73 653a 206e 756d 5f70 6172 616c 6c65  lse: num_paralle
+00077920: 6c5f 6368 756e 6b73 203d 204e 554d 5f50  l_chunks = NUM_P
+00077930: 4152 414c 4c45 4c5f 4348 554e 4b53 0a20  ARALLEL_CHUNKS. 
+00077940: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00077950: 625f 636e 7420 3d20 300a 2020 2020 2020  b_cnt = 0.      
+00077960: 2020 725f 6c73 745f 6f66 5f6c 7374 203d    r_lst_of_lst =
+00077970: 205b 5d0a 2020 2020 2020 2020 0a20 2020   [].        .   
+00077980: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
 00077990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000779a0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-000779b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000779c0: 206d 6564 5f66 7261 675f 6c65 6e20 3d20   med_frag_len = 
-000779d0: 300a 2020 2020 2020 2020 6966 2063 6279  0.        if cby
-000779e0: 633a 0a20 2020 2020 2020 2020 2020 200a  c:.            .
-000779f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00077a00: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
-00077a10: 6369 2026 2043 4d61 7420 2729 2023 202c  ci & CMat ') # ,
-00077a20: 2065 6e64 3d27 2729 0a20 2020 2020 2020   end='').       
-00077a30: 2020 2020 2063 6e74 5f63 203d 2030 0a20       cnt_c = 0. 
-00077a40: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-00077a50: 2054 7275 653a 0a0a 2020 2020 2020 2020   True:..        
-00077a60: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
-00077a70: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00077a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077a90: 2065 725f 636f 6465 2c20 7361 6d5f 6c73   er_code, sam_ls
-00077aa0: 742c 206e 756d 5f72 6561 6473 203d 2073  t, num_reads = s
-00077ab0: 6f2e 6765 745f 6f6e 655f 6f76 6572 6c61  o.get_one_overla
-00077ac0: 7065 645f 7361 6d28 290a 0a20 2020 2020  ped_sam()..     
-00077ad0: 2020 2020 2020 2020 2020 2069 6620 6572             if er
-00077ae0: 5f63 6f64 6520 3d3d 204e 4f54 5f53 4f52  _code == NOT_SOR
-00077af0: 5445 443a 0a20 2020 2020 2020 2020 2020  TED:.           
-00077b00: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00077b10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00077b20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00077b30: 2020 2020 2020 2020 2069 6620 625f 636e           if b_cn
-00077b40: 7420 3d3d 2030 3a20 725f 6c73 745f 6f66  t == 0: r_lst_of
-00077b50: 5f6c 7374 203d 205b 5d0a 2020 2020 2020  _lst = [].      
-00077b60: 2020 2020 2020 2020 2020 2020 2020 625f                b_
-00077b70: 636e 7420 2b3d 206c 656e 2873 616d 5f6c  cnt += len(sam_l
-00077b80: 7374 290a 0a20 2020 2020 2020 2020 2020  st)..           
-00077b90: 2020 2020 2020 2020 2073 616d 5f6c 7374           sam_lst
-00077ba0: 2e61 7070 656e 6428 7361 290a 2020 2020  .append(sa).    
-00077bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077bc0: 725f 6c73 745f 6f66 5f6c 7374 2e61 7070  r_lst_of_lst.app
-00077bd0: 656e 6428 2073 616d 5f6c 7374 2029 2023  end( sam_lst ) #
-00077be0: 2028 7361 6d5f 6c73 742c 2073 6129 2029   (sam_lst, sa) )
-00077bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077c00: 2020 2020 2023 2072 5f6c 7374 5f6f 665f       # r_lst_of_
-00077c10: 6c73 742e 6170 7065 6e64 2820 2873 616d  lst.append( (sam
-00077c20: 5f6c 7374 2c20 7361 2920 290a 0a20 2020  _lst, sa) )..   
-00077c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077c40: 2069 6620 6e5f 636f 7265 7320 3d3d 2031   if n_cores == 1
-00077c50: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-00077c60: 2020 2020 2020 2020 2020 2069 6620 2862             if (b
-00077c70: 5f63 6e74 203d 3d20 6e75 6d5f 7061 7261  _cnt == num_para
-00077c80: 6c6c 656c 5f63 6875 6e6b 7329 207c 2028  llel_chunks) | (
-00077c90: 6572 5f63 6f64 6520 3d3d 204e 4f5f 4d4f  er_code == NO_MO
-00077ca0: 5245 5f4c 494e 4529 3a20 625f 636e 7420  RE_LINE): b_cnt 
-00077cb0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00077cc0: 2020 2020 2020 2020 656c 7365 3a20 0a20          else: . 
-00077cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077ce0: 2020 2020 2020 2023 2069 6620 2865 725f         # if (er_
-00077cf0: 636f 6465 203d 3d20 4e45 575f 4348 524d  code == NEW_CHRM
-00077d00: 2920 7c20 2865 725f 636f 6465 203d 3d20  ) | (er_code == 
-00077d10: 4e4f 5f4d 4f52 455f 4c49 4e45 293a 2062  NO_MORE_LINE): b
-00077d20: 5f63 6e74 203d 2030 0a20 2020 2020 2020  _cnt = 0.       
-00077d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077d40: 2069 6620 2828 625f 636e 7420 3e20 6e75   if ((b_cnt > nu
-00077d50: 6d5f 7061 7261 6c6c 656c 5f63 6875 6e6b  m_parallel_chunk
-00077d60: 7329 2026 2028 6572 5f63 6f64 6520 3d3d  s) & (er_code ==
-00077d70: 204e 4557 5f43 4852 4d29 2920 7c20 2865   NEW_CHRM)) | (e
-00077d80: 725f 636f 6465 203d 3d20 4e4f 5f4d 4f52  r_code == NO_MOR
-00077d90: 455f 4c49 4e45 293a 2062 5f63 6e74 203d  E_LINE): b_cnt =
-00077da0: 2030 0a0a 2020 2020 2020 2020 2020 2020   0..            
-00077db0: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
-00077dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077dd0: 2069 6620 625f 636e 7420 3d3d 2030 3a0a   if b_cnt == 0:.
-00077de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077df0: 2020 2020 2020 2020 2074 6c65 6e20 3d20           tlen = 
-00077e00: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-00077e10: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-00077e20: 5f6c 7374 2069 6e20 725f 6c73 745f 6f66  _lst in r_lst_of
-00077e30: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
-00077e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077e50: 2020 666f 7220 736c 2069 6e20 725f 6c73    for sl in r_ls
-00077e60: 745b 3a2d 315d 3a0a 2020 2020 2020 2020  t[:-1]:.        
-00077e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077e80: 2020 2020 2020 2020 746c 656e 2e61 7070          tlen.app
-00077e90: 656e 6428 736c 2e74 6c65 6e29 0a20 2020  end(sl.tlen).   
-00077ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077eb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00077ec0: 6c65 6e28 746c 656e 2920 3e20 3130 3030  len(tlen) > 1000
-00077ed0: 3030 3a20 6272 6561 6b0a 2020 2020 2020  00: break.      
-00077ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077ef0: 2020 6d66 6c20 3d20 6e70 2e6d 6564 6961    mfl = np.media
-00077f00: 6e28 746c 656e 290a 2020 2020 2020 2020  n(tlen).        
-00077f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f20: 6d65 645f 6672 6167 5f6c 656e 202b 3d20  med_frag_len += 
-00077f30: 6d66 6c20 0a0a 2020 2020 2020 2020 2020  mfl ..          
-00077f40: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00077f50: 206e 5f63 6f72 6573 203d 3d20 313a 0a20   n_cores == 1:. 
-00077f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f70: 2020 2020 2020 2020 2020 2023 2063 6872             # chr
-00077f80: 5f6e 616d 6520 3d20 7361 6d5f 6c73 745b  _name = sam_lst[
-00077f90: 305d 2e72 6e61 6d65 0a20 2020 2020 2020  0].rname.       
-00077fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077fb0: 2020 2020 2063 6872 5f6c 7374 203d 205b       chr_lst = [
-00077fc0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00077fd0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00077fe0: 725f 6e61 6d65 203d 2027 270a 2020 2020  r_name = ''.    
-00077ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078000: 2020 2020 2020 2020 666f 7220 725f 6c73          for r_ls
-00078010: 7420 696e 2072 5f6c 7374 5f6f 665f 6c73  t in r_lst_of_ls
-00078020: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00078030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078040: 2020 2069 6620 725f 6c73 745b 305d 2e72     if r_lst[0].r
-00078050: 6e61 6d65 206e 6f74 2069 6e20 6368 725f  name not in chr_
-00078060: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
-00078070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078080: 2020 2020 2020 2020 2063 6872 5f6c 7374           chr_lst
-00078090: 2e61 7070 656e 6428 725f 6c73 745b 305d  .append(r_lst[0]
-000780a0: 2e72 6e61 6d65 290a 2020 2020 2020 2020  .rname).        
-000780b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000780c0: 2020 2020 2020 2020 2020 2020 6368 725f              chr_
-000780d0: 6e61 6d65 203d 2063 6872 5f6e 616d 6520  name = chr_name 
-000780e0: 2b20 2725 7320 2720 2520 2872 5f6c 7374  + '%s ' % (r_lst
-000780f0: 5b30 5d2e 726e 616d 6529 0a20 2020 2020  [0].rname).     
-00078100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078110: 2020 2020 2020 2069 6620 6c65 6e28 6368         if len(ch
-00078120: 725f 6e61 6d65 2920 3e20 3530 3a20 0a20  r_name) > 50: . 
-00078130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078140: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00078150: 6620 2863 6e74 5f63 203d 3d20 3029 2026  f (cnt_c == 0) &
-00078160: 2028 6572 5f63 6f64 6520 3d3d 204e 4f5f   (er_code == NO_
-00078170: 4d4f 5245 5f4c 494e 4529 3a20 6368 725f  MORE_LINE): chr_
-00078180: 6e61 6d65 203d 2027 2027 0a20 2020 2020  name = ' '.     
-00078190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000781a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000781b0: 2063 6872 5f6e 616d 6520 3d20 276f 7468   chr_name = 'oth
-000781c0: 6572 7327 0a20 2020 2020 2020 2020 2020  ers'.           
-000781d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000781e0: 2072 5f6d 695f 6c73 742c 2072 5f6e 645f   r_mi_lst, r_nd_
-000781f0: 6c73 742c 2072 5f73 745f 6c73 7420 3d20  lst, r_st_lst = 
-00078200: 6275 696c 645f 636f 6e74 6967 7328 725f  build_contigs(r_
-00078210: 6c73 745f 6f66 5f6c 7374 2c20 6368 725f  lst_of_lst, chr_
-00078220: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00078230: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00078240: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00078250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078260: 6368 725f 6e61 6d65 203d 2027 270a 2020  chr_name = ''.  
-00078270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078280: 2020 2020 2020 2020 2020 2320 6966 2028            # if (
-00078290: 636e 745f 6320 3e20 3029 207c 2028 6572  cnt_c > 0) | (er
-000782a0: 5f63 6f64 6520 213d 204e 4f5f 4d4f 5245  _code != NO_MORE
-000782b0: 5f4c 494e 4529 3a0a 2020 2020 2020 2020  _LINE):.        
-000782c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000782d0: 2020 2020 6368 725f 6c73 7420 3d20 5b5d      chr_lst = []
-000782e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000782f0: 2020 2020 2020 2020 2020 2020 2063 6872               chr
-00078300: 5f6e 616d 6520 3d20 2727 0a20 2020 2020  _name = ''.     
-00078310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078320: 2020 2020 2020 2066 6f72 2072 5f6c 7374         for r_lst
-00078330: 2069 6e20 725f 6c73 745f 6f66 5f6c 7374   in r_lst_of_lst
-00078340: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000779a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000779b0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+000779c0: 2020 2020 2020 0a20 2020 2020 2020 206d        .        m
+000779d0: 6564 5f66 7261 675f 6c65 6e20 3d20 300a  ed_frag_len = 0.
+000779e0: 2020 2020 2020 2020 6966 2063 6279 633a          if cbyc:
+000779f0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00077a00: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00077a10: 275c 7242 7569 6c64 696e 6720 6c6f 6369  '\rBuilding loci
+00077a20: 2026 2043 4d61 7420 2729 2023 202c 2065   & CMat ') # , e
+00077a30: 6e64 3d27 2729 0a20 2020 2020 2020 2020  nd='').         
+00077a40: 2020 2063 6e74 5f63 203d 2030 0a20 2020     cnt_c = 0.   
+00077a50: 2020 2020 2020 2020 2077 6869 6c65 2054           while T
+00077a60: 7275 653a 0a0a 2020 2020 2020 2020 2020  rue:..          
+00077a70: 2020 2020 2020 7374 6172 745f 7469 6d65        start_time
+00077a80: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
+00077a90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00077aa0: 725f 636f 6465 2c20 7361 6d5f 6c73 742c  r_code, sam_lst,
+00077ab0: 206e 756d 5f72 6561 6473 203d 2073 6f2e   num_reads = so.
+00077ac0: 6765 745f 6f6e 655f 6f76 6572 6c61 7065  get_one_overlape
+00077ad0: 645f 7361 6d28 290a 0a20 2020 2020 2020  d_sam()..       
+00077ae0: 2020 2020 2020 2020 2069 6620 6572 5f63           if er_c
+00077af0: 6f64 6520 3d3d 204e 4f54 5f53 4f52 5445  ode == NOT_SORTE
+00077b00: 443a 0a20 2020 2020 2020 2020 2020 2020  D:.             
+00077b10: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00077b20: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00077b30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00077b40: 2020 2020 2020 2069 6620 625f 636e 7420         if b_cnt 
+00077b50: 3d3d 2030 3a20 725f 6c73 745f 6f66 5f6c  == 0: r_lst_of_l
+00077b60: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+00077b70: 2020 2020 2020 2020 2020 2020 625f 636e              b_cn
+00077b80: 7420 2b3d 206c 656e 2873 616d 5f6c 7374  t += len(sam_lst
+00077b90: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00077ba0: 2020 2020 2020 2073 616d 5f6c 7374 2e61         sam_lst.a
+00077bb0: 7070 656e 6428 7361 290a 2020 2020 2020  ppend(sa).      
+00077bc0: 2020 2020 2020 2020 2020 2020 2020 725f                r_
+00077bd0: 6c73 745f 6f66 5f6c 7374 2e61 7070 656e  lst_of_lst.appen
+00077be0: 6428 2073 616d 5f6c 7374 2029 2023 2028  d( sam_lst ) # (
+00077bf0: 7361 6d5f 6c73 742c 2073 6129 2029 0a20  sam_lst, sa) ). 
+00077c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077c10: 2020 2023 2072 5f6c 7374 5f6f 665f 6c73     # r_lst_of_ls
+00077c20: 742e 6170 7065 6e64 2820 2873 616d 5f6c  t.append( (sam_l
+00077c30: 7374 2c20 7361 2920 290a 0a20 2020 2020  st, sa) )..     
+00077c40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00077c50: 6620 6e5f 636f 7265 7320 3d3d 2031 3a20  f n_cores == 1: 
+00077c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00077c70: 2020 2020 2020 2020 2069 6620 2862 5f63           if (b_c
+00077c80: 6e74 203d 3d20 6e75 6d5f 7061 7261 6c6c  nt == num_parall
+00077c90: 656c 5f63 6875 6e6b 7329 207c 2028 6572  el_chunks) | (er
+00077ca0: 5f63 6f64 6520 3d3d 204e 4f5f 4d4f 5245  _code == NO_MORE
+00077cb0: 5f4c 494e 4529 3a20 625f 636e 7420 3d20  _LINE): b_cnt = 
+00077cc0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+00077cd0: 2020 2020 2020 656c 7365 3a20 0a20 2020        else: .   
+00077ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077cf0: 2020 2020 2023 2069 6620 2865 725f 636f       # if (er_co
+00077d00: 6465 203d 3d20 4e45 575f 4348 524d 2920  de == NEW_CHRM) 
+00077d10: 7c20 2865 725f 636f 6465 203d 3d20 4e4f  | (er_code == NO
+00077d20: 5f4d 4f52 455f 4c49 4e45 293a 2062 5f63  _MORE_LINE): b_c
+00077d30: 6e74 203d 2030 0a20 2020 2020 2020 2020  nt = 0.         
+00077d40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00077d50: 6620 2828 625f 636e 7420 3e20 6e75 6d5f  f ((b_cnt > num_
+00077d60: 7061 7261 6c6c 656c 5f63 6875 6e6b 7329  parallel_chunks)
+00077d70: 2026 2028 6572 5f63 6f64 6520 3d3d 204e   & (er_code == N
+00077d80: 4557 5f43 4852 4d29 2920 7c20 2865 725f  EW_CHRM)) | (er_
+00077d90: 636f 6465 203d 3d20 4e4f 5f4d 4f52 455f  code == NO_MORE_
+00077da0: 4c49 4e45 293a 2062 5f63 6e74 203d 2030  LINE): b_cnt = 0
+00077db0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00077dc0: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
+00077dd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00077de0: 6620 625f 636e 7420 3d3d 2030 3a0a 0a20  f b_cnt == 0:.. 
+00077df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e00: 2020 2020 2020 2074 6c65 6e20 3d20 5b5d         tlen = []
+00077e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00077e20: 2020 2020 2020 2020 2066 6f72 2072 5f6c           for r_l
+00077e30: 7374 2069 6e20 725f 6c73 745f 6f66 5f6c  st in r_lst_of_l
+00077e40: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00077e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e60: 666f 7220 736c 2069 6e20 725f 6c73 745b  for sl in r_lst[
+00077e70: 3a2d 315d 3a0a 2020 2020 2020 2020 2020  :-1]:.          
+00077e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e90: 2020 2020 2020 746c 656e 2e61 7070 656e        tlen.appen
+00077ea0: 6428 736c 2e74 6c65 6e29 0a20 2020 2020  d(sl.tlen).     
+00077eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077ec0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00077ed0: 6e28 746c 656e 2920 3e20 3130 3030 3030  n(tlen) > 100000
+00077ee0: 3a20 6272 6561 6b0a 2020 2020 2020 2020  : break.        
+00077ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077f00: 6d66 6c20 3d20 6e70 2e6d 6564 6961 6e28  mfl = np.median(
+00077f10: 746c 656e 290a 2020 2020 2020 2020 2020  tlen).          
+00077f20: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00077f30: 645f 6672 6167 5f6c 656e 202b 3d20 6d66  d_frag_len += mf
+00077f40: 6c20 0a0a 2020 2020 2020 2020 2020 2020  l ..            
+00077f50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00077f60: 5f63 6f72 6573 203d 3d20 313a 0a20 2020  _cores == 1:.   
+00077f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077f80: 2020 2020 2020 2020 2023 2063 6872 5f6e           # chr_n
+00077f90: 616d 6520 3d20 7361 6d5f 6c73 745b 305d  ame = sam_lst[0]
+00077fa0: 2e72 6e61 6d65 0a20 2020 2020 2020 2020  .rname.         
+00077fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077fc0: 2020 2063 6872 5f6c 7374 203d 205b 5d0a     chr_lst = [].
+00077fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077fe0: 2020 2020 2020 2020 2020 2020 6368 725f              chr_
+00077ff0: 6e61 6d65 203d 2027 270a 2020 2020 2020  name = ''.      
+00078000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078010: 2020 2020 2020 666f 7220 725f 6c73 7420        for r_lst 
+00078020: 696e 2072 5f6c 7374 5f6f 665f 6c73 743a  in r_lst_of_lst:
+00078030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078050: 2069 6620 725f 6c73 745b 305d 2e72 6e61   if r_lst[0].rna
+00078060: 6d65 206e 6f74 2069 6e20 6368 725f 6c73  me not in chr_ls
+00078070: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00078080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078090: 2020 2020 2020 2063 6872 5f6c 7374 2e61         chr_lst.a
+000780a0: 7070 656e 6428 725f 6c73 745b 305d 2e72  ppend(r_lst[0].r
+000780b0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+000780c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000780d0: 2020 2020 2020 2020 2020 6368 725f 6e61            chr_na
+000780e0: 6d65 203d 2063 6872 5f6e 616d 6520 2b20  me = chr_name + 
+000780f0: 2725 7320 2720 2520 2872 5f6c 7374 5b30  '%s ' % (r_lst[0
+00078100: 5d2e 726e 616d 6529 0a20 2020 2020 2020  ].rname).       
+00078110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078120: 2020 2020 2069 6620 6c65 6e28 6368 725f       if len(chr_
+00078130: 6e61 6d65 2920 3e20 3530 3a20 0a20 2020  name) > 50: .   
+00078140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078150: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00078160: 2863 6e74 5f63 203d 3d20 3029 2026 2028  (cnt_c == 0) & (
+00078170: 6572 5f63 6f64 6520 3d3d 204e 4f5f 4d4f  er_code == NO_MO
+00078180: 5245 5f4c 494e 4529 3a20 6368 725f 6e61  RE_LINE): chr_na
+00078190: 6d65 203d 2027 2027 0a20 2020 2020 2020  me = ' '.       
+000781a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000781b0: 2020 2020 2020 2020 2065 6c73 653a 2063           else: c
+000781c0: 6872 5f6e 616d 6520 3d20 276f 7468 6572  hr_name = 'other
+000781d0: 7327 0a20 2020 2020 2020 2020 2020 2020  s'.             
+000781e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000781f0: 5f6d 695f 6c73 742c 2072 5f6e 645f 6c73  _mi_lst, r_nd_ls
+00078200: 742c 2072 5f73 745f 6c73 7420 3d20 6275  t, r_st_lst = bu
+00078210: 696c 645f 636f 6e74 6967 7328 725f 6c73  ild_contigs(r_ls
+00078220: 745f 6f66 5f6c 7374 2c20 6368 725f 6e61  t_of_lst, chr_na
+00078230: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00078240: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00078250: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00078260: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00078270: 725f 6e61 6d65 203d 2027 270a 2020 2020  r_name = ''.    
+00078280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078290: 2020 2020 2020 2020 2320 6966 2028 636e          # if (cn
+000782a0: 745f 6320 3e20 3029 207c 2028 6572 5f63  t_c > 0) | (er_c
+000782b0: 6f64 6520 213d 204e 4f5f 4d4f 5245 5f4c  ode != NO_MORE_L
+000782c0: 494e 4529 3a0a 2020 2020 2020 2020 2020  INE):.          
+000782d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000782e0: 2020 6368 725f 6c73 7420 3d20 5b5d 0a20    chr_lst = []. 
+000782f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078300: 2020 2020 2020 2020 2020 2063 6872 5f6e             chr_n
+00078310: 616d 6520 3d20 2727 0a20 2020 2020 2020  ame = ''.       
+00078320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078330: 2020 2020 2066 6f72 2072 5f6c 7374 2069       for r_lst i
+00078340: 6e20 725f 6c73 745f 6f66 5f6c 7374 3a0a  n r_lst_of_lst:.
 00078350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078360: 2020 6966 2072 5f6c 7374 5b30 5d2e 726e    if r_lst[0].rn
-00078370: 616d 6520 6e6f 7420 696e 2063 6872 5f6c  ame not in chr_l
-00078380: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00078390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000783a0: 2020 2020 2020 2020 6368 725f 6c73 742e          chr_lst.
-000783b0: 6170 7065 6e64 2872 5f6c 7374 5b30 5d2e  append(r_lst[0].
-000783c0: 726e 616d 6529 0a20 2020 2020 2020 2020  rname).         
-000783d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000783e0: 2020 2020 2020 2020 2020 2063 6872 5f6e             chr_n
-000783f0: 616d 6520 3d20 6368 725f 6e61 6d65 202b  ame = chr_name +
-00078400: 2027 2573 2027 2025 2028 725f 6c73 745b   '%s ' % (r_lst[
-00078410: 305d 2e72 6e61 6d65 290a 2020 2020 2020  0].rname).      
-00078420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078430: 2020 2020 2020 6966 206c 656e 2863 6872        if len(chr
-00078440: 5f6e 616d 6529 203e 2035 303a 200a 2020  _name) > 50: .  
-00078450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078460: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00078470: 2028 636e 745f 6320 3d3d 2030 2920 2620   (cnt_c == 0) & 
-00078480: 2865 725f 636f 6465 203d 3d20 4e4f 5f4d  (er_code == NO_M
-00078490: 4f52 455f 4c49 4e45 293a 2063 6872 5f6e  ORE_LINE): chr_n
-000784a0: 616d 6520 3d20 2720 270a 2020 2020 2020  ame = ' '.      
-000784b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000784c0: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-000784d0: 6368 725f 6e61 6d65 203d 2027 6f74 6865  chr_name = 'othe
-000784e0: 7273 270a 2020 2020 2020 2020 2020 2020  rs'.            
-000784f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078500: 2320 6966 2063 6e74 5f63 203d 3d20 303a  # if cnt_c == 0:
-00078510: 2070 7269 6e74 2827 2027 290a 0a20 2020   print(' ')..   
-00078520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078530: 2020 2020 2020 2020 2073 7461 7274 5f74           start_t
-00078540: 696d 6533 203d 2074 696d 652e 7469 6d65  ime3 = time.time
-00078550: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00078560: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00078570: 5f6d 695f 6c73 742c 2072 5f6e 645f 6c73  _mi_lst, r_nd_ls
-00078580: 742c 2072 5f73 745f 6c73 7420 3d20 6275  t, r_st_lst = bu
-00078590: 696c 645f 636f 6e74 6967 735f 6d63 2872  ild_contigs_mc(r
-000785a0: 5f6c 7374 5f6f 665f 6c73 742c 206e 5f63  _lst_of_lst, n_c
-000785b0: 6f72 6573 2c20 6368 725f 6e61 6d65 290a  ores, chr_name).
-000785c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000785d0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-000785e0: 6620 2863 6e74 5f63 203e 2030 2920 7c20  f (cnt_c > 0) | 
-000785f0: 2865 725f 636f 6465 2021 3d20 4e4f 5f4d  (er_code != NO_M
-00078600: 4f52 455f 4c49 4e45 293a 0a20 2020 2020  ORE_LINE):.     
-00078610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078620: 2020 2020 2020 2065 6c61 7073 6564 5f74         elapsed_t
-00078630: 696d 6533 203d 2074 696d 652e 7469 6d65  ime3 = time.time
-00078640: 2829 202d 2073 7461 7274 5f74 696d 6533  () - start_time3
-00078650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00078660: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00078670: 6e74 2827 5c72 2720 2b20 2720 272a 3130  nt('\r' + ' '*10
-00078680: 302c 2065 6e64 3d27 272c 2066 6c75 7368  0, end='', flush
-00078690: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-000786a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000786b0: 2020 2020 2070 7269 6e74 2827 5c72 2020       print('\r  
-000786c0: 2070 726f 6365 7373 696e 6720 2573 2e2e   processing %s..
-000786d0: 2e20 646f 6e65 2e20 2825 6929 2028 2569  . done. (%i) (%i
-000786e0: 722c 2025 6963 2c20 2569 2927 205c 0a20  r, %ic, %i)' \. 
-000786f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078370: 6966 2072 5f6c 7374 5b30 5d2e 726e 616d  if r_lst[0].rnam
+00078380: 6520 6e6f 7420 696e 2063 6872 5f6c 7374  e not in chr_lst
+00078390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000783a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000783b0: 2020 2020 2020 6368 725f 6c73 742e 6170        chr_lst.ap
+000783c0: 7065 6e64 2872 5f6c 7374 5b30 5d2e 726e  pend(r_lst[0].rn
+000783d0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+000783e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000783f0: 2020 2020 2020 2020 2063 6872 5f6e 616d           chr_nam
+00078400: 6520 3d20 6368 725f 6e61 6d65 202b 2027  e = chr_name + '
+00078410: 2573 2027 2025 2028 725f 6c73 745b 305d  %s ' % (r_lst[0]
+00078420: 2e72 6e61 6d65 290a 2020 2020 2020 2020  .rname).        
+00078430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078440: 2020 2020 6966 206c 656e 2863 6872 5f6e      if len(chr_n
+00078450: 616d 6529 203e 2035 303a 200a 2020 2020  ame) > 50: .    
+00078460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078470: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00078480: 636e 745f 6320 3d3d 2030 2920 2620 2865  cnt_c == 0) & (e
+00078490: 725f 636f 6465 203d 3d20 4e4f 5f4d 4f52  r_code == NO_MOR
+000784a0: 455f 4c49 4e45 293a 2063 6872 5f6e 616d  E_LINE): chr_nam
+000784b0: 6520 3d20 2720 270a 2020 2020 2020 2020  e = ' '.        
+000784c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000784d0: 2020 2020 2020 2020 656c 7365 3a20 6368          else: ch
+000784e0: 725f 6e61 6d65 203d 2027 6f74 6865 7273  r_name = 'others
+000784f0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00078500: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00078510: 6966 2063 6e74 5f63 203d 3d20 303a 2070  if cnt_c == 0: p
+00078520: 7269 6e74 2827 2027 290a 0a20 2020 2020  rint(' ')..     
+00078530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078540: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
+00078550: 6533 203d 2074 696d 652e 7469 6d65 2829  e3 = time.time()
+00078560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078570: 2020 2020 2020 2020 2020 2020 2072 5f6d               r_m
+00078580: 695f 6c73 742c 2072 5f6e 645f 6c73 742c  i_lst, r_nd_lst,
+00078590: 2072 5f73 745f 6c73 7420 3d20 6275 696c   r_st_lst = buil
+000785a0: 645f 636f 6e74 6967 735f 6d63 2872 5f6c  d_contigs_mc(r_l
+000785b0: 7374 5f6f 665f 6c73 742c 206e 5f63 6f72  st_of_lst, n_cor
+000785c0: 6573 2c20 6368 725f 6e61 6d65 290a 0a20  es, chr_name).. 
+000785d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000785e0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+000785f0: 2863 6e74 5f63 203e 2030 2920 7c20 2865  (cnt_c > 0) | (e
+00078600: 725f 636f 6465 2021 3d20 4e4f 5f4d 4f52  r_code != NO_MOR
+00078610: 455f 4c49 4e45 293a 0a20 2020 2020 2020  E_LINE):.       
+00078620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078630: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
+00078640: 6533 203d 2074 696d 652e 7469 6d65 2829  e3 = time.time()
+00078650: 202d 2073 7461 7274 5f74 696d 6533 0a20   - start_time3. 
+00078660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078670: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00078680: 2827 5c72 2720 2b20 2720 272a 3130 302c  ('\r' + ' '*100,
+00078690: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
+000786a0: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
+000786b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000786c0: 2020 2070 7269 6e74 2827 5c72 2020 2070     print('\r   p
+000786d0: 726f 6365 7373 696e 6720 2573 2e2e 2e20  rocessing %s... 
+000786e0: 646f 6e65 2e20 2825 6929 2028 2569 722c  done. (%i) (%ir,
+000786f0: 2025 6963 2c20 2569 2927 205c 0a20 2020   %ic, %i)' \.   
 00078700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078710: 2025 2028 6368 725f 6e61 6d65 2c20 656c   % (chr_name, el
-00078720: 6170 7365 645f 7469 6d65 332c 2069 6e74  apsed_time3, int
-00078730: 2873 6f2e 6e75 6d5f 7265 6164 7329 2c20  (so.num_reads), 
-00078740: 6c65 6e28 725f 6c73 745f 6f66 5f6c 7374  len(r_lst_of_lst
-00078750: 292c 206d 666c 292c 2066 6c75 7368 203d  ), mfl), flush =
-00078760: 2054 7275 6529 2023 2c20 656e 643d 2727   True) #, end=''
-00078770: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00078780: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
-00078790: 6c73 745f 6d69 203d 2072 676e 735f 6c73  lst_mi = rgns_ls
-000787a0: 745f 6d69 202b 2072 5f6d 695f 6c73 740a  t_mi + r_mi_lst.
-000787b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000787c0: 2020 2020 2020 2020 7267 6e73 5f6c 7374          rgns_lst
-000787d0: 5f6e 6420 3d20 7267 6e73 5f6c 7374 5f6e  _nd = rgns_lst_n
-000787e0: 6420 2b20 725f 6e64 5f6c 7374 0a20 2020  d + r_nd_lst.   
-000787f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078800: 2020 2020 2072 676e 735f 6c73 745f 7374       rgns_lst_st
-00078810: 203d 2072 676e 735f 6c73 745f 7374 202b   = rgns_lst_st +
-00078820: 2072 5f73 745f 6c73 740a 2020 2020 2020   r_st_lst.      
-00078830: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-00078840: 2020 2020 2020 2020 2020 2069 6620 6572             if er
-00078850: 5f63 6f64 6520 3d3d 204e 4f5f 4d4f 5245  _code == NO_MORE
-00078860: 5f4c 494e 453a 2062 7265 616b 0a20 2020  _LINE: break.   
-00078870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078880: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00078890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000788a0: 2020 2020 2020 2063 6e74 5f63 202b 3d20         cnt_c += 
-000788b0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000788c0: 2020 2020 2020 2327 2727 0a0a 2020 2020        #'''..    
-000788d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000788e0: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
-000788f0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00078900: 6620 636e 745f 6320 3e20 303a 0a20 2020  f cnt_c > 0:.   
-00078910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078920: 2069 6620 636e 7425 3130 3020 3d3d 2030   if cnt%100 == 0
-00078930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00078940: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00078950: 275c 7227 202b 2027 2027 2a31 3030 2c20  '\r' + ' '*100, 
-00078960: 656e 643d 2727 2c20 666c 7573 6820 3d20  end='', flush = 
-00078970: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00078980: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00078990: 696e 7428 275c 7220 2020 6c6f 6164 696e  int('\r   loadin
-000789a0: 6720 2825 6972 2c20 2569 632c 2025 7329  g (%ir, %ic, %s)
-000789b0: 2027 205c 0a20 2020 2020 2020 2020 2020   ' \.           
-000789c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000789d0: 2020 2025 2028 696e 7428 736f 2e6e 756d     % (int(so.num
-000789e0: 5f72 6561 6473 292c 2063 6e74 2c20 7361  _reads), cnt, sa
-000789f0: 6d5f 6c73 745b 305d 2e72 6e61 6d65 292c  m_lst[0].rname),
-00078a00: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
-00078a10: 2054 7275 6529 0a0a 2020 2020 2020 2020   True)..        
-00078a20: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00078a30: 725f 636f 6465 203d 3d20 4e4f 5f4d 4f52  r_code == NO_MOR
-00078a40: 455f 4c49 4e45 3a20 6272 6561 6b0a 0a20  E_LINE: break.. 
-00078a50: 2020 2020 2020 2020 2020 206d 6564 5f66             med_f
-00078a60: 7261 675f 6c65 6e20 3d20 6e70 2e69 6e74  rag_len = np.int
-00078a70: 286d 6564 5f66 7261 675f 6c65 6e2f 2863  (med_frag_len/(c
-00078a80: 6e74 5f63 2b31 2929 0a0a 2020 2020 2020  nt_c+1))..      
-00078a90: 2020 2020 2020 656c 6170 7365 645f 7469        elapsed_ti
-00078aa0: 6d65 3120 3d20 7469 6d65 2e74 696d 6528  me1 = time.time(
-00078ab0: 2920 2d20 7374 6172 745f 7469 6d65 320a  ) - start_time2.
-00078ac0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00078ad0: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
-00078ae0: 6369 2026 2043 4d61 7420 2e2e 2e20 646f  ci & CMat ... do
-00078af0: 6e65 2028 2569 292e 2028 2569 722c 2025  ne (%i). (%ir, %
-00078b00: 6963 2c20 2569 2920 2720 5c0a 2020 2020  ic, %i) ' \.    
-00078b10: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-00078b20: 2869 6e74 2865 6c61 7073 6564 5f74 696d  (int(elapsed_tim
-00078b30: 6531 292c 2069 6e74 2873 6f2e 6e75 6d5f  e1), int(so.num_
-00078b40: 7265 6164 7329 2c20 636e 742c 206d 6564  reads), cnt, med
-00078b50: 5f66 7261 675f 6c65 6e29 2029 0a0a 2020  _frag_len) )..  
-00078b60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00078b70: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00078b80: 2070 7269 6e74 2827 5c72 4c6f 6164 696e   print('\rLoadin
-00078b90: 6720 5341 4d20 6c69 6e65 7320 2e2e 2e2e  g SAM lines ....
-00078ba0: 2e2e 2020 272c 2065 6e64 3d27 2729 2020  ..  ', end='')  
-00078bb0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00078bc0: 2020 2077 6869 6c65 2054 7275 653a 0a0a     while True:..
-00078bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078be0: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
-00078bf0: 652e 7469 6d65 2829 0a20 2020 2020 2020  e.time().       
-00078c00: 2020 2020 2020 2020 2065 725f 636f 6465           er_code
-00078c10: 2c20 7361 6d5f 6c73 742c 206e 756d 5f72  , sam_lst, num_r
-00078c20: 6561 6473 203d 2073 6f2e 6765 745f 6f6e  eads = so.get_on
-00078c30: 655f 6f76 6572 6c61 7065 645f 7361 6d28  e_overlaped_sam(
-00078c40: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00078c50: 2020 2069 6620 6572 5f63 6f64 6520 3d3d     if er_code ==
-00078c60: 204e 4f54 5f53 4f52 5445 443a 0a20 2020   NOT_SORTED:.   
-00078c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078c80: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00078c90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00078ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078cb0: 2073 616d 5f6c 7374 2e61 7070 656e 6428   sam_lst.append(
-00078cc0: 7361 290a 2020 2020 2020 2020 2020 2020  sa).            
-00078cd0: 2020 2020 2020 2020 725f 6c73 745f 6f66          r_lst_of
-00078ce0: 5f6c 7374 2e61 7070 656e 6428 2073 616d  _lst.append( sam
-00078cf0: 5f6c 7374 2029 2023 2028 7361 6d5f 6c73  _lst ) # (sam_ls
-00078d00: 742c 2073 6129 2029 0a20 2020 2020 2020  t, sa) ).       
-00078d10: 2020 2020 2020 2020 2020 2020 2023 2072               # r
-00078d20: 5f6c 7374 5f6f 665f 6c73 742e 6170 7065  _lst_of_lst.appe
-00078d30: 6e64 2820 2873 616d 5f6c 7374 2c20 7361  nd( (sam_lst, sa
-00078d40: 2920 290a 0a20 2020 2020 2020 2020 2020  ) )..           
-00078d50: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
-00078d60: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00078d70: 2020 2020 2020 6966 2063 6e74 2531 3030        if cnt%100
-00078d80: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00078d90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00078da0: 7269 6e74 2827 5c72 2720 2b20 2720 272a  rint('\r' + ' '*
-00078db0: 3130 302c 2065 6e64 3d27 272c 2066 6c75  100, end='', flu
-00078dc0: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
-00078dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078de0: 2020 2070 7269 6e74 2827 5c72 4c6f 6164     print('\rLoad
-00078df0: 696e 6720 5341 4d20 6c69 6e65 7320 2e2e  ing SAM lines ..
-00078e00: 2e2e 2e2e 2028 2569 722c 2025 6963 2920  .... (%ir, %ic) 
-00078e10: 2720 2520 2869 6e74 2873 6f2e 6e75 6d5f  ' % (int(so.num_
-00078e20: 7265 6164 7329 2c20 636e 7429 2c20 656e  reads), cnt), en
-00078e30: 643d 2727 2c20 666c 7573 6820 3d20 5472  d='', flush = Tr
-00078e40: 7565 290a 0a20 2020 2020 2020 2020 2020  ue)..           
-00078e50: 2020 2020 2020 2020 2069 6620 6572 5f63           if er_c
-00078e60: 6f64 6520 3d3d 204e 4f5f 4d4f 5245 5f4c  ode == NO_MORE_L
-00078e70: 494e 453a 2062 7265 616b 0a0a 2020 2020  INE: break..    
-00078e80: 2020 2020 2020 2020 746c 656e 203d 205b          tlen = [
-00078e90: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-00078ea0: 7220 725f 6c73 7420 696e 2072 5f6c 7374  r r_lst in r_lst
-00078eb0: 5f6f 665f 6c73 743a 0a20 2020 2020 2020  _of_lst:.       
-00078ec0: 2020 2020 2020 2020 2066 6f72 2073 6c20           for sl 
-00078ed0: 696e 2072 5f6c 7374 5b3a 2d31 5d3a 0a20  in r_lst[:-1]:. 
-00078ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078ef0: 2020 2074 6c65 6e2e 6170 7065 6e64 2873     tlen.append(s
-00078f00: 6c2e 746c 656e 290a 2020 2020 2020 2020  l.tlen).        
-00078f10: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00078f20: 656e 2874 6c65 6e29 203e 2031 3030 3030  en(tlen) > 10000
-00078f30: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00078f40: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00078f50: 0a20 2020 2020 2020 2020 2020 206d 6564  .            med
-00078f60: 5f66 7261 675f 6c65 6e20 3d20 6e70 2e6d  _frag_len = np.m
-00078f70: 6564 6961 6e28 746c 656e 290a 0a20 2020  edian(tlen)..   
-00078f80: 2020 2020 2020 2020 2023 2727 270a 2020           #'''.  
-00078f90: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
-00078fa0: 645f 7469 6d65 3120 3d20 7469 6d65 2e74  d_time1 = time.t
-00078fb0: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
-00078fc0: 6d65 310a 2020 2020 2020 2020 2020 2020  me1.            
-00078fd0: 7072 696e 7428 275c 7227 202b 2027 2027  print('\r' + ' '
-00078fe0: 2a31 3030 2c20 656e 643d 2727 2c20 666c  *100, end='', fl
-00078ff0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-00079000: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-00079010: 724c 6f61 6469 6e67 2053 414d 206c 696e  rLoading SAM lin
-00079020: 6573 202e 2e2e 2e2e 2e20 646f 6e65 2028  es ...... done (
-00079030: 2569 292e 2028 2569 722c 2025 6963 2920  %i). (%ir, %ic) 
-00079040: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-00079050: 2020 2020 2020 2520 2869 6e74 2865 6c61        % (int(ela
-00079060: 7073 6564 5f74 696d 6531 292c 2069 6e74  psed_time1), int
-00079070: 2873 6f2e 6e75 6d5f 7265 6164 7329 2c20  (so.num_reads), 
-00079080: 636e 7429 2c20 666c 7573 6820 3d20 5472  cnt), flush = Tr
-00079090: 7565 2029 0a20 2020 2020 2020 2020 2020  ue ).           
-000790a0: 2073 7461 7274 5f74 696d 6532 203d 2074   start_time2 = t
-000790b0: 696d 652e 7469 6d65 2829 0a0a 2020 2020  ime.time()..    
-000790c0: 2020 2020 2020 2020 6966 206e 5f63 6f72          if n_cor
-000790d0: 6573 203d 3d20 313a 0a20 2020 2020 2020  es == 1:.       
-000790e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000790f0: 4275 696c 6469 6e67 206c 6f63 6920 2620  Building loci & 
-00079100: 434d 6174 202e 2e2e 2027 2c20 656e 643d  CMat ... ', end=
-00079110: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
-00079120: 2020 2020 725f 6d69 5f6c 7374 2c20 725f      r_mi_lst, r_
-00079130: 6e64 5f6c 7374 2c20 725f 7374 5f6c 7374  nd_lst, r_st_lst
-00079140: 203d 2062 7569 6c64 5f63 6f6e 7469 6773   = build_contigs
-00079150: 2872 5f6c 7374 5f6f 665f 6c73 7429 0a20  (r_lst_of_lst). 
-00079160: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00079170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00079180: 2070 7269 6e74 2827 4275 696c 6469 6e67   print('Building
-00079190: 206c 6f63 6920 2620 434d 6174 202e 2e2e   loci & CMat ...
-000791a0: 2027 2c20 656e 643d 2727 290a 2020 2020   ', end='').    
-000791b0: 2020 2020 2020 2020 2020 2020 725f 6d69              r_mi
-000791c0: 5f6c 7374 2c20 725f 6e64 5f6c 7374 2c20  _lst, r_nd_lst, 
-000791d0: 725f 7374 5f6c 7374 203d 2062 7569 6c64  r_st_lst = build
-000791e0: 5f63 6f6e 7469 6773 5f6d 6328 725f 6c73  _contigs_mc(r_ls
-000791f0: 745f 6f66 5f6c 7374 2c20 6e5f 636f 7265  t_of_lst, n_core
-00079200: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-00079210: 7267 6e73 5f6c 7374 5f6d 6920 3d20 7267  rgns_lst_mi = rg
-00079220: 6e73 5f6c 7374 5f6d 6920 2b20 725f 6d69  ns_lst_mi + r_mi
-00079230: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
-00079240: 2072 676e 735f 6c73 745f 6e64 203d 2072   rgns_lst_nd = r
-00079250: 676e 735f 6c73 745f 6e64 202b 2072 5f6e  gns_lst_nd + r_n
-00079260: 645f 6c73 740a 2020 2020 2020 2020 2020  d_lst.          
-00079270: 2020 7267 6e73 5f6c 7374 5f73 7420 3d20    rgns_lst_st = 
-00079280: 7267 6e73 5f6c 7374 5f73 7420 2b20 725f  rgns_lst_st + r_
-00079290: 7374 5f6c 7374 0a20 2020 2020 2020 2020  st_lst.         
-000792a0: 2020 2023 2727 2720 0a20 2020 2020 2020     #''' .       
-000792b0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-000792c0: 2065 6c61 7073 6564 5f74 696d 6531 203d   elapsed_time1 =
-000792d0: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
-000792e0: 7461 7274 5f74 696d 6532 0a20 2020 2020  tart_time2.     
-000792f0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-00079300: 4275 696c 6469 6e67 206c 6f63 6920 2620  Building loci & 
-00079310: 434d 6174 202e 2e2e 2064 6f6e 6520 2825  CMat ... done (%
-00079320: 6929 2e20 2569 722c 2025 6963 2c20 6d65  i). %ir, %ic, me
-00079330: 642e 6672 6167 2e6c 656e 203d 2025 6920  d.frag.len = %i 
-00079340: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-00079350: 2020 2020 2020 2520 2869 6e74 2865 6c61        % (int(ela
-00079360: 7073 6564 5f74 696d 6531 292c 2069 6e74  psed_time1), int
-00079370: 2873 6f2e 6e75 6d5f 7265 6164 7329 2c20  (so.num_reads), 
-00079380: 636e 742c 206d 6564 5f66 7261 675f 6c65  cnt, med_frag_le
-00079390: 6e29 2029 0a20 2020 2020 2020 2020 2020  n) ).           
-000793a0: 200a 2020 2020 2020 2020 2323 2323 2323   .        ######
-000793b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00078710: 2020 2020 2020 2020 2020 2020 2020 2025                 %
+00078720: 2028 6368 725f 6e61 6d65 2c20 656c 6170   (chr_name, elap
+00078730: 7365 645f 7469 6d65 332c 2069 6e74 2873  sed_time3, int(s
+00078740: 6f2e 6e75 6d5f 7265 6164 7329 2c20 6c65  o.num_reads), le
+00078750: 6e28 725f 6c73 745f 6f66 5f6c 7374 292c  n(r_lst_of_lst),
+00078760: 206d 666c 292c 2066 6c75 7368 203d 2054   mfl), flush = T
+00078770: 7275 6529 2023 2c20 656e 643d 2727 290a  rue) #, end='').
+00078780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078790: 2020 2020 2020 2020 2072 676e 735f 6c73           rgns_ls
+000787a0: 745f 6d69 203d 2072 676e 735f 6c73 745f  t_mi = rgns_lst_
+000787b0: 6d69 202b 2072 5f6d 695f 6c73 740a 2020  mi + r_mi_lst.  
+000787c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000787d0: 2020 2020 2020 7267 6e73 5f6c 7374 5f6e        rgns_lst_n
+000787e0: 6420 3d20 7267 6e73 5f6c 7374 5f6e 6420  d = rgns_lst_nd 
+000787f0: 2b20 725f 6e64 5f6c 7374 0a20 2020 2020  + r_nd_lst.     
+00078800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078810: 2020 2072 676e 735f 6c73 745f 7374 203d     rgns_lst_st =
+00078820: 2072 676e 735f 6c73 745f 7374 202b 2072   rgns_lst_st + r
+00078830: 5f73 745f 6c73 740a 2020 2020 2020 2020  _st_lst.        
+00078840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078850: 2020 2020 2020 2020 2069 6620 6572 5f63           if er_c
+00078860: 6f64 6520 3d3d 204e 4f5f 4d4f 5245 5f4c  ode == NO_MORE_L
+00078870: 494e 453a 2062 7265 616b 0a20 2020 2020  INE: break.     
+00078880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078890: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000788a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000788b0: 2020 2020 2063 6e74 5f63 202b 3d20 310a       cnt_c += 1.
+000788c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000788d0: 2020 2020 2327 2727 0a0a 2020 2020 2020      #'''..      
+000788e0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+000788f0: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
+00078900: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+00078910: 636e 745f 6320 3e20 303a 0a20 2020 2020  cnt_c > 0:.     
+00078920: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00078930: 6620 636e 7425 3130 3020 3d3d 2030 3a0a  f cnt%100 == 0:.
+00078940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078950: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
+00078960: 7227 202b 2027 2027 2a31 3030 2c20 656e  r' + ' '*100, en
+00078970: 643d 2727 2c20 666c 7573 6820 3d20 5472  d='', flush = Tr
+00078980: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00078990: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000789a0: 7428 275c 7220 2020 6c6f 6164 696e 6720  t('\r   loading 
+000789b0: 2825 6972 2c20 2569 632c 2025 7329 2027  (%ir, %ic, %s) '
+000789c0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+000789d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000789e0: 2025 2028 696e 7428 736f 2e6e 756d 5f72   % (int(so.num_r
+000789f0: 6561 6473 292c 2063 6e74 2c20 7361 6d5f  eads), cnt, sam_
+00078a00: 6c73 745b 305d 2e72 6e61 6d65 292c 2065  lst[0].rname), e
+00078a10: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
+00078a20: 7275 6529 0a0a 2020 2020 2020 2020 2020  rue)..          
+00078a30: 2020 2020 2020 2020 2020 6966 2065 725f            if er_
+00078a40: 636f 6465 203d 3d20 4e4f 5f4d 4f52 455f  code == NO_MORE_
+00078a50: 4c49 4e45 3a20 6272 6561 6b0a 0a20 2020  LINE: break..   
+00078a60: 2020 2020 2020 2020 206d 6564 5f66 7261           med_fra
+00078a70: 675f 6c65 6e20 3d20 6e70 2e69 6e74 286d  g_len = np.int(m
+00078a80: 6564 5f66 7261 675f 6c65 6e2f 2863 6e74  ed_frag_len/(cnt
+00078a90: 5f63 2b31 2929 0a0a 2020 2020 2020 2020  _c+1))..        
+00078aa0: 2020 2020 656c 6170 7365 645f 7469 6d65      elapsed_time
+00078ab0: 3120 3d20 7469 6d65 2e74 696d 6528 2920  1 = time.time() 
+00078ac0: 2d20 7374 6172 745f 7469 6d65 320a 2020  - start_time2.  
+00078ad0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00078ae0: 275c 7242 7569 6c64 696e 6720 6c6f 6369  '\rBuilding loci
+00078af0: 2026 2043 4d61 7420 2e2e 2e20 646f 6e65   & CMat ... done
+00078b00: 2028 2569 292e 2028 2569 722c 2025 6963   (%i). (%ir, %ic
+00078b10: 2c20 2569 2920 2720 5c0a 2020 2020 2020  , %i) ' \.      
+00078b20: 2020 2020 2020 2020 2020 2020 2520 2869              % (i
+00078b30: 6e74 2865 6c61 7073 6564 5f74 696d 6531  nt(elapsed_time1
+00078b40: 292c 2069 6e74 2873 6f2e 6e75 6d5f 7265  ), int(so.num_re
+00078b50: 6164 7329 2c20 636e 742c 206d 6564 5f66  ads), cnt, med_f
+00078b60: 7261 675f 6c65 6e29 2029 0a0a 2020 2020  rag_len) )..    
+00078b70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00078b80: 2020 0a20 2020 2020 2020 2020 2020 2070    .            p
+00078b90: 7269 6e74 2827 5c72 4c6f 6164 696e 6720  rint('\rLoading 
+00078ba0: 5341 4d20 6c69 6e65 7320 2e2e 2e2e 2e2e  SAM lines ......
+00078bb0: 2020 272c 2065 6e64 3d27 2729 2020 2020    ', end='')    
+00078bc0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00078bd0: 2077 6869 6c65 2054 7275 653a 0a0a 2020   while True:..  
+00078be0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00078bf0: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
+00078c00: 7469 6d65 2829 0a20 2020 2020 2020 2020  time().         
+00078c10: 2020 2020 2020 2065 725f 636f 6465 2c20         er_code, 
+00078c20: 7361 6d5f 6c73 742c 206e 756d 5f72 6561  sam_lst, num_rea
+00078c30: 6473 203d 2073 6f2e 6765 745f 6f6e 655f  ds = so.get_one_
+00078c40: 6f76 6572 6c61 7065 645f 7361 6d28 290a  overlaped_sam().
+00078c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078c60: 2069 6620 6572 5f63 6f64 6520 3d3d 204e   if er_code == N
+00078c70: 4f54 5f53 4f52 5445 443a 0a20 2020 2020  OT_SORTED:.     
+00078c80: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00078c90: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00078ca0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00078cb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00078cc0: 616d 5f6c 7374 2e61 7070 656e 6428 7361  am_lst.append(sa
+00078cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00078ce0: 2020 2020 2020 725f 6c73 745f 6f66 5f6c        r_lst_of_l
+00078cf0: 7374 2e61 7070 656e 6428 2073 616d 5f6c  st.append( sam_l
+00078d00: 7374 2029 2023 2028 7361 6d5f 6c73 742c  st ) # (sam_lst,
+00078d10: 2073 6129 2029 0a20 2020 2020 2020 2020   sa) ).         
+00078d20: 2020 2020 2020 2020 2020 2023 2072 5f6c             # r_l
+00078d30: 7374 5f6f 665f 6c73 742e 6170 7065 6e64  st_of_lst.append
+00078d40: 2820 2873 616d 5f6c 7374 2c20 7361 2920  ( (sam_lst, sa) 
+00078d50: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00078d60: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
+00078d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078d80: 2020 2020 6966 2063 6e74 2531 3030 203d      if cnt%100 =
+00078d90: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00078da0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00078db0: 6e74 2827 5c72 2720 2b20 2720 272a 3130  nt('\r' + ' '*10
+00078dc0: 302c 2065 6e64 3d27 272c 2066 6c75 7368  0, end='', flush
+00078dd0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+00078de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078df0: 2070 7269 6e74 2827 5c72 4c6f 6164 696e   print('\rLoadin
+00078e00: 6720 5341 4d20 6c69 6e65 7320 2e2e 2e2e  g SAM lines ....
+00078e10: 2e2e 2028 2569 722c 2025 6963 2920 2720  .. (%ir, %ic) ' 
+00078e20: 2520 2869 6e74 2873 6f2e 6e75 6d5f 7265  % (int(so.num_re
+00078e30: 6164 7329 2c20 636e 7429 2c20 656e 643d  ads), cnt), end=
+00078e40: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
+00078e50: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00078e60: 2020 2020 2020 2069 6620 6572 5f63 6f64         if er_cod
+00078e70: 6520 3d3d 204e 4f5f 4d4f 5245 5f4c 494e  e == NO_MORE_LIN
+00078e80: 453a 2062 7265 616b 0a0a 2020 2020 2020  E: break..      
+00078e90: 2020 2020 2020 746c 656e 203d 205b 5d0a        tlen = [].
+00078ea0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00078eb0: 725f 6c73 7420 696e 2072 5f6c 7374 5f6f  r_lst in r_lst_o
+00078ec0: 665f 6c73 743a 0a20 2020 2020 2020 2020  f_lst:.         
+00078ed0: 2020 2020 2020 2066 6f72 2073 6c20 696e         for sl in
+00078ee0: 2072 5f6c 7374 5b3a 2d31 5d3a 0a20 2020   r_lst[:-1]:.   
+00078ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078f00: 2074 6c65 6e2e 6170 7065 6e64 2873 6c2e   tlen.append(sl.
+00078f10: 746c 656e 290a 2020 2020 2020 2020 2020  tlen).          
+00078f20: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00078f30: 2874 6c65 6e29 203e 2031 3030 3030 303a  (tlen) > 100000:
+00078f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078f50: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00078f60: 2020 2020 2020 2020 2020 206d 6564 5f66             med_f
+00078f70: 7261 675f 6c65 6e20 3d20 6e70 2e6d 6564  rag_len = np.med
+00078f80: 6961 6e28 746c 656e 290a 0a20 2020 2020  ian(tlen)..     
+00078f90: 2020 2020 2020 2023 2727 270a 2020 2020         #'''.    
+00078fa0: 2020 2020 2020 2020 656c 6170 7365 645f          elapsed_
+00078fb0: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
+00078fc0: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
+00078fd0: 310a 2020 2020 2020 2020 2020 2020 7072  1.            pr
+00078fe0: 696e 7428 275c 7227 202b 2027 2027 2a31  int('\r' + ' '*1
+00078ff0: 3030 2c20 656e 643d 2727 2c20 666c 7573  00, end='', flus
+00079000: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
+00079010: 2020 2020 2020 7072 696e 7428 275c 724c        print('\rL
+00079020: 6f61 6469 6e67 2053 414d 206c 696e 6573  oading SAM lines
+00079030: 202e 2e2e 2e2e 2e20 646f 6e65 2028 2569   ...... done (%i
+00079040: 292e 2028 2569 722c 2025 6963 2920 2720  ). (%ir, %ic) ' 
+00079050: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00079060: 2020 2020 2520 2869 6e74 2865 6c61 7073      % (int(elaps
+00079070: 6564 5f74 696d 6531 292c 2069 6e74 2873  ed_time1), int(s
+00079080: 6f2e 6e75 6d5f 7265 6164 7329 2c20 636e  o.num_reads), cn
+00079090: 7429 2c20 666c 7573 6820 3d20 5472 7565  t), flush = True
+000790a0: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+000790b0: 7461 7274 5f74 696d 6532 203d 2074 696d  tart_time2 = tim
+000790c0: 652e 7469 6d65 2829 0a0a 2020 2020 2020  e.time()..      
+000790d0: 2020 2020 2020 6966 206e 5f63 6f72 6573        if n_cores
+000790e0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+000790f0: 2020 2020 2020 2070 7269 6e74 2827 4275         print('Bu
+00079100: 696c 6469 6e67 206c 6f63 6920 2620 434d  ilding loci & CM
+00079110: 6174 202e 2e2e 2027 2c20 656e 643d 2727  at ... ', end=''
+00079120: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00079130: 2020 725f 6d69 5f6c 7374 2c20 725f 6e64    r_mi_lst, r_nd
+00079140: 5f6c 7374 2c20 725f 7374 5f6c 7374 203d  _lst, r_st_lst =
+00079150: 2062 7569 6c64 5f63 6f6e 7469 6773 2872   build_contigs(r
+00079160: 5f6c 7374 5f6f 665f 6c73 7429 0a20 2020  _lst_of_lst).   
+00079170: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00079180: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00079190: 7269 6e74 2827 4275 696c 6469 6e67 206c  rint('Building l
+000791a0: 6f63 6920 2620 434d 6174 202e 2e2e 2027  oci & CMat ... '
+000791b0: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
+000791c0: 2020 2020 2020 2020 2020 725f 6d69 5f6c            r_mi_l
+000791d0: 7374 2c20 725f 6e64 5f6c 7374 2c20 725f  st, r_nd_lst, r_
+000791e0: 7374 5f6c 7374 203d 2062 7569 6c64 5f63  st_lst = build_c
+000791f0: 6f6e 7469 6773 5f6d 6328 725f 6c73 745f  ontigs_mc(r_lst_
+00079200: 6f66 5f6c 7374 2c20 6e5f 636f 7265 7329  of_lst, n_cores)
+00079210: 0a0a 2020 2020 2020 2020 2020 2020 7267  ..            rg
+00079220: 6e73 5f6c 7374 5f6d 6920 3d20 7267 6e73  ns_lst_mi = rgns
+00079230: 5f6c 7374 5f6d 6920 2b20 725f 6d69 5f6c  _lst_mi + r_mi_l
+00079240: 7374 0a20 2020 2020 2020 2020 2020 2072  st.            r
+00079250: 676e 735f 6c73 745f 6e64 203d 2072 676e  gns_lst_nd = rgn
+00079260: 735f 6c73 745f 6e64 202b 2072 5f6e 645f  s_lst_nd + r_nd_
+00079270: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
+00079280: 7267 6e73 5f6c 7374 5f73 7420 3d20 7267  rgns_lst_st = rg
+00079290: 6e73 5f6c 7374 5f73 7420 2b20 725f 7374  ns_lst_st + r_st
+000792a0: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+000792b0: 2023 2727 2720 0a20 2020 2020 2020 2020   #''' .         
+000792c0: 2020 0a20 2020 2020 2020 2020 2020 2065    .            e
+000792d0: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
+000792e0: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
+000792f0: 7274 5f74 696d 6532 0a20 2020 2020 2020  rt_time2.       
+00079300: 2020 2020 2070 7269 6e74 2827 5c72 4275       print('\rBu
+00079310: 696c 6469 6e67 206c 6f63 6920 2620 434d  ilding loci & CM
+00079320: 6174 202e 2e2e 2064 6f6e 6520 2825 6929  at ... done (%i)
+00079330: 2e20 2569 722c 2025 6963 2c20 6d65 642e  . %ir, %ic, med.
+00079340: 6672 6167 2e6c 656e 203d 2025 6920 2720  frag.len = %i ' 
+00079350: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00079360: 2020 2020 2520 2869 6e74 2865 6c61 7073      % (int(elaps
+00079370: 6564 5f74 696d 6531 292c 2069 6e74 2873  ed_time1), int(s
+00079380: 6f2e 6e75 6d5f 7265 6164 7329 2c20 636e  o.num_reads), cn
+00079390: 742c 206d 6564 5f66 7261 675f 6c65 6e29  t, med_frag_len)
+000793a0: 2029 0a20 2020 2020 2020 2020 2020 200a   ).            .
+000793b0: 2020 2020 2020 2020 2323 2323 2323 2323          ########
 000793c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000793d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000793e0: 2323 0a20 2020 2020 2020 200a 2020 2020  ##.        .    
-000793f0: 2020 2020 6465 6c20 725f 6c73 745f 6f66      del r_lst_of
-00079400: 5f6c 7374 0a20 2020 2020 2020 2027 2727  _lst.        '''
-00079410: 0a20 2020 2020 2020 2063 6e74 5f69 203d  .        cnt_i =
-00079420: 2030 0a20 2020 2020 2020 2063 6e74 5f73   0.        cnt_s
-00079430: 203d 2030 0a20 2020 2020 2020 2063 6e74   = 0.        cnt
-00079440: 5f74 203d 2030 0a20 2020 2020 2020 2066  _t = 0.        f
-00079450: 6f72 2072 676e 7320 696e 2072 676e 735f  or rgns in rgns_
-00079460: 6c73 745f 7374 3a20 0a20 2020 2020 2020  lst_st: .       
-00079470: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
-00079480: 6e73 2e72 676e 733a 0a20 2020 2020 2020  ns.rgns:.       
-00079490: 2020 2020 2020 2020 2069 6620 722e 7479           if r.ty
-000794a0: 7065 203d 3d20 2749 273a 2063 6e74 5f69  pe == 'I': cnt_i
-000794b0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-000794c0: 2020 2020 2020 656c 6966 2072 2e74 7970        elif r.typ
-000794d0: 6520 3d3d 2027 5327 3a20 636e 745f 7320  e == 'S': cnt_s 
-000794e0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-000794f0: 2020 2020 2065 6c69 6620 722e 7479 7065       elif r.type
-00079500: 203d 3d20 2754 273a 2063 6e74 5f74 202b   == 'T': cnt_t +
-00079510: 3d20 310a 2020 2020 2020 2020 7072 696e  = 1.        prin
-00079520: 7428 2027 436e 7420 492f 532f 5420 3d20  t( 'Cnt I/S/T = 
-00079530: 2569 2c20 2569 2c20 2569 2027 2025 2028  %i, %i, %i ' % (
-00079540: 636e 745f 692c 2063 6e74 5f73 2c20 636e  cnt_i, cnt_s, cn
-00079550: 745f 7429 2029 0a20 2020 2020 2020 2027  t_t) ).        '
-00079560: 2727 2020 2020 2020 2020 2020 2020 2020  ''              
+000793e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000793f0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00079400: 2020 6465 6c20 725f 6c73 745f 6f66 5f6c    del r_lst_of_l
+00079410: 7374 0a20 2020 2020 2020 2027 2727 0a20  st.        '''. 
+00079420: 2020 2020 2020 2063 6e74 5f69 203d 2030         cnt_i = 0
+00079430: 0a20 2020 2020 2020 2063 6e74 5f73 203d  .        cnt_s =
+00079440: 2030 0a20 2020 2020 2020 2063 6e74 5f74   0.        cnt_t
+00079450: 203d 2030 0a20 2020 2020 2020 2066 6f72   = 0.        for
+00079460: 2072 676e 7320 696e 2072 676e 735f 6c73   rgns in rgns_ls
+00079470: 745f 7374 3a20 0a20 2020 2020 2020 2020  t_st: .         
+00079480: 2020 2066 6f72 2072 2069 6e20 7267 6e73     for r in rgns
+00079490: 2e72 676e 733a 0a20 2020 2020 2020 2020  .rgns:.         
+000794a0: 2020 2020 2020 2069 6620 722e 7479 7065         if r.type
+000794b0: 203d 3d20 2749 273a 2063 6e74 5f69 202b   == 'I': cnt_i +
+000794c0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+000794d0: 2020 2020 656c 6966 2072 2e74 7970 6520      elif r.type 
+000794e0: 3d3d 2027 5327 3a20 636e 745f 7320 2b3d  == 'S': cnt_s +=
+000794f0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00079500: 2020 2065 6c69 6620 722e 7479 7065 203d     elif r.type =
+00079510: 3d20 2754 273a 2063 6e74 5f74 202b 3d20  = 'T': cnt_t += 
+00079520: 310a 2020 2020 2020 2020 7072 696e 7428  1.        print(
+00079530: 2027 436e 7420 492f 532f 5420 3d20 2569   'Cnt I/S/T = %i
+00079540: 2c20 2569 2c20 2569 2027 2025 2028 636e  , %i, %i ' % (cn
+00079550: 745f 692c 2063 6e74 5f73 2c20 636e 745f  t_i, cnt_s, cnt_
+00079560: 7429 2029 0a20 2020 2020 2020 2027 2727  t) ).        '''
 00079570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00079580: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00079590: 2020 2066 6f72 2072 2069 6e20 7267 6e73     for r in rgns
-000795a0: 5f6c 7374 5f6d 693a 2072 2e73 6574 5f63  _lst_mi: r.set_c
-000795b0: 7667 2829 0a20 2020 2020 2020 2066 6f72  vg().        for
-000795c0: 2072 2069 6e20 7267 6e73 5f6c 7374 5f6e   r in rgns_lst_n
-000795d0: 643a 2072 2e73 6574 5f63 7667 2829 0a20  d: r.set_cvg(). 
-000795e0: 2020 2020 2020 2066 6f72 2072 2069 6e20         for r in 
-000795f0: 7267 6e73 5f6c 7374 5f73 743a 2072 2e73  rgns_lst_st: r.s
-00079600: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
-00079610: 2020 2020 200a 2020 2020 2020 2020 736f       .        so
-00079620: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-00079630: 206e 5f72 6561 6473 2c20 6e5f 6261 7365   n_reads, n_base
-00079640: 732c 2072 645f 6c65 6e20 3d20 736f 2e6e  s, rd_len = so.n
-00079650: 756d 5f72 6561 6473 2c20 736f 2e6e 756d  um_reads, so.num
-00079660: 5f62 6173 6573 2c20 736f 2e72 6561 645f  _bases, so.read_
-00079670: 6c65 6e0a 2020 2020 2020 2020 7264 5f6c  len.        rd_l
-00079680: 656e 203d 2073 6f2e 7265 6164 5f6c 656e  en = so.read_len
-00079690: 0a20 2020 2020 2020 2065 6c61 7073 6564  .        elapsed
-000796a0: 5f74 696d 6531 203d 2074 696d 652e 7469  _time1 = time.ti
-000796b0: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
-000796c0: 6532 0a0a 2020 2020 2020 2020 2327 2727  e2..        #'''
-000796d0: 0a20 2020 2020 2020 2069 6620 7361 765f  .        if sav_
-000796e0: 7267 6e3a 0a20 2020 2020 2020 2020 2020  rgn:.           
-000796f0: 2070 7269 6e74 2827 5361 7669 6e67 206c   print('Saving l
-00079700: 6f63 6920 2620 636f 6e73 656e 7375 7320  oci & consensus 
-00079710: 6d61 7472 6963 6573 202e 2e2e 2e2e 272c  matrices .....',
-00079720: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
-00079730: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
-00079740: 2020 2073 6176 655f 7267 6e73 5f6f 626a     save_rgns_obj
-00079750: 2866 6e61 6d65 202b 2027 2e72 676e 7327  (fname + '.rgns'
-00079760: 2c20 7267 6e73 5f6c 7374 5f6d 692c 2072  , rgns_lst_mi, r
-00079770: 676e 735f 6c73 745f 6e64 2c20 7267 6e73  gns_lst_nd, rgns
-00079780: 5f6c 7374 5f73 742c 2073 6f2e 7265 6164  _lst_st, so.read
-00079790: 5f6c 656e 2c20 736f 2e6e 756d 5f72 6561  _len, so.num_rea
-000797a0: 6473 2c20 6d65 645f 6672 6167 5f6c 656e  ds, med_frag_len
-000797b0: 2029 0a20 2020 2020 2020 2020 2020 2070   ).            p
-000797c0: 7269 6e74 2827 2064 6f6e 6527 290a 0a20  rint(' done').. 
-000797d0: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
-000797e0: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
-000797f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00079800: 7361 7665 5f72 676e 7328 2066 6e61 6d65  save_rgns( fname
-00079810: 202b 2027 5f72 676e 735f 6d69 5f25 692e   + '_rgns_mi_%i.
-00079820: 7478 7427 2025 2073 612c 2072 676e 735f  txt' % sa, rgns_
-00079830: 6c73 745f 6d69 2c20 736f 2e72 6561 645f  lst_mi, so.read_
-00079840: 6c65 6e2c 2073 6f2e 6e75 6d5f 7265 6164  len, so.num_read
-00079850: 7320 290a 2020 2020 2020 2020 7072 696e  s ).        prin
-00079860: 7428 272e 272c 2065 6e64 3d27 2729 0a20  t('.', end=''). 
-00079870: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00079880: 2020 2023 2073 6176 655f 7267 6e73 2820     # save_rgns( 
-00079890: 666e 616d 6520 2b20 275f 7267 6e73 5f6e  fname + '_rgns_n
-000798a0: 645f 2569 2e74 7874 2720 2520 7361 2c20  d_%i.txt' % sa, 
-000798b0: 7267 6e73 5f6c 7374 5f6e 642c 2073 6f2e  rgns_lst_nd, so.
-000798c0: 7265 6164 5f6c 656e 2c20 736f 2e6e 756d  read_len, so.num
-000798d0: 5f72 6561 6473 2029 0a20 2020 2020 2020  _reads ).       
-000798e0: 2023 2070 7269 6e74 2827 2e27 2c20 656e   # print('.', en
-000798f0: 643d 2727 290a 2020 2020 2020 2020 2320  d='').        # 
-00079900: 7361 7665 5f72 676e 7328 2066 6e61 6d65  save_rgns( fname
-00079910: 202b 2027 5f72 676e 735f 695f 2569 5f68   + '_rgns_i_%i_h
-00079920: 6f2e 7478 7427 2025 2073 612c 2072 676e  o.txt' % sa, rgn
-00079930: 735f 6c73 745f 7374 2c20 736f 2e72 6561  s_lst_st, so.rea
-00079940: 645f 6c65 6e2c 2073 6f2e 6e75 6d5f 7265  d_len, so.num_re
-00079950: 6164 732c 2068 6f20 3d20 5472 7565 2029  ads, ho = True )
-00079960: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
-00079970: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
-00079980: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
-00079990: 2073 6176 655f 7267 6e73 2820 666e 616d   save_rgns( fnam
-000799a0: 6520 2b20 275f 7267 6e73 5f6d 5f25 695f  e + '_rgns_m_%i_
-000799b0: 686f 2e74 7874 2720 2520 7361 2c20 7267  ho.txt' % sa, rg
-000799c0: 6e73 5f6c 7374 5f6d 692c 2073 6f2e 7265  ns_lst_mi, so.re
-000799d0: 6164 5f6c 656e 2c20 736f 2e6e 756d 5f72  ad_len, so.num_r
-000799e0: 6561 6473 2c20 686f 203d 2054 7275 6520  eads, ho = True 
-000799f0: 290a 2020 2020 2020 2020 2320 7072 696e  ).        # prin
-00079a00: 7428 272e 272c 2065 6e64 3d27 2729 0a20  t('.', end=''). 
-00079a10: 2020 2020 2020 2023 2067 7466 5f6c 696e         # gtf_lin
-00079a20: 655f 6c73 7420 3d20 6765 745f 6774 665f  e_lst = get_gtf_
-00079a30: 6c69 6e65 7328 2072 676e 735f 6c73 745f  lines( rgns_lst_
-00079a40: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 6420  mi, rgns_lst_nd 
-00079a50: 290a 2020 2020 2020 2020 2320 7361 7665  ).        # save
-00079a60: 5f67 7466 2820 666e 616d 652b 275f 7265  _gtf( fname+'_re
-00079a70: 6769 6f6e 732e 6774 6627 2c20 6774 665f  gions.gtf', gtf_
-00079a80: 6c69 6e65 5f6c 7374 2029 0a20 2020 2020  line_lst ).     
-00079a90: 2020 2023 2070 7269 6e74 2827 2064 6f6e     # print(' don
-00079aa0: 6527 290a 2020 2020 2020 2020 2327 2727  e').        #'''
-00079ab0: 0a20 2020 200a 2020 2020 656c 7365 3a0a  .    .    else:.
-00079ac0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-00079ad0: 7472 696e 6746 6978 2073 7461 7274 6564  tringFix started
-00079ae0: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
-00079af0: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
-00079b00: 2020 2020 2070 7269 6e74 2827 4c6f 6164       print('Load
-00079b10: 696e 6720 6c6f 6369 2026 2063 6f6e 7365  ing loci & conse
-00079b20: 6e73 7573 206d 6174 7269 6365 7320 2e2e  nsus matrices ..
-00079b30: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
-00079b40: 2020 2020 0a20 2020 2020 2020 2064 6174      .        dat
-00079b50: 6120 3d20 6c6f 6164 5f72 676e 735f 6f62  a = load_rgns_ob
-00079b60: 6a28 666e 616d 6520 2b20 272e 7267 6e73  j(fname + '.rgns
-00079b70: 2729 0a20 2020 2020 2020 2069 6620 6c65  ').        if le
-00079b80: 6e28 6461 7461 2920 3d3d 2035 3a0a 2020  n(data) == 5:.  
-00079b90: 2020 2020 2020 2020 2020 7267 6e73 5f6c            rgns_l
-00079ba0: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
-00079bb0: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
-00079bc0: 2072 645f 6c65 6e2c 206e 5f72 6561 6473   rd_len, n_reads
-00079bd0: 203d 2064 6174 610a 2020 2020 2020 2020   = data.        
-00079be0: 2020 2020 6d65 645f 6672 6167 5f6c 656e      med_frag_len
-00079bf0: 203d 2033 3030 0a20 2020 2020 2020 2020   = 300.         
-00079c00: 2020 2064 656c 2064 6174 610a 2020 2020     del data.    
-00079c10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00079c20: 2020 2020 2020 7267 6e73 5f6c 7374 5f6d        rgns_lst_m
-00079c30: 692c 2072 676e 735f 6c73 745f 6e64 2c20  i, rgns_lst_nd, 
-00079c40: 7267 6e73 5f6c 7374 5f73 742c 2072 645f  rgns_lst_st, rd_
-00079c50: 6c65 6e2c 206e 5f72 6561 6473 2c20 6d65  len, n_reads, me
-00079c60: 645f 6672 6167 5f6c 656e 203d 2064 6174  d_frag_len = dat
-00079c70: 610a 2020 2020 2020 2020 2020 2020 6465  a.            de
-00079c80: 6c20 6461 7461 0a20 2020 2020 2020 2070  l data.        p
-00079c90: 7269 6e74 2827 2064 6f6e 652e 2729 0a20  rint(' done.'). 
-00079ca0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00079cb0: 666f 7220 7220 696e 2072 676e 735f 6c73  for r in rgns_ls
-00079cc0: 745f 6d69 3a20 722e 7365 745f 6376 6728  t_mi: r.set_cvg(
-00079cd0: 290a 2020 2020 2020 2020 666f 7220 7220  ).        for r 
-00079ce0: 696e 2072 676e 735f 6c73 745f 6e64 3a20  in rgns_lst_nd: 
-00079cf0: 722e 7365 745f 6376 6728 290a 2020 2020  r.set_cvg().    
-00079d00: 2020 2020 666f 7220 7220 696e 2072 676e      for r in rgn
-00079d10: 735f 6c73 745f 7374 3a20 722e 7365 745f  s_lst_st: r.set_
-00079d20: 6376 6728 290a 2020 2020 2020 2020 6572  cvg().        er
-00079d30: 5f63 6f64 6520 3d20 4e4f 5f4d 4f52 455f  _code = NO_MORE_
-00079d40: 4c49 4e45 0a20 2020 2020 2020 2020 2020  LINE.           
-00079d50: 2020 2020 200a 2020 2020 2020 2020 656c       .        el
-00079d60: 6170 7365 645f 7469 6d65 3120 3d20 7469  apsed_time1 = ti
-00079d70: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-00079d80: 745f 7469 6d65 310a 2020 2020 2020 2020  t_time1.        
-00079d90: 2020 2020 0a20 2020 2069 6620 6572 5f63      .    if er_c
-00079da0: 6f64 6520 213d 204e 4f5f 4d4f 5245 5f4c  ode != NO_MORE_L
-00079db0: 494e 453a 0a20 2020 2020 2020 2070 7269  INE:.        pri
-00079dc0: 6e74 2827 4552 524f 523a 2069 6e70 7574  nt('ERROR: input
-00079dd0: 2061 6c69 676e 6d65 6e74 7320 7765 7265   alignments were
-00079de0: 204e 4f54 2073 6f72 7465 642e 2729 0a20   NOT sorted.'). 
-00079df0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00079e00: 2067 6473 203d 204e 6f6e 650a 2020 2020   gds = None.    
-00079e10: 2020 2020 6966 206a 756d 7020 3c20 323a      if jump < 2:
-00079e20: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00079e30: 2020 2020 2020 2020 2020 765f 7468 203d            v_th =
-00079e40: 2072 645f 6c65 6e2a 6d69 6e5f 6672 6167   rd_len*min_frag
-00079e50: 735f 7065 725f 6765 6e65 0a20 2020 2020  s_per_gene.     
-00079e60: 2020 2020 2020 2023 2069 6620 6774 6620         # if gtf 
-00079e70: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00079e80: 2020 2020 2023 2020 2020 2072 676e 735f       #     rgns_
-00079e90: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
-00079ea0: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
-00079eb0: 203d 2066 696c 7465 725f 7267 6e73 2872   = filter_rgns(r
-00079ec0: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
-00079ed0: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
-00079ee0: 745f 7374 2c20 765f 7468 2c20 735f 7468  t_st, v_th, s_th
-00079ef0: 203d 204d 4158 5f50 4552 4345 4e54 5f53   = MAX_PERCENT_S
-00079f00: 4543 290a 0a20 2020 2020 2020 2020 2020  EC)..           
-00079f10: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
-00079f20: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00079f30: 2069 6620 6774 6620 6973 206e 6f74 204e   if gtf is not N
-00079f40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00079f50: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00079f60: 2020 2020 2020 6966 2067 656e 6f6d 655f        if genome_
-00079f70: 6669 6c65 2069 7320 4e6f 6e65 3a0a 2020  file is None:.  
-00079f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00079f90: 2020 6765 6e6f 6d65 203d 204e 6f6e 650a    genome = None.
-00079fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00079fb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00079fc0: 2020 2020 2020 2020 2020 6765 6e6f 6d65            genome
-00079fd0: 203d 206c 6f61 645f 6765 6e6f 6d65 2867   = load_genome(g
-00079fe0: 656e 6f6d 655f 6669 6c65 2c20 7665 7262  enome_file, verb
-00079ff0: 6f73 6520 3d20 5472 7565 290a 0a20 2020  ose = True)..   
-0007a000: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007a010: 6f73 2e70 6174 682e 6973 6669 6c65 2867  os.path.isfile(g
-0007a020: 7466 202b 2027 2e67 7478 2729 3a0a 2020  tf + '.gtx'):.  
-0007a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a040: 2020 7072 696e 7428 274c 6f61 6469 6e67    print('Loading
-0007a050: 2047 5446 7820 2e2e 2027 2c20 656e 6420   GTFx .. ', end 
-0007a060: 3d20 2720 272c 2066 6c75 7368 203d 2054  = ' ', flush = T
-0007a070: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0007a080: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-0007a090: 656e 2867 7466 202b 2027 2e67 7478 272c  en(gtf + '.gtx',
-0007a0a0: 2027 7262 2729 2061 7320 663a 0a20 2020   'rb') as f:.   
-0007a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a0c0: 2020 2020 2028 6764 5f6c 7374 2c20 6368       (gd_lst, ch
-0007a0d0: 7273 2920 3d20 7069 636b 6c65 2e6c 6f61  rs) = pickle.loa
-0007a0e0: 6428 2066 2029 0a20 2020 2020 2020 2020  d( f ).         
-0007a0f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0007a100: 2827 646f 6e65 2e20 2729 0a20 2020 2020  ('done. ').     
-0007a110: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0007a120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a130: 2020 2020 2067 7466 5f6c 696e 6573 2c20       gtf_lines, 
-0007a140: 6864 725f 6c69 6e65 7320 3d20 6c6f 6164  hdr_lines = load
-0007a150: 5f67 7466 2867 7466 2c20 7665 7262 6f73  _gtf(gtf, verbos
-0007a160: 6520 3d20 5472 7565 290a 2020 2020 2020  e = True).      
-0007a170: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-0007a180: 5f6c 7374 2c20 6368 7273 203d 2067 6574  _lst, chrs = get
-0007a190: 5f67 656e 655f 6465 7363 7269 7074 6f72  _gene_descriptor
-0007a1a0: 2867 7466 5f6c 696e 6573 2c20 6765 6e6f  (gtf_lines, geno
-0007a1b0: 6d65 203d 2067 656e 6f6d 652c 2066 696c  me = genome, fil
-0007a1c0: 6c20 3d20 4661 6c73 652c 205c 0a20 2020  l = False, \.   
-0007a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079590: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000795a0: 2066 6f72 2072 2069 6e20 7267 6e73 5f6c   for r in rgns_l
+000795b0: 7374 5f6d 693a 2072 2e73 6574 5f63 7667  st_mi: r.set_cvg
+000795c0: 2829 0a20 2020 2020 2020 2066 6f72 2072  ().        for r
+000795d0: 2069 6e20 7267 6e73 5f6c 7374 5f6e 643a   in rgns_lst_nd:
+000795e0: 2072 2e73 6574 5f63 7667 2829 0a20 2020   r.set_cvg().   
+000795f0: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
+00079600: 6e73 5f6c 7374 5f73 743a 2072 2e73 6574  ns_lst_st: r.set
+00079610: 5f63 7667 2829 0a20 2020 2020 2020 2020  _cvg().         
+00079620: 2020 200a 2020 2020 2020 2020 736f 2e63     .        so.c
+00079630: 6c6f 7365 2829 0a20 2020 2020 2020 206e  lose().        n
+00079640: 5f72 6561 6473 2c20 6e5f 6261 7365 732c  _reads, n_bases,
+00079650: 2072 645f 6c65 6e20 3d20 736f 2e6e 756d   rd_len = so.num
+00079660: 5f72 6561 6473 2c20 736f 2e6e 756d 5f62  _reads, so.num_b
+00079670: 6173 6573 2c20 736f 2e72 6561 645f 6c65  ases, so.read_le
+00079680: 6e0a 2020 2020 2020 2020 7264 5f6c 656e  n.        rd_len
+00079690: 203d 2073 6f2e 7265 6164 5f6c 656e 0a20   = so.read_len. 
+000796a0: 2020 2020 2020 2065 6c61 7073 6564 5f74         elapsed_t
+000796b0: 696d 6531 203d 2074 696d 652e 7469 6d65  ime1 = time.time
+000796c0: 2829 202d 2073 7461 7274 5f74 696d 6532  () - start_time2
+000796d0: 0a0a 2020 2020 2020 2020 2327 2727 0a20  ..        #'''. 
+000796e0: 2020 2020 2020 2069 6620 7361 765f 7267         if sav_rg
+000796f0: 6e3a 0a20 2020 2020 2020 2020 2020 2070  n:.            p
+00079700: 7269 6e74 2827 5361 7669 6e67 206c 6f63  rint('Saving loc
+00079710: 6920 2620 636f 6e73 656e 7375 7320 6d61  i & consensus ma
+00079720: 7472 6963 6573 202e 2e2e 2e2e 272c 2065  trices .....', e
+00079730: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
+00079740: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00079750: 2073 6176 655f 7267 6e73 5f6f 626a 2866   save_rgns_obj(f
+00079760: 6e61 6d65 202b 2027 2e72 676e 7327 2c20  name + '.rgns', 
+00079770: 7267 6e73 5f6c 7374 5f6d 692c 2072 676e  rgns_lst_mi, rgn
+00079780: 735f 6c73 745f 6e64 2c20 7267 6e73 5f6c  s_lst_nd, rgns_l
+00079790: 7374 5f73 742c 2073 6f2e 7265 6164 5f6c  st_st, so.read_l
+000797a0: 656e 2c20 736f 2e6e 756d 5f72 6561 6473  en, so.num_reads
+000797b0: 2c20 6d65 645f 6672 6167 5f6c 656e 2029  , med_frag_len )
+000797c0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000797d0: 6e74 2827 2064 6f6e 6527 290a 0a20 2020  nt(' done')..   
+000797e0: 2020 2020 2023 2070 7269 6e74 2827 2e27       # print('.'
+000797f0: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
+00079800: 2020 2222 220a 2020 2020 2020 2020 7361    """.        sa
+00079810: 7665 5f72 676e 7328 2066 6e61 6d65 202b  ve_rgns( fname +
+00079820: 2027 5f72 676e 735f 6d69 5f25 692e 7478   '_rgns_mi_%i.tx
+00079830: 7427 2025 2073 612c 2072 676e 735f 6c73  t' % sa, rgns_ls
+00079840: 745f 6d69 2c20 736f 2e72 6561 645f 6c65  t_mi, so.read_le
+00079850: 6e2c 2073 6f2e 6e75 6d5f 7265 6164 7320  n, so.num_reads 
+00079860: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00079870: 272e 272c 2065 6e64 3d27 2729 0a20 2020  '.', end='').   
+00079880: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00079890: 2023 2073 6176 655f 7267 6e73 2820 666e   # save_rgns( fn
+000798a0: 616d 6520 2b20 275f 7267 6e73 5f6e 645f  ame + '_rgns_nd_
+000798b0: 2569 2e74 7874 2720 2520 7361 2c20 7267  %i.txt' % sa, rg
+000798c0: 6e73 5f6c 7374 5f6e 642c 2073 6f2e 7265  ns_lst_nd, so.re
+000798d0: 6164 5f6c 656e 2c20 736f 2e6e 756d 5f72  ad_len, so.num_r
+000798e0: 6561 6473 2029 0a20 2020 2020 2020 2023  eads ).        #
+000798f0: 2070 7269 6e74 2827 2e27 2c20 656e 643d   print('.', end=
+00079900: 2727 290a 2020 2020 2020 2020 2320 7361  '').        # sa
+00079910: 7665 5f72 676e 7328 2066 6e61 6d65 202b  ve_rgns( fname +
+00079920: 2027 5f72 676e 735f 695f 2569 5f68 6f2e   '_rgns_i_%i_ho.
+00079930: 7478 7427 2025 2073 612c 2072 676e 735f  txt' % sa, rgns_
+00079940: 6c73 745f 7374 2c20 736f 2e72 6561 645f  lst_st, so.read_
+00079950: 6c65 6e2c 2073 6f2e 6e75 6d5f 7265 6164  len, so.num_read
+00079960: 732c 2068 6f20 3d20 5472 7565 2029 0a20  s, ho = True ). 
+00079970: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+00079980: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+00079990: 2020 2020 0a20 2020 2020 2020 2023 2073      .        # s
+000799a0: 6176 655f 7267 6e73 2820 666e 616d 6520  ave_rgns( fname 
+000799b0: 2b20 275f 7267 6e73 5f6d 5f25 695f 686f  + '_rgns_m_%i_ho
+000799c0: 2e74 7874 2720 2520 7361 2c20 7267 6e73  .txt' % sa, rgns
+000799d0: 5f6c 7374 5f6d 692c 2073 6f2e 7265 6164  _lst_mi, so.read
+000799e0: 5f6c 656e 2c20 736f 2e6e 756d 5f72 6561  _len, so.num_rea
+000799f0: 6473 2c20 686f 203d 2054 7275 6520 290a  ds, ho = True ).
+00079a00: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00079a10: 272e 272c 2065 6e64 3d27 2729 0a20 2020  '.', end='').   
+00079a20: 2020 2020 2023 2067 7466 5f6c 696e 655f       # gtf_line_
+00079a30: 6c73 7420 3d20 6765 745f 6774 665f 6c69  lst = get_gtf_li
+00079a40: 6e65 7328 2072 676e 735f 6c73 745f 6d69  nes( rgns_lst_mi
+00079a50: 2c20 7267 6e73 5f6c 7374 5f6e 6420 290a  , rgns_lst_nd ).
+00079a60: 2020 2020 2020 2020 2320 7361 7665 5f67          # save_g
+00079a70: 7466 2820 666e 616d 652b 275f 7265 6769  tf( fname+'_regi
+00079a80: 6f6e 732e 6774 6627 2c20 6774 665f 6c69  ons.gtf', gtf_li
+00079a90: 6e65 5f6c 7374 2029 0a20 2020 2020 2020  ne_lst ).       
+00079aa0: 2023 2070 7269 6e74 2827 2064 6f6e 6527   # print(' done'
+00079ab0: 290a 2020 2020 2020 2020 2327 2727 0a20  ).        #'''. 
+00079ac0: 2020 200a 2020 2020 656c 7365 3a0a 2020     .    else:.  
+00079ad0: 2020 2020 2020 7072 696e 7428 2753 7472        print('Str
+00079ae0: 696e 6746 6978 2073 7461 7274 6564 2027  ingFix started '
+00079af0: 2c20 6461 7465 7469 6d65 2e64 6174 6574  , datetime.datet
+00079b00: 696d 652e 6e6f 7728 2929 0a20 2020 2020  ime.now()).     
+00079b10: 2020 2070 7269 6e74 2827 4c6f 6164 696e     print('Loadin
+00079b20: 6720 6c6f 6369 2026 2063 6f6e 7365 6e73  g loci & consens
+00079b30: 7573 206d 6174 7269 6365 7320 2e2e 2e27  us matrices ...'
+00079b40: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
+00079b50: 2020 0a20 2020 2020 2020 2064 6174 6120    .        data 
+00079b60: 3d20 6c6f 6164 5f72 676e 735f 6f62 6a28  = load_rgns_obj(
+00079b70: 666e 616d 6520 2b20 272e 7267 6e73 2729  fname + '.rgns')
+00079b80: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00079b90: 6461 7461 2920 3d3d 2035 3a0a 2020 2020  data) == 5:.    
+00079ba0: 2020 2020 2020 2020 7267 6e73 5f6c 7374          rgns_lst
+00079bb0: 5f6d 692c 2072 676e 735f 6c73 745f 6e64  _mi, rgns_lst_nd
+00079bc0: 2c20 7267 6e73 5f6c 7374 5f73 742c 2072  , rgns_lst_st, r
+00079bd0: 645f 6c65 6e2c 206e 5f72 6561 6473 203d  d_len, n_reads =
+00079be0: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+00079bf0: 2020 6d65 645f 6672 6167 5f6c 656e 203d    med_frag_len =
+00079c00: 2033 3030 0a20 2020 2020 2020 2020 2020   300.           
+00079c10: 2064 656c 2064 6174 610a 2020 2020 2020   del data.      
+00079c20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00079c30: 2020 2020 7267 6e73 5f6c 7374 5f6d 692c      rgns_lst_mi,
+00079c40: 2072 676e 735f 6c73 745f 6e64 2c20 7267   rgns_lst_nd, rg
+00079c50: 6e73 5f6c 7374 5f73 742c 2072 645f 6c65  ns_lst_st, rd_le
+00079c60: 6e2c 206e 5f72 6561 6473 2c20 6d65 645f  n, n_reads, med_
+00079c70: 6672 6167 5f6c 656e 203d 2064 6174 610a  frag_len = data.
+00079c80: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00079c90: 6461 7461 0a20 2020 2020 2020 2070 7269  data.        pri
+00079ca0: 6e74 2827 2064 6f6e 652e 2729 0a20 2020  nt(' done.').   
+00079cb0: 2020 2020 200a 2020 2020 2020 2020 666f       .        fo
+00079cc0: 7220 7220 696e 2072 676e 735f 6c73 745f  r r in rgns_lst_
+00079cd0: 6d69 3a20 722e 7365 745f 6376 6728 290a  mi: r.set_cvg().
+00079ce0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+00079cf0: 2072 676e 735f 6c73 745f 6e64 3a20 722e   rgns_lst_nd: r.
+00079d00: 7365 745f 6376 6728 290a 2020 2020 2020  set_cvg().      
+00079d10: 2020 666f 7220 7220 696e 2072 676e 735f    for r in rgns_
+00079d20: 6c73 745f 7374 3a20 722e 7365 745f 6376  lst_st: r.set_cv
+00079d30: 6728 290a 2020 2020 2020 2020 6572 5f63  g().        er_c
+00079d40: 6f64 6520 3d20 4e4f 5f4d 4f52 455f 4c49  ode = NO_MORE_LI
+00079d50: 4e45 0a20 2020 2020 2020 2020 2020 2020  NE.             
+00079d60: 2020 200a 2020 2020 2020 2020 656c 6170     .        elap
+00079d70: 7365 645f 7469 6d65 3120 3d20 7469 6d65  sed_time1 = time
+00079d80: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
+00079d90: 7469 6d65 310a 2020 2020 2020 2020 2020  time1.          
+00079da0: 2020 0a20 2020 2069 6620 6572 5f63 6f64    .    if er_cod
+00079db0: 6520 213d 204e 4f5f 4d4f 5245 5f4c 494e  e != NO_MORE_LIN
+00079dc0: 453a 0a20 2020 2020 2020 2070 7269 6e74  E:.        print
+00079dd0: 2827 4552 524f 523a 2069 6e70 7574 2061  ('ERROR: input a
+00079de0: 6c69 676e 6d65 6e74 7320 7765 7265 204e  lignments were N
+00079df0: 4f54 2073 6f72 7465 642e 2729 0a20 2020  OT sorted.').   
+00079e00: 2065 6c73 653a 0a20 2020 2020 2020 2067   else:.        g
+00079e10: 6473 203d 204e 6f6e 650a 2020 2020 2020  ds = None.      
+00079e20: 2020 6966 206a 756d 7020 3c20 323a 0a20    if jump < 2:. 
+00079e30: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00079e40: 2020 2020 2020 2020 765f 7468 203d 2072          v_th = r
+00079e50: 645f 6c65 6e2a 6d69 6e5f 6672 6167 735f  d_len*min_frags_
+00079e60: 7065 725f 6765 6e65 0a20 2020 2020 2020  per_gene.       
+00079e70: 2020 2020 2023 2069 6620 6774 6620 6973       # if gtf is
+00079e80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00079e90: 2020 2023 2020 2020 2072 676e 735f 6c73     #     rgns_ls
+00079ea0: 745f 6d69 2c20 7267 6e73 5f6c 7374 5f6e  t_mi, rgns_lst_n
+00079eb0: 642c 2072 676e 735f 6c73 745f 7374 203d  d, rgns_lst_st =
+00079ec0: 2066 696c 7465 725f 7267 6e73 2872 676e   filter_rgns(rgn
+00079ed0: 735f 6c73 745f 6d69 2c20 7267 6e73 5f6c  s_lst_mi, rgns_l
+00079ee0: 7374 5f6e 642c 2072 676e 735f 6c73 745f  st_nd, rgns_lst_
+00079ef0: 7374 2c20 765f 7468 2c20 735f 7468 203d  st, v_th, s_th =
+00079f00: 204d 4158 5f50 4552 4345 4e54 5f53 4543   MAX_PERCENT_SEC
+00079f10: 290a 0a20 2020 2020 2020 2020 2020 2067  )..            g
+00079f20: 6473 5f75 6e6d 6170 7065 6420 3d20 4e6f  ds_unmapped = No
+00079f30: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
+00079f40: 6620 6774 6620 6973 206e 6f74 204e 6f6e  f gtf is not Non
+00079f50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00079f60: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00079f70: 2020 2020 6966 2067 656e 6f6d 655f 6669      if genome_fi
+00079f80: 6c65 2069 7320 4e6f 6e65 3a0a 2020 2020  le is None:.    
+00079f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079fa0: 6765 6e6f 6d65 203d 204e 6f6e 650a 2020  genome = None.  
+00079fb0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00079fc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00079fd0: 2020 2020 2020 2020 6765 6e6f 6d65 203d          genome =
+00079fe0: 206c 6f61 645f 6765 6e6f 6d65 2867 656e   load_genome(gen
+00079ff0: 6f6d 655f 6669 6c65 2c20 7665 7262 6f73  ome_file, verbos
+0007a000: 6520 3d20 5472 7565 290a 0a20 2020 2020  e = True)..     
+0007a010: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+0007a020: 2e70 6174 682e 6973 6669 6c65 2867 7466  .path.isfile(gtf
+0007a030: 202b 2027 2e67 7478 2729 3a0a 2020 2020   + '.gtx'):.    
+0007a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a050: 7072 696e 7428 274c 6f61 6469 6e67 2047  print('Loading G
+0007a060: 5446 7820 2e2e 2027 2c20 656e 6420 3d20  TFx .. ', end = 
+0007a070: 2720 272c 2066 6c75 7368 203d 2054 7275  ' ', flush = Tru
+0007a080: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0007a090: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0007a0a0: 2867 7466 202b 2027 2e67 7478 272c 2027  (gtf + '.gtx', '
+0007a0b0: 7262 2729 2061 7320 663a 0a20 2020 2020  rb') as f:.     
+0007a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a0d0: 2020 2028 6764 5f6c 7374 2c20 6368 7273     (gd_lst, chrs
+0007a0e0: 2920 3d20 7069 636b 6c65 2e6c 6f61 6428  ) = pickle.load(
+0007a0f0: 2066 2029 0a20 2020 2020 2020 2020 2020   f ).           
+0007a100: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0007a110: 646f 6e65 2e20 2729 0a20 2020 2020 2020  done. ').       
+0007a120: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0007a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a140: 2020 2067 7466 5f6c 696e 6573 2c20 6864     gtf_lines, hd
+0007a150: 725f 6c69 6e65 7320 3d20 6c6f 6164 5f67  r_lines = load_g
+0007a160: 7466 2867 7466 2c20 7665 7262 6f73 6520  tf(gtf, verbose 
+0007a170: 3d20 5472 7565 290a 2020 2020 2020 2020  = True).        
+0007a180: 2020 2020 2020 2020 2020 2020 6764 5f6c              gd_l
+0007a190: 7374 2c20 6368 7273 203d 2067 6574 5f67  st, chrs = get_g
+0007a1a0: 656e 655f 6465 7363 7269 7074 6f72 2867  ene_descriptor(g
+0007a1b0: 7466 5f6c 696e 6573 2c20 6765 6e6f 6d65  tf_lines, genome
+0007a1c0: 203d 2067 656e 6f6d 652c 2066 696c 6c20   = genome, fill 
+0007a1d0: 3d20 4661 6c73 652c 205c 0a20 2020 2020  = False, \.     
 0007a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0007a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a200: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-0007a210: 7262 6f73 6520 3d20 5472 7565 2c20 6e5f  rbose = True, n_
-0007a220: 636f 7265 7320 3d20 6e5f 636f 7265 7329  cores = n_cores)
-0007a230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a240: 2020 2020 2064 656c 2067 7466 5f6c 696e       del gtf_lin
-0007a250: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0007a260: 2020 2020 2020 2070 7269 6e74 2827 5361         print('Sa
-0007a270: 7669 6e67 2047 5446 7820 2e2e 2027 2c20  ving GTFx .. ', 
-0007a280: 656e 6420 3d20 2720 272c 2066 6c75 7368  end = ' ', flush
-0007a290: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-0007a2a0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0007a2b0: 6820 6f70 656e 2867 7466 202b 2027 2e67  h open(gtf + '.g
-0007a2c0: 7478 272c 2027 7762 2729 2061 7320 663a  tx', 'wb') as f:
-0007a2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a2e0: 2020 2020 2020 2020 2070 6963 6b6c 652e           pickle.
-0007a2f0: 6475 6d70 2820 2867 645f 6c73 742c 2063  dump( (gd_lst, c
-0007a300: 6872 7329 2c20 6620 290a 2020 2020 2020  hrs), f ).      
-0007a310: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0007a320: 696e 7428 2764 6f6e 652e 2027 290a 0a20  int('done. ').. 
-0007a330: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0007a340: 645f 6c73 745f 6f66 5f6c 7374 2c20 6368  d_lst_of_lst, ch
-0007a350: 725f 6c73 7420 3d20 7061 636b 5f67 656e  r_lst = pack_gen
-0007a360: 655f 6465 7363 7269 7074 6f72 2820 6764  e_descriptor( gd
-0007a370: 5f6c 7374 2c20 6368 7273 2029 2020 2020  _lst, chrs )    
-0007a380: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0007a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a3a0: 6764 732c 2072 676e 735f 6c73 745f 6d69  gds, rgns_lst_mi
-0007a3b0: 2c20 7267 6e73 5f6c 7374 5f6e 642c 2072  , rgns_lst_nd, r
-0007a3c0: 676e 735f 6c73 745f 7374 2c20 6764 735f  gns_lst_st, gds_
-0007a3d0: 756e 6d61 7070 6564 203d 205c 0a20 2020  unmapped = \.   
-0007a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a3f0: 2070 6172 7365 5f61 6e64 5f63 6f6d 6269   parse_and_combi
-0007a400: 6e65 5f67 656e 6573 5f61 6e64 5f72 676e  ne_genes_and_rgn
-0007a410: 7328 6764 5f6c 7374 5f6f 665f 6c73 742c  s(gd_lst_of_lst,
-0007a420: 2063 6872 5f6c 7374 2c20 7267 6e73 5f6c   chr_lst, rgns_l
-0007a430: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
-0007a440: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
-0007a450: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0007a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a210: 2020 2020 2020 2020 2020 2020 7665 7262              verb
+0007a220: 6f73 6520 3d20 5472 7565 2c20 6e5f 636f  ose = True, n_co
+0007a230: 7265 7320 3d20 6e5f 636f 7265 7329 0a20  res = n_cores). 
+0007a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a250: 2020 2064 656c 2067 7466 5f6c 696e 6573     del gtf_lines
+0007a260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a270: 2020 2020 2070 7269 6e74 2827 5361 7669       print('Savi
+0007a280: 6e67 2047 5446 7820 2e2e 2027 2c20 656e  ng GTFx .. ', en
+0007a290: 6420 3d20 2720 272c 2066 6c75 7368 203d  d = ' ', flush =
+0007a2a0: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
+0007a2b0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0007a2c0: 6f70 656e 2867 7466 202b 2027 2e67 7478  open(gtf + '.gtx
+0007a2d0: 272c 2027 7762 2729 2061 7320 663a 0a20  ', 'wb') as f:. 
+0007a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a2f0: 2020 2020 2020 2070 6963 6b6c 652e 6475         pickle.du
+0007a300: 6d70 2820 2867 645f 6c73 742c 2063 6872  mp( (gd_lst, chr
+0007a310: 7329 2c20 6620 290a 2020 2020 2020 2020  s), f ).        
+0007a320: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0007a330: 7428 2764 6f6e 652e 2027 290a 0a20 2020  t('done. ')..   
+0007a340: 2020 2020 2020 2020 2020 2020 2067 645f               gd_
+0007a350: 6c73 745f 6f66 5f6c 7374 2c20 6368 725f  lst_of_lst, chr_
+0007a360: 6c73 7420 3d20 7061 636b 5f67 656e 655f  lst = pack_gene_
+0007a370: 6465 7363 7269 7074 6f72 2820 6764 5f6c  descriptor( gd_l
+0007a380: 7374 2c20 6368 7273 2029 2020 2020 2020  st, chrs )      
+0007a390: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0007a3a0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+0007a3b0: 732c 2072 676e 735f 6c73 745f 6d69 2c20  s, rgns_lst_mi, 
+0007a3c0: 7267 6e73 5f6c 7374 5f6e 642c 2072 676e  rgns_lst_nd, rgn
+0007a3d0: 735f 6c73 745f 7374 2c20 6764 735f 756e  s_lst_st, gds_un
+0007a3e0: 6d61 7070 6564 203d 205c 0a20 2020 2020  mapped = \.     
+0007a3f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007a400: 6172 7365 5f61 6e64 5f63 6f6d 6269 6e65  arse_and_combine
+0007a410: 5f67 656e 6573 5f61 6e64 5f72 676e 7328  _genes_and_rgns(
+0007a420: 6764 5f6c 7374 5f6f 665f 6c73 742c 2063  gd_lst_of_lst, c
+0007a430: 6872 5f6c 7374 2c20 7267 6e73 5f6c 7374  hr_lst, rgns_lst
+0007a440: 5f6d 692c 2072 676e 735f 6c73 745f 6e64  _mi, rgns_lst_nd
+0007a450: 2c20 7267 6e73 5f6c 7374 5f73 742c 205c  , rgns_lst_st, \
+0007a460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0007a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a480: 2020 2020 2020 2020 6e5f 636f 7265 7320          n_cores 
-0007a490: 3d20 6e5f 636f 7265 732c 2067 656e 6f6d  = n_cores, genom
-0007a4a0: 6520 3d20 6765 6e6f 6d65 2c20 7665 7262  e = genome, verb
-0007a4b0: 6f73 6520 3d20 5472 7565 2029 0a0a 2020  ose = True )..  
-0007a4c0: 2020 2020 2020 2020 2020 2020 2020 2327                #'
-0007a4d0: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
-0007a4e0: 2020 204e 7472 7320 3d20 300a 2020 2020     Ntrs = 0.    
-0007a4f0: 2020 2020 2020 2020 2020 2020 4e74 7273              Ntrs
-0007a500: 3220 3d20 300a 2020 2020 2020 2020 2020  2 = 0.          
-0007a510: 2020 2020 2020 666f 7220 6764 2069 6e20        for gd in 
-0007a520: 6764 733a 0a20 2020 2020 2020 2020 2020  gds:.           
-0007a530: 2020 2020 2020 2020 204e 7472 7320 2b3d           Ntrs +=
-0007a540: 2067 642e 6e74 720a 2020 2020 2020 2020   gd.ntr.        
-0007a550: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0007a560: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
-0007a570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a580: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0007a590: 7464 2e74 655f 746f 5f67 655f 6d61 7029  td.te_to_ge_map)
-0007a5a0: 203e 2030 3a20 4e74 7273 3220 2b3d 2031   > 0: Ntrs2 += 1
-0007a5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a5c0: 2070 7269 6e74 2827 4e74 7273 203d 2025   print('Ntrs = %
-0007a5d0: 692c 2025 6920 2720 2520 284e 7472 732c  i, %i ' % (Ntrs,
-0007a5e0: 204e 7472 7332 2920 290a 2020 2020 2020   Ntrs2) ).      
-0007a5f0: 2020 2020 2020 2020 2020 2327 2727 0a20            #'''. 
-0007a600: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0007a610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a620: 2067 6473 203d 204e 6f6e 650a 2020 2020   gds = None.    
-0007a630: 2020 2020 2020 2020 2020 2020 6764 735f              gds_
-0007a640: 756e 6d61 7070 6564 203d 204e 6f6e 650a  unmapped = None.
-0007a650: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007a660: 2020 2020 2020 2020 2023 2069 6620 7361           # if sa
-0007a670: 765f 7267 6e3a 0a20 2020 2020 2020 2020  v_rgn:.         
-0007a680: 2020 2023 2020 2020 2073 6176 655f 7267     #     save_rg
-0007a690: 6e73 5f6f 626a 2866 6e61 6d65 202b 2027  ns_obj(fname + '
-0007a6a0: 5f73 656c 6563 7465 642e 7267 6e73 272c  _selected.rgns',
-0007a6b0: 2072 676e 735f 6c73 745f 6d69 2c20 7267   rgns_lst_mi, rg
-0007a6c0: 6e73 5f6c 7374 5f6e 642c 2072 676e 735f  ns_lst_nd, rgns_
-0007a6d0: 6c73 745f 7374 2c20 7264 5f6c 656e 2c20  lst_st, rd_len, 
-0007a6e0: 6e5f 7265 6164 7320 290a 2020 2020 2020  n_reads ).      
-0007a6f0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0007a700: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
-0007a710: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0007a720: 2020 2020 5472 5f6c 7374 2c20 4973 5f6c      Tr_lst, Is_l
-0007a730: 7374 2c20 4754 465f 6c73 742c 206d 6e5f  st, GTF_lst, mn_
-0007a740: 6c73 742c 2067 7270 5f6c 7374 2c20 6764  lst, grp_lst, gd
-0007a750: 732c 2065 7473 2c20 6574 7820 3d20 5c0a  s, ets, etx = \.
-0007a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a770: 2020 2020 2020 2020 6765 745f 7472 616e          get_tran
-0007a780: 7363 7269 7074 7328 2072 676e 735f 6c73  scripts( rgns_ls
-0007a790: 745f 6d69 2c20 7267 6e73 5f6c 7374 5f6e  t_mi, rgns_lst_n
-0007a7a0: 642c 2072 676e 735f 6c73 745f 7374 2c20  d, rgns_lst_st, 
-0007a7b0: 7264 5f6c 656e 2c20 5c0a 2020 2020 2020  rd_len, \.      
-0007a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a490: 2020 2020 2020 6e5f 636f 7265 7320 3d20        n_cores = 
+0007a4a0: 6e5f 636f 7265 732c 2067 656e 6f6d 6520  n_cores, genome 
+0007a4b0: 3d20 6765 6e6f 6d65 2c20 7665 7262 6f73  = genome, verbos
+0007a4c0: 6520 3d20 5472 7565 2029 0a0a 2020 2020  e = True )..    
+0007a4d0: 2020 2020 2020 2020 2020 2020 2327 2727              #'''
+0007a4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a4f0: 204e 7472 7320 3d20 300a 2020 2020 2020   Ntrs = 0.      
+0007a500: 2020 2020 2020 2020 2020 4e74 7273 3220            Ntrs2 
+0007a510: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0007a520: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
+0007a530: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0007a540: 2020 2020 2020 204e 7472 7320 2b3d 2067         Ntrs += g
+0007a550: 642e 6e74 720a 2020 2020 2020 2020 2020  d.ntr.          
+0007a560: 2020 2020 2020 2020 2020 666f 7220 7464            for td
+0007a570: 2069 6e20 6764 2e74 645f 6c73 743a 0a20   in gd.td_lst:. 
+0007a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a590: 2020 2020 2020 2069 6620 6c65 6e28 7464         if len(td
+0007a5a0: 2e74 655f 746f 5f67 655f 6d61 7029 203e  .te_to_ge_map) >
+0007a5b0: 2030 3a20 4e74 7273 3220 2b3d 2031 0a20   0: Ntrs2 += 1. 
+0007a5c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007a5d0: 7269 6e74 2827 4e74 7273 203d 2025 692c  rint('Ntrs = %i,
+0007a5e0: 2025 6920 2720 2520 284e 7472 732c 204e   %i ' % (Ntrs, N
+0007a5f0: 7472 7332 2920 290a 2020 2020 2020 2020  trs2) ).        
+0007a600: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
+0007a610: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0007a620: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0007a630: 6473 203d 204e 6f6e 650a 2020 2020 2020  ds = None.      
+0007a640: 2020 2020 2020 2020 2020 6764 735f 756e            gds_un
+0007a650: 6d61 7070 6564 203d 204e 6f6e 650a 2020  mapped = None.  
+0007a660: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0007a670: 2020 2020 2020 2023 2069 6620 7361 765f         # if sav_
+0007a680: 7267 6e3a 0a20 2020 2020 2020 2020 2020  rgn:.           
+0007a690: 2023 2020 2020 2073 6176 655f 7267 6e73   #     save_rgns
+0007a6a0: 5f6f 626a 2866 6e61 6d65 202b 2027 5f73  _obj(fname + '_s
+0007a6b0: 656c 6563 7465 642e 7267 6e73 272c 2072  elected.rgns', r
+0007a6c0: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
+0007a6d0: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
+0007a6e0: 745f 7374 2c20 7264 5f6c 656e 2c20 6e5f  t_st, rd_len, n_
+0007a6f0: 7265 6164 7320 290a 2020 2020 2020 2020  reads ).        
+0007a700: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007a710: 2069 6620 6e5f 636f 7265 7320 3d3d 2031   if n_cores == 1
+0007a720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007a730: 2020 5472 5f6c 7374 2c20 4973 5f6c 7374    Tr_lst, Is_lst
+0007a740: 2c20 4754 465f 6c73 742c 206d 6e5f 6c73  , GTF_lst, mn_ls
+0007a750: 742c 2067 7270 5f6c 7374 2c20 6764 732c  t, grp_lst, gds,
+0007a760: 2065 7473 2c20 6574 7820 3d20 5c0a 2020   ets, etx = \.  
+0007a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a780: 2020 2020 2020 6765 745f 7472 616e 7363        get_transc
+0007a790: 7269 7074 7328 2072 676e 735f 6c73 745f  ripts( rgns_lst_
+0007a7a0: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 642c  mi, rgns_lst_nd,
+0007a7b0: 2072 676e 735f 6c73 745f 7374 2c20 7264   rgns_lst_st, rd
+0007a7c0: 5f6c 656e 2c20 5c0a 2020 2020 2020 2020  _len, \.        
 0007a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a7e0: 2020 2067 6473 2c20 6c65 6e5f 7468 2c20     gds, len_th, 
-0007a7f0: 6d65 7468 6f64 2c20 4e72 6563 2c20 7374  method, Nrec, st
-0007a800: 6172 7420 3d20 5374 6172 742c 2076 6572  art = Start, ver
-0007a810: 626f 7365 3d54 7275 6520 290a 2020 2020  bose=True ).    
-0007a820: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0007a830: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
-0007a840: 5f6c 7374 2c20 4973 5f6c 7374 2c20 4754  _lst, Is_lst, GT
-0007a850: 465f 6c73 742c 206d 6e5f 6c73 742c 2067  F_lst, mn_lst, g
-0007a860: 7270 5f6c 7374 2c20 6764 732c 2065 7473  rp_lst, gds, ets
-0007a870: 2c20 6574 7820 3d20 5c0a 2020 2020 2020  , etx = \.      
-0007a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a890: 2020 6765 745f 7472 616e 7363 7269 7074    get_transcript
-0007a8a0: 735f 6d63 2820 7267 6e73 5f6c 7374 5f6d  s_mc( rgns_lst_m
-0007a8b0: 692c 2072 676e 735f 6c73 745f 6e64 2c20  i, rgns_lst_nd, 
-0007a8c0: 7267 6e73 5f6c 7374 5f73 742c 2072 645f  rgns_lst_st, rd_
-0007a8d0: 6c65 6e2c 205c 0a20 2020 2020 2020 2020  len, \.         
-0007a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a7f0: 2067 6473 2c20 6c65 6e5f 7468 2c20 6d65   gds, len_th, me
+0007a800: 7468 6f64 2c20 4e72 6563 2c20 7374 6172  thod, Nrec, star
+0007a810: 7420 3d20 5374 6172 742c 2076 6572 626f  t = Start, verbo
+0007a820: 7365 3d54 7275 6520 290a 2020 2020 2020  se=True ).      
+0007a830: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0007a840: 2020 2020 2020 2020 2020 2020 5472 5f6c              Tr_l
+0007a850: 7374 2c20 4973 5f6c 7374 2c20 4754 465f  st, Is_lst, GTF_
+0007a860: 6c73 742c 206d 6e5f 6c73 742c 2067 7270  lst, mn_lst, grp
+0007a870: 5f6c 7374 2c20 6764 732c 2065 7473 2c20  _lst, gds, ets, 
+0007a880: 6574 7820 3d20 5c0a 2020 2020 2020 2020  etx = \.        
+0007a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a8a0: 6765 745f 7472 616e 7363 7269 7074 735f  get_transcripts_
+0007a8b0: 6d63 2820 7267 6e73 5f6c 7374 5f6d 692c  mc( rgns_lst_mi,
+0007a8c0: 2072 676e 735f 6c73 745f 6e64 2c20 7267   rgns_lst_nd, rg
+0007a8d0: 6e73 5f6c 7374 5f73 742c 2072 645f 6c65  ns_lst_st, rd_le
+0007a8e0: 6e2c 205c 0a20 2020 2020 2020 2020 2020  n, \.           
 0007a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a900: 2020 2067 6473 2c20 6e5f 636f 7265 732c     gds, n_cores,
-0007a910: 206c 656e 5f74 682c 206d 6574 686f 642c   len_th, method,
-0007a920: 204e 7265 632c 2073 7461 7274 203d 2053   Nrec, start = S
-0007a930: 7461 7274 2c20 7665 7262 6f73 653d 5472  tart, verbose=Tr
-0007a940: 7565 2029 0a20 2020 2020 2020 2020 2020  ue ).           
-0007a950: 200a 2020 2020 2020 2020 2020 2020 6574   .            et
-0007a960: 7320 3d20 6e70 2e61 7272 6179 2865 7473  s = np.array(ets
-0007a970: 2c20 6474 7970 6520 3d20 696e 7429 0a20  , dtype = int). 
-0007a980: 2020 2020 2020 2020 2020 2065 7478 203d             etx =
-0007a990: 206e 702e 6172 7261 7928 6574 782c 2064   np.array(etx, d
-0007a9a0: 7479 7065 203d 2069 6e74 290a 2020 2020  type = int).    
-0007a9b0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-0007a9c0: 2745 6c61 7061 6564 2074 696d 6573 3a20  'Elapaed times: 
-0007a9d0: 272c 2065 7473 2c20 6574 7829 0a20 2020  ', ets, etx).   
-0007a9e0: 2020 2020 2020 2020 2065 6c61 7073 6564           elapsed
-0007a9f0: 5f74 696d 6532 203d 2074 696d 652e 7469  _time2 = time.ti
-0007aa00: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
-0007aa10: 6531 0a20 2020 2020 2020 2020 2020 206e  e1.            n
-0007aa20: 5f63 6875 6e6b 7320 3d20 6c65 6e28 7267  _chunks = len(rg
-0007aa30: 6e73 5f6c 7374 5f6d 6929 0a0a 2020 2020  ns_lst_mi)..    
-0007aa40: 2020 2020 2020 2020 6465 6c20 7267 6e73          del rgns
-0007aa50: 5f6c 7374 5f6d 690a 2020 2020 2020 2020  _lst_mi.        
-0007aa60: 2020 2020 6465 6c20 7267 6e73 5f6c 7374      del rgns_lst
-0007aa70: 5f6e 640a 2020 2020 2020 2020 2020 2020  _nd.            
-0007aa80: 6465 6c20 7267 6e73 5f6c 7374 5f73 740a  del rgns_lst_st.
-0007aa90: 0a20 2020 2020 2020 2020 2020 2023 2727  .            #''
-0007aaa0: 270a 2020 2020 2020 2020 2020 2020 6966  '.            if
-0007aab0: 2067 7466 2069 7320 6e6f 7420 4e6f 6e65   gtf is not None
-0007aac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007aad0: 2020 4e74 7273 203d 2030 0a20 2020 2020    Ntrs = 0.     
-0007aae0: 2020 2020 2020 2020 2020 204e 7472 7332             Ntrs2
-0007aaf0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0007ab00: 2020 2020 204e 7472 7333 203d 2030 0a20       Ntrs3 = 0. 
-0007ab10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007ab20: 6f72 2067 6420 696e 2067 6473 3a0a 2020  or gd in gds:.  
-0007ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ab40: 2020 4e74 7273 202b 3d20 6764 2e6e 7472    Ntrs += gd.ntr
-0007ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007ab60: 2020 2020 2066 6f72 2074 6420 696e 2067       for td in g
-0007ab70: 642e 7464 5f6c 7374 3a0a 2020 2020 2020  d.td_lst:.      
-0007ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ab90: 2020 6966 206c 656e 2874 642e 7465 5f74    if len(td.te_t
-0007aba0: 6f5f 6765 5f6d 6170 2920 3e20 303a 204e  o_ge_map) > 0: N
-0007abb0: 7472 7332 202b 3d20 310a 2020 2020 2020  trs2 += 1.      
-0007abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007abd0: 2020 6966 206c 656e 2874 642e 7472 5f74    if len(td.tr_t
-0007abe0: 6f5f 6772 5f6d 6170 2920 3e20 303a 204e  o_gr_map) > 0: N
-0007abf0: 7472 7333 202b 3d20 310a 0a20 2020 2020  trs3 += 1..     
-0007ac00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0007ac10: 5f6e 6567 203d 2030 0a20 2020 2020 2020  _neg = 0.       
-0007ac20: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0007ac30: 2074 6420 696e 2067 642e 7464 5f6c 7374   td in gd.td_lst
-0007ac40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007ac50: 2020 2020 2020 2020 2020 6966 2074 642e            if td.
-0007ac60: 6162 6e20 3c20 303a 206e 5f6e 6567 202b  abn < 0: n_neg +
-0007ac70: 3d20 310a 0a20 2020 2020 2020 2020 2020  = 1..           
-0007ac80: 2020 2020 2070 7269 6e74 2827 2020 2025       print('   %
-0007ac90: 692c 2025 692c 2025 6920 2825 6929 2074  i, %i, %i (%i) t
-0007aca0: 7273 2066 726f 6d20 2569 2063 6875 6e63  rs from %i chunc
-0007acb0: 6b73 2f67 656e 6573 2028 2569 2927 2025  ks/genes (%i)' %
-0007acc0: 2028 4e74 7273 2c20 4e74 7273 322c 204e   (Ntrs, Ntrs2, N
-0007acd0: 7472 7333 2c20 6e5f 6e65 672c 206e 5f63  trs3, n_neg, n_c
-0007ace0: 6875 6e6b 732c 2069 6e74 2865 6c61 7073  hunks, int(elaps
-0007acf0: 6564 5f74 696d 6532 2929 2029 0a0a 2020  ed_time2)) )..  
-0007ad00: 2020 2020 2020 2020 2020 2320 666e 616d            # fnam
-0007ad10: 6520 3d20 666e 616d 6520 2b20 275f 7361  e = fname + '_sa
-0007ad20: 2569 2720 2520 7361 0a20 2020 2020 2020  %i' % sa.       
-0007ad30: 2020 2020 2066 6e61 6d65 5f74 7220 3d20       fname_tr = 
-0007ad40: 666e 616d 6520 2b20 275f 7472 616e 7363  fname + '_transc
-0007ad50: 7269 7074 6f6d 652e 6661 270a 2020 2020  riptome.fa'.    
-0007ad60: 2020 2020 2020 2020 666e 616d 655f 7072          fname_pr
-0007ad70: 203d 2066 6e61 6d65 202b 2027 5f70 726f   = fname + '_pro
-0007ad80: 7465 6f6d 652e 6661 270a 2020 2020 2020  teome.fa'.      
-0007ad90: 2020 2020 2020 666e 616d 655f 6766 6620        fname_gff 
-0007ada0: 3d20 666e 616d 6520 2b20 272e 6766 6627  = fname + '.gff'
-0007adb0: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
-0007adc0: 6d65 5f65 7870 203d 2066 6e61 6d65 202b  me_exp = fname +
-0007add0: 2027 5f65 7870 5f70 726f 6669 6c65 2e74   '_exp_profile.t
-0007ade0: 7376 270a 2020 2020 2020 2020 2020 2020  sv'.            
-0007adf0: 666e 616d 655f 736e 7620 3d20 666e 616d  fname_snv = fnam
-0007ae00: 6520 2b20 275f 736e 765f 7375 6d6d 6172  e + '_snv_summar
-0007ae10: 792e 7473 7627 0a0a 2020 2020 2020 2020  y.tsv'..        
-0007ae20: 2020 2020 6966 2067 6473 2069 7320 6e6f      if gds is no
-0007ae30: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0007ae40: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0007ae50: 2020 2020 2020 2020 2074 5f61 626e 203d           t_abn =
-0007ae60: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-0007ae70: 2020 2066 6f72 2067 6420 696e 2067 6473     for gd in gds
-0007ae80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007ae90: 2020 2020 2020 6764 2e73 6574 5f63 6f76        gd.set_cov
-0007aea0: 5f6e 5f61 626e 5f74 6828 204d 494e 5f43  _n_abn_th( MIN_C
-0007aeb0: 4f56 5f54 4f5f 5345 4c2c 204d 494e 5f41  OV_TO_SEL, MIN_A
-0007aec0: 424e 5f54 4f5f 5345 4c20 290a 2020 2020  BN_TO_SEL ).    
-0007aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007aee0: 6e74 722c 206e 7072 2c20 6e65 203d 2067  ntr, npr, ne = g
-0007aef0: 642e 7570 6461 7465 5f74 645f 696e 666f  d.update_td_info
-0007af00: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0007af10: 2020 2020 2020 2074 5f61 626e 202b 3d20         t_abn += 
-0007af20: 6764 2e67 6574 5f74 6f74 616c 5f61 626e  gd.get_total_abn
-0007af30: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0007af40: 2020 2069 6620 745f 6162 6e20 3d3d 2030     if t_abn == 0
-0007af50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007af60: 2020 2020 2020 745f 6162 6e20 3d20 310a        t_abn = 1.
-0007af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007af80: 2020 2020 7072 696e 7428 2754 6f74 616c      print('Total
-0007af90: 2076 6f6c 756d 6520 3d20 2569 2720 2520   volume = %i' % 
-0007afa0: 745f 6162 6e29 0a20 2020 2020 2020 2020  t_abn).         
-0007afb0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0007afc0: 2020 2020 2020 2020 2020 2020 6e66 203d              nf =
-0007afd0: 2031 3030 3030 3030 2f74 5f61 626e 0a20   1000000/t_abn. 
-0007afe0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007aff0: 6f72 2067 6420 696e 2067 6473 3a0a 2020  or gd in gds:.  
-0007b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b010: 2020 6764 2e73 6574 5f74 725f 696e 666f    gd.set_tr_info
-0007b020: 2820 6e66 2029 0a0a 2020 2020 2020 2020  ( nf )..        
-0007b030: 2020 2020 2020 2020 6966 2067 6473 5f75          if gds_u
-0007b040: 6e6d 6170 7065 6420 6973 206e 6f74 204e  nmapped is not N
-0007b050: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0007b060: 2020 2020 2020 2020 2069 6620 284d 494e           if (MIN
-0007b070: 5f43 4f56 5f54 4f5f 5345 4c20 3d3d 2030  _COV_TO_SEL == 0
-0007b080: 2920 2620 286c 656e 2867 6473 5f75 6e6d  ) & (len(gds_unm
-0007b090: 6170 7065 6429 203e 2030 293a 200a 2020  apped) > 0): .  
-0007b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b0b0: 2020 2020 2020 6e74 7220 3d20 300a 2020        ntr = 0.  
-0007b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b0d0: 2020 2020 2020 666f 7220 6764 2069 6e20        for gd in 
-0007b0e0: 6764 735f 756e 6d61 7070 6564 3a0a 2020  gds_unmapped:.  
-0007b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b100: 2020 2020 2020 2020 2020 6e74 7220 2b3d            ntr +=
-0007b110: 2067 642e 6e74 720a 2020 2020 2020 2020   gd.ntr.        
-0007b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b130: 2020 2020 6764 2e73 6574 5f63 6f76 5f6e      gd.set_cov_n
-0007b140: 5f61 626e 5f74 6828 204d 494e 5f43 4f56  _abn_th( MIN_COV
-0007b150: 5f54 4f5f 5345 4c2c 204d 494e 5f41 424e  _TO_SEL, MIN_ABN
-0007b160: 5f54 4f5f 5345 4c20 290a 2020 2020 2020  _TO_SEL ).      
-0007b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b180: 2020 2020 2020 6764 2e75 7064 6174 655f        gd.update_
-0007b190: 7464 5f69 6e66 6f28 290a 2020 2020 2020  td_info().      
-0007b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b1b0: 2020 6764 7320 3d20 6764 7320 2b20 6764    gds = gds + gd
-0007b1c0: 735f 756e 6d61 7070 6564 0a20 2020 2020  s_unmapped.     
-0007b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b1e0: 2020 2070 7269 6e74 2827 2020 2025 692c     print('   %i,
-0007b1f0: 2569 2075 6e6d 6170 7065 6420 6765 6e65  %i unmapped gene
-0007b200: 732f 7472 7320 7765 7265 2061 6464 6564  s/trs were added
-0007b210: 2e27 2025 2028 6c65 6e28 6764 735f 756e  .' % (len(gds_un
-0007b220: 6d61 7070 6564 292c 206e 7472 2920 290a  mapped), ntr) ).
-0007b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b240: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007b250: 2020 2020 2067 6473 203d 2073 6f72 745f       gds = sort_
-0007b260: 6465 7363 7269 7074 6f72 5f6c 7374 2867  descriptor_lst(g
-0007b270: 6473 290a 0a20 2020 2020 2020 2020 2020  ds)..           
-0007b280: 2020 2020 2023 2727 270a 2020 2020 2020       #'''.      
-0007b290: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-0007b2a0: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-0007b2b0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0007b2c0: 2020 2070 7269 6e74 2827 4765 6e65 7261     print('Genera
-0007b2d0: 7469 6e67 2069 6e74 6572 6d65 6469 6174  ting intermediat
-0007b2e0: 6520 4746 4620 616e 6420 5472 616e 7363  e GFF and Transc
-0007b2f0: 7269 7074 6f6d 6520 2e2e 2027 2c20 656e  riptome .. ', en
-0007b300: 643d 2720 2020 2027 290a 2020 2020 2020  d='    ').      
-0007b310: 2020 2020 2020 2020 2020 6774 665f 6c69            gtf_li
-0007b320: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-0007b330: 2020 2020 2020 2020 2066 6173 7461 5f6c           fasta_l
-0007b340: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
-0007b350: 2020 2020 2020 2020 2020 6661 7374 615f            fasta_
-0007b360: 6c69 6e65 7332 203d 205b 5d0a 2020 2020  lines2 = [].    
-0007b370: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-0007b380: 6e6f 6e65 203d 2030 0a0a 2020 2020 2020  none = 0..      
-0007b390: 2020 2020 2020 2020 2020 6864 725f 6c69            hdr_li
-0007b3a0: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-0007b3b0: 2020 2020 2020 2020 2068 6472 5f6c 696e           hdr_lin
-0007b3c0: 6573 2e61 7070 656e 6428 2753 7472 696e  es.append('Strin
-0007b3d0: 6746 6978 2076 6572 7369 6f6e 2025 7327  gFix version %s'
-0007b3e0: 2025 2053 7472 696e 6746 6978 5f76 6572   % StringFix_ver
-0007b3f0: 7369 6f6e 2029 0a20 2020 2020 2020 2020  sion ).         
-0007b400: 2020 2020 2020 2068 6472 5f6c 696e 6573         hdr_lines
-0007b410: 2e61 7070 656e 6428 2749 6e70 7574 2053  .append('Input S
-0007b420: 414d 2f42 414d 3a20 2573 2720 2520 7361  AM/BAM: %s' % sa
-0007b430: 6d5f 6669 6c65 290a 2020 2020 2020 2020  m_file).        
-0007b440: 2020 2020 2020 2020 6966 2067 7466 2069          if gtf i
-0007b450: 7320 6e6f 7420 4e6f 6e65 3a20 6864 725f  s not None: hdr_
-0007b460: 6c69 6e65 732e 6170 7065 6e64 2827 5265  lines.append('Re
-0007b470: 662e 2047 5446 2f47 4646 3a20 2573 2720  f. GTF/GFF: %s' 
-0007b480: 2520 6774 6629 0a20 2020 2020 2020 2020  % gtf).         
-0007b490: 2020 2020 2020 2068 6472 5f6c 696e 6573         hdr_lines
-0007b4a0: 2e61 7070 656e 6428 2752 6561 6420 6c65  .append('Read le
-0007b4b0: 6e67 7468 3a20 2569 2720 2520 7264 5f6c  ngth: %i' % rd_l
-0007b4c0: 656e 290a 2020 2020 2020 2020 2020 2020  en).            
-0007b4d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007b4e0: 2020 2020 2066 5f67 7466 203d 2073 6176       f_gtf = sav
-0007b4f0: 655f 6774 6632 2866 6e61 6d65 5f67 6666  e_gtf2(fname_gff
-0007b500: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
-0007b510: 204e 6f6e 652c 2068 6472 203d 2068 6472   None, hdr = hdr
-0007b520: 5f6c 696e 6573 290a 2020 2020 2020 2020  _lines).        
-0007b530: 2020 2020 2020 2020 6966 206f 7574 5f74          if out_t
-0007b540: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-0007b550: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
-0007b560: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-0007b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b580: 2020 2020 665f 7420 3d20 6f70 656e 2866      f_t = open(f
-0007b590: 6e61 6d65 5f74 722c 2027 772b 2729 0a20  name_tr, 'w+'). 
-0007b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b5b0: 2020 2023 2069 6620 2867 7466 2069 7320     # if (gtf is 
-0007b5c0: 4e6f 6e65 293a 2066 5f70 203d 206f 7065  None): f_p = ope
-0007b5d0: 6e28 666e 616d 655f 7072 2c20 2777 2b27  n(fname_pr, 'w+'
-0007b5e0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007b5f0: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
-0007b600: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0007b610: 2020 2020 2020 2020 666f 7220 6d2c 2067          for m, g
-0007b620: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
-0007b630: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
-0007b640: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007b650: 6d25 3130 3020 3d3d 2030 3a20 7072 696e  m%100 == 0: prin
-0007b660: 7428 275c 7247 656e 6572 6174 696e 6720  t('\rGenerating 
-0007b670: 696e 7465 726d 6564 6961 7465 2047 5446  intermediate GTF
-0007b680: 2061 6e64 2074 7261 6e73 6372 6970 746f   and transcripto
-0007b690: 6d65 202e 2e20 2569 2f25 6927 2025 2028  me .. %i/%i' % (
-0007b6a0: 6d2c 206c 656e 2867 6473 2929 2c20 656e  m, len(gds)), en
-0007b6b0: 6420 3d20 2720 2020 2729 0a20 2020 2020  d = '   ').     
-0007b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b6d0: 2020 2023 206e 7472 2c20 6e70 722c 206e     # ntr, npr, n
-0007b6e0: 6520 3d20 6764 2e75 7064 6174 655f 7464  e = gd.update_td
-0007b6f0: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
-0007b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b710: 6774 666c 2c20 636e 203d 2067 642e 6765  gtfl, cn = gd.ge
-0007b720: 745f 6774 665f 6c69 6e65 735f 6672 6f6d  t_gtf_lines_from
-0007b730: 5f65 786f 6e73 2829 0a20 2020 2020 2020  _exons().       
-0007b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b750: 2066 5f67 7466 203d 2073 6176 655f 6774   f_gtf = save_gt
-0007b760: 6632 2866 6e61 6d65 5f67 6666 2c20 6774  f2(fname_gff, gt
-0007b770: 665f 6c69 6e65 5f6c 7374 203d 2067 7466  f_line_lst = gtf
-0007b780: 6c2c 2066 6f20 3d20 665f 6774 6629 0a0a  l, fo = f_gtf)..
-0007b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b7a0: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
-0007b7b0: 202b 3d20 636e 0a20 2020 2020 2020 2020   += cn.         
-0007b7c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0007b7d0: 6620 6f75 745f 7472 3a0a 2020 2020 2020  f out_tr:.      
-0007b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b7f0: 2020 2020 2020 6c31 2c20 6c32 203d 2067        l1, l2 = g
-0007b800: 642e 6765 745f 6661 7374 615f 6c69 6e65  d.get_fasta_line
-0007b810: 735f 6672 6f6d 5f65 786f 6e73 2870 6570  s_from_exons(pep
-0007b820: 7469 6465 203d 2046 616c 7365 290a 2020  tide = False).  
-0007b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b840: 2020 2020 2020 2020 2020 665f 742e 7772            f_t.wr
-0007b850: 6974 656c 696e 6573 2827 272e 6a6f 696e  itelines(''.join
-0007b860: 286c 3129 290a 2020 2020 2020 2020 2020  (l1)).          
-0007b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b880: 2020 2320 6966 2028 6774 6620 6973 204e    # if (gtf is N
-0007b890: 6f6e 6529 3a20 665f 702e 7772 6974 656c  one): f_p.writel
-0007b8a0: 696e 6573 2827 272e 6a6f 696e 286c 3229  ines(''.join(l2)
-0007b8b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007b8c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0007b8d0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
-0007b8e0: 636f 7265 203d 206d 696e 2820 6e5f 636f  core = min( n_co
-0007b8f0: 7265 732c 2028 6370 755f 636f 756e 7428  res, (cpu_count(
-0007b900: 2920 2d20 3129 2029 0a20 2020 2020 2020  ) - 1) ).       
-0007b910: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
-0007b920: 6c20 3d20 506f 6f6c 286e 756d 5f63 6f72  l = Pool(num_cor
-0007b930: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0007b940: 2020 2020 2020 206d 203d 2031 0a20 2020         m = 1.   
-0007b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b960: 2066 6f72 2067 7466 6c2c 206c 312c 206c   for gtfl, l1, l
-0007b970: 322c 206e 652c 2063 6e20 696e 2070 6f6f  2, ne, cn in poo
-0007b980: 6c2e 6d61 7028 6d63 5f63 6f72 655f 6765  l.map(mc_core_ge
-0007b990: 745f 6774 665f 616e 645f 6661 7374 615f  t_gtf_and_fasta_
-0007b9a0: 7066 2c20 6764 7329 3a0a 2020 2020 2020  pf, gds):.      
-0007b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b9c0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0007b9d0: 2020 2020 2020 2020 2020 2069 6620 6d25             if m%
-0007b9e0: 3130 3020 3d3d 2030 3a20 7072 696e 7428  100 == 0: print(
-0007b9f0: 275c 7247 656e 6572 6174 696e 6720 696e  '\rGenerating in
-0007ba00: 7465 726d 6564 6961 7465 2047 5446 2061  termediate GTF a
-0007ba10: 6e64 2074 7261 6e73 6372 6970 746f 6d65  nd transcriptome
-0007ba20: 202e 2e20 2569 2f25 6927 2025 2028 6d2c   .. %i/%i' % (m,
-0007ba30: 206c 656e 2867 6473 2929 2c20 656e 6420   len(gds)), end 
-0007ba40: 3d20 2720 2020 2729 0a20 2020 2020 2020  = '   ').       
-0007ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ba60: 206d 202b 3d20 310a 2020 2020 2020 2020   m += 1.        
-0007ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ba80: 665f 6774 6620 3d20 7361 7665 5f67 7466  f_gtf = save_gtf
-0007ba90: 3228 666e 616d 655f 6766 662c 2067 7466  2(fname_gff, gtf
-0007baa0: 5f6c 696e 655f 6c73 7420 3d20 6774 666c  _line_lst = gtfl
-0007bab0: 2c20 666f 203d 2066 5f67 7466 290a 0a20  , fo = f_gtf).. 
-0007bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bad0: 2020 2020 2020 2063 6e74 5f6e 6f6e 6520         cnt_none 
-0007bae0: 2b3d 2063 6e0a 2020 2020 2020 2020 2020  += cn.          
-0007baf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0007bb00: 206f 7574 5f74 723a 0a20 2020 2020 2020   out_tr:.       
-0007bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bb20: 2020 2020 2066 5f74 2e77 7269 7465 6c69       f_t.writeli
-0007bb30: 6e65 7328 2727 2e6a 6f69 6e28 6c31 2929  nes(''.join(l1))
-0007bb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007bb50: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0007bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bb70: 2020 706f 6f6c 2e63 6c6f 7365 2829 0a20    pool.close(). 
-0007bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bb90: 2020 2070 6f6f 6c2e 6a6f 696e 2829 0a20     pool.join(). 
-0007bba0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0007bbb0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0007bbc0: 5f67 7466 3228 666e 616d 655f 6766 662c  _gtf2(fname_gff,
-0007bbd0: 2067 7466 5f6c 696e 655f 6c73 7420 3d20   gtf_line_lst = 
-0007bbe0: 4e6f 6e65 2c20 666f 203d 2066 5f67 7466  None, fo = f_gtf
-0007bbf0: 2c20 636c 6f73 6520 3d20 5472 7565 290a  , close = True).
-0007bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007bc20: 2069 6620 6f75 745f 7472 3a0a 2020 2020   if out_tr:.    
-0007bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bc40: 665f 742e 636c 6f73 6528 290a 2020 2020  f_t.close().    
-0007bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bc60: 2320 6966 2028 6774 6620 6973 204e 6f6e  # if (gtf is Non
-0007bc70: 6529 3a20 665f 702e 636c 6f73 6528 290a  e): f_p.close().
-0007bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bc90: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007bca0: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
-0007bcb0: 6532 203d 2074 696d 652e 7469 6d65 2829  e2 = time.time()
-0007bcc0: 202d 2073 7461 7274 5f74 696d 650a 2020   - start_time.  
-0007bcd0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0007bce0: 696e 7428 275c 7247 656e 6572 6174 696e  int('\rGeneratin
-0007bcf0: 6720 696e 7465 726d 6564 6961 7465 2047  g intermediate G
-0007bd00: 5446 2061 6e64 2074 7261 6e73 6372 6970  TF and transcrip
-0007bd10: 746f 6d65 202e 2e20 2569 2c20 2569 2c20  tome .. %i, %i, 
-0007bd20: 2569 2064 6f6e 6520 2825 6929 2020 2720  %i done (%i)  ' 
-0007bd30: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0007bd40: 2020 2020 2020 2020 2025 2028 6c65 6e28           % (len(
-0007bd50: 6661 7374 615f 6c69 6e65 7329 2f32 2c20  fasta_lines)/2, 
-0007bd60: 6c65 6e28 6764 7329 2c20 636e 745f 6e6f  len(gds), cnt_no
-0007bd70: 6e65 2c20 656c 6170 7365 645f 7469 6d65  ne, elapsed_time
-0007bd80: 3229 290a 2020 2020 2020 2020 2020 2020  2)).            
-0007bd90: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007bda0: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
-0007bdb0: 6533 203d 2074 696d 652e 7469 6d65 2829  e3 = time.time()
-0007bdc0: 202d 2073 7461 7274 5f74 696d 650a 0a20   - start_time.. 
-0007bdd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0007bde0: 7269 6e74 2827 2020 2025 7320 2825 6929  rint('   %s (%i)
-0007bdf0: 2720 2520 2866 6e61 6d65 5f67 6666 2c20  ' % (fname_gff, 
-0007be00: 656c 6170 7365 645f 7469 6d65 3329 2029  elapsed_time3) )
-0007be10: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007be20: 2020 6966 2054 7275 653a 2023 2028 6765    if True: # (ge
-0007be30: 6e6f 6d65 5f66 696c 6520 6973 204e 6f6e  nome_file is Non
-0007be40: 6529 2026 2028 6774 6620 6973 204e 6f6e  e) & (gtf is Non
-0007be50: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0007be60: 2020 2020 2020 2020 6e76 5f6c 7374 203d          nv_lst =
-0007be70: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0007be80: 2020 2020 2020 2020 636e 745f 6520 3d20          cnt_e = 
-0007be90: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-0007bea0: 2020 2020 2020 666f 7220 6764 2069 6e20        for gd in 
-0007beb0: 6764 733a 0a20 2020 2020 2020 2020 2020  gds:.           
-0007bec0: 2020 2020 2020 2020 2020 2020 2067 642e               gd.
-0007bed0: 6669 6e64 5f73 6e70 5f66 726f 6d5f 7267  find_snp_from_rg
-0007bee0: 6e73 2829 0a20 2020 2020 2020 2020 2020  ns().           
-0007bef0: 2020 2020 2020 2020 2020 2020 206e 765f               nv_
-0007bf00: 6c73 745f 746d 702c 2063 6e74 5f65 203d  lst_tmp, cnt_e =
-0007bf10: 2067 642e 6765 745f 6765 6e65 5f6c 6576   gd.get_gene_lev
-0007bf20: 656c 5f6e 765f 696e 666f 2863 6e74 5f65  el_nv_info(cnt_e
-0007bf30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007bf40: 2020 2020 2020 2020 2020 6e76 5f6c 7374            nv_lst
-0007bf50: 203d 206e 765f 6c73 7420 2b20 6e76 5f6c   = nv_lst + nv_l
-0007bf60: 7374 5f74 6d70 0a0a 2020 2020 2020 2020  st_tmp..        
-0007bf70: 2020 2020 2020 2020 2020 2020 6466 203d              df =
-0007bf80: 2070 642e 4461 7461 4672 616d 6528 6e76   pd.DataFrame(nv
-0007bf90: 5f6c 7374 290a 2020 2020 2020 2020 2020  _lst).          
-0007bfa0: 2020 2020 2020 2020 2020 6466 5f73 6e76            df_snv
-0007bfb0: 203d 2064 665b 5b27 6368 7227 2c20 2770   = df[['chr', 'p
-0007bfc0: 6f73 5f72 6566 272c 2027 7265 665f 7365  os_ref', 'ref_se
-0007bfd0: 7127 2c20 2761 6c74 5f73 6571 272c 2027  q', 'alt_seq', '
-0007bfe0: 6376 675f 6465 7074 6827 2c20 2763 7667  cvg_depth', 'cvg
-0007bff0: 5f66 7261 6327 2c20 2776 5f74 7970 6527  _frac', 'v_type'
-0007c000: 2c20 2776 5f6c 656e 272c 2027 765f 636c  , 'v_len', 'v_cl
-0007c010: 6173 7327 2c20 2776 5f63 6c61 7373 5f74  ass', 'v_class_t
-0007c020: 7227 5d5d 0a20 2020 2020 2020 2020 2020  r']].           
-0007c030: 2020 2020 2020 2020 2064 665f 736e 762e           df_snv.
-0007c040: 746f 5f63 7376 2866 6e61 6d65 5f73 6e76  to_csv(fname_snv
-0007c050: 2c20 7365 703d 275c 7427 290a 2020 2020  , sep='\t').    
-0007c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c070: 7072 696e 7428 2753 4e56 2073 756d 6d61  print('SNV summa
-0007c080: 7279 2073 6176 6564 2074 6f20 2850 4520  ry saved to (PE 
-0007c090: 2569 2920 5c6e 2020 2025 7327 2025 2028  %i) \n   %s' % (
-0007c0a0: 636e 745f 652c 2066 6e61 6d65 5f73 6e76  cnt_e, fname_snv
-0007c0b0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0007c0c0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0007c0d0: 2020 2020 7464 5f65 7870 5f69 6e66 6f20      td_exp_info 
-0007c0e0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0007c0f0: 2020 2020 2066 6f72 206d 2c20 6764 2069       for m, gd i
-0007c100: 6e20 656e 756d 6572 6174 6528 6764 7329  n enumerate(gds)
-0007c110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007c120: 2020 2020 2020 7469 7320 3d20 6764 2e67        tis = gd.g
-0007c130: 6574 5f74 645f 6578 705f 696e 666f 2829  et_td_exp_info()
-0007c140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c150: 2020 2020 2074 645f 6578 705f 696e 666f       td_exp_info
-0007c160: 203d 2074 645f 6578 705f 696e 666f 202b   = td_exp_info +
-0007c170: 2074 6973 0a20 2020 2020 2020 200a 2020   tis.        .  
-0007c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c190: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0007c1a0: 2020 2064 665f 7464 5f65 7870 5f69 6e66     df_td_exp_inf
-0007c1b0: 6f20 3d20 7064 2e44 6174 6146 7261 6d65  o = pd.DataFrame
-0007c1c0: 2874 645f 6578 705f 696e 666f 290a 2020  (td_exp_info).  
-0007c1d0: 2020 2020 2020 2020 2020 2020 2020 6162                ab
-0007c1e0: 6e5f 7375 6d20 3d20 6466 5f74 645f 6578  n_sum = df_td_ex
-0007c1f0: 705f 696e 666f 5b27 6162 6e27 5d2e 7375  p_info['abn'].su
-0007c200: 6d28 290a 2020 2020 2020 2020 2020 2020  m().            
-0007c210: 2020 2020 6966 2061 626e 5f73 756d 203e      if abn_sum >
-0007c220: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0007c230: 2020 2020 2020 2020 6e66 203d 2031 3030          nf = 100
-0007c240: 3030 3030 2f61 626e 5f73 756d 0a20 2020  0000/abn_sum.   
-0007c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c260: 2064 665f 7464 5f65 7870 5f69 6e66 6f5b   df_td_exp_info[
-0007c270: 2774 706d 275d 203d 2064 665f 7464 5f65  'tpm'] = df_td_e
-0007c280: 7870 5f69 6e66 6f5b 2761 626e 275d 2a6e  xp_info['abn']*n
-0007c290: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-0007c2a0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0007c2b0: 2020 2064 665f 7464 5f65 7870 5f69 6e66     df_td_exp_inf
-0007c2c0: 6f2e 746f 5f63 7376 2866 6e61 6d65 5f65  o.to_csv(fname_e
-0007c2d0: 7870 2c20 7365 703d 275c 7427 290a 2020  xp, sep='\t').  
-0007c2e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0007c2f0: 696e 7428 2754 7261 6e73 6372 6970 7420  int('Transcript 
-0007c300: 6578 7072 6573 7369 6f6e 2070 726f 6669  expression profi
-0007c310: 6c65 2073 6176 6564 2074 6f20 5c6e 2020  le saved to \n  
-0007c320: 2025 7327 2025 2066 6e61 6d65 5f65 7870   %s' % fname_exp
-0007c330: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0007c340: 6620 2867 7466 2069 7320 4e6f 6e65 293a  f (gtf is None):
-0007c350: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007c360: 2020 5472 5f6c 7374 203d 2054 725f 6c73    Tr_lst = Tr_ls
-0007c370: 7420 2b20 4973 5f6c 7374 0a20 2020 2020  t + Is_lst.     
-0007c380: 2020 2020 2020 2020 2020 2074 725f 7365             tr_se
-0007c390: 6c20 3d20 5b5d 0a20 2020 2020 2020 2020  l = [].         
-0007c3a0: 2020 2020 2020 2069 6620 6c65 6e28 5472         if len(Tr
-0007c3b0: 5f6c 7374 2920 3e20 303a 0a20 2020 2020  _lst) > 0:.     
-0007c3c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007c3d0: 6f72 2074 7220 696e 2054 725f 6c73 743a  or tr in Tr_lst:
-0007c3e0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0007c3f0: 2020 2020 2020 2020 2020 6966 2028 6c65            if (le
-0007c400: 6e28 7472 2e73 6571 2920 3e3d 206c 656e  n(tr.seq) >= len
-0007c410: 5f74 6829 3a0a 2020 2020 2020 2020 2020  _th):.          
-0007c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c430: 2020 7472 5f73 656c 2e61 7070 656e 6428    tr_sel.append(
-0007c440: 7472 290a 0a20 2020 2020 2020 2020 2020  tr)..           
-0007c450: 2020 2020 2020 2020 2074 725f 7365 6c20           tr_sel 
-0007c460: 3d20 6765 745f 7470 6d28 7472 5f73 656c  = get_tpm(tr_sel
-0007c470: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007c480: 2020 2069 6620 6c65 6e28 7472 5f73 656c     if len(tr_sel
-0007c490: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
-0007c4a0: 2020 2020 2020 2020 2020 2020 6966 2054              if T
-0007c4b0: 525f 4649 4c54 4552 5f53 454c 203d 3d20  R_FILTER_SEL == 
-0007c4c0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-0007c4d0: 2020 2020 2020 2020 2020 2074 725f 7365             tr_se
-0007c4e0: 6c20 3d20 6669 6c74 6572 5f74 7273 5f31  l = filter_trs_1
-0007c4f0: 2820 7472 5f73 656c 2c20 7264 5f6c 656e  ( tr_sel, rd_len
-0007c500: 2c20 675f 7468 203d 204d 494e 5f4e 5f52  , g_th = MIN_N_R
-0007c510: 4453 5f50 4552 5f47 454e 452c 2061 626e  DS_PER_GENE, abn
-0007c520: 5f74 685f 7420 3d20 4d49 4e5f 4142 4e5f  _th_t = MIN_ABN_
-0007c530: 544f 5f53 454c 2c20 5c0a 2020 2020 2020  TO_SEL, \.      
-0007c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a910: 2067 6473 2c20 6e5f 636f 7265 732c 206c   gds, n_cores, l
+0007a920: 656e 5f74 682c 206d 6574 686f 642c 204e  en_th, method, N
+0007a930: 7265 632c 2073 7461 7274 203d 2053 7461  rec, start = Sta
+0007a940: 7274 2c20 7665 7262 6f73 653d 5472 7565  rt, verbose=True
+0007a950: 2029 0a20 2020 2020 2020 2020 2020 200a   ).            .
+0007a960: 2020 2020 2020 2020 2020 2020 6574 7320              ets 
+0007a970: 3d20 6e70 2e61 7272 6179 2865 7473 2c20  = np.array(ets, 
+0007a980: 6474 7970 6520 3d20 696e 7429 0a20 2020  dtype = int).   
+0007a990: 2020 2020 2020 2020 2065 7478 203d 206e           etx = n
+0007a9a0: 702e 6172 7261 7928 6574 782c 2064 7479  p.array(etx, dty
+0007a9b0: 7065 203d 2069 6e74 290a 2020 2020 2020  pe = int).      
+0007a9c0: 2020 2020 2020 2320 7072 696e 7428 2745        # print('E
+0007a9d0: 6c61 7061 6564 2074 696d 6573 3a20 272c  lapaed times: ',
+0007a9e0: 2065 7473 2c20 6574 7829 0a20 2020 2020   ets, etx).     
+0007a9f0: 2020 2020 2020 2065 6c61 7073 6564 5f74         elapsed_t
+0007aa00: 696d 6532 203d 2074 696d 652e 7469 6d65  ime2 = time.time
+0007aa10: 2829 202d 2073 7461 7274 5f74 696d 6531  () - start_time1
+0007aa20: 0a20 2020 2020 2020 2020 2020 206e 5f63  .            n_c
+0007aa30: 6875 6e6b 7320 3d20 6c65 6e28 7267 6e73  hunks = len(rgns
+0007aa40: 5f6c 7374 5f6d 6929 0a0a 2020 2020 2020  _lst_mi)..      
+0007aa50: 2020 2020 2020 6465 6c20 7267 6e73 5f6c        del rgns_l
+0007aa60: 7374 5f6d 690a 2020 2020 2020 2020 2020  st_mi.          
+0007aa70: 2020 6465 6c20 7267 6e73 5f6c 7374 5f6e    del rgns_lst_n
+0007aa80: 640a 2020 2020 2020 2020 2020 2020 6465  d.            de
+0007aa90: 6c20 7267 6e73 5f6c 7374 5f73 740a 0a20  l rgns_lst_st.. 
+0007aaa0: 2020 2020 2020 2020 2020 2023 2727 270a             #'''.
+0007aab0: 2020 2020 2020 2020 2020 2020 6966 2067              if g
+0007aac0: 7466 2069 7320 6e6f 7420 4e6f 6e65 3a0a  tf is not None:.
+0007aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007aae0: 4e74 7273 203d 2030 0a20 2020 2020 2020  Ntrs = 0.       
+0007aaf0: 2020 2020 2020 2020 204e 7472 7332 203d           Ntrs2 =
+0007ab00: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+0007ab10: 2020 204e 7472 7333 203d 2030 0a20 2020     Ntrs3 = 0.   
+0007ab20: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0007ab30: 2067 6420 696e 2067 6473 3a0a 2020 2020   gd in gds:.    
+0007ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ab50: 4e74 7273 202b 3d20 6764 2e6e 7472 0a20  Ntrs += gd.ntr. 
+0007ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ab70: 2020 2066 6f72 2074 6420 696e 2067 642e     for td in gd.
+0007ab80: 7464 5f6c 7374 3a0a 2020 2020 2020 2020  td_lst:.        
+0007ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007aba0: 6966 206c 656e 2874 642e 7465 5f74 6f5f  if len(td.te_to_
+0007abb0: 6765 5f6d 6170 2920 3e20 303a 204e 7472  ge_map) > 0: Ntr
+0007abc0: 7332 202b 3d20 310a 2020 2020 2020 2020  s2 += 1.        
+0007abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007abe0: 6966 206c 656e 2874 642e 7472 5f74 6f5f  if len(td.tr_to_
+0007abf0: 6772 5f6d 6170 2920 3e20 303a 204e 7472  gr_map) > 0: Ntr
+0007ac00: 7333 202b 3d20 310a 0a20 2020 2020 2020  s3 += 1..       
+0007ac10: 2020 2020 2020 2020 2020 2020 206e 5f6e               n_n
+0007ac20: 6567 203d 2030 0a20 2020 2020 2020 2020  eg = 0.         
+0007ac30: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+0007ac40: 6420 696e 2067 642e 7464 5f6c 7374 3a0a  d in gd.td_lst:.
+0007ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ac60: 2020 2020 2020 2020 6966 2074 642e 6162          if td.ab
+0007ac70: 6e20 3c20 303a 206e 5f6e 6567 202b 3d20  n < 0: n_neg += 
+0007ac80: 310a 0a20 2020 2020 2020 2020 2020 2020  1..             
+0007ac90: 2020 2070 7269 6e74 2827 2020 2025 692c     print('   %i,
+0007aca0: 2025 692c 2025 6920 2825 6929 2074 7273   %i, %i (%i) trs
+0007acb0: 2066 726f 6d20 2569 2063 6875 6e63 6b73   from %i chuncks
+0007acc0: 2f67 656e 6573 2028 2569 2927 2025 2028  /genes (%i)' % (
+0007acd0: 4e74 7273 2c20 4e74 7273 322c 204e 7472  Ntrs, Ntrs2, Ntr
+0007ace0: 7333 2c20 6e5f 6e65 672c 206e 5f63 6875  s3, n_neg, n_chu
+0007acf0: 6e6b 732c 2069 6e74 2865 6c61 7073 6564  nks, int(elapsed
+0007ad00: 5f74 696d 6532 2929 2029 0a0a 2020 2020  _time2)) )..    
+0007ad10: 2020 2020 2020 2020 2320 666e 616d 6520          # fname 
+0007ad20: 3d20 666e 616d 6520 2b20 275f 7361 2569  = fname + '_sa%i
+0007ad30: 2720 2520 7361 0a20 2020 2020 2020 2020  ' % sa.         
+0007ad40: 2020 2066 6e61 6d65 5f74 7220 3d20 666e     fname_tr = fn
+0007ad50: 616d 6520 2b20 275f 7472 616e 7363 7269  ame + '_transcri
+0007ad60: 7074 6f6d 652e 6661 270a 2020 2020 2020  ptome.fa'.      
+0007ad70: 2020 2020 2020 666e 616d 655f 7072 203d        fname_pr =
+0007ad80: 2066 6e61 6d65 202b 2027 5f70 726f 7465   fname + '_prote
+0007ad90: 6f6d 652e 6661 270a 2020 2020 2020 2020  ome.fa'.        
+0007ada0: 2020 2020 666e 616d 655f 6766 6620 3d20      fname_gff = 
+0007adb0: 666e 616d 6520 2b20 272e 6766 6627 0a20  fname + '.gff'. 
+0007adc0: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
+0007add0: 5f65 7870 203d 2066 6e61 6d65 202b 2027  _exp = fname + '
+0007ade0: 5f65 7870 5f70 726f 6669 6c65 2e74 7376  _exp_profile.tsv
+0007adf0: 270a 2020 2020 2020 2020 2020 2020 666e  '.            fn
+0007ae00: 616d 655f 736e 7620 3d20 666e 616d 6520  ame_snv = fname 
+0007ae10: 2b20 275f 736e 765f 7375 6d6d 6172 792e  + '_snv_summary.
+0007ae20: 7473 7627 0a0a 2020 2020 2020 2020 2020  tsv'..          
+0007ae30: 2020 6966 2067 6473 2069 7320 6e6f 7420    if gds is not 
+0007ae40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0007ae50: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0007ae60: 2020 2020 2020 2074 5f61 626e 203d 2030         t_abn = 0
+0007ae70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007ae80: 2066 6f72 2067 6420 696e 2067 6473 3a0a   for gd in gds:.
+0007ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007aea0: 2020 2020 6764 2e73 6574 5f63 6f76 5f6e      gd.set_cov_n
+0007aeb0: 5f61 626e 5f74 6828 204d 494e 5f43 4f56  _abn_th( MIN_COV
+0007aec0: 5f54 4f5f 5345 4c2c 204d 494e 5f41 424e  _TO_SEL, MIN_ABN
+0007aed0: 5f54 4f5f 5345 4c20 290a 2020 2020 2020  _TO_SEL ).      
+0007aee0: 2020 2020 2020 2020 2020 2020 2020 6e74                nt
+0007aef0: 722c 206e 7072 2c20 6e65 203d 2067 642e  r, npr, ne = gd.
+0007af00: 7570 6461 7465 5f74 645f 696e 666f 2829  update_td_info()
+0007af10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007af20: 2020 2020 2074 5f61 626e 202b 3d20 6764       t_abn += gd
+0007af30: 2e67 6574 5f74 6f74 616c 5f61 626e 2829  .get_total_abn()
+0007af40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007af50: 2069 6620 745f 6162 6e20 3d3d 2030 3a0a   if t_abn == 0:.
+0007af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007af70: 2020 2020 745f 6162 6e20 3d20 310a 2020      t_abn = 1.  
+0007af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007af90: 2020 7072 696e 7428 2754 6f74 616c 2076    print('Total v
+0007afa0: 6f6c 756d 6520 3d20 2569 2720 2520 745f  olume = %i' % t_
+0007afb0: 6162 6e29 0a20 2020 2020 2020 2020 2020  abn).           
+0007afc0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007afd0: 2020 2020 2020 2020 2020 6e66 203d 2031            nf = 1
+0007afe0: 3030 3030 3030 2f74 5f61 626e 0a20 2020  000000/t_abn.   
+0007aff0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0007b000: 2067 6420 696e 2067 6473 3a0a 2020 2020   gd in gds:.    
+0007b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b020: 6764 2e73 6574 5f74 725f 696e 666f 2820  gd.set_tr_info( 
+0007b030: 6e66 2029 0a0a 2020 2020 2020 2020 2020  nf )..          
+0007b040: 2020 2020 2020 6966 2067 6473 5f75 6e6d        if gds_unm
+0007b050: 6170 7065 6420 6973 206e 6f74 204e 6f6e  apped is not Non
+0007b060: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0007b070: 2020 2020 2020 2069 6620 284d 494e 5f43         if (MIN_C
+0007b080: 4f56 5f54 4f5f 5345 4c20 3d3d 2030 2920  OV_TO_SEL == 0) 
+0007b090: 2620 286c 656e 2867 6473 5f75 6e6d 6170  & (len(gds_unmap
+0007b0a0: 7065 6429 203e 2030 293a 200a 2020 2020  ped) > 0): .    
+0007b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b0c0: 2020 2020 6e74 7220 3d20 300a 2020 2020      ntr = 0.    
+0007b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b0e0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
+0007b0f0: 735f 756e 6d61 7070 6564 3a0a 2020 2020  s_unmapped:.    
+0007b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b110: 2020 2020 2020 2020 6e74 7220 2b3d 2067          ntr += g
+0007b120: 642e 6e74 720a 2020 2020 2020 2020 2020  d.ntr.          
+0007b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b140: 2020 6764 2e73 6574 5f63 6f76 5f6e 5f61    gd.set_cov_n_a
+0007b150: 626e 5f74 6828 204d 494e 5f43 4f56 5f54  bn_th( MIN_COV_T
+0007b160: 4f5f 5345 4c2c 204d 494e 5f41 424e 5f54  O_SEL, MIN_ABN_T
+0007b170: 4f5f 5345 4c20 290a 2020 2020 2020 2020  O_SEL ).        
+0007b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b190: 2020 2020 6764 2e75 7064 6174 655f 7464      gd.update_td
+0007b1a0: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
+0007b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b1c0: 6764 7320 3d20 6764 7320 2b20 6764 735f  gds = gds + gds_
+0007b1d0: 756e 6d61 7070 6564 0a20 2020 2020 2020  unmapped.       
+0007b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b1f0: 2070 7269 6e74 2827 2020 2025 692c 2569   print('   %i,%i
+0007b200: 2075 6e6d 6170 7065 6420 6765 6e65 732f   unmapped genes/
+0007b210: 7472 7320 7765 7265 2061 6464 6564 2e27  trs were added.'
+0007b220: 2025 2028 6c65 6e28 6764 735f 756e 6d61   % (len(gds_unma
+0007b230: 7070 6564 292c 206e 7472 2920 290a 2020  pped), ntr) ).  
+0007b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b250: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007b260: 2020 2067 6473 203d 2073 6f72 745f 6465     gds = sort_de
+0007b270: 7363 7269 7074 6f72 5f6c 7374 2867 6473  scriptor_lst(gds
+0007b280: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0007b290: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
+0007b2a0: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
+0007b2b0: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+0007b2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007b2d0: 2070 7269 6e74 2827 4765 6e65 7261 7469   print('Generati
+0007b2e0: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
+0007b2f0: 4746 4620 616e 6420 5472 616e 7363 7269  GFF and Transcri
+0007b300: 7074 6f6d 6520 2e2e 2027 2c20 656e 643d  ptome .. ', end=
+0007b310: 2720 2020 2027 290a 2020 2020 2020 2020  '    ').        
+0007b320: 2020 2020 2020 2020 6774 665f 6c69 6e65          gtf_line
+0007b330: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+0007b340: 2020 2020 2020 2066 6173 7461 5f6c 696e         fasta_lin
+0007b350: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+0007b360: 2020 2020 2020 2020 6661 7374 615f 6c69          fasta_li
+0007b370: 6e65 7332 203d 205b 5d0a 2020 2020 2020  nes2 = [].      
+0007b380: 2020 2020 2020 2020 2020 636e 745f 6e6f            cnt_no
+0007b390: 6e65 203d 2030 0a0a 2020 2020 2020 2020  ne = 0..        
+0007b3a0: 2020 2020 2020 2020 6864 725f 6c69 6e65          hdr_line
+0007b3b0: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+0007b3c0: 2020 2020 2020 2068 6472 5f6c 696e 6573         hdr_lines
+0007b3d0: 2e61 7070 656e 6428 2753 7472 696e 6746  .append('StringF
+0007b3e0: 6978 2076 6572 7369 6f6e 2025 7327 2025  ix version %s' %
+0007b3f0: 2053 7472 696e 6746 6978 5f76 6572 7369   StringFix_versi
+0007b400: 6f6e 2029 0a20 2020 2020 2020 2020 2020  on ).           
+0007b410: 2020 2020 2068 6472 5f6c 696e 6573 2e61       hdr_lines.a
+0007b420: 7070 656e 6428 2749 6e70 7574 2053 414d  ppend('Input SAM
+0007b430: 2f42 414d 3a20 2573 2720 2520 7361 6d5f  /BAM: %s' % sam_
+0007b440: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+0007b450: 2020 2020 2020 6966 2067 7466 2069 7320        if gtf is 
+0007b460: 6e6f 7420 4e6f 6e65 3a20 6864 725f 6c69  not None: hdr_li
+0007b470: 6e65 732e 6170 7065 6e64 2827 5265 662e  nes.append('Ref.
+0007b480: 2047 5446 2f47 4646 3a20 2573 2720 2520   GTF/GFF: %s' % 
+0007b490: 6774 6629 0a20 2020 2020 2020 2020 2020  gtf).           
+0007b4a0: 2020 2020 2068 6472 5f6c 696e 6573 2e61       hdr_lines.a
+0007b4b0: 7070 656e 6428 2752 6561 6420 6c65 6e67  ppend('Read leng
+0007b4c0: 7468 3a20 2569 2720 2520 7264 5f6c 656e  th: %i' % rd_len
+0007b4d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007b4e0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007b4f0: 2020 2066 5f67 7466 203d 2073 6176 655f     f_gtf = save_
+0007b500: 6774 6632 2866 6e61 6d65 5f67 6666 2c20  gtf2(fname_gff, 
+0007b510: 6774 665f 6c69 6e65 5f6c 7374 203d 204e  gtf_line_lst = N
+0007b520: 6f6e 652c 2068 6472 203d 2068 6472 5f6c  one, hdr = hdr_l
+0007b530: 696e 6573 290a 2020 2020 2020 2020 2020  ines).          
+0007b540: 2020 2020 2020 6966 206f 7574 5f74 723a        if out_tr:
+0007b550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007b560: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
+0007b570: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
+0007b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b590: 2020 665f 7420 3d20 6f70 656e 2866 6e61    f_t = open(fna
+0007b5a0: 6d65 5f74 722c 2027 772b 2729 0a20 2020  me_tr, 'w+').   
+0007b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b5c0: 2023 2069 6620 2867 7466 2069 7320 4e6f   # if (gtf is No
+0007b5d0: 6e65 293a 2066 5f70 203d 206f 7065 6e28  ne): f_p = open(
+0007b5e0: 666e 616d 655f 7072 2c20 2777 2b27 290a  fname_pr, 'w+').
+0007b5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007b600: 2069 6620 6e5f 636f 7265 7320 3d3d 2031   if n_cores == 1
+0007b610: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007b620: 2020 2020 2020 666f 7220 6d2c 2067 6420        for m, gd 
+0007b630: 696e 2065 6e75 6d65 7261 7465 2867 6473  in enumerate(gds
+0007b640: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0007b650: 2020 2020 2020 2020 2020 2069 6620 6d25             if m%
+0007b660: 3130 3020 3d3d 2030 3a20 7072 696e 7428  100 == 0: print(
+0007b670: 275c 7247 656e 6572 6174 696e 6720 696e  '\rGenerating in
+0007b680: 7465 726d 6564 6961 7465 2047 5446 2061  termediate GTF a
+0007b690: 6e64 2074 7261 6e73 6372 6970 746f 6d65  nd transcriptome
+0007b6a0: 202e 2e20 2569 2f25 6927 2025 2028 6d2c   .. %i/%i' % (m,
+0007b6b0: 206c 656e 2867 6473 2929 2c20 656e 6420   len(gds)), end 
+0007b6c0: 3d20 2720 2020 2729 0a20 2020 2020 2020  = '   ').       
+0007b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b6e0: 2023 206e 7472 2c20 6e70 722c 206e 6520   # ntr, npr, ne 
+0007b6f0: 3d20 6764 2e75 7064 6174 655f 7464 5f69  = gd.update_td_i
+0007b700: 6e66 6f28 290a 2020 2020 2020 2020 2020  nfo().          
+0007b710: 2020 2020 2020 2020 2020 2020 2020 6774                gt
+0007b720: 666c 2c20 636e 203d 2067 642e 6765 745f  fl, cn = gd.get_
+0007b730: 6774 665f 6c69 6e65 735f 6672 6f6d 5f65  gtf_lines_from_e
+0007b740: 786f 6e73 2829 0a20 2020 2020 2020 2020  xons().         
+0007b750: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007b760: 5f67 7466 203d 2073 6176 655f 6774 6632  _gtf = save_gtf2
+0007b770: 2866 6e61 6d65 5f67 6666 2c20 6774 665f  (fname_gff, gtf_
+0007b780: 6c69 6e65 5f6c 7374 203d 2067 7466 6c2c  line_lst = gtfl,
+0007b790: 2066 6f20 3d20 665f 6774 6629 0a0a 2020   fo = f_gtf)..  
+0007b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b7b0: 2020 2020 2020 636e 745f 6e6f 6e65 202b        cnt_none +
+0007b7c0: 3d20 636e 0a20 2020 2020 2020 2020 2020  = cn.           
+0007b7d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007b7e0: 6f75 745f 7472 3a0a 2020 2020 2020 2020  out_tr:.        
+0007b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b800: 2020 2020 6c31 2c20 6c32 203d 2067 642e      l1, l2 = gd.
+0007b810: 6765 745f 6661 7374 615f 6c69 6e65 735f  get_fasta_lines_
+0007b820: 6672 6f6d 5f65 786f 6e73 2870 6570 7469  from_exons(pepti
+0007b830: 6465 203d 2046 616c 7365 290a 2020 2020  de = False).    
+0007b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b850: 2020 2020 2020 2020 665f 742e 7772 6974          f_t.writ
+0007b860: 656c 696e 6573 2827 272e 6a6f 696e 286c  elines(''.join(l
+0007b870: 3129 290a 2020 2020 2020 2020 2020 2020  1)).            
+0007b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b890: 2320 6966 2028 6774 6620 6973 204e 6f6e  # if (gtf is Non
+0007b8a0: 6529 3a20 665f 702e 7772 6974 656c 696e  e): f_p.writelin
+0007b8b0: 6573 2827 272e 6a6f 696e 286c 3229 290a  es(''.join(l2)).
+0007b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b8d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0007b8e0: 2020 2020 2020 2020 2020 6e75 6d5f 636f            num_co
+0007b8f0: 7265 203d 206d 696e 2820 6e5f 636f 7265  re = min( n_core
+0007b900: 732c 2028 6370 755f 636f 756e 7428 2920  s, (cpu_count() 
+0007b910: 2d20 3129 2029 0a20 2020 2020 2020 2020  - 1) ).         
+0007b920: 2020 2020 2020 2020 2020 2070 6f6f 6c20             pool 
+0007b930: 3d20 506f 6f6c 286e 756d 5f63 6f72 6529  = Pool(num_core)
+0007b940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007b950: 2020 2020 206d 203d 2031 0a20 2020 2020       m = 1.     
+0007b960: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007b970: 6f72 2067 7466 6c2c 206c 312c 206c 322c  or gtfl, l1, l2,
+0007b980: 206e 652c 2063 6e20 696e 2070 6f6f 6c2e   ne, cn in pool.
+0007b990: 6d61 7028 6d63 5f63 6f72 655f 6765 745f  map(mc_core_get_
+0007b9a0: 6774 665f 616e 645f 6661 7374 615f 7066  gtf_and_fasta_pf
+0007b9b0: 2c20 6764 7329 3a0a 2020 2020 2020 2020  , gds):.        
+0007b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007b9e0: 2020 2020 2020 2020 2069 6620 6d25 3130           if m%10
+0007b9f0: 3020 3d3d 2030 3a20 7072 696e 7428 275c  0 == 0: print('\
+0007ba00: 7247 656e 6572 6174 696e 6720 696e 7465  rGenerating inte
+0007ba10: 726d 6564 6961 7465 2047 5446 2061 6e64  rmediate GTF and
+0007ba20: 2074 7261 6e73 6372 6970 746f 6d65 202e   transcriptome .
+0007ba30: 2e20 2569 2f25 6927 2025 2028 6d2c 206c  . %i/%i' % (m, l
+0007ba40: 656e 2867 6473 2929 2c20 656e 6420 3d20  en(gds)), end = 
+0007ba50: 2720 2020 2729 0a20 2020 2020 2020 2020  '   ').         
+0007ba60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0007ba70: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0007ba80: 2020 2020 2020 2020 2020 2020 2020 665f                f_
+0007ba90: 6774 6620 3d20 7361 7665 5f67 7466 3228  gtf = save_gtf2(
+0007baa0: 666e 616d 655f 6766 662c 2067 7466 5f6c  fname_gff, gtf_l
+0007bab0: 696e 655f 6c73 7420 3d20 6774 666c 2c20  ine_lst = gtfl, 
+0007bac0: 666f 203d 2066 5f67 7466 290a 0a20 2020  fo = f_gtf)..   
+0007bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bae0: 2020 2020 2063 6e74 5f6e 6f6e 6520 2b3d       cnt_none +=
+0007baf0: 2063 6e0a 2020 2020 2020 2020 2020 2020   cn.            
+0007bb00: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+0007bb10: 7574 5f74 723a 0a20 2020 2020 2020 2020  ut_tr:.         
+0007bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bb30: 2020 2066 5f74 2e77 7269 7465 6c69 6e65     f_t.writeline
+0007bb40: 7328 2727 2e6a 6f69 6e28 6c31 2929 0a20  s(''.join(l1)). 
+0007bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bb60: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0007bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bb80: 706f 6f6c 2e63 6c6f 7365 2829 0a20 2020  pool.close().   
+0007bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bba0: 2070 6f6f 6c2e 6a6f 696e 2829 0a20 2020   pool.join().   
+0007bbb0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007bbc0: 2020 2020 2020 2020 2020 7361 7665 5f67            save_g
+0007bbd0: 7466 3228 666e 616d 655f 6766 662c 2067  tf2(fname_gff, g
+0007bbe0: 7466 5f6c 696e 655f 6c73 7420 3d20 4e6f  tf_line_lst = No
+0007bbf0: 6e65 2c20 666f 203d 2066 5f67 7466 2c20  ne, fo = f_gtf, 
+0007bc00: 636c 6f73 6520 3d20 5472 7565 290a 2020  close = True).  
+0007bc10: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0007bc20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0007bc30: 6620 6f75 745f 7472 3a0a 2020 2020 2020  f out_tr:.      
+0007bc40: 2020 2020 2020 2020 2020 2020 2020 665f                f_
+0007bc50: 742e 636c 6f73 6528 290a 2020 2020 2020  t.close().      
+0007bc60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0007bc70: 6966 2028 6774 6620 6973 204e 6f6e 6529  if (gtf is None)
+0007bc80: 3a20 665f 702e 636c 6f73 6528 290a 2020  : f_p.close().  
+0007bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bca0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007bcb0: 2020 2065 6c61 7073 6564 5f74 696d 6532     elapsed_time2
+0007bcc0: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+0007bcd0: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
+0007bce0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0007bcf0: 7428 275c 7247 656e 6572 6174 696e 6720  t('\rGenerating 
+0007bd00: 696e 7465 726d 6564 6961 7465 2047 5446  intermediate GTF
+0007bd10: 2061 6e64 2074 7261 6e73 6372 6970 746f   and transcripto
+0007bd20: 6d65 202e 2e20 2569 2c20 2569 2c20 2569  me .. %i, %i, %i
+0007bd30: 2064 6f6e 6520 2825 6929 2020 2720 5c0a   done (%i)  ' \.
+0007bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bd50: 2020 2020 2020 2025 2028 6c65 6e28 6661         % (len(fa
+0007bd60: 7374 615f 6c69 6e65 7329 2f32 2c20 6c65  sta_lines)/2, le
+0007bd70: 6e28 6764 7329 2c20 636e 745f 6e6f 6e65  n(gds), cnt_none
+0007bd80: 2c20 656c 6170 7365 645f 7469 6d65 3229  , elapsed_time2)
+0007bd90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007bda0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007bdb0: 2020 2065 6c61 7073 6564 5f74 696d 6533     elapsed_time3
+0007bdc0: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+0007bdd0: 2073 7461 7274 5f74 696d 650a 0a20 2020   start_time..   
+0007bde0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0007bdf0: 6e74 2827 2020 2025 7320 2825 6929 2720  nt('   %s (%i)' 
+0007be00: 2520 2866 6e61 6d65 5f67 6666 2c20 656c  % (fname_gff, el
+0007be10: 6170 7365 645f 7469 6d65 3329 2029 0a0a  apsed_time3) )..
+0007be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007be30: 6966 2054 7275 653a 2023 2028 6765 6e6f  if True: # (geno
+0007be40: 6d65 5f66 696c 6520 6973 204e 6f6e 6529  me_file is None)
+0007be50: 2026 2028 6774 6620 6973 204e 6f6e 6529   & (gtf is None)
+0007be60: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0007be70: 2020 2020 2020 6e76 5f6c 7374 203d 205b        nv_lst = [
+0007be80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0007be90: 2020 2020 2020 636e 745f 6520 3d20 300a        cnt_e = 0.
+0007bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007beb0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
+0007bec0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0007bed0: 2020 2020 2020 2020 2020 2067 642e 6669             gd.fi
+0007bee0: 6e64 5f73 6e70 5f66 726f 6d5f 7267 6e73  nd_snp_from_rgns
+0007bef0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0007bf00: 2020 2020 2020 2020 2020 206e 765f 6c73             nv_ls
+0007bf10: 745f 746d 702c 2063 6e74 5f65 203d 2067  t_tmp, cnt_e = g
+0007bf20: 642e 6765 745f 6765 6e65 5f6c 6576 656c  d.get_gene_level
+0007bf30: 5f6e 765f 696e 666f 2863 6e74 5f65 290a  _nv_info(cnt_e).
+0007bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bf50: 2020 2020 2020 2020 6e76 5f6c 7374 203d          nv_lst =
+0007bf60: 206e 765f 6c73 7420 2b20 6e76 5f6c 7374   nv_lst + nv_lst
+0007bf70: 5f74 6d70 0a0a 2020 2020 2020 2020 2020  _tmp..          
+0007bf80: 2020 2020 2020 2020 2020 6466 203d 2070            df = p
+0007bf90: 642e 4461 7461 4672 616d 6528 6e76 5f6c  d.DataFrame(nv_l
+0007bfa0: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
+0007bfb0: 2020 2020 2020 2020 6466 5f73 6e76 203d          df_snv =
+0007bfc0: 2064 665b 5b27 6368 7227 2c20 2770 6f73   df[['chr', 'pos
+0007bfd0: 5f72 6566 272c 2027 7265 665f 7365 7127  _ref', 'ref_seq'
+0007bfe0: 2c20 2761 6c74 5f73 6571 272c 2027 6376  , 'alt_seq', 'cv
+0007bff0: 675f 6465 7074 6827 2c20 2763 7667 5f66  g_depth', 'cvg_f
+0007c000: 7261 6327 2c20 2776 5f74 7970 6527 2c20  rac', 'v_type', 
+0007c010: 2776 5f6c 656e 272c 2027 765f 636c 6173  'v_len', 'v_clas
+0007c020: 7327 2c20 2776 5f63 6c61 7373 5f74 7227  s', 'v_class_tr'
+0007c030: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+0007c040: 2020 2020 2020 2064 665f 736e 762e 746f         df_snv.to
+0007c050: 5f63 7376 2866 6e61 6d65 5f73 6e76 2c20  _csv(fname_snv, 
+0007c060: 7365 703d 275c 7427 290a 2020 2020 2020  sep='\t').      
+0007c070: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0007c080: 696e 7428 2753 4e56 2073 756d 6d61 7279  int('SNV summary
+0007c090: 2073 6176 6564 2074 6f20 2850 4520 2569   saved to (PE %i
+0007c0a0: 2920 5c6e 2020 2025 7327 2025 2028 636e  ) \n   %s' % (cn
+0007c0b0: 745f 652c 2066 6e61 6d65 5f73 6e76 2929  t_e, fname_snv))
+0007c0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c0d0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0007c0e0: 2020 7464 5f65 7870 5f69 6e66 6f20 3d20    td_exp_info = 
+0007c0f0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+0007c100: 2020 2066 6f72 206d 2c20 6764 2069 6e20     for m, gd in 
+0007c110: 656e 756d 6572 6174 6528 6764 7329 3a0a  enumerate(gds):.
+0007c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c130: 2020 2020 7469 7320 3d20 6764 2e67 6574      tis = gd.get
+0007c140: 5f74 645f 6578 705f 696e 666f 2829 0a20  _td_exp_info(). 
+0007c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c160: 2020 2074 645f 6578 705f 696e 666f 203d     td_exp_info =
+0007c170: 2074 645f 6578 705f 696e 666f 202b 2074   td_exp_info + t
+0007c180: 6973 0a20 2020 2020 2020 200a 2020 2020  is.        .    
+0007c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c1b0: 2064 665f 7464 5f65 7870 5f69 6e66 6f20   df_td_exp_info 
+0007c1c0: 3d20 7064 2e44 6174 6146 7261 6d65 2874  = pd.DataFrame(t
+0007c1d0: 645f 6578 705f 696e 666f 290a 2020 2020  d_exp_info).    
+0007c1e0: 2020 2020 2020 2020 2020 2020 6162 6e5f              abn_
+0007c1f0: 7375 6d20 3d20 6466 5f74 645f 6578 705f  sum = df_td_exp_
+0007c200: 696e 666f 5b27 6162 6e27 5d2e 7375 6d28  info['abn'].sum(
+0007c210: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007c220: 2020 6966 2061 626e 5f73 756d 203e 2030    if abn_sum > 0
+0007c230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007c240: 2020 2020 2020 6e66 203d 2031 3030 3030        nf = 10000
+0007c250: 3030 2f61 626e 5f73 756d 0a20 2020 2020  00/abn_sum.     
+0007c260: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0007c270: 665f 7464 5f65 7870 5f69 6e66 6f5b 2774  f_td_exp_info['t
+0007c280: 706d 275d 203d 2064 665f 7464 5f65 7870  pm'] = df_td_exp
+0007c290: 5f69 6e66 6f5b 2761 626e 275d 2a6e 660a  _info['abn']*nf.
+0007c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c2c0: 2064 665f 7464 5f65 7870 5f69 6e66 6f2e   df_td_exp_info.
+0007c2d0: 746f 5f63 7376 2866 6e61 6d65 5f65 7870  to_csv(fname_exp
+0007c2e0: 2c20 7365 703d 275c 7427 290a 2020 2020  , sep='\t').    
+0007c2f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0007c300: 7428 2754 7261 6e73 6372 6970 7420 6578  t('Transcript ex
+0007c310: 7072 6573 7369 6f6e 2070 726f 6669 6c65  pression profile
+0007c320: 2073 6176 6564 2074 6f20 5c6e 2020 2025   saved to \n   %
+0007c330: 7327 2025 2066 6e61 6d65 5f65 7870 290a  s' % fname_exp).
+0007c340: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0007c350: 2867 7466 2069 7320 4e6f 6e65 293a 0a0a  (gtf is None):..
+0007c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c370: 5472 5f6c 7374 203d 2054 725f 6c73 7420  Tr_lst = Tr_lst 
+0007c380: 2b20 4973 5f6c 7374 0a20 2020 2020 2020  + Is_lst.       
+0007c390: 2020 2020 2020 2020 2074 725f 7365 6c20           tr_sel 
+0007c3a0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0007c3b0: 2020 2020 2069 6620 6c65 6e28 5472 5f6c       if len(Tr_l
+0007c3c0: 7374 2920 3e20 303a 0a20 2020 2020 2020  st) > 0:.       
+0007c3d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0007c3e0: 2074 7220 696e 2054 725f 6c73 743a 200a   tr in Tr_lst: .
+0007c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c400: 2020 2020 2020 2020 6966 2028 6c65 6e28          if (len(
+0007c410: 7472 2e73 6571 2920 3e3d 206c 656e 5f74  tr.seq) >= len_t
+0007c420: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+0007c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c440: 7472 5f73 656c 2e61 7070 656e 6428 7472  tr_sel.append(tr
+0007c450: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0007c460: 2020 2020 2020 2074 725f 7365 6c20 3d20         tr_sel = 
+0007c470: 6765 745f 7470 6d28 7472 5f73 656c 290a  get_tpm(tr_sel).
+0007c480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c490: 2069 6620 6c65 6e28 7472 5f73 656c 2920   if len(tr_sel) 
+0007c4a0: 3e20 303a 0a0a 2020 2020 2020 2020 2020  > 0:..          
+0007c4b0: 2020 2020 2020 2020 2020 6966 2054 525f            if TR_
+0007c4c0: 4649 4c54 4552 5f53 454c 203d 3d20 313a  FILTER_SEL == 1:
+0007c4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c4e0: 2020 2020 2020 2020 2074 725f 7365 6c20           tr_sel 
+0007c4f0: 3d20 6669 6c74 6572 5f74 7273 5f31 2820  = filter_trs_1( 
+0007c500: 7472 5f73 656c 2c20 7264 5f6c 656e 2c20  tr_sel, rd_len, 
+0007c510: 675f 7468 203d 204d 494e 5f4e 5f52 4453  g_th = MIN_N_RDS
+0007c520: 5f50 4552 5f47 454e 452c 2061 626e 5f74  _PER_GENE, abn_t
+0007c530: 685f 7420 3d20 4d49 4e5f 4142 4e5f 544f  h_t = MIN_ABN_TO
+0007c540: 5f53 454c 2c20 5c0a 2020 2020 2020 2020  _SEL, \.        
 0007c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c560: 2020 2020 2020 2020 2061 626e 5f74 685f           abn_th_
-0007c570: 6920 3d20 4d49 4e5f 4142 4e5f 544f 5f53  i = MIN_ABN_TO_S
-0007c580: 454c 2c20 6973 6f5f 6672 6163 5f74 6820  EL, iso_frac_th 
-0007c590: 3d20 4d49 4e5f 4953 4f5f 4652 4143 2c20  = MIN_ISO_FRAC, 
-0007c5a0: 6c65 6e5f 7468 203d 204d 494e 5f54 525f  len_th = MIN_TR_
-0007c5b0: 4c45 4e47 5448 290a 2020 2020 2020 2020  LENGTH).        
-0007c5c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0007c5d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007c5e0: 2020 2020 2020 2020 2020 7472 5f73 656c            tr_sel
-0007c5f0: 203d 2066 696c 7465 725f 7472 735f 3228   = filter_trs_2(
-0007c600: 2074 725f 7365 6c2c 2072 645f 6c65 6e2c   tr_sel, rd_len,
-0007c610: 2067 5f74 6820 3d20 4d49 4e5f 4e5f 5244   g_th = MIN_N_RD
-0007c620: 535f 5045 525f 4745 4e45 2c20 6162 6e5f  S_PER_GENE, abn_
-0007c630: 7468 5f74 203d 204d 494e 5f41 424e 5f54  th_t = MIN_ABN_T
-0007c640: 4f5f 5345 4c2c 205c 0a20 2020 2020 2020  O_SEL, \.       
-0007c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c570: 2020 2020 2020 2061 626e 5f74 685f 6920         abn_th_i 
+0007c580: 3d20 4d49 4e5f 4142 4e5f 544f 5f53 454c  = MIN_ABN_TO_SEL
+0007c590: 2c20 6973 6f5f 6672 6163 5f74 6820 3d20  , iso_frac_th = 
+0007c5a0: 4d49 4e5f 4953 4f5f 4652 4143 2c20 6c65  MIN_ISO_FRAC, le
+0007c5b0: 6e5f 7468 203d 204d 494e 5f54 525f 4c45  n_th = MIN_TR_LE
+0007c5c0: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
+0007c5d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0007c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c5f0: 2020 2020 2020 2020 7472 5f73 656c 203d          tr_sel =
+0007c600: 2066 696c 7465 725f 7472 735f 3228 2074   filter_trs_2( t
+0007c610: 725f 7365 6c2c 2072 645f 6c65 6e2c 2067  r_sel, rd_len, g
+0007c620: 5f74 6820 3d20 4d49 4e5f 4e5f 5244 535f  _th = MIN_N_RDS_
+0007c630: 5045 525f 4745 4e45 2c20 6162 6e5f 7468  PER_GENE, abn_th
+0007c640: 5f74 203d 204d 494e 5f41 424e 5f54 4f5f  _t = MIN_ABN_TO_
+0007c650: 5345 4c2c 205c 0a20 2020 2020 2020 2020  SEL, \.         
 0007c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c670: 2020 2020 2020 2020 6162 6e5f 7468 5f69          abn_th_i
-0007c680: 203d 204d 494e 5f41 424e 5f54 4f5f 5345   = MIN_ABN_TO_SE
-0007c690: 4c2c 2069 736f 5f66 7261 635f 7468 203d  L, iso_frac_th =
-0007c6a0: 204d 494e 5f49 534f 5f46 5241 432c 206c   MIN_ISO_FRAC, l
-0007c6b0: 656e 5f74 6820 3d20 4d49 4e5f 5452 5f4c  en_th = MIN_TR_L
-0007c6c0: 454e 4754 4829 0a0a 2020 2020 2020 2020  ENGTH)..        
-0007c6d0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
-0007c6e0: 655f 7472 203d 2066 6e61 6d65 202b 2027  e_tr = fname + '
-0007c6f0: 5f74 7261 6e73 6372 6970 746f 6d65 2e66  _transcriptome.f
-0007c700: 6127 0a20 2020 2020 2020 2020 2020 2020  a'.             
-0007c710: 2020 2020 2020 2066 6e61 6d65 5f70 7220         fname_pr 
-0007c720: 3d20 666e 616d 6520 2b20 275f 7072 6f74  = fname + '_prot
-0007c730: 656f 6d65 2e66 6127 0a20 2020 2020 2020  eome.fa'.       
-0007c740: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0007c750: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0007c760: 2753 6176 696e 6720 2e2e 2027 2c20 656e  'Saving .. ', en
-0007c770: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
-0007c780: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0007c790: 2020 2020 2020 2020 2020 7361 7665 5f74            save_t
-0007c7a0: 7261 6e73 6372 6970 7473 3228 2066 6e61  ranscripts2( fna
-0007c7b0: 6d65 5f74 722c 2074 725f 7365 6c20 290a  me_tr, tr_sel ).
-0007c7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c7d0: 2020 2020 2068 6472 5f6c 7374 2c20 7473       hdr_lst, ts
-0007c7e0: 6571 5f6c 7374 203d 206c 6f61 645f 6661  eq_lst = load_fa
-0007c7f0: 7374 6131 2820 666e 616d 655f 7472 2c20  sta1( fname_tr, 
-0007c800: 7665 7262 6f73 6520 3d20 4661 6c73 6529  verbose = False)
-0007c810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c820: 2020 2020 2063 616e 645f 636e 7420 3d20       cand_cnt = 
-0007c830: 6c65 6e28 7473 6571 5f6c 7374 290a 0a20  len(tseq_lst).. 
-0007c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c850: 2020 206c 696e 6573 203d 2067 656e 5f70     lines = gen_p
-0007c860: 726f 7465 6f6d 655f 6672 6f6d 5f74 7261  roteome_from_tra
-0007c870: 7363 7269 7074 6f6d 6528 6864 725f 6c73  scriptome(hdr_ls
-0007c880: 742c 2074 7365 715f 6c73 742c 206c 656e  t, tseq_lst, len
-0007c890: 5f74 6820 3d20 4d49 4e5f 5052 5f4c 454e  _th = MIN_PR_LEN
-0007c8a0: 4754 482c 2076 6572 626f 7365 203d 2046  GTH, verbose = F
-0007c8b0: 616c 7365 2c20 7472 6172 6563 6f20 3d20  alse, trareco = 
-0007c8c0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-0007c8d0: 2020 2020 2020 2020 2020 2070 5f63 616e             p_can
-0007c8e0: 645f 636e 7420 3d20 6c65 6e28 6c69 6e65  d_cnt = len(line
-0007c8f0: 7329 2f32 0a20 2020 2020 2020 2020 2020  s)/2.           
-0007c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c910: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0007c920: 2020 2020 2020 6620 3d20 6f70 656e 2866        f = open(f
-0007c930: 6e61 6d65 5f70 722c 2777 2b27 290a 2020  name_pr,'w+').  
-0007c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c950: 2020 662e 7772 6974 656c 696e 6573 286c    f.writelines(l
-0007c960: 696e 6573 290a 2020 2020 2020 2020 2020  ines).          
-0007c970: 2020 2020 2020 2020 2020 662e 636c 6f73            f.clos
-0007c980: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
-0007c990: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0007c9a0: 2064 6f6e 652e 2729 0a20 2020 2020 2020   done.').       
-0007c9b0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0007c9c0: 6e74 2827 2020 2025 7327 2025 2028 666e  nt('   %s' % (fn
-0007c9d0: 616d 655f 7472 2920 290a 2020 2020 2020  ame_tr) ).      
-0007c9e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0007c9f0: 696e 7428 2720 2020 2573 2720 2520 2866  int('   %s' % (f
-0007ca00: 6e61 6d65 5f70 7229 2029 0a20 2020 2020  name_pr) ).     
-0007ca10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0007ca20: 7269 6e74 2827 2020 2025 7327 2025 2028  rint('   %s' % (
-0007ca30: 666e 616d 655f 6766 6629 2029 0a0a 2020  fname_gff) )..  
-0007ca40: 2020 2320 7072 696e 7428 2753 7472 696e    # print('Strin
-0007ca50: 6746 6978 5f61 6e61 6c79 7369 7320 6669  gFix_analysis fi
-0007ca60: 6e69 7368 6564 2027 2c20 6461 7465 7469  nished ', dateti
-0007ca70: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
-0007ca80: 2929 0a20 2020 2072 6574 7572 6e20 666e  )).    return fn
-0007ca90: 616d 652c 2067 6473 200a 0a0a 4765 6e65  ame, gds ...Gene
-0007caa0: 5f54 725f 696e 666f 203d 2063 6f6c 6c65  _Tr_info = colle
-0007cab0: 6374 696f 6e73 2e6e 616d 6564 7475 706c  ctions.namedtupl
-0007cac0: 6528 2747 656e 655f 5472 5f69 6e66 6f27  e('Gene_Tr_info'
-0007cad0: 2c20 2774 725f 6964 2c20 7472 5f6e 616d  , 'tr_id, tr_nam
-0007cae0: 652c 2067 656e 655f 6964 2c20 6765 6e65  e, gene_id, gene
-0007caf0: 5f6e 616d 652c 2062 696f 7479 7065 2c20  _name, biotype, 
-0007cb00: 6368 722c 2073 7461 7274 2c20 656e 642c  chr, start, end,
-0007cb10: 2073 7472 616e 642c 2063 6f64 696e 672c   strand, coding,
-0007cb20: 206e 756d 5f65 786f 6e73 2c20 7472 5f6c   num_exons, tr_l
-0007cb30: 656e 2720 290a 0a64 6566 2062 7569 6c64  en' )..def build
-0007cb40: 5f67 656e 655f 7472 616e 7363 7269 7074  _gene_transcript
-0007cb50: 5f74 6162 6c65 2820 6774 665f 6669 6c65  _table( gtf_file
-0007cb60: 2029 3a0a 0a20 2020 2067 7466 5f6c 696e   ):..    gtf_lin
-0007cb70: 6573 2c20 6864 725f 6c69 6e65 7320 3d20  es, hdr_lines = 
-0007cb80: 6c6f 6164 5f67 7466 2820 6774 665f 6669  load_gtf( gtf_fi
-0007cb90: 6c65 2c20 7665 7262 6f73 6520 3d20 5472  le, verbose = Tr
-0007cba0: 7565 290a 2020 2020 6764 5f6c 7374 2c20  ue).    gd_lst, 
-0007cbb0: 6368 7273 203d 2067 6574 5f67 656e 655f  chrs = get_gene_
-0007cbc0: 6465 7363 7269 7074 6f72 2867 7466 5f6c  descriptor(gtf_l
-0007cbd0: 696e 6573 2c20 6765 6e6f 6d65 203d 204e  ines, genome = N
-0007cbe0: 6f6e 652c 2066 696c 6c20 3d20 4661 6c73  one, fill = Fals
-0007cbf0: 652c 205c 0a20 2020 2020 2020 2020 2020  e, \.           
-0007cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c680: 2020 2020 2020 6162 6e5f 7468 5f69 203d        abn_th_i =
+0007c690: 204d 494e 5f41 424e 5f54 4f5f 5345 4c2c   MIN_ABN_TO_SEL,
+0007c6a0: 2069 736f 5f66 7261 635f 7468 203d 204d   iso_frac_th = M
+0007c6b0: 494e 5f49 534f 5f46 5241 432c 206c 656e  IN_ISO_FRAC, len
+0007c6c0: 5f74 6820 3d20 4d49 4e5f 5452 5f4c 454e  _th = MIN_TR_LEN
+0007c6d0: 4754 4829 0a0a 2020 2020 2020 2020 2020  GTH)..          
+0007c6e0: 2020 2020 2020 2020 2020 666e 616d 655f            fname_
+0007c6f0: 7472 203d 2066 6e61 6d65 202b 2027 5f74  tr = fname + '_t
+0007c700: 7261 6e73 6372 6970 746f 6d65 2e66 6127  ranscriptome.fa'
+0007c710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c720: 2020 2020 2066 6e61 6d65 5f70 7220 3d20       fname_pr = 
+0007c730: 666e 616d 6520 2b20 275f 7072 6f74 656f  fname + '_proteo
+0007c740: 6d65 2e66 6127 0a20 2020 2020 2020 2020  me.fa'.         
+0007c750: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0007c760: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+0007c770: 6176 696e 6720 2e2e 2027 2c20 656e 6420  aving .. ', end 
+0007c780: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
+0007c790: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0007c7a0: 2020 2020 2020 2020 7361 7665 5f74 7261          save_tra
+0007c7b0: 6e73 6372 6970 7473 3228 2066 6e61 6d65  nscripts2( fname
+0007c7c0: 5f74 722c 2074 725f 7365 6c20 290a 0a20  _tr, tr_sel ).. 
+0007c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c7e0: 2020 2068 6472 5f6c 7374 2c20 7473 6571     hdr_lst, tseq
+0007c7f0: 5f6c 7374 203d 206c 6f61 645f 6661 7374  _lst = load_fast
+0007c800: 6131 2820 666e 616d 655f 7472 2c20 7665  a1( fname_tr, ve
+0007c810: 7262 6f73 6520 3d20 4661 6c73 6529 0a20  rbose = False). 
+0007c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c830: 2020 2063 616e 645f 636e 7420 3d20 6c65     cand_cnt = le
+0007c840: 6e28 7473 6571 5f6c 7374 290a 0a20 2020  n(tseq_lst)..   
+0007c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c860: 206c 696e 6573 203d 2067 656e 5f70 726f   lines = gen_pro
+0007c870: 7465 6f6d 655f 6672 6f6d 5f74 7261 7363  teome_from_trasc
+0007c880: 7269 7074 6f6d 6528 6864 725f 6c73 742c  riptome(hdr_lst,
+0007c890: 2074 7365 715f 6c73 742c 206c 656e 5f74   tseq_lst, len_t
+0007c8a0: 6820 3d20 4d49 4e5f 5052 5f4c 454e 4754  h = MIN_PR_LENGT
+0007c8b0: 482c 2076 6572 626f 7365 203d 2046 616c  H, verbose = Fal
+0007c8c0: 7365 2c20 7472 6172 6563 6f20 3d20 4661  se, trareco = Fa
+0007c8d0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+0007c8e0: 2020 2020 2020 2020 2070 5f63 616e 645f           p_cand_
+0007c8f0: 636e 7420 3d20 6c65 6e28 6c69 6e65 7329  cnt = len(lines)
+0007c900: 2f32 0a20 2020 2020 2020 2020 2020 2020  /2.             
+0007c910: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0007c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c930: 2020 2020 6620 3d20 6f70 656e 2866 6e61      f = open(fna
+0007c940: 6d65 5f70 722c 2777 2b27 290a 2020 2020  me_pr,'w+').    
+0007c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c960: 662e 7772 6974 656c 696e 6573 286c 696e  f.writelines(lin
+0007c970: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0007c980: 2020 2020 2020 2020 662e 636c 6f73 6528          f.close(
+0007c990: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0007c9a0: 2020 2020 2020 2070 7269 6e74 2827 2064         print(' d
+0007c9b0: 6f6e 652e 2729 0a20 2020 2020 2020 2020  one.').         
+0007c9c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0007c9d0: 2827 2020 2025 7327 2025 2028 666e 616d  ('   %s' % (fnam
+0007c9e0: 655f 7472 2920 290a 2020 2020 2020 2020  e_tr) ).        
+0007c9f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0007ca00: 7428 2720 2020 2573 2720 2520 2866 6e61  t('   %s' % (fna
+0007ca10: 6d65 5f70 7229 2029 0a20 2020 2020 2020  me_pr) ).       
+0007ca20: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0007ca30: 6e74 2827 2020 2025 7327 2025 2028 666e  nt('   %s' % (fn
+0007ca40: 616d 655f 6766 6629 2029 0a0a 2020 2020  ame_gff) )..    
+0007ca50: 2320 7072 696e 7428 2753 7472 696e 6746  # print('StringF
+0007ca60: 6978 5f61 6e61 6c79 7369 7320 6669 6e69  ix_analysis fini
+0007ca70: 7368 6564 2027 2c20 6461 7465 7469 6d65  shed ', datetime
+0007ca80: 2e64 6174 6574 696d 652e 6e6f 7728 2929  .datetime.now())
+0007ca90: 0a20 2020 2072 6574 7572 6e20 666e 616d  .    return fnam
+0007caa0: 652c 2067 6473 200a 0a0a 4765 6e65 5f54  e, gds ...Gene_T
+0007cab0: 725f 696e 666f 203d 2063 6f6c 6c65 6374  r_info = collect
+0007cac0: 696f 6e73 2e6e 616d 6564 7475 706c 6528  ions.namedtuple(
+0007cad0: 2747 656e 655f 5472 5f69 6e66 6f27 2c20  'Gene_Tr_info', 
+0007cae0: 2774 725f 6964 2c20 7472 5f6e 616d 652c  'tr_id, tr_name,
+0007caf0: 2067 656e 655f 6964 2c20 6765 6e65 5f6e   gene_id, gene_n
+0007cb00: 616d 652c 2062 696f 7479 7065 2c20 6368  ame, biotype, ch
+0007cb10: 722c 2073 7461 7274 2c20 656e 642c 2073  r, start, end, s
+0007cb20: 7472 616e 642c 2063 6f64 696e 672c 206e  trand, coding, n
+0007cb30: 756d 5f65 786f 6e73 2c20 7472 5f6c 656e  um_exons, tr_len
+0007cb40: 2720 290a 0a64 6566 2062 7569 6c64 5f67  ' )..def build_g
+0007cb50: 656e 655f 7472 616e 7363 7269 7074 5f74  ene_transcript_t
+0007cb60: 6162 6c65 2820 6774 665f 6669 6c65 2029  able( gtf_file )
+0007cb70: 3a0a 0a20 2020 2067 7466 5f6c 696e 6573  :..    gtf_lines
+0007cb80: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
+0007cb90: 6164 5f67 7466 2820 6774 665f 6669 6c65  ad_gtf( gtf_file
+0007cba0: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
+0007cbb0: 290a 2020 2020 6764 5f6c 7374 2c20 6368  ).    gd_lst, ch
+0007cbc0: 7273 203d 2067 6574 5f67 656e 655f 6465  rs = get_gene_de
+0007cbd0: 7363 7269 7074 6f72 2867 7466 5f6c 696e  scriptor(gtf_lin
+0007cbe0: 6573 2c20 6765 6e6f 6d65 203d 204e 6f6e  es, genome = Non
+0007cbf0: 652c 2066 696c 6c20 3d20 4661 6c73 652c  e, fill = False,
+0007cc00: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
 0007cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0007cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cc30: 2020 2076 6572 626f 7365 203d 2054 7275     verbose = Tru
-0007cc40: 652c 206e 5f63 6f72 6573 203d 2031 290a  e, n_cores = 1).
-0007cc50: 2020 2020 6465 6c20 6774 665f 6c69 6e65      del gtf_line
-0007cc60: 730a 0a20 2020 2063 6872 5f6c 7374 203d  s..    chr_lst =
-0007cc70: 206c 6973 7428 7365 7428 6368 7273 2929   list(set(chrs))
-0007cc80: 0a20 2020 2063 6872 5f6c 7374 2e73 6f72  .    chr_lst.sor
-0007cc90: 7428 290a 2020 2020 6368 7273 203d 206e  t().    chrs = n
-0007cca0: 702e 6172 7261 7928 6368 7273 290a 0a20  p.array(chrs).. 
-0007ccb0: 2020 2067 745f 6c73 7420 3d20 5b5d 0a20     gt_lst = []. 
-0007ccc0: 2020 2066 6f72 2063 6872 6d20 696e 2063     for chrm in c
-0007ccd0: 6872 5f6c 7374 3a0a 2020 2020 2020 2020  hr_lst:.        
-0007cce0: 7768 203d 2077 6869 6368 2863 6872 7320  wh = which(chrs 
-0007ccf0: 3d3d 2063 6872 6d29 0a0a 2020 2020 2020  == chrm)..      
-0007cd00: 2020 735f 706f 7320 3d20 6e70 2e7a 6572    s_pos = np.zer
-0007cd10: 6f73 286c 656e 2877 6829 290a 2020 2020  os(len(wh)).    
-0007cd20: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
-0007cd30: 6765 286c 656e 2877 6829 293a 200a 2020  ge(len(wh)): .  
-0007cd40: 2020 2020 2020 2020 2020 735f 706f 735b            s_pos[
-0007cd50: 6b5d 203d 2067 645f 6c73 745b 7768 5b6b  k] = gd_lst[wh[k
-0007cd60: 5d5d 2e62 6567 696e 0a20 2020 2020 2020  ]].begin.       
-0007cd70: 206f 6472 203d 2073 5f70 6f73 2e61 7267   odr = s_pos.arg
-0007cd80: 736f 7274 2829 0a0a 2020 2020 2020 2020  sort()..        
-0007cd90: 6764 5f73 656c 5f6f 7264 6572 6564 203d  gd_sel_ordered =
-0007cda0: 205b 6764 5f6c 7374 5b77 685b 6f64 725b   [gd_lst[wh[odr[
-0007cdb0: 6b5d 5d5d 2066 6f72 206b 2069 6e20 7261  k]]] for k in ra
-0007cdc0: 6e67 6528 6c65 6e28 7768 2929 5d0a 0a20  nge(len(wh))].. 
-0007cdd0: 2020 2020 2020 2066 6f72 206b 2c20 6764         for k, gd
-0007cde0: 2069 6e20 656e 756d 6572 6174 6528 6764   in enumerate(gd
-0007cdf0: 5f73 656c 5f6f 7264 6572 6564 293a 0a20  _sel_ordered):. 
-0007ce00: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-0007ce10: 2c20 7464 2069 6e20 656e 756d 6572 6174  , td in enumerat
-0007ce20: 6528 6764 2e74 645f 6c73 7429 3a0a 2020  e(gd.td_lst):.  
-0007ce30: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0007ce40: 6420 3d20 7464 2e74 6964 0a20 2020 2020  d = td.tid.     
-0007ce50: 2020 2020 2020 2020 2020 2074 6e61 6d65             tname
-0007ce60: 203d 2074 642e 746e 616d 650a 2020 2020   = td.tname.    
-0007ce70: 2020 2020 2020 2020 2020 2020 6769 6420              gid 
-0007ce80: 3d20 7464 2e67 6964 0a20 2020 2020 2020  = td.gid.       
-0007ce90: 2020 2020 2020 2020 2067 6e61 6d65 203d           gname =
-0007cea0: 2074 642e 676e 616d 650a 2020 2020 2020   td.gname.      
-0007ceb0: 2020 2020 2020 2020 2020 6269 6f74 7970            biotyp
-0007cec0: 6520 3d20 7464 2e62 696f 7479 7065 0a20  e = td.biotype. 
-0007ced0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0007cee0: 7461 7274 203d 2074 642e 6265 6769 6e0a  tart = td.begin.
-0007cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cf00: 656e 6420 3d20 7464 2e65 6e64 0a20 2020  end = td.end.   
-0007cf10: 2020 2020 2020 2020 2020 2020 206e 5f65               n_e
-0007cf20: 7820 3d20 7464 2e6e 6578 6f6e 730a 2020  x = td.nexons.  
-0007cf30: 2020 2020 2020 2020 2020 2020 2020 746c                tl
-0007cf40: 656e 203d 2074 642e 746c 656e 0a20 2020  en = td.tlen.   
-0007cf50: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0007cf60: 616e 6420 3d20 6765 745f 635f 6672 6f6d  and = get_c_from
-0007cf70: 5f69 7374 7261 6e64 2820 7464 2e69 7374  _istrand( td.ist
-0007cf80: 7261 6e64 2029 0a20 2020 2020 2020 2020  rand ).         
-0007cf90: 2020 2020 2020 2063 6473 203d 2067 6574         cds = get
-0007cfa0: 5f73 7472 5f66 726f 6d5f 6963 646e 6728  _str_from_icdng(
-0007cfb0: 2074 642e 6963 6473 2029 0a0a 2020 2020   td.icds )..    
-0007cfc0: 2020 2020 2020 2020 2020 2020 6774 6520              gte 
-0007cfd0: 3d20 4765 6e65 5f54 725f 696e 666f 2820  = Gene_Tr_info( 
-0007cfe0: 7469 642c 2074 6e61 6d65 2c20 6769 642c  tid, tname, gid,
-0007cff0: 2067 6e61 6d65 2c20 6269 6f74 7970 652c   gname, biotype,
-0007d000: 2063 6872 6d2c 2073 7461 7274 2c20 656e   chrm, start, en
-0007d010: 642c 2073 7472 616e 642c 2063 6473 2c20  d, strand, cds, 
-0007d020: 6e5f 6578 2c20 746c 656e 2029 0a20 2020  n_ex, tlen ).   
-0007d030: 2020 2020 2020 2020 2020 2020 2067 745f               gt_
-0007d040: 6c73 742e 6170 7065 6e64 2867 7465 290a  lst.append(gte).
-0007d050: 0a20 2020 2070 7269 6e74 2827 5c6e 5361  .    print('\nSa
-0007d060: 7669 6e67 202e 2e20 2027 2c20 656e 6420  ving ..  ', end 
-0007d070: 3d20 2727 290a 2020 2020 6466 203d 2070  = '').    df = p
-0007d080: 642e 4461 7461 4672 616d 6528 6774 5f6c  d.DataFrame(gt_l
-0007d090: 7374 290a 2020 2020 6669 6c65 5f6f 7574  st).    file_out
-0007d0a0: 203d 2067 7466 5f66 696c 6520 2b20 272e   = gtf_file + '.
-0007d0b0: 7472 616e 7363 7269 7074 5f69 6e66 6f2e  transcript_info.
-0007d0c0: 7473 7627 0a20 2020 2064 662e 746f 5f63  tsv'.    df.to_c
-0007d0d0: 7376 2866 696c 655f 6f75 742c 2073 6570  sv(file_out, sep
-0007d0e0: 203d 2027 5c74 2729 0a20 2020 2070 7269   = '\t').    pri
-0007d0f0: 6e74 2827 646f 6e65 2e27 290a 0a20 2020  nt('done.')..   
-0007d100: 2070 7269 6e74 2827 5472 616e 7363 7269   print('Transcri
-0007d110: 7074 2069 6e66 6f2e 2073 6176 6564 2074  pt info. saved t
-0007d120: 6f20 2573 2720 2520 6669 6c65 5f6f 7574  o %s' % file_out
-0007d130: 290a 0a20 2020 2072 6574 7572 6e20 6774  )..    return gt
-0007d140: 5f6c 7374 0a0a 2727 270a 6465 6620 4765  _lst..'''.def Ge
-0007d150: 6e65 7261 7465 5f50 726f 7465 6f6d 6528  nerate_Proteome(
-0007d160: 7472 5f66 612c 206c 656e 5f74 6820 3d20  tr_fa, len_th = 
-0007d170: 4d49 4e5f 5052 5f4c 454e 4754 482c 2076  MIN_PR_LENGTH, v
-0007d180: 6572 626f 7365 203d 2054 7275 652c 206d  erbose = True, m
-0007d190: 785f 636e 7420 3d20 302c 2074 7261 7265  x_cnt = 0, trare
-0007d1a0: 636f 203d 2046 616c 7365 2c20 666e 616d  co = False, fnam
-0007d1b0: 655f 6f75 7420 3d20 4e6f 6e65 293a 0a20  e_out = None):. 
-0007d1c0: 2020 200a 2020 2020 6669 6c65 5f6e 616d     .    file_nam
-0007d1d0: 6520 3d20 7472 5f66 612e 7370 6c69 7428  e = tr_fa.split(
-0007d1e0: 272f 2729 5b2d 315d 0a20 2020 2066 6e73  '/')[-1].    fns
-0007d1f0: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
-0007d200: 6974 2827 2e27 295b 3a2d 315d 0a20 2020  it('.')[:-1].   
-0007d210: 2066 6e61 6d65 203d 2027 270a 2020 2020   fname = ''.    
-0007d220: 666f 7220 6b2c 2066 6e20 696e 2065 6e75  for k, fn in enu
-0007d230: 6d65 7261 7465 2866 6e73 293a 0a20 2020  merate(fns):.   
-0007d240: 2020 2020 2069 6620 6b20 3e20 303a 0a20       if k > 0:. 
-0007d250: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-0007d260: 203d 2066 6e61 6d65 202b 2027 2e27 0a20   = fname + '.'. 
-0007d270: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
-0007d280: 6e61 6d65 202b 2066 6e0a 2020 2020 0a20  name + fn.    . 
-0007d290: 2020 2068 6472 5f6c 7374 2c20 7473 6571     hdr_lst, tseq
-0007d2a0: 5f6c 7374 203d 206c 6f61 645f 6661 7374  _lst = load_fast
-0007d2b0: 6131 2874 725f 6661 2c20 7665 7262 6f73  a1(tr_fa, verbos
-0007d2c0: 6520 3d20 4661 6c73 6529 0a20 2020 2063  e = False).    c
-0007d2d0: 616e 645f 636e 7420 3d20 6c65 6e28 7473  and_cnt = len(ts
-0007d2e0: 6571 5f6c 7374 290a 0a20 2020 206c 696e  eq_lst)..    lin
-0007d2f0: 6573 203d 2067 656e 5f70 726f 7465 6f6d  es = gen_proteom
-0007d300: 655f 6672 6f6d 5f74 7261 7363 7269 7074  e_from_trascript
-0007d310: 6f6d 6528 6864 725f 6c73 742c 2074 7365  ome(hdr_lst, tse
-0007d320: 715f 6c73 742c 206c 656e 5f74 6820 3d20  q_lst, len_th = 
-0007d330: 6c65 6e5f 7468 2c20 7665 7262 6f73 6520  len_th, verbose 
-0007d340: 3d20 7665 7262 6f73 652c 2074 7261 7265  = verbose, trare
-0007d350: 636f 203d 2074 7261 7265 636f 290a 2020  co = trareco).  
-0007d360: 2020 705f 6361 6e64 5f63 6e74 203d 206c    p_cand_cnt = l
-0007d370: 656e 286c 696e 6573 292f 320a 2020 2020  en(lines)/2.    
-0007d380: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
-0007d390: 666e 616d 655f 6f75 7420 6973 204e 6f6e  fname_out is Non
-0007d3a0: 653a 2066 6e61 6d65 5f6f 7574 203d 2066  e: fname_out = f
-0007d3b0: 6e61 6d65 202b 2027 5f70 726f 7465 6f6d  name + '_proteom
-0007d3c0: 652e 6661 270a 2020 2020 6620 3d20 6f70  e.fa'.    f = op
-0007d3d0: 656e 2866 6e61 6d65 5f6f 7574 2c27 772b  en(fname_out,'w+
-0007d3e0: 2729 0a20 2020 2066 2e77 7269 7465 6c69  ').    f.writeli
-0007d3f0: 6e65 7328 6c69 6e65 7329 0a20 2020 2066  nes(lines).    f
-0007d400: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-0007d410: 2020 2020 2020 2020 200a 2020 2020 6966           .    if
-0007d420: 2076 6572 626f 7365 3a20 0a20 2020 2020   verbose: .     
-0007d430: 2020 2070 7269 6e74 2827 4141 5365 7120     print('AASeq 
-0007d440: 7361 7665 6420 746f 2025 7327 2025 2028  saved to %s' % (
-0007d450: 666e 616d 655f 6f75 7429 290a 2020 2020  fname_out)).    
-0007d460: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
-0007d470: 666e 616d 655f 6f75 740a 2727 270a 0a23  fname_out.'''..#
-0007d480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cc40: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
+0007cc50: 206e 5f63 6f72 6573 203d 2031 290a 2020   n_cores = 1).  
+0007cc60: 2020 6465 6c20 6774 665f 6c69 6e65 730a    del gtf_lines.
+0007cc70: 0a20 2020 2063 6872 5f6c 7374 203d 206c  .    chr_lst = l
+0007cc80: 6973 7428 7365 7428 6368 7273 2929 0a20  ist(set(chrs)). 
+0007cc90: 2020 2063 6872 5f6c 7374 2e73 6f72 7428     chr_lst.sort(
+0007cca0: 290a 2020 2020 6368 7273 203d 206e 702e  ).    chrs = np.
+0007ccb0: 6172 7261 7928 6368 7273 290a 0a20 2020  array(chrs)..   
+0007ccc0: 2067 745f 6c73 7420 3d20 5b5d 0a20 2020   gt_lst = [].   
+0007ccd0: 2066 6f72 2063 6872 6d20 696e 2063 6872   for chrm in chr
+0007cce0: 5f6c 7374 3a0a 2020 2020 2020 2020 7768  _lst:.        wh
+0007ccf0: 203d 2077 6869 6368 2863 6872 7320 3d3d   = which(chrs ==
+0007cd00: 2063 6872 6d29 0a0a 2020 2020 2020 2020   chrm)..        
+0007cd10: 735f 706f 7320 3d20 6e70 2e7a 6572 6f73  s_pos = np.zeros
+0007cd20: 286c 656e 2877 6829 290a 2020 2020 2020  (len(wh)).      
+0007cd30: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
+0007cd40: 286c 656e 2877 6829 293a 200a 2020 2020  (len(wh)): .    
+0007cd50: 2020 2020 2020 2020 735f 706f 735b 6b5d          s_pos[k]
+0007cd60: 203d 2067 645f 6c73 745b 7768 5b6b 5d5d   = gd_lst[wh[k]]
+0007cd70: 2e62 6567 696e 0a20 2020 2020 2020 206f  .begin.        o
+0007cd80: 6472 203d 2073 5f70 6f73 2e61 7267 736f  dr = s_pos.argso
+0007cd90: 7274 2829 0a0a 2020 2020 2020 2020 6764  rt()..        gd
+0007cda0: 5f73 656c 5f6f 7264 6572 6564 203d 205b  _sel_ordered = [
+0007cdb0: 6764 5f6c 7374 5b77 685b 6f64 725b 6b5d  gd_lst[wh[odr[k]
+0007cdc0: 5d5d 2066 6f72 206b 2069 6e20 7261 6e67  ]] for k in rang
+0007cdd0: 6528 6c65 6e28 7768 2929 5d0a 0a20 2020  e(len(wh))]..   
+0007cde0: 2020 2020 2066 6f72 206b 2c20 6764 2069       for k, gd i
+0007cdf0: 6e20 656e 756d 6572 6174 6528 6764 5f73  n enumerate(gd_s
+0007ce00: 656c 5f6f 7264 6572 6564 293a 0a20 2020  el_ordered):.   
+0007ce10: 2020 2020 2020 2020 2066 6f72 206d 2c20           for m, 
+0007ce20: 7464 2069 6e20 656e 756d 6572 6174 6528  td in enumerate(
+0007ce30: 6764 2e74 645f 6c73 7429 3a0a 2020 2020  gd.td_lst):.    
+0007ce40: 2020 2020 2020 2020 2020 2020 7469 6420              tid 
+0007ce50: 3d20 7464 2e74 6964 0a20 2020 2020 2020  = td.tid.       
+0007ce60: 2020 2020 2020 2020 2074 6e61 6d65 203d           tname =
+0007ce70: 2074 642e 746e 616d 650a 2020 2020 2020   td.tname.      
+0007ce80: 2020 2020 2020 2020 2020 6769 6420 3d20            gid = 
+0007ce90: 7464 2e67 6964 0a20 2020 2020 2020 2020  td.gid.         
+0007cea0: 2020 2020 2020 2067 6e61 6d65 203d 2074         gname = t
+0007ceb0: 642e 676e 616d 650a 2020 2020 2020 2020  d.gname.        
+0007cec0: 2020 2020 2020 2020 6269 6f74 7970 6520          biotype 
+0007ced0: 3d20 7464 2e62 696f 7479 7065 0a20 2020  = td.biotype.   
+0007cee0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0007cef0: 7274 203d 2074 642e 6265 6769 6e0a 2020  rt = td.begin.  
+0007cf00: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0007cf10: 6420 3d20 7464 2e65 6e64 0a20 2020 2020  d = td.end.     
+0007cf20: 2020 2020 2020 2020 2020 206e 5f65 7820             n_ex 
+0007cf30: 3d20 7464 2e6e 6578 6f6e 730a 2020 2020  = td.nexons.    
+0007cf40: 2020 2020 2020 2020 2020 2020 746c 656e              tlen
+0007cf50: 203d 2074 642e 746c 656e 0a20 2020 2020   = td.tlen.     
+0007cf60: 2020 2020 2020 2020 2020 2073 7472 616e             stran
+0007cf70: 6420 3d20 6765 745f 635f 6672 6f6d 5f69  d = get_c_from_i
+0007cf80: 7374 7261 6e64 2820 7464 2e69 7374 7261  strand( td.istra
+0007cf90: 6e64 2029 0a20 2020 2020 2020 2020 2020  nd ).           
+0007cfa0: 2020 2020 2063 6473 203d 2067 6574 5f73       cds = get_s
+0007cfb0: 7472 5f66 726f 6d5f 6963 646e 6728 2074  tr_from_icdng( t
+0007cfc0: 642e 6963 6473 2029 0a0a 2020 2020 2020  d.icds )..      
+0007cfd0: 2020 2020 2020 2020 2020 6774 6520 3d20            gte = 
+0007cfe0: 4765 6e65 5f54 725f 696e 666f 2820 7469  Gene_Tr_info( ti
+0007cff0: 642c 2074 6e61 6d65 2c20 6769 642c 2067  d, tname, gid, g
+0007d000: 6e61 6d65 2c20 6269 6f74 7970 652c 2063  name, biotype, c
+0007d010: 6872 6d2c 2073 7461 7274 2c20 656e 642c  hrm, start, end,
+0007d020: 2073 7472 616e 642c 2063 6473 2c20 6e5f   strand, cds, n_
+0007d030: 6578 2c20 746c 656e 2029 0a20 2020 2020  ex, tlen ).     
+0007d040: 2020 2020 2020 2020 2020 2067 745f 6c73             gt_ls
+0007d050: 742e 6170 7065 6e64 2867 7465 290a 0a20  t.append(gte).. 
+0007d060: 2020 2070 7269 6e74 2827 5c6e 5361 7669     print('\nSavi
+0007d070: 6e67 202e 2e20 2027 2c20 656e 6420 3d20  ng ..  ', end = 
+0007d080: 2727 290a 2020 2020 6466 203d 2070 642e  '').    df = pd.
+0007d090: 4461 7461 4672 616d 6528 6774 5f6c 7374  DataFrame(gt_lst
+0007d0a0: 290a 2020 2020 6669 6c65 5f6f 7574 203d  ).    file_out =
+0007d0b0: 2067 7466 5f66 696c 6520 2b20 272e 7472   gtf_file + '.tr
+0007d0c0: 616e 7363 7269 7074 5f69 6e66 6f2e 7473  anscript_info.ts
+0007d0d0: 7627 0a20 2020 2064 662e 746f 5f63 7376  v'.    df.to_csv
+0007d0e0: 2866 696c 655f 6f75 742c 2073 6570 203d  (file_out, sep =
+0007d0f0: 2027 5c74 2729 0a20 2020 2070 7269 6e74   '\t').    print
+0007d100: 2827 646f 6e65 2e27 290a 0a20 2020 2070  ('done.')..    p
+0007d110: 7269 6e74 2827 5472 616e 7363 7269 7074  rint('Transcript
+0007d120: 2069 6e66 6f2e 2073 6176 6564 2074 6f20   info. saved to 
+0007d130: 2573 2720 2520 6669 6c65 5f6f 7574 290a  %s' % file_out).
+0007d140: 0a20 2020 2072 6574 7572 6e20 6774 5f6c  .    return gt_l
+0007d150: 7374 0a0a 2727 270a 6465 6620 4765 6e65  st..'''.def Gene
+0007d160: 7261 7465 5f50 726f 7465 6f6d 6528 7472  rate_Proteome(tr
+0007d170: 5f66 612c 206c 656e 5f74 6820 3d20 4d49  _fa, len_th = MI
+0007d180: 4e5f 5052 5f4c 454e 4754 482c 2076 6572  N_PR_LENGTH, ver
+0007d190: 626f 7365 203d 2054 7275 652c 206d 785f  bose = True, mx_
+0007d1a0: 636e 7420 3d20 302c 2074 7261 7265 636f  cnt = 0, trareco
+0007d1b0: 203d 2046 616c 7365 2c20 666e 616d 655f   = False, fname_
+0007d1c0: 6f75 7420 3d20 4e6f 6e65 293a 0a20 2020  out = None):.   
+0007d1d0: 200a 2020 2020 6669 6c65 5f6e 616d 6520   .    file_name 
+0007d1e0: 3d20 7472 5f66 612e 7370 6c69 7428 272f  = tr_fa.split('/
+0007d1f0: 2729 5b2d 315d 0a20 2020 2066 6e73 203d  ')[-1].    fns =
+0007d200: 2066 696c 655f 6e61 6d65 2e73 706c 6974   file_name.split
+0007d210: 2827 2e27 295b 3a2d 315d 0a20 2020 2066  ('.')[:-1].    f
+0007d220: 6e61 6d65 203d 2027 270a 2020 2020 666f  name = ''.    fo
+0007d230: 7220 6b2c 2066 6e20 696e 2065 6e75 6d65  r k, fn in enume
+0007d240: 7261 7465 2866 6e73 293a 0a20 2020 2020  rate(fns):.     
+0007d250: 2020 2069 6620 6b20 3e20 303a 0a20 2020     if k > 0:.   
+0007d260: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
+0007d270: 2066 6e61 6d65 202b 2027 2e27 0a20 2020   fname + '.'.   
+0007d280: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
+0007d290: 6d65 202b 2066 6e0a 2020 2020 0a20 2020  me + fn.    .   
+0007d2a0: 2068 6472 5f6c 7374 2c20 7473 6571 5f6c   hdr_lst, tseq_l
+0007d2b0: 7374 203d 206c 6f61 645f 6661 7374 6131  st = load_fasta1
+0007d2c0: 2874 725f 6661 2c20 7665 7262 6f73 6520  (tr_fa, verbose 
+0007d2d0: 3d20 4661 6c73 6529 0a20 2020 2063 616e  = False).    can
+0007d2e0: 645f 636e 7420 3d20 6c65 6e28 7473 6571  d_cnt = len(tseq
+0007d2f0: 5f6c 7374 290a 0a20 2020 206c 696e 6573  _lst)..    lines
+0007d300: 203d 2067 656e 5f70 726f 7465 6f6d 655f   = gen_proteome_
+0007d310: 6672 6f6d 5f74 7261 7363 7269 7074 6f6d  from_trascriptom
+0007d320: 6528 6864 725f 6c73 742c 2074 7365 715f  e(hdr_lst, tseq_
+0007d330: 6c73 742c 206c 656e 5f74 6820 3d20 6c65  lst, len_th = le
+0007d340: 6e5f 7468 2c20 7665 7262 6f73 6520 3d20  n_th, verbose = 
+0007d350: 7665 7262 6f73 652c 2074 7261 7265 636f  verbose, trareco
+0007d360: 203d 2074 7261 7265 636f 290a 2020 2020   = trareco).    
+0007d370: 705f 6361 6e64 5f63 6e74 203d 206c 656e  p_cand_cnt = len
+0007d380: 286c 696e 6573 292f 320a 2020 2020 2020  (lines)/2.      
+0007d390: 2020 2020 2020 0a20 2020 2069 6620 666e        .    if fn
+0007d3a0: 616d 655f 6f75 7420 6973 204e 6f6e 653a  ame_out is None:
+0007d3b0: 2066 6e61 6d65 5f6f 7574 203d 2066 6e61   fname_out = fna
+0007d3c0: 6d65 202b 2027 5f70 726f 7465 6f6d 652e  me + '_proteome.
+0007d3d0: 6661 270a 2020 2020 6620 3d20 6f70 656e  fa'.    f = open
+0007d3e0: 2866 6e61 6d65 5f6f 7574 2c27 772b 2729  (fname_out,'w+')
+0007d3f0: 0a20 2020 2066 2e77 7269 7465 6c69 6e65  .    f.writeline
+0007d400: 7328 6c69 6e65 7329 0a20 2020 2066 2e63  s(lines).    f.c
+0007d410: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
+0007d420: 2020 2020 2020 200a 2020 2020 6966 2076         .    if v
+0007d430: 6572 626f 7365 3a20 0a20 2020 2020 2020  erbose: .       
+0007d440: 2070 7269 6e74 2827 4141 5365 7120 7361   print('AASeq sa
+0007d450: 7665 6420 746f 2025 7327 2025 2028 666e  ved to %s' % (fn
+0007d460: 616d 655f 6f75 7429 290a 2020 2020 2020  ame_out)).      
+0007d470: 2020 0a20 2020 2072 6574 7572 6e20 666e    .    return fn
+0007d480: 616d 655f 6f75 740a 2727 270a 0a23 2323  ame_out.'''..###
 0007d490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d4a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d4c0: 2323 2323 2323 2323 230a 2323 2053 7472  #########.## Str
-0007d4d0: 696e 6746 6978 2061 6464 6f6e 2773 0a23  ingFix addon's.#
-0007d4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d4d0: 2323 2323 2323 230a 2323 2053 7472 696e  #######.## Strin
+0007d4e0: 6746 6978 2061 6464 6f6e 2773 0a23 2323  gFix addon's.###
 0007d4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d520: 2323 2323 2323 2323 230a 0a64 6566 2074  #########..def t
-0007d530: 7269 6d5f 6865 6164 6572 2866 6e61 6d65  rim_header(fname
-0007d540: 5f66 6129 3a0a 2020 2020 0a20 2020 2066  _fa):.    .    f
-0007d550: 203d 206f 7065 6e28 666e 616d 655f 6661   = open(fname_fa
-0007d560: 2c20 2772 2729 0a20 2020 206c 696e 6573  , 'r').    lines
-0007d570: 203d 205b 5d0a 2020 2020 636e 7420 3d20   = [].    cnt = 
-0007d580: 300a 2020 2020 666f 7220 6c69 6e65 2069  0.    for line i
-0007d590: 6e20 663a 0a20 2020 2020 2020 2069 6620  n f:.        if 
-0007d5a0: 6c69 6e65 5b30 5d20 3d3d 2027 3e27 3a0a  line[0] == '>':.
-0007d5b0: 2020 2020 2020 2020 2020 2020 6864 7220              hdr 
-0007d5c0: 3d20 6c69 6e65 2e73 706c 6974 2827 2027  = line.split(' '
-0007d5d0: 290a 2020 2020 2020 2020 2020 2020 6c69  ).            li
-0007d5e0: 6e65 732e 6170 7065 6e64 2868 6472 5b30  nes.append(hdr[0
-0007d5f0: 5d2b 275c 6e27 290a 2020 2020 2020 2020  ]+'\n').        
-0007d600: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0007d610: 2020 6c69 6e65 732e 6170 7065 6e64 286c    lines.append(l
-0007d620: 696e 6529 0a20 2020 2066 2e63 6c6f 7365  ine).    f.close
-0007d630: 2829 0a20 2020 200a 2020 2020 6620 3d20  ().    .    f = 
-0007d640: 6f70 656e 2866 6e61 6d65 5f66 612c 2027  open(fname_fa, '
-0007d650: 772b 2729 0a20 2020 2066 2e77 7269 7465  w+').    f.write
-0007d660: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
-0007d670: 2066 2e63 6c6f 7365 2829 0a20 2020 200a   f.close().    .
-0007d680: 2020 2020 0a64 6566 2074 7269 6d5f 6865      .def trim_he
-0007d690: 6164 6572 5f61 6e64 5f61 6464 5f73 7472  ader_and_add_str
-0007d6a0: 616e 645f 696e 666f 2866 6e61 6d65 5f66  and_info(fname_f
-0007d6b0: 612c 2067 6666 5f66 696c 6529 3a0a 2020  a, gff_file):.  
-0007d6c0: 2020 0a20 2020 2067 7466 5f6c 696e 6573    .    gtf_lines
-0007d6d0: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
-0007d6e0: 6164 5f67 7466 2867 6666 5f66 696c 652c  ad_gtf(gff_file,
-0007d6f0: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
-0007d700: 0a20 2020 2067 7466 5f6c 696e 6573 5f6c  .    gtf_lines_l
-0007d710: 7374 203d 2070 6172 7365 5f67 7466 5f6c  st = parse_gtf_l
-0007d720: 696e 6573 5f61 6e64 5f73 706c 6974 5f69  ines_and_split_i
-0007d730: 6e74 6f5f 6765 6e65 7328 2067 7466 5f6c  nto_genes( gtf_l
-0007d740: 696e 6573 2c20 675f 6f72 5f74 203d 2027  ines, g_or_t = '
-0007d750: 7472 616e 7363 7269 7074 272c 2076 6572  transcript', ver
-0007d760: 626f 7365 203d 2046 616c 7365 2029 2020  bose = False )  
-0007d770: 2020 0a20 2020 2074 645f 6c73 7420 3d20    .    td_lst = 
-0007d780: 5b5d 0a20 2020 2066 6f72 206c 696e 6573  [].    for lines
-0007d790: 2069 6e20 6774 665f 6c69 6e65 735f 6c73   in gtf_lines_ls
-0007d7a0: 743a 0a20 2020 2020 2020 2074 6420 3d20  t:.        td = 
-0007d7b0: 7472 616e 7363 7269 7074 5f64 6573 6372  transcript_descr
-0007d7c0: 6970 746f 7228 6c69 6e65 7329 0a20 2020  iptor(lines).   
-0007d7d0: 2020 2020 2074 645f 6c73 742e 6170 7065       td_lst.appe
-0007d7e0: 6e64 2874 6429 0a20 2020 2020 2020 2020  nd(td).         
-0007d7f0: 2020 200a 2020 2020 6620 3d20 6f70 656e     .    f = open
-0007d800: 2866 6e61 6d65 5f66 612c 2027 7227 290a  (fname_fa, 'r').
-0007d810: 2020 2020 6c69 6e65 7320 3d20 5b5d 0a20      lines = []. 
-0007d820: 2020 2063 6e74 203d 2030 0a20 2020 2066     cnt = 0.    f
-0007d830: 6f72 206c 696e 6520 696e 2066 3a0a 2020  or line in f:.  
-0007d840: 2020 2020 2020 6966 206c 696e 655b 305d        if line[0]
-0007d850: 203d 3d20 273e 273a 0a20 2020 2020 2020   == '>':.       
-0007d860: 2020 2020 2068 6472 203d 206c 696e 652e       hdr = line.
-0007d870: 7370 6c69 7428 2720 2729 0a20 2020 2020  split(' ').     
-0007d880: 2020 2020 2020 206c 696e 6573 2e61 7070         lines.app
-0007d890: 656e 6428 6864 725b 305d 2b27 2073 7472  end(hdr[0]+' str
-0007d8a0: 616e 643a 2569 5c6e 2720 2520 7464 5f6c  and:%i\n' % td_l
-0007d8b0: 7374 5b63 6e74 5d2e 7374 7261 6e64 2029  st[cnt].strand )
-0007d8c0: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
-0007d8d0: 202b 3d20 310a 2020 2020 2020 2020 656c   += 1.        el
-0007d8e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0007d8f0: 6c69 6e65 732e 6170 7065 6e64 286c 696e  lines.append(lin
-0007d900: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
-0007d910: 0a20 2020 200a 2020 2020 6620 3d20 6f70  .    .    f = op
-0007d920: 656e 2866 6e61 6d65 5f66 612c 2027 772b  en(fname_fa, 'w+
-0007d930: 2729 0a20 2020 2066 2e77 7269 7465 6c69  ').    f.writeli
-0007d940: 6e65 7328 6c69 6e65 7329 0a20 2020 2066  nes(lines).    f
-0007d950: 2e63 6c6f 7365 2829 0a0a 2020 2020 6966  .close()..    if
-0007d960: 2063 6e74 203d 3d20 6c65 6e28 7464 5f6c   cnt == len(td_l
-0007d970: 7374 293a 0a20 2020 2020 2020 2070 7269  st):.        pri
-0007d980: 6e74 2827 4641 5354 4120 6669 6c65 2067  nt('FASTA file g
-0007d990: 656e 6572 6174 6564 2073 7563 6365 7373  enerated success
-0007d9a0: 6675 6c6c 7927 290a 2020 2020 656c 7365  fully').    else
-0007d9b0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-0007d9c0: 2757 4152 4e49 4e47 3a20 2569 207e 3d20  'WARNING: %i ~= 
-0007d9d0: 2569 2720 2520 2863 6e74 2c20 6c65 6e28  %i' % (cnt, len(
-0007d9e0: 7464 5f6c 7374 2929 2029 0a20 2020 2020  td_lst)) ).     
-0007d9f0: 2020 200a 2020 2020 2020 2020 0a64 6566     .        .def
-0007da00: 2053 7472 696e 6746 6978 5f47 4646 5265   StringFix_GFFRe
-0007da10: 6164 2867 7466 5f66 696c 652c 2067 656e  ad(gtf_file, gen
-0007da20: 6f6d 655f 6669 6c65 2c20 6e5f 636f 7265  ome_file, n_core
-0007da30: 7320 3d20 3129 3a0a 2020 2020 0a20 2020  s = 1):.    .   
-0007da40: 2066 696c 655f 6e61 6d65 7320 3d20 6774   file_names = gt
-0007da50: 665f 6669 6c65 2e73 706c 6974 2827 2e27  f_file.split('.'
-0007da60: 290a 2020 2020 666e 616d 6520 3d20 2727  ).    fname = ''
-0007da70: 2e6a 6f69 6e28 7374 2066 6f72 2073 7420  .join(st for st 
-0007da80: 696e 2066 696c 655f 6e61 6d65 735b 3a2d  in file_names[:-
-0007da90: 315d 2029 0a20 2020 200a 2020 2020 6774  1] ).    .    gt
-0007daa0: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
-0007dab0: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
-0007dac0: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
-0007dad0: 3d20 5472 7565 290a 2020 2020 6764 5f6c  = True).    gd_l
-0007dae0: 7374 2c20 6368 7273 203d 2067 6574 5f67  st, chrs = get_g
-0007daf0: 656e 655f 6465 7363 7269 7074 6f72 2867  ene_descriptor(g
-0007db00: 7466 5f6c 696e 6573 2c20 6765 6e6f 6d65  tf_lines, genome
-0007db10: 203d 204e 6f6e 652c 2066 696c 6c20 3d20   = None, fill = 
-0007db20: 4661 6c73 652c 2076 6572 626f 7365 203d  False, verbose =
-0007db30: 2054 7275 652c 206e 5f63 6f72 6573 203d   True, n_cores =
-0007db40: 2031 290a 2020 2020 6764 5f6c 7374 732c   1).    gd_lsts,
-0007db50: 2063 6872 5f6c 7374 203d 2070 6163 6b5f   chr_lst = pack_
-0007db60: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
-0007db70: 2067 645f 6c73 742c 2063 6872 7320 290a   gd_lst, chrs ).
-0007db80: 0a20 2020 2069 6620 6765 6e6f 6d65 5f66  .    if genome_f
-0007db90: 696c 6520 6973 204e 6f6e 653a 2067 656e  ile is None: gen
-0007dba0: 6f6d 6520 3d20 4e6f 6e65 0a20 2020 2065  ome = None.    e
-0007dbb0: 6c73 653a 2067 656e 6f6d 6520 3d20 6c6f  lse: genome = lo
-0007dbc0: 6164 5f67 656e 6f6d 6528 6765 6e6f 6d65  ad_genome(genome
-0007dbd0: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
-0007dbe0: 2054 7275 6529 0a0a 2020 2020 6661 7374   True)..    fast
-0007dbf0: 615f 6c69 6e65 7332 203d 205b 5d0a 2020  a_lines2 = [].  
-0007dc00: 2020 6661 7374 615f 6c69 6e65 7320 3d20    fasta_lines = 
-0007dc10: 5b5d 0a20 2020 2067 6473 203d 205b 5d0a  [].    gds = [].
-0007dc20: 2020 2020 666f 7220 6764 6c20 696e 2067      for gdl in g
-0007dc30: 645f 6c73 7473 3a20 6764 7320 3d20 6764  d_lsts: gds = gd
-0007dc40: 7320 2b20 6764 6c0a 2020 2020 2020 2020  s + gdl.        
-0007dc50: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
-0007dc60: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-0007dc70: 2020 7072 696e 7428 2747 656e 6572 6174    print('Generat
-0007dc80: 696e 6720 7472 616e 7363 7269 7074 6f6d  ing transcriptom
-0007dc90: 6520 2e2e 2027 2c20 656e 643d 2720 2020  e .. ', end='   
-0007dca0: 2027 290a 2020 2020 636e 745f 7472 203d   ').    cnt_tr =
-0007dcb0: 2030 0a20 2020 2063 6e74 5f70 7220 3d20   0.    cnt_pr = 
-0007dcc0: 300a 2020 2020 666f 7220 6d2c 2067 6420  0.    for m, gd 
-0007dcd0: 696e 2065 6e75 6d65 7261 7465 2867 6473  in enumerate(gds
-0007dce0: 293a 0a20 2020 2020 2020 2063 6e74 5f74  ):.        cnt_t
-0007dcf0: 2c20 636e 745f 702c 2063 6e74 5f65 203d  , cnt_p, cnt_e =
-0007dd00: 2067 642e 7570 6461 7465 5f74 645f 696e   gd.update_td_in
-0007dd10: 666f 2867 656e 6f6d 652c 2073 656c 203d  fo(genome, sel =
-0007dd20: 2032 2c20 7065 7074 6964 6520 3d20 5472   2, peptide = Tr
-0007dd30: 7565 290a 2020 2020 2020 2020 636e 745f  ue).        cnt_
-0007dd40: 7472 202b 3d20 636e 745f 740a 2020 2020  tr += cnt_t.    
-0007dd50: 2020 2020 636e 745f 7072 202b 3d20 636e      cnt_pr += cn
-0007dd60: 745f 700a 2020 2020 2020 2020 2320 6764  t_p.        # gd
-0007dd70: 2e6f 7264 6572 2829 0a20 2020 2020 2020  .order().       
-0007dd80: 206c 312c 206c 3220 3d20 6764 2e67 6574   l1, l2 = gd.get
-0007dd90: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
-0007dda0: 6d5f 6578 6f6e 7328 6765 6e6f 6d65 2c20  m_exons(genome, 
-0007ddb0: 7365 6c20 3d20 322c 2070 6570 7469 6465  sel = 2, peptide
-0007ddc0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-0007ddd0: 2066 6173 7461 5f6c 696e 6573 203d 2066   fasta_lines = f
-0007dde0: 6173 7461 5f6c 696e 6573 202b 206c 310a  asta_lines + l1.
-0007ddf0: 2020 2020 2020 2020 6661 7374 615f 6c69          fasta_li
-0007de00: 6e65 7332 203d 2066 6173 7461 5f6c 696e  nes2 = fasta_lin
-0007de10: 6573 3220 2b20 6c32 0a20 2020 2020 2020  es2 + l2.       
-0007de20: 2069 6620 6d25 3130 3020 3d3d 2030 3a20   if m%100 == 0: 
-0007de30: 7072 696e 7428 275c 7247 656e 6572 6174  print('\rGenerat
-0007de40: 696e 6720 7472 616e 7363 7269 7074 6f6d  ing transcriptom
-0007de50: 6520 2e2e 2025 692f 2569 2028 2569 2c25  e .. %i/%i (%i,%
-0007de60: 6929 2720 2520 286d 2c20 6c65 6e28 6764  i)' % (m, len(gd
-0007de70: 7329 2c20 636e 745f 7472 2c20 636e 745f  s), cnt_tr, cnt_
-0007de80: 7072 292c 2065 6e64 3d27 2020 2020 2729  pr), end='    ')
-0007de90: 0a20 2020 2065 6c61 7073 6564 5f74 696d  .    elapsed_tim
-0007dea0: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
-0007deb0: 2d20 7374 6172 745f 7469 6d65 0a20 2020  - start_time.   
-0007dec0: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
-0007ded0: 7469 6e67 2074 7261 6e73 6372 6970 746f  ting transcripto
-0007dee0: 6d65 202e 2e20 2569 2064 6f6e 6520 696e  me .. %i done in
-0007def0: 2025 6928 7329 2028 2569 2c25 6929 2720   %i(s) (%i,%i)' 
-0007df00: 2520 286c 656e 2867 6473 292c 2065 6c61  % (len(gds), ela
-0007df10: 7073 6564 5f74 696d 652c 2063 6e74 5f74  psed_time, cnt_t
-0007df20: 722c 2063 6e74 5f70 7229 290a 0a20 2020  r, cnt_pr))..   
-0007df30: 2070 7269 6e74 2827 5361 7669 6e67 202e   print('Saving .
-0007df40: 2e20 2569 2074 7273 2c20 2569 2070 7273  . %i trs, %i prs
-0007df50: 2720 2520 286c 656e 2866 6173 7461 5f6c  ' % (len(fasta_l
-0007df60: 696e 6573 292f 322c 206c 656e 2866 6173  ines)/2, len(fas
-0007df70: 7461 5f6c 696e 6573 3229 2f32 2920 2c20  ta_lines2)/2) , 
-0007df80: 656e 6420 3d20 2727 2c20 666c 7573 6820  end = '', flush 
-0007df90: 3d20 5472 7565 290a 2020 2020 666e 616d  = True).    fnam
-0007dfa0: 655f 7472 203d 2066 6e61 6d65 202b 2027  e_tr = fname + '
-0007dfb0: 5f74 7261 6e73 6372 6970 746f 6d65 2e66  _transcriptome.f
-0007dfc0: 6127 0a20 2020 2066 203d 206f 7065 6e28  a'.    f = open(
-0007dfd0: 666e 616d 655f 7472 2c20 2777 2b27 290a  fname_tr, 'w+').
-0007dfe0: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
-0007dff0: 2866 6173 7461 5f6c 696e 6573 290a 2020  (fasta_lines).  
-0007e000: 2020 662e 636c 6f73 6528 290a 0a20 2020    f.close()..   
-0007e010: 2066 6e61 6d65 5f70 7220 3d20 666e 616d   fname_pr = fnam
-0007e020: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
-0007e030: 6127 0a20 2020 2066 203d 206f 7065 6e28  a'.    f = open(
-0007e040: 666e 616d 655f 7072 2c20 2777 2b27 290a  fname_pr, 'w+').
-0007e050: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
-0007e060: 2866 6173 7461 5f6c 696e 6573 3229 0a20  (fasta_lines2). 
-0007e070: 2020 2066 2e63 6c6f 7365 2829 0a0a 2020     f.close()..  
-0007e080: 2020 7072 696e 7428 2720 646f 6e65 2e27    print(' done.'
-0007e090: 290a 2020 2020 7072 696e 7428 2720 2020  ).    print('   
-0007e0a0: 2573 2720 2520 2866 6e61 6d65 5f74 7229  %s' % (fname_tr)
-0007e0b0: 2029 0a20 2020 2070 7269 6e74 2827 2020   ).    print('  
-0007e0c0: 2025 7327 2025 2028 666e 616d 655f 7072   %s' % (fname_pr
-0007e0d0: 2920 290a 0a20 2020 2072 6574 7572 6e28  ) )..    return(
-0007e0e0: 666e 616d 6529 0a0a 0a23 2323 2323 2323  fname)...#######
-0007e0f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d520: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d530: 2323 2323 2323 230a 0a64 6566 2074 7269  #######..def tri
+0007d540: 6d5f 6865 6164 6572 2866 6e61 6d65 5f66  m_header(fname_f
+0007d550: 6129 3a0a 2020 2020 0a20 2020 2066 203d  a):.    .    f =
+0007d560: 206f 7065 6e28 666e 616d 655f 6661 2c20   open(fname_fa, 
+0007d570: 2772 2729 0a20 2020 206c 696e 6573 203d  'r').    lines =
+0007d580: 205b 5d0a 2020 2020 636e 7420 3d20 300a   [].    cnt = 0.
+0007d590: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
+0007d5a0: 663a 0a20 2020 2020 2020 2069 6620 6c69  f:.        if li
+0007d5b0: 6e65 5b30 5d20 3d3d 2027 3e27 3a0a 2020  ne[0] == '>':.  
+0007d5c0: 2020 2020 2020 2020 2020 6864 7220 3d20            hdr = 
+0007d5d0: 6c69 6e65 2e73 706c 6974 2827 2027 290a  line.split(' ').
+0007d5e0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0007d5f0: 732e 6170 7065 6e64 2868 6472 5b30 5d2b  s.append(hdr[0]+
+0007d600: 275c 6e27 290a 2020 2020 2020 2020 656c  '\n').        el
+0007d610: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0007d620: 6c69 6e65 732e 6170 7065 6e64 286c 696e  lines.append(lin
+0007d630: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
+0007d640: 0a20 2020 200a 2020 2020 6620 3d20 6f70  .    .    f = op
+0007d650: 656e 2866 6e61 6d65 5f66 612c 2027 772b  en(fname_fa, 'w+
+0007d660: 2729 0a20 2020 2066 2e77 7269 7465 6c69  ').    f.writeli
+0007d670: 6e65 7328 6c69 6e65 7329 0a20 2020 2066  nes(lines).    f
+0007d680: 2e63 6c6f 7365 2829 0a20 2020 200a 2020  .close().    .  
+0007d690: 2020 0a64 6566 2074 7269 6d5f 6865 6164    .def trim_head
+0007d6a0: 6572 5f61 6e64 5f61 6464 5f73 7472 616e  er_and_add_stran
+0007d6b0: 645f 696e 666f 2866 6e61 6d65 5f66 612c  d_info(fname_fa,
+0007d6c0: 2067 6666 5f66 696c 6529 3a0a 2020 2020   gff_file):.    
+0007d6d0: 0a20 2020 2067 7466 5f6c 696e 6573 2c20  .    gtf_lines, 
+0007d6e0: 6864 725f 6c69 6e65 7320 3d20 6c6f 6164  hdr_lines = load
+0007d6f0: 5f67 7466 2867 6666 5f66 696c 652c 2076  _gtf(gff_file, v
+0007d700: 6572 626f 7365 203d 2054 7275 6529 0a20  erbose = True). 
+0007d710: 2020 2067 7466 5f6c 696e 6573 5f6c 7374     gtf_lines_lst
+0007d720: 203d 2070 6172 7365 5f67 7466 5f6c 696e   = parse_gtf_lin
+0007d730: 6573 5f61 6e64 5f73 706c 6974 5f69 6e74  es_and_split_int
+0007d740: 6f5f 6765 6e65 7328 2067 7466 5f6c 696e  o_genes( gtf_lin
+0007d750: 6573 2c20 675f 6f72 5f74 203d 2027 7472  es, g_or_t = 'tr
+0007d760: 616e 7363 7269 7074 272c 2076 6572 626f  anscript', verbo
+0007d770: 7365 203d 2046 616c 7365 2029 2020 2020  se = False )    
+0007d780: 0a20 2020 2074 645f 6c73 7420 3d20 5b5d  .    td_lst = []
+0007d790: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
+0007d7a0: 6e20 6774 665f 6c69 6e65 735f 6c73 743a  n gtf_lines_lst:
+0007d7b0: 0a20 2020 2020 2020 2074 6420 3d20 7472  .        td = tr
+0007d7c0: 616e 7363 7269 7074 5f64 6573 6372 6970  anscript_descrip
+0007d7d0: 746f 7228 6c69 6e65 7329 0a20 2020 2020  tor(lines).     
+0007d7e0: 2020 2074 645f 6c73 742e 6170 7065 6e64     td_lst.append
+0007d7f0: 2874 6429 0a20 2020 2020 2020 2020 2020  (td).           
+0007d800: 200a 2020 2020 6620 3d20 6f70 656e 2866   .    f = open(f
+0007d810: 6e61 6d65 5f66 612c 2027 7227 290a 2020  name_fa, 'r').  
+0007d820: 2020 6c69 6e65 7320 3d20 5b5d 0a20 2020    lines = [].   
+0007d830: 2063 6e74 203d 2030 0a20 2020 2066 6f72   cnt = 0.    for
+0007d840: 206c 696e 6520 696e 2066 3a0a 2020 2020   line in f:.    
+0007d850: 2020 2020 6966 206c 696e 655b 305d 203d      if line[0] =
+0007d860: 3d20 273e 273a 0a20 2020 2020 2020 2020  = '>':.         
+0007d870: 2020 2068 6472 203d 206c 696e 652e 7370     hdr = line.sp
+0007d880: 6c69 7428 2720 2729 0a20 2020 2020 2020  lit(' ').       
+0007d890: 2020 2020 206c 696e 6573 2e61 7070 656e       lines.appen
+0007d8a0: 6428 6864 725b 305d 2b27 2073 7472 616e  d(hdr[0]+' stran
+0007d8b0: 643a 2569 5c6e 2720 2520 7464 5f6c 7374  d:%i\n' % td_lst
+0007d8c0: 5b63 6e74 5d2e 7374 7261 6e64 2029 0a20  [cnt].strand ). 
+0007d8d0: 2020 2020 2020 2020 2020 2063 6e74 202b             cnt +
+0007d8e0: 3d20 310a 2020 2020 2020 2020 656c 7365  = 1.        else
+0007d8f0: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
+0007d900: 6e65 732e 6170 7065 6e64 286c 696e 6529  nes.append(line)
+0007d910: 0a20 2020 2066 2e63 6c6f 7365 2829 0a20  .    f.close(). 
+0007d920: 2020 200a 2020 2020 6620 3d20 6f70 656e     .    f = open
+0007d930: 2866 6e61 6d65 5f66 612c 2027 772b 2729  (fname_fa, 'w+')
+0007d940: 0a20 2020 2066 2e77 7269 7465 6c69 6e65  .    f.writeline
+0007d950: 7328 6c69 6e65 7329 0a20 2020 2066 2e63  s(lines).    f.c
+0007d960: 6c6f 7365 2829 0a0a 2020 2020 6966 2063  lose()..    if c
+0007d970: 6e74 203d 3d20 6c65 6e28 7464 5f6c 7374  nt == len(td_lst
+0007d980: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
+0007d990: 2827 4641 5354 4120 6669 6c65 2067 656e  ('FASTA file gen
+0007d9a0: 6572 6174 6564 2073 7563 6365 7373 6675  erated successfu
+0007d9b0: 6c6c 7927 290a 2020 2020 656c 7365 3a0a  lly').    else:.
+0007d9c0: 2020 2020 2020 2020 7072 696e 7428 2757          print('W
+0007d9d0: 4152 4e49 4e47 3a20 2569 207e 3d20 2569  ARNING: %i ~= %i
+0007d9e0: 2720 2520 2863 6e74 2c20 6c65 6e28 7464  ' % (cnt, len(td
+0007d9f0: 5f6c 7374 2929 2029 0a20 2020 2020 2020  _lst)) ).       
+0007da00: 200a 2020 2020 2020 2020 0a64 6566 2053   .        .def S
+0007da10: 7472 696e 6746 6978 5f47 4646 5265 6164  tringFix_GFFRead
+0007da20: 2867 7466 5f66 696c 652c 2067 656e 6f6d  (gtf_file, genom
+0007da30: 655f 6669 6c65 2c20 6e5f 636f 7265 7320  e_file, n_cores 
+0007da40: 3d20 3129 3a0a 2020 2020 0a20 2020 2066  = 1):.    .    f
+0007da50: 696c 655f 6e61 6d65 7320 3d20 6774 665f  ile_names = gtf_
+0007da60: 6669 6c65 2e73 706c 6974 2827 2e27 290a  file.split('.').
+0007da70: 2020 2020 666e 616d 6520 3d20 2727 2e6a      fname = ''.j
+0007da80: 6f69 6e28 7374 2066 6f72 2073 7420 696e  oin(st for st in
+0007da90: 2066 696c 655f 6e61 6d65 735b 3a2d 315d   file_names[:-1]
+0007daa0: 2029 0a20 2020 200a 2020 2020 6774 665f   ).    .    gtf_
+0007dab0: 6c69 6e65 732c 2068 6472 5f6c 696e 6573  lines, hdr_lines
+0007dac0: 203d 206c 6f61 645f 6774 6628 6774 665f   = load_gtf(gtf_
+0007dad0: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
+0007dae0: 5472 7565 290a 2020 2020 6764 5f6c 7374  True).    gd_lst
+0007daf0: 2c20 6368 7273 203d 2067 6574 5f67 656e  , chrs = get_gen
+0007db00: 655f 6465 7363 7269 7074 6f72 2867 7466  e_descriptor(gtf
+0007db10: 5f6c 696e 6573 2c20 6765 6e6f 6d65 203d  _lines, genome =
+0007db20: 204e 6f6e 652c 2066 696c 6c20 3d20 4661   None, fill = Fa
+0007db30: 6c73 652c 2076 6572 626f 7365 203d 2054  lse, verbose = T
+0007db40: 7275 652c 206e 5f63 6f72 6573 203d 2031  rue, n_cores = 1
+0007db50: 290a 2020 2020 6764 5f6c 7374 732c 2063  ).    gd_lsts, c
+0007db60: 6872 5f6c 7374 203d 2070 6163 6b5f 6765  hr_lst = pack_ge
+0007db70: 6e65 5f64 6573 6372 6970 746f 7228 2067  ne_descriptor( g
+0007db80: 645f 6c73 742c 2063 6872 7320 290a 0a20  d_lst, chrs ).. 
+0007db90: 2020 2069 6620 6765 6e6f 6d65 5f66 696c     if genome_fil
+0007dba0: 6520 6973 204e 6f6e 653a 2067 656e 6f6d  e is None: genom
+0007dbb0: 6520 3d20 4e6f 6e65 0a20 2020 2065 6c73  e = None.    els
+0007dbc0: 653a 2067 656e 6f6d 6520 3d20 6c6f 6164  e: genome = load
+0007dbd0: 5f67 656e 6f6d 6528 6765 6e6f 6d65 5f66  _genome(genome_f
+0007dbe0: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
+0007dbf0: 7275 6529 0a0a 2020 2020 6661 7374 615f  rue)..    fasta_
+0007dc00: 6c69 6e65 7332 203d 205b 5d0a 2020 2020  lines2 = [].    
+0007dc10: 6661 7374 615f 6c69 6e65 7320 3d20 5b5d  fasta_lines = []
+0007dc20: 0a20 2020 2067 6473 203d 205b 5d0a 2020  .    gds = [].  
+0007dc30: 2020 666f 7220 6764 6c20 696e 2067 645f    for gdl in gd_
+0007dc40: 6c73 7473 3a20 6764 7320 3d20 6764 7320  lsts: gds = gds 
+0007dc50: 2b20 6764 6c0a 2020 2020 2020 2020 0a20  + gdl.        . 
+0007dc60: 2020 2073 7461 7274 5f74 696d 6520 3d20     start_time = 
+0007dc70: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
+0007dc80: 7072 696e 7428 2747 656e 6572 6174 696e  print('Generatin
+0007dc90: 6720 7472 616e 7363 7269 7074 6f6d 6520  g transcriptome 
+0007dca0: 2e2e 2027 2c20 656e 643d 2720 2020 2027  .. ', end='    '
+0007dcb0: 290a 2020 2020 636e 745f 7472 203d 2030  ).    cnt_tr = 0
+0007dcc0: 0a20 2020 2063 6e74 5f70 7220 3d20 300a  .    cnt_pr = 0.
+0007dcd0: 2020 2020 666f 7220 6d2c 2067 6420 696e      for m, gd in
+0007dce0: 2065 6e75 6d65 7261 7465 2867 6473 293a   enumerate(gds):
+0007dcf0: 0a20 2020 2020 2020 2063 6e74 5f74 2c20  .        cnt_t, 
+0007dd00: 636e 745f 702c 2063 6e74 5f65 203d 2067  cnt_p, cnt_e = g
+0007dd10: 642e 7570 6461 7465 5f74 645f 696e 666f  d.update_td_info
+0007dd20: 2867 656e 6f6d 652c 2073 656c 203d 2032  (genome, sel = 2
+0007dd30: 2c20 7065 7074 6964 6520 3d20 5472 7565  , peptide = True
+0007dd40: 290a 2020 2020 2020 2020 636e 745f 7472  ).        cnt_tr
+0007dd50: 202b 3d20 636e 745f 740a 2020 2020 2020   += cnt_t.      
+0007dd60: 2020 636e 745f 7072 202b 3d20 636e 745f    cnt_pr += cnt_
+0007dd70: 700a 2020 2020 2020 2020 2320 6764 2e6f  p.        # gd.o
+0007dd80: 7264 6572 2829 0a20 2020 2020 2020 206c  rder().        l
+0007dd90: 312c 206c 3220 3d20 6764 2e67 6574 5f66  1, l2 = gd.get_f
+0007dda0: 6173 7461 5f6c 696e 6573 5f66 726f 6d5f  asta_lines_from_
+0007ddb0: 6578 6f6e 7328 6765 6e6f 6d65 2c20 7365  exons(genome, se
+0007ddc0: 6c20 3d20 322c 2070 6570 7469 6465 203d  l = 2, peptide =
+0007ddd0: 2054 7275 6529 0a20 2020 2020 2020 2066   True).        f
+0007dde0: 6173 7461 5f6c 696e 6573 203d 2066 6173  asta_lines = fas
+0007ddf0: 7461 5f6c 696e 6573 202b 206c 310a 2020  ta_lines + l1.  
+0007de00: 2020 2020 2020 6661 7374 615f 6c69 6e65        fasta_line
+0007de10: 7332 203d 2066 6173 7461 5f6c 696e 6573  s2 = fasta_lines
+0007de20: 3220 2b20 6c32 0a20 2020 2020 2020 2069  2 + l2.        i
+0007de30: 6620 6d25 3130 3020 3d3d 2030 3a20 7072  f m%100 == 0: pr
+0007de40: 696e 7428 275c 7247 656e 6572 6174 696e  int('\rGeneratin
+0007de50: 6720 7472 616e 7363 7269 7074 6f6d 6520  g transcriptome 
+0007de60: 2e2e 2025 692f 2569 2028 2569 2c25 6929  .. %i/%i (%i,%i)
+0007de70: 2720 2520 286d 2c20 6c65 6e28 6764 7329  ' % (m, len(gds)
+0007de80: 2c20 636e 745f 7472 2c20 636e 745f 7072  , cnt_tr, cnt_pr
+0007de90: 292c 2065 6e64 3d27 2020 2020 2729 0a20  ), end='    '). 
+0007dea0: 2020 2065 6c61 7073 6564 5f74 696d 6520     elapsed_time 
+0007deb0: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
+0007dec0: 7374 6172 745f 7469 6d65 0a20 2020 2070  start_time.    p
+0007ded0: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
+0007dee0: 6e67 2074 7261 6e73 6372 6970 746f 6d65  ng transcriptome
+0007def0: 202e 2e20 2569 2064 6f6e 6520 696e 2025   .. %i done in %
+0007df00: 6928 7329 2028 2569 2c25 6929 2720 2520  i(s) (%i,%i)' % 
+0007df10: 286c 656e 2867 6473 292c 2065 6c61 7073  (len(gds), elaps
+0007df20: 6564 5f74 696d 652c 2063 6e74 5f74 722c  ed_time, cnt_tr,
+0007df30: 2063 6e74 5f70 7229 290a 0a20 2020 2070   cnt_pr))..    p
+0007df40: 7269 6e74 2827 5361 7669 6e67 202e 2e20  rint('Saving .. 
+0007df50: 2569 2074 7273 2c20 2569 2070 7273 2720  %i trs, %i prs' 
+0007df60: 2520 286c 656e 2866 6173 7461 5f6c 696e  % (len(fasta_lin
+0007df70: 6573 292f 322c 206c 656e 2866 6173 7461  es)/2, len(fasta
+0007df80: 5f6c 696e 6573 3229 2f32 2920 2c20 656e  _lines2)/2) , en
+0007df90: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
+0007dfa0: 5472 7565 290a 2020 2020 666e 616d 655f  True).    fname_
+0007dfb0: 7472 203d 2066 6e61 6d65 202b 2027 5f74  tr = fname + '_t
+0007dfc0: 7261 6e73 6372 6970 746f 6d65 2e66 6127  ranscriptome.fa'
+0007dfd0: 0a20 2020 2066 203d 206f 7065 6e28 666e  .    f = open(fn
+0007dfe0: 616d 655f 7472 2c20 2777 2b27 290a 2020  ame_tr, 'w+').  
+0007dff0: 2020 662e 7772 6974 656c 696e 6573 2866    f.writelines(f
+0007e000: 6173 7461 5f6c 696e 6573 290a 2020 2020  asta_lines).    
+0007e010: 662e 636c 6f73 6528 290a 0a20 2020 2066  f.close()..    f
+0007e020: 6e61 6d65 5f70 7220 3d20 666e 616d 6520  name_pr = fname 
+0007e030: 2b20 275f 7072 6f74 656f 6d65 2e66 6127  + '_proteome.fa'
+0007e040: 0a20 2020 2066 203d 206f 7065 6e28 666e  .    f = open(fn
+0007e050: 616d 655f 7072 2c20 2777 2b27 290a 2020  ame_pr, 'w+').  
+0007e060: 2020 662e 7772 6974 656c 696e 6573 2866    f.writelines(f
+0007e070: 6173 7461 5f6c 696e 6573 3229 0a20 2020  asta_lines2).   
+0007e080: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
+0007e090: 7072 696e 7428 2720 646f 6e65 2e27 290a  print(' done.').
+0007e0a0: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
+0007e0b0: 2720 2520 2866 6e61 6d65 5f74 7229 2029  ' % (fname_tr) )
+0007e0c0: 0a20 2020 2070 7269 6e74 2827 2020 2025  .    print('   %
+0007e0d0: 7327 2025 2028 666e 616d 655f 7072 2920  s' % (fname_pr) 
+0007e0e0: 290a 0a20 2020 2072 6574 7572 6e28 666e  )..    return(fn
+0007e0f0: 616d 6529 0a0a 0a23 2323 2323 2323 2323  ame)...#########
 0007e100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e130: 2323 230a 2323 2053 7472 696e 6746 6978  ###.## StringFix
-0007e140: 2d73 796e 7468 6573 6973 0a23 2323 2323  -synthesis.#####
-0007e150: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e140: 230a 2323 2053 7472 696e 6746 6978 2d73  #.## StringFix-s
+0007e150: 796e 7468 6573 6973 0a23 2323 2323 2323  ynthesis.#######
 0007e160: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e190: 2323 2323 230a 0a53 4e56 5f69 6e66 6f20  #####..SNV_info 
-0007e1a0: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
-0007e1b0: 6d65 6474 7570 6c65 2827 534e 565f 696e  medtuple('SNV_in
-0007e1c0: 666f 272c 2027 6368 722c 2070 6f73 5f72  fo', 'chr, pos_r
-0007e1d0: 6566 2c20 706f 735f 6e65 772c 2067 656e  ef, pos_new, gen
-0007e1e0: 655f 6964 2c20 6765 6e65 5f6e 616d 652c  e_id, gene_name,
-0007e1f0: 2076 5f74 7970 652c 2076 5f6c 656e 2c20   v_type, v_len, 
-0007e200: 6376 675f 6465 7074 682c 2063 7667 5f66  cvg_depth, cvg_f
-0007e210: 7261 632c 205c 0a20 2020 2020 2020 2020  rac, \.         
-0007e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e230: 2020 2020 2020 2020 2020 7265 665f 7072            ref_pr
-0007e240: 6576 2c20 7265 665f 7365 712c 2072 6566  ev, ref_seq, ref
-0007e250: 5f6e 6578 742c 2061 6c74 5f70 7265 762c  _next, alt_prev,
-0007e260: 2061 6c74 5f73 6571 2c20 616c 745f 6e65   alt_seq, alt_ne
-0007e270: 7874 2729 2023 206f 6e65 2d62 6173 650a  xt') # one-base.
-0007e280: 0a4e 5749 4e20 3d20 330a 6465 6620 6669  .NWIN = 3.def fi
-0007e290: 6e64 5f73 6e70 5f6f 6c64 2873 672c 2073  nd_snp_old(sg, s
-0007e2a0: 722c 2063 722c 2063 6872 6d2c 2070 6f73  r, cr, chrm, pos
-0007e2b0: 5f61 6273 2c20 6f73 2c20 6769 6e29 3a0a  _abs, os, gin):.
-0007e2c0: 2020 2020 0a20 2020 2073 6e76 5f69 6e66      .    snv_inf
-0007e2d0: 6f5f 6c73 7420 3d20 5b5d 0a20 2020 206c  o_lst = [].    l
-0007e2e0: 656e 5f74 6f5f 7465 7374 203d 206d 696e  en_to_test = min
-0007e2f0: 286c 656e 2873 7229 2c6c 656e 2873 6729  (len(sr),len(sg)
-0007e300: 290a 0a20 2020 2073 7461 7274 203d 2030  )..    start = 0
-0007e310: 0a20 2020 2065 6e64 203d 206d 696e 2820  .    end = min( 
-0007e320: 3130 302c 206c 656e 5f74 6f5f 7465 7374  100, len_to_test
-0007e330: 2029 0a20 2020 204e 203d 2069 6e74 286e   ).    N = int(n
-0007e340: 702e 6365 696c 2820 6c65 6e5f 746f 5f74  p.ceil( len_to_t
-0007e350: 6573 742f 3130 3020 2929 0a20 2020 2023  est/100 )).    #
-0007e360: 2727 270a 2020 2020 666f 7220 6e20 696e  '''.    for n in
-0007e370: 2072 616e 6765 284e 293a 0a20 2020 2020   range(N):.     
-0007e380: 2020 200a 2020 2020 2020 2020 6966 2073     .        if s
-0007e390: 675b 7374 6172 743a 656e 645d 2021 3d20  g[start:end] != 
-0007e3a0: 7372 5b73 7461 7274 3a65 6e64 5d3a 0a0a  sr[start:end]:..
-0007e3b0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-0007e3c0: 300a 2020 2020 2020 2020 2020 2020 706f  0.            po
-0007e3d0: 735f 6c73 7420 3d20 5b5d 0a20 2020 2020  s_lst = [].     
-0007e3e0: 2020 2020 2020 206c 656e 5f6c 7374 203d         len_lst =
-0007e3f0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0007e400: 6376 675f 6c73 7420 3d20 5b5d 0a20 2020  cvg_lst = [].   
-0007e410: 2020 2020 2020 2020 2073 6e70 5f6c 7374           snp_lst
-0007e420: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0007e430: 2020 736e 705f 6f72 675f 6c73 7420 3d20    snp_org_lst = 
-0007e440: 5b5d 0a20 2020 2020 2020 2020 2020 200a  [].            .
-0007e450: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0007e460: 6b20 696e 2072 616e 6765 2873 7461 7274  k in range(start
-0007e470: 2c20 656e 6429 3a0a 2020 2020 2020 2020  , end):.        
-0007e480: 2020 2020 2020 2020 6966 2073 725b 6b5d          if sr[k]
-0007e490: 2021 3d20 7367 5b6b 5d3a 0a20 2020 2020   != sg[k]:.     
-0007e4a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0007e4b0: 6620 7020 3d3d 2030 3a20 706f 7320 3d20  f p == 0: pos = 
-0007e4c0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0007e4d0: 2020 2020 2020 7020 2b3d 2031 0a20 2020        p += 1.   
-0007e4e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0007e4f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0007e500: 2020 2020 2020 2069 6620 7020 3e20 303a         if p > 0:
-0007e510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e520: 2020 2020 2020 2020 2023 2063 7667 5f6c           # cvg_l
-0007e530: 7374 2e61 7070 656e 6428 6e70 2e6d 6561  st.append(np.mea
-0007e540: 6e28 2063 725b 706f 733a 2870 6f73 2b70  n( cr[pos:(pos+p
-0007e550: 295d 2029 2029 0a20 2020 2020 2020 2020  )] ) ).         
-0007e560: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0007e570: 2073 6e70 5f6c 7374 2e61 7070 656e 6428   snp_lst.append(
-0007e580: 7372 5b70 6f73 3a28 706f 732b 7029 5d29  sr[pos:(pos+p)])
-0007e590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e5a0: 2020 2020 2020 2020 2070 6f73 5f6c 7374           pos_lst
-0007e5b0: 2e61 7070 656e 6428 706f 7329 0a20 2020  .append(pos).   
-0007e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e5d0: 2020 2020 206c 656e 5f6c 7374 2e61 7070       len_lst.app
-0007e5e0: 656e 6428 7029 0a20 2020 2020 2020 2020  end(p).         
-0007e5f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0007e600: 2073 6e70 5f6f 7267 5f6c 7374 2e61 7070   snp_org_lst.app
-0007e610: 656e 6428 7367 5b70 6f73 3a28 706f 732b  end(sg[pos:(pos+
-0007e620: 7029 5d29 0a20 2020 2020 2020 2020 2020  p)]).           
-0007e630: 2020 2020 2020 2020 2020 2020 2070 203d               p =
-0007e640: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-0007e650: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0007e660: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
-0007e670: 6765 286c 656e 2870 6f73 5f6c 7374 2929  ge(len(pos_lst))
-0007e680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007e690: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0007e6a0: 2020 2070 3120 3d20 6d61 7828 302c 2870     p1 = max(0,(p
-0007e6b0: 6f73 5f6c 7374 5b6b 5d2d 4e57 494e 2929  os_lst[k]-NWIN))
-0007e6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e6d0: 2070 3220 3d20 6d69 6e28 6c65 6e5f 746f   p2 = min(len_to
-0007e6e0: 5f74 6573 742c 2870 6f73 5f6c 7374 5b6b  _test,(pos_lst[k
-0007e6f0: 5d2b 6c65 6e5f 6c73 745b 6b5d 2b4e 5749  ]+len_lst[k]+NWI
-0007e700: 4e29 290a 2020 2020 2020 2020 2020 2020  N)).            
-0007e710: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007e720: 2020 2020 2073 6f70 203d 2073 675b 7031       sop = sg[p1
-0007e730: 3a70 6f73 5f6c 7374 5b6b 5d5d 0a20 2020  :pos_lst[k]].   
-0007e740: 2020 2020 2020 2020 2020 2020 2073 6f63               soc
-0007e750: 203d 2073 675b 706f 735f 6c73 745b 6b5d   = sg[pos_lst[k]
-0007e760: 3a28 706f 735f 6c73 745b 6b5d 2b6c 656e  :(pos_lst[k]+len
-0007e770: 5f6c 7374 5b6b 5d29 5d0a 2020 2020 2020  _lst[k])].      
-0007e780: 2020 2020 2020 2020 2020 736f 6e20 3d20            son = 
-0007e790: 7367 5b28 706f 735f 6c73 745b 6b5d 2b6c  sg[(pos_lst[k]+l
-0007e7a0: 656e 5f6c 7374 5b6b 5d29 3a70 325d 0a20  en_lst[k]):p2]. 
-0007e7b0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0007e7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e7d0: 736e 7020 3d20 7372 5b70 313a 706f 735f  snp = sr[p1:pos_
-0007e7e0: 6c73 745b 6b5d 5d0a 2020 2020 2020 2020  lst[k]].        
-0007e7f0: 2020 2020 2020 2020 736e 6320 3d20 7372          snc = sr
-0007e800: 5b70 6f73 5f6c 7374 5b6b 5d3a 2870 6f73  [pos_lst[k]:(pos
-0007e810: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
-0007e820: 6b5d 295d 0a20 2020 2020 2020 2020 2020  k])].           
-0007e830: 2020 2020 2073 6e6e 203d 2073 725b 2870       snn = sr[(p
-0007e840: 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73  os_lst[k]+len_ls
-0007e850: 745b 6b5d 293a 7032 5d0a 2020 2020 2020  t[k]):p2].      
-0007e860: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0007e870: 2020 2020 2020 2020 2020 2073 6920 3d20             si = 
-0007e880: 534e 565f 696e 666f 2863 6872 6d2c 2070  SNV_info(chrm, p
-0007e890: 6f73 5f6c 7374 5b6b 5d2b 706f 735f 6162  os_lst[k]+pos_ab
-0007e8a0: 732c 2070 6f73 5f6c 7374 5b6b 5d2b 706f  s, pos_lst[k]+po
-0007e8b0: 735f 6162 732b 6f73 2c20 6769 6e5b 305d  s_abs+os, gin[0]
-0007e8c0: 2c20 6769 6e5b 315d 2c20 2756 272c 206c  , gin[1], 'V', l
-0007e8d0: 656e 5f6c 7374 5b6b 5d2c 205c 0a20 2020  en_lst[k], \.   
-0007e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e8f0: 2020 2020 2020 2020 2020 2069 6e74 2863             int(c
-0007e900: 725b 706f 735f 6c73 745b 6b5d 5d29 2c20  r[pos_lst[k]]), 
-0007e910: 312c 2073 6f70 2c20 736f 632c 2073 6f6e  1, sop, soc, son
-0007e920: 2c20 736e 702c 2073 6e63 2c20 736e 6e20  , snp, snc, snn 
-0007e930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007e940: 2020 736e 765f 696e 666f 5f6c 7374 2e61    snv_info_lst.a
-0007e950: 7070 656e 6428 7369 290a 0a20 2020 2020  ppend(si)..     
-0007e960: 2020 2073 7461 7274 203d 2065 6e64 0a20     start = end. 
-0007e970: 2020 2020 2020 2065 6e64 203d 206d 696e         end = min
-0007e980: 2820 656e 6420 2b20 3130 302c 206c 656e  ( end + 100, len
-0007e990: 5f74 6f5f 7465 7374 2029 0a20 2020 2023  _to_test ).    #
-0007e9a0: 2727 2720 2020 2020 2020 2020 0a20 2020  '''         .   
-0007e9b0: 2072 6574 7572 6e28 736e 765f 696e 666f   return(snv_info
-0007e9c0: 5f6c 7374 290a 0a0a 6465 6620 6669 6e64  _lst)...def find
-0007e9d0: 5f73 6e70 2873 672c 2073 722c 2063 6d61  _snp(sg, sr, cma
-0007e9e0: 742c 2063 6872 6d2c 2070 6f73 5f61 6273  t, chrm, pos_abs
-0007e9f0: 2c20 6f73 2c20 6769 6e29 3a0a 2020 2020  , os, gin):.    
-0007ea00: 0a20 2020 2073 6e76 5f69 6e66 6f5f 6c73  .    snv_info_ls
-0007ea10: 7420 3d20 5b5d 0a20 2020 206c 656e 5f74  t = [].    len_t
-0007ea20: 6f5f 7465 7374 203d 206d 696e 286c 656e  o_test = min(len
-0007ea30: 2873 7229 2c6c 656e 2873 6729 290a 0a20  (sr),len(sg)).. 
-0007ea40: 2020 2063 7220 3d20 636d 6174 2e73 756d     cr = cmat.sum
-0007ea50: 2861 7869 7320 3d20 3029 0a20 2020 206e  (axis = 0).    n
-0007ea60: 7320 3d20 6e70 2e61 7267 6d61 7828 2063  s = np.argmax( c
-0007ea70: 6d61 742c 2061 7869 733d 3020 290a 2020  mat, axis=0 ).  
-0007ea80: 2020 7072 203d 2063 6d61 745b 6e73 2c6e    pr = cmat[ns,n
-0007ea90: 702e 6172 616e 6765 286c 656e 286e 7329  p.arange(len(ns)
-0007eaa0: 295d 2f63 720a 0a20 2020 2070 203d 2030  )]/cr..    p = 0
-0007eab0: 0a20 2020 2070 6f73 5f6c 7374 203d 205b  .    pos_lst = [
-0007eac0: 5d0a 2020 2020 6c65 6e5f 6c73 7420 3d20  ].    len_lst = 
-0007ead0: 5b5d 0a20 2020 2063 7667 5f6c 7374 203d  [].    cvg_lst =
-0007eae0: 205b 5d0a 2020 2020 6366 725f 6c73 7420   [].    cfr_lst 
-0007eaf0: 3d20 5b5d 0a20 2020 2073 6e70 5f6c 7374  = [].    snp_lst
-0007eb00: 203d 205b 5d0a 2020 2020 736e 705f 6f72   = [].    snp_or
-0007eb10: 675f 6c73 7420 3d20 5b5d 0a20 2020 200a  g_lst = [].    .
-0007eb20: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
-0007eb30: 6765 286c 656e 5f74 6f5f 7465 7374 293a  ge(len_to_test):
-0007eb40: 0a20 2020 2020 2020 2069 6620 7372 5b6b  .        if sr[k
-0007eb50: 5d20 213d 2073 675b 6b5d 3a0a 2020 2020  ] != sg[k]:.    
-0007eb60: 2020 2020 2020 2020 6966 2070 203d 3d20          if p == 
-0007eb70: 303a 2070 6f73 203d 206b 0a20 2020 2020  0: pos = k.     
-0007eb80: 2020 2020 2020 2070 202b 3d20 310a 2020         p += 1.  
-0007eb90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0007eba0: 2020 2020 2020 2020 6966 2070 203e 2030          if p > 0
-0007ebb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007ebc0: 2020 2320 6376 675f 6c73 742e 6170 7065    # cvg_lst.appe
-0007ebd0: 6e64 286e 702e 6d65 616e 2820 6372 5b70  nd(np.mean( cr[p
-0007ebe0: 6f73 3a28 706f 732b 7029 5d20 2920 290a  os:(pos+p)] ) ).
-0007ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ec00: 2320 736e 705f 6c73 742e 6170 7065 6e64  # snp_lst.append
-0007ec10: 2873 725b 706f 733a 2870 6f73 2b70 295d  (sr[pos:(pos+p)]
-0007ec20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007ec30: 2020 706f 735f 6c73 742e 6170 7065 6e64    pos_lst.append
-0007ec40: 2870 6f73 290a 2020 2020 2020 2020 2020  (pos).          
-0007ec50: 2020 2020 2020 6c65 6e5f 6c73 742e 6170        len_lst.ap
-0007ec60: 7065 6e64 2870 290a 2020 2020 2020 2020  pend(p).        
-0007ec70: 2020 2020 2020 2020 2320 736e 705f 6f72          # snp_or
-0007ec80: 675f 6c73 742e 6170 7065 6e64 2873 675b  g_lst.append(sg[
-0007ec90: 706f 733a 2870 6f73 2b70 295d 290a 2020  pos:(pos+p)]).  
-0007eca0: 2020 2020 2020 2020 2020 2020 2020 7020                p 
-0007ecb0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0007ecc0: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
-0007ecd0: 6e67 6528 6c65 6e28 706f 735f 6c73 7429  nge(len(pos_lst)
-0007ece0: 293a 0a20 2020 2020 2020 200a 2020 2020  ):.        .    
-0007ecf0: 2020 2020 7031 203d 206d 6178 2830 2c28      p1 = max(0,(
-0007ed00: 706f 735f 6c73 745b 6b5d 2d4e 5749 4e29  pos_lst[k]-NWIN)
-0007ed10: 290a 2020 2020 2020 2020 7032 203d 206d  ).        p2 = m
-0007ed20: 696e 286c 656e 5f74 6f5f 7465 7374 2c28  in(len_to_test,(
-0007ed30: 706f 735f 6c73 745b 6b5d 2b6c 656e 5f6c  pos_lst[k]+len_l
-0007ed40: 7374 5b6b 5d2b 4e57 494e 2929 0a20 2020  st[k]+NWIN)).   
-0007ed50: 2020 2020 200a 2020 2020 2020 2020 736f       .        so
-0007ed60: 7020 3d20 7367 5b70 313a 706f 735f 6c73  p = sg[p1:pos_ls
-0007ed70: 745b 6b5d 5d0a 2020 2020 2020 2020 736f  t[k]].        so
-0007ed80: 6320 3d20 7367 5b70 6f73 5f6c 7374 5b6b  c = sg[pos_lst[k
-0007ed90: 5d3a 2870 6f73 5f6c 7374 5b6b 5d2b 6c65  ]:(pos_lst[k]+le
-0007eda0: 6e5f 6c73 745b 6b5d 295d 0a20 2020 2020  n_lst[k])].     
-0007edb0: 2020 2073 6f6e 203d 2073 675b 2870 6f73     son = sg[(pos
-0007edc0: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
-0007edd0: 6b5d 293a 7032 5d0a 2020 2020 2020 2020  k]):p2].        
-0007ede0: 0a20 2020 2020 2020 2073 6e70 203d 2073  .        snp = s
-0007edf0: 725b 7031 3a70 6f73 5f6c 7374 5b6b 5d5d  r[p1:pos_lst[k]]
-0007ee00: 0a20 2020 2020 2020 2073 6e63 203d 2073  .        snc = s
-0007ee10: 725b 706f 735f 6c73 745b 6b5d 3a28 706f  r[pos_lst[k]:(po
-0007ee20: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
-0007ee30: 5b6b 5d29 5d0a 2020 2020 2020 2020 736e  [k])].        sn
-0007ee40: 6e20 3d20 7372 5b28 706f 735f 6c73 745b  n = sr[(pos_lst[
-0007ee50: 6b5d 2b6c 656e 5f6c 7374 5b6b 5d29 3a70  k]+len_lst[k]):p
-0007ee60: 325d 0a20 2020 2020 2020 200a 2020 2020  2].        .    
-0007ee70: 2020 2020 7369 203d 2053 4e56 5f69 6e66      si = SNV_inf
-0007ee80: 6f28 6368 726d 2c20 706f 735f 6c73 745b  o(chrm, pos_lst[
-0007ee90: 6b5d 2b70 6f73 5f61 6273 2c20 706f 735f  k]+pos_abs, pos_
-0007eea0: 6c73 745b 6b5d 2b70 6f73 5f61 6273 2b6f  lst[k]+pos_abs+o
-0007eeb0: 732c 2067 696e 5b30 5d2c 2067 696e 5b31  s, gin[0], gin[1
-0007eec0: 5d2c 2027 5627 2c20 6c65 6e5f 6c73 745b  ], 'V', len_lst[
-0007eed0: 6b5d 2c20 5c0a 2020 2020 2020 2020 2020  k], \.          
-0007eee0: 2020 2020 2020 2020 2020 2020 696e 7428              int(
-0007eef0: 6372 5b70 6f73 5f6c 7374 5b6b 5d5d 292c  cr[pos_lst[k]]),
-0007ef00: 206e 702e 726f 756e 6428 7072 5b70 6f73   np.round(pr[pos
-0007ef10: 5f6c 7374 5b6b 5d5d 2c33 292c 2073 6f70  _lst[k]],3), sop
-0007ef20: 2c20 736f 632c 2073 6f6e 2c20 736e 702c  , soc, son, snp,
-0007ef30: 2073 6e63 2c20 736e 6e20 290a 2020 2020   snc, snn ).    
-0007ef40: 2020 2020 736e 765f 696e 666f 5f6c 7374      snv_info_lst
-0007ef50: 2e61 7070 656e 6428 7369 290a 0a20 2020  .append(si)..   
-0007ef60: 2072 6574 7572 6e28 736e 765f 696e 666f   return(snv_info
-0007ef70: 5f6c 7374 290a 0a0a 6465 6620 636f 6d70  _lst)...def comp
-0007ef80: 6172 655f 7365 7132 2820 7331 2c20 7332  are_seq2( s1, s2
-0007ef90: 2029 3a0a 2020 2020 636e 7420 3d20 300a   ):.    cnt = 0.
-0007efa0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0007efb0: 6765 286d 696e 286c 656e 2873 3129 2c6c  ge(min(len(s1),l
-0007efc0: 656e 2873 3229 2929 3a0a 2020 2020 2020  en(s2))):.      
-0007efd0: 2020 636e 7420 2b3d 2028 7331 5b69 5d20    cnt += (s1[i] 
-0007efe0: 213d 2073 325b 695d 290a 2020 2020 2320  != s2[i]).    # 
-0007eff0: 6966 206c 656e 2873 3129 2021 3d20 6c65  if len(s1) != le
-0007f000: 6e28 7332 293a 2070 7269 6e74 2827 5741  n(s2): print('WA
-0007f010: 524e 494e 4720 696e 2063 6f6d 7061 7265  RNING in compare
-0007f020: 5f73 6571 323a 2025 6920 213d 2025 6927  _seq2: %i != %i'
-0007f030: 2025 2028 6c65 6e28 7331 292c 6c65 6e28   % (len(s1),len(
-0007f040: 7332 2929 2029 0a20 2020 2072 6574 7572  s2)) ).    retur
-0007f050: 6e20 636e 740a 0a0a 4f53 5f69 6e66 6f20  n cnt...OS_info 
-0007f060: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
-0007f070: 6d65 6474 7570 6c65 2827 4f53 5f69 6e66  medtuple('OS_inf
-0007f080: 6f27 2c20 276f 732c 2073 7461 7274 2c20  o', 'os, start, 
-0007f090: 656e 6427 2920 2320 6f6e 652d 6261 7365  end') # one-base
-0007f0a0: 0a0a 636c 6173 7320 6f66 6673 6574 5f66  ..class offset_f
-0007f0b0: 696e 6465 723a 0a20 2020 200a 2020 2020  inder:.    .    
-0007f0c0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0007f0d0: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-0007f0e0: 2e6f 7369 5f6c 7374 203d 205b 5d0a 2020  .osi_lst = [].  
-0007f0f0: 2020 2020 2020 7365 6c66 2e6f 735f 6d61        self.os_ma
-0007f100: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
-0007f110: 2073 656c 662e 6f73 5f70 7265 7620 3d20   self.os_prev = 
-0007f120: 300a 2020 2020 2020 2020 0a20 2020 2064  0.        .    d
-0007f130: 6566 2061 6464 2820 7365 6c66 2c20 6f73  ef add( self, os
-0007f140: 2c20 7374 6172 742c 2065 6e64 293a 0a20  , start, end):. 
-0007f150: 2020 2020 2020 2073 656c 662e 6f73 695f         self.osi_
-0007f160: 6c73 742e 6170 7065 6e64 2820 4f53 5f69  lst.append( OS_i
-0007f170: 6e66 6f28 6f73 2c20 7374 6172 742c 2065  nfo(os, start, e
-0007f180: 6e64 2920 290a 2020 2020 2020 2020 0a20  nd) ).        . 
-0007f190: 2020 2064 6566 2066 696e 645f 6f73 2820     def find_os( 
-0007f1a0: 7365 6c66 2c20 706f 7320 293a 0a20 2020  self, pos ):.   
-0007f1b0: 2020 2020 206f 7320 3d20 300a 2020 2020       os = 0.    
-0007f1c0: 2020 2020 666f 7220 6f73 6920 696e 2073      for osi in s
-0007f1d0: 656c 662e 6f73 695f 6c73 743a 0a20 2020  elf.osi_lst:.   
-0007f1e0: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
-0007f1f0: 203e 3d20 6f73 692e 7374 6172 7429 2026   >= osi.start) &
-0007f200: 2028 706f 7320 3c20 6f73 692e 656e 6429   (pos < osi.end)
-0007f210: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0007f220: 2020 206f 7320 3d20 6f73 692e 6f73 0a20     os = osi.os. 
-0007f230: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0007f240: 7265 616b 0a20 2020 2020 2020 2072 6574  reak.        ret
-0007f250: 7572 6e20 6f73 0a0a 2020 2020 0a20 2020  urn os..    .   
-0007f260: 2064 6566 2066 696e 645f 6f73 5f73 6571   def find_os_seq
-0007f270: 2820 7365 6c66 2c20 706f 732c 2070 7265  ( self, pos, pre
-0007f280: 765f 692c 206d 6172 6b20 3d20 2727 2029  v_i, mark = '' )
-0007f290: 3a0a 2020 2020 2020 2020 6f73 203d 204e  :.        os = N
-0007f2a0: 6f6e 650a 2020 2020 2020 2020 6e65 7874  one.        next
-0007f2b0: 5f69 203d 2030 0a20 2020 2020 2020 2066  _i = 0.        f
-0007f2c0: 6f72 206b 2c20 6f73 6920 696e 2065 6e75  or k, osi in enu
-0007f2d0: 6d65 7261 7465 2873 656c 662e 6f73 695f  merate(self.osi_
-0007f2e0: 6c73 745b 7072 6576 5f69 3a5d 293a 0a20  lst[prev_i:]):. 
-0007f2f0: 2020 2020 2020 2020 2020 2069 6620 2870             if (p
-0007f300: 6f73 203e 3d20 6f73 692e 7374 6172 7429  os >= osi.start)
-0007f310: 2026 2028 706f 7320 3c20 6f73 692e 656e   & (pos < osi.en
-0007f320: 6429 3a20 0a20 2020 2020 2020 2020 2020  d): .           
-0007f330: 2020 2020 206f 7320 3d20 6f73 692e 6f73       os = osi.os
-0007f340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f350: 206e 6578 745f 6920 3d20 6b20 2b20 7072   next_i = k + pr
-0007f360: 6576 5f69 200a 2020 2020 2020 2020 2020  ev_i .          
-0007f370: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-0007f380: 2020 2020 6966 206f 7320 6973 204e 6f6e      if os is Non
-0007f390: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-0007f3a0: 6f72 206b 2c20 6f73 6920 696e 2065 6e75  or k, osi in enu
-0007f3b0: 6d65 7261 7465 2873 656c 662e 6f73 695f  merate(self.osi_
-0007f3c0: 6c73 745b 3a70 7265 765f 695d 293a 0a20  lst[:prev_i]):. 
-0007f3d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0007f3e0: 6620 2870 6f73 203e 3d20 6f73 692e 7374  f (pos >= osi.st
-0007f3f0: 6172 7429 2026 2028 706f 7320 3c20 6f73  art) & (pos < os
-0007f400: 692e 656e 6429 3a20 0a20 2020 2020 2020  i.end): .       
-0007f410: 2020 2020 2020 2020 2020 2020 206f 7320               os 
-0007f420: 3d20 6f73 692e 6f73 0a20 2020 2020 2020  = osi.os.       
-0007f430: 2020 2020 2020 2020 2020 2020 206e 6578               nex
-0007f440: 745f 6920 3d20 6b0a 2020 2020 2020 2020  t_i = k.        
-0007f450: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0007f460: 6b0a 0a20 2020 2020 2020 2069 6620 6f73  k..        if os
-0007f470: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0007f480: 2020 2020 2020 6f73 203d 2073 656c 662e        os = self.
-0007f490: 6f73 5f70 7265 760a 2020 2020 2020 2020  os_prev.        
-0007f4a0: 2020 2020 2320 7072 696e 7428 2745 5252      # print('ERR
-0007f4b0: 4f52 2069 6e20 6669 6e64 5f6f 735f 7365  OR in find_os_se
-0007f4c0: 713a 206f 7320 6973 204e 6f6e 6520 2573  q: os is None %s
-0007f4d0: 2720 2520 6d61 726b 2029 0a20 2020 2020  ' % mark ).     
-0007f4e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0007f4f0: 2020 2020 2073 656c 662e 6f73 5f70 7265       self.os_pre
-0007f500: 7620 3d20 6f73 0a20 2020 2020 2020 2020  v = os.         
-0007f510: 2020 200a 2020 2020 2020 2020 7265 7475     .        retu
-0007f520: 726e 206f 732c 206e 6578 745f 690a 2020  rn os, next_i.  
-0007f530: 2020 0a20 2020 200a 2020 2020 6465 6620    .    .    def 
-0007f540: 6d61 6b65 5f69 745f 636f 6d70 6163 7428  make_it_compact(
-0007f550: 2073 656c 6620 293a 0a0a 2020 2020 2020   self ):..      
-0007f560: 2020 666f 7220 6b20 696e 2072 6576 6572    for k in rever
-0007f570: 7365 6428 7261 6e67 6528 312c 6c65 6e28  sed(range(1,len(
-0007f580: 7365 6c66 2e6f 7369 5f6c 7374 2929 293a  self.osi_lst))):
-0007f590: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0007f5a0: 7365 6c66 2e6f 7369 5f6c 7374 5b6b 5d2e  self.osi_lst[k].
-0007f5b0: 6f73 203d 3d20 7365 6c66 2e6f 7369 5f6c  os == self.osi_l
-0007f5c0: 7374 5b6b 2d31 5d2e 6f73 3a0a 2020 2020  st[k-1].os:.    
-0007f5d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0007f5e0: 2e6f 7369 5f6c 7374 5b6b 2d31 5d20 3d20  .osi_lst[k-1] = 
-0007f5f0: 4f53 5f69 6e66 6f28 2073 656c 662e 6f73  OS_info( self.os
-0007f600: 695f 6c73 745b 6b2d 315d 2e6f 732c 2073  i_lst[k-1].os, s
-0007f610: 656c 662e 6f73 695f 6c73 745b 6b2d 315d  elf.osi_lst[k-1]
-0007f620: 2e73 7461 7274 2c20 7365 6c66 2e6f 7369  .start, self.osi
-0007f630: 5f6c 7374 5b6b 5d2e 656e 6420 290a 2020  _lst[k].end ).  
-0007f640: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0007f650: 6c20 7365 6c66 2e6f 7369 5f6c 7374 5b6b  l self.osi_lst[k
-0007f660: 5d0a 2020 2020 2020 2020 0a20 2020 2064  ].        .    d
-0007f670: 6566 2067 6574 5f62 6e64 7279 2820 7365  ef get_bndry( se
-0007f680: 6c66 2c20 706f 7320 293a 0a20 2020 2020  lf, pos ):.     
-0007f690: 2020 206f 7320 3d20 300a 2020 2020 2020     os = 0.      
-0007f6a0: 2020 666f 7220 6f73 6920 696e 2073 656c    for osi in sel
-0007f6b0: 662e 6f73 695f 6c73 743a 0a20 2020 2020  f.osi_lst:.     
-0007f6c0: 2020 2020 2020 2069 6620 2870 6f73 203e         if (pos >
-0007f6d0: 3d20 6f73 692e 7374 6172 7429 3a20 0a20  = osi.start): . 
-0007f6e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0007f6f0: 7320 3d20 6f73 692e 7374 6172 740a 2020  s = osi.start.  
-0007f700: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0007f710: 6561 6b0a 2020 2020 2020 2020 7265 7475  eak.        retu
-0007f720: 726e 206f 730a 2020 2020 0a20 2020 2064  rn os.    .    d
-0007f730: 6566 2067 6574 5f62 6e64 7279 5f73 6571  ef get_bndry_seq
-0007f740: 2820 7365 6c66 2c20 706f 732c 2070 7265  ( self, pos, pre
-0007f750: 765f 6920 293a 0a20 2020 2020 2020 206f  v_i ):.        o
-0007f760: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
-0007f770: 206e 6578 745f 6920 3d20 300a 2020 2020   next_i = 0.    
-0007f780: 2020 2020 666f 7220 6b2c 206f 7369 2069      for k, osi i
-0007f790: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-0007f7a0: 2e6f 7369 5f6c 7374 5b70 7265 765f 693a  .osi_lst[prev_i:
-0007f7b0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-0007f7c0: 6966 2028 706f 7320 3e3d 206f 7369 2e73  if (pos >= osi.s
-0007f7d0: 7461 7274 2920 2620 2870 6f73 203c 206f  tart) & (pos < o
-0007f7e0: 7369 2e65 6e64 293a 200a 2020 2020 2020  si.end): .      
-0007f7f0: 2020 2020 2020 2020 2020 6f73 203d 206f            os = o
-0007f800: 7369 2e73 7461 7274 0a20 2020 2020 2020  si.start.       
-0007f810: 2020 2020 2020 2020 206e 6578 745f 6920           next_i 
-0007f820: 3d20 6b20 2b20 7072 6576 5f69 200a 2020  = k + prev_i .  
-0007f830: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0007f840: 6561 6b0a 2020 2020 2020 2020 6966 206f  eak.        if o
-0007f850: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0007f860: 2020 2020 2020 2066 6f72 206b 2c20 6f73         for k, os
-0007f870: 6920 696e 2065 6e75 6d65 7261 7465 2873  i in enumerate(s
-0007f880: 656c 662e 6f73 695f 6c73 745b 3a70 7265  elf.osi_lst[:pre
-0007f890: 765f 695d 293a 0a20 2020 2020 2020 2020  v_i]):.         
-0007f8a0: 2020 2020 2020 2069 6620 2870 6f73 203e         if (pos >
-0007f8b0: 3d20 6f73 692e 7374 6172 7429 2026 2028  = osi.start) & (
-0007f8c0: 706f 7320 3c20 6f73 692e 656e 6429 3a20  pos < osi.end): 
-0007f8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f8e0: 2020 2020 206f 7320 3d20 6f73 692e 7374       os = osi.st
-0007f8f0: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
-0007f900: 2020 2020 2020 2020 6e65 7874 5f69 203d          next_i =
-0007f910: 206b 0a20 2020 2020 2020 2020 2020 2020   k.             
-0007f920: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-0007f930: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007f940: 2020 6966 206f 7320 6973 204e 6f6e 653a    if os is None:
-0007f950: 0a20 2020 2020 2020 2020 2020 206f 7320  .            os 
-0007f960: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0007f970: 6e65 7874 5f69 203d 2030 0a20 2020 2020  next_i = 0.     
-0007f980: 2020 2020 2020 2070 7269 6e74 2827 4552         print('ER
-0007f990: 524f 5220 696e 2067 6574 5f62 6e64 7279  ROR in get_bndry
-0007f9a0: 5f73 6571 3a20 6f73 2069 7320 4e6f 6e65  _seq: os is None
-0007f9b0: 2729 0a20 2020 2020 2020 2020 2020 2023  ').            #
-0007f9c0: 2073 656c 662e 7072 696e 7428 290a 2020   self.print().  
-0007f9d0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0007f9e0: 2020 2072 6574 7572 6e20 6f73 2c20 6e65     return os, ne
-0007f9f0: 7874 5f69 0a20 2020 200a 2020 2020 0a20  xt_i.    .    . 
-0007fa00: 2020 2064 6566 2070 7269 6e74 2873 656c     def print(sel
-0007fa10: 6629 3a0a 2020 2020 2020 2020 666f 7220  f):.        for 
-0007fa20: 6f73 6920 696e 2073 656c 662e 6f73 695f  osi in self.osi_
-0007fa30: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
-0007fa40: 2070 7269 6e74 2827 2569 202d 2025 693a   print('%i - %i:
-0007fa50: 2025 6927 2025 2028 6f73 692e 7374 6172   %i' % (osi.star
-0007fa60: 742c 206f 7369 2e65 6e64 2c20 6f73 692e  t, osi.end, osi.
-0007fa70: 6f73 2929 0a0a 2020 2020 2020 2020 2020  os))..          
-0007fa80: 2020 0a64 6566 2047 656e 6572 6174 655f    .def Generate_
-0007fa90: 5265 6665 7265 6e63 6528 6774 665f 6669  Reference(gtf_fi
-0007faa0: 6c65 2c20 6765 6e6f 6d65 5f66 696c 652c  le, genome_file,
-0007fab0: 2070 6570 7469 6465 203d 2054 7275 652c   peptide = True,
-0007fac0: 206f 7574 5f64 6972 203d 204e 6f6e 652c   out_dir = None,
-0007fad0: 2073 7566 6669 7820 3d20 4e6f 6e65 293a   suffix = None):
-0007fae0: 0a0a 2020 2020 6765 6e6f 6d65 203d 206c  ..    genome = l
-0007faf0: 6f61 645f 6765 6e6f 6d65 2867 656e 6f6d  oad_genome(genom
-0007fb00: 655f 6669 6c65 2c20 7665 7262 6f73 6520  e_file, verbose 
-0007fb10: 3d20 5472 7565 290a 0a20 2020 2067 7466  = True)..    gtf
-0007fb20: 5f6c 696e 6573 2c20 6864 725f 6c69 6e65  _lines, hdr_line
-0007fb30: 7320 3d20 6c6f 6164 5f67 7466 2867 7466  s = load_gtf(gtf
-0007fb40: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
-0007fb50: 2054 7275 6529 0a20 2020 2067 645f 6c73   True).    gd_ls
-0007fb60: 742c 2063 6872 7320 3d20 6765 745f 6765  t, chrs = get_ge
-0007fb70: 6e65 5f64 6573 6372 6970 746f 7228 6774  ne_descriptor(gt
-0007fb80: 665f 6c69 6e65 732c 2067 656e 6f6d 6520  f_lines, genome 
-0007fb90: 3d20 4e6f 6e65 2c20 6669 6c6c 203d 2046  = None, fill = F
-0007fba0: 616c 7365 2c20 5c0a 2020 2020 2020 2020  alse, \.        
-0007fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e1a0: 2323 230a 0a53 4e56 5f69 6e66 6f20 3d20  ###..SNV_info = 
+0007e1b0: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
+0007e1c0: 6474 7570 6c65 2827 534e 565f 696e 666f  dtuple('SNV_info
+0007e1d0: 272c 2027 6368 722c 2070 6f73 5f72 6566  ', 'chr, pos_ref
+0007e1e0: 2c20 706f 735f 6e65 772c 2067 656e 655f  , pos_new, gene_
+0007e1f0: 6964 2c20 6765 6e65 5f6e 616d 652c 2076  id, gene_name, v
+0007e200: 5f74 7970 652c 2076 5f6c 656e 2c20 6376  _type, v_len, cv
+0007e210: 675f 6465 7074 682c 2063 7667 5f66 7261  g_depth, cvg_fra
+0007e220: 632c 205c 0a20 2020 2020 2020 2020 2020  c, \.           
+0007e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e240: 2020 2020 2020 2020 7265 665f 7072 6576          ref_prev
+0007e250: 2c20 7265 665f 7365 712c 2072 6566 5f6e  , ref_seq, ref_n
+0007e260: 6578 742c 2061 6c74 5f70 7265 762c 2061  ext, alt_prev, a
+0007e270: 6c74 5f73 6571 2c20 616c 745f 6e65 7874  lt_seq, alt_next
+0007e280: 2729 2023 206f 6e65 2d62 6173 650a 0a4e  ') # one-base..N
+0007e290: 5749 4e20 3d20 330a 6465 6620 6669 6e64  WIN = 3.def find
+0007e2a0: 5f73 6e70 5f6f 6c64 2873 672c 2073 722c  _snp_old(sg, sr,
+0007e2b0: 2063 722c 2063 6872 6d2c 2070 6f73 5f61   cr, chrm, pos_a
+0007e2c0: 6273 2c20 6f73 2c20 6769 6e29 3a0a 2020  bs, os, gin):.  
+0007e2d0: 2020 0a20 2020 2073 6e76 5f69 6e66 6f5f    .    snv_info_
+0007e2e0: 6c73 7420 3d20 5b5d 0a20 2020 206c 656e  lst = [].    len
+0007e2f0: 5f74 6f5f 7465 7374 203d 206d 696e 286c  _to_test = min(l
+0007e300: 656e 2873 7229 2c6c 656e 2873 6729 290a  en(sr),len(sg)).
+0007e310: 0a20 2020 2073 7461 7274 203d 2030 0a20  .    start = 0. 
+0007e320: 2020 2065 6e64 203d 206d 696e 2820 3130     end = min( 10
+0007e330: 302c 206c 656e 5f74 6f5f 7465 7374 2029  0, len_to_test )
+0007e340: 0a20 2020 204e 203d 2069 6e74 286e 702e  .    N = int(np.
+0007e350: 6365 696c 2820 6c65 6e5f 746f 5f74 6573  ceil( len_to_tes
+0007e360: 742f 3130 3020 2929 0a20 2020 2023 2727  t/100 )).    #''
+0007e370: 270a 2020 2020 666f 7220 6e20 696e 2072  '.    for n in r
+0007e380: 616e 6765 284e 293a 0a20 2020 2020 2020  ange(N):.       
+0007e390: 200a 2020 2020 2020 2020 6966 2073 675b   .        if sg[
+0007e3a0: 7374 6172 743a 656e 645d 2021 3d20 7372  start:end] != sr
+0007e3b0: 5b73 7461 7274 3a65 6e64 5d3a 0a0a 2020  [start:end]:..  
+0007e3c0: 2020 2020 2020 2020 2020 7020 3d20 300a            p = 0.
+0007e3d0: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
+0007e3e0: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
+0007e3f0: 2020 2020 206c 656e 5f6c 7374 203d 205b       len_lst = [
+0007e400: 5d0a 2020 2020 2020 2020 2020 2020 6376  ].            cv
+0007e410: 675f 6c73 7420 3d20 5b5d 0a20 2020 2020  g_lst = [].     
+0007e420: 2020 2020 2020 2073 6e70 5f6c 7374 203d         snp_lst =
+0007e430: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0007e440: 736e 705f 6f72 675f 6c73 7420 3d20 5b5d  snp_org_lst = []
+0007e450: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0007e460: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
+0007e470: 696e 2072 616e 6765 2873 7461 7274 2c20  in range(start, 
+0007e480: 656e 6429 3a0a 2020 2020 2020 2020 2020  end):.          
+0007e490: 2020 2020 2020 6966 2073 725b 6b5d 2021        if sr[k] !
+0007e4a0: 3d20 7367 5b6b 5d3a 0a20 2020 2020 2020  = sg[k]:.       
+0007e4b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007e4c0: 7020 3d3d 2030 3a20 706f 7320 3d20 6b0a  p == 0: pos = k.
+0007e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e4e0: 2020 2020 7020 2b3d 2031 0a20 2020 2020      p += 1.     
+0007e4f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0007e500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e510: 2020 2020 2069 6620 7020 3e20 303a 0a20       if p > 0:. 
+0007e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e530: 2020 2020 2020 2023 2063 7667 5f6c 7374         # cvg_lst
+0007e540: 2e61 7070 656e 6428 6e70 2e6d 6561 6e28  .append(np.mean(
+0007e550: 2063 725b 706f 733a 2870 6f73 2b70 295d   cr[pos:(pos+p)]
+0007e560: 2029 2029 0a20 2020 2020 2020 2020 2020   ) ).           
+0007e570: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+0007e580: 6e70 5f6c 7374 2e61 7070 656e 6428 7372  np_lst.append(sr
+0007e590: 5b70 6f73 3a28 706f 732b 7029 5d29 0a20  [pos:(pos+p)]). 
+0007e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e5b0: 2020 2020 2020 2070 6f73 5f6c 7374 2e61         pos_lst.a
+0007e5c0: 7070 656e 6428 706f 7329 0a20 2020 2020  ppend(pos).     
+0007e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e5e0: 2020 206c 656e 5f6c 7374 2e61 7070 656e     len_lst.appen
+0007e5f0: 6428 7029 0a20 2020 2020 2020 2020 2020  d(p).           
+0007e600: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+0007e610: 6e70 5f6f 7267 5f6c 7374 2e61 7070 656e  np_org_lst.appen
+0007e620: 6428 7367 5b70 6f73 3a28 706f 732b 7029  d(sg[pos:(pos+p)
+0007e630: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0007e640: 2020 2020 2020 2020 2020 2070 203d 2030             p = 0
+0007e650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e660: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0007e670: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
+0007e680: 286c 656e 2870 6f73 5f6c 7374 2929 3a0a  (len(pos_lst)):.
+0007e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e6b0: 2070 3120 3d20 6d61 7828 302c 2870 6f73   p1 = max(0,(pos
+0007e6c0: 5f6c 7374 5b6b 5d2d 4e57 494e 2929 0a20  _lst[k]-NWIN)). 
+0007e6d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007e6e0: 3220 3d20 6d69 6e28 6c65 6e5f 746f 5f74  2 = min(len_to_t
+0007e6f0: 6573 742c 2870 6f73 5f6c 7374 5b6b 5d2b  est,(pos_lst[k]+
+0007e700: 6c65 6e5f 6c73 745b 6b5d 2b4e 5749 4e29  len_lst[k]+NWIN)
+0007e710: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007e720: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007e730: 2020 2073 6f70 203d 2073 675b 7031 3a70     sop = sg[p1:p
+0007e740: 6f73 5f6c 7374 5b6b 5d5d 0a20 2020 2020  os_lst[k]].     
+0007e750: 2020 2020 2020 2020 2020 2073 6f63 203d             soc =
+0007e760: 2073 675b 706f 735f 6c73 745b 6b5d 3a28   sg[pos_lst[k]:(
+0007e770: 706f 735f 6c73 745b 6b5d 2b6c 656e 5f6c  pos_lst[k]+len_l
+0007e780: 7374 5b6b 5d29 5d0a 2020 2020 2020 2020  st[k])].        
+0007e790: 2020 2020 2020 2020 736f 6e20 3d20 7367          son = sg
+0007e7a0: 5b28 706f 735f 6c73 745b 6b5d 2b6c 656e  [(pos_lst[k]+len
+0007e7b0: 5f6c 7374 5b6b 5d29 3a70 325d 0a20 2020  _lst[k]):p2].   
+0007e7c0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0007e7d0: 2020 2020 2020 2020 2020 2020 2020 736e                sn
+0007e7e0: 7020 3d20 7372 5b70 313a 706f 735f 6c73  p = sr[p1:pos_ls
+0007e7f0: 745b 6b5d 5d0a 2020 2020 2020 2020 2020  t[k]].          
+0007e800: 2020 2020 2020 736e 6320 3d20 7372 5b70        snc = sr[p
+0007e810: 6f73 5f6c 7374 5b6b 5d3a 2870 6f73 5f6c  os_lst[k]:(pos_l
+0007e820: 7374 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d  st[k]+len_lst[k]
+0007e830: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+0007e840: 2020 2073 6e6e 203d 2073 725b 2870 6f73     snn = sr[(pos
+0007e850: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
+0007e860: 6b5d 293a 7032 5d0a 2020 2020 2020 2020  k]):p2].        
+0007e870: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0007e880: 2020 2020 2020 2020 2073 6920 3d20 534e           si = SN
+0007e890: 565f 696e 666f 2863 6872 6d2c 2070 6f73  V_info(chrm, pos
+0007e8a0: 5f6c 7374 5b6b 5d2b 706f 735f 6162 732c  _lst[k]+pos_abs,
+0007e8b0: 2070 6f73 5f6c 7374 5b6b 5d2b 706f 735f   pos_lst[k]+pos_
+0007e8c0: 6162 732b 6f73 2c20 6769 6e5b 305d 2c20  abs+os, gin[0], 
+0007e8d0: 6769 6e5b 315d 2c20 2756 272c 206c 656e  gin[1], 'V', len
+0007e8e0: 5f6c 7374 5b6b 5d2c 205c 0a20 2020 2020  _lst[k], \.     
+0007e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e900: 2020 2020 2020 2020 2069 6e74 2863 725b           int(cr[
+0007e910: 706f 735f 6c73 745b 6b5d 5d29 2c20 312c  pos_lst[k]]), 1,
+0007e920: 2073 6f70 2c20 736f 632c 2073 6f6e 2c20   sop, soc, son, 
+0007e930: 736e 702c 2073 6e63 2c20 736e 6e20 290a  snp, snc, snn ).
+0007e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e950: 736e 765f 696e 666f 5f6c 7374 2e61 7070  snv_info_lst.app
+0007e960: 656e 6428 7369 290a 0a20 2020 2020 2020  end(si)..       
+0007e970: 2073 7461 7274 203d 2065 6e64 0a20 2020   start = end.   
+0007e980: 2020 2020 2065 6e64 203d 206d 696e 2820       end = min( 
+0007e990: 656e 6420 2b20 3130 302c 206c 656e 5f74  end + 100, len_t
+0007e9a0: 6f5f 7465 7374 2029 0a20 2020 2023 2727  o_test ).    #''
+0007e9b0: 2720 2020 2020 2020 2020 0a20 2020 2072  '         .    r
+0007e9c0: 6574 7572 6e28 736e 765f 696e 666f 5f6c  eturn(snv_info_l
+0007e9d0: 7374 290a 0a0a 6465 6620 6669 6e64 5f73  st)...def find_s
+0007e9e0: 6e70 2873 672c 2073 722c 2063 6d61 742c  np(sg, sr, cmat,
+0007e9f0: 2063 6872 6d2c 2070 6f73 5f61 6273 2c20   chrm, pos_abs, 
+0007ea00: 6f73 2c20 6769 6e29 3a0a 2020 2020 0a20  os, gin):.    . 
+0007ea10: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
+0007ea20: 3d20 5b5d 0a20 2020 206c 656e 5f74 6f5f  = [].    len_to_
+0007ea30: 7465 7374 203d 206d 696e 286c 656e 2873  test = min(len(s
+0007ea40: 7229 2c6c 656e 2873 6729 290a 0a20 2020  r),len(sg))..   
+0007ea50: 2063 7220 3d20 636d 6174 2e73 756d 2861   cr = cmat.sum(a
+0007ea60: 7869 7320 3d20 3029 0a20 2020 206e 7320  xis = 0).    ns 
+0007ea70: 3d20 6e70 2e61 7267 6d61 7828 2063 6d61  = np.argmax( cma
+0007ea80: 742c 2061 7869 733d 3020 290a 2020 2020  t, axis=0 ).    
+0007ea90: 7072 203d 2063 6d61 745b 6e73 2c6e 702e  pr = cmat[ns,np.
+0007eaa0: 6172 616e 6765 286c 656e 286e 7329 295d  arange(len(ns))]
+0007eab0: 2f63 720a 0a20 2020 2070 203d 2030 0a20  /cr..    p = 0. 
+0007eac0: 2020 2070 6f73 5f6c 7374 203d 205b 5d0a     pos_lst = [].
+0007ead0: 2020 2020 6c65 6e5f 6c73 7420 3d20 5b5d      len_lst = []
+0007eae0: 0a20 2020 2063 7667 5f6c 7374 203d 205b  .    cvg_lst = [
+0007eaf0: 5d0a 2020 2020 6366 725f 6c73 7420 3d20  ].    cfr_lst = 
+0007eb00: 5b5d 0a20 2020 2073 6e70 5f6c 7374 203d  [].    snp_lst =
+0007eb10: 205b 5d0a 2020 2020 736e 705f 6f72 675f   [].    snp_org_
+0007eb20: 6c73 7420 3d20 5b5d 0a20 2020 200a 2020  lst = [].    .  
+0007eb30: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
+0007eb40: 286c 656e 5f74 6f5f 7465 7374 293a 0a20  (len_to_test):. 
+0007eb50: 2020 2020 2020 2069 6620 7372 5b6b 5d20         if sr[k] 
+0007eb60: 213d 2073 675b 6b5d 3a0a 2020 2020 2020  != sg[k]:.      
+0007eb70: 2020 2020 2020 6966 2070 203d 3d20 303a        if p == 0:
+0007eb80: 2070 6f73 203d 206b 0a20 2020 2020 2020   pos = k.       
+0007eb90: 2020 2020 2070 202b 3d20 310a 2020 2020       p += 1.    
+0007eba0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0007ebb0: 2020 2020 2020 6966 2070 203e 2030 3a0a        if p > 0:.
+0007ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ebd0: 2320 6376 675f 6c73 742e 6170 7065 6e64  # cvg_lst.append
+0007ebe0: 286e 702e 6d65 616e 2820 6372 5b70 6f73  (np.mean( cr[pos
+0007ebf0: 3a28 706f 732b 7029 5d20 2920 290a 2020  :(pos+p)] ) ).  
+0007ec00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0007ec10: 736e 705f 6c73 742e 6170 7065 6e64 2873  snp_lst.append(s
+0007ec20: 725b 706f 733a 2870 6f73 2b70 295d 290a  r[pos:(pos+p)]).
+0007ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ec40: 706f 735f 6c73 742e 6170 7065 6e64 2870  pos_lst.append(p
+0007ec50: 6f73 290a 2020 2020 2020 2020 2020 2020  os).            
+0007ec60: 2020 2020 6c65 6e5f 6c73 742e 6170 7065      len_lst.appe
+0007ec70: 6e64 2870 290a 2020 2020 2020 2020 2020  nd(p).          
+0007ec80: 2020 2020 2020 2320 736e 705f 6f72 675f        # snp_org_
+0007ec90: 6c73 742e 6170 7065 6e64 2873 675b 706f  lst.append(sg[po
+0007eca0: 733a 2870 6f73 2b70 295d 290a 2020 2020  s:(pos+p)]).    
+0007ecb0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
+0007ecc0: 300a 2020 2020 2020 2020 2020 2020 0a20  0.            . 
+0007ecd0: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
+0007ece0: 6528 6c65 6e28 706f 735f 6c73 7429 293a  e(len(pos_lst)):
+0007ecf0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0007ed00: 2020 7031 203d 206d 6178 2830 2c28 706f    p1 = max(0,(po
+0007ed10: 735f 6c73 745b 6b5d 2d4e 5749 4e29 290a  s_lst[k]-NWIN)).
+0007ed20: 2020 2020 2020 2020 7032 203d 206d 696e          p2 = min
+0007ed30: 286c 656e 5f74 6f5f 7465 7374 2c28 706f  (len_to_test,(po
+0007ed40: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
+0007ed50: 5b6b 5d2b 4e57 494e 2929 0a20 2020 2020  [k]+NWIN)).     
+0007ed60: 2020 200a 2020 2020 2020 2020 736f 7020     .        sop 
+0007ed70: 3d20 7367 5b70 313a 706f 735f 6c73 745b  = sg[p1:pos_lst[
+0007ed80: 6b5d 5d0a 2020 2020 2020 2020 736f 6320  k]].        soc 
+0007ed90: 3d20 7367 5b70 6f73 5f6c 7374 5b6b 5d3a  = sg[pos_lst[k]:
+0007eda0: 2870 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f  (pos_lst[k]+len_
+0007edb0: 6c73 745b 6b5d 295d 0a20 2020 2020 2020  lst[k])].       
+0007edc0: 2073 6f6e 203d 2073 675b 2870 6f73 5f6c   son = sg[(pos_l
+0007edd0: 7374 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d  st[k]+len_lst[k]
+0007ede0: 293a 7032 5d0a 2020 2020 2020 2020 0a20  ):p2].        . 
+0007edf0: 2020 2020 2020 2073 6e70 203d 2073 725b         snp = sr[
+0007ee00: 7031 3a70 6f73 5f6c 7374 5b6b 5d5d 0a20  p1:pos_lst[k]]. 
+0007ee10: 2020 2020 2020 2073 6e63 203d 2073 725b         snc = sr[
+0007ee20: 706f 735f 6c73 745b 6b5d 3a28 706f 735f  pos_lst[k]:(pos_
+0007ee30: 6c73 745b 6b5d 2b6c 656e 5f6c 7374 5b6b  lst[k]+len_lst[k
+0007ee40: 5d29 5d0a 2020 2020 2020 2020 736e 6e20  ])].        snn 
+0007ee50: 3d20 7372 5b28 706f 735f 6c73 745b 6b5d  = sr[(pos_lst[k]
+0007ee60: 2b6c 656e 5f6c 7374 5b6b 5d29 3a70 325d  +len_lst[k]):p2]
+0007ee70: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0007ee80: 2020 7369 203d 2053 4e56 5f69 6e66 6f28    si = SNV_info(
+0007ee90: 6368 726d 2c20 706f 735f 6c73 745b 6b5d  chrm, pos_lst[k]
+0007eea0: 2b70 6f73 5f61 6273 2c20 706f 735f 6c73  +pos_abs, pos_ls
+0007eeb0: 745b 6b5d 2b70 6f73 5f61 6273 2b6f 732c  t[k]+pos_abs+os,
+0007eec0: 2067 696e 5b30 5d2c 2067 696e 5b31 5d2c   gin[0], gin[1],
+0007eed0: 2027 5627 2c20 6c65 6e5f 6c73 745b 6b5d   'V', len_lst[k]
+0007eee0: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+0007eef0: 2020 2020 2020 2020 2020 696e 7428 6372            int(cr
+0007ef00: 5b70 6f73 5f6c 7374 5b6b 5d5d 292c 206e  [pos_lst[k]]), n
+0007ef10: 702e 726f 756e 6428 7072 5b70 6f73 5f6c  p.round(pr[pos_l
+0007ef20: 7374 5b6b 5d5d 2c33 292c 2073 6f70 2c20  st[k]],3), sop, 
+0007ef30: 736f 632c 2073 6f6e 2c20 736e 702c 2073  soc, son, snp, s
+0007ef40: 6e63 2c20 736e 6e20 290a 2020 2020 2020  nc, snn ).      
+0007ef50: 2020 736e 765f 696e 666f 5f6c 7374 2e61    snv_info_lst.a
+0007ef60: 7070 656e 6428 7369 290a 0a20 2020 2072  ppend(si)..    r
+0007ef70: 6574 7572 6e28 736e 765f 696e 666f 5f6c  eturn(snv_info_l
+0007ef80: 7374 290a 0a0a 6465 6620 636f 6d70 6172  st)...def compar
+0007ef90: 655f 7365 7132 2820 7331 2c20 7332 2029  e_seq2( s1, s2 )
+0007efa0: 3a0a 2020 2020 636e 7420 3d20 300a 2020  :.    cnt = 0.  
+0007efb0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0007efc0: 286d 696e 286c 656e 2873 3129 2c6c 656e  (min(len(s1),len
+0007efd0: 2873 3229 2929 3a0a 2020 2020 2020 2020  (s2))):.        
+0007efe0: 636e 7420 2b3d 2028 7331 5b69 5d20 213d  cnt += (s1[i] !=
+0007eff0: 2073 325b 695d 290a 2020 2020 2320 6966   s2[i]).    # if
+0007f000: 206c 656e 2873 3129 2021 3d20 6c65 6e28   len(s1) != len(
+0007f010: 7332 293a 2070 7269 6e74 2827 5741 524e  s2): print('WARN
+0007f020: 494e 4720 696e 2063 6f6d 7061 7265 5f73  ING in compare_s
+0007f030: 6571 323a 2025 6920 213d 2025 6927 2025  eq2: %i != %i' %
+0007f040: 2028 6c65 6e28 7331 292c 6c65 6e28 7332   (len(s1),len(s2
+0007f050: 2929 2029 0a20 2020 2072 6574 7572 6e20  )) ).    return 
+0007f060: 636e 740a 0a0a 4f53 5f69 6e66 6f20 3d20  cnt...OS_info = 
+0007f070: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
+0007f080: 6474 7570 6c65 2827 4f53 5f69 6e66 6f27  dtuple('OS_info'
+0007f090: 2c20 276f 732c 2073 7461 7274 2c20 656e  , 'os, start, en
+0007f0a0: 6427 2920 2320 6f6e 652d 6261 7365 0a0a  d') # one-base..
+0007f0b0: 636c 6173 7320 6f66 6673 6574 5f66 696e  class offset_fin
+0007f0c0: 6465 723a 0a20 2020 200a 2020 2020 6465  der:.    .    de
+0007f0d0: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+0007f0e0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6f  :.        self.o
+0007f0f0: 7369 5f6c 7374 203d 205b 5d0a 2020 2020  si_lst = [].    
+0007f100: 2020 2020 7365 6c66 2e6f 735f 6d61 7020      self.os_map 
+0007f110: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+0007f120: 656c 662e 6f73 5f70 7265 7620 3d20 300a  elf.os_prev = 0.
+0007f130: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
+0007f140: 2061 6464 2820 7365 6c66 2c20 6f73 2c20   add( self, os, 
+0007f150: 7374 6172 742c 2065 6e64 293a 0a20 2020  start, end):.   
+0007f160: 2020 2020 2073 656c 662e 6f73 695f 6c73       self.osi_ls
+0007f170: 742e 6170 7065 6e64 2820 4f53 5f69 6e66  t.append( OS_inf
+0007f180: 6f28 6f73 2c20 7374 6172 742c 2065 6e64  o(os, start, end
+0007f190: 2920 290a 2020 2020 2020 2020 0a20 2020  ) ).        .   
+0007f1a0: 2064 6566 2066 696e 645f 6f73 2820 7365   def find_os( se
+0007f1b0: 6c66 2c20 706f 7320 293a 0a20 2020 2020  lf, pos ):.     
+0007f1c0: 2020 206f 7320 3d20 300a 2020 2020 2020     os = 0.      
+0007f1d0: 2020 666f 7220 6f73 6920 696e 2073 656c    for osi in sel
+0007f1e0: 662e 6f73 695f 6c73 743a 0a20 2020 2020  f.osi_lst:.     
+0007f1f0: 2020 2020 2020 2069 6620 2870 6f73 203e         if (pos >
+0007f200: 3d20 6f73 692e 7374 6172 7429 2026 2028  = osi.start) & (
+0007f210: 706f 7320 3c20 6f73 692e 656e 6429 3a20  pos < osi.end): 
+0007f220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007f230: 206f 7320 3d20 6f73 692e 6f73 0a20 2020   os = osi.os.   
+0007f240: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0007f250: 616b 0a20 2020 2020 2020 2072 6574 7572  ak.        retur
+0007f260: 6e20 6f73 0a0a 2020 2020 0a20 2020 2064  n os..    .    d
+0007f270: 6566 2066 696e 645f 6f73 5f73 6571 2820  ef find_os_seq( 
+0007f280: 7365 6c66 2c20 706f 732c 2070 7265 765f  self, pos, prev_
+0007f290: 692c 206d 6172 6b20 3d20 2727 2029 3a0a  i, mark = '' ):.
+0007f2a0: 2020 2020 2020 2020 6f73 203d 204e 6f6e          os = Non
+0007f2b0: 650a 2020 2020 2020 2020 6e65 7874 5f69  e.        next_i
+0007f2c0: 203d 2030 0a20 2020 2020 2020 2066 6f72   = 0.        for
+0007f2d0: 206b 2c20 6f73 6920 696e 2065 6e75 6d65   k, osi in enume
+0007f2e0: 7261 7465 2873 656c 662e 6f73 695f 6c73  rate(self.osi_ls
+0007f2f0: 745b 7072 6576 5f69 3a5d 293a 0a20 2020  t[prev_i:]):.   
+0007f300: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
+0007f310: 203e 3d20 6f73 692e 7374 6172 7429 2026   >= osi.start) &
+0007f320: 2028 706f 7320 3c20 6f73 692e 656e 6429   (pos < osi.end)
+0007f330: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0007f340: 2020 206f 7320 3d20 6f73 692e 6f73 0a20     os = osi.os. 
+0007f350: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0007f360: 6578 745f 6920 3d20 6b20 2b20 7072 6576  ext_i = k + prev
+0007f370: 5f69 200a 2020 2020 2020 2020 2020 2020  _i .            
+0007f380: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+0007f390: 2020 6966 206f 7320 6973 204e 6f6e 653a    if os is None:
+0007f3a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0007f3b0: 206b 2c20 6f73 6920 696e 2065 6e75 6d65   k, osi in enume
+0007f3c0: 7261 7465 2873 656c 662e 6f73 695f 6c73  rate(self.osi_ls
+0007f3d0: 745b 3a70 7265 765f 695d 293a 0a20 2020  t[:prev_i]):.   
+0007f3e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007f3f0: 2870 6f73 203e 3d20 6f73 692e 7374 6172  (pos >= osi.star
+0007f400: 7429 2026 2028 706f 7320 3c20 6f73 692e  t) & (pos < osi.
+0007f410: 656e 6429 3a20 0a20 2020 2020 2020 2020  end): .         
+0007f420: 2020 2020 2020 2020 2020 206f 7320 3d20             os = 
+0007f430: 6f73 692e 6f73 0a20 2020 2020 2020 2020  osi.os.         
+0007f440: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+0007f450: 6920 3d20 6b0a 2020 2020 2020 2020 2020  i = k.          
+0007f460: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0007f470: 0a20 2020 2020 2020 2069 6620 6f73 2069  .        if os i
+0007f480: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0007f490: 2020 2020 6f73 203d 2073 656c 662e 6f73      os = self.os
+0007f4a0: 5f70 7265 760a 2020 2020 2020 2020 2020  _prev.          
+0007f4b0: 2020 2320 7072 696e 7428 2745 5252 4f52    # print('ERROR
+0007f4c0: 2069 6e20 6669 6e64 5f6f 735f 7365 713a   in find_os_seq:
+0007f4d0: 206f 7320 6973 204e 6f6e 6520 2573 2720   os is None %s' 
+0007f4e0: 2520 6d61 726b 2029 0a20 2020 2020 2020  % mark ).       
+0007f4f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0007f500: 2020 2073 656c 662e 6f73 5f70 7265 7620     self.os_prev 
+0007f510: 3d20 6f73 0a20 2020 2020 2020 2020 2020  = os.           
+0007f520: 200a 2020 2020 2020 2020 7265 7475 726e   .        return
+0007f530: 206f 732c 206e 6578 745f 690a 2020 2020   os, next_i.    
+0007f540: 0a20 2020 200a 2020 2020 6465 6620 6d61  .    .    def ma
+0007f550: 6b65 5f69 745f 636f 6d70 6163 7428 2073  ke_it_compact( s
+0007f560: 656c 6620 293a 0a0a 2020 2020 2020 2020  elf ):..        
+0007f570: 666f 7220 6b20 696e 2072 6576 6572 7365  for k in reverse
+0007f580: 6428 7261 6e67 6528 312c 6c65 6e28 7365  d(range(1,len(se
+0007f590: 6c66 2e6f 7369 5f6c 7374 2929 293a 0a20  lf.osi_lst))):. 
+0007f5a0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0007f5b0: 6c66 2e6f 7369 5f6c 7374 5b6b 5d2e 6f73  lf.osi_lst[k].os
+0007f5c0: 203d 3d20 7365 6c66 2e6f 7369 5f6c 7374   == self.osi_lst
+0007f5d0: 5b6b 2d31 5d2e 6f73 3a0a 2020 2020 2020  [k-1].os:.      
+0007f5e0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+0007f5f0: 7369 5f6c 7374 5b6b 2d31 5d20 3d20 4f53  si_lst[k-1] = OS
+0007f600: 5f69 6e66 6f28 2073 656c 662e 6f73 695f  _info( self.osi_
+0007f610: 6c73 745b 6b2d 315d 2e6f 732c 2073 656c  lst[k-1].os, sel
+0007f620: 662e 6f73 695f 6c73 745b 6b2d 315d 2e73  f.osi_lst[k-1].s
+0007f630: 7461 7274 2c20 7365 6c66 2e6f 7369 5f6c  tart, self.osi_l
+0007f640: 7374 5b6b 5d2e 656e 6420 290a 2020 2020  st[k].end ).    
+0007f650: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+0007f660: 7365 6c66 2e6f 7369 5f6c 7374 5b6b 5d0a  self.osi_lst[k].
+0007f670: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
+0007f680: 2067 6574 5f62 6e64 7279 2820 7365 6c66   get_bndry( self
+0007f690: 2c20 706f 7320 293a 0a20 2020 2020 2020  , pos ):.       
+0007f6a0: 206f 7320 3d20 300a 2020 2020 2020 2020   os = 0.        
+0007f6b0: 666f 7220 6f73 6920 696e 2073 656c 662e  for osi in self.
+0007f6c0: 6f73 695f 6c73 743a 0a20 2020 2020 2020  osi_lst:.       
+0007f6d0: 2020 2020 2069 6620 2870 6f73 203e 3d20       if (pos >= 
+0007f6e0: 6f73 692e 7374 6172 7429 3a20 0a20 2020  osi.start): .   
+0007f6f0: 2020 2020 2020 2020 2020 2020 206f 7320               os 
+0007f700: 3d20 6f73 692e 7374 6172 740a 2020 2020  = osi.start.    
+0007f710: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0007f720: 6b0a 2020 2020 2020 2020 7265 7475 726e  k.        return
+0007f730: 206f 730a 2020 2020 0a20 2020 2064 6566   os.    .    def
+0007f740: 2067 6574 5f62 6e64 7279 5f73 6571 2820   get_bndry_seq( 
+0007f750: 7365 6c66 2c20 706f 732c 2070 7265 765f  self, pos, prev_
+0007f760: 6920 293a 0a20 2020 2020 2020 206f 7320  i ):.        os 
+0007f770: 3d20 4e6f 6e65 0a20 2020 2020 2020 206e  = None.        n
+0007f780: 6578 745f 6920 3d20 300a 2020 2020 2020  ext_i = 0.      
+0007f790: 2020 666f 7220 6b2c 206f 7369 2069 6e20    for k, osi in 
+0007f7a0: 656e 756d 6572 6174 6528 7365 6c66 2e6f  enumerate(self.o
+0007f7b0: 7369 5f6c 7374 5b70 7265 765f 693a 5d29  si_lst[prev_i:])
+0007f7c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0007f7d0: 2028 706f 7320 3e3d 206f 7369 2e73 7461   (pos >= osi.sta
+0007f7e0: 7274 2920 2620 2870 6f73 203c 206f 7369  rt) & (pos < osi
+0007f7f0: 2e65 6e64 293a 200a 2020 2020 2020 2020  .end): .        
+0007f800: 2020 2020 2020 2020 6f73 203d 206f 7369          os = osi
+0007f810: 2e73 7461 7274 0a20 2020 2020 2020 2020  .start.         
+0007f820: 2020 2020 2020 206e 6578 745f 6920 3d20         next_i = 
+0007f830: 6b20 2b20 7072 6576 5f69 200a 2020 2020  k + prev_i .    
+0007f840: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0007f850: 6b0a 2020 2020 2020 2020 6966 206f 7320  k.        if os 
+0007f860: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0007f870: 2020 2020 2066 6f72 206b 2c20 6f73 6920       for k, osi 
+0007f880: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
+0007f890: 662e 6f73 695f 6c73 745b 3a70 7265 765f  f.osi_lst[:prev_
+0007f8a0: 695d 293a 0a20 2020 2020 2020 2020 2020  i]):.           
+0007f8b0: 2020 2020 2069 6620 2870 6f73 203e 3d20       if (pos >= 
+0007f8c0: 6f73 692e 7374 6172 7429 2026 2028 706f  osi.start) & (po
+0007f8d0: 7320 3c20 6f73 692e 656e 6429 3a20 0a20  s < osi.end): . 
+0007f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007f8f0: 2020 206f 7320 3d20 6f73 692e 7374 6172     os = osi.star
+0007f900: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0007f910: 2020 2020 2020 6e65 7874 5f69 203d 206b        next_i = k
+0007f920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007f930: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+0007f940: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0007f950: 6966 206f 7320 6973 204e 6f6e 653a 0a20  if os is None:. 
+0007f960: 2020 2020 2020 2020 2020 206f 7320 3d20             os = 
+0007f970: 300a 2020 2020 2020 2020 2020 2020 6e65  0.            ne
+0007f980: 7874 5f69 203d 2030 0a20 2020 2020 2020  xt_i = 0.       
+0007f990: 2020 2020 2070 7269 6e74 2827 4552 524f       print('ERRO
+0007f9a0: 5220 696e 2067 6574 5f62 6e64 7279 5f73  R in get_bndry_s
+0007f9b0: 6571 3a20 6f73 2069 7320 4e6f 6e65 2729  eq: os is None')
+0007f9c0: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+0007f9d0: 656c 662e 7072 696e 7428 290a 2020 2020  elf.print().    
+0007f9e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0007f9f0: 2072 6574 7572 6e20 6f73 2c20 6e65 7874   return os, next
+0007fa00: 5f69 0a20 2020 200a 2020 2020 0a20 2020  _i.    .    .   
+0007fa10: 2064 6566 2070 7269 6e74 2873 656c 6629   def print(self)
+0007fa20: 3a0a 2020 2020 2020 2020 666f 7220 6f73  :.        for os
+0007fa30: 6920 696e 2073 656c 662e 6f73 695f 6c73  i in self.osi_ls
+0007fa40: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+0007fa50: 7269 6e74 2827 2569 202d 2025 693a 2025  rint('%i - %i: %
+0007fa60: 6927 2025 2028 6f73 692e 7374 6172 742c  i' % (osi.start,
+0007fa70: 206f 7369 2e65 6e64 2c20 6f73 692e 6f73   osi.end, osi.os
+0007fa80: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+0007fa90: 0a64 6566 2047 656e 6572 6174 655f 5265  .def Generate_Re
+0007faa0: 6665 7265 6e63 6528 6774 665f 6669 6c65  ference(gtf_file
+0007fab0: 2c20 6765 6e6f 6d65 5f66 696c 652c 2070  , genome_file, p
+0007fac0: 6570 7469 6465 203d 2054 7275 652c 206f  eptide = True, o
+0007fad0: 7574 5f64 6972 203d 204e 6f6e 652c 2073  ut_dir = None, s
+0007fae0: 7566 6669 7820 3d20 4e6f 6e65 293a 0a0a  uffix = None):..
+0007faf0: 2020 2020 6765 6e6f 6d65 203d 206c 6f61      genome = loa
+0007fb00: 645f 6765 6e6f 6d65 2867 656e 6f6d 655f  d_genome(genome_
+0007fb10: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
+0007fb20: 5472 7565 290a 0a20 2020 2067 7466 5f6c  True)..    gtf_l
+0007fb30: 696e 6573 2c20 6864 725f 6c69 6e65 7320  ines, hdr_lines 
+0007fb40: 3d20 6c6f 6164 5f67 7466 2867 7466 5f66  = load_gtf(gtf_f
+0007fb50: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
+0007fb60: 7275 6529 0a20 2020 2067 645f 6c73 742c  rue).    gd_lst,
+0007fb70: 2063 6872 7320 3d20 6765 745f 6765 6e65   chrs = get_gene
+0007fb80: 5f64 6573 6372 6970 746f 7228 6774 665f  _descriptor(gtf_
+0007fb90: 6c69 6e65 732c 2067 656e 6f6d 6520 3d20  lines, genome = 
+0007fba0: 4e6f 6e65 2c20 6669 6c6c 203d 2046 616c  None, fill = Fal
+0007fbb0: 7365 2c20 5c0a 2020 2020 2020 2020 2020  se, \.          
 0007fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007fbd0: 2020 2063 6720 3d20 4661 6c73 652c 2076     cg = False, v
-0007fbe0: 6572 626f 7365 203d 2054 7275 652c 206e  erbose = True, n
-0007fbf0: 5f63 6f72 6573 203d 2031 290a 2020 2020  _cores = 1).    
-0007fc00: 6764 5f6c 7374 732c 2063 6872 5f6c 7374  gd_lsts, chr_lst
-0007fc10: 203d 2070 6163 6b5f 6765 6e65 5f64 6573   = pack_gene_des
-0007fc20: 6372 6970 746f 7228 2067 645f 6c73 742c  criptor( gd_lst,
-0007fc30: 2063 6872 7320 290a 2020 2020 0a0a 2020   chrs ).    ..  
-0007fc40: 2020 2320 6669 6c65 5f6e 616d 6520 3d20    # file_name = 
-0007fc50: 6774 665f 6669 6c65 2e73 706c 6974 2827  gtf_file.split('
-0007fc60: 2f27 295b 2d31 5d0a 2020 2020 2320 666e  /')[-1].    # fn
-0007fc70: 7320 3d20 6669 6c65 5f6e 616d 652e 7370  s = file_name.sp
-0007fc80: 6c69 7428 272e 2729 5b3a 2d31 5d0a 2020  lit('.')[:-1].  
-0007fc90: 2020 666e 7320 3d20 6774 665f 6669 6c65    fns = gtf_file
-0007fca0: 2e73 706c 6974 2827 2e27 295b 3a2d 315d  .split('.')[:-1]
-0007fcb0: 0a20 2020 2066 6e61 6d65 203d 2027 270a  .    fname = ''.
-0007fcc0: 2020 2020 666f 7220 6b2c 2066 6e20 696e      for k, fn in
-0007fcd0: 2065 6e75 6d65 7261 7465 2866 6e73 293a   enumerate(fns):
-0007fce0: 0a20 2020 2020 2020 2069 6620 6b20 3e20  .        if k > 
-0007fcf0: 303a 0a20 2020 2020 2020 2020 2020 2066  0:.            f
-0007fd00: 6e61 6d65 203d 2066 6e61 6d65 202b 2027  name = fname + '
-0007fd10: 2e27 0a20 2020 2020 2020 2066 6e61 6d65  .'.        fname
-0007fd20: 203d 2066 6e61 6d65 202b 2066 6e0a 2020   = fname + fn.  
-0007fd30: 2020 6966 206f 7574 5f64 6972 2069 7320    if out_dir is 
-0007fd40: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0007fd50: 2020 6966 206f 7574 5f64 6972 5b2d 315d    if out_dir[-1]
-0007fd60: 203d 3d20 272f 273a 0a20 2020 2020 2020   == '/':.       
-0007fd70: 2020 2020 2066 6e61 6d65 203d 206f 7574       fname = out
-0007fd80: 5f64 6972 202b 2066 6e61 6d65 0a20 2020  _dir + fname.   
-0007fd90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0007fda0: 2020 2020 2020 2066 6e61 6d65 203d 206f         fname = o
-0007fdb0: 7574 5f64 6972 202b 2027 2f27 202b 2066  ut_dir + '/' + f
-0007fdc0: 6e61 6d65 0a0a 2020 2020 6966 2073 7566  name..    if suf
-0007fdd0: 6669 7820 6973 204e 6f6e 653a 2020 2020  fix is None:    
-0007fde0: 0a20 2020 2020 2020 2066 615f 6669 6c65  .        fa_file
-0007fdf0: 5f74 7220 3d20 666e 616d 6520 2b20 275f  _tr = fname + '_
-0007fe00: 7472 616e 7363 7269 7074 6f6d 652e 6661  transcriptome.fa
-0007fe10: 270a 2020 2020 2020 2020 6661 5f66 696c  '.        fa_fil
-0007fe20: 655f 7072 203d 2066 6e61 6d65 202b 2027  e_pr = fname + '
-0007fe30: 5f70 726f 7465 6f6d 652e 6661 270a 2020  _proteome.fa'.  
-0007fe40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0007fe50: 6661 5f66 696c 655f 7472 203d 2066 6e61  fa_file_tr = fna
-0007fe60: 6d65 202b 2027 5f25 735f 7472 616e 7363  me + '_%s_transc
-0007fe70: 7269 7074 6f6d 652e 6661 2720 2520 7375  riptome.fa' % su
-0007fe80: 6666 6978 0a20 2020 2020 2020 2066 615f  ffix.        fa_
-0007fe90: 6669 6c65 5f70 7220 3d20 666e 616d 6520  file_pr = fname 
-0007fea0: 2b20 275f 2573 5f70 726f 7465 6f6d 652e  + '_%s_proteome.
-0007feb0: 6661 2720 2520 7375 6666 6978 0a0a 2020  fa' % suffix..  
-0007fec0: 2020 6661 5f74 7220 3d20 5b5d 0a20 2020    fa_tr = [].   
-0007fed0: 2066 615f 7072 203d 205b 5d0a 2020 2020   fa_pr = [].    
-0007fee0: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
-0007fef0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-0007ff00: 2020 6e74 7220 3d20 300a 0a20 2020 206d    ntr = 0..    m
-0007ff10: 6178 5f61 626e 203d 2030 0a20 2020 206d  ax_abn = 0.    m
-0007ff20: 6178 5f63 6f76 203d 2030 0a20 2020 2066  ax_cov = 0.    f
-0007ff30: 6f72 206b 6b2c 2063 6872 6d20 696e 2065  or kk, chrm in e
-0007ff40: 6e75 6d65 7261 7465 2863 6872 5f6c 7374  numerate(chr_lst
-0007ff50: 293a 0a20 2020 2020 2020 2066 6f72 2067  ):.        for g
-0007ff60: 6420 696e 2067 645f 6c73 7473 5b6b 6b5d  d in gd_lsts[kk]
-0007ff70: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0007ff80: 7220 7464 2069 6e20 6764 2e74 645f 6c73  r td in gd.td_ls
-0007ff90: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0007ffa0: 2020 2069 6620 7464 2e61 626e 203e 2030     if td.abn > 0
-0007ffb0: 3a20 6d61 785f 6162 6e20 3d20 6d61 7828  : max_abn = max(
-0007ffc0: 206d 6178 5f61 626e 2c20 7464 2e61 626e   max_abn, td.abn
-0007ffd0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0007ffe0: 2020 2069 6620 7464 2e63 6f76 203e 2030     if td.cov > 0
-0007fff0: 3a20 6d61 785f 636f 7620 3d20 6d61 7828  : max_cov = max(
-00080000: 206d 6178 5f63 6f76 2c20 7464 2e63 6f76   max_cov, td.cov
-00080010: 2029 0a0a 2020 2020 6966 206d 6178 5f61   )..    if max_a
-00080020: 626e 203e 2030 3a20 6162 6e5f 7468 203d  bn > 0: abn_th =
-00080030: 204d 494e 5f41 424e 5f54 4f5f 5345 4c0a   MIN_ABN_TO_SEL.
-00080040: 2020 2020 656c 7365 3a20 6162 6e5f 7468      else: abn_th
-00080050: 203d 2030 0a20 2020 2069 6620 6d61 785f   = 0.    if max_
-00080060: 636f 7620 3e20 303a 2063 6f76 5f74 6820  cov > 0: cov_th 
-00080070: 3d20 4d49 4e5f 434f 565f 544f 5f53 454c  = MIN_COV_TO_SEL
-00080080: 0a20 2020 2065 6c73 653a 2063 6f76 5f74  .    else: cov_t
-00080090: 6820 3d20 300a 2020 2020 7072 696e 7428  h = 0.    print(
-000800a0: 2743 7574 6f66 663a 2041 203d 2025 352e  'Cutoff: A = %5.
-000800b0: 3266 2c20 4320 3d20 2535 2e32 6620 2720  2f, C = %5.2f ' 
-000800c0: 2520 2861 626e 5f74 682c 2063 6f76 5f74  % (abn_th, cov_t
-000800d0: 6829 290a 0a20 2020 2066 6f72 206b 6b2c  h))..    for kk,
-000800e0: 2063 6872 6d20 696e 2065 6e75 6d65 7261   chrm in enumera
-000800f0: 7465 2863 6872 5f6c 7374 293a 0a0a 2020  te(chr_lst):..  
-00080100: 2020 2020 2020 7072 696e 7428 275c 7227        print('\r'
-00080110: 202b 2027 2027 2a31 3030 2c20 656e 643d   + ' '*100, end=
-00080120: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-00080130: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00080140: 275c 7247 656e 6572 6174 696e 6720 7265  '\rGenerating re
-00080150: 6665 7265 6e63 6573 202e 2e20 2573 2020  ferences .. %s  
-00080160: 2720 2520 2863 6872 6d29 2c20 656e 6420  ' % (chrm), end 
-00080170: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
-00080180: 7565 290a 0a20 2020 2020 2020 2066 6f72  ue)..        for
-00080190: 2067 6420 696e 2067 645f 6c73 7473 5b6b   gd in gd_lsts[k
-000801a0: 6b5d 3a0a 2020 2020 2020 2020 2020 2020  k]:.            
-000801b0: 2320 6764 2e6f 7264 6572 2829 0a20 2020  # gd.order().   
-000801c0: 2020 2020 2020 2020 206e 7472 202b 3d20           ntr += 
-000801d0: 6764 2e6e 7472 0a20 2020 2020 2020 2020  gd.ntr.         
-000801e0: 2020 2066 615f 742c 2066 615f 7020 3d20     fa_t, fa_p = 
-000801f0: 6764 2e67 6574 5f66 6173 7461 5f6c 696e  gd.get_fasta_lin
-00080200: 6573 5f66 726f 6d5f 6765 6e6f 6d65 2867  es_from_genome(g
-00080210: 656e 6f6d 652c 2061 626e 5f74 6820 3d20  enome, abn_th = 
-00080220: 6162 6e5f 7468 2c20 636f 765f 7468 203d  abn_th, cov_th =
-00080230: 2063 6f76 5f74 682c 206c 656e 5f74 685f   cov_th, len_th_
-00080240: 743d 204d 494e 5f54 525f 4c45 4e47 5448  t= MIN_TR_LENGTH
-00080250: 2c20 6c65 6e5f 7468 5f70 203d 204d 494e  , len_th_p = MIN
-00080260: 5f50 525f 4c45 4e47 5448 290a 2020 2020  _PR_LENGTH).    
-00080270: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00080280: 2020 2020 2023 2066 615f 7420 3d20 6669       # fa_t = fi
-00080290: 6c74 6572 5f74 7273 5f6c 656e 2866 615f  lter_trs_len(fa_
-000802a0: 742c 206d 696e 5f6c 656e 203d 204d 494e  t, min_len = MIN
-000802b0: 5f54 525f 4c45 4e47 5448 290a 2020 2020  _TR_LENGTH).    
-000802c0: 2020 2020 2020 2020 2320 6661 5f70 203d          # fa_p =
-000802d0: 2066 696c 7465 725f 7472 735f 6c65 6e28   filter_trs_len(
-000802e0: 6661 5f70 2c20 6d69 6e5f 6c65 6e20 3d20  fa_p, min_len = 
-000802f0: 4d49 4e5f 5052 5f4c 454e 4754 4829 0a20  MIN_PR_LENGTH). 
-00080300: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00080310: 2020 2020 2020 2020 6661 5f74 7220 3d20          fa_tr = 
-00080320: 6661 5f74 7220 2b20 6661 5f74 0a20 2020  fa_tr + fa_t.   
-00080330: 2020 2020 2020 2020 2066 615f 7072 203d           fa_pr =
-00080340: 2066 615f 7072 202b 2066 615f 700a 2020   fa_pr + fa_p.  
-00080350: 2020 2020 2020 2020 2020 0a20 2020 200a            .    .
-00080360: 2020 2020 6966 2028 6c65 6e28 6661 5f70      if (len(fa_p
-00080370: 7229 203d 3d20 3029 2026 2028 7065 7074  r) == 0) & (pept
-00080380: 6964 6529 3a0a 2020 2020 2020 2020 6864  ide):.        hd
-00080390: 725f 6c73 742c 2074 7365 715f 6c73 7420  r_lst, tseq_lst 
-000803a0: 3d20 5b5d 2c20 5b5d 0a20 2020 2020 2020  = [], [].       
-000803b0: 2066 6f72 206c 696e 6520 696e 2066 615f   for line in fa_
-000803c0: 7472 3a0a 2020 2020 2020 2020 2020 2020  tr:.            
-000803d0: 6966 206c 696e 655b 305d 203d 3d20 273e  if line[0] == '>
-000803e0: 273a 2068 6472 5f6c 7374 2e61 7070 656e  ': hdr_lst.appen
-000803f0: 6428 6c69 6e65 5b31 3a2d 315d 290a 2020  d(line[1:-1]).  
-00080400: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-00080410: 7473 6571 5f6c 7374 2e61 7070 656e 6428  tseq_lst.append(
-00080420: 6c69 6e65 5b30 3a2d 315d 290a 0a20 2020  line[0:-1])..   
-00080430: 2020 2020 2066 615f 7072 203d 2067 656e       fa_pr = gen
-00080440: 5f70 726f 7465 6f6d 655f 6672 6f6d 5f74  _proteome_from_t
-00080450: 7261 7363 7269 7074 6f6d 6528 6864 725f  rascriptome(hdr_
-00080460: 6c73 742c 2074 7365 715f 6c73 742c 206c  lst, tseq_lst, l
-00080470: 656e 5f74 6820 3d20 4d49 4e5f 5052 5f4c  en_th = MIN_PR_L
-00080480: 454e 4754 482c 2076 6572 626f 7365 203d  ENGTH, verbose =
-00080490: 2054 7275 652c 2074 7261 7265 636f 203d   True, trareco =
-000804a0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
-000804b0: 705f 6361 6e64 5f63 6e74 203d 206c 656e  p_cand_cnt = len
-000804c0: 2866 615f 7072 292f 320a 0a20 2020 2020  (fa_pr)/2..     
-000804d0: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
-000804e0: 7261 7469 6e67 2072 6566 6572 656e 6365  rating reference
-000804f0: 7320 2e2e 2064 6f6e 652e 2025 6920 2d3e  s .. done. %i ->
-00080500: 2025 692c 2569 2720 2520 286e 7472 2c20   %i,%i' % (ntr, 
-00080510: 6c65 6e28 6661 5f74 7229 2f32 2c20 705f  len(fa_tr)/2, p_
-00080520: 6361 6e64 5f63 6e74 2929 0a20 2020 2065  cand_cnt)).    e
-00080530: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
-00080540: 6e74 2827 5c72 4765 6e65 7261 7469 6e67  nt('\rGenerating
-00080550: 2072 6566 6572 656e 6365 7320 2e2e 2064   references .. d
-00080560: 6f6e 652e 2025 6920 2d3e 2025 6927 2025  one. %i -> %i' %
-00080570: 2028 6e74 722c 206c 656e 2866 615f 7472   (ntr, len(fa_tr
-00080580: 292f 3229 290a 0a20 2020 2070 7269 6e74  )/2))..    print
-00080590: 2827 5361 7669 6e67 2046 4153 5441 202e  ('Saving FASTA .
-000805a0: 2e27 2c20 656e 6420 3d20 2727 2c20 666c  .', end = '', fl
-000805b0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-000805c0: 6620 3d20 6f70 656e 2866 615f 6669 6c65  f = open(fa_file
-000805d0: 5f74 722c 2027 772b 2729 0a20 2020 2066  _tr, 'w+').    f
-000805e0: 2e77 7269 7465 6c69 6e65 7328 6661 5f74  .writelines(fa_t
-000805f0: 7229 0a20 2020 2066 2e63 6c6f 7365 2829  r).    f.close()
-00080600: 0a0a 2020 2020 6966 2070 6570 7469 6465  ..    if peptide
-00080610: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00080620: 272e 272c 2065 6e64 3d27 2729 0a20 2020  '.', end='').   
-00080630: 2020 2020 2066 203d 206f 7065 6e28 6661       f = open(fa
-00080640: 5f66 696c 655f 7072 2c20 2777 2b27 290a  _file_pr, 'w+').
-00080650: 2020 2020 2020 2020 662e 7772 6974 656c          f.writel
-00080660: 696e 6573 2866 615f 7072 290a 2020 2020  ines(fa_pr).    
-00080670: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
-00080680: 2020 2065 6c61 7073 6564 5f74 696d 6520     elapsed_time 
-00080690: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
-000806a0: 7374 6172 745f 7469 6d65 0a20 2020 2070  start_time.    p
-000806b0: 7269 6e74 2827 2064 6f6e 652e 2028 2569  rint(' done. (%i
-000806c0: 2920 2720 2520 2865 6c61 7073 6564 5f74  ) ' % (elapsed_t
-000806d0: 696d 6529 290a 2020 2020 7072 696e 7428  ime)).    print(
-000806e0: 2720 2020 2573 2720 2520 6661 5f66 696c  '   %s' % fa_fil
-000806f0: 655f 7472 2029 0a20 2020 2069 6620 7065  e_tr ).    if pe
-00080700: 7074 6964 653a 2070 7269 6e74 2827 2020  ptide: print('  
-00080710: 2025 7327 2025 2066 615f 6669 6c65 5f70   %s' % fa_file_p
-00080720: 7220 290a 2020 2020 0a20 2020 2072 6574  r ).    .    ret
-00080730: 7572 6e20 6661 5f66 696c 655f 7472 2c20  urn fa_file_tr, 
-00080740: 6661 5f66 696c 655f 7072 0a20 2020 200a  fa_file_pr.    .
-00080750: 0a64 6566 206d 635f 636f 7265 5f72 6563  .def mc_core_rec
-00080760: 6f6e 7374 7275 6374 696f 6e28 6767 635f  onstruction(ggc_
-00080770: 7475 706c 6529 3a0a 2020 2020 0a20 2020  tuple):.    .   
-00080780: 2067 645f 7365 6c20 3d20 6767 635f 7475   gd_sel = ggc_tu
-00080790: 706c 655b 305d 0a20 2020 2073 6571 5f6f  ple[0].    seq_o
-000807a0: 7267 203d 2067 6763 5f74 7570 6c65 5b31  rg = ggc_tuple[1
-000807b0: 5d0a 2020 2020 6368 726d 203d 2067 6763  ].    chrm = ggc
-000807c0: 5f74 7570 6c65 5b32 5d0a 2020 2020 0a20  _tuple[2].    . 
-000807d0: 2020 2023 2067 645f 7365 6c20 3d20 736f     # gd_sel = so
-000807e0: 7274 5f64 6573 6372 6970 746f 725f 6c73  rt_descriptor_ls
-000807f0: 7428 6764 5f73 656c 290a 2020 2020 6e5f  t(gd_sel).    n_
-00080800: 6764 203d 206c 656e 2867 645f 7365 6c29  gd = len(gd_sel)
-00080810: 0a0a 2020 2020 2323 2323 2323 2323 2323  ..    ##########
-00080820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080830: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
-00080840: 2063 6f6c 6c65 6374 2072 676e 7320 616e   collect rgns an
-00080850: 6420 6d61 726b 2074 6865 6972 2070 6f73  d mark their pos
-00080860: 0a20 2020 200a 2020 2020 7374 6172 745f  .    .    start_
-00080870: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-00080880: 2829 0a20 2020 206c 6f63 5f6f 7320 3d20  ().    loc_os = 
-00080890: 6e70 2e7a 6572 6f73 286e 5f67 642c 6474  np.zeros(n_gd,dt
-000808a0: 7970 653d 6e70 2e66 6c6f 6174 3332 290a  ype=np.float32).
-000808b0: 2020 2020 6e75 6d5f 6f73 203d 206e 702e      num_os = np.
-000808c0: 7a65 726f 7328 6e5f 6764 2c64 7479 7065  zeros(n_gd,dtype
-000808d0: 3d6e 702e 666c 6f61 7433 3229 0a20 2020  =np.float32).   
-000808e0: 2072 616c 6c20 3d20 7265 6769 6f6e 7328   rall = regions(
-000808f0: 290a 2020 2020 4765 6e65 5f69 645f 6e61  ).    Gene_id_na
-00080900: 6d65 203d 205b 5d0a 2020 2020 6764 5f69  me = [].    gd_i
-00080910: 6478 5f6f 665f 7267 6e20 3d20 5b5d 0a20  dx_of_rgn = []. 
-00080920: 2020 206f 735f 6375 7220 3d20 300a 2020     os_cur = 0.  
-00080930: 2020 725f 706f 7320 3d20 5b5d 0a20 2020    r_pos = [].   
-00080940: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
-00080950: 756d 6572 6174 6528 6764 5f73 656c 293a  umerate(gd_sel):
-00080960: 0a0a 2020 2020 2020 2020 2323 2063 6865  ..        ## che
-00080970: 636b 2069 6620 616e 7920 4420 6f72 2049  ck if any D or I
-00080980: 206c 6965 7320 7769 7468 696e 2061 6e20   lies within an 
-00080990: 6578 6f6e 0a20 2020 2020 2020 2066 6f72  exon.        for
-000809a0: 2065 2069 6e20 6764 2e65 786f 6e73 2e72   e in gd.exons.r
-000809b0: 676e 733a 0a20 2020 2020 2020 2020 2020  gns:.           
-000809c0: 2069 6620 652e 7479 7065 203d 3d20 2764   if e.type == 'd
-000809d0: 656c 6574 696f 6e27 3a0a 2020 2020 2020  eletion':.      
-000809e0: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
-000809f0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00080a00: 2020 2020 666f 7220 6320 696e 2067 642e      for c in gd.
-00080a10: 6578 6f6e 732e 7267 6e73 3a0a 2020 2020  exons.rgns:.    
-00080a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080a30: 6966 2028 632e 7479 7065 203d 3d20 2765  if (c.type == 'e
-00080a40: 786f 6e27 293a 0a20 2020 2020 2020 2020  xon'):.         
-00080a50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00080a60: 6620 652e 6861 735f 6578 745f 696e 7465  f e.has_ext_inte
-00080a70: 7273 6563 7469 6f6e 5f77 6974 6828 6329  rsection_with(c)
-00080a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00080a90: 2020 2020 2020 2020 2020 2020 2020 6220                b 
-00080aa0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00080ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080ac0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00080ad0: 2020 2020 2020 2020 2027 2727 0a20 2020           '''.   
-00080ae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00080af0: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
-00080b00: 2020 2020 2020 2070 7269 6e74 2827 5741         print('WA
-00080b10: 524e 494e 473a 2044 2825 733a 2569 2d25  RNING: D(%s:%i-%
-00080b20: 6929 206f 7665 726c 6170 7320 7769 7468  i) overlaps with
-00080b30: 2045 2825 733a 2569 2d25 6929 2720 2520   E(%s:%i-%i)' % 
-00080b40: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00080b50: 2020 2020 2020 2020 2020 2020 2865 2e63              (e.c
-00080b60: 6872 2c20 652e 7374 6172 742c 2065 2e65  hr, e.start, e.e
-00080b70: 6e64 2c20 632e 6368 722c 2063 2e73 7461  nd, c.chr, c.sta
-00080b80: 7274 2c20 632e 656e 6429 290a 2020 2020  rt, c.end)).    
-00080b90: 2020 2020 2020 2020 2020 2020 2727 2720              ''' 
-00080ba0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00080bb0: 656c 6966 2065 2e74 7970 6520 3d3d 2027  elif e.type == '
-00080bc0: 696e 7365 7273 696f 6e27 3a0a 2020 2020  insersion':.    
-00080bd0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-00080be0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00080bf0: 2020 2020 2020 666f 7220 6320 696e 2067        for c in g
-00080c00: 642e 6578 6f6e 732e 7267 6e73 3a0a 2020  d.exons.rgns:.  
-00080c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080c20: 2020 6966 2028 632e 7479 7065 203d 3d20    if (c.type == 
-00080c30: 2765 786f 6e27 293a 0a20 2020 2020 2020  'exon'):.       
-00080c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080c50: 2069 6620 2865 2e73 7461 7274 203e 2063   if (e.start > c
-00080c60: 2e73 7461 7274 2920 2620 2865 2e73 7461  .start) & (e.sta
-00080c70: 7274 203c 2063 2e65 6e64 293a 0a20 2020  rt < c.end):.   
-00080c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080c90: 2020 2020 2020 2020 2062 203d 2054 7275           b = Tru
-00080ca0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00080cb0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00080cc0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00080cd0: 2020 2020 2727 2720 2020 200a 2020 2020      '''    .    
-00080ce0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-00080cf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00080d00: 2020 2020 2020 7072 696e 7428 2757 4152        print('WAR
-00080d10: 4e49 4e47 3a20 4928 2573 3a25 692d 2569  NING: I(%s:%i-%i
-00080d20: 2920 6f76 6572 6c61 7073 2077 6974 6820  ) overlaps with 
-00080d30: 4528 2573 3a25 692d 2569 2927 2025 205c  E(%s:%i-%i)' % \
-00080d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00080d50: 2020 2020 2020 2020 2020 2028 652e 6368             (e.ch
-00080d60: 722c 2065 2e73 7461 7274 2c20 652e 656e  r, e.start, e.en
-00080d70: 642c 2063 2e63 6872 2c20 632e 7374 6172  d, c.chr, c.star
-00080d80: 742c 2063 2e65 6e64 2929 0a20 2020 2020  t, c.end)).     
-00080d90: 2020 2020 2020 2020 2020 2027 2727 2020             '''  
-00080da0: 2020 0a0a 2020 2020 2020 2020 6c6f 635f    ..        loc_
-00080db0: 6f73 5b6b 5d20 3d20 6f73 5f63 7572 0a20  os[k] = os_cur. 
-00080dc0: 2020 2020 2020 206e 756d 5f6f 735b 6b5d         num_os[k]
-00080dd0: 203d 206c 656e 2867 642e 6578 6f6e 732e   = len(gd.exons.
-00080de0: 7267 6e73 290a 2020 2020 2020 2020 7261  rgns).        ra
-00080df0: 6c6c 2e72 676e 7320 3d20 7261 6c6c 2e72  ll.rgns = rall.r
-00080e00: 676e 7320 2b20 6764 2e65 786f 6e73 2e72  gns + gd.exons.r
-00080e10: 676e 730a 2020 2020 2020 2020 675f 6964  gns.        g_id
-00080e20: 5f6e 5f6e 616d 655f 6c73 7420 3d20 6764  _n_name_lst = gd
-00080e30: 2e67 6574 5f67 6964 5f6e 5f67 6e61 6d65  .get_gid_n_gname
-00080e40: 5f6c 6973 7428 290a 2020 2020 2020 2020  _list().        
-00080e50: 4765 6e65 5f69 645f 6e61 6d65 203d 2047  Gene_id_name = G
-00080e60: 656e 655f 6964 5f6e 616d 6520 2b20 675f  ene_id_name + g_
-00080e70: 6964 5f6e 5f6e 616d 655f 6c73 740a 2020  id_n_name_lst.  
-00080e80: 2020 2020 2020 6764 5f69 6478 5f6f 665f        gd_idx_of_
-00080e90: 7267 6e20 3d20 6764 5f69 6478 5f6f 665f  rgn = gd_idx_of_
-00080ea0: 7267 6e20 2b20 5b6b 5d2a 6c65 6e28 6764  rgn + [k]*len(gd
-00080eb0: 2e65 786f 6e73 2e72 676e 7329 0a20 2020  .exons.rgns).   
-00080ec0: 2020 2020 206f 735f 6375 7220 2b3d 206c       os_cur += l
-00080ed0: 656e 2867 642e 6578 6f6e 732e 7267 6e73  en(gd.exons.rgns
-00080ee0: 290a 0a20 2020 2020 2020 2066 6f72 2072  )..        for r
-00080ef0: 2069 6e20 6764 2e65 786f 6e73 2e72 676e   in gd.exons.rgn
-00080f00: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-00080f10: 2072 5f70 6f73 2e61 7070 656e 6428 722e   r_pos.append(r.
-00080f20: 656e 6429 0a20 2020 2020 2020 2020 2020  end).           
-00080f30: 2072 5f70 6f73 2e61 7070 656e 6428 722e   r_pos.append(r.
-00080f40: 7374 6172 7429 0a0a 2020 2020 2323 2323  start)..    ####
-00080f50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080f60: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00080f70: 2020 2020 2323 2067 6574 206f 7264 6572      ## get order
-00080f80: 2061 6363 6f72 6469 6e67 2074 6f20 6c6f   according to lo
-00080f90: 6361 7469 6f6e 0a20 2020 2072 5f70 6f73  cation.    r_pos
-00080fa0: 203d 206e 702e 6172 7261 7928 725f 706f   = np.array(r_po
-00080fb0: 7329 0a20 2020 206f 6472 203d 2072 5f70  s).    odr = r_p
-00080fc0: 6f73 2e61 7267 736f 7274 2829 0a0a 2020  os.argsort()..  
-00080fd0: 2020 666f 7220 6b2c 206f 2069 6e20 656e    for k, o in en
-00080fe0: 756d 6572 6174 6528 6f64 7229 3a0a 2020  umerate(odr):.  
-00080ff0: 2020 2020 2020 7220 3d20 7261 6c6c 2e72        r = rall.r
-00081000: 676e 735b 6f5d 0a20 2020 2020 2020 2069  gns[o].        i
-00081010: 6620 722e 7479 7065 203d 3d20 2769 6e73  f r.type == 'ins
-00081020: 6572 7369 6f6e 273a 0a20 2020 2020 2020  ersion':.       
-00081030: 2020 2020 2072 7020 3d20 7261 6c6c 2e72       rp = rall.r
-00081040: 676e 735b 6f64 725b 6b2d 315d 5d0a 2020  gns[odr[k-1]].  
-00081050: 2020 2020 2020 2020 2020 6966 2028 722e            if (r.
-00081060: 7374 6172 7420 3d3d 2072 702e 7374 6172  start == rp.star
-00081070: 7429 2026 2028 7270 2e74 7970 6520 3d3d  t) & (rp.type ==
-00081080: 2027 6578 6f6e 2729 3a0a 2020 2020 2020   'exon'):.      
-00081090: 2020 2020 2020 2020 2020 6f70 203d 206f            op = o
-000810a0: 6472 5b6b 2d31 5d0a 2020 2020 2020 2020  dr[k-1].        
-000810b0: 2020 2020 2020 2020 6f64 725b 6b2d 315d          odr[k-1]
-000810c0: 203d 206f 6472 5b6b 5d0a 2020 2020 2020   = odr[k].      
-000810d0: 2020 2020 2020 2020 2020 6f64 725b 6b5d            odr[k]
-000810e0: 203d 206f 700a 2020 2020 2020 2020 2020   = op.          
-000810f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00081100: 2020 2020 2020 2020 726e 203d 2072 616c          rn = ral
-00081110: 6c2e 7267 6e73 5b6f 6472 5b6b 2b31 5d5d  l.rgns[odr[k+1]]
-00081120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081130: 2069 6620 2872 6e2e 7374 6172 7420 3d3d   if (rn.start ==
-00081140: 2072 2e73 7461 7274 2920 2620 2872 6e2e   r.start) & (rn.
-00081150: 7479 7065 203d 3d20 2765 786f 6e27 293a  type == 'exon'):
-00081160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081170: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00081180: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00081190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000811a0: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
-000811b0: 2025 693a 204e 6f20 636f 6e6e 6563 7469   %i: No connecti
-000811c0: 6f6e 2066 6f75 6e64 2066 6f72 2049 2025  on found for I %
-000811d0: 692c 2573 2d25 692c 2573 2d25 692c 2573  i,%s-%i,%s-%i,%s
-000811e0: 2720 2520 5c0a 2020 2020 2020 2020 2020  ' % \.          
-000811f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081200: 286b 2c20 7270 2e73 7461 7274 2c72 702e  (k, rp.start,rp.
-00081210: 7479 7065 2c20 722e 7374 6172 742c 722e  type, r.start,r.
-00081220: 7479 7065 2c20 726e 2e73 7461 7274 2c20  type, rn.start, 
-00081230: 726e 2e74 7970 6529 2029 0a0a 2020 2020  rn.type) )..    
-00081240: 656c 6170 7365 645f 7469 6d65 203d 2074  elapsed_time = t
-00081250: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00081260: 7274 5f74 696d 650a 2020 2020 2320 7072  rt_time.    # pr
-00081270: 696e 7428 2720 2020 312e 2064 6f6e 6520  int('   1. done 
-00081280: 2825 6929 2020 2720 2520 2865 6c61 7073  (%i)  ' % (elaps
-00081290: 6564 5f74 696d 6529 2c20 666c 7573 6820  ed_time), flush 
-000812a0: 3d20 5472 7565 290a 2020 2020 2327 2727  = True).    #'''
-000812b0: 0a0a 2020 2020 2327 2727 0a20 2020 2023  ..    #'''.    #
-000812c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007fbe0: 2063 6720 3d20 4661 6c73 652c 2076 6572   cg = False, ver
+0007fbf0: 626f 7365 203d 2054 7275 652c 206e 5f63  bose = True, n_c
+0007fc00: 6f72 6573 203d 2031 290a 2020 2020 6764  ores = 1).    gd
+0007fc10: 5f6c 7374 732c 2063 6872 5f6c 7374 203d  _lsts, chr_lst =
+0007fc20: 2070 6163 6b5f 6765 6e65 5f64 6573 6372   pack_gene_descr
+0007fc30: 6970 746f 7228 2067 645f 6c73 742c 2063  iptor( gd_lst, c
+0007fc40: 6872 7320 290a 2020 2020 0a0a 2020 2020  hrs ).    ..    
+0007fc50: 2320 6669 6c65 5f6e 616d 6520 3d20 6774  # file_name = gt
+0007fc60: 665f 6669 6c65 2e73 706c 6974 2827 2f27  f_file.split('/'
+0007fc70: 295b 2d31 5d0a 2020 2020 2320 666e 7320  )[-1].    # fns 
+0007fc80: 3d20 6669 6c65 5f6e 616d 652e 7370 6c69  = file_name.spli
+0007fc90: 7428 272e 2729 5b3a 2d31 5d0a 2020 2020  t('.')[:-1].    
+0007fca0: 666e 7320 3d20 6774 665f 6669 6c65 2e73  fns = gtf_file.s
+0007fcb0: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
+0007fcc0: 2020 2066 6e61 6d65 203d 2027 270a 2020     fname = ''.  
+0007fcd0: 2020 666f 7220 6b2c 2066 6e20 696e 2065    for k, fn in e
+0007fce0: 6e75 6d65 7261 7465 2866 6e73 293a 0a20  numerate(fns):. 
+0007fcf0: 2020 2020 2020 2069 6620 6b20 3e20 303a         if k > 0:
+0007fd00: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
+0007fd10: 6d65 203d 2066 6e61 6d65 202b 2027 2e27  me = fname + '.'
+0007fd20: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
+0007fd30: 2066 6e61 6d65 202b 2066 6e0a 2020 2020   fname + fn.    
+0007fd40: 6966 206f 7574 5f64 6972 2069 7320 6e6f  if out_dir is no
+0007fd50: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0007fd60: 6966 206f 7574 5f64 6972 5b2d 315d 203d  if out_dir[-1] =
+0007fd70: 3d20 272f 273a 0a20 2020 2020 2020 2020  = '/':.         
+0007fd80: 2020 2066 6e61 6d65 203d 206f 7574 5f64     fname = out_d
+0007fd90: 6972 202b 2066 6e61 6d65 0a20 2020 2020  ir + fname.     
+0007fda0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0007fdb0: 2020 2020 2066 6e61 6d65 203d 206f 7574       fname = out
+0007fdc0: 5f64 6972 202b 2027 2f27 202b 2066 6e61  _dir + '/' + fna
+0007fdd0: 6d65 0a0a 2020 2020 6966 2073 7566 6669  me..    if suffi
+0007fde0: 7820 6973 204e 6f6e 653a 2020 2020 0a20  x is None:    . 
+0007fdf0: 2020 2020 2020 2066 615f 6669 6c65 5f74         fa_file_t
+0007fe00: 7220 3d20 666e 616d 6520 2b20 275f 7472  r = fname + '_tr
+0007fe10: 616e 7363 7269 7074 6f6d 652e 6661 270a  anscriptome.fa'.
+0007fe20: 2020 2020 2020 2020 6661 5f66 696c 655f          fa_file_
+0007fe30: 7072 203d 2066 6e61 6d65 202b 2027 5f70  pr = fname + '_p
+0007fe40: 726f 7465 6f6d 652e 6661 270a 2020 2020  roteome.fa'.    
+0007fe50: 656c 7365 3a0a 2020 2020 2020 2020 6661  else:.        fa
+0007fe60: 5f66 696c 655f 7472 203d 2066 6e61 6d65  _file_tr = fname
+0007fe70: 202b 2027 5f25 735f 7472 616e 7363 7269   + '_%s_transcri
+0007fe80: 7074 6f6d 652e 6661 2720 2520 7375 6666  ptome.fa' % suff
+0007fe90: 6978 0a20 2020 2020 2020 2066 615f 6669  ix.        fa_fi
+0007fea0: 6c65 5f70 7220 3d20 666e 616d 6520 2b20  le_pr = fname + 
+0007feb0: 275f 2573 5f70 726f 7465 6f6d 652e 6661  '_%s_proteome.fa
+0007fec0: 2720 2520 7375 6666 6978 0a0a 2020 2020  ' % suffix..    
+0007fed0: 6661 5f74 7220 3d20 5b5d 0a20 2020 2066  fa_tr = [].    f
+0007fee0: 615f 7072 203d 205b 5d0a 2020 2020 0a20  a_pr = [].    . 
+0007fef0: 2020 2073 7461 7274 5f74 696d 6520 3d20     start_time = 
+0007ff00: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
+0007ff10: 6e74 7220 3d20 300a 0a20 2020 206d 6178  ntr = 0..    max
+0007ff20: 5f61 626e 203d 2030 0a20 2020 206d 6178  _abn = 0.    max
+0007ff30: 5f63 6f76 203d 2030 0a20 2020 2066 6f72  _cov = 0.    for
+0007ff40: 206b 6b2c 2063 6872 6d20 696e 2065 6e75   kk, chrm in enu
+0007ff50: 6d65 7261 7465 2863 6872 5f6c 7374 293a  merate(chr_lst):
+0007ff60: 0a20 2020 2020 2020 2066 6f72 2067 6420  .        for gd 
+0007ff70: 696e 2067 645f 6c73 7473 5b6b 6b5d 3a0a  in gd_lsts[kk]:.
+0007ff80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0007ff90: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
+0007ffa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007ffb0: 2069 6620 7464 2e61 626e 203e 2030 3a20   if td.abn > 0: 
+0007ffc0: 6d61 785f 6162 6e20 3d20 6d61 7828 206d  max_abn = max( m
+0007ffd0: 6178 5f61 626e 2c20 7464 2e61 626e 2029  ax_abn, td.abn )
+0007ffe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007fff0: 2069 6620 7464 2e63 6f76 203e 2030 3a20   if td.cov > 0: 
+00080000: 6d61 785f 636f 7620 3d20 6d61 7828 206d  max_cov = max( m
+00080010: 6178 5f63 6f76 2c20 7464 2e63 6f76 2029  ax_cov, td.cov )
+00080020: 0a0a 2020 2020 6966 206d 6178 5f61 626e  ..    if max_abn
+00080030: 203e 2030 3a20 6162 6e5f 7468 203d 204d   > 0: abn_th = M
+00080040: 494e 5f41 424e 5f54 4f5f 5345 4c0a 2020  IN_ABN_TO_SEL.  
+00080050: 2020 656c 7365 3a20 6162 6e5f 7468 203d    else: abn_th =
+00080060: 2030 0a20 2020 2069 6620 6d61 785f 636f   0.    if max_co
+00080070: 7620 3e20 303a 2063 6f76 5f74 6820 3d20  v > 0: cov_th = 
+00080080: 4d49 4e5f 434f 565f 544f 5f53 454c 0a20  MIN_COV_TO_SEL. 
+00080090: 2020 2065 6c73 653a 2063 6f76 5f74 6820     else: cov_th 
+000800a0: 3d20 300a 2020 2020 7072 696e 7428 2743  = 0.    print('C
+000800b0: 7574 6f66 663a 2041 203d 2025 352e 3266  utoff: A = %5.2f
+000800c0: 2c20 4320 3d20 2535 2e32 6620 2720 2520  , C = %5.2f ' % 
+000800d0: 2861 626e 5f74 682c 2063 6f76 5f74 6829  (abn_th, cov_th)
+000800e0: 290a 0a20 2020 2066 6f72 206b 6b2c 2063  )..    for kk, c
+000800f0: 6872 6d20 696e 2065 6e75 6d65 7261 7465  hrm in enumerate
+00080100: 2863 6872 5f6c 7374 293a 0a0a 2020 2020  (chr_lst):..    
+00080110: 2020 2020 7072 696e 7428 275c 7227 202b      print('\r' +
+00080120: 2027 2027 2a31 3030 2c20 656e 643d 2727   ' '*100, end=''
+00080130: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+00080140: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
+00080150: 7247 656e 6572 6174 696e 6720 7265 6665  rGenerating refe
+00080160: 7265 6e63 6573 202e 2e20 2573 2020 2720  rences .. %s  ' 
+00080170: 2520 2863 6872 6d29 2c20 656e 6420 3d20  % (chrm), end = 
+00080180: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
+00080190: 290a 0a20 2020 2020 2020 2066 6f72 2067  )..        for g
+000801a0: 6420 696e 2067 645f 6c73 7473 5b6b 6b5d  d in gd_lsts[kk]
+000801b0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000801c0: 6764 2e6f 7264 6572 2829 0a20 2020 2020  gd.order().     
+000801d0: 2020 2020 2020 206e 7472 202b 3d20 6764         ntr += gd
+000801e0: 2e6e 7472 0a20 2020 2020 2020 2020 2020  .ntr.           
+000801f0: 2066 615f 742c 2066 615f 7020 3d20 6764   fa_t, fa_p = gd
+00080200: 2e67 6574 5f66 6173 7461 5f6c 696e 6573  .get_fasta_lines
+00080210: 5f66 726f 6d5f 6765 6e6f 6d65 2867 656e  _from_genome(gen
+00080220: 6f6d 652c 2061 626e 5f74 6820 3d20 6162  ome, abn_th = ab
+00080230: 6e5f 7468 2c20 636f 765f 7468 203d 2063  n_th, cov_th = c
+00080240: 6f76 5f74 682c 206c 656e 5f74 685f 743d  ov_th, len_th_t=
+00080250: 204d 494e 5f54 525f 4c45 4e47 5448 2c20   MIN_TR_LENGTH, 
+00080260: 6c65 6e5f 7468 5f70 203d 204d 494e 5f50  len_th_p = MIN_P
+00080270: 525f 4c45 4e47 5448 290a 2020 2020 2020  R_LENGTH).      
+00080280: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+00080290: 2020 2023 2066 615f 7420 3d20 6669 6c74     # fa_t = filt
+000802a0: 6572 5f74 7273 5f6c 656e 2866 615f 742c  er_trs_len(fa_t,
+000802b0: 206d 696e 5f6c 656e 203d 204d 494e 5f54   min_len = MIN_T
+000802c0: 525f 4c45 4e47 5448 290a 2020 2020 2020  R_LENGTH).      
+000802d0: 2020 2020 2020 2320 6661 5f70 203d 2066        # fa_p = f
+000802e0: 696c 7465 725f 7472 735f 6c65 6e28 6661  ilter_trs_len(fa
+000802f0: 5f70 2c20 6d69 6e5f 6c65 6e20 3d20 4d49  _p, min_len = MI
+00080300: 4e5f 5052 5f4c 454e 4754 4829 0a20 2020  N_PR_LENGTH).   
+00080310: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00080320: 2020 2020 2020 6661 5f74 7220 3d20 6661        fa_tr = fa
+00080330: 5f74 7220 2b20 6661 5f74 0a20 2020 2020  _tr + fa_t.     
+00080340: 2020 2020 2020 2066 615f 7072 203d 2066         fa_pr = f
+00080350: 615f 7072 202b 2066 615f 700a 2020 2020  a_pr + fa_p.    
+00080360: 2020 2020 2020 2020 0a20 2020 200a 2020          .    .  
+00080370: 2020 6966 2028 6c65 6e28 6661 5f70 7229    if (len(fa_pr)
+00080380: 203d 3d20 3029 2026 2028 7065 7074 6964   == 0) & (peptid
+00080390: 6529 3a0a 2020 2020 2020 2020 6864 725f  e):.        hdr_
+000803a0: 6c73 742c 2074 7365 715f 6c73 7420 3d20  lst, tseq_lst = 
+000803b0: 5b5d 2c20 5b5d 0a20 2020 2020 2020 2066  [], [].        f
+000803c0: 6f72 206c 696e 6520 696e 2066 615f 7472  or line in fa_tr
+000803d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000803e0: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
+000803f0: 2068 6472 5f6c 7374 2e61 7070 656e 6428   hdr_lst.append(
+00080400: 6c69 6e65 5b31 3a2d 315d 290a 2020 2020  line[1:-1]).    
+00080410: 2020 2020 2020 2020 656c 7365 3a20 7473          else: ts
+00080420: 6571 5f6c 7374 2e61 7070 656e 6428 6c69  eq_lst.append(li
+00080430: 6e65 5b30 3a2d 315d 290a 0a20 2020 2020  ne[0:-1])..     
+00080440: 2020 2066 615f 7072 203d 2067 656e 5f70     fa_pr = gen_p
+00080450: 726f 7465 6f6d 655f 6672 6f6d 5f74 7261  roteome_from_tra
+00080460: 7363 7269 7074 6f6d 6528 6864 725f 6c73  scriptome(hdr_ls
+00080470: 742c 2074 7365 715f 6c73 742c 206c 656e  t, tseq_lst, len
+00080480: 5f74 6820 3d20 4d49 4e5f 5052 5f4c 454e  _th = MIN_PR_LEN
+00080490: 4754 482c 2076 6572 626f 7365 203d 2054  GTH, verbose = T
+000804a0: 7275 652c 2074 7261 7265 636f 203d 2046  rue, trareco = F
+000804b0: 616c 7365 290a 2020 2020 2020 2020 705f  alse).        p_
+000804c0: 6361 6e64 5f63 6e74 203d 206c 656e 2866  cand_cnt = len(f
+000804d0: 615f 7072 292f 320a 0a20 2020 2020 2020  a_pr)/2..       
+000804e0: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
+000804f0: 7469 6e67 2072 6566 6572 656e 6365 7320  ting references 
+00080500: 2e2e 2064 6f6e 652e 2025 6920 2d3e 2025  .. done. %i -> %
+00080510: 692c 2569 2720 2520 286e 7472 2c20 6c65  i,%i' % (ntr, le
+00080520: 6e28 6661 5f74 7229 2f32 2c20 705f 6361  n(fa_tr)/2, p_ca
+00080530: 6e64 5f63 6e74 2929 0a20 2020 2065 6c73  nd_cnt)).    els
+00080540: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+00080550: 2827 5c72 4765 6e65 7261 7469 6e67 2072  ('\rGenerating r
+00080560: 6566 6572 656e 6365 7320 2e2e 2064 6f6e  eferences .. don
+00080570: 652e 2025 6920 2d3e 2025 6927 2025 2028  e. %i -> %i' % (
+00080580: 6e74 722c 206c 656e 2866 615f 7472 292f  ntr, len(fa_tr)/
+00080590: 3229 290a 0a20 2020 2070 7269 6e74 2827  2))..    print('
+000805a0: 5361 7669 6e67 2046 4153 5441 202e 2e27  Saving FASTA ..'
+000805b0: 2c20 656e 6420 3d20 2727 2c20 666c 7573  , end = '', flus
+000805c0: 6820 3d20 5472 7565 290a 2020 2020 6620  h = True).    f 
+000805d0: 3d20 6f70 656e 2866 615f 6669 6c65 5f74  = open(fa_file_t
+000805e0: 722c 2027 772b 2729 0a20 2020 2066 2e77  r, 'w+').    f.w
+000805f0: 7269 7465 6c69 6e65 7328 6661 5f74 7229  ritelines(fa_tr)
+00080600: 0a20 2020 2066 2e63 6c6f 7365 2829 0a0a  .    f.close()..
+00080610: 2020 2020 6966 2070 6570 7469 6465 3a0a      if peptide:.
+00080620: 2020 2020 2020 2020 7072 696e 7428 272e          print('.
+00080630: 272c 2065 6e64 3d27 2729 0a20 2020 2020  ', end='').     
+00080640: 2020 2066 203d 206f 7065 6e28 6661 5f66     f = open(fa_f
+00080650: 696c 655f 7072 2c20 2777 2b27 290a 2020  ile_pr, 'w+').  
+00080660: 2020 2020 2020 662e 7772 6974 656c 696e        f.writelin
+00080670: 6573 2866 615f 7072 290a 2020 2020 2020  es(fa_pr).      
+00080680: 2020 662e 636c 6f73 6528 290a 0a20 2020    f.close()..   
+00080690: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
+000806a0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+000806b0: 6172 745f 7469 6d65 0a20 2020 2070 7269  art_time.    pri
+000806c0: 6e74 2827 2064 6f6e 652e 2028 2569 2920  nt(' done. (%i) 
+000806d0: 2720 2520 2865 6c61 7073 6564 5f74 696d  ' % (elapsed_tim
+000806e0: 6529 290a 2020 2020 7072 696e 7428 2720  e)).    print(' 
+000806f0: 2020 2573 2720 2520 6661 5f66 696c 655f    %s' % fa_file_
+00080700: 7472 2029 0a20 2020 2069 6620 7065 7074  tr ).    if pept
+00080710: 6964 653a 2070 7269 6e74 2827 2020 2025  ide: print('   %
+00080720: 7327 2025 2066 615f 6669 6c65 5f70 7220  s' % fa_file_pr 
+00080730: 290a 2020 2020 0a20 2020 2072 6574 7572  ).    .    retur
+00080740: 6e20 6661 5f66 696c 655f 7472 2c20 6661  n fa_file_tr, fa
+00080750: 5f66 696c 655f 7072 0a20 2020 200a 0a64  _file_pr.    ..d
+00080760: 6566 206d 635f 636f 7265 5f72 6563 6f6e  ef mc_core_recon
+00080770: 7374 7275 6374 696f 6e28 6767 635f 7475  struction(ggc_tu
+00080780: 706c 6529 3a0a 2020 2020 0a20 2020 2067  ple):.    .    g
+00080790: 645f 7365 6c20 3d20 6767 635f 7475 706c  d_sel = ggc_tupl
+000807a0: 655b 305d 0a20 2020 2073 6571 5f6f 7267  e[0].    seq_org
+000807b0: 203d 2067 6763 5f74 7570 6c65 5b31 5d0a   = ggc_tuple[1].
+000807c0: 2020 2020 6368 726d 203d 2067 6763 5f74      chrm = ggc_t
+000807d0: 7570 6c65 5b32 5d0a 2020 2020 0a20 2020  uple[2].    .   
+000807e0: 2023 2067 645f 7365 6c20 3d20 736f 7274   # gd_sel = sort
+000807f0: 5f64 6573 6372 6970 746f 725f 6c73 7428  _descriptor_lst(
+00080800: 6764 5f73 656c 290a 2020 2020 6e5f 6764  gd_sel).    n_gd
+00080810: 203d 206c 656e 2867 645f 7365 6c29 0a0a   = len(gd_sel)..
+00080820: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+00080830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080840: 2323 2323 2323 230a 2020 2020 2323 2063  #######.    ## c
+00080850: 6f6c 6c65 6374 2072 676e 7320 616e 6420  ollect rgns and 
+00080860: 6d61 726b 2074 6865 6972 2070 6f73 0a20  mark their pos. 
+00080870: 2020 200a 2020 2020 7374 6172 745f 7469     .    start_ti
+00080880: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+00080890: 0a20 2020 206c 6f63 5f6f 7320 3d20 6e70  .    loc_os = np
+000808a0: 2e7a 6572 6f73 286e 5f67 642c 6474 7970  .zeros(n_gd,dtyp
+000808b0: 653d 6e70 2e66 6c6f 6174 3332 290a 2020  e=np.float32).  
+000808c0: 2020 6e75 6d5f 6f73 203d 206e 702e 7a65    num_os = np.ze
+000808d0: 726f 7328 6e5f 6764 2c64 7479 7065 3d6e  ros(n_gd,dtype=n
+000808e0: 702e 666c 6f61 7433 3229 0a20 2020 2072  p.float32).    r
+000808f0: 616c 6c20 3d20 7265 6769 6f6e 7328 290a  all = regions().
+00080900: 2020 2020 4765 6e65 5f69 645f 6e61 6d65      Gene_id_name
+00080910: 203d 205b 5d0a 2020 2020 6764 5f69 6478   = [].    gd_idx
+00080920: 5f6f 665f 7267 6e20 3d20 5b5d 0a20 2020  _of_rgn = [].   
+00080930: 206f 735f 6375 7220 3d20 300a 2020 2020   os_cur = 0.    
+00080940: 725f 706f 7320 3d20 5b5d 0a20 2020 2066  r_pos = [].    f
+00080950: 6f72 206b 2c20 6764 2069 6e20 656e 756d  or k, gd in enum
+00080960: 6572 6174 6528 6764 5f73 656c 293a 0a0a  erate(gd_sel):..
+00080970: 2020 2020 2020 2020 2323 2063 6865 636b          ## check
+00080980: 2069 6620 616e 7920 4420 6f72 2049 206c   if any D or I l
+00080990: 6965 7320 7769 7468 696e 2061 6e20 6578  ies within an ex
+000809a0: 6f6e 0a20 2020 2020 2020 2066 6f72 2065  on.        for e
+000809b0: 2069 6e20 6764 2e65 786f 6e73 2e72 676e   in gd.exons.rgn
+000809c0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+000809d0: 6620 652e 7479 7065 203d 3d20 2764 656c  f e.type == 'del
+000809e0: 6574 696f 6e27 3a0a 2020 2020 2020 2020  etion':.        
+000809f0: 2020 2020 2020 2020 6220 3d20 4661 6c73          b = Fals
+00080a00: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00080a10: 2020 666f 7220 6320 696e 2067 642e 6578    for c in gd.ex
+00080a20: 6f6e 732e 7267 6e73 3a0a 2020 2020 2020  ons.rgns:.      
+00080a30: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00080a40: 2028 632e 7479 7065 203d 3d20 2765 786f   (c.type == 'exo
+00080a50: 6e27 293a 0a20 2020 2020 2020 2020 2020  n'):.           
+00080a60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00080a70: 652e 6861 735f 6578 745f 696e 7465 7273  e.has_ext_inters
+00080a80: 6563 7469 6f6e 5f77 6974 6828 6329 3a0a  ection_with(c):.
+00080a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080aa0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+00080ab0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00080ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080ad0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00080ae0: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+00080af0: 2020 2020 2020 2020 2020 2069 6620 623a             if b:
+00080b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00080b10: 2020 2020 2070 7269 6e74 2827 5741 524e       print('WARN
+00080b20: 494e 473a 2044 2825 733a 2569 2d25 6929  ING: D(%s:%i-%i)
+00080b30: 206f 7665 726c 6170 7320 7769 7468 2045   overlaps with E
+00080b40: 2825 733a 2569 2d25 6929 2720 2520 5c0a  (%s:%i-%i)' % \.
+00080b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080b60: 2020 2020 2020 2020 2020 2865 2e63 6872            (e.chr
+00080b70: 2c20 652e 7374 6172 742c 2065 2e65 6e64  , e.start, e.end
+00080b80: 2c20 632e 6368 722c 2063 2e73 7461 7274  , c.chr, c.start
+00080b90: 2c20 632e 656e 6429 290a 2020 2020 2020  , c.end)).      
+00080ba0: 2020 2020 2020 2020 2020 2727 2720 2020            '''   
+00080bb0: 200a 2020 2020 2020 2020 2020 2020 656c   .            el
+00080bc0: 6966 2065 2e74 7970 6520 3d3d 2027 696e  if e.type == 'in
+00080bd0: 7365 7273 696f 6e27 3a0a 2020 2020 2020  sersion':.      
+00080be0: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
+00080bf0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00080c00: 2020 2020 666f 7220 6320 696e 2067 642e      for c in gd.
+00080c10: 6578 6f6e 732e 7267 6e73 3a0a 2020 2020  exons.rgns:.    
+00080c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080c30: 6966 2028 632e 7479 7065 203d 3d20 2765  if (c.type == 'e
+00080c40: 786f 6e27 293a 0a20 2020 2020 2020 2020  xon'):.         
+00080c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00080c60: 6620 2865 2e73 7461 7274 203e 2063 2e73  f (e.start > c.s
+00080c70: 7461 7274 2920 2620 2865 2e73 7461 7274  tart) & (e.start
+00080c80: 203c 2063 2e65 6e64 293a 0a20 2020 2020   < c.end):.     
+00080c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080ca0: 2020 2020 2020 2062 203d 2054 7275 650a         b = True.
+00080cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080cc0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00080cd0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00080ce0: 2020 2727 2720 2020 200a 2020 2020 2020    '''    .      
+00080cf0: 2020 2020 2020 2020 2020 6966 2062 3a0a            if b:.
+00080d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080d10: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
+00080d20: 4e47 3a20 4928 2573 3a25 692d 2569 2920  NG: I(%s:%i-%i) 
+00080d30: 6f76 6572 6c61 7073 2077 6974 6820 4528  overlaps with E(
+00080d40: 2573 3a25 692d 2569 2927 2025 205c 0a20  %s:%i-%i)' % \. 
+00080d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080d60: 2020 2020 2020 2020 2028 652e 6368 722c           (e.chr,
+00080d70: 2065 2e73 7461 7274 2c20 652e 656e 642c   e.start, e.end,
+00080d80: 2063 2e63 6872 2c20 632e 7374 6172 742c   c.chr, c.start,
+00080d90: 2063 2e65 6e64 2929 0a20 2020 2020 2020   c.end)).       
+00080da0: 2020 2020 2020 2020 2027 2727 2020 2020           '''    
+00080db0: 0a0a 2020 2020 2020 2020 6c6f 635f 6f73  ..        loc_os
+00080dc0: 5b6b 5d20 3d20 6f73 5f63 7572 0a20 2020  [k] = os_cur.   
+00080dd0: 2020 2020 206e 756d 5f6f 735b 6b5d 203d       num_os[k] =
+00080de0: 206c 656e 2867 642e 6578 6f6e 732e 7267   len(gd.exons.rg
+00080df0: 6e73 290a 2020 2020 2020 2020 7261 6c6c  ns).        rall
+00080e00: 2e72 676e 7320 3d20 7261 6c6c 2e72 676e  .rgns = rall.rgn
+00080e10: 7320 2b20 6764 2e65 786f 6e73 2e72 676e  s + gd.exons.rgn
+00080e20: 730a 2020 2020 2020 2020 675f 6964 5f6e  s.        g_id_n
+00080e30: 5f6e 616d 655f 6c73 7420 3d20 6764 2e67  _name_lst = gd.g
+00080e40: 6574 5f67 6964 5f6e 5f67 6e61 6d65 5f6c  et_gid_n_gname_l
+00080e50: 6973 7428 290a 2020 2020 2020 2020 4765  ist().        Ge
+00080e60: 6e65 5f69 645f 6e61 6d65 203d 2047 656e  ne_id_name = Gen
+00080e70: 655f 6964 5f6e 616d 6520 2b20 675f 6964  e_id_name + g_id
+00080e80: 5f6e 5f6e 616d 655f 6c73 740a 2020 2020  _n_name_lst.    
+00080e90: 2020 2020 6764 5f69 6478 5f6f 665f 7267      gd_idx_of_rg
+00080ea0: 6e20 3d20 6764 5f69 6478 5f6f 665f 7267  n = gd_idx_of_rg
+00080eb0: 6e20 2b20 5b6b 5d2a 6c65 6e28 6764 2e65  n + [k]*len(gd.e
+00080ec0: 786f 6e73 2e72 676e 7329 0a20 2020 2020  xons.rgns).     
+00080ed0: 2020 206f 735f 6375 7220 2b3d 206c 656e     os_cur += len
+00080ee0: 2867 642e 6578 6f6e 732e 7267 6e73 290a  (gd.exons.rgns).
+00080ef0: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
+00080f00: 6e20 6764 2e65 786f 6e73 2e72 676e 733a  n gd.exons.rgns:
+00080f10: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
+00080f20: 5f70 6f73 2e61 7070 656e 6428 722e 656e  _pos.append(r.en
+00080f30: 6429 0a20 2020 2020 2020 2020 2020 2072  d).            r
+00080f40: 5f70 6f73 2e61 7070 656e 6428 722e 7374  _pos.append(r.st
+00080f50: 6172 7429 0a0a 2020 2020 2323 2323 2323  art)..    ######
+00080f60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080f70: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00080f80: 2020 2323 2067 6574 206f 7264 6572 2061    ## get order a
+00080f90: 6363 6f72 6469 6e67 2074 6f20 6c6f 6361  ccording to loca
+00080fa0: 7469 6f6e 0a20 2020 2072 5f70 6f73 203d  tion.    r_pos =
+00080fb0: 206e 702e 6172 7261 7928 725f 706f 7329   np.array(r_pos)
+00080fc0: 0a20 2020 206f 6472 203d 2072 5f70 6f73  .    odr = r_pos
+00080fd0: 2e61 7267 736f 7274 2829 0a0a 2020 2020  .argsort()..    
+00080fe0: 666f 7220 6b2c 206f 2069 6e20 656e 756d  for k, o in enum
+00080ff0: 6572 6174 6528 6f64 7229 3a0a 2020 2020  erate(odr):.    
+00081000: 2020 2020 7220 3d20 7261 6c6c 2e72 676e      r = rall.rgn
+00081010: 735b 6f5d 0a20 2020 2020 2020 2069 6620  s[o].        if 
+00081020: 722e 7479 7065 203d 3d20 2769 6e73 6572  r.type == 'inser
+00081030: 7369 6f6e 273a 0a20 2020 2020 2020 2020  sion':.         
+00081040: 2020 2072 7020 3d20 7261 6c6c 2e72 676e     rp = rall.rgn
+00081050: 735b 6f64 725b 6b2d 315d 5d0a 2020 2020  s[odr[k-1]].    
+00081060: 2020 2020 2020 2020 6966 2028 722e 7374          if (r.st
+00081070: 6172 7420 3d3d 2072 702e 7374 6172 7429  art == rp.start)
+00081080: 2026 2028 7270 2e74 7970 6520 3d3d 2027   & (rp.type == '
+00081090: 6578 6f6e 2729 3a0a 2020 2020 2020 2020  exon'):.        
+000810a0: 2020 2020 2020 2020 6f70 203d 206f 6472          op = odr
+000810b0: 5b6b 2d31 5d0a 2020 2020 2020 2020 2020  [k-1].          
+000810c0: 2020 2020 2020 6f64 725b 6b2d 315d 203d        odr[k-1] =
+000810d0: 206f 6472 5b6b 5d0a 2020 2020 2020 2020   odr[k].        
+000810e0: 2020 2020 2020 2020 6f64 725b 6b5d 203d          odr[k] =
+000810f0: 206f 700a 2020 2020 2020 2020 2020 2020   op.            
+00081100: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00081110: 2020 2020 2020 726e 203d 2072 616c 6c2e        rn = rall.
+00081120: 7267 6e73 5b6f 6472 5b6b 2b31 5d5d 0a20  rgns[odr[k+1]]. 
+00081130: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00081140: 6620 2872 6e2e 7374 6172 7420 3d3d 2072  f (rn.start == r
+00081150: 2e73 7461 7274 2920 2620 2872 6e2e 7479  .start) & (rn.ty
+00081160: 7065 203d 3d20 2765 786f 6e27 293a 0a20  pe == 'exon'):. 
+00081170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081180: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00081190: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000811a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000811b0: 2020 7072 696e 7428 2745 5252 4f52 2025    print('ERROR %
+000811c0: 693a 204e 6f20 636f 6e6e 6563 7469 6f6e  i: No connection
+000811d0: 2066 6f75 6e64 2066 6f72 2049 2025 692c   found for I %i,
+000811e0: 2573 2d25 692c 2573 2d25 692c 2573 2720  %s-%i,%s-%i,%s' 
+000811f0: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
+00081200: 2020 2020 2020 2020 2020 2020 2020 286b                (k
+00081210: 2c20 7270 2e73 7461 7274 2c72 702e 7479  , rp.start,rp.ty
+00081220: 7065 2c20 722e 7374 6172 742c 722e 7479  pe, r.start,r.ty
+00081230: 7065 2c20 726e 2e73 7461 7274 2c20 726e  pe, rn.start, rn
+00081240: 2e74 7970 6529 2029 0a0a 2020 2020 656c  .type) )..    el
+00081250: 6170 7365 645f 7469 6d65 203d 2074 696d  apsed_time = tim
+00081260: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
+00081270: 5f74 696d 650a 2020 2020 2320 7072 696e  _time.    # prin
+00081280: 7428 2720 2020 312e 2064 6f6e 6520 2825  t('   1. done (%
+00081290: 6929 2020 2720 2520 2865 6c61 7073 6564  i)  ' % (elapsed
+000812a0: 5f74 696d 6529 2c20 666c 7573 6820 3d20  _time), flush = 
+000812b0: 5472 7565 290a 2020 2020 2327 2727 0a0a  True).    #'''..
+000812c0: 2020 2020 2327 2727 0a20 2020 2023 2323      #'''.    ###
 000812d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000812e0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
-000812f0: 6765 7420 206f 6666 7365 745f 6669 6e64  get  offset_find
-00081300: 6572 2061 6e64 206e 6577 2067 656e 6f6d  er and new genom
-00081310: 6520 7365 710a 2020 2020 0a20 2020 2073  e seq.    .    s
-00081320: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
-00081330: 2e74 696d 6528 290a 2020 2020 6f66 203d  .time().    of =
-00081340: 206f 6666 7365 745f 6669 6e64 6572 2829   offset_finder()
-00081350: 0a20 2020 206f 735f 6375 7220 3d20 300a  .    os_cur = 0.
-00081360: 2020 2020 7072 6576 5f70 6f73 203d 2031      prev_pos = 1
-00081370: 2023 206f 6e65 2d62 6173 650a 2020 2020   # one-base.    
-00081380: 6c61 7374 5f70 6f73 203d 2031 2023 206f  last_pos = 1 # o
-00081390: 6e65 2d62 6173 650a 0a20 2020 2073 6571  ne-base..    seq
-000813a0: 5f6c 7374 203d 205b 5d0a 0a20 2020 2066  _lst = []..    f
-000813b0: 6f72 206d 2c20 6b20 696e 2065 6e75 6d65  or m, k in enume
-000813c0: 7261 7465 286f 6472 293a 0a20 2020 2020  rate(odr):.     
-000813d0: 2020 2072 203d 2072 616c 6c2e 7267 6e73     r = rall.rgns
-000813e0: 5b6b 5d0a 0a20 2020 2020 2020 2069 6620  [k]..        if 
-000813f0: 722e 7479 7065 203d 3d20 2765 786f 6e27  r.type == 'exon'
-00081400: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00081410: 2028 722e 7374 6172 7429 203c 2028 7072   (r.start) < (pr
-00081420: 6576 5f70 6f73 293a 0a20 2020 2020 2020  ev_pos):.       
-00081430: 2020 2020 2020 2020 2069 6620 722e 656e           if r.en
-00081440: 6420 3c20 7072 6576 5f70 6f73 3a0a 2020  d < prev_pos:.  
-00081450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081460: 2020 2320 7072 696e 7428 2725 6920 5741    # print('%i WA
-00081470: 524e 494e 4720 2845 4129 3a20 2573 2c20  RNING (EA): %s, 
-00081480: 2569 2d25 6920 3c3d 2025 692c 2025 692f  %i-%i <= %i, %i/
-00081490: 2569 2720 2520 286d 2c20 722e 6368 722c  %i' % (m, r.chr,
-000814a0: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
-000814b0: 2070 7265 765f 706f 732c 206d 2c20 6c65   prev_pos, m, le
-000814c0: 6e28 6f64 7229 2920 290a 2020 2020 2020  n(odr)) ).      
-000814d0: 2020 2020 2020 2020 2020 2020 2020 735f                s_
-000814e0: 6f72 6720 3d20 7365 715f 6f72 675b 2872  org = seq_org[(r
-000814f0: 2e73 7461 7274 2d31 293a 2872 2e65 6e64  .start-1):(r.end
-00081500: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-00081510: 2020 2020 2020 2072 2e63 6f6d 7061 7265         r.compare
-00081520: 5f61 6e64 5f72 6570 6c61 6365 5f4e 2873  _and_replace_N(s
-00081530: 5f6f 7267 290a 2020 2020 2020 2020 2020  _org).          
-00081540: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00081550: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00081560: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00081570: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
-00081580: 2827 2569 2057 4152 4e49 4e47 2028 4542  ('%i WARNING (EB
-00081590: 293a 2025 732c 2025 692d 2569 203c 3d20  ): %s, %i-%i <= 
-000815a0: 2569 2720 2520 286d 2c20 722e 6368 722c  %i' % (m, r.chr,
-000815b0: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
-000815c0: 2070 7265 765f 706f 7329 2029 0a20 2020   prev_pos) ).   
-000815d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000815e0: 2073 5f6f 7267 203d 2073 6571 5f6f 7267   s_org = seq_org
-000815f0: 5b28 722e 7374 6172 742d 3129 3a28 722e  [(r.start-1):(r.
-00081600: 656e 6429 5d0a 2020 2020 2020 2020 2020  end)].          
-00081610: 2020 2020 2020 2020 2020 722e 636f 6d70            r.comp
-00081620: 6172 655f 616e 645f 7265 706c 6163 655f  are_and_replace_
-00081630: 4e28 735f 6f72 6729 0a20 2020 2020 2020  N(s_org).       
-00081640: 2020 2020 2020 2020 2020 2020 2073 7020               sp 
-00081650: 3d20 2870 7265 765f 706f 732d 722e 7374  = (prev_pos-r.st
-00081660: 6172 7429 0a20 2020 2020 2020 2020 2020  art).           
-00081670: 2020 2020 2020 2020 2073 6571 5f6c 7374           seq_lst
-00081680: 2e61 7070 656e 6428 722e 7365 715b 7370  .append(r.seq[sp
-00081690: 3a5d 290a 0a20 2020 2020 2020 2020 2020  :])..           
-000816a0: 2020 2020 2020 2020 206f 662e 6164 6428           of.add(
-000816b0: 206f 735f 6375 722c 2070 7265 765f 706f   os_cur, prev_po
-000816c0: 732c 2072 2e65 6e64 2b31 2029 0a20 2020  s, r.end+1 ).   
-000816d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000816e0: 2070 7265 765f 706f 7320 3d20 722e 656e   prev_pos = r.en
-000816f0: 642b 310a 0a20 2020 2020 2020 2020 2020  d+1..           
-00081700: 2065 6c73 653a 2020 2020 2020 2020 2020   else:          
-00081710: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00081720: 2020 2020 2020 735f 6f72 6720 3d20 7365        s_org = se
-00081730: 715f 6f72 675b 2872 2e73 7461 7274 2d31  q_org[(r.start-1
-00081740: 293a 2872 2e65 6e64 295d 0a20 2020 2020  ):(r.end)].     
-00081750: 2020 2020 2020 2020 2020 2023 6966 206c             #if l
-00081760: 656e 2873 5f6f 7267 2920 3d3d 206c 656e  en(s_org) == len
-00081770: 2872 2e73 6571 293a 0a20 2020 2020 2020  (r.seq):.       
-00081780: 2020 2020 2020 2020 2072 2e63 6f6d 7061           r.compa
-00081790: 7265 5f61 6e64 5f72 6570 6c61 6365 5f4e  re_and_replace_N
-000817a0: 2873 5f6f 7267 290a 2020 2020 2020 2020  (s_org).        
-000817b0: 2020 2020 2020 2020 2320 656c 7365 3a20          # else: 
-000817c0: 2070 7269 6e74 2820 2757 4152 4e49 4e47   print( 'WARNING
-000817d0: 3a20 2569 2d25 6920 696e 2025 6920 7e3d  : %i-%i in %i ~=
-000817e0: 2025 6927 2025 2028 722e 7374 6172 742c   %i' % (r.start,
-000817f0: 2072 2e65 6e64 2c20 6c65 6e28 735f 6f72   r.end, len(s_or
-00081800: 6729 2c20 6c65 6e28 722e 7365 7129 2920  g), len(r.seq)) 
-00081810: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00081820: 2020 2069 6620 722e 7374 6172 7420 3e20     if r.start > 
-00081830: 7072 6576 5f70 6f73 3a0a 2020 2020 2020  prev_pos:.      
-00081840: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00081850: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
-00081860: 5f6f 7267 5b28 7072 6576 5f70 6f73 2d31  _org[(prev_pos-1
-00081870: 293a 2872 2e73 7461 7274 2d31 295d 290a  ):(r.start-1)]).
-00081880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081890: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-000818a0: 2020 2020 2073 6571 5f6c 7374 2e61 7070       seq_lst.app
-000818b0: 656e 6428 722e 7365 7129 0a20 2020 2020  end(r.seq).     
-000818c0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-000818d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000818e0: 6f66 2e61 6464 2820 6f73 5f63 7572 2c20  of.add( os_cur, 
-000818f0: 7072 6576 5f70 6f73 2c20 722e 656e 642b  prev_pos, r.end+
-00081900: 3120 290a 2020 2020 2020 2020 2020 2020  1 ).            
-00081910: 2020 2020 7072 6576 5f70 6f73 203d 2072      prev_pos = r
-00081920: 2e65 6e64 2b31 0a20 2020 2020 2020 2020  .end+1.         
-00081930: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00081940: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00081950: 656e 2872 2e73 6571 2920 213d 206c 656e  en(r.seq) != len
-00081960: 2873 5f6f 7267 293a 0a20 2020 2020 2020  (s_org):.       
-00081970: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-00081980: 7269 6e74 2820 2757 4152 4e49 4e47 3a20  rint( 'WARNING: 
-00081990: 2573 3a20 2569 2d25 6920 696e 2025 6920  %s: %i-%i in %i 
-000819a0: 7e3d 2025 6927 2025 2028 722e 6368 722c  ~= %i' % (r.chr,
-000819b0: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
-000819c0: 206c 656e 2873 5f6f 7267 292c 206c 656e   len(s_org), len
-000819d0: 2872 2e73 6571 2929 2029 0a20 2020 2020  (r.seq)) ).     
-000819e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000819f0: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
-00081a00: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
-00081a10: 2020 2020 2020 2020 2020 2023 2072 2e73             # r.s
-00081a20: 6571 203d 2072 6567 696f 6e28 722e 6368  eq = region(r.ch
-00081a30: 722c 2072 2e73 7461 7274 2c20 722e 656e  r, r.start, r.en
-00081a40: 642c 2072 2e74 7970 652c 2073 5f6f 7267  d, r.type, s_org
-00081a50: 2c20 6376 675f 6465 7020 3d20 4356 475f  , cvg_dep = CVG_
-00081a60: 4445 5054 485f 544d 5020 290a 2020 2020  DEPTH_TMP ).    
-00081a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081a80: 2320 722e 6765 745f 6376 6728 290a 2020  # r.get_cvg().  
-00081a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081aa0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-00081ab0: 2020 2020 2020 2020 2020 200a 0a20 2020             ..   
-00081ac0: 2020 2020 2065 6c69 6620 2872 2e74 7970       elif (r.typ
-00081ad0: 6520 3d3d 2027 696e 7365 7273 696f 6e27  e == 'insersion'
-00081ae0: 2920 7c20 2872 2e74 7970 6520 3d3d 2027  ) | (r.type == '
-00081af0: 4927 2029 3a0a 2020 2020 2020 2020 2020  I' ):.          
-00081b00: 2020 6966 2028 722e 7374 6172 7429 203c    if (r.start) <
-00081b10: 2028 7072 6576 5f70 6f73 293a 0a20 2020   (prev_pos):.   
-00081b20: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-00081b30: 7269 6e74 2827 5741 524e 494e 4720 2849  rint('WARNING (I
-00081b40: 293a 2025 6920 2d20 2573 2c20 2569 203c  ): %i - %s, %i <
-00081b50: 2025 6927 2025 2028 6d2c 2072 2e63 6872   %i' % (m, r.chr
-00081b60: 2c20 722e 7374 6172 742c 2070 7265 765f  , r.start, prev_
-00081b70: 706f 7329 2029 0a20 2020 2020 2020 2020  pos) ).         
-00081b80: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00081b90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00081ba0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-00081bb0: 2e61 6464 2820 6f73 5f63 7572 2c20 7072  .add( os_cur, pr
-00081bc0: 6576 5f70 6f73 2c20 722e 7374 6172 7420  ev_pos, r.start 
-00081bd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081be0: 2020 6f73 5f63 7572 202b 3d20 2872 2e65    os_cur += (r.e
-00081bf0: 6e64 202d 2072 2e73 7461 7274 202b 2031  nd - r.start + 1
-00081c00: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00081c10: 2020 2069 6620 722e 7374 6172 7420 3e20     if r.start > 
-00081c20: 7072 6576 5f70 6f73 3a0a 2020 2020 2020  prev_pos:.      
-00081c30: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00081c40: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
-00081c50: 5f6f 7267 5b28 7072 6576 5f70 6f73 2d31  _org[(prev_pos-1
-00081c60: 293a 2872 2e73 7461 7274 2d31 295d 290a  ):(r.start-1)]).
-00081c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081c80: 7365 715f 6c73 742e 6170 7065 6e64 2872  seq_lst.append(r
-00081c90: 2e73 6571 290a 0a20 2020 2020 2020 2020  .seq)..         
-00081ca0: 2020 2020 2020 2070 7265 765f 706f 7320         prev_pos 
-00081cb0: 3d20 722e 7374 6172 740a 0a20 2020 2020  = r.start..     
-00081cc0: 2020 2065 6c69 6620 2872 2e74 7970 6520     elif (r.type 
-00081cd0: 3d3d 2027 6465 6c65 7469 6f6e 2729 207c  == 'deletion') |
-00081ce0: 2028 722e 7479 7065 203d 3d20 2744 2720   (r.type == 'D' 
-00081cf0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00081d00: 6620 2872 2e73 7461 7274 2920 3c20 2870  f (r.start) < (p
-00081d10: 7265 765f 706f 7329 3a0a 2020 2020 2020  rev_pos):.      
-00081d20: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-00081d30: 7428 2757 4152 4e49 4e47 2028 4429 3a20  t('WARNING (D): 
-00081d40: 2569 202d 2025 732c 2025 6920 3c3d 2025  %i - %s, %i <= %
-00081d50: 6927 2025 2028 6d2c 2072 2e63 6872 2c20  i' % (m, r.chr, 
-00081d60: 722e 7374 6172 742c 2070 7265 765f 706f  r.start, prev_po
-00081d70: 7329 2029 0a20 2020 2020 2020 2020 2020  s) ).           
-00081d80: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00081d90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00081da0: 2020 2020 2020 2020 2020 2020 6f66 2e61              of.a
-00081db0: 6464 2820 6f73 5f63 7572 2c20 7072 6576  dd( os_cur, prev
-00081dc0: 5f70 6f73 2c20 722e 7374 6172 7420 290a  _pos, r.start ).
-00081dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081de0: 6f73 5f63 7572 202d 3d20 2872 2e65 6e64  os_cur -= (r.end
-00081df0: 202d 2072 2e73 7461 7274 202b 2031 290a   - r.start + 1).
-00081e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081e10: 7072 6576 5f70 6f73 203d 2072 2e73 7461  prev_pos = r.sta
-00081e20: 7274 0a0a 2020 2020 2020 2020 2020 2020  rt..            
-00081e30: 2020 2020 6f66 2e61 6464 2820 6f73 5f63      of.add( os_c
-00081e40: 7572 2c20 7072 6576 5f70 6f73 2c20 722e  ur, prev_pos, r.
-00081e50: 656e 642b 3120 290a 2020 2020 2020 2020  end+1 ).        
-00081e60: 2020 2020 2020 2020 7072 6576 5f70 6f73          prev_pos
-00081e70: 203d 2072 2e65 6e64 2b31 0a0a 2020 2020   = r.end+1..    
-00081e80: 2020 2020 6c61 7374 5f70 6f73 203d 2072      last_pos = r
-00081e90: 2e65 6e64 0a0a 2020 2020 7365 715f 6c73  .end..    seq_ls
-00081ea0: 742e 6170 7065 6e64 2873 6571 5f6f 7267  t.append(seq_org
-00081eb0: 5b28 7072 6576 5f70 6f73 2d31 293a 5d29  [(prev_pos-1):])
-00081ec0: 0a20 2020 2073 6571 5f6e 6577 203d 2027  .    seq_new = '
-00081ed0: 272e 6a6f 696e 2873 6571 5f6c 7374 290a  '.join(seq_lst).
-00081ee0: 0a20 2020 2023 2069 6620 6c61 7374 5f70  .    # if last_p
-00081ef0: 6f73 203e 2070 7265 765f 706f 733a 0a20  os > prev_pos:. 
-00081f00: 2020 206f 662e 6164 6428 206f 735f 6375     of.add( os_cu
-00081f10: 722c 2070 7265 765f 706f 732c 206c 656e  r, prev_pos, len
-00081f20: 2873 6571 5f6f 7267 2920 2b20 3130 3030  (seq_org) + 1000
-00081f30: 3030 2029 0a0a 2020 2020 656c 6170 7365  00 )..    elapse
-00081f40: 645f 7469 6d65 203d 2074 696d 652e 7469  d_time = time.ti
-00081f50: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
-00081f60: 650a 2020 2020 2320 7072 696e 7428 2720  e.    # print(' 
-00081f70: 2020 322e 2064 6f6e 6520 2825 6929 2020    2. done (%i)  
-00081f80: 2720 2520 2865 6c61 7073 6564 5f74 696d  ' % (elapsed_tim
-00081f90: 6529 2c20 666c 7573 6820 3d20 5472 7565  e), flush = True
-00081fa0: 290a 2020 2020 2327 2727 0a0a 2020 2020  ).    #'''..    
-00081fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000812e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000812f0: 2323 2323 2323 0a20 2020 2023 2320 6765  ######.    ## ge
+00081300: 7420 206f 6666 7365 745f 6669 6e64 6572  t  offset_finder
+00081310: 2061 6e64 206e 6577 2067 656e 6f6d 6520   and new genome 
+00081320: 7365 710a 2020 2020 0a20 2020 2073 7461  seq.    .    sta
+00081330: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
+00081340: 696d 6528 290a 2020 2020 6f66 203d 206f  ime().    of = o
+00081350: 6666 7365 745f 6669 6e64 6572 2829 0a20  ffset_finder(). 
+00081360: 2020 206f 735f 6375 7220 3d20 300a 2020     os_cur = 0.  
+00081370: 2020 7072 6576 5f70 6f73 203d 2031 2023    prev_pos = 1 #
+00081380: 206f 6e65 2d62 6173 650a 2020 2020 6c61   one-base.    la
+00081390: 7374 5f70 6f73 203d 2031 2023 206f 6e65  st_pos = 1 # one
+000813a0: 2d62 6173 650a 0a20 2020 2073 6571 5f6c  -base..    seq_l
+000813b0: 7374 203d 205b 5d0a 0a20 2020 2066 6f72  st = []..    for
+000813c0: 206d 2c20 6b20 696e 2065 6e75 6d65 7261   m, k in enumera
+000813d0: 7465 286f 6472 293a 0a20 2020 2020 2020  te(odr):.       
+000813e0: 2072 203d 2072 616c 6c2e 7267 6e73 5b6b   r = rall.rgns[k
+000813f0: 5d0a 0a20 2020 2020 2020 2069 6620 722e  ]..        if r.
+00081400: 7479 7065 203d 3d20 2765 786f 6e27 3a0a  type == 'exon':.
+00081410: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00081420: 722e 7374 6172 7429 203c 2028 7072 6576  r.start) < (prev
+00081430: 5f70 6f73 293a 0a20 2020 2020 2020 2020  _pos):.         
+00081440: 2020 2020 2020 2069 6620 722e 656e 6420         if r.end 
+00081450: 3c20 7072 6576 5f70 6f73 3a0a 2020 2020  < prev_pos:.    
+00081460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081470: 2320 7072 696e 7428 2725 6920 5741 524e  # print('%i WARN
+00081480: 494e 4720 2845 4129 3a20 2573 2c20 2569  ING (EA): %s, %i
+00081490: 2d25 6920 3c3d 2025 692c 2025 692f 2569  -%i <= %i, %i/%i
+000814a0: 2720 2520 286d 2c20 722e 6368 722c 2072  ' % (m, r.chr, r
+000814b0: 2e73 7461 7274 2c20 722e 656e 642c 2070  .start, r.end, p
+000814c0: 7265 765f 706f 732c 206d 2c20 6c65 6e28  rev_pos, m, len(
+000814d0: 6f64 7229 2920 290a 2020 2020 2020 2020  odr)) ).        
+000814e0: 2020 2020 2020 2020 2020 2020 735f 6f72              s_or
+000814f0: 6720 3d20 7365 715f 6f72 675b 2872 2e73  g = seq_org[(r.s
+00081500: 7461 7274 2d31 293a 2872 2e65 6e64 295d  tart-1):(r.end)]
+00081510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081520: 2020 2020 2072 2e63 6f6d 7061 7265 5f61       r.compare_a
+00081530: 6e64 5f72 6570 6c61 6365 5f4e 2873 5f6f  nd_replace_N(s_o
+00081540: 7267 290a 2020 2020 2020 2020 2020 2020  rg).            
+00081550: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00081560: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00081570: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00081580: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+00081590: 2569 2057 4152 4e49 4e47 2028 4542 293a  %i WARNING (EB):
+000815a0: 2025 732c 2025 692d 2569 203c 3d20 2569   %s, %i-%i <= %i
+000815b0: 2720 2520 286d 2c20 722e 6368 722c 2072  ' % (m, r.chr, r
+000815c0: 2e73 7461 7274 2c20 722e 656e 642c 2070  .start, r.end, p
+000815d0: 7265 765f 706f 7329 2029 0a20 2020 2020  rev_pos) ).     
+000815e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000815f0: 5f6f 7267 203d 2073 6571 5f6f 7267 5b28  _org = seq_org[(
+00081600: 722e 7374 6172 742d 3129 3a28 722e 656e  r.start-1):(r.en
+00081610: 6429 5d0a 2020 2020 2020 2020 2020 2020  d)].            
+00081620: 2020 2020 2020 2020 722e 636f 6d70 6172          r.compar
+00081630: 655f 616e 645f 7265 706c 6163 655f 4e28  e_and_replace_N(
+00081640: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
+00081650: 2020 2020 2020 2020 2020 2073 7020 3d20             sp = 
+00081660: 2870 7265 765f 706f 732d 722e 7374 6172  (prev_pos-r.star
+00081670: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00081680: 2020 2020 2020 2073 6571 5f6c 7374 2e61         seq_lst.a
+00081690: 7070 656e 6428 722e 7365 715b 7370 3a5d  ppend(r.seq[sp:]
+000816a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000816b0: 2020 2020 2020 206f 662e 6164 6428 206f         of.add( o
+000816c0: 735f 6375 722c 2070 7265 765f 706f 732c  s_cur, prev_pos,
+000816d0: 2072 2e65 6e64 2b31 2029 0a20 2020 2020   r.end+1 ).     
+000816e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000816f0: 7265 765f 706f 7320 3d20 722e 656e 642b  rev_pos = r.end+
+00081700: 310a 0a20 2020 2020 2020 2020 2020 2065  1..            e
+00081710: 6c73 653a 2020 2020 2020 2020 2020 2020  lse:            
+00081720: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00081730: 2020 2020 735f 6f72 6720 3d20 7365 715f      s_org = seq_
+00081740: 6f72 675b 2872 2e73 7461 7274 2d31 293a  org[(r.start-1):
+00081750: 2872 2e65 6e64 295d 0a20 2020 2020 2020  (r.end)].       
+00081760: 2020 2020 2020 2020 2023 6966 206c 656e           #if len
+00081770: 2873 5f6f 7267 2920 3d3d 206c 656e 2872  (s_org) == len(r
+00081780: 2e73 6571 293a 0a20 2020 2020 2020 2020  .seq):.         
+00081790: 2020 2020 2020 2072 2e63 6f6d 7061 7265         r.compare
+000817a0: 5f61 6e64 5f72 6570 6c61 6365 5f4e 2873  _and_replace_N(s
+000817b0: 5f6f 7267 290a 2020 2020 2020 2020 2020  _org).          
+000817c0: 2020 2020 2020 2320 656c 7365 3a20 2070        # else:  p
+000817d0: 7269 6e74 2820 2757 4152 4e49 4e47 3a20  rint( 'WARNING: 
+000817e0: 2569 2d25 6920 696e 2025 6920 7e3d 2025  %i-%i in %i ~= %
+000817f0: 6927 2025 2028 722e 7374 6172 742c 2072  i' % (r.start, r
+00081800: 2e65 6e64 2c20 6c65 6e28 735f 6f72 6729  .end, len(s_org)
+00081810: 2c20 6c65 6e28 722e 7365 7129 2920 290a  , len(r.seq)) ).
+00081820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081830: 2069 6620 722e 7374 6172 7420 3e20 7072   if r.start > pr
+00081840: 6576 5f70 6f73 3a0a 2020 2020 2020 2020  ev_pos:.        
+00081850: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
+00081860: 6c73 742e 6170 7065 6e64 2873 6571 5f6f  lst.append(seq_o
+00081870: 7267 5b28 7072 6576 5f70 6f73 2d31 293a  rg[(prev_pos-1):
+00081880: 2872 2e73 7461 7274 2d31 295d 290a 2020  (r.start-1)]).  
+00081890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000818a0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+000818b0: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
+000818c0: 6428 722e 7365 7129 0a20 2020 2020 2020  d(r.seq).       
+000818d0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+000818e0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+000818f0: 2e61 6464 2820 6f73 5f63 7572 2c20 7072  .add( os_cur, pr
+00081900: 6576 5f70 6f73 2c20 722e 656e 642b 3120  ev_pos, r.end+1 
+00081910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00081920: 2020 7072 6576 5f70 6f73 203d 2072 2e65    prev_pos = r.e
+00081930: 6e64 2b31 0a20 2020 2020 2020 2020 2020  nd+1.           
+00081940: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00081950: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00081960: 2872 2e73 6571 2920 213d 206c 656e 2873  (r.seq) != len(s
+00081970: 5f6f 7267 293a 0a20 2020 2020 2020 2020  _org):.         
+00081980: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
+00081990: 6e74 2820 2757 4152 4e49 4e47 3a20 2573  nt( 'WARNING: %s
+000819a0: 3a20 2569 2d25 6920 696e 2025 6920 7e3d  : %i-%i in %i ~=
+000819b0: 2025 6927 2025 2028 722e 6368 722c 2072   %i' % (r.chr, r
+000819c0: 2e73 7461 7274 2c20 722e 656e 642c 206c  .start, r.end, l
+000819d0: 656e 2873 5f6f 7267 292c 206c 656e 2872  en(s_org), len(r
+000819e0: 2e73 6571 2929 2029 0a20 2020 2020 2020  .seq)) ).       
+000819f0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+00081a00: 6571 5f6c 7374 2e61 7070 656e 6428 735f  eq_lst.append(s_
+00081a10: 6f72 6729 0a20 2020 2020 2020 2020 2020  org).           
+00081a20: 2020 2020 2020 2020 2023 2072 2e73 6571           # r.seq
+00081a30: 203d 2072 6567 696f 6e28 722e 6368 722c   = region(r.chr,
+00081a40: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
+00081a50: 2072 2e74 7970 652c 2073 5f6f 7267 2c20   r.type, s_org, 
+00081a60: 6376 675f 6465 7020 3d20 4356 475f 4445  cvg_dep = CVG_DE
+00081a70: 5054 485f 544d 5020 290a 2020 2020 2020  PTH_TMP ).      
+00081a80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00081a90: 722e 6765 745f 6376 6728 290a 2020 2020  r.get_cvg().    
+00081aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081ab0: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
+00081ac0: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
+00081ad0: 2020 2065 6c69 6620 2872 2e74 7970 6520     elif (r.type 
+00081ae0: 3d3d 2027 696e 7365 7273 696f 6e27 2920  == 'insersion') 
+00081af0: 7c20 2872 2e74 7970 6520 3d3d 2027 4927  | (r.type == 'I'
+00081b00: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00081b10: 6966 2028 722e 7374 6172 7429 203c 2028  if (r.start) < (
+00081b20: 7072 6576 5f70 6f73 293a 0a20 2020 2020  prev_pos):.     
+00081b30: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
+00081b40: 6e74 2827 5741 524e 494e 4720 2849 293a  nt('WARNING (I):
+00081b50: 2025 6920 2d20 2573 2c20 2569 203c 2025   %i - %s, %i < %
+00081b60: 6927 2025 2028 6d2c 2072 2e63 6872 2c20  i' % (m, r.chr, 
+00081b70: 722e 7374 6172 742c 2070 7265 765f 706f  r.start, prev_po
+00081b80: 7329 2029 0a20 2020 2020 2020 2020 2020  s) ).           
+00081b90: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00081ba0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00081bb0: 2020 2020 2020 2020 2020 2020 6f66 2e61              of.a
+00081bc0: 6464 2820 6f73 5f63 7572 2c20 7072 6576  dd( os_cur, prev
+00081bd0: 5f70 6f73 2c20 722e 7374 6172 7420 290a  _pos, r.start ).
+00081be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081bf0: 6f73 5f63 7572 202b 3d20 2872 2e65 6e64  os_cur += (r.end
+00081c00: 202d 2072 2e73 7461 7274 202b 2031 290a   - r.start + 1).
+00081c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081c20: 2069 6620 722e 7374 6172 7420 3e20 7072   if r.start > pr
+00081c30: 6576 5f70 6f73 3a0a 2020 2020 2020 2020  ev_pos:.        
+00081c40: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
+00081c50: 6c73 742e 6170 7065 6e64 2873 6571 5f6f  lst.append(seq_o
+00081c60: 7267 5b28 7072 6576 5f70 6f73 2d31 293a  rg[(prev_pos-1):
+00081c70: 2872 2e73 7461 7274 2d31 295d 290a 2020  (r.start-1)]).  
+00081c80: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00081c90: 715f 6c73 742e 6170 7065 6e64 2872 2e73  q_lst.append(r.s
+00081ca0: 6571 290a 0a20 2020 2020 2020 2020 2020  eq)..           
+00081cb0: 2020 2020 2070 7265 765f 706f 7320 3d20       prev_pos = 
+00081cc0: 722e 7374 6172 740a 0a20 2020 2020 2020  r.start..       
+00081cd0: 2065 6c69 6620 2872 2e74 7970 6520 3d3d   elif (r.type ==
+00081ce0: 2027 6465 6c65 7469 6f6e 2729 207c 2028   'deletion') | (
+00081cf0: 722e 7479 7065 203d 3d20 2744 2720 293a  r.type == 'D' ):
+00081d00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00081d10: 2872 2e73 7461 7274 2920 3c20 2870 7265  (r.start) < (pre
+00081d20: 765f 706f 7329 3a0a 2020 2020 2020 2020  v_pos):.        
+00081d30: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00081d40: 2757 4152 4e49 4e47 2028 4429 3a20 2569  'WARNING (D): %i
+00081d50: 202d 2025 732c 2025 6920 3c3d 2025 6927   - %s, %i <= %i'
+00081d60: 2025 2028 6d2c 2072 2e63 6872 2c20 722e   % (m, r.chr, r.
+00081d70: 7374 6172 742c 2070 7265 765f 706f 7329  start, prev_pos)
+00081d80: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00081d90: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00081da0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00081db0: 2020 2020 2020 2020 2020 6f66 2e61 6464            of.add
+00081dc0: 2820 6f73 5f63 7572 2c20 7072 6576 5f70  ( os_cur, prev_p
+00081dd0: 6f73 2c20 722e 7374 6172 7420 290a 2020  os, r.start ).  
+00081de0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+00081df0: 5f63 7572 202d 3d20 2872 2e65 6e64 202d  _cur -= (r.end -
+00081e00: 2072 2e73 7461 7274 202b 2031 290a 2020   r.start + 1).  
+00081e10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00081e20: 6576 5f70 6f73 203d 2072 2e73 7461 7274  ev_pos = r.start
+00081e30: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00081e40: 2020 6f66 2e61 6464 2820 6f73 5f63 7572    of.add( os_cur
+00081e50: 2c20 7072 6576 5f70 6f73 2c20 722e 656e  , prev_pos, r.en
+00081e60: 642b 3120 290a 2020 2020 2020 2020 2020  d+1 ).          
+00081e70: 2020 2020 2020 7072 6576 5f70 6f73 203d        prev_pos =
+00081e80: 2072 2e65 6e64 2b31 0a0a 2020 2020 2020   r.end+1..      
+00081e90: 2020 6c61 7374 5f70 6f73 203d 2072 2e65    last_pos = r.e
+00081ea0: 6e64 0a0a 2020 2020 7365 715f 6c73 742e  nd..    seq_lst.
+00081eb0: 6170 7065 6e64 2873 6571 5f6f 7267 5b28  append(seq_org[(
+00081ec0: 7072 6576 5f70 6f73 2d31 293a 5d29 0a20  prev_pos-1):]). 
+00081ed0: 2020 2073 6571 5f6e 6577 203d 2027 272e     seq_new = ''.
+00081ee0: 6a6f 696e 2873 6571 5f6c 7374 290a 0a20  join(seq_lst).. 
+00081ef0: 2020 2023 2069 6620 6c61 7374 5f70 6f73     # if last_pos
+00081f00: 203e 2070 7265 765f 706f 733a 0a20 2020   > prev_pos:.   
+00081f10: 206f 662e 6164 6428 206f 735f 6375 722c   of.add( os_cur,
+00081f20: 2070 7265 765f 706f 732c 206c 656e 2873   prev_pos, len(s
+00081f30: 6571 5f6f 7267 2920 2b20 3130 3030 3030  eq_org) + 100000
+00081f40: 2029 0a0a 2020 2020 656c 6170 7365 645f   )..    elapsed_
+00081f50: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+00081f60: 2829 202d 2073 7461 7274 5f74 696d 650a  () - start_time.
+00081f70: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
+00081f80: 322e 2064 6f6e 6520 2825 6929 2020 2720  2. done (%i)  ' 
+00081f90: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
+00081fa0: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+00081fb0: 2020 2020 2327 2727 0a0a 2020 2020 2323      #'''..    ##
 00081fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00081fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081fe0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
-00081ff0: 5573 6520 6f66 6673 6574 5f66 696e 6465  Use offset_finde
-00082000: 7220 746f 2063 6f72 7265 6374 2070 6f73  r to correct pos
-00082010: 6974 696f 6e73 2069 6e20 4754 4620 656e  itions in GTF en
-00082020: 7472 6965 730a 2020 2020 2323 2061 6c73  tries.    ## als
-00082030: 6f20 6765 7420 7267 6e73 2066 7261 676d  o get rgns fragm
-00082040: 656e 7473 2077 6865 6e20 7370 6c69 7420  ents when split 
-00082050: 6973 2072 6571 7569 7265 640a 0a20 2020  is required..   
-00082060: 206f 662e 6d61 6b65 5f69 745f 636f 6d70   of.make_it_comp
-00082070: 6163 7428 290a 2020 2020 0a20 2020 2073  act().    .    s
-00082080: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
-00082090: 2e74 696d 6528 290a 2020 2020 725f 746f  .time().    r_to
-000820a0: 5f61 6464 203d 205b 5d0a 2020 2020 706f  _add = [].    po
-000820b0: 735f 746f 5f61 6464 203d 205b 5d0a 2020  s_to_add = [].  
-000820c0: 2020 736e 765f 696e 666f 5f63 6872 203d    snv_info_chr =
-000820d0: 205b 5d0a 0a20 2020 2066 6f72 2067 6420   []..    for gd 
-000820e0: 696e 2067 645f 7365 6c3a 0a20 2020 2020  in gd_sel:.     
-000820f0: 2020 2067 642e 6e76 5f69 6e66 6f5f 6c73     gd.nv_info_ls
-00082100: 7420 3d20 5b5d 0a0a 2020 2020 7072 6576  t = []..    prev
-00082110: 5f6f 6669 203d 2030 0a20 2020 2076 5f63  _ofi = 0.    v_c
-00082120: 6e74 203d 2030 0a20 2020 2023 666f 7220  nt = 0.    #for 
-00082130: 6b2c 2072 2069 6e20 656e 756d 6572 6174  k, r in enumerat
-00082140: 6528 7261 6c6c 2e72 676e 7329 3a0a 2020  e(rall.rgns):.  
-00082150: 2020 666f 7220 6d2c 206b 2069 6e20 656e    for m, k in en
-00082160: 756d 6572 6174 6528 6f64 7229 3a0a 2020  umerate(odr):.  
-00082170: 2020 2020 2020 7220 3d20 7261 6c6c 2e72        r = rall.r
-00082180: 676e 735b 6b5d 0a20 2020 2020 2020 2067  gns[k].        g
-00082190: 696e 203d 2047 656e 655f 6964 5f6e 616d  in = Gene_id_nam
-000821a0: 655b 6b5d 0a20 2020 2020 2020 200a 2020  e[k].        .  
-000821b0: 2020 2020 2020 6f73 732c 2070 7265 765f        oss, prev_
-000821c0: 6f66 3120 3d20 6f66 2e66 696e 645f 6f73  of1 = of.find_os
-000821d0: 5f73 6571 2872 2e73 7461 7274 2c20 7072  _seq(r.start, pr
-000821e0: 6576 5f6f 6669 290a 2020 2020 2020 2020  ev_ofi).        
-000821f0: 2320 6f73 6520 3d20 6f73 730a 2020 2020  # ose = oss.    
-00082200: 2020 2020 6f73 652c 2070 7265 765f 6f66      ose, prev_of
-00082210: 3220 3d20 6f66 2e66 696e 645f 6f73 5f73  2 = of.find_os_s
-00082220: 6571 2872 2e65 6e64 2c20 7072 6576 5f6f  eq(r.end, prev_o
-00082230: 6669 290a 200a 2020 2020 2020 2020 722e  fi). .        r.
-00082240: 6765 745f 6376 6728 290a 2020 2020 2020  get_cvg().      
-00082250: 2020 2320 6966 2072 2e63 7667 2069 7320    # if r.cvg is 
-00082260: 4e6f 6e65 3a20 722e 6376 6720 3d20 6e70  None: r.cvg = np
-00082270: 2e6f 6e65 7328 6c65 6e28 722e 7365 7129  .ones(len(r.seq)
-00082280: 290a 0a20 2020 2020 2020 2069 6620 722e  )..        if r.
-00082290: 7479 7065 203d 3d20 2765 786f 6e27 3a0a  type == 'exon':.
-000822a0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-000822b0: 2020 2020 2020 2020 2069 6620 286f 7373           if (oss
-000822c0: 203d 3d20 6f73 6529 3a0a 0a20 2020 2020   == ose):..     
-000822d0: 2020 2020 2020 2020 2020 2023 2073 695f             # si_
-000822e0: 6c73 7420 3d20 6669 6e64 5f73 6e70 2873  lst = find_snp(s
-000822f0: 6571 5f6f 7267 5b28 722e 7374 6172 742d  eq_org[(r.start-
-00082300: 3129 3a72 2e65 6e64 5d2c 2072 2e73 6571  1):r.end], r.seq
-00082310: 2c20 722e 6765 745f 6376 6728 292c 2063  , r.get_cvg(), c
-00082320: 6872 6d2c 2072 2e73 7461 7274 2c20 6f73  hrm, r.start, os
-00082330: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00082340: 2020 2073 695f 6c73 7420 3d20 6669 6e64     si_lst = find
-00082350: 5f73 6e70 2873 6571 5f6f 7267 5b28 722e  _snp(seq_org[(r.
-00082360: 7374 6172 742d 3129 3a72 2e65 6e64 5d2c  start-1):r.end],
-00082370: 2072 2e73 6571 2c20 722e 636d 6174 2c20   r.seq, r.cmat, 
-00082380: 6368 726d 2c20 722e 7374 6172 742c 206f  chrm, r.start, o
-00082390: 7373 2c20 6769 6e29 0a20 2020 2020 2020  ss, gin).       
-000823a0: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
-000823b0: 6f5f 6368 7220 3d20 736e 765f 696e 666f  o_chr = snv_info
-000823c0: 5f63 6872 202b 2073 695f 6c73 740a 2020  _chr + si_lst.  
-000823d0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-000823e0: 5f69 6478 203d 2067 645f 6964 785f 6f66  _idx = gd_idx_of
-000823f0: 5f72 676e 5b6b 5d0a 2020 2020 2020 2020  _rgn[k].        
-00082400: 2020 2020 2020 2020 6764 5f73 656c 5b67          gd_sel[g
-00082410: 645f 6964 785d 2e6e 765f 696e 666f 5f6c  d_idx].nv_info_l
-00082420: 7374 203d 2067 645f 7365 6c5b 6764 5f69  st = gd_sel[gd_i
-00082430: 6478 5d2e 6e76 5f69 6e66 6f5f 6c73 7420  dx].nv_info_lst 
-00082440: 2b20 7369 5f6c 7374 0a0a 2020 2020 2020  + si_lst..      
-00082450: 2020 2020 2020 2020 2020 722e 7374 6172            r.star
-00082460: 7420 2b3d 206f 7373 0a20 2020 2020 2020  t += oss.       
-00082470: 2020 2020 2020 2020 2072 2e65 6e64 202b           r.end +
-00082480: 3d20 6f73 650a 2020 2020 2020 2020 2020  = ose.          
-00082490: 2020 2020 2020 7261 6c6c 2e72 676e 735b        rall.rgns[
-000824a0: 6b5d 203d 2072 2023 202e 636f 7079 2829  k] = r # .copy()
-000824b0: 0a0a 0a20 2020 2020 2020 2020 2020 2065  ...            e
-000824c0: 6c69 6620 286f 7373 203c 206f 7365 293a  lif (oss < ose):
-000824d0: 2023 2049 6e73 6572 7369 6f6e 2069 6e20   # Insersion in 
-000824e0: 6265 7477 6565 6e0a 0a20 2020 2020 2020  between..       
-000824f0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00082500: 2020 2025 6920 6f73 7320 3c20 6f73 6527     %i oss < ose'
-00082510: 2025 206b 290a 2020 2020 2020 2020 2020   % k).          
-00082520: 2020 2020 2020 2320 722e 7072 696e 745f        # r.print_
-00082530: 7368 6f72 7428 290a 2020 2020 2020 2020  short().        
-00082540: 2020 2020 2020 2020 702c 2070 7265 765f          p, prev_
-00082550: 6f66 3220 3d20 6f66 2e67 6574 5f62 6e64  of2 = of.get_bnd
-00082560: 7279 5f73 6571 286f 7365 2c20 7072 6576  ry_seq(ose, prev
-00082570: 5f6f 6669 290a 0a20 2020 2020 2020 2020  _ofi)..         
-00082580: 2020 2020 2020 2023 2320 7370 6c69 740a         ## split.
-00082590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000825a0: 4c72 203d 2072 2e65 6e64 202d 2072 2e73  Lr = r.end - r.s
-000825b0: 7461 7274 202b 310a 2020 2020 2020 2020  tart +1.        
-000825c0: 2020 2020 2020 2020 4c6e 203d 2072 2e65          Ln = r.e
-000825d0: 6e64 202d 2070 202b 2031 0a20 2020 2020  nd - p + 1.     
-000825e0: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
-000825f0: 6577 203d 2072 6567 696f 6e28 2072 2e63  ew = region( r.c
-00082600: 6872 2c20 702b 6f73 652c 2072 2e65 6e64  hr, p+ose, r.end
-00082610: 2b6f 7365 2c20 722e 7479 7065 2c20 722e  +ose, r.type, r.
-00082620: 636d 6174 5b3a 2c2d 4c6e 3a5d 2c20 7873  cmat[:,-Ln:], xs
-00082630: 203d 2072 2e78 7329 0a20 2020 2020 2020   = r.xs).       
-00082640: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
-00082650: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
-00082660: 2020 2020 2020 2020 2020 2072 5f74 6f5f             r_to_
-00082670: 6164 642e 6170 7065 6e64 2872 676e 5f6e  add.append(rgn_n
-00082680: 6577 290a 2020 2020 2020 2020 2020 2020  ew).            
-00082690: 2020 2020 706f 735f 746f 5f61 6464 2e61      pos_to_add.a
-000826a0: 7070 656e 6428 6b2b 3129 0a0a 2020 2020  ppend(k+1)..    
-000826b0: 2020 2020 2020 2020 2020 2020 2320 7369              # si
-000826c0: 5f6c 7374 203d 2066 696e 645f 736e 7028  _lst = find_snp(
-000826d0: 7365 715f 6f72 675b 2870 2d31 293a 722e  seq_org[(p-1):r.
-000826e0: 656e 645d 2c20 7267 6e5f 6e65 772e 7365  end], rgn_new.se
-000826f0: 712c 2072 676e 5f6e 6577 2e67 6574 5f63  q, rgn_new.get_c
-00082700: 7667 2829 2c20 6368 726d 2c20 702c 206f  vg(), chrm, p, o
-00082710: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00082720: 2020 2020 7369 5f6c 7374 203d 2066 696e      si_lst = fin
-00082730: 645f 736e 7028 7365 715f 6f72 675b 2870  d_snp(seq_org[(p
-00082740: 2d31 293a 722e 656e 645d 2c20 7267 6e5f  -1):r.end], rgn_
-00082750: 6e65 772e 7365 712c 2072 676e 5f6e 6577  new.seq, rgn_new
-00082760: 2e63 6d61 742c 2063 6872 6d2c 2070 2c20  .cmat, chrm, p, 
-00082770: 6f73 652c 2067 696e 290a 2020 2020 2020  ose, gin).      
-00082780: 2020 2020 2020 2020 2020 736e 765f 696e            snv_in
-00082790: 666f 5f63 6872 203d 2073 6e76 5f69 6e66  fo_chr = snv_inf
-000827a0: 6f5f 6368 7220 2b20 7369 5f6c 7374 0a20  o_chr + si_lst. 
-000827b0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-000827c0: 645f 6964 7820 3d20 6764 5f69 6478 5f6f  d_idx = gd_idx_o
-000827d0: 665f 7267 6e5b 6b5d 0a20 2020 2020 2020  f_rgn[k].       
-000827e0: 2020 2020 2020 2020 2067 645f 7365 6c5b           gd_sel[
-000827f0: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
-00082800: 6c73 7420 3d20 6764 5f73 656c 5b67 645f  lst = gd_sel[gd_
-00082810: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
-00082820: 202b 2073 695f 6c73 740a 0a20 2020 2020   + si_lst..     
-00082830: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
-00082840: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
-00082850: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
-00082860: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
-00082870: 2020 2020 2020 2020 2020 4c6e 203d 2072            Ln = r
-00082880: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
-00082890: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000828a0: 2020 722e 636d 6174 203d 2072 2e63 6d61    r.cmat = r.cma
-000828b0: 745b 3a2c 3a4c 6e5d 0a20 2020 2020 2020  t[:,:Ln].       
-000828c0: 2020 2020 2020 2020 2072 2e73 6571 203d           r.seq =
-000828d0: 2072 2e73 6571 5b3a 4c6e 5d0a 2020 2020   r.seq[:Ln].    
-000828e0: 2020 2020 2020 2020 2020 2020 722e 6376              r.cv
-000828f0: 6720 3d20 722e 6376 675b 3a4c 6e5d 0a20  g = r.cvg[:Ln]. 
-00082900: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00082910: 2072 2e67 6574 5f63 7667 2829 0a20 2020   r.get_cvg().   
-00082920: 2020 2020 2020 2020 2020 2020 2072 616c               ral
-00082930: 6c2e 7267 6e73 5b6b 5d20 3d20 7220 2320  l.rgns[k] = r # 
-00082940: 2e63 6f70 7928 290a 0a20 2020 2020 2020  .copy()..       
-00082950: 2020 2020 2020 2020 2023 2073 695f 6c73           # si_ls
-00082960: 7420 3d20 6669 6e64 5f73 6e70 2873 6571  t = find_snp(seq
-00082970: 5f6f 7267 5b28 722e 7374 6172 742d 6f73  _org[(r.start-os
-00082980: 732d 3129 3a70 5d2c 2072 2e73 6571 2c20  s-1):p], r.seq, 
-00082990: 722e 6765 745f 6376 6728 292c 2063 6872  r.get_cvg(), chr
-000829a0: 6d2c 2072 2e73 7461 7274 2d6f 7373 2c20  m, r.start-oss, 
-000829b0: 6f73 7329 0a20 2020 2020 2020 2020 2020  oss).           
-000829c0: 2020 2020 2073 695f 6c73 7420 3d20 6669       si_lst = fi
-000829d0: 6e64 5f73 6e70 2873 6571 5f6f 7267 5b28  nd_snp(seq_org[(
-000829e0: 722e 7374 6172 742d 6f73 732d 3129 3a70  r.start-oss-1):p
-000829f0: 5d2c 2072 2e73 6571 2c20 722e 636d 6174  ], r.seq, r.cmat
-00082a00: 2c20 6368 726d 2c20 722e 7374 6172 742d  , chrm, r.start-
-00082a10: 6f73 732c 206f 7373 2c20 6769 6e29 0a20  oss, oss, gin). 
-00082a20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00082a30: 6e76 5f69 6e66 6f5f 6368 7220 3d20 736e  nv_info_chr = sn
-00082a40: 765f 696e 666f 5f63 6872 202b 2073 695f  v_info_chr + si_
-00082a50: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
-00082a60: 2020 2020 6764 5f69 6478 203d 2067 645f      gd_idx = gd_
-00082a70: 6964 785f 6f66 5f72 676e 5b6b 5d0a 2020  idx_of_rgn[k].  
-00082a80: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-00082a90: 5f73 656c 5b67 645f 6964 785d 2e6e 765f  _sel[gd_idx].nv_
-00082aa0: 696e 666f 5f6c 7374 203d 2067 645f 7365  info_lst = gd_se
-00082ab0: 6c5b 6764 5f69 6478 5d2e 6e76 5f69 6e66  l[gd_idx].nv_inf
-00082ac0: 6f5f 6c73 7420 2b20 7369 5f6c 7374 0a0a  o_lst + si_lst..
-00082ad0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00082ae0: 2028 6f73 7320 3e20 6f73 6529 3a20 2320   (oss > ose): # 
-00082af0: 6465 6c65 7469 6f6e 2069 6e20 6265 7477  deletion in betw
-00082b00: 6565 6e0a 0a20 2020 2020 2020 2020 2020  een..           
-00082b10: 2020 2020 2070 7269 6e74 2827 2020 2025       print('   %
-00082b20: 6920 6f73 7320 3e20 6f73 6527 2025 206b  i oss > ose' % k
-00082b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00082b40: 2020 2320 722e 7072 696e 745f 7368 6f72    # r.print_shor
-00082b50: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00082b60: 2020 2020 702c 2070 7265 765f 6f66 3220      p, prev_of2 
-00082b70: 3d20 6f66 2e67 6574 5f62 6e64 7279 5f73  = of.get_bndry_s
-00082b80: 6571 286f 7365 2c20 7072 6576 5f6f 6669  eq(ose, prev_ofi
-00082b90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00082ba0: 2020 4c64 203d 206f 7373 202d 206f 7365    Ld = oss - ose
-00082bb0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00082bc0: 2020 2323 2073 706c 6974 2028 666f 7220    ## split (for 
-00082bd0: 4344 5320 6f6e 6c79 290a 2020 2020 2020  CDS only).      
-00082be0: 2020 2020 2020 2020 2020 4c72 203d 2072            Lr = r
-00082bf0: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
-00082c00: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00082c10: 2020 4c6e 203d 2072 2e65 6e64 202d 2070    Ln = r.end - p
-00082c20: 202b 2031 202d 204c 640a 2020 2020 2020   + 1 - Ld.      
-00082c30: 2020 2020 2020 2020 2020 7267 6e5f 6e65            rgn_ne
-00082c40: 7720 3d20 7265 6769 6f6e 2820 722e 6368  w = region( r.ch
-00082c50: 722c 2070 2b4c 642b 6f73 652c 2072 2e65  r, p+Ld+ose, r.e
-00082c60: 6e64 2b6f 7365 2c20 722e 7479 7065 2c20  nd+ose, r.type, 
-00082c70: 722e 636d 6174 5b3a 2c2d 4c6e 3a5d 2c20  r.cmat[:,-Ln:], 
-00082c80: 7873 203d 2072 2e78 7329 0a20 2020 2020  xs = r.xs).     
-00082c90: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
-00082ca0: 6577 2e67 6574 5f63 7667 2829 0a20 2020  ew.get_cvg().   
-00082cb0: 2020 2020 2020 2020 2020 2020 2072 5f74               r_t
-00082cc0: 6f5f 6164 642e 6170 7065 6e64 2872 676e  o_add.append(rgn
-00082cd0: 5f6e 6577 290a 2020 2020 2020 2020 2020  _new).          
-00082ce0: 2020 2020 2020 706f 735f 746f 5f61 6464        pos_to_add
-00082cf0: 2e61 7070 656e 6428 6b2b 3129 0a0a 2020  .append(k+1)..  
-00082d00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00082d10: 7369 5f6c 7374 203d 2066 696e 645f 736e  si_lst = find_sn
-00082d20: 7028 7365 715f 6e65 775b 2872 676e 5f6e  p(seq_new[(rgn_n
-00082d30: 6577 2e73 7461 7274 2d31 293a 7267 6e5f  ew.start-1):rgn_
-00082d40: 6e65 772e 656e 645d 2c20 7267 6e5f 6e65  new.end], rgn_ne
-00082d50: 772e 7365 712c 2072 676e 5f6e 6577 2e67  w.seq, rgn_new.g
-00082d60: 6574 5f63 7667 2829 2c20 6368 726d 2c20  et_cvg(), chrm, 
-00082d70: 702c 206f 7365 290a 2020 2020 2020 2020  p, ose).        
-00082d80: 2020 2020 2020 2020 7369 5f6c 7374 203d          si_lst =
-00082d90: 2066 696e 645f 736e 7028 7365 715f 6e65   find_snp(seq_ne
-00082da0: 775b 2872 676e 5f6e 6577 2e73 7461 7274  w[(rgn_new.start
-00082db0: 2d31 293a 7267 6e5f 6e65 772e 656e 645d  -1):rgn_new.end]
-00082dc0: 2c20 7267 6e5f 6e65 772e 7365 712c 2072  , rgn_new.seq, r
-00082dd0: 676e 5f6e 6577 2e63 6d61 742c 2063 6872  gn_new.cmat, chr
-00082de0: 6d2c 2070 2c20 6f73 652c 2067 696e 290a  m, p, ose, gin).
-00082df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082e00: 736e 765f 696e 666f 5f63 6872 203d 2073  snv_info_chr = s
-00082e10: 6e76 5f69 6e66 6f5f 6368 7220 2b20 7369  nv_info_chr + si
-00082e20: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
-00082e30: 2020 2020 2067 645f 6964 7820 3d20 6764       gd_idx = gd
-00082e40: 5f69 6478 5f6f 665f 7267 6e5b 6b5d 0a20  _idx_of_rgn[k]. 
-00082e50: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00082e60: 645f 7365 6c5b 6764 5f69 6478 5d2e 6e76  d_sel[gd_idx].nv
-00082e70: 5f69 6e66 6f5f 6c73 7420 3d20 6764 5f73  _info_lst = gd_s
-00082e80: 656c 5b67 645f 6964 785d 2e6e 765f 696e  el[gd_idx].nv_in
-00082e90: 666f 5f6c 7374 202b 2073 695f 6c73 740a  fo_lst + si_lst.
-00082ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082eb0: 2072 2e65 6e64 203d 2070 2d31 2b6f 7373   r.end = p-1+oss
-00082ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082ed0: 2072 2e73 7461 7274 202b 3d20 6f73 730a   r.start += oss.
-00082ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082ef0: 4c6e 203d 2072 2e65 6e64 202d 2072 2e73  Ln = r.end - r.s
-00082f00: 7461 7274 202b 310a 2020 2020 2020 2020  tart +1.        
-00082f10: 2020 2020 2020 2020 722e 636d 6174 203d          r.cmat =
-00082f20: 2072 2e63 6d61 745b 3a2c 3a4c 6e5d 0a20   r.cmat[:,:Ln]. 
-00082f30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00082f40: 2e73 6571 203d 2072 2e73 6571 5b3a 4c6e  .seq = r.seq[:Ln
-00082f50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00082f60: 2020 722e 6376 6720 3d20 722e 6376 675b    r.cvg = r.cvg[
-00082f70: 3a4c 6e5d 0a20 2020 2020 2020 2020 2020  :Ln].           
-00082f80: 2020 2020 2023 2072 2e67 6574 5f63 7667       # r.get_cvg
-00082f90: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00082fa0: 2020 2072 616c 6c2e 7267 6e73 5b6b 5d20     rall.rgns[k] 
-00082fb0: 3d20 7220 2320 2e63 6f70 7928 290a 0a20  = r # .copy().. 
-00082fc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00082fd0: 2073 695f 6c73 7420 3d20 6669 6e64 5f73   si_lst = find_s
-00082fe0: 6e70 2873 6571 5f6f 7267 5b28 722e 7374  np(seq_org[(r.st
-00082ff0: 6172 742d 6f73 732d 3129 3a70 5d2c 2072  art-oss-1):p], r
-00083000: 2e73 6571 2c20 722e 6765 745f 6376 6728  .seq, r.get_cvg(
-00083010: 292c 2063 6872 6d2c 2072 2e73 7461 7274  ), chrm, r.start
-00083020: 2d6f 7373 2c20 6f73 7329 0a20 2020 2020  -oss, oss).     
-00083030: 2020 2020 2020 2020 2020 2073 695f 6c73             si_ls
-00083040: 7420 3d20 6669 6e64 5f73 6e70 2873 6571  t = find_snp(seq
-00083050: 5f6f 7267 5b28 722e 7374 6172 742d 6f73  _org[(r.start-os
-00083060: 732d 3129 3a70 5d2c 2072 2e73 6571 2c20  s-1):p], r.seq, 
-00083070: 722e 636d 6174 2c20 6368 726d 2c20 722e  r.cmat, chrm, r.
-00083080: 7374 6172 742d 6f73 732c 206f 7373 2c20  start-oss, oss, 
-00083090: 6769 6e29 0a20 2020 2020 2020 2020 2020  gin).           
-000830a0: 2020 2020 2073 6e76 5f69 6e66 6f5f 6368       snv_info_ch
-000830b0: 7220 3d20 736e 765f 696e 666f 5f63 6872  r = snv_info_chr
-000830c0: 202b 2073 695f 6c73 740a 2020 2020 2020   + si_lst.      
-000830d0: 2020 2020 2020 2020 2020 6764 5f69 6478            gd_idx
-000830e0: 203d 2067 645f 6964 785f 6f66 5f72 676e   = gd_idx_of_rgn
-000830f0: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
-00083100: 2020 2020 6764 5f73 656c 5b67 645f 6964      gd_sel[gd_id
-00083110: 785d 2e6e 765f 696e 666f 5f6c 7374 203d  x].nv_info_lst =
-00083120: 2067 645f 7365 6c5b 6764 5f69 6478 5d2e   gd_sel[gd_idx].
-00083130: 6e76 5f69 6e66 6f5f 6c73 7420 2b20 7369  nv_info_lst + si
-00083140: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
-00083150: 2020 2020 200a 2020 2020 2020 2020 656c       .        el
-00083160: 6966 2072 2e74 7970 6520 3d3d 2027 696e  if r.type == 'in
-00083170: 7365 7273 696f 6e27 3a0a 0a20 2020 2020  sersion':..     
-00083180: 2020 2020 2020 206f 7373 702c 2070 7265         ossp, pre
-00083190: 765f 6f66 3120 3d20 6f66 2e66 696e 645f  v_of1 = of.find_
-000831a0: 6f73 5f73 6571 2872 2e73 7461 7274 2d31  os_seq(r.start-1
-000831b0: 2c20 7072 6576 5f6f 6669 2c20 6d61 726b  , prev_ofi, mark
-000831c0: 203d 2027 4927 290a 0a20 2020 2020 2020   = 'I')..       
-000831d0: 2020 2020 2073 6f70 203d 2073 6571 5f6f       sop = seq_o
-000831e0: 7267 5b69 6e74 2872 2e73 7461 7274 2d28  rg[int(r.start-(
-000831f0: 4e57 494e 2b31 2929 3a69 6e74 2872 2e73  NWIN+1)):int(r.s
-00083200: 7461 7274 2d31 295d 0a20 2020 2020 2020  tart-1)].       
-00083210: 2020 2020 2073 6f63 203d 2027 2d27 0a20       soc = '-'. 
-00083220: 2020 2020 2020 2020 2020 2073 6f6e 203d             son =
-00083230: 2073 6571 5f6f 7267 5b69 6e74 2872 2e73   seq_org[int(r.s
-00083240: 7461 7274 2d31 293a 696e 7428 722e 7374  tart-1):int(r.st
-00083250: 6172 742b 284e 5749 4e2d 3129 295d 0a20  art+(NWIN-1))]. 
-00083260: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00083270: 2020 2020 2020 2020 736e 7020 3d20 7365          snp = se
-00083280: 715f 6e65 775b 696e 7428 722e 7374 6172  q_new[int(r.star
-00083290: 742b 6f73 7370 2d28 4e57 494e 2b31 2929  t+ossp-(NWIN+1))
-000832a0: 3a69 6e74 2872 2e73 7461 7274 2b6f 7373  :int(r.start+oss
-000832b0: 702d 3129 5d0a 2020 2020 2020 2020 2020  p-1)].          
-000832c0: 2020 736e 6320 3d20 722e 7365 710a 2020    snc = r.seq.  
-000832d0: 2020 2020 2020 2020 2020 736e 6e20 3d20            snn = 
-000832e0: 7365 715f 6e65 775b 696e 7428 722e 7374  seq_new[int(r.st
-000832f0: 6172 742b 6f73 732d 3129 3a69 6e74 2872  art+oss-1):int(r
-00083300: 2e73 7461 7274 2b6f 7373 2b28 4e57 494e  .start+oss+(NWIN
-00083310: 2d31 2929 5d0a 2020 2020 2020 2020 2020  -1))].          
-00083320: 2020 7369 203d 2053 4e56 5f69 6e66 6f28    si = SNV_info(
-00083330: 6368 726d 2c20 722e 7374 6172 742c 2072  chrm, r.start, r
-00083340: 2e73 7461 7274 2b6f 7373 2c20 6769 6e5b  .start+oss, gin[
-00083350: 305d 2c20 6769 6e5b 315d 2c20 2749 272c  0], gin[1], 'I',
-00083360: 2072 2e67 6574 5f6c 656e 2829 2c20 696e   r.get_len(), in
-00083370: 7428 722e 6176 655f 6376 675f 6465 7074  t(r.ave_cvg_dept
-00083380: 6828 2929 2c20 722e 6376 675f 6672 6163  h()), r.cvg_frac
-00083390: 2c20 736f 702c 2073 6f63 2c20 736f 6e2c  , sop, soc, son,
-000833a0: 2073 6e70 2c20 736e 632c 2073 6e6e 2029   snp, snc, snn )
-000833b0: 0a20 2020 2020 2020 2020 2020 2073 6e76  .            snv
-000833c0: 5f69 6e66 6f5f 6368 722e 6170 7065 6e64  _info_chr.append
-000833d0: 2873 6929 0a20 2020 2020 2020 2020 2020  (si).           
-000833e0: 2067 645f 6964 7820 3d20 6764 5f69 6478   gd_idx = gd_idx
-000833f0: 5f6f 665f 7267 6e5b 6b5d 0a20 2020 2020  _of_rgn[k].     
-00083400: 2020 2020 2020 2067 645f 7365 6c5b 6764         gd_sel[gd
-00083410: 5f69 6478 5d2e 6e76 5f69 6e66 6f5f 6c73  _idx].nv_info_ls
-00083420: 742e 6170 7065 6e64 2873 6929 0a0a 2020  t.append(si)..  
-00083430: 2020 2020 2020 2020 2020 722e 7374 6172            r.star
-00083440: 7420 2b3d 206f 7373 700a 2020 2020 2020  t += ossp.      
-00083450: 2020 2020 2020 722e 656e 6420 2b3d 206f        r.end += o
-00083460: 7373 7020 200a 2020 2020 2020 2020 2020  ssp  .          
-00083470: 2020 7261 6c6c 2e72 676e 735b 6b5d 203d    rall.rgns[k] =
-00083480: 2072 2023 202e 636f 7079 2829 0a0a 2020   r # .copy()..  
-00083490: 2020 2020 2020 656c 6966 2072 2e74 7970        elif r.typ
-000834a0: 6520 3d3d 2027 6465 6c65 7469 6f6e 273a  e == 'deletion':
-000834b0: 0a0a 2020 2020 2020 2020 2020 2020 6f73  ..            os
-000834c0: 7370 2c20 7072 6576 5f6f 6631 203d 206f  sp, prev_of1 = o
-000834d0: 662e 6669 6e64 5f6f 735f 7365 7128 722e  f.find_os_seq(r.
-000834e0: 7374 6172 742d 312c 2070 7265 765f 6f66  start-1, prev_of
-000834f0: 692c 206d 6172 6b20 3d20 2744 2729 0a0a  i, mark = 'D')..
-00083500: 2020 2020 2020 2020 2020 2020 736f 7020              sop 
-00083510: 3d20 7365 715f 6f72 675b 696e 7428 722e  = seq_org[int(r.
-00083520: 7374 6172 742d 284e 5749 4e2b 3129 293a  start-(NWIN+1)):
-00083530: 696e 7428 722e 7374 6172 742d 3129 5d0a  int(r.start-1)].
-00083540: 2020 2020 2020 2020 2020 2020 736f 6320              soc 
-00083550: 3d20 7365 715f 6f72 675b 696e 7428 722e  = seq_org[int(r.
-00083560: 7374 6172 742d 3129 3a69 6e74 2872 2e65  start-1):int(r.e
-00083570: 6e64 295d 0a20 2020 2020 2020 2020 2020  nd)].           
-00083580: 2073 6f6e 203d 2073 6571 5f6f 7267 5b69   son = seq_org[i
-00083590: 6e74 2872 2e65 6e64 293a 696e 7428 722e  nt(r.end):int(r.
-000835a0: 656e 642b 284e 5749 4e29 295d 0a20 2020  end+(NWIN))].   
-000835b0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-000835c0: 2020 2020 2020 2320 736f 7020 3d20 7261        # sop = ra
-000835d0: 6c6c 2e72 676e 735b 6f64 725b 6d2d 315d  ll.rgns[odr[m-1]
-000835e0: 5d2e 7365 715b 2d4e 5749 4e3a 5d0a 2020  ].seq[-NWIN:].  
-000835f0: 2020 2020 2020 2020 2020 736e 7020 3d20            snp = 
-00083600: 7365 715f 6e65 775b 696e 7428 722e 7374  seq_new[int(r.st
-00083610: 6172 742b 6f73 7370 2d28 4e57 494e 2b31  art+ossp-(NWIN+1
-00083620: 2929 3a69 6e74 2872 2e73 7461 7274 2b6f  )):int(r.start+o
-00083630: 7373 702d 3129 5d0a 2020 2020 2020 2020  ssp-1)].        
-00083640: 2020 2020 736e 6320 3d20 272d 270a 2020      snc = '-'.  
-00083650: 2020 2020 2020 2020 2020 2320 736f 6e20            # son 
-00083660: 3d20 7261 6c6c 2e72 676e 735b 6f64 725b  = rall.rgns[odr[
-00083670: 6d2b 315d 5d2e 7365 715b 3a4e 5749 4e5d  m+1]].seq[:NWIN]
-00083680: 0a20 2020 2020 2020 2020 2020 2073 6e6e  .            snn
-00083690: 203d 2073 6571 5f6e 6577 5b69 6e74 2872   = seq_new[int(r
-000836a0: 2e73 7461 7274 2b6f 7373 702d 3129 3a69  .start+ossp-1):i
-000836b0: 6e74 2872 2e73 7461 7274 2b6f 7373 702b  nt(r.start+ossp+
-000836c0: 284e 5749 4e2d 3129 295d 0a20 2020 2020  (NWIN-1))].     
-000836d0: 2020 2020 2020 2073 6920 3d20 534e 565f         si = SNV_
-000836e0: 696e 666f 2863 6872 6d2c 2072 2e73 7461  info(chrm, r.sta
-000836f0: 7274 2c20 722e 7374 6172 742b 6f73 732c  rt, r.start+oss,
-00083700: 2067 696e 5b30 5d2c 2067 696e 5b31 5d2c   gin[0], gin[1],
-00083710: 2027 4427 2c20 722e 6765 745f 6c65 6e28   'D', r.get_len(
-00083720: 292c 2069 6e74 2872 2e61 7665 5f63 7667  ), int(r.ave_cvg
-00083730: 5f64 6570 7468 2829 292c 2072 2e63 7667  _depth()), r.cvg
-00083740: 5f66 7261 632c 2073 6f70 2c20 736f 632c  _frac, sop, soc,
-00083750: 2073 6f6e 2c20 736e 702c 2073 6e63 2c20   son, snp, snc, 
-00083760: 736e 6e20 290a 2020 2020 2020 2020 2020  snn ).          
-00083770: 2020 736e 765f 696e 666f 5f63 6872 2e61    snv_info_chr.a
-00083780: 7070 656e 6428 7369 290a 2020 2020 2020  ppend(si).      
-00083790: 2020 2020 2020 6764 5f69 6478 203d 2067        gd_idx = g
-000837a0: 645f 6964 785f 6f66 5f72 676e 5b6b 5d0a  d_idx_of_rgn[k].
-000837b0: 2020 2020 2020 2020 2020 2020 6764 5f73              gd_s
-000837c0: 656c 5b67 645f 6964 785d 2e6e 765f 696e  el[gd_idx].nv_in
-000837d0: 666f 5f6c 7374 2e61 7070 656e 6428 7369  fo_lst.append(si
-000837e0: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
-000837f0: 2e73 7461 7274 202b 3d20 6f73 7370 0a20  .start += ossp. 
-00083800: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
-00083810: 202b 3d20 6f73 7370 2020 200a 2020 2020   += ossp   .    
-00083820: 2020 2020 2020 2020 7261 6c6c 2e72 676e          rall.rgn
-00083830: 735b 6b5d 203d 2072 2023 202e 636f 7079  s[k] = r # .copy
-00083840: 2829 0a0a 2020 2020 2020 2020 7072 6576  ()..        prev
-00083850: 5f6f 6669 203d 2070 7265 765f 6f66 310a  _ofi = prev_of1.
-00083860: 0a20 2020 2065 6c61 7073 6564 5f74 696d  .    elapsed_tim
-00083870: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
-00083880: 2d20 7374 6172 745f 7469 6d65 0a20 2020  - start_time.   
-00083890: 2023 2070 7269 6e74 2827 2020 2033 2e20   # print('   3. 
-000838a0: 646f 6e65 2028 2569 2920 2025 6927 2025  done (%i)  %i' %
-000838b0: 2028 656c 6170 7365 645f 7469 6d65 2c20   (elapsed_time, 
-000838c0: 6c65 6e28 6f66 2e6f 7369 5f6c 7374 2929  len(of.osi_lst))
-000838d0: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-000838e0: 2020 2020 0a20 2020 206e 765f 6c73 7420      .    nv_lst 
-000838f0: 3d20 5b5d 0a20 2020 2063 6e74 5f65 203d  = [].    cnt_e =
-00083900: 2030 0a20 2020 2066 6f72 2067 6420 696e   0.    for gd in
-00083910: 2067 645f 7365 6c3a 0a20 2020 2020 2020   gd_sel:.       
-00083920: 2066 6f72 2074 6420 696e 2067 642e 7464   for td in gd.td
-00083930: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
-00083940: 2020 7464 2e67 6574 5f6f 7267 5f63 6f64    td.get_org_cod
-00083950: 696e 675f 7365 7128 2067 642e 6364 732e  ing_seq( gd.cds.
-00083960: 7267 6e73 2c20 7365 715f 6f72 6720 290a  rgns, seq_org ).
-00083970: 2020 2020 2020 2020 6e76 5f6c 7374 5f74          nv_lst_t
-00083980: 6d70 2c20 636e 745f 6520 3d20 6764 2e67  mp, cnt_e = gd.g
-00083990: 6574 5f67 656e 655f 6c65 7665 6c5f 6e76  et_gene_level_nv
-000839a0: 5f69 6e66 6f28 636e 745f 6529 0a20 2020  _info(cnt_e).   
-000839b0: 2020 2020 206e 765f 6c73 7420 3d20 6e76       nv_lst = nv
-000839c0: 5f6c 7374 202b 206e 765f 6c73 745f 746d  _lst + nv_lst_tm
-000839d0: 700a 2020 2020 736e 765f 696e 666f 5f63  p.    snv_info_c
-000839e0: 6872 203d 206e 765f 6c73 740a 2020 2020  hr = nv_lst.    
-000839f0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00083a00: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00083a10: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00083a20: 2323 2070 7574 2072 676e 7320 6261 636b  ## put rgns back
-00083a30: 2074 6f20 6764 5f73 656c 0a20 2020 2023   to gd_sel.    #
-00083a40: 2320 616e 6420 616c 736f 2061 6464 206e  # and also add n
-00083a50: 6577 2072 676e 7320 0a0a 2020 2020 7374  ew rgns ..    st
-00083a60: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
-00083a70: 7469 6d65 2829 0a20 2020 2070 6f73 5f74  time().    pos_t
-00083a80: 6f5f 6164 6420 3d20 6e70 2e61 7272 6179  o_add = np.array
-00083a90: 2870 6f73 5f74 6f5f 6164 6429 0a20 2020  (pos_to_add).   
-00083aa0: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
-00083ab0: 756d 6572 6174 6528 6764 5f73 656c 293a  umerate(gd_sel):
-00083ac0: 200a 0a20 2020 2020 2020 2070 3120 3d20   ..        p1 = 
-00083ad0: 696e 7428 6c6f 635f 6f73 5b6b 5d29 0a20  int(loc_os[k]). 
-00083ae0: 2020 2020 2020 2070 3220 3d20 696e 7428         p2 = int(
-00083af0: 7031 202b 206e 756d 5f6f 735b 6b5d 290a  p1 + num_os[k]).
-00083b00: 2020 2020 2020 2020 2320 6764 2e65 786f          # gd.exo
-00083b10: 6e73 2e72 676e 7320 3d20 7261 6c6c 2e72  ns.rgns = rall.r
-00083b20: 676e 735b 7031 3a70 325d 0a20 2020 2020  gns[p1:p2].     
-00083b30: 2020 2067 642e 6578 6f6e 732e 7267 6e73     gd.exons.rgns
-00083b40: 203d 205b 7261 6c6c 2e72 676e 735b 7031   = [rall.rgns[p1
-00083b50: 2b6d 5d20 666f 7220 6d20 696e 2072 616e  +m] for m in ran
-00083b60: 6765 2870 322d 7031 295d 0a20 2020 2020  ge(p2-p1)].     
-00083b70: 2020 2077 6820 3d20 7768 6963 6828 2028     wh = which( (
-00083b80: 706f 735f 746f 5f61 6464 203e 3d20 7031  pos_to_add >= p1
-00083b90: 2920 2620 2870 6f73 5f74 6f5f 6164 6420  ) & (pos_to_add 
-00083ba0: 3c20 7032 2920 290a 2020 2020 2020 2020  < p2) ).        
-00083bb0: 6966 206c 656e 2877 6829 203e 2030 3a0a  if len(wh) > 0:.
-00083bc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00083bd0: 7720 696e 2077 683a 2067 642e 6578 6f6e  w in wh: gd.exon
-00083be0: 732e 7267 6e73 2e61 7070 656e 6428 725f  s.rgns.append(r_
-00083bf0: 746f 5f61 6464 5b77 5d29 0a0a 2020 2020  to_add[w])..    
-00083c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083c10: 2323 2323 2323 230a 2020 2020 2323 2072  #######.    ## r
-00083c20: 656d 6f76 6520 6964 656c 6574 696f 6e20  emove ideletion 
-00083c30: 0a20 2020 2023 2320 636f 6d62 696e 6520  .    ## combine 
-00083c40: 7469 6c65 6420 6578 6f6e 730a 2020 2020  tiled exons.    
-00083c50: 0a20 2020 2066 6f72 2067 6420 696e 2067  .    for gd in g
-00083c60: 645f 7365 6c3a 0a20 2020 2020 2020 2067  d_sel:.        g
-00083c70: 642e 7265 6d6f 7665 5f69 6e64 656c 5f61  d.remove_indel_a
-00083c80: 6e64 5f63 6f6d 6269 6e65 5f66 7261 6773  nd_combine_frags
-00083c90: 2829 0a0a 2020 2020 2327 2727 0a20 2020  ()..    #'''.   
-00083ca0: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
-00083cb0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00083cc0: 6172 745f 7469 6d65 0a20 2020 2023 2070  art_time.    # p
-00083cd0: 7269 6e74 2827 2020 2033 622e 2064 6f6e  rint('   3b. don
-00083ce0: 6520 2825 6929 2020 2720 2520 2865 6c61  e (%i)  ' % (ela
-00083cf0: 7073 6564 5f74 696d 6529 2c20 666c 7573  psed_time), flus
-00083d00: 6820 3d20 5472 7565 290a 2020 2020 0a0a  h = True).    ..
-00083d10: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-00083d20: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-00083d30: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00083d40: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
-00083d50: 2063 6f64 696e 6720 7265 6769 6f6e 2075   coding region u
-00083d60: 7064 6174 650a 0a20 2020 2073 7461 7274  pdate..    start
-00083d70: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
-00083d80: 6528 290a 2020 2020 0a20 2020 2023 2320  e().    .    ## 
-00083d90: 636f 6c6c 6563 7420 7267 6e73 2061 6e64  collect rgns and
-00083da0: 206d 6172 6b20 7468 6569 7220 706f 730a   mark their pos.
-00083db0: 2020 2020 6c6f 635f 6f73 203d 206e 702e      loc_os = np.
-00083dc0: 7a65 726f 7328 6e5f 6764 290a 2020 2020  zeros(n_gd).    
-00083dd0: 6e75 6d5f 6f73 203d 206e 702e 7a65 726f  num_os = np.zero
-00083de0: 7328 6e5f 6764 2c64 7479 7065 3d6e 702e  s(n_gd,dtype=np.
-00083df0: 666c 6f61 7433 3229 0a20 2020 2063 616c  float32).    cal
-00083e00: 6c20 3d20 7265 6769 6f6e 7328 290a 2020  l = regions().  
-00083e10: 2020 6f73 5f63 7572 203d 2030 0a20 2020    os_cur = 0.   
-00083e20: 2063 5f70 6f73 203d 205b 5d0a 2020 2020   c_pos = [].    
-00083e30: 666f 7220 6b2c 2067 6420 696e 2065 6e75  for k, gd in enu
-00083e40: 6d65 7261 7465 2867 645f 7365 6c29 3a0a  merate(gd_sel):.
-00083e50: 2020 2020 2020 2020 6c6f 635f 6f73 5b6b          loc_os[k
-00083e60: 5d20 3d20 6f73 5f63 7572 0a20 2020 2020  ] = os_cur.     
-00083e70: 2020 206e 756d 5f6f 735b 6b5d 203d 206c     num_os[k] = l
-00083e80: 656e 2867 642e 6364 732e 7267 6e73 290a  en(gd.cds.rgns).
-00083e90: 2020 2020 2020 2020 6361 6c6c 2e72 676e          call.rgn
-00083ea0: 7320 3d20 6361 6c6c 2e72 676e 7320 2b20  s = call.rgns + 
-00083eb0: 6764 2e63 6473 2e72 676e 730a 2020 2020  gd.cds.rgns.    
-00083ec0: 2020 2020 6f73 5f63 7572 202b 3d20 6c65      os_cur += le
-00083ed0: 6e28 6764 2e63 6473 2e72 676e 7329 0a0a  n(gd.cds.rgns)..
-00083ee0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
-00083ef0: 2067 642e 6364 732e 7267 6e73 3a0a 2020   gd.cds.rgns:.  
-00083f00: 2020 2020 2020 2020 2020 635f 706f 732e            c_pos.
-00083f10: 6170 7065 6e64 2872 2e73 7461 7274 290a  append(r.start).
-00083f20: 0a20 2020 2023 2320 6765 7420 6f72 6465  .    ## get orde
-00083f30: 7220 6163 636f 7264 696e 6720 746f 206c  r according to l
-00083f40: 6f63 6174 696f 6e0a 2020 2020 635f 706f  ocation.    c_po
-00083f50: 7320 3d20 6e70 2e61 7272 6179 2863 5f70  s = np.array(c_p
-00083f60: 6f73 290a 2020 2020 6f64 7220 3d20 635f  os).    odr = c_
-00083f70: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
-00083f80: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00083f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081fe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081ff0: 2323 2323 2323 0a20 2020 2023 2320 5573  ######.    ## Us
+00082000: 6520 6f66 6673 6574 5f66 696e 6465 7220  e offset_finder 
+00082010: 746f 2063 6f72 7265 6374 2070 6f73 6974  to correct posit
+00082020: 696f 6e73 2069 6e20 4754 4620 656e 7472  ions in GTF entr
+00082030: 6965 730a 2020 2020 2323 2061 6c73 6f20  ies.    ## also 
+00082040: 6765 7420 7267 6e73 2066 7261 676d 656e  get rgns fragmen
+00082050: 7473 2077 6865 6e20 7370 6c69 7420 6973  ts when split is
+00082060: 2072 6571 7569 7265 640a 0a20 2020 206f   required..    o
+00082070: 662e 6d61 6b65 5f69 745f 636f 6d70 6163  f.make_it_compac
+00082080: 7428 290a 2020 2020 0a20 2020 2073 7461  t().    .    sta
+00082090: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
+000820a0: 696d 6528 290a 2020 2020 725f 746f 5f61  ime().    r_to_a
+000820b0: 6464 203d 205b 5d0a 2020 2020 706f 735f  dd = [].    pos_
+000820c0: 746f 5f61 6464 203d 205b 5d0a 2020 2020  to_add = [].    
+000820d0: 736e 765f 696e 666f 5f63 6872 203d 205b  snv_info_chr = [
+000820e0: 5d0a 0a20 2020 2066 6f72 2067 6420 696e  ]..    for gd in
+000820f0: 2067 645f 7365 6c3a 0a20 2020 2020 2020   gd_sel:.       
+00082100: 2067 642e 6e76 5f69 6e66 6f5f 6c73 7420   gd.nv_info_lst 
+00082110: 3d20 5b5d 0a0a 2020 2020 7072 6576 5f6f  = []..    prev_o
+00082120: 6669 203d 2030 0a20 2020 2076 5f63 6e74  fi = 0.    v_cnt
+00082130: 203d 2030 0a20 2020 2023 666f 7220 6b2c   = 0.    #for k,
+00082140: 2072 2069 6e20 656e 756d 6572 6174 6528   r in enumerate(
+00082150: 7261 6c6c 2e72 676e 7329 3a0a 2020 2020  rall.rgns):.    
+00082160: 666f 7220 6d2c 206b 2069 6e20 656e 756d  for m, k in enum
+00082170: 6572 6174 6528 6f64 7229 3a0a 2020 2020  erate(odr):.    
+00082180: 2020 2020 7220 3d20 7261 6c6c 2e72 676e      r = rall.rgn
+00082190: 735b 6b5d 0a20 2020 2020 2020 2067 696e  s[k].        gin
+000821a0: 203d 2047 656e 655f 6964 5f6e 616d 655b   = Gene_id_name[
+000821b0: 6b5d 0a20 2020 2020 2020 200a 2020 2020  k].        .    
+000821c0: 2020 2020 6f73 732c 2070 7265 765f 6f66      oss, prev_of
+000821d0: 3120 3d20 6f66 2e66 696e 645f 6f73 5f73  1 = of.find_os_s
+000821e0: 6571 2872 2e73 7461 7274 2c20 7072 6576  eq(r.start, prev
+000821f0: 5f6f 6669 290a 2020 2020 2020 2020 2320  _ofi).        # 
+00082200: 6f73 6520 3d20 6f73 730a 2020 2020 2020  ose = oss.      
+00082210: 2020 6f73 652c 2070 7265 765f 6f66 3220    ose, prev_of2 
+00082220: 3d20 6f66 2e66 696e 645f 6f73 5f73 6571  = of.find_os_seq
+00082230: 2872 2e65 6e64 2c20 7072 6576 5f6f 6669  (r.end, prev_ofi
+00082240: 290a 200a 2020 2020 2020 2020 722e 6765  ). .        r.ge
+00082250: 745f 6376 6728 290a 2020 2020 2020 2020  t_cvg().        
+00082260: 2320 6966 2072 2e63 7667 2069 7320 4e6f  # if r.cvg is No
+00082270: 6e65 3a20 722e 6376 6720 3d20 6e70 2e6f  ne: r.cvg = np.o
+00082280: 6e65 7328 6c65 6e28 722e 7365 7129 290a  nes(len(r.seq)).
+00082290: 0a20 2020 2020 2020 2069 6620 722e 7479  .        if r.ty
+000822a0: 7065 203d 3d20 2765 786f 6e27 3a0a 2020  pe == 'exon':.  
+000822b0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000822c0: 2020 2020 2020 2069 6620 286f 7373 203d         if (oss =
+000822d0: 3d20 6f73 6529 3a0a 0a20 2020 2020 2020  = ose):..       
+000822e0: 2020 2020 2020 2020 2023 2073 695f 6c73           # si_ls
+000822f0: 7420 3d20 6669 6e64 5f73 6e70 2873 6571  t = find_snp(seq
+00082300: 5f6f 7267 5b28 722e 7374 6172 742d 3129  _org[(r.start-1)
+00082310: 3a72 2e65 6e64 5d2c 2072 2e73 6571 2c20  :r.end], r.seq, 
+00082320: 722e 6765 745f 6376 6728 292c 2063 6872  r.get_cvg(), chr
+00082330: 6d2c 2072 2e73 7461 7274 2c20 6f73 7329  m, r.start, oss)
+00082340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00082350: 2073 695f 6c73 7420 3d20 6669 6e64 5f73   si_lst = find_s
+00082360: 6e70 2873 6571 5f6f 7267 5b28 722e 7374  np(seq_org[(r.st
+00082370: 6172 742d 3129 3a72 2e65 6e64 5d2c 2072  art-1):r.end], r
+00082380: 2e73 6571 2c20 722e 636d 6174 2c20 6368  .seq, r.cmat, ch
+00082390: 726d 2c20 722e 7374 6172 742c 206f 7373  rm, r.start, oss
+000823a0: 2c20 6769 6e29 0a20 2020 2020 2020 2020  , gin).         
+000823b0: 2020 2020 2020 2073 6e76 5f69 6e66 6f5f         snv_info_
+000823c0: 6368 7220 3d20 736e 765f 696e 666f 5f63  chr = snv_info_c
+000823d0: 6872 202b 2073 695f 6c73 740a 2020 2020  hr + si_lst.    
+000823e0: 2020 2020 2020 2020 2020 2020 6764 5f69              gd_i
+000823f0: 6478 203d 2067 645f 6964 785f 6f66 5f72  dx = gd_idx_of_r
+00082400: 676e 5b6b 5d0a 2020 2020 2020 2020 2020  gn[k].          
+00082410: 2020 2020 2020 6764 5f73 656c 5b67 645f        gd_sel[gd_
+00082420: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
+00082430: 203d 2067 645f 7365 6c5b 6764 5f69 6478   = gd_sel[gd_idx
+00082440: 5d2e 6e76 5f69 6e66 6f5f 6c73 7420 2b20  ].nv_info_lst + 
+00082450: 7369 5f6c 7374 0a0a 2020 2020 2020 2020  si_lst..        
+00082460: 2020 2020 2020 2020 722e 7374 6172 7420          r.start 
+00082470: 2b3d 206f 7373 0a20 2020 2020 2020 2020  += oss.         
+00082480: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
+00082490: 6f73 650a 2020 2020 2020 2020 2020 2020  ose.            
+000824a0: 2020 2020 7261 6c6c 2e72 676e 735b 6b5d      rall.rgns[k]
+000824b0: 203d 2072 2023 202e 636f 7079 2829 0a0a   = r # .copy()..
+000824c0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000824d0: 6620 286f 7373 203c 206f 7365 293a 2023  f (oss < ose): #
+000824e0: 2049 6e73 6572 7369 6f6e 2069 6e20 6265   Insersion in be
+000824f0: 7477 6565 6e0a 0a20 2020 2020 2020 2020  tween..         
+00082500: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+00082510: 2025 6920 6f73 7320 3c20 6f73 6527 2025   %i oss < ose' %
+00082520: 206b 290a 2020 2020 2020 2020 2020 2020   k).            
+00082530: 2020 2020 2320 722e 7072 696e 745f 7368      # r.print_sh
+00082540: 6f72 7428 290a 2020 2020 2020 2020 2020  ort().          
+00082550: 2020 2020 2020 702c 2070 7265 765f 6f66        p, prev_of
+00082560: 3220 3d20 6f66 2e67 6574 5f62 6e64 7279  2 = of.get_bndry
+00082570: 5f73 6571 286f 7365 2c20 7072 6576 5f6f  _seq(ose, prev_o
+00082580: 6669 290a 0a20 2020 2020 2020 2020 2020  fi)..           
+00082590: 2020 2020 2023 2320 7370 6c69 740a 2020       ## split.  
+000825a0: 2020 2020 2020 2020 2020 2020 2020 4c72                Lr
+000825b0: 203d 2072 2e65 6e64 202d 2072 2e73 7461   = r.end - r.sta
+000825c0: 7274 202b 310a 2020 2020 2020 2020 2020  rt +1.          
+000825d0: 2020 2020 2020 4c6e 203d 2072 2e65 6e64        Ln = r.end
+000825e0: 202d 2070 202b 2031 0a20 2020 2020 2020   - p + 1.       
+000825f0: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
+00082600: 203d 2072 6567 696f 6e28 2072 2e63 6872   = region( r.chr
+00082610: 2c20 702b 6f73 652c 2072 2e65 6e64 2b6f  , p+ose, r.end+o
+00082620: 7365 2c20 722e 7479 7065 2c20 722e 636d  se, r.type, r.cm
+00082630: 6174 5b3a 2c2d 4c6e 3a5d 2c20 7873 203d  at[:,-Ln:], xs =
+00082640: 2072 2e78 7329 0a20 2020 2020 2020 2020   r.xs).         
+00082650: 2020 2020 2020 2072 676e 5f6e 6577 2e67         rgn_new.g
+00082660: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
+00082670: 2020 2020 2020 2020 2072 5f74 6f5f 6164           r_to_ad
+00082680: 642e 6170 7065 6e64 2872 676e 5f6e 6577  d.append(rgn_new
+00082690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000826a0: 2020 706f 735f 746f 5f61 6464 2e61 7070    pos_to_add.app
+000826b0: 656e 6428 6b2b 3129 0a0a 2020 2020 2020  end(k+1)..      
+000826c0: 2020 2020 2020 2020 2020 2320 7369 5f6c            # si_l
+000826d0: 7374 203d 2066 696e 645f 736e 7028 7365  st = find_snp(se
+000826e0: 715f 6f72 675b 2870 2d31 293a 722e 656e  q_org[(p-1):r.en
+000826f0: 645d 2c20 7267 6e5f 6e65 772e 7365 712c  d], rgn_new.seq,
+00082700: 2072 676e 5f6e 6577 2e67 6574 5f63 7667   rgn_new.get_cvg
+00082710: 2829 2c20 6368 726d 2c20 702c 206f 7365  (), chrm, p, ose
+00082720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00082730: 2020 7369 5f6c 7374 203d 2066 696e 645f    si_lst = find_
+00082740: 736e 7028 7365 715f 6f72 675b 2870 2d31  snp(seq_org[(p-1
+00082750: 293a 722e 656e 645d 2c20 7267 6e5f 6e65  ):r.end], rgn_ne
+00082760: 772e 7365 712c 2072 676e 5f6e 6577 2e63  w.seq, rgn_new.c
+00082770: 6d61 742c 2063 6872 6d2c 2070 2c20 6f73  mat, chrm, p, os
+00082780: 652c 2067 696e 290a 2020 2020 2020 2020  e, gin).        
+00082790: 2020 2020 2020 2020 736e 765f 696e 666f          snv_info
+000827a0: 5f63 6872 203d 2073 6e76 5f69 6e66 6f5f  _chr = snv_info_
+000827b0: 6368 7220 2b20 7369 5f6c 7374 0a20 2020  chr + si_lst.   
+000827c0: 2020 2020 2020 2020 2020 2020 2067 645f               gd_
+000827d0: 6964 7820 3d20 6764 5f69 6478 5f6f 665f  idx = gd_idx_of_
+000827e0: 7267 6e5b 6b5d 0a20 2020 2020 2020 2020  rgn[k].         
+000827f0: 2020 2020 2020 2067 645f 7365 6c5b 6764         gd_sel[gd
+00082800: 5f69 6478 5d2e 6e76 5f69 6e66 6f5f 6c73  _idx].nv_info_ls
+00082810: 7420 3d20 6764 5f73 656c 5b67 645f 6964  t = gd_sel[gd_id
+00082820: 785d 2e6e 765f 696e 666f 5f6c 7374 202b  x].nv_info_lst +
+00082830: 2073 695f 6c73 740a 0a20 2020 2020 2020   si_lst..       
+00082840: 2020 2020 2020 2020 2072 2e65 6e64 203d           r.end =
+00082850: 2070 2d31 2b6f 7373 0a20 2020 2020 2020   p-1+oss.       
+00082860: 2020 2020 2020 2020 2072 2e73 7461 7274           r.start
+00082870: 202b 3d20 6f73 730a 2020 2020 2020 2020   += oss.        
+00082880: 2020 2020 2020 2020 4c6e 203d 2072 2e65          Ln = r.e
+00082890: 6e64 202d 2072 2e73 7461 7274 202b 310a  nd - r.start +1.
+000828a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000828b0: 722e 636d 6174 203d 2072 2e63 6d61 745b  r.cmat = r.cmat[
+000828c0: 3a2c 3a4c 6e5d 0a20 2020 2020 2020 2020  :,:Ln].         
+000828d0: 2020 2020 2020 2072 2e73 6571 203d 2072         r.seq = r
+000828e0: 2e73 6571 5b3a 4c6e 5d0a 2020 2020 2020  .seq[:Ln].      
+000828f0: 2020 2020 2020 2020 2020 722e 6376 6720            r.cvg 
+00082900: 3d20 722e 6376 675b 3a4c 6e5d 0a20 2020  = r.cvg[:Ln].   
+00082910: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+00082920: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
+00082930: 2020 2020 2020 2020 2020 2072 616c 6c2e             rall.
+00082940: 7267 6e73 5b6b 5d20 3d20 7220 2320 2e63  rgns[k] = r # .c
+00082950: 6f70 7928 290a 0a20 2020 2020 2020 2020  opy()..         
+00082960: 2020 2020 2020 2023 2073 695f 6c73 7420         # si_lst 
+00082970: 3d20 6669 6e64 5f73 6e70 2873 6571 5f6f  = find_snp(seq_o
+00082980: 7267 5b28 722e 7374 6172 742d 6f73 732d  rg[(r.start-oss-
+00082990: 3129 3a70 5d2c 2072 2e73 6571 2c20 722e  1):p], r.seq, r.
+000829a0: 6765 745f 6376 6728 292c 2063 6872 6d2c  get_cvg(), chrm,
+000829b0: 2072 2e73 7461 7274 2d6f 7373 2c20 6f73   r.start-oss, os
+000829c0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+000829d0: 2020 2073 695f 6c73 7420 3d20 6669 6e64     si_lst = find
+000829e0: 5f73 6e70 2873 6571 5f6f 7267 5b28 722e  _snp(seq_org[(r.
+000829f0: 7374 6172 742d 6f73 732d 3129 3a70 5d2c  start-oss-1):p],
+00082a00: 2072 2e73 6571 2c20 722e 636d 6174 2c20   r.seq, r.cmat, 
+00082a10: 6368 726d 2c20 722e 7374 6172 742d 6f73  chrm, r.start-os
+00082a20: 732c 206f 7373 2c20 6769 6e29 0a20 2020  s, oss, gin).   
+00082a30: 2020 2020 2020 2020 2020 2020 2073 6e76               snv
+00082a40: 5f69 6e66 6f5f 6368 7220 3d20 736e 765f  _info_chr = snv_
+00082a50: 696e 666f 5f63 6872 202b 2073 695f 6c73  info_chr + si_ls
+00082a60: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00082a70: 2020 6764 5f69 6478 203d 2067 645f 6964    gd_idx = gd_id
+00082a80: 785f 6f66 5f72 676e 5b6b 5d0a 2020 2020  x_of_rgn[k].    
+00082a90: 2020 2020 2020 2020 2020 2020 6764 5f73              gd_s
+00082aa0: 656c 5b67 645f 6964 785d 2e6e 765f 696e  el[gd_idx].nv_in
+00082ab0: 666f 5f6c 7374 203d 2067 645f 7365 6c5b  fo_lst = gd_sel[
+00082ac0: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
+00082ad0: 6c73 7420 2b20 7369 5f6c 7374 0a0a 2020  lst + si_lst..  
+00082ae0: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
+00082af0: 6f73 7320 3e20 6f73 6529 3a20 2320 6465  oss > ose): # de
+00082b00: 6c65 7469 6f6e 2069 6e20 6265 7477 6565  letion in betwee
+00082b10: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+00082b20: 2020 2070 7269 6e74 2827 2020 2025 6920     print('   %i 
+00082b30: 6f73 7320 3e20 6f73 6527 2025 206b 290a  oss > ose' % k).
+00082b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082b50: 2320 722e 7072 696e 745f 7368 6f72 7428  # r.print_short(
+00082b60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00082b70: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
+00082b80: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
+00082b90: 286f 7365 2c20 7072 6576 5f6f 6669 290a  (ose, prev_ofi).
+00082ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082bb0: 4c64 203d 206f 7373 202d 206f 7365 0a0a  Ld = oss - ose..
+00082bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082bd0: 2323 2073 706c 6974 2028 666f 7220 4344  ## split (for CD
+00082be0: 5320 6f6e 6c79 290a 2020 2020 2020 2020  S only).        
+00082bf0: 2020 2020 2020 2020 4c72 203d 2072 2e65          Lr = r.e
+00082c00: 6e64 202d 2072 2e73 7461 7274 202b 310a  nd - r.start +1.
+00082c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082c20: 4c6e 203d 2072 2e65 6e64 202d 2070 202b  Ln = r.end - p +
+00082c30: 2031 202d 204c 640a 2020 2020 2020 2020   1 - Ld.        
+00082c40: 2020 2020 2020 2020 7267 6e5f 6e65 7720          rgn_new 
+00082c50: 3d20 7265 6769 6f6e 2820 722e 6368 722c  = region( r.chr,
+00082c60: 2070 2b4c 642b 6f73 652c 2072 2e65 6e64   p+Ld+ose, r.end
+00082c70: 2b6f 7365 2c20 722e 7479 7065 2c20 722e  +ose, r.type, r.
+00082c80: 636d 6174 5b3a 2c2d 4c6e 3a5d 2c20 7873  cmat[:,-Ln:], xs
+00082c90: 203d 2072 2e78 7329 0a20 2020 2020 2020   = r.xs).       
+00082ca0: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
+00082cb0: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
+00082cc0: 2020 2020 2020 2020 2020 2072 5f74 6f5f             r_to_
+00082cd0: 6164 642e 6170 7065 6e64 2872 676e 5f6e  add.append(rgn_n
+00082ce0: 6577 290a 2020 2020 2020 2020 2020 2020  ew).            
+00082cf0: 2020 2020 706f 735f 746f 5f61 6464 2e61      pos_to_add.a
+00082d00: 7070 656e 6428 6b2b 3129 0a0a 2020 2020  ppend(k+1)..    
+00082d10: 2020 2020 2020 2020 2020 2020 2320 7369              # si
+00082d20: 5f6c 7374 203d 2066 696e 645f 736e 7028  _lst = find_snp(
+00082d30: 7365 715f 6e65 775b 2872 676e 5f6e 6577  seq_new[(rgn_new
+00082d40: 2e73 7461 7274 2d31 293a 7267 6e5f 6e65  .start-1):rgn_ne
+00082d50: 772e 656e 645d 2c20 7267 6e5f 6e65 772e  w.end], rgn_new.
+00082d60: 7365 712c 2072 676e 5f6e 6577 2e67 6574  seq, rgn_new.get
+00082d70: 5f63 7667 2829 2c20 6368 726d 2c20 702c  _cvg(), chrm, p,
+00082d80: 206f 7365 290a 2020 2020 2020 2020 2020   ose).          
+00082d90: 2020 2020 2020 7369 5f6c 7374 203d 2066        si_lst = f
+00082da0: 696e 645f 736e 7028 7365 715f 6e65 775b  ind_snp(seq_new[
+00082db0: 2872 676e 5f6e 6577 2e73 7461 7274 2d31  (rgn_new.start-1
+00082dc0: 293a 7267 6e5f 6e65 772e 656e 645d 2c20  ):rgn_new.end], 
+00082dd0: 7267 6e5f 6e65 772e 7365 712c 2072 676e  rgn_new.seq, rgn
+00082de0: 5f6e 6577 2e63 6d61 742c 2063 6872 6d2c  _new.cmat, chrm,
+00082df0: 2070 2c20 6f73 652c 2067 696e 290a 2020   p, ose, gin).  
+00082e00: 2020 2020 2020 2020 2020 2020 2020 736e                sn
+00082e10: 765f 696e 666f 5f63 6872 203d 2073 6e76  v_info_chr = snv
+00082e20: 5f69 6e66 6f5f 6368 7220 2b20 7369 5f6c  _info_chr + si_l
+00082e30: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
+00082e40: 2020 2067 645f 6964 7820 3d20 6764 5f69     gd_idx = gd_i
+00082e50: 6478 5f6f 665f 7267 6e5b 6b5d 0a20 2020  dx_of_rgn[k].   
+00082e60: 2020 2020 2020 2020 2020 2020 2067 645f               gd_
+00082e70: 7365 6c5b 6764 5f69 6478 5d2e 6e76 5f69  sel[gd_idx].nv_i
+00082e80: 6e66 6f5f 6c73 7420 3d20 6764 5f73 656c  nfo_lst = gd_sel
+00082e90: 5b67 645f 6964 785d 2e6e 765f 696e 666f  [gd_idx].nv_info
+00082ea0: 5f6c 7374 202b 2073 695f 6c73 740a 0a20  _lst + si_lst.. 
+00082eb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00082ec0: 2e65 6e64 203d 2070 2d31 2b6f 7373 0a20  .end = p-1+oss. 
+00082ed0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00082ee0: 2e73 7461 7274 202b 3d20 6f73 730a 2020  .start += oss.  
+00082ef0: 2020 2020 2020 2020 2020 2020 2020 4c6e                Ln
+00082f00: 203d 2072 2e65 6e64 202d 2072 2e73 7461   = r.end - r.sta
+00082f10: 7274 202b 310a 2020 2020 2020 2020 2020  rt +1.          
+00082f20: 2020 2020 2020 722e 636d 6174 203d 2072        r.cmat = r
+00082f30: 2e63 6d61 745b 3a2c 3a4c 6e5d 0a20 2020  .cmat[:,:Ln].   
+00082f40: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
+00082f50: 6571 203d 2072 2e73 6571 5b3a 4c6e 5d0a  eq = r.seq[:Ln].
+00082f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082f70: 722e 6376 6720 3d20 722e 6376 675b 3a4c  r.cvg = r.cvg[:L
+00082f80: 6e5d 0a20 2020 2020 2020 2020 2020 2020  n].             
+00082f90: 2020 2023 2072 2e67 6574 5f63 7667 2829     # r.get_cvg()
+00082fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00082fb0: 2072 616c 6c2e 7267 6e73 5b6b 5d20 3d20   rall.rgns[k] = 
+00082fc0: 7220 2320 2e63 6f70 7928 290a 0a20 2020  r # .copy()..   
+00082fd0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+00082fe0: 695f 6c73 7420 3d20 6669 6e64 5f73 6e70  i_lst = find_snp
+00082ff0: 2873 6571 5f6f 7267 5b28 722e 7374 6172  (seq_org[(r.star
+00083000: 742d 6f73 732d 3129 3a70 5d2c 2072 2e73  t-oss-1):p], r.s
+00083010: 6571 2c20 722e 6765 745f 6376 6728 292c  eq, r.get_cvg(),
+00083020: 2063 6872 6d2c 2072 2e73 7461 7274 2d6f   chrm, r.start-o
+00083030: 7373 2c20 6f73 7329 0a20 2020 2020 2020  ss, oss).       
+00083040: 2020 2020 2020 2020 2073 695f 6c73 7420           si_lst 
+00083050: 3d20 6669 6e64 5f73 6e70 2873 6571 5f6f  = find_snp(seq_o
+00083060: 7267 5b28 722e 7374 6172 742d 6f73 732d  rg[(r.start-oss-
+00083070: 3129 3a70 5d2c 2072 2e73 6571 2c20 722e  1):p], r.seq, r.
+00083080: 636d 6174 2c20 6368 726d 2c20 722e 7374  cmat, chrm, r.st
+00083090: 6172 742d 6f73 732c 206f 7373 2c20 6769  art-oss, oss, gi
+000830a0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+000830b0: 2020 2073 6e76 5f69 6e66 6f5f 6368 7220     snv_info_chr 
+000830c0: 3d20 736e 765f 696e 666f 5f63 6872 202b  = snv_info_chr +
+000830d0: 2073 695f 6c73 740a 2020 2020 2020 2020   si_lst.        
+000830e0: 2020 2020 2020 2020 6764 5f69 6478 203d          gd_idx =
+000830f0: 2067 645f 6964 785f 6f66 5f72 676e 5b6b   gd_idx_of_rgn[k
+00083100: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00083110: 2020 6764 5f73 656c 5b67 645f 6964 785d    gd_sel[gd_idx]
+00083120: 2e6e 765f 696e 666f 5f6c 7374 203d 2067  .nv_info_lst = g
+00083130: 645f 7365 6c5b 6764 5f69 6478 5d2e 6e76  d_sel[gd_idx].nv
+00083140: 5f69 6e66 6f5f 6c73 7420 2b20 7369 5f6c  _info_lst + si_l
+00083150: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
+00083160: 2020 200a 2020 2020 2020 2020 656c 6966     .        elif
+00083170: 2072 2e74 7970 6520 3d3d 2027 696e 7365   r.type == 'inse
+00083180: 7273 696f 6e27 3a0a 0a20 2020 2020 2020  rsion':..       
+00083190: 2020 2020 206f 7373 702c 2070 7265 765f       ossp, prev_
+000831a0: 6f66 3120 3d20 6f66 2e66 696e 645f 6f73  of1 = of.find_os
+000831b0: 5f73 6571 2872 2e73 7461 7274 2d31 2c20  _seq(r.start-1, 
+000831c0: 7072 6576 5f6f 6669 2c20 6d61 726b 203d  prev_ofi, mark =
+000831d0: 2027 4927 290a 0a20 2020 2020 2020 2020   'I')..         
+000831e0: 2020 2073 6f70 203d 2073 6571 5f6f 7267     sop = seq_org
+000831f0: 5b69 6e74 2872 2e73 7461 7274 2d28 4e57  [int(r.start-(NW
+00083200: 494e 2b31 2929 3a69 6e74 2872 2e73 7461  IN+1)):int(r.sta
+00083210: 7274 2d31 295d 0a20 2020 2020 2020 2020  rt-1)].         
+00083220: 2020 2073 6f63 203d 2027 2d27 0a20 2020     soc = '-'.   
+00083230: 2020 2020 2020 2020 2073 6f6e 203d 2073           son = s
+00083240: 6571 5f6f 7267 5b69 6e74 2872 2e73 7461  eq_org[int(r.sta
+00083250: 7274 2d31 293a 696e 7428 722e 7374 6172  rt-1):int(r.star
+00083260: 742b 284e 5749 4e2d 3129 295d 0a20 2020  t+(NWIN-1))].   
+00083270: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00083280: 2020 2020 2020 736e 7020 3d20 7365 715f        snp = seq_
+00083290: 6e65 775b 696e 7428 722e 7374 6172 742b  new[int(r.start+
+000832a0: 6f73 7370 2d28 4e57 494e 2b31 2929 3a69  ossp-(NWIN+1)):i
+000832b0: 6e74 2872 2e73 7461 7274 2b6f 7373 702d  nt(r.start+ossp-
+000832c0: 3129 5d0a 2020 2020 2020 2020 2020 2020  1)].            
+000832d0: 736e 6320 3d20 722e 7365 710a 2020 2020  snc = r.seq.    
+000832e0: 2020 2020 2020 2020 736e 6e20 3d20 7365          snn = se
+000832f0: 715f 6e65 775b 696e 7428 722e 7374 6172  q_new[int(r.star
+00083300: 742b 6f73 732d 3129 3a69 6e74 2872 2e73  t+oss-1):int(r.s
+00083310: 7461 7274 2b6f 7373 2b28 4e57 494e 2d31  tart+oss+(NWIN-1
+00083320: 2929 5d0a 2020 2020 2020 2020 2020 2020  ))].            
+00083330: 7369 203d 2053 4e56 5f69 6e66 6f28 6368  si = SNV_info(ch
+00083340: 726d 2c20 722e 7374 6172 742c 2072 2e73  rm, r.start, r.s
+00083350: 7461 7274 2b6f 7373 2c20 6769 6e5b 305d  tart+oss, gin[0]
+00083360: 2c20 6769 6e5b 315d 2c20 2749 272c 2072  , gin[1], 'I', r
+00083370: 2e67 6574 5f6c 656e 2829 2c20 696e 7428  .get_len(), int(
+00083380: 722e 6176 655f 6376 675f 6465 7074 6828  r.ave_cvg_depth(
+00083390: 2929 2c20 722e 6376 675f 6672 6163 2c20  )), r.cvg_frac, 
+000833a0: 736f 702c 2073 6f63 2c20 736f 6e2c 2073  sop, soc, son, s
+000833b0: 6e70 2c20 736e 632c 2073 6e6e 2029 0a20  np, snc, snn ). 
+000833c0: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
+000833d0: 6e66 6f5f 6368 722e 6170 7065 6e64 2873  nfo_chr.append(s
+000833e0: 6929 0a20 2020 2020 2020 2020 2020 2067  i).            g
+000833f0: 645f 6964 7820 3d20 6764 5f69 6478 5f6f  d_idx = gd_idx_o
+00083400: 665f 7267 6e5b 6b5d 0a20 2020 2020 2020  f_rgn[k].       
+00083410: 2020 2020 2067 645f 7365 6c5b 6764 5f69       gd_sel[gd_i
+00083420: 6478 5d2e 6e76 5f69 6e66 6f5f 6c73 742e  dx].nv_info_lst.
+00083430: 6170 7065 6e64 2873 6929 0a0a 2020 2020  append(si)..    
+00083440: 2020 2020 2020 2020 722e 7374 6172 7420          r.start 
+00083450: 2b3d 206f 7373 700a 2020 2020 2020 2020  += ossp.        
+00083460: 2020 2020 722e 656e 6420 2b3d 206f 7373      r.end += oss
+00083470: 7020 200a 2020 2020 2020 2020 2020 2020  p  .            
+00083480: 7261 6c6c 2e72 676e 735b 6b5d 203d 2072  rall.rgns[k] = r
+00083490: 2023 202e 636f 7079 2829 0a0a 2020 2020   # .copy()..    
+000834a0: 2020 2020 656c 6966 2072 2e74 7970 6520      elif r.type 
+000834b0: 3d3d 2027 6465 6c65 7469 6f6e 273a 0a0a  == 'deletion':..
+000834c0: 2020 2020 2020 2020 2020 2020 6f73 7370              ossp
+000834d0: 2c20 7072 6576 5f6f 6631 203d 206f 662e  , prev_of1 = of.
+000834e0: 6669 6e64 5f6f 735f 7365 7128 722e 7374  find_os_seq(r.st
+000834f0: 6172 742d 312c 2070 7265 765f 6f66 692c  art-1, prev_ofi,
+00083500: 206d 6172 6b20 3d20 2744 2729 0a0a 2020   mark = 'D')..  
+00083510: 2020 2020 2020 2020 2020 736f 7020 3d20            sop = 
+00083520: 7365 715f 6f72 675b 696e 7428 722e 7374  seq_org[int(r.st
+00083530: 6172 742d 284e 5749 4e2b 3129 293a 696e  art-(NWIN+1)):in
+00083540: 7428 722e 7374 6172 742d 3129 5d0a 2020  t(r.start-1)].  
+00083550: 2020 2020 2020 2020 2020 736f 6320 3d20            soc = 
+00083560: 7365 715f 6f72 675b 696e 7428 722e 7374  seq_org[int(r.st
+00083570: 6172 742d 3129 3a69 6e74 2872 2e65 6e64  art-1):int(r.end
+00083580: 295d 0a20 2020 2020 2020 2020 2020 2073  )].            s
+00083590: 6f6e 203d 2073 6571 5f6f 7267 5b69 6e74  on = seq_org[int
+000835a0: 2872 2e65 6e64 293a 696e 7428 722e 656e  (r.end):int(r.en
+000835b0: 642b 284e 5749 4e29 295d 0a20 2020 2020  d+(NWIN))].     
+000835c0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000835d0: 2020 2020 2320 736f 7020 3d20 7261 6c6c      # sop = rall
+000835e0: 2e72 676e 735b 6f64 725b 6d2d 315d 5d2e  .rgns[odr[m-1]].
+000835f0: 7365 715b 2d4e 5749 4e3a 5d0a 2020 2020  seq[-NWIN:].    
+00083600: 2020 2020 2020 2020 736e 7020 3d20 7365          snp = se
+00083610: 715f 6e65 775b 696e 7428 722e 7374 6172  q_new[int(r.star
+00083620: 742b 6f73 7370 2d28 4e57 494e 2b31 2929  t+ossp-(NWIN+1))
+00083630: 3a69 6e74 2872 2e73 7461 7274 2b6f 7373  :int(r.start+oss
+00083640: 702d 3129 5d0a 2020 2020 2020 2020 2020  p-1)].          
+00083650: 2020 736e 6320 3d20 272d 270a 2020 2020    snc = '-'.    
+00083660: 2020 2020 2020 2020 2320 736f 6e20 3d20          # son = 
+00083670: 7261 6c6c 2e72 676e 735b 6f64 725b 6d2b  rall.rgns[odr[m+
+00083680: 315d 5d2e 7365 715b 3a4e 5749 4e5d 0a20  1]].seq[:NWIN]. 
+00083690: 2020 2020 2020 2020 2020 2073 6e6e 203d             snn =
+000836a0: 2073 6571 5f6e 6577 5b69 6e74 2872 2e73   seq_new[int(r.s
+000836b0: 7461 7274 2b6f 7373 702d 3129 3a69 6e74  tart+ossp-1):int
+000836c0: 2872 2e73 7461 7274 2b6f 7373 702b 284e  (r.start+ossp+(N
+000836d0: 5749 4e2d 3129 295d 0a20 2020 2020 2020  WIN-1))].       
+000836e0: 2020 2020 2073 6920 3d20 534e 565f 696e       si = SNV_in
+000836f0: 666f 2863 6872 6d2c 2072 2e73 7461 7274  fo(chrm, r.start
+00083700: 2c20 722e 7374 6172 742b 6f73 732c 2067  , r.start+oss, g
+00083710: 696e 5b30 5d2c 2067 696e 5b31 5d2c 2027  in[0], gin[1], '
+00083720: 4427 2c20 722e 6765 745f 6c65 6e28 292c  D', r.get_len(),
+00083730: 2069 6e74 2872 2e61 7665 5f63 7667 5f64   int(r.ave_cvg_d
+00083740: 6570 7468 2829 292c 2072 2e63 7667 5f66  epth()), r.cvg_f
+00083750: 7261 632c 2073 6f70 2c20 736f 632c 2073  rac, sop, soc, s
+00083760: 6f6e 2c20 736e 702c 2073 6e63 2c20 736e  on, snp, snc, sn
+00083770: 6e20 290a 2020 2020 2020 2020 2020 2020  n ).            
+00083780: 736e 765f 696e 666f 5f63 6872 2e61 7070  snv_info_chr.app
+00083790: 656e 6428 7369 290a 2020 2020 2020 2020  end(si).        
+000837a0: 2020 2020 6764 5f69 6478 203d 2067 645f      gd_idx = gd_
+000837b0: 6964 785f 6f66 5f72 676e 5b6b 5d0a 2020  idx_of_rgn[k].  
+000837c0: 2020 2020 2020 2020 2020 6764 5f73 656c            gd_sel
+000837d0: 5b67 645f 6964 785d 2e6e 765f 696e 666f  [gd_idx].nv_info
+000837e0: 5f6c 7374 2e61 7070 656e 6428 7369 290a  _lst.append(si).
+000837f0: 0a20 2020 2020 2020 2020 2020 2072 2e73  .            r.s
+00083800: 7461 7274 202b 3d20 6f73 7370 0a20 2020  tart += ossp.   
+00083810: 2020 2020 2020 2020 2072 2e65 6e64 202b           r.end +
+00083820: 3d20 6f73 7370 2020 200a 2020 2020 2020  = ossp   .      
+00083830: 2020 2020 2020 7261 6c6c 2e72 676e 735b        rall.rgns[
+00083840: 6b5d 203d 2072 2023 202e 636f 7079 2829  k] = r # .copy()
+00083850: 0a0a 2020 2020 2020 2020 7072 6576 5f6f  ..        prev_o
+00083860: 6669 203d 2070 7265 765f 6f66 310a 0a20  fi = prev_of1.. 
+00083870: 2020 2065 6c61 7073 6564 5f74 696d 6520     elapsed_time 
+00083880: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
+00083890: 7374 6172 745f 7469 6d65 0a20 2020 2023  start_time.    #
+000838a0: 2070 7269 6e74 2827 2020 2033 2e20 646f   print('   3. do
+000838b0: 6e65 2028 2569 2920 2025 6927 2025 2028  ne (%i)  %i' % (
+000838c0: 656c 6170 7365 645f 7469 6d65 2c20 6c65  elapsed_time, le
+000838d0: 6e28 6f66 2e6f 7369 5f6c 7374 2929 2c20  n(of.osi_lst)), 
+000838e0: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
+000838f0: 2020 0a20 2020 206e 765f 6c73 7420 3d20    .    nv_lst = 
+00083900: 5b5d 0a20 2020 2063 6e74 5f65 203d 2030  [].    cnt_e = 0
+00083910: 0a20 2020 2066 6f72 2067 6420 696e 2067  .    for gd in g
+00083920: 645f 7365 6c3a 0a20 2020 2020 2020 2066  d_sel:.        f
+00083930: 6f72 2074 6420 696e 2067 642e 7464 5f6c  or td in gd.td_l
+00083940: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00083950: 7464 2e67 6574 5f6f 7267 5f63 6f64 696e  td.get_org_codin
+00083960: 675f 7365 7128 2067 642e 6364 732e 7267  g_seq( gd.cds.rg
+00083970: 6e73 2c20 7365 715f 6f72 6720 290a 2020  ns, seq_org ).  
+00083980: 2020 2020 2020 6e76 5f6c 7374 5f74 6d70        nv_lst_tmp
+00083990: 2c20 636e 745f 6520 3d20 6764 2e67 6574  , cnt_e = gd.get
+000839a0: 5f67 656e 655f 6c65 7665 6c5f 6e76 5f69  _gene_level_nv_i
+000839b0: 6e66 6f28 636e 745f 6529 0a20 2020 2020  nfo(cnt_e).     
+000839c0: 2020 206e 765f 6c73 7420 3d20 6e76 5f6c     nv_lst = nv_l
+000839d0: 7374 202b 206e 765f 6c73 745f 746d 700a  st + nv_lst_tmp.
+000839e0: 2020 2020 736e 765f 696e 666f 5f63 6872      snv_info_chr
+000839f0: 203d 206e 765f 6c73 740a 2020 2020 2020   = nv_lst.      
+00083a00: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
+00083a10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083a20: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00083a30: 2070 7574 2072 676e 7320 6261 636b 2074   put rgns back t
+00083a40: 6f20 6764 5f73 656c 0a20 2020 2023 2320  o gd_sel.    ## 
+00083a50: 616e 6420 616c 736f 2061 6464 206e 6577  and also add new
+00083a60: 2072 676e 7320 0a0a 2020 2020 7374 6172   rgns ..    star
+00083a70: 745f 7469 6d65 203d 2074 696d 652e 7469  t_time = time.ti
+00083a80: 6d65 2829 0a20 2020 2070 6f73 5f74 6f5f  me().    pos_to_
+00083a90: 6164 6420 3d20 6e70 2e61 7272 6179 2870  add = np.array(p
+00083aa0: 6f73 5f74 6f5f 6164 6429 0a20 2020 2066  os_to_add).    f
+00083ab0: 6f72 206b 2c20 6764 2069 6e20 656e 756d  or k, gd in enum
+00083ac0: 6572 6174 6528 6764 5f73 656c 293a 200a  erate(gd_sel): .
+00083ad0: 0a20 2020 2020 2020 2070 3120 3d20 696e  .        p1 = in
+00083ae0: 7428 6c6f 635f 6f73 5b6b 5d29 0a20 2020  t(loc_os[k]).   
+00083af0: 2020 2020 2070 3220 3d20 696e 7428 7031       p2 = int(p1
+00083b00: 202b 206e 756d 5f6f 735b 6b5d 290a 2020   + num_os[k]).  
+00083b10: 2020 2020 2020 2320 6764 2e65 786f 6e73        # gd.exons
+00083b20: 2e72 676e 7320 3d20 7261 6c6c 2e72 676e  .rgns = rall.rgn
+00083b30: 735b 7031 3a70 325d 0a20 2020 2020 2020  s[p1:p2].       
+00083b40: 2067 642e 6578 6f6e 732e 7267 6e73 203d   gd.exons.rgns =
+00083b50: 205b 7261 6c6c 2e72 676e 735b 7031 2b6d   [rall.rgns[p1+m
+00083b60: 5d20 666f 7220 6d20 696e 2072 616e 6765  ] for m in range
+00083b70: 2870 322d 7031 295d 0a20 2020 2020 2020  (p2-p1)].       
+00083b80: 2077 6820 3d20 7768 6963 6828 2028 706f   wh = which( (po
+00083b90: 735f 746f 5f61 6464 203e 3d20 7031 2920  s_to_add >= p1) 
+00083ba0: 2620 2870 6f73 5f74 6f5f 6164 6420 3c20  & (pos_to_add < 
+00083bb0: 7032 2920 290a 2020 2020 2020 2020 6966  p2) ).        if
+00083bc0: 206c 656e 2877 6829 203e 2030 3a0a 2020   len(wh) > 0:.  
+00083bd0: 2020 2020 2020 2020 2020 666f 7220 7720            for w 
+00083be0: 696e 2077 683a 2067 642e 6578 6f6e 732e  in wh: gd.exons.
+00083bf0: 7267 6e73 2e61 7070 656e 6428 725f 746f  rgns.append(r_to
+00083c00: 5f61 6464 5b77 5d29 0a0a 2020 2020 2323  _add[w])..    ##
+00083c10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083c20: 2323 2323 230a 2020 2020 2323 2072 656d  #####.    ## rem
+00083c30: 6f76 6520 6964 656c 6574 696f 6e20 0a20  ove ideletion . 
+00083c40: 2020 2023 2320 636f 6d62 696e 6520 7469     ## combine ti
+00083c50: 6c65 6420 6578 6f6e 730a 2020 2020 0a20  led exons.    . 
+00083c60: 2020 2066 6f72 2067 6420 696e 2067 645f     for gd in gd_
+00083c70: 7365 6c3a 0a20 2020 2020 2020 2067 642e  sel:.        gd.
+00083c80: 7265 6d6f 7665 5f69 6e64 656c 5f61 6e64  remove_indel_and
+00083c90: 5f63 6f6d 6269 6e65 5f66 7261 6773 2829  _combine_frags()
+00083ca0: 0a0a 2020 2020 2327 2727 0a20 2020 2065  ..    #'''.    e
+00083cb0: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
+00083cc0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+00083cd0: 745f 7469 6d65 0a20 2020 2023 2070 7269  t_time.    # pri
+00083ce0: 6e74 2827 2020 2033 622e 2064 6f6e 6520  nt('   3b. done 
+00083cf0: 2825 6929 2020 2720 2520 2865 6c61 7073  (%i)  ' % (elaps
+00083d00: 6564 5f74 696d 6529 2c20 666c 7573 6820  ed_time), flush 
+00083d10: 3d20 5472 7565 290a 2020 2020 0a0a 2020  = True).    ..  
+00083d20: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+00083d30: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
+00083d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083d50: 2323 2323 2323 230a 2020 2020 2323 2063  #######.    ## c
+00083d60: 6f64 696e 6720 7265 6769 6f6e 2075 7064  oding region upd
+00083d70: 6174 650a 0a20 2020 2073 7461 7274 5f74  ate..    start_t
+00083d80: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+00083d90: 290a 2020 2020 0a20 2020 2023 2320 636f  ).    .    ## co
+00083da0: 6c6c 6563 7420 7267 6e73 2061 6e64 206d  llect rgns and m
+00083db0: 6172 6b20 7468 6569 7220 706f 730a 2020  ark their pos.  
+00083dc0: 2020 6c6f 635f 6f73 203d 206e 702e 7a65    loc_os = np.ze
+00083dd0: 726f 7328 6e5f 6764 290a 2020 2020 6e75  ros(n_gd).    nu
+00083de0: 6d5f 6f73 203d 206e 702e 7a65 726f 7328  m_os = np.zeros(
+00083df0: 6e5f 6764 2c64 7479 7065 3d6e 702e 666c  n_gd,dtype=np.fl
+00083e00: 6f61 7433 3229 0a20 2020 2063 616c 6c20  oat32).    call 
+00083e10: 3d20 7265 6769 6f6e 7328 290a 2020 2020  = regions().    
+00083e20: 6f73 5f63 7572 203d 2030 0a20 2020 2063  os_cur = 0.    c
+00083e30: 5f70 6f73 203d 205b 5d0a 2020 2020 666f  _pos = [].    fo
+00083e40: 7220 6b2c 2067 6420 696e 2065 6e75 6d65  r k, gd in enume
+00083e50: 7261 7465 2867 645f 7365 6c29 3a0a 2020  rate(gd_sel):.  
+00083e60: 2020 2020 2020 6c6f 635f 6f73 5b6b 5d20        loc_os[k] 
+00083e70: 3d20 6f73 5f63 7572 0a20 2020 2020 2020  = os_cur.       
+00083e80: 206e 756d 5f6f 735b 6b5d 203d 206c 656e   num_os[k] = len
+00083e90: 2867 642e 6364 732e 7267 6e73 290a 2020  (gd.cds.rgns).  
+00083ea0: 2020 2020 2020 6361 6c6c 2e72 676e 7320        call.rgns 
+00083eb0: 3d20 6361 6c6c 2e72 676e 7320 2b20 6764  = call.rgns + gd
+00083ec0: 2e63 6473 2e72 676e 730a 2020 2020 2020  .cds.rgns.      
+00083ed0: 2020 6f73 5f63 7572 202b 3d20 6c65 6e28    os_cur += len(
+00083ee0: 6764 2e63 6473 2e72 676e 7329 0a0a 2020  gd.cds.rgns)..  
+00083ef0: 2020 2020 2020 666f 7220 7220 696e 2067        for r in g
+00083f00: 642e 6364 732e 7267 6e73 3a0a 2020 2020  d.cds.rgns:.    
+00083f10: 2020 2020 2020 2020 635f 706f 732e 6170          c_pos.ap
+00083f20: 7065 6e64 2872 2e73 7461 7274 290a 0a20  pend(r.start).. 
+00083f30: 2020 2023 2320 6765 7420 6f72 6465 7220     ## get order 
+00083f40: 6163 636f 7264 696e 6720 746f 206c 6f63  according to loc
+00083f50: 6174 696f 6e0a 2020 2020 635f 706f 7320  ation.    c_pos 
+00083f60: 3d20 6e70 2e61 7272 6179 2863 5f70 6f73  = np.array(c_pos
+00083f70: 290a 2020 2020 6f64 7220 3d20 635f 706f  ).    odr = c_po
+00083f80: 732e 6172 6773 6f72 7428 290a 0a20 2020  s.argsort()..   
+00083f90: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
 00083fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083fb0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00083fc0: 2323 2055 7365 206f 6666 7365 745f 6669  ## Use offset_fi
-00083fd0: 6e64 6572 2074 6f20 636f 7272 6563 7420  nder to correct 
-00083fe0: 706f 7369 7469 6f6e 7320 696e 2047 5446  positions in GTF
-00083ff0: 2065 6e74 7269 6573 0a20 2020 2023 2320   entries.    ## 
-00084000: 616c 736f 2067 6574 2072 676e 7320 6672  also get rgns fr
-00084010: 6167 6d65 6e74 7320 7768 656e 2073 706c  agments when spl
-00084020: 6974 2069 7320 7265 7175 6972 6564 0a0a  it is required..
-00084030: 2020 2020 635f 746f 5f61 6464 203d 205b      c_to_add = [
-00084040: 5d0a 2020 2020 706f 735f 746f 5f61 6464  ].    pos_to_add
-00084050: 203d 205b 5d0a 0a20 2020 2070 7265 765f   = []..    prev_
-00084060: 6f66 6920 3d20 300a 2020 2020 2320 666f  ofi = 0.    # fo
-00084070: 7220 6b2c 2072 2069 6e20 656e 756d 6572  r k, r in enumer
-00084080: 6174 6528 6361 6c6c 2e72 676e 7329 3a0a  ate(call.rgns):.
-00084090: 2020 2020 666f 7220 6d2c 206b 2069 6e20      for m, k in 
-000840a0: 656e 756d 6572 6174 6528 6f64 7229 3a0a  enumerate(odr):.
-000840b0: 2020 2020 2020 2020 7220 3d20 6361 6c6c          r = call
-000840c0: 2e72 676e 735b 6b5d 0a20 2020 2020 2020  .rgns[k].       
-000840d0: 200a 2020 2020 2020 2020 2320 6f73 7320   .        # oss 
-000840e0: 3d20 6f66 2e66 696e 645f 6f73 2872 2e73  = of.find_os(r.s
-000840f0: 7461 7274 290a 2020 2020 2020 2020 2320  tart).        # 
-00084100: 6f73 6520 3d20 6f66 2e66 696e 645f 6f73  ose = of.find_os
-00084110: 2872 2e65 6e64 290a 2020 2020 2020 2020  (r.end).        
-00084120: 6f73 732c 2070 7265 765f 6f66 3120 3d20  oss, prev_of1 = 
-00084130: 6f66 2e66 696e 645f 6f73 5f73 6571 2872  of.find_os_seq(r
-00084140: 2e73 7461 7274 2c20 7072 6576 5f6f 6669  .start, prev_ofi
-00084150: 2c20 6d61 726b 203d 2027 4227 290a 2020  , mark = 'B').  
-00084160: 2020 2020 2020 6f73 652c 2070 7265 765f        ose, prev_
-00084170: 6f66 3220 3d20 6f66 2e66 696e 645f 6f73  of2 = of.find_os
-00084180: 5f73 6571 2872 2e65 6e64 2c20 7072 6576  _seq(r.end, prev
-00084190: 5f6f 6669 2c20 6d61 726b 203d 2027 4327  _ofi, mark = 'C'
-000841a0: 290a 2020 2020 2020 2020 7072 6576 5f6f  ).        prev_o
-000841b0: 6669 203d 2070 7265 765f 6f66 310a 0a20  fi = prev_of1.. 
-000841c0: 2020 2020 2020 2069 6620 2872 2e74 7970         if (r.typ
-000841d0: 652e 6c6f 7765 7228 2920 3d3d 2027 7374  e.lower() == 'st
-000841e0: 6172 745f 636f 646f 6e27 2920 7c20 2872  art_codon') | (r
-000841f0: 2e74 7970 652e 6c6f 7765 7228 2920 3d3d  .type.lower() ==
-00084200: 2027 7374 6f70 5f63 6f64 6f6e 2729 3a0a   'stop_codon'):.
-00084210: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
-00084220: 6172 7420 2b3d 206f 7373 0a20 2020 2020  art += oss.     
-00084230: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
-00084240: 6f73 7320 2020 0a20 2020 2020 2020 2020  oss   .         
-00084250: 2020 2063 616c 6c2e 7267 6e73 5b6b 5d20     call.rgns[k] 
-00084260: 3d20 722e 636f 7079 2875 7064 6174 653d  = r.copy(update=
-00084270: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
-00084280: 656c 7365 3a20 2023 2043 4453 2c20 6669  else:  # CDS, fi
-00084290: 7665 5f70 7269 6d65 5f75 7472 2c20 7468  ve_prime_utr, th
-000842a0: 7265 655f 7072 696d 655f 7574 722c 202e  ree_prime_utr, .
-000842b0: 2e2e 0a20 2020 2020 2020 2020 2020 2069  ...            i
-000842c0: 6620 286f 7373 203d 3d20 6f73 6529 3a0a  f (oss == ose):.
-000842d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000842e0: 722e 7374 6172 7420 2b3d 206f 7373 0a20  r.start += oss. 
-000842f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00084300: 2e65 6e64 202b 3d20 6f73 650a 2020 2020  .end += ose.    
-00084310: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00084320: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
-00084330: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
-00084340: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00084350: 6620 286f 7373 203c 206f 7365 293a 2023  f (oss < ose): #
-00084360: 2049 6e73 6572 7369 6f6e 206f 7220 6465   Insersion or de
-00084370: 6c65 7469 6f6e 2069 6e20 6265 7477 6565  letion in betwee
-00084380: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
-00084390: 2020 2023 2070 7269 6e74 2827 2020 2025     # print('   %
-000843a0: 6920 6f73 7320 3c20 6f73 6527 2025 206b  i oss < ose' % k
-000843b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000843c0: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
-000843d0: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
-000843e0: 2872 2e65 6e64 2c20 7072 6576 5f6f 6669  (r.end, prev_ofi
-000843f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00084400: 2020 2023 2320 7370 6c69 740a 2020 2020     ## split.    
-00084410: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
-00084420: 6e65 7720 3d20 7265 6769 6f6e 2820 722e  new = region( r.
-00084430: 6368 722c 2070 2b6f 7365 2c20 722e 656e  chr, p+ose, r.en
-00084440: 642b 6f73 652c 2072 2e74 7970 652c 2078  d+ose, r.type, x
-00084450: 7320 3d20 722e 7873 290a 2020 2020 2020  s = r.xs).      
-00084460: 2020 2020 2020 2020 2020 635f 746f 5f61            c_to_a
-00084470: 6464 2e61 7070 656e 6428 7267 6e5f 6e65  dd.append(rgn_ne
-00084480: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
-00084490: 2020 2070 6f73 5f74 6f5f 6164 642e 6170     pos_to_add.ap
-000844a0: 7065 6e64 286b 2b31 290a 0a20 2020 2020  pend(k+1)..     
-000844b0: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
-000844c0: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
-000844d0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
-000844e0: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
-000844f0: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
-00084500: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
-00084510: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
-00084520: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00084530: 286f 7373 203e 206f 7365 293a 2023 2064  (oss > ose): # d
-00084540: 656c 6574 696f 6e20 696e 2062 6574 7765  eletion in betwe
-00084550: 656e 0a0a 2020 2020 2020 2020 2020 2020  en..            
-00084560: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
-00084570: 2569 206f 7373 203e 206f 7365 2720 2520  %i oss > ose' % 
-00084580: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
-00084590: 2020 2070 2c20 7072 6576 5f6f 6632 203d     p, prev_of2 =
-000845a0: 206f 662e 6765 745f 626e 6472 795f 7365   of.get_bndry_se
-000845b0: 7128 722e 656e 642c 2070 7265 765f 6f66  q(r.end, prev_of
-000845c0: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
-000845d0: 2020 204c 6420 3d20 6f73 7320 2d20 6f73     Ld = oss - os
-000845e0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-000845f0: 2020 2023 2320 7370 6c69 7420 2866 6f72     ## split (for
-00084600: 2043 4453 206f 6e6c 7929 0a20 2020 2020   CDS only).     
-00084610: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
-00084620: 6577 203d 2072 6567 696f 6e28 2072 2e63  ew = region( r.c
-00084630: 6872 2c20 702b 4c64 2b6f 7365 2c20 722e  hr, p+Ld+ose, r.
-00084640: 656e 642b 6f73 652c 2072 2e74 7970 652c  end+ose, r.type,
-00084650: 2078 7320 3d20 722e 7873 290a 2020 2020   xs = r.xs).    
-00084660: 2020 2020 2020 2020 2020 2020 635f 746f              c_to
-00084670: 5f61 6464 2e61 7070 656e 6428 7267 6e5f  _add.append(rgn_
-00084680: 6e65 7729 0a20 2020 2020 2020 2020 2020  new).           
-00084690: 2020 2020 2070 6f73 5f74 6f5f 6164 642e       pos_to_add.
-000846a0: 6170 7065 6e64 286b 2b31 290a 0a20 2020  append(k+1)..   
-000846b0: 2020 2020 2020 2020 2020 2020 2072 2e65               r.e
-000846c0: 6e64 203d 2070 2d31 2b6f 7373 0a20 2020  nd = p-1+oss.   
-000846d0: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
-000846e0: 7461 7274 202b 3d20 6f73 730a 2020 2020  tart += oss.    
-000846f0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00084700: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
-00084710: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
-00084720: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
-00084730: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00084740: 2020 2020 2323 2070 7574 2072 676e 7320      ## put rgns 
-00084750: 6261 636b 2074 6f20 6764 5f73 656c 0a20  back to gd_sel. 
-00084760: 2020 2023 2320 616e 6420 616c 736f 2061     ## and also a
-00084770: 6464 206e 6577 2072 676e 7320 0a0a 2020  dd new rgns ..  
-00084780: 2020 706f 735f 746f 5f61 6464 203d 206e    pos_to_add = n
-00084790: 702e 6172 7261 7928 706f 735f 746f 5f61  p.array(pos_to_a
-000847a0: 6464 290a 2020 2020 666f 7220 6b2c 2067  dd).    for k, g
-000847b0: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
-000847c0: 645f 7365 6c29 3a20 0a0a 2020 2020 2020  d_sel): ..      
-000847d0: 2020 7031 203d 2069 6e74 286c 6f63 5f6f    p1 = int(loc_o
-000847e0: 735b 6b5d 290a 2020 2020 2020 2020 7032  s[k]).        p2
-000847f0: 203d 2069 6e74 2870 3120 2b20 6e75 6d5f   = int(p1 + num_
-00084800: 6f73 5b6b 5d29 0a20 2020 2020 2020 2067  os[k]).        g
-00084810: 642e 6364 732e 7267 6e73 203d 205b 6361  d.cds.rgns = [ca
-00084820: 6c6c 2e72 676e 735b 7031 2b6d 5d20 666f  ll.rgns[p1+m] fo
-00084830: 7220 6d20 696e 2072 616e 6765 2870 322d  r m in range(p2-
-00084840: 7031 295d 0a20 2020 2020 2020 2077 6820  p1)].        wh 
-00084850: 3d20 7768 6963 6828 2028 706f 735f 746f  = which( (pos_to
-00084860: 5f61 6464 203e 3d20 7031 2920 2620 2870  _add >= p1) & (p
-00084870: 6f73 5f74 6f5f 6164 6420 3c20 7032 2920  os_to_add < p2) 
-00084880: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00084890: 2877 6829 203e 2030 3a0a 2020 2020 2020  (wh) > 0:.      
-000848a0: 2020 2020 2020 666f 7220 7720 696e 2077        for w in w
-000848b0: 683a 2067 642e 6364 732e 7267 6e73 2e61  h: gd.cds.rgns.a
-000848c0: 7070 656e 6428 635f 746f 5f61 6464 5b77  ppend(c_to_add[w
-000848d0: 5d29 0a0a 2020 2020 656c 6170 7365 645f  ])..    elapsed_
-000848e0: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-000848f0: 2829 202d 2073 7461 7274 5f74 696d 650a  () - start_time.
-00084900: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
-00084910: 342e 2064 6f6e 6520 2825 6929 2020 2720  4. done (%i)  ' 
-00084920: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
-00084930: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-00084940: 2020 2020 0a20 2020 2023 2323 2323 2323      .    #######
-00084950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00084960: 230a 2020 2020 2323 2063 6f64 696e 6720  #.    ## coding 
-00084970: 7265 6769 6f6e 2075 7064 6174 650a 2020  region update.  
-00084980: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-00084990: 2323 2323 2323 2323 2323 0a0a 2020 2020  ##########..    
-000849a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000849b0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
-000849c0: 496e 7465 6772 6974 7920 6368 6563 6b0a  Integrity check.
-000849d0: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
-000849e0: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-000849f0: 290a 2020 2020 6e5f 6261 7365 735f 746f  ).    n_bases_to
-00084a00: 7461 6c20 3d20 300a 2020 2020 6e5f 6572  tal = 0.    n_er
-00084a10: 5f62 6173 6573 203d 2030 0a20 2020 206e  _bases = 0.    n
-00084a20: 5f62 6c6b 5f74 6f74 616c 203d 2030 0a20  _blk_total = 0. 
-00084a30: 2020 206e 5f65 725f 626c 6b20 3d20 300a     n_er_blk = 0.
-00084a40: 2020 2020 6e70 6520 3d20 300a 2020 2020      npe = 0.    
-00084a50: 6e70 7420 3d20 300a 2020 2020 666f 7220  npt = 0.    for 
-00084a60: 6764 2069 6e20 6764 5f73 656c 3a0a 2020  gd in gd_sel:.  
-00084a70: 2020 2020 2020 666f 7220 7220 696e 2067        for r in g
-00084a80: 642e 6578 6f6e 732e 7267 6e73 3a0a 2020  d.exons.rgns:.  
-00084a90: 2020 2020 2020 2020 2020 6966 2072 2e74            if r.t
-00084aa0: 7970 6520 213d 2027 6465 6c65 7469 6f6e  ype != 'deletion
-00084ab0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00084ac0: 2020 2073 3120 3d20 722e 7365 710a 2020     s1 = r.seq.  
-00084ad0: 2020 2020 2020 2020 2020 2020 2020 7332                s2
-00084ae0: 203d 2073 6571 5f6e 6577 5b28 722e 7374   = seq_new[(r.st
-00084af0: 6172 742d 3129 3a72 2e65 6e64 5d20 2320  art-1):r.end] # 
-00084b00: 6765 6e6f 6d65 5b72 2e63 6872 5d2e 7365  genome[r.chr].se
-00084b10: 715b 2872 2e73 7461 7274 2d31 293a 722e  q[(r.start-1):r.
-00084b20: 656e 645d 0a20 2020 2020 2020 2020 2020  end].           
-00084b30: 2020 2020 206e 5f65 7220 3d20 636f 6d70       n_er = comp
-00084b40: 6172 655f 7365 7132 2820 7331 2c20 7332  are_seq2( s1, s2
-00084b50: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00084b60: 2020 2023 2069 6620 6e5f 6572 203e 2030     # if n_er > 0
-00084b70: 3a20 7072 696e 7428 275c 6e53 313a 2025  : print('\nS1: %
-00084b80: 735c 6e53 323a 2025 7327 2025 2028 7331  s\nS2: %s' % (s1
-00084b90: 2c73 3229 290a 2020 2020 2020 2020 2020  ,s2)).          
-00084ba0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00084bb0: 2020 2020 2020 2020 2020 206e 5f62 6173             n_bas
-00084bc0: 6573 5f74 6f74 616c 202b 3d20 6c65 6e28  es_total += len(
-00084bd0: 7331 290a 2020 2020 2020 2020 2020 2020  s1).            
-00084be0: 2020 2020 6e5f 6572 5f62 6173 6573 202b      n_er_bases +
-00084bf0: 3d20 6e5f 6572 0a20 2020 2020 2020 2020  = n_er.         
-00084c00: 2020 2020 2020 206e 5f62 6c6b 5f74 6f74         n_blk_tot
-00084c10: 616c 202b 3d20 310a 2020 2020 2020 2020  al += 1.        
-00084c20: 2020 2020 2020 2020 6966 206e 5f65 7220          if n_er 
-00084c30: 3e20 303a 206e 5f65 725f 626c 6b20 2b3d  > 0: n_er_blk +=
-00084c40: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00084c50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00084c60: 6e74 722c 206e 7072 2c20 6e65 7220 3d20  ntr, npr, ner = 
-00084c70: 6764 2e75 7064 6174 655f 7464 5f69 6e66  gd.update_td_inf
-00084c80: 6f28 7365 6c20 3d20 312c 2070 6570 7469  o(sel = 1, pepti
-00084c90: 6465 203d 2054 7275 6529 0a20 2020 2020  de = True).     
-00084ca0: 2020 206e 652c 206e 7420 3d20 6764 2e63     ne, nt = gd.c
-00084cb0: 6f6d 7061 7265 5f73 6571 735f 6672 6f6d  ompare_seqs_from
-00084cc0: 5f63 6473 5f61 6e64 5f67 656e 6f6d 6528  _cds_and_genome(
-00084cd0: 7365 715f 6e65 7729 2023 2067 656e 6f6d  seq_new) # genom
-00084ce0: 655b 6764 2e63 6872 5d2e 7365 7129 0a20  e[gd.chr].seq). 
-00084cf0: 2020 2020 2020 206e 7065 202b 3d20 6e65         npe += ne
-00084d00: 0a20 2020 2020 2020 206e 7074 202b 3d20  .        npt += 
-00084d10: 6e74 0a0a 2020 2020 2020 2020 2320 6966  nt..        # if
-00084d20: 206e 6572 203e 2030 3a20 7072 696e 7428   ner > 0: print(
-00084d30: 2749 6e74 6567 7269 7479 2063 6865 636b  'Integrity check
-00084d40: 2065 7272 6f72 2041 2069 6e20 2573 3a20   error A in %s: 
-00084d50: 2569 202d 2025 692f 2569 2c20 2569 2f25  %i - %i/%i, %i/%
-00084d60: 692c 2025 692f 2569 2720 2520 2863 6872  i, %i/%i' % (chr
-00084d70: 6d2c 206e 6572 2c20 6e5f 6572 5f62 6173  m, ner, n_er_bas
-00084d80: 6573 2c20 6e5f 6261 7365 735f 746f 7461  es, n_bases_tota
-00084d90: 6c2c 206e 5f65 725f 626c 6b2c 206e 5f62  l, n_er_blk, n_b
-00084da0: 6c6b 5f74 6f74 616c 2c20 6e70 652c 206e  lk_total, npe, n
-00084db0: 7074 2920 290a 2020 2020 2020 2020 2320  pt) ).        # 
-00084dc0: 6966 206e 5f65 7220 3e20 303a 2070 7269  if n_er > 0: pri
-00084dd0: 6e74 2827 496e 7465 6772 6974 7920 6368  nt('Integrity ch
-00084de0: 6563 6b20 6572 726f 7220 696e 2025 733a  eck error in %s:
-00084df0: 2025 6920 2d20 2569 2f25 692c 2025 692f   %i - %i/%i, %i/
-00084e00: 2569 2c20 2569 2f25 6927 2025 2028 6368  %i, %i/%i' % (ch
-00084e10: 726d 2c20 6e5f 6572 2c20 6e5f 6572 5f62  rm, n_er, n_er_b
-00084e20: 6173 6573 2c20 6e5f 6261 7365 735f 746f  ases, n_bases_to
-00084e30: 7461 6c2c 206e 5f65 725f 626c 6b2c 206e  tal, n_er_blk, n
-00084e40: 5f62 6c6b 5f74 6f74 616c 2c20 6e70 652c  _blk_total, npe,
-00084e50: 206e 7074 2920 290a 0a20 2020 2065 6c61   npt) )..    ela
-00084e60: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
-00084e70: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-00084e80: 7469 6d65 0a20 2020 2023 2070 7269 6e74  time.    # print
-00084e90: 2827 2020 2035 2e20 646f 6e65 2028 2569  ('   5. done (%i
-00084ea0: 2920 2027 2025 2028 656c 6170 7365 645f  )  ' % (elapsed_
-00084eb0: 7469 6d65 292c 2066 6c75 7368 203d 2054  time), flush = T
-00084ec0: 7275 6529 0a20 2020 200a 2020 2020 6573  rue).    .    es
-00084ed0: 7461 7420 3d20 286e 5f62 6173 6573 5f74  tat = (n_bases_t
-00084ee0: 6f74 616c 2c20 6e5f 6572 5f62 6173 6573  otal, n_er_bases
-00084ef0: 2c20 6e5f 626c 6b5f 746f 7461 6c2c 206e  , n_blk_total, n
-00084f00: 5f65 725f 626c 6b2c 206e 7074 2c20 6e70  _er_blk, npt, np
-00084f10: 6529 0a20 2020 200a 2020 2020 7265 7475  e).    .    retu
-00084f20: 726e 2067 645f 7365 6c2c 2073 6571 5f6e  rn gd_sel, seq_n
-00084f30: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
-00084f40: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
-00084f50: 740a 0a27 2727 0a4e 565f 696e 666f 5f65  t..'''.NV_info_e
-00084f60: 7874 5f74 7220 3d20 636f 6c6c 6563 7469  xt_tr = collecti
-00084f70: 6f6e 732e 6e61 6d65 6474 7570 6c65 2827  ons.namedtuple('
-00084f80: 4e56 5f69 6e66 6f5f 6578 745f 7472 272c  NV_info_ext_tr',
-00084f90: 2027 6368 722c 2070 6f73 5f72 6566 2c20   'chr, pos_ref, 
-00084fa0: 706f 735f 6e65 772c 2067 656e 655f 6964  pos_new, gene_id
-00084fb0: 2c20 6765 6e65 5f6e 616d 652c 2076 5f74  , gene_name, v_t
-00084fc0: 7970 652c 2076 5f6c 656e 2c20 6376 675f  ype, v_len, cvg_
-00084fd0: 6465 7074 682c 2063 7667 5f66 7261 632c  depth, cvg_frac,
-00084fe0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00084ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085000: 2020 2020 2072 6566 5f70 7265 762c 2072       ref_prev, r
-00085010: 6566 5f73 6571 2c20 7265 665f 6e65 7874  ef_seq, ref_next
-00085020: 2c20 616c 745f 7072 6576 2c20 616c 745f  , alt_prev, alt_
-00085030: 7365 712c 2061 6c74 5f6e 6578 742c 2076  seq, alt_next, v
-00085040: 5f63 6c61 7373 2c20 5c0a 2020 2020 2020  _class, \.      
-00085050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085060: 2020 2020 2020 2020 2020 2020 765f 636c              v_cl
-00085070: 6173 735f 7472 2c20 7374 7261 6e64 2c20  ass_tr, strand, 
-00085080: 6344 4e41 5f63 6861 6e67 652c 2043 6f64  cDNA_change, Cod
-00085090: 6f6e 5f63 6861 6e67 652c 2050 726f 7465  on_change, Prote
-000850a0: 696e 5f63 6861 6e67 652c 2050 726f 7465  in_change, Prote
-000850b0: 696e 5f63 6861 6e67 6532 2c20 4368 6563  in_change2, Chec
-000850c0: 6b27 2920 2023 206f 6e65 2d62 6173 650a  k')  # one-base.
-000850d0: 0a64 6566 2077 7269 7465 5f74 6f5f 7663  .def write_to_vc
-000850e0: 6628 2073 6e76 5f69 6e66 6f5f 6c73 742c  f( snv_info_lst,
-000850f0: 2066 696c 655f 6e61 6d65 2029 3a0a 0a20   file_name ):.. 
-00085100: 2020 2069 6620 6c65 6e28 736e 765f 696e     if len(snv_in
-00085110: 666f 5f6c 7374 2920 3d3d 2030 3a0a 2020  fo_lst) == 0:.  
-00085120: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00085130: 200a 2020 2020 6966 206c 656e 2873 6e76   .    if len(snv
-00085140: 5f69 6e66 6f5f 6c73 745b 305d 2920 3c3d  _info_lst[0]) <=
-00085150: 2032 303a 0a20 2020 2020 2020 2070 6173   20:.        pas
-00085160: 730a 2020 2020 656c 7365 3a0a 2020 2020  s.    else:.    
-00085170: 2020 2020 6620 3d20 6f70 656e 2820 666e      f = open( fn
-00085180: 616d 655f 7663 662c 2027 7774 2b27 2029  ame_vcf, 'wt+' )
-00085190: 0a0a 2020 2020 2020 2020 6c69 6e65 7320  ..        lines 
-000851a0: 3d20 5b27 2343 4852 4f4d 5c74 504f 535c  = ['#CHROM\tPOS\
-000851b0: 7449 445c 7452 4546 5c74 414c 545c 7451  tID\tREF\tALT\tQ
-000851c0: 5541 4c5c 7446 494c 5445 525c 7449 4e46  UAL\tFILTER\tINF
-000851d0: 4f27 5d0a 2020 2020 2020 2020 666f 7220  O'].        for 
-000851e0: 6e69 2069 6e20 736e 765f 696e 666f 5f6c  ni in snv_info_l
-000851f0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00085200: 6d69 6420 3d0a 2020 2020 2020 2020 2020  mid =.          
-00085210: 2020 5175 616c 203d 0a20 2020 2020 2020    Qual =.       
-00085220: 2020 2020 2046 696c 7465 7220 3d0a 2020       Filter =.  
-00085230: 2020 2020 2020 2020 2020 696e 666f 203d            info =
-00085240: 2027 4143 3d25 693b 4146 270a 2020 2020   'AC=%i;AF'.    
-00085250: 2020 2020 2020 2020 2725 735c 7425 695c          '%s\t%i\
-00085260: 7425 735c 7425 735c 7425 735c 7425 695c  t%s\t%s\t%s\t%i\
-00085270: 7425 735c 7425 735c 6e27 2025 2028 6e69  t%s\t%s\n' % (ni
-00085280: 2e63 6872 2c20 6e69 2e70 6f73 5f72 6566  .chr, ni.pos_ref
-00085290: 2c20 6d69 642c 206e 692e 7265 665f 7365  , mid, ni.ref_se
-000852a0: 712c 206e 692e 616c 745f 7365 712c 2051  q, ni.alt_seq, Q
-000852b0: 7561 6c2c 2069 6e66 6f29 0a0a 2020 2020  ual, info)..    
-000852c0: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
-000852d0: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-000852e0: 6e0a 2727 270a 0a64 6566 206d 635f 636f  n.'''..def mc_co
-000852f0: 7265 5f67 6574 5f67 7466 5f61 6e64 5f66  re_get_gtf_and_f
-00085300: 6173 7461 5f70 7428 6764 293a 0a20 2020  asta_pt(gd):.   
-00085310: 200a 2020 2020 6e74 722c 206e 7072 2c20   .    ntr, npr, 
-00085320: 6e65 7220 3d20 6764 2e75 7064 6174 655f  ner = gd.update_
-00085330: 7464 5f69 6e66 6f28 7365 6c20 3d20 312c  td_info(sel = 1,
-00085340: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
-00085350: 0a20 2020 2067 7466 5f6c 696e 652c 2063  .    gtf_line, c
-00085360: 6e20 3d20 6764 2e67 6574 5f67 7466 5f6c  n = gd.get_gtf_l
-00085370: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
-00085380: 7365 6c20 3d20 312c 2061 6464 5f73 6571  sel = 1, add_seq
-00085390: 203d 2046 616c 7365 2c20 636f 6e6e 6563   = False, connec
-000853a0: 7420 3d20 5472 7565 290a 2020 2020 6c74  t = True).    lt
-000853b0: 2c20 6c70 203d 2067 642e 6765 745f 6661  , lp = gd.get_fa
-000853c0: 7374 615f 6c69 6e65 735f 6672 6f6d 5f65  sta_lines_from_e
-000853d0: 786f 6e73 2873 656c 203d 2031 2c20 7065  xons(sel = 1, pe
-000853e0: 7074 6964 6520 3d20 5472 7565 290a 2020  ptide = True).  
-000853f0: 2020 7265 7475 726e 2067 7466 5f6c 696e    return gtf_lin
-00085400: 652c 206c 742c 206c 702c 2067 642e 6368  e, lt, lp, gd.ch
-00085410: 722c 206e 6572 2c20 636e 0a0a 0a27 2727  r, ner, cn...'''
-00085420: 0a4e 565f 696e 666f 5f65 7874 5f74 7220  .NV_info_ext_tr 
-00085430: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
-00085440: 6d65 6474 7570 6c65 2827 4e56 5f69 6e66  medtuple('NV_inf
-00085450: 6f5f 6578 745f 7472 272c 2027 6368 722c  o_ext_tr', 'chr,
-00085460: 2070 6f73 5f72 6566 2c20 706f 735f 6e65   pos_ref, pos_ne
-00085470: 772c 2067 656e 655f 6964 2c20 6765 6e65  w, gene_id, gene
-00085480: 5f6e 616d 652c 2076 5f74 7970 652c 2076  _name, v_type, v
-00085490: 5f6c 656e 2c20 6376 675f 6465 7074 682c  _len, cvg_depth,
-000854a0: 2063 7667 5f66 7261 632c 205c 0a20 2020   cvg_frac, \.   
-000854b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000854c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000854d0: 6566 5f70 7265 762c 2072 6566 5f73 6571  ef_prev, ref_seq
-000854e0: 2c20 7265 665f 6e65 7874 2c20 616c 745f  , ref_next, alt_
-000854f0: 7072 6576 2c20 616c 745f 7365 712c 2061  prev, alt_seq, a
-00085500: 6c74 5f6e 6578 742c 2076 5f63 6c61 7373  lt_next, v_class
-00085510: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00085520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085530: 2020 2020 2020 765f 636c 6173 735f 7472        v_class_tr
-00085540: 2c20 7374 7261 6e64 2c20 6344 4e41 5f63  , strand, cDNA_c
-00085550: 6861 6e67 652c 2043 6f64 6f6e 5f63 6861  hange, Codon_cha
-00085560: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
-00085570: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
-00085580: 6e67 6532 2729 2023 2c20 4368 6563 6b27  nge2') #, Check'
-00085590: 2920 2023 206f 6e65 2d62 6173 650a 2727  )  # one-base.''
-000855a0: 270a 0a4e 565f 696e 666f 5f74 7220 3d20  '..NV_info_tr = 
-000855b0: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
-000855c0: 6474 7570 6c65 2827 4e56 5f69 6e66 6f5f  dtuple('NV_info_
-000855d0: 6578 745f 7472 272c 2027 6368 722c 2070  ext_tr', 'chr, p
-000855e0: 6f73 5f72 6566 2c20 6765 6e65 5f6e 616d  os_ref, gene_nam
-000855f0: 652c 2067 656e 655f 6964 2c20 765f 7479  e, gene_id, v_ty
-00085600: 7065 2c20 765f 6c65 6e2c 205c 0a20 2020  pe, v_len, \.   
-00085610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085620: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00085630: 7667 5f64 6570 7468 2c20 6376 675f 6672  vg_depth, cvg_fr
-00085640: 6163 2c20 7265 665f 7365 712c 2061 6c74  ac, ref_seq, alt
-00085650: 5f73 6571 2c20 5c0a 2020 2020 2020 2020  _seq, \.        
-00085660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085670: 2020 2020 2020 2020 2020 7374 7261 6e64            strand
-00085680: 2c20 6344 4e41 5f63 6861 6e67 652c 2043  , cDNA_change, C
-00085690: 6f64 6f6e 5f63 6861 6e67 652c 2050 726f  odon_change, Pro
-000856a0: 7465 696e 5f63 6861 6e67 652c 2050 726f  tein_change, Pro
-000856b0: 7465 696e 5f63 6861 6e67 6532 2c20 765f  tein_change2, v_
-000856c0: 636c 6173 7327 2920 0a0a 6465 6620 746f  class') ..def to
-000856d0: 5f6e 765f 7369 6d70 6c65 2820 6e76 2029  _nv_simple( nv )
-000856e0: 3a0a 0a20 2020 206e 7669 203d 204e 565f  :..    nvi = NV_
-000856f0: 696e 666f 5f74 7228 206e 762e 6368 722c  info_tr( nv.chr,
-00085700: 206e 762e 706f 735f 7265 662c 206e 762e   nv.pos_ref, nv.
-00085710: 6765 6e65 5f6e 616d 652c 206e 762e 6765  gene_name, nv.ge
-00085720: 6e65 5f69 642c 206e 762e 765f 7479 7065  ne_id, nv.v_type
-00085730: 2c20 6e76 2e76 5f6c 656e 2c20 5c0a 2020  , nv.v_len, \.  
-00085740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085750: 2020 2020 2020 2020 2020 2020 2020 6e76                nv
-00085760: 2e63 7667 5f64 6570 7468 2c20 6e76 2e63  .cvg_depth, nv.c
-00085770: 7667 5f66 7261 632c 206e 762e 7265 665f  vg_frac, nv.ref_
-00085780: 7365 712c 206e 762e 616c 745f 7365 712c  seq, nv.alt_seq,
-00085790: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-000857a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000857b0: 2020 206e 762e 7374 7261 6e64 2c20 6e76     nv.strand, nv
-000857c0: 2e63 444e 415f 6368 616e 6765 2c20 6e76  .cDNA_change, nv
-000857d0: 2e43 6f64 6f6e 5f63 6861 6e67 652c 205c  .Codon_change, \
-000857e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00083fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083fc0: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00083fd0: 2055 7365 206f 6666 7365 745f 6669 6e64   Use offset_find
+00083fe0: 6572 2074 6f20 636f 7272 6563 7420 706f  er to correct po
+00083ff0: 7369 7469 6f6e 7320 696e 2047 5446 2065  sitions in GTF e
+00084000: 6e74 7269 6573 0a20 2020 2023 2320 616c  ntries.    ## al
+00084010: 736f 2067 6574 2072 676e 7320 6672 6167  so get rgns frag
+00084020: 6d65 6e74 7320 7768 656e 2073 706c 6974  ments when split
+00084030: 2069 7320 7265 7175 6972 6564 0a0a 2020   is required..  
+00084040: 2020 635f 746f 5f61 6464 203d 205b 5d0a    c_to_add = [].
+00084050: 2020 2020 706f 735f 746f 5f61 6464 203d      pos_to_add =
+00084060: 205b 5d0a 0a20 2020 2070 7265 765f 6f66   []..    prev_of
+00084070: 6920 3d20 300a 2020 2020 2320 666f 7220  i = 0.    # for 
+00084080: 6b2c 2072 2069 6e20 656e 756d 6572 6174  k, r in enumerat
+00084090: 6528 6361 6c6c 2e72 676e 7329 3a0a 2020  e(call.rgns):.  
+000840a0: 2020 666f 7220 6d2c 206b 2069 6e20 656e    for m, k in en
+000840b0: 756d 6572 6174 6528 6f64 7229 3a0a 2020  umerate(odr):.  
+000840c0: 2020 2020 2020 7220 3d20 6361 6c6c 2e72        r = call.r
+000840d0: 676e 735b 6b5d 0a20 2020 2020 2020 200a  gns[k].        .
+000840e0: 2020 2020 2020 2020 2320 6f73 7320 3d20          # oss = 
+000840f0: 6f66 2e66 696e 645f 6f73 2872 2e73 7461  of.find_os(r.sta
+00084100: 7274 290a 2020 2020 2020 2020 2320 6f73  rt).        # os
+00084110: 6520 3d20 6f66 2e66 696e 645f 6f73 2872  e = of.find_os(r
+00084120: 2e65 6e64 290a 2020 2020 2020 2020 6f73  .end).        os
+00084130: 732c 2070 7265 765f 6f66 3120 3d20 6f66  s, prev_of1 = of
+00084140: 2e66 696e 645f 6f73 5f73 6571 2872 2e73  .find_os_seq(r.s
+00084150: 7461 7274 2c20 7072 6576 5f6f 6669 2c20  tart, prev_ofi, 
+00084160: 6d61 726b 203d 2027 4227 290a 2020 2020  mark = 'B').    
+00084170: 2020 2020 6f73 652c 2070 7265 765f 6f66      ose, prev_of
+00084180: 3220 3d20 6f66 2e66 696e 645f 6f73 5f73  2 = of.find_os_s
+00084190: 6571 2872 2e65 6e64 2c20 7072 6576 5f6f  eq(r.end, prev_o
+000841a0: 6669 2c20 6d61 726b 203d 2027 4327 290a  fi, mark = 'C').
+000841b0: 2020 2020 2020 2020 7072 6576 5f6f 6669          prev_ofi
+000841c0: 203d 2070 7265 765f 6f66 310a 0a20 2020   = prev_of1..   
+000841d0: 2020 2020 2069 6620 2872 2e74 7970 652e       if (r.type.
+000841e0: 6c6f 7765 7228 2920 3d3d 2027 7374 6172  lower() == 'star
+000841f0: 745f 636f 646f 6e27 2920 7c20 2872 2e74  t_codon') | (r.t
+00084200: 7970 652e 6c6f 7765 7228 2920 3d3d 2027  ype.lower() == '
+00084210: 7374 6f70 5f63 6f64 6f6e 2729 3a0a 2020  stop_codon'):.  
+00084220: 2020 2020 2020 2020 2020 722e 7374 6172            r.star
+00084230: 7420 2b3d 206f 7373 0a20 2020 2020 2020  t += oss.       
+00084240: 2020 2020 2072 2e65 6e64 202b 3d20 6f73       r.end += os
+00084250: 7320 2020 0a20 2020 2020 2020 2020 2020  s   .           
+00084260: 2063 616c 6c2e 7267 6e73 5b6b 5d20 3d20   call.rgns[k] = 
+00084270: 722e 636f 7079 2875 7064 6174 653d 4661  r.copy(update=Fa
+00084280: 6c73 6529 0a0a 2020 2020 2020 2020 656c  lse)..        el
+00084290: 7365 3a20 2023 2043 4453 2c20 6669 7665  se:  # CDS, five
+000842a0: 5f70 7269 6d65 5f75 7472 2c20 7468 7265  _prime_utr, thre
+000842b0: 655f 7072 696d 655f 7574 722c 202e 2e2e  e_prime_utr, ...
+000842c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000842d0: 286f 7373 203d 3d20 6f73 6529 3a0a 2020  (oss == ose):.  
+000842e0: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+000842f0: 7374 6172 7420 2b3d 206f 7373 0a20 2020  start += oss.   
+00084300: 2020 2020 2020 2020 2020 2020 2072 2e65               r.e
+00084310: 6e64 202b 3d20 6f73 650a 2020 2020 2020  nd += ose.      
+00084320: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
+00084330: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
+00084340: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
+00084350: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00084360: 286f 7373 203c 206f 7365 293a 2023 2049  (oss < ose): # I
+00084370: 6e73 6572 7369 6f6e 206f 7220 6465 6c65  nsersion or dele
+00084380: 7469 6f6e 2069 6e20 6265 7477 6565 6e0a  tion in between.
+00084390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000843a0: 2023 2070 7269 6e74 2827 2020 2025 6920   # print('   %i 
+000843b0: 6f73 7320 3c20 6f73 6527 2025 206b 290a  oss < ose' % k).
+000843c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000843d0: 702c 2070 7265 765f 6f66 3220 3d20 6f66  p, prev_of2 = of
+000843e0: 2e67 6574 5f62 6e64 7279 5f73 6571 2872  .get_bndry_seq(r
+000843f0: 2e65 6e64 2c20 7072 6576 5f6f 6669 290a  .end, prev_ofi).
+00084400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084410: 2023 2320 7370 6c69 740a 2020 2020 2020   ## split.      
+00084420: 2020 2020 2020 2020 2020 7267 6e5f 6e65            rgn_ne
+00084430: 7720 3d20 7265 6769 6f6e 2820 722e 6368  w = region( r.ch
+00084440: 722c 2070 2b6f 7365 2c20 722e 656e 642b  r, p+ose, r.end+
+00084450: 6f73 652c 2072 2e74 7970 652c 2078 7320  ose, r.type, xs 
+00084460: 3d20 722e 7873 290a 2020 2020 2020 2020  = r.xs).        
+00084470: 2020 2020 2020 2020 635f 746f 5f61 6464          c_to_add
+00084480: 2e61 7070 656e 6428 7267 6e5f 6e65 7729  .append(rgn_new)
+00084490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000844a0: 2070 6f73 5f74 6f5f 6164 642e 6170 7065   pos_to_add.appe
+000844b0: 6e64 286b 2b31 290a 0a20 2020 2020 2020  nd(k+1)..       
+000844c0: 2020 2020 2020 2020 2072 2e65 6e64 203d           r.end =
+000844d0: 2070 2d31 2b6f 7373 0a20 2020 2020 2020   p-1+oss.       
+000844e0: 2020 2020 2020 2020 2072 2e73 7461 7274           r.start
+000844f0: 202b 3d20 6f73 730a 2020 2020 2020 2020   += oss.        
+00084500: 2020 2020 2020 2020 6361 6c6c 2e72 676e          call.rgn
+00084510: 735b 6b5d 203d 2072 2e63 6f70 7928 7570  s[k] = r.copy(up
+00084520: 6461 7465 3d46 616c 7365 290a 0a20 2020  date=False)..   
+00084530: 2020 2020 2020 2020 2065 6c69 6620 286f           elif (o
+00084540: 7373 203e 206f 7365 293a 2023 2064 656c  ss > ose): # del
+00084550: 6574 696f 6e20 696e 2062 6574 7765 656e  etion in between
+00084560: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00084570: 2020 2320 7072 696e 7428 2720 2020 2569    # print('   %i
+00084580: 206f 7373 203e 206f 7365 2720 2520 6b29   oss > ose' % k)
+00084590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000845a0: 2070 2c20 7072 6576 5f6f 6632 203d 206f   p, prev_of2 = o
+000845b0: 662e 6765 745f 626e 6472 795f 7365 7128  f.get_bndry_seq(
+000845c0: 722e 656e 642c 2070 7265 765f 6f66 6929  r.end, prev_ofi)
+000845d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000845e0: 204c 6420 3d20 6f73 7320 2d20 6f73 650a   Ld = oss - ose.
+000845f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084600: 2023 2320 7370 6c69 7420 2866 6f72 2043   ## split (for C
+00084610: 4453 206f 6e6c 7929 0a20 2020 2020 2020  DS only).       
+00084620: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
+00084630: 203d 2072 6567 696f 6e28 2072 2e63 6872   = region( r.chr
+00084640: 2c20 702b 4c64 2b6f 7365 2c20 722e 656e  , p+Ld+ose, r.en
+00084650: 642b 6f73 652c 2072 2e74 7970 652c 2078  d+ose, r.type, x
+00084660: 7320 3d20 722e 7873 290a 2020 2020 2020  s = r.xs).      
+00084670: 2020 2020 2020 2020 2020 635f 746f 5f61            c_to_a
+00084680: 6464 2e61 7070 656e 6428 7267 6e5f 6e65  dd.append(rgn_ne
+00084690: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
+000846a0: 2020 2070 6f73 5f74 6f5f 6164 642e 6170     pos_to_add.ap
+000846b0: 7065 6e64 286b 2b31 290a 0a20 2020 2020  pend(k+1)..     
+000846c0: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
+000846d0: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
+000846e0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
+000846f0: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
+00084700: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
+00084710: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
+00084720: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
+00084730: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00084740: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00084750: 2020 2323 2070 7574 2072 676e 7320 6261    ## put rgns ba
+00084760: 636b 2074 6f20 6764 5f73 656c 0a20 2020  ck to gd_sel.   
+00084770: 2023 2320 616e 6420 616c 736f 2061 6464   ## and also add
+00084780: 206e 6577 2072 676e 7320 0a0a 2020 2020   new rgns ..    
+00084790: 706f 735f 746f 5f61 6464 203d 206e 702e  pos_to_add = np.
+000847a0: 6172 7261 7928 706f 735f 746f 5f61 6464  array(pos_to_add
+000847b0: 290a 2020 2020 666f 7220 6b2c 2067 6420  ).    for k, gd 
+000847c0: 696e 2065 6e75 6d65 7261 7465 2867 645f  in enumerate(gd_
+000847d0: 7365 6c29 3a20 0a0a 2020 2020 2020 2020  sel): ..        
+000847e0: 7031 203d 2069 6e74 286c 6f63 5f6f 735b  p1 = int(loc_os[
+000847f0: 6b5d 290a 2020 2020 2020 2020 7032 203d  k]).        p2 =
+00084800: 2069 6e74 2870 3120 2b20 6e75 6d5f 6f73   int(p1 + num_os
+00084810: 5b6b 5d29 0a20 2020 2020 2020 2067 642e  [k]).        gd.
+00084820: 6364 732e 7267 6e73 203d 205b 6361 6c6c  cds.rgns = [call
+00084830: 2e72 676e 735b 7031 2b6d 5d20 666f 7220  .rgns[p1+m] for 
+00084840: 6d20 696e 2072 616e 6765 2870 322d 7031  m in range(p2-p1
+00084850: 295d 0a20 2020 2020 2020 2077 6820 3d20  )].        wh = 
+00084860: 7768 6963 6828 2028 706f 735f 746f 5f61  which( (pos_to_a
+00084870: 6464 203e 3d20 7031 2920 2620 2870 6f73  dd >= p1) & (pos
+00084880: 5f74 6f5f 6164 6420 3c20 7032 2920 290a  _to_add < p2) ).
+00084890: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
+000848a0: 6829 203e 2030 3a0a 2020 2020 2020 2020  h) > 0:.        
+000848b0: 2020 2020 666f 7220 7720 696e 2077 683a      for w in wh:
+000848c0: 2067 642e 6364 732e 7267 6e73 2e61 7070   gd.cds.rgns.app
+000848d0: 656e 6428 635f 746f 5f61 6464 5b77 5d29  end(c_to_add[w])
+000848e0: 0a0a 2020 2020 656c 6170 7365 645f 7469  ..    elapsed_ti
+000848f0: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+00084900: 202d 2073 7461 7274 5f74 696d 650a 2020   - start_time.  
+00084910: 2020 2320 7072 696e 7428 2720 2020 342e    # print('   4.
+00084920: 2064 6f6e 6520 2825 6929 2020 2720 2520   done (%i)  ' % 
+00084930: 2865 6c61 7073 6564 5f74 696d 6529 2c20  (elapsed_time), 
+00084940: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
+00084950: 2020 0a20 2020 2023 2323 2323 2323 2323    .    #########
+00084960: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00084970: 2020 2020 2323 2063 6f64 696e 6720 7265      ## coding re
+00084980: 6769 6f6e 2075 7064 6174 650a 2020 2020  gion update.    
+00084990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000849a0: 2323 2323 2323 2323 0a0a 2020 2020 2323  ########..    ##
+000849b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000849c0: 2323 2323 2323 0a20 2020 2023 2320 496e  ######.    ## In
+000849d0: 7465 6772 6974 7920 6368 6563 6b0a 2020  tegrity check.  
+000849e0: 2020 0a20 2020 2073 7461 7274 5f74 696d    .    start_tim
+000849f0: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
+00084a00: 2020 2020 6e5f 6261 7365 735f 746f 7461      n_bases_tota
+00084a10: 6c20 3d20 300a 2020 2020 6e5f 6572 5f62  l = 0.    n_er_b
+00084a20: 6173 6573 203d 2030 0a20 2020 206e 5f62  ases = 0.    n_b
+00084a30: 6c6b 5f74 6f74 616c 203d 2030 0a20 2020  lk_total = 0.   
+00084a40: 206e 5f65 725f 626c 6b20 3d20 300a 2020   n_er_blk = 0.  
+00084a50: 2020 6e70 6520 3d20 300a 2020 2020 6e70    npe = 0.    np
+00084a60: 7420 3d20 300a 2020 2020 666f 7220 6764  t = 0.    for gd
+00084a70: 2069 6e20 6764 5f73 656c 3a0a 2020 2020   in gd_sel:.    
+00084a80: 2020 2020 666f 7220 7220 696e 2067 642e      for r in gd.
+00084a90: 6578 6f6e 732e 7267 6e73 3a0a 2020 2020  exons.rgns:.    
+00084aa0: 2020 2020 2020 2020 6966 2072 2e74 7970          if r.typ
+00084ab0: 6520 213d 2027 6465 6c65 7469 6f6e 273a  e != 'deletion':
+00084ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084ad0: 2073 3120 3d20 722e 7365 710a 2020 2020   s1 = r.seq.    
+00084ae0: 2020 2020 2020 2020 2020 2020 7332 203d              s2 =
+00084af0: 2073 6571 5f6e 6577 5b28 722e 7374 6172   seq_new[(r.star
+00084b00: 742d 3129 3a72 2e65 6e64 5d20 2320 6765  t-1):r.end] # ge
+00084b10: 6e6f 6d65 5b72 2e63 6872 5d2e 7365 715b  nome[r.chr].seq[
+00084b20: 2872 2e73 7461 7274 2d31 293a 722e 656e  (r.start-1):r.en
+00084b30: 645d 0a20 2020 2020 2020 2020 2020 2020  d].             
+00084b40: 2020 206e 5f65 7220 3d20 636f 6d70 6172     n_er = compar
+00084b50: 655f 7365 7132 2820 7331 2c20 7332 2029  e_seq2( s1, s2 )
+00084b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084b70: 2023 2069 6620 6e5f 6572 203e 2030 3a20   # if n_er > 0: 
+00084b80: 7072 696e 7428 275c 6e53 313a 2025 735c  print('\nS1: %s\
+00084b90: 6e53 323a 2025 7327 2025 2028 7331 2c73  nS2: %s' % (s1,s
+00084ba0: 3229 290a 2020 2020 2020 2020 2020 2020  2)).            
+00084bb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00084bc0: 2020 2020 2020 2020 206e 5f62 6173 6573           n_bases
+00084bd0: 5f74 6f74 616c 202b 3d20 6c65 6e28 7331  _total += len(s1
+00084be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00084bf0: 2020 6e5f 6572 5f62 6173 6573 202b 3d20    n_er_bases += 
+00084c00: 6e5f 6572 0a20 2020 2020 2020 2020 2020  n_er.           
+00084c10: 2020 2020 206e 5f62 6c6b 5f74 6f74 616c       n_blk_total
+00084c20: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00084c30: 2020 2020 2020 6966 206e 5f65 7220 3e20        if n_er > 
+00084c40: 303a 206e 5f65 725f 626c 6b20 2b3d 2031  0: n_er_blk += 1
+00084c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084c60: 2020 2020 200a 2020 2020 2020 2020 6e74       .        nt
+00084c70: 722c 206e 7072 2c20 6e65 7220 3d20 6764  r, npr, ner = gd
+00084c80: 2e75 7064 6174 655f 7464 5f69 6e66 6f28  .update_td_info(
+00084c90: 7365 6c20 3d20 312c 2070 6570 7469 6465  sel = 1, peptide
+00084ca0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+00084cb0: 206e 652c 206e 7420 3d20 6764 2e63 6f6d   ne, nt = gd.com
+00084cc0: 7061 7265 5f73 6571 735f 6672 6f6d 5f63  pare_seqs_from_c
+00084cd0: 6473 5f61 6e64 5f67 656e 6f6d 6528 7365  ds_and_genome(se
+00084ce0: 715f 6e65 7729 2023 2067 656e 6f6d 655b  q_new) # genome[
+00084cf0: 6764 2e63 6872 5d2e 7365 7129 0a20 2020  gd.chr].seq).   
+00084d00: 2020 2020 206e 7065 202b 3d20 6e65 0a20       npe += ne. 
+00084d10: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
+00084d20: 0a0a 2020 2020 2020 2020 2320 6966 206e  ..        # if n
+00084d30: 6572 203e 2030 3a20 7072 696e 7428 2749  er > 0: print('I
+00084d40: 6e74 6567 7269 7479 2063 6865 636b 2065  ntegrity check e
+00084d50: 7272 6f72 2041 2069 6e20 2573 3a20 2569  rror A in %s: %i
+00084d60: 202d 2025 692f 2569 2c20 2569 2f25 692c   - %i/%i, %i/%i,
+00084d70: 2025 692f 2569 2720 2520 2863 6872 6d2c   %i/%i' % (chrm,
+00084d80: 206e 6572 2c20 6e5f 6572 5f62 6173 6573   ner, n_er_bases
+00084d90: 2c20 6e5f 6261 7365 735f 746f 7461 6c2c  , n_bases_total,
+00084da0: 206e 5f65 725f 626c 6b2c 206e 5f62 6c6b   n_er_blk, n_blk
+00084db0: 5f74 6f74 616c 2c20 6e70 652c 206e 7074  _total, npe, npt
+00084dc0: 2920 290a 2020 2020 2020 2020 2320 6966  ) ).        # if
+00084dd0: 206e 5f65 7220 3e20 303a 2070 7269 6e74   n_er > 0: print
+00084de0: 2827 496e 7465 6772 6974 7920 6368 6563  ('Integrity chec
+00084df0: 6b20 6572 726f 7220 696e 2025 733a 2025  k error in %s: %
+00084e00: 6920 2d20 2569 2f25 692c 2025 692f 2569  i - %i/%i, %i/%i
+00084e10: 2c20 2569 2f25 6927 2025 2028 6368 726d  , %i/%i' % (chrm
+00084e20: 2c20 6e5f 6572 2c20 6e5f 6572 5f62 6173  , n_er, n_er_bas
+00084e30: 6573 2c20 6e5f 6261 7365 735f 746f 7461  es, n_bases_tota
+00084e40: 6c2c 206e 5f65 725f 626c 6b2c 206e 5f62  l, n_er_blk, n_b
+00084e50: 6c6b 5f74 6f74 616c 2c20 6e70 652c 206e  lk_total, npe, n
+00084e60: 7074 2920 290a 0a20 2020 2065 6c61 7073  pt) )..    elaps
+00084e70: 6564 5f74 696d 6520 3d20 7469 6d65 2e74  ed_time = time.t
+00084e80: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
+00084e90: 6d65 0a20 2020 2023 2070 7269 6e74 2827  me.    # print('
+00084ea0: 2020 2035 2e20 646f 6e65 2028 2569 2920     5. done (%i) 
+00084eb0: 2027 2025 2028 656c 6170 7365 645f 7469   ' % (elapsed_ti
+00084ec0: 6d65 292c 2066 6c75 7368 203d 2054 7275  me), flush = Tru
+00084ed0: 6529 0a20 2020 200a 2020 2020 6573 7461  e).    .    esta
+00084ee0: 7420 3d20 286e 5f62 6173 6573 5f74 6f74  t = (n_bases_tot
+00084ef0: 616c 2c20 6e5f 6572 5f62 6173 6573 2c20  al, n_er_bases, 
+00084f00: 6e5f 626c 6b5f 746f 7461 6c2c 206e 5f65  n_blk_total, n_e
+00084f10: 725f 626c 6b2c 206e 7074 2c20 6e70 6529  r_blk, npt, npe)
+00084f20: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
+00084f30: 2067 645f 7365 6c2c 2073 6571 5f6e 6577   gd_sel, seq_new
+00084f40: 2c20 736e 765f 696e 666f 5f63 6872 2c20  , snv_info_chr, 
+00084f50: 6f66 2c20 6368 726d 2c20 6573 7461 740a  of, chrm, estat.
+00084f60: 0a27 2727 0a4e 565f 696e 666f 5f65 7874  .'''.NV_info_ext
+00084f70: 5f74 7220 3d20 636f 6c6c 6563 7469 6f6e  _tr = collection
+00084f80: 732e 6e61 6d65 6474 7570 6c65 2827 4e56  s.namedtuple('NV
+00084f90: 5f69 6e66 6f5f 6578 745f 7472 272c 2027  _info_ext_tr', '
+00084fa0: 6368 722c 2070 6f73 5f72 6566 2c20 706f  chr, pos_ref, po
+00084fb0: 735f 6e65 772c 2067 656e 655f 6964 2c20  s_new, gene_id, 
+00084fc0: 6765 6e65 5f6e 616d 652c 2076 5f74 7970  gene_name, v_typ
+00084fd0: 652c 2076 5f6c 656e 2c20 6376 675f 6465  e, v_len, cvg_de
+00084fe0: 7074 682c 2063 7667 5f66 7261 632c 205c  pth, cvg_frac, \
+00084ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00085000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085010: 2020 2072 6566 5f70 7265 762c 2072 6566     ref_prev, ref
+00085020: 5f73 6571 2c20 7265 665f 6e65 7874 2c20  _seq, ref_next, 
+00085030: 616c 745f 7072 6576 2c20 616c 745f 7365  alt_prev, alt_se
+00085040: 712c 2061 6c74 5f6e 6578 742c 2076 5f63  q, alt_next, v_c
+00085050: 6c61 7373 2c20 5c0a 2020 2020 2020 2020  lass, \.        
+00085060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085070: 2020 2020 2020 2020 2020 765f 636c 6173            v_clas
+00085080: 735f 7472 2c20 7374 7261 6e64 2c20 6344  s_tr, strand, cD
+00085090: 4e41 5f63 6861 6e67 652c 2043 6f64 6f6e  NA_change, Codon
+000850a0: 5f63 6861 6e67 652c 2050 726f 7465 696e  _change, Protein
+000850b0: 5f63 6861 6e67 652c 2050 726f 7465 696e  _change, Protein
+000850c0: 5f63 6861 6e67 6532 2c20 4368 6563 6b27  _change2, Check'
+000850d0: 2920 2023 206f 6e65 2d62 6173 650a 0a64  )  # one-base..d
+000850e0: 6566 2077 7269 7465 5f74 6f5f 7663 6628  ef write_to_vcf(
+000850f0: 2073 6e76 5f69 6e66 6f5f 6c73 742c 2066   snv_info_lst, f
+00085100: 696c 655f 6e61 6d65 2029 3a0a 0a20 2020  ile_name ):..   
+00085110: 2069 6620 6c65 6e28 736e 765f 696e 666f   if len(snv_info
+00085120: 5f6c 7374 2920 3d3d 2030 3a0a 2020 2020  _lst) == 0:.    
+00085130: 2020 2020 7265 7475 726e 0a20 2020 200a      return.    .
+00085140: 2020 2020 6966 206c 656e 2873 6e76 5f69      if len(snv_i
+00085150: 6e66 6f5f 6c73 745b 305d 2920 3c3d 2032  nfo_lst[0]) <= 2
+00085160: 303a 0a20 2020 2020 2020 2070 6173 730a  0:.        pass.
+00085170: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00085180: 2020 6620 3d20 6f70 656e 2820 666e 616d    f = open( fnam
+00085190: 655f 7663 662c 2027 7774 2b27 2029 0a0a  e_vcf, 'wt+' )..
+000851a0: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
+000851b0: 5b27 2343 4852 4f4d 5c74 504f 535c 7449  ['#CHROM\tPOS\tI
+000851c0: 445c 7452 4546 5c74 414c 545c 7451 5541  D\tREF\tALT\tQUA
+000851d0: 4c5c 7446 494c 5445 525c 7449 4e46 4f27  L\tFILTER\tINFO'
+000851e0: 5d0a 2020 2020 2020 2020 666f 7220 6e69  ].        for ni
+000851f0: 2069 6e20 736e 765f 696e 666f 5f6c 7374   in snv_info_lst
+00085200: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
+00085210: 6420 3d0a 2020 2020 2020 2020 2020 2020  d =.            
+00085220: 5175 616c 203d 0a20 2020 2020 2020 2020  Qual =.         
+00085230: 2020 2046 696c 7465 7220 3d0a 2020 2020     Filter =.    
+00085240: 2020 2020 2020 2020 696e 666f 203d 2027          info = '
+00085250: 4143 3d25 693b 4146 270a 2020 2020 2020  AC=%i;AF'.      
+00085260: 2020 2020 2020 2725 735c 7425 695c 7425        '%s\t%i\t%
+00085270: 735c 7425 735c 7425 735c 7425 695c 7425  s\t%s\t%s\t%i\t%
+00085280: 735c 7425 735c 6e27 2025 2028 6e69 2e63  s\t%s\n' % (ni.c
+00085290: 6872 2c20 6e69 2e70 6f73 5f72 6566 2c20  hr, ni.pos_ref, 
+000852a0: 6d69 642c 206e 692e 7265 665f 7365 712c  mid, ni.ref_seq,
+000852b0: 206e 692e 616c 745f 7365 712c 2051 7561   ni.alt_seq, Qua
+000852c0: 6c2c 2069 6e66 6f29 0a0a 2020 2020 2020  l, info)..      
+000852d0: 2020 662e 636c 6f73 6528 290a 2020 2020    f.close().    
+000852e0: 2020 2020 0a20 2020 2072 6574 7572 6e0a      .    return.
+000852f0: 2727 270a 0a64 6566 206d 635f 636f 7265  '''..def mc_core
+00085300: 5f67 6574 5f67 7466 5f61 6e64 5f66 6173  _get_gtf_and_fas
+00085310: 7461 5f70 7428 6764 293a 0a20 2020 200a  ta_pt(gd):.    .
+00085320: 2020 2020 6e74 722c 206e 7072 2c20 6e65      ntr, npr, ne
+00085330: 7220 3d20 6764 2e75 7064 6174 655f 7464  r = gd.update_td
+00085340: 5f69 6e66 6f28 7365 6c20 3d20 312c 2070  _info(sel = 1, p
+00085350: 6570 7469 6465 203d 2054 7275 6529 0a20  eptide = True). 
+00085360: 2020 2067 7466 5f6c 696e 652c 2063 6e20     gtf_line, cn 
+00085370: 3d20 6764 2e67 6574 5f67 7466 5f6c 696e  = gd.get_gtf_lin
+00085380: 6573 5f66 726f 6d5f 6578 6f6e 7328 7365  es_from_exons(se
+00085390: 6c20 3d20 312c 2061 6464 5f73 6571 203d  l = 1, add_seq =
+000853a0: 2046 616c 7365 2c20 636f 6e6e 6563 7420   False, connect 
+000853b0: 3d20 5472 7565 290a 2020 2020 6c74 2c20  = True).    lt, 
+000853c0: 6c70 203d 2067 642e 6765 745f 6661 7374  lp = gd.get_fast
+000853d0: 615f 6c69 6e65 735f 6672 6f6d 5f65 786f  a_lines_from_exo
+000853e0: 6e73 2873 656c 203d 2031 2c20 7065 7074  ns(sel = 1, pept
+000853f0: 6964 6520 3d20 5472 7565 290a 2020 2020  ide = True).    
+00085400: 7265 7475 726e 2067 7466 5f6c 696e 652c  return gtf_line,
+00085410: 206c 742c 206c 702c 2067 642e 6368 722c   lt, lp, gd.chr,
+00085420: 206e 6572 2c20 636e 0a0a 0a27 2727 0a4e   ner, cn...'''.N
+00085430: 565f 696e 666f 5f65 7874 5f74 7220 3d20  V_info_ext_tr = 
+00085440: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
+00085450: 6474 7570 6c65 2827 4e56 5f69 6e66 6f5f  dtuple('NV_info_
+00085460: 6578 745f 7472 272c 2027 6368 722c 2070  ext_tr', 'chr, p
+00085470: 6f73 5f72 6566 2c20 706f 735f 6e65 772c  os_ref, pos_new,
+00085480: 2067 656e 655f 6964 2c20 6765 6e65 5f6e   gene_id, gene_n
+00085490: 616d 652c 2076 5f74 7970 652c 2076 5f6c  ame, v_type, v_l
+000854a0: 656e 2c20 6376 675f 6465 7074 682c 2063  en, cvg_depth, c
+000854b0: 7667 5f66 7261 632c 205c 0a20 2020 2020  vg_frac, \.     
+000854c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000854d0: 2020 2020 2020 2020 2020 2020 2072 6566               ref
+000854e0: 5f70 7265 762c 2072 6566 5f73 6571 2c20  _prev, ref_seq, 
+000854f0: 7265 665f 6e65 7874 2c20 616c 745f 7072  ref_next, alt_pr
+00085500: 6576 2c20 616c 745f 7365 712c 2061 6c74  ev, alt_seq, alt
+00085510: 5f6e 6578 742c 2076 5f63 6c61 7373 2c20  _next, v_class, 
+00085520: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00085530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085540: 2020 2020 765f 636c 6173 735f 7472 2c20      v_class_tr, 
+00085550: 7374 7261 6e64 2c20 6344 4e41 5f63 6861  strand, cDNA_cha
+00085560: 6e67 652c 2043 6f64 6f6e 5f63 6861 6e67  nge, Codon_chang
+00085570: 652c 2050 726f 7465 696e 5f63 6861 6e67  e, Protein_chang
+00085580: 652c 2050 726f 7465 696e 5f63 6861 6e67  e, Protein_chang
+00085590: 6532 2729 2023 2c20 4368 6563 6b27 2920  e2') #, Check') 
+000855a0: 2023 206f 6e65 2d62 6173 650a 2727 270a   # one-base.'''.
+000855b0: 0a4e 565f 696e 666f 5f74 7220 3d20 636f  .NV_info_tr = co
+000855c0: 6c6c 6563 7469 6f6e 732e 6e61 6d65 6474  llections.namedt
+000855d0: 7570 6c65 2827 4e56 5f69 6e66 6f5f 6578  uple('NV_info_ex
+000855e0: 745f 7472 272c 2027 6368 722c 2070 6f73  t_tr', 'chr, pos
+000855f0: 5f72 6566 2c20 6765 6e65 5f6e 616d 652c  _ref, gene_name,
+00085600: 2067 656e 655f 6964 2c20 765f 7479 7065   gene_id, v_type
+00085610: 2c20 765f 6c65 6e2c 205c 0a20 2020 2020  , v_len, \.     
+00085620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085630: 2020 2020 2020 2020 2020 2020 2063 7667               cvg
+00085640: 5f64 6570 7468 2c20 6376 675f 6672 6163  _depth, cvg_frac
+00085650: 2c20 7265 665f 7365 712c 2061 6c74 5f73  , ref_seq, alt_s
+00085660: 6571 2c20 5c0a 2020 2020 2020 2020 2020  eq, \.          
+00085670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085680: 2020 2020 2020 2020 7374 7261 6e64 2c20          strand, 
+00085690: 6344 4e41 5f63 6861 6e67 652c 2043 6f64  cDNA_change, Cod
+000856a0: 6f6e 5f63 6861 6e67 652c 2050 726f 7465  on_change, Prote
+000856b0: 696e 5f63 6861 6e67 652c 2050 726f 7465  in_change, Prote
+000856c0: 696e 5f63 6861 6e67 6532 2c20 765f 636c  in_change2, v_cl
+000856d0: 6173 7327 2920 0a0a 6465 6620 746f 5f6e  ass') ..def to_n
+000856e0: 765f 7369 6d70 6c65 2820 6e76 2029 3a0a  v_simple( nv ):.
+000856f0: 0a20 2020 206e 7669 203d 204e 565f 696e  .    nvi = NV_in
+00085700: 666f 5f74 7228 206e 762e 6368 722c 206e  fo_tr( nv.chr, n
+00085710: 762e 706f 735f 7265 662c 206e 762e 6765  v.pos_ref, nv.ge
+00085720: 6e65 5f6e 616d 652c 206e 762e 6765 6e65  ne_name, nv.gene
+00085730: 5f69 642c 206e 762e 765f 7479 7065 2c20  _id, nv.v_type, 
+00085740: 6e76 2e76 5f6c 656e 2c20 5c0a 2020 2020  nv.v_len, \.    
+00085750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085760: 2020 2020 2020 2020 2020 2020 6e76 2e63              nv.c
+00085770: 7667 5f64 6570 7468 2c20 6e76 2e63 7667  vg_depth, nv.cvg
+00085780: 5f66 7261 632c 206e 762e 7265 665f 7365  _frac, nv.ref_se
+00085790: 712c 206e 762e 616c 745f 7365 712c 205c  q, nv.alt_seq, \
+000857a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000857b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000857c0: 206e 762e 7374 7261 6e64 2c20 6e76 2e63   nv.strand, nv.c
+000857d0: 444e 415f 6368 616e 6765 2c20 6e76 2e43  DNA_change, nv.C
+000857e0: 6f64 6f6e 5f63 6861 6e67 652c 205c 0a20  odon_change, \. 
 000857f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085800: 206e 762e 5072 6f74 6569 6e5f 6368 616e   nv.Protein_chan
-00085810: 6765 2c20 6e76 2e50 726f 7465 696e 5f63  ge, nv.Protein_c
-00085820: 6861 6e67 6532 2c20 6e76 2e76 5f63 6c61  hange2, nv.v_cla
-00085830: 7373 5f74 7220 290a 2020 2020 7265 7475  ss_tr ).    retu
-00085840: 726e 206e 7669 0a0a 6465 6620 5374 7269  rn nvi..def Stri
-00085850: 6e67 4669 785f 7379 6e74 6865 7369 7328  ngFix_synthesis(
-00085860: 6774 665f 6669 6c65 2c20 6765 6e6f 6d65  gtf_file, genome
-00085870: 5f66 696c 652c 2072 6576 203d 2054 7275  _file, rev = Tru
-00085880: 652c 206e 5f63 6f72 6573 203d 2031 2c20  e, n_cores = 1, 
-00085890: 6f75 745f 6469 7220 3d20 4e6f 6e65 2c20  out_dir = None, 
-000858a0: 6764 7320 3d20 4e6f 6e65 293a 0a0a 2020  gds = None):..  
-000858b0: 2020 2320 7072 696e 7428 2753 7472 696e    # print('Strin
-000858c0: 6746 6978 5f73 796e 7468 6573 6973 2073  gFix_synthesis s
-000858d0: 7461 7274 6564 2027 2c20 6461 7465 7469  tarted ', dateti
-000858e0: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
-000858f0: 2929 0a20 2020 200a 2020 2020 6966 2069  )).    .    if i
-00085900: 7369 6e73 7461 6e63 6528 6765 6e6f 6d65  sinstance(genome
-00085910: 5f66 696c 652c 2073 7472 293a 0a20 2020  _file, str):.   
-00085920: 2020 2020 2067 656e 6f6d 6520 3d20 6c6f       genome = lo
-00085930: 6164 5f67 656e 6f6d 6528 6765 6e6f 6d65  ad_genome(genome
-00085940: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
-00085950: 2054 7275 6529 0a20 2020 2065 6c73 653a   True).    else:
-00085960: 0a20 2020 2020 2020 2067 656e 6f6d 6520  .        genome 
-00085970: 3d20 6765 6e6f 6d65 5f66 696c 650a 0a20  = genome_file.. 
-00085980: 2020 2069 6620 6764 7320 6973 204e 6f6e     if gds is Non
-00085990: 653a 0a20 2020 2020 2020 2067 7466 5f6c  e:.        gtf_l
-000859a0: 696e 6573 2c20 6864 725f 6c69 6e65 7320  ines, hdr_lines 
-000859b0: 3d20 6c6f 6164 5f67 7466 2867 7466 5f66  = load_gtf(gtf_f
-000859c0: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
-000859d0: 7275 6529 0a20 2020 2020 2020 2067 645f  rue).        gd_
-000859e0: 6c73 742c 2063 6872 7320 3d20 6765 745f  lst, chrs = get_
-000859f0: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
-00085a00: 6774 665f 6c69 6e65 732c 2067 656e 6f6d  gtf_lines, genom
-00085a10: 6520 3d20 4e6f 6e65 2c20 6669 6c6c 203d  e = None, fill =
-00085a20: 2054 7275 652c 205c 0a20 2020 2020 2020   True, \.       
-00085a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085800: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00085810: 762e 5072 6f74 6569 6e5f 6368 616e 6765  v.Protein_change
+00085820: 2c20 6e76 2e50 726f 7465 696e 5f63 6861  , nv.Protein_cha
+00085830: 6e67 6532 2c20 6e76 2e76 5f63 6c61 7373  nge2, nv.v_class
+00085840: 5f74 7220 290a 2020 2020 7265 7475 726e  _tr ).    return
+00085850: 206e 7669 0a0a 6465 6620 5374 7269 6e67   nvi..def String
+00085860: 4669 785f 7379 6e74 6865 7369 7328 6774  Fix_synthesis(gt
+00085870: 665f 6669 6c65 2c20 6765 6e6f 6d65 5f66  f_file, genome_f
+00085880: 696c 652c 2072 6576 203d 2054 7275 652c  ile, rev = True,
+00085890: 206e 5f63 6f72 6573 203d 2031 2c20 6f75   n_cores = 1, ou
+000858a0: 745f 6469 7220 3d20 4e6f 6e65 2c20 6764  t_dir = None, gd
+000858b0: 7320 3d20 4e6f 6e65 293a 0a0a 2020 2020  s = None):..    
+000858c0: 2320 7072 696e 7428 2753 7472 696e 6746  # print('StringF
+000858d0: 6978 5f73 796e 7468 6573 6973 2073 7461  ix_synthesis sta
+000858e0: 7274 6564 2027 2c20 6461 7465 7469 6d65  rted ', datetime
+000858f0: 2e64 6174 6574 696d 652e 6e6f 7728 2929  .datetime.now())
+00085900: 0a20 2020 200a 2020 2020 6966 2069 7369  .    .    if isi
+00085910: 6e73 7461 6e63 6528 6765 6e6f 6d65 5f66  nstance(genome_f
+00085920: 696c 652c 2073 7472 293a 0a20 2020 2020  ile, str):.     
+00085930: 2020 2067 656e 6f6d 6520 3d20 6c6f 6164     genome = load
+00085940: 5f67 656e 6f6d 6528 6765 6e6f 6d65 5f66  _genome(genome_f
+00085950: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
+00085960: 7275 6529 0a20 2020 2065 6c73 653a 0a20  rue).    else:. 
+00085970: 2020 2020 2020 2067 656e 6f6d 6520 3d20         genome = 
+00085980: 6765 6e6f 6d65 5f66 696c 650a 0a20 2020  genome_file..   
+00085990: 2069 6620 6764 7320 6973 204e 6f6e 653a   if gds is None:
+000859a0: 0a20 2020 2020 2020 2067 7466 5f6c 696e  .        gtf_lin
+000859b0: 6573 2c20 6864 725f 6c69 6e65 7320 3d20  es, hdr_lines = 
+000859c0: 6c6f 6164 5f67 7466 2867 7466 5f66 696c  load_gtf(gtf_fil
+000859d0: 652c 2076 6572 626f 7365 203d 2054 7275  e, verbose = Tru
+000859e0: 6529 0a20 2020 2020 2020 2067 645f 6c73  e).        gd_ls
+000859f0: 742c 2063 6872 7320 3d20 6765 745f 6765  t, chrs = get_ge
+00085a00: 6e65 5f64 6573 6372 6970 746f 7228 6774  ne_descriptor(gt
+00085a10: 665f 6c69 6e65 732c 2067 656e 6f6d 6520  f_lines, genome 
+00085a20: 3d20 4e6f 6e65 2c20 6669 6c6c 203d 2054  = None, fill = T
+00085a30: 7275 652c 205c 0a20 2020 2020 2020 2020  rue, \.         
 00085a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085a50: 2020 2020 2020 2020 6367 203d 2054 7275          cg = Tru
-00085a60: 652c 2076 6572 626f 7365 203d 2054 7275  e, verbose = Tru
-00085a70: 652c 206e 5f63 6f72 6573 203d 2031 290a  e, n_cores = 1).
-00085a80: 2020 2020 2020 2020 6764 5f6c 7374 732c          gd_lsts,
-00085a90: 2063 6872 5f6c 7374 203d 2070 6163 6b5f   chr_lst = pack_
-00085aa0: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
-00085ab0: 2067 645f 6c73 742c 2063 6872 7320 290a   gd_lst, chrs ).
-00085ac0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00085ad0: 2066 6f72 2067 646c 2069 6e20 6764 5f6c   for gdl in gd_l
-00085ae0: 7374 733a 200a 2020 2020 2020 2020 2020  sts: .          
-00085af0: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
-00085b00: 6e75 6d65 7261 7465 2867 646c 293a 0a20  numerate(gdl):. 
-00085b10: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00085b20: 642e 7365 745f 636f 765f 6e5f 6162 6e5f  d.set_cov_n_abn_
-00085b30: 7468 2820 4d49 4e5f 434f 565f 544f 5f53  th( MIN_COV_TO_S
-00085b40: 454c 2c20 4d49 4e5f 4142 4e5f 544f 5f53  EL, MIN_ABN_TO_S
-00085b50: 454c 2029 0a0a 2020 2020 2020 2020 6e74  EL )..        nt
-00085b60: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
-00085b70: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
-00085b80: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
-00085b90: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
-00085ba0: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
-00085bb0: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
-00085bc0: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
-00085bd0: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
-00085be0: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
-00085bf0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00085c00: 725f 6c73 745f 6e65 772e 6170 7065 6e64  r_lst_new.append
-00085c10: 2863 6872 6d29 0a20 2020 2020 2020 2020  (chrm).         
-00085c20: 2020 2020 2020 2067 6763 5f74 7570 6c65         ggc_tuple
-00085c30: 2e61 7070 656e 6428 2028 6764 5f6c 7374  .append( (gd_lst
-00085c40: 735b 6b6b 5d2c 2067 656e 6f6d 655b 6368  s[kk], genome[ch
-00085c50: 726d 5d2e 7365 712c 2063 6872 6d29 2029  rm].seq, chrm) )
-00085c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00085c70: 2066 6f72 2067 6420 696e 2067 645f 6c73   for gd in gd_ls
-00085c80: 7473 5b6b 6b5d 3a0a 2020 2020 2020 2020  ts[kk]:.        
-00085c90: 2020 2020 2020 2020 2020 2020 6e74 725f              ntr_
-00085ca0: 7661 6c69 6420 2b3d 2067 642e 6e74 720a  valid += gd.ntr.
-00085cb0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-00085cc0: 274e 5f74 7273 2076 616c 6964 203d 2025  'N_trs valid = %
-00085cd0: 6927 2025 206e 7472 5f76 616c 6964 290a  i' % ntr_valid).
-00085ce0: 2020 2020 2020 2020 6465 6c20 6764 5f6c          del gd_l
-00085cf0: 7374 730a 0a20 2020 2065 6c73 653a 0a20  sts..    else:. 
-00085d00: 2020 2020 2020 2067 7466 5f6c 696e 6573         gtf_lines
-00085d10: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
-00085d20: 6164 5f67 7466 2867 7466 5f66 696c 652c  ad_gtf(gtf_file,
-00085d30: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
-00085d40: 2c20 686f 203d 2054 7275 6529 0a0a 2020  , ho = True)..  
-00085d50: 2020 2020 2020 666d 203d 207b 274d 273a        fm = {'M':
-00085d60: 2027 6578 6f6e 272c 2027 4927 3a20 2769   'exon', 'I': 'i
-00085d70: 6e73 6572 7369 6f6e 272c 2027 4427 3a20  nsersion', 'D': 
-00085d80: 2764 656c 6574 696f 6e27 7d0a 2020 2020  'deletion'}.    
-00085d90: 2020 2020 666f 7220 6d2c 2067 6420 696e      for m, gd in
-00085da0: 2065 6e75 6d65 7261 7465 2867 6473 293a   enumerate(gds):
-00085db0: 0a20 2020 2020 2020 2020 2020 2067 642e  .            gd.
-00085dc0: 7365 745f 636f 765f 6e5f 6162 6e5f 7468  set_cov_n_abn_th
-00085dd0: 2820 4d49 4e5f 434f 565f 544f 5f53 454c  ( MIN_COV_TO_SEL
-00085de0: 2c20 4d49 4e5f 4142 4e5f 544f 5f53 454c  , MIN_ABN_TO_SEL
-00085df0: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
-00085e00: 6620 286c 656e 2867 642e 7267 6e73 2e72  f (len(gd.rgns.r
-00085e10: 676e 7329 203e 2030 293a 0a20 2020 2020  gns) > 0):.     
-00085e20: 2020 2020 2020 2020 2020 2067 642e 6578             gd.ex
-00085e30: 6f6e 732e 7267 6e73 2c20 6764 2e72 676e  ons.rgns, gd.rgn
-00085e40: 732e 7267 6e73 203d 2067 642e 7267 6e73  s.rgns = gd.rgns
-00085e50: 2e72 676e 732c 2067 642e 6578 6f6e 732e  .rgns, gd.exons.
-00085e60: 7267 6e73 0a20 2020 2020 2020 2020 2020  rgns.           
-00085e70: 2020 2020 2067 642e 7465 5f74 6f5f 6765       gd.te_to_ge
-00085e80: 5f6d 6170 732c 2067 642e 7472 5f74 6f5f  _maps, gd.tr_to_
-00085e90: 6772 5f6d 6170 7320 3d20 6764 2e74 725f  gr_maps = gd.tr_
-00085ea0: 746f 5f67 725f 6d61 7073 2c20 6764 2e74  to_gr_maps, gd.t
-00085eb0: 655f 746f 5f67 655f 6d61 7073 0a20 2020  e_to_ge_maps.   
-00085ec0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00085ed0: 2020 2020 2020 2020 2020 666f 7220 7220            for r 
-00085ee0: 696e 2067 642e 6578 6f6e 732e 7267 6e73  in gd.exons.rgns
-00085ef0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00085f00: 2020 6966 2072 2e74 7970 6520 696e 2066    if r.type in f
-00085f10: 6d2e 6b65 7973 2829 3a0a 2020 2020 2020  m.keys():.      
-00085f20: 2020 2020 2020 2020 2020 2020 2020 722e                r.
-00085f30: 7479 7065 203d 2066 6d5b 722e 7479 7065  type = fm[r.type
-00085f40: 5d0a 0a20 2020 2020 2020 2063 6872 7320  ]..        chrs 
-00085f50: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-00085f60: 2067 6420 696e 2067 6473 3a20 0a20 2020   gd in gds: .   
-00085f70: 2020 2020 2020 2020 2063 6872 732e 6170           chrs.ap
-00085f80: 7065 6e64 2867 642e 6368 7229 0a0a 2020  pend(gd.chr)..  
-00085f90: 2020 2020 2020 6368 725f 6c73 7420 3d20        chr_lst = 
-00085fa0: 6c69 7374 2873 6574 2863 6872 7329 290a  list(set(chrs)).
-00085fb0: 2020 2020 2020 2020 6368 725f 6c73 742e          chr_lst.
-00085fc0: 736f 7274 2829 0a20 2020 2020 2020 2063  sort().        c
-00085fd0: 6872 7320 3d20 6e70 2e61 7272 6179 2863  hrs = np.array(c
-00085fe0: 6872 7329 0a0a 2020 2020 2020 2020 6e74  hrs)..        nt
-00085ff0: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
-00086000: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
-00086010: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
-00086020: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
-00086030: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
-00086040: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
-00086050: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
-00086060: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
-00086070: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
-00086080: 2020 2020 2020 2020 2020 2020 2020 7768                wh
-00086090: 203d 2077 6869 6368 2863 6872 7320 3d3d   = which(chrs ==
-000860a0: 2063 6872 6d29 0a20 2020 2020 2020 2020   chrm).         
-000860b0: 2020 2020 2020 2069 6620 6c65 6e28 7768         if len(wh
-000860c0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-000860d0: 2020 2020 2020 2020 2020 2073 5f70 6f73             s_pos
-000860e0: 203d 206e 702e 7a65 726f 7328 6c65 6e28   = np.zeros(len(
-000860f0: 7768 292c 6474 7970 653d 6e70 2e66 6c6f  wh),dtype=np.flo
-00086100: 6174 3332 290a 2020 2020 2020 2020 2020  at32).          
-00086110: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-00086120: 696e 2072 616e 6765 286c 656e 2877 6829  in range(len(wh)
-00086130: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
-00086140: 2020 2020 2020 2020 2020 2020 735f 706f              s_po
-00086150: 735b 6b5d 203d 2067 6473 5b77 685b 6b5d  s[k] = gds[wh[k]
-00086160: 5d2e 6265 6769 6e0a 2020 2020 2020 2020  ].begin.        
-00086170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086180: 6e74 725f 7661 6c69 6420 2b3d 2067 642e  ntr_valid += gd.
-00086190: 6e74 720a 2020 2020 2020 2020 2020 2020  ntr.            
-000861a0: 2020 2020 2020 2020 6f64 7220 3d20 735f          odr = s_
-000861b0: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
-000861c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000861d0: 2020 2063 6872 5f6c 7374 5f6e 6577 2e61     chr_lst_new.a
-000861e0: 7070 656e 6428 6368 726d 290a 2020 2020  ppend(chrm).    
-000861f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086200: 6767 635f 7475 706c 652e 6170 7065 6e64  ggc_tuple.append
-00086210: 2820 285b 2067 6473 5b77 685b 6f64 725b  ( ([ gds[wh[odr[
-00086220: 6b5d 5d5d 2066 6f72 206b 2069 6e20 7261  k]]] for k in ra
-00086230: 6e67 6528 6c65 6e28 7768 2929 205d 2c20  nge(len(wh)) ], 
-00086240: 6765 6e6f 6d65 5b63 6872 6d5d 2e73 6571  genome[chrm].seq
-00086250: 2c20 6368 726d 2920 290a 0a20 2020 2020  , chrm) )..     
-00086260: 2020 2023 2070 7269 6e74 2827 4e5f 7472     # print('N_tr
-00086270: 7320 7661 6c69 6420 3d20 2569 2720 2520  s valid = %i' % 
-00086280: 6e74 725f 7661 6c69 6429 0a20 2020 2020  ntr_valid).     
-00086290: 2020 2064 656c 2067 6473 0a0a 0a20 2020     del gds...   
-000862a0: 2066 696c 655f 6e61 6d65 203d 2067 7466   file_name = gtf
-000862b0: 5f66 696c 652e 7370 6c69 7428 272f 2729  _file.split('/')
-000862c0: 5b2d 315d 0a20 2020 2023 2066 6e61 6d65  [-1].    # fname
-000862d0: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
-000862e0: 6974 2827 2e27 295b 305d 0a20 2020 2066  it('.')[0].    f
-000862f0: 6e73 203d 2066 696c 655f 6e61 6d65 2e73  ns = file_name.s
-00086300: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
-00086310: 2020 2066 6e61 6d65 203d 2027 270a 2020     fname = ''.  
-00086320: 2020 666f 7220 6b2c 2066 6e20 696e 2065    for k, fn in e
-00086330: 6e75 6d65 7261 7465 2866 6e73 293a 0a20  numerate(fns):. 
-00086340: 2020 2020 2020 2069 6620 6b20 3e20 303a         if k > 0:
-00086350: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
-00086360: 6d65 203d 2066 6e61 6d65 202b 2027 2e27  me = fname + '.'
-00086370: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
-00086380: 2066 6e61 6d65 202b 2066 6e0a 0a20 2020   fname + fn..   
-00086390: 2069 6620 6f75 745f 6469 7220 6973 206e   if out_dir is n
-000863a0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000863b0: 2069 6620 6f75 745f 6469 725b 2d31 5d20   if out_dir[-1] 
-000863c0: 3d3d 2027 2f27 3a0a 2020 2020 2020 2020  == '/':.        
-000863d0: 2020 2020 666e 616d 6520 3d20 6f75 745f      fname = out_
-000863e0: 6469 7220 2b20 666e 616d 650a 2020 2020  dir + fname.    
-000863f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00086400: 2020 2020 2020 666e 616d 6520 3d20 6f75        fname = ou
-00086410: 745f 6469 7220 2b20 272f 2720 2b20 666e  t_dir + '/' + fn
-00086420: 616d 650a 0a20 2020 2067 656e 6f6d 655f  ame..    genome_
-00086430: 6669 6c65 5f6e 6577 203d 2066 6e61 6d65  file_new = fname
-00086440: 202b 2027 5f63 7573 746f 6d69 7a65 645f   + '_customized_
-00086450: 6765 6e6f 6d65 2e66 6127 0a20 2020 2067  genome.fa'.    g
-00086460: 7466 5f66 696c 655f 6e65 7720 3d20 666e  tf_file_new = fn
-00086470: 616d 6520 2b20 275f 6375 7374 6f6d 697a  ame + '_customiz
-00086480: 6564 2e67 7466 270a 2020 2020 6661 5f66  ed.gtf'.    fa_f
-00086490: 696c 655f 7472 5f6e 6577 203d 2066 6e61  ile_tr_new = fna
-000864a0: 6d65 202b 2027 5f74 7261 6e73 6372 6970  me + '_transcrip
-000864b0: 746f 6d65 2e66 6127 0a20 2020 2066 615f  tome.fa'.    fa_
-000864c0: 6669 6c65 5f70 725f 6e65 7720 3d20 666e  file_pr_new = fn
-000864d0: 616d 6520 2b20 275f 7072 6f74 656f 6d65  ame + '_proteome
-000864e0: 2e66 6127 0a20 2020 2066 6e61 6d65 5f73  .fa'.    fname_s
-000864f0: 6e76 203d 2066 6e61 6d65 202b 2027 5f73  nv = fname + '_s
-00086500: 6e76 5f73 756d 6d61 7279 2e74 7376 270a  nv_summary.tsv'.
-00086510: 2020 2020 666e 616d 655f 7663 6620 3d20      fname_vcf = 
-00086520: 666e 616d 6520 2b20 275f 736e 765f 7375  fname + '_snv_su
-00086530: 6d6d 6172 792e 7663 6627 0a0a 2020 2020  mmary.vcf'..    
-00086540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00085a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085a60: 2020 2020 2020 6367 203d 2054 7275 652c        cg = True,
+00085a70: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
+00085a80: 206e 5f63 6f72 6573 203d 2031 290a 2020   n_cores = 1).  
+00085a90: 2020 2020 2020 6764 5f6c 7374 732c 2063        gd_lsts, c
+00085aa0: 6872 5f6c 7374 203d 2070 6163 6b5f 6765  hr_lst = pack_ge
+00085ab0: 6e65 5f64 6573 6372 6970 746f 7228 2067  ne_descriptor( g
+00085ac0: 645f 6c73 742c 2063 6872 7320 290a 2020  d_lst, chrs ).  
+00085ad0: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
+00085ae0: 6f72 2067 646c 2069 6e20 6764 5f6c 7374  or gdl in gd_lst
+00085af0: 733a 200a 2020 2020 2020 2020 2020 2020  s: .            
+00085b00: 666f 7220 6d2c 2067 6420 696e 2065 6e75  for m, gd in enu
+00085b10: 6d65 7261 7465 2867 646c 293a 0a20 2020  merate(gdl):.   
+00085b20: 2020 2020 2020 2020 2020 2020 2067 642e               gd.
+00085b30: 7365 745f 636f 765f 6e5f 6162 6e5f 7468  set_cov_n_abn_th
+00085b40: 2820 4d49 4e5f 434f 565f 544f 5f53 454c  ( MIN_COV_TO_SEL
+00085b50: 2c20 4d49 4e5f 4142 4e5f 544f 5f53 454c  , MIN_ABN_TO_SEL
+00085b60: 2029 0a0a 2020 2020 2020 2020 6e74 725f   )..        ntr_
+00085b70: 7661 6c69 6420 3d20 300a 2020 2020 2020  valid = 0.      
+00085b80: 2020 6767 635f 7475 706c 6520 3d20 5b5d    ggc_tuple = []
+00085b90: 0a20 2020 2020 2020 2063 6872 5f6c 7374  .        chr_lst
+00085ba0: 5f6e 6577 203d 205b 5d0a 2020 2020 2020  _new = [].      
+00085bb0: 2020 666f 7220 6b6b 2c20 6368 726d 2069    for kk, chrm i
+00085bc0: 6e20 656e 756d 6572 6174 6528 6368 725f  n enumerate(chr_
+00085bd0: 6c73 7429 3a0a 2020 2020 2020 2020 2020  lst):.          
+00085be0: 2020 6966 2063 6872 6d20 696e 2067 656e    if chrm in gen
+00085bf0: 6f6d 652e 6b65 7973 2829 3a0a 2020 2020  ome.keys():.    
+00085c00: 2020 2020 2020 2020 2020 2020 6368 725f              chr_
+00085c10: 6c73 745f 6e65 772e 6170 7065 6e64 2863  lst_new.append(c
+00085c20: 6872 6d29 0a20 2020 2020 2020 2020 2020  hrm).           
+00085c30: 2020 2020 2067 6763 5f74 7570 6c65 2e61       ggc_tuple.a
+00085c40: 7070 656e 6428 2028 6764 5f6c 7374 735b  ppend( (gd_lsts[
+00085c50: 6b6b 5d2c 2067 656e 6f6d 655b 6368 726d  kk], genome[chrm
+00085c60: 5d2e 7365 712c 2063 6872 6d29 2029 0a20  ].seq, chrm) ). 
+00085c70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00085c80: 6f72 2067 6420 696e 2067 645f 6c73 7473  or gd in gd_lsts
+00085c90: 5b6b 6b5d 3a0a 2020 2020 2020 2020 2020  [kk]:.          
+00085ca0: 2020 2020 2020 2020 2020 6e74 725f 7661            ntr_va
+00085cb0: 6c69 6420 2b3d 2067 642e 6e74 720a 2020  lid += gd.ntr.  
+00085cc0: 2020 2020 2020 2320 7072 696e 7428 274e        # print('N
+00085cd0: 5f74 7273 2076 616c 6964 203d 2025 6927  _trs valid = %i'
+00085ce0: 2025 206e 7472 5f76 616c 6964 290a 2020   % ntr_valid).  
+00085cf0: 2020 2020 2020 6465 6c20 6764 5f6c 7374        del gd_lst
+00085d00: 730a 0a20 2020 2065 6c73 653a 0a20 2020  s..    else:.   
+00085d10: 2020 2020 2067 7466 5f6c 696e 6573 2c20       gtf_lines, 
+00085d20: 6864 725f 6c69 6e65 7320 3d20 6c6f 6164  hdr_lines = load
+00085d30: 5f67 7466 2867 7466 5f66 696c 652c 2076  _gtf(gtf_file, v
+00085d40: 6572 626f 7365 203d 2046 616c 7365 2c20  erbose = False, 
+00085d50: 686f 203d 2054 7275 6529 0a0a 2020 2020  ho = True)..    
+00085d60: 2020 2020 666d 203d 207b 274d 273a 2027      fm = {'M': '
+00085d70: 6578 6f6e 272c 2027 4927 3a20 2769 6e73  exon', 'I': 'ins
+00085d80: 6572 7369 6f6e 272c 2027 4427 3a20 2764  ersion', 'D': 'd
+00085d90: 656c 6574 696f 6e27 7d0a 2020 2020 2020  eletion'}.      
+00085da0: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
+00085db0: 6e75 6d65 7261 7465 2867 6473 293a 0a20  numerate(gds):. 
+00085dc0: 2020 2020 2020 2020 2020 2067 642e 7365             gd.se
+00085dd0: 745f 636f 765f 6e5f 6162 6e5f 7468 2820  t_cov_n_abn_th( 
+00085de0: 4d49 4e5f 434f 565f 544f 5f53 454c 2c20  MIN_COV_TO_SEL, 
+00085df0: 4d49 4e5f 4142 4e5f 544f 5f53 454c 2029  MIN_ABN_TO_SEL )
+00085e00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00085e10: 286c 656e 2867 642e 7267 6e73 2e72 676e  (len(gd.rgns.rgn
+00085e20: 7329 203e 2030 293a 0a20 2020 2020 2020  s) > 0):.       
+00085e30: 2020 2020 2020 2020 2067 642e 6578 6f6e           gd.exon
+00085e40: 732e 7267 6e73 2c20 6764 2e72 676e 732e  s.rgns, gd.rgns.
+00085e50: 7267 6e73 203d 2067 642e 7267 6e73 2e72  rgns = gd.rgns.r
+00085e60: 676e 732c 2067 642e 6578 6f6e 732e 7267  gns, gd.exons.rg
+00085e70: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
+00085e80: 2020 2067 642e 7465 5f74 6f5f 6765 5f6d     gd.te_to_ge_m
+00085e90: 6170 732c 2067 642e 7472 5f74 6f5f 6772  aps, gd.tr_to_gr
+00085ea0: 5f6d 6170 7320 3d20 6764 2e74 725f 746f  _maps = gd.tr_to
+00085eb0: 5f67 725f 6d61 7073 2c20 6764 2e74 655f  _gr_maps, gd.te_
+00085ec0: 746f 5f67 655f 6d61 7073 0a20 2020 2020  to_ge_maps.     
+00085ed0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00085ee0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+00085ef0: 2067 642e 6578 6f6e 732e 7267 6e73 3a0a   gd.exons.rgns:.
+00085f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085f10: 6966 2072 2e74 7970 6520 696e 2066 6d2e  if r.type in fm.
+00085f20: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+00085f30: 2020 2020 2020 2020 2020 2020 722e 7479              r.ty
+00085f40: 7065 203d 2066 6d5b 722e 7479 7065 5d0a  pe = fm[r.type].
+00085f50: 0a20 2020 2020 2020 2063 6872 7320 3d20  .        chrs = 
+00085f60: 5b5d 0a20 2020 2020 2020 2066 6f72 2067  [].        for g
+00085f70: 6420 696e 2067 6473 3a20 0a20 2020 2020  d in gds: .     
+00085f80: 2020 2020 2020 2063 6872 732e 6170 7065         chrs.appe
+00085f90: 6e64 2867 642e 6368 7229 0a0a 2020 2020  nd(gd.chr)..    
+00085fa0: 2020 2020 6368 725f 6c73 7420 3d20 6c69      chr_lst = li
+00085fb0: 7374 2873 6574 2863 6872 7329 290a 2020  st(set(chrs)).  
+00085fc0: 2020 2020 2020 6368 725f 6c73 742e 736f        chr_lst.so
+00085fd0: 7274 2829 0a20 2020 2020 2020 2063 6872  rt().        chr
+00085fe0: 7320 3d20 6e70 2e61 7272 6179 2863 6872  s = np.array(chr
+00085ff0: 7329 0a0a 2020 2020 2020 2020 6e74 725f  s)..        ntr_
+00086000: 7661 6c69 6420 3d20 300a 2020 2020 2020  valid = 0.      
+00086010: 2020 6767 635f 7475 706c 6520 3d20 5b5d    ggc_tuple = []
+00086020: 0a20 2020 2020 2020 2063 6872 5f6c 7374  .        chr_lst
+00086030: 5f6e 6577 203d 205b 5d0a 2020 2020 2020  _new = [].      
+00086040: 2020 666f 7220 6b6b 2c20 6368 726d 2069    for kk, chrm i
+00086050: 6e20 656e 756d 6572 6174 6528 6368 725f  n enumerate(chr_
+00086060: 6c73 7429 3a0a 2020 2020 2020 2020 2020  lst):.          
+00086070: 2020 6966 2063 6872 6d20 696e 2067 656e    if chrm in gen
+00086080: 6f6d 652e 6b65 7973 2829 3a0a 2020 2020  ome.keys():.    
+00086090: 2020 2020 2020 2020 2020 2020 7768 203d              wh =
+000860a0: 2077 6869 6368 2863 6872 7320 3d3d 2063   which(chrs == c
+000860b0: 6872 6d29 0a20 2020 2020 2020 2020 2020  hrm).           
+000860c0: 2020 2020 2069 6620 6c65 6e28 7768 2920       if len(wh) 
+000860d0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+000860e0: 2020 2020 2020 2020 2073 5f70 6f73 203d           s_pos =
+000860f0: 206e 702e 7a65 726f 7328 6c65 6e28 7768   np.zeros(len(wh
+00086100: 292c 6474 7970 653d 6e70 2e66 6c6f 6174  ),dtype=np.float
+00086110: 3332 290a 2020 2020 2020 2020 2020 2020  32).            
+00086120: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
+00086130: 2072 616e 6765 286c 656e 2877 6829 293a   range(len(wh)):
+00086140: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00086150: 2020 2020 2020 2020 2020 735f 706f 735b            s_pos[
+00086160: 6b5d 203d 2067 6473 5b77 685b 6b5d 5d2e  k] = gds[wh[k]].
+00086170: 6265 6769 6e0a 2020 2020 2020 2020 2020  begin.          
+00086180: 2020 2020 2020 2020 2020 2020 2020 6e74                nt
+00086190: 725f 7661 6c69 6420 2b3d 2067 642e 6e74  r_valid += gd.nt
+000861a0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+000861b0: 2020 2020 2020 6f64 7220 3d20 735f 706f        odr = s_po
+000861c0: 732e 6172 6773 6f72 7428 290a 0a20 2020  s.argsort()..   
+000861d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000861e0: 2063 6872 5f6c 7374 5f6e 6577 2e61 7070   chr_lst_new.app
+000861f0: 656e 6428 6368 726d 290a 2020 2020 2020  end(chrm).      
+00086200: 2020 2020 2020 2020 2020 2020 2020 6767                gg
+00086210: 635f 7475 706c 652e 6170 7065 6e64 2820  c_tuple.append( 
+00086220: 285b 2067 6473 5b77 685b 6f64 725b 6b5d  ([ gds[wh[odr[k]
+00086230: 5d5d 2066 6f72 206b 2069 6e20 7261 6e67  ]] for k in rang
+00086240: 6528 6c65 6e28 7768 2929 205d 2c20 6765  e(len(wh)) ], ge
+00086250: 6e6f 6d65 5b63 6872 6d5d 2e73 6571 2c20  nome[chrm].seq, 
+00086260: 6368 726d 2920 290a 0a20 2020 2020 2020  chrm) )..       
+00086270: 2023 2070 7269 6e74 2827 4e5f 7472 7320   # print('N_trs 
+00086280: 7661 6c69 6420 3d20 2569 2720 2520 6e74  valid = %i' % nt
+00086290: 725f 7661 6c69 6429 0a20 2020 2020 2020  r_valid).       
+000862a0: 2064 656c 2067 6473 0a0a 0a20 2020 2066   del gds...    f
+000862b0: 696c 655f 6e61 6d65 203d 2067 7466 5f66  ile_name = gtf_f
+000862c0: 696c 652e 7370 6c69 7428 272f 2729 5b2d  ile.split('/')[-
+000862d0: 315d 0a20 2020 2023 2066 6e61 6d65 203d  1].    # fname =
+000862e0: 2066 696c 655f 6e61 6d65 2e73 706c 6974   file_name.split
+000862f0: 2827 2e27 295b 305d 0a20 2020 2066 6e73  ('.')[0].    fns
+00086300: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
+00086310: 6974 2827 2e27 295b 3a2d 315d 0a20 2020  it('.')[:-1].   
+00086320: 2066 6e61 6d65 203d 2027 270a 2020 2020   fname = ''.    
+00086330: 666f 7220 6b2c 2066 6e20 696e 2065 6e75  for k, fn in enu
+00086340: 6d65 7261 7465 2866 6e73 293a 0a20 2020  merate(fns):.   
+00086350: 2020 2020 2069 6620 6b20 3e20 303a 0a20       if k > 0:. 
+00086360: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
+00086370: 203d 2066 6e61 6d65 202b 2027 2e27 0a20   = fname + '.'. 
+00086380: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
+00086390: 6e61 6d65 202b 2066 6e0a 0a20 2020 2069  name + fn..    i
+000863a0: 6620 6f75 745f 6469 7220 6973 206e 6f74  f out_dir is not
+000863b0: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+000863c0: 6620 6f75 745f 6469 725b 2d31 5d20 3d3d  f out_dir[-1] ==
+000863d0: 2027 2f27 3a0a 2020 2020 2020 2020 2020   '/':.          
+000863e0: 2020 666e 616d 6520 3d20 6f75 745f 6469    fname = out_di
+000863f0: 7220 2b20 666e 616d 650a 2020 2020 2020  r + fname.      
+00086400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00086410: 2020 2020 666e 616d 6520 3d20 6f75 745f      fname = out_
+00086420: 6469 7220 2b20 272f 2720 2b20 666e 616d  dir + '/' + fnam
+00086430: 650a 0a20 2020 2067 656e 6f6d 655f 6669  e..    genome_fi
+00086440: 6c65 5f6e 6577 203d 2066 6e61 6d65 202b  le_new = fname +
+00086450: 2027 5f63 7573 746f 6d69 7a65 645f 6765   '_customized_ge
+00086460: 6e6f 6d65 2e66 6127 0a20 2020 2067 7466  nome.fa'.    gtf
+00086470: 5f66 696c 655f 6e65 7720 3d20 666e 616d  _file_new = fnam
+00086480: 6520 2b20 275f 6375 7374 6f6d 697a 6564  e + '_customized
+00086490: 2e67 7466 270a 2020 2020 6661 5f66 696c  .gtf'.    fa_fil
+000864a0: 655f 7472 5f6e 6577 203d 2066 6e61 6d65  e_tr_new = fname
+000864b0: 202b 2027 5f74 7261 6e73 6372 6970 746f   + '_transcripto
+000864c0: 6d65 2e66 6127 0a20 2020 2066 615f 6669  me.fa'.    fa_fi
+000864d0: 6c65 5f70 725f 6e65 7720 3d20 666e 616d  le_pr_new = fnam
+000864e0: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
+000864f0: 6127 0a20 2020 2066 6e61 6d65 5f73 6e76  a'.    fname_snv
+00086500: 203d 2066 6e61 6d65 202b 2027 5f73 6e76   = fname + '_snv
+00086510: 5f73 756d 6d61 7279 2e74 7376 270a 2020  _summary.tsv'.  
+00086520: 2020 666e 616d 655f 7663 6620 3d20 666e    fname_vcf = fn
+00086530: 616d 6520 2b20 275f 736e 765f 7375 6d6d  ame + '_snv_summ
+00086540: 6172 792e 7663 6627 0a0a 2020 2020 2323  ary.vcf'..    ##
 00086550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00086560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086570: 2323 2323 2323 0a20 2020 2063 6872 5f6c  ######.    chr_l
-00086580: 7374 203d 2063 6872 5f6c 7374 5f6e 6577  st = chr_lst_new
-00086590: 0a0a 2020 2020 6f66 5f64 6963 7420 3d20  ..    of_dict = 
-000865a0: 7b7d 0a20 2020 2023 2067 6473 5f6c 7374  {}.    # gds_lst
-000865b0: 203d 205b 5d0a 2020 2020 2320 736e 765f   = [].    # snv_
-000865c0: 6c73 7420 3d20 5b5d 0a20 2020 2067 6473  lst = [].    gds
-000865d0: 5f6e 6577 203d 205b 5d0a 2020 2020 736e  _new = [].    sn
-000865e0: 765f 696e 666f 5f6c 7374 203d 205b 5d0a  v_info_lst = [].
-000865f0: 0a20 2020 206e 5f62 6173 6573 5f74 6f74  .    n_bases_tot
-00086600: 616c 203d 2030 0a20 2020 206e 5f65 725f  al = 0.    n_er_
-00086610: 6261 7365 7320 3d20 300a 2020 2020 6e5f  bases = 0.    n_
-00086620: 626c 6b5f 746f 7461 6c20 3d20 300a 2020  blk_total = 0.  
-00086630: 2020 6e5f 6572 5f62 6c6b 203d 2030 0a20    n_er_blk = 0. 
-00086640: 2020 206e 7074 203d 2030 0a20 2020 206e     npt = 0.    n
-00086650: 7065 203d 2030 0a20 2020 200a 2020 2020  pe = 0.    .    
-00086660: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
-00086670: 652e 7469 6d65 2829 0a20 2020 2069 6620  e.time().    if 
-00086680: 286e 5f63 6f72 6573 203d 3d20 3129 207c  (n_cores == 1) |
-00086690: 2028 6c65 6e28 6368 725f 6c73 7429 203d   (len(chr_lst) =
-000866a0: 3d20 3129 3a0a 2020 2020 2020 2020 666f  = 1):.        fo
-000866b0: 7220 6b6b 2069 6e20 7261 6e67 6528 6c65  r kk in range(le
-000866c0: 6e28 6368 725f 6c73 7429 293a 0a20 2020  n(chr_lst)):.   
-000866d0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000866e0: 5c72 2720 2b20 2720 272a 3130 302c 2065  \r' + ' '*100, e
-000866f0: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
-00086700: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00086710: 2070 7269 6e74 2827 5c72 5265 636f 6e73   print('\rRecons
-00086720: 7472 7563 7469 6e67 202e 2e20 2569 2f25  tructing .. %i/%
-00086730: 6920 2825 7329 2027 2025 2028 6b6b 2b31  i (%s) ' % (kk+1
-00086740: 2c20 6c65 6e28 6368 725f 6c73 7429 2c20  , len(chr_lst), 
-00086750: 6368 725f 6c73 745b 6b6b 5d29 2c20 656e  chr_lst[kk]), en
-00086760: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
-00086770: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00086780: 2020 6764 5f73 656c 2c20 7365 715f 6e65    gd_sel, seq_ne
-00086790: 772c 2073 6e76 5f69 6e66 6f5f 6368 722c  w, snv_info_chr,
-000867a0: 206f 662c 2063 6872 6d2c 2065 7374 6174   of, chrm, estat
-000867b0: 203d 206d 635f 636f 7265 5f72 6563 6f6e   = mc_core_recon
-000867c0: 7374 7275 6374 696f 6e28 6767 635f 7475  struction(ggc_tu
-000867d0: 706c 655b 6b6b 5d29 0a20 2020 2020 2020  ple[kk]).       
-000867e0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-000867f0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00086800: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
-00086810: 6d65 5b63 6872 6d5d 2e73 6571 203d 2073  me[chrm].seq = s
-00086820: 6571 5f6e 6577 0a20 2020 2020 2020 2020  eq_new.         
-00086830: 2020 206f 665f 6469 6374 5b63 6872 6d5d     of_dict[chrm]
-00086840: 203d 206f 660a 2020 2020 2020 2020 2020   = of.          
-00086850: 2020 2320 6764 735f 6c73 742e 6170 7065    # gds_lst.appe
-00086860: 6e64 2867 645f 7365 6c29 0a20 2020 2020  nd(gd_sel).     
-00086870: 2020 2020 2020 2023 2073 6e76 5f6c 7374         # snv_lst
-00086880: 2e61 7070 656e 6428 736e 765f 696e 666f  .append(snv_info
-00086890: 5f63 6872 290a 2020 2020 2020 2020 2020  _chr).          
-000868a0: 2020 6764 735f 6e65 7720 3d20 6764 735f    gds_new = gds_
-000868b0: 6e65 7720 2b20 6764 5f73 656c 0a20 2020  new + gd_sel.   
-000868c0: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
-000868d0: 6f5f 6c73 7420 3d20 736e 765f 696e 666f  o_lst = snv_info
-000868e0: 5f6c 7374 202b 2073 6e76 5f69 6e66 6f5f  _lst + snv_info_
-000868f0: 6368 720a 0a20 2020 2020 2020 2020 2020  chr..           
-00086900: 206e 6274 2c20 6e62 652c 206e 6c74 2c20   nbt, nbe, nlt, 
-00086910: 6e6c 652c 206e 742c 206e 653d 2065 7374  nle, nt, ne= est
-00086920: 6174 0a20 2020 2020 2020 2020 2020 206e  at.            n
-00086930: 5f62 6173 6573 5f74 6f74 616c 202b 3d20  _bases_total += 
-00086940: 6e62 740a 2020 2020 2020 2020 2020 2020  nbt.            
-00086950: 6e5f 6572 5f62 6173 6573 202b 3d20 6e62  n_er_bases += nb
-00086960: 650a 2020 2020 2020 2020 2020 2020 6e5f  e.            n_
-00086970: 626c 6b5f 746f 7461 6c20 2b3d 206e 6c74  blk_total += nlt
-00086980: 0a20 2020 2020 2020 2020 2020 206e 5f65  .            n_e
-00086990: 725f 626c 6b20 2b3d 206e 6c65 0a20 2020  r_blk += nle.   
-000869a0: 2020 2020 2020 2020 206e 7074 202b 3d20           npt += 
-000869b0: 6e74 0a20 2020 2020 2020 2020 2020 206e  nt.            n
-000869c0: 7065 202b 3d20 6e65 0a20 2020 2020 2020  pe += ne.       
-000869d0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-000869e0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-000869f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00086a00: 2020 6e75 6d5f 636f 7265 203d 206d 696e    num_core = min
-00086a10: 2820 6e5f 636f 7265 732c 2028 6370 755f  ( n_cores, (cpu_
-00086a20: 636f 756e 7428 2920 2d20 3129 2029 0a20  count() - 1) ). 
-00086a30: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
-00086a40: 6e75 6d20 636f 7265 7320 746f 2075 7365  num cores to use
-00086a50: 203d 207b 7d22 2e66 6f72 6d61 7428 6e75   = {}".format(nu
-00086a60: 6d5f 636f 7265 2929 0a20 2020 2020 2020  m_core)).       
-00086a70: 2070 6f6f 6c20 3d20 506f 6f6c 286e 756d   pool = Pool(num
-00086a80: 5f63 6f72 6529 0a20 2020 2020 2020 2063  _core).        c
-00086a90: 6e74 203d 2031 0a20 2020 2020 2020 2066  nt = 1.        f
-00086aa0: 6f72 2067 645f 7365 6c2c 2073 6571 5f6e  or gd_sel, seq_n
-00086ab0: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
-00086ac0: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
-00086ad0: 7420 696e 205c 0a20 2020 2020 2020 2020  t in \.         
-00086ae0: 2020 2070 6f6f 6c2e 696d 6170 5f75 6e6f     pool.imap_uno
-00086af0: 7264 6572 6564 286d 635f 636f 7265 5f72  rdered(mc_core_r
-00086b00: 6563 6f6e 7374 7275 6374 696f 6e2c 2067  econstruction, g
-00086b10: 6763 5f74 7570 6c65 293a 0a20 2020 2020  gc_tuple):.     
-00086b20: 2020 2020 2020 2023 2074 7164 6d2e 7471         # tqdm.tq
-00086b30: 646d 5f6e 6f74 6562 6f6f 6b28 706f 6f6c  dm_notebook(pool
-00086b40: 2e69 6d61 705f 756e 6f72 6465 7265 6428  .imap_unordered(
-00086b50: 6d63 5f63 6f72 655f 7265 636f 6e73 7472  mc_core_reconstr
-00086b60: 7563 7469 6f6e 2c20 6767 635f 7475 706c  uction, ggc_tupl
-00086b70: 6529 2c20 746f 7461 6c3d 6c65 6e28 6767  e), total=len(gg
-00086b80: 635f 7475 706c 6529 293a 0a20 2020 2020  c_tuple)):.     
-00086b90: 2020 2020 2020 2023 2323 2323 2323 2323         #########
-00086ba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086bb0: 230a 2020 2020 2020 2020 2020 2020 6765  #.            ge
-00086bc0: 6e6f 6d65 5b63 6872 6d5d 2e73 6571 203d  nome[chrm].seq =
-00086bd0: 2073 6571 5f6e 6577 0a20 2020 2020 2020   seq_new.       
-00086be0: 2020 2020 206f 665f 6469 6374 5b63 6872       of_dict[chr
-00086bf0: 6d5d 203d 206f 660a 2020 2020 2020 2020  m] = of.        
-00086c00: 2020 2020 2320 6764 735f 6c73 742e 6170      # gds_lst.ap
-00086c10: 7065 6e64 2867 645f 7365 6c29 0a20 2020  pend(gd_sel).   
-00086c20: 2020 2020 2020 2020 2023 2073 6e76 5f6c           # snv_l
-00086c30: 7374 2e61 7070 656e 6428 736e 765f 696e  st.append(snv_in
-00086c40: 666f 5f63 6872 290a 2020 2020 2020 2020  fo_chr).        
-00086c50: 2020 2020 6764 735f 6e65 7720 3d20 6764      gds_new = gd
-00086c60: 735f 6e65 7720 2b20 6764 5f73 656c 0a20  s_new + gd_sel. 
-00086c70: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
-00086c80: 6e66 6f5f 6c73 7420 3d20 736e 765f 696e  nfo_lst = snv_in
-00086c90: 666f 5f6c 7374 202b 2073 6e76 5f69 6e66  fo_lst + snv_inf
-00086ca0: 6f5f 6368 720a 2020 2020 2020 2020 2020  o_chr.          
-00086cb0: 2020 0a20 2020 2020 2020 2020 2020 206e    .            n
-00086cc0: 6274 2c20 6e62 652c 206e 6c74 2c20 6e6c  bt, nbe, nlt, nl
-00086cd0: 652c 206e 742c 206e 653d 2065 7374 6174  e, nt, ne= estat
-00086ce0: 0a20 2020 2020 2020 2020 2020 206e 5f62  .            n_b
-00086cf0: 6173 6573 5f74 6f74 616c 202b 3d20 6e62  ases_total += nb
-00086d00: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
-00086d10: 6572 5f62 6173 6573 202b 3d20 6e62 650a  er_bases += nbe.
-00086d20: 2020 2020 2020 2020 2020 2020 6e5f 626c              n_bl
-00086d30: 6b5f 746f 7461 6c20 2b3d 206e 6c74 0a20  k_total += nlt. 
-00086d40: 2020 2020 2020 2020 2020 206e 5f65 725f             n_er_
-00086d50: 626c 6b20 2b3d 206e 6c65 0a20 2020 2020  blk += nle.     
-00086d60: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
-00086d70: 0a20 2020 2020 2020 2020 2020 206e 7065  .            npe
-00086d80: 202b 3d20 6e65 0a20 2020 2020 2020 2020   += ne.         
-00086d90: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00086da0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00086db0: 2020 2020 2020 2020 2020 636e 7420 2b3d            cnt +=
-00086dc0: 2031 0a20 2020 2020 2020 2020 2020 2070   1.            p
-00086dd0: 7269 6e74 2827 5c72 5265 636f 6e73 7472  rint('\rReconstr
-00086de0: 7563 7469 6e67 2028 2569 2920 2e2e 2025  ucting (%i) .. %
-00086df0: 692f 2569 2028 2573 2920 2020 2020 2020  i/%i (%s)       
-00086e00: 2020 2020 2027 2025 2028 6e75 6d5f 636f       ' % (num_co
-00086e10: 7265 2c20 636e 742c 206c 656e 2867 6763  re, cnt, len(ggc
-00086e20: 5f74 7570 6c65 292c 2063 6872 6d29 2c20  _tuple), chrm), 
-00086e30: 656e 6420 3d20 2720 2020 2020 2020 2020  end = '         
-00086e40: 2020 2020 2020 2020 2020 2020 2729 0a20              '). 
-00086e50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00086e60: 2020 2020 706f 6f6c 2e63 6c6f 7365 2829      pool.close()
-00086e70: 0a20 2020 2020 2020 2070 6f6f 6c2e 6a6f  .        pool.jo
-00086e80: 696e 2829 0a20 2020 2020 2020 200a 2020  in().        .  
-00086e90: 2020 2727 270a 2020 2020 6764 735f 6e65    '''.    gds_ne
-00086ea0: 7720 3d20 5b5d 0a20 2020 2073 6e76 5f69  w = [].    snv_i
-00086eb0: 6e66 6f5f 6c73 7420 3d20 5b5d 0a20 2020  nfo_lst = [].   
-00086ec0: 2066 6f72 206b 6b2c 2063 6872 6d20 696e   for kk, chrm in
-00086ed0: 2065 6e75 6d65 7261 7465 2863 6872 5f6c   enumerate(chr_l
-00086ee0: 7374 293a 0a20 2020 2020 2020 2067 6473  st):.        gds
-00086ef0: 5f6e 6577 203d 2067 6473 5f6e 6577 202b  _new = gds_new +
-00086f00: 2067 6473 5f6c 7374 5b6b 6b5d 0a20 2020   gds_lst[kk].   
-00086f10: 2020 2020 2073 6e76 5f69 6e66 6f5f 6c73       snv_info_ls
-00086f20: 7420 3d20 736e 765f 696e 666f 5f6c 7374  t = snv_info_lst
-00086f30: 202b 2073 6e76 5f6c 7374 5b6b 6b5d 0a0a   + snv_lst[kk]..
-00086f40: 2020 2020 6465 6c20 6764 735f 6c73 740a      del gds_lst.
-00086f50: 2020 2020 2327 2727 0a20 2020 2020 0a20      #'''.     . 
-00086f60: 2020 2065 6c61 7073 6564 5f74 696d 6532     elapsed_time2
-00086f70: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
-00086f80: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
-00086f90: 7072 696e 7428 275c 7252 6563 6f6e 7374  print('\rReconst
-00086fa0: 7275 6374 696f 6e20 2e2e 2064 6f6e 652e  ruction .. done.
-00086fb0: 2028 2569 2920 2020 2020 2020 2020 2020   (%i)           
-00086fc0: 2027 2025 2028 656c 6170 7365 645f 7469   ' % (elapsed_ti
-00086fd0: 6d65 3229 2c20 666c 7573 6820 3d20 5472  me2), flush = Tr
-00086fe0: 7565 290a 2020 2020 7072 696e 7428 2749  ue).    print('I
-00086ff0: 6e74 6567 7269 7479 2063 6865 636b 3a20  ntegrity check: 
-00087000: 2025 692f 2569 2c20 2569 2f25 692c 2025   %i/%i, %i/%i, %
-00087010: 692f 2569 2720 2520 5c0a 2020 2020 2020  i/%i' % \.      
-00087020: 2020 2020 286e 5f65 725f 6261 7365 732c      (n_er_bases,
-00087030: 206e 5f62 6173 6573 5f74 6f74 616c 2c20   n_bases_total, 
-00087040: 6e5f 6572 5f62 6c6b 2c20 6e5f 626c 6b5f  n_er_blk, n_blk_
-00087050: 746f 7461 6c2c 206e 7065 2c20 6e70 7429  total, npe, npt)
-00087060: 2c20 666c 7573 6820 3d20 5472 7565 2029  , flush = True )
-00087070: 0a20 2020 2020 200a 2020 2020 2727 2720  .      .    ''' 
-00087080: 200a 2020 2020 4e74 725f 616c 6c20 3d20   .    Ntr_all = 
-00087090: 300a 2020 2020 666f 7220 6764 2069 6e20  0.    for gd in 
-000870a0: 6764 735f 6e65 773a 204e 7472 5f61 6c6c  gds_new: Ntr_all
-000870b0: 202b 3d20 6764 2e6e 7472 0a20 2020 2070   += gd.ntr.    p
-000870c0: 7269 6e74 2827 4e5f 7472 2028 6166 7465  rint('N_tr (afte
-000870d0: 7229 203d 2025 6927 2025 204e 7472 5f61  r) = %i' % Ntr_a
-000870e0: 6c6c 290a 0a20 2020 206e 5f74 7220 3d20  ll)..    n_tr = 
-000870f0: 300a 2020 2020 6e5f 6e65 675f 636f 7620  0.    n_neg_cov 
-00087100: 3d20 300a 2020 2020 6e5f 706f 735f 636f  = 0.    n_pos_co
-00087110: 7620 3d20 300a 2020 2020 666f 7220 6764  v = 0.    for gd
-00087120: 2069 6e20 6764 735f 6e65 773a 0a20 2020   in gds_new:.   
-00087130: 2020 2020 206e 5f74 7220 2b3d 2067 642e       n_tr += gd.
-00087140: 6e74 720a 2020 2020 2020 2020 666f 7220  ntr.        for 
-00087150: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
-00087160: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00087170: 7464 2e63 6f76 203c 3d20 303a 206e 5f6e  td.cov <= 0: n_n
-00087180: 6567 5f63 6f76 202b 3d20 310a 2020 2020  eg_cov += 1.    
-00087190: 2020 2020 2020 2020 656c 6966 2074 642e          elif td.
-000871a0: 636f 7620 3e20 303a 206e 5f70 6f73 5f63  cov > 0: n_pos_c
-000871b0: 6f76 202b 3d20 310a 2020 2020 7072 696e  ov += 1.    prin
-000871c0: 7428 274e 5f74 7273 203d 2025 692c 2025  t('N_trs = %i, %
-000871d0: 692c 2025 6927 2025 2028 6e5f 7472 2c20  i, %i' % (n_tr, 
-000871e0: 6e5f 6e65 675f 636f 762c 206e 5f70 6f73  n_neg_cov, n_pos
-000871f0: 5f63 6f76 2929 0a20 2020 2023 2727 270a  _cov)).    #'''.
-00087200: 2020 2020 2020 2020 0a20 2020 2073 7461          .    sta
-00087210: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
-00087220: 696d 6528 290a 2020 2020 6774 665f 6c69  ime().    gtf_li
-00087230: 6e65 7320 3d20 5b5d 0a20 2020 2066 615f  nes = [].    fa_
-00087240: 6c69 6e65 735f 7472 203d 205b 5d0a 2020  lines_tr = [].  
-00087250: 2020 6661 5f6c 696e 6573 5f70 7220 3d20    fa_lines_pr = 
-00087260: 5b5d 0a0a 2020 2020 2320 7361 7665 5f67  []..    # save_g
-00087270: 7466 3228 2066 6e61 6d65 2c20 6774 665f  tf2( fname, gtf_
-00087280: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
-00087290: 2068 6472 203d 204e 6f6e 652c 2066 6f20   hdr = None, fo 
-000872a0: 3d20 4e6f 6e65 2063 6c6f 7365 203d 2046  = None close = F
-000872b0: 616c 7365 2029 0a20 2020 200a 2020 2020  alse ).    .    
-000872c0: 6966 2072 6576 3a20 0a20 2020 2020 2020  if rev: .       
-000872d0: 2068 6472 5f6c 696e 6573 2e61 7070 656e   hdr_lines.appen
-000872e0: 6428 2752 6566 2e20 6765 6e6f 6d65 3a20  d('Ref. genome: 
-000872f0: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
-00087300: 6529 0a20 2020 2020 2020 2066 5f67 7466  e).        f_gtf
-00087310: 203d 2073 6176 655f 6774 6632 2820 6774   = save_gtf2( gt
-00087320: 665f 6669 6c65 5f6e 6577 2c20 6774 665f  f_file_new, gtf_
-00087330: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
-00087340: 2068 6472 203d 2068 6472 5f6c 696e 6573   hdr = hdr_lines
-00087350: 2029 0a0a 2020 2020 6674 203d 206f 7065   )..    ft = ope
-00087360: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
-00087370: 2c20 2777 2b27 290a 2020 2020 6670 203d  , 'w+').    fp =
-00087380: 206f 7065 6e28 6661 5f66 696c 655f 7072   open(fa_file_pr
-00087390: 5f6e 6577 2c20 2777 2b27 290a 0a20 2020  _new, 'w+')..   
-000873a0: 2067 6473 5f6e 6577 203d 2073 6f72 745f   gds_new = sort_
-000873b0: 6465 7363 7269 7074 6f72 5f6c 7374 2867  descriptor_lst(g
-000873c0: 6473 5f6e 6577 290a 2020 2020 636e 745f  ds_new).    cnt_
-000873d0: 6e6f 6e65 203d 2030 0a20 2020 2070 7269  none = 0.    pri
-000873e0: 6e74 2827 4765 6e65 7261 7469 6e67 2047  nt('Generating G
-000873f0: 5446 2061 6e64 2054 7261 6e73 6372 6970  TF and Transcrip
-00087400: 746f 6d65 2f50 726f 7465 6f6d 6520 2e2e  tome/Proteome ..
-00087410: 2027 2c20 656e 643d 2720 2020 2027 290a   ', end='    ').
-00087420: 0a20 2020 2069 6620 6e5f 636f 7265 7320  .    if n_cores 
-00087430: 3d3d 2031 3a0a 2020 2020 2020 2020 636e  == 1:.        cn
-00087440: 745f 7420 3d20 300a 2020 2020 2020 2020  t_t = 0.        
-00087450: 636e 745f 7020 3d20 300a 2020 2020 2020  cnt_p = 0.      
-00087460: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
-00087470: 6e75 6d65 7261 7465 2867 6473 5f6e 6577  numerate(gds_new
-00087480: 293a 0a20 2020 2020 2020 2020 2020 200a  ):.            .
-00087490: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000874a0: 6d2b 3129 2531 3030 203d 3d20 303a 2070  m+1)%100 == 0: p
-000874b0: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
-000874c0: 6e67 2047 5446 2061 6e64 2054 7261 6e73  ng GTF and Trans
-000874d0: 6372 6970 746f 6d65 2f50 726f 7465 6f6d  criptome/Proteom
-000874e0: 6520 2e2e 2025 692f 2569 2720 2520 286d  e .. %i/%i' % (m
-000874f0: 2c20 6c65 6e28 6764 735f 6e65 7729 292c  , len(gds_new)),
-00087500: 2065 6e64 203d 2027 2020 2027 2c20 666c   end = '   ', fl
-00087510: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-00087520: 2020 2020 2020 2020 6e74 722c 206e 7072          ntr, npr
-00087530: 2c20 6e65 7220 3d20 6764 2e75 7064 6174  , ner = gd.updat
-00087540: 655f 7464 5f69 6e66 6f28 7365 6c20 3d20  e_td_info(sel = 
-00087550: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
-00087560: 6529 2020 2020 2020 2020 2020 2020 0a20  e)            . 
-00087570: 2020 2020 2020 2020 2020 2067 7466 6c2c             gtfl,
-00087580: 2063 6e20 3d20 6764 2e67 6574 5f67 7466   cn = gd.get_gtf
-00087590: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
-000875a0: 7328 7365 6c20 3d20 312c 2061 6464 5f73  s(sel = 1, add_s
-000875b0: 6571 203d 2046 616c 7365 2c20 636f 6e6e  eq = False, conn
-000875c0: 6563 7420 3d20 5472 7565 290a 2020 2020  ect = True).    
-000875d0: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
-000875e0: 202b 3d20 636e 0a20 2020 2020 2020 2020   += cn.         
-000875f0: 2020 206c 742c 206c 7020 3d20 6764 2e67     lt, lp = gd.g
-00087600: 6574 5f66 6173 7461 5f6c 696e 6573 5f66  et_fasta_lines_f
-00087610: 726f 6d5f 6578 6f6e 7328 7365 6c20 3d20  rom_exons(sel = 
-00087620: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
-00087630: 6529 0a20 2020 2020 2020 2020 2020 206c  e).            l
-00087640: 7420 3d20 6669 6c74 6572 5f74 7273 5f6c  t = filter_trs_l
-00087650: 656e 286c 742c 206d 696e 5f6c 656e 203d  en(lt, min_len =
-00087660: 204d 494e 5f54 525f 4c45 4e47 5448 290a   MIN_TR_LENGTH).
-00087670: 2020 2020 2020 2020 2020 2020 6c70 203d              lp =
-00087680: 2066 696c 7465 725f 7472 735f 6c65 6e28   filter_trs_len(
-00087690: 6c70 2c20 6d69 6e5f 6c65 6e20 3d20 4d49  lp, min_len = MI
-000876a0: 4e5f 5052 5f4c 454e 4754 4829 0a20 2020  N_PR_LENGTH).   
-000876b0: 2020 2020 2020 2020 2069 6620 7265 763a           if rev:
-000876c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000876d0: 2066 5f67 7466 203d 2073 6176 655f 6774   f_gtf = save_gt
-000876e0: 6632 2820 6774 665f 6669 6c65 5f6e 6577  f2( gtf_file_new
-000876f0: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
-00087700: 2067 7466 6c2c 2066 6f20 3d20 665f 6774   gtfl, fo = f_gt
-00087710: 6620 2920 0a20 2020 2020 2020 2020 2020  f ) .           
-00087720: 2020 2020 2023 2067 7466 5f6c 696e 6573       # gtf_lines
-00087730: 203d 2067 7466 5f6c 696e 6573 202b 2067   = gtf_lines + g
-00087740: 7466 6c0a 2020 2020 2020 2020 0a20 2020  tfl.        .   
-00087750: 2020 2020 2020 2020 2066 742e 7772 6974           ft.writ
-00087760: 656c 696e 6573 286c 7429 0a20 2020 2020  elines(lt).     
-00087770: 2020 2020 2020 2066 702e 7772 6974 656c         fp.writel
-00087780: 696e 6573 286c 7029 0a20 2020 2020 2020  ines(lp).       
-00087790: 2020 2020 2023 2066 615f 6c69 6e65 735f       # fa_lines_
-000877a0: 7472 203d 2066 615f 6c69 6e65 735f 7472  tr = fa_lines_tr
-000877b0: 202b 206c 740a 2020 2020 2020 2020 2020   + lt.          
-000877c0: 2020 2320 6661 5f6c 696e 6573 5f70 7220    # fa_lines_pr 
-000877d0: 3d20 6661 5f6c 696e 6573 5f70 7220 2b20  = fa_lines_pr + 
-000877e0: 6c70 0a20 2020 2020 2020 2020 2020 2063  lp.            c
-000877f0: 6e74 5f74 202b 3d20 6c65 6e28 6c74 290a  nt_t += len(lt).
-00087800: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-00087810: 7020 2b3d 206c 656e 286c 7029 0a20 2020  p += len(lp).   
-00087820: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00087830: 2020 656c 6170 7365 645f 7469 6d65 3220    elapsed_time2 
-00087840: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
-00087850: 7374 6172 745f 7469 6d65 0a20 2020 2020  start_time.     
-00087860: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
-00087870: 7261 7469 6e67 2047 5446 2061 6e64 2054  rating GTF and T
-00087880: 7261 6e73 6372 6970 746f 6d65 2f50 726f  ranscriptome/Pro
-00087890: 7465 6f6d 6520 2e2e 2025 692c 2025 6920  teome .. %i, %i 
-000878a0: 646f 6e65 2e20 2825 6929 2027 2025 2028  done. (%i) ' % (
-000878b0: 6c65 6e28 6764 735f 6e65 7729 2c20 636e  len(gds_new), cn
-000878c0: 745f 6e6f 6e65 2c20 656c 6170 7365 645f  t_none, elapsed_
-000878d0: 7469 6d65 3229 2c20 666c 7573 6820 3d20  time2), flush = 
-000878e0: 5472 7565 290a 0a20 2020 2065 6c73 653a  True)..    else:
-000878f0: 0a20 2020 2020 2020 206e 756d 5f63 6f72  .        num_cor
-00087900: 6520 3d20 6d69 6e28 206e 5f63 6f72 6573  e = min( n_cores
-00087910: 2c20 2863 7075 5f63 6f75 6e74 2829 202d  , (cpu_count() -
-00087920: 2031 2920 290a 2020 2020 2020 2020 2320   1) ).        # 
-00087930: 7072 696e 7428 226e 756d 2063 6f72 6573  print("num cores
-00087940: 2074 6f20 7573 6520 3d20 7b7d 222e 666f   to use = {}".fo
-00087950: 726d 6174 286e 756d 5f63 6f72 6529 290a  rmat(num_core)).
-00087960: 2020 2020 2020 2020 706f 6f6c 203d 2050          pool = P
-00087970: 6f6f 6c28 6e75 6d5f 636f 7265 290a 2020  ool(num_core).  
-00087980: 2020 2020 2020 636e 7420 3d20 310a 2020        cnt = 1.  
-00087990: 2020 2020 2020 636e 745f 7420 3d20 300a        cnt_t = 0.
-000879a0: 2020 2020 2020 2020 636e 745f 7020 3d20          cnt_p = 
-000879b0: 300a 2020 2020 2020 2020 666f 7220 6774  0.        for gt
-000879c0: 666c 2c20 6c74 2c20 6c70 2c20 6368 726d  fl, lt, lp, chrm
-000879d0: 2c20 6e65 2c20 636e 2069 6e20 706f 6f6c  , ne, cn in pool
-000879e0: 2e6d 6170 286d 635f 636f 7265 5f67 6574  .map(mc_core_get
-000879f0: 5f67 7466 5f61 6e64 5f66 6173 7461 5f70  _gtf_and_fasta_p
-00087a00: 742c 2067 6473 5f6e 6577 293a 0a20 2020  t, gds_new):.   
-00087a10: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00087a20: 2020 2020 2020 636e 745f 6e6f 6e65 202b        cnt_none +
-00087a30: 3d20 636e 0a20 2020 2020 2020 2020 2020  = cn.           
-00087a40: 2069 6620 2863 6e74 2b31 2925 3130 3020   if (cnt+1)%100 
-00087a50: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00087a60: 2020 2020 2020 7072 696e 7428 275c 7247        print('\rG
-00087a70: 656e 6572 6174 696e 6720 4754 4620 616e  enerating GTF an
-00087a80: 6420 5472 616e 7363 7269 7074 6f6d 652f  d Transcriptome/
-00087a90: 5072 6f74 656f 6d65 202e 2e20 2569 2f25  Proteome .. %i/%
-00087aa0: 6927 2025 2028 636e 742c 206c 656e 2867  i' % (cnt, len(g
-00087ab0: 6473 5f6e 6577 2929 2c20 656e 6420 3d20  ds_new)), end = 
-00087ac0: 2720 2020 2729 0a20 2020 2020 2020 2020  '   ').         
-00087ad0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00087ae0: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
-00087af0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00087b00: 2020 2020 2020 2020 2020 6c74 203d 2066            lt = f
-00087b10: 696c 7465 725f 7472 735f 6c65 6e28 6c74  ilter_trs_len(lt
-00087b20: 2c20 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f  , min_len = MIN_
-00087b30: 5452 5f4c 454e 4754 4829 0a20 2020 2020  TR_LENGTH).     
-00087b40: 2020 2020 2020 206c 7020 3d20 6669 6c74         lp = filt
-00087b50: 6572 5f74 7273 5f6c 656e 286c 702c 206d  er_trs_len(lp, m
-00087b60: 696e 5f6c 656e 203d 204d 494e 5f50 525f  in_len = MIN_PR_
-00087b70: 4c45 4e47 5448 290a 2020 2020 2020 2020  LENGTH).        
-00087b80: 2020 2020 6966 2072 6576 3a0a 2020 2020      if rev:.    
-00087b90: 2020 2020 2020 2020 2020 2020 665f 6774              f_gt
-00087ba0: 6620 3d20 7361 7665 5f67 7466 3228 2067  f = save_gtf2( g
-00087bb0: 7466 5f66 696c 655f 6e65 772c 2067 7466  tf_file_new, gtf
-00087bc0: 5f6c 696e 655f 6c73 7420 3d20 6774 666c  _line_lst = gtfl
-00087bd0: 2c20 666f 203d 2066 5f67 7466 2029 2020  , fo = f_gtf )  
-00087be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00087bf0: 2023 2067 7466 5f6c 696e 6573 203d 2067   # gtf_lines = g
-00087c00: 7466 5f6c 696e 6573 202b 2067 7466 6c0a  tf_lines + gtfl.
-00087c10: 0a20 2020 2020 2020 2020 2020 2066 742e  .            ft.
-00087c20: 7772 6974 656c 696e 6573 286c 7429 0a20  writelines(lt). 
-00087c30: 2020 2020 2020 2020 2020 2066 702e 7772             fp.wr
-00087c40: 6974 656c 696e 6573 286c 7029 0a20 2020  itelines(lp).   
-00087c50: 2020 2020 2020 2020 2023 2066 615f 6c69           # fa_li
-00087c60: 6e65 735f 7472 203d 2066 615f 6c69 6e65  nes_tr = fa_line
-00087c70: 735f 7472 202b 206c 740a 2020 2020 2020  s_tr + lt.      
-00087c80: 2020 2020 2020 2320 6661 5f6c 696e 6573        # fa_lines
-00087c90: 5f70 7220 3d20 6661 5f6c 696e 6573 5f70  _pr = fa_lines_p
-00087ca0: 7220 2b20 6c70 0a20 2020 2020 2020 2020  r + lp.         
-00087cb0: 2020 2063 6e74 5f74 202b 3d20 6c65 6e28     cnt_t += len(
-00087cc0: 6c74 290a 2020 2020 2020 2020 2020 2020  lt).            
-00087cd0: 636e 745f 7020 2b3d 206c 656e 286c 7029  cnt_p += len(lp)
-00087ce0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00087cf0: 2020 2020 2020 706f 6f6c 2e63 6c6f 7365        pool.close
-00087d00: 2829 0a20 2020 2020 2020 2070 6f6f 6c2e  ().        pool.
-00087d10: 6a6f 696e 2829 0a0a 2020 2020 2020 2020  join()..        
-00087d20: 656c 6170 7365 645f 7469 6d65 3220 3d20  elapsed_time2 = 
-00087d30: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00087d40: 6172 745f 7469 6d65 0a20 2020 2020 2020  art_time.       
-00087d50: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
-00087d60: 7469 6e67 2047 5446 2061 6e64 2054 7261  ting GTF and Tra
-00087d70: 6e73 6372 6970 746f 6d65 2f50 726f 7465  nscriptome/Prote
-00087d80: 6f6d 6520 2e2e 2064 6f6e 652e 2025 692c  ome .. done. %i,
-00087d90: 2025 692c 2025 6920 2825 6929 2027 2025   %i, %i (%i) ' %
-00087da0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00087db0: 2028 636e 745f 6e6f 6e65 2c20 696e 7428   (cnt_none, int(
-00087dc0: 636e 745f 742f 3229 2c20 696e 7428 636e  cnt_t/2), int(cn
-00087dd0: 745f 702f 3229 2c20 656c 6170 7365 645f  t_p/2), elapsed_
-00087de0: 7469 6d65 3229 290a 2020 2020 2020 2020  time2)).        
-00087df0: 0a20 2020 2069 6620 7265 763a 2073 6176  .    if rev: sav
-00087e00: 655f 6774 6632 2820 6774 665f 6669 6c65  e_gtf2( gtf_file
-00087e10: 5f6e 6577 2c20 6774 665f 6c69 6e65 5f6c  _new, gtf_line_l
-00087e20: 7374 203d 204e 6f6e 652c 2066 6f20 3d20  st = None, fo = 
-00087e30: 665f 6774 662c 2063 6c6f 7365 203d 2054  f_gtf, close = T
-00087e40: 7275 6520 290a 2020 2020 6674 2e63 6c6f  rue ).    ft.clo
-00087e50: 7365 2829 0a20 2020 2066 702e 636c 6f73  se().    fp.clos
-00087e60: 6528 290a 0a20 2020 2023 2064 656c 2067  e()..    # del g
-00087e70: 6473 5f6e 6577 0a0a 2020 2020 2727 2720  ds_new..    ''' 
-00087e80: 2020 200a 2020 2020 7374 6172 745f 7469     .    start_ti
-00087e90: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00087ea0: 0a20 2020 2070 7269 6e74 2827 5361 7669  .    print('Savi
-00087eb0: 6e67 2046 4153 5441 2028 2569 2c20 2569  ng FASTA (%i, %i
-00087ec0: 202f 2025 6929 202e 2e27 2025 2028 6c65   / %i) ..' % (le
-00087ed0: 6e28 6661 5f6c 696e 6573 5f74 7229 2f32  n(fa_lines_tr)/2
-00087ee0: 2c20 6c65 6e28 6661 5f6c 696e 6573 5f70  , len(fa_lines_p
-00087ef0: 7229 2f32 2c20 6e5f 7472 292c 2065 6e64  r)/2, n_tr), end
-00087f00: 203d 2027 272c 2066 6c75 7368 203d 2054   = '', flush = T
-00087f10: 7275 6529 0a20 2020 2066 203d 206f 7065  rue).    f = ope
-00087f20: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
-00087f30: 2c20 2777 2b27 290a 2020 2020 662e 7772  , 'w+').    f.wr
-00087f40: 6974 656c 696e 6573 2866 615f 6c69 6e65  itelines(fa_line
-00087f50: 735f 7472 290a 2020 2020 662e 636c 6f73  s_tr).    f.clos
-00087f60: 6528 290a 0a20 2020 2070 7269 6e74 2827  e()..    print('
-00087f70: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
-00087f80: 6620 3d20 6f70 656e 2866 615f 6669 6c65  f = open(fa_file
-00087f90: 5f70 725f 6e65 772c 2027 772b 2729 0a20  _pr_new, 'w+'). 
-00087fa0: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
-00087fb0: 6661 5f6c 696e 6573 5f70 7229 0a20 2020  fa_lines_pr).   
-00087fc0: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
-00087fd0: 656c 6170 7365 645f 7469 6d65 203d 2074  elapsed_time = t
-00087fe0: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00087ff0: 7274 5f74 696d 650a 2020 2020 7072 696e  rt_time.    prin
-00088000: 7428 2720 646f 6e65 2e20 2825 6929 2720  t(' done. (%i)' 
-00088010: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
-00088020: 290a 2020 2020 2727 270a 0a20 2020 2070  ).    '''..    p
-00088030: 7269 6e74 2827 2020 2025 7327 2025 2066  rint('   %s' % f
-00088040: 615f 6669 6c65 5f74 725f 6e65 7720 290a  a_file_tr_new ).
-00088050: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
-00088060: 2720 2520 6661 5f66 696c 655f 7072 5f6e  ' % fa_file_pr_n
-00088070: 6577 2029 0a20 2020 2069 6620 7265 763a  ew ).    if rev:
-00088080: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
-00088090: 2067 7466 5f66 696c 655f 6e65 7729 0a0a   gtf_file_new)..
-000880a0: 2020 2020 736e 765f 6c73 7420 3d20 5b5d      snv_lst = []
-000880b0: 0a20 2020 2066 6f72 2073 6e76 2069 6e20  .    for snv in 
-000880c0: 736e 765f 696e 666f 5f6c 7374 3a0a 2020  snv_info_lst:.  
-000880d0: 2020 2020 2020 6e76 6920 3d20 746f 5f6e        nvi = to_n
-000880e0: 765f 7369 6d70 6c65 2820 736e 7620 290a  v_simple( snv ).
-000880f0: 2020 2020 2020 2020 736e 765f 6c73 742e          snv_lst.
-00088100: 6170 7065 6e64 286e 7669 290a 2020 2020  append(nvi).    
-00088110: 2020 2020 0a20 2020 2064 665f 736e 7620      .    df_snv 
-00088120: 3d20 7064 2e44 6174 6146 7261 6d65 2873  = pd.DataFrame(s
-00088130: 6e76 5f6c 7374 290a 2020 2020 6466 5f73  nv_lst).    df_s
-00088140: 6e76 2e74 6f5f 6373 7628 666e 616d 655f  nv.to_csv(fname_
-00088150: 736e 762c 2073 6570 203d 2027 5c74 2729  snv, sep = '\t')
-00088160: 0a20 2020 2070 7269 6e74 2827 534e 5620  .    print('SNV 
-00088170: 7375 6d6d 6172 7920 7361 7665 6420 746f  summary saved to
-00088180: 205c 6e20 2020 2573 2720 2520 666e 616d   \n   %s' % fnam
-00088190: 655f 736e 7629 0a20 2020 2023 2077 7269  e_snv).    # wri
-000881a0: 7465 5f74 6f5f 7663 6628 2073 6e76 5f69  te_to_vcf( snv_i
-000881b0: 6e66 6f5f 6c73 742c 2066 6e61 6d65 5f76  nfo_lst, fname_v
-000881c0: 6366 2029 0a0a 2020 2020 2327 2727 2020  cf )..    #'''  
-000881d0: 2020 0a20 2020 2069 6620 7265 763a 0a20    .    if rev:. 
-000881e0: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
-000881f0: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-00088200: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-00088210: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
-00088220: 6720 6375 7374 6f6d 697a 6564 2067 656e  g customized gen
-00088230: 6f6d 6520 2e2e 2027 2c20 656e 6420 3d20  ome .. ', end = 
-00088240: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-00088250: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-00088260: 2020 2023 2068 6472 5f6c 696e 6573 2e61     # hdr_lines.a
-00088270: 7070 656e 6428 2752 6566 2e20 6765 6e6f  ppend('Ref. geno
-00088280: 6d65 3a20 2573 2720 2520 6765 6e6f 6d65  me: %s' % genome
-00088290: 5f66 696c 6529 0a20 2020 2020 2020 2023  _file).        #
-000882a0: 2073 6176 655f 6774 6628 6774 665f 6669   save_gtf(gtf_fi
-000882b0: 6c65 5f6e 6577 2c20 6774 665f 6c69 6e65  le_new, gtf_line
-000882c0: 732c 2068 6472 5f6c 696e 6573 290a 2020  s, hdr_lines).  
-000882d0: 2020 2020 2020 0a20 2020 2020 2020 2065        .        e
-000882e0: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
-000882f0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-00088300: 745f 7469 6d65 0a20 2020 2020 2020 2070  t_time.        p
-00088310: 7269 6e74 2827 2064 6f6e 652e 2025 6928  rint(' done. %i(
-00088320: 7329 205c 6e20 2020 2573 2720 2520 2865  s) \n   %s' % (e
-00088330: 6c61 7073 6564 5f74 696d 652c 2067 7466  lapsed_time, gtf
-00088340: 5f66 696c 655f 6e65 7729 290a 2020 2020  _file_new)).    
-00088350: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-00088360: 2323 2053 6176 6520 6765 6e6f 6d65 2063  ## Save genome c
-00088370: 6f72 7265 6374 6564 0a20 2020 2020 2020  orrected.       
-00088380: 2070 7269 6e74 2827 596f 7520 6172 6520   print('You are 
-00088390: 616c 6d6f 7374 2064 6f6e 652e 205c 6e4c  almost done. \nL
-000883a0: 6173 7420 7374 6570 2069 7320 746f 2073  ast step is to s
-000883b0: 6176 6520 7468 6520 6669 7865 6420 6765  ave the fixed ge
-000883c0: 6e6f 6d65 2e20 2729 0a20 2020 2020 2020  nome. ').       
-000883d0: 2073 6176 655f 6765 6e6f 6d65 2820 6765   save_genome( ge
-000883e0: 6e6f 6d65 5f66 696c 655f 6e65 772c 2067  nome_file_new, g
-000883f0: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
-00088400: 2054 7275 652c 2074 6974 6c65 203d 2027   True, title = '
-00088410: 4765 6e6f 6d65 2d72 6576 2720 290a 2020  Genome-rev' ).  
-00088420: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-00088430: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
-00088440: 655f 6e65 7720 290a 0a20 2020 2070 7269  e_new )..    pri
-00088450: 6e74 2827 5374 7269 6e67 4669 7820 6669  nt('StringFix fi
-00088460: 6e69 7368 6564 2027 2c20 6461 7465 7469  nished ', dateti
-00088470: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
-00088480: 2929 0a0a 2020 2020 7265 7475 726e 2066  ))..    return f
-00088490: 6e61 6d65 2c20 6765 6e6f 6d65 5f66 696c  name, genome_fil
-000884a0: 655f 6e65 7720 232c 2067 6473 5f6e 6577  e_new #, gds_new
-000884b0: 0a20 2020 2023 2727 2720 2020 200a 0a64  .    #'''    ..d
-000884c0: 6566 2053 7472 696e 6746 6978 5f61 7373  ef StringFix_ass
-000884d0: 656d 626c 6528 2049 6e70 7574 203d 204e  emble( Input = N
-000884e0: 6f6e 652c 2067 656e 6f6d 655f 6661 203d  one, genome_fa =
-000884f0: 204e 6f6e 652c 2061 6e6e 6f74 5f67 7466   None, annot_gtf
-00088500: 203d 204e 6f6e 652c 206f 7574 5f64 6972   = None, out_dir
-00088510: 203d 2027 5346 6978 5f6f 7574 272c 205c   = 'SFix_out', \
-00088520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00088530: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
-00088540: 203d 2034 2c20 6f75 745f 6375 7374 6f6d   = 4, out_custom
-00088550: 5f67 656e 6f6d 6520 3d20 4661 6c73 652c  _genome = False,
-00088560: 2073 7566 6669 7820 3d20 4e6f 6e65 2c20   suffix = None, 
-00088570: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00088580: 2020 2020 2020 2020 2020 6d63 7620 3d20            mcv = 
-00088590: 302e 352c 206d 6364 203d 2031 2c20 6d74  0.5, mcd = 1, mt
-000885a0: 6c20 3d20 3230 302c 206d 706c 203d 2035  l = 200, mpl = 5
-000885b0: 302c 206d 6469 203d 2032 2c20 6d64 6420  0, mdi = 2, mdd 
-000885c0: 3d20 322c 206d 6470 203d 2033 2c20 5c0a  = 2, mdp = 3, \.
-000885d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000885e0: 2020 2020 2020 2020 6d64 6620 3d20 302e          mdf = 0.
-000885f0: 322c 206e 5f70 203d 2031 362c 2078 7361  2, n_p = 16, xsa
-00088600: 203d 2054 7275 652c 206a 756d 705f 746f   = True, jump_to
-00088610: 203d 2030 2029 3a0a 0a20 2020 2070 7269   = 0 ):..    pri
-00088620: 6e74 2827 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('+-----------
-00088630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00088640: 2d2d 2d2b 2729 0a20 2020 2070 7269 6e74  ---+').    print
-00088650: 2827 7c20 2020 2020 2053 7472 696e 6766  ('|      Stringf
-00088660: 6978 2076 2e25 7320 2020 2020 2020 7c27  ix v.%s       |'
-00088670: 2025 2053 7472 696e 6746 6978 5f76 6572   % StringFix_ver
-00088680: 7369 6f6e 290a 2020 2020 7072 696e 7428  sion).    print(
-00088690: 272b 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '+--------------
+00086570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086580: 2323 2323 0a20 2020 2063 6872 5f6c 7374  ####.    chr_lst
+00086590: 203d 2063 6872 5f6c 7374 5f6e 6577 0a0a   = chr_lst_new..
+000865a0: 2020 2020 6f66 5f64 6963 7420 3d20 7b7d      of_dict = {}
+000865b0: 0a20 2020 2023 2067 6473 5f6c 7374 203d  .    # gds_lst =
+000865c0: 205b 5d0a 2020 2020 2320 736e 765f 6c73   [].    # snv_ls
+000865d0: 7420 3d20 5b5d 0a20 2020 2067 6473 5f6e  t = [].    gds_n
+000865e0: 6577 203d 205b 5d0a 2020 2020 736e 765f  ew = [].    snv_
+000865f0: 696e 666f 5f6c 7374 203d 205b 5d0a 0a20  info_lst = [].. 
+00086600: 2020 206e 5f62 6173 6573 5f74 6f74 616c     n_bases_total
+00086610: 203d 2030 0a20 2020 206e 5f65 725f 6261   = 0.    n_er_ba
+00086620: 7365 7320 3d20 300a 2020 2020 6e5f 626c  ses = 0.    n_bl
+00086630: 6b5f 746f 7461 6c20 3d20 300a 2020 2020  k_total = 0.    
+00086640: 6e5f 6572 5f62 6c6b 203d 2030 0a20 2020  n_er_blk = 0.   
+00086650: 206e 7074 203d 2030 0a20 2020 206e 7065   npt = 0.    npe
+00086660: 203d 2030 0a20 2020 200a 2020 2020 7374   = 0.    .    st
+00086670: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
+00086680: 7469 6d65 2829 0a20 2020 2069 6620 286e  time().    if (n
+00086690: 5f63 6f72 6573 203d 3d20 3129 207c 2028  _cores == 1) | (
+000866a0: 6c65 6e28 6368 725f 6c73 7429 203d 3d20  len(chr_lst) == 
+000866b0: 3129 3a0a 2020 2020 2020 2020 666f 7220  1):.        for 
+000866c0: 6b6b 2069 6e20 7261 6e67 6528 6c65 6e28  kk in range(len(
+000866d0: 6368 725f 6c73 7429 293a 0a20 2020 2020  chr_lst)):.     
+000866e0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+000866f0: 2720 2b20 2720 272a 3130 302c 2065 6e64  ' + ' '*100, end
+00086700: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
+00086710: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
+00086720: 7269 6e74 2827 5c72 5265 636f 6e73 7472  rint('\rReconstr
+00086730: 7563 7469 6e67 202e 2e20 2569 2f25 6920  ucting .. %i/%i 
+00086740: 2825 7329 2027 2025 2028 6b6b 2b31 2c20  (%s) ' % (kk+1, 
+00086750: 6c65 6e28 6368 725f 6c73 7429 2c20 6368  len(chr_lst), ch
+00086760: 725f 6c73 745b 6b6b 5d29 2c20 656e 6420  r_lst[kk]), end 
+00086770: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
+00086780: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00086790: 6764 5f73 656c 2c20 7365 715f 6e65 772c  gd_sel, seq_new,
+000867a0: 2073 6e76 5f69 6e66 6f5f 6368 722c 206f   snv_info_chr, o
+000867b0: 662c 2063 6872 6d2c 2065 7374 6174 203d  f, chrm, estat =
+000867c0: 206d 635f 636f 7265 5f72 6563 6f6e 7374   mc_core_reconst
+000867d0: 7275 6374 696f 6e28 6767 635f 7475 706c  ruction(ggc_tupl
+000867e0: 655b 6b6b 5d29 0a20 2020 2020 2020 2020  e[kk]).         
+000867f0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00086800: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00086810: 2020 2020 2020 2020 2020 6765 6e6f 6d65            genome
+00086820: 5b63 6872 6d5d 2e73 6571 203d 2073 6571  [chrm].seq = seq
+00086830: 5f6e 6577 0a20 2020 2020 2020 2020 2020  _new.           
+00086840: 206f 665f 6469 6374 5b63 6872 6d5d 203d   of_dict[chrm] =
+00086850: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
+00086860: 2320 6764 735f 6c73 742e 6170 7065 6e64  # gds_lst.append
+00086870: 2867 645f 7365 6c29 0a20 2020 2020 2020  (gd_sel).       
+00086880: 2020 2020 2023 2073 6e76 5f6c 7374 2e61       # snv_lst.a
+00086890: 7070 656e 6428 736e 765f 696e 666f 5f63  ppend(snv_info_c
+000868a0: 6872 290a 2020 2020 2020 2020 2020 2020  hr).            
+000868b0: 6764 735f 6e65 7720 3d20 6764 735f 6e65  gds_new = gds_ne
+000868c0: 7720 2b20 6764 5f73 656c 0a20 2020 2020  w + gd_sel.     
+000868d0: 2020 2020 2020 2073 6e76 5f69 6e66 6f5f         snv_info_
+000868e0: 6c73 7420 3d20 736e 765f 696e 666f 5f6c  lst = snv_info_l
+000868f0: 7374 202b 2073 6e76 5f69 6e66 6f5f 6368  st + snv_info_ch
+00086900: 720a 0a20 2020 2020 2020 2020 2020 206e  r..            n
+00086910: 6274 2c20 6e62 652c 206e 6c74 2c20 6e6c  bt, nbe, nlt, nl
+00086920: 652c 206e 742c 206e 653d 2065 7374 6174  e, nt, ne= estat
+00086930: 0a20 2020 2020 2020 2020 2020 206e 5f62  .            n_b
+00086940: 6173 6573 5f74 6f74 616c 202b 3d20 6e62  ases_total += nb
+00086950: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
+00086960: 6572 5f62 6173 6573 202b 3d20 6e62 650a  er_bases += nbe.
+00086970: 2020 2020 2020 2020 2020 2020 6e5f 626c              n_bl
+00086980: 6b5f 746f 7461 6c20 2b3d 206e 6c74 0a20  k_total += nlt. 
+00086990: 2020 2020 2020 2020 2020 206e 5f65 725f             n_er_
+000869a0: 626c 6b20 2b3d 206e 6c65 0a20 2020 2020  blk += nle.     
+000869b0: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
+000869c0: 0a20 2020 2020 2020 2020 2020 206e 7065  .            npe
+000869d0: 202b 3d20 6e65 0a20 2020 2020 2020 2020   += ne.         
+000869e0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+000869f0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00086a00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00086a10: 6e75 6d5f 636f 7265 203d 206d 696e 2820  num_core = min( 
+00086a20: 6e5f 636f 7265 732c 2028 6370 755f 636f  n_cores, (cpu_co
+00086a30: 756e 7428 2920 2d20 3129 2029 0a20 2020  unt() - 1) ).   
+00086a40: 2020 2020 2023 2070 7269 6e74 2822 6e75       # print("nu
+00086a50: 6d20 636f 7265 7320 746f 2075 7365 203d  m cores to use =
+00086a60: 207b 7d22 2e66 6f72 6d61 7428 6e75 6d5f   {}".format(num_
+00086a70: 636f 7265 2929 0a20 2020 2020 2020 2070  core)).        p
+00086a80: 6f6f 6c20 3d20 506f 6f6c 286e 756d 5f63  ool = Pool(num_c
+00086a90: 6f72 6529 0a20 2020 2020 2020 2063 6e74  ore).        cnt
+00086aa0: 203d 2031 0a20 2020 2020 2020 2066 6f72   = 1.        for
+00086ab0: 2067 645f 7365 6c2c 2073 6571 5f6e 6577   gd_sel, seq_new
+00086ac0: 2c20 736e 765f 696e 666f 5f63 6872 2c20  , snv_info_chr, 
+00086ad0: 6f66 2c20 6368 726d 2c20 6573 7461 7420  of, chrm, estat 
+00086ae0: 696e 205c 0a20 2020 2020 2020 2020 2020  in \.           
+00086af0: 2070 6f6f 6c2e 696d 6170 5f75 6e6f 7264   pool.imap_unord
+00086b00: 6572 6564 286d 635f 636f 7265 5f72 6563  ered(mc_core_rec
+00086b10: 6f6e 7374 7275 6374 696f 6e2c 2067 6763  onstruction, ggc
+00086b20: 5f74 7570 6c65 293a 0a20 2020 2020 2020  _tuple):.       
+00086b30: 2020 2020 2023 2074 7164 6d2e 7471 646d       # tqdm.tqdm
+00086b40: 5f6e 6f74 6562 6f6f 6b28 706f 6f6c 2e69  _notebook(pool.i
+00086b50: 6d61 705f 756e 6f72 6465 7265 6428 6d63  map_unordered(mc
+00086b60: 5f63 6f72 655f 7265 636f 6e73 7472 7563  _core_reconstruc
+00086b70: 7469 6f6e 2c20 6767 635f 7475 706c 6529  tion, ggc_tuple)
+00086b80: 2c20 746f 7461 6c3d 6c65 6e28 6767 635f  , total=len(ggc_
+00086b90: 7475 706c 6529 293a 0a20 2020 2020 2020  tuple)):.       
+00086ba0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+00086bb0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00086bc0: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
+00086bd0: 6d65 5b63 6872 6d5d 2e73 6571 203d 2073  me[chrm].seq = s
+00086be0: 6571 5f6e 6577 0a20 2020 2020 2020 2020  eq_new.         
+00086bf0: 2020 206f 665f 6469 6374 5b63 6872 6d5d     of_dict[chrm]
+00086c00: 203d 206f 660a 2020 2020 2020 2020 2020   = of.          
+00086c10: 2020 2320 6764 735f 6c73 742e 6170 7065    # gds_lst.appe
+00086c20: 6e64 2867 645f 7365 6c29 0a20 2020 2020  nd(gd_sel).     
+00086c30: 2020 2020 2020 2023 2073 6e76 5f6c 7374         # snv_lst
+00086c40: 2e61 7070 656e 6428 736e 765f 696e 666f  .append(snv_info
+00086c50: 5f63 6872 290a 2020 2020 2020 2020 2020  _chr).          
+00086c60: 2020 6764 735f 6e65 7720 3d20 6764 735f    gds_new = gds_
+00086c70: 6e65 7720 2b20 6764 5f73 656c 0a20 2020  new + gd_sel.   
+00086c80: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
+00086c90: 6f5f 6c73 7420 3d20 736e 765f 696e 666f  o_lst = snv_info
+00086ca0: 5f6c 7374 202b 2073 6e76 5f69 6e66 6f5f  _lst + snv_info_
+00086cb0: 6368 720a 2020 2020 2020 2020 2020 2020  chr.            
+00086cc0: 0a20 2020 2020 2020 2020 2020 206e 6274  .            nbt
+00086cd0: 2c20 6e62 652c 206e 6c74 2c20 6e6c 652c  , nbe, nlt, nle,
+00086ce0: 206e 742c 206e 653d 2065 7374 6174 0a20   nt, ne= estat. 
+00086cf0: 2020 2020 2020 2020 2020 206e 5f62 6173             n_bas
+00086d00: 6573 5f74 6f74 616c 202b 3d20 6e62 740a  es_total += nbt.
+00086d10: 2020 2020 2020 2020 2020 2020 6e5f 6572              n_er
+00086d20: 5f62 6173 6573 202b 3d20 6e62 650a 2020  _bases += nbe.  
+00086d30: 2020 2020 2020 2020 2020 6e5f 626c 6b5f            n_blk_
+00086d40: 746f 7461 6c20 2b3d 206e 6c74 0a20 2020  total += nlt.   
+00086d50: 2020 2020 2020 2020 206e 5f65 725f 626c           n_er_bl
+00086d60: 6b20 2b3d 206e 6c65 0a20 2020 2020 2020  k += nle.       
+00086d70: 2020 2020 206e 7074 202b 3d20 6e74 0a20       npt += nt. 
+00086d80: 2020 2020 2020 2020 2020 206e 7065 202b             npe +
+00086d90: 3d20 6e65 0a20 2020 2020 2020 2020 2020  = ne.           
+00086da0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00086db0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
+00086dc0: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
+00086dd0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00086de0: 6e74 2827 5c72 5265 636f 6e73 7472 7563  nt('\rReconstruc
+00086df0: 7469 6e67 2028 2569 2920 2e2e 2025 692f  ting (%i) .. %i/
+00086e00: 2569 2028 2573 2920 2020 2020 2020 2020  %i (%s)         
+00086e10: 2020 2027 2025 2028 6e75 6d5f 636f 7265     ' % (num_core
+00086e20: 2c20 636e 742c 206c 656e 2867 6763 5f74  , cnt, len(ggc_t
+00086e30: 7570 6c65 292c 2063 6872 6d29 2c20 656e  uple), chrm), en
+00086e40: 6420 3d20 2720 2020 2020 2020 2020 2020  d = '           
+00086e50: 2020 2020 2020 2020 2020 2729 0a20 2020            ').   
+00086e60: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00086e70: 2020 706f 6f6c 2e63 6c6f 7365 2829 0a20    pool.close(). 
+00086e80: 2020 2020 2020 2070 6f6f 6c2e 6a6f 696e         pool.join
+00086e90: 2829 0a20 2020 2020 2020 200a 2020 2020  ().        .    
+00086ea0: 2727 270a 2020 2020 6764 735f 6e65 7720  '''.    gds_new 
+00086eb0: 3d20 5b5d 0a20 2020 2073 6e76 5f69 6e66  = [].    snv_inf
+00086ec0: 6f5f 6c73 7420 3d20 5b5d 0a20 2020 2066  o_lst = [].    f
+00086ed0: 6f72 206b 6b2c 2063 6872 6d20 696e 2065  or kk, chrm in e
+00086ee0: 6e75 6d65 7261 7465 2863 6872 5f6c 7374  numerate(chr_lst
+00086ef0: 293a 0a20 2020 2020 2020 2067 6473 5f6e  ):.        gds_n
+00086f00: 6577 203d 2067 6473 5f6e 6577 202b 2067  ew = gds_new + g
+00086f10: 6473 5f6c 7374 5b6b 6b5d 0a20 2020 2020  ds_lst[kk].     
+00086f20: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
+00086f30: 3d20 736e 765f 696e 666f 5f6c 7374 202b  = snv_info_lst +
+00086f40: 2073 6e76 5f6c 7374 5b6b 6b5d 0a0a 2020   snv_lst[kk]..  
+00086f50: 2020 6465 6c20 6764 735f 6c73 740a 2020    del gds_lst.  
+00086f60: 2020 2327 2727 0a20 2020 2020 0a20 2020    #'''.     .   
+00086f70: 2065 6c61 7073 6564 5f74 696d 6532 203d   elapsed_time2 =
+00086f80: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
+00086f90: 7461 7274 5f74 696d 650a 2020 2020 7072  tart_time.    pr
+00086fa0: 696e 7428 275c 7252 6563 6f6e 7374 7275  int('\rReconstru
+00086fb0: 6374 696f 6e20 2e2e 2064 6f6e 652e 2028  ction .. done. (
+00086fc0: 2569 2920 2020 2020 2020 2020 2020 2027  %i)            '
+00086fd0: 2025 2028 656c 6170 7365 645f 7469 6d65   % (elapsed_time
+00086fe0: 3229 2c20 666c 7573 6820 3d20 5472 7565  2), flush = True
+00086ff0: 290a 2020 2020 7072 696e 7428 2749 6e74  ).    print('Int
+00087000: 6567 7269 7479 2063 6865 636b 3a20 2025  egrity check:  %
+00087010: 692f 2569 2c20 2569 2f25 692c 2025 692f  i/%i, %i/%i, %i/
+00087020: 2569 2720 2520 5c0a 2020 2020 2020 2020  %i' % \.        
+00087030: 2020 286e 5f65 725f 6261 7365 732c 206e    (n_er_bases, n
+00087040: 5f62 6173 6573 5f74 6f74 616c 2c20 6e5f  _bases_total, n_
+00087050: 6572 5f62 6c6b 2c20 6e5f 626c 6b5f 746f  er_blk, n_blk_to
+00087060: 7461 6c2c 206e 7065 2c20 6e70 7429 2c20  tal, npe, npt), 
+00087070: 666c 7573 6820 3d20 5472 7565 2029 0a20  flush = True ). 
+00087080: 2020 2020 200a 2020 2020 2727 2720 200a       .    '''  .
+00087090: 2020 2020 4e74 725f 616c 6c20 3d20 300a      Ntr_all = 0.
+000870a0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
+000870b0: 735f 6e65 773a 204e 7472 5f61 6c6c 202b  s_new: Ntr_all +
+000870c0: 3d20 6764 2e6e 7472 0a20 2020 2070 7269  = gd.ntr.    pri
+000870d0: 6e74 2827 4e5f 7472 2028 6166 7465 7229  nt('N_tr (after)
+000870e0: 203d 2025 6927 2025 204e 7472 5f61 6c6c   = %i' % Ntr_all
+000870f0: 290a 0a20 2020 206e 5f74 7220 3d20 300a  )..    n_tr = 0.
+00087100: 2020 2020 6e5f 6e65 675f 636f 7620 3d20      n_neg_cov = 
+00087110: 300a 2020 2020 6e5f 706f 735f 636f 7620  0.    n_pos_cov 
+00087120: 3d20 300a 2020 2020 666f 7220 6764 2069  = 0.    for gd i
+00087130: 6e20 6764 735f 6e65 773a 0a20 2020 2020  n gds_new:.     
+00087140: 2020 206e 5f74 7220 2b3d 2067 642e 6e74     n_tr += gd.nt
+00087150: 720a 2020 2020 2020 2020 666f 7220 7464  r.        for td
+00087160: 2069 6e20 6764 2e74 645f 6c73 743a 0a20   in gd.td_lst:. 
+00087170: 2020 2020 2020 2020 2020 2069 6620 7464             if td
+00087180: 2e63 6f76 203c 3d20 303a 206e 5f6e 6567  .cov <= 0: n_neg
+00087190: 5f63 6f76 202b 3d20 310a 2020 2020 2020  _cov += 1.      
+000871a0: 2020 2020 2020 656c 6966 2074 642e 636f        elif td.co
+000871b0: 7620 3e20 303a 206e 5f70 6f73 5f63 6f76  v > 0: n_pos_cov
+000871c0: 202b 3d20 310a 2020 2020 7072 696e 7428   += 1.    print(
+000871d0: 274e 5f74 7273 203d 2025 692c 2025 692c  'N_trs = %i, %i,
+000871e0: 2025 6927 2025 2028 6e5f 7472 2c20 6e5f   %i' % (n_tr, n_
+000871f0: 6e65 675f 636f 762c 206e 5f70 6f73 5f63  neg_cov, n_pos_c
+00087200: 6f76 2929 0a20 2020 2023 2727 270a 2020  ov)).    #'''.  
+00087210: 2020 2020 2020 0a20 2020 2073 7461 7274        .    start
+00087220: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
+00087230: 6528 290a 2020 2020 6774 665f 6c69 6e65  e().    gtf_line
+00087240: 7320 3d20 5b5d 0a20 2020 2066 615f 6c69  s = [].    fa_li
+00087250: 6e65 735f 7472 203d 205b 5d0a 2020 2020  nes_tr = [].    
+00087260: 6661 5f6c 696e 6573 5f70 7220 3d20 5b5d  fa_lines_pr = []
+00087270: 0a0a 2020 2020 2320 7361 7665 5f67 7466  ..    # save_gtf
+00087280: 3228 2066 6e61 6d65 2c20 6774 665f 6c69  2( fname, gtf_li
+00087290: 6e65 5f6c 7374 203d 204e 6f6e 652c 2068  ne_lst = None, h
+000872a0: 6472 203d 204e 6f6e 652c 2066 6f20 3d20  dr = None, fo = 
+000872b0: 4e6f 6e65 2063 6c6f 7365 203d 2046 616c  None close = Fal
+000872c0: 7365 2029 0a20 2020 200a 2020 2020 6966  se ).    .    if
+000872d0: 2072 6576 3a20 0a20 2020 2020 2020 2068   rev: .        h
+000872e0: 6472 5f6c 696e 6573 2e61 7070 656e 6428  dr_lines.append(
+000872f0: 2752 6566 2e20 6765 6e6f 6d65 3a20 2573  'Ref. genome: %s
+00087300: 2720 2520 6765 6e6f 6d65 5f66 696c 6529  ' % genome_file)
+00087310: 0a20 2020 2020 2020 2066 5f67 7466 203d  .        f_gtf =
+00087320: 2073 6176 655f 6774 6632 2820 6774 665f   save_gtf2( gtf_
+00087330: 6669 6c65 5f6e 6577 2c20 6774 665f 6c69  file_new, gtf_li
+00087340: 6e65 5f6c 7374 203d 204e 6f6e 652c 2068  ne_lst = None, h
+00087350: 6472 203d 2068 6472 5f6c 696e 6573 2029  dr = hdr_lines )
+00087360: 0a0a 2020 2020 6674 203d 206f 7065 6e28  ..    ft = open(
+00087370: 6661 5f66 696c 655f 7472 5f6e 6577 2c20  fa_file_tr_new, 
+00087380: 2777 2b27 290a 2020 2020 6670 203d 206f  'w+').    fp = o
+00087390: 7065 6e28 6661 5f66 696c 655f 7072 5f6e  pen(fa_file_pr_n
+000873a0: 6577 2c20 2777 2b27 290a 0a20 2020 2067  ew, 'w+')..    g
+000873b0: 6473 5f6e 6577 203d 2073 6f72 745f 6465  ds_new = sort_de
+000873c0: 7363 7269 7074 6f72 5f6c 7374 2867 6473  scriptor_lst(gds
+000873d0: 5f6e 6577 290a 2020 2020 636e 745f 6e6f  _new).    cnt_no
+000873e0: 6e65 203d 2030 0a20 2020 2070 7269 6e74  ne = 0.    print
+000873f0: 2827 4765 6e65 7261 7469 6e67 2047 5446  ('Generating GTF
+00087400: 2061 6e64 2054 7261 6e73 6372 6970 746f   and Transcripto
+00087410: 6d65 2f50 726f 7465 6f6d 6520 2e2e 2027  me/Proteome .. '
+00087420: 2c20 656e 643d 2720 2020 2027 290a 0a20  , end='    ').. 
+00087430: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
+00087440: 2031 3a0a 2020 2020 2020 2020 636e 745f   1:.        cnt_
+00087450: 7420 3d20 300a 2020 2020 2020 2020 636e  t = 0.        cn
+00087460: 745f 7020 3d20 300a 2020 2020 2020 2020  t_p = 0.        
+00087470: 666f 7220 6d2c 2067 6420 696e 2065 6e75  for m, gd in enu
+00087480: 6d65 7261 7465 2867 6473 5f6e 6577 293a  merate(gds_new):
+00087490: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+000874a0: 2020 2020 2020 2020 2020 6966 2028 6d2b            if (m+
+000874b0: 3129 2531 3030 203d 3d20 303a 2070 7269  1)%100 == 0: pri
+000874c0: 6e74 2827 5c72 4765 6e65 7261 7469 6e67  nt('\rGenerating
+000874d0: 2047 5446 2061 6e64 2054 7261 6e73 6372   GTF and Transcr
+000874e0: 6970 746f 6d65 2f50 726f 7465 6f6d 6520  iptome/Proteome 
+000874f0: 2e2e 2025 692f 2569 2720 2520 286d 2c20  .. %i/%i' % (m, 
+00087500: 6c65 6e28 6764 735f 6e65 7729 292c 2065  len(gds_new)), e
+00087510: 6e64 203d 2027 2020 2027 2c20 666c 7573  nd = '   ', flus
+00087520: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
+00087530: 2020 2020 2020 6e74 722c 206e 7072 2c20        ntr, npr, 
+00087540: 6e65 7220 3d20 6764 2e75 7064 6174 655f  ner = gd.update_
+00087550: 7464 5f69 6e66 6f28 7365 6c20 3d20 312c  td_info(sel = 1,
+00087560: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
+00087570: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00087580: 2020 2020 2020 2020 2067 7466 6c2c 2063           gtfl, c
+00087590: 6e20 3d20 6764 2e67 6574 5f67 7466 5f6c  n = gd.get_gtf_l
+000875a0: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
+000875b0: 7365 6c20 3d20 312c 2061 6464 5f73 6571  sel = 1, add_seq
+000875c0: 203d 2046 616c 7365 2c20 636f 6e6e 6563   = False, connec
+000875d0: 7420 3d20 5472 7565 290a 2020 2020 2020  t = True).      
+000875e0: 2020 2020 2020 636e 745f 6e6f 6e65 202b        cnt_none +
+000875f0: 3d20 636e 0a20 2020 2020 2020 2020 2020  = cn.           
+00087600: 206c 742c 206c 7020 3d20 6764 2e67 6574   lt, lp = gd.get
+00087610: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
+00087620: 6d5f 6578 6f6e 7328 7365 6c20 3d20 312c  m_exons(sel = 1,
+00087630: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
+00087640: 0a20 2020 2020 2020 2020 2020 206c 7420  .            lt 
+00087650: 3d20 6669 6c74 6572 5f74 7273 5f6c 656e  = filter_trs_len
+00087660: 286c 742c 206d 696e 5f6c 656e 203d 204d  (lt, min_len = M
+00087670: 494e 5f54 525f 4c45 4e47 5448 290a 2020  IN_TR_LENGTH).  
+00087680: 2020 2020 2020 2020 2020 6c70 203d 2066            lp = f
+00087690: 696c 7465 725f 7472 735f 6c65 6e28 6c70  ilter_trs_len(lp
+000876a0: 2c20 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f  , min_len = MIN_
+000876b0: 5052 5f4c 454e 4754 4829 0a20 2020 2020  PR_LENGTH).     
+000876c0: 2020 2020 2020 2069 6620 7265 763a 0a20         if rev:. 
+000876d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000876e0: 5f67 7466 203d 2073 6176 655f 6774 6632  _gtf = save_gtf2
+000876f0: 2820 6774 665f 6669 6c65 5f6e 6577 2c20  ( gtf_file_new, 
+00087700: 6774 665f 6c69 6e65 5f6c 7374 203d 2067  gtf_line_lst = g
+00087710: 7466 6c2c 2066 6f20 3d20 665f 6774 6620  tfl, fo = f_gtf 
+00087720: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
+00087730: 2020 2023 2067 7466 5f6c 696e 6573 203d     # gtf_lines =
+00087740: 2067 7466 5f6c 696e 6573 202b 2067 7466   gtf_lines + gtf
+00087750: 6c0a 2020 2020 2020 2020 0a20 2020 2020  l.        .     
+00087760: 2020 2020 2020 2066 742e 7772 6974 656c         ft.writel
+00087770: 696e 6573 286c 7429 0a20 2020 2020 2020  ines(lt).       
+00087780: 2020 2020 2066 702e 7772 6974 656c 696e       fp.writelin
+00087790: 6573 286c 7029 0a20 2020 2020 2020 2020  es(lp).         
+000877a0: 2020 2023 2066 615f 6c69 6e65 735f 7472     # fa_lines_tr
+000877b0: 203d 2066 615f 6c69 6e65 735f 7472 202b   = fa_lines_tr +
+000877c0: 206c 740a 2020 2020 2020 2020 2020 2020   lt.            
+000877d0: 2320 6661 5f6c 696e 6573 5f70 7220 3d20  # fa_lines_pr = 
+000877e0: 6661 5f6c 696e 6573 5f70 7220 2b20 6c70  fa_lines_pr + lp
+000877f0: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
+00087800: 5f74 202b 3d20 6c65 6e28 6c74 290a 2020  _t += len(lt).  
+00087810: 2020 2020 2020 2020 2020 636e 745f 7020            cnt_p 
+00087820: 2b3d 206c 656e 286c 7029 0a20 2020 2020  += len(lp).     
+00087830: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00087840: 656c 6170 7365 645f 7469 6d65 3220 3d20  elapsed_time2 = 
+00087850: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+00087860: 6172 745f 7469 6d65 0a20 2020 2020 2020  art_time.       
+00087870: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
+00087880: 7469 6e67 2047 5446 2061 6e64 2054 7261  ting GTF and Tra
+00087890: 6e73 6372 6970 746f 6d65 2f50 726f 7465  nscriptome/Prote
+000878a0: 6f6d 6520 2e2e 2025 692c 2025 6920 646f  ome .. %i, %i do
+000878b0: 6e65 2e20 2825 6929 2027 2025 2028 6c65  ne. (%i) ' % (le
+000878c0: 6e28 6764 735f 6e65 7729 2c20 636e 745f  n(gds_new), cnt_
+000878d0: 6e6f 6e65 2c20 656c 6170 7365 645f 7469  none, elapsed_ti
+000878e0: 6d65 3229 2c20 666c 7573 6820 3d20 5472  me2), flush = Tr
+000878f0: 7565 290a 0a20 2020 2065 6c73 653a 0a20  ue)..    else:. 
+00087900: 2020 2020 2020 206e 756d 5f63 6f72 6520         num_core 
+00087910: 3d20 6d69 6e28 206e 5f63 6f72 6573 2c20  = min( n_cores, 
+00087920: 2863 7075 5f63 6f75 6e74 2829 202d 2031  (cpu_count() - 1
+00087930: 2920 290a 2020 2020 2020 2020 2320 7072  ) ).        # pr
+00087940: 696e 7428 226e 756d 2063 6f72 6573 2074  int("num cores t
+00087950: 6f20 7573 6520 3d20 7b7d 222e 666f 726d  o use = {}".form
+00087960: 6174 286e 756d 5f63 6f72 6529 290a 2020  at(num_core)).  
+00087970: 2020 2020 2020 706f 6f6c 203d 2050 6f6f        pool = Poo
+00087980: 6c28 6e75 6d5f 636f 7265 290a 2020 2020  l(num_core).    
+00087990: 2020 2020 636e 7420 3d20 310a 2020 2020      cnt = 1.    
+000879a0: 2020 2020 636e 745f 7420 3d20 300a 2020      cnt_t = 0.  
+000879b0: 2020 2020 2020 636e 745f 7020 3d20 300a        cnt_p = 0.
+000879c0: 2020 2020 2020 2020 666f 7220 6774 666c          for gtfl
+000879d0: 2c20 6c74 2c20 6c70 2c20 6368 726d 2c20  , lt, lp, chrm, 
+000879e0: 6e65 2c20 636e 2069 6e20 706f 6f6c 2e6d  ne, cn in pool.m
+000879f0: 6170 286d 635f 636f 7265 5f67 6574 5f67  ap(mc_core_get_g
+00087a00: 7466 5f61 6e64 5f66 6173 7461 5f70 742c  tf_and_fasta_pt,
+00087a10: 2067 6473 5f6e 6577 293a 0a20 2020 2020   gds_new):.     
+00087a20: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00087a30: 2020 2020 636e 745f 6e6f 6e65 202b 3d20      cnt_none += 
+00087a40: 636e 0a20 2020 2020 2020 2020 2020 2069  cn.            i
+00087a50: 6620 2863 6e74 2b31 2925 3130 3020 3d3d  f (cnt+1)%100 ==
+00087a60: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00087a70: 2020 2020 7072 696e 7428 275c 7247 656e      print('\rGen
+00087a80: 6572 6174 696e 6720 4754 4620 616e 6420  erating GTF and 
+00087a90: 5472 616e 7363 7269 7074 6f6d 652f 5072  Transcriptome/Pr
+00087aa0: 6f74 656f 6d65 202e 2e20 2569 2f25 6927  oteome .. %i/%i'
+00087ab0: 2025 2028 636e 742c 206c 656e 2867 6473   % (cnt, len(gds
+00087ac0: 5f6e 6577 2929 2c20 656e 6420 3d20 2720  _new)), end = ' 
+00087ad0: 2020 2729 0a20 2020 2020 2020 2020 2020    ').           
+00087ae0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00087af0: 2020 2020 2020 636e 7420 2b3d 2031 0a20        cnt += 1. 
+00087b00: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00087b10: 2020 2020 2020 2020 6c74 203d 2066 696c          lt = fil
+00087b20: 7465 725f 7472 735f 6c65 6e28 6c74 2c20  ter_trs_len(lt, 
+00087b30: 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f 5452  min_len = MIN_TR
+00087b40: 5f4c 454e 4754 4829 0a20 2020 2020 2020  _LENGTH).       
+00087b50: 2020 2020 206c 7020 3d20 6669 6c74 6572       lp = filter
+00087b60: 5f74 7273 5f6c 656e 286c 702c 206d 696e  _trs_len(lp, min
+00087b70: 5f6c 656e 203d 204d 494e 5f50 525f 4c45  _len = MIN_PR_LE
+00087b80: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
+00087b90: 2020 6966 2072 6576 3a0a 2020 2020 2020    if rev:.      
+00087ba0: 2020 2020 2020 2020 2020 665f 6774 6620            f_gtf 
+00087bb0: 3d20 7361 7665 5f67 7466 3228 2067 7466  = save_gtf2( gtf
+00087bc0: 5f66 696c 655f 6e65 772c 2067 7466 5f6c  _file_new, gtf_l
+00087bd0: 696e 655f 6c73 7420 3d20 6774 666c 2c20  ine_lst = gtfl, 
+00087be0: 666f 203d 2066 5f67 7466 2029 2020 0a20  fo = f_gtf )  . 
+00087bf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00087c00: 2067 7466 5f6c 696e 6573 203d 2067 7466   gtf_lines = gtf
+00087c10: 5f6c 696e 6573 202b 2067 7466 6c0a 0a20  _lines + gtfl.. 
+00087c20: 2020 2020 2020 2020 2020 2066 742e 7772             ft.wr
+00087c30: 6974 656c 696e 6573 286c 7429 0a20 2020  itelines(lt).   
+00087c40: 2020 2020 2020 2020 2066 702e 7772 6974           fp.writ
+00087c50: 656c 696e 6573 286c 7029 0a20 2020 2020  elines(lp).     
+00087c60: 2020 2020 2020 2023 2066 615f 6c69 6e65         # fa_line
+00087c70: 735f 7472 203d 2066 615f 6c69 6e65 735f  s_tr = fa_lines_
+00087c80: 7472 202b 206c 740a 2020 2020 2020 2020  tr + lt.        
+00087c90: 2020 2020 2320 6661 5f6c 696e 6573 5f70      # fa_lines_p
+00087ca0: 7220 3d20 6661 5f6c 696e 6573 5f70 7220  r = fa_lines_pr 
+00087cb0: 2b20 6c70 0a20 2020 2020 2020 2020 2020  + lp.           
+00087cc0: 2063 6e74 5f74 202b 3d20 6c65 6e28 6c74   cnt_t += len(lt
+00087cd0: 290a 2020 2020 2020 2020 2020 2020 636e  ).            cn
+00087ce0: 745f 7020 2b3d 206c 656e 286c 7029 0a20  t_p += len(lp). 
+00087cf0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00087d00: 2020 2020 706f 6f6c 2e63 6c6f 7365 2829      pool.close()
+00087d10: 0a20 2020 2020 2020 2070 6f6f 6c2e 6a6f  .        pool.jo
+00087d20: 696e 2829 0a0a 2020 2020 2020 2020 656c  in()..        el
+00087d30: 6170 7365 645f 7469 6d65 3220 3d20 7469  apsed_time2 = ti
+00087d40: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+00087d50: 745f 7469 6d65 0a20 2020 2020 2020 2070  t_time.        p
+00087d60: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
+00087d70: 6e67 2047 5446 2061 6e64 2054 7261 6e73  ng GTF and Trans
+00087d80: 6372 6970 746f 6d65 2f50 726f 7465 6f6d  criptome/Proteom
+00087d90: 6520 2e2e 2064 6f6e 652e 2025 692c 2025  e .. done. %i, %
+00087da0: 692c 2025 6920 2825 6929 2027 2025 205c  i, %i (%i) ' % \
+00087db0: 0a20 2020 2020 2020 2020 2020 2020 2028  .              (
+00087dc0: 636e 745f 6e6f 6e65 2c20 696e 7428 636e  cnt_none, int(cn
+00087dd0: 745f 742f 3229 2c20 696e 7428 636e 745f  t_t/2), int(cnt_
+00087de0: 702f 3229 2c20 656c 6170 7365 645f 7469  p/2), elapsed_ti
+00087df0: 6d65 3229 290a 2020 2020 2020 2020 0a20  me2)).        . 
+00087e00: 2020 2069 6620 7265 763a 2073 6176 655f     if rev: save_
+00087e10: 6774 6632 2820 6774 665f 6669 6c65 5f6e  gtf2( gtf_file_n
+00087e20: 6577 2c20 6774 665f 6c69 6e65 5f6c 7374  ew, gtf_line_lst
+00087e30: 203d 204e 6f6e 652c 2066 6f20 3d20 665f   = None, fo = f_
+00087e40: 6774 662c 2063 6c6f 7365 203d 2054 7275  gtf, close = Tru
+00087e50: 6520 290a 2020 2020 6674 2e63 6c6f 7365  e ).    ft.close
+00087e60: 2829 0a20 2020 2066 702e 636c 6f73 6528  ().    fp.close(
+00087e70: 290a 0a20 2020 2023 2064 656c 2067 6473  )..    # del gds
+00087e80: 5f6e 6577 0a0a 2020 2020 2727 2720 2020  _new..    '''   
+00087e90: 200a 2020 2020 7374 6172 745f 7469 6d65   .    start_time
+00087ea0: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
+00087eb0: 2020 2070 7269 6e74 2827 5361 7669 6e67     print('Saving
+00087ec0: 2046 4153 5441 2028 2569 2c20 2569 202f   FASTA (%i, %i /
+00087ed0: 2025 6929 202e 2e27 2025 2028 6c65 6e28   %i) ..' % (len(
+00087ee0: 6661 5f6c 696e 6573 5f74 7229 2f32 2c20  fa_lines_tr)/2, 
+00087ef0: 6c65 6e28 6661 5f6c 696e 6573 5f70 7229  len(fa_lines_pr)
+00087f00: 2f32 2c20 6e5f 7472 292c 2065 6e64 203d  /2, n_tr), end =
+00087f10: 2027 272c 2066 6c75 7368 203d 2054 7275   '', flush = Tru
+00087f20: 6529 0a20 2020 2066 203d 206f 7065 6e28  e).    f = open(
+00087f30: 6661 5f66 696c 655f 7472 5f6e 6577 2c20  fa_file_tr_new, 
+00087f40: 2777 2b27 290a 2020 2020 662e 7772 6974  'w+').    f.writ
+00087f50: 656c 696e 6573 2866 615f 6c69 6e65 735f  elines(fa_lines_
+00087f60: 7472 290a 2020 2020 662e 636c 6f73 6528  tr).    f.close(
+00087f70: 290a 0a20 2020 2070 7269 6e74 2827 2e27  )..    print('.'
+00087f80: 2c20 656e 643d 2727 290a 2020 2020 6620  , end='').    f 
+00087f90: 3d20 6f70 656e 2866 615f 6669 6c65 5f70  = open(fa_file_p
+00087fa0: 725f 6e65 772c 2027 772b 2729 0a20 2020  r_new, 'w+').   
+00087fb0: 2066 2e77 7269 7465 6c69 6e65 7328 6661   f.writelines(fa
+00087fc0: 5f6c 696e 6573 5f70 7229 0a20 2020 2066  _lines_pr).    f
+00087fd0: 2e63 6c6f 7365 2829 0a0a 2020 2020 656c  .close()..    el
+00087fe0: 6170 7365 645f 7469 6d65 203d 2074 696d  apsed_time = tim
+00087ff0: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
+00088000: 5f74 696d 650a 2020 2020 7072 696e 7428  _time.    print(
+00088010: 2720 646f 6e65 2e20 2825 6929 2720 2520  ' done. (%i)' % 
+00088020: 2865 6c61 7073 6564 5f74 696d 6529 290a  (elapsed_time)).
+00088030: 2020 2020 2727 270a 0a20 2020 2070 7269      '''..    pri
+00088040: 6e74 2827 2020 2025 7327 2025 2066 615f  nt('   %s' % fa_
+00088050: 6669 6c65 5f74 725f 6e65 7720 290a 2020  file_tr_new ).  
+00088060: 2020 7072 696e 7428 2720 2020 2573 2720    print('   %s' 
+00088070: 2520 6661 5f66 696c 655f 7072 5f6e 6577  % fa_file_pr_new
+00088080: 2029 0a20 2020 2069 6620 7265 763a 2070   ).    if rev: p
+00088090: 7269 6e74 2827 2020 2025 7327 2025 2067  rint('   %s' % g
+000880a0: 7466 5f66 696c 655f 6e65 7729 0a0a 2020  tf_file_new)..  
+000880b0: 2020 736e 765f 6c73 7420 3d20 5b5d 0a20    snv_lst = []. 
+000880c0: 2020 2066 6f72 2073 6e76 2069 6e20 736e     for snv in sn
+000880d0: 765f 696e 666f 5f6c 7374 3a0a 2020 2020  v_info_lst:.    
+000880e0: 2020 2020 6e76 6920 3d20 746f 5f6e 765f      nvi = to_nv_
+000880f0: 7369 6d70 6c65 2820 736e 7620 290a 2020  simple( snv ).  
+00088100: 2020 2020 2020 736e 765f 6c73 742e 6170        snv_lst.ap
+00088110: 7065 6e64 286e 7669 290a 2020 2020 2020  pend(nvi).      
+00088120: 2020 0a20 2020 2064 665f 736e 7620 3d20    .    df_snv = 
+00088130: 7064 2e44 6174 6146 7261 6d65 2873 6e76  pd.DataFrame(snv
+00088140: 5f6c 7374 290a 2020 2020 6466 5f73 6e76  _lst).    df_snv
+00088150: 2e74 6f5f 6373 7628 666e 616d 655f 736e  .to_csv(fname_sn
+00088160: 762c 2073 6570 203d 2027 5c74 2729 0a20  v, sep = '\t'). 
+00088170: 2020 2070 7269 6e74 2827 534e 5620 7375     print('SNV su
+00088180: 6d6d 6172 7920 7361 7665 6420 746f 205c  mmary saved to \
+00088190: 6e20 2020 2573 2720 2520 666e 616d 655f  n   %s' % fname_
+000881a0: 736e 7629 0a20 2020 2023 2077 7269 7465  snv).    # write
+000881b0: 5f74 6f5f 7663 6628 2073 6e76 5f69 6e66  _to_vcf( snv_inf
+000881c0: 6f5f 6c73 742c 2066 6e61 6d65 5f76 6366  o_lst, fname_vcf
+000881d0: 2029 0a0a 2020 2020 2327 2727 2020 2020   )..    #'''    
+000881e0: 0a20 2020 2069 6620 7265 763a 0a20 2020  .    if rev:.   
+000881f0: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
+00088200: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
+00088210: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+00088220: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
+00088230: 6375 7374 6f6d 697a 6564 2067 656e 6f6d  customized genom
+00088240: 6520 2e2e 2027 2c20 656e 6420 3d20 2727  e .. ', end = ''
+00088250: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+00088260: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00088270: 2023 2068 6472 5f6c 696e 6573 2e61 7070   # hdr_lines.app
+00088280: 656e 6428 2752 6566 2e20 6765 6e6f 6d65  end('Ref. genome
+00088290: 3a20 2573 2720 2520 6765 6e6f 6d65 5f66  : %s' % genome_f
+000882a0: 696c 6529 0a20 2020 2020 2020 2023 2073  ile).        # s
+000882b0: 6176 655f 6774 6628 6774 665f 6669 6c65  ave_gtf(gtf_file
+000882c0: 5f6e 6577 2c20 6774 665f 6c69 6e65 732c  _new, gtf_lines,
+000882d0: 2068 6472 5f6c 696e 6573 290a 2020 2020   hdr_lines).    
+000882e0: 2020 2020 0a20 2020 2020 2020 2065 6c61      .        ela
+000882f0: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
+00088300: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
+00088310: 7469 6d65 0a20 2020 2020 2020 2070 7269  time.        pri
+00088320: 6e74 2827 2064 6f6e 652e 2025 6928 7329  nt(' done. %i(s)
+00088330: 205c 6e20 2020 2573 2720 2520 2865 6c61   \n   %s' % (ela
+00088340: 7073 6564 5f74 696d 652c 2067 7466 5f66  psed_time, gtf_f
+00088350: 696c 655f 6e65 7729 290a 2020 2020 2020  ile_new)).      
+00088360: 2020 2727 270a 2020 2020 2020 2020 2323    '''.        ##
+00088370: 2053 6176 6520 6765 6e6f 6d65 2063 6f72   Save genome cor
+00088380: 7265 6374 6564 0a20 2020 2020 2020 2070  rected.        p
+00088390: 7269 6e74 2827 596f 7520 6172 6520 616c  rint('You are al
+000883a0: 6d6f 7374 2064 6f6e 652e 205c 6e4c 6173  most done. \nLas
+000883b0: 7420 7374 6570 2069 7320 746f 2073 6176  t step is to sav
+000883c0: 6520 7468 6520 6669 7865 6420 6765 6e6f  e the fixed geno
+000883d0: 6d65 2e20 2729 0a20 2020 2020 2020 2073  me. ').        s
+000883e0: 6176 655f 6765 6e6f 6d65 2820 6765 6e6f  ave_genome( geno
+000883f0: 6d65 5f66 696c 655f 6e65 772c 2067 656e  me_file_new, gen
+00088400: 6f6d 652c 2076 6572 626f 7365 203d 2054  ome, verbose = T
+00088410: 7275 652c 2074 6974 6c65 203d 2027 4765  rue, title = 'Ge
+00088420: 6e6f 6d65 2d72 6576 2720 290a 2020 2020  nome-rev' ).    
+00088430: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
+00088440: 2720 2520 6765 6e6f 6d65 5f66 696c 655f  ' % genome_file_
+00088450: 6e65 7720 290a 0a20 2020 2070 7269 6e74  new )..    print
+00088460: 2827 5374 7269 6e67 4669 7820 6669 6e69  ('StringFix fini
+00088470: 7368 6564 2027 2c20 6461 7465 7469 6d65  shed ', datetime
+00088480: 2e64 6174 6574 696d 652e 6e6f 7728 2929  .datetime.now())
+00088490: 0a0a 2020 2020 7265 7475 726e 2066 6e61  ..    return fna
+000884a0: 6d65 2c20 6765 6e6f 6d65 5f66 696c 655f  me, genome_file_
+000884b0: 6e65 7720 232c 2067 6473 5f6e 6577 0a20  new #, gds_new. 
+000884c0: 2020 2023 2727 2720 2020 200a 0a64 6566     #'''    ..def
+000884d0: 2053 7472 696e 6746 6978 5f61 7373 656d   StringFix_assem
+000884e0: 626c 6528 2049 6e70 7574 203d 204e 6f6e  ble( Input = Non
+000884f0: 652c 2067 656e 6f6d 655f 6661 203d 204e  e, genome_fa = N
+00088500: 6f6e 652c 2061 6e6e 6f74 5f67 7466 203d  one, annot_gtf =
+00088510: 204e 6f6e 652c 206f 7574 5f64 6972 203d   None, out_dir =
+00088520: 2027 5346 6978 5f6f 7574 272c 205c 0a20   'SFix_out', \. 
+00088530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088540: 2020 2020 2020 206e 5f63 6f72 6573 203d         n_cores =
+00088550: 2034 2c20 6f75 745f 6375 7374 6f6d 5f67   4, out_custom_g
+00088560: 656e 6f6d 6520 3d20 4661 6c73 652c 2073  enome = False, s
+00088570: 7566 6669 7820 3d20 4e6f 6e65 2c20 5c0a  uffix = None, \.
+00088580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088590: 2020 2020 2020 2020 6d63 7620 3d20 302e          mcv = 0.
+000885a0: 352c 206d 6364 203d 2031 2c20 6d74 6c20  5, mcd = 1, mtl 
+000885b0: 3d20 3230 302c 206d 706c 203d 2035 302c  = 200, mpl = 50,
+000885c0: 206d 6469 203d 2032 2c20 6d64 6420 3d20   mdi = 2, mdd = 
+000885d0: 322c 206d 6470 203d 2033 2c20 5c0a 2020  2, mdp = 3, \.  
+000885e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000885f0: 2020 2020 2020 6d64 6620 3d20 302e 322c        mdf = 0.2,
+00088600: 206e 5f70 203d 2031 362c 2078 7361 203d   n_p = 16, xsa =
+00088610: 2054 7275 652c 206a 756d 705f 746f 203d   True, jump_to =
+00088620: 2030 2029 3a0a 0a20 2020 2070 7269 6e74   0 ):..    print
+00088630: 2827 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('+-------------
+00088640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00088650: 2d2b 2729 0a20 2020 2070 7269 6e74 2827  -+').    print('
+00088660: 7c20 2020 2020 2053 7472 696e 6766 6978  |      Stringfix
+00088670: 2076 2e25 7320 2020 2020 2020 7c27 2025   v.%s       |' %
+00088680: 2053 7472 696e 6746 6978 5f76 6572 7369   StringFix_versi
+00088690: 6f6e 290a 2020 2020 7072 696e 7428 272b  on).    print('+
 000886a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000886b0: 2b27 290a 0a20 2020 2069 6620 496e 7075  +')..    if Inpu
-000886c0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
-000886d0: 2020 2070 7269 6e74 2827 5573 6167 653a     print('Usage:
-000886e0: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
-000886f0: 2827 2531 3273 3a20 2720 2520 2761 7267  ('%12s: ' % 'arg
-00088700: 756d 656e 7427 2c20 2764 6573 6372 6970  ument', 'descrip
-00088710: 7469 6f6e 2720 290a 2020 2020 2020 2020  tion' ).        
-00088720: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
-00088730: 2027 496e 7075 7427 2c20 2749 6e70 7574   'Input', 'Input
-00088740: 2053 414d 206f 7220 4241 4d20 6669 6c65   SAM or BAM file
-00088750: 2e20 7079 6261 6d2e 7079 2069 7320 7265  . pybam.py is re
-00088760: 7175 6972 6564 2066 6f72 2042 414d 2069  quired for BAM i
-00088770: 6e70 7574 2e27 2029 0a20 2020 2020 2020  nput.' ).       
-00088780: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-00088790: 2520 2767 656e 6f6d 655f 6661 272c 2065  % 'genome_fa', e
-000887a0: 6e64 203d 2027 2729 0a20 2020 2020 2020  nd = '').       
-000887b0: 2070 7269 6e74 2827 2047 656e 6f6d 6520   print(' Genome 
-000887c0: 6661 7374 6120 6669 6c65 2075 7365 6420  fasta file used 
-000887d0: 746f 2067 656e 6572 6174 6520 7468 6520  to generate the 
-000887e0: 696e 7075 7420 5341 4d2f 4241 4d2e 2027  input SAM/BAM. '
-000887f0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
-00088800: 2827 2531 3273 2020 2049 7420 6973 2075  ('%12s   It is u
-00088810: 7365 6420 746f 2063 6f72 7265 6374 2073  sed to correct s
-00088820: 6571 7565 6e63 6573 206e 6f74 2063 6f76  equences not cov
-00088830: 6572 6564 2062 7920 7265 6164 732c 2027  ered by reads, '
-00088840: 2025 2027 2729 0a20 2020 2020 2020 2070   % '').        p
-00088850: 7269 6e74 2827 2531 3273 2020 2074 6f20  rint('%12s   to 
-00088860: 6964 656e 7469 6679 2053 4e50 7320 616e  identify SNPs an
-00088870: 6420 746f 2067 656e 6572 6174 6520 6375  d to generate cu
-00088880: 7374 6f6d 697a 6564 2067 656e 6f6d 652e  stomized genome.
-00088890: 2027 2020 2520 2727 290a 2020 2020 2020   '  % '').      
-000888a0: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
-000888b0: 2025 2027 616e 6e6f 745f 6774 6627 2c20   % 'annot_gtf', 
-000888c0: 2747 5446 2f47 4646 2066 696c 6520 746f  'GTF/GFF file to
-000888d0: 2062 6520 7573 6564 2066 6f72 2067 7569   be used for gui
-000888e0: 6465 2061 6e6e 6f74 6174 696f 6e27 2029  de annotation' )
-000888f0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088900: 2531 3273 3a20 2720 2520 276f 7574 5f64  %12s: ' % 'out_d
-00088910: 6972 272c 2027 4f75 7470 7574 2064 6972  ir', 'Output dir
-00088920: 6563 746f 7279 2720 290a 2020 2020 2020  ectory' ).      
-00088930: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
-00088940: 2025 2027 6e5f 636f 7265 7327 2c20 274e   % 'n_cores', 'N
-00088950: 756d 6265 7220 6f66 2063 6f72 6573 2074  umber of cores t
-00088960: 6f20 7573 6527 2029 0a20 2020 2020 2020  o use' ).       
-00088970: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-00088980: 2520 2773 7566 6669 7827 2c20 2753 7566  % 'suffix', 'Suf
-00088990: 6669 7820 746f 2062 6520 7573 6564 2066  fix to be used f
-000889a0: 6f72 206f 7574 7075 7420 6669 6c65 206e  or output file n
-000889b0: 616d 6573 2720 290a 2020 2020 2020 2020  ames' ).        
-000889c0: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
-000889d0: 2027 6d63 7627 2c20 274d 696e 696d 756d   'mcv', 'Minimum
-000889e0: 2072 6561 6420 636f 7665 7261 6765 2066   read coverage f
-000889f0: 6f72 2069 6e63 6c75 7369 6f6e 2069 6e20  or inclusion in 
-00088a00: 7468 6520 6f75 7470 7574 2047 5446 2f47  the output GTF/G
-00088a10: 4646 2720 290a 2020 2020 2020 2020 7072  FF' ).        pr
-00088a20: 696e 7428 2725 3132 7320 2020 616e 6420  int('%12s   and 
-00088a30: 7472 616e 7363 7269 7074 6f6d 652f 7072  transcriptome/pr
-00088a40: 6f74 656f 6d65 205b 307e 315d 2e20 466f  oteome [0~1]. Fo
-00088a50: 7220 6120 6c65 6e67 7468 204c 2074 7261  r a length L tra
-00088a60: 6e73 6372 6970 742c 2027 2025 2027 2729  nscript, ' % '')
-00088a70: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088a80: 2531 3273 2020 2069 7420 7769 6c6c 2062  %12s   it will b
-00088a90: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
-00088aa0: 6520 6f75 7470 7574 2069 6620 6174 206c  e output if at l
-00088ab0: 6561 7374 206d 6376 2a4c 2062 6173 6573  east mcv*L bases
-00088ac0: 2061 7265 2063 6f76 6572 6564 2062 7920   are covered by 
-00088ad0: 7265 6164 7320 2720 2025 2027 2729 0a20  reads '  % ''). 
-00088ae0: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
-00088af0: 3273 3a20 2720 2520 276d 6364 272c 2027  2s: ' % 'mcd', '
-00088b00: 4d69 6e69 6d75 6d20 6261 7365 2063 6f76  Minimum base cov
-00088b10: 6572 6167 6520 6465 7074 6820 666f 7220  erage depth for 
-00088b20: 696e 636c 7573 696f 6e20 696e 2074 6865  inclusion in the
-00088b30: 206f 7574 7075 7427 2029 0a20 2020 2020   output' ).     
-00088b40: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
-00088b50: 2720 2520 276d 746c 272c 2027 4d69 6e69  ' % 'mtl', 'Mini
-00088b60: 6d75 6d20 7472 616e 7363 7269 7074 206c  mum transcript l
-00088b70: 656e 6774 6820 696e 2062 6173 6573 2720  ength in bases' 
-00088b80: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00088b90: 2725 3132 733a 2027 2025 2027 6d70 6c27  '%12s: ' % 'mpl'
-00088ba0: 2c20 274d 696e 696d 756d 2070 726f 7465  , 'Minimum prote
-00088bb0: 696e 2028 616d 696e 6f20 6163 6964 2073  in (amino acid s
-00088bc0: 6571 7565 6e63 6529 206c 656e 6774 6827  equence) length'
-00088bd0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
-00088be0: 2827 2531 3273 3a20 2720 2520 276d 6469  ('%12s: ' % 'mdi
-00088bf0: 272c 2027 4d69 6e69 6d75 6d20 636f 7665  ', 'Minimum cove
-00088c00: 7261 6765 2064 6570 7468 2066 6f72 2061  rage depth for a
-00088c10: 6e20 696e 7365 7273 696f 6e20 746f 2062  n insersion to b
-00088c20: 6520 636f 6e73 6964 6572 6564 2076 616c  e considered val
-00088c30: 6964 205b 3e3d 312e 305d 2720 290a 2020  id [>=1.0]' ).  
-00088c40: 2020 2020 2020 7072 696e 7428 2725 3132        print('%12
-00088c50: 733a 2027 2025 2027 6d64 6427 2c20 274d  s: ' % 'mdd', 'M
-00088c60: 696e 696d 756d 2063 6f76 6572 6167 6520  inimum coverage 
-00088c70: 6465 7074 6820 666f 7220 6120 6465 6c65  depth for a dele
-00088c80: 7469 6f6e 2074 6f20 6265 2063 6f6e 7369  tion to be consi
-00088c90: 6465 7265 6420 7661 6c69 6420 5b3e 3d31  dered valid [>=1
-00088ca0: 2e30 5d27 2029 0a20 2020 2020 2020 2070  .0]' ).        p
-00088cb0: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
-00088cc0: 276d 6470 272c 2027 4d69 6e69 6d75 6d20  'mdp', 'Minimum 
-00088cd0: 636f 7665 7261 6765 2064 6570 7468 2066  coverage depth f
-00088ce0: 6f72 2053 4e50 2063 6f72 7265 6374 696f  or SNP correctio
-00088cf0: 6e20 5b3e 3d31 2e30 5d27 2029 0a20 2020  n [>=1.0]' ).   
-00088d00: 2020 2020 2070 7269 6e74 2827 2531 3273       print('%12s
-00088d10: 3a20 2720 2520 276d 6466 272c 2027 4d69  : ' % 'mdf', 'Mi
-00088d20: 6e69 6d75 6d20 636f 7665 7261 6765 2064  nimum coverage d
-00088d30: 6570 7468 2066 7261 6374 696f 6e20 666f  epth fraction fo
-00088d40: 7220 696e 7365 7273 696f 6e20 616e 6420  r insersion and 
-00088d50: 6465 6c65 7469 6f6e 2074 6f20 6265 2063  deletion to be c
-00088d60: 6f6e 7369 6465 7265 6420 7661 6c69 6420  onsidered valid 
-00088d70: 2830 7e31 2927 2029 0a20 2020 2020 2020  (0~1)' ).       
-00088d80: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-00088d90: 2520 276a 756d 705f 746f 272c 2027 4a75  % 'jump_to', 'Ju
-00088da0: 6d70 2074 6f20 7374 6570 206a 205b 3020  mp to step j [0 
-00088db0: 6f72 2031 206f 7220 325d 2720 290a 2020  or 1 or 2]' ).  
-00088dc0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00088dd0: 2020 7361 6d5f 6669 6c65 203d 2049 6e70    sam_file = Inp
-00088de0: 7574 0a20 2020 2067 7466 5f66 696c 6520  ut.    gtf_file 
-00088df0: 3d20 616e 6e6f 745f 6774 660a 0a20 2020  = annot_gtf..   
-00088e00: 2069 6620 5059 4241 4d5f 4552 523a 0a20   if PYBAM_ERR:. 
-00088e10: 2020 2020 2020 2070 7269 6e74 2827 5374         print('St
-00088e20: 7269 6e67 4669 7820 5741 524e 494e 473a  ringFix WARNING:
-00088e30: 2070 7962 616d 206e 6f74 2061 7661 696c   pybam not avail
-00088e40: 6162 6c65 2e20 4163 6365 7074 2053 414d  able. Accept SAM
-00088e50: 2066 696c 6520 6f6e 6c79 2e27 290a 0a20   file only.').. 
-00088e60: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
-00088e70: 2069 7320 6e6f 7420 4e6f 6e65 2920 2620   is not None) & 
-00088e80: 2867 7466 5f66 696c 6520 6973 206e 6f74  (gtf_file is not
-00088e90: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
-00088ea0: 7072 696e 7428 2753 7472 696e 6746 6978  print('StringFix
-00088eb0: 2069 7320 7275 6e6e 696e 6720 696e 2061   is running in a
-00088ec0: 6e6e 6f74 6174 696f 6e20 6775 6964 6564  nnotation guided
-00088ed0: 206d 6f64 6520 7769 7468 2073 6571 7565   mode with seque
-00088ee0: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
-00088ef0: 290a 2020 2020 656c 6966 2028 6765 6e6f  ).    elif (geno
-00088f00: 6d65 5f66 6120 6973 206e 6f74 204e 6f6e  me_fa is not Non
-00088f10: 6529 2026 2028 6774 665f 6669 6c65 2069  e) & (gtf_file i
-00088f20: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
-00088f30: 2070 7269 6e74 2827 5374 7269 6e67 4669   print('StringFi
-00088f40: 7820 6973 2072 756e 6e69 6e67 2069 6e20  x is running in 
-00088f50: 6765 6e6f 6d65 2067 7569 6465 6420 6d6f  genome guided mo
-00088f60: 6465 2077 6974 6820 7365 7175 656e 6365  de with sequence
-00088f70: 2063 6f72 7265 6374 696f 6e2e 2729 0a20   correction.'). 
-00088f80: 2020 2065 6c69 6620 2867 656e 6f6d 655f     elif (genome_
-00088f90: 6661 2069 7320 4e6f 6e65 2920 2620 2867  fa is None) & (g
-00088fa0: 7466 5f66 696c 6520 6973 204e 6f6e 6529  tf_file is None)
-00088fb0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00088fc0: 2753 7472 696e 6746 6978 2069 7320 7275  'StringFix is ru
-00088fd0: 6e6e 696e 6720 696e 2067 656e 6f6d 6520  nning in genome 
-00088fe0: 6775 6964 6564 206d 6f64 6520 7769 7468  guided mode with
-00088ff0: 6f75 7420 7365 7175 656e 6365 2063 6f72  out sequence cor
-00089000: 7265 6374 696f 6e2e 2729 0a20 2020 2065  rection.').    e
-00089010: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
-00089020: 6e74 2827 5374 7269 6e67 4669 7820 6973  nt('StringFix is
-00089030: 2072 756e 6e69 6e67 2069 6e20 616e 6e6f   running in anno
-00089040: 7461 7469 6f6e 2067 7569 6465 6420 6d6f  tation guided mo
-00089050: 6465 2077 6974 686f 7574 2073 6571 7565  de without seque
-00089060: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
-00089070: 290a 2020 2020 0a0a 2020 2020 2320 7265  ).    ..    # re
-00089080: 7620 3d20 4661 6c73 650a 2020 2020 7265  v = False.    re
-00089090: 7620 3d20 6f75 745f 6375 7374 6f6d 5f67  v = out_custom_g
-000890a0: 656e 6f6d 650a 2020 2020 6362 7963 203d  enome.    cbyc =
-000890b0: 2054 7275 6520 0a20 2020 2073 6120 3d20   True .    sa = 
-000890c0: 320a 2020 2020 6966 2078 7361 3a20 7361  2.    if xsa: sa
-000890d0: 203d 2030 0a0a 2020 2020 4d49 4e5f 4356   = 0..    MIN_CV
-000890e0: 475f 464f 525f 534e 505f 434f 5252 4543  G_FOR_SNP_CORREC
-000890f0: 5449 4f4e 203d 2069 6e74 286d 6470 290a  TION = int(mdp).
-00089100: 2020 2020 495f 5641 4c49 445f 4356 4720      I_VALID_CVG 
-00089110: 3d20 6d61 7828 312c 206e 702e 666c 6f61  = max(1, np.floa
-00089120: 7428 6d64 6929 290a 2020 2020 445f 5641  t(mdi)).    D_VA
-00089130: 4c49 445f 4356 4720 3d20 6d61 7828 312c  LID_CVG = max(1,
-00089140: 206e 702e 666c 6f61 7428 6d64 6429 290a   np.float(mdd)).
-00089150: 2020 2020 495f 5641 4c49 445f 4346 5241      I_VALID_CFRA
-00089160: 4320 3d20 666c 6f61 7428 6d64 6629 0a20  C = float(mdf). 
-00089170: 2020 2044 5f56 414c 4944 5f43 4652 4143     D_VALID_CFRAC
-00089180: 203d 2066 6c6f 6174 286d 6466 290a 2020   = float(mdf).  
-00089190: 2020 4d49 4e5f 434f 565f 544f 5f53 454c    MIN_COV_TO_SEL
-000891a0: 203d 206e 702e 666c 6f61 7428 6d63 7629   = np.float(mcv)
-000891b0: 0a20 2020 204d 494e 5f41 424e 5f54 4f5f  .    MIN_ABN_TO_
-000891c0: 5345 4c20 3d20 6e70 2e66 6c6f 6174 286d  SEL = np.float(m
-000891d0: 6364 290a 2020 2020 4d49 4e5f 5452 5f4c  cd).    MIN_TR_L
-000891e0: 454e 4754 4820 3d20 696e 7428 6d74 6c29  ENGTH = int(mtl)
-000891f0: 0a20 2020 204d 494e 5f50 525f 4c45 4e47  .    MIN_PR_LENG
-00089200: 5448 203d 2069 6e74 286d 706c 290a 2020  TH = int(mpl).  
-00089210: 2020 4d41 585f 4e55 4d5f 5041 5448 5320    MAX_NUM_PATHS 
-00089220: 3d20 696e 7428 6e5f 7029 0a20 2020 2047  = int(n_p).    G
-00089230: 454e 5f41 4153 5f55 4e53 5045 4320 3d20  EN_AAS_UNSPEC = 
-00089240: 5472 7565 0a0a 2020 2020 6966 2067 7466  True..    if gtf
-00089250: 5f66 696c 6520 6973 204e 6f6e 653a 0a20  _file is None:. 
-00089260: 2020 2020 2020 204d 4158 5f4e 554d 5f50         MAX_NUM_P
-00089270: 4154 4853 203d 2032 300a 2020 2020 2020  ATHS = 20.      
-00089280: 2020 4d49 4e5f 4e5f 5244 535f 5045 525f    MIN_N_RDS_PER_
-00089290: 4745 4e45 203d 2033 300a 2020 2020 2020  GENE = 30.      
-000892a0: 2020 5452 5f46 494c 5445 525f 5345 4c20    TR_FILTER_SEL 
-000892b0: 3d20 320a 0a20 2020 2069 6620 6f75 745f  = 2..    if out_
-000892c0: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
-000892d0: 200a 2020 2020 2020 2020 6966 206e 6f74   .        if not
-000892e0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-000892f0: 6f75 745f 6469 7229 3a20 6f73 2e6d 6b64  out_dir): os.mkd
-00089300: 6972 286f 7574 5f64 6972 290a 0a20 2020  ir(out_dir)..   
-00089310: 2066 696c 655f 6f75 742c 2067 6473 2c20   file_out, gds, 
-00089320: 6765 6e6f 6d65 203d 2053 7472 696e 6746  genome = StringF
-00089330: 6978 5f61 6e61 6c79 7369 7328 7361 6d5f  ix_analysis(sam_
-00089340: 6669 6c65 2c20 6774 6620 3d20 6774 665f  file, gtf = gtf_
-00089350: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
-00089360: 6520 3d20 6765 6e6f 6d65 5f66 612c 206a  e = genome_fa, j
-00089370: 756d 7020 3d20 6a75 6d70 5f74 6f2c 205c  ump = jump_to, \
-00089380: 0a20 2020 2020 2020 2020 2020 206e 5f63  .            n_c
-00089390: 6f72 6573 3d6e 5f63 6f72 6573 2c20 6f75  ores=n_cores, ou
-000893a0: 745f 7472 203d 2054 7275 652c 2063 6279  t_tr = True, cby
-000893b0: 6320 3d20 6362 7963 2c20 7375 6666 6978  c = cbyc, suffix
-000893c0: 203d 2073 7566 6669 782c 206f 7574 5f64   = suffix, out_d
-000893d0: 6972 203d 206f 7574 5f64 6972 2c20 7361  ir = out_dir, sa
-000893e0: 203d 2073 6120 2920 0a0a 2020 2020 6966   = sa ) ..    if
-000893f0: 2028 6764 7320 6973 206e 6f74 204e 6f6e   (gds is not Non
-00089400: 6529 2026 2028 6a75 6d70 5f74 6f20 3c20  e) & (jump_to < 
-00089410: 3229 3a0a 2020 2020 2020 2020 7072 696e  2):.        prin
-00089420: 7428 2753 6176 696e 6720 6765 6e65 2064  t('Saving gene d
-00089430: 6573 6372 6970 746f 7220 2e2e 2027 2c20  escriptor .. ', 
-00089440: 656e 6420 3d20 2720 272c 2066 6c75 7368  end = ' ', flush
-00089450: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-00089460: 2077 6974 6820 6f70 656e 2866 696c 655f   with open(file_
-00089470: 6f75 7420 2b20 272e 6764 7327 2c20 2777  out + '.gds', 'w
-00089480: 6227 2920 6173 2066 3a0a 2020 2020 2020  b') as f:.      
-00089490: 2020 2020 2020 7069 636b 6c65 2e64 756d        pickle.dum
-000894a0: 7028 2028 6764 7329 2c20 6620 290a 2020  p( (gds), f ).  
-000894b0: 2020 2020 2020 7072 696e 7428 2764 6f6e        print('don
-000894c0: 652e 2027 290a 2020 2020 656c 7365 3a0a  e. ').    else:.
-000894d0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-000894e0: 7472 696e 6746 6978 2073 7461 7274 6564  tringFix started
-000894f0: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
-00089500: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
-00089510: 2020 2020 2070 7269 6e74 2827 4c6f 6164       print('Load
-00089520: 696e 6720 6765 6e65 2064 6573 6372 6970  ing gene descrip
-00089530: 746f 7220 2e2e 2027 2c20 656e 6420 3d20  tor .. ', end = 
-00089540: 2720 272c 2066 6c75 7368 203d 2054 7275  ' ', flush = Tru
-00089550: 6529 0a20 2020 2020 2020 2077 6974 6820  e).        with 
-00089560: 6f70 656e 2866 696c 655f 6f75 7420 2b20  open(file_out + 
-00089570: 272e 6764 7327 2c20 2772 6227 2920 6173  '.gds', 'rb') as
-00089580: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-00089590: 6764 7320 3d20 7069 636b 6c65 2e6c 6f61  gds = pickle.loa
-000895a0: 6428 2066 2029 0a20 2020 2020 2020 2067  d( f ).        g
-000895b0: 656e 6f6d 6520 3d20 6765 6e6f 6d65 5f66  enome = genome_f
-000895c0: 610a 2020 2020 2020 2020 7072 696e 7428  a.        print(
-000895d0: 2764 6f6e 652e 2027 290a 2020 2020 0a20  'done. ').    . 
-000895e0: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
-000895f0: 2069 7320 4e6f 6e65 293a 0a20 2020 2020   is None):.     
-00089600: 2020 2070 7269 6e74 2827 5374 7269 6e67     print('String
-00089610: 4669 7820 6669 6e69 7368 6564 2027 2c20  Fix finished ', 
-00089620: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-00089630: 652e 6e6f 7728 2929 0a20 2020 2065 6c73  e.now()).    els
-00089640: 653a 0a20 2020 2020 2020 2066 696c 655f  e:.        file_
-00089650: 6f75 742c 2066 696c 655f 6f75 745f 6765  out, file_out_ge
-00089660: 6e6f 6d65 203d 2053 7472 696e 6746 6978  nome = StringFix
-00089670: 5f73 796e 7468 6573 6973 2820 6669 6c65  _synthesis( file
-00089680: 5f6f 7574 202b 2027 2e67 6666 272c 2067  _out + '.gff', g
-00089690: 656e 6f6d 652c 205c 0a20 2020 2020 2020  enome, \.       
-000896a0: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
-000896b0: 3d6e 5f63 6f72 6573 2c20 7265 7620 3d20  =n_cores, rev = 
-000896c0: 7265 762c 206f 7574 5f64 6972 203d 206f  rev, out_dir = o
-000896d0: 7574 5f64 6972 2c20 6764 7320 3d20 6764  ut_dir, gds = gd
-000896e0: 7320 290a 2020 2020 2020 2020 0a20 2020  s ).        .   
-000896f0: 2072 6574 7572 6e20 6669 6c65 5f6f 7574   return file_out
-00089700: 0a20 2020 2020 2020 200a 0a23 2323 2323  .        ..#####
-00089710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000886b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2b27  --------------+'
+000886c0: 290a 0a20 2020 2069 6620 496e 7075 7420  )..    if Input 
+000886d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000886e0: 2070 7269 6e74 2827 5573 6167 653a 2729   print('Usage:')
+000886f0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088700: 2531 3273 3a20 2720 2520 2761 7267 756d  %12s: ' % 'argum
+00088710: 656e 7427 2c20 2764 6573 6372 6970 7469  ent', 'descripti
+00088720: 6f6e 2720 290a 2020 2020 2020 2020 7072  on' ).        pr
+00088730: 696e 7428 2725 3132 733a 2027 2025 2027  int('%12s: ' % '
+00088740: 496e 7075 7427 2c20 2749 6e70 7574 2053  Input', 'Input S
+00088750: 414d 206f 7220 4241 4d20 6669 6c65 2e20  AM or BAM file. 
+00088760: 7079 6261 6d2e 7079 2069 7320 7265 7175  pybam.py is requ
+00088770: 6972 6564 2066 6f72 2042 414d 2069 6e70  ired for BAM inp
+00088780: 7574 2e27 2029 0a20 2020 2020 2020 2070  ut.' ).        p
+00088790: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
+000887a0: 2767 656e 6f6d 655f 6661 272c 2065 6e64  'genome_fa', end
+000887b0: 203d 2027 2729 0a20 2020 2020 2020 2070   = '').        p
+000887c0: 7269 6e74 2827 2047 656e 6f6d 6520 6661  rint(' Genome fa
+000887d0: 7374 6120 6669 6c65 2075 7365 6420 746f  sta file used to
+000887e0: 2067 656e 6572 6174 6520 7468 6520 696e   generate the in
+000887f0: 7075 7420 5341 4d2f 4241 4d2e 2027 2029  put SAM/BAM. ' )
+00088800: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088810: 2531 3273 2020 2049 7420 6973 2075 7365  %12s   It is use
+00088820: 6420 746f 2063 6f72 7265 6374 2073 6571  d to correct seq
+00088830: 7565 6e63 6573 206e 6f74 2063 6f76 6572  uences not cover
+00088840: 6564 2062 7920 7265 6164 732c 2027 2025  ed by reads, ' %
+00088850: 2027 2729 0a20 2020 2020 2020 2070 7269   '').        pri
+00088860: 6e74 2827 2531 3273 2020 2074 6f20 6964  nt('%12s   to id
+00088870: 656e 7469 6679 2053 4e50 7320 616e 6420  entify SNPs and 
+00088880: 746f 2067 656e 6572 6174 6520 6375 7374  to generate cust
+00088890: 6f6d 697a 6564 2067 656e 6f6d 652e 2027  omized genome. '
+000888a0: 2020 2520 2727 290a 2020 2020 2020 2020    % '').        
+000888b0: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
+000888c0: 2027 616e 6e6f 745f 6774 6627 2c20 2747   'annot_gtf', 'G
+000888d0: 5446 2f47 4646 2066 696c 6520 746f 2062  TF/GFF file to b
+000888e0: 6520 7573 6564 2066 6f72 2067 7569 6465  e used for guide
+000888f0: 2061 6e6e 6f74 6174 696f 6e27 2029 0a20   annotation' ). 
+00088900: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
+00088910: 3273 3a20 2720 2520 276f 7574 5f64 6972  2s: ' % 'out_dir
+00088920: 272c 2027 4f75 7470 7574 2064 6972 6563  ', 'Output direc
+00088930: 746f 7279 2720 290a 2020 2020 2020 2020  tory' ).        
+00088940: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
+00088950: 2027 6e5f 636f 7265 7327 2c20 274e 756d   'n_cores', 'Num
+00088960: 6265 7220 6f66 2063 6f72 6573 2074 6f20  ber of cores to 
+00088970: 7573 6527 2029 0a20 2020 2020 2020 2070  use' ).        p
+00088980: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
+00088990: 2773 7566 6669 7827 2c20 2753 7566 6669  'suffix', 'Suffi
+000889a0: 7820 746f 2062 6520 7573 6564 2066 6f72  x to be used for
+000889b0: 206f 7574 7075 7420 6669 6c65 206e 616d   output file nam
+000889c0: 6573 2720 290a 2020 2020 2020 2020 7072  es' ).        pr
+000889d0: 696e 7428 2725 3132 733a 2027 2025 2027  int('%12s: ' % '
+000889e0: 6d63 7627 2c20 274d 696e 696d 756d 2072  mcv', 'Minimum r
+000889f0: 6561 6420 636f 7665 7261 6765 2066 6f72  ead coverage for
+00088a00: 2069 6e63 6c75 7369 6f6e 2069 6e20 7468   inclusion in th
+00088a10: 6520 6f75 7470 7574 2047 5446 2f47 4646  e output GTF/GFF
+00088a20: 2720 290a 2020 2020 2020 2020 7072 696e  ' ).        prin
+00088a30: 7428 2725 3132 7320 2020 616e 6420 7472  t('%12s   and tr
+00088a40: 616e 7363 7269 7074 6f6d 652f 7072 6f74  anscriptome/prot
+00088a50: 656f 6d65 205b 307e 315d 2e20 466f 7220  eome [0~1]. For 
+00088a60: 6120 6c65 6e67 7468 204c 2074 7261 6e73  a length L trans
+00088a70: 6372 6970 742c 2027 2025 2027 2729 0a20  cript, ' % ''). 
+00088a80: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
+00088a90: 3273 2020 2069 7420 7769 6c6c 2062 6520  2s   it will be 
+00088aa0: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
+00088ab0: 6f75 7470 7574 2069 6620 6174 206c 6561  output if at lea
+00088ac0: 7374 206d 6376 2a4c 2062 6173 6573 2061  st mcv*L bases a
+00088ad0: 7265 2063 6f76 6572 6564 2062 7920 7265  re covered by re
+00088ae0: 6164 7320 2720 2025 2027 2729 0a20 2020  ads '  % '').   
+00088af0: 2020 2020 2070 7269 6e74 2827 2531 3273       print('%12s
+00088b00: 3a20 2720 2520 276d 6364 272c 2027 4d69  : ' % 'mcd', 'Mi
+00088b10: 6e69 6d75 6d20 6261 7365 2063 6f76 6572  nimum base cover
+00088b20: 6167 6520 6465 7074 6820 666f 7220 696e  age depth for in
+00088b30: 636c 7573 696f 6e20 696e 2074 6865 206f  clusion in the o
+00088b40: 7574 7075 7427 2029 0a20 2020 2020 2020  utput' ).       
+00088b50: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088b60: 2520 276d 746c 272c 2027 4d69 6e69 6d75  % 'mtl', 'Minimu
+00088b70: 6d20 7472 616e 7363 7269 7074 206c 656e  m transcript len
+00088b80: 6774 6820 696e 2062 6173 6573 2720 290a  gth in bases' ).
+00088b90: 2020 2020 2020 2020 7072 696e 7428 2725          print('%
+00088ba0: 3132 733a 2027 2025 2027 6d70 6c27 2c20  12s: ' % 'mpl', 
+00088bb0: 274d 696e 696d 756d 2070 726f 7465 696e  'Minimum protein
+00088bc0: 2028 616d 696e 6f20 6163 6964 2073 6571   (amino acid seq
+00088bd0: 7565 6e63 6529 206c 656e 6774 6827 2029  uence) length' )
+00088be0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088bf0: 2531 3273 3a20 2720 2520 276d 6469 272c  %12s: ' % 'mdi',
+00088c00: 2027 4d69 6e69 6d75 6d20 636f 7665 7261   'Minimum covera
+00088c10: 6765 2064 6570 7468 2066 6f72 2061 6e20  ge depth for an 
+00088c20: 696e 7365 7273 696f 6e20 746f 2062 6520  insersion to be 
+00088c30: 636f 6e73 6964 6572 6564 2076 616c 6964  considered valid
+00088c40: 205b 3e3d 312e 305d 2720 290a 2020 2020   [>=1.0]' ).    
+00088c50: 2020 2020 7072 696e 7428 2725 3132 733a      print('%12s:
+00088c60: 2027 2025 2027 6d64 6427 2c20 274d 696e   ' % 'mdd', 'Min
+00088c70: 696d 756d 2063 6f76 6572 6167 6520 6465  imum coverage de
+00088c80: 7074 6820 666f 7220 6120 6465 6c65 7469  pth for a deleti
+00088c90: 6f6e 2074 6f20 6265 2063 6f6e 7369 6465  on to be conside
+00088ca0: 7265 6420 7661 6c69 6420 5b3e 3d31 2e30  red valid [>=1.0
+00088cb0: 5d27 2029 0a20 2020 2020 2020 2070 7269  ]' ).        pri
+00088cc0: 6e74 2827 2531 3273 3a20 2720 2520 276d  nt('%12s: ' % 'm
+00088cd0: 6470 272c 2027 4d69 6e69 6d75 6d20 636f  dp', 'Minimum co
+00088ce0: 7665 7261 6765 2064 6570 7468 2066 6f72  verage depth for
+00088cf0: 2053 4e50 2063 6f72 7265 6374 696f 6e20   SNP correction 
+00088d00: 5b3e 3d31 2e30 5d27 2029 0a20 2020 2020  [>=1.0]' ).     
+00088d10: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
+00088d20: 2720 2520 276d 6466 272c 2027 4d69 6e69  ' % 'mdf', 'Mini
+00088d30: 6d75 6d20 636f 7665 7261 6765 2064 6570  mum coverage dep
+00088d40: 7468 2066 7261 6374 696f 6e20 666f 7220  th fraction for 
+00088d50: 696e 7365 7273 696f 6e20 616e 6420 6465  insersion and de
+00088d60: 6c65 7469 6f6e 2074 6f20 6265 2063 6f6e  letion to be con
+00088d70: 7369 6465 7265 6420 7661 6c69 6420 2830  sidered valid (0
+00088d80: 7e31 2927 2029 0a20 2020 2020 2020 2070  ~1)' ).        p
+00088d90: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
+00088da0: 276a 756d 705f 746f 272c 2027 4a75 6d70  'jump_to', 'Jump
+00088db0: 2074 6f20 7374 6570 206a 205b 3020 6f72   to step j [0 or
+00088dc0: 2031 206f 7220 325d 2720 290a 2020 2020   1 or 2]' ).    
+00088dd0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00088de0: 7361 6d5f 6669 6c65 203d 2049 6e70 7574  sam_file = Input
+00088df0: 0a20 2020 2067 7466 5f66 696c 6520 3d20  .    gtf_file = 
+00088e00: 616e 6e6f 745f 6774 660a 0a20 2020 2069  annot_gtf..    i
+00088e10: 6620 5059 4241 4d5f 4552 523a 0a20 2020  f PYBAM_ERR:.   
+00088e20: 2020 2020 2070 7269 6e74 2827 5374 7269       print('Stri
+00088e30: 6e67 4669 7820 5741 524e 494e 473a 2070  ngFix WARNING: p
+00088e40: 7962 616d 206e 6f74 2061 7661 696c 6162  ybam not availab
+00088e50: 6c65 2e20 4163 6365 7074 2053 414d 2066  le. Accept SAM f
+00088e60: 696c 6520 6f6e 6c79 2e27 290a 0a20 2020  ile only.')..   
+00088e70: 2069 6620 2867 656e 6f6d 655f 6661 2069   if (genome_fa i
+00088e80: 7320 6e6f 7420 4e6f 6e65 2920 2620 2867  s not None) & (g
+00088e90: 7466 5f66 696c 6520 6973 206e 6f74 204e  tf_file is not N
+00088ea0: 6f6e 6529 3a0a 2020 2020 2020 2020 7072  one):.        pr
+00088eb0: 696e 7428 2753 7472 696e 6746 6978 2069  int('StringFix i
+00088ec0: 7320 7275 6e6e 696e 6720 696e 2061 6e6e  s running in ann
+00088ed0: 6f74 6174 696f 6e20 6775 6964 6564 206d  otation guided m
+00088ee0: 6f64 6520 7769 7468 2073 6571 7565 6e63  ode with sequenc
+00088ef0: 6520 636f 7272 6563 7469 6f6e 2e27 290a  e correction.').
+00088f00: 2020 2020 656c 6966 2028 6765 6e6f 6d65      elif (genome
+00088f10: 5f66 6120 6973 206e 6f74 204e 6f6e 6529  _fa is not None)
+00088f20: 2026 2028 6774 665f 6669 6c65 2069 7320   & (gtf_file is 
+00088f30: 4e6f 6e65 293a 0a20 2020 2020 2020 2070  None):.        p
+00088f40: 7269 6e74 2827 5374 7269 6e67 4669 7820  rint('StringFix 
+00088f50: 6973 2072 756e 6e69 6e67 2069 6e20 6765  is running in ge
+00088f60: 6e6f 6d65 2067 7569 6465 6420 6d6f 6465  nome guided mode
+00088f70: 2077 6974 6820 7365 7175 656e 6365 2063   with sequence c
+00088f80: 6f72 7265 6374 696f 6e2e 2729 0a20 2020  orrection.').   
+00088f90: 2065 6c69 6620 2867 656e 6f6d 655f 6661   elif (genome_fa
+00088fa0: 2069 7320 4e6f 6e65 2920 2620 2867 7466   is None) & (gtf
+00088fb0: 5f66 696c 6520 6973 204e 6f6e 6529 3a0a  _file is None):.
+00088fc0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+00088fd0: 7472 696e 6746 6978 2069 7320 7275 6e6e  tringFix is runn
+00088fe0: 696e 6720 696e 2067 656e 6f6d 6520 6775  ing in genome gu
+00088ff0: 6964 6564 206d 6f64 6520 7769 7468 6f75  ided mode withou
+00089000: 7420 7365 7175 656e 6365 2063 6f72 7265  t sequence corre
+00089010: 6374 696f 6e2e 2729 0a20 2020 2065 6c73  ction.').    els
+00089020: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+00089030: 2827 5374 7269 6e67 4669 7820 6973 2072  ('StringFix is r
+00089040: 756e 6e69 6e67 2069 6e20 616e 6e6f 7461  unning in annota
+00089050: 7469 6f6e 2067 7569 6465 6420 6d6f 6465  tion guided mode
+00089060: 2077 6974 686f 7574 2073 6571 7565 6e63   without sequenc
+00089070: 6520 636f 7272 6563 7469 6f6e 2e27 290a  e correction.').
+00089080: 2020 2020 0a0a 2020 2020 2320 7265 7620      ..    # rev 
+00089090: 3d20 4661 6c73 650a 2020 2020 7265 7620  = False.    rev 
+000890a0: 3d20 6f75 745f 6375 7374 6f6d 5f67 656e  = out_custom_gen
+000890b0: 6f6d 650a 2020 2020 6362 7963 203d 2054  ome.    cbyc = T
+000890c0: 7275 6520 0a20 2020 2073 6120 3d20 320a  rue .    sa = 2.
+000890d0: 2020 2020 6966 2078 7361 3a20 7361 203d      if xsa: sa =
+000890e0: 2030 0a0a 2020 2020 4d49 4e5f 4356 475f   0..    MIN_CVG_
+000890f0: 464f 525f 534e 505f 434f 5252 4543 5449  FOR_SNP_CORRECTI
+00089100: 4f4e 203d 2069 6e74 286d 6470 290a 2020  ON = int(mdp).  
+00089110: 2020 495f 5641 4c49 445f 4356 4720 3d20    I_VALID_CVG = 
+00089120: 6d61 7828 312c 206e 702e 666c 6f61 7428  max(1, np.float(
+00089130: 6d64 6929 290a 2020 2020 445f 5641 4c49  mdi)).    D_VALI
+00089140: 445f 4356 4720 3d20 6d61 7828 312c 206e  D_CVG = max(1, n
+00089150: 702e 666c 6f61 7428 6d64 6429 290a 2020  p.float(mdd)).  
+00089160: 2020 495f 5641 4c49 445f 4346 5241 4320    I_VALID_CFRAC 
+00089170: 3d20 666c 6f61 7428 6d64 6629 0a20 2020  = float(mdf).   
+00089180: 2044 5f56 414c 4944 5f43 4652 4143 203d   D_VALID_CFRAC =
+00089190: 2066 6c6f 6174 286d 6466 290a 2020 2020   float(mdf).    
+000891a0: 4d49 4e5f 434f 565f 544f 5f53 454c 203d  MIN_COV_TO_SEL =
+000891b0: 206e 702e 666c 6f61 7428 6d63 7629 0a20   np.float(mcv). 
+000891c0: 2020 204d 494e 5f41 424e 5f54 4f5f 5345     MIN_ABN_TO_SE
+000891d0: 4c20 3d20 6e70 2e66 6c6f 6174 286d 6364  L = np.float(mcd
+000891e0: 290a 2020 2020 4d49 4e5f 5452 5f4c 454e  ).    MIN_TR_LEN
+000891f0: 4754 4820 3d20 696e 7428 6d74 6c29 0a20  GTH = int(mtl). 
+00089200: 2020 204d 494e 5f50 525f 4c45 4e47 5448     MIN_PR_LENGTH
+00089210: 203d 2069 6e74 286d 706c 290a 2020 2020   = int(mpl).    
+00089220: 4d41 585f 4e55 4d5f 5041 5448 5320 3d20  MAX_NUM_PATHS = 
+00089230: 696e 7428 6e5f 7029 0a20 2020 2047 454e  int(n_p).    GEN
+00089240: 5f41 4153 5f55 4e53 5045 4320 3d20 5472  _AAS_UNSPEC = Tr
+00089250: 7565 0a0a 2020 2020 6966 2067 7466 5f66  ue..    if gtf_f
+00089260: 696c 6520 6973 204e 6f6e 653a 0a20 2020  ile is None:.   
+00089270: 2020 2020 204d 4158 5f4e 554d 5f50 4154       MAX_NUM_PAT
+00089280: 4853 203d 2032 300a 2020 2020 2020 2020  HS = 20.        
+00089290: 4d49 4e5f 4e5f 5244 535f 5045 525f 4745  MIN_N_RDS_PER_GE
+000892a0: 4e45 203d 2033 300a 2020 2020 2020 2020  NE = 30.        
+000892b0: 5452 5f46 494c 5445 525f 5345 4c20 3d20  TR_FILTER_SEL = 
+000892c0: 320a 0a20 2020 2069 6620 6f75 745f 6469  2..    if out_di
+000892d0: 7220 6973 206e 6f74 204e 6f6e 653a 200a  r is not None: .
+000892e0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+000892f0: 732e 7061 7468 2e65 7869 7374 7328 6f75  s.path.exists(ou
+00089300: 745f 6469 7229 3a20 6f73 2e6d 6b64 6972  t_dir): os.mkdir
+00089310: 286f 7574 5f64 6972 290a 0a20 2020 2066  (out_dir)..    f
+00089320: 696c 655f 6f75 742c 2067 6473 2c20 6765  ile_out, gds, ge
+00089330: 6e6f 6d65 203d 2053 7472 696e 6746 6978  nome = StringFix
+00089340: 5f61 6e61 6c79 7369 7328 7361 6d5f 6669  _analysis(sam_fi
+00089350: 6c65 2c20 6774 6620 3d20 6774 665f 6669  le, gtf = gtf_fi
+00089360: 6c65 2c20 6765 6e6f 6d65 5f66 696c 6520  le, genome_file 
+00089370: 3d20 6765 6e6f 6d65 5f66 612c 206a 756d  = genome_fa, jum
+00089380: 7020 3d20 6a75 6d70 5f74 6f2c 205c 0a20  p = jump_to, \. 
+00089390: 2020 2020 2020 2020 2020 206e 5f63 6f72             n_cor
+000893a0: 6573 3d6e 5f63 6f72 6573 2c20 6f75 745f  es=n_cores, out_
+000893b0: 7472 203d 2054 7275 652c 2063 6279 6320  tr = True, cbyc 
+000893c0: 3d20 6362 7963 2c20 7375 6666 6978 203d  = cbyc, suffix =
+000893d0: 2073 7566 6669 782c 206f 7574 5f64 6972   suffix, out_dir
+000893e0: 203d 206f 7574 5f64 6972 2c20 7361 203d   = out_dir, sa =
+000893f0: 2073 6120 2920 0a0a 2020 2020 6966 2028   sa ) ..    if (
+00089400: 6764 7320 6973 206e 6f74 204e 6f6e 6529  gds is not None)
+00089410: 2026 2028 6a75 6d70 5f74 6f20 3c20 3229   & (jump_to < 2)
+00089420: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00089430: 2753 6176 696e 6720 6765 6e65 2064 6573  'Saving gene des
+00089440: 6372 6970 746f 7220 2e2e 2027 2c20 656e  criptor .. ', en
+00089450: 6420 3d20 2720 272c 2066 6c75 7368 203d  d = ' ', flush =
+00089460: 2054 7275 6529 0a20 2020 2020 2020 2077   True).        w
+00089470: 6974 6820 6f70 656e 2866 696c 655f 6f75  ith open(file_ou
+00089480: 7420 2b20 272e 6764 7327 2c20 2777 6227  t + '.gds', 'wb'
+00089490: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+000894a0: 2020 2020 7069 636b 6c65 2e64 756d 7028      pickle.dump(
+000894b0: 2028 6764 7329 2c20 6620 290a 2020 2020   (gds), f ).    
+000894c0: 2020 2020 7072 696e 7428 2764 6f6e 652e      print('done.
+000894d0: 2027 290a 2020 2020 656c 7365 3a0a 2020   ').    else:.  
+000894e0: 2020 2020 2020 7072 696e 7428 2753 7472        print('Str
+000894f0: 696e 6746 6978 2073 7461 7274 6564 2027  ingFix started '
+00089500: 2c20 6461 7465 7469 6d65 2e64 6174 6574  , datetime.datet
+00089510: 696d 652e 6e6f 7728 2929 0a20 2020 2020  ime.now()).     
+00089520: 2020 2070 7269 6e74 2827 4c6f 6164 696e     print('Loadin
+00089530: 6720 6765 6e65 2064 6573 6372 6970 746f  g gene descripto
+00089540: 7220 2e2e 2027 2c20 656e 6420 3d20 2720  r .. ', end = ' 
+00089550: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
+00089560: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00089570: 656e 2866 696c 655f 6f75 7420 2b20 272e  en(file_out + '.
+00089580: 6764 7327 2c20 2772 6227 2920 6173 2066  gds', 'rb') as f
+00089590: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
+000895a0: 7320 3d20 7069 636b 6c65 2e6c 6f61 6428  s = pickle.load(
+000895b0: 2066 2029 0a20 2020 2020 2020 2067 656e   f ).        gen
+000895c0: 6f6d 6520 3d20 6765 6e6f 6d65 5f66 610a  ome = genome_fa.
+000895d0: 2020 2020 2020 2020 7072 696e 7428 2764          print('d
+000895e0: 6f6e 652e 2027 290a 2020 2020 0a20 2020  one. ').    .   
+000895f0: 2069 6620 2867 656e 6f6d 655f 6661 2069   if (genome_fa i
+00089600: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
+00089610: 2070 7269 6e74 2827 5374 7269 6e67 4669   print('StringFi
+00089620: 7820 6669 6e69 7368 6564 2027 2c20 6461  x finished ', da
+00089630: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+00089640: 6e6f 7728 2929 0a20 2020 2065 6c73 653a  now()).    else:
+00089650: 0a20 2020 2020 2020 2066 696c 655f 6f75  .        file_ou
+00089660: 742c 2066 696c 655f 6f75 745f 6765 6e6f  t, file_out_geno
+00089670: 6d65 203d 2053 7472 696e 6746 6978 5f73  me = StringFix_s
+00089680: 796e 7468 6573 6973 2820 6669 6c65 5f6f  ynthesis( file_o
+00089690: 7574 202b 2027 2e67 6666 272c 2067 656e  ut + '.gff', gen
+000896a0: 6f6d 652c 205c 0a20 2020 2020 2020 2020  ome, \.         
+000896b0: 2020 2020 2020 206e 5f63 6f72 6573 3d6e         n_cores=n
+000896c0: 5f63 6f72 6573 2c20 7265 7620 3d20 7265  _cores, rev = re
+000896d0: 762c 206f 7574 5f64 6972 203d 206f 7574  v, out_dir = out
+000896e0: 5f64 6972 2c20 6764 7320 3d20 6764 7320  _dir, gds = gds 
+000896f0: 290a 2020 2020 2020 2020 0a20 2020 2072  ).        .    r
+00089700: 6574 7572 6e20 6669 6c65 5f6f 7574 0a20  eturn file_out. 
+00089710: 2020 2020 2020 200a 0a23 2323 2323 2323         ..#######
 00089720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00089730: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089740: 2323 2323 0a23 2320 5374 7269 6e67 4669  ####.## StringFi
-00089750: 782d 6164 646f 6e20 2020 2020 2020 2020  x-addon         
-00089760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089750: 2323 0a23 2320 5374 7269 6e67 4669 782d  ##.## StringFix-
+00089760: 6164 646f 6e20 2020 2020 2020 2020 2020  addon           
 00089770: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00089780: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00089790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000897a0: 2020 2020 2023 230a 2323 2064 6576 656c       ##.## devel
-000897b0: 6f70 6564 2062 7920 5365 6f6b 6879 756e  oped by Seokhyun
-000897c0: 2059 6f6f 6e20 2873 796f 6f6e 4064 6b75   Yoon (syoon@dku
-000897d0: 2e65 6475 2920 4f63 742e 2030 342c 2032  .edu) Oct. 04, 2
-000897e0: 3032 3020 2020 2323 0a23 2323 2323 2323  020   ##.#######
-000897f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000897a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000897b0: 2020 2023 230a 2323 2064 6576 656c 6f70     ##.## develop
+000897c0: 6564 2062 7920 5365 6f6b 6879 756e 2059  ed by Seokhyun Y
+000897d0: 6f6f 6e20 2873 796f 6f6e 4064 6b75 2e65  oon (syoon@dku.e
+000897e0: 6475 2920 4f63 742e 2030 342c 2032 3032  du) Oct. 04, 202
+000897f0: 3020 2020 2323 0a23 2323 2323 2323 2323  0   ##.#########
 00089800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00089810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089820: 2323 0a0a 6465 6620 7768 6963 6828 2061  ##..def which( a
-00089830: 692c 2076 616c 7565 203d 2054 7275 6520  i, value = True 
-00089840: 2920 3a0a 2020 2020 7768 203d 205b 5d0a  ) :.    wh = [].
-00089850: 2020 2020 6120 3d20 6c69 7374 2861 6929      a = list(ai)
-00089860: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
-00089870: 6e67 6528 6c65 6e28 6129 293a 200a 2020  nge(len(a)): .  
-00089880: 2020 2020 2020 6966 2061 5b6b 5d20 3d3d        if a[k] ==
-00089890: 2076 616c 7565 3a20 0a20 2020 2020 2020   value: .       
-000898a0: 2020 2020 2077 682e 6170 7065 6e64 286b       wh.append(k
-000898b0: 2920 0a20 2020 2072 6574 7572 6e28 7768  ) .    return(wh
-000898c0: 290a 0a64 6566 2067 6574 5f69 6e66 6f5f  )..def get_info_
-000898d0: 6672 6f6d 5f74 725f 6e61 6d65 2820 746e  from_tr_name( tn
-000898e0: 7320 293a 0a20 2020 200a 2020 2020 6162  s ):.    .    ab
-000898f0: 6e5f 6520 3d20 5b5d 0a20 2020 2074 706d  n_e = [].    tpm
-00089900: 5f65 203d 205b 5d0a 2020 2020 6966 7261  _e = [].    ifra
-00089910: 6320 3d20 5b5d 0a20 2020 2073 6964 7820  c = [].    sidx 
-00089920: 3d20 5b5d 0a20 2020 2067 5f73 697a 6520  = [].    g_size 
-00089930: 3d20 5b5d 0a20 2020 206e 5f65 786f 6e73  = [].    n_exons
-00089940: 203d 205b 5d0a 2020 2020 675f 766f 6c20   = [].    g_vol 
-00089950: 3d20 5b5d 0a20 2020 2069 636e 7420 3d20  = [].    icnt = 
-00089960: 5b5d 0a20 2020 2074 5f6c 656e 203d 205b  [].    t_len = [
-00089970: 5d0a 2020 2020 7374 726e 6420 3d20 5b5d  ].    strnd = []
-00089980: 0a20 2020 2063 646e 6720 3d20 5b5d 0a20  .    cdng = []. 
-00089990: 2020 2066 6f72 206b 2c20 746e 2069 6e20     for k, tn in 
-000899a0: 656e 756d 6572 6174 6528 746e 7329 3a0a  enumerate(tns):.
-000899b0: 2020 2020 2020 2020 6864 7220 3d20 746e          hdr = tn
-000899c0: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
-000899d0: 2020 2020 6974 656d 7320 3d20 6864 725b      items = hdr[
-000899e0: 305d 2e73 706c 6974 2827 5f27 290a 2020  0].split('_').  
-000899f0: 2020 2020 2020 7374 726e 642e 6170 7065        strnd.appe
-00089a00: 6e64 2820 6974 656d 735b 325d 290a 2020  nd( items[2]).  
-00089a10: 2020 2020 2020 6364 6e67 2e61 7070 656e        cdng.appen
-00089a20: 6428 2069 7465 6d73 5b33 5d29 0a20 2020  d( items[3]).   
-00089a30: 2020 2020 2073 6964 782e 6170 7065 6e64       sidx.append
-00089a40: 2820 2869 7465 6d73 5b34 5d29 2029 0a20  ( (items[4]) ). 
-00089a50: 2020 2020 2020 2067 5f73 697a 652e 6170         g_size.ap
-00089a60: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
-00089a70: 355d 2920 290a 2020 2020 2020 2020 6963  5]) ).        ic
-00089a80: 6e74 2e61 7070 656e 6428 2069 6e74 2869  nt.append( int(i
-00089a90: 7465 6d73 5b36 5d29 2029 0a20 2020 2020  tems[6]) ).     
-00089aa0: 2020 2076 616c 203d 2069 7465 6d73 5b37     val = items[7
-00089ab0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-00089ac0: 2020 2020 2061 626e 5f65 2e61 7070 656e       abn_e.appen
-00089ad0: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
-00089ae0: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-00089af0: 2069 7465 6d73 5b38 5d2e 7370 6c69 7428   items[8].split(
-00089b00: 273a 2729 0a20 2020 2020 2020 2074 706d  ':').        tpm
-00089b10: 5f65 2e61 7070 656e 6428 2066 6c6f 6174  _e.append( float
-00089b20: 2876 616c 5b31 5d29 2029 0a20 2020 2020  (val[1]) ).     
-00089b30: 2020 2076 616c 203d 2069 7465 6d73 5b39     val = items[9
-00089b40: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-00089b50: 2020 2020 2069 6672 6163 2e61 7070 656e       ifrac.appen
-00089b60: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
-00089b70: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-00089b80: 2069 7465 6d73 5b31 315d 2e73 706c 6974   items[11].split
-00089b90: 2827 3a27 290a 2020 2020 2020 2020 6e5f  (':').        n_
-00089ba0: 6578 6f6e 732e 6170 7065 6e64 2820 696e  exons.append( in
-00089bb0: 7428 7661 6c5b 315d 2920 290a 2020 2020  t(val[1]) ).    
-00089bc0: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
-00089bd0: 3132 5d2e 7370 6c69 7428 273a 2729 0a20  12].split(':'). 
-00089be0: 2020 2020 2020 2067 5f76 6f6c 2e61 7070         g_vol.app
-00089bf0: 656e 6428 2069 6e74 2876 616c 5b31 5d29  end( int(val[1])
-00089c00: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-00089c10: 2069 7465 6d73 5b31 335d 2e73 706c 6974   items[13].split
-00089c20: 2827 3a27 290a 2020 2020 2020 2020 745f  (':').        t_
-00089c30: 6c65 6e2e 6170 7065 6e64 2820 696e 7428  len.append( int(
-00089c40: 7661 6c5b 315d 2920 290a 2020 2020 0a20  val[1]) ).    . 
-00089c50: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
-00089c60: 7261 6d65 2829 0a20 2020 200a 2020 2020  rame().    .    
-00089c70: 6466 5b27 7472 5f6e 616d 6527 5d20 3d20  df['tr_name'] = 
-00089c80: 746e 730a 2020 2020 6466 5b27 6162 6e5f  tns.    df['abn_
-00089c90: 6573 7427 5d20 3d20 6162 6e5f 650a 2020  est'] = abn_e.  
-00089ca0: 2020 6466 5b27 7470 6d5f 6573 7427 5d20    df['tpm_est'] 
-00089cb0: 3d20 7470 6d5f 650a 2020 2020 6466 5b27  = tpm_e.    df['
-00089cc0: 6769 6478 275d 203d 2073 6964 780a 2020  gidx'] = sidx.  
-00089cd0: 2020 6466 5b27 6969 6478 275d 203d 2069    df['iidx'] = i
-00089ce0: 636e 740a 2020 2020 6466 5b27 675f 7369  cnt.    df['g_si
-00089cf0: 7a65 275d 203d 2067 5f73 697a 650a 2020  ze'] = g_size.  
-00089d00: 2020 6466 5b27 6973 6f5f 6672 6163 275d    df['iso_frac']
-00089d10: 203d 2069 6672 6163 0a20 2020 2064 665b   = ifrac.    df[
-00089d20: 276e 5f65 786f 6e73 275d 203d 206e 5f65  'n_exons'] = n_e
-00089d30: 786f 6e73 0a20 2020 2064 665b 2767 5f76  xons.    df['g_v
-00089d40: 6f6c 275d 203d 2067 5f76 6f6c 0a20 2020  ol'] = g_vol.   
-00089d50: 2064 665b 276c 656e 6774 6827 5d20 3d20   df['length'] = 
-00089d60: 745f 6c65 6e0a 2020 2020 6466 5b27 7374  t_len.    df['st
-00089d70: 7261 6e64 275d 203d 2073 7472 6e64 0a20  rand'] = strnd. 
-00089d80: 2020 2064 665b 2743 5f6f 725f 4e27 5d20     df['C_or_N'] 
-00089d90: 3d20 6364 6e67 0a20 2020 200a 2020 2020  = cdng.    .    
-00089da0: 6466 203d 2064 662e 7365 745f 696e 6465  df = df.set_inde
-00089db0: 7828 2774 725f 6e61 6d65 2729 0a20 2020  x('tr_name').   
-00089dc0: 200a 2020 2020 7265 7475 726e 2064 660a   .    return df.
-00089dd0: 0a64 6566 2067 6574 5f70 6572 666f 726d  .def get_perform
-00089de0: 616e 6365 2874 7269 6e66 6f2c 2063 7667  ance(trinfo, cvg
-00089df0: 5f74 6820 3d20 5b38 302c 3930 2c39 355d  _th = [80,90,95]
-00089e00: 2c20 665f 746f 5f73 6176 6520 3d20 4e6f  , f_to_save = No
-00089e10: 6e65 2c20 7265 6620 3d20 302c 2076 6572  ne, ref = 0, ver
-00089e20: 626f 7365 203d 2046 616c 7365 293a 0a20  bose = False):. 
-00089e30: 2020 200a 2020 2020 2327 2727 0a20 2020     .    #'''.   
-00089e40: 2069 6620 7265 6620 3d3d 2030 3a0a 2020   if ref == 0:.  
-00089e50: 2020 2020 2020 715f 6376 6720 3d20 2771        q_cvg = 'q
-00089e60: 6376 6727 0a20 2020 2020 2020 2071 5f6c  cvg'.        q_l
-00089e70: 656e 203d 2027 716c 656e 270a 2020 2020  en = 'qlen'.    
-00089e80: 2020 2020 715f 6964 203d 2027 7169 6427      q_id = 'qid'
-00089e90: 0a20 2020 2020 2020 2073 5f73 7461 7274  .        s_start
-00089ea0: 203d 2027 7373 7461 7274 270a 2020 2020   = 'sstart'.    
-00089eb0: 2020 2020 735f 656e 6420 3d20 2773 656e      s_end = 'sen
-00089ec0: 6427 0a20 2020 2020 2020 2073 5f69 6420  d'.        s_id 
-00089ed0: 3d20 2773 6964 270a 2020 2020 656c 7365  = 'sid'.    else
-00089ee0: 3a0a 2020 2020 2020 2020 715f 6376 6720  :.        q_cvg 
-00089ef0: 3d20 2773 6376 6727 0a20 2020 2020 2020  = 'scvg'.       
-00089f00: 2071 5f6c 656e 203d 2027 736c 656e 270a   q_len = 'slen'.
-00089f10: 2020 2020 2020 2020 715f 6964 203d 2027          q_id = '
-00089f20: 7369 6427 0a20 2020 2020 2020 2073 5f73  sid'.        s_s
-00089f30: 7461 7274 203d 2027 7173 7461 7274 270a  tart = 'qstart'.
-00089f40: 2020 2020 2020 2020 735f 656e 6420 3d20          s_end = 
-00089f50: 2771 656e 6427 0a20 2020 2020 2020 2073  'qend'.        s
-00089f60: 5f69 6420 3d20 2771 6964 270a 2020 2020  _id = 'qid'.    
-00089f70: 2327 2727 0a20 2020 200a 2020 2020 7169  #'''.    .    qi
-00089f80: 6473 203d 2070 642e 756e 6971 7565 2874  ds = pd.unique(t
-00089f90: 7269 6e66 6f5b 715f 6964 5d29 0a20 2020  rinfo[q_id]).   
-00089fa0: 2073 6964 7320 3d20 7064 2e75 6e69 7175   sids = pd.uniqu
-00089fb0: 6528 7472 696e 666f 5b73 5f69 645d 290a  e(trinfo[s_id]).
-00089fc0: 2020 2020 7767 7420 3d20 6e70 2e7a 6572      wgt = np.zer
-00089fd0: 6f73 285b 6c65 6e28 7169 6473 292c 6c65  os([len(qids),le
-00089fe0: 6e28 7369 6473 295d 290a 2020 2020 6966  n(sids)]).    if
-00089ff0: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
-0008a000: 274d 6174 6368 696e 6720 2825 692c 2569  'Matching (%i,%i
-0008a010: 2920 2720 2520 2877 6774 2e73 6861 7065  ) ' % (wgt.shape
-0008a020: 292c 2065 6e64 3d27 2729 0a0a 2020 2020  ), end='')..    
-0008a030: 7169 6478 203d 206e 702e 6675 6c6c 2874  qidx = np.full(t
-0008a040: 7269 6e66 6f2e 7368 6170 655b 305d 2c2d  rinfo.shape[0],-
-0008a050: 312c 6474 7970 653d 696e 7429 0a20 2020  1,dtype=int).   
-0008a060: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
-0008a070: 6c65 6e28 7169 6473 2929 203a 0a20 2020  len(qids)) :.   
-0008a080: 2020 2020 2071 6964 203d 2071 6964 735b       qid = qids[
-0008a090: 6b5d 0a20 2020 2020 2020 2077 6820 3d20  k].        wh = 
-0008a0a0: 7768 6963 6828 2074 7269 6e66 6f5b 715f  which( trinfo[q_
-0008a0b0: 6964 5d20 3d3d 2071 6964 2029 0a20 2020  id] == qid ).   
-0008a0c0: 2020 2020 2071 6964 785b 7768 5d20 3d20       qidx[wh] = 
-0008a0d0: 6b0a 2020 2020 2020 2020 0a20 2020 2069  k.        .    i
-0008a0e0: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
-0008a0f0: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
-0008a100: 2020 7369 6478 203d 206e 702e 6675 6c6c    sidx = np.full
-0008a110: 2874 7269 6e66 6f2e 7368 6170 655b 305d  (trinfo.shape[0]
-0008a120: 2c2d 312c 6474 7970 653d 696e 7429 0a20  ,-1,dtype=int). 
-0008a130: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-0008a140: 6528 6c65 6e28 7369 6473 2929 203a 0a20  e(len(sids)) :. 
-0008a150: 2020 2020 2020 2073 6964 203d 2073 6964         sid = sid
-0008a160: 735b 6b5d 0a20 2020 2020 2020 2077 6820  s[k].        wh 
-0008a170: 3d20 7768 6963 6828 2074 7269 6e66 6f5b  = which( trinfo[
-0008a180: 735f 6964 5d20 3d3d 2073 6964 2029 0a20  s_id] == sid ). 
-0008a190: 2020 2020 2020 2073 6964 785b 7768 5d20         sidx[wh] 
-0008a1a0: 3d20 6b0a 2020 2020 2020 2020 0a20 2020  = k.        .   
-0008a1b0: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
-0008a1c0: 6e74 2827 2e27 2c20 656e 643d 2727 290a  nt('.', end='').
-0008a1d0: 2020 2020 666f 7220 7720 696e 2072 616e      for w in ran
-0008a1e0: 6765 286c 656e 2871 6964 7829 293a 0a20  ge(len(qidx)):. 
-0008a1f0: 2020 2020 2020 2077 6774 5b69 6e74 2871         wgt[int(q
-0008a200: 6964 785b 775d 292c 2069 6e74 2873 6964  idx[w]), int(sid
-0008a210: 785b 775d 295d 203d 202d 7472 696e 666f  x[w])] = -trinfo
-0008a220: 5b71 5f63 7667 5d5b 775d 0a0a 2020 2020  [q_cvg][w]..    
-0008a230: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0008a240: 7428 275f 272c 2065 6e64 3d27 2729 0a20  t('_', end=''). 
-0008a250: 2020 2023 2070 7269 6e74 2877 6774 2e73     # print(wgt.s
-0008a260: 6861 7065 290a 2020 2020 726f 775f 6964  hape).    row_id
-0008a270: 782c 2063 6f6c 5f69 6478 203d 206f 7074  x, col_idx = opt
-0008a280: 696d 697a 652e 6c69 6e65 6172 5f73 756d  imize.linear_sum
-0008a290: 5f61 7373 6967 6e6d 656e 7428 7767 7429  _assignment(wgt)
-0008a2a0: 0a20 2020 200a 2020 2020 6966 2076 6572  .    .    if ver
-0008a2b0: 626f 7365 3a20 7072 696e 7428 272e 272c  bose: print('.',
-0008a2c0: 2065 6e64 3d27 2729 0a20 2020 2064 665f   end='').    df_
-0008a2d0: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
-0008a2e0: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
-0008a2f0: 636f 6c5f 6964 7829 2920 3a0a 2020 2020  col_idx)) :.    
-0008a300: 2020 2020 7369 203d 2063 6f6c 5f69 6478      si = col_idx
-0008a310: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
-0008a320: 2077 6869 6368 2873 6964 7820 3d3d 2073   which(sidx == s
-0008a330: 6929 0a20 2020 2020 2020 2077 203d 2077  i).        w = w
-0008a340: 6869 6368 2820 7169 6478 5b77 685d 203d  hich( qidx[wh] =
-0008a350: 3d20 726f 775f 6964 785b 6b5d 2029 0a20  = row_idx[k] ). 
-0008a360: 2020 2020 2020 2069 6620 6c65 6e28 7729         if len(w)
-0008a370: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0008a380: 2020 6966 206c 656e 2877 2920 3e20 313a    if len(w) > 1:
-0008a390: 2070 7269 6e74 2827 4552 524f 5220 696e   print('ERROR in
-0008a3a0: 2067 6574 5f70 6572 666f 726d 616e 6365   get_performance
-0008a3b0: 2829 3a20 4c65 6e28 7729 203d 2025 6927  (): Len(w) = %i'
-0008a3c0: 2025 206c 656e 2877 2920 290a 2020 2020   % len(w) ).    
-0008a3d0: 2020 2020 2020 2020 6964 7820 3d20 7768          idx = wh
-0008a3e0: 5b77 5b30 5d5d 0a20 2020 2020 2020 2020  [w[0]].         
-0008a3f0: 2020 2064 665f 6c73 742e 6170 7065 6e64     df_lst.append
-0008a400: 2874 7269 6e66 6f2e 696c 6f63 5b69 6478  (trinfo.iloc[idx
-0008a410: 5d29 0a20 2020 2020 2020 200a 2020 2020  ]).        .    
-0008a420: 6466 5f73 656c 203d 2070 642e 4461 7461  df_sel = pd.Data
-0008a430: 4672 616d 6528 6466 5f6c 7374 290a 2020  Frame(df_lst).  
-0008a440: 2020 6966 2066 5f74 6f5f 7361 7665 2069    if f_to_save i
-0008a450: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0008a460: 2020 2020 666e 616d 6520 3d20 2725 735f      fname = '%s_
-0008a470: 626c 6173 745f 7265 7375 6c74 2e74 7376  blast_result.tsv
-0008a480: 2720 2520 665f 746f 5f73 6176 650a 2020  ' % f_to_save.  
-0008a490: 2020 2020 2020 6466 5f73 656c 2e74 6f5f        df_sel.to_
-0008a4a0: 6373 7628 666e 616d 652c 2068 6561 6465  csv(fname, heade
-0008a4b0: 723d 5472 7565 2c20 696e 6465 783d 4661  r=True, index=Fa
-0008a4c0: 6c73 652c 2073 6570 3d27 5c74 2729 0a20  lse, sep='\t'). 
-0008a4d0: 2020 2020 2020 2023 2069 6620 7665 7262         # if verb
-0008a4e0: 6f73 653a 2070 7269 6e74 2827 2025 732e  ose: print(' %s.
-0008a4f0: 2720 2520 666e 616d 652c 2065 6e64 3d27  ' % fname, end='
-0008a500: 2720 290a 2020 2020 0a20 2020 2069 6620  ' ).    .    if 
-0008a510: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-0008a520: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
-0008a530: 636e 7420 3d20 6e70 2e7a 6572 6f73 286c  cnt = np.zeros(l
-0008a540: 656e 2863 7667 5f74 6829 290a 2020 2020  en(cvg_th)).    
-0008a550: 666f 7220 6b20 696e 2072 616e 6765 286c  for k in range(l
-0008a560: 656e 2863 7667 5f74 6829 293a 0a20 2020  en(cvg_th)):.   
-0008a570: 2020 2020 2074 6820 3d20 6376 675f 7468       th = cvg_th
-0008a580: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
-0008a590: 2077 6869 6368 2820 6466 5f73 656c 5b71   which( df_sel[q
-0008a5a0: 5f63 7667 5d2a 3130 3020 3e3d 2074 6820  _cvg]*100 >= th 
-0008a5b0: 290a 2020 2020 2020 2020 636e 745b 6b5d  ).        cnt[k]
-0008a5c0: 203d 206e 702e 696e 7428 6c65 6e28 7768   = np.int(len(wh
-0008a5d0: 2929 0a20 2020 2020 2020 200a 2020 2020  )).        .    
-0008a5e0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0008a5f0: 7428 2720 646f 6e65 2e27 290a 0a20 2020  t(' done.')..   
-0008a600: 2064 203d 207b 2763 7667 5f74 6827 3a20   d = {'cvg_th': 
-0008a610: 6376 675f 7468 2c20 274e 5f72 6563 6f76  cvg_th, 'N_recov
-0008a620: 6572 6564 273a 2063 6e74 2e61 7374 7970  ered': cnt.astyp
-0008a630: 6528 696e 7429 2c20 2770 7265 6369 7369  e(int), 'precisi
-0008a640: 6f6e 273a 206e 702e 726f 756e 6428 3130  on': np.round(10
-0008a650: 302a 636e 742f 6c65 6e28 7369 6473 292c  0*cnt/len(sids),
-0008a660: 3129 7d0a 2020 2020 6466 5f70 6572 6620  1)}.    df_perf 
-0008a670: 3d20 7064 2e44 6174 6146 7261 6d65 2864  = pd.DataFrame(d
-0008a680: 6174 6120 3d20 6429 2023 2c20 636f 6c75  ata = d) #, colu
-0008a690: 6d6e 7320 3d20 5b27 6376 675f 7468 272c  mns = ['cvg_th',
-0008a6a0: 276e 5f72 6563 6f76 6572 6564 272c 2770  'n_recovered','p
-0008a6b0: 7265 6369 7369 6f6e 275d 290a 2020 2020  recision']).    
-0008a6c0: 0a20 2020 2072 6574 7572 6e28 6466 5f70  .    return(df_p
-0008a6d0: 6572 662c 2064 665f 7365 6c29 0a0a 2020  erf, df_sel)..  
-0008a6e0: 2020 0a64 6566 2072 756e 5f62 6c61 7374    .def run_blast
-0008a6f0: 2820 696e 7074 5f66 612c 2072 6566 5f66  ( inpt_fa, ref_f
-0008a700: 612c 2070 6174 685f 746f 5f62 6c61 7374  a, path_to_blast
-0008a710: 203d 204e 6f6e 652c 2074 7261 7265 636f   = None, trareco
-0008a720: 203d 2046 616c 7365 2c20 7265 665f 696e   = False, ref_in
-0008a730: 666f 203d 2046 616c 7365 2c20 5c0a 2020  fo = False, \.  
-0008a740: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0008a750: 6274 7970 6520 3d20 276e 7563 6c27 2c20  btype = 'nucl', 
-0008a760: 7265 6620 3d20 302c 2073 6469 7620 3d20  ref = 0, sdiv = 
-0008a770: 3130 2c20 6d78 5f6e 6361 6e64 203d 2036  10, mx_ncand = 6
-0008a780: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
-0008a790: 6529 3a0a 0a20 2020 2023 2727 270a 2020  e):..    #'''.  
-0008a7a0: 2020 6966 2072 6566 203d 3d20 303a 0a20    if ref == 0:. 
-0008a7b0: 2020 2020 2020 2072 6566 5f74 7220 3d20         ref_tr = 
-0008a7c0: 7265 665f 6661 0a20 2020 2020 2020 2069  ref_fa.        i
-0008a7d0: 6e70 745f 7472 203d 2069 6e70 745f 6661  npt_tr = inpt_fa
-0008a7e0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0008a7f0: 2020 715f 6376 6720 3d20 2771 6376 6727    q_cvg = 'qcvg'
-0008a800: 0a20 2020 2020 2020 2071 5f6c 656e 203d  .        q_len =
-0008a810: 2027 716c 656e 270a 2020 2020 2020 2020   'qlen'.        
-0008a820: 715f 6964 203d 2027 7169 6427 0a20 2020  q_id = 'qid'.   
-0008a830: 2020 2020 2073 5f73 7461 7274 203d 2027       s_start = '
-0008a840: 7373 7461 7274 270a 2020 2020 2020 2020  sstart'.        
-0008a850: 735f 656e 6420 3d20 2773 656e 6427 0a20  s_end = 'send'. 
-0008a860: 2020 2020 2020 2073 5f69 6420 3d20 2773         s_id = 's
-0008a870: 6964 270a 2020 2020 656c 7365 3a0a 2020  id'.    else:.  
-0008a880: 2020 2020 2020 7265 665f 7472 203d 2069        ref_tr = i
-0008a890: 6e70 745f 6661 0a20 2020 2020 2020 2069  npt_fa.        i
-0008a8a0: 6e70 745f 7472 203d 2072 6566 5f66 610a  npt_tr = ref_fa.
-0008a8b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0008a8c0: 2071 5f63 7667 203d 2027 7363 7667 270a   q_cvg = 'scvg'.
-0008a8d0: 2020 2020 2020 2020 715f 6c65 6e20 3d20          q_len = 
-0008a8e0: 2773 6c65 6e27 0a20 2020 2020 2020 2071  'slen'.        q
-0008a8f0: 5f69 6420 3d20 2773 6964 270a 2020 2020  _id = 'sid'.    
-0008a900: 2020 2020 735f 7374 6172 7420 3d20 2771      s_start = 'q
-0008a910: 7374 6172 7427 0a20 2020 2020 2020 2073  start'.        s
-0008a920: 5f65 6e64 203d 2027 7165 6e64 270a 2020  _end = 'qend'.  
-0008a930: 2020 2020 2020 735f 6964 203d 2027 7169        s_id = 'qi
-0008a940: 6427 0a20 2020 2023 2727 270a 2020 2020  d'.    #'''.    
-0008a950: 0a20 2020 2066 696c 655f 6e61 6d65 7320  .    file_names 
-0008a960: 3d20 696e 7074 5f74 722e 7370 6c69 7428  = inpt_tr.split(
-0008a970: 272e 2729 0a20 2020 2066 6e61 6d65 203d  '.').    fname =
-0008a980: 2027 272e 6a6f 696e 2873 7420 666f 7220   ''.join(st for 
-0008a990: 7374 2069 6e20 6669 6c65 5f6e 616d 6573  st in file_names
-0008a9a0: 5b3a 2d31 5d20 290a 0a20 2020 2074 6e5f  [:-1] )..    tn_
-0008a9b0: 696e 203d 205b 5d0a 2020 2020 6620 3d20  in = [].    f = 
-0008a9c0: 6f70 656e 2869 6e70 745f 7472 2c27 7227  open(inpt_tr,'r'
-0008a9d0: 290a 2020 2020 6361 6e64 5f63 6e74 203d  ).    cand_cnt =
-0008a9e0: 2030 0a20 2020 2066 6f72 206c 696e 6520   0.    for line 
-0008a9f0: 696e 2066 3a0a 2020 2020 2020 2020 6966  in f:.        if
-0008aa00: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
-0008aa10: 0a20 2020 2020 2020 2020 2020 2074 6e5f  .            tn_
-0008aa20: 696e 2e61 7070 656e 6428 6c69 6e65 5b31  in.append(line[1
-0008aa30: 3a2d 315d 290a 2020 2020 2020 2020 2020  :-1]).          
-0008aa40: 2020 6361 6e64 5f63 6e74 202b 3d20 310a    cand_cnt += 1.
-0008aa50: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
-0008aa60: 2020 0a20 2020 2074 6e5f 7265 6620 3d20    .    tn_ref = 
-0008aa70: 5b5d 0a20 2020 2066 203d 206f 7065 6e28  [].    f = open(
-0008aa80: 7265 665f 7472 2c27 7227 290a 2020 2020  ref_tr,'r').    
-0008aa90: 7265 665f 636e 7420 3d20 300a 2020 2020  ref_cnt = 0.    
-0008aaa0: 666f 7220 6c69 6e65 2069 6e20 663a 0a20  for line in f:. 
-0008aab0: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
-0008aac0: 5d20 3d3d 2027 3e27 3a0a 2020 2020 2020  ] == '>':.      
-0008aad0: 2020 2020 2020 746e 5f72 6566 2e61 7070        tn_ref.app
-0008aae0: 656e 6428 6c69 6e65 5b31 3a2d 315d 290a  end(line[1:-1]).
-0008aaf0: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
-0008ab00: 636e 7420 2b3d 2031 0a20 2020 2066 2e63  cnt += 1.    f.c
-0008ab10: 6c6f 7365 2829 0a20 2020 2023 2070 7269  lose().    # pri
-0008ab20: 6e74 2827 4c65 6e3a 2025 692c 204e 753d  nt('Len: %i, Nu=
-0008ab30: 2025 6927 2025 2028 6c65 6e28 746e 292c   %i' % (len(tn),
-0008ab40: 206c 656e 2870 642e 756e 6971 7565 2874   len(pd.unique(t
-0008ab50: 6e29 2929 2c20 656e 643d 2727 2029 0a20  n))), end='' ). 
-0008ab60: 2020 200a 2020 2020 6966 2072 6566 203d     .    if ref =
-0008ab70: 3d20 303a 0a20 2020 2020 2020 2074 6e20  = 0:.        tn 
-0008ab80: 3d20 746e 5f69 6e0a 2020 2020 2020 2020  = tn_in.        
-0008ab90: 6e5f 6d61 785f 6361 6e64 7320 3d20 310a  n_max_cands = 1.
-0008aba0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0008abb0: 2020 746e 203d 2074 6e5f 7265 660a 2020    tn = tn_ref.  
-0008abc0: 2020 2020 2020 6e5f 6d61 785f 6361 6e64        n_max_cand
-0008abd0: 7320 3d20 206d 785f 6e63 616e 640a 2020  s =  mx_ncand.  
-0008abe0: 2020 2020 2020 746d 7020 3d20 6361 6e64        tmp = cand
-0008abf0: 5f63 6e74 0a20 2020 2020 2020 2063 616e  _cnt.        can
-0008ac00: 645f 636e 7420 3d20 7265 665f 636e 740a  d_cnt = ref_cnt.
-0008ac10: 2020 2020 2020 2020 7265 665f 636e 7420          ref_cnt 
-0008ac20: 3d20 746d 700a 2020 2020 0a20 2020 2023  = tmp.    .    #
-0008ac30: 2320 6d61 6b65 2062 6c61 7374 2064 6220  # make blast db 
-0008ac40: 7769 7468 2069 6e70 7574 5f74 720a 2020  with input_tr.  
-0008ac50: 2020 6966 2070 6174 685f 746f 5f62 6c61    if path_to_bla
-0008ac60: 7374 2069 7320 4e6f 6e65 3a0a 2020 2020  st is None:.    
-0008ac70: 2020 2020 636d 6420 3d20 276d 616b 6562      cmd = 'makeb
-0008ac80: 6c61 7374 6462 202d 696e 2025 7320 2d64  lastdb -in %s -d
-0008ac90: 6274 7970 6520 2573 2720 2520 2869 6e70  btype %s' % (inp
-0008aca0: 745f 7472 2c20 6462 7479 7065 290a 2020  t_tr, dbtype).  
-0008acb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008acc0: 636d 6420 3d20 2725 732f 6d61 6b65 626c  cmd = '%s/makebl
-0008acd0: 6173 7464 6220 2d69 6e20 2573 202d 6462  astdb -in %s -db
-0008ace0: 7479 7065 2025 7327 2025 2028 7061 7468  type %s' % (path
-0008acf0: 5f74 6f5f 626c 6173 742c 2069 6e70 745f  _to_blast, inpt_
-0008ad00: 7472 2c20 6462 7479 7065 290a 2020 2020  tr, dbtype).    
-0008ad10: 7265 7320 3d20 7375 6270 726f 6365 7373  res = subprocess
-0008ad20: 2e63 6865 636b 5f6f 7574 7075 7428 636d  .check_output(cm
-0008ad30: 642c 2073 6865 6c6c 3d54 7275 6529 0a20  d, shell=True). 
-0008ad40: 2020 2023 2070 7269 6e74 2872 6573 2e64     # print(res.d
-0008ad50: 6563 6f64 6528 2777 696e 646f 7773 2d31  ecode('windows-1
-0008ad60: 3235 3227 2929 0a20 0a20 2020 2073 7472  252')). .    str
-0008ad70: 5f6f 7074 696f 6e20 3d20 272d 6f75 7466  _option = '-outf
-0008ad80: 6d74 2022 3620 7173 6571 6964 2073 7365  mt "6 qseqid sse
-0008ad90: 7169 6420 716c 656e 206c 656e 6774 6820  qid qlen length 
-0008ada0: 736c 656e 2071 7374 6172 7420 7165 6e64  slen qstart qend
-0008adb0: 2073 7374 6172 7420 7365 6e64 206e 6964   sstart send nid
-0008adc0: 656e 7420 6d69 736d 6174 6368 2067 6170  ent mismatch gap
-0008add0: 6f70 656e 2071 636f 7673 2071 636f 7668  open qcovs qcovh
-0008ade0: 7370 2062 6974 7363 6f72 6522 202d 6e75  sp bitscore" -nu
-0008adf0: 6d5f 7468 7265 6164 7320 3420 2d6d 6178  m_threads 4 -max
-0008ae00: 5f74 6172 6765 745f 7365 7173 2025 6927  _target_seqs %i'
-0008ae10: 2025 206e 5f6d 6178 5f63 616e 6473 0a0a   % n_max_cands..
-0008ae20: 2020 2020 6966 2064 6274 7970 6520 3d3d      if dbtype ==
-0008ae30: 2027 6e75 636c 273a 2070 7266 7820 3d20   'nucl': prfx = 
-0008ae40: 276e 270a 2020 2020 656c 7365 3a20 7072  'n'.    else: pr
-0008ae50: 6678 203d 2027 7027 0a20 2020 2020 2020  fx = 'p'.       
-0008ae60: 200a 2020 2020 6966 2070 6174 685f 746f   .    if path_to
-0008ae70: 5f62 6c61 7374 2069 7320 4e6f 6e65 3a0a  _blast is None:.
-0008ae80: 2020 2020 2020 2020 636d 6420 3d20 2762          cmd = 'b
-0008ae90: 6c61 7374 2573 2025 7320 2d64 6220 2573  last%s %s -db %s
-0008aea0: 202d 7175 6572 7920 2573 202d 6f75 7420   -query %s -out 
-0008aeb0: 2573 2e74 626c 7374 2720 2520 2870 7266  %s.tblst' % (prf
-0008aec0: 782c 2073 7472 5f6f 7074 696f 6e2c 2069  x, str_option, i
-0008aed0: 6e70 745f 7472 2c20 7265 665f 7472 2c20  npt_tr, ref_tr, 
-0008aee0: 666e 616d 6529 0a20 2020 2065 6c73 653a  fname).    else:
-0008aef0: 0a20 2020 2020 2020 2063 6d64 203d 2027  .        cmd = '
-0008af00: 2573 2f62 6c61 7374 2573 2025 7320 2d64  %s/blast%s %s -d
-0008af10: 6220 2573 202d 7175 6572 7920 2573 202d  b %s -query %s -
-0008af20: 6f75 7420 2573 2e74 626c 7374 2720 2520  out %s.tblst' % 
-0008af30: 2870 6174 685f 746f 5f62 6c61 7374 2c20  (path_to_blast, 
-0008af40: 7072 6678 2c20 7374 725f 6f70 7469 6f6e  prfx, str_option
-0008af50: 2c20 696e 7074 5f74 722c 2072 6566 5f74  , inpt_tr, ref_t
-0008af60: 722c 2066 6e61 6d65 290a 2020 2020 2020  r, fname).      
-0008af70: 2020 0a20 2020 2069 6620 7665 7262 6f73    .    if verbos
-0008af80: 653a 2070 7269 6e74 2822 5275 6e6e 696e  e: print("Runnin
-0008af90: 6720 426c 6173 742d 2573 2077 6974 6820  g Blast-%s with 
-0008afa0: 2569 2063 616e 642e 2025 6920 7265 662e  %i cand. %i ref.
-0008afb0: 202e 2e2e 2022 2025 2028 6462 7479 7065   ... " % (dbtype
-0008afc0: 5b30 5d2e 7570 7065 7228 292c 6361 6e64  [0].upper(),cand
-0008afd0: 5f63 6e74 2c20 7265 665f 636e 7429 2c20  _cnt, ref_cnt), 
-0008afe0: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
-0008aff0: 7565 293b 0a20 2020 2072 6573 203d 2073  ue);.    res = s
-0008b000: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
-0008b010: 6f75 7470 7574 2863 6d64 2c20 7368 656c  output(cmd, shel
-0008b020: 6c3d 5472 7565 290a 2020 2020 2320 7072  l=True).    # pr
-0008b030: 696e 7428 7265 732e 6465 636f 6465 2827  int(res.decode('
-0008b040: 7769 6e64 6f77 732d 3132 3532 2729 290a  windows-1252')).
-0008b050: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
-0008b060: 7072 696e 7428 2764 6f6e 652e 2729 0a20  print('done.'). 
-0008b070: 2020 200a 2020 2020 6f73 2e72 656d 6f76     .    os.remov
-0008b080: 6528 2027 2573 2e25 7368 7227 2025 2028  e( '%s.%shr' % (
-0008b090: 696e 7074 5f74 722c 2070 7266 7829 2029  inpt_tr, prfx) )
-0008b0a0: 0a20 2020 206f 732e 7265 6d6f 7665 2820  .    os.remove( 
-0008b0b0: 2725 732e 2573 696e 2720 2520 2869 6e70  '%s.%sin' % (inp
-0008b0c0: 745f 7472 2c20 7072 6678 2920 290a 2020  t_tr, prfx) ).  
-0008b0d0: 2020 6f73 2e72 656d 6f76 6528 2027 2573    os.remove( '%s
-0008b0e0: 2e25 7373 7127 2025 2028 696e 7074 5f74  .%ssq' % (inpt_t
-0008b0f0: 722c 2070 7266 7829 2029 0a20 2020 0a20  r, prfx) ).   . 
-0008b100: 2020 2063 6f6c 6e61 6d65 7320 3d20 5b27     colnames = ['
-0008b110: 7169 6427 2c20 2773 6964 272c 2027 716c  qid', 'sid', 'ql
-0008b120: 656e 272c 2027 616c 656e 272c 2027 736c  en', 'alen', 'sl
-0008b130: 656e 272c 2027 7173 7461 7274 272c 2027  en', 'qstart', '
-0008b140: 7165 6e64 272c 2027 7373 7461 7274 272c  qend', 'sstart',
-0008b150: 2027 7365 6e64 272c 205c 0a20 2020 2020   'send', \.     
-0008b160: 2020 2020 2020 2020 2020 2027 6e69 6465             'nide
-0008b170: 6e74 272c 2027 6d69 736d 6174 6368 272c  nt', 'mismatch',
-0008b180: 2027 6761 706f 7065 6e27 2c20 2771 636f   'gapopen', 'qco
-0008b190: 7673 272c 2027 7163 6f76 6873 7027 2c20  vs', 'qcovhsp', 
-0008b1a0: 2762 6974 7363 6f72 6527 5d0a 2020 2020  'bitscore'].    
-0008b1b0: 7462 6c73 7420 3d20 2725 732e 7462 6c73  tblst = '%s.tbls
-0008b1c0: 7427 2025 2066 6e61 6d65 0a20 2020 2064  t' % fname.    d
-0008b1d0: 6620 3d20 7064 2e72 6561 645f 6373 7628  f = pd.read_csv(
-0008b1e0: 7462 6c73 742c 2068 6561 6465 7220 3d20  tblst, header = 
-0008b1f0: 2769 6e66 6572 272c 206e 616d 6573 203d  'infer', names =
-0008b200: 2063 6f6c 6e61 6d65 732c 2073 6570 3d27   colnames, sep='
-0008b210: 5c74 2729 0a20 2020 200a 2020 2020 6f73  \t').    .    os
-0008b220: 2e72 656d 6f76 6528 2027 2573 2720 2520  .remove( '%s' % 
-0008b230: 2874 626c 7374 2920 290a 2020 2020 0a20  (tblst) ).    . 
-0008b240: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
-0008b250: 7269 6e74 2827 4e2e 6361 6e64 3a20 2569  rint('N.cand: %i
-0008b260: 2c20 4e2e 7375 626a 6563 742e 756e 6971  , N.subject.uniq
-0008b270: 7565 3a20 2569 2720 2520 286c 656e 2874  ue: %i' % (len(t
-0008b280: 6e29 2c20 6c65 6e28 7064 2e75 6e69 7175  n), len(pd.uniqu
-0008b290: 6528 6466 5b27 7369 6427 5d29 2929 2029  e(df['sid']))) )
-0008b2a0: 0a0a 2020 2020 6466 5b27 7363 7667 275d  ..    df['scvg']
-0008b2b0: 203d 2064 665b 2761 6c65 6e27 5d2f 6466   = df['alen']/df
-0008b2c0: 5b27 736c 656e 275d 0a20 2020 2064 665b  ['slen'].    df[
-0008b2d0: 2771 6376 6727 5d20 3d20 6466 5b27 616c  'qcvg'] = df['al
-0008b2e0: 656e 275d 2f64 665b 2771 6c65 6e27 5d0a  en']/df['qlen'].
-0008b2f0: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
-0008b300: 7472 6172 6563 6f20 3d3d 2054 7275 653a  trareco == True:
-0008b310: 0a20 2020 2020 2020 2061 626e 5f65 203d  .        abn_e =
-0008b320: 205b 5d0a 2020 2020 2020 2020 7470 6d5f   [].        tpm_
-0008b330: 6520 3d20 5b5d 0a20 2020 2020 2020 2069  e = [].        i
-0008b340: 6672 6163 203d 205b 5d0a 2020 2020 2020  frac = [].      
-0008b350: 2020 7369 6478 203d 205b 5d0a 2020 2020    sidx = [].    
-0008b360: 2020 2020 675f 7369 7a65 203d 205b 5d0a      g_size = [].
-0008b370: 2020 2020 2020 2020 6e5f 6578 6f6e 7320          n_exons 
-0008b380: 3d20 5b5d 0a20 2020 2020 2020 2067 5f76  = [].        g_v
-0008b390: 6f6c 203d 205b 5d0a 2020 2020 2020 2020  ol = [].        
-0008b3a0: 6963 6e74 203d 205b 5d0a 2020 2020 2020  icnt = [].      
-0008b3b0: 2020 7374 726e 6420 3d20 5b5d 0a20 2020    strnd = [].   
-0008b3c0: 2020 2020 2063 646e 6720 3d20 5b5d 0a20       cdng = []. 
-0008b3d0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-0008b3e0: 7261 6e67 6528 6466 2e73 6861 7065 5b30  range(df.shape[0
-0008b3f0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-0008b400: 2320 7320 3d20 273e 2573 5f43 6872 2573  # s = '>%s_Chr%s
-0008b410: 3a25 692d 2569 5f25 695f 2569 5f25 695f  :%i-%i_%i_%i_%i_
-0008b420: 4162 6e3a 2534 2e33 665f 5450 4d3a 2534  Abn:%4.3f_TPM:%4
-0008b430: 2e32 665f 4946 7261 633a 2533 2e32 665c  .2f_IFrac:%3.2f\
-0008b440: 6e27 200a 2020 2020 2020 2020 2020 2020  n' .            
-0008b450: 2320 2520 2874 722e 7072 6566 6978 2c20  # % (tr.prefix, 
-0008b460: 7472 2e63 6872 2c20 7472 2e73 7461 7274  tr.chr, tr.start
-0008b470: 2c20 7472 2e65 6e64 2c20 7472 2e67 6964  , tr.end, tr.gid
-0008b480: 782c 2074 722e 6772 705f 7369 7a65 2c20  x, tr.grp_size, 
-0008b490: 7472 2e69 636e 742c 2074 722e 6162 6e2c  tr.icnt, tr.abn,
-0008b4a0: 2074 722e 7470 6d2c 2074 722e 6973 6f5f   tr.tpm, tr.iso_
-0008b4b0: 6672 6163 290a 2020 2020 2020 2020 2020  frac).          
-0008b4c0: 2020 6864 7220 3d20 6466 5b73 5f69 645d    hdr = df[s_id]
-0008b4d0: 5b6b 5d2e 7370 6c69 7428 2720 2729 0a20  [k].split(' '). 
-0008b4e0: 2020 2020 2020 2020 2020 2069 7465 6d73             items
-0008b4f0: 203d 2068 6472 5b30 5d2e 7370 6c69 7428   = hdr[0].split(
-0008b500: 275f 2729 0a20 2020 2020 2020 2020 2020  '_').           
-0008b510: 2073 7472 6e64 2e61 7070 656e 6428 2069   strnd.append( i
-0008b520: 7465 6d73 5b32 5d29 0a20 2020 2020 2020  tems[2]).       
-0008b530: 2020 2020 2063 646e 672e 6170 7065 6e64       cdng.append
-0008b540: 2820 6974 656d 735b 335d 290a 2020 2020  ( items[3]).    
-0008b550: 2020 2020 2020 2020 7369 6478 2e61 7070          sidx.app
-0008b560: 656e 6428 2028 6974 656d 735b 345d 2920  end( (items[4]) 
-0008b570: 290a 2020 2020 2020 2020 2020 2020 675f  ).            g_
-0008b580: 7369 7a65 2e61 7070 656e 6428 2069 6e74  size.append( int
-0008b590: 2869 7465 6d73 5b35 5d29 2029 0a20 2020  (items[5]) ).   
-0008b5a0: 2020 2020 2020 2020 2069 636e 742e 6170           icnt.ap
-0008b5b0: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
-0008b5c0: 365d 2920 290a 2020 2020 2020 2020 2020  6]) ).          
-0008b5d0: 2020 7661 6c20 3d20 6974 656d 735b 375d    val = items[7]
-0008b5e0: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0008b5f0: 2020 2020 2020 2020 6162 6e5f 652e 6170          abn_e.ap
-0008b600: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
-0008b610: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
-0008b620: 2020 7661 6c20 3d20 6974 656d 735b 385d    val = items[8]
-0008b630: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0008b640: 2020 2020 2020 2020 7470 6d5f 652e 6170          tpm_e.ap
-0008b650: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
-0008b660: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
-0008b670: 2020 7661 6c20 3d20 6974 656d 735b 395d    val = items[9]
-0008b680: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0008b690: 2020 2020 2020 2020 6966 7261 632e 6170          ifrac.ap
-0008b6a0: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
-0008b6b0: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
-0008b6c0: 2020 7661 6c20 3d20 6974 656d 735b 3131    val = items[11
-0008b6d0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-0008b6e0: 2020 2020 2020 2020 206e 5f65 786f 6e73           n_exons
-0008b6f0: 2e61 7070 656e 6428 2069 6e74 2876 616c  .append( int(val
-0008b700: 5b31 5d29 2029 0a20 2020 2020 2020 2020  [1]) ).         
-0008b710: 2020 2076 616c 203d 2069 7465 6d73 5b31     val = items[1
-0008b720: 325d 2e73 706c 6974 2827 3a27 290a 2020  2].split(':').  
-0008b730: 2020 2020 2020 2020 2020 675f 766f 6c2e            g_vol.
-0008b740: 6170 7065 6e64 2820 696e 7428 7661 6c5b  append( int(val[
-0008b750: 315d 2920 290a 2020 2020 656c 7365 3a0a  1]) ).    else:.
-0008b760: 2020 2020 2020 2020 6162 6e5f 6520 3d20          abn_e = 
-0008b770: 6e70 2e7a 6572 6f73 2864 662e 7368 6170  np.zeros(df.shap
-0008b780: 655b 305d 290a 2020 2020 2020 2020 7470  e[0]).        tp
-0008b790: 6d5f 6520 3d20 6e70 2e7a 6572 6f73 2864  m_e = np.zeros(d
-0008b7a0: 662e 7368 6170 655b 305d 290a 2020 2020  f.shape[0]).    
-0008b7b0: 2020 2020 6966 7261 6320 3d20 6e70 2e7a      ifrac = np.z
-0008b7c0: 6572 6f73 2864 662e 7368 6170 655b 305d  eros(df.shape[0]
-0008b7d0: 290a 2020 2020 2020 2020 7369 6478 203d  ).        sidx =
-0008b7e0: 206e 702e 6675 6c6c 2864 662e 7368 6170   np.full(df.shap
-0008b7f0: 655b 305d 2c20 2727 290a 2020 2020 2020  e[0], '').      
-0008b800: 2020 675f 7369 7a65 203d 206e 702e 7a65    g_size = np.ze
-0008b810: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
-0008b820: 0a20 2020 2020 2020 206e 5f65 786f 6e73  .        n_exons
-0008b830: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
-0008b840: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
-0008b850: 2067 5f76 6f6c 203d 206e 702e 7a65 726f   g_vol = np.zero
-0008b860: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
-0008b870: 2020 2020 2020 2069 636e 7420 3d20 6e70         icnt = np
-0008b880: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
-0008b890: 305d 290a 2020 2020 2020 2020 7374 726e  0]).        strn
-0008b8a0: 6420 3d20 6e70 2e7a 6572 6f73 2864 662e  d = np.zeros(df.
-0008b8b0: 7368 6170 655b 305d 290a 2020 2020 2020  shape[0]).      
-0008b8c0: 2020 6364 6e67 203d 206e 702e 7a65 726f    cdng = np.zero
-0008b8d0: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
-0008b8e0: 2020 2020 2020 200a 2020 2020 2327 2727         .    #'''
-0008b8f0: 0a20 2020 2072 6566 5f69 6e66 6f20 3d20  .    ref_info = 
-0008b900: 4661 6c73 650a 2020 2020 6966 206c 656e  False.    if len
-0008b910: 2864 665b 715f 6964 5d5b 305d 2e73 706c  (df[q_id][0].spl
-0008b920: 6974 2827 3a27 2929 203d 3d20 343a 200a  it(':')) == 4: .
-0008b930: 2020 2020 2020 2020 7265 665f 696e 666f          ref_info
-0008b940: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0008b950: 2320 7072 696e 7428 2752 6566 5f69 6e66  # print('Ref_inf
-0008b960: 6f20 6973 2074 7275 6527 290a 2020 2020  o is true').    
-0008b970: 2020 2020 0a20 2020 2069 6620 7265 665f      .    if ref_
-0008b980: 696e 666f 203d 3d20 5472 7565 3a0a 2020  info == True:.  
-0008b990: 2020 2020 2020 6769 6420 3d20 5b5d 0a20        gid = []. 
-0008b9a0: 2020 2020 2020 2063 7667 203d 205b 5d0a         cvg = [].
-0008b9b0: 2020 2020 2020 2020 6162 6e5f 7420 3d20          abn_t = 
-0008b9c0: 5b5d 0a20 2020 2020 2020 2074 706d 5f74  [].        tpm_t
-0008b9d0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-0008b9e0: 7220 6b20 696e 2072 616e 6765 2864 662e  r k in range(df.
-0008b9f0: 7368 6170 655b 305d 293a 0a20 2020 2020  shape[0]):.     
-0008ba00: 2020 2020 2020 2069 7465 6d73 203d 2064         items = d
-0008ba10: 665b 715f 6964 5d5b 6b5d 2e73 706c 6974  f[q_id][k].split
-0008ba20: 2827 3a27 290a 2020 2020 2020 2020 2020  (':').          
-0008ba30: 2020 6769 642e 6170 7065 6e64 2820 6974    gid.append( it
-0008ba40: 656d 735b 305d 2029 0a20 2020 2020 2020  ems[0] ).       
-0008ba50: 2020 2020 2063 7667 2e61 7070 656e 6428       cvg.append(
-0008ba60: 2066 6c6f 6174 2869 7465 6d73 5b31 5d29   float(items[1])
-0008ba70: 2029 0a20 2020 2020 2020 2020 2020 2061   ).            a
-0008ba80: 626e 5f74 2e61 7070 656e 6428 2066 6c6f  bn_t.append( flo
-0008ba90: 6174 2869 7465 6d73 5b32 5d29 2029 0a20  at(items[2]) ). 
-0008baa0: 2020 2020 2020 2020 2020 2074 706d 5f74             tpm_t
-0008bab0: 2e61 7070 656e 6428 2066 6c6f 6174 2869  .append( float(i
-0008bac0: 7465 6d73 5b33 5d29 2029 0a20 2020 2065  tems[3]) ).    e
-0008bad0: 6c73 653a 0a20 2020 2020 2020 2067 6964  lse:.        gid
-0008bae0: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
-0008baf0: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
-0008bb00: 2063 7667 203d 206e 702e 7a65 726f 7328   cvg = np.zeros(
-0008bb10: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
-0008bb20: 2020 2020 2061 626e 5f74 203d 206e 702e       abn_t = np.
-0008bb30: 7a65 726f 7328 6466 2e73 6861 7065 5b30  zeros(df.shape[0
-0008bb40: 5d29 0a20 2020 2020 2020 2074 706d 5f74  ]).        tpm_t
-0008bb50: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
-0008bb60: 6861 7065 5b30 5d29 0a0a 2020 2020 2327  hape[0])..    #'
-0008bb70: 2727 0a20 2020 2064 665b 2765 7870 5f63  ''.    df['exp_c
-0008bb80: 7667 275d 203d 2063 7667 0a20 2020 2064  vg'] = cvg.    d
-0008bb90: 665b 2761 626e 5f74 7275 6527 5d20 3d20  f['abn_true'] = 
-0008bba0: 6162 6e5f 740a 2020 2020 6466 5b27 6162  abn_t.    df['ab
-0008bbb0: 6e5f 6573 7427 5d20 3d20 6162 6e5f 650a  n_est'] = abn_e.
-0008bbc0: 2020 2020 6466 5b27 7470 6d5f 7472 7565      df['tpm_true
-0008bbd0: 275d 203d 2074 706d 5f74 0a20 2020 2064  '] = tpm_t.    d
-0008bbe0: 665b 2774 706d 5f65 7374 275d 203d 2074  f['tpm_est'] = t
-0008bbf0: 706d 5f65 0a20 2020 2064 665b 2767 6964  pm_e.    df['gid
-0008bc00: 7827 5d20 3d20 7369 6478 0a20 2020 2064  x'] = sidx.    d
-0008bc10: 665b 2769 6964 7827 5d20 3d20 6963 6e74  f['iidx'] = icnt
-0008bc20: 0a20 2020 2064 665b 2767 5f73 697a 6527  .    df['g_size'
-0008bc30: 5d20 3d20 675f 7369 7a65 0a20 2020 2064  ] = g_size.    d
-0008bc40: 665b 2769 736f 5f66 7261 6327 5d20 3d20  f['iso_frac'] = 
-0008bc50: 6966 7261 630a 2020 2020 6466 5b27 6e5f  ifrac.    df['n_
-0008bc60: 6578 6f6e 7327 5d20 3d20 6e5f 6578 6f6e  exons'] = n_exon
-0008bc70: 730a 2020 2020 6466 5b27 675f 766f 6c27  s.    df['g_vol'
-0008bc80: 5d20 3d20 675f 766f 6c0a 2020 2020 6466  ] = g_vol.    df
-0008bc90: 5b27 7374 7261 6e64 275d 203d 2073 7472  ['strand'] = str
-0008bca0: 6e64 0a20 2020 2064 665b 2743 5f6f 725f  nd.    df['C_or_
-0008bcb0: 4e27 5d20 3d20 6364 6e67 0a20 2020 2020  N'] = cdng.     
-0008bcc0: 2020 200a 2020 2020 6220 3d20 6466 5b71     .    b = df[q
-0008bcd0: 5f63 7667 5d20 3e3d 2030 2e38 0a20 2020  _cvg] >= 0.8.   
-0008bce0: 2064 665f 6e65 7720 3d20 6466 2e6c 6f63   df_new = df.loc
-0008bcf0: 5b62 2c3a 5d0a 2020 2020 6466 203d 2064  [b,:].    df = d
-0008bd00: 665f 6e65 770a 2020 2020 0a20 2020 2066  f_new.    .    f
-0008bd10: 756c 6c5f 6e61 6d65 7320 3d20 6466 5b71  ull_names = df[q
-0008bd20: 5f69 645d 202b 2064 665b 735f 6964 5d0a  _id] + df[s_id].
-0008bd30: 2020 2020 666e 7320 3d20 7064 2e75 6e69      fns = pd.uni
-0008bd40: 7175 6528 6675 6c6c 5f6e 616d 6573 290a  que(full_names).
-0008bd50: 2020 2020 6b20 3d20 300a 2020 2020 6466      k = 0.    df
-0008bd60: 5f6c 7374 203d 205b 5d0a 2020 2020 666f  _lst = [].    fo
-0008bd70: 7220 666e 2069 6e20 666e 733a 0a20 2020  r fn in fns:.   
-0008bd80: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
-0008bd90: 6675 6c6c 5f6e 616d 6573 203d 3d20 666e  full_names == fn
-0008bda0: 290a 2020 2020 2020 2020 6466 5f74 6d70  ).        df_tmp
-0008bdb0: 203d 2064 662e 696c 6f63 5b77 685d 0a20   = df.iloc[wh]. 
-0008bdc0: 2020 2020 2020 2071 6376 6720 3d20 6e70         qcvg = np
-0008bdd0: 2e61 7272 6179 2820 6466 5f74 6d70 5b71  .array( df_tmp[q
-0008bde0: 5f63 7667 5d20 290a 2020 2020 2020 2020  _cvg] ).        
-0008bdf0: 6f64 7220 3d20 7163 7667 2e61 7267 736f  odr = qcvg.argso
-0008be00: 7274 2829 0a20 2020 2020 2020 2064 665f  rt().        df_
-0008be10: 6c73 742e 6170 7065 6e64 2864 665f 746d  lst.append(df_tm
-0008be20: 702e 696c 6f63 5b6f 6472 5b2d 315d 5d29  p.iloc[odr[-1]])
-0008be30: 200a 2020 2020 2020 2020 6b20 2b3d 2031   .        k += 1
-0008be40: 0a0a 2020 2020 6966 206c 656e 2864 665f  ..    if len(df_
-0008be50: 6c73 7429 203e 2030 3a0a 2020 2020 2020  lst) > 0:.      
-0008be60: 2020 6466 5f73 656c 203d 2070 642e 4461    df_sel = pd.Da
-0008be70: 7461 4672 616d 6528 6466 5f6c 7374 290a  taFrame(df_lst).
-0008be80: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
-0008be90: 2020 2020 2074 7269 6e66 6f20 3d20 2725       trinfo = '%
-0008bea0: 735f 626c 6173 745f 7265 7375 6c74 2e74  s_blast_result.t
-0008beb0: 7376 2720 2520 666e 616d 650a 2020 2020  sv' % fname.    
-0008bec0: 2020 2020 6466 5f73 656c 2e74 6f5f 6373      df_sel.to_cs
-0008bed0: 7628 7472 696e 666f 2c20 6865 6164 6572  v(trinfo, header
-0008bee0: 3d54 7275 652c 2069 6e64 6578 3d46 616c  =True, index=Fal
-0008bef0: 7365 2c20 7365 703d 275c 7427 290a 2020  se, sep='\t').  
-0008bf00: 2020 2020 2020 2320 6966 2076 6572 626f        # if verbo
-0008bf10: 7365 3a20 7072 696e 7428 2754 7261 6e73  se: print('Trans
-0008bf20: 6372 6970 746f 6d65 2049 6e66 6f2e 2077  criptome Info. w
-0008bf30: 7269 7474 656e 2074 6f20 5c6e 2020 2025  ritten to \n   %
-0008bf40: 732e 2720 2520 7472 696e 666f 2029 0a0a  s.' % trinfo )..
-0008bf50: 2020 2020 2020 2020 6466 5f73 656c 203d          df_sel =
-0008bf60: 2070 642e 7265 6164 5f63 7376 2874 7269   pd.read_csv(tri
-0008bf70: 6e66 6f2c 2073 6570 3d27 5c74 2729 0a20  nfo, sep='\t'). 
-0008bf80: 2020 2020 2020 2023 2727 270a 0a20 2020         #'''..   
-0008bf90: 2020 2020 2064 665f 7065 7266 2c20 6466       df_perf, df
-0008bfa0: 5f73 656c 203d 2067 6574 5f70 6572 666f  _sel = get_perfo
-0008bfb0: 726d 616e 6365 2864 665f 7365 6c2c 2066  rmance(df_sel, f
-0008bfc0: 5f74 6f5f 7361 7665 3d66 6e61 6d65 2c20  _to_save=fname, 
-0008bfd0: 7265 6620 3d20 7265 662c 2076 6572 626f  ref = ref, verbo
-0008bfe0: 7365 3d76 6572 626f 7365 290a 2020 2020  se=verbose).    
-0008bff0: 2020 2020 6466 5f70 6572 665b 2770 7265      df_perf['pre
-0008c000: 6369 7369 6f6e 275d 203d 2072 6f75 6e64  cision'] = round
-0008c010: 2864 665f 7065 7266 5b27 4e5f 7265 636f  (df_perf['N_reco
-0008c020: 7665 7265 6427 5d2a 3130 302f 6361 6e64  vered']*100/cand
-0008c030: 5f63 6e74 2c31 290a 2020 2020 2020 2020  _cnt,1).        
-0008c040: 6466 5f70 6572 665b 2773 656e 7369 7469  df_perf['sensiti
-0008c050: 7669 7479 275d 203d 2072 6f75 6e64 2864  vity'] = round(d
-0008c060: 665f 7065 7266 5b27 4e5f 7265 636f 7665  f_perf['N_recove
-0008c070: 7265 6427 5d2a 3130 302f 7265 665f 636e  red']*100/ref_cn
-0008c080: 742c 3129 0a20 2020 2020 2020 2023 2069  t,1).        # i
-0008c090: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
-0008c0a0: 2864 665f 7065 7266 290a 2020 2020 2020  (df_perf).      
-0008c0b0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-0008c0c0: 2074 7261 7265 636f 203d 3d20 5472 7565   trareco == True
-0008c0d0: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-0008c0e0: 5f74 7220 3d20 6765 745f 696e 666f 5f66  _tr = get_info_f
-0008c0f0: 726f 6d5f 7472 5f6e 616d 6528 2074 6e20  rom_tr_name( tn 
-0008c100: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0008c110: 5f74 725b 2764 6574 6563 7465 6427 5d20  _tr['detected'] 
-0008c120: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0008c130: 2020 2020 6466 5f74 722e 6c6f 635b 6c69      df_tr.loc[li
-0008c140: 7374 2864 665f 7365 6c5b 735f 6964 5d29  st(df_sel[s_id])
-0008c150: 2c27 6465 7465 6374 6564 275d 203d 2054  ,'detected'] = T
-0008c160: 7275 6520 0a20 2020 2020 2020 2020 2020  rue .           
-0008c170: 2064 665f 7472 5b71 5f6c 656e 5d20 3d20   df_tr[q_len] = 
-0008c180: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
-0008c190: 7220 6d2c 2073 6964 2069 6e20 656e 756d  r m, sid in enum
-0008c1a0: 6572 6174 6528 6466 5f73 656c 5b73 5f69  erate(df_sel[s_i
-0008c1b0: 645d 293a 0a20 2020 2020 2020 2020 2020  d]):.           
-0008c1c0: 2020 2020 2064 665f 7472 2e6c 6f63 5b73       df_tr.loc[s
-0008c1d0: 6964 2c71 5f6c 656e 5d20 3d20 6e70 2e72  id,q_len] = np.r
-0008c1e0: 6f75 6e64 2864 665f 7365 6c2e 696c 6f63  ound(df_sel.iloc
-0008c1f0: 5b6d 5d2e 716c 656e 290a 2020 2020 2020  [m].qlen).      
-0008c200: 2020 2020 2020 6466 5f74 725b 735f 7374        df_tr[s_st
-0008c210: 6172 745d 203d 2030 0a20 2020 2020 2020  art] = 0.       
-0008c220: 2020 2020 2023 2064 665f 7472 2e6c 6f63       # df_tr.loc
-0008c230: 5b6c 6973 7428 6466 5f73 656c 5b27 7369  [list(df_sel['si
-0008c240: 6427 5d29 2c27 7363 7667 275d 203d 2064  d']),'scvg'] = d
-0008c250: 665f 7365 6c2e 6c6f 635b 3a2c 2773 6376  f_sel.loc[:,'scv
-0008c260: 6727 5d20 0a20 2020 2020 2020 2020 2020  g'] .           
-0008c270: 2066 6f72 206d 2c20 7369 6420 696e 2065   for m, sid in e
-0008c280: 6e75 6d65 7261 7465 2864 665f 7365 6c5b  numerate(df_sel[
-0008c290: 735f 6964 5d29 3a0a 2020 2020 2020 2020  s_id]):.        
-0008c2a0: 2020 2020 2020 2020 6466 5f74 722e 6c6f          df_tr.lo
-0008c2b0: 635b 7369 642c 735f 7374 6172 745d 203d  c[sid,s_start] =
-0008c2c0: 206e 702e 726f 756e 6428 6466 5f73 656c   np.round(df_sel
-0008c2d0: 2e69 6c6f 635b 6d5d 2e73 7374 6172 7429  .iloc[m].sstart)
-0008c2e0: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-0008c2f0: 7472 5b73 5f65 6e64 5d20 3d20 300a 2020  tr[s_end] = 0.  
-0008c300: 2020 2020 2020 2020 2020 2320 6466 5f74            # df_t
-0008c310: 722e 6c6f 635b 6c69 7374 2864 665f 7365  r.loc[list(df_se
-0008c320: 6c5b 2773 6964 275d 292c 2773 6376 6727  l['sid']),'scvg'
-0008c330: 5d20 3d20 6466 5f73 656c 2e6c 6f63 5b3a  ] = df_sel.loc[:
-0008c340: 2c27 7363 7667 275d 200a 2020 2020 2020  ,'scvg'] .      
-0008c350: 2020 2020 2020 666f 7220 6d2c 2073 6964        for m, sid
-0008c360: 2069 6e20 656e 756d 6572 6174 6528 6466   in enumerate(df
-0008c370: 5f73 656c 5b73 5f69 645d 293a 0a20 2020  _sel[s_id]):.   
-0008c380: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0008c390: 7472 2e6c 6f63 5b73 6964 2c73 5f65 6e64  tr.loc[sid,s_end
-0008c3a0: 5d20 3d20 6e70 2e72 6f75 6e64 2864 665f  ] = np.round(df_
-0008c3b0: 7365 6c2e 696c 6f63 5b6d 5d2e 7365 6e64  sel.iloc[m].send
-0008c3c0: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0008c3d0: 5f74 7220 3d20 6466 5f74 722e 7265 7365  _tr = df_tr.rese
-0008c3e0: 745f 696e 6465 7828 290a 2020 2020 2020  t_index().      
-0008c3f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008c400: 2020 2020 6466 5f74 7220 3d20 4e6f 6e65      df_tr = None
-0008c410: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0008c420: 2020 2020 2020 7265 7475 726e 2864 665f        return(df_
-0008c430: 7065 7266 2c20 6466 5f73 656c 2c20 6466  perf, df_sel, df
-0008c440: 5f74 7229 0a20 2020 200a 2020 2020 656c  _tr).    .    el
-0008c450: 7365 3a0a 2020 2020 2020 2020 6966 2076  se:.        if v
-0008c460: 6572 626f 7365 3a20 7072 696e 7428 274e  erbose: print('N
-0008c470: 6f20 7472 2066 6f75 6e64 2e20 2729 0a20  o tr found. '). 
-0008c480: 2020 2020 2020 2072 6574 7572 6e28 4e6f         return(No
-0008c490: 6e65 2c4e 6f6e 652c 4e6f 6e65 290a 2020  ne,None,None).  
-0008c4a0: 2020 0a0a 2323 2323 2323 2323 2323 2323    ..############
-0008c4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089830: 0a0a 6465 6620 7768 6963 6828 2061 692c  ..def which( ai,
+00089840: 2076 616c 7565 203d 2054 7275 6520 2920   value = True ) 
+00089850: 3a0a 2020 2020 7768 203d 205b 5d0a 2020  :.    wh = [].  
+00089860: 2020 6120 3d20 6c69 7374 2861 6929 0a20    a = list(ai). 
+00089870: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
+00089880: 6528 6c65 6e28 6129 293a 200a 2020 2020  e(len(a)): .    
+00089890: 2020 2020 6966 2061 5b6b 5d20 3d3d 2076      if a[k] == v
+000898a0: 616c 7565 3a20 0a20 2020 2020 2020 2020  alue: .         
+000898b0: 2020 2077 682e 6170 7065 6e64 286b 2920     wh.append(k) 
+000898c0: 0a20 2020 2072 6574 7572 6e28 7768 290a  .    return(wh).
+000898d0: 0a64 6566 2067 6574 5f69 6e66 6f5f 6672  .def get_info_fr
+000898e0: 6f6d 5f74 725f 6e61 6d65 2820 746e 7320  om_tr_name( tns 
+000898f0: 293a 0a20 2020 200a 2020 2020 6162 6e5f  ):.    .    abn_
+00089900: 6520 3d20 5b5d 0a20 2020 2074 706d 5f65  e = [].    tpm_e
+00089910: 203d 205b 5d0a 2020 2020 6966 7261 6320   = [].    ifrac 
+00089920: 3d20 5b5d 0a20 2020 2073 6964 7820 3d20  = [].    sidx = 
+00089930: 5b5d 0a20 2020 2067 5f73 697a 6520 3d20  [].    g_size = 
+00089940: 5b5d 0a20 2020 206e 5f65 786f 6e73 203d  [].    n_exons =
+00089950: 205b 5d0a 2020 2020 675f 766f 6c20 3d20   [].    g_vol = 
+00089960: 5b5d 0a20 2020 2069 636e 7420 3d20 5b5d  [].    icnt = []
+00089970: 0a20 2020 2074 5f6c 656e 203d 205b 5d0a  .    t_len = [].
+00089980: 2020 2020 7374 726e 6420 3d20 5b5d 0a20      strnd = []. 
+00089990: 2020 2063 646e 6720 3d20 5b5d 0a20 2020     cdng = [].   
+000899a0: 2066 6f72 206b 2c20 746e 2069 6e20 656e   for k, tn in en
+000899b0: 756d 6572 6174 6528 746e 7329 3a0a 2020  umerate(tns):.  
+000899c0: 2020 2020 2020 6864 7220 3d20 746e 2e73        hdr = tn.s
+000899d0: 706c 6974 2827 2027 290a 2020 2020 2020  plit(' ').      
+000899e0: 2020 6974 656d 7320 3d20 6864 725b 305d    items = hdr[0]
+000899f0: 2e73 706c 6974 2827 5f27 290a 2020 2020  .split('_').    
+00089a00: 2020 2020 7374 726e 642e 6170 7065 6e64      strnd.append
+00089a10: 2820 6974 656d 735b 325d 290a 2020 2020  ( items[2]).    
+00089a20: 2020 2020 6364 6e67 2e61 7070 656e 6428      cdng.append(
+00089a30: 2069 7465 6d73 5b33 5d29 0a20 2020 2020   items[3]).     
+00089a40: 2020 2073 6964 782e 6170 7065 6e64 2820     sidx.append( 
+00089a50: 2869 7465 6d73 5b34 5d29 2029 0a20 2020  (items[4]) ).   
+00089a60: 2020 2020 2067 5f73 697a 652e 6170 7065       g_size.appe
+00089a70: 6e64 2820 696e 7428 6974 656d 735b 355d  nd( int(items[5]
+00089a80: 2920 290a 2020 2020 2020 2020 6963 6e74  ) ).        icnt
+00089a90: 2e61 7070 656e 6428 2069 6e74 2869 7465  .append( int(ite
+00089aa0: 6d73 5b36 5d29 2029 0a20 2020 2020 2020  ms[6]) ).       
+00089ab0: 2076 616c 203d 2069 7465 6d73 5b37 5d2e   val = items[7].
+00089ac0: 7370 6c69 7428 273a 2729 0a20 2020 2020  split(':').     
+00089ad0: 2020 2061 626e 5f65 2e61 7070 656e 6428     abn_e.append(
+00089ae0: 2066 6c6f 6174 2876 616c 5b31 5d29 2029   float(val[1]) )
+00089af0: 0a20 2020 2020 2020 2076 616c 203d 2069  .        val = i
+00089b00: 7465 6d73 5b38 5d2e 7370 6c69 7428 273a  tems[8].split(':
+00089b10: 2729 0a20 2020 2020 2020 2074 706d 5f65  ').        tpm_e
+00089b20: 2e61 7070 656e 6428 2066 6c6f 6174 2876  .append( float(v
+00089b30: 616c 5b31 5d29 2029 0a20 2020 2020 2020  al[1]) ).       
+00089b40: 2076 616c 203d 2069 7465 6d73 5b39 5d2e   val = items[9].
+00089b50: 7370 6c69 7428 273a 2729 0a20 2020 2020  split(':').     
+00089b60: 2020 2069 6672 6163 2e61 7070 656e 6428     ifrac.append(
+00089b70: 2066 6c6f 6174 2876 616c 5b31 5d29 2029   float(val[1]) )
+00089b80: 0a20 2020 2020 2020 2076 616c 203d 2069  .        val = i
+00089b90: 7465 6d73 5b31 315d 2e73 706c 6974 2827  tems[11].split('
+00089ba0: 3a27 290a 2020 2020 2020 2020 6e5f 6578  :').        n_ex
+00089bb0: 6f6e 732e 6170 7065 6e64 2820 696e 7428  ons.append( int(
+00089bc0: 7661 6c5b 315d 2920 290a 2020 2020 2020  val[1]) ).      
+00089bd0: 2020 7661 6c20 3d20 6974 656d 735b 3132    val = items[12
+00089be0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
+00089bf0: 2020 2020 2067 5f76 6f6c 2e61 7070 656e       g_vol.appen
+00089c00: 6428 2069 6e74 2876 616c 5b31 5d29 2029  d( int(val[1]) )
+00089c10: 0a20 2020 2020 2020 2076 616c 203d 2069  .        val = i
+00089c20: 7465 6d73 5b31 335d 2e73 706c 6974 2827  tems[13].split('
+00089c30: 3a27 290a 2020 2020 2020 2020 745f 6c65  :').        t_le
+00089c40: 6e2e 6170 7065 6e64 2820 696e 7428 7661  n.append( int(va
+00089c50: 6c5b 315d 2920 290a 2020 2020 0a20 2020  l[1]) ).    .   
+00089c60: 2064 6620 3d20 7064 2e44 6174 6146 7261   df = pd.DataFra
+00089c70: 6d65 2829 0a20 2020 200a 2020 2020 6466  me().    .    df
+00089c80: 5b27 7472 5f6e 616d 6527 5d20 3d20 746e  ['tr_name'] = tn
+00089c90: 730a 2020 2020 6466 5b27 6162 6e5f 6573  s.    df['abn_es
+00089ca0: 7427 5d20 3d20 6162 6e5f 650a 2020 2020  t'] = abn_e.    
+00089cb0: 6466 5b27 7470 6d5f 6573 7427 5d20 3d20  df['tpm_est'] = 
+00089cc0: 7470 6d5f 650a 2020 2020 6466 5b27 6769  tpm_e.    df['gi
+00089cd0: 6478 275d 203d 2073 6964 780a 2020 2020  dx'] = sidx.    
+00089ce0: 6466 5b27 6969 6478 275d 203d 2069 636e  df['iidx'] = icn
+00089cf0: 740a 2020 2020 6466 5b27 675f 7369 7a65  t.    df['g_size
+00089d00: 275d 203d 2067 5f73 697a 650a 2020 2020  '] = g_size.    
+00089d10: 6466 5b27 6973 6f5f 6672 6163 275d 203d  df['iso_frac'] =
+00089d20: 2069 6672 6163 0a20 2020 2064 665b 276e   ifrac.    df['n
+00089d30: 5f65 786f 6e73 275d 203d 206e 5f65 786f  _exons'] = n_exo
+00089d40: 6e73 0a20 2020 2064 665b 2767 5f76 6f6c  ns.    df['g_vol
+00089d50: 275d 203d 2067 5f76 6f6c 0a20 2020 2064  '] = g_vol.    d
+00089d60: 665b 276c 656e 6774 6827 5d20 3d20 745f  f['length'] = t_
+00089d70: 6c65 6e0a 2020 2020 6466 5b27 7374 7261  len.    df['stra
+00089d80: 6e64 275d 203d 2073 7472 6e64 0a20 2020  nd'] = strnd.   
+00089d90: 2064 665b 2743 5f6f 725f 4e27 5d20 3d20   df['C_or_N'] = 
+00089da0: 6364 6e67 0a20 2020 200a 2020 2020 6466  cdng.    .    df
+00089db0: 203d 2064 662e 7365 745f 696e 6465 7828   = df.set_index(
+00089dc0: 2774 725f 6e61 6d65 2729 0a20 2020 200a  'tr_name').    .
+00089dd0: 2020 2020 7265 7475 726e 2064 660a 0a64      return df..d
+00089de0: 6566 2067 6574 5f70 6572 666f 726d 616e  ef get_performan
+00089df0: 6365 2874 7269 6e66 6f2c 2063 7667 5f74  ce(trinfo, cvg_t
+00089e00: 6820 3d20 5b38 302c 3930 2c39 355d 2c20  h = [80,90,95], 
+00089e10: 665f 746f 5f73 6176 6520 3d20 4e6f 6e65  f_to_save = None
+00089e20: 2c20 7265 6620 3d20 302c 2076 6572 626f  , ref = 0, verbo
+00089e30: 7365 203d 2046 616c 7365 293a 0a20 2020  se = False):.   
+00089e40: 200a 2020 2020 2327 2727 0a20 2020 2069   .    #'''.    i
+00089e50: 6620 7265 6620 3d3d 2030 3a0a 2020 2020  f ref == 0:.    
+00089e60: 2020 2020 715f 6376 6720 3d20 2771 6376      q_cvg = 'qcv
+00089e70: 6727 0a20 2020 2020 2020 2071 5f6c 656e  g'.        q_len
+00089e80: 203d 2027 716c 656e 270a 2020 2020 2020   = 'qlen'.      
+00089e90: 2020 715f 6964 203d 2027 7169 6427 0a20    q_id = 'qid'. 
+00089ea0: 2020 2020 2020 2073 5f73 7461 7274 203d         s_start =
+00089eb0: 2027 7373 7461 7274 270a 2020 2020 2020   'sstart'.      
+00089ec0: 2020 735f 656e 6420 3d20 2773 656e 6427    s_end = 'send'
+00089ed0: 0a20 2020 2020 2020 2073 5f69 6420 3d20  .        s_id = 
+00089ee0: 2773 6964 270a 2020 2020 656c 7365 3a0a  'sid'.    else:.
+00089ef0: 2020 2020 2020 2020 715f 6376 6720 3d20          q_cvg = 
+00089f00: 2773 6376 6727 0a20 2020 2020 2020 2071  'scvg'.        q
+00089f10: 5f6c 656e 203d 2027 736c 656e 270a 2020  _len = 'slen'.  
+00089f20: 2020 2020 2020 715f 6964 203d 2027 7369        q_id = 'si
+00089f30: 6427 0a20 2020 2020 2020 2073 5f73 7461  d'.        s_sta
+00089f40: 7274 203d 2027 7173 7461 7274 270a 2020  rt = 'qstart'.  
+00089f50: 2020 2020 2020 735f 656e 6420 3d20 2771        s_end = 'q
+00089f60: 656e 6427 0a20 2020 2020 2020 2073 5f69  end'.        s_i
+00089f70: 6420 3d20 2771 6964 270a 2020 2020 2327  d = 'qid'.    #'
+00089f80: 2727 0a20 2020 200a 2020 2020 7169 6473  ''.    .    qids
+00089f90: 203d 2070 642e 756e 6971 7565 2874 7269   = pd.unique(tri
+00089fa0: 6e66 6f5b 715f 6964 5d29 0a20 2020 2073  nfo[q_id]).    s
+00089fb0: 6964 7320 3d20 7064 2e75 6e69 7175 6528  ids = pd.unique(
+00089fc0: 7472 696e 666f 5b73 5f69 645d 290a 2020  trinfo[s_id]).  
+00089fd0: 2020 7767 7420 3d20 6e70 2e7a 6572 6f73    wgt = np.zeros
+00089fe0: 285b 6c65 6e28 7169 6473 292c 6c65 6e28  ([len(qids),len(
+00089ff0: 7369 6473 295d 290a 2020 2020 6966 2076  sids)]).    if v
+0008a000: 6572 626f 7365 3a20 7072 696e 7428 274d  erbose: print('M
+0008a010: 6174 6368 696e 6720 2825 692c 2569 2920  atching (%i,%i) 
+0008a020: 2720 2520 2877 6774 2e73 6861 7065 292c  ' % (wgt.shape),
+0008a030: 2065 6e64 3d27 2729 0a0a 2020 2020 7169   end='')..    qi
+0008a040: 6478 203d 206e 702e 6675 6c6c 2874 7269  dx = np.full(tri
+0008a050: 6e66 6f2e 7368 6170 655b 305d 2c2d 312c  nfo.shape[0],-1,
+0008a060: 6474 7970 653d 696e 7429 0a20 2020 2066  dtype=int).    f
+0008a070: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
+0008a080: 6e28 7169 6473 2929 203a 0a20 2020 2020  n(qids)) :.     
+0008a090: 2020 2071 6964 203d 2071 6964 735b 6b5d     qid = qids[k]
+0008a0a0: 0a20 2020 2020 2020 2077 6820 3d20 7768  .        wh = wh
+0008a0b0: 6963 6828 2074 7269 6e66 6f5b 715f 6964  ich( trinfo[q_id
+0008a0c0: 5d20 3d3d 2071 6964 2029 0a20 2020 2020  ] == qid ).     
+0008a0d0: 2020 2071 6964 785b 7768 5d20 3d20 6b0a     qidx[wh] = k.
+0008a0e0: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
+0008a0f0: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
+0008a100: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+0008a110: 7369 6478 203d 206e 702e 6675 6c6c 2874  sidx = np.full(t
+0008a120: 7269 6e66 6f2e 7368 6170 655b 305d 2c2d  rinfo.shape[0],-
+0008a130: 312c 6474 7970 653d 696e 7429 0a20 2020  1,dtype=int).   
+0008a140: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
+0008a150: 6c65 6e28 7369 6473 2929 203a 0a20 2020  len(sids)) :.   
+0008a160: 2020 2020 2073 6964 203d 2073 6964 735b       sid = sids[
+0008a170: 6b5d 0a20 2020 2020 2020 2077 6820 3d20  k].        wh = 
+0008a180: 7768 6963 6828 2074 7269 6e66 6f5b 735f  which( trinfo[s_
+0008a190: 6964 5d20 3d3d 2073 6964 2029 0a20 2020  id] == sid ).   
+0008a1a0: 2020 2020 2073 6964 785b 7768 5d20 3d20       sidx[wh] = 
+0008a1b0: 6b0a 2020 2020 2020 2020 0a20 2020 2069  k.        .    i
+0008a1c0: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
+0008a1d0: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
+0008a1e0: 2020 666f 7220 7720 696e 2072 616e 6765    for w in range
+0008a1f0: 286c 656e 2871 6964 7829 293a 0a20 2020  (len(qidx)):.   
+0008a200: 2020 2020 2077 6774 5b69 6e74 2871 6964       wgt[int(qid
+0008a210: 785b 775d 292c 2069 6e74 2873 6964 785b  x[w]), int(sidx[
+0008a220: 775d 295d 203d 202d 7472 696e 666f 5b71  w])] = -trinfo[q
+0008a230: 5f63 7667 5d5b 775d 0a0a 2020 2020 6966  _cvg][w]..    if
+0008a240: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
+0008a250: 275f 272c 2065 6e64 3d27 2729 0a20 2020  '_', end='').   
+0008a260: 2023 2070 7269 6e74 2877 6774 2e73 6861   # print(wgt.sha
+0008a270: 7065 290a 2020 2020 726f 775f 6964 782c  pe).    row_idx,
+0008a280: 2063 6f6c 5f69 6478 203d 206f 7074 696d   col_idx = optim
+0008a290: 697a 652e 6c69 6e65 6172 5f73 756d 5f61  ize.linear_sum_a
+0008a2a0: 7373 6967 6e6d 656e 7428 7767 7429 0a20  ssignment(wgt). 
+0008a2b0: 2020 200a 2020 2020 6966 2076 6572 626f     .    if verbo
+0008a2c0: 7365 3a20 7072 696e 7428 272e 272c 2065  se: print('.', e
+0008a2d0: 6e64 3d27 2729 0a20 2020 2064 665f 6c73  nd='').    df_ls
+0008a2e0: 7420 3d20 5b5d 0a20 2020 2066 6f72 206b  t = [].    for k
+0008a2f0: 2069 6e20 7261 6e67 6528 6c65 6e28 636f   in range(len(co
+0008a300: 6c5f 6964 7829 2920 3a0a 2020 2020 2020  l_idx)) :.      
+0008a310: 2020 7369 203d 2063 6f6c 5f69 6478 5b6b    si = col_idx[k
+0008a320: 5d0a 2020 2020 2020 2020 7768 203d 2077  ].        wh = w
+0008a330: 6869 6368 2873 6964 7820 3d3d 2073 6929  hich(sidx == si)
+0008a340: 0a20 2020 2020 2020 2077 203d 2077 6869  .        w = whi
+0008a350: 6368 2820 7169 6478 5b77 685d 203d 3d20  ch( qidx[wh] == 
+0008a360: 726f 775f 6964 785b 6b5d 2029 0a20 2020  row_idx[k] ).   
+0008a370: 2020 2020 2069 6620 6c65 6e28 7729 203e       if len(w) >
+0008a380: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0008a390: 6966 206c 656e 2877 2920 3e20 313a 2070  if len(w) > 1: p
+0008a3a0: 7269 6e74 2827 4552 524f 5220 696e 2067  rint('ERROR in g
+0008a3b0: 6574 5f70 6572 666f 726d 616e 6365 2829  et_performance()
+0008a3c0: 3a20 4c65 6e28 7729 203d 2025 6927 2025  : Len(w) = %i' %
+0008a3d0: 206c 656e 2877 2920 290a 2020 2020 2020   len(w) ).      
+0008a3e0: 2020 2020 2020 6964 7820 3d20 7768 5b77        idx = wh[w
+0008a3f0: 5b30 5d5d 0a20 2020 2020 2020 2020 2020  [0]].           
+0008a400: 2064 665f 6c73 742e 6170 7065 6e64 2874   df_lst.append(t
+0008a410: 7269 6e66 6f2e 696c 6f63 5b69 6478 5d29  rinfo.iloc[idx])
+0008a420: 0a20 2020 2020 2020 200a 2020 2020 6466  .        .    df
+0008a430: 5f73 656c 203d 2070 642e 4461 7461 4672  _sel = pd.DataFr
+0008a440: 616d 6528 6466 5f6c 7374 290a 2020 2020  ame(df_lst).    
+0008a450: 6966 2066 5f74 6f5f 7361 7665 2069 7320  if f_to_save is 
+0008a460: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0008a470: 2020 666e 616d 6520 3d20 2725 735f 626c    fname = '%s_bl
+0008a480: 6173 745f 7265 7375 6c74 2e74 7376 2720  ast_result.tsv' 
+0008a490: 2520 665f 746f 5f73 6176 650a 2020 2020  % f_to_save.    
+0008a4a0: 2020 2020 6466 5f73 656c 2e74 6f5f 6373      df_sel.to_cs
+0008a4b0: 7628 666e 616d 652c 2068 6561 6465 723d  v(fname, header=
+0008a4c0: 5472 7565 2c20 696e 6465 783d 4661 6c73  True, index=Fals
+0008a4d0: 652c 2073 6570 3d27 5c74 2729 0a20 2020  e, sep='\t').   
+0008a4e0: 2020 2020 2023 2069 6620 7665 7262 6f73       # if verbos
+0008a4f0: 653a 2070 7269 6e74 2827 2025 732e 2720  e: print(' %s.' 
+0008a500: 2520 666e 616d 652c 2065 6e64 3d27 2720  % fname, end='' 
+0008a510: 290a 2020 2020 0a20 2020 2069 6620 7665  ).    .    if ve
+0008a520: 7262 6f73 653a 2070 7269 6e74 2827 2e27  rbose: print('.'
+0008a530: 2c20 656e 643d 2727 290a 2020 2020 636e  , end='').    cn
+0008a540: 7420 3d20 6e70 2e7a 6572 6f73 286c 656e  t = np.zeros(len
+0008a550: 2863 7667 5f74 6829 290a 2020 2020 666f  (cvg_th)).    fo
+0008a560: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
+0008a570: 2863 7667 5f74 6829 293a 0a20 2020 2020  (cvg_th)):.     
+0008a580: 2020 2074 6820 3d20 6376 675f 7468 5b6b     th = cvg_th[k
+0008a590: 5d0a 2020 2020 2020 2020 7768 203d 2077  ].        wh = w
+0008a5a0: 6869 6368 2820 6466 5f73 656c 5b71 5f63  hich( df_sel[q_c
+0008a5b0: 7667 5d2a 3130 3020 3e3d 2074 6820 290a  vg]*100 >= th ).
+0008a5c0: 2020 2020 2020 2020 636e 745b 6b5d 203d          cnt[k] =
+0008a5d0: 206e 702e 696e 7428 6c65 6e28 7768 2929   np.int(len(wh))
+0008a5e0: 0a20 2020 2020 2020 200a 2020 2020 6966  .        .    if
+0008a5f0: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
+0008a600: 2720 646f 6e65 2e27 290a 0a20 2020 2064  ' done.')..    d
+0008a610: 203d 207b 2763 7667 5f74 6827 3a20 6376   = {'cvg_th': cv
+0008a620: 675f 7468 2c20 274e 5f72 6563 6f76 6572  g_th, 'N_recover
+0008a630: 6564 273a 2063 6e74 2e61 7374 7970 6528  ed': cnt.astype(
+0008a640: 696e 7429 2c20 2770 7265 6369 7369 6f6e  int), 'precision
+0008a650: 273a 206e 702e 726f 756e 6428 3130 302a  ': np.round(100*
+0008a660: 636e 742f 6c65 6e28 7369 6473 292c 3129  cnt/len(sids),1)
+0008a670: 7d0a 2020 2020 6466 5f70 6572 6620 3d20  }.    df_perf = 
+0008a680: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
+0008a690: 6120 3d20 6429 2023 2c20 636f 6c75 6d6e  a = d) #, column
+0008a6a0: 7320 3d20 5b27 6376 675f 7468 272c 276e  s = ['cvg_th','n
+0008a6b0: 5f72 6563 6f76 6572 6564 272c 2770 7265  _recovered','pre
+0008a6c0: 6369 7369 6f6e 275d 290a 2020 2020 0a20  cision']).    . 
+0008a6d0: 2020 2072 6574 7572 6e28 6466 5f70 6572     return(df_per
+0008a6e0: 662c 2064 665f 7365 6c29 0a0a 2020 2020  f, df_sel)..    
+0008a6f0: 0a64 6566 2072 756e 5f62 6c61 7374 2820  .def run_blast( 
+0008a700: 696e 7074 5f66 612c 2072 6566 5f66 612c  inpt_fa, ref_fa,
+0008a710: 2070 6174 685f 746f 5f62 6c61 7374 203d   path_to_blast =
+0008a720: 204e 6f6e 652c 2074 7261 7265 636f 203d   None, trareco =
+0008a730: 2046 616c 7365 2c20 7265 665f 696e 666f   False, ref_info
+0008a740: 203d 2046 616c 7365 2c20 5c0a 2020 2020   = False, \.    
+0008a750: 2020 2020 2020 2020 2020 2020 2064 6274               dbt
+0008a760: 7970 6520 3d20 276e 7563 6c27 2c20 7265  ype = 'nucl', re
+0008a770: 6620 3d20 302c 2073 6469 7620 3d20 3130  f = 0, sdiv = 10
+0008a780: 2c20 6d78 5f6e 6361 6e64 203d 2036 2c20  , mx_ncand = 6, 
+0008a790: 7665 7262 6f73 6520 3d20 4661 6c73 6529  verbose = False)
+0008a7a0: 3a0a 0a20 2020 2023 2727 270a 2020 2020  :..    #'''.    
+0008a7b0: 6966 2072 6566 203d 3d20 303a 0a20 2020  if ref == 0:.   
+0008a7c0: 2020 2020 2072 6566 5f74 7220 3d20 7265       ref_tr = re
+0008a7d0: 665f 6661 0a20 2020 2020 2020 2069 6e70  f_fa.        inp
+0008a7e0: 745f 7472 203d 2069 6e70 745f 6661 0a20  t_tr = inpt_fa. 
+0008a7f0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0008a800: 715f 6376 6720 3d20 2771 6376 6727 0a20  q_cvg = 'qcvg'. 
+0008a810: 2020 2020 2020 2071 5f6c 656e 203d 2027         q_len = '
+0008a820: 716c 656e 270a 2020 2020 2020 2020 715f  qlen'.        q_
+0008a830: 6964 203d 2027 7169 6427 0a20 2020 2020  id = 'qid'.     
+0008a840: 2020 2073 5f73 7461 7274 203d 2027 7373     s_start = 'ss
+0008a850: 7461 7274 270a 2020 2020 2020 2020 735f  tart'.        s_
+0008a860: 656e 6420 3d20 2773 656e 6427 0a20 2020  end = 'send'.   
+0008a870: 2020 2020 2073 5f69 6420 3d20 2773 6964       s_id = 'sid
+0008a880: 270a 2020 2020 656c 7365 3a0a 2020 2020  '.    else:.    
+0008a890: 2020 2020 7265 665f 7472 203d 2069 6e70      ref_tr = inp
+0008a8a0: 745f 6661 0a20 2020 2020 2020 2069 6e70  t_fa.        inp
+0008a8b0: 745f 7472 203d 2072 6566 5f66 610a 2020  t_tr = ref_fa.  
+0008a8c0: 2020 2020 2020 0a20 2020 2020 2020 2071        .        q
+0008a8d0: 5f63 7667 203d 2027 7363 7667 270a 2020  _cvg = 'scvg'.  
+0008a8e0: 2020 2020 2020 715f 6c65 6e20 3d20 2773        q_len = 's
+0008a8f0: 6c65 6e27 0a20 2020 2020 2020 2071 5f69  len'.        q_i
+0008a900: 6420 3d20 2773 6964 270a 2020 2020 2020  d = 'sid'.      
+0008a910: 2020 735f 7374 6172 7420 3d20 2771 7374    s_start = 'qst
+0008a920: 6172 7427 0a20 2020 2020 2020 2073 5f65  art'.        s_e
+0008a930: 6e64 203d 2027 7165 6e64 270a 2020 2020  nd = 'qend'.    
+0008a940: 2020 2020 735f 6964 203d 2027 7169 6427      s_id = 'qid'
+0008a950: 0a20 2020 2023 2727 270a 2020 2020 0a20  .    #'''.    . 
+0008a960: 2020 2066 696c 655f 6e61 6d65 7320 3d20     file_names = 
+0008a970: 696e 7074 5f74 722e 7370 6c69 7428 272e  inpt_tr.split('.
+0008a980: 2729 0a20 2020 2066 6e61 6d65 203d 2027  ').    fname = '
+0008a990: 272e 6a6f 696e 2873 7420 666f 7220 7374  '.join(st for st
+0008a9a0: 2069 6e20 6669 6c65 5f6e 616d 6573 5b3a   in file_names[:
+0008a9b0: 2d31 5d20 290a 0a20 2020 2074 6e5f 696e  -1] )..    tn_in
+0008a9c0: 203d 205b 5d0a 2020 2020 6620 3d20 6f70   = [].    f = op
+0008a9d0: 656e 2869 6e70 745f 7472 2c27 7227 290a  en(inpt_tr,'r').
+0008a9e0: 2020 2020 6361 6e64 5f63 6e74 203d 2030      cand_cnt = 0
+0008a9f0: 0a20 2020 2066 6f72 206c 696e 6520 696e  .    for line in
+0008aa00: 2066 3a0a 2020 2020 2020 2020 6966 206c   f:.        if l
+0008aa10: 696e 655b 305d 203d 3d20 273e 273a 0a20  ine[0] == '>':. 
+0008aa20: 2020 2020 2020 2020 2020 2074 6e5f 696e             tn_in
+0008aa30: 2e61 7070 656e 6428 6c69 6e65 5b31 3a2d  .append(line[1:-
+0008aa40: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+0008aa50: 6361 6e64 5f63 6e74 202b 3d20 310a 2020  cand_cnt += 1.  
+0008aa60: 2020 662e 636c 6f73 6528 290a 2020 2020    f.close().    
+0008aa70: 0a20 2020 2074 6e5f 7265 6620 3d20 5b5d  .    tn_ref = []
+0008aa80: 0a20 2020 2066 203d 206f 7065 6e28 7265  .    f = open(re
+0008aa90: 665f 7472 2c27 7227 290a 2020 2020 7265  f_tr,'r').    re
+0008aaa0: 665f 636e 7420 3d20 300a 2020 2020 666f  f_cnt = 0.    fo
+0008aab0: 7220 6c69 6e65 2069 6e20 663a 0a20 2020  r line in f:.   
+0008aac0: 2020 2020 2069 6620 6c69 6e65 5b30 5d20       if line[0] 
+0008aad0: 3d3d 2027 3e27 3a0a 2020 2020 2020 2020  == '>':.        
+0008aae0: 2020 2020 746e 5f72 6566 2e61 7070 656e      tn_ref.appen
+0008aaf0: 6428 6c69 6e65 5b31 3a2d 315d 290a 2020  d(line[1:-1]).  
+0008ab00: 2020 2020 2020 2020 2020 7265 665f 636e            ref_cn
+0008ab10: 7420 2b3d 2031 0a20 2020 2066 2e63 6c6f  t += 1.    f.clo
+0008ab20: 7365 2829 0a20 2020 2023 2070 7269 6e74  se().    # print
+0008ab30: 2827 4c65 6e3a 2025 692c 204e 753d 2025  ('Len: %i, Nu= %
+0008ab40: 6927 2025 2028 6c65 6e28 746e 292c 206c  i' % (len(tn), l
+0008ab50: 656e 2870 642e 756e 6971 7565 2874 6e29  en(pd.unique(tn)
+0008ab60: 2929 2c20 656e 643d 2727 2029 0a20 2020  )), end='' ).   
+0008ab70: 200a 2020 2020 6966 2072 6566 203d 3d20   .    if ref == 
+0008ab80: 303a 0a20 2020 2020 2020 2074 6e20 3d20  0:.        tn = 
+0008ab90: 746e 5f69 6e0a 2020 2020 2020 2020 6e5f  tn_in.        n_
+0008aba0: 6d61 785f 6361 6e64 7320 3d20 310a 2020  max_cands = 1.  
+0008abb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008abc0: 746e 203d 2074 6e5f 7265 660a 2020 2020  tn = tn_ref.    
+0008abd0: 2020 2020 6e5f 6d61 785f 6361 6e64 7320      n_max_cands 
+0008abe0: 3d20 206d 785f 6e63 616e 640a 2020 2020  =  mx_ncand.    
+0008abf0: 2020 2020 746d 7020 3d20 6361 6e64 5f63      tmp = cand_c
+0008ac00: 6e74 0a20 2020 2020 2020 2063 616e 645f  nt.        cand_
+0008ac10: 636e 7420 3d20 7265 665f 636e 740a 2020  cnt = ref_cnt.  
+0008ac20: 2020 2020 2020 7265 665f 636e 7420 3d20        ref_cnt = 
+0008ac30: 746d 700a 2020 2020 0a20 2020 2023 2320  tmp.    .    ## 
+0008ac40: 6d61 6b65 2062 6c61 7374 2064 6220 7769  make blast db wi
+0008ac50: 7468 2069 6e70 7574 5f74 720a 2020 2020  th input_tr.    
+0008ac60: 6966 2070 6174 685f 746f 5f62 6c61 7374  if path_to_blast
+0008ac70: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0008ac80: 2020 636d 6420 3d20 276d 616b 6562 6c61    cmd = 'makebla
+0008ac90: 7374 6462 202d 696e 2025 7320 2d64 6274  stdb -in %s -dbt
+0008aca0: 7970 6520 2573 2720 2520 2869 6e70 745f  ype %s' % (inpt_
+0008acb0: 7472 2c20 6462 7479 7065 290a 2020 2020  tr, dbtype).    
+0008acc0: 656c 7365 3a0a 2020 2020 2020 2020 636d  else:.        cm
+0008acd0: 6420 3d20 2725 732f 6d61 6b65 626c 6173  d = '%s/makeblas
+0008ace0: 7464 6220 2d69 6e20 2573 202d 6462 7479  tdb -in %s -dbty
+0008acf0: 7065 2025 7327 2025 2028 7061 7468 5f74  pe %s' % (path_t
+0008ad00: 6f5f 626c 6173 742c 2069 6e70 745f 7472  o_blast, inpt_tr
+0008ad10: 2c20 6462 7479 7065 290a 2020 2020 7265  , dbtype).    re
+0008ad20: 7320 3d20 7375 6270 726f 6365 7373 2e63  s = subprocess.c
+0008ad30: 6865 636b 5f6f 7574 7075 7428 636d 642c  heck_output(cmd,
+0008ad40: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
+0008ad50: 2023 2070 7269 6e74 2872 6573 2e64 6563   # print(res.dec
+0008ad60: 6f64 6528 2777 696e 646f 7773 2d31 3235  ode('windows-125
+0008ad70: 3227 2929 0a20 0a20 2020 2073 7472 5f6f  2')). .    str_o
+0008ad80: 7074 696f 6e20 3d20 272d 6f75 7466 6d74  ption = '-outfmt
+0008ad90: 2022 3620 7173 6571 6964 2073 7365 7169   "6 qseqid sseqi
+0008ada0: 6420 716c 656e 206c 656e 6774 6820 736c  d qlen length sl
+0008adb0: 656e 2071 7374 6172 7420 7165 6e64 2073  en qstart qend s
+0008adc0: 7374 6172 7420 7365 6e64 206e 6964 656e  start send niden
+0008add0: 7420 6d69 736d 6174 6368 2067 6170 6f70  t mismatch gapop
+0008ade0: 656e 2071 636f 7673 2071 636f 7668 7370  en qcovs qcovhsp
+0008adf0: 2062 6974 7363 6f72 6522 202d 6e75 6d5f   bitscore" -num_
+0008ae00: 7468 7265 6164 7320 3420 2d6d 6178 5f74  threads 4 -max_t
+0008ae10: 6172 6765 745f 7365 7173 2025 6927 2025  arget_seqs %i' %
+0008ae20: 206e 5f6d 6178 5f63 616e 6473 0a0a 2020   n_max_cands..  
+0008ae30: 2020 6966 2064 6274 7970 6520 3d3d 2027    if dbtype == '
+0008ae40: 6e75 636c 273a 2070 7266 7820 3d20 276e  nucl': prfx = 'n
+0008ae50: 270a 2020 2020 656c 7365 3a20 7072 6678  '.    else: prfx
+0008ae60: 203d 2027 7027 0a20 2020 2020 2020 200a   = 'p'.        .
+0008ae70: 2020 2020 6966 2070 6174 685f 746f 5f62      if path_to_b
+0008ae80: 6c61 7374 2069 7320 4e6f 6e65 3a0a 2020  last is None:.  
+0008ae90: 2020 2020 2020 636d 6420 3d20 2762 6c61        cmd = 'bla
+0008aea0: 7374 2573 2025 7320 2d64 6220 2573 202d  st%s %s -db %s -
+0008aeb0: 7175 6572 7920 2573 202d 6f75 7420 2573  query %s -out %s
+0008aec0: 2e74 626c 7374 2720 2520 2870 7266 782c  .tblst' % (prfx,
+0008aed0: 2073 7472 5f6f 7074 696f 6e2c 2069 6e70   str_option, inp
+0008aee0: 745f 7472 2c20 7265 665f 7472 2c20 666e  t_tr, ref_tr, fn
+0008aef0: 616d 6529 0a20 2020 2065 6c73 653a 0a20  ame).    else:. 
+0008af00: 2020 2020 2020 2063 6d64 203d 2027 2573         cmd = '%s
+0008af10: 2f62 6c61 7374 2573 2025 7320 2d64 6220  /blast%s %s -db 
+0008af20: 2573 202d 7175 6572 7920 2573 202d 6f75  %s -query %s -ou
+0008af30: 7420 2573 2e74 626c 7374 2720 2520 2870  t %s.tblst' % (p
+0008af40: 6174 685f 746f 5f62 6c61 7374 2c20 7072  ath_to_blast, pr
+0008af50: 6678 2c20 7374 725f 6f70 7469 6f6e 2c20  fx, str_option, 
+0008af60: 696e 7074 5f74 722c 2072 6566 5f74 722c  inpt_tr, ref_tr,
+0008af70: 2066 6e61 6d65 290a 2020 2020 2020 2020   fname).        
+0008af80: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
+0008af90: 2070 7269 6e74 2822 5275 6e6e 696e 6720   print("Running 
+0008afa0: 426c 6173 742d 2573 2077 6974 6820 2569  Blast-%s with %i
+0008afb0: 2063 616e 642e 2025 6920 7265 662e 202e   cand. %i ref. .
+0008afc0: 2e2e 2022 2025 2028 6462 7479 7065 5b30  .. " % (dbtype[0
+0008afd0: 5d2e 7570 7065 7228 292c 6361 6e64 5f63  ].upper(),cand_c
+0008afe0: 6e74 2c20 7265 665f 636e 7429 2c20 656e  nt, ref_cnt), en
+0008aff0: 643d 2727 2c20 666c 7573 683d 5472 7565  d='', flush=True
+0008b000: 293b 0a20 2020 2072 6573 203d 2073 7562  );.    res = sub
+0008b010: 7072 6f63 6573 732e 6368 6563 6b5f 6f75  process.check_ou
+0008b020: 7470 7574 2863 6d64 2c20 7368 656c 6c3d  tput(cmd, shell=
+0008b030: 5472 7565 290a 2020 2020 2320 7072 696e  True).    # prin
+0008b040: 7428 7265 732e 6465 636f 6465 2827 7769  t(res.decode('wi
+0008b050: 6e64 6f77 732d 3132 3532 2729 290a 2020  ndows-1252')).  
+0008b060: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
+0008b070: 696e 7428 2764 6f6e 652e 2729 0a20 2020  int('done.').   
+0008b080: 200a 2020 2020 6f73 2e72 656d 6f76 6528   .    os.remove(
+0008b090: 2027 2573 2e25 7368 7227 2025 2028 696e   '%s.%shr' % (in
+0008b0a0: 7074 5f74 722c 2070 7266 7829 2029 0a20  pt_tr, prfx) ). 
+0008b0b0: 2020 206f 732e 7265 6d6f 7665 2820 2725     os.remove( '%
+0008b0c0: 732e 2573 696e 2720 2520 2869 6e70 745f  s.%sin' % (inpt_
+0008b0d0: 7472 2c20 7072 6678 2920 290a 2020 2020  tr, prfx) ).    
+0008b0e0: 6f73 2e72 656d 6f76 6528 2027 2573 2e25  os.remove( '%s.%
+0008b0f0: 7373 7127 2025 2028 696e 7074 5f74 722c  ssq' % (inpt_tr,
+0008b100: 2070 7266 7829 2029 0a20 2020 0a20 2020   prfx) ).   .   
+0008b110: 2063 6f6c 6e61 6d65 7320 3d20 5b27 7169   colnames = ['qi
+0008b120: 6427 2c20 2773 6964 272c 2027 716c 656e  d', 'sid', 'qlen
+0008b130: 272c 2027 616c 656e 272c 2027 736c 656e  ', 'alen', 'slen
+0008b140: 272c 2027 7173 7461 7274 272c 2027 7165  ', 'qstart', 'qe
+0008b150: 6e64 272c 2027 7373 7461 7274 272c 2027  nd', 'sstart', '
+0008b160: 7365 6e64 272c 205c 0a20 2020 2020 2020  send', \.       
+0008b170: 2020 2020 2020 2020 2027 6e69 6465 6e74           'nident
+0008b180: 272c 2027 6d69 736d 6174 6368 272c 2027  ', 'mismatch', '
+0008b190: 6761 706f 7065 6e27 2c20 2771 636f 7673  gapopen', 'qcovs
+0008b1a0: 272c 2027 7163 6f76 6873 7027 2c20 2762  ', 'qcovhsp', 'b
+0008b1b0: 6974 7363 6f72 6527 5d0a 2020 2020 7462  itscore'].    tb
+0008b1c0: 6c73 7420 3d20 2725 732e 7462 6c73 7427  lst = '%s.tblst'
+0008b1d0: 2025 2066 6e61 6d65 0a20 2020 2064 6620   % fname.    df 
+0008b1e0: 3d20 7064 2e72 6561 645f 6373 7628 7462  = pd.read_csv(tb
+0008b1f0: 6c73 742c 2068 6561 6465 7220 3d20 2769  lst, header = 'i
+0008b200: 6e66 6572 272c 206e 616d 6573 203d 2063  nfer', names = c
+0008b210: 6f6c 6e61 6d65 732c 2073 6570 3d27 5c74  olnames, sep='\t
+0008b220: 2729 0a20 2020 200a 2020 2020 6f73 2e72  ').    .    os.r
+0008b230: 656d 6f76 6528 2027 2573 2720 2520 2874  emove( '%s' % (t
+0008b240: 626c 7374 2920 290a 2020 2020 0a20 2020  blst) ).    .   
+0008b250: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
+0008b260: 6e74 2827 4e2e 6361 6e64 3a20 2569 2c20  nt('N.cand: %i, 
+0008b270: 4e2e 7375 626a 6563 742e 756e 6971 7565  N.subject.unique
+0008b280: 3a20 2569 2720 2520 286c 656e 2874 6e29  : %i' % (len(tn)
+0008b290: 2c20 6c65 6e28 7064 2e75 6e69 7175 6528  , len(pd.unique(
+0008b2a0: 6466 5b27 7369 6427 5d29 2929 2029 0a0a  df['sid']))) )..
+0008b2b0: 2020 2020 6466 5b27 7363 7667 275d 203d      df['scvg'] =
+0008b2c0: 2064 665b 2761 6c65 6e27 5d2f 6466 5b27   df['alen']/df['
+0008b2d0: 736c 656e 275d 0a20 2020 2064 665b 2771  slen'].    df['q
+0008b2e0: 6376 6727 5d20 3d20 6466 5b27 616c 656e  cvg'] = df['alen
+0008b2f0: 275d 2f64 665b 2771 6c65 6e27 5d0a 2020  ']/df['qlen'].  
+0008b300: 2020 2020 2020 0a20 2020 2069 6620 7472        .    if tr
+0008b310: 6172 6563 6f20 3d3d 2054 7275 653a 0a20  areco == True:. 
+0008b320: 2020 2020 2020 2061 626e 5f65 203d 205b         abn_e = [
+0008b330: 5d0a 2020 2020 2020 2020 7470 6d5f 6520  ].        tpm_e 
+0008b340: 3d20 5b5d 0a20 2020 2020 2020 2069 6672  = [].        ifr
+0008b350: 6163 203d 205b 5d0a 2020 2020 2020 2020  ac = [].        
+0008b360: 7369 6478 203d 205b 5d0a 2020 2020 2020  sidx = [].      
+0008b370: 2020 675f 7369 7a65 203d 205b 5d0a 2020    g_size = [].  
+0008b380: 2020 2020 2020 6e5f 6578 6f6e 7320 3d20        n_exons = 
+0008b390: 5b5d 0a20 2020 2020 2020 2067 5f76 6f6c  [].        g_vol
+0008b3a0: 203d 205b 5d0a 2020 2020 2020 2020 6963   = [].        ic
+0008b3b0: 6e74 203d 205b 5d0a 2020 2020 2020 2020  nt = [].        
+0008b3c0: 7374 726e 6420 3d20 5b5d 0a20 2020 2020  strnd = [].     
+0008b3d0: 2020 2063 646e 6720 3d20 5b5d 0a20 2020     cdng = [].   
+0008b3e0: 2020 2020 2066 6f72 206b 2069 6e20 7261       for k in ra
+0008b3f0: 6e67 6528 6466 2e73 6861 7065 5b30 5d29  nge(df.shape[0])
+0008b400: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0008b410: 7320 3d20 273e 2573 5f43 6872 2573 3a25  s = '>%s_Chr%s:%
+0008b420: 692d 2569 5f25 695f 2569 5f25 695f 4162  i-%i_%i_%i_%i_Ab
+0008b430: 6e3a 2534 2e33 665f 5450 4d3a 2534 2e32  n:%4.3f_TPM:%4.2
+0008b440: 665f 4946 7261 633a 2533 2e32 665c 6e27  f_IFrac:%3.2f\n'
+0008b450: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
+0008b460: 2520 2874 722e 7072 6566 6978 2c20 7472  % (tr.prefix, tr
+0008b470: 2e63 6872 2c20 7472 2e73 7461 7274 2c20  .chr, tr.start, 
+0008b480: 7472 2e65 6e64 2c20 7472 2e67 6964 782c  tr.end, tr.gidx,
+0008b490: 2074 722e 6772 705f 7369 7a65 2c20 7472   tr.grp_size, tr
+0008b4a0: 2e69 636e 742c 2074 722e 6162 6e2c 2074  .icnt, tr.abn, t
+0008b4b0: 722e 7470 6d2c 2074 722e 6973 6f5f 6672  r.tpm, tr.iso_fr
+0008b4c0: 6163 290a 2020 2020 2020 2020 2020 2020  ac).            
+0008b4d0: 6864 7220 3d20 6466 5b73 5f69 645d 5b6b  hdr = df[s_id][k
+0008b4e0: 5d2e 7370 6c69 7428 2720 2729 0a20 2020  ].split(' ').   
+0008b4f0: 2020 2020 2020 2020 2069 7465 6d73 203d           items =
+0008b500: 2068 6472 5b30 5d2e 7370 6c69 7428 275f   hdr[0].split('_
+0008b510: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+0008b520: 7472 6e64 2e61 7070 656e 6428 2069 7465  trnd.append( ite
+0008b530: 6d73 5b32 5d29 0a20 2020 2020 2020 2020  ms[2]).         
+0008b540: 2020 2063 646e 672e 6170 7065 6e64 2820     cdng.append( 
+0008b550: 6974 656d 735b 335d 290a 2020 2020 2020  items[3]).      
+0008b560: 2020 2020 2020 7369 6478 2e61 7070 656e        sidx.appen
+0008b570: 6428 2028 6974 656d 735b 345d 2920 290a  d( (items[4]) ).
+0008b580: 2020 2020 2020 2020 2020 2020 675f 7369              g_si
+0008b590: 7a65 2e61 7070 656e 6428 2069 6e74 2869  ze.append( int(i
+0008b5a0: 7465 6d73 5b35 5d29 2029 0a20 2020 2020  tems[5]) ).     
+0008b5b0: 2020 2020 2020 2069 636e 742e 6170 7065         icnt.appe
+0008b5c0: 6e64 2820 696e 7428 6974 656d 735b 365d  nd( int(items[6]
+0008b5d0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+0008b5e0: 7661 6c20 3d20 6974 656d 735b 375d 2e73  val = items[7].s
+0008b5f0: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
+0008b600: 2020 2020 2020 6162 6e5f 652e 6170 7065        abn_e.appe
+0008b610: 6e64 2820 666c 6f61 7428 7661 6c5b 315d  nd( float(val[1]
+0008b620: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+0008b630: 7661 6c20 3d20 6974 656d 735b 385d 2e73  val = items[8].s
+0008b640: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
+0008b650: 2020 2020 2020 7470 6d5f 652e 6170 7065        tpm_e.appe
+0008b660: 6e64 2820 666c 6f61 7428 7661 6c5b 315d  nd( float(val[1]
+0008b670: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+0008b680: 7661 6c20 3d20 6974 656d 735b 395d 2e73  val = items[9].s
+0008b690: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
+0008b6a0: 2020 2020 2020 6966 7261 632e 6170 7065        ifrac.appe
+0008b6b0: 6e64 2820 666c 6f61 7428 7661 6c5b 315d  nd( float(val[1]
+0008b6c0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+0008b6d0: 7661 6c20 3d20 6974 656d 735b 3131 5d2e  val = items[11].
+0008b6e0: 7370 6c69 7428 273a 2729 0a20 2020 2020  split(':').     
+0008b6f0: 2020 2020 2020 206e 5f65 786f 6e73 2e61         n_exons.a
+0008b700: 7070 656e 6428 2069 6e74 2876 616c 5b31  ppend( int(val[1
+0008b710: 5d29 2029 0a20 2020 2020 2020 2020 2020  ]) ).           
+0008b720: 2076 616c 203d 2069 7465 6d73 5b31 325d   val = items[12]
+0008b730: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0008b740: 2020 2020 2020 2020 675f 766f 6c2e 6170          g_vol.ap
+0008b750: 7065 6e64 2820 696e 7428 7661 6c5b 315d  pend( int(val[1]
+0008b760: 2920 290a 2020 2020 656c 7365 3a0a 2020  ) ).    else:.  
+0008b770: 2020 2020 2020 6162 6e5f 6520 3d20 6e70        abn_e = np
+0008b780: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
+0008b790: 305d 290a 2020 2020 2020 2020 7470 6d5f  0]).        tpm_
+0008b7a0: 6520 3d20 6e70 2e7a 6572 6f73 2864 662e  e = np.zeros(df.
+0008b7b0: 7368 6170 655b 305d 290a 2020 2020 2020  shape[0]).      
+0008b7c0: 2020 6966 7261 6320 3d20 6e70 2e7a 6572    ifrac = np.zer
+0008b7d0: 6f73 2864 662e 7368 6170 655b 305d 290a  os(df.shape[0]).
+0008b7e0: 2020 2020 2020 2020 7369 6478 203d 206e          sidx = n
+0008b7f0: 702e 6675 6c6c 2864 662e 7368 6170 655b  p.full(df.shape[
+0008b800: 305d 2c20 2727 290a 2020 2020 2020 2020  0], '').        
+0008b810: 675f 7369 7a65 203d 206e 702e 7a65 726f  g_size = np.zero
+0008b820: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
+0008b830: 2020 2020 2020 206e 5f65 786f 6e73 203d         n_exons =
+0008b840: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
+0008b850: 7065 5b30 5d29 0a20 2020 2020 2020 2067  pe[0]).        g
+0008b860: 5f76 6f6c 203d 206e 702e 7a65 726f 7328  _vol = np.zeros(
+0008b870: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
+0008b880: 2020 2020 2069 636e 7420 3d20 6e70 2e7a       icnt = np.z
+0008b890: 6572 6f73 2864 662e 7368 6170 655b 305d  eros(df.shape[0]
+0008b8a0: 290a 2020 2020 2020 2020 7374 726e 6420  ).        strnd 
+0008b8b0: 3d20 6e70 2e7a 6572 6f73 2864 662e 7368  = np.zeros(df.sh
+0008b8c0: 6170 655b 305d 290a 2020 2020 2020 2020  ape[0]).        
+0008b8d0: 6364 6e67 203d 206e 702e 7a65 726f 7328  cdng = np.zeros(
+0008b8e0: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
+0008b8f0: 2020 2020 200a 2020 2020 2327 2727 0a20       .    #'''. 
+0008b900: 2020 2072 6566 5f69 6e66 6f20 3d20 4661     ref_info = Fa
+0008b910: 6c73 650a 2020 2020 6966 206c 656e 2864  lse.    if len(d
+0008b920: 665b 715f 6964 5d5b 305d 2e73 706c 6974  f[q_id][0].split
+0008b930: 2827 3a27 2929 203d 3d20 343a 200a 2020  (':')) == 4: .  
+0008b940: 2020 2020 2020 7265 665f 696e 666f 203d        ref_info =
+0008b950: 2054 7275 650a 2020 2020 2020 2020 2320   True.        # 
+0008b960: 7072 696e 7428 2752 6566 5f69 6e66 6f20  print('Ref_info 
+0008b970: 6973 2074 7275 6527 290a 2020 2020 2020  is true').      
+0008b980: 2020 0a20 2020 2069 6620 7265 665f 696e    .    if ref_in
+0008b990: 666f 203d 3d20 5472 7565 3a0a 2020 2020  fo == True:.    
+0008b9a0: 2020 2020 6769 6420 3d20 5b5d 0a20 2020      gid = [].   
+0008b9b0: 2020 2020 2063 7667 203d 205b 5d0a 2020       cvg = [].  
+0008b9c0: 2020 2020 2020 6162 6e5f 7420 3d20 5b5d        abn_t = []
+0008b9d0: 0a20 2020 2020 2020 2074 706d 5f74 203d  .        tpm_t =
+0008b9e0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+0008b9f0: 6b20 696e 2072 616e 6765 2864 662e 7368  k in range(df.sh
+0008ba00: 6170 655b 305d 293a 0a20 2020 2020 2020  ape[0]):.       
+0008ba10: 2020 2020 2069 7465 6d73 203d 2064 665b       items = df[
+0008ba20: 715f 6964 5d5b 6b5d 2e73 706c 6974 2827  q_id][k].split('
+0008ba30: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
+0008ba40: 6769 642e 6170 7065 6e64 2820 6974 656d  gid.append( item
+0008ba50: 735b 305d 2029 0a20 2020 2020 2020 2020  s[0] ).         
+0008ba60: 2020 2063 7667 2e61 7070 656e 6428 2066     cvg.append( f
+0008ba70: 6c6f 6174 2869 7465 6d73 5b31 5d29 2029  loat(items[1]) )
+0008ba80: 0a20 2020 2020 2020 2020 2020 2061 626e  .            abn
+0008ba90: 5f74 2e61 7070 656e 6428 2066 6c6f 6174  _t.append( float
+0008baa0: 2869 7465 6d73 5b32 5d29 2029 0a20 2020  (items[2]) ).   
+0008bab0: 2020 2020 2020 2020 2074 706d 5f74 2e61           tpm_t.a
+0008bac0: 7070 656e 6428 2066 6c6f 6174 2869 7465  ppend( float(ite
+0008bad0: 6d73 5b33 5d29 2029 0a20 2020 2065 6c73  ms[3]) ).    els
+0008bae0: 653a 0a20 2020 2020 2020 2067 6964 203d  e:.        gid =
+0008baf0: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
+0008bb00: 7065 5b30 5d29 0a20 2020 2020 2020 2063  pe[0]).        c
+0008bb10: 7667 203d 206e 702e 7a65 726f 7328 6466  vg = np.zeros(df
+0008bb20: 2e73 6861 7065 5b30 5d29 0a20 2020 2020  .shape[0]).     
+0008bb30: 2020 2061 626e 5f74 203d 206e 702e 7a65     abn_t = np.ze
+0008bb40: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
+0008bb50: 0a20 2020 2020 2020 2074 706d 5f74 203d  .        tpm_t =
+0008bb60: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
+0008bb70: 7065 5b30 5d29 0a0a 2020 2020 2327 2727  pe[0])..    #'''
+0008bb80: 0a20 2020 2064 665b 2765 7870 5f63 7667  .    df['exp_cvg
+0008bb90: 275d 203d 2063 7667 0a20 2020 2064 665b  '] = cvg.    df[
+0008bba0: 2761 626e 5f74 7275 6527 5d20 3d20 6162  'abn_true'] = ab
+0008bbb0: 6e5f 740a 2020 2020 6466 5b27 6162 6e5f  n_t.    df['abn_
+0008bbc0: 6573 7427 5d20 3d20 6162 6e5f 650a 2020  est'] = abn_e.  
+0008bbd0: 2020 6466 5b27 7470 6d5f 7472 7565 275d    df['tpm_true']
+0008bbe0: 203d 2074 706d 5f74 0a20 2020 2064 665b   = tpm_t.    df[
+0008bbf0: 2774 706d 5f65 7374 275d 203d 2074 706d  'tpm_est'] = tpm
+0008bc00: 5f65 0a20 2020 2064 665b 2767 6964 7827  _e.    df['gidx'
+0008bc10: 5d20 3d20 7369 6478 0a20 2020 2064 665b  ] = sidx.    df[
+0008bc20: 2769 6964 7827 5d20 3d20 6963 6e74 0a20  'iidx'] = icnt. 
+0008bc30: 2020 2064 665b 2767 5f73 697a 6527 5d20     df['g_size'] 
+0008bc40: 3d20 675f 7369 7a65 0a20 2020 2064 665b  = g_size.    df[
+0008bc50: 2769 736f 5f66 7261 6327 5d20 3d20 6966  'iso_frac'] = if
+0008bc60: 7261 630a 2020 2020 6466 5b27 6e5f 6578  rac.    df['n_ex
+0008bc70: 6f6e 7327 5d20 3d20 6e5f 6578 6f6e 730a  ons'] = n_exons.
+0008bc80: 2020 2020 6466 5b27 675f 766f 6c27 5d20      df['g_vol'] 
+0008bc90: 3d20 675f 766f 6c0a 2020 2020 6466 5b27  = g_vol.    df['
+0008bca0: 7374 7261 6e64 275d 203d 2073 7472 6e64  strand'] = strnd
+0008bcb0: 0a20 2020 2064 665b 2743 5f6f 725f 4e27  .    df['C_or_N'
+0008bcc0: 5d20 3d20 6364 6e67 0a20 2020 2020 2020  ] = cdng.       
+0008bcd0: 200a 2020 2020 6220 3d20 6466 5b71 5f63   .    b = df[q_c
+0008bce0: 7667 5d20 3e3d 2030 2e38 0a20 2020 2064  vg] >= 0.8.    d
+0008bcf0: 665f 6e65 7720 3d20 6466 2e6c 6f63 5b62  f_new = df.loc[b
+0008bd00: 2c3a 5d0a 2020 2020 6466 203d 2064 665f  ,:].    df = df_
+0008bd10: 6e65 770a 2020 2020 0a20 2020 2066 756c  new.    .    ful
+0008bd20: 6c5f 6e61 6d65 7320 3d20 6466 5b71 5f69  l_names = df[q_i
+0008bd30: 645d 202b 2064 665b 735f 6964 5d0a 2020  d] + df[s_id].  
+0008bd40: 2020 666e 7320 3d20 7064 2e75 6e69 7175    fns = pd.uniqu
+0008bd50: 6528 6675 6c6c 5f6e 616d 6573 290a 2020  e(full_names).  
+0008bd60: 2020 6b20 3d20 300a 2020 2020 6466 5f6c    k = 0.    df_l
+0008bd70: 7374 203d 205b 5d0a 2020 2020 666f 7220  st = [].    for 
+0008bd80: 666e 2069 6e20 666e 733a 0a20 2020 2020  fn in fns:.     
+0008bd90: 2020 2077 6820 3d20 7768 6963 6828 6675     wh = which(fu
+0008bda0: 6c6c 5f6e 616d 6573 203d 3d20 666e 290a  ll_names == fn).
+0008bdb0: 2020 2020 2020 2020 6466 5f74 6d70 203d          df_tmp =
+0008bdc0: 2064 662e 696c 6f63 5b77 685d 0a20 2020   df.iloc[wh].   
+0008bdd0: 2020 2020 2071 6376 6720 3d20 6e70 2e61       qcvg = np.a
+0008bde0: 7272 6179 2820 6466 5f74 6d70 5b71 5f63  rray( df_tmp[q_c
+0008bdf0: 7667 5d20 290a 2020 2020 2020 2020 6f64  vg] ).        od
+0008be00: 7220 3d20 7163 7667 2e61 7267 736f 7274  r = qcvg.argsort
+0008be10: 2829 0a20 2020 2020 2020 2064 665f 6c73  ().        df_ls
+0008be20: 742e 6170 7065 6e64 2864 665f 746d 702e  t.append(df_tmp.
+0008be30: 696c 6f63 5b6f 6472 5b2d 315d 5d29 200a  iloc[odr[-1]]) .
+0008be40: 2020 2020 2020 2020 6b20 2b3d 2031 0a0a          k += 1..
+0008be50: 2020 2020 6966 206c 656e 2864 665f 6c73      if len(df_ls
+0008be60: 7429 203e 2030 3a0a 2020 2020 2020 2020  t) > 0:.        
+0008be70: 6466 5f73 656c 203d 2070 642e 4461 7461  df_sel = pd.Data
+0008be80: 4672 616d 6528 6466 5f6c 7374 290a 2020  Frame(df_lst).  
+0008be90: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
+0008bea0: 2020 2074 7269 6e66 6f20 3d20 2725 735f     trinfo = '%s_
+0008beb0: 626c 6173 745f 7265 7375 6c74 2e74 7376  blast_result.tsv
+0008bec0: 2720 2520 666e 616d 650a 2020 2020 2020  ' % fname.      
+0008bed0: 2020 6466 5f73 656c 2e74 6f5f 6373 7628    df_sel.to_csv(
+0008bee0: 7472 696e 666f 2c20 6865 6164 6572 3d54  trinfo, header=T
+0008bef0: 7275 652c 2069 6e64 6578 3d46 616c 7365  rue, index=False
+0008bf00: 2c20 7365 703d 275c 7427 290a 2020 2020  , sep='\t').    
+0008bf10: 2020 2020 2320 6966 2076 6572 626f 7365      # if verbose
+0008bf20: 3a20 7072 696e 7428 2754 7261 6e73 6372  : print('Transcr
+0008bf30: 6970 746f 6d65 2049 6e66 6f2e 2077 7269  iptome Info. wri
+0008bf40: 7474 656e 2074 6f20 5c6e 2020 2025 732e  tten to \n   %s.
+0008bf50: 2720 2520 7472 696e 666f 2029 0a0a 2020  ' % trinfo )..  
+0008bf60: 2020 2020 2020 6466 5f73 656c 203d 2070        df_sel = p
+0008bf70: 642e 7265 6164 5f63 7376 2874 7269 6e66  d.read_csv(trinf
+0008bf80: 6f2c 2073 6570 3d27 5c74 2729 0a20 2020  o, sep='\t').   
+0008bf90: 2020 2020 2023 2727 270a 0a20 2020 2020       #'''..     
+0008bfa0: 2020 2064 665f 7065 7266 2c20 6466 5f73     df_perf, df_s
+0008bfb0: 656c 203d 2067 6574 5f70 6572 666f 726d  el = get_perform
+0008bfc0: 616e 6365 2864 665f 7365 6c2c 2066 5f74  ance(df_sel, f_t
+0008bfd0: 6f5f 7361 7665 3d66 6e61 6d65 2c20 7265  o_save=fname, re
+0008bfe0: 6620 3d20 7265 662c 2076 6572 626f 7365  f = ref, verbose
+0008bff0: 3d76 6572 626f 7365 290a 2020 2020 2020  =verbose).      
+0008c000: 2020 6466 5f70 6572 665b 2770 7265 6369    df_perf['preci
+0008c010: 7369 6f6e 275d 203d 2072 6f75 6e64 2864  sion'] = round(d
+0008c020: 665f 7065 7266 5b27 4e5f 7265 636f 7665  f_perf['N_recove
+0008c030: 7265 6427 5d2a 3130 302f 6361 6e64 5f63  red']*100/cand_c
+0008c040: 6e74 2c31 290a 2020 2020 2020 2020 6466  nt,1).        df
+0008c050: 5f70 6572 665b 2773 656e 7369 7469 7669  _perf['sensitivi
+0008c060: 7479 275d 203d 2072 6f75 6e64 2864 665f  ty'] = round(df_
+0008c070: 7065 7266 5b27 4e5f 7265 636f 7665 7265  perf['N_recovere
+0008c080: 6427 5d2a 3130 302f 7265 665f 636e 742c  d']*100/ref_cnt,
+0008c090: 3129 0a20 2020 2020 2020 2023 2069 6620  1).        # if 
+0008c0a0: 7665 7262 6f73 653a 2070 7269 6e74 2864  verbose: print(d
+0008c0b0: 665f 7065 7266 290a 2020 2020 2020 2020  f_perf).        
+0008c0c0: 2020 200a 2020 2020 2020 2020 6966 2074     .        if t
+0008c0d0: 7261 7265 636f 203d 3d20 5472 7565 3a0a  rareco == True:.
+0008c0e0: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
+0008c0f0: 7220 3d20 6765 745f 696e 666f 5f66 726f  r = get_info_fro
+0008c100: 6d5f 7472 5f6e 616d 6528 2074 6e20 290a  m_tr_name( tn ).
+0008c110: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
+0008c120: 725b 2764 6574 6563 7465 6427 5d20 3d20  r['detected'] = 
+0008c130: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0008c140: 2020 6466 5f74 722e 6c6f 635b 6c69 7374    df_tr.loc[list
+0008c150: 2864 665f 7365 6c5b 735f 6964 5d29 2c27  (df_sel[s_id]),'
+0008c160: 6465 7465 6374 6564 275d 203d 2054 7275  detected'] = Tru
+0008c170: 6520 0a20 2020 2020 2020 2020 2020 2064  e .            d
+0008c180: 665f 7472 5b71 5f6c 656e 5d20 3d20 300a  f_tr[q_len] = 0.
+0008c190: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0008c1a0: 6d2c 2073 6964 2069 6e20 656e 756d 6572  m, sid in enumer
+0008c1b0: 6174 6528 6466 5f73 656c 5b73 5f69 645d  ate(df_sel[s_id]
+0008c1c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0008c1d0: 2020 2064 665f 7472 2e6c 6f63 5b73 6964     df_tr.loc[sid
+0008c1e0: 2c71 5f6c 656e 5d20 3d20 6e70 2e72 6f75  ,q_len] = np.rou
+0008c1f0: 6e64 2864 665f 7365 6c2e 696c 6f63 5b6d  nd(df_sel.iloc[m
+0008c200: 5d2e 716c 656e 290a 2020 2020 2020 2020  ].qlen).        
+0008c210: 2020 2020 6466 5f74 725b 735f 7374 6172      df_tr[s_star
+0008c220: 745d 203d 2030 0a20 2020 2020 2020 2020  t] = 0.         
+0008c230: 2020 2023 2064 665f 7472 2e6c 6f63 5b6c     # df_tr.loc[l
+0008c240: 6973 7428 6466 5f73 656c 5b27 7369 6427  ist(df_sel['sid'
+0008c250: 5d29 2c27 7363 7667 275d 203d 2064 665f  ]),'scvg'] = df_
+0008c260: 7365 6c2e 6c6f 635b 3a2c 2773 6376 6727  sel.loc[:,'scvg'
+0008c270: 5d20 0a20 2020 2020 2020 2020 2020 2066  ] .            f
+0008c280: 6f72 206d 2c20 7369 6420 696e 2065 6e75  or m, sid in enu
+0008c290: 6d65 7261 7465 2864 665f 7365 6c5b 735f  merate(df_sel[s_
+0008c2a0: 6964 5d29 3a0a 2020 2020 2020 2020 2020  id]):.          
+0008c2b0: 2020 2020 2020 6466 5f74 722e 6c6f 635b        df_tr.loc[
+0008c2c0: 7369 642c 735f 7374 6172 745d 203d 206e  sid,s_start] = n
+0008c2d0: 702e 726f 756e 6428 6466 5f73 656c 2e69  p.round(df_sel.i
+0008c2e0: 6c6f 635b 6d5d 2e73 7374 6172 7429 0a20  loc[m].sstart). 
+0008c2f0: 2020 2020 2020 2020 2020 2064 665f 7472             df_tr
+0008c300: 5b73 5f65 6e64 5d20 3d20 300a 2020 2020  [s_end] = 0.    
+0008c310: 2020 2020 2020 2020 2320 6466 5f74 722e          # df_tr.
+0008c320: 6c6f 635b 6c69 7374 2864 665f 7365 6c5b  loc[list(df_sel[
+0008c330: 2773 6964 275d 292c 2773 6376 6727 5d20  'sid']),'scvg'] 
+0008c340: 3d20 6466 5f73 656c 2e6c 6f63 5b3a 2c27  = df_sel.loc[:,'
+0008c350: 7363 7667 275d 200a 2020 2020 2020 2020  scvg'] .        
+0008c360: 2020 2020 666f 7220 6d2c 2073 6964 2069      for m, sid i
+0008c370: 6e20 656e 756d 6572 6174 6528 6466 5f73  n enumerate(df_s
+0008c380: 656c 5b73 5f69 645d 293a 0a20 2020 2020  el[s_id]):.     
+0008c390: 2020 2020 2020 2020 2020 2064 665f 7472             df_tr
+0008c3a0: 2e6c 6f63 5b73 6964 2c73 5f65 6e64 5d20  .loc[sid,s_end] 
+0008c3b0: 3d20 6e70 2e72 6f75 6e64 2864 665f 7365  = np.round(df_se
+0008c3c0: 6c2e 696c 6f63 5b6d 5d2e 7365 6e64 290a  l.iloc[m].send).
+0008c3d0: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
+0008c3e0: 7220 3d20 6466 5f74 722e 7265 7365 745f  r = df_tr.reset_
+0008c3f0: 696e 6465 7828 290a 2020 2020 2020 2020  index().        
+0008c400: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0008c410: 2020 6466 5f74 7220 3d20 4e6f 6e65 0a20    df_tr = None. 
+0008c420: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0008c430: 2020 2020 7265 7475 726e 2864 665f 7065      return(df_pe
+0008c440: 7266 2c20 6466 5f73 656c 2c20 6466 5f74  rf, df_sel, df_t
+0008c450: 7229 0a20 2020 200a 2020 2020 656c 7365  r).    .    else
+0008c460: 3a0a 2020 2020 2020 2020 6966 2076 6572  :.        if ver
+0008c470: 626f 7365 3a20 7072 696e 7428 274e 6f20  bose: print('No 
+0008c480: 7472 2066 6f75 6e64 2e20 2729 0a20 2020  tr found. ').   
+0008c490: 2020 2020 2072 6574 7572 6e28 4e6f 6e65       return(None
+0008c4a0: 2c4e 6f6e 652c 4e6f 6e65 290a 2020 2020  ,None,None).    
+0008c4b0: 0a0a 2323 2323 2323 2323 2323 2323 2323  ..##############
 0008c4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008c4d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008c4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c4f0: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
-0008c500: 6f6e 7320 746f 2028 3129 2073 656c 6563  ons to (1) selec
-0008c510: 7420 7370 6563 6966 6963 2063 6872 6d20  t specific chrm 
-0008c520: 616e 6420 2832 2920 6f6e 6c79 2063 6f64  and (2) only cod
-0008c530: 696e 6720 6765 6e65 7320 696e 2061 2047  ing genes in a G
-0008c540: 5446 0a23 2323 2323 2323 2323 2323 2323  TF.#############
-0008c550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c500: 2323 2323 0a23 2320 4675 6e63 7469 6f6e  ####.## Function
+0008c510: 7320 746f 2028 3129 2073 656c 6563 7420  s to (1) select 
+0008c520: 7370 6563 6966 6963 2063 6872 6d20 616e  specific chrm an
+0008c530: 6420 2832 2920 6f6e 6c79 2063 6f64 696e  d (2) only codin
+0008c540: 6720 6765 6e65 7320 696e 2061 2047 5446  g genes in a GTF
+0008c550: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
 0008c560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008c570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008c580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c590: 2323 2323 230a 0a64 6566 2073 6f72 745f  #####..def sort_
-0008c5a0: 6774 665f 6c69 6e65 735f 6c73 7428 6774  gtf_lines_lst(gt
-0008c5b0: 665f 6c69 6e65 735f 6c73 7429 3a0a 2020  f_lines_lst):.  
-0008c5c0: 2020 0a20 2020 2063 6872 7320 3d20 5b5d    .    chrs = []
-0008c5d0: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
-0008c5e0: 6e20 6774 665f 6c69 6e65 735f 6c73 743a  n gtf_lines_lst:
-0008c5f0: 0a20 2020 2020 2020 2066 6972 7374 5f6c  .        first_l
-0008c600: 696e 6520 3d20 6c69 6e65 735b 305d 0a20  ine = lines[0]. 
-0008c610: 2020 2020 2020 2063 6872 732e 6170 7065         chrs.appe
-0008c620: 6e64 2866 6972 7374 5f6c 696e 652e 6368  nd(first_line.ch
-0008c630: 7229 0a0a 2020 2020 6368 725f 7365 7420  r)..    chr_set 
-0008c640: 3d20 6c69 7374 2873 6574 2863 6872 7329  = list(set(chrs)
-0008c650: 290a 2020 2020 6368 725f 7365 742e 736f  ).    chr_set.so
-0008c660: 7274 2829 0a20 2020 2063 6872 7320 3d20  rt().    chrs = 
-0008c670: 6e70 2e61 7272 6179 2863 6872 7329 0a0a  np.array(chrs)..
-0008c680: 2020 2020 6774 665f 6c73 745f 6e65 7720      gtf_lst_new 
-0008c690: 3d20 5b5d 0a20 2020 2066 6f72 2063 2069  = [].    for c i
-0008c6a0: 6e20 6368 725f 7365 743a 0a20 2020 2020  n chr_set:.     
-0008c6b0: 2020 2077 6820 3d20 7768 6963 6828 6368     wh = which(ch
-0008c6c0: 7273 203d 3d20 6329 0a20 2020 2020 2020  rs == c).       
-0008c6d0: 2070 7320 3d20 6e70 2e61 7272 6179 2820   ps = np.array( 
-0008c6e0: 5b67 7466 5f6c 696e 6573 5f6c 7374 5b77  [gtf_lines_lst[w
-0008c6f0: 5d5b 305d 2e73 7461 7274 2066 6f72 2077  ][0].start for w
-0008c700: 2069 6e20 7768 5d20 290a 2020 2020 2020   in wh] ).      
-0008c710: 2020 6f64 7232 203d 2070 732e 6172 6773    odr2 = ps.args
-0008c720: 6f72 7428 290a 2020 2020 2020 2020 666f  ort().        fo
-0008c730: 7220 6f20 696e 206f 6472 323a 0a20 2020  r o in odr2:.   
-0008c740: 2020 2020 2020 2020 2077 203d 2077 685b           w = wh[
-0008c750: 6f5d 0a20 2020 2020 2020 2020 2020 2067  o].            g
-0008c760: 7466 5f6c 7374 5f6e 6577 2e61 7070 656e  tf_lst_new.appen
-0008c770: 6428 6774 665f 6c69 6e65 735f 6c73 745b  d(gtf_lines_lst[
-0008c780: 775d 290a 2020 2020 2020 2020 0a20 2020  w]).        .   
-0008c790: 2072 6574 7572 6e20 6774 665f 6c73 745f   return gtf_lst_
-0008c7a0: 6e65 770a 0a0a 6465 6620 7365 6c65 6374  new...def select
-0008c7b0: 5f63 6f64 696e 675f 6765 6e65 735f 6672  _coding_genes_fr
-0008c7c0: 6f6d 5f67 7466 5f66 696c 6528 6774 665f  om_gtf_file(gtf_
-0008c7d0: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
-0008c7e0: 6529 3a0a 0a20 2020 2066 6e73 203d 2067  e):..    fns = g
-0008c7f0: 7466 5f66 696c 652e 7370 6c69 7428 272e  tf_file.split('.
-0008c800: 2729 5b3a 2d31 5d0a 2020 2020 666e 616d  ')[:-1].    fnam
-0008c810: 6520 3d20 2727 0a20 2020 2066 6f72 206b  e = ''.    for k
-0008c820: 2c20 666e 2069 6e20 656e 756d 6572 6174  , fn in enumerat
-0008c830: 6528 666e 7329 3a0a 2020 2020 2020 2020  e(fns):.        
-0008c840: 6966 206b 203e 2030 3a0a 2020 2020 2020  if k > 0:.      
-0008c850: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
-0008c860: 616d 6520 2b20 272e 270a 2020 2020 2020  ame + '.'.      
-0008c870: 2020 666e 616d 6520 3d20 666e 616d 6520    fname = fname 
-0008c880: 2b20 666e 0a20 2020 200a 2020 2020 6774  + fn.    .    gt
-0008c890: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
-0008c8a0: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
-0008c8b0: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
-0008c8c0: 3d20 5472 7565 290a 2020 2020 0a20 2020  = True).    .   
-0008c8d0: 2062 6173 655f 6364 7320 3d20 6765 745f   base_cds = get_
-0008c8e0: 6261 7365 5f63 6473 5f66 726f 6d5f 6774  base_cds_from_gt
-0008c8f0: 665f 6c69 6e65 7328 6774 665f 6c69 6e65  f_lines(gtf_line
-0008c900: 7329 0a20 2020 2069 6620 6261 7365 5f63  s).    if base_c
-0008c910: 6473 203c 2030 3a0a 2020 2020 2020 2020  ds < 0:.        
-0008c920: 7072 696e 7428 2749 4e46 4f3a 204e 6f20  print('INFO: No 
-0008c930: 636f 6469 6e67 2069 6e66 6f72 6d61 7469  coding informati
-0008c940: 6f6e 2070 726f 7669 6465 6420 696e 2074  on provided in t
-0008c950: 6865 2047 5446 2f47 4646 2e27 290a 2020  he GTF/GFF.').  
-0008c960: 2020 0a20 2020 2067 7466 5f6c 696e 6573    .    gtf_lines
-0008c970: 5f6c 7374 203d 2070 6172 7365 5f67 7466  _lst = parse_gtf
-0008c980: 5f6c 696e 6573 5f61 6e64 5f73 706c 6974  _lines_and_split
-0008c990: 5f69 6e74 6f5f 6765 6e65 7328 2067 7466  _into_genes( gtf
-0008c9a0: 5f6c 696e 6573 2029 0a20 2020 2067 656e  _lines ).    gen
-0008c9b0: 6f6d 6520 3d20 6c6f 6164 5f67 656e 6f6d  ome = load_genom
-0008c9c0: 6528 6765 6e6f 6d65 5f66 696c 6529 0a20  e(genome_file). 
-0008c9d0: 2020 2063 6872 7320 3d20 6765 6e6f 6d65     chrs = genome
-0008c9e0: 2e6b 6579 7328 290a 0a20 2020 2067 7466  .keys()..    gtf
-0008c9f0: 5f6c 696e 6573 5f6c 7374 5f6e 6577 203d  _lines_lst_new =
-0008ca00: 205b 5d0a 2020 2020 6363 6e74 203d 2030   [].    ccnt = 0
-0008ca10: 0a20 2020 2067 636e 7420 3d20 300a 2020  .    gcnt = 0.  
-0008ca20: 2020 666f 7220 6b2c 2067 6c69 6e65 7320    for k, glines 
-0008ca30: 696e 2065 6e75 6d65 7261 7465 2867 7466  in enumerate(gtf
-0008ca40: 5f6c 696e 6573 5f6c 7374 293a 0a0a 2020  _lines_lst):..  
-0008ca50: 2020 2020 2020 6966 2020 676c 696e 6573        if  glines
-0008ca60: 5b30 5d2e 6368 7220 696e 2063 6872 733a  [0].chr in chrs:
-0008ca70: 0a20 2020 2020 2020 2020 2020 2074 725f  .            tr_
-0008ca80: 6c69 6e65 735f 6c73 7420 3d20 7061 7273  lines_lst = pars
-0008ca90: 655f 6774 665f 6c69 6e65 735f 616e 645f  e_gtf_lines_and_
-0008caa0: 7370 6c69 745f 696e 746f 5f67 656e 6573  split_into_genes
-0008cab0: 2820 676c 696e 6573 2c20 2774 7261 6e73  ( glines, 'trans
-0008cac0: 6372 6970 7427 2029 0a20 2020 2020 2020  cript' ).       
-0008cad0: 2020 2020 206c 696e 6573 5f6e 6577 203d       lines_new =
-0008cae0: 205b 5d0a 0a20 2020 2020 2020 2020 2020   []..           
-0008caf0: 2066 6f72 206c 696e 6573 2069 6e20 7472   for lines in tr
-0008cb00: 5f6c 696e 6573 5f6c 7374 3a0a 2020 2020  _lines_lst:.    
-0008cb10: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-0008cb20: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0008cb30: 2020 2020 2020 636e 7420 3d20 5b30 2c30        cnt = [0,0
-0008cb40: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0008cb50: 2020 666f 7220 6774 666c 696e 6520 696e    for gtfline in
-0008cb60: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
-0008cb70: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-0008cb80: 7466 6c69 6e65 2e66 6561 7475 7265 203d  tfline.feature =
-0008cb90: 3d20 2773 7461 7274 5f63 6f64 6f6e 273a  = 'start_codon':
-0008cba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008cbb0: 2020 2020 2020 2020 2063 6e74 5b30 5d20           cnt[0] 
-0008cbc0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-0008cbd0: 2020 2020 2020 2020 2069 6620 6774 666c           if gtfl
-0008cbe0: 696e 652e 6665 6174 7572 6520 3d3d 2027  ine.feature == '
-0008cbf0: 7374 6f70 5f63 6f64 6f6e 273a 0a20 2020  stop_codon':.   
-0008cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cc10: 2020 2020 2063 6e74 5b31 5d20 2b3d 2031       cnt[1] += 1
-0008cc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008cc30: 2020 2020 2069 6620 2863 6e74 5b30 5d20       if (cnt[0] 
-0008cc40: 3e20 3029 2026 2028 636e 745b 315d 203e  > 0) & (cnt[1] >
-0008cc50: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
-0008cc60: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-0008cc70: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0008cc80: 2020 2020 2020 2020 2020 2020 2020 6363                cc
-0008cc90: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008ccb0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0008ccc0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0008ccd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0008cce0: 6620 623a 206c 696e 6573 5f6e 6577 203d  f b: lines_new =
-0008ccf0: 206c 696e 6573 5f6e 6577 202b 206c 696e   lines_new + lin
-0008cd00: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0008cd10: 2020 2067 636e 7420 2b3d 2031 0a20 2020     gcnt += 1.   
-0008cd20: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0008cd30: 2020 2020 2020 6966 206c 656e 286c 696e        if len(lin
-0008cd40: 6573 5f6e 6577 2920 3e20 303a 0a20 2020  es_new) > 0:.   
-0008cd50: 2020 2020 2020 2020 2020 2020 2067 7466               gtf
-0008cd60: 5f6c 696e 6573 5f6c 7374 5f6e 6577 2e61  _lines_lst_new.a
-0008cd70: 7070 656e 6428 6c69 6e65 735f 6e65 7729  ppend(lines_new)
-0008cd80: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0008cd90: 2020 2020 2020 6966 206b 2531 3030 203d        if k%100 =
-0008cda0: 3d20 303a 2070 7269 6e74 2827 5c72 7061  = 0: print('\rpa
-0008cdb0: 7273 696e 6720 2e2e 2025 692f 2569 2028  rsing .. %i/%i (
-0008cdc0: 2569 2f25 6929 2720 2520 286b 2c20 6c65  %i/%i)' % (k, le
-0008cdd0: 6e28 6774 665f 6c69 6e65 735f 6c73 7429  n(gtf_lines_lst)
-0008cde0: 2c20 6363 6e74 2c20 6763 6e74 292c 2065  , ccnt, gcnt), e
-0008cdf0: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
-0008ce00: 7275 6520 290a 0a20 2020 2070 7269 6e74  rue )..    print
-0008ce10: 2827 5c72 7061 7273 696e 6720 2e2e 2025  ('\rparsing .. %
-0008ce20: 692f 2569 2028 2569 2f25 6929 2720 2520  i/%i (%i/%i)' % 
-0008ce30: 286b 2c20 6c65 6e28 6774 665f 6c69 6e65  (k, len(gtf_line
-0008ce40: 735f 6c73 7429 2c20 6363 6e74 2c20 6763  s_lst), ccnt, gc
-0008ce50: 6e74 292c 2066 6c75 7368 203d 2054 7275  nt), flush = Tru
-0008ce60: 6520 290a 2020 2020 7072 696e 7428 2753  e ).    print('S
-0008ce70: 6f72 7469 6e67 202e 2e20 272c 2065 6e64  orting .. ', end
-0008ce80: 3d27 2729 0a20 2020 2067 7466 5f6c 696e  ='').    gtf_lin
-0008ce90: 6573 5f6c 7374 5f6e 6577 203d 2073 6f72  es_lst_new = sor
-0008cea0: 745f 6774 665f 6c69 6e65 735f 6c73 7428  t_gtf_lines_lst(
-0008ceb0: 6774 665f 6c69 6e65 735f 6c73 745f 6e65  gtf_lines_lst_ne
-0008cec0: 7729 0a20 2020 2070 7269 6e74 2827 5c72  w).    print('\r
-0008ced0: 536f 7274 696e 6720 2e2e 2064 6f6e 6527  Sorting .. done'
-0008cee0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
-0008cef0: 2020 2067 7466 5f6c 696e 6573 5f6e 6577     gtf_lines_new
-0008cf00: 203d 205b 5d0a 2020 2020 666f 7220 6c69   = [].    for li
-0008cf10: 6e65 7320 696e 2067 7466 5f6c 696e 6573  nes in gtf_lines
-0008cf20: 5f6c 7374 5f6e 6577 3a0a 2020 2020 2020  _lst_new:.      
-0008cf30: 2020 6774 665f 6c69 6e65 735f 6e65 7720    gtf_lines_new 
-0008cf40: 3d20 6774 665f 6c69 6e65 735f 6e65 7720  = gtf_lines_new 
-0008cf50: 2b20 6c69 6e65 730a 2020 2020 2020 2020  + lines.        
-0008cf60: 0a20 2020 2066 6e61 6d65 203d 2066 6e61  .    fname = fna
-0008cf70: 6d65 202b 2027 5f63 6473 2e67 7466 270a  me + '_cds.gtf'.
-0008cf80: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
-0008cf90: 6720 2e2e 2027 2c20 656e 643d 2727 290a  g .. ', end='').
-0008cfa0: 2020 2020 7361 7665 5f67 7466 2820 666e      save_gtf( fn
-0008cfb0: 616d 652c 2067 7466 5f6c 696e 6573 5f6e  ame, gtf_lines_n
-0008cfc0: 6577 2c20 6864 725f 6c69 6e65 7320 290a  ew, hdr_lines ).
-0008cfd0: 2020 2020 7072 696e 7428 275c 7253 6176      print('\rSav
-0008cfe0: 696e 6720 2e2e 2064 6f6e 6527 290a 2020  ing .. done').  
-0008cff0: 2020 0a20 2020 2072 6574 7572 6e20 666e    .    return fn
-0008d000: 616d 650a 2020 2020 0a0a 6465 6620 7365  ame.    ..def se
-0008d010: 6c65 6374 5f63 6872 5f66 726f 6d5f 6774  lect_chr_from_gt
-0008d020: 665f 6669 6c65 2867 7466 5f66 696c 652c  f_file(gtf_file,
-0008d030: 2063 6872 6d73 203d 205b 5d29 3a0a 0a20   chrms = []):.. 
-0008d040: 2020 2066 6e73 203d 2067 7466 5f66 696c     fns = gtf_fil
-0008d050: 652e 7370 6c69 7428 272e 2729 5b3a 2d31  e.split('.')[:-1
-0008d060: 5d0a 2020 2020 666e 616d 6520 3d20 2727  ].    fname = ''
-0008d070: 0a20 2020 2066 6f72 206b 2c20 666e 2069  .    for k, fn i
-0008d080: 6e20 656e 756d 6572 6174 6528 666e 7329  n enumerate(fns)
-0008d090: 3a0a 2020 2020 2020 2020 6966 206b 203e  :.        if k >
-0008d0a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0008d0b0: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
-0008d0c0: 272e 270a 2020 2020 2020 2020 666e 616d  '.'.        fnam
-0008d0d0: 6520 3d20 666e 616d 6520 2b20 666e 0a20  e = fname + fn. 
-0008d0e0: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
-0008d0f0: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
-0008d100: 6f61 645f 6774 6628 6774 665f 6669 6c65  oad_gtf(gtf_file
-0008d110: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
-0008d120: 290a 2020 2020 0a20 2020 2067 7466 5f6c  ).    .    gtf_l
-0008d130: 696e 6573 5f6c 7374 203d 2070 6172 7365  ines_lst = parse
-0008d140: 5f67 7466 5f6c 696e 6573 5f61 6e64 5f73  _gtf_lines_and_s
-0008d150: 706c 6974 5f69 6e74 6f5f 6765 6e65 7328  plit_into_genes(
-0008d160: 2067 7466 5f6c 696e 6573 2029 0a0a 2020   gtf_lines )..  
-0008d170: 2020 6774 665f 6c69 6e65 735f 6c73 745f    gtf_lines_lst_
-0008d180: 6e65 7720 3d20 5b5d 0a20 2020 2063 636e  new = [].    ccn
-0008d190: 7420 3d20 300a 2020 2020 6763 6e74 203d  t = 0.    gcnt =
-0008d1a0: 2030 0a20 2020 2069 6620 6973 696e 7374   0.    if isinst
-0008d1b0: 616e 6365 2863 6872 6d73 2c20 7374 7229  ance(chrms, str)
-0008d1c0: 3a0a 2020 2020 2020 2020 666f 7220 6b2c  :.        for k,
-0008d1d0: 206c 696e 6573 2069 6e20 656e 756d 6572   lines in enumer
-0008d1e0: 6174 6528 6774 665f 6c69 6e65 735f 6c73  ate(gtf_lines_ls
-0008d1f0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0008d200: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
-0008d210: 2020 2020 2020 6966 206c 696e 6573 5b30        if lines[0
-0008d220: 5d2e 6368 7220 3d3d 2063 6872 6d3a 200a  ].chr == chrm: .
-0008d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d240: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
-0008d250: 2020 2020 2020 2020 2063 636e 7420 2b3d           ccnt +=
-0008d260: 2031 0a20 2020 2020 2020 2020 2020 2067   1.            g
-0008d270: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
-0008d280: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0008d290: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
-0008d2a0: 2070 7269 6e74 2827 5c72 7061 7273 696e   print('\rparsin
-0008d2b0: 6720 2e2e 2025 692f 2569 2028 2569 2f25  g .. %i/%i (%i/%
-0008d2c0: 6929 2720 2520 286b 2c20 6c65 6e28 6774  i)' % (k, len(gt
-0008d2d0: 665f 6c69 6e65 735f 6c73 7429 2c20 6363  f_lines_lst), cc
-0008d2e0: 6e74 2c20 6763 6e74 292c 2065 6e64 3d27  nt, gcnt), end='
-0008d2f0: 272c 2066 6c75 7368 203d 2054 7275 6520  ', flush = True 
-0008d300: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0008d310: 2062 3a20 0a20 2020 2020 2020 2020 2020   b: .           
-0008d320: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
-0008d330: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
-0008d340: 6e65 7329 0a20 2020 2065 6c73 653a 0a20  nes).    else:. 
-0008d350: 2020 2020 2020 2066 6f72 2063 6872 6d20         for chrm 
-0008d360: 696e 2063 6872 6d73 3a0a 2020 2020 2020  in chrms:.      
-0008d370: 2020 2020 2020 666f 7220 6b2c 206c 696e        for k, lin
-0008d380: 6573 2069 6e20 656e 756d 6572 6174 6528  es in enumerate(
-0008d390: 6774 665f 6c69 6e65 735f 6c73 7429 3a0a  gtf_lines_lst):.
-0008d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d3b0: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
-0008d3c0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
-0008d3d0: 6573 5b30 5d2e 6368 7220 3d3d 2063 6872  es[0].chr == chr
-0008d3e0: 6d3a 200a 2020 2020 2020 2020 2020 2020  m: .            
-0008d3f0: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
-0008d400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d410: 2020 2020 2063 636e 7420 2b3d 2031 0a20       ccnt += 1. 
-0008d420: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0008d430: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
-0008d440: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0008d450: 2020 2020 2020 2020 2020 6966 206b 2531            if k%1
-0008d460: 3030 203d 3d20 303a 2070 7269 6e74 2827  00 == 0: print('
-0008d470: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
-0008d480: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
-0008d490: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
-0008d4a0: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
-0008d4b0: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
-0008d4c0: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
-0008d4d0: 2020 2020 2020 2020 2020 6966 2062 3a20            if b: 
-0008d4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d4f0: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
-0008d500: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
-0008d510: 6e65 7329 0a20 2020 2020 2020 2063 6872  nes).        chr
-0008d520: 6d20 3d20 6368 726d 735b 305d 0a20 2020  m = chrms[0].   
-0008d530: 2020 2020 2066 6f72 2063 2069 6e20 6368       for c in ch
-0008d540: 726d 735b 313a 5d3a 0a20 2020 2020 2020  rms[1:]:.       
-0008d550: 2020 2020 2063 6872 6d20 3d20 6368 726d       chrm = chrm
-0008d560: 202b 2027 2c25 7327 2025 2063 0a20 2020   + ',%s' % c.   
-0008d570: 2020 2020 2020 2020 200a 2020 2020 7072           .    pr
-0008d580: 696e 7428 275c 7270 6172 7369 6e67 202e  int('\rparsing .
-0008d590: 2e20 646f 6e65 2025 692f 2569 2028 2569  . done %i/%i (%i
-0008d5a0: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
-0008d5b0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
-0008d5c0: 6363 6e74 2c20 6763 6e74 292c 2066 6c75  ccnt, gcnt), flu
-0008d5d0: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
-0008d5e0: 0a20 2020 2070 7269 6e74 2827 536f 7274  .    print('Sort
-0008d5f0: 696e 6720 2e2e 2027 2c20 656e 643d 2727  ing .. ', end=''
-0008d600: 290a 2020 2020 6774 665f 6c69 6e65 735f  ).    gtf_lines_
-0008d610: 6c73 745f 6e65 7720 3d20 736f 7274 5f67  lst_new = sort_g
-0008d620: 7466 5f6c 696e 6573 5f6c 7374 2867 7466  tf_lines_lst(gtf
-0008d630: 5f6c 696e 6573 5f6c 7374 5f6e 6577 290a  _lines_lst_new).
-0008d640: 2020 2020 7072 696e 7428 275c 7253 6f72      print('\rSor
-0008d650: 7469 6e67 202e 2e20 646f 6e65 2729 0a20  ting .. done'). 
-0008d660: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0008d670: 6774 665f 6c69 6e65 735f 6e65 7720 3d20  gtf_lines_new = 
-0008d680: 5b5d 0a20 2020 2066 6f72 206c 696e 6573  [].    for lines
-0008d690: 2069 6e20 6774 665f 6c69 6e65 735f 6c73   in gtf_lines_ls
-0008d6a0: 745f 6e65 773a 0a20 2020 2020 2020 2067  t_new:.        g
-0008d6b0: 7466 5f6c 696e 6573 5f6e 6577 203d 2067  tf_lines_new = g
-0008d6c0: 7466 5f6c 696e 6573 5f6e 6577 202b 206c  tf_lines_new + l
-0008d6d0: 696e 6573 0a20 2020 200a 2020 2020 7072  ines.    .    pr
-0008d6e0: 696e 7428 2753 6176 696e 6720 2e2e 2027  int('Saving .. '
-0008d6f0: 2c20 656e 643d 2727 290a 2020 2020 666e  , end='').    fn
-0008d700: 616d 6520 3d20 666e 616d 6520 2b20 275f  ame = fname + '_
-0008d710: 7365 6c5f 2573 2e67 7466 2720 2520 6368  sel_%s.gtf' % ch
-0008d720: 726d 0a20 2020 2073 6176 655f 6774 6628  rm.    save_gtf(
-0008d730: 2066 6e61 6d65 2c20 6774 665f 6c69 6e65   fname, gtf_line
-0008d740: 735f 6e65 772c 2068 6472 5f6c 696e 6573  s_new, hdr_lines
-0008d750: 2029 0a20 2020 2070 7269 6e74 2827 5c72   ).    print('\r
-0008d760: 5361 7669 6e67 202e 2e20 646f 6e65 2729  Saving .. done')
-0008d770: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
-0008d780: 2066 6e61 6d65 0a20 2020 200a 0a23 2323   fname.    ..###
-0008d790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c5a0: 2323 230a 0a64 6566 2073 6f72 745f 6774  ###..def sort_gt
+0008c5b0: 665f 6c69 6e65 735f 6c73 7428 6774 665f  f_lines_lst(gtf_
+0008c5c0: 6c69 6e65 735f 6c73 7429 3a0a 2020 2020  lines_lst):.    
+0008c5d0: 0a20 2020 2063 6872 7320 3d20 5b5d 0a20  .    chrs = []. 
+0008c5e0: 2020 2066 6f72 206c 696e 6573 2069 6e20     for lines in 
+0008c5f0: 6774 665f 6c69 6e65 735f 6c73 743a 0a20  gtf_lines_lst:. 
+0008c600: 2020 2020 2020 2066 6972 7374 5f6c 696e         first_lin
+0008c610: 6520 3d20 6c69 6e65 735b 305d 0a20 2020  e = lines[0].   
+0008c620: 2020 2020 2063 6872 732e 6170 7065 6e64       chrs.append
+0008c630: 2866 6972 7374 5f6c 696e 652e 6368 7229  (first_line.chr)
+0008c640: 0a0a 2020 2020 6368 725f 7365 7420 3d20  ..    chr_set = 
+0008c650: 6c69 7374 2873 6574 2863 6872 7329 290a  list(set(chrs)).
+0008c660: 2020 2020 6368 725f 7365 742e 736f 7274      chr_set.sort
+0008c670: 2829 0a20 2020 2063 6872 7320 3d20 6e70  ().    chrs = np
+0008c680: 2e61 7272 6179 2863 6872 7329 0a0a 2020  .array(chrs)..  
+0008c690: 2020 6774 665f 6c73 745f 6e65 7720 3d20    gtf_lst_new = 
+0008c6a0: 5b5d 0a20 2020 2066 6f72 2063 2069 6e20  [].    for c in 
+0008c6b0: 6368 725f 7365 743a 0a20 2020 2020 2020  chr_set:.       
+0008c6c0: 2077 6820 3d20 7768 6963 6828 6368 7273   wh = which(chrs
+0008c6d0: 203d 3d20 6329 0a20 2020 2020 2020 2070   == c).        p
+0008c6e0: 7320 3d20 6e70 2e61 7272 6179 2820 5b67  s = np.array( [g
+0008c6f0: 7466 5f6c 696e 6573 5f6c 7374 5b77 5d5b  tf_lines_lst[w][
+0008c700: 305d 2e73 7461 7274 2066 6f72 2077 2069  0].start for w i
+0008c710: 6e20 7768 5d20 290a 2020 2020 2020 2020  n wh] ).        
+0008c720: 6f64 7232 203d 2070 732e 6172 6773 6f72  odr2 = ps.argsor
+0008c730: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
+0008c740: 6f20 696e 206f 6472 323a 0a20 2020 2020  o in odr2:.     
+0008c750: 2020 2020 2020 2077 203d 2077 685b 6f5d         w = wh[o]
+0008c760: 0a20 2020 2020 2020 2020 2020 2067 7466  .            gtf
+0008c770: 5f6c 7374 5f6e 6577 2e61 7070 656e 6428  _lst_new.append(
+0008c780: 6774 665f 6c69 6e65 735f 6c73 745b 775d  gtf_lines_lst[w]
+0008c790: 290a 2020 2020 2020 2020 0a20 2020 2072  ).        .    r
+0008c7a0: 6574 7572 6e20 6774 665f 6c73 745f 6e65  eturn gtf_lst_ne
+0008c7b0: 770a 0a0a 6465 6620 7365 6c65 6374 5f63  w...def select_c
+0008c7c0: 6f64 696e 675f 6765 6e65 735f 6672 6f6d  oding_genes_from
+0008c7d0: 5f67 7466 5f66 696c 6528 6774 665f 6669  _gtf_file(gtf_fi
+0008c7e0: 6c65 2c20 6765 6e6f 6d65 5f66 696c 6529  le, genome_file)
+0008c7f0: 3a0a 0a20 2020 2066 6e73 203d 2067 7466  :..    fns = gtf
+0008c800: 5f66 696c 652e 7370 6c69 7428 272e 2729  _file.split('.')
+0008c810: 5b3a 2d31 5d0a 2020 2020 666e 616d 6520  [:-1].    fname 
+0008c820: 3d20 2727 0a20 2020 2066 6f72 206b 2c20  = ''.    for k, 
+0008c830: 666e 2069 6e20 656e 756d 6572 6174 6528  fn in enumerate(
+0008c840: 666e 7329 3a0a 2020 2020 2020 2020 6966  fns):.        if
+0008c850: 206b 203e 2030 3a0a 2020 2020 2020 2020   k > 0:.        
+0008c860: 2020 2020 666e 616d 6520 3d20 666e 616d      fname = fnam
+0008c870: 6520 2b20 272e 270a 2020 2020 2020 2020  e + '.'.        
+0008c880: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
+0008c890: 666e 0a20 2020 200a 2020 2020 6774 665f  fn.    .    gtf_
+0008c8a0: 6c69 6e65 732c 2068 6472 5f6c 696e 6573  lines, hdr_lines
+0008c8b0: 203d 206c 6f61 645f 6774 6628 6774 665f   = load_gtf(gtf_
+0008c8c0: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
+0008c8d0: 5472 7565 290a 2020 2020 0a20 2020 2062  True).    .    b
+0008c8e0: 6173 655f 6364 7320 3d20 6765 745f 6261  ase_cds = get_ba
+0008c8f0: 7365 5f63 6473 5f66 726f 6d5f 6774 665f  se_cds_from_gtf_
+0008c900: 6c69 6e65 7328 6774 665f 6c69 6e65 7329  lines(gtf_lines)
+0008c910: 0a20 2020 2069 6620 6261 7365 5f63 6473  .    if base_cds
+0008c920: 203c 2030 3a0a 2020 2020 2020 2020 7072   < 0:.        pr
+0008c930: 696e 7428 2749 4e46 4f3a 204e 6f20 636f  int('INFO: No co
+0008c940: 6469 6e67 2069 6e66 6f72 6d61 7469 6f6e  ding information
+0008c950: 2070 726f 7669 6465 6420 696e 2074 6865   provided in the
+0008c960: 2047 5446 2f47 4646 2e27 290a 2020 2020   GTF/GFF.').    
+0008c970: 0a20 2020 2067 7466 5f6c 696e 6573 5f6c  .    gtf_lines_l
+0008c980: 7374 203d 2070 6172 7365 5f67 7466 5f6c  st = parse_gtf_l
+0008c990: 696e 6573 5f61 6e64 5f73 706c 6974 5f69  ines_and_split_i
+0008c9a0: 6e74 6f5f 6765 6e65 7328 2067 7466 5f6c  nto_genes( gtf_l
+0008c9b0: 696e 6573 2029 0a20 2020 2067 656e 6f6d  ines ).    genom
+0008c9c0: 6520 3d20 6c6f 6164 5f67 656e 6f6d 6528  e = load_genome(
+0008c9d0: 6765 6e6f 6d65 5f66 696c 6529 0a20 2020  genome_file).   
+0008c9e0: 2063 6872 7320 3d20 6765 6e6f 6d65 2e6b   chrs = genome.k
+0008c9f0: 6579 7328 290a 0a20 2020 2067 7466 5f6c  eys()..    gtf_l
+0008ca00: 696e 6573 5f6c 7374 5f6e 6577 203d 205b  ines_lst_new = [
+0008ca10: 5d0a 2020 2020 6363 6e74 203d 2030 0a20  ].    ccnt = 0. 
+0008ca20: 2020 2067 636e 7420 3d20 300a 2020 2020     gcnt = 0.    
+0008ca30: 666f 7220 6b2c 2067 6c69 6e65 7320 696e  for k, glines in
+0008ca40: 2065 6e75 6d65 7261 7465 2867 7466 5f6c   enumerate(gtf_l
+0008ca50: 696e 6573 5f6c 7374 293a 0a0a 2020 2020  ines_lst):..    
+0008ca60: 2020 2020 6966 2020 676c 696e 6573 5b30      if  glines[0
+0008ca70: 5d2e 6368 7220 696e 2063 6872 733a 0a20  ].chr in chrs:. 
+0008ca80: 2020 2020 2020 2020 2020 2074 725f 6c69             tr_li
+0008ca90: 6e65 735f 6c73 7420 3d20 7061 7273 655f  nes_lst = parse_
+0008caa0: 6774 665f 6c69 6e65 735f 616e 645f 7370  gtf_lines_and_sp
+0008cab0: 6c69 745f 696e 746f 5f67 656e 6573 2820  lit_into_genes( 
+0008cac0: 676c 696e 6573 2c20 2774 7261 6e73 6372  glines, 'transcr
+0008cad0: 6970 7427 2029 0a20 2020 2020 2020 2020  ipt' ).         
+0008cae0: 2020 206c 696e 6573 5f6e 6577 203d 205b     lines_new = [
+0008caf0: 5d0a 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+0008cb00: 6f72 206c 696e 6573 2069 6e20 7472 5f6c  or lines in tr_l
+0008cb10: 696e 6573 5f6c 7374 3a0a 2020 2020 2020  ines_lst:.      
+0008cb20: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
+0008cb30: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0008cb40: 2020 2020 636e 7420 3d20 5b30 2c30 5d0a      cnt = [0,0].
+0008cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cb60: 666f 7220 6774 666c 696e 6520 696e 206c  for gtfline in l
+0008cb70: 696e 6573 3a0a 2020 2020 2020 2020 2020  ines:.          
+0008cb80: 2020 2020 2020 2020 2020 6966 2067 7466            if gtf
+0008cb90: 6c69 6e65 2e66 6561 7475 7265 203d 3d20  line.feature == 
+0008cba0: 2773 7461 7274 5f63 6f64 6f6e 273a 0a20  'start_codon':. 
+0008cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cbc0: 2020 2020 2020 2063 6e74 5b30 5d20 2b3d         cnt[0] +=
+0008cbd0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0008cbe0: 2020 2020 2020 2069 6620 6774 666c 696e         if gtflin
+0008cbf0: 652e 6665 6174 7572 6520 3d3d 2027 7374  e.feature == 'st
+0008cc00: 6f70 5f63 6f64 6f6e 273a 0a20 2020 2020  op_codon':.     
+0008cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cc20: 2020 2063 6e74 5b31 5d20 2b3d 2031 0a20     cnt[1] += 1. 
+0008cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cc40: 2020 2069 6620 2863 6e74 5b30 5d20 3e20     if (cnt[0] > 
+0008cc50: 3029 2026 2028 636e 745b 315d 203e 2030  0) & (cnt[1] > 0
+0008cc60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0008cc70: 2020 2020 2020 2020 2020 2062 203d 2054             b = T
+0008cc80: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0008cc90: 2020 2020 2020 2020 2020 2020 6363 6e74              ccnt
+0008cca0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0008ccb0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0008ccc0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0008ccd0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0008cce0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0008ccf0: 623a 206c 696e 6573 5f6e 6577 203d 206c  b: lines_new = l
+0008cd00: 696e 6573 5f6e 6577 202b 206c 696e 6573  ines_new + lines
+0008cd10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008cd20: 2067 636e 7420 2b3d 2031 0a20 2020 2020   gcnt += 1.     
+0008cd30: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0008cd40: 2020 2020 6966 206c 656e 286c 696e 6573      if len(lines
+0008cd50: 5f6e 6577 2920 3e20 303a 0a20 2020 2020  _new) > 0:.     
+0008cd60: 2020 2020 2020 2020 2020 2067 7466 5f6c             gtf_l
+0008cd70: 696e 6573 5f6c 7374 5f6e 6577 2e61 7070  ines_lst_new.app
+0008cd80: 656e 6428 6c69 6e65 735f 6e65 7729 0a20  end(lines_new). 
+0008cd90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0008cda0: 2020 2020 6966 206b 2531 3030 203d 3d20      if k%100 == 
+0008cdb0: 303a 2070 7269 6e74 2827 5c72 7061 7273  0: print('\rpars
+0008cdc0: 696e 6720 2e2e 2025 692f 2569 2028 2569  ing .. %i/%i (%i
+0008cdd0: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
+0008cde0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
+0008cdf0: 6363 6e74 2c20 6763 6e74 292c 2065 6e64  ccnt, gcnt), end
+0008ce00: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
+0008ce10: 6520 290a 0a20 2020 2070 7269 6e74 2827  e )..    print('
+0008ce20: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
+0008ce30: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
+0008ce40: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
+0008ce50: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
+0008ce60: 292c 2066 6c75 7368 203d 2054 7275 6520  ), flush = True 
+0008ce70: 290a 2020 2020 7072 696e 7428 2753 6f72  ).    print('Sor
+0008ce80: 7469 6e67 202e 2e20 272c 2065 6e64 3d27  ting .. ', end='
+0008ce90: 2729 0a20 2020 2067 7466 5f6c 696e 6573  ').    gtf_lines
+0008cea0: 5f6c 7374 5f6e 6577 203d 2073 6f72 745f  _lst_new = sort_
+0008ceb0: 6774 665f 6c69 6e65 735f 6c73 7428 6774  gtf_lines_lst(gt
+0008cec0: 665f 6c69 6e65 735f 6c73 745f 6e65 7729  f_lines_lst_new)
+0008ced0: 0a20 2020 2070 7269 6e74 2827 5c72 536f  .    print('\rSo
+0008cee0: 7274 696e 6720 2e2e 2064 6f6e 6527 290a  rting .. done').
+0008cef0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0008cf00: 2067 7466 5f6c 696e 6573 5f6e 6577 203d   gtf_lines_new =
+0008cf10: 205b 5d0a 2020 2020 666f 7220 6c69 6e65   [].    for line
+0008cf20: 7320 696e 2067 7466 5f6c 696e 6573 5f6c  s in gtf_lines_l
+0008cf30: 7374 5f6e 6577 3a0a 2020 2020 2020 2020  st_new:.        
+0008cf40: 6774 665f 6c69 6e65 735f 6e65 7720 3d20  gtf_lines_new = 
+0008cf50: 6774 665f 6c69 6e65 735f 6e65 7720 2b20  gtf_lines_new + 
+0008cf60: 6c69 6e65 730a 2020 2020 2020 2020 0a20  lines.        . 
+0008cf70: 2020 2066 6e61 6d65 203d 2066 6e61 6d65     fname = fname
+0008cf80: 202b 2027 5f63 6473 2e67 7466 270a 2020   + '_cds.gtf'.  
+0008cf90: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
+0008cfa0: 2e2e 2027 2c20 656e 643d 2727 290a 2020  .. ', end='').  
+0008cfb0: 2020 7361 7665 5f67 7466 2820 666e 616d    save_gtf( fnam
+0008cfc0: 652c 2067 7466 5f6c 696e 6573 5f6e 6577  e, gtf_lines_new
+0008cfd0: 2c20 6864 725f 6c69 6e65 7320 290a 2020  , hdr_lines ).  
+0008cfe0: 2020 7072 696e 7428 275c 7253 6176 696e    print('\rSavin
+0008cff0: 6720 2e2e 2064 6f6e 6527 290a 2020 2020  g .. done').    
+0008d000: 0a20 2020 2072 6574 7572 6e20 666e 616d  .    return fnam
+0008d010: 650a 2020 2020 0a0a 6465 6620 7365 6c65  e.    ..def sele
+0008d020: 6374 5f63 6872 5f66 726f 6d5f 6774 665f  ct_chr_from_gtf_
+0008d030: 6669 6c65 2867 7466 5f66 696c 652c 2063  file(gtf_file, c
+0008d040: 6872 6d73 203d 205b 5d29 3a0a 0a20 2020  hrms = []):..   
+0008d050: 2066 6e73 203d 2067 7466 5f66 696c 652e   fns = gtf_file.
+0008d060: 7370 6c69 7428 272e 2729 5b3a 2d31 5d0a  split('.')[:-1].
+0008d070: 2020 2020 666e 616d 6520 3d20 2727 0a20      fname = ''. 
+0008d080: 2020 2066 6f72 206b 2c20 666e 2069 6e20     for k, fn in 
+0008d090: 656e 756d 6572 6174 6528 666e 7329 3a0a  enumerate(fns):.
+0008d0a0: 2020 2020 2020 2020 6966 206b 203e 2030          if k > 0
+0008d0b0: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
+0008d0c0: 616d 6520 3d20 666e 616d 6520 2b20 272e  ame = fname + '.
+0008d0d0: 270a 2020 2020 2020 2020 666e 616d 6520  '.        fname 
+0008d0e0: 3d20 666e 616d 6520 2b20 666e 0a20 2020  = fname + fn.   
+0008d0f0: 200a 2020 2020 6774 665f 6c69 6e65 732c   .    gtf_lines,
+0008d100: 2068 6472 5f6c 696e 6573 203d 206c 6f61   hdr_lines = loa
+0008d110: 645f 6774 6628 6774 665f 6669 6c65 2c20  d_gtf(gtf_file, 
+0008d120: 7665 7262 6f73 6520 3d20 5472 7565 290a  verbose = True).
+0008d130: 2020 2020 0a20 2020 2067 7466 5f6c 696e      .    gtf_lin
+0008d140: 6573 5f6c 7374 203d 2070 6172 7365 5f67  es_lst = parse_g
+0008d150: 7466 5f6c 696e 6573 5f61 6e64 5f73 706c  tf_lines_and_spl
+0008d160: 6974 5f69 6e74 6f5f 6765 6e65 7328 2067  it_into_genes( g
+0008d170: 7466 5f6c 696e 6573 2029 0a0a 2020 2020  tf_lines )..    
+0008d180: 6774 665f 6c69 6e65 735f 6c73 745f 6e65  gtf_lines_lst_ne
+0008d190: 7720 3d20 5b5d 0a20 2020 2063 636e 7420  w = [].    ccnt 
+0008d1a0: 3d20 300a 2020 2020 6763 6e74 203d 2030  = 0.    gcnt = 0
+0008d1b0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+0008d1c0: 6365 2863 6872 6d73 2c20 7374 7229 3a0a  ce(chrms, str):.
+0008d1d0: 2020 2020 2020 2020 666f 7220 6b2c 206c          for k, l
+0008d1e0: 696e 6573 2069 6e20 656e 756d 6572 6174  ines in enumerat
+0008d1f0: 6528 6774 665f 6c69 6e65 735f 6c73 7429  e(gtf_lines_lst)
+0008d200: 3a0a 2020 2020 2020 2020 2020 2020 6220  :.            b 
+0008d210: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0008d220: 2020 2020 6966 206c 696e 6573 5b30 5d2e      if lines[0].
+0008d230: 6368 7220 3d3d 2063 6872 6d3a 200a 2020  chr == chrm: .  
+0008d240: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+0008d250: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0008d260: 2020 2020 2020 2063 636e 7420 2b3d 2031         ccnt += 1
+0008d270: 0a20 2020 2020 2020 2020 2020 2067 636e  .            gcn
+0008d280: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
+0008d290: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0008d2a0: 6966 206b 2531 3030 203d 3d20 303a 2070  if k%100 == 0: p
+0008d2b0: 7269 6e74 2827 5c72 7061 7273 696e 6720  rint('\rparsing 
+0008d2c0: 2e2e 2025 692f 2569 2028 2569 2f25 6929  .. %i/%i (%i/%i)
+0008d2d0: 2720 2520 286b 2c20 6c65 6e28 6774 665f  ' % (k, len(gtf_
+0008d2e0: 6c69 6e65 735f 6c73 7429 2c20 6363 6e74  lines_lst), ccnt
+0008d2f0: 2c20 6763 6e74 292c 2065 6e64 3d27 272c  , gcnt), end='',
+0008d300: 2066 6c75 7368 203d 2054 7275 6520 290a   flush = True ).
+0008d310: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+0008d320: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0008d330: 2020 2067 7466 5f6c 696e 6573 5f6c 7374     gtf_lines_lst
+0008d340: 5f6e 6577 2e61 7070 656e 6428 6c69 6e65  _new.append(line
+0008d350: 7329 0a20 2020 2065 6c73 653a 0a20 2020  s).    else:.   
+0008d360: 2020 2020 2066 6f72 2063 6872 6d20 696e       for chrm in
+0008d370: 2063 6872 6d73 3a0a 2020 2020 2020 2020   chrms:.        
+0008d380: 2020 2020 666f 7220 6b2c 206c 696e 6573      for k, lines
+0008d390: 2069 6e20 656e 756d 6572 6174 6528 6774   in enumerate(gt
+0008d3a0: 665f 6c69 6e65 735f 6c73 7429 3a0a 2020  f_lines_lst):.  
+0008d3b0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+0008d3c0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0008d3d0: 2020 2020 2020 2020 6966 206c 696e 6573          if lines
+0008d3e0: 5b30 5d2e 6368 7220 3d3d 2063 6872 6d3a  [0].chr == chrm:
+0008d3f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0008d400: 2020 2020 2020 6220 3d20 5472 7565 0a20        b = True. 
+0008d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d420: 2020 2063 636e 7420 2b3d 2031 0a20 2020     ccnt += 1.   
+0008d430: 2020 2020 2020 2020 2020 2020 2067 636e               gcn
+0008d440: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
+0008d450: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0008d460: 2020 2020 2020 2020 6966 206b 2531 3030          if k%100
+0008d470: 203d 3d20 303a 2070 7269 6e74 2827 5c72   == 0: print('\r
+0008d480: 7061 7273 696e 6720 2e2e 2025 692f 2569  parsing .. %i/%i
+0008d490: 2028 2569 2f25 6929 2720 2520 286b 2c20   (%i/%i)' % (k, 
+0008d4a0: 6c65 6e28 6774 665f 6c69 6e65 735f 6c73  len(gtf_lines_ls
+0008d4b0: 7429 2c20 6363 6e74 2c20 6763 6e74 292c  t), ccnt, gcnt),
+0008d4c0: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
+0008d4d0: 2054 7275 6520 290a 2020 2020 2020 2020   True ).        
+0008d4e0: 2020 2020 2020 2020 6966 2062 3a20 0a20          if b: . 
+0008d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d500: 2020 2067 7466 5f6c 696e 6573 5f6c 7374     gtf_lines_lst
+0008d510: 5f6e 6577 2e61 7070 656e 6428 6c69 6e65  _new.append(line
+0008d520: 7329 0a20 2020 2020 2020 2063 6872 6d20  s).        chrm 
+0008d530: 3d20 6368 726d 735b 305d 0a20 2020 2020  = chrms[0].     
+0008d540: 2020 2066 6f72 2063 2069 6e20 6368 726d     for c in chrm
+0008d550: 735b 313a 5d3a 0a20 2020 2020 2020 2020  s[1:]:.         
+0008d560: 2020 2063 6872 6d20 3d20 6368 726d 202b     chrm = chrm +
+0008d570: 2027 2c25 7327 2025 2063 0a20 2020 2020   ',%s' % c.     
+0008d580: 2020 2020 2020 200a 2020 2020 7072 696e         .    prin
+0008d590: 7428 275c 7270 6172 7369 6e67 202e 2e20  t('\rparsing .. 
+0008d5a0: 646f 6e65 2025 692f 2569 2028 2569 2f25  done %i/%i (%i/%
+0008d5b0: 6929 2720 2520 286b 2c20 6c65 6e28 6774  i)' % (k, len(gt
+0008d5c0: 665f 6c69 6e65 735f 6c73 7429 2c20 6363  f_lines_lst), cc
+0008d5d0: 6e74 2c20 6763 6e74 292c 2066 6c75 7368  nt, gcnt), flush
+0008d5e0: 203d 2054 7275 6520 290a 2020 2020 0a20   = True ).    . 
+0008d5f0: 2020 2070 7269 6e74 2827 536f 7274 696e     print('Sortin
+0008d600: 6720 2e2e 2027 2c20 656e 643d 2727 290a  g .. ', end='').
+0008d610: 2020 2020 6774 665f 6c69 6e65 735f 6c73      gtf_lines_ls
+0008d620: 745f 6e65 7720 3d20 736f 7274 5f67 7466  t_new = sort_gtf
+0008d630: 5f6c 696e 6573 5f6c 7374 2867 7466 5f6c  _lines_lst(gtf_l
+0008d640: 696e 6573 5f6c 7374 5f6e 6577 290a 2020  ines_lst_new).  
+0008d650: 2020 7072 696e 7428 275c 7253 6f72 7469    print('\rSorti
+0008d660: 6e67 202e 2e20 646f 6e65 2729 0a20 2020  ng .. done').   
+0008d670: 2020 2020 2020 2020 200a 2020 2020 6774           .    gt
+0008d680: 665f 6c69 6e65 735f 6e65 7720 3d20 5b5d  f_lines_new = []
+0008d690: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
+0008d6a0: 6e20 6774 665f 6c69 6e65 735f 6c73 745f  n gtf_lines_lst_
+0008d6b0: 6e65 773a 0a20 2020 2020 2020 2067 7466  new:.        gtf
+0008d6c0: 5f6c 696e 6573 5f6e 6577 203d 2067 7466  _lines_new = gtf
+0008d6d0: 5f6c 696e 6573 5f6e 6577 202b 206c 696e  _lines_new + lin
+0008d6e0: 6573 0a20 2020 200a 2020 2020 7072 696e  es.    .    prin
+0008d6f0: 7428 2753 6176 696e 6720 2e2e 2027 2c20  t('Saving .. ', 
+0008d700: 656e 643d 2727 290a 2020 2020 666e 616d  end='').    fnam
+0008d710: 6520 3d20 666e 616d 6520 2b20 275f 7365  e = fname + '_se
+0008d720: 6c5f 2573 2e67 7466 2720 2520 6368 726d  l_%s.gtf' % chrm
+0008d730: 0a20 2020 2073 6176 655f 6774 6628 2066  .    save_gtf( f
+0008d740: 6e61 6d65 2c20 6774 665f 6c69 6e65 735f  name, gtf_lines_
+0008d750: 6e65 772c 2068 6472 5f6c 696e 6573 2029  new, hdr_lines )
+0008d760: 0a20 2020 2070 7269 6e74 2827 5c72 5361  .    print('\rSa
+0008d770: 7669 6e67 202e 2e20 646f 6e65 2729 0a20  ving .. done'). 
+0008d780: 2020 200a 2020 2020 7265 7475 726e 2066     .    return f
+0008d790: 6e61 6d65 0a20 2020 200a 0a23 2323 2323  name.    ..#####
 0008d7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008d7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008d7c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7d0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-0008d7e0: 2323 2046 756e 6374 696f 6e73 2074 6f20  ## Functions to 
-0008d7f0: 6861 6e64 6c65 2073 696d 756c 6174 6564  handle simulated
-0008d800: 2072 6561 6473 2028 6164 6420 7472 6172   reads (add trar
-0008d810: 6563 6f20 6865 6164 6572 2c20 7370 6c69  eco header, spli
-0008d820: 7420 6661 7374 5129 0a23 2323 2323 2323  t fastQ).#######
-0008d830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d7d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d7e0: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
+0008d7f0: 2046 756e 6374 696f 6e73 2074 6f20 6861   Functions to ha
+0008d800: 6e64 6c65 2073 696d 756c 6174 6564 2072  ndle simulated r
+0008d810: 6561 6473 2028 6164 6420 7472 6172 6563  eads (add trarec
+0008d820: 6f20 6865 6164 6572 2c20 7370 6c69 7420  o header, split 
+0008d830: 6661 7374 5129 0a23 2323 2323 2323 2323  fastQ).#########
 0008d840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008d850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008d860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d870: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-0008d880: 2066 6173 7461 5f61 6464 5f74 7261 7265   fasta_add_trare
-0008d890: 636f 5f68 6561 6465 7228 2072 6566 5f74  co_header( ref_t
-0008d8a0: 722c 2073 696d 5f70 726f 6669 6c65 2c20  r, sim_profile, 
-0008d8b0: 7265 6164 5f6c 656e 2c20 7375 6666 6978  read_len, suffix
-0008d8c0: 203d 204e 6f6e 652c 2063 6f76 5f74 6820   = None, cov_th 
-0008d8d0: 3d20 302e 3820 293a 0a20 2020 200a 2020  = 0.8 ):.    .  
-0008d8e0: 2020 636f 6c6e 616d 6573 203d 205b 276c    colnames = ['l
-0008d8f0: 6f63 272c 2027 7469 6427 2c20 2763 6f64  oc', 'tid', 'cod
-0008d900: 696e 6727 2c20 276c 656e 6774 6827 2c20  ing', 'length', 
-0008d910: 2765 7870 5f66 7261 6327 2c20 2765 7870  'exp_frac', 'exp
-0008d920: 5f6e 756d 272c 2027 6c69 625f 6672 6163  _num', 'lib_frac
-0008d930: 272c 2027 6c69 625f 6e75 6d27 2c20 5c0a  ', 'lib_num', \.
-0008d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d950: 2773 6571 5f66 7261 6327 2c20 2773 6571  'seq_frac', 'seq
-0008d960: 5f6e 756d 272c 2027 636f 765f 6672 6163  _num', 'cov_frac
-0008d970: 272c 2027 6368 6932 272c 2027 5663 6f65  ', 'chi2', 'Vcoe
-0008d980: 6627 5d0a 2020 2020 6466 5f70 726f 203d  f'].    df_pro =
-0008d990: 2070 642e 7265 6164 5f63 7376 2873 696d   pd.read_csv(sim
-0008d9a0: 5f70 726f 6669 6c65 2c20 7365 703d 275c  _profile, sep='\
-0008d9b0: 7427 2c20 6865 6164 6572 203d 204e 6f6e  t', header = Non
-0008d9c0: 652c 2069 6e64 6578 5f63 6f6c 203d 2031  e, index_col = 1
-0008d9d0: 2c20 6e61 6d65 7320 3d20 636f 6c6e 616d  , names = colnam
-0008d9e0: 6573 290a 0a20 2020 2072 6566 203d 206c  es)..    ref = l
-0008d9f0: 6f61 645f 6661 7374 6128 7265 665f 7472  oad_fasta(ref_tr
-0008da00: 290a 0a20 2020 2064 665f 7072 6f5b 2761  )..    df_pro['a
-0008da10: 626e 275d 203d 2064 665f 7072 6f5b 2773  bn'] = df_pro['s
-0008da20: 6571 5f6e 756d 275d 2a72 6561 645f 6c65  eq_num']*read_le
-0008da30: 6e2f 6466 5f70 726f 5b27 6c65 6e67 7468  n/df_pro['length
-0008da40: 275d 0a20 2020 2064 665f 7072 6f5b 2774  '].    df_pro['t
-0008da50: 706d 275d 203d 2064 665f 7072 6f5b 2761  pm'] = df_pro['a
-0008da60: 626e 275d 2a31 3030 3030 3030 2f28 6466  bn']*1000000/(df
-0008da70: 5f70 726f 5b27 6162 6e27 5d2e 7375 6d28  _pro['abn'].sum(
-0008da80: 2929 0a0a 2020 2020 6466 5f69 6478 203d  ))..    df_idx =
-0008da90: 206e 702e 6172 7261 7928 6466 5f70 726f   np.array(df_pro
-0008daa0: 2e69 6e64 6578 2e76 616c 7565 732e 746f  .index.values.to
-0008dab0: 6c69 7374 2829 290a 2020 2020 636e 745f  list()).    cnt_
-0008dac0: 6475 7020 3d20 300a 2020 2020 666f 7220  dup = 0.    for 
-0008dad0: 6b65 7920 696e 206c 6973 7428 7265 662e  key in list(ref.
-0008dae0: 6b65 7973 2829 293a 0a20 2020 2020 2020  keys()):.       
-0008daf0: 2069 6620 286b 6579 2069 6e20 6466 5f69   if (key in df_i
-0008db00: 6478 2920 2620 286e 702e 7375 6d28 6466  dx) & (np.sum(df
-0008db10: 5f69 6478 203d 3d20 6b65 7929 203d 3d20  _idx == key) == 
-0008db20: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-0008db30: 6966 2064 665f 7072 6f2e 6c6f 635b 6b65  if df_pro.loc[ke
-0008db40: 795d 2e63 6f76 5f66 7261 6320 3e3d 2063  y].cov_frac >= c
-0008db50: 6f76 5f74 683a 0a20 2020 2020 2020 2020  ov_th:.         
-0008db60: 2020 2020 2020 2072 6566 5b6b 6579 5d2e         ref[key].
-0008db70: 6865 6164 6572 203d 2027 2573 2063 6f76  header = '%s cov
-0008db80: 5f66 7261 633a 2566 2061 626e 3a25 6620  _frac:%f abn:%f 
-0008db90: 7470 6d3a 2566 2720 2520 2872 6566 5b6b  tpm:%f' % (ref[k
-0008dba0: 6579 5d2e 6865 6164 6572 2c20 6466 5f70  ey].header, df_p
-0008dbb0: 726f 2e6c 6f63 5b6b 6579 5d2e 636f 765f  ro.loc[key].cov_
-0008dbc0: 6672 6163 2c20 6466 5f70 726f 2e6c 6f63  frac, df_pro.loc
-0008dbd0: 5b6b 6579 5d2e 6162 6e2c 2064 665f 7072  [key].abn, df_pr
-0008dbe0: 6f2e 6c6f 635b 6b65 795d 2e74 706d 290a  o.loc[key].tpm).
-0008dbf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0008dc00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0008dc10: 2020 7265 662e 706f 7028 6b65 7929 0a20    ref.pop(key). 
-0008dc20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0008dc30: 2020 2020 2020 2020 2069 6620 6466 5f70           if df_p
-0008dc40: 726f 2e6c 6f63 5b6b 6579 5d2e 7368 6170  ro.loc[key].shap
-0008dc50: 655b 305d 203e 2031 3a20 636e 745f 6475  e[0] > 1: cnt_du
-0008dc60: 7020 2b3d 2031 0a20 2020 2020 2020 2020  p += 1.         
-0008dc70: 2020 2072 6566 2e70 6f70 286b 6579 290a     ref.pop(key).
-0008dc80: 0a20 2020 2066 6e61 6d65 2c20 6578 7420  .    fname, ext 
-0008dc90: 3d20 6765 745f 6669 6c65 5f6e 616d 6528  = get_file_name(
-0008dca0: 7265 665f 7472 290a 2020 2020 6966 2073  ref_tr).    if s
-0008dcb0: 7566 6669 7820 6973 204e 6f6e 653a 0a20  uffix is None:. 
-0008dcc0: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
-0008dcd0: 6e61 6d65 202b 2027 5f63 6f76 2569 2e27  name + '_cov%i.'
-0008dce0: 2025 2069 6e74 2863 6f76 5f74 682a 3130   % int(cov_th*10
-0008dcf0: 3029 202b 2065 7874 0a20 2020 2065 6c73  0) + ext.    els
-0008dd00: 653a 0a20 2020 2020 2020 2066 6e61 6d65  e:.        fname
-0008dd10: 203d 2066 6e61 6d65 202b 2027 5f25 735f   = fname + '_%s_
-0008dd20: 636f 7625 692e 2720 2520 2873 7566 6669  cov%i.' % (suffi
-0008dd30: 782c 2069 6e74 2863 6f76 5f74 682a 3130  x, int(cov_th*10
-0008dd40: 3029 2920 2b20 6578 740a 0a20 2020 2073  0)) + ext..    s
-0008dd50: 6176 655f 6661 7374 6128 666e 616d 652c  ave_fasta(fname,
-0008dd60: 2072 6566 2c20 7469 746c 6520 3d20 666e   ref, title = fn
-0008dd70: 616d 6529 0a20 2020 200a 0a64 6566 206c  ame).    ..def l
-0008dd80: 6f61 645f 6661 7374 7128 6669 6c65 5f67  oad_fastq(file_g
-0008dd90: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
-0008dda0: 2046 616c 7365 2029 3a0a 0a20 2020 2067   False ):..    g
-0008ddb0: 656e 6f6d 6520 3d20 6469 6374 2829 0a20  enome = dict(). 
-0008ddc0: 2020 2066 203d 206f 7065 6e28 6669 6c65     f = open(file
-0008ddd0: 5f67 656e 6f6d 652c 2027 7227 290a 2020  _genome, 'r').  
-0008dde0: 2020 7363 6e74 203d 2030 0a20 2020 2070    scnt = 0.    p
-0008ddf0: 7269 6e74 2827 5c72 4c6f 6164 696e 6720  rint('\rLoading 
-0008de00: 6661 7374 5120 2e2e 2027 2c20 656e 643d  fastQ .. ', end=
-0008de10: 2727 2c20 666c 7573 683d 5472 7565 290a  '', flush=True).
-0008de20: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
-0008de30: 666f 7220 6c69 6e65 2069 6e20 6620 3a0a  for line in f :.
-0008de40: 2020 2020 2020 2020 6966 206c 696e 655b          if line[
-0008de50: 305d 203d 3d20 2740 273a 0a20 2020 2020  0] == '@':.     
-0008de60: 2020 2020 2020 2069 6620 636e 7420 3d3d         if cnt ==
-0008de70: 2034 3a0a 2020 2020 2020 2020 2020 2020   4:.            
-0008de80: 2020 2020 6765 6e6f 6d65 5b73 636e 745d      genome[scnt]
-0008de90: 203d 2047 656e 6f6d 6528 6864 722c 2073   = Genome(hdr, s
-0008dea0: 6571 2c20 7175 616c 290a 2020 2020 2020  eq, qual).      
-0008deb0: 2020 2020 2020 2020 2020 7363 6e74 202b            scnt +
-0008dec0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0008ded0: 636e 7420 3d20 300a 2020 2020 2020 2020  cnt = 0.        
-0008dee0: 2020 2020 6864 7220 3d20 6c69 6e65 5b31      hdr = line[1
-0008def0: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
-0008df00: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
-0008df10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008df20: 2020 2020 6966 2063 6e74 203d 3d20 313a      if cnt == 1:
-0008df30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008df40: 2073 6571 203d 206c 696e 655b 3a2d 315d   seq = line[:-1]
-0008df50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008df60: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
-0008df70: 2020 2020 2020 656c 6966 2063 6e74 203d        elif cnt =
-0008df80: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-0008df90: 2020 2020 2069 6620 6c69 6e65 5b30 5d20       if line[0] 
-0008dfa0: 3d3d 2027 2b27 3a0a 2020 2020 2020 2020  == '+':.        
-0008dfb0: 2020 2020 2020 2020 2020 2020 6964 7220              idr 
-0008dfc0: 3d20 6c69 6e65 5b31 3a2d 315d 0a20 2020  = line[1:-1].   
-0008dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008dfe0: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
-0008dff0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0008e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e010: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
-0008e020: 2069 6e20 6661 7374 5120 6669 6c65 2729   in fastQ file')
-0008e030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008e040: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0008e050: 2020 2020 2020 2065 6c69 6620 636e 7420         elif cnt 
-0008e060: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
-0008e070: 2020 2020 2020 7175 616c 203d 206c 696e        qual = lin
-0008e080: 655b 3a2d 315d 0a20 2020 2020 2020 2020  e[:-1].         
-0008e090: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
-0008e0a0: 2020 2020 6966 2063 6e74 203e 2030 3a0a      if cnt > 0:.
-0008e0b0: 2020 2020 2020 2020 6765 6e6f 6d65 5b73          genome[s
-0008e0c0: 636e 745d 203d 2047 656e 6f6d 6528 6864  cnt] = Genome(hd
-0008e0d0: 722c 2073 6571 2c20 7175 616c 290a 2020  r, seq, qual).  
-0008e0e0: 2020 2020 2020 7363 6e74 202b 3d20 310a        scnt += 1.
-0008e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e100: 0a20 2020 2070 7269 6e74 2827 5c72 4c6f  .    print('\rLo
-0008e110: 6164 696e 6720 6661 7374 5120 2e2e 2064  ading fastQ .. d
-0008e120: 6f6e 652e 2020 4e75 6d2e 5365 7120 3d20  one.  Num.Seq = 
-0008e130: 272c 2073 636e 742c 2027 2020 2027 2c20  ', scnt, '   ', 
-0008e140: 666c 7573 683d 5472 7565 290a 2020 2020  flush=True).    
-0008e150: 662e 636c 6f73 6528 290a 2020 2020 7265  f.close().    re
-0008e160: 7475 726e 2867 656e 6f6d 6529 0a0a 0a64  turn(genome)...d
-0008e170: 6566 2073 6176 655f 6661 7374 7128 2066  ef save_fastq( f
-0008e180: 696c 655f 6765 6e6f 6d65 2c20 6765 6e6f  ile_genome, geno
-0008e190: 6d65 5f64 6963 742c 2076 6572 626f 7365  me_dict, verbose
-0008e1a0: 203d 2046 616c 7365 2c20 7469 746c 6520   = False, title 
-0008e1b0: 3d20 2766 6173 7451 2720 293a 0a0a 2020  = 'fastQ' ):..  
-0008e1c0: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
-0008e1d0: 2573 202e 2e27 2025 2074 6974 6c65 2c20  %s ..' % title, 
-0008e1e0: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
-0008e1f0: 7565 290a 2020 2020 2320 666f 7220 6720  ue).    # for g 
-0008e200: 696e 2067 656e 6f6d 655f 6c73 7420 3a0a  in genome_lst :.
-0008e210: 2020 2020 4b65 7973 203d 2067 656e 6f6d      Keys = genom
-0008e220: 655f 6469 6374 2e6b 6579 7328 290a 2020  e_dict.keys().  
-0008e230: 2020 6620 3d20 6f70 656e 2866 696c 655f    f = open(file_
-0008e240: 6765 6e6f 6d65 2c20 2777 742b 2729 0a20  genome, 'wt+'). 
-0008e250: 2020 206c 696e 655f 6c73 7420 3d20 5b5d     line_lst = []
-0008e260: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
-0008e270: 4b65 7973 3a0a 2020 2020 2020 2020 2320  Keys:.        # 
-0008e280: 7072 696e 7428 275c 7253 6176 696e 6720  print('\rSaving 
-0008e290: 2573 202e 2e20 2573 2720 2520 2874 6974  %s .. %s' % (tit
-0008e2a0: 6c65 2c20 6b65 7929 2c20 656e 643d 2720  le, key), end=' 
-0008e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e2c0: 2020 2027 290a 2020 2020 2020 2020 6720     ').        g 
-0008e2d0: 3d20 6765 6e6f 6d65 5f64 6963 745b 6b65  = genome_dict[ke
-0008e2e0: 795d 0a20 2020 2020 2020 2073 203d 2027  y].        s = '
-0008e2f0: 4025 735c 6e27 2025 2067 2e68 6561 6465  @%s\n' % g.heade
-0008e300: 720a 2020 2020 2020 2020 6c69 6e65 5f6c  r.        line_l
-0008e310: 7374 2e61 7070 656e 6428 7329 0a20 2020  st.append(s).   
-0008e320: 2020 2020 206c 696e 655f 6c73 742e 6170       line_lst.ap
-0008e330: 7065 6e64 2867 2e73 6571 2e75 7070 6572  pend(g.seq.upper
-0008e340: 2829 202b 2027 5c6e 2729 0a20 2020 2020  () + '\n').     
-0008e350: 2020 206c 696e 655f 6c73 742e 6170 7065     line_lst.appe
-0008e360: 6e64 2827 2b5c 6e27 290a 2020 2020 2020  nd('+\n').      
-0008e370: 2020 6c69 6e65 5f6c 7374 2e61 7070 656e    line_lst.appen
-0008e380: 6428 672e 7175 616c 202b 2027 5c6e 2729  d(g.qual + '\n')
-0008e390: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0008e3a0: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
-0008e3b0: 696e 7428 272e 272c 2065 6e64 3d27 272c  int('.', end='',
-0008e3c0: 2066 6c75 7368 3d54 7275 6529 0a0a 2020   flush=True)..  
-0008e3d0: 2020 662e 7772 6974 656c 696e 6573 2827    f.writelines('
-0008e3e0: 272e 6a6f 696e 286c 696e 655f 6c73 7429  '.join(line_lst)
-0008e3f0: 290a 2020 2020 2020 2020 0a20 2020 2070  ).        .    p
-0008e400: 7269 6e74 2827 5c72 5361 7669 6e67 2025  rint('\rSaving %
-0008e410: 7320 2e2e 2064 6f6e 652e 2028 2569 2920  s .. done. (%i) 
-0008e420: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0008e430: 2025 2028 7469 746c 652c 206c 656e 284b   % (title, len(K
-0008e440: 6579 7329 292c 2066 6c75 7368 3d54 7275  eys)), flush=Tru
-0008e450: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
-0008e460: 0a20 2020 200a 0a20 2020 200a 6465 6620  .    ..    .def 
-0008e470: 6661 7374 615f 7369 6d5f 7265 6164 5f73  fasta_sim_read_s
-0008e480: 706c 6974 2820 7369 6d5f 7265 6164 2c20  plit( sim_read, 
-0008e490: 6473 7220 3d20 3120 293a 0a20 2020 200a  dsr = 1 ):.    .
-0008e4a0: 2020 2020 666e 616d 652c 2065 7874 203d      fname, ext =
-0008e4b0: 2067 6574 5f70 6174 685f 6e61 6d65 2873   get_path_name(s
-0008e4c0: 696d 5f72 6561 6429 0a0a 2020 2020 6661  im_read)..    fa
-0008e4d0: 5f61 6c6c 203d 206c 6f61 645f 6661 7374  _all = load_fast
-0008e4e0: 7128 7369 6d5f 7265 6164 290a 2020 2020  q(sim_read).    
-0008e4f0: 0a20 2020 2066 6131 203d 207b 7d0a 2020  .    fa1 = {}.  
-0008e500: 2020 6661 3220 3d20 7b7d 0a20 2020 2063    fa2 = {}.    c
-0008e510: 6e74 203d 2030 0a20 2020 2063 6e74 5f31  nt = 0.    cnt_1
-0008e520: 203d 2030 0a20 2020 2063 6e74 5f32 203d   = 0.    cnt_2 =
-0008e530: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
-0008e540: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
-0008e550: 0a20 2020 2020 2020 2066 615f 616c 6c5b  .        fa_all[
-0008e560: 6b65 795d 2e68 6561 6465 7220 3d20 6661  key].header = fa
-0008e570: 5f61 6c6c 5b6b 6579 5d2e 6865 6164 6572  _all[key].header
-0008e580: 5b3a 2d34 5d0a 2020 2020 2020 2020 6966  [:-4].        if
-0008e590: 2063 6e74 2532 203d 3d20 303a 0a20 2020   cnt%2 == 0:.   
-0008e5a0: 2020 2020 2020 2020 2069 6620 636e 745f           if cnt_
-0008e5b0: 3125 6473 7220 3d3d 2030 3a0a 2020 2020  1%dsr == 0:.    
-0008e5c0: 2020 2020 2020 2020 2020 2020 6661 5f61              fa_a
-0008e5d0: 6c6c 5b6b 6579 5d2e 6865 6164 6572 203d  ll[key].header =
-0008e5e0: 2066 615f 616c 6c5b 6b65 795d 2e68 6561   fa_all[key].hea
-0008e5f0: 6465 722e 7370 6c69 7428 2720 2729 5b30  der.split(' ')[0
-0008e600: 5d20 2b20 272f 3127 0a20 2020 2020 2020  ] + '/1'.       
-0008e610: 2020 2020 2020 2020 2066 6131 5b6b 6579           fa1[key
-0008e620: 5d20 3d20 6661 5f61 6c6c 5b6b 6579 5d0a  ] = fa_all[key].
-0008e630: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-0008e640: 3120 2b3d 2031 0a20 2020 2020 2020 2065  1 += 1.        e
-0008e650: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0008e660: 2069 6620 636e 745f 3225 6473 7220 3d3d   if cnt_2%dsr ==
-0008e670: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0008e680: 2020 2020 6661 5f61 6c6c 5b6b 6579 5d2e      fa_all[key].
-0008e690: 6865 6164 6572 203d 2066 615f 616c 6c5b  header = fa_all[
-0008e6a0: 6b65 795d 2e68 6561 6465 722e 7370 6c69  key].header.spli
-0008e6b0: 7428 2720 2729 5b30 5d20 2b20 272f 3227  t(' ')[0] + '/2'
-0008e6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008e6d0: 2066 6132 5b6b 6579 5d20 3d20 6661 5f61   fa2[key] = fa_a
-0008e6e0: 6c6c 5b6b 6579 5d0a 2020 2020 2020 2020  ll[key].        
-0008e6f0: 2020 2020 636e 745f 3220 2b3d 2031 0a0a      cnt_2 += 1..
-0008e700: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
-0008e710: 0a0a 2020 2020 6966 2064 7372 203d 3d20  ..    if dsr == 
-0008e720: 313a 0a20 2020 2020 2020 2066 6e31 203d  1:.        fn1 =
-0008e730: 2066 6e61 6d65 202b 2027 5f31 2e27 202b   fname + '_1.' +
-0008e740: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
-0008e750: 203d 2066 6e61 6d65 202b 2027 5f32 2e27   = fname + '_2.'
-0008e760: 202b 2065 7874 0a20 2020 2065 6c73 653a   + ext.    else:
-0008e770: 0a20 2020 2020 2020 2066 6e31 203d 2066  .        fn1 = f
-0008e780: 6e61 6d65 202b 2028 275f 6473 2569 2720  name + ('_ds%i' 
-0008e790: 2520 6473 7229 202b 2027 5f31 2e27 202b  % dsr) + '_1.' +
-0008e7a0: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
-0008e7b0: 203d 2066 6e61 6d65 202b 2028 275f 6473   = fname + ('_ds
-0008e7c0: 2569 2720 2520 6473 7229 202b 2027 5f32  %i' % dsr) + '_2
-0008e7d0: 2e27 202b 2065 7874 0a20 2020 2073 6176  .' + ext.    sav
-0008e7e0: 655f 6661 7374 7128 666e 312c 2066 6131  e_fastq(fn1, fa1
-0008e7f0: 290a 2020 2020 7361 7665 5f66 6173 7471  ).    save_fastq
-0008e800: 2866 6e32 2c20 6661 3229 0a20 2020 200a  (fn2, fa2).    .
-0008e810: 0a64 6566 2066 6173 7461 5f73 696d 5f72  .def fasta_sim_r
-0008e820: 6561 645f 646f 776e 7361 6d70 6c65 2820  ead_downsample( 
-0008e830: 7369 6d5f 7265 6164 2c20 6473 7220 3d20  sim_read, dsr = 
-0008e840: 3120 293a 0a20 2020 200a 2020 2020 666e  1 ):.    .    fn
-0008e850: 616d 652c 2065 7874 203d 2067 6574 5f70  ame, ext = get_p
-0008e860: 6174 685f 6e61 6d65 2873 696d 5f72 6561  ath_name(sim_rea
-0008e870: 6429 0a0a 2020 2020 6661 5f61 6c6c 203d  d)..    fa_all =
-0008e880: 206c 6f61 645f 6661 7374 7128 7369 6d5f   load_fastq(sim_
-0008e890: 7265 6164 290a 2020 2020 0a20 2020 2066  read).    .    f
-0008e8a0: 6120 3d20 7b7d 0a20 2020 2063 6e74 203d  a = {}.    cnt =
-0008e8b0: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
-0008e8c0: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
-0008e8d0: 0a20 2020 2020 2020 2023 2066 615f 616c  .        # fa_al
-0008e8e0: 6c5b 6b65 795d 2e68 6561 6465 7220 3d20  l[key].header = 
-0008e8f0: 6661 5f61 6c6c 5b6b 6579 5d2e 6865 6164  fa_all[key].head
-0008e900: 6572 5b3a 2d34 5d0a 2020 2020 2020 2020  er[:-4].        
-0008e910: 6966 2063 6e74 2564 7372 203d 3d20 303a  if cnt%dsr == 0:
-0008e920: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-0008e930: 615f 616c 6c5b 6b65 795d 2e68 6561 6465  a_all[key].heade
-0008e940: 7220 3d20 6661 5f61 6c6c 5b6b 6579 5d2e  r = fa_all[key].
-0008e950: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-0008e960: 2020 2066 615b 6b65 795d 203d 2066 615f     fa[key] = fa_
-0008e970: 616c 6c5b 6b65 795d 0a20 2020 2020 2020  all[key].       
-0008e980: 2063 6e74 202b 3d20 310a 0a20 2020 2066   cnt += 1..    f
-0008e990: 6e20 3d20 666e 616d 6520 2b20 2827 5f64  n = fname + ('_d
-0008e9a0: 7325 692e 2720 2520 6473 7229 202b 2065  s%i.' % dsr) + e
-0008e9b0: 7874 0a20 2020 2073 6176 655f 6661 7374  xt.    save_fast
-0008e9c0: 7128 666e 2c20 6661 290a 2020 2020 0a20  q(fn, fa).    . 
-0008e9d0: 2020 200a 2323 2323 2323 2323 2323 2323     .############
-0008e9e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d880: 2323 2323 2323 2323 230a 0a64 6566 2066  #########..def f
+0008d890: 6173 7461 5f61 6464 5f74 7261 7265 636f  asta_add_trareco
+0008d8a0: 5f68 6561 6465 7228 2072 6566 5f74 722c  _header( ref_tr,
+0008d8b0: 2073 696d 5f70 726f 6669 6c65 2c20 7265   sim_profile, re
+0008d8c0: 6164 5f6c 656e 2c20 7375 6666 6978 203d  ad_len, suffix =
+0008d8d0: 204e 6f6e 652c 2063 6f76 5f74 6820 3d20   None, cov_th = 
+0008d8e0: 302e 3820 293a 0a20 2020 200a 2020 2020  0.8 ):.    .    
+0008d8f0: 636f 6c6e 616d 6573 203d 205b 276c 6f63  colnames = ['loc
+0008d900: 272c 2027 7469 6427 2c20 2763 6f64 696e  ', 'tid', 'codin
+0008d910: 6727 2c20 276c 656e 6774 6827 2c20 2765  g', 'length', 'e
+0008d920: 7870 5f66 7261 6327 2c20 2765 7870 5f6e  xp_frac', 'exp_n
+0008d930: 756d 272c 2027 6c69 625f 6672 6163 272c  um', 'lib_frac',
+0008d940: 2027 6c69 625f 6e75 6d27 2c20 5c0a 2020   'lib_num', \.  
+0008d950: 2020 2020 2020 2020 2020 2020 2020 2773                's
+0008d960: 6571 5f66 7261 6327 2c20 2773 6571 5f6e  eq_frac', 'seq_n
+0008d970: 756d 272c 2027 636f 765f 6672 6163 272c  um', 'cov_frac',
+0008d980: 2027 6368 6932 272c 2027 5663 6f65 6627   'chi2', 'Vcoef'
+0008d990: 5d0a 2020 2020 6466 5f70 726f 203d 2070  ].    df_pro = p
+0008d9a0: 642e 7265 6164 5f63 7376 2873 696d 5f70  d.read_csv(sim_p
+0008d9b0: 726f 6669 6c65 2c20 7365 703d 275c 7427  rofile, sep='\t'
+0008d9c0: 2c20 6865 6164 6572 203d 204e 6f6e 652c  , header = None,
+0008d9d0: 2069 6e64 6578 5f63 6f6c 203d 2031 2c20   index_col = 1, 
+0008d9e0: 6e61 6d65 7320 3d20 636f 6c6e 616d 6573  names = colnames
+0008d9f0: 290a 0a20 2020 2072 6566 203d 206c 6f61  )..    ref = loa
+0008da00: 645f 6661 7374 6128 7265 665f 7472 290a  d_fasta(ref_tr).
+0008da10: 0a20 2020 2064 665f 7072 6f5b 2761 626e  .    df_pro['abn
+0008da20: 275d 203d 2064 665f 7072 6f5b 2773 6571  '] = df_pro['seq
+0008da30: 5f6e 756d 275d 2a72 6561 645f 6c65 6e2f  _num']*read_len/
+0008da40: 6466 5f70 726f 5b27 6c65 6e67 7468 275d  df_pro['length']
+0008da50: 0a20 2020 2064 665f 7072 6f5b 2774 706d  .    df_pro['tpm
+0008da60: 275d 203d 2064 665f 7072 6f5b 2761 626e  '] = df_pro['abn
+0008da70: 275d 2a31 3030 3030 3030 2f28 6466 5f70  ']*1000000/(df_p
+0008da80: 726f 5b27 6162 6e27 5d2e 7375 6d28 2929  ro['abn'].sum())
+0008da90: 0a0a 2020 2020 6466 5f69 6478 203d 206e  ..    df_idx = n
+0008daa0: 702e 6172 7261 7928 6466 5f70 726f 2e69  p.array(df_pro.i
+0008dab0: 6e64 6578 2e76 616c 7565 732e 746f 6c69  ndex.values.toli
+0008dac0: 7374 2829 290a 2020 2020 636e 745f 6475  st()).    cnt_du
+0008dad0: 7020 3d20 300a 2020 2020 666f 7220 6b65  p = 0.    for ke
+0008dae0: 7920 696e 206c 6973 7428 7265 662e 6b65  y in list(ref.ke
+0008daf0: 7973 2829 293a 0a20 2020 2020 2020 2069  ys()):.        i
+0008db00: 6620 286b 6579 2069 6e20 6466 5f69 6478  f (key in df_idx
+0008db10: 2920 2620 286e 702e 7375 6d28 6466 5f69  ) & (np.sum(df_i
+0008db20: 6478 203d 3d20 6b65 7929 203d 3d20 3129  dx == key) == 1)
+0008db30: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0008db40: 2064 665f 7072 6f2e 6c6f 635b 6b65 795d   df_pro.loc[key]
+0008db50: 2e63 6f76 5f66 7261 6320 3e3d 2063 6f76  .cov_frac >= cov
+0008db60: 5f74 683a 0a20 2020 2020 2020 2020 2020  _th:.           
+0008db70: 2020 2020 2072 6566 5b6b 6579 5d2e 6865       ref[key].he
+0008db80: 6164 6572 203d 2027 2573 2063 6f76 5f66  ader = '%s cov_f
+0008db90: 7261 633a 2566 2061 626e 3a25 6620 7470  rac:%f abn:%f tp
+0008dba0: 6d3a 2566 2720 2520 2872 6566 5b6b 6579  m:%f' % (ref[key
+0008dbb0: 5d2e 6865 6164 6572 2c20 6466 5f70 726f  ].header, df_pro
+0008dbc0: 2e6c 6f63 5b6b 6579 5d2e 636f 765f 6672  .loc[key].cov_fr
+0008dbd0: 6163 2c20 6466 5f70 726f 2e6c 6f63 5b6b  ac, df_pro.loc[k
+0008dbe0: 6579 5d2e 6162 6e2c 2064 665f 7072 6f2e  ey].abn, df_pro.
+0008dbf0: 6c6f 635b 6b65 795d 2e74 706d 290a 2020  loc[key].tpm).  
+0008dc00: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0008dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008dc20: 7265 662e 706f 7028 6b65 7929 0a20 2020  ref.pop(key).   
+0008dc30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0008dc40: 2020 2020 2020 2069 6620 6466 5f70 726f         if df_pro
+0008dc50: 2e6c 6f63 5b6b 6579 5d2e 7368 6170 655b  .loc[key].shape[
+0008dc60: 305d 203e 2031 3a20 636e 745f 6475 7020  0] > 1: cnt_dup 
+0008dc70: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0008dc80: 2072 6566 2e70 6f70 286b 6579 290a 0a20   ref.pop(key).. 
+0008dc90: 2020 2066 6e61 6d65 2c20 6578 7420 3d20     fname, ext = 
+0008dca0: 6765 745f 6669 6c65 5f6e 616d 6528 7265  get_file_name(re
+0008dcb0: 665f 7472 290a 2020 2020 6966 2073 7566  f_tr).    if suf
+0008dcc0: 6669 7820 6973 204e 6f6e 653a 0a20 2020  fix is None:.   
+0008dcd0: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
+0008dce0: 6d65 202b 2027 5f63 6f76 2569 2e27 2025  me + '_cov%i.' %
+0008dcf0: 2069 6e74 2863 6f76 5f74 682a 3130 3029   int(cov_th*100)
+0008dd00: 202b 2065 7874 0a20 2020 2065 6c73 653a   + ext.    else:
+0008dd10: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
+0008dd20: 2066 6e61 6d65 202b 2027 5f25 735f 636f   fname + '_%s_co
+0008dd30: 7625 692e 2720 2520 2873 7566 6669 782c  v%i.' % (suffix,
+0008dd40: 2069 6e74 2863 6f76 5f74 682a 3130 3029   int(cov_th*100)
+0008dd50: 2920 2b20 6578 740a 0a20 2020 2073 6176  ) + ext..    sav
+0008dd60: 655f 6661 7374 6128 666e 616d 652c 2072  e_fasta(fname, r
+0008dd70: 6566 2c20 7469 746c 6520 3d20 666e 616d  ef, title = fnam
+0008dd80: 6529 0a20 2020 200a 0a64 6566 206c 6f61  e).    ..def loa
+0008dd90: 645f 6661 7374 7128 6669 6c65 5f67 656e  d_fastq(file_gen
+0008dda0: 6f6d 652c 2076 6572 626f 7365 203d 2046  ome, verbose = F
+0008ddb0: 616c 7365 2029 3a0a 0a20 2020 2067 656e  alse ):..    gen
+0008ddc0: 6f6d 6520 3d20 6469 6374 2829 0a20 2020  ome = dict().   
+0008ddd0: 2066 203d 206f 7065 6e28 6669 6c65 5f67   f = open(file_g
+0008dde0: 656e 6f6d 652c 2027 7227 290a 2020 2020  enome, 'r').    
+0008ddf0: 7363 6e74 203d 2030 0a20 2020 2070 7269  scnt = 0.    pri
+0008de00: 6e74 2827 5c72 4c6f 6164 696e 6720 6661  nt('\rLoading fa
+0008de10: 7374 5120 2e2e 2027 2c20 656e 643d 2727  stQ .. ', end=''
+0008de20: 2c20 666c 7573 683d 5472 7565 290a 2020  , flush=True).  
+0008de30: 2020 636e 7420 3d20 300a 2020 2020 666f    cnt = 0.    fo
+0008de40: 7220 6c69 6e65 2069 6e20 6620 3a0a 2020  r line in f :.  
+0008de50: 2020 2020 2020 6966 206c 696e 655b 305d        if line[0]
+0008de60: 203d 3d20 2740 273a 0a20 2020 2020 2020   == '@':.       
+0008de70: 2020 2020 2069 6620 636e 7420 3d3d 2034       if cnt == 4
+0008de80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0008de90: 2020 6765 6e6f 6d65 5b73 636e 745d 203d    genome[scnt] =
+0008dea0: 2047 656e 6f6d 6528 6864 722c 2073 6571   Genome(hdr, seq
+0008deb0: 2c20 7175 616c 290a 2020 2020 2020 2020  , qual).        
+0008dec0: 2020 2020 2020 2020 7363 6e74 202b 3d20          scnt += 
+0008ded0: 310a 2020 2020 2020 2020 2020 2020 636e  1.            cn
+0008dee0: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
+0008def0: 2020 6864 7220 3d20 6c69 6e65 5b31 3a2d    hdr = line[1:-
+0008df00: 315d 0a20 2020 2020 2020 2020 2020 2063  1].            c
+0008df10: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0008df20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0008df30: 2020 6966 2063 6e74 203d 3d20 313a 0a20    if cnt == 1:. 
+0008df40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008df50: 6571 203d 206c 696e 655b 3a2d 315d 0a20  eq = line[:-1]. 
+0008df60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0008df70: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0008df80: 2020 2020 656c 6966 2063 6e74 203d 3d20      elif cnt == 
+0008df90: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+0008dfa0: 2020 2069 6620 6c69 6e65 5b30 5d20 3d3d     if line[0] ==
+0008dfb0: 2027 2b27 3a0a 2020 2020 2020 2020 2020   '+':.          
+0008dfc0: 2020 2020 2020 2020 2020 6964 7220 3d20            idr = 
+0008dfd0: 6c69 6e65 5b31 3a2d 315d 0a20 2020 2020  line[1:-1].     
+0008dfe0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0008dff0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0008e000: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0008e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008e020: 2020 7072 696e 7428 2745 5252 4f52 2069    print('ERROR i
+0008e030: 6e20 6661 7374 5120 6669 6c65 2729 0a20  n fastQ file'). 
+0008e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008e050: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0008e060: 2020 2020 2065 6c69 6620 636e 7420 3d3d       elif cnt ==
+0008e070: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+0008e080: 2020 2020 7175 616c 203d 206c 696e 655b      qual = line[
+0008e090: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
+0008e0a0: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
+0008e0b0: 2020 6966 2063 6e74 203e 2030 3a0a 2020    if cnt > 0:.  
+0008e0c0: 2020 2020 2020 6765 6e6f 6d65 5b73 636e        genome[scn
+0008e0d0: 745d 203d 2047 656e 6f6d 6528 6864 722c  t] = Genome(hdr,
+0008e0e0: 2073 6571 2c20 7175 616c 290a 2020 2020   seq, qual).    
+0008e0f0: 2020 2020 7363 6e74 202b 3d20 310a 2020      scnt += 1.  
+0008e100: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0008e110: 2020 2070 7269 6e74 2827 5c72 4c6f 6164     print('\rLoad
+0008e120: 696e 6720 6661 7374 5120 2e2e 2064 6f6e  ing fastQ .. don
+0008e130: 652e 2020 4e75 6d2e 5365 7120 3d20 272c  e.  Num.Seq = ',
+0008e140: 2073 636e 742c 2027 2020 2027 2c20 666c   scnt, '   ', fl
+0008e150: 7573 683d 5472 7565 290a 2020 2020 662e  ush=True).    f.
+0008e160: 636c 6f73 6528 290a 2020 2020 7265 7475  close().    retu
+0008e170: 726e 2867 656e 6f6d 6529 0a0a 0a64 6566  rn(genome)...def
+0008e180: 2073 6176 655f 6661 7374 7128 2066 696c   save_fastq( fil
+0008e190: 655f 6765 6e6f 6d65 2c20 6765 6e6f 6d65  e_genome, genome
+0008e1a0: 5f64 6963 742c 2076 6572 626f 7365 203d  _dict, verbose =
+0008e1b0: 2046 616c 7365 2c20 7469 746c 6520 3d20   False, title = 
+0008e1c0: 2766 6173 7451 2720 293a 0a0a 2020 2020  'fastQ' ):..    
+0008e1d0: 7072 696e 7428 2753 6176 696e 6720 2573  print('Saving %s
+0008e1e0: 202e 2e27 2025 2074 6974 6c65 2c20 656e   ..' % title, en
+0008e1f0: 643d 2727 2c20 666c 7573 683d 5472 7565  d='', flush=True
+0008e200: 290a 2020 2020 2320 666f 7220 6720 696e  ).    # for g in
+0008e210: 2067 656e 6f6d 655f 6c73 7420 3a0a 2020   genome_lst :.  
+0008e220: 2020 4b65 7973 203d 2067 656e 6f6d 655f    Keys = genome_
+0008e230: 6469 6374 2e6b 6579 7328 290a 2020 2020  dict.keys().    
+0008e240: 6620 3d20 6f70 656e 2866 696c 655f 6765  f = open(file_ge
+0008e250: 6e6f 6d65 2c20 2777 742b 2729 0a20 2020  nome, 'wt+').   
+0008e260: 206c 696e 655f 6c73 7420 3d20 5b5d 0a20   line_lst = []. 
+0008e270: 2020 2066 6f72 206b 6579 2069 6e20 4b65     for key in Ke
+0008e280: 7973 3a0a 2020 2020 2020 2020 2320 7072  ys:.        # pr
+0008e290: 696e 7428 275c 7253 6176 696e 6720 2573  int('\rSaving %s
+0008e2a0: 202e 2e20 2573 2720 2520 2874 6974 6c65   .. %s' % (title
+0008e2b0: 2c20 6b65 7929 2c20 656e 643d 2720 2020  , key), end='   
+0008e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008e2d0: 2027 290a 2020 2020 2020 2020 6720 3d20   ').        g = 
+0008e2e0: 6765 6e6f 6d65 5f64 6963 745b 6b65 795d  genome_dict[key]
+0008e2f0: 0a20 2020 2020 2020 2073 203d 2027 4025  .        s = '@%
+0008e300: 735c 6e27 2025 2067 2e68 6561 6465 720a  s\n' % g.header.
+0008e310: 2020 2020 2020 2020 6c69 6e65 5f6c 7374          line_lst
+0008e320: 2e61 7070 656e 6428 7329 0a20 2020 2020  .append(s).     
+0008e330: 2020 206c 696e 655f 6c73 742e 6170 7065     line_lst.appe
+0008e340: 6e64 2867 2e73 6571 2e75 7070 6572 2829  nd(g.seq.upper()
+0008e350: 202b 2027 5c6e 2729 0a20 2020 2020 2020   + '\n').       
+0008e360: 206c 696e 655f 6c73 742e 6170 7065 6e64   line_lst.append
+0008e370: 2827 2b5c 6e27 290a 2020 2020 2020 2020  ('+\n').        
+0008e380: 6c69 6e65 5f6c 7374 2e61 7070 656e 6428  line_lst.append(
+0008e390: 672e 7175 616c 202b 2027 5c6e 2729 0a20  g.qual + '\n'). 
+0008e3a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0008e3b0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
+0008e3c0: 7428 272e 272c 2065 6e64 3d27 272c 2066  t('.', end='', f
+0008e3d0: 6c75 7368 3d54 7275 6529 0a0a 2020 2020  lush=True)..    
+0008e3e0: 662e 7772 6974 656c 696e 6573 2827 272e  f.writelines(''.
+0008e3f0: 6a6f 696e 286c 696e 655f 6c73 7429 290a  join(line_lst)).
+0008e400: 2020 2020 2020 2020 0a20 2020 2070 7269          .    pri
+0008e410: 6e74 2827 5c72 5361 7669 6e67 2025 7320  nt('\rSaving %s 
+0008e420: 2e2e 2064 6f6e 652e 2028 2569 2920 2020  .. done. (%i)   
+0008e430: 2020 2020 2020 2020 2020 2020 2027 2025               ' %
+0008e440: 2028 7469 746c 652c 206c 656e 284b 6579   (title, len(Key
+0008e450: 7329 292c 2066 6c75 7368 3d54 7275 6529  s)), flush=True)
+0008e460: 0a20 2020 2066 2e63 6c6f 7365 2829 0a20  .    f.close(). 
+0008e470: 2020 200a 0a20 2020 200a 6465 6620 6661     ..    .def fa
+0008e480: 7374 615f 7369 6d5f 7265 6164 5f73 706c  sta_sim_read_spl
+0008e490: 6974 2820 7369 6d5f 7265 6164 2c20 6473  it( sim_read, ds
+0008e4a0: 7220 3d20 3120 293a 0a20 2020 200a 2020  r = 1 ):.    .  
+0008e4b0: 2020 666e 616d 652c 2065 7874 203d 2067    fname, ext = g
+0008e4c0: 6574 5f70 6174 685f 6e61 6d65 2873 696d  et_path_name(sim
+0008e4d0: 5f72 6561 6429 0a0a 2020 2020 6661 5f61  _read)..    fa_a
+0008e4e0: 6c6c 203d 206c 6f61 645f 6661 7374 7128  ll = load_fastq(
+0008e4f0: 7369 6d5f 7265 6164 290a 2020 2020 0a20  sim_read).    . 
+0008e500: 2020 2066 6131 203d 207b 7d0a 2020 2020     fa1 = {}.    
+0008e510: 6661 3220 3d20 7b7d 0a20 2020 2063 6e74  fa2 = {}.    cnt
+0008e520: 203d 2030 0a20 2020 2063 6e74 5f31 203d   = 0.    cnt_1 =
+0008e530: 2030 0a20 2020 2063 6e74 5f32 203d 2030   0.    cnt_2 = 0
+0008e540: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
+0008e550: 6661 5f61 6c6c 2e6b 6579 7328 293a 0a20  fa_all.keys():. 
+0008e560: 2020 2020 2020 2066 615f 616c 6c5b 6b65         fa_all[ke
+0008e570: 795d 2e68 6561 6465 7220 3d20 6661 5f61  y].header = fa_a
+0008e580: 6c6c 5b6b 6579 5d2e 6865 6164 6572 5b3a  ll[key].header[:
+0008e590: 2d34 5d0a 2020 2020 2020 2020 6966 2063  -4].        if c
+0008e5a0: 6e74 2532 203d 3d20 303a 0a20 2020 2020  nt%2 == 0:.     
+0008e5b0: 2020 2020 2020 2069 6620 636e 745f 3125         if cnt_1%
+0008e5c0: 6473 7220 3d3d 2030 3a0a 2020 2020 2020  dsr == 0:.      
+0008e5d0: 2020 2020 2020 2020 2020 6661 5f61 6c6c            fa_all
+0008e5e0: 5b6b 6579 5d2e 6865 6164 6572 203d 2066  [key].header = f
+0008e5f0: 615f 616c 6c5b 6b65 795d 2e68 6561 6465  a_all[key].heade
+0008e600: 722e 7370 6c69 7428 2720 2729 5b30 5d20  r.split(' ')[0] 
+0008e610: 2b20 272f 3127 0a20 2020 2020 2020 2020  + '/1'.         
+0008e620: 2020 2020 2020 2066 6131 5b6b 6579 5d20         fa1[key] 
+0008e630: 3d20 6661 5f61 6c6c 5b6b 6579 5d0a 2020  = fa_all[key].  
+0008e640: 2020 2020 2020 2020 2020 636e 745f 3120            cnt_1 
+0008e650: 2b3d 2031 0a20 2020 2020 2020 2065 6c73  += 1.        els
+0008e660: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0008e670: 6620 636e 745f 3225 6473 7220 3d3d 2030  f cnt_2%dsr == 0
+0008e680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0008e690: 2020 6661 5f61 6c6c 5b6b 6579 5d2e 6865    fa_all[key].he
+0008e6a0: 6164 6572 203d 2066 615f 616c 6c5b 6b65  ader = fa_all[ke
+0008e6b0: 795d 2e68 6561 6465 722e 7370 6c69 7428  y].header.split(
+0008e6c0: 2720 2729 5b30 5d20 2b20 272f 3227 0a20  ' ')[0] + '/2'. 
+0008e6d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0008e6e0: 6132 5b6b 6579 5d20 3d20 6661 5f61 6c6c  a2[key] = fa_all
+0008e6f0: 5b6b 6579 5d0a 2020 2020 2020 2020 2020  [key].          
+0008e700: 2020 636e 745f 3220 2b3d 2031 0a0a 2020    cnt_2 += 1..  
+0008e710: 2020 2020 2020 636e 7420 2b3d 2031 0a0a        cnt += 1..
+0008e720: 2020 2020 6966 2064 7372 203d 3d20 313a      if dsr == 1:
+0008e730: 0a20 2020 2020 2020 2066 6e31 203d 2066  .        fn1 = f
+0008e740: 6e61 6d65 202b 2027 5f31 2e27 202b 2065  name + '_1.' + e
+0008e750: 7874 0a20 2020 2020 2020 2066 6e32 203d  xt.        fn2 =
+0008e760: 2066 6e61 6d65 202b 2027 5f32 2e27 202b   fname + '_2.' +
+0008e770: 2065 7874 0a20 2020 2065 6c73 653a 0a20   ext.    else:. 
+0008e780: 2020 2020 2020 2066 6e31 203d 2066 6e61         fn1 = fna
+0008e790: 6d65 202b 2028 275f 6473 2569 2720 2520  me + ('_ds%i' % 
+0008e7a0: 6473 7229 202b 2027 5f31 2e27 202b 2065  dsr) + '_1.' + e
+0008e7b0: 7874 0a20 2020 2020 2020 2066 6e32 203d  xt.        fn2 =
+0008e7c0: 2066 6e61 6d65 202b 2028 275f 6473 2569   fname + ('_ds%i
+0008e7d0: 2720 2520 6473 7229 202b 2027 5f32 2e27  ' % dsr) + '_2.'
+0008e7e0: 202b 2065 7874 0a20 2020 2073 6176 655f   + ext.    save_
+0008e7f0: 6661 7374 7128 666e 312c 2066 6131 290a  fastq(fn1, fa1).
+0008e800: 2020 2020 7361 7665 5f66 6173 7471 2866      save_fastq(f
+0008e810: 6e32 2c20 6661 3229 0a20 2020 200a 0a64  n2, fa2).    ..d
+0008e820: 6566 2066 6173 7461 5f73 696d 5f72 6561  ef fasta_sim_rea
+0008e830: 645f 646f 776e 7361 6d70 6c65 2820 7369  d_downsample( si
+0008e840: 6d5f 7265 6164 2c20 6473 7220 3d20 3120  m_read, dsr = 1 
+0008e850: 293a 0a20 2020 200a 2020 2020 666e 616d  ):.    .    fnam
+0008e860: 652c 2065 7874 203d 2067 6574 5f70 6174  e, ext = get_pat
+0008e870: 685f 6e61 6d65 2873 696d 5f72 6561 6429  h_name(sim_read)
+0008e880: 0a0a 2020 2020 6661 5f61 6c6c 203d 206c  ..    fa_all = l
+0008e890: 6f61 645f 6661 7374 7128 7369 6d5f 7265  oad_fastq(sim_re
+0008e8a0: 6164 290a 2020 2020 0a20 2020 2066 6120  ad).    .    fa 
+0008e8b0: 3d20 7b7d 0a20 2020 2063 6e74 203d 2030  = {}.    cnt = 0
+0008e8c0: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
+0008e8d0: 6661 5f61 6c6c 2e6b 6579 7328 293a 0a20  fa_all.keys():. 
+0008e8e0: 2020 2020 2020 2023 2066 615f 616c 6c5b         # fa_all[
+0008e8f0: 6b65 795d 2e68 6561 6465 7220 3d20 6661  key].header = fa
+0008e900: 5f61 6c6c 5b6b 6579 5d2e 6865 6164 6572  _all[key].header
+0008e910: 5b3a 2d34 5d0a 2020 2020 2020 2020 6966  [:-4].        if
+0008e920: 2063 6e74 2564 7372 203d 3d20 303a 0a20   cnt%dsr == 0:. 
+0008e930: 2020 2020 2020 2020 2020 2023 2066 615f             # fa_
+0008e940: 616c 6c5b 6b65 795d 2e68 6561 6465 7220  all[key].header 
+0008e950: 3d20 6661 5f61 6c6c 5b6b 6579 5d2e 6865  = fa_all[key].he
+0008e960: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
+0008e970: 2066 615b 6b65 795d 203d 2066 615f 616c   fa[key] = fa_al
+0008e980: 6c5b 6b65 795d 0a20 2020 2020 2020 2063  l[key].        c
+0008e990: 6e74 202b 3d20 310a 0a20 2020 2066 6e20  nt += 1..    fn 
+0008e9a0: 3d20 666e 616d 6520 2b20 2827 5f64 7325  = fname + ('_ds%
+0008e9b0: 692e 2720 2520 6473 7229 202b 2065 7874  i.' % dsr) + ext
+0008e9c0: 0a20 2020 2073 6176 655f 6661 7374 7128  .    save_fastq(
+0008e9d0: 666e 2c20 6661 290a 2020 2020 0a20 2020  fn, fa).    .   
+0008e9e0: 200a 2323 2323 2323 2323 2323 2323 2323   .##############
 0008e9f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008ea00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008ea10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea20: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
-0008ea30: 6f6e 7320 746f 2061 6464 2053 4e56 2069  ons to add SNV i
-0008ea40: 6e74 6f20 6120 6765 6e6f 6d65 0a23 2323  nto a genome.###
-0008ea50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008ea20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008ea30: 2323 2323 0a23 2320 4675 6e63 7469 6f6e  ####.## Function
+0008ea40: 7320 746f 2061 6464 2053 4e56 2069 6e74  s to add SNV int
+0008ea50: 6f20 6120 6765 6e6f 6d65 0a23 2323 2323  o a genome.#####
 0008ea60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008ea70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008ea80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea90: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-0008eaa0: 0a53 4e56 203d 2063 6f6c 6c65 6374 696f  .SNV = collectio
-0008eab0: 6e73 2e6e 616d 6564 7475 706c 6528 2753  ns.namedtuple('S
-0008eac0: 4e56 272c 2027 6368 722c 2070 6f73 5f6e  NV', 'chr, pos_n
-0008ead0: 6577 2c20 706f 735f 6f72 672c 2074 7970  ew, pos_org, typ
-0008eae0: 652c 206c 656e 2c20 7365 715f 6e65 772c  e, len, seq_new,
-0008eaf0: 2073 6571 5f6f 7267 2c20 6578 5f73 7461   seq_org, ex_sta
-0008eb00: 7274 2c20 6578 5f65 6e64 2729 0a0a 6465  rt, ex_end')..de
-0008eb10: 6620 6765 745f 736e 765f 7479 7065 2870  f get_snv_type(p
-0008eb20: 692c 2070 6429 3a0a 2020 2020 0a20 2020  i, pd):.    .   
-0008eb30: 2072 6e20 3d20 6e70 2e72 616e 646f 6d2e   rn = np.random.
-0008eb40: 756e 6966 6f72 6d28 3130 3029 0a20 2020  uniform(100).   
-0008eb50: 2069 6620 726e 203c 2028 7069 2a31 3030   if rn < (pi*100
-0008eb60: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0008eb70: 6e28 3129 0a20 2020 2065 6c69 6620 726e  n(1).    elif rn
-0008eb80: 203c 2028 7069 2b70 6929 2a31 3030 3a0a   < (pi+pi)*100:.
-0008eb90: 2020 2020 2020 2020 7265 7475 726e 2832          return(2
-0008eba0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-0008ebb0: 2020 2020 7265 7475 726e 2830 290a 2020      return(0).  
-0008ebc0: 2020 0a64 6566 2072 616e 645f 6e75 636c    .def rand_nucl
-0008ebd0: 656f 7469 6465 5f65 7863 6570 7428 6e74  eotide_except(nt
-0008ebe0: 7329 3a0a 2020 2020 0a20 2020 206e 7473  s):.    .    nts
-0008ebf0: 5f6f 7574 203d 2027 270a 2020 2020 666f  _out = ''.    fo
-0008ec00: 7220 6e74 2069 6e20 6e74 733a 0a20 2020  r nt in nts:.   
-0008ec10: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-0008ec20: 0a20 2020 2020 2020 2020 2020 2072 6e20  .            rn 
-0008ec30: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-0008ec40: 696e 7428 302c 342c 3129 5b30 5d0a 2020  int(0,4,1)[0].  
-0008ec50: 2020 2020 2020 2020 2020 6e74 5f6e 6577            nt_new
-0008ec60: 203d 204e 545f 6c73 745b 696e 7428 726e   = NT_lst[int(rn
-0008ec70: 295d 0a20 2020 2020 2020 2020 2020 2069  )].            i
-0008ec80: 6620 6e74 5f6e 6577 2021 3d20 6e74 3a20  f nt_new != nt: 
-0008ec90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008eca0: 206e 7473 5f6f 7574 203d 206e 7473 5f6f   nts_out = nts_o
-0008ecb0: 7574 202b 206e 745f 6e65 770a 2020 2020  ut + nt_new.    
-0008ecc0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0008ecd0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0008ece0: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-0008ecf0: 6e28 6e74 735f 6f75 7429 0a20 2020 2020  n(nts_out).     
-0008ed00: 2020 200a 6465 6620 7261 6e64 5f6e 7563     .def rand_nuc
-0008ed10: 6c65 6f74 6964 6573 286e 756d 293a 0a20  leotides(num):. 
-0008ed20: 2020 200a 2020 2020 6e75 6d5f 7365 7120     .    num_seq 
-0008ed30: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-0008ed40: 696e 7428 302c 342c 6e75 6d29 0a20 2020  int(0,4,num).   
-0008ed50: 206e 745f 7374 7220 3d20 2727 2e6a 6f69   nt_str = ''.joi
-0008ed60: 6e28 5b4e 545f 6c73 745b 6e5d 2066 6f72  n([NT_lst[n] for
-0008ed70: 206e 2069 6e20 6e75 6d5f 7365 715d 290a   n in num_seq]).
-0008ed80: 2020 2020 7265 7475 726e 286e 745f 7374      return(nt_st
-0008ed90: 7229 0a0a 0a64 6566 2073 6176 655f 736e  r)...def save_sn
-0008eda0: 765f 696e 666f 5f6f 6c64 2820 6669 6c65  v_info_old( file
-0008edb0: 5f6e 616d 652c 2073 6e76 5f6c 7374 2c20  _name, snv_lst, 
-0008edc0: 7665 7262 6f73 6520 3d20 4661 6c73 6520  verbose = False 
-0008edd0: 293a 0a20 2020 200a 2020 2020 6620 3d20  ):.    .    f = 
-0008ede0: 6f70 656e 2866 696c 655f 6e61 6d65 2c20  open(file_name, 
-0008edf0: 2777 742b 2729 0a20 2020 2070 7269 6e74  'wt+').    print
-0008ee00: 2827 5361 7669 6e67 2053 4e56 2069 6e66  ('Saving SNV inf
-0008ee10: 6f2e 2027 2c20 656e 643d 2727 290a 2020  o. ', end='').  
-0008ee20: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
-0008ee30: 286c 656e 2873 6e76 5f6c 7374 292f 3230  (len(snv_lst)/20
-0008ee40: 290a 2020 2020 666f 7220 6b20 696e 2072  ).    for k in r
-0008ee50: 616e 6765 286c 656e 2873 6e76 5f6c 7374  ange(len(snv_lst
-0008ee60: 2929 203a 0a20 2020 2020 2020 2073 6e76  )) :.        snv
-0008ee70: 203d 2073 6e76 5f6c 7374 5b6b 5d0a 2020   = snv_lst[k].  
-0008ee80: 2020 2020 2020 7320 3d20 2725 732c 2569        s = '%s,%i
-0008ee90: 2c25 692c 2573 2c25 692c 2573 2c25 735c  ,%i,%s,%i,%s,%s\
-0008eea0: 6e27 2025 205c 0a20 2020 2020 2020 2028  n' % \.        (
-0008eeb0: 736e 762e 6368 722c 2073 6e76 2e70 6f73  snv.chr, snv.pos
-0008eec0: 5f6e 6577 2c20 736e 762e 706f 735f 6f72  _new, snv.pos_or
-0008eed0: 672c 2073 6e76 2e74 7970 652c 2073 6e76  g, snv.type, snv
-0008eee0: 2e6c 656e 2c20 736e 762e 7365 715f 6e65  .len, snv.seq_ne
-0008eef0: 772c 2073 6e76 2e73 6571 5f6f 7267 2029  w, snv.seq_org )
-0008ef00: 0a20 2020 2020 2020 2066 2e77 7269 7465  .        f.write
-0008ef10: 6c69 6e65 7328 7329 0a20 2020 2020 2020  lines(s).       
-0008ef20: 2069 6620 6b25 7374 6570 203d 3d20 303a   if k%step == 0:
-0008ef30: 2070 7269 6e74 2827 2e27 2c65 6e64 3d27   print('.',end='
-0008ef40: 2729 0a20 2020 2020 2020 200a 2020 2020  ').        .    
-0008ef50: 7072 696e 7428 2720 646f 6e65 2e20 2569  print(' done. %i
-0008ef60: 2073 6e76 732e 2720 2520 6c65 6e28 736e   snvs.' % len(sn
-0008ef70: 765f 6c73 7429 2029 0a20 2020 2066 2e63  v_lst) ).    f.c
-0008ef80: 6c6f 7365 2829 0a0a 2020 2020 0a64 6566  lose()..    .def
-0008ef90: 2073 6176 655f 736e 765f 696e 666f 2820   save_snv_info( 
-0008efa0: 6669 6c65 5f6e 616d 652c 2073 6e76 5f6c  file_name, snv_l
-0008efb0: 7374 2c20 7665 7262 6f73 6520 3d20 4661  st, verbose = Fa
-0008efc0: 6c73 6520 293a 0a0a 2020 2020 6466 203d  lse ):..    df =
-0008efd0: 2070 642e 4461 7461 4672 616d 6528 736e   pd.DataFrame(sn
-0008efe0: 765f 6c73 7429 0a20 2020 2064 662e 746f  v_lst).    df.to
-0008eff0: 5f63 7376 2866 696c 655f 6e61 6d65 2c20  _csv(file_name, 
-0008f000: 696e 6465 783d 4661 6c73 652c 2073 6570  index=False, sep
-0008f010: 3d27 5c74 2729 0a0a 2020 2020 0a64 6566  ='\t')..    .def
-0008f020: 2067 656e 6572 6174 655f 736e 765f 7769   generate_snv_wi
-0008f030: 7468 5f67 7466 2820 6765 6e6f 6d65 2c20  th_gtf( genome, 
-0008f040: 6774 665f 6c69 6e65 735f 736f 7274 6564  gtf_lines_sorted
-0008f050: 2c20 6d75 203d 2032 3030 2c20 6c69 203d  , mu = 200, li =
-0008f060: 2033 2c20 6c64 203d 2033 2c20 6c76 203d   3, ld = 3, lv =
-0008f070: 2032 2c20 7069 203d 2030 2e31 2c20 7064   2, pi = 0.1, pd
-0008f080: 203d 2030 2e31 2029 3a0a 2020 2020 0a20   = 0.1 ):.    . 
-0008f090: 2020 2070 7620 3d20 3120 2d20 7069 202d     pv = 1 - pi -
-0008f0a0: 2070 640a 2020 2020 7072 696e 7428 6765   pd.    print(ge
-0008f0b0: 6e6f 6d65 2e6e 616d 652c 2065 6e64 3d27  nome.name, end='
-0008f0c0: 2027 290a 2020 2020 736e 765f 6c73 7420   ').    snv_lst 
-0008f0d0: 3d20 5b5d 0a20 2020 2063 7572 5f70 6f73  = [].    cur_pos
-0008f0e0: 5f6f 7267 203d 2030 0a20 2020 2063 7572  _org = 0.    cur
-0008f0f0: 5f70 6f73 5f6e 6577 203d 2063 7572 5f70  _pos_new = cur_p
-0008f100: 6f73 5f6f 7267 0a20 2020 2073 6571 5f6e  os_org.    seq_n
-0008f110: 6577 203d 2027 270a 2020 2020 7365 715f  ew = ''.    seq_
-0008f120: 6c73 7420 3d20 5b5d 0a20 2020 204d 6172  lst = [].    Mar
-0008f130: 6769 6e20 3d20 6d61 7828 6c69 2c6d 6178  gin = max(li,max
-0008f140: 286c 642c 6c76 2929 0a20 2020 200a 2020  (ld,lv)).    .  
-0008f150: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
-0008f160: 2867 656e 6f6d 652e 6c65 6e2f 6d75 2f32  (genome.len/mu/2
-0008f170: 3030 290a 2020 2020 0a20 2020 2063 6e74  00).    .    cnt
-0008f180: 203d 2030 0a20 2020 2066 6f72 206c 696e   = 0.    for lin
-0008f190: 6520 696e 2067 7466 5f6c 696e 6573 5f73  e in gtf_lines_s
-0008f1a0: 6f72 7465 643a 0a20 2020 2020 2020 200a  orted:.        .
-0008f1b0: 2020 2020 2020 2020 2320 6469 6666 203d          # diff =
-0008f1c0: 2063 7572 5f70 6f73 5f6e 6577 202d 2063   cur_pos_new - c
-0008f1d0: 7572 5f70 6f73 5f6f 7267 0a20 2020 2020  ur_pos_org.     
-0008f1e0: 2020 2053 7461 7274 203d 206c 696e 652e     Start = line.
-0008f1f0: 7374 6172 740a 2020 2020 2020 2020 456e  start.        En
-0008f200: 6420 3d20 6c69 6e65 2e65 6e64 0a20 2020  d = line.end.   
-0008f210: 2020 2020 204c 203d 206e 702e 7261 6e64       L = np.rand
-0008f220: 6f6d 2e72 616e 6469 6e74 2830 2c6d 752f  om.randint(0,mu/
-0008f230: 322c 3129 5b30 5d0a 2020 2020 2020 2020  2,1)[0].        
-0008f240: 6966 2063 7572 5f70 6f73 5f6f 7267 203c  if cur_pos_org <
-0008f250: 2028 6c69 6e65 2e73 7461 7274 2d31 2b4c   (line.start-1+L
-0008f260: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0008f270: 6578 745f 706f 735f 6f72 6720 3d20 6c69  ext_pos_org = li
-0008f280: 6e65 2e73 7461 7274 2d31 2b4c 0a20 2020  ne.start-1+L.   
-0008f290: 2020 2020 2020 2020 2073 6571 5f6c 7374           seq_lst
-0008f2a0: 2e61 7070 656e 6428 6765 6e6f 6d65 2e73  .append(genome.s
-0008f2b0: 6571 5b69 6e74 2863 7572 5f70 6f73 5f6f  eq[int(cur_pos_o
-0008f2c0: 7267 293a 696e 7428 6e65 7874 5f70 6f73  rg):int(next_pos
-0008f2d0: 5f6f 7267 295d 290a 2020 2020 2020 2020  _org)]).        
-0008f2e0: 2020 2020 6375 725f 706f 735f 6e65 7720      cur_pos_new 
-0008f2f0: 2b3d 2028 6e65 7874 5f70 6f73 5f6f 7267  += (next_pos_org
-0008f300: 2d63 7572 5f70 6f73 5f6f 7267 290a 2020  -cur_pos_org).  
-0008f310: 2020 2020 2020 2020 2020 6375 725f 706f            cur_po
-0008f320: 735f 6f72 6720 3d20 6e65 7874 5f70 6f73  s_org = next_pos
-0008f330: 5f6f 7267 0a20 2020 2020 2020 200a 2020  _org.        .  
-0008f340: 2020 2020 2020 7768 696c 6520 2863 7572        while (cur
-0008f350: 5f70 6f73 5f6f 7267 203c 2028 6c69 6e65  _pos_org < (line
-0008f360: 2e65 6e64 2d4d 6172 6769 6e29 2920 2620  .end-Margin)) & 
-0008f370: 2863 7572 5f70 6f73 5f6f 7267 203e 2028  (cur_pos_org > (
-0008f380: 6c69 6e65 2e73 7461 7274 2b4d 6172 6769  line.start+Margi
-0008f390: 6e29 293a 0a0a 2020 2020 2020 2020 2020  n)):..          
-0008f3a0: 2020 736e 765f 7479 7065 203d 2067 6574    snv_type = get
-0008f3b0: 5f73 6e76 5f74 7970 6528 7069 2c20 7076  _snv_type(pi, pv
-0008f3c0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0008f3d0: 6620 736e 765f 7479 7065 203d 3d20 313a  f snv_type == 1:
-0008f3e0: 2023 2049 6e73 6572 7469 6f6e 0a20 2020   # Insertion.   
-0008f3f0: 2020 2020 2020 2020 2020 2020 206e 203d               n =
-0008f400: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
-0008f410: 6e74 2830 2c6c 692c 2031 295b 305d 2b31  nt(0,li, 1)[0]+1
-0008f420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008f430: 2073 6571 5f66 7261 6720 3d20 7261 6e64   seq_frag = rand
-0008f440: 5f6e 7563 6c65 6f74 6964 6573 286e 290a  _nucleotides(n).
-0008f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f460: 2320 7365 715f 6e65 7720 3d20 7365 715f  # seq_new = seq_
-0008f470: 6e65 7720 2b20 7365 715f 6672 6167 0a20  new + seq_frag. 
-0008f480: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f490: 6571 5f6c 7374 2e61 7070 656e 6428 7365  eq_lst.append(se
-0008f4a0: 715f 6672 6167 290a 2020 2020 2020 2020  q_frag).        
-0008f4b0: 2020 2020 2020 2020 736e 7620 3d20 534e          snv = SN
-0008f4c0: 5628 2067 656e 6f6d 652e 6e61 6d65 2c20  V( genome.name, 
-0008f4d0: 6375 725f 706f 735f 6e65 772b 312c 2063  cur_pos_new+1, c
-0008f4e0: 7572 5f70 6f73 5f6f 7267 2b31 2c20 2749  ur_pos_org+1, 'I
-0008f4f0: 272c 206e 2c20 7365 715f 6672 6167 2c20  ', n, seq_frag, 
-0008f500: 272d 272c 2053 7461 7274 2c20 456e 6420  '-', Start, End 
-0008f510: 2920 2320 6d61 6b65 2069 7420 6f6e 652d  ) # make it one-
-0008f520: 6261 7365 2070 6f73 6974 696f 6e0a 2020  base position.  
-0008f530: 2020 2020 2020 2020 2020 2020 2020 736e                sn
-0008f540: 765f 6c73 742e 6170 7065 6e64 2873 6e76  v_lst.append(snv
-0008f550: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0008f560: 2020 6375 725f 706f 735f 6e65 7720 2b3d    cur_pos_new +=
-0008f570: 206c 656e 2873 6571 5f66 7261 6729 0a0a   len(seq_frag)..
-0008f580: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0008f590: 2073 6e76 5f74 7970 6520 3d3d 2032 3a20   snv_type == 2: 
-0008f5a0: 2320 4465 6c65 7469 6f6e 0a20 2020 2020  # Deletion.     
-0008f5b0: 2020 2020 2020 2020 2020 206e 203d 206e             n = n
-0008f5c0: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
-0008f5d0: 2830 2c6c 642c 2031 295b 305d 2b31 0a20  (0,ld, 1)[0]+1. 
-0008f5e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f5f0: 6571 5f66 7261 6720 3d20 6765 6e6f 6d65  eq_frag = genome
-0008f600: 2e73 6571 5b69 6e74 2863 7572 5f70 6f73  .seq[int(cur_pos
-0008f610: 5f6f 7267 293a 696e 7428 6375 725f 706f  _org):int(cur_po
-0008f620: 735f 6f72 672b 6e29 5d0a 2020 2020 2020  s_org+n)].      
-0008f630: 2020 2020 2020 2020 2020 736e 7620 3d20            snv = 
-0008f640: 534e 5628 2067 656e 6f6d 652e 6e61 6d65  SNV( genome.name
-0008f650: 2c20 6375 725f 706f 735f 6e65 772b 312c  , cur_pos_new+1,
-0008f660: 2063 7572 5f70 6f73 5f6f 7267 2b31 2c20   cur_pos_org+1, 
-0008f670: 2744 272c 206e 2c20 272d 272c 2073 6571  'D', n, '-', seq
-0008f680: 5f66 7261 672c 2053 7461 7274 2c20 456e  _frag, Start, En
-0008f690: 6420 2920 2320 6d61 6b65 2069 7420 6f6e  d ) # make it on
-0008f6a0: 652d 6261 7365 2070 6f73 6974 696f 6e0a  e-base position.
-0008f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f6c0: 736e 765f 6c73 742e 6170 7065 6e64 2873  snv_lst.append(s
-0008f6d0: 6e76 290a 2020 2020 2020 2020 2020 2020  nv).            
-0008f6e0: 2020 2020 6375 725f 706f 735f 6f72 6720      cur_pos_org 
-0008f6f0: 2b3d 206e 0a0a 2020 2020 2020 2020 2020  += n..          
-0008f700: 2020 656c 7365 3a20 2320 534e 500a 2020    else: # SNP.  
-0008f710: 2020 2020 2020 2020 2020 2020 2020 6e20                n 
-0008f720: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-0008f730: 696e 7428 302c 6c76 2c20 3129 5b30 5d2b  int(0,lv, 1)[0]+
-0008f740: 3120 2020 2020 2020 200a 2020 2020 2020  1        .      
-0008f750: 2020 2020 2020 2020 2020 7365 715f 746d            seq_tm
-0008f760: 7020 3d20 6765 6e6f 6d65 2e73 6571 5b69  p = genome.seq[i
-0008f770: 6e74 2863 7572 5f70 6f73 5f6f 7267 293a  nt(cur_pos_org):
-0008f780: 696e 7428 6375 725f 706f 735f 6f72 672b  int(cur_pos_org+
-0008f790: 6e29 5d0a 2020 2020 2020 2020 2020 2020  n)].            
-0008f7a0: 2020 2020 7365 715f 6672 6167 203d 2072      seq_frag = r
-0008f7b0: 616e 645f 6e75 636c 656f 7469 6465 5f65  and_nucleotide_e
-0008f7c0: 7863 6570 7428 7365 715f 746d 7029 0a20  xcept(seq_tmp). 
-0008f7d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0008f7e0: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
-0008f7f0: 6577 202b 2073 6571 5f66 7261 670a 2020  ew + seq_frag.  
-0008f800: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0008f810: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
-0008f820: 5f66 7261 6729 0a20 2020 2020 2020 2020  _frag).         
-0008f830: 2020 2020 2020 2073 6e76 203d 2053 4e56         snv = SNV
-0008f840: 2820 6765 6e6f 6d65 2e6e 616d 652c 2063  ( genome.name, c
-0008f850: 7572 5f70 6f73 5f6e 6577 2b31 2c20 6375  ur_pos_new+1, cu
-0008f860: 725f 706f 735f 6f72 672b 312c 2027 5627  r_pos_org+1, 'V'
-0008f870: 2c20 6e2c 2073 6571 5f66 7261 672c 2073  , n, seq_frag, s
-0008f880: 6571 5f74 6d70 2c20 5374 6172 742c 2045  eq_tmp, Start, E
-0008f890: 6e64 2029 2023 206d 616b 6520 6974 206f  nd ) # make it o
-0008f8a0: 6e65 2d62 6173 6520 706f 7369 7469 6f6e  ne-base position
-0008f8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008f8c0: 2073 6e76 5f6c 7374 2e61 7070 656e 6428   snv_lst.append(
-0008f8d0: 736e 7629 0a20 2020 2020 2020 2020 2020  snv).           
-0008f8e0: 2020 2020 2063 7572 5f70 6f73 5f6e 6577       cur_pos_new
-0008f8f0: 202b 3d20 6e0a 2020 2020 2020 2020 2020   += n.          
-0008f900: 2020 2020 2020 6375 725f 706f 735f 6f72        cur_pos_or
-0008f910: 6720 2b3d 206e 0a0a 2020 2020 2020 2020  g += n..        
-0008f920: 2020 2020 4c20 3d20 6e70 2e72 616e 646f      L = np.rando
-0008f930: 6d2e 7261 6e64 696e 7428 3230 2c6d 752c  m.randint(20,mu,
-0008f940: 3129 5b30 5d20 2320 7365 7061 7261 7465  1)[0] # separate
-0008f950: 2053 4e56 2061 7420 6c65 6173 7420 3230   SNV at least 20
-0008f960: 2062 6173 6573 0a20 2020 2020 2020 2020   bases.         
-0008f970: 2020 206e 6578 745f 706f 735f 6f72 6720     next_pos_org 
-0008f980: 3d20 6375 725f 706f 735f 6f72 6720 2b20  = cur_pos_org + 
-0008f990: 4c0a 2020 2020 2020 2020 2020 2020 6966  L.            if
-0008f9a0: 206e 6578 745f 706f 735f 6f72 6720 3e3d   next_pos_org >=
-0008f9b0: 206c 696e 652e 656e 643a 2023 2028 6765   line.end: # (ge
-0008f9c0: 6e6f 6d65 2e6c 656e 2d31 3030 293a 0a20  nome.len-100):. 
-0008f9d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0008f9e0: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
-0008f9f0: 6577 202b 2067 656e 6f6d 652e 7365 715b  ew + genome.seq[
-0008fa00: 696e 7428 6375 725f 706f 735f 6f72 6729  int(cur_pos_org)
-0008fa10: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-0008fa20: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
-0008fa30: 6428 6765 6e6f 6d65 2e73 6571 5b69 6e74  d(genome.seq[int
-0008fa40: 2863 7572 5f70 6f73 5f6f 7267 293a 286c  (cur_pos_org):(l
-0008fa50: 696e 652e 656e 642b 3129 5d29 0a20 2020  ine.end+1)]).   
-0008fa60: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0008fa70: 5f70 6f73 5f6e 6577 202b 3d20 2828 6c69  _pos_new += ((li
-0008fa80: 6e65 2e65 6e64 2b31 292d 6375 725f 706f  ne.end+1)-cur_po
-0008fa90: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
-0008faa0: 2020 2020 2020 2063 7572 5f70 6f73 5f6f         cur_pos_o
-0008fab0: 7267 203d 2028 6c69 6e65 2e65 6e64 2b31  rg = (line.end+1
-0008fac0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0008fad0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0008fae0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0008faf0: 2020 2020 2020 2020 2020 2320 7365 715f            # seq_
-0008fb00: 6e65 7720 3d20 7365 715f 6e65 7720 2b20  new = seq_new + 
-0008fb10: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
-0008fb20: 7572 5f70 6f73 5f6f 7267 293a 696e 7428  ur_pos_org):int(
-0008fb30: 6e65 7874 5f70 6f73 5f6f 7267 295d 0a20  next_pos_org)]. 
-0008fb40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008fb50: 6571 5f6c 7374 2e61 7070 656e 6428 6765  eq_lst.append(ge
-0008fb60: 6e6f 6d65 2e73 6571 5b69 6e74 2863 7572  nome.seq[int(cur
-0008fb70: 5f70 6f73 5f6f 7267 293a 696e 7428 6e65  _pos_org):int(ne
-0008fb80: 7874 5f70 6f73 5f6f 7267 295d 290a 2020  xt_pos_org)]).  
-0008fb90: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0008fba0: 725f 706f 735f 6e65 7720 2b3d 2028 6e65  r_pos_new += (ne
-0008fbb0: 7874 5f70 6f73 5f6f 7267 2d63 7572 5f70  xt_pos_org-cur_p
-0008fbc0: 6f73 5f6f 7267 290a 2020 2020 2020 2020  os_org).        
-0008fbd0: 2020 2020 2020 2020 6375 725f 706f 735f          cur_pos_
-0008fbe0: 6f72 6720 3d20 6e65 7874 5f70 6f73 5f6f  org = next_pos_o
-0008fbf0: 7267 0a20 2020 2020 2020 2020 2020 2063  rg.            c
-0008fc00: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008fc10: 2020 2020 6966 2063 6e74 2573 7465 7020      if cnt%step 
-0008fc20: 3d3d 2030 3a20 0a20 2020 2020 2020 2020  == 0: .         
-0008fc30: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-0008fc40: 2573 202d 2025 692c 2025 692c 2025 6920  %s - %i, %i, %i 
-0008fc50: 2720 2520 2867 656e 6f6d 652e 6e61 6d65  ' % (genome.name
-0008fc60: 2c20 6375 725f 706f 735f 6f72 672c 2067  , cur_pos_org, g
-0008fc70: 656e 6f6d 652e 6c65 6e2c 2063 7572 5f70  enome.len, cur_p
-0008fc80: 6f73 5f6e 6577 292c 2065 6e64 3d27 2729  os_new), end='')
-0008fc90: 0a20 2020 2020 2020 0a20 2020 2069 6620  .       .    if 
-0008fca0: 6375 725f 706f 735f 6f72 6720 3c20 6765  cur_pos_org < ge
-0008fcb0: 6e6f 6d65 2e6c 656e 3a0a 2020 2020 2020  nome.len:.      
-0008fcc0: 2020 7365 715f 6c73 742e 6170 7065 6e64    seq_lst.append
-0008fcd0: 2867 656e 6f6d 652e 7365 715b 696e 7428  (genome.seq[int(
-0008fce0: 6375 725f 706f 735f 6f72 6729 3a5d 290a  cur_pos_org):]).
-0008fcf0: 2020 2020 0a20 2020 2073 6571 5f6e 6577      .    seq_new
-0008fd00: 203d 2027 272e 6a6f 696e 2873 6571 5f6c   = ''.join(seq_l
-0008fd10: 7374 290a 2020 2020 2320 7375 6666 6978  st).    # suffix
-0008fd20: 203d 2027 2d4c 2569 2d49 2569 2d44 2569   = '-L%i-I%i-D%i
-0008fd30: 2d56 2569 2720 2520 286d 752c 6c69 2c6c  -V%i' % (mu,li,l
-0008fd40: 642c 6c76 290a 2020 2020 2320 6765 6e6f  d,lv).    # geno
-0008fd50: 6d65 5f6e 6577 203d 2047 656e 6f6d 6528  me_new = Genome(
-0008fd60: 2067 656e 6f6d 652e 6865 6164 6572 202b   genome.header +
-0008fd70: 2073 7566 6669 782c 2073 6571 5f6e 6577   suffix, seq_new
-0008fd80: 2029 0a20 2020 2067 656e 6f6d 655f 6e65   ).    genome_ne
-0008fd90: 7720 3d20 4765 6e6f 6d65 2820 6765 6e6f  w = Genome( geno
-0008fda0: 6d65 2e68 6561 6465 722c 2073 6571 5f6e  me.header, seq_n
-0008fdb0: 6577 2029 0a20 2020 2070 7269 6e74 2827  ew ).    print('
-0008fdc0: 2064 6f6e 652e 2729 0a20 2020 2020 2020   done.').       
-0008fdd0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
-0008fde0: 2867 656e 6f6d 655f 6e65 772c 2073 6e76  (genome_new, snv
-0008fdf0: 5f6c 7374 290a 2020 2020 0a23 2323 2323  _lst).    .#####
-0008fe00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008fe10: 2323 2323 2323 2323 2323 230a 2323 2050  ###########.## P
-0008fe20: 6172 616d 6574 6572 7320 666f 7220 534e  arameters for SN
-0008fe30: 5620 6765 6e65 7261 7469 6f6e 0a0a 505f  V generation..P_
-0008fe40: 494e 5320 3d20 302e 3135 0a50 5f44 454c  INS = 0.15.P_DEL
-0008fe50: 203d 2030 2e31 350a 505f 534e 5020 3d20   = 0.15.P_SNP = 
-0008fe60: 3120 2d20 505f 494e 5320 2d20 505f 4445  1 - P_INS - P_DE
-0008fe70: 4c0a 0a4c 4920 3d20 330a 4c44 203d 2033  L..LI = 3.LD = 3
-0008fe80: 0a4c 5620 3d20 320a 4c5f 494e 5445 525f  .LV = 2.L_INTER_
-0008fe90: 534e 5620 3d20 3230 300a 0a23 2323 2323  SNV = 200..#####
-0008fea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008feb0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-0008fec0: 2067 656e 6572 6174 655f 736e 7628 6765   generate_snv(ge
-0008fed0: 6e6f 6d65 2c20 6774 665f 6c69 6e65 732c  nome, gtf_lines,
-0008fee0: 206c 5f69 6e74 6572 5f73 6e76 203d 204c   l_inter_snv = L
-0008fef0: 5f49 4e54 4552 5f53 4e56 2c20 5c0a 2020  _INTER_SNV, \.  
-0008ff00: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0008ff10: 6920 3d20 4c49 2c20 6c64 203d 204c 442c  i = LI, ld = LD,
-0008ff20: 206c 7620 3d20 4c56 2c20 7069 203d 2050   lv = LV, pi = P
-0008ff30: 5f49 4e53 2c20 7064 203d 2050 5f44 454c  _INS, pd = P_DEL
-0008ff40: 293a 0a20 2020 200a 2020 2020 7076 203d  ):.    .    pv =
-0008ff50: 2031 202d 2070 6920 2d20 7064 0a20 2020   1 - pi - pd.   
-0008ff60: 206e 702e 7261 6e64 6f6d 2e73 6565 6428   np.random.seed(
-0008ff70: 3029 0a20 2020 2070 7269 6e74 2827 4765  0).    print('Ge
-0008ff80: 6e65 7261 7469 6e67 2053 4e56 2027 2c65  nerating SNV ',e
-0008ff90: 6e64 3d27 2729 0a20 2020 2046 6561 7475  nd='').    Featu
-0008ffa0: 7265 7320 3d20 6765 745f 636f 6c28 6774  res = get_col(gt
-0008ffb0: 665f 6c69 6e65 732c 2032 290a 2020 2020  f_lines, 2).    
-0008ffc0: 7768 203d 2077 6869 6368 2820 4665 6174  wh = which( Feat
-0008ffd0: 7572 6573 2c20 2765 786f 6e27 2029 0a20  ures, 'exon' ). 
-0008ffe0: 2020 2067 7466 5f65 786f 6e73 203d 205b     gtf_exons = [
-0008fff0: 6774 665f 6c69 6e65 735b 775d 2066 6f72  gtf_lines[w] for
-00090000: 2077 2069 6e20 7768 5d20 0a0a 2020 2020   w in wh] ..    
-00090010: 2320 7072 696e 7428 6c65 6e28 4665 6174  # print(len(Feat
-00090020: 7572 6573 2929 0a20 2020 2043 6872 7320  ures)).    Chrs 
-00090030: 3d20 6765 745f 636f 6c28 6774 665f 6578  = get_col(gtf_ex
-00090040: 6f6e 732c 2030 290a 2020 2020 4368 725f  ons, 0).    Chr_
-00090050: 6e61 6d65 7320 3d20 736f 7274 6564 2873  names = sorted(s
-00090060: 6574 2843 6872 7329 290a 0a20 2020 2073  et(Chrs))..    s
-00090070: 6e76 5f6c 7374 5f61 6c6c 203d 205b 5d0a  nv_lst_all = [].
-00090080: 2020 2020 6765 6e6f 6d65 5f6e 6577 203d      genome_new =
-00090090: 207b 7d0a 2020 2020 666f 7220 4368 7220   {}.    for Chr 
-000900a0: 696e 2043 6872 5f6e 616d 6573 3a0a 2020  in Chr_names:.  
-000900b0: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
-000900c0: 6620 4368 7220 696e 2067 656e 6f6d 652e  f Chr in genome.
-000900d0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-000900e0: 2020 2020 7768 203d 2077 6869 6368 2820      wh = which( 
-000900f0: 4368 7273 2c20 4368 7220 290a 2020 2020  Chrs, Chr ).    
-00090100: 2020 2020 2020 2020 6774 665f 6368 7220          gtf_chr 
-00090110: 3d20 5b67 7466 5f65 786f 6e73 5b77 5d20  = [gtf_exons[w] 
-00090120: 666f 7220 7720 696e 2077 685d 0a20 2020  for w in wh].   
-00090130: 2020 2020 2020 2020 2050 6f73 5f73 7461           Pos_sta
-00090140: 7274 203d 206e 702e 6172 7261 7928 2067  rt = np.array( g
-00090150: 6574 5f63 6f6c 2867 7466 5f63 6872 2c20  et_col(gtf_chr, 
-00090160: 3329 2029 0a20 2020 2020 2020 2020 2020  3) ).           
-00090170: 206f 6472 203d 2050 6f73 5f73 7461 7274   odr = Pos_start
-00090180: 2e61 7267 736f 7274 2829 0a0a 2020 2020  .argsort()..    
-00090190: 2020 2020 2020 2020 6774 665f 6368 725f          gtf_chr_
-000901a0: 736f 7274 6564 203d 205b 5d0a 2020 2020  sorted = [].    
-000901b0: 2020 2020 2020 2020 7070 203d 2030 0a20          pp = 0. 
-000901c0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-000901d0: 2069 6e20 7261 6e67 6528 6c65 6e28 6774   in range(len(gt
-000901e0: 665f 6368 7229 293a 0a20 2020 2020 2020  f_chr)):.       
-000901f0: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-00090200: 6774 665f 6368 725b 6f64 725b 6b5d 5d0a  gtf_chr[odr[k]].
-00090210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090220: 6774 665f 6368 725f 736f 7274 6564 2e61  gtf_chr_sorted.a
-00090230: 7070 656e 6428 6c69 6e65 290a 2020 2020  ppend(line).    
-00090240: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00090250: 696e 652e 7374 6172 7420 3c20 7070 3a20  ine.start < pp: 
-00090260: 7072 696e 7428 6c69 6e65 290a 2020 2020  print(line).    
-00090270: 2020 2020 2020 2020 2020 2020 7070 203d              pp =
-00090280: 206c 696e 652e 7374 6172 740a 0a20 2020   line.start..   
-00090290: 2020 2020 2020 2020 2067 6e6d 2c20 736e           gnm, sn
-000902a0: 765f 6c73 7420 3d20 6765 6e65 7261 7465  v_lst = generate
-000902b0: 5f73 6e76 5f77 6974 685f 6774 6628 2067  _snv_with_gtf( g
-000902c0: 656e 6f6d 655b 4368 725d 2c20 6774 665f  enome[Chr], gtf_
-000902d0: 6368 725f 736f 7274 6564 2c20 6d75 203d  chr_sorted, mu =
-000902e0: 206c 5f69 6e74 6572 5f73 6e76 2c20 5c0a   l_inter_snv, \.
-000902f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008ea90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eaa0: 2323 2323 2323 2323 2323 2323 230a 0a53  #############..S
+0008eab0: 4e56 203d 2063 6f6c 6c65 6374 696f 6e73  NV = collections
+0008eac0: 2e6e 616d 6564 7475 706c 6528 2753 4e56  .namedtuple('SNV
+0008ead0: 272c 2027 6368 722c 2070 6f73 5f6e 6577  ', 'chr, pos_new
+0008eae0: 2c20 706f 735f 6f72 672c 2074 7970 652c  , pos_org, type,
+0008eaf0: 206c 656e 2c20 7365 715f 6e65 772c 2073   len, seq_new, s
+0008eb00: 6571 5f6f 7267 2c20 6578 5f73 7461 7274  eq_org, ex_start
+0008eb10: 2c20 6578 5f65 6e64 2729 0a0a 6465 6620  , ex_end')..def 
+0008eb20: 6765 745f 736e 765f 7479 7065 2870 692c  get_snv_type(pi,
+0008eb30: 2070 6429 3a0a 2020 2020 0a20 2020 2072   pd):.    .    r
+0008eb40: 6e20 3d20 6e70 2e72 616e 646f 6d2e 756e  n = np.random.un
+0008eb50: 6966 6f72 6d28 3130 3029 0a20 2020 2069  iform(100).    i
+0008eb60: 6620 726e 203c 2028 7069 2a31 3030 293a  f rn < (pi*100):
+0008eb70: 0a20 2020 2020 2020 2072 6574 7572 6e28  .        return(
+0008eb80: 3129 0a20 2020 2065 6c69 6620 726e 203c  1).    elif rn <
+0008eb90: 2028 7069 2b70 6929 2a31 3030 3a0a 2020   (pi+pi)*100:.  
+0008eba0: 2020 2020 2020 7265 7475 726e 2832 290a        return(2).
+0008ebb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008ebc0: 2020 7265 7475 726e 2830 290a 2020 2020    return(0).    
+0008ebd0: 0a64 6566 2072 616e 645f 6e75 636c 656f  .def rand_nucleo
+0008ebe0: 7469 6465 5f65 7863 6570 7428 6e74 7329  tide_except(nts)
+0008ebf0: 3a0a 2020 2020 0a20 2020 206e 7473 5f6f  :.    .    nts_o
+0008ec00: 7574 203d 2027 270a 2020 2020 666f 7220  ut = ''.    for 
+0008ec10: 6e74 2069 6e20 6e74 733a 0a20 2020 2020  nt in nts:.     
+0008ec20: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
+0008ec30: 2020 2020 2020 2020 2020 2072 6e20 3d20             rn = 
+0008ec40: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
+0008ec50: 7428 302c 342c 3129 5b30 5d0a 2020 2020  t(0,4,1)[0].    
+0008ec60: 2020 2020 2020 2020 6e74 5f6e 6577 203d          nt_new =
+0008ec70: 204e 545f 6c73 745b 696e 7428 726e 295d   NT_lst[int(rn)]
+0008ec80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0008ec90: 6e74 5f6e 6577 2021 3d20 6e74 3a20 0a20  nt_new != nt: . 
+0008eca0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0008ecb0: 7473 5f6f 7574 203d 206e 7473 5f6f 7574  ts_out = nts_out
+0008ecc0: 202b 206e 745f 6e65 770a 2020 2020 2020   + nt_new.      
+0008ecd0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0008ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008ecf0: 2020 2020 0a20 2020 2072 6574 7572 6e28      .    return(
+0008ed00: 6e74 735f 6f75 7429 0a20 2020 2020 2020  nts_out).       
+0008ed10: 200a 6465 6620 7261 6e64 5f6e 7563 6c65   .def rand_nucle
+0008ed20: 6f74 6964 6573 286e 756d 293a 0a20 2020  otides(num):.   
+0008ed30: 200a 2020 2020 6e75 6d5f 7365 7120 3d20   .    num_seq = 
+0008ed40: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
+0008ed50: 7428 302c 342c 6e75 6d29 0a20 2020 206e  t(0,4,num).    n
+0008ed60: 745f 7374 7220 3d20 2727 2e6a 6f69 6e28  t_str = ''.join(
+0008ed70: 5b4e 545f 6c73 745b 6e5d 2066 6f72 206e  [NT_lst[n] for n
+0008ed80: 2069 6e20 6e75 6d5f 7365 715d 290a 2020   in num_seq]).  
+0008ed90: 2020 7265 7475 726e 286e 745f 7374 7229    return(nt_str)
+0008eda0: 0a0a 0a64 6566 2073 6176 655f 736e 765f  ...def save_snv_
+0008edb0: 696e 666f 5f6f 6c64 2820 6669 6c65 5f6e  info_old( file_n
+0008edc0: 616d 652c 2073 6e76 5f6c 7374 2c20 7665  ame, snv_lst, ve
+0008edd0: 7262 6f73 6520 3d20 4661 6c73 6520 293a  rbose = False ):
+0008ede0: 0a20 2020 200a 2020 2020 6620 3d20 6f70  .    .    f = op
+0008edf0: 656e 2866 696c 655f 6e61 6d65 2c20 2777  en(file_name, 'w
+0008ee00: 742b 2729 0a20 2020 2070 7269 6e74 2827  t+').    print('
+0008ee10: 5361 7669 6e67 2053 4e56 2069 6e66 6f2e  Saving SNV info.
+0008ee20: 2027 2c20 656e 643d 2727 290a 2020 2020   ', end='').    
+0008ee30: 7374 6570 203d 206e 702e 6365 696c 286c  step = np.ceil(l
+0008ee40: 656e 2873 6e76 5f6c 7374 292f 3230 290a  en(snv_lst)/20).
+0008ee50: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
+0008ee60: 6765 286c 656e 2873 6e76 5f6c 7374 2929  ge(len(snv_lst))
+0008ee70: 203a 0a20 2020 2020 2020 2073 6e76 203d   :.        snv =
+0008ee80: 2073 6e76 5f6c 7374 5b6b 5d0a 2020 2020   snv_lst[k].    
+0008ee90: 2020 2020 7320 3d20 2725 732c 2569 2c25      s = '%s,%i,%
+0008eea0: 692c 2573 2c25 692c 2573 2c25 735c 6e27  i,%s,%i,%s,%s\n'
+0008eeb0: 2025 205c 0a20 2020 2020 2020 2028 736e   % \.        (sn
+0008eec0: 762e 6368 722c 2073 6e76 2e70 6f73 5f6e  v.chr, snv.pos_n
+0008eed0: 6577 2c20 736e 762e 706f 735f 6f72 672c  ew, snv.pos_org,
+0008eee0: 2073 6e76 2e74 7970 652c 2073 6e76 2e6c   snv.type, snv.l
+0008eef0: 656e 2c20 736e 762e 7365 715f 6e65 772c  en, snv.seq_new,
+0008ef00: 2073 6e76 2e73 6571 5f6f 7267 2029 0a20   snv.seq_org ). 
+0008ef10: 2020 2020 2020 2066 2e77 7269 7465 6c69         f.writeli
+0008ef20: 6e65 7328 7329 0a20 2020 2020 2020 2069  nes(s).        i
+0008ef30: 6620 6b25 7374 6570 203d 3d20 303a 2070  f k%step == 0: p
+0008ef40: 7269 6e74 2827 2e27 2c65 6e64 3d27 2729  rint('.',end='')
+0008ef50: 0a20 2020 2020 2020 200a 2020 2020 7072  .        .    pr
+0008ef60: 696e 7428 2720 646f 6e65 2e20 2569 2073  int(' done. %i s
+0008ef70: 6e76 732e 2720 2520 6c65 6e28 736e 765f  nvs.' % len(snv_
+0008ef80: 6c73 7429 2029 0a20 2020 2066 2e63 6c6f  lst) ).    f.clo
+0008ef90: 7365 2829 0a0a 2020 2020 0a64 6566 2073  se()..    .def s
+0008efa0: 6176 655f 736e 765f 696e 666f 2820 6669  ave_snv_info( fi
+0008efb0: 6c65 5f6e 616d 652c 2073 6e76 5f6c 7374  le_name, snv_lst
+0008efc0: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
+0008efd0: 6520 293a 0a0a 2020 2020 6466 203d 2070  e ):..    df = p
+0008efe0: 642e 4461 7461 4672 616d 6528 736e 765f  d.DataFrame(snv_
+0008eff0: 6c73 7429 0a20 2020 2064 662e 746f 5f63  lst).    df.to_c
+0008f000: 7376 2866 696c 655f 6e61 6d65 2c20 696e  sv(file_name, in
+0008f010: 6465 783d 4661 6c73 652c 2073 6570 3d27  dex=False, sep='
+0008f020: 5c74 2729 0a0a 2020 2020 0a64 6566 2067  \t')..    .def g
+0008f030: 656e 6572 6174 655f 736e 765f 7769 7468  enerate_snv_with
+0008f040: 5f67 7466 2820 6765 6e6f 6d65 2c20 6774  _gtf( genome, gt
+0008f050: 665f 6c69 6e65 735f 736f 7274 6564 2c20  f_lines_sorted, 
+0008f060: 6d75 203d 2032 3030 2c20 6c69 203d 2033  mu = 200, li = 3
+0008f070: 2c20 6c64 203d 2033 2c20 6c76 203d 2032  , ld = 3, lv = 2
+0008f080: 2c20 7069 203d 2030 2e31 2c20 7064 203d  , pi = 0.1, pd =
+0008f090: 2030 2e31 2029 3a0a 2020 2020 0a20 2020   0.1 ):.    .   
+0008f0a0: 2070 7620 3d20 3120 2d20 7069 202d 2070   pv = 1 - pi - p
+0008f0b0: 640a 2020 2020 7072 696e 7428 6765 6e6f  d.    print(geno
+0008f0c0: 6d65 2e6e 616d 652c 2065 6e64 3d27 2027  me.name, end=' '
+0008f0d0: 290a 2020 2020 736e 765f 6c73 7420 3d20  ).    snv_lst = 
+0008f0e0: 5b5d 0a20 2020 2063 7572 5f70 6f73 5f6f  [].    cur_pos_o
+0008f0f0: 7267 203d 2030 0a20 2020 2063 7572 5f70  rg = 0.    cur_p
+0008f100: 6f73 5f6e 6577 203d 2063 7572 5f70 6f73  os_new = cur_pos
+0008f110: 5f6f 7267 0a20 2020 2073 6571 5f6e 6577  _org.    seq_new
+0008f120: 203d 2027 270a 2020 2020 7365 715f 6c73   = ''.    seq_ls
+0008f130: 7420 3d20 5b5d 0a20 2020 204d 6172 6769  t = [].    Margi
+0008f140: 6e20 3d20 6d61 7828 6c69 2c6d 6178 286c  n = max(li,max(l
+0008f150: 642c 6c76 2929 0a20 2020 200a 2020 2020  d,lv)).    .    
+0008f160: 7374 6570 203d 206e 702e 6365 696c 2867  step = np.ceil(g
+0008f170: 656e 6f6d 652e 6c65 6e2f 6d75 2f32 3030  enome.len/mu/200
+0008f180: 290a 2020 2020 0a20 2020 2063 6e74 203d  ).    .    cnt =
+0008f190: 2030 0a20 2020 2066 6f72 206c 696e 6520   0.    for line 
+0008f1a0: 696e 2067 7466 5f6c 696e 6573 5f73 6f72  in gtf_lines_sor
+0008f1b0: 7465 643a 0a20 2020 2020 2020 200a 2020  ted:.        .  
+0008f1c0: 2020 2020 2020 2320 6469 6666 203d 2063        # diff = c
+0008f1d0: 7572 5f70 6f73 5f6e 6577 202d 2063 7572  ur_pos_new - cur
+0008f1e0: 5f70 6f73 5f6f 7267 0a20 2020 2020 2020  _pos_org.       
+0008f1f0: 2053 7461 7274 203d 206c 696e 652e 7374   Start = line.st
+0008f200: 6172 740a 2020 2020 2020 2020 456e 6420  art.        End 
+0008f210: 3d20 6c69 6e65 2e65 6e64 0a20 2020 2020  = line.end.     
+0008f220: 2020 204c 203d 206e 702e 7261 6e64 6f6d     L = np.random
+0008f230: 2e72 616e 6469 6e74 2830 2c6d 752f 322c  .randint(0,mu/2,
+0008f240: 3129 5b30 5d0a 2020 2020 2020 2020 6966  1)[0].        if
+0008f250: 2063 7572 5f70 6f73 5f6f 7267 203c 2028   cur_pos_org < (
+0008f260: 6c69 6e65 2e73 7461 7274 2d31 2b4c 293a  line.start-1+L):
+0008f270: 0a20 2020 2020 2020 2020 2020 206e 6578  .            nex
+0008f280: 745f 706f 735f 6f72 6720 3d20 6c69 6e65  t_pos_org = line
+0008f290: 2e73 7461 7274 2d31 2b4c 0a20 2020 2020  .start-1+L.     
+0008f2a0: 2020 2020 2020 2073 6571 5f6c 7374 2e61         seq_lst.a
+0008f2b0: 7070 656e 6428 6765 6e6f 6d65 2e73 6571  ppend(genome.seq
+0008f2c0: 5b69 6e74 2863 7572 5f70 6f73 5f6f 7267  [int(cur_pos_org
+0008f2d0: 293a 696e 7428 6e65 7874 5f70 6f73 5f6f  ):int(next_pos_o
+0008f2e0: 7267 295d 290a 2020 2020 2020 2020 2020  rg)]).          
+0008f2f0: 2020 6375 725f 706f 735f 6e65 7720 2b3d    cur_pos_new +=
+0008f300: 2028 6e65 7874 5f70 6f73 5f6f 7267 2d63   (next_pos_org-c
+0008f310: 7572 5f70 6f73 5f6f 7267 290a 2020 2020  ur_pos_org).    
+0008f320: 2020 2020 2020 2020 6375 725f 706f 735f          cur_pos_
+0008f330: 6f72 6720 3d20 6e65 7874 5f70 6f73 5f6f  org = next_pos_o
+0008f340: 7267 0a20 2020 2020 2020 200a 2020 2020  rg.        .    
+0008f350: 2020 2020 7768 696c 6520 2863 7572 5f70      while (cur_p
+0008f360: 6f73 5f6f 7267 203c 2028 6c69 6e65 2e65  os_org < (line.e
+0008f370: 6e64 2d4d 6172 6769 6e29 2920 2620 2863  nd-Margin)) & (c
+0008f380: 7572 5f70 6f73 5f6f 7267 203e 2028 6c69  ur_pos_org > (li
+0008f390: 6e65 2e73 7461 7274 2b4d 6172 6769 6e29  ne.start+Margin)
+0008f3a0: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+0008f3b0: 736e 765f 7479 7065 203d 2067 6574 5f73  snv_type = get_s
+0008f3c0: 6e76 5f74 7970 6528 7069 2c20 7076 290a  nv_type(pi, pv).
+0008f3d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0008f3e0: 736e 765f 7479 7065 203d 3d20 313a 2023  snv_type == 1: #
+0008f3f0: 2049 6e73 6572 7469 6f6e 0a20 2020 2020   Insertion.     
+0008f400: 2020 2020 2020 2020 2020 206e 203d 206e             n = n
+0008f410: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
+0008f420: 2830 2c6c 692c 2031 295b 305d 2b31 0a20  (0,li, 1)[0]+1. 
+0008f430: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008f440: 6571 5f66 7261 6720 3d20 7261 6e64 5f6e  eq_frag = rand_n
+0008f450: 7563 6c65 6f74 6964 6573 286e 290a 2020  ucleotides(n).  
+0008f460: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0008f470: 7365 715f 6e65 7720 3d20 7365 715f 6e65  seq_new = seq_ne
+0008f480: 7720 2b20 7365 715f 6672 6167 0a20 2020  w + seq_frag.   
+0008f490: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+0008f4a0: 5f6c 7374 2e61 7070 656e 6428 7365 715f  _lst.append(seq_
+0008f4b0: 6672 6167 290a 2020 2020 2020 2020 2020  frag).          
+0008f4c0: 2020 2020 2020 736e 7620 3d20 534e 5628        snv = SNV(
+0008f4d0: 2067 656e 6f6d 652e 6e61 6d65 2c20 6375   genome.name, cu
+0008f4e0: 725f 706f 735f 6e65 772b 312c 2063 7572  r_pos_new+1, cur
+0008f4f0: 5f70 6f73 5f6f 7267 2b31 2c20 2749 272c  _pos_org+1, 'I',
+0008f500: 206e 2c20 7365 715f 6672 6167 2c20 272d   n, seq_frag, '-
+0008f510: 272c 2053 7461 7274 2c20 456e 6420 2920  ', Start, End ) 
+0008f520: 2320 6d61 6b65 2069 7420 6f6e 652d 6261  # make it one-ba
+0008f530: 7365 2070 6f73 6974 696f 6e0a 2020 2020  se position.    
+0008f540: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
+0008f550: 6c73 742e 6170 7065 6e64 2873 6e76 290a  lst.append(snv).
+0008f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f570: 6375 725f 706f 735f 6e65 7720 2b3d 206c  cur_pos_new += l
+0008f580: 656e 2873 6571 5f66 7261 6729 0a0a 2020  en(seq_frag)..  
+0008f590: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+0008f5a0: 6e76 5f74 7970 6520 3d3d 2032 3a20 2320  nv_type == 2: # 
+0008f5b0: 4465 6c65 7469 6f6e 0a20 2020 2020 2020  Deletion.       
+0008f5c0: 2020 2020 2020 2020 206e 203d 206e 702e           n = np.
+0008f5d0: 7261 6e64 6f6d 2e72 616e 6469 6e74 2830  random.randint(0
+0008f5e0: 2c6c 642c 2031 295b 305d 2b31 0a20 2020  ,ld, 1)[0]+1.   
+0008f5f0: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+0008f600: 5f66 7261 6720 3d20 6765 6e6f 6d65 2e73  _frag = genome.s
+0008f610: 6571 5b69 6e74 2863 7572 5f70 6f73 5f6f  eq[int(cur_pos_o
+0008f620: 7267 293a 696e 7428 6375 725f 706f 735f  rg):int(cur_pos_
+0008f630: 6f72 672b 6e29 5d0a 2020 2020 2020 2020  org+n)].        
+0008f640: 2020 2020 2020 2020 736e 7620 3d20 534e          snv = SN
+0008f650: 5628 2067 656e 6f6d 652e 6e61 6d65 2c20  V( genome.name, 
+0008f660: 6375 725f 706f 735f 6e65 772b 312c 2063  cur_pos_new+1, c
+0008f670: 7572 5f70 6f73 5f6f 7267 2b31 2c20 2744  ur_pos_org+1, 'D
+0008f680: 272c 206e 2c20 272d 272c 2073 6571 5f66  ', n, '-', seq_f
+0008f690: 7261 672c 2053 7461 7274 2c20 456e 6420  rag, Start, End 
+0008f6a0: 2920 2320 6d61 6b65 2069 7420 6f6e 652d  ) # make it one-
+0008f6b0: 6261 7365 2070 6f73 6974 696f 6e0a 2020  base position.  
+0008f6c0: 2020 2020 2020 2020 2020 2020 2020 736e                sn
+0008f6d0: 765f 6c73 742e 6170 7065 6e64 2873 6e76  v_lst.append(snv
+0008f6e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0008f6f0: 2020 6375 725f 706f 735f 6f72 6720 2b3d    cur_pos_org +=
+0008f700: 206e 0a0a 2020 2020 2020 2020 2020 2020   n..            
+0008f710: 656c 7365 3a20 2320 534e 500a 2020 2020  else: # SNP.    
+0008f720: 2020 2020 2020 2020 2020 2020 6e20 3d20              n = 
+0008f730: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
+0008f740: 7428 302c 6c76 2c20 3129 5b30 5d2b 3120  t(0,lv, 1)[0]+1 
+0008f750: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0008f760: 2020 2020 2020 2020 7365 715f 746d 7020          seq_tmp 
+0008f770: 3d20 6765 6e6f 6d65 2e73 6571 5b69 6e74  = genome.seq[int
+0008f780: 2863 7572 5f70 6f73 5f6f 7267 293a 696e  (cur_pos_org):in
+0008f790: 7428 6375 725f 706f 735f 6f72 672b 6e29  t(cur_pos_org+n)
+0008f7a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0008f7b0: 2020 7365 715f 6672 6167 203d 2072 616e    seq_frag = ran
+0008f7c0: 645f 6e75 636c 656f 7469 6465 5f65 7863  d_nucleotide_exc
+0008f7d0: 6570 7428 7365 715f 746d 7029 0a20 2020  ept(seq_tmp).   
+0008f7e0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+0008f7f0: 6571 5f6e 6577 203d 2073 6571 5f6e 6577  eq_new = seq_new
+0008f800: 202b 2073 6571 5f66 7261 670a 2020 2020   + seq_frag.    
+0008f810: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
+0008f820: 6c73 742e 6170 7065 6e64 2873 6571 5f66  lst.append(seq_f
+0008f830: 7261 6729 0a20 2020 2020 2020 2020 2020  rag).           
+0008f840: 2020 2020 2073 6e76 203d 2053 4e56 2820       snv = SNV( 
+0008f850: 6765 6e6f 6d65 2e6e 616d 652c 2063 7572  genome.name, cur
+0008f860: 5f70 6f73 5f6e 6577 2b31 2c20 6375 725f  _pos_new+1, cur_
+0008f870: 706f 735f 6f72 672b 312c 2027 5627 2c20  pos_org+1, 'V', 
+0008f880: 6e2c 2073 6571 5f66 7261 672c 2073 6571  n, seq_frag, seq
+0008f890: 5f74 6d70 2c20 5374 6172 742c 2045 6e64  _tmp, Start, End
+0008f8a0: 2029 2023 206d 616b 6520 6974 206f 6e65   ) # make it one
+0008f8b0: 2d62 6173 6520 706f 7369 7469 6f6e 0a20  -base position. 
+0008f8c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008f8d0: 6e76 5f6c 7374 2e61 7070 656e 6428 736e  nv_lst.append(sn
+0008f8e0: 7629 0a20 2020 2020 2020 2020 2020 2020  v).             
+0008f8f0: 2020 2063 7572 5f70 6f73 5f6e 6577 202b     cur_pos_new +
+0008f900: 3d20 6e0a 2020 2020 2020 2020 2020 2020  = n.            
+0008f910: 2020 2020 6375 725f 706f 735f 6f72 6720      cur_pos_org 
+0008f920: 2b3d 206e 0a0a 2020 2020 2020 2020 2020  += n..          
+0008f930: 2020 4c20 3d20 6e70 2e72 616e 646f 6d2e    L = np.random.
+0008f940: 7261 6e64 696e 7428 3230 2c6d 752c 3129  randint(20,mu,1)
+0008f950: 5b30 5d20 2320 7365 7061 7261 7465 2053  [0] # separate S
+0008f960: 4e56 2061 7420 6c65 6173 7420 3230 2062  NV at least 20 b
+0008f970: 6173 6573 0a20 2020 2020 2020 2020 2020  ases.           
+0008f980: 206e 6578 745f 706f 735f 6f72 6720 3d20   next_pos_org = 
+0008f990: 6375 725f 706f 735f 6f72 6720 2b20 4c0a  cur_pos_org + L.
+0008f9a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0008f9b0: 6578 745f 706f 735f 6f72 6720 3e3d 206c  ext_pos_org >= l
+0008f9c0: 696e 652e 656e 643a 2023 2028 6765 6e6f  ine.end: # (geno
+0008f9d0: 6d65 2e6c 656e 2d31 3030 293a 0a20 2020  me.len-100):.   
+0008f9e0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+0008f9f0: 6571 5f6e 6577 203d 2073 6571 5f6e 6577  eq_new = seq_new
+0008fa00: 202b 2067 656e 6f6d 652e 7365 715b 696e   + genome.seq[in
+0008fa10: 7428 6375 725f 706f 735f 6f72 6729 3a5d  t(cur_pos_org):]
+0008fa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008fa30: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
+0008fa40: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
+0008fa50: 7572 5f70 6f73 5f6f 7267 293a 286c 696e  ur_pos_org):(lin
+0008fa60: 652e 656e 642b 3129 5d29 0a20 2020 2020  e.end+1)]).     
+0008fa70: 2020 2020 2020 2020 2020 2063 7572 5f70             cur_p
+0008fa80: 6f73 5f6e 6577 202b 3d20 2828 6c69 6e65  os_new += ((line
+0008fa90: 2e65 6e64 2b31 292d 6375 725f 706f 735f  .end+1)-cur_pos_
+0008faa0: 6f72 6729 0a20 2020 2020 2020 2020 2020  org).           
+0008fab0: 2020 2020 2063 7572 5f70 6f73 5f6f 7267       cur_pos_org
+0008fac0: 203d 2028 6c69 6e65 2e65 6e64 2b31 290a   = (line.end+1).
+0008fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008fae0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0008faf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008fb00: 2020 2020 2020 2020 2320 7365 715f 6e65          # seq_ne
+0008fb10: 7720 3d20 7365 715f 6e65 7720 2b20 6765  w = seq_new + ge
+0008fb20: 6e6f 6d65 2e73 6571 5b69 6e74 2863 7572  nome.seq[int(cur
+0008fb30: 5f70 6f73 5f6f 7267 293a 696e 7428 6e65  _pos_org):int(ne
+0008fb40: 7874 5f70 6f73 5f6f 7267 295d 0a20 2020  xt_pos_org)].   
+0008fb50: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+0008fb60: 5f6c 7374 2e61 7070 656e 6428 6765 6e6f  _lst.append(geno
+0008fb70: 6d65 2e73 6571 5b69 6e74 2863 7572 5f70  me.seq[int(cur_p
+0008fb80: 6f73 5f6f 7267 293a 696e 7428 6e65 7874  os_org):int(next
+0008fb90: 5f70 6f73 5f6f 7267 295d 290a 2020 2020  _pos_org)]).    
+0008fba0: 2020 2020 2020 2020 2020 2020 6375 725f              cur_
+0008fbb0: 706f 735f 6e65 7720 2b3d 2028 6e65 7874  pos_new += (next
+0008fbc0: 5f70 6f73 5f6f 7267 2d63 7572 5f70 6f73  _pos_org-cur_pos
+0008fbd0: 5f6f 7267 290a 2020 2020 2020 2020 2020  _org).          
+0008fbe0: 2020 2020 2020 6375 725f 706f 735f 6f72        cur_pos_or
+0008fbf0: 6720 3d20 6e65 7874 5f70 6f73 5f6f 7267  g = next_pos_org
+0008fc00: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
+0008fc10: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0008fc20: 2020 6966 2063 6e74 2573 7465 7020 3d3d    if cnt%step ==
+0008fc30: 2030 3a20 0a20 2020 2020 2020 2020 2020   0: .           
+0008fc40: 2020 2020 2070 7269 6e74 2827 5c72 2573       print('\r%s
+0008fc50: 202d 2025 692c 2025 692c 2025 6920 2720   - %i, %i, %i ' 
+0008fc60: 2520 2867 656e 6f6d 652e 6e61 6d65 2c20  % (genome.name, 
+0008fc70: 6375 725f 706f 735f 6f72 672c 2067 656e  cur_pos_org, gen
+0008fc80: 6f6d 652e 6c65 6e2c 2063 7572 5f70 6f73  ome.len, cur_pos
+0008fc90: 5f6e 6577 292c 2065 6e64 3d27 2729 0a20  _new), end=''). 
+0008fca0: 2020 2020 2020 0a20 2020 2069 6620 6375        .    if cu
+0008fcb0: 725f 706f 735f 6f72 6720 3c20 6765 6e6f  r_pos_org < geno
+0008fcc0: 6d65 2e6c 656e 3a0a 2020 2020 2020 2020  me.len:.        
+0008fcd0: 7365 715f 6c73 742e 6170 7065 6e64 2867  seq_lst.append(g
+0008fce0: 656e 6f6d 652e 7365 715b 696e 7428 6375  enome.seq[int(cu
+0008fcf0: 725f 706f 735f 6f72 6729 3a5d 290a 2020  r_pos_org):]).  
+0008fd00: 2020 0a20 2020 2073 6571 5f6e 6577 203d    .    seq_new =
+0008fd10: 2027 272e 6a6f 696e 2873 6571 5f6c 7374   ''.join(seq_lst
+0008fd20: 290a 2020 2020 2320 7375 6666 6978 203d  ).    # suffix =
+0008fd30: 2027 2d4c 2569 2d49 2569 2d44 2569 2d56   '-L%i-I%i-D%i-V
+0008fd40: 2569 2720 2520 286d 752c 6c69 2c6c 642c  %i' % (mu,li,ld,
+0008fd50: 6c76 290a 2020 2020 2320 6765 6e6f 6d65  lv).    # genome
+0008fd60: 5f6e 6577 203d 2047 656e 6f6d 6528 2067  _new = Genome( g
+0008fd70: 656e 6f6d 652e 6865 6164 6572 202b 2073  enome.header + s
+0008fd80: 7566 6669 782c 2073 6571 5f6e 6577 2029  uffix, seq_new )
+0008fd90: 0a20 2020 2067 656e 6f6d 655f 6e65 7720  .    genome_new 
+0008fda0: 3d20 4765 6e6f 6d65 2820 6765 6e6f 6d65  = Genome( genome
+0008fdb0: 2e68 6561 6465 722c 2073 6571 5f6e 6577  .header, seq_new
+0008fdc0: 2029 0a20 2020 2070 7269 6e74 2827 2064   ).    print(' d
+0008fdd0: 6f6e 652e 2729 0a20 2020 2020 2020 2020  one.').         
+0008fde0: 2020 200a 2020 2020 7265 7475 726e 2867     .    return(g
+0008fdf0: 656e 6f6d 655f 6e65 772c 2073 6e76 5f6c  enome_new, snv_l
+0008fe00: 7374 290a 2020 2020 0a23 2323 2323 2323  st).    .#######
+0008fe10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008fe20: 2323 2323 2323 2323 230a 2323 2050 6172  #########.## Par
+0008fe30: 616d 6574 6572 7320 666f 7220 534e 5620  ameters for SNV 
+0008fe40: 6765 6e65 7261 7469 6f6e 0a0a 505f 494e  generation..P_IN
+0008fe50: 5320 3d20 302e 3135 0a50 5f44 454c 203d  S = 0.15.P_DEL =
+0008fe60: 2030 2e31 350a 505f 534e 5020 3d20 3120   0.15.P_SNP = 1 
+0008fe70: 2d20 505f 494e 5320 2d20 505f 4445 4c0a  - P_INS - P_DEL.
+0008fe80: 0a4c 4920 3d20 330a 4c44 203d 2033 0a4c  .LI = 3.LD = 3.L
+0008fe90: 5620 3d20 320a 4c5f 494e 5445 525f 534e  V = 2.L_INTER_SN
+0008fea0: 5620 3d20 3230 300a 0a23 2323 2323 2323  V = 200..#######
+0008feb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008fec0: 2323 2323 2323 2323 230a 0a64 6566 2067  #########..def g
+0008fed0: 656e 6572 6174 655f 736e 7628 6765 6e6f  enerate_snv(geno
+0008fee0: 6d65 2c20 6774 665f 6c69 6e65 732c 206c  me, gtf_lines, l
+0008fef0: 5f69 6e74 6572 5f73 6e76 203d 204c 5f49  _inter_snv = L_I
+0008ff00: 4e54 4552 5f53 4e56 2c20 5c0a 2020 2020  NTER_SNV, \.    
+0008ff10: 2020 2020 2020 2020 2020 2020 206c 6920               li 
+0008ff20: 3d20 4c49 2c20 6c64 203d 204c 442c 206c  = LI, ld = LD, l
+0008ff30: 7620 3d20 4c56 2c20 7069 203d 2050 5f49  v = LV, pi = P_I
+0008ff40: 4e53 2c20 7064 203d 2050 5f44 454c 293a  NS, pd = P_DEL):
+0008ff50: 0a20 2020 200a 2020 2020 7076 203d 2031  .    .    pv = 1
+0008ff60: 202d 2070 6920 2d20 7064 0a20 2020 206e   - pi - pd.    n
+0008ff70: 702e 7261 6e64 6f6d 2e73 6565 6428 3029  p.random.seed(0)
+0008ff80: 0a20 2020 2070 7269 6e74 2827 4765 6e65  .    print('Gene
+0008ff90: 7261 7469 6e67 2053 4e56 2027 2c65 6e64  rating SNV ',end
+0008ffa0: 3d27 2729 0a20 2020 2046 6561 7475 7265  ='').    Feature
+0008ffb0: 7320 3d20 6765 745f 636f 6c28 6774 665f  s = get_col(gtf_
+0008ffc0: 6c69 6e65 732c 2032 290a 2020 2020 7768  lines, 2).    wh
+0008ffd0: 203d 2077 6869 6368 2820 4665 6174 7572   = which( Featur
+0008ffe0: 6573 2c20 2765 786f 6e27 2029 0a20 2020  es, 'exon' ).   
+0008fff0: 2067 7466 5f65 786f 6e73 203d 205b 6774   gtf_exons = [gt
+00090000: 665f 6c69 6e65 735b 775d 2066 6f72 2077  f_lines[w] for w
+00090010: 2069 6e20 7768 5d20 0a0a 2020 2020 2320   in wh] ..    # 
+00090020: 7072 696e 7428 6c65 6e28 4665 6174 7572  print(len(Featur
+00090030: 6573 2929 0a20 2020 2043 6872 7320 3d20  es)).    Chrs = 
+00090040: 6765 745f 636f 6c28 6774 665f 6578 6f6e  get_col(gtf_exon
+00090050: 732c 2030 290a 2020 2020 4368 725f 6e61  s, 0).    Chr_na
+00090060: 6d65 7320 3d20 736f 7274 6564 2873 6574  mes = sorted(set
+00090070: 2843 6872 7329 290a 0a20 2020 2073 6e76  (Chrs))..    snv
+00090080: 5f6c 7374 5f61 6c6c 203d 205b 5d0a 2020  _lst_all = [].  
+00090090: 2020 6765 6e6f 6d65 5f6e 6577 203d 207b    genome_new = {
+000900a0: 7d0a 2020 2020 666f 7220 4368 7220 696e  }.    for Chr in
+000900b0: 2043 6872 5f6e 616d 6573 3a0a 2020 2020   Chr_names:.    
+000900c0: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+000900d0: 4368 7220 696e 2067 656e 6f6d 652e 6b65  Chr in genome.ke
+000900e0: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
+000900f0: 2020 7768 203d 2077 6869 6368 2820 4368    wh = which( Ch
+00090100: 7273 2c20 4368 7220 290a 2020 2020 2020  rs, Chr ).      
+00090110: 2020 2020 2020 6774 665f 6368 7220 3d20        gtf_chr = 
+00090120: 5b67 7466 5f65 786f 6e73 5b77 5d20 666f  [gtf_exons[w] fo
+00090130: 7220 7720 696e 2077 685d 0a20 2020 2020  r w in wh].     
+00090140: 2020 2020 2020 2050 6f73 5f73 7461 7274         Pos_start
+00090150: 203d 206e 702e 6172 7261 7928 2067 6574   = np.array( get
+00090160: 5f63 6f6c 2867 7466 5f63 6872 2c20 3329  _col(gtf_chr, 3)
+00090170: 2029 0a20 2020 2020 2020 2020 2020 206f   ).            o
+00090180: 6472 203d 2050 6f73 5f73 7461 7274 2e61  dr = Pos_start.a
+00090190: 7267 736f 7274 2829 0a0a 2020 2020 2020  rgsort()..      
+000901a0: 2020 2020 2020 6774 665f 6368 725f 736f        gtf_chr_so
+000901b0: 7274 6564 203d 205b 5d0a 2020 2020 2020  rted = [].      
+000901c0: 2020 2020 2020 7070 203d 2030 0a20 2020        pp = 0.   
+000901d0: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
+000901e0: 6e20 7261 6e67 6528 6c65 6e28 6774 665f  n range(len(gtf_
+000901f0: 6368 7229 293a 0a20 2020 2020 2020 2020  chr)):.         
+00090200: 2020 2020 2020 206c 696e 6520 3d20 6774         line = gt
+00090210: 665f 6368 725b 6f64 725b 6b5d 5d0a 2020  f_chr[odr[k]].  
+00090220: 2020 2020 2020 2020 2020 2020 2020 6774                gt
+00090230: 665f 6368 725f 736f 7274 6564 2e61 7070  f_chr_sorted.app
+00090240: 656e 6428 6c69 6e65 290a 2020 2020 2020  end(line).      
+00090250: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
+00090260: 652e 7374 6172 7420 3c20 7070 3a20 7072  e.start < pp: pr
+00090270: 696e 7428 6c69 6e65 290a 2020 2020 2020  int(line).      
+00090280: 2020 2020 2020 2020 2020 7070 203d 206c            pp = l
+00090290: 696e 652e 7374 6172 740a 0a20 2020 2020  ine.start..     
+000902a0: 2020 2020 2020 2067 6e6d 2c20 736e 765f         gnm, snv_
+000902b0: 6c73 7420 3d20 6765 6e65 7261 7465 5f73  lst = generate_s
+000902c0: 6e76 5f77 6974 685f 6774 6628 2067 656e  nv_with_gtf( gen
+000902d0: 6f6d 655b 4368 725d 2c20 6774 665f 6368  ome[Chr], gtf_ch
+000902e0: 725f 736f 7274 6564 2c20 6d75 203d 206c  r_sorted, mu = l
+000902f0: 5f69 6e74 6572 5f73 6e76 2c20 5c0a 2020  _inter_snv, \.  
 00090300: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00090310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090320: 2020 6c69 203d 206c 692c 206c 6420 3d20    li = li, ld = 
-00090330: 6c64 2c20 6c76 203d 206c 762c 2070 6920  ld, lv = lv, pi 
-00090340: 3d20 7069 2c20 7064 203d 2070 6420 290a  = pi, pd = pd ).
-00090350: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
-00090360: 6c73 745f 616c 6c20 3d20 736e 765f 6c73  lst_all = snv_ls
-00090370: 745f 616c 6c20 2b20 736e 765f 6c73 740a  t_all + snv_lst.
-00090380: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
-00090390: 6d65 5f6e 6577 5b43 6872 5d20 3d20 676e  me_new[Chr] = gn
-000903a0: 6d0a 2020 2020 200a 2020 2020 7265 7475  m.     .    retu
-000903b0: 726e 2867 656e 6f6d 655f 6e65 772c 2073  rn(genome_new, s
-000903c0: 6e76 5f6c 7374 5f61 6c6c 2c20 4665 6174  nv_lst_all, Feat
-000903d0: 7572 6573 290a 2020 2020 0a23 2323 2323  ures).    .#####
-000903e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090330: 6c69 203d 206c 692c 206c 6420 3d20 6c64  li = li, ld = ld
+00090340: 2c20 6c76 203d 206c 762c 2070 6920 3d20  , lv = lv, pi = 
+00090350: 7069 2c20 7064 203d 2070 6420 290a 2020  pi, pd = pd ).  
+00090360: 2020 2020 2020 2020 2020 736e 765f 6c73            snv_ls
+00090370: 745f 616c 6c20 3d20 736e 765f 6c73 745f  t_all = snv_lst_
+00090380: 616c 6c20 2b20 736e 765f 6c73 740a 2020  all + snv_lst.  
+00090390: 2020 2020 2020 2020 2020 6765 6e6f 6d65            genome
+000903a0: 5f6e 6577 5b43 6872 5d20 3d20 676e 6d0a  _new[Chr] = gnm.
+000903b0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
+000903c0: 2867 656e 6f6d 655f 6e65 772c 2073 6e76  (genome_new, snv
+000903d0: 5f6c 7374 5f61 6c6c 2c20 4665 6174 7572  _lst_all, Featur
+000903e0: 6573 290a 2020 2020 0a23 2323 2323 2323  es).    .#######
 000903f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00090400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00090410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090420: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
-00090430: 2046 756e 6374 696f 6e73 2066 6f72 2065   Functions for e
-00090440: 7661 6c75 6174 696f 6e20 6f66 2053 4e56  valuation of SNV
-00090450: 2064 6574 6563 7469 6f6e 0a23 2323 2323   detection.#####
-00090460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090430: 2323 2323 2323 2323 2323 230a 2323 2046  ###########.## F
+00090440: 756e 6374 696f 6e73 2066 6f72 2065 7661  unctions for eva
+00090450: 6c75 6174 696f 6e20 6f66 2053 4e56 2064  luation of SNV d
+00090460: 6574 6563 7469 6f6e 0a23 2323 2323 2323  etection.#######
 00090470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00090480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00090490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000904a0: 2323 2323 2323 2323 2323 2323 230a 0a64  #############..d
-000904b0: 6566 2067 6574 5f73 7061 6e5f 6c73 7428  ef get_span_lst(
-000904c0: 7267 6e73 5f6c 7374 5f6d 692c 2054 7970  rgns_lst_mi, Typ
-000904d0: 6520 3d20 274d 2729 3a0a 2020 2020 0a20  e = 'M'):.    . 
-000904e0: 2020 2073 7061 6e5f 6c73 7420 3d20 5b5d     span_lst = []
-000904f0: 0a20 2020 2066 6f72 2072 5f6d 2069 6e20  .    for r_m in 
-00090500: 7267 6e73 5f6c 7374 5f6d 693a 0a20 2020  rgns_lst_mi:.   
-00090510: 2020 2020 2073 706e 203d 2072 5f6d 2e67       spn = r_m.g
-00090520: 6574 5f73 7061 6e28 290a 2020 2020 2020  et_span().      
-00090530: 2020 7370 6e2e 7479 7065 203d 2054 7970    spn.type = Typ
-00090540: 650a 2020 2020 2020 2020 7370 616e 5f6c  e.        span_l
-00090550: 7374 2e61 7070 656e 6428 2073 706e 2029  st.append( spn )
-00090560: 0a20 2020 2072 6574 7572 6e28 7370 616e  .    return(span
-00090570: 5f6c 7374 290a 0a23 2320 5365 6c65 6374  _lst)..## Select
-00090580: 2053 4e56 2773 2074 6861 7420 6661 6c6c   SNV's that fall
-00090590: 7320 7769 7468 696e 2074 6865 2063 6f76  s within the cov
-000905a0: 6572 6564 2072 6567 696f 6e0a 6465 6620  ered region.def 
-000905b0: 7365 6c65 6374 5f73 6e76 7328 2064 665f  select_snvs( df_
-000905c0: 736e 762c 2073 7061 6e5f 6c73 742c 2072  snv, span_lst, r
-000905d0: 676e 735f 6c73 745f 6d69 2c20 5479 7065  gns_lst_mi, Type
-000905e0: 203d 2027 4d27 2c20 6d64 6576 203d 2031   = 'M', mdev = 1
-000905f0: 3220 293a 0a20 2020 200a 2020 2020 7072  2 ):.    .    pr
-00090600: 696e 7428 2743 6865 636b 696e 6720 696e  int('Checking in
-00090610: 7465 7273 6563 7469 6f6e 202e 2e20 272c  tersection .. ',
-00090620: 2065 6e64 3d27 2729 0a20 2020 2073 7465   end='').    ste
-00090630: 7020 3d20 6e70 2e63 6569 6c28 6466 5f73  p = np.ceil(df_s
-00090640: 6e76 2e73 6861 7065 5b30 5d2f 3230 290a  nv.shape[0]/20).
-00090650: 2020 2020 0a20 2020 2064 665f 736e 765b      .    df_snv[
-00090660: 2773 7461 7274 275d 203d 2064 665f 736e  'start'] = df_sn
-00090670: 765b 2770 6f73 5f6f 7267 275d 202d 206d  v['pos_org'] - m
-00090680: 6465 760a 2020 2020 6466 5f73 6e76 5b27  dev.    df_snv['
-00090690: 656e 6427 5d20 3d20 6466 5f73 6e76 5b27  end'] = df_snv['
-000906a0: 706f 735f 6f72 6727 5d20 2b20 6466 5f73  pos_org'] + df_s
-000906b0: 6e76 5b27 6c65 6e27 5d20 2b20 6d64 6576  nv['len'] + mdev
-000906c0: 0a20 2020 2064 665f 736e 765b 2763 7667  .    df_snv['cvg
-000906d0: 275d 203d 2030 0a0a 2020 2020 625f 7072  '] = 0..    b_pr
-000906e0: 6f63 203d 206e 702e 6675 6c6c 2864 665f  oc = np.full(df_
-000906f0: 736e 762e 7368 6170 655b 305d 2c20 4661  snv.shape[0], Fa
-00090700: 6c73 6529 0a20 2020 2066 6f72 206b 2c20  lse).    for k, 
-00090710: 7370 616e 2069 6e20 656e 756d 6572 6174  span in enumerat
-00090720: 6528 7370 616e 5f6c 7374 293a 0a20 2020  e(span_lst):.   
-00090730: 2020 2020 2062 3020 3d20 6466 5f73 6e76       b0 = df_snv
-00090740: 5b27 6368 7227 5d20 3d3d 2073 7061 6e2e  ['chr'] == span.
-00090750: 6368 720a 2020 2020 2020 2020 6231 203d  chr.        b1 =
-00090760: 2028 6466 5f73 6e76 5b27 7374 6172 7427   (df_snv['start'
-00090770: 5d20 3e3d 2073 7061 6e2e 7374 6172 7429  ] >= span.start)
-00090780: 2026 2028 2864 665f 736e 765b 2773 7461   & ((df_snv['sta
-00090790: 7274 275d 203c 3d20 7370 616e 2e65 6e64  rt'] <= span.end
-000907a0: 2929 0a20 2020 2020 2020 2062 3220 3d20  )).        b2 = 
-000907b0: 2864 665f 736e 765b 2765 6e64 275d 203e  (df_snv['end'] >
-000907c0: 3d20 7370 616e 2e73 7461 7274 2920 2620  = span.start) & 
-000907d0: 2828 6466 5f73 6e76 5b27 656e 6427 5d20  ((df_snv['end'] 
-000907e0: 3c3d 2073 7061 6e2e 656e 6429 290a 2020  <= span.end)).  
-000907f0: 2020 2020 2020 6220 3d20 6230 2026 2028        b = b0 & (
-00090800: 6231 207c 2062 3229 2026 2028 625f 7072  b1 | b2) & (b_pr
-00090810: 6f63 203d 3d20 4661 6c73 6529 0a20 2020  oc == False).   
-00090820: 2020 2020 2064 665f 736e 765f 746d 7020       df_snv_tmp 
-00090830: 3d20 6466 5f73 6e76 5b62 5d0a 2020 2020  = df_snv[b].    
-00090840: 2020 2020 666f 7220 6d2c 2072 6f77 2069      for m, row i
-00090850: 6e20 6466 5f73 6e76 5f74 6d70 2e69 7465  n df_snv_tmp.ite
-00090860: 7272 6f77 7328 293a 0a20 2020 2020 2020  rrows():.       
-00090870: 2020 2020 2072 676e 203d 2072 6567 696f       rgn = regio
-00090880: 6e28 2072 6f77 2e63 6872 2c20 726f 772e  n( row.chr, row.
-00090890: 7374 6172 742c 2072 6f77 2e65 6e64 2c20  start, row.end, 
-000908a0: 5479 7065 2029 0a20 2020 2020 2020 2020  Type ).         
-000908b0: 2020 2062 622c 2063 6320 3d20 7267 6e73     bb, cc = rgns
-000908c0: 5f6c 7374 5f6d 695b 6b5d 2e67 6574 5f69  _lst_mi[k].get_i
-000908d0: 6e74 6572 7365 6374 696f 6e5f 6376 6728  ntersection_cvg(
-000908e0: 7267 6e29 200a 2020 2020 2020 2020 2020  rgn) .          
-000908f0: 2020 6966 2062 623a 200a 2020 2020 2020    if bb: .      
-00090900: 2020 2020 2020 2020 2020 625f 7072 6f63            b_proc
-00090910: 5b6d 5d20 3d20 5472 7565 0a20 2020 2020  [m] = True.     
-00090920: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
-00090930: 762e 6c6f 635b 6d2c 2763 7667 275d 203d  v.loc[m,'cvg'] =
-00090940: 2063 630a 2020 2020 2020 2020 2020 2020   cc.            
-00090950: 2020 2020 0a20 2020 2020 2020 2023 2069      .        # i
-00090960: 6620 6b25 7374 6570 203d 3d20 303a 2070  f k%step == 0: p
-00090970: 7269 6e74 2827 2e27 2c65 6e64 3d27 2729  rint('.',end='')
-00090980: 0a20 2020 2020 2020 2069 6620 6b25 3130  .        if k%10
-00090990: 203d 3d20 303a 2020 2020 0a20 2020 2020   == 0:    .     
-000909a0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-000909b0: 4368 6563 6b69 6e67 2069 6e74 6572 7365  Checking interse
-000909c0: 6374 696f 6e20 2e2e 2025 692f 2569 2028  ction .. %i/%i (
-000909d0: 2569 2927 2025 2028 6b2c 206c 656e 2873  %i)' % (k, len(s
-000909e0: 7061 6e5f 6c73 7429 2c20 6e70 2e73 756d  pan_lst), np.sum
-000909f0: 2862 5f70 726f 6329 292c 2065 6e64 3d27  (b_proc)), end='
-00090a00: 2720 290a 0a20 2020 2070 7269 6e74 2827  ' )..    print('
-00090a10: 5c72 4368 6563 6b69 6e67 2069 6e74 6572  \rChecking inter
-00090a20: 7365 6374 696f 6e20 2e2e 2064 6f6e 652e  section .. done.
-00090a30: 2025 6920 2d3e 2025 6927 2025 2028 6466   %i -> %i' % (df
-00090a40: 5f73 6e76 2e73 6861 7065 5b30 5d2c 206e  _snv.shape[0], n
-00090a50: 702e 7375 6d28 625f 7072 6f63 2929 2029  p.sum(b_proc)) )
-00090a60: 0a20 2020 200a 2020 2020 6466 5f73 6e76  .    .    df_snv
-00090a70: 5f73 656c 203d 2028 6466 5f73 6e76 2e69  _sel = (df_snv.i
-00090a80: 6c6f 635b 625f 7072 6f63 5d29 2e63 6f70  loc[b_proc]).cop
-00090a90: 7928 6465 6570 203d 2054 7275 6529 0a20  y(deep = True). 
-00090aa0: 2020 200a 2020 2020 7265 7475 726e 2864     .    return(d
-00090ab0: 665f 736e 765f 7365 6c29 0a0a 0a64 6566  f_snv_sel)...def
-00090ac0: 206d 6174 6368 696e 675f 736e 7673 2820   matching_snvs( 
-00090ad0: 6466 5f73 6e76 5f73 656c 2c20 6466 5f64  df_snv_sel, df_d
-00090ae0: 6574 6563 7465 642c 2064 6576 5f74 6f6c  etected, dev_tol
-00090af0: 203d 2033 2029 3a0a 2020 2020 0a20 2020   = 3 ):.    .   
-00090b00: 2023 2320 7468 6520 6461 7461 6672 616d   ## the datafram
-00090b10: 6573 206d 7573 6820 6265 2073 6f72 7465  es mush be sorte
-00090b20: 6420 6163 636f 7264 696e 6720 746f 2074  d according to t
-00090b30: 6865 2070 6f73 6974 696f 6e20 2870 6f73  he position (pos
-00090b40: 5f6e 6577 2c20 7374 6172 7429 0a20 2020  _new, start).   
-00090b50: 2064 665f 745f 616c 6c20 3d20 6466 5f73   df_t_all = df_s
-00090b60: 6e76 5f73 656c 0a20 2020 2064 665f 645f  nv_sel.    df_d_
-00090b70: 616c 6c20 3d20 6466 5f64 6574 6563 7465  all = df_detecte
-00090b80: 640a 0a20 2020 2063 6e74 203d 2030 0a20  d..    cnt = 0. 
-00090b90: 2020 2063 6872 6d73 203d 2064 665f 745f     chrms = df_t_
-00090ba0: 616c 6c5b 2763 6872 275d 0a20 2020 2063  all['chr'].    c
-00090bb0: 6872 5f6c 7374 203d 206c 6973 7428 7365  hr_lst = list(se
-00090bc0: 7428 6368 726d 7329 290a 2020 2020 6368  t(chrms)).    ch
-00090bd0: 725f 6c73 742e 736f 7274 2829 0a0a 2020  r_lst.sort()..  
-00090be0: 2020 636e 7420 3d20 300a 2020 2020 4e5f    cnt = 0.    N_
-00090bf0: 7420 3d20 300a 2020 2020 4e5f 6420 3d20  t = 0.    N_d = 
-00090c00: 300a 2020 2020 666f 7220 6e2c 2063 6872  0.    for n, chr
-00090c10: 6d20 696e 2065 6e75 6d65 7261 7465 2863  m in enumerate(c
-00090c20: 6872 5f6c 7374 293a 0a20 2020 2020 2020  hr_lst):.       
-00090c30: 200a 2020 2020 2020 2020 6231 203d 2028   .        b1 = (
-00090c40: 6466 5f74 5f61 6c6c 5b27 6368 7227 5d20  df_t_all['chr'] 
-00090c50: 3d3d 2063 6872 6d29 0a20 2020 2020 2020  == chrm).       
-00090c60: 2062 3220 3d20 2864 665f 645f 616c 6c5b   b2 = (df_d_all[
-00090c70: 2763 6872 275d 203d 3d20 6368 726d 290a  'chr'] == chrm).
-00090c80: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
-00090c90: 286e 702e 7375 6d28 6231 2920 3d3d 2030  (np.sum(b1) == 0
-00090ca0: 2920 7c20 286e 702e 7375 6d28 6232 2920  ) | (np.sum(b2) 
-00090cb0: 3d3d 2030 293a 2020 2020 2020 2020 0a20  == 0):        . 
-00090cc0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00090cd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00090ce0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00090cf0: 2020 2020 2020 2064 665f 7420 3d20 6466         df_t = df
-00090d00: 5f74 5f61 6c6c 2e6c 6f63 5b62 312c 3a5d  _t_all.loc[b1,:]
-00090d10: 2e63 6f70 7928 6465 6570 203d 2054 7275  .copy(deep = Tru
-00090d20: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
-00090d30: 665f 6420 3d20 6466 5f64 5f61 6c6c 2e6c  f_d = df_d_all.l
-00090d40: 6f63 5b62 322c 3a5d 2e63 6f70 7928 6465  oc[b2,:].copy(de
-00090d50: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
-00090d60: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00090d70: 2020 2020 6e5f 7461 7267 6574 203d 2064      n_target = d
-00090d80: 665f 742e 7368 6170 655b 305d 0a20 2020  f_t.shape[0].   
-00090d90: 2020 2020 2020 2020 206e 5f64 6574 6563           n_detec
-00090da0: 7465 6420 3d20 6466 5f64 2e73 6861 7065  ted = df_d.shape
-00090db0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00090dc0: 0a20 2020 2020 2020 2020 2020 204e 5f74  .            N_t
-00090dd0: 202b 3d20 6e5f 7461 7267 6574 0a20 2020   += n_target.   
-00090de0: 2020 2020 2020 2020 204e 5f64 202b 3d20           N_d += 
-00090df0: 6e5f 6465 7465 6374 6564 0a20 2020 2020  n_detected.     
-00090e00: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00090e10: 2020 2020 2320 7072 696e 7428 275c 724d      # print('\rM
-00090e20: 6174 6368 696e 6720 2573 2027 2025 2028  atching %s ' % (
-00090e30: 6368 726d 2920 2c20 656e 643d 2727 290a  chrm) , end='').
-00090e40: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-00090e50: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-00090e60: 2020 636e 745f 6420 3d20 300a 2020 2020    cnt_d = 0.    
-00090e70: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-00090e80: 6e70 2e66 756c 6c28 6e5f 7461 7267 6574  np.full(n_target
-00090e90: 2c20 2d31 290a 2020 2020 2020 2020 2020  , -1).          
-00090ea0: 2020 6469 7374 203d 206e 702e 6675 6c6c    dist = np.full
-00090eb0: 286e 5f74 6172 6765 742c 2030 290a 2020  (n_target, 0).  
-00090ec0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00090ed0: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
-00090ee0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00090ef0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00090f00: 2020 2020 6966 2028 636e 745f 6420 3e3d      if (cnt_d >=
-00090f10: 206e 5f64 6574 6563 7465 6429 207c 2028   n_detected) | (
-00090f20: 636e 745f 7420 3e3d 206e 5f74 6172 6765  cnt_t >= n_targe
-00090f30: 7429 3a20 6272 6561 6b0a 2020 2020 2020  t): break.      
-00090f40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00090f50: 275c 724d 6174 6368 696e 6720 2573 2c20  '\rMatching %s, 
-00090f60: 2569 2f25 6920 2e2e 2025 692f 2569 2c20  %i/%i .. %i/%i, 
-00090f70: 2569 2f25 6920 2720 2520 5c0a 2020 2020  %i/%i ' % \.    
-00090f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090f90: 2020 2863 6872 6d2c 206e 2c20 6c65 6e28    (chrm, n, len(
-00090fa0: 6368 725f 6c73 7429 2c20 636e 745f 742c  chr_lst), cnt_t,
-00090fb0: 206e 5f74 6172 6765 742c 2063 6e74 5f64   n_target, cnt_d
-00090fc0: 2c20 6e5f 6465 7465 6374 6564 2920 2c20  , n_detected) , 
-00090fd0: 656e 643d 2727 290a 0a20 2020 2020 2020  end='')..       
-00090fe0: 2020 2020 2020 2020 2070 5f74 203d 2064           p_t = d
-00090ff0: 665f 742e 696c 6f63 5b63 6e74 5f74 5d2e  f_t.iloc[cnt_t].
-00091000: 706f 735f 6f72 670a 2020 2020 2020 2020  pos_org.        
-00091010: 2020 2020 2020 2020 705f 6420 3d20 6466          p_d = df
-00091020: 5f64 2e69 6c6f 635b 636e 745f 645d 2e70  _d.iloc[cnt_d].p
-00091030: 6f73 5f6f 7267 0a20 2020 2020 2020 2020  os_org.         
-00091040: 2020 2020 2020 2074 5f74 203d 2064 665f         t_t = df_
-00091050: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7479  t.iloc[cnt_t].ty
-00091060: 7065 0a20 2020 2020 2020 2020 2020 2020  pe.             
-00091070: 2020 2074 5f64 203d 2064 665f 642e 696c     t_d = df_d.il
-00091080: 6f63 5b63 6e74 5f64 5d2e 7479 7065 0a20  oc[cnt_d].type. 
-00091090: 2020 2020 2020 2020 2020 2020 2020 204c                 L
-000910a0: 5f74 203d 206d 6178 286c 656e 2864 665f  _t = max(len(df_
-000910b0: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7365  t.iloc[cnt_t].se
-000910c0: 715f 6f72 6729 2c20 6c65 6e28 6466 5f74  q_org), len(df_t
-000910d0: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
-000910e0: 5f6e 6577 2929 0a20 2020 2020 2020 2020  _new)).         
-000910f0: 2020 2020 2020 204c 5f64 203d 206d 6178         L_d = max
-00091100: 286c 656e 2864 665f 642e 696c 6f63 5b63  (len(df_d.iloc[c
-00091110: 6e74 5f64 5d2e 7365 715f 6f72 6729 2c20  nt_d].seq_org), 
-00091120: 6c65 6e28 6466 5f64 2e69 6c6f 635b 636e  len(df_d.iloc[cn
-00091130: 745f 645d 2e73 6571 5f6e 6577 2929 0a0a  t_d].seq_new))..
-00091140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091150: 6966 2028 705f 7429 203e 2028 705f 6420  if (p_t) > (p_d 
-00091160: 2b20 4c5f 6420 2b20 6465 765f 746f 6c29  + L_d + dev_tol)
-00091170: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00091180: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
-00091190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000911a0: 2020 2020 2069 6620 636e 745f 6420 3e3d       if cnt_d >=
-000911b0: 206e 5f64 6574 6563 7465 643a 2062 7265   n_detected: bre
-000911c0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-000911d0: 2020 2065 6c69 6620 2870 5f74 202b 204c     elif (p_t + L
-000911e0: 5f74 202b 2064 6576 5f74 6f6c 2920 3c20  _t + dev_tol) < 
-000911f0: 2870 5f64 293a 0a20 2020 2020 2020 2020  (p_d):.         
-00091200: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
-00091210: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091220: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
-00091230: 5f74 203e 3d20 6e5f 7461 7267 6574 3a20  _t >= n_target: 
-00091240: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00091250: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00091260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091270: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
-00091280: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00091290: 2874 5f74 203d 3d20 2756 2729 2026 2028  (t_t == 'V') & (
-000912a0: 745f 6420 3d3d 2027 5627 293a 0a20 2020  t_d == 'V'):.   
-000912b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000912c0: 2020 2020 2069 6620 6c65 6e28 6466 5f74       if len(df_t
-000912d0: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
-000912e0: 5f6e 6577 2920 3d3d 206c 656e 2864 665f  _new) == len(df_
-000912f0: 642e 696c 6f63 5b63 6e74 5f64 5d2e 7365  d.iloc[cnt_d].se
-00091300: 715f 6e65 7729 3a0a 2020 2020 2020 2020  q_new):.        
-00091310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091320: 2020 2020 6966 2028 705f 7420 3d3d 2070      if (p_t == p
-00091330: 5f64 2920 2620 2864 665f 742e 696c 6f63  _d) & (df_t.iloc
-00091340: 5b63 6e74 5f74 5d2e 7365 715f 6e65 7720  [cnt_t].seq_new 
-00091350: 3d3d 2064 665f 642e 696c 6f63 5b63 6e74  == df_d.iloc[cnt
-00091360: 5f64 5d2e 7365 715f 6e65 7729 3a0a 2020  _d].seq_new):.  
-00091370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091380: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00091390: 7463 685b 636e 745f 745d 203d 2063 6e74  tch[cnt_t] = cnt
-000913a0: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
-000913b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000913c0: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
-000913d0: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
-000913e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000913f0: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
-00091400: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091420: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
-00091430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000904a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000904b0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
+000904c0: 2067 6574 5f73 7061 6e5f 6c73 7428 7267   get_span_lst(rg
+000904d0: 6e73 5f6c 7374 5f6d 692c 2054 7970 6520  ns_lst_mi, Type 
+000904e0: 3d20 274d 2729 3a0a 2020 2020 0a20 2020  = 'M'):.    .   
+000904f0: 2073 7061 6e5f 6c73 7420 3d20 5b5d 0a20   span_lst = []. 
+00090500: 2020 2066 6f72 2072 5f6d 2069 6e20 7267     for r_m in rg
+00090510: 6e73 5f6c 7374 5f6d 693a 0a20 2020 2020  ns_lst_mi:.     
+00090520: 2020 2073 706e 203d 2072 5f6d 2e67 6574     spn = r_m.get
+00090530: 5f73 7061 6e28 290a 2020 2020 2020 2020  _span().        
+00090540: 7370 6e2e 7479 7065 203d 2054 7970 650a  spn.type = Type.
+00090550: 2020 2020 2020 2020 7370 616e 5f6c 7374          span_lst
+00090560: 2e61 7070 656e 6428 2073 706e 2029 0a20  .append( spn ). 
+00090570: 2020 2072 6574 7572 6e28 7370 616e 5f6c     return(span_l
+00090580: 7374 290a 0a23 2320 5365 6c65 6374 2053  st)..## Select S
+00090590: 4e56 2773 2074 6861 7420 6661 6c6c 7320  NV's that falls 
+000905a0: 7769 7468 696e 2074 6865 2063 6f76 6572  within the cover
+000905b0: 6564 2072 6567 696f 6e0a 6465 6620 7365  ed region.def se
+000905c0: 6c65 6374 5f73 6e76 7328 2064 665f 736e  lect_snvs( df_sn
+000905d0: 762c 2073 7061 6e5f 6c73 742c 2072 676e  v, span_lst, rgn
+000905e0: 735f 6c73 745f 6d69 2c20 5479 7065 203d  s_lst_mi, Type =
+000905f0: 2027 4d27 2c20 6d64 6576 203d 2031 3220   'M', mdev = 12 
+00090600: 293a 0a20 2020 200a 2020 2020 7072 696e  ):.    .    prin
+00090610: 7428 2743 6865 636b 696e 6720 696e 7465  t('Checking inte
+00090620: 7273 6563 7469 6f6e 202e 2e20 272c 2065  rsection .. ', e
+00090630: 6e64 3d27 2729 0a20 2020 2073 7465 7020  nd='').    step 
+00090640: 3d20 6e70 2e63 6569 6c28 6466 5f73 6e76  = np.ceil(df_snv
+00090650: 2e73 6861 7065 5b30 5d2f 3230 290a 2020  .shape[0]/20).  
+00090660: 2020 0a20 2020 2064 665f 736e 765b 2773    .    df_snv['s
+00090670: 7461 7274 275d 203d 2064 665f 736e 765b  tart'] = df_snv[
+00090680: 2770 6f73 5f6f 7267 275d 202d 206d 6465  'pos_org'] - mde
+00090690: 760a 2020 2020 6466 5f73 6e76 5b27 656e  v.    df_snv['en
+000906a0: 6427 5d20 3d20 6466 5f73 6e76 5b27 706f  d'] = df_snv['po
+000906b0: 735f 6f72 6727 5d20 2b20 6466 5f73 6e76  s_org'] + df_snv
+000906c0: 5b27 6c65 6e27 5d20 2b20 6d64 6576 0a20  ['len'] + mdev. 
+000906d0: 2020 2064 665f 736e 765b 2763 7667 275d     df_snv['cvg']
+000906e0: 203d 2030 0a0a 2020 2020 625f 7072 6f63   = 0..    b_proc
+000906f0: 203d 206e 702e 6675 6c6c 2864 665f 736e   = np.full(df_sn
+00090700: 762e 7368 6170 655b 305d 2c20 4661 6c73  v.shape[0], Fals
+00090710: 6529 0a20 2020 2066 6f72 206b 2c20 7370  e).    for k, sp
+00090720: 616e 2069 6e20 656e 756d 6572 6174 6528  an in enumerate(
+00090730: 7370 616e 5f6c 7374 293a 0a20 2020 2020  span_lst):.     
+00090740: 2020 2062 3020 3d20 6466 5f73 6e76 5b27     b0 = df_snv['
+00090750: 6368 7227 5d20 3d3d 2073 7061 6e2e 6368  chr'] == span.ch
+00090760: 720a 2020 2020 2020 2020 6231 203d 2028  r.        b1 = (
+00090770: 6466 5f73 6e76 5b27 7374 6172 7427 5d20  df_snv['start'] 
+00090780: 3e3d 2073 7061 6e2e 7374 6172 7429 2026  >= span.start) &
+00090790: 2028 2864 665f 736e 765b 2773 7461 7274   ((df_snv['start
+000907a0: 275d 203c 3d20 7370 616e 2e65 6e64 2929  '] <= span.end))
+000907b0: 0a20 2020 2020 2020 2062 3220 3d20 2864  .        b2 = (d
+000907c0: 665f 736e 765b 2765 6e64 275d 203e 3d20  f_snv['end'] >= 
+000907d0: 7370 616e 2e73 7461 7274 2920 2620 2828  span.start) & ((
+000907e0: 6466 5f73 6e76 5b27 656e 6427 5d20 3c3d  df_snv['end'] <=
+000907f0: 2073 7061 6e2e 656e 6429 290a 2020 2020   span.end)).    
+00090800: 2020 2020 6220 3d20 6230 2026 2028 6231      b = b0 & (b1
+00090810: 207c 2062 3229 2026 2028 625f 7072 6f63   | b2) & (b_proc
+00090820: 203d 3d20 4661 6c73 6529 0a20 2020 2020   == False).     
+00090830: 2020 2064 665f 736e 765f 746d 7020 3d20     df_snv_tmp = 
+00090840: 6466 5f73 6e76 5b62 5d0a 2020 2020 2020  df_snv[b].      
+00090850: 2020 666f 7220 6d2c 2072 6f77 2069 6e20    for m, row in 
+00090860: 6466 5f73 6e76 5f74 6d70 2e69 7465 7272  df_snv_tmp.iterr
+00090870: 6f77 7328 293a 0a20 2020 2020 2020 2020  ows():.         
+00090880: 2020 2072 676e 203d 2072 6567 696f 6e28     rgn = region(
+00090890: 2072 6f77 2e63 6872 2c20 726f 772e 7374   row.chr, row.st
+000908a0: 6172 742c 2072 6f77 2e65 6e64 2c20 5479  art, row.end, Ty
+000908b0: 7065 2029 0a20 2020 2020 2020 2020 2020  pe ).           
+000908c0: 2062 622c 2063 6320 3d20 7267 6e73 5f6c   bb, cc = rgns_l
+000908d0: 7374 5f6d 695b 6b5d 2e67 6574 5f69 6e74  st_mi[k].get_int
+000908e0: 6572 7365 6374 696f 6e5f 6376 6728 7267  ersection_cvg(rg
+000908f0: 6e29 200a 2020 2020 2020 2020 2020 2020  n) .            
+00090900: 6966 2062 623a 200a 2020 2020 2020 2020  if bb: .        
+00090910: 2020 2020 2020 2020 625f 7072 6f63 5b6d          b_proc[m
+00090920: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+00090930: 2020 2020 2020 2020 2064 665f 736e 762e           df_snv.
+00090940: 6c6f 635b 6d2c 2763 7667 275d 203d 2063  loc[m,'cvg'] = c
+00090950: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+00090960: 2020 0a20 2020 2020 2020 2023 2069 6620    .        # if 
+00090970: 6b25 7374 6570 203d 3d20 303a 2070 7269  k%step == 0: pri
+00090980: 6e74 2827 2e27 2c65 6e64 3d27 2729 0a20  nt('.',end=''). 
+00090990: 2020 2020 2020 2069 6620 6b25 3130 203d         if k%10 =
+000909a0: 3d20 303a 2020 2020 0a20 2020 2020 2020  = 0:    .       
+000909b0: 2020 2020 2070 7269 6e74 2827 5c72 4368       print('\rCh
+000909c0: 6563 6b69 6e67 2069 6e74 6572 7365 6374  ecking intersect
+000909d0: 696f 6e20 2e2e 2025 692f 2569 2028 2569  ion .. %i/%i (%i
+000909e0: 2927 2025 2028 6b2c 206c 656e 2873 7061  )' % (k, len(spa
+000909f0: 6e5f 6c73 7429 2c20 6e70 2e73 756d 2862  n_lst), np.sum(b
+00090a00: 5f70 726f 6329 292c 2065 6e64 3d27 2720  _proc)), end='' 
+00090a10: 290a 0a20 2020 2070 7269 6e74 2827 5c72  )..    print('\r
+00090a20: 4368 6563 6b69 6e67 2069 6e74 6572 7365  Checking interse
+00090a30: 6374 696f 6e20 2e2e 2064 6f6e 652e 2025  ction .. done. %
+00090a40: 6920 2d3e 2025 6927 2025 2028 6466 5f73  i -> %i' % (df_s
+00090a50: 6e76 2e73 6861 7065 5b30 5d2c 206e 702e  nv.shape[0], np.
+00090a60: 7375 6d28 625f 7072 6f63 2929 2029 0a20  sum(b_proc)) ). 
+00090a70: 2020 200a 2020 2020 6466 5f73 6e76 5f73     .    df_snv_s
+00090a80: 656c 203d 2028 6466 5f73 6e76 2e69 6c6f  el = (df_snv.ilo
+00090a90: 635b 625f 7072 6f63 5d29 2e63 6f70 7928  c[b_proc]).copy(
+00090aa0: 6465 6570 203d 2054 7275 6529 0a20 2020  deep = True).   
+00090ab0: 200a 2020 2020 7265 7475 726e 2864 665f   .    return(df_
+00090ac0: 736e 765f 7365 6c29 0a0a 0a64 6566 206d  snv_sel)...def m
+00090ad0: 6174 6368 696e 675f 736e 7673 2820 6466  atching_snvs( df
+00090ae0: 5f73 6e76 5f73 656c 2c20 6466 5f64 6574  _snv_sel, df_det
+00090af0: 6563 7465 642c 2064 6576 5f74 6f6c 203d  ected, dev_tol =
+00090b00: 2033 2029 3a0a 2020 2020 0a20 2020 2023   3 ):.    .    #
+00090b10: 2320 7468 6520 6461 7461 6672 616d 6573  # the dataframes
+00090b20: 206d 7573 6820 6265 2073 6f72 7465 6420   mush be sorted 
+00090b30: 6163 636f 7264 696e 6720 746f 2074 6865  according to the
+00090b40: 2070 6f73 6974 696f 6e20 2870 6f73 5f6e   position (pos_n
+00090b50: 6577 2c20 7374 6172 7429 0a20 2020 2064  ew, start).    d
+00090b60: 665f 745f 616c 6c20 3d20 6466 5f73 6e76  f_t_all = df_snv
+00090b70: 5f73 656c 0a20 2020 2064 665f 645f 616c  _sel.    df_d_al
+00090b80: 6c20 3d20 6466 5f64 6574 6563 7465 640a  l = df_detected.
+00090b90: 0a20 2020 2063 6e74 203d 2030 0a20 2020  .    cnt = 0.   
+00090ba0: 2063 6872 6d73 203d 2064 665f 745f 616c   chrms = df_t_al
+00090bb0: 6c5b 2763 6872 275d 0a20 2020 2063 6872  l['chr'].    chr
+00090bc0: 5f6c 7374 203d 206c 6973 7428 7365 7428  _lst = list(set(
+00090bd0: 6368 726d 7329 290a 2020 2020 6368 725f  chrms)).    chr_
+00090be0: 6c73 742e 736f 7274 2829 0a0a 2020 2020  lst.sort()..    
+00090bf0: 636e 7420 3d20 300a 2020 2020 4e5f 7420  cnt = 0.    N_t 
+00090c00: 3d20 300a 2020 2020 4e5f 6420 3d20 300a  = 0.    N_d = 0.
+00090c10: 2020 2020 666f 7220 6e2c 2063 6872 6d20      for n, chrm 
+00090c20: 696e 2065 6e75 6d65 7261 7465 2863 6872  in enumerate(chr
+00090c30: 5f6c 7374 293a 0a20 2020 2020 2020 200a  _lst):.        .
+00090c40: 2020 2020 2020 2020 6231 203d 2028 6466          b1 = (df
+00090c50: 5f74 5f61 6c6c 5b27 6368 7227 5d20 3d3d  _t_all['chr'] ==
+00090c60: 2063 6872 6d29 0a20 2020 2020 2020 2062   chrm).        b
+00090c70: 3220 3d20 2864 665f 645f 616c 6c5b 2763  2 = (df_d_all['c
+00090c80: 6872 275d 203d 3d20 6368 726d 290a 2020  hr'] == chrm).  
+00090c90: 2020 0a20 2020 2020 2020 2069 6620 286e    .        if (n
+00090ca0: 702e 7375 6d28 6231 2920 3d3d 2030 2920  p.sum(b1) == 0) 
+00090cb0: 7c20 286e 702e 7375 6d28 6232 2920 3d3d  | (np.sum(b2) ==
+00090cc0: 2030 293a 2020 2020 2020 2020 0a20 2020   0):        .   
+00090cd0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00090ce0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00090cf0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00090d00: 2020 2020 2064 665f 7420 3d20 6466 5f74       df_t = df_t
+00090d10: 5f61 6c6c 2e6c 6f63 5b62 312c 3a5d 2e63  _all.loc[b1,:].c
+00090d20: 6f70 7928 6465 6570 203d 2054 7275 6529  opy(deep = True)
+00090d30: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+00090d40: 6420 3d20 6466 5f64 5f61 6c6c 2e6c 6f63  d = df_d_all.loc
+00090d50: 5b62 322c 3a5d 2e63 6f70 7928 6465 6570  [b2,:].copy(deep
+00090d60: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+00090d70: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00090d80: 2020 6e5f 7461 7267 6574 203d 2064 665f    n_target = df_
+00090d90: 742e 7368 6170 655b 305d 0a20 2020 2020  t.shape[0].     
+00090da0: 2020 2020 2020 206e 5f64 6574 6563 7465         n_detecte
+00090db0: 6420 3d20 6466 5f64 2e73 6861 7065 5b30  d = df_d.shape[0
+00090dc0: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
+00090dd0: 2020 2020 2020 2020 2020 204e 5f74 202b             N_t +
+00090de0: 3d20 6e5f 7461 7267 6574 0a20 2020 2020  = n_target.     
+00090df0: 2020 2020 2020 204e 5f64 202b 3d20 6e5f         N_d += n_
+00090e00: 6465 7465 6374 6564 0a20 2020 2020 2020  detected.       
+00090e10: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00090e20: 2020 2320 7072 696e 7428 275c 724d 6174    # print('\rMat
+00090e30: 6368 696e 6720 2573 2027 2025 2028 6368  ching %s ' % (ch
+00090e40: 726d 2920 2c20 656e 643d 2727 290a 2020  rm) , end='').  
+00090e50: 2020 2020 2020 2020 2020 636e 745f 7420            cnt_t 
+00090e60: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00090e70: 636e 745f 6420 3d20 300a 2020 2020 2020  cnt_d = 0.      
+00090e80: 2020 2020 2020 6d61 7463 6820 3d20 6e70        match = np
+00090e90: 2e66 756c 6c28 6e5f 7461 7267 6574 2c20  .full(n_target, 
+00090ea0: 2d31 290a 2020 2020 2020 2020 2020 2020  -1).            
+00090eb0: 6469 7374 203d 206e 702e 6675 6c6c 286e  dist = np.full(n
+00090ec0: 5f74 6172 6765 742c 2030 290a 2020 2020  _target, 0).    
+00090ed0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00090ee0: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+00090ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00090f00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00090f10: 2020 6966 2028 636e 745f 6420 3e3d 206e    if (cnt_d >= n
+00090f20: 5f64 6574 6563 7465 6429 207c 2028 636e  _detected) | (cn
+00090f30: 745f 7420 3e3d 206e 5f74 6172 6765 7429  t_t >= n_target)
+00090f40: 3a20 6272 6561 6b0a 2020 2020 2020 2020  : break.        
+00090f50: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
+00090f60: 724d 6174 6368 696e 6720 2573 2c20 2569  rMatching %s, %i
+00090f70: 2f25 6920 2e2e 2025 692f 2569 2c20 2569  /%i .. %i/%i, %i
+00090f80: 2f25 6920 2720 2520 5c0a 2020 2020 2020  /%i ' % \.      
+00090f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090fa0: 2863 6872 6d2c 206e 2c20 6c65 6e28 6368  (chrm, n, len(ch
+00090fb0: 725f 6c73 7429 2c20 636e 745f 742c 206e  r_lst), cnt_t, n
+00090fc0: 5f74 6172 6765 742c 2063 6e74 5f64 2c20  _target, cnt_d, 
+00090fd0: 6e5f 6465 7465 6374 6564 2920 2c20 656e  n_detected) , en
+00090fe0: 643d 2727 290a 0a20 2020 2020 2020 2020  d='')..         
+00090ff0: 2020 2020 2020 2070 5f74 203d 2064 665f         p_t = df_
+00091000: 742e 696c 6f63 5b63 6e74 5f74 5d2e 706f  t.iloc[cnt_t].po
+00091010: 735f 6f72 670a 2020 2020 2020 2020 2020  s_org.          
+00091020: 2020 2020 2020 705f 6420 3d20 6466 5f64        p_d = df_d
+00091030: 2e69 6c6f 635b 636e 745f 645d 2e70 6f73  .iloc[cnt_d].pos
+00091040: 5f6f 7267 0a20 2020 2020 2020 2020 2020  _org.           
+00091050: 2020 2020 2074 5f74 203d 2064 665f 742e       t_t = df_t.
+00091060: 696c 6f63 5b63 6e74 5f74 5d2e 7479 7065  iloc[cnt_t].type
+00091070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091080: 2074 5f64 203d 2064 665f 642e 696c 6f63   t_d = df_d.iloc
+00091090: 5b63 6e74 5f64 5d2e 7479 7065 0a20 2020  [cnt_d].type.   
+000910a0: 2020 2020 2020 2020 2020 2020 204c 5f74               L_t
+000910b0: 203d 206d 6178 286c 656e 2864 665f 742e   = max(len(df_t.
+000910c0: 696c 6f63 5b63 6e74 5f74 5d2e 7365 715f  iloc[cnt_t].seq_
+000910d0: 6f72 6729 2c20 6c65 6e28 6466 5f74 2e69  org), len(df_t.i
+000910e0: 6c6f 635b 636e 745f 745d 2e73 6571 5f6e  loc[cnt_t].seq_n
+000910f0: 6577 2929 0a20 2020 2020 2020 2020 2020  ew)).           
+00091100: 2020 2020 204c 5f64 203d 206d 6178 286c       L_d = max(l
+00091110: 656e 2864 665f 642e 696c 6f63 5b63 6e74  en(df_d.iloc[cnt
+00091120: 5f64 5d2e 7365 715f 6f72 6729 2c20 6c65  _d].seq_org), le
+00091130: 6e28 6466 5f64 2e69 6c6f 635b 636e 745f  n(df_d.iloc[cnt_
+00091140: 645d 2e73 6571 5f6e 6577 2929 0a0a 2020  d].seq_new))..  
+00091150: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00091160: 2028 705f 7429 203e 2028 705f 6420 2b20   (p_t) > (p_d + 
+00091170: 4c5f 6420 2b20 6465 765f 746f 6c29 3a0a  L_d + dev_tol):.
+00091180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091190: 2020 2020 636e 745f 6420 2b3d 2031 0a20      cnt_d += 1. 
+000911a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000911b0: 2020 2069 6620 636e 745f 6420 3e3d 206e     if cnt_d >= n
+000911c0: 5f64 6574 6563 7465 643a 2062 7265 616b  _detected: break
+000911d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000911e0: 2065 6c69 6620 2870 5f74 202b 204c 5f74   elif (p_t + L_t
+000911f0: 202b 2064 6576 5f74 6f6c 2920 3c20 2870   + dev_tol) < (p
+00091200: 5f64 293a 0a20 2020 2020 2020 2020 2020  _d):.           
+00091210: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
+00091220: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00091230: 2020 2020 2020 2020 6966 2063 6e74 5f74          if cnt_t
+00091240: 203e 3d20 6e5f 7461 7267 6574 3a20 6272   >= n_target: br
+00091250: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00091260: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00091270: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+00091280: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00091290: 2020 2020 2020 2020 2020 2069 6620 2874             if (t
+000912a0: 5f74 203d 3d20 2756 2729 2026 2028 745f  _t == 'V') & (t_
+000912b0: 6420 3d3d 2027 5627 293a 0a20 2020 2020  d == 'V'):.     
+000912c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000912d0: 2020 2069 6620 6c65 6e28 6466 5f74 2e69     if len(df_t.i
+000912e0: 6c6f 635b 636e 745f 745d 2e73 6571 5f6e  loc[cnt_t].seq_n
+000912f0: 6577 2920 3d3d 206c 656e 2864 665f 642e  ew) == len(df_d.
+00091300: 696c 6f63 5b63 6e74 5f64 5d2e 7365 715f  iloc[cnt_d].seq_
+00091310: 6e65 7729 3a0a 2020 2020 2020 2020 2020  new):.          
+00091320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091330: 2020 6966 2028 705f 7420 3d3d 2070 5f64    if (p_t == p_d
+00091340: 2920 2620 2864 665f 742e 696c 6f63 5b63  ) & (df_t.iloc[c
+00091350: 6e74 5f74 5d2e 7365 715f 6e65 7720 3d3d  nt_t].seq_new ==
+00091360: 2064 665f 642e 696c 6f63 5b63 6e74 5f64   df_d.iloc[cnt_d
+00091370: 5d2e 7365 715f 6e65 7729 3a0a 2020 2020  ].seq_new):.    
+00091380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091390: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+000913a0: 685b 636e 745f 745d 203d 2063 6e74 5f64  h[cnt_t] = cnt_d
+000913b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000913c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000913d0: 2064 6973 745b 636e 745f 745d 203d 2070   dist[cnt_t] = p
+000913e0: 5f74 202d 2070 5f64 0a20 2020 2020 2020  _t - p_d.       
+000913f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091400: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
+00091410: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00091420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091430: 2020 2020 636e 745f 6420 2b3d 2031 0a20      cnt_d += 1. 
 00091440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091450: 2062 203d 2046 616c 7365 0a20 2020 2020   b = False.     
-00091460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091470: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00091480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091490: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-000914a0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00091450: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00091460: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00091470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091480: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00091490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000914a0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
 000914b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914c0: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
-000914d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914e0: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
-000914f0: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
-00091500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091510: 2020 2020 2020 2020 2020 2064 6973 745b             dist[
-00091520: 636e 745f 745d 203d 2070 5f74 202d 2070  cnt_t] = p_t - p
-00091530: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
-00091540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091550: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
-00091560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091570: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-00091580: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
-00091590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000915a0: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
-000915b0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-000915c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000915d0: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
-000915e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000915f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00091600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091610: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-00091620: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00091630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091640: 2020 2020 2020 2069 6620 623a 0a20 2020         if b:.   
-00091650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091660: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
-00091670: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00091680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091690: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
-000916a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000916b0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000916c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000916d0: 2028 745f 7420 3d3d 2027 4927 2920 2620   (t_t == 'I') & 
-000916e0: 2874 5f64 203d 3d20 2744 2729 3a0a 2020  (t_d == 'D'):.  
-000916f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091700: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
-00091710: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
-00091720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091730: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
-00091740: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
-00091750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091760: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
-00091770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091780: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
-00091790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000917a0: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
-000917b0: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
-000917c0: 2020 2020 2020 2020 656c 6966 2028 745f          elif (t_
-000917d0: 7420 3d3d 2027 4427 2920 2620 2874 5f64  t == 'D') & (t_d
-000917e0: 203d 3d20 2749 2729 3a0a 2020 2020 2020   == 'I'):.      
-000917f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091800: 2020 6d61 7463 685b 636e 745f 745d 203d    match[cnt_t] =
-00091810: 2063 6e74 5f64 0a20 2020 2020 2020 2020   cnt_d.         
-00091820: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00091830: 6973 745b 636e 745f 745d 203d 2070 5f74  ist[cnt_t] = p_t
-00091840: 202d 2070 5f64 0a20 2020 2020 2020 2020   - p_d.         
-00091850: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00091860: 6e74 5f74 202b 3d20 310a 2020 2020 2020  nt_t += 1.      
-00091870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091880: 2020 636e 745f 6420 2b3d 2031 0a20 2020    cnt_d += 1.   
-00091890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918a0: 2020 2020 2062 203d 2046 616c 7365 0a20       b = False. 
-000918b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000918d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918e0: 2023 2063 6e74 5f74 202b 3d20 310a 2020   # cnt_t += 1.  
-000918f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091900: 2020 2020 2020 2320 636e 745f 6420 2b3d        # cnt_d +=
-00091910: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00091920: 2020 2020 2020 2020 2020 2069 6620 2863             if (c
-00091930: 6e74 5f64 203e 3d20 6e5f 6465 7465 6374  nt_d >= n_detect
-00091940: 6564 2920 7c20 2863 6e74 5f74 203e 3d20  ed) | (cnt_t >= 
-00091950: 6e5f 7461 7267 6574 293a 2062 7265 616b  n_target): break
-00091960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091970: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
-00091980: 2020 2020 2020 2062 203d 206d 6174 6368         b = match
-00091990: 203e 3d20 300a 2020 2020 2020 2020 2020   >= 0.          
-000919a0: 2020 7768 5f74 203d 2077 6869 6368 2862    wh_t = which(b
-000919b0: 290a 2020 2020 2020 2020 2020 2020 7768  ).            wh
-000919c0: 5f64 203d 206d 6174 6368 5b77 685f 745d  _d = match[wh_t]
-000919d0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-000919e0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-000919f0: 2877 685f 7429 203e 2030 3a0a 2020 2020  (wh_t) > 0:.    
-00091a00: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00091a10: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
-00091a20: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00091a30: 745b 2764 6973 7427 5d20 3d20 6469 7374  t['dist'] = dist
-00091a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091a50: 2020 2020 2064 6631 203d 2064 665f 742e       df1 = df_t.
-00091a60: 696c 6f63 5b77 685f 745d 2e63 6f70 7928  iloc[wh_t].copy(
-00091a70: 6465 6570 203d 2054 7275 6529 0a20 2020  deep = True).   
-00091a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091a90: 2064 6632 203d 2064 665f 642e 696c 6f63   df2 = df_d.iloc
-00091aa0: 5b77 685f 645d 2e63 6f70 7928 6465 6570  [wh_d].copy(deep
-00091ab0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-00091ac0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
-00091ad0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091ae0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00091af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091b00: 6466 5f74 5b27 6469 7374 275d 203d 2064  df_t['dist'] = d
-00091b10: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-00091b20: 2020 2020 2020 2020 6466 3120 3d20 7064          df1 = pd
-00091b30: 2e63 6f6e 6361 7428 5b64 6631 2c20 6466  .concat([df1, df
-00091b40: 5f74 2e69 6c6f 635b 7768 5f74 5d2e 636f  _t.iloc[wh_t].co
-00091b50: 7079 2864 6565 7020 3d20 5472 7565 295d  py(deep = True)]
-00091b60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00091b70: 2020 2020 2020 6466 3220 3d20 7064 2e63        df2 = pd.c
-00091b80: 6f6e 6361 7428 5b64 6632 2c20 6466 5f64  oncat([df2, df_d
-00091b90: 2e69 6c6f 635b 7768 5f64 5d2e 636f 7079  .iloc[wh_d].copy
-00091ba0: 2864 6565 7020 3d20 5472 7565 295d 290a  (deep = True)]).
-00091bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091bc0: 2020 2020 636e 7420 2b3d 2031 0a20 2020      cnt += 1.   
-00091bd0: 2020 2020 2020 2020 0a20 2020 2070 7269          .    pri
-00091be0: 6e74 2827 5c72 4d61 7463 6869 6e67 202e  nt('\rMatching .
-00091bf0: 2e20 646f 6e65 2e20 272c 2065 6e64 203d  . done. ', end =
-00091c00: 2027 2729 0a20 2020 2069 6620 636e 7420   '').    if cnt 
-00091c10: 3e20 303a 0a20 2020 2020 2020 2064 6632  > 0:.        df2
-00091c20: 203d 2064 6632 2e72 656e 616d 6528 2063   = df2.rename( c
-00091c30: 6f6c 756d 6e73 203d 207b 2763 6872 273a  olumns = {'chr':
-00091c40: 2027 6368 725f 6427 2c20 2774 7970 6527   'chr_d', 'type'
-00091c50: 3a20 2774 7970 655f 6427 2c20 2770 6f73  : 'type_d', 'pos
-00091c60: 5f6f 7267 273a 2027 706f 735f 6f72 675f  _org': 'pos_org_
-00091c70: 6427 2c20 5c0a 2020 2020 2020 2020 2020  d', \.          
-00091c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091c90: 2020 2020 2020 2773 6571 5f6f 7267 273a        'seq_org':
-00091ca0: 2027 7365 715f 6f72 675f 6427 2c20 2773   'seq_org_d', 's
-00091cb0: 6571 5f6e 6577 273a 2027 7365 715f 6e65  eq_new': 'seq_ne
-00091cc0: 775f 6427 7d20 290a 2020 2020 2020 2020  w_d'} ).        
-00091cd0: 7365 6c5f 636f 6c5f 7420 3d20 5b27 6368  sel_col_t = ['ch
-00091ce0: 7227 2c20 2774 7970 6527 2c20 2770 6f73  r', 'type', 'pos
-00091cf0: 5f6f 7267 272c 2027 7365 715f 6f72 6727  _org', 'seq_org'
-00091d00: 2c20 2773 6571 5f6e 6577 272c 2027 6469  , 'seq_new', 'di
-00091d10: 7374 275d 0a20 2020 2020 2020 2073 656c  st'].        sel
-00091d20: 5f63 6f6c 5f64 203d 205b 2769 6427 2c20  _col_d = ['id', 
-00091d30: 2763 6872 5f64 272c 2027 7479 7065 5f64  'chr_d', 'type_d
-00091d40: 272c 2027 706f 735f 6f72 675f 6427 2c20  ', 'pos_org_d', 
-00091d50: 2773 6571 5f6f 7267 5f64 272c 2027 7365  'seq_org_d', 'se
-00091d60: 715f 6e65 775f 6427 5d0a 2020 2020 2020  q_new_d'].      
-00091d70: 2020 6466 312e 696e 6465 7820 3d20 7064    df1.index = pd
-00091d80: 2e49 6e64 6578 285b 6b20 666f 7220 6b20  .Index([k for k 
-00091d90: 696e 2072 616e 6765 2864 6631 2e73 6861  in range(df1.sha
-00091da0: 7065 5b30 5d29 5d29 0a20 2020 2020 2020  pe[0])]).       
-00091db0: 2064 6632 2e69 6e64 6578 203d 2070 642e   df2.index = pd.
-00091dc0: 496e 6465 7828 5b6b 2066 6f72 206b 2069  Index([k for k i
-00091dd0: 6e20 7261 6e67 6528 6466 322e 7368 6170  n range(df2.shap
-00091de0: 655b 305d 295d 290a 2020 2020 2020 2020  e[0])]).        
-00091df0: 6466 203d 2070 642e 636f 6e63 6174 2820  df = pd.concat( 
-00091e00: 5b64 6631 5b73 656c 5f63 6f6c 5f74 5d2c  [df1[sel_col_t],
-00091e10: 2064 6632 5b73 656c 5f63 6f6c 5f64 5d5d   df2[sel_col_d]]
-00091e20: 2c20 6178 6973 203d 2031 2c20 736f 7274  , axis = 1, sort
-00091e30: 3d46 616c 7365 2029 2020 2020 2020 2020  =False )        
-00091e40: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00091e50: 2020 2020 2020 7365 6e73 203d 2031 3030        sens = 100
-00091e60: 2a64 662e 7368 6170 655b 305d 2f4e 5f74  *df.shape[0]/N_t
-00091e70: 0a20 2020 2020 2020 2070 7265 6320 3d20  .        prec = 
-00091e80: 3130 302a 6466 2e73 6861 7065 5b30 5d2f  100*df.shape[0]/
-00091e90: 4e5f 640a 2020 2020 2020 2020 7072 696e  N_d.        prin
-00091ea0: 7428 2720 4e5f 743a 2025 692c 204e 5f64  t(' N_t: %i, N_d
-00091eb0: 3a20 2569 202d 3e20 2569 2028 7365 6e73  : %i -> %i (sens
-00091ec0: 3a20 2534 2e31 662c 2070 7265 633a 2025  : %4.1f, prec: %
-00091ed0: 342e 3166 2920 2720 2520 5c0a 2020 2020  4.1f) ' % \.    
-00091ee0: 2020 2020 2020 2020 2020 284e 5f74 2c20            (N_t, 
-00091ef0: 4e5f 642c 2064 662e 7368 6170 655b 305d  N_d, df.shape[0]
-00091f00: 2c20 7365 6e73 2c20 7072 6563 2929 0a20  , sens, prec)). 
-00091f10: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-00091f20: 2c20 7072 6563 2c20 7365 6e73 2c20 6466  , prec, sens, df
-00091f30: 2e73 6861 7065 5b30 5d2c 204e 5f64 2c20  .shape[0], N_d, 
-00091f40: 4e5f 740a 2020 2020 656c 7365 3a0a 2020  N_t.    else:.  
-00091f50: 2020 2020 2020 7072 696e 7428 2720 2729        print(' ')
-00091f60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00091f70: 4e6f 6e65 2c20 302c 2030 2c20 302c 2030  None, 0, 0, 0, 0
-00091f80: 2c20 300a 2020 2020 2020 2020 2020 2020  , 0.            
-00091f90: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+000914c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000914d0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+000914e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000914f0: 2020 2020 6d61 7463 685b 636e 745f 745d      match[cnt_t]
+00091500: 203d 2063 6e74 5f64 0a20 2020 2020 2020   = cnt_d.       
+00091510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091520: 2020 2020 2020 2020 2064 6973 745b 636e           dist[cn
+00091530: 745f 745d 203d 2070 5f74 202d 2070 5f64  t_t] = p_t - p_d
+00091540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091560: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
+00091570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091580: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+00091590: 6420 2b3d 2031 0a20 2020 2020 2020 2020  d += 1.         
+000915a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915b0: 2020 2020 2020 2062 203d 2046 616c 7365         b = False
+000915c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000915d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915e0: 2027 2727 0a20 2020 2020 2020 2020 2020   '''.           
+000915f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00091600: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00091610: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00091620: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+00091630: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00091640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091650: 2020 2020 2069 6620 623a 0a20 2020 2020       if b:.     
+00091660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091670: 2020 2020 2020 2063 6e74 5f74 202b 3d20         cnt_t += 
+00091680: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00091690: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+000916a0: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
+000916b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000916c0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+000916d0: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
+000916e0: 745f 7420 3d3d 2027 4927 2920 2620 2874  t_t == 'I') & (t
+000916f0: 5f64 203d 3d20 2744 2729 3a0a 2020 2020  _d == 'D'):.    
+00091700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091710: 2020 2020 6d61 7463 685b 636e 745f 745d      match[cnt_t]
+00091720: 203d 2063 6e74 5f64 0a20 2020 2020 2020   = cnt_d.       
+00091730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091740: 2064 6973 745b 636e 745f 745d 203d 2070   dist[cnt_t] = p
+00091750: 5f74 202d 2070 5f64 0a20 2020 2020 2020  _t - p_d.       
+00091760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091770: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
+00091780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091790: 2020 2020 636e 745f 6420 2b3d 2031 0a20      cnt_d += 1. 
+000917a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000917b0: 2020 2020 2020 2062 203d 2046 616c 7365         b = False
+000917c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000917d0: 2020 2020 2020 656c 6966 2028 745f 7420        elif (t_t 
+000917e0: 3d3d 2027 4427 2920 2620 2874 5f64 203d  == 'D') & (t_d =
+000917f0: 3d20 2749 2729 3a0a 2020 2020 2020 2020  = 'I'):.        
+00091800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091810: 6d61 7463 685b 636e 745f 745d 203d 2063  match[cnt_t] = c
+00091820: 6e74 5f64 0a20 2020 2020 2020 2020 2020  nt_d.           
+00091830: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+00091840: 745b 636e 745f 745d 203d 2070 5f74 202d  t[cnt_t] = p_t -
+00091850: 2070 5f64 0a20 2020 2020 2020 2020 2020   p_d.           
+00091860: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
+00091870: 5f74 202b 3d20 310a 2020 2020 2020 2020  _t += 1.        
+00091880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091890: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
+000918a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000918b0: 2020 2062 203d 2046 616c 7365 0a20 2020     b = False.   
+000918c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000918d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000918e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000918f0: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
+00091900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091910: 2020 2020 2320 636e 745f 6420 2b3d 2031      # cnt_d += 1
+00091920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091930: 2020 2020 2020 2020 2069 6620 2863 6e74           if (cnt
+00091940: 5f64 203e 3d20 6e5f 6465 7465 6374 6564  _d >= n_detected
+00091950: 2920 7c20 2863 6e74 5f74 203e 3d20 6e5f  ) | (cnt_t >= n_
+00091960: 7461 7267 6574 293a 2062 7265 616b 0a20  target): break. 
+00091970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091980: 2020 2020 2020 200a 0a20 2020 2020 2020         ..       
+00091990: 2020 2020 2062 203d 206d 6174 6368 203e       b = match >
+000919a0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+000919b0: 7768 5f74 203d 2077 6869 6368 2862 290a  wh_t = which(b).
+000919c0: 2020 2020 2020 2020 2020 2020 7768 5f64              wh_d
+000919d0: 203d 206d 6174 6368 5b77 685f 745d 0a20   = match[wh_t]. 
+000919e0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+000919f0: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
+00091a00: 685f 7429 203e 2030 3a0a 2020 2020 2020  h_t) > 0:.      
+00091a10: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
+00091a20: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00091a30: 2020 2020 2020 2020 2020 2064 665f 745b             df_t[
+00091a40: 2764 6973 7427 5d20 3d20 6469 7374 0a20  'dist'] = dist. 
+00091a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091a60: 2020 2064 6631 203d 2064 665f 742e 696c     df1 = df_t.il
+00091a70: 6f63 5b77 685f 745d 2e63 6f70 7928 6465  oc[wh_t].copy(de
+00091a80: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
+00091a90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00091aa0: 6632 203d 2064 665f 642e 696c 6f63 5b77  f2 = df_d.iloc[w
+00091ab0: 685f 645d 2e63 6f70 7928 6465 6570 203d  h_d].copy(deep =
+00091ac0: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
+00091ad0: 2020 2020 2020 2020 2020 2063 6e74 202b             cnt +
+00091ae0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00091af0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00091b00: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00091b10: 5f74 5b27 6469 7374 275d 203d 2064 6973  _t['dist'] = dis
+00091b20: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00091b30: 2020 2020 2020 6466 3120 3d20 7064 2e63        df1 = pd.c
+00091b40: 6f6e 6361 7428 5b64 6631 2c20 6466 5f74  oncat([df1, df_t
+00091b50: 2e69 6c6f 635b 7768 5f74 5d2e 636f 7079  .iloc[wh_t].copy
+00091b60: 2864 6565 7020 3d20 5472 7565 295d 290a  (deep = True)]).
+00091b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091b80: 2020 2020 6466 3220 3d20 7064 2e63 6f6e      df2 = pd.con
+00091b90: 6361 7428 5b64 6632 2c20 6466 5f64 2e69  cat([df2, df_d.i
+00091ba0: 6c6f 635b 7768 5f64 5d2e 636f 7079 2864  loc[wh_d].copy(d
+00091bb0: 6565 7020 3d20 5472 7565 295d 290a 2020  eep = True)]).  
+00091bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091bd0: 2020 636e 7420 2b3d 2031 0a20 2020 2020    cnt += 1.     
+00091be0: 2020 2020 2020 0a20 2020 2070 7269 6e74        .    print
+00091bf0: 2827 5c72 4d61 7463 6869 6e67 202e 2e20  ('\rMatching .. 
+00091c00: 646f 6e65 2e20 272c 2065 6e64 203d 2027  done. ', end = '
+00091c10: 2729 0a20 2020 2069 6620 636e 7420 3e20  ').    if cnt > 
+00091c20: 303a 0a20 2020 2020 2020 2064 6632 203d  0:.        df2 =
+00091c30: 2064 6632 2e72 656e 616d 6528 2063 6f6c   df2.rename( col
+00091c40: 756d 6e73 203d 207b 2763 6872 273a 2027  umns = {'chr': '
+00091c50: 6368 725f 6427 2c20 2774 7970 6527 3a20  chr_d', 'type': 
+00091c60: 2774 7970 655f 6427 2c20 2770 6f73 5f6f  'type_d', 'pos_o
+00091c70: 7267 273a 2027 706f 735f 6f72 675f 6427  rg': 'pos_org_d'
+00091c80: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00091c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091ca0: 2020 2020 2773 6571 5f6f 7267 273a 2027      'seq_org': '
+00091cb0: 7365 715f 6f72 675f 6427 2c20 2773 6571  seq_org_d', 'seq
+00091cc0: 5f6e 6577 273a 2027 7365 715f 6e65 775f  _new': 'seq_new_
+00091cd0: 6427 7d20 290a 2020 2020 2020 2020 7365  d'} ).        se
+00091ce0: 6c5f 636f 6c5f 7420 3d20 5b27 6368 7227  l_col_t = ['chr'
+00091cf0: 2c20 2774 7970 6527 2c20 2770 6f73 5f6f  , 'type', 'pos_o
+00091d00: 7267 272c 2027 7365 715f 6f72 6727 2c20  rg', 'seq_org', 
+00091d10: 2773 6571 5f6e 6577 272c 2027 6469 7374  'seq_new', 'dist
+00091d20: 275d 0a20 2020 2020 2020 2073 656c 5f63  '].        sel_c
+00091d30: 6f6c 5f64 203d 205b 2769 6427 2c20 2763  ol_d = ['id', 'c
+00091d40: 6872 5f64 272c 2027 7479 7065 5f64 272c  hr_d', 'type_d',
+00091d50: 2027 706f 735f 6f72 675f 6427 2c20 2773   'pos_org_d', 's
+00091d60: 6571 5f6f 7267 5f64 272c 2027 7365 715f  eq_org_d', 'seq_
+00091d70: 6e65 775f 6427 5d0a 2020 2020 2020 2020  new_d'].        
+00091d80: 6466 312e 696e 6465 7820 3d20 7064 2e49  df1.index = pd.I
+00091d90: 6e64 6578 285b 6b20 666f 7220 6b20 696e  ndex([k for k in
+00091da0: 2072 616e 6765 2864 6631 2e73 6861 7065   range(df1.shape
+00091db0: 5b30 5d29 5d29 0a20 2020 2020 2020 2064  [0])]).        d
+00091dc0: 6632 2e69 6e64 6578 203d 2070 642e 496e  f2.index = pd.In
+00091dd0: 6465 7828 5b6b 2066 6f72 206b 2069 6e20  dex([k for k in 
+00091de0: 7261 6e67 6528 6466 322e 7368 6170 655b  range(df2.shape[
+00091df0: 305d 295d 290a 2020 2020 2020 2020 6466  0])]).        df
+00091e00: 203d 2070 642e 636f 6e63 6174 2820 5b64   = pd.concat( [d
+00091e10: 6631 5b73 656c 5f63 6f6c 5f74 5d2c 2064  f1[sel_col_t], d
+00091e20: 6632 5b73 656c 5f63 6f6c 5f64 5d5d 2c20  f2[sel_col_d]], 
+00091e30: 6178 6973 203d 2031 2c20 736f 7274 3d46  axis = 1, sort=F
+00091e40: 616c 7365 2029 2020 2020 2020 2020 0a20  alse )        . 
+00091e50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00091e60: 2020 2020 7365 6e73 203d 2031 3030 2a64      sens = 100*d
+00091e70: 662e 7368 6170 655b 305d 2f4e 5f74 0a20  f.shape[0]/N_t. 
+00091e80: 2020 2020 2020 2070 7265 6320 3d20 3130         prec = 10
+00091e90: 302a 6466 2e73 6861 7065 5b30 5d2f 4e5f  0*df.shape[0]/N_
+00091ea0: 640a 2020 2020 2020 2020 7072 696e 7428  d.        print(
+00091eb0: 2720 4e5f 743a 2025 692c 204e 5f64 3a20  ' N_t: %i, N_d: 
+00091ec0: 2569 202d 3e20 2569 2028 7365 6e73 3a20  %i -> %i (sens: 
+00091ed0: 2534 2e31 662c 2070 7265 633a 2025 342e  %4.1f, prec: %4.
+00091ee0: 3166 2920 2720 2520 5c0a 2020 2020 2020  1f) ' % \.      
+00091ef0: 2020 2020 2020 2020 284e 5f74 2c20 4e5f          (N_t, N_
+00091f00: 642c 2064 662e 7368 6170 655b 305d 2c20  d, df.shape[0], 
+00091f10: 7365 6e73 2c20 7072 6563 2929 0a20 2020  sens, prec)).   
+00091f20: 2020 2020 2072 6574 7572 6e20 6466 2c20       return df, 
+00091f30: 7072 6563 2c20 7365 6e73 2c20 6466 2e73  prec, sens, df.s
+00091f40: 6861 7065 5b30 5d2c 204e 5f64 2c20 4e5f  hape[0], N_d, N_
+00091f50: 740a 2020 2020 656c 7365 3a0a 2020 2020  t.    else:.    
+00091f60: 2020 2020 7072 696e 7428 2720 2729 0a20      print(' '). 
+00091f70: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00091f80: 6e65 2c20 302c 2030 2c20 302c 2030 2c20  ne, 0, 0, 0, 0, 
+00091f90: 300a 2020 2020 2020 2020 2020 2020 0a23  0.            .#
 00091fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00091fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00091fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091fd0: 2323 2323 2323 2323 2323 230a 2323 2053  ###########.## S
-00091fe0: 656f 6b68 7975 6e20 596f 6f6e 2028 7379  eokhyun Yoon (sy
-00091ff0: 6f6f 6e40 646b 752e 6564 7529 204f 6374  oon@dku.edu) Oct
-00092000: 2e20 3034 2c20 3230 3230 0a23 2323 2323  . 04, 2020.#####
-00092010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091fe0: 2323 2323 2323 2323 230a 2323 2053 656f  #########.## Seo
+00091ff0: 6b68 7975 6e20 596f 6f6e 2028 7379 6f6f  khyun Yoon (syoo
+00092000: 6e40 646b 752e 6564 7529 204f 6374 2e20  n@dku.edu) Oct. 
+00092010: 3034 2c20 3230 3230 0a23 2323 2323 2323  04, 2020.#######
 00092020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00092030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00092040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092050: 2323 2323 230a 0a0a 0a0a 2020 2020 2020  #####.....      
-00092060: 2020 0a                                    .
+00092050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092060: 2323 230a 0a0a 0a0a 2020 2020 2020 2020  ###.....        
+00092070: 0a                                       .
```

### Comparing `StringFix-0.6.7/StringFix/pybam.py` & `StringFix-0.6.8/StringFix/pybam.py`

 * *Files identical despite different names*

### Comparing `StringFix-0.6.7/StringFix/run_sfix.py` & `StringFix-0.6.8/StringFix/run_sfix.py`

 * *Files identical despite different names*

### Comparing `StringFix-0.6.7/StringFix.egg-info/PKG-INFO` & `StringFix-0.6.8/StringFix.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.6.7
+Version: 0.6.8
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.6.7/setup.py` & `StringFix-0.6.8/setup.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from setuptools import setup, find_packages
 
 setup(
     # 배포할 패키지의 이름을 적어줍니다. setup.py파일을 가지는 폴더 이름과 동일하게 합니다.
     name                = 'StringFix',
     # 배포할 패키지의 버전을 적어줍니다. 첫 등록이므로 0.1 또는 0.0.1을 사용합니다.
-    version             = '0.6.7',
+    version             = '0.6.8',
     # 배포할 패키지에 대한 설명을 작성합니다.
     description         = 'Annotation guided transcriptome assembly program.',
     # 배포하는 사람의 이름을 작성합니다.
     author              = 'Joongho Lee, Seokhyun Yoon',
     # 배포하는 사람의 메일주소를 작성합니다.
     author_email        = 'syoon@dku.edu',
     # 배포하는 패키지의 url을 적어줍니다. 보통 github 링크를 적습니다.
```

