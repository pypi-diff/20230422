# Comparing `tmp/StringFix-0.6.9.tar.gz` & `tmp/StringFix-0.7.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "StringFix-0.6.9.tar", last modified: Sat Apr 22 05:33:17 2023, max compression
+gzip compressed data, was "StringFix-0.7.0.tar", last modified: Sat Apr 22 06:49:52 2023, max compression
```

## Comparing `StringFix-0.6.9.tar` & `StringFix-0.7.0.tar`

### file list

```diff
@@ -1,19 +1,19 @@
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 05:33:17.494445 StringFix-0.6.9/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.6.9/LICENSE
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.6.9/MANIFEST.in
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 05:33:17.494445 StringFix-0.6.9/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.6.9/README.md
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 05:33:17.494445 StringFix-0.6.9/StringFix/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.6.9/StringFix/__init__.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)   598129 2023-04-22 05:28:21.000000 StringFix-0.6.9/StringFix/core.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)    53685 2023-04-22 02:22:03.000000 StringFix-0.6.9/StringFix/pybam.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     7641 2023-04-22 05:31:54.000000 StringFix-0.6.9/StringFix/run_sfix.py
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 05:33:17.494445 StringFix-0.6.9/StringFix.egg-info/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 05:33:17.000000 StringFix-0.6.9/StringFix.egg-info/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-22 05:33:17.000000 StringFix-0.6.9/StringFix.egg-info/SOURCES.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 05:33:17.000000 StringFix-0.6.9/StringFix.egg-info/dependency_links.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 05:33:17.000000 StringFix-0.6.9/StringFix.egg-info/not-zip-safe
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-22 05:33:17.000000 StringFix-0.6.9/StringFix.egg-info/requires.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       10 2023-04-22 05:33:17.000000 StringFix-0.6.9/StringFix.egg-info/top_level.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-22 05:33:17.494445 StringFix-0.6.9/setup.cfg
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-22 05:32:30.000000 StringFix-0.6.9/setup.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 06:49:52.801424 StringFix-0.7.0/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.7.0/LICENSE
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.7.0/MANIFEST.in
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 06:49:52.801424 StringFix-0.7.0/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.7.0/README.md
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 06:49:52.801424 StringFix-0.7.0/StringFix/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.7.0/StringFix/__init__.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)   598341 2023-04-22 06:48:52.000000 StringFix-0.7.0/StringFix/core.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    53685 2023-04-22 02:22:03.000000 StringFix-0.7.0/StringFix/pybam.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     7641 2023-04-22 06:48:52.000000 StringFix-0.7.0/StringFix/run_sfix.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 06:49:52.801424 StringFix-0.7.0/StringFix.egg-info/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 06:49:52.000000 StringFix-0.7.0/StringFix.egg-info/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-22 06:49:52.000000 StringFix-0.7.0/StringFix.egg-info/SOURCES.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 06:49:52.000000 StringFix-0.7.0/StringFix.egg-info/dependency_links.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 05:33:17.000000 StringFix-0.7.0/StringFix.egg-info/not-zip-safe
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-22 06:49:52.000000 StringFix-0.7.0/StringFix.egg-info/requires.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       10 2023-04-22 06:49:52.000000 StringFix-0.7.0/StringFix.egg-info/top_level.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-22 06:49:52.801424 StringFix-0.7.0/setup.cfg
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-22 06:49:01.000000 StringFix-0.7.0/setup.py
```

### Comparing `StringFix-0.6.9/LICENSE` & `StringFix-0.7.0/LICENSE`

 * *Files identical despite different names*

### Comparing `StringFix-0.6.9/PKG-INFO` & `StringFix-0.7.0/PKG-INFO`

 * *Files 15% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.6.9
+Version: 0.7.0
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.6.9/StringFix/core.py` & `StringFix-0.7.0/StringFix/core.py`

 * *Files 1% similar despite different names*

```diff
@@ -31730,5655 +31730,5668 @@
 0007bf10: 745f 746d 702c 2063 6e74 5f65 203d 2067  t_tmp, cnt_e = g
 0007bf20: 642e 6765 745f 6765 6e65 5f6c 6576 656c  d.get_gene_level
 0007bf30: 5f6e 765f 696e 666f 2863 6e74 5f65 290a  _nv_info(cnt_e).
 0007bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0007bf50: 2020 2020 2020 2020 6e76 5f6c 7374 203d          nv_lst =
 0007bf60: 206e 765f 6c73 7420 2b20 6e76 5f6c 7374   nv_lst + nv_lst
 0007bf70: 5f74 6d70 0a0a 2020 2020 2020 2020 2020  _tmp..          
-0007bf80: 2020 2020 2020 2020 2020 6466 203d 2070            df = p
-0007bf90: 642e 4461 7461 4672 616d 6528 6e76 5f6c  d.DataFrame(nv_l
-0007bfa0: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
-0007bfb0: 2020 2020 2020 2020 6466 5f73 6e76 203d          df_snv =
-0007bfc0: 2064 665b 5b27 6368 7227 2c20 2770 6f73   df[['chr', 'pos
-0007bfd0: 5f72 6566 272c 2027 7265 665f 7365 7127  _ref', 'ref_seq'
-0007bfe0: 2c20 2761 6c74 5f73 6571 272c 2027 6376  , 'alt_seq', 'cv
-0007bff0: 675f 6465 7074 6827 2c20 2763 7667 5f66  g_depth', 'cvg_f
-0007c000: 7261 6327 2c20 2776 5f74 7970 6527 2c20  rac', 'v_type', 
-0007c010: 2776 5f6c 656e 272c 2027 765f 636c 6173  'v_len', 'v_clas
-0007c020: 7327 2c20 2776 5f63 6c61 7373 5f74 7227  s', 'v_class_tr'
-0007c030: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-0007c040: 2020 2020 2020 2064 665f 736e 762e 746f         df_snv.to
-0007c050: 5f63 7376 2866 6e61 6d65 5f73 6e76 2c20  _csv(fname_snv, 
-0007c060: 7365 703d 275c 7427 290a 2020 2020 2020  sep='\t').      
-0007c070: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0007c080: 696e 7428 2753 4e56 2073 756d 6d61 7279  int('SNV summary
-0007c090: 2073 6176 6564 2074 6f20 2850 4520 2569   saved to (PE %i
-0007c0a0: 2920 5c6e 2020 2025 7327 2025 2028 636e  ) \n   %s' % (cn
-0007c0b0: 745f 652c 2066 6e61 6d65 5f73 6e76 2929  t_e, fname_snv))
-0007c0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c0d0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0007c0e0: 2020 7464 5f65 7870 5f69 6e66 6f20 3d20    td_exp_info = 
-0007c0f0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-0007c100: 2020 2066 6f72 206d 2c20 6764 2069 6e20     for m, gd in 
-0007c110: 656e 756d 6572 6174 6528 6764 7329 3a0a  enumerate(gds):.
-0007c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c130: 2020 2020 7469 7320 3d20 6764 2e67 6574      tis = gd.get
-0007c140: 5f74 645f 6578 705f 696e 666f 2829 0a20  _td_exp_info(). 
-0007c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c160: 2020 2074 645f 6578 705f 696e 666f 203d     td_exp_info =
-0007c170: 2074 645f 6578 705f 696e 666f 202b 2074   td_exp_info + t
-0007c180: 6973 0a20 2020 2020 2020 200a 2020 2020  is.        .    
-0007c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c1b0: 2064 665f 7464 5f65 7870 5f69 6e66 6f20   df_td_exp_info 
-0007c1c0: 3d20 7064 2e44 6174 6146 7261 6d65 2874  = pd.DataFrame(t
-0007c1d0: 645f 6578 705f 696e 666f 290a 2020 2020  d_exp_info).    
-0007c1e0: 2020 2020 2020 2020 2020 2020 6162 6e5f              abn_
-0007c1f0: 7375 6d20 3d20 6466 5f74 645f 6578 705f  sum = df_td_exp_
-0007c200: 696e 666f 5b27 6162 6e27 5d2e 7375 6d28  info['abn'].sum(
-0007c210: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007c220: 2020 6966 2061 626e 5f73 756d 203e 2030    if abn_sum > 0
-0007c230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007c240: 2020 2020 2020 6e66 203d 2031 3030 3030        nf = 10000
-0007c250: 3030 2f61 626e 5f73 756d 0a20 2020 2020  00/abn_sum.     
-0007c260: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0007c270: 665f 7464 5f65 7870 5f69 6e66 6f5b 2774  f_td_exp_info['t
-0007c280: 706d 275d 203d 2064 665f 7464 5f65 7870  pm'] = df_td_exp
-0007c290: 5f69 6e66 6f5b 2761 626e 275d 2a6e 660a  _info['abn']*nf.
-0007c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c2c0: 2064 665f 7464 5f65 7870 5f69 6e66 6f2e   df_td_exp_info.
-0007c2d0: 746f 5f63 7376 2866 6e61 6d65 5f65 7870  to_csv(fname_exp
-0007c2e0: 2c20 7365 703d 275c 7427 290a 2020 2020  , sep='\t').    
-0007c2f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0007c300: 7428 2754 7261 6e73 6372 6970 7420 6578  t('Transcript ex
-0007c310: 7072 6573 7369 6f6e 2070 726f 6669 6c65  pression profile
-0007c320: 2073 6176 6564 2074 6f20 5c6e 2020 2025   saved to \n   %
-0007c330: 7327 2025 2066 6e61 6d65 5f65 7870 290a  s' % fname_exp).
-0007c340: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0007c350: 2867 7466 2069 7320 4e6f 6e65 293a 0a0a  (gtf is None):..
-0007c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c370: 5472 5f6c 7374 203d 2054 725f 6c73 7420  Tr_lst = Tr_lst 
-0007c380: 2b20 4973 5f6c 7374 0a20 2020 2020 2020  + Is_lst.       
-0007c390: 2020 2020 2020 2020 2074 725f 7365 6c20           tr_sel 
-0007c3a0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0007c3b0: 2020 2020 2069 6620 6c65 6e28 5472 5f6c       if len(Tr_l
-0007c3c0: 7374 2920 3e20 303a 0a20 2020 2020 2020  st) > 0:.       
-0007c3d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0007c3e0: 2074 7220 696e 2054 725f 6c73 743a 200a   tr in Tr_lst: .
-0007c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c400: 2020 2020 2020 2020 6966 2028 6c65 6e28          if (len(
-0007c410: 7472 2e73 6571 2920 3e3d 206c 656e 5f74  tr.seq) >= len_t
-0007c420: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-0007c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c440: 7472 5f73 656c 2e61 7070 656e 6428 7472  tr_sel.append(tr
-0007c450: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007c460: 2020 2020 2020 2074 725f 7365 6c20 3d20         tr_sel = 
-0007c470: 6765 745f 7470 6d28 7472 5f73 656c 290a  get_tpm(tr_sel).
-0007c480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c490: 2069 6620 6c65 6e28 7472 5f73 656c 2920   if len(tr_sel) 
-0007c4a0: 3e20 303a 0a0a 2020 2020 2020 2020 2020  > 0:..          
-0007c4b0: 2020 2020 2020 2020 2020 6966 2054 525f            if TR_
-0007c4c0: 4649 4c54 4552 5f53 454c 203d 3d20 313a  FILTER_SEL == 1:
-0007c4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c4e0: 2020 2020 2020 2020 2074 725f 7365 6c20           tr_sel 
-0007c4f0: 3d20 6669 6c74 6572 5f74 7273 5f31 2820  = filter_trs_1( 
-0007c500: 7472 5f73 656c 2c20 7264 5f6c 656e 2c20  tr_sel, rd_len, 
-0007c510: 675f 7468 203d 204d 494e 5f4e 5f52 4453  g_th = MIN_N_RDS
-0007c520: 5f50 4552 5f47 454e 452c 2061 626e 5f74  _PER_GENE, abn_t
-0007c530: 685f 7420 3d20 4d49 4e5f 4142 4e5f 544f  h_t = MIN_ABN_TO
-0007c540: 5f53 454c 2c20 5c0a 2020 2020 2020 2020  _SEL, \.        
-0007c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c570: 2020 2020 2020 2061 626e 5f74 685f 6920         abn_th_i 
-0007c580: 3d20 4d49 4e5f 4142 4e5f 544f 5f53 454c  = MIN_ABN_TO_SEL
-0007c590: 2c20 6973 6f5f 6672 6163 5f74 6820 3d20  , iso_frac_th = 
-0007c5a0: 4d49 4e5f 4953 4f5f 4652 4143 2c20 6c65  MIN_ISO_FRAC, le
-0007c5b0: 6e5f 7468 203d 204d 494e 5f54 525f 4c45  n_th = MIN_TR_LE
-0007c5c0: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
-0007c5d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0007bf80: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0007bf90: 286e 765f 6c73 7429 203e 2030 3a0a 2020  (nv_lst) > 0:.  
+0007bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bfb0: 2020 2020 2020 6466 203d 2070 642e 4461        df = pd.Da
+0007bfc0: 7461 4672 616d 6528 6e76 5f6c 7374 290a  taFrame(nv_lst).
+0007bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bfe0: 2020 2020 2020 2020 6466 5f73 6e76 203d          df_snv =
+0007bff0: 2064 665b 5b27 6368 7227 2c20 2770 6f73   df[['chr', 'pos
+0007c000: 5f72 6566 272c 2027 7265 665f 7365 7127  _ref', 'ref_seq'
+0007c010: 2c20 2761 6c74 5f73 6571 272c 2027 6376  , 'alt_seq', 'cv
+0007c020: 675f 6465 7074 6827 2c20 2763 7667 5f66  g_depth', 'cvg_f
+0007c030: 7261 6327 2c20 2776 5f74 7970 6527 2c20  rac', 'v_type', 
+0007c040: 2776 5f6c 656e 272c 2027 765f 636c 6173  'v_len', 'v_clas
+0007c050: 7327 2c20 2776 5f63 6c61 7373 5f74 7227  s', 'v_class_tr'
+0007c060: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+0007c070: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
+0007c080: 762e 746f 5f63 7376 2866 6e61 6d65 5f73  v.to_csv(fname_s
+0007c090: 6e76 2c20 7365 703d 275c 7427 290a 2020  nv, sep='\t').  
+0007c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c0b0: 2020 2020 2020 7072 696e 7428 2753 4e56        print('SNV
+0007c0c0: 2073 756d 6d61 7279 2073 6176 6564 2074   summary saved t
+0007c0d0: 6f20 2850 4520 2569 2920 5c6e 2020 2025  o (PE %i) \n   %
+0007c0e0: 7327 2025 2028 636e 745f 652c 2066 6e61  s' % (cnt_e, fna
+0007c0f0: 6d65 5f73 6e76 2929 0a20 2020 2020 2020  me_snv)).       
+0007c100: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0007c110: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0007c120: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0007c130: 2827 4e6f 2053 4e56 7320 666f 756e 642e  ('No SNVs found.
+0007c140: 2027 290a 2020 2020 2020 2020 2020 2020   ').            
+0007c150: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007c160: 2020 2020 2074 645f 6578 705f 696e 666f       td_exp_info
+0007c170: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0007c180: 2020 2020 2020 666f 7220 6d2c 2067 6420        for m, gd 
+0007c190: 696e 2065 6e75 6d65 7261 7465 2867 6473  in enumerate(gds
+0007c1a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0007c1b0: 2020 2020 2020 2074 6973 203d 2067 642e         tis = gd.
+0007c1c0: 6765 745f 7464 5f65 7870 5f69 6e66 6f28  get_td_exp_info(
+0007c1d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007c1e0: 2020 2020 2020 7464 5f65 7870 5f69 6e66        td_exp_inf
+0007c1f0: 6f20 3d20 7464 5f65 7870 5f69 6e66 6f20  o = td_exp_info 
+0007c200: 2b20 7469 730a 2020 2020 2020 2020 0a20  + tis.        . 
+0007c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c220: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0007c230: 2020 2020 6466 5f74 645f 6578 705f 696e      df_td_exp_in
+0007c240: 666f 203d 2070 642e 4461 7461 4672 616d  fo = pd.DataFram
+0007c250: 6528 7464 5f65 7870 5f69 6e66 6f29 0a20  e(td_exp_info). 
+0007c260: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0007c270: 626e 5f73 756d 203d 2064 665f 7464 5f65  bn_sum = df_td_e
+0007c280: 7870 5f69 6e66 6f5b 2761 626e 275d 2e73  xp_info['abn'].s
+0007c290: 756d 2829 0a20 2020 2020 2020 2020 2020  um().           
+0007c2a0: 2020 2020 2069 6620 6162 6e5f 7375 6d20       if abn_sum 
+0007c2b0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0007c2c0: 2020 2020 2020 2020 206e 6620 3d20 3130           nf = 10
+0007c2d0: 3030 3030 302f 6162 6e5f 7375 6d0a 2020  00000/abn_sum.  
+0007c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c2f0: 2020 6466 5f74 645f 6578 705f 696e 666f    df_td_exp_info
+0007c300: 5b27 7470 6d27 5d20 3d20 6466 5f74 645f  ['tpm'] = df_td_
+0007c310: 6578 705f 696e 666f 5b27 6162 6e27 5d2a  exp_info['abn']*
+0007c320: 6e66 0a20 2020 2020 2020 2020 2020 2020  nf.             
+0007c330: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0007c340: 2020 2020 6466 5f74 645f 6578 705f 696e      df_td_exp_in
+0007c350: 666f 2e74 6f5f 6373 7628 666e 616d 655f  fo.to_csv(fname_
+0007c360: 6578 702c 2073 6570 3d27 5c74 2729 0a20  exp, sep='\t'). 
+0007c370: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007c380: 7269 6e74 2827 5472 616e 7363 7269 7074  rint('Transcript
+0007c390: 2065 7870 7265 7373 696f 6e20 7072 6f66   expression prof
+0007c3a0: 696c 6520 7361 7665 6420 746f 205c 6e20  ile saved to \n 
+0007c3b0: 2020 2573 2720 2520 666e 616d 655f 6578    %s' % fname_ex
+0007c3c0: 7029 0a0a 2020 2020 2020 2020 2020 2020  p)..            
+0007c3d0: 6966 2028 6774 6620 6973 204e 6f6e 6529  if (gtf is None)
+0007c3e0: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+0007c3f0: 2020 2054 725f 6c73 7420 3d20 5472 5f6c     Tr_lst = Tr_l
+0007c400: 7374 202b 2049 735f 6c73 740a 2020 2020  st + Is_lst.    
+0007c410: 2020 2020 2020 2020 2020 2020 7472 5f73              tr_s
+0007c420: 656c 203d 205b 5d0a 2020 2020 2020 2020  el = [].        
+0007c430: 2020 2020 2020 2020 6966 206c 656e 2854          if len(T
+0007c440: 725f 6c73 7429 203e 2030 3a0a 2020 2020  r_lst) > 0:.    
+0007c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c460: 666f 7220 7472 2069 6e20 5472 5f6c 7374  for tr in Tr_lst
+0007c470: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0007c480: 2020 2020 2020 2020 2020 2069 6620 286c             if (l
+0007c490: 656e 2874 722e 7365 7129 203e 3d20 6c65  en(tr.seq) >= le
+0007c4a0: 6e5f 7468 293a 0a20 2020 2020 2020 2020  n_th):.         
+0007c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c4c0: 2020 2074 725f 7365 6c2e 6170 7065 6e64     tr_sel.append
+0007c4d0: 2874 7229 0a0a 2020 2020 2020 2020 2020  (tr)..          
+0007c4e0: 2020 2020 2020 2020 2020 7472 5f73 656c            tr_sel
+0007c4f0: 203d 2067 6574 5f74 706d 2874 725f 7365   = get_tpm(tr_se
+0007c500: 6c29 0a0a 2020 2020 2020 2020 2020 2020  l)..            
+0007c510: 2020 2020 6966 206c 656e 2874 725f 7365      if len(tr_se
+0007c520: 6c29 203e 2030 3a0a 0a20 2020 2020 2020  l) > 0:..       
+0007c530: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007c540: 5452 5f46 494c 5445 525f 5345 4c20 3d3d  TR_FILTER_SEL ==
+0007c550: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0007c560: 2020 2020 2020 2020 2020 2020 7472 5f73              tr_s
+0007c570: 656c 203d 2066 696c 7465 725f 7472 735f  el = filter_trs_
+0007c580: 3128 2074 725f 7365 6c2c 2072 645f 6c65  1( tr_sel, rd_le
+0007c590: 6e2c 2067 5f74 6820 3d20 4d49 4e5f 4e5f  n, g_th = MIN_N_
+0007c5a0: 5244 535f 5045 525f 4745 4e45 2c20 6162  RDS_PER_GENE, ab
+0007c5b0: 6e5f 7468 5f74 203d 204d 494e 5f41 424e  n_th_t = MIN_ABN
+0007c5c0: 5f54 4f5f 5345 4c2c 205c 0a20 2020 2020  _TO_SEL, \.     
+0007c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0007c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c5f0: 2020 2020 2020 2020 7472 5f73 656c 203d          tr_sel =
-0007c600: 2066 696c 7465 725f 7472 735f 3228 2074   filter_trs_2( t
-0007c610: 725f 7365 6c2c 2072 645f 6c65 6e2c 2067  r_sel, rd_len, g
-0007c620: 5f74 6820 3d20 4d49 4e5f 4e5f 5244 535f  _th = MIN_N_RDS_
-0007c630: 5045 525f 4745 4e45 2c20 6162 6e5f 7468  PER_GENE, abn_th
-0007c640: 5f74 203d 204d 494e 5f41 424e 5f54 4f5f  _t = MIN_ABN_TO_
-0007c650: 5345 4c2c 205c 0a20 2020 2020 2020 2020  SEL, \.         
-0007c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c680: 2020 2020 2020 6162 6e5f 7468 5f69 203d        abn_th_i =
-0007c690: 204d 494e 5f41 424e 5f54 4f5f 5345 4c2c   MIN_ABN_TO_SEL,
-0007c6a0: 2069 736f 5f66 7261 635f 7468 203d 204d   iso_frac_th = M
-0007c6b0: 494e 5f49 534f 5f46 5241 432c 206c 656e  IN_ISO_FRAC, len
-0007c6c0: 5f74 6820 3d20 4d49 4e5f 5452 5f4c 454e  _th = MIN_TR_LEN
-0007c6d0: 4754 4829 0a0a 2020 2020 2020 2020 2020  GTH)..          
-0007c6e0: 2020 2020 2020 2020 2020 666e 616d 655f            fname_
-0007c6f0: 7472 203d 2066 6e61 6d65 202b 2027 5f74  tr = fname + '_t
-0007c700: 7261 6e73 6372 6970 746f 6d65 2e66 6127  ranscriptome.fa'
-0007c710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c720: 2020 2020 2066 6e61 6d65 5f70 7220 3d20       fname_pr = 
-0007c730: 666e 616d 6520 2b20 275f 7072 6f74 656f  fname + '_proteo
-0007c740: 6d65 2e66 6127 0a20 2020 2020 2020 2020  me.fa'.         
-0007c750: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0007c760: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-0007c770: 6176 696e 6720 2e2e 2027 2c20 656e 6420  aving .. ', end 
-0007c780: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
-0007c790: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-0007c7a0: 2020 2020 2020 2020 7361 7665 5f74 7261          save_tra
-0007c7b0: 6e73 6372 6970 7473 3228 2066 6e61 6d65  nscripts2( fname
-0007c7c0: 5f74 722c 2074 725f 7365 6c20 290a 0a20  _tr, tr_sel ).. 
-0007c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c7e0: 2020 2068 6472 5f6c 7374 2c20 7473 6571     hdr_lst, tseq
-0007c7f0: 5f6c 7374 203d 206c 6f61 645f 6661 7374  _lst = load_fast
-0007c800: 6131 2820 666e 616d 655f 7472 2c20 7665  a1( fname_tr, ve
-0007c810: 7262 6f73 6520 3d20 4661 6c73 6529 0a20  rbose = False). 
-0007c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c830: 2020 2063 616e 645f 636e 7420 3d20 6c65     cand_cnt = le
-0007c840: 6e28 7473 6571 5f6c 7374 290a 0a20 2020  n(tseq_lst)..   
-0007c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c860: 206c 696e 6573 203d 2067 656e 5f70 726f   lines = gen_pro
-0007c870: 7465 6f6d 655f 6672 6f6d 5f74 7261 7363  teome_from_trasc
-0007c880: 7269 7074 6f6d 6528 6864 725f 6c73 742c  riptome(hdr_lst,
-0007c890: 2074 7365 715f 6c73 742c 206c 656e 5f74   tseq_lst, len_t
-0007c8a0: 6820 3d20 4d49 4e5f 5052 5f4c 454e 4754  h = MIN_PR_LENGT
-0007c8b0: 482c 2076 6572 626f 7365 203d 2046 616c  H, verbose = Fal
-0007c8c0: 7365 2c20 7472 6172 6563 6f20 3d20 4661  se, trareco = Fa
-0007c8d0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-0007c8e0: 2020 2020 2020 2020 2070 5f63 616e 645f           p_cand_
-0007c8f0: 636e 7420 3d20 6c65 6e28 6c69 6e65 7329  cnt = len(lines)
-0007c900: 2f32 0a20 2020 2020 2020 2020 2020 2020  /2.             
-0007c910: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0007c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c930: 2020 2020 6620 3d20 6f70 656e 2866 6e61      f = open(fna
-0007c940: 6d65 5f70 722c 2777 2b27 290a 2020 2020  me_pr,'w+').    
-0007c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c960: 662e 7772 6974 656c 696e 6573 286c 696e  f.writelines(lin
-0007c970: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-0007c980: 2020 2020 2020 2020 662e 636c 6f73 6528          f.close(
-0007c990: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007c9a0: 2020 2020 2020 2070 7269 6e74 2827 2064         print(' d
-0007c9b0: 6f6e 652e 2729 0a20 2020 2020 2020 2020  one.').         
-0007c9c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0007c9d0: 2827 2020 2025 7327 2025 2028 666e 616d  ('   %s' % (fnam
-0007c9e0: 655f 7472 2920 290a 2020 2020 2020 2020  e_tr) ).        
-0007c9f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0007ca00: 7428 2720 2020 2573 2720 2520 2866 6e61  t('   %s' % (fna
-0007ca10: 6d65 5f70 7229 2029 0a20 2020 2020 2020  me_pr) ).       
-0007ca20: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0007ca30: 6e74 2827 2020 2025 7327 2025 2028 666e  nt('   %s' % (fn
-0007ca40: 616d 655f 6766 6629 2029 0a0a 2020 2020  ame_gff) )..    
-0007ca50: 2320 7072 696e 7428 2753 7472 696e 6746  # print('StringF
-0007ca60: 6978 5f61 6e61 6c79 7369 7320 6669 6e69  ix_analysis fini
-0007ca70: 7368 6564 2027 2c20 6461 7465 7469 6d65  shed ', datetime
-0007ca80: 2e64 6174 6574 696d 652e 6e6f 7728 2929  .datetime.now())
-0007ca90: 0a20 2020 2072 6574 7572 6e20 666e 616d  .    return fnam
-0007caa0: 652c 2067 6473 200a 0a0a 4765 6e65 5f54  e, gds ...Gene_T
-0007cab0: 725f 696e 666f 203d 2063 6f6c 6c65 6374  r_info = collect
-0007cac0: 696f 6e73 2e6e 616d 6564 7475 706c 6528  ions.namedtuple(
-0007cad0: 2747 656e 655f 5472 5f69 6e66 6f27 2c20  'Gene_Tr_info', 
-0007cae0: 2774 725f 6964 2c20 7472 5f6e 616d 652c  'tr_id, tr_name,
-0007caf0: 2067 656e 655f 6964 2c20 6765 6e65 5f6e   gene_id, gene_n
-0007cb00: 616d 652c 2062 696f 7479 7065 2c20 6368  ame, biotype, ch
-0007cb10: 722c 2073 7461 7274 2c20 656e 642c 2073  r, start, end, s
-0007cb20: 7472 616e 642c 2063 6f64 696e 672c 206e  trand, coding, n
-0007cb30: 756d 5f65 786f 6e73 2c20 7472 5f6c 656e  um_exons, tr_len
-0007cb40: 2720 290a 0a64 6566 2062 7569 6c64 5f67  ' )..def build_g
-0007cb50: 656e 655f 7472 616e 7363 7269 7074 5f74  ene_transcript_t
-0007cb60: 6162 6c65 2820 6774 665f 6669 6c65 2029  able( gtf_file )
-0007cb70: 3a0a 0a20 2020 2067 7466 5f6c 696e 6573  :..    gtf_lines
-0007cb80: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
-0007cb90: 6164 5f67 7466 2820 6774 665f 6669 6c65  ad_gtf( gtf_file
-0007cba0: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
-0007cbb0: 290a 2020 2020 6764 5f6c 7374 2c20 6368  ).    gd_lst, ch
-0007cbc0: 7273 203d 2067 6574 5f67 656e 655f 6465  rs = get_gene_de
-0007cbd0: 7363 7269 7074 6f72 2867 7466 5f6c 696e  scriptor(gtf_lin
-0007cbe0: 6573 2c20 6765 6e6f 6d65 203d 204e 6f6e  es, genome = Non
-0007cbf0: 652c 2066 696c 6c20 3d20 4661 6c73 652c  e, fill = False,
-0007cc00: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0007cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cc40: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
-0007cc50: 206e 5f63 6f72 6573 203d 2031 290a 2020   n_cores = 1).  
-0007cc60: 2020 6465 6c20 6774 665f 6c69 6e65 730a    del gtf_lines.
-0007cc70: 0a20 2020 2063 6872 5f6c 7374 203d 206c  .    chr_lst = l
-0007cc80: 6973 7428 7365 7428 6368 7273 2929 0a20  ist(set(chrs)). 
-0007cc90: 2020 2063 6872 5f6c 7374 2e73 6f72 7428     chr_lst.sort(
-0007cca0: 290a 2020 2020 6368 7273 203d 206e 702e  ).    chrs = np.
-0007ccb0: 6172 7261 7928 6368 7273 290a 0a20 2020  array(chrs)..   
-0007ccc0: 2067 745f 6c73 7420 3d20 5b5d 0a20 2020   gt_lst = [].   
-0007ccd0: 2066 6f72 2063 6872 6d20 696e 2063 6872   for chrm in chr
-0007cce0: 5f6c 7374 3a0a 2020 2020 2020 2020 7768  _lst:.        wh
-0007ccf0: 203d 2077 6869 6368 2863 6872 7320 3d3d   = which(chrs ==
-0007cd00: 2063 6872 6d29 0a0a 2020 2020 2020 2020   chrm)..        
-0007cd10: 735f 706f 7320 3d20 6e70 2e7a 6572 6f73  s_pos = np.zeros
-0007cd20: 286c 656e 2877 6829 290a 2020 2020 2020  (len(wh)).      
-0007cd30: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-0007cd40: 286c 656e 2877 6829 293a 200a 2020 2020  (len(wh)): .    
-0007cd50: 2020 2020 2020 2020 735f 706f 735b 6b5d          s_pos[k]
-0007cd60: 203d 2067 645f 6c73 745b 7768 5b6b 5d5d   = gd_lst[wh[k]]
-0007cd70: 2e62 6567 696e 0a20 2020 2020 2020 206f  .begin.        o
-0007cd80: 6472 203d 2073 5f70 6f73 2e61 7267 736f  dr = s_pos.argso
-0007cd90: 7274 2829 0a0a 2020 2020 2020 2020 6764  rt()..        gd
-0007cda0: 5f73 656c 5f6f 7264 6572 6564 203d 205b  _sel_ordered = [
-0007cdb0: 6764 5f6c 7374 5b77 685b 6f64 725b 6b5d  gd_lst[wh[odr[k]
-0007cdc0: 5d5d 2066 6f72 206b 2069 6e20 7261 6e67  ]] for k in rang
-0007cdd0: 6528 6c65 6e28 7768 2929 5d0a 0a20 2020  e(len(wh))]..   
-0007cde0: 2020 2020 2066 6f72 206b 2c20 6764 2069       for k, gd i
-0007cdf0: 6e20 656e 756d 6572 6174 6528 6764 5f73  n enumerate(gd_s
-0007ce00: 656c 5f6f 7264 6572 6564 293a 0a20 2020  el_ordered):.   
-0007ce10: 2020 2020 2020 2020 2066 6f72 206d 2c20           for m, 
-0007ce20: 7464 2069 6e20 656e 756d 6572 6174 6528  td in enumerate(
-0007ce30: 6764 2e74 645f 6c73 7429 3a0a 2020 2020  gd.td_lst):.    
-0007ce40: 2020 2020 2020 2020 2020 2020 7469 6420              tid 
-0007ce50: 3d20 7464 2e74 6964 0a20 2020 2020 2020  = td.tid.       
-0007ce60: 2020 2020 2020 2020 2074 6e61 6d65 203d           tname =
-0007ce70: 2074 642e 746e 616d 650a 2020 2020 2020   td.tname.      
-0007ce80: 2020 2020 2020 2020 2020 6769 6420 3d20            gid = 
-0007ce90: 7464 2e67 6964 0a20 2020 2020 2020 2020  td.gid.         
-0007cea0: 2020 2020 2020 2067 6e61 6d65 203d 2074         gname = t
-0007ceb0: 642e 676e 616d 650a 2020 2020 2020 2020  d.gname.        
-0007cec0: 2020 2020 2020 2020 6269 6f74 7970 6520          biotype 
-0007ced0: 3d20 7464 2e62 696f 7479 7065 0a20 2020  = td.biotype.   
-0007cee0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-0007cef0: 7274 203d 2074 642e 6265 6769 6e0a 2020  rt = td.begin.  
-0007cf00: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0007cf10: 6420 3d20 7464 2e65 6e64 0a20 2020 2020  d = td.end.     
-0007cf20: 2020 2020 2020 2020 2020 206e 5f65 7820             n_ex 
-0007cf30: 3d20 7464 2e6e 6578 6f6e 730a 2020 2020  = td.nexons.    
-0007cf40: 2020 2020 2020 2020 2020 2020 746c 656e              tlen
-0007cf50: 203d 2074 642e 746c 656e 0a20 2020 2020   = td.tlen.     
-0007cf60: 2020 2020 2020 2020 2020 2073 7472 616e             stran
-0007cf70: 6420 3d20 6765 745f 635f 6672 6f6d 5f69  d = get_c_from_i
-0007cf80: 7374 7261 6e64 2820 7464 2e69 7374 7261  strand( td.istra
-0007cf90: 6e64 2029 0a20 2020 2020 2020 2020 2020  nd ).           
-0007cfa0: 2020 2020 2063 6473 203d 2067 6574 5f73       cds = get_s
-0007cfb0: 7472 5f66 726f 6d5f 6963 646e 6728 2074  tr_from_icdng( t
-0007cfc0: 642e 6963 6473 2029 0a0a 2020 2020 2020  d.icds )..      
-0007cfd0: 2020 2020 2020 2020 2020 6774 6520 3d20            gte = 
-0007cfe0: 4765 6e65 5f54 725f 696e 666f 2820 7469  Gene_Tr_info( ti
-0007cff0: 642c 2074 6e61 6d65 2c20 6769 642c 2067  d, tname, gid, g
-0007d000: 6e61 6d65 2c20 6269 6f74 7970 652c 2063  name, biotype, c
-0007d010: 6872 6d2c 2073 7461 7274 2c20 656e 642c  hrm, start, end,
-0007d020: 2073 7472 616e 642c 2063 6473 2c20 6e5f   strand, cds, n_
-0007d030: 6578 2c20 746c 656e 2029 0a20 2020 2020  ex, tlen ).     
-0007d040: 2020 2020 2020 2020 2020 2067 745f 6c73             gt_ls
-0007d050: 742e 6170 7065 6e64 2867 7465 290a 0a20  t.append(gte).. 
-0007d060: 2020 2070 7269 6e74 2827 5c6e 5361 7669     print('\nSavi
-0007d070: 6e67 202e 2e20 2027 2c20 656e 6420 3d20  ng ..  ', end = 
-0007d080: 2727 290a 2020 2020 6466 203d 2070 642e  '').    df = pd.
-0007d090: 4461 7461 4672 616d 6528 6774 5f6c 7374  DataFrame(gt_lst
-0007d0a0: 290a 2020 2020 6669 6c65 5f6f 7574 203d  ).    file_out =
-0007d0b0: 2067 7466 5f66 696c 6520 2b20 272e 7472   gtf_file + '.tr
-0007d0c0: 616e 7363 7269 7074 5f69 6e66 6f2e 7473  anscript_info.ts
-0007d0d0: 7627 0a20 2020 2064 662e 746f 5f63 7376  v'.    df.to_csv
-0007d0e0: 2866 696c 655f 6f75 742c 2073 6570 203d  (file_out, sep =
-0007d0f0: 2027 5c74 2729 0a20 2020 2070 7269 6e74   '\t').    print
-0007d100: 2827 646f 6e65 2e27 290a 0a20 2020 2070  ('done.')..    p
-0007d110: 7269 6e74 2827 5472 616e 7363 7269 7074  rint('Transcript
-0007d120: 2069 6e66 6f2e 2073 6176 6564 2074 6f20   info. saved to 
-0007d130: 2573 2720 2520 6669 6c65 5f6f 7574 290a  %s' % file_out).
-0007d140: 0a20 2020 2072 6574 7572 6e20 6774 5f6c  .    return gt_l
-0007d150: 7374 0a0a 2727 270a 6465 6620 4765 6e65  st..'''.def Gene
-0007d160: 7261 7465 5f50 726f 7465 6f6d 6528 7472  rate_Proteome(tr
-0007d170: 5f66 612c 206c 656e 5f74 6820 3d20 4d49  _fa, len_th = MI
-0007d180: 4e5f 5052 5f4c 454e 4754 482c 2076 6572  N_PR_LENGTH, ver
-0007d190: 626f 7365 203d 2054 7275 652c 206d 785f  bose = True, mx_
-0007d1a0: 636e 7420 3d20 302c 2074 7261 7265 636f  cnt = 0, trareco
-0007d1b0: 203d 2046 616c 7365 2c20 666e 616d 655f   = False, fname_
-0007d1c0: 6f75 7420 3d20 4e6f 6e65 293a 0a20 2020  out = None):.   
-0007d1d0: 200a 2020 2020 6669 6c65 5f6e 616d 6520   .    file_name 
-0007d1e0: 3d20 7472 5f66 612e 7370 6c69 7428 272f  = tr_fa.split('/
-0007d1f0: 2729 5b2d 315d 0a20 2020 2066 6e73 203d  ')[-1].    fns =
-0007d200: 2066 696c 655f 6e61 6d65 2e73 706c 6974   file_name.split
-0007d210: 2827 2e27 295b 3a2d 315d 0a20 2020 2066  ('.')[:-1].    f
-0007d220: 6e61 6d65 203d 2027 270a 2020 2020 666f  name = ''.    fo
-0007d230: 7220 6b2c 2066 6e20 696e 2065 6e75 6d65  r k, fn in enume
-0007d240: 7261 7465 2866 6e73 293a 0a20 2020 2020  rate(fns):.     
-0007d250: 2020 2069 6620 6b20 3e20 303a 0a20 2020     if k > 0:.   
-0007d260: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
-0007d270: 2066 6e61 6d65 202b 2027 2e27 0a20 2020   fname + '.'.   
-0007d280: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-0007d290: 6d65 202b 2066 6e0a 2020 2020 0a20 2020  me + fn.    .   
-0007d2a0: 2068 6472 5f6c 7374 2c20 7473 6571 5f6c   hdr_lst, tseq_l
-0007d2b0: 7374 203d 206c 6f61 645f 6661 7374 6131  st = load_fasta1
-0007d2c0: 2874 725f 6661 2c20 7665 7262 6f73 6520  (tr_fa, verbose 
-0007d2d0: 3d20 4661 6c73 6529 0a20 2020 2063 616e  = False).    can
-0007d2e0: 645f 636e 7420 3d20 6c65 6e28 7473 6571  d_cnt = len(tseq
-0007d2f0: 5f6c 7374 290a 0a20 2020 206c 696e 6573  _lst)..    lines
-0007d300: 203d 2067 656e 5f70 726f 7465 6f6d 655f   = gen_proteome_
-0007d310: 6672 6f6d 5f74 7261 7363 7269 7074 6f6d  from_trascriptom
-0007d320: 6528 6864 725f 6c73 742c 2074 7365 715f  e(hdr_lst, tseq_
-0007d330: 6c73 742c 206c 656e 5f74 6820 3d20 6c65  lst, len_th = le
-0007d340: 6e5f 7468 2c20 7665 7262 6f73 6520 3d20  n_th, verbose = 
-0007d350: 7665 7262 6f73 652c 2074 7261 7265 636f  verbose, trareco
-0007d360: 203d 2074 7261 7265 636f 290a 2020 2020   = trareco).    
-0007d370: 705f 6361 6e64 5f63 6e74 203d 206c 656e  p_cand_cnt = len
-0007d380: 286c 696e 6573 292f 320a 2020 2020 2020  (lines)/2.      
-0007d390: 2020 2020 2020 0a20 2020 2069 6620 666e        .    if fn
-0007d3a0: 616d 655f 6f75 7420 6973 204e 6f6e 653a  ame_out is None:
-0007d3b0: 2066 6e61 6d65 5f6f 7574 203d 2066 6e61   fname_out = fna
-0007d3c0: 6d65 202b 2027 5f70 726f 7465 6f6d 652e  me + '_proteome.
-0007d3d0: 6661 270a 2020 2020 6620 3d20 6f70 656e  fa'.    f = open
-0007d3e0: 2866 6e61 6d65 5f6f 7574 2c27 772b 2729  (fname_out,'w+')
-0007d3f0: 0a20 2020 2066 2e77 7269 7465 6c69 6e65  .    f.writeline
-0007d400: 7328 6c69 6e65 7329 0a20 2020 2066 2e63  s(lines).    f.c
-0007d410: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-0007d420: 2020 2020 2020 200a 2020 2020 6966 2076         .    if v
-0007d430: 6572 626f 7365 3a20 0a20 2020 2020 2020  erbose: .       
-0007d440: 2070 7269 6e74 2827 4141 5365 7120 7361   print('AASeq sa
-0007d450: 7665 6420 746f 2025 7327 2025 2028 666e  ved to %s' % (fn
-0007d460: 616d 655f 6f75 7429 290a 2020 2020 2020  ame_out)).      
-0007d470: 2020 0a20 2020 2072 6574 7572 6e20 666e    .    return fn
-0007d480: 616d 655f 6f75 740a 2727 270a 0a23 2323  ame_out.'''..###
-0007d490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d4a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d4d0: 2323 2323 2323 230a 2323 2053 7472 696e  #######.## Strin
-0007d4e0: 6746 6978 2061 6464 6f6e 2773 0a23 2323  gFix addon's.###
-0007d4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007c5f0: 2020 2020 2020 2020 2020 6162 6e5f 7468            abn_th
+0007c600: 5f69 203d 204d 494e 5f41 424e 5f54 4f5f  _i = MIN_ABN_TO_
+0007c610: 5345 4c2c 2069 736f 5f66 7261 635f 7468  SEL, iso_frac_th
+0007c620: 203d 204d 494e 5f49 534f 5f46 5241 432c   = MIN_ISO_FRAC,
+0007c630: 206c 656e 5f74 6820 3d20 4d49 4e5f 5452   len_th = MIN_TR
+0007c640: 5f4c 454e 4754 4829 0a20 2020 2020 2020  _LENGTH).       
+0007c650: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0007c660: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0007c670: 2020 2020 2020 2020 2020 2074 725f 7365             tr_se
+0007c680: 6c20 3d20 6669 6c74 6572 5f74 7273 5f32  l = filter_trs_2
+0007c690: 2820 7472 5f73 656c 2c20 7264 5f6c 656e  ( tr_sel, rd_len
+0007c6a0: 2c20 675f 7468 203d 204d 494e 5f4e 5f52  , g_th = MIN_N_R
+0007c6b0: 4453 5f50 4552 5f47 454e 452c 2061 626e  DS_PER_GENE, abn
+0007c6c0: 5f74 685f 7420 3d20 4d49 4e5f 4142 4e5f  _th_t = MIN_ABN_
+0007c6d0: 544f 5f53 454c 2c20 5c0a 2020 2020 2020  TO_SEL, \.      
+0007c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c700: 2020 2020 2020 2020 2061 626e 5f74 685f           abn_th_
+0007c710: 6920 3d20 4d49 4e5f 4142 4e5f 544f 5f53  i = MIN_ABN_TO_S
+0007c720: 454c 2c20 6973 6f5f 6672 6163 5f74 6820  EL, iso_frac_th 
+0007c730: 3d20 4d49 4e5f 4953 4f5f 4652 4143 2c20  = MIN_ISO_FRAC, 
+0007c740: 6c65 6e5f 7468 203d 204d 494e 5f54 525f  len_th = MIN_TR_
+0007c750: 4c45 4e47 5448 290a 0a20 2020 2020 2020  LENGTH)..       
+0007c760: 2020 2020 2020 2020 2020 2020 2066 6e61               fna
+0007c770: 6d65 5f74 7220 3d20 666e 616d 6520 2b20  me_tr = fname + 
+0007c780: 275f 7472 616e 7363 7269 7074 6f6d 652e  '_transcriptome.
+0007c790: 6661 270a 2020 2020 2020 2020 2020 2020  fa'.            
+0007c7a0: 2020 2020 2020 2020 666e 616d 655f 7072          fname_pr
+0007c7b0: 203d 2066 6e61 6d65 202b 2027 5f70 726f   = fname + '_pro
+0007c7c0: 7465 6f6d 652e 6661 270a 2020 2020 2020  teome.fa'.      
+0007c7d0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0007c7e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0007c7f0: 2827 5361 7669 6e67 202e 2e20 272c 2065  ('Saving .. ', e
+0007c800: 6e64 203d 2027 272c 2066 6c75 7368 203d  nd = '', flush =
+0007c810: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
+0007c820: 2020 2020 2020 2020 2020 2073 6176 655f             save_
+0007c830: 7472 616e 7363 7269 7074 7332 2820 666e  transcripts2( fn
+0007c840: 616d 655f 7472 2c20 7472 5f73 656c 2029  ame_tr, tr_sel )
+0007c850: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0007c860: 2020 2020 2020 6864 725f 6c73 742c 2074        hdr_lst, t
+0007c870: 7365 715f 6c73 7420 3d20 6c6f 6164 5f66  seq_lst = load_f
+0007c880: 6173 7461 3128 2066 6e61 6d65 5f74 722c  asta1( fname_tr,
+0007c890: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
+0007c8a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007c8b0: 2020 2020 2020 6361 6e64 5f63 6e74 203d        cand_cnt =
+0007c8c0: 206c 656e 2874 7365 715f 6c73 7429 0a0a   len(tseq_lst)..
+0007c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c8e0: 2020 2020 6c69 6e65 7320 3d20 6765 6e5f      lines = gen_
+0007c8f0: 7072 6f74 656f 6d65 5f66 726f 6d5f 7472  proteome_from_tr
+0007c900: 6173 6372 6970 746f 6d65 2868 6472 5f6c  ascriptome(hdr_l
+0007c910: 7374 2c20 7473 6571 5f6c 7374 2c20 6c65  st, tseq_lst, le
+0007c920: 6e5f 7468 203d 204d 494e 5f50 525f 4c45  n_th = MIN_PR_LE
+0007c930: 4e47 5448 2c20 7665 7262 6f73 6520 3d20  NGTH, verbose = 
+0007c940: 4661 6c73 652c 2074 7261 7265 636f 203d  False, trareco =
+0007c950: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+0007c960: 2020 2020 2020 2020 2020 2020 705f 6361              p_ca
+0007c970: 6e64 5f63 6e74 203d 206c 656e 286c 696e  nd_cnt = len(lin
+0007c980: 6573 292f 320a 2020 2020 2020 2020 2020  es)/2.          
+0007c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c9a0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007c9b0: 2020 2020 2020 2066 203d 206f 7065 6e28         f = open(
+0007c9c0: 666e 616d 655f 7072 2c27 772b 2729 0a20  fname_pr,'w+'). 
+0007c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c9e0: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
+0007c9f0: 6c69 6e65 7329 0a20 2020 2020 2020 2020  lines).         
+0007ca00: 2020 2020 2020 2020 2020 2066 2e63 6c6f             f.clo
+0007ca10: 7365 2829 0a0a 2020 2020 2020 2020 2020  se()..          
+0007ca20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0007ca30: 2720 646f 6e65 2e27 290a 2020 2020 2020  ' done.').      
+0007ca40: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0007ca50: 696e 7428 2720 2020 2573 2720 2520 2866  int('   %s' % (f
+0007ca60: 6e61 6d65 5f74 7229 2029 0a20 2020 2020  name_tr) ).     
+0007ca70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007ca80: 7269 6e74 2827 2020 2025 7327 2025 2028  rint('   %s' % (
+0007ca90: 666e 616d 655f 7072 2920 290a 2020 2020  fname_pr) ).    
+0007caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cab0: 7072 696e 7428 2720 2020 2573 2720 2520  print('   %s' % 
+0007cac0: 2866 6e61 6d65 5f67 6666 2920 290a 0a20  (fname_gff) ).. 
+0007cad0: 2020 2023 2070 7269 6e74 2827 5374 7269     # print('Stri
+0007cae0: 6e67 4669 785f 616e 616c 7973 6973 2066  ngFix_analysis f
+0007caf0: 696e 6973 6865 6420 272c 2064 6174 6574  inished ', datet
+0007cb00: 696d 652e 6461 7465 7469 6d65 2e6e 6f77  ime.datetime.now
+0007cb10: 2829 290a 2020 2020 7265 7475 726e 2066  ()).    return f
+0007cb20: 6e61 6d65 2c20 6764 7320 0a0a 0a47 656e  name, gds ...Gen
+0007cb30: 655f 5472 5f69 6e66 6f20 3d20 636f 6c6c  e_Tr_info = coll
+0007cb40: 6563 7469 6f6e 732e 6e61 6d65 6474 7570  ections.namedtup
+0007cb50: 6c65 2827 4765 6e65 5f54 725f 696e 666f  le('Gene_Tr_info
+0007cb60: 272c 2027 7472 5f69 642c 2074 725f 6e61  ', 'tr_id, tr_na
+0007cb70: 6d65 2c20 6765 6e65 5f69 642c 2067 656e  me, gene_id, gen
+0007cb80: 655f 6e61 6d65 2c20 6269 6f74 7970 652c  e_name, biotype,
+0007cb90: 2063 6872 2c20 7374 6172 742c 2065 6e64   chr, start, end
+0007cba0: 2c20 7374 7261 6e64 2c20 636f 6469 6e67  , strand, coding
+0007cbb0: 2c20 6e75 6d5f 6578 6f6e 732c 2074 725f  , num_exons, tr_
+0007cbc0: 6c65 6e27 2029 0a0a 6465 6620 6275 696c  len' )..def buil
+0007cbd0: 645f 6765 6e65 5f74 7261 6e73 6372 6970  d_gene_transcrip
+0007cbe0: 745f 7461 626c 6528 2067 7466 5f66 696c  t_table( gtf_fil
+0007cbf0: 6520 293a 0a0a 2020 2020 6774 665f 6c69  e ):..    gtf_li
+0007cc00: 6e65 732c 2068 6472 5f6c 696e 6573 203d  nes, hdr_lines =
+0007cc10: 206c 6f61 645f 6774 6628 2067 7466 5f66   load_gtf( gtf_f
+0007cc20: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
+0007cc30: 7275 6529 0a20 2020 2067 645f 6c73 742c  rue).    gd_lst,
+0007cc40: 2063 6872 7320 3d20 6765 745f 6765 6e65   chrs = get_gene
+0007cc50: 5f64 6573 6372 6970 746f 7228 6774 665f  _descriptor(gtf_
+0007cc60: 6c69 6e65 732c 2067 656e 6f6d 6520 3d20  lines, genome = 
+0007cc70: 4e6f 6e65 2c20 6669 6c6c 203d 2046 616c  None, fill = Fal
+0007cc80: 7365 2c20 5c0a 2020 2020 2020 2020 2020  se, \.          
+0007cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ccc0: 2020 2020 7665 7262 6f73 6520 3d20 5472      verbose = Tr
+0007ccd0: 7565 2c20 6e5f 636f 7265 7320 3d20 3129  ue, n_cores = 1)
+0007cce0: 0a20 2020 2064 656c 2067 7466 5f6c 696e  .    del gtf_lin
+0007ccf0: 6573 0a0a 2020 2020 6368 725f 6c73 7420  es..    chr_lst 
+0007cd00: 3d20 6c69 7374 2873 6574 2863 6872 7329  = list(set(chrs)
+0007cd10: 290a 2020 2020 6368 725f 6c73 742e 736f  ).    chr_lst.so
+0007cd20: 7274 2829 0a20 2020 2063 6872 7320 3d20  rt().    chrs = 
+0007cd30: 6e70 2e61 7272 6179 2863 6872 7329 0a0a  np.array(chrs)..
+0007cd40: 2020 2020 6774 5f6c 7374 203d 205b 5d0a      gt_lst = [].
+0007cd50: 2020 2020 666f 7220 6368 726d 2069 6e20      for chrm in 
+0007cd60: 6368 725f 6c73 743a 0a20 2020 2020 2020  chr_lst:.       
+0007cd70: 2077 6820 3d20 7768 6963 6828 6368 7273   wh = which(chrs
+0007cd80: 203d 3d20 6368 726d 290a 0a20 2020 2020   == chrm)..     
+0007cd90: 2020 2073 5f70 6f73 203d 206e 702e 7a65     s_pos = np.ze
+0007cda0: 726f 7328 6c65 6e28 7768 2929 0a20 2020  ros(len(wh)).   
+0007cdb0: 2020 2020 2066 6f72 206b 2069 6e20 7261       for k in ra
+0007cdc0: 6e67 6528 6c65 6e28 7768 2929 3a20 0a20  nge(len(wh)): . 
+0007cdd0: 2020 2020 2020 2020 2020 2073 5f70 6f73             s_pos
+0007cde0: 5b6b 5d20 3d20 6764 5f6c 7374 5b77 685b  [k] = gd_lst[wh[
+0007cdf0: 6b5d 5d2e 6265 6769 6e0a 2020 2020 2020  k]].begin.      
+0007ce00: 2020 6f64 7220 3d20 735f 706f 732e 6172    odr = s_pos.ar
+0007ce10: 6773 6f72 7428 290a 0a20 2020 2020 2020  gsort()..       
+0007ce20: 2067 645f 7365 6c5f 6f72 6465 7265 6420   gd_sel_ordered 
+0007ce30: 3d20 5b67 645f 6c73 745b 7768 5b6f 6472  = [gd_lst[wh[odr
+0007ce40: 5b6b 5d5d 5d20 666f 7220 6b20 696e 2072  [k]]] for k in r
+0007ce50: 616e 6765 286c 656e 2877 6829 295d 0a0a  ange(len(wh))]..
+0007ce60: 2020 2020 2020 2020 666f 7220 6b2c 2067          for k, g
+0007ce70: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
+0007ce80: 645f 7365 6c5f 6f72 6465 7265 6429 3a0a  d_sel_ordered):.
+0007ce90: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0007cea0: 6d2c 2074 6420 696e 2065 6e75 6d65 7261  m, td in enumera
+0007ceb0: 7465 2867 642e 7464 5f6c 7374 293a 0a20  te(gd.td_lst):. 
+0007cec0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0007ced0: 6964 203d 2074 642e 7469 640a 2020 2020  id = td.tid.    
+0007cee0: 2020 2020 2020 2020 2020 2020 746e 616d              tnam
+0007cef0: 6520 3d20 7464 2e74 6e61 6d65 0a20 2020  e = td.tname.   
+0007cf00: 2020 2020 2020 2020 2020 2020 2067 6964               gid
+0007cf10: 203d 2074 642e 6769 640a 2020 2020 2020   = td.gid.      
+0007cf20: 2020 2020 2020 2020 2020 676e 616d 6520            gname 
+0007cf30: 3d20 7464 2e67 6e61 6d65 0a20 2020 2020  = td.gname.     
+0007cf40: 2020 2020 2020 2020 2020 2062 696f 7479             bioty
+0007cf50: 7065 203d 2074 642e 6269 6f74 7970 650a  pe = td.biotype.
+0007cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cf70: 7374 6172 7420 3d20 7464 2e62 6567 696e  start = td.begin
+0007cf80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007cf90: 2065 6e64 203d 2074 642e 656e 640a 2020   end = td.end.  
+0007cfa0: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+0007cfb0: 6578 203d 2074 642e 6e65 786f 6e73 0a20  ex = td.nexons. 
+0007cfc0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0007cfd0: 6c65 6e20 3d20 7464 2e74 6c65 6e0a 2020  len = td.tlen.  
+0007cfe0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0007cff0: 7261 6e64 203d 2067 6574 5f63 5f66 726f  rand = get_c_fro
+0007d000: 6d5f 6973 7472 616e 6428 2074 642e 6973  m_istrand( td.is
+0007d010: 7472 616e 6420 290a 2020 2020 2020 2020  trand ).        
+0007d020: 2020 2020 2020 2020 6364 7320 3d20 6765          cds = ge
+0007d030: 745f 7374 725f 6672 6f6d 5f69 6364 6e67  t_str_from_icdng
+0007d040: 2820 7464 2e69 6364 7320 290a 0a20 2020  ( td.icds )..   
+0007d050: 2020 2020 2020 2020 2020 2020 2067 7465               gte
+0007d060: 203d 2047 656e 655f 5472 5f69 6e66 6f28   = Gene_Tr_info(
+0007d070: 2074 6964 2c20 746e 616d 652c 2067 6964   tid, tname, gid
+0007d080: 2c20 676e 616d 652c 2062 696f 7479 7065  , gname, biotype
+0007d090: 2c20 6368 726d 2c20 7374 6172 742c 2065  , chrm, start, e
+0007d0a0: 6e64 2c20 7374 7261 6e64 2c20 6364 732c  nd, strand, cds,
+0007d0b0: 206e 5f65 782c 2074 6c65 6e20 290a 2020   n_ex, tlen ).  
+0007d0c0: 2020 2020 2020 2020 2020 2020 2020 6774                gt
+0007d0d0: 5f6c 7374 2e61 7070 656e 6428 6774 6529  _lst.append(gte)
+0007d0e0: 0a0a 2020 2020 7072 696e 7428 275c 6e53  ..    print('\nS
+0007d0f0: 6176 696e 6720 2e2e 2020 272c 2065 6e64  aving ..  ', end
+0007d100: 203d 2027 2729 0a20 2020 2064 6620 3d20   = '').    df = 
+0007d110: 7064 2e44 6174 6146 7261 6d65 2867 745f  pd.DataFrame(gt_
+0007d120: 6c73 7429 0a20 2020 2066 696c 655f 6f75  lst).    file_ou
+0007d130: 7420 3d20 6774 665f 6669 6c65 202b 2027  t = gtf_file + '
+0007d140: 2e74 7261 6e73 6372 6970 745f 696e 666f  .transcript_info
+0007d150: 2e74 7376 270a 2020 2020 6466 2e74 6f5f  .tsv'.    df.to_
+0007d160: 6373 7628 6669 6c65 5f6f 7574 2c20 7365  csv(file_out, se
+0007d170: 7020 3d20 275c 7427 290a 2020 2020 7072  p = '\t').    pr
+0007d180: 696e 7428 2764 6f6e 652e 2729 0a0a 2020  int('done.')..  
+0007d190: 2020 7072 696e 7428 2754 7261 6e73 6372    print('Transcr
+0007d1a0: 6970 7420 696e 666f 2e20 7361 7665 6420  ipt info. saved 
+0007d1b0: 746f 2025 7327 2025 2066 696c 655f 6f75  to %s' % file_ou
+0007d1c0: 7429 0a0a 2020 2020 7265 7475 726e 2067  t)..    return g
+0007d1d0: 745f 6c73 740a 0a27 2727 0a64 6566 2047  t_lst..'''.def G
+0007d1e0: 656e 6572 6174 655f 5072 6f74 656f 6d65  enerate_Proteome
+0007d1f0: 2874 725f 6661 2c20 6c65 6e5f 7468 203d  (tr_fa, len_th =
+0007d200: 204d 494e 5f50 525f 4c45 4e47 5448 2c20   MIN_PR_LENGTH, 
+0007d210: 7665 7262 6f73 6520 3d20 5472 7565 2c20  verbose = True, 
+0007d220: 6d78 5f63 6e74 203d 2030 2c20 7472 6172  mx_cnt = 0, trar
+0007d230: 6563 6f20 3d20 4661 6c73 652c 2066 6e61  eco = False, fna
+0007d240: 6d65 5f6f 7574 203d 204e 6f6e 6529 3a0a  me_out = None):.
+0007d250: 2020 2020 0a20 2020 2066 696c 655f 6e61      .    file_na
+0007d260: 6d65 203d 2074 725f 6661 2e73 706c 6974  me = tr_fa.split
+0007d270: 2827 2f27 295b 2d31 5d0a 2020 2020 666e  ('/')[-1].    fn
+0007d280: 7320 3d20 6669 6c65 5f6e 616d 652e 7370  s = file_name.sp
+0007d290: 6c69 7428 272e 2729 5b3a 2d31 5d0a 2020  lit('.')[:-1].  
+0007d2a0: 2020 666e 616d 6520 3d20 2727 0a20 2020    fname = ''.   
+0007d2b0: 2066 6f72 206b 2c20 666e 2069 6e20 656e   for k, fn in en
+0007d2c0: 756d 6572 6174 6528 666e 7329 3a0a 2020  umerate(fns):.  
+0007d2d0: 2020 2020 2020 6966 206b 203e 2030 3a0a        if k > 0:.
+0007d2e0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+0007d2f0: 6520 3d20 666e 616d 6520 2b20 272e 270a  e = fname + '.'.
+0007d300: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
+0007d310: 666e 616d 6520 2b20 666e 0a20 2020 200a  fname + fn.    .
+0007d320: 2020 2020 6864 725f 6c73 742c 2074 7365      hdr_lst, tse
+0007d330: 715f 6c73 7420 3d20 6c6f 6164 5f66 6173  q_lst = load_fas
+0007d340: 7461 3128 7472 5f66 612c 2076 6572 626f  ta1(tr_fa, verbo
+0007d350: 7365 203d 2046 616c 7365 290a 2020 2020  se = False).    
+0007d360: 6361 6e64 5f63 6e74 203d 206c 656e 2874  cand_cnt = len(t
+0007d370: 7365 715f 6c73 7429 0a0a 2020 2020 6c69  seq_lst)..    li
+0007d380: 6e65 7320 3d20 6765 6e5f 7072 6f74 656f  nes = gen_proteo
+0007d390: 6d65 5f66 726f 6d5f 7472 6173 6372 6970  me_from_trascrip
+0007d3a0: 746f 6d65 2868 6472 5f6c 7374 2c20 7473  tome(hdr_lst, ts
+0007d3b0: 6571 5f6c 7374 2c20 6c65 6e5f 7468 203d  eq_lst, len_th =
+0007d3c0: 206c 656e 5f74 682c 2076 6572 626f 7365   len_th, verbose
+0007d3d0: 203d 2076 6572 626f 7365 2c20 7472 6172   = verbose, trar
+0007d3e0: 6563 6f20 3d20 7472 6172 6563 6f29 0a20  eco = trareco). 
+0007d3f0: 2020 2070 5f63 616e 645f 636e 7420 3d20     p_cand_cnt = 
+0007d400: 6c65 6e28 6c69 6e65 7329 2f32 0a20 2020  len(lines)/2.   
+0007d410: 2020 2020 2020 2020 200a 2020 2020 6966           .    if
+0007d420: 2066 6e61 6d65 5f6f 7574 2069 7320 4e6f   fname_out is No
+0007d430: 6e65 3a20 666e 616d 655f 6f75 7420 3d20  ne: fname_out = 
+0007d440: 666e 616d 6520 2b20 275f 7072 6f74 656f  fname + '_proteo
+0007d450: 6d65 2e66 6127 0a20 2020 2066 203d 206f  me.fa'.    f = o
+0007d460: 7065 6e28 666e 616d 655f 6f75 742c 2777  pen(fname_out,'w
+0007d470: 2b27 290a 2020 2020 662e 7772 6974 656c  +').    f.writel
+0007d480: 696e 6573 286c 696e 6573 290a 2020 2020  ines(lines).    
+0007d490: 662e 636c 6f73 6528 290a 2020 2020 2020  f.close().      
+0007d4a0: 2020 2020 2020 2020 2020 0a20 2020 2069            .    i
+0007d4b0: 6620 7665 7262 6f73 653a 200a 2020 2020  f verbose: .    
+0007d4c0: 2020 2020 7072 696e 7428 2741 4153 6571      print('AASeq
+0007d4d0: 2073 6176 6564 2074 6f20 2573 2720 2520   saved to %s' % 
+0007d4e0: 2866 6e61 6d65 5f6f 7574 2929 0a20 2020  (fname_out)).   
+0007d4f0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
+0007d500: 2066 6e61 6d65 5f6f 7574 0a27 2727 0a0a   fname_out.'''..
 0007d510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d520: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d530: 2323 2323 2323 230a 0a64 6566 2074 7269  #######..def tri
-0007d540: 6d5f 6865 6164 6572 2866 6e61 6d65 5f66  m_header(fname_f
-0007d550: 6129 3a0a 2020 2020 0a20 2020 2066 203d  a):.    .    f =
-0007d560: 206f 7065 6e28 666e 616d 655f 6661 2c20   open(fname_fa, 
-0007d570: 2772 2729 0a20 2020 206c 696e 6573 203d  'r').    lines =
-0007d580: 205b 5d0a 2020 2020 636e 7420 3d20 300a   [].    cnt = 0.
-0007d590: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
-0007d5a0: 663a 0a20 2020 2020 2020 2069 6620 6c69  f:.        if li
-0007d5b0: 6e65 5b30 5d20 3d3d 2027 3e27 3a0a 2020  ne[0] == '>':.  
-0007d5c0: 2020 2020 2020 2020 2020 6864 7220 3d20            hdr = 
-0007d5d0: 6c69 6e65 2e73 706c 6974 2827 2027 290a  line.split(' ').
-0007d5e0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0007d5f0: 732e 6170 7065 6e64 2868 6472 5b30 5d2b  s.append(hdr[0]+
-0007d600: 275c 6e27 290a 2020 2020 2020 2020 656c  '\n').        el
-0007d610: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0007d620: 6c69 6e65 732e 6170 7065 6e64 286c 696e  lines.append(lin
-0007d630: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
-0007d640: 0a20 2020 200a 2020 2020 6620 3d20 6f70  .    .    f = op
-0007d650: 656e 2866 6e61 6d65 5f66 612c 2027 772b  en(fname_fa, 'w+
-0007d660: 2729 0a20 2020 2066 2e77 7269 7465 6c69  ').    f.writeli
-0007d670: 6e65 7328 6c69 6e65 7329 0a20 2020 2066  nes(lines).    f
-0007d680: 2e63 6c6f 7365 2829 0a20 2020 200a 2020  .close().    .  
-0007d690: 2020 0a64 6566 2074 7269 6d5f 6865 6164    .def trim_head
-0007d6a0: 6572 5f61 6e64 5f61 6464 5f73 7472 616e  er_and_add_stran
-0007d6b0: 645f 696e 666f 2866 6e61 6d65 5f66 612c  d_info(fname_fa,
-0007d6c0: 2067 6666 5f66 696c 6529 3a0a 2020 2020   gff_file):.    
-0007d6d0: 0a20 2020 2067 7466 5f6c 696e 6573 2c20  .    gtf_lines, 
-0007d6e0: 6864 725f 6c69 6e65 7320 3d20 6c6f 6164  hdr_lines = load
-0007d6f0: 5f67 7466 2867 6666 5f66 696c 652c 2076  _gtf(gff_file, v
-0007d700: 6572 626f 7365 203d 2054 7275 6529 0a20  erbose = True). 
-0007d710: 2020 2067 7466 5f6c 696e 6573 5f6c 7374     gtf_lines_lst
-0007d720: 203d 2070 6172 7365 5f67 7466 5f6c 696e   = parse_gtf_lin
-0007d730: 6573 5f61 6e64 5f73 706c 6974 5f69 6e74  es_and_split_int
-0007d740: 6f5f 6765 6e65 7328 2067 7466 5f6c 696e  o_genes( gtf_lin
-0007d750: 6573 2c20 675f 6f72 5f74 203d 2027 7472  es, g_or_t = 'tr
-0007d760: 616e 7363 7269 7074 272c 2076 6572 626f  anscript', verbo
-0007d770: 7365 203d 2046 616c 7365 2029 2020 2020  se = False )    
-0007d780: 0a20 2020 2074 645f 6c73 7420 3d20 5b5d  .    td_lst = []
-0007d790: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
-0007d7a0: 6e20 6774 665f 6c69 6e65 735f 6c73 743a  n gtf_lines_lst:
-0007d7b0: 0a20 2020 2020 2020 2074 6420 3d20 7472  .        td = tr
-0007d7c0: 616e 7363 7269 7074 5f64 6573 6372 6970  anscript_descrip
-0007d7d0: 746f 7228 6c69 6e65 7329 0a20 2020 2020  tor(lines).     
-0007d7e0: 2020 2074 645f 6c73 742e 6170 7065 6e64     td_lst.append
-0007d7f0: 2874 6429 0a20 2020 2020 2020 2020 2020  (td).           
-0007d800: 200a 2020 2020 6620 3d20 6f70 656e 2866   .    f = open(f
-0007d810: 6e61 6d65 5f66 612c 2027 7227 290a 2020  name_fa, 'r').  
-0007d820: 2020 6c69 6e65 7320 3d20 5b5d 0a20 2020    lines = [].   
-0007d830: 2063 6e74 203d 2030 0a20 2020 2066 6f72   cnt = 0.    for
-0007d840: 206c 696e 6520 696e 2066 3a0a 2020 2020   line in f:.    
-0007d850: 2020 2020 6966 206c 696e 655b 305d 203d      if line[0] =
-0007d860: 3d20 273e 273a 0a20 2020 2020 2020 2020  = '>':.         
-0007d870: 2020 2068 6472 203d 206c 696e 652e 7370     hdr = line.sp
-0007d880: 6c69 7428 2720 2729 0a20 2020 2020 2020  lit(' ').       
-0007d890: 2020 2020 206c 696e 6573 2e61 7070 656e       lines.appen
-0007d8a0: 6428 6864 725b 305d 2b27 2073 7472 616e  d(hdr[0]+' stran
-0007d8b0: 643a 2569 5c6e 2720 2520 7464 5f6c 7374  d:%i\n' % td_lst
-0007d8c0: 5b63 6e74 5d2e 7374 7261 6e64 2029 0a20  [cnt].strand ). 
-0007d8d0: 2020 2020 2020 2020 2020 2063 6e74 202b             cnt +
-0007d8e0: 3d20 310a 2020 2020 2020 2020 656c 7365  = 1.        else
-0007d8f0: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-0007d900: 6e65 732e 6170 7065 6e64 286c 696e 6529  nes.append(line)
-0007d910: 0a20 2020 2066 2e63 6c6f 7365 2829 0a20  .    f.close(). 
-0007d920: 2020 200a 2020 2020 6620 3d20 6f70 656e     .    f = open
-0007d930: 2866 6e61 6d65 5f66 612c 2027 772b 2729  (fname_fa, 'w+')
-0007d940: 0a20 2020 2066 2e77 7269 7465 6c69 6e65  .    f.writeline
-0007d950: 7328 6c69 6e65 7329 0a20 2020 2066 2e63  s(lines).    f.c
-0007d960: 6c6f 7365 2829 0a0a 2020 2020 6966 2063  lose()..    if c
-0007d970: 6e74 203d 3d20 6c65 6e28 7464 5f6c 7374  nt == len(td_lst
-0007d980: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
-0007d990: 2827 4641 5354 4120 6669 6c65 2067 656e  ('FASTA file gen
-0007d9a0: 6572 6174 6564 2073 7563 6365 7373 6675  erated successfu
-0007d9b0: 6c6c 7927 290a 2020 2020 656c 7365 3a0a  lly').    else:.
-0007d9c0: 2020 2020 2020 2020 7072 696e 7428 2757          print('W
-0007d9d0: 4152 4e49 4e47 3a20 2569 207e 3d20 2569  ARNING: %i ~= %i
-0007d9e0: 2720 2520 2863 6e74 2c20 6c65 6e28 7464  ' % (cnt, len(td
-0007d9f0: 5f6c 7374 2929 2029 0a20 2020 2020 2020  _lst)) ).       
-0007da00: 200a 2020 2020 2020 2020 0a64 6566 2053   .        .def S
-0007da10: 7472 696e 6746 6978 5f47 4646 5265 6164  tringFix_GFFRead
-0007da20: 2867 7466 5f66 696c 652c 2067 656e 6f6d  (gtf_file, genom
-0007da30: 655f 6669 6c65 2c20 6e5f 636f 7265 7320  e_file, n_cores 
-0007da40: 3d20 3129 3a0a 2020 2020 0a20 2020 2066  = 1):.    .    f
-0007da50: 696c 655f 6e61 6d65 7320 3d20 6774 665f  ile_names = gtf_
-0007da60: 6669 6c65 2e73 706c 6974 2827 2e27 290a  file.split('.').
-0007da70: 2020 2020 666e 616d 6520 3d20 2727 2e6a      fname = ''.j
-0007da80: 6f69 6e28 7374 2066 6f72 2073 7420 696e  oin(st for st in
-0007da90: 2066 696c 655f 6e61 6d65 735b 3a2d 315d   file_names[:-1]
-0007daa0: 2029 0a20 2020 200a 2020 2020 6774 665f   ).    .    gtf_
-0007dab0: 6c69 6e65 732c 2068 6472 5f6c 696e 6573  lines, hdr_lines
-0007dac0: 203d 206c 6f61 645f 6774 6628 6774 665f   = load_gtf(gtf_
-0007dad0: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
-0007dae0: 5472 7565 290a 2020 2020 6764 5f6c 7374  True).    gd_lst
-0007daf0: 2c20 6368 7273 203d 2067 6574 5f67 656e  , chrs = get_gen
-0007db00: 655f 6465 7363 7269 7074 6f72 2867 7466  e_descriptor(gtf
-0007db10: 5f6c 696e 6573 2c20 6765 6e6f 6d65 203d  _lines, genome =
-0007db20: 204e 6f6e 652c 2066 696c 6c20 3d20 4661   None, fill = Fa
-0007db30: 6c73 652c 2076 6572 626f 7365 203d 2054  lse, verbose = T
-0007db40: 7275 652c 206e 5f63 6f72 6573 203d 2031  rue, n_cores = 1
-0007db50: 290a 2020 2020 6764 5f6c 7374 732c 2063  ).    gd_lsts, c
-0007db60: 6872 5f6c 7374 203d 2070 6163 6b5f 6765  hr_lst = pack_ge
-0007db70: 6e65 5f64 6573 6372 6970 746f 7228 2067  ne_descriptor( g
-0007db80: 645f 6c73 742c 2063 6872 7320 290a 0a20  d_lst, chrs ).. 
-0007db90: 2020 2069 6620 6765 6e6f 6d65 5f66 696c     if genome_fil
-0007dba0: 6520 6973 204e 6f6e 653a 2067 656e 6f6d  e is None: genom
-0007dbb0: 6520 3d20 4e6f 6e65 0a20 2020 2065 6c73  e = None.    els
-0007dbc0: 653a 2067 656e 6f6d 6520 3d20 6c6f 6164  e: genome = load
-0007dbd0: 5f67 656e 6f6d 6528 6765 6e6f 6d65 5f66  _genome(genome_f
-0007dbe0: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
-0007dbf0: 7275 6529 0a0a 2020 2020 6661 7374 615f  rue)..    fasta_
-0007dc00: 6c69 6e65 7332 203d 205b 5d0a 2020 2020  lines2 = [].    
-0007dc10: 6661 7374 615f 6c69 6e65 7320 3d20 5b5d  fasta_lines = []
-0007dc20: 0a20 2020 2067 6473 203d 205b 5d0a 2020  .    gds = [].  
-0007dc30: 2020 666f 7220 6764 6c20 696e 2067 645f    for gdl in gd_
-0007dc40: 6c73 7473 3a20 6764 7320 3d20 6764 7320  lsts: gds = gds 
-0007dc50: 2b20 6764 6c0a 2020 2020 2020 2020 0a20  + gdl.        . 
-0007dc60: 2020 2073 7461 7274 5f74 696d 6520 3d20     start_time = 
-0007dc70: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
-0007dc80: 7072 696e 7428 2747 656e 6572 6174 696e  print('Generatin
-0007dc90: 6720 7472 616e 7363 7269 7074 6f6d 6520  g transcriptome 
-0007dca0: 2e2e 2027 2c20 656e 643d 2720 2020 2027  .. ', end='    '
-0007dcb0: 290a 2020 2020 636e 745f 7472 203d 2030  ).    cnt_tr = 0
-0007dcc0: 0a20 2020 2063 6e74 5f70 7220 3d20 300a  .    cnt_pr = 0.
-0007dcd0: 2020 2020 666f 7220 6d2c 2067 6420 696e      for m, gd in
-0007dce0: 2065 6e75 6d65 7261 7465 2867 6473 293a   enumerate(gds):
-0007dcf0: 0a20 2020 2020 2020 2063 6e74 5f74 2c20  .        cnt_t, 
-0007dd00: 636e 745f 702c 2063 6e74 5f65 203d 2067  cnt_p, cnt_e = g
-0007dd10: 642e 7570 6461 7465 5f74 645f 696e 666f  d.update_td_info
-0007dd20: 2867 656e 6f6d 652c 2073 656c 203d 2032  (genome, sel = 2
-0007dd30: 2c20 7065 7074 6964 6520 3d20 5472 7565  , peptide = True
-0007dd40: 290a 2020 2020 2020 2020 636e 745f 7472  ).        cnt_tr
-0007dd50: 202b 3d20 636e 745f 740a 2020 2020 2020   += cnt_t.      
-0007dd60: 2020 636e 745f 7072 202b 3d20 636e 745f    cnt_pr += cnt_
-0007dd70: 700a 2020 2020 2020 2020 2320 6764 2e6f  p.        # gd.o
-0007dd80: 7264 6572 2829 0a20 2020 2020 2020 206c  rder().        l
-0007dd90: 312c 206c 3220 3d20 6764 2e67 6574 5f66  1, l2 = gd.get_f
-0007dda0: 6173 7461 5f6c 696e 6573 5f66 726f 6d5f  asta_lines_from_
-0007ddb0: 6578 6f6e 7328 6765 6e6f 6d65 2c20 7365  exons(genome, se
-0007ddc0: 6c20 3d20 322c 2070 6570 7469 6465 203d  l = 2, peptide =
-0007ddd0: 2054 7275 6529 0a20 2020 2020 2020 2066   True).        f
-0007dde0: 6173 7461 5f6c 696e 6573 203d 2066 6173  asta_lines = fas
-0007ddf0: 7461 5f6c 696e 6573 202b 206c 310a 2020  ta_lines + l1.  
-0007de00: 2020 2020 2020 6661 7374 615f 6c69 6e65        fasta_line
-0007de10: 7332 203d 2066 6173 7461 5f6c 696e 6573  s2 = fasta_lines
-0007de20: 3220 2b20 6c32 0a20 2020 2020 2020 2069  2 + l2.        i
-0007de30: 6620 6d25 3130 3020 3d3d 2030 3a20 7072  f m%100 == 0: pr
-0007de40: 696e 7428 275c 7247 656e 6572 6174 696e  int('\rGeneratin
-0007de50: 6720 7472 616e 7363 7269 7074 6f6d 6520  g transcriptome 
-0007de60: 2e2e 2025 692f 2569 2028 2569 2c25 6929  .. %i/%i (%i,%i)
-0007de70: 2720 2520 286d 2c20 6c65 6e28 6764 7329  ' % (m, len(gds)
-0007de80: 2c20 636e 745f 7472 2c20 636e 745f 7072  , cnt_tr, cnt_pr
-0007de90: 292c 2065 6e64 3d27 2020 2020 2729 0a20  ), end='    '). 
-0007dea0: 2020 2065 6c61 7073 6564 5f74 696d 6520     elapsed_time 
-0007deb0: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
-0007dec0: 7374 6172 745f 7469 6d65 0a20 2020 2070  start_time.    p
-0007ded0: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
-0007dee0: 6e67 2074 7261 6e73 6372 6970 746f 6d65  ng transcriptome
-0007def0: 202e 2e20 2569 2064 6f6e 6520 696e 2025   .. %i done in %
-0007df00: 6928 7329 2028 2569 2c25 6929 2720 2520  i(s) (%i,%i)' % 
-0007df10: 286c 656e 2867 6473 292c 2065 6c61 7073  (len(gds), elaps
-0007df20: 6564 5f74 696d 652c 2063 6e74 5f74 722c  ed_time, cnt_tr,
-0007df30: 2063 6e74 5f70 7229 290a 0a20 2020 2070   cnt_pr))..    p
-0007df40: 7269 6e74 2827 5361 7669 6e67 202e 2e20  rint('Saving .. 
-0007df50: 2569 2074 7273 2c20 2569 2070 7273 2720  %i trs, %i prs' 
-0007df60: 2520 286c 656e 2866 6173 7461 5f6c 696e  % (len(fasta_lin
-0007df70: 6573 292f 322c 206c 656e 2866 6173 7461  es)/2, len(fasta
-0007df80: 5f6c 696e 6573 3229 2f32 2920 2c20 656e  _lines2)/2) , en
-0007df90: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
-0007dfa0: 5472 7565 290a 2020 2020 666e 616d 655f  True).    fname_
-0007dfb0: 7472 203d 2066 6e61 6d65 202b 2027 5f74  tr = fname + '_t
-0007dfc0: 7261 6e73 6372 6970 746f 6d65 2e66 6127  ranscriptome.fa'
-0007dfd0: 0a20 2020 2066 203d 206f 7065 6e28 666e  .    f = open(fn
-0007dfe0: 616d 655f 7472 2c20 2777 2b27 290a 2020  ame_tr, 'w+').  
-0007dff0: 2020 662e 7772 6974 656c 696e 6573 2866    f.writelines(f
-0007e000: 6173 7461 5f6c 696e 6573 290a 2020 2020  asta_lines).    
-0007e010: 662e 636c 6f73 6528 290a 0a20 2020 2066  f.close()..    f
-0007e020: 6e61 6d65 5f70 7220 3d20 666e 616d 6520  name_pr = fname 
-0007e030: 2b20 275f 7072 6f74 656f 6d65 2e66 6127  + '_proteome.fa'
-0007e040: 0a20 2020 2066 203d 206f 7065 6e28 666e  .    f = open(fn
-0007e050: 616d 655f 7072 2c20 2777 2b27 290a 2020  ame_pr, 'w+').  
-0007e060: 2020 662e 7772 6974 656c 696e 6573 2866    f.writelines(f
-0007e070: 6173 7461 5f6c 696e 6573 3229 0a20 2020  asta_lines2).   
-0007e080: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
-0007e090: 7072 696e 7428 2720 646f 6e65 2e27 290a  print(' done.').
-0007e0a0: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
-0007e0b0: 2720 2520 2866 6e61 6d65 5f74 7229 2029  ' % (fname_tr) )
-0007e0c0: 0a20 2020 2070 7269 6e74 2827 2020 2025  .    print('   %
-0007e0d0: 7327 2025 2028 666e 616d 655f 7072 2920  s' % (fname_pr) 
-0007e0e0: 290a 0a20 2020 2072 6574 7572 6e28 666e  )..    return(fn
-0007e0f0: 616d 6529 0a0a 0a23 2323 2323 2323 2323  ame)...#########
-0007e100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e140: 230a 2323 2053 7472 696e 6746 6978 2d73  #.## StringFix-s
-0007e150: 796e 7468 6573 6973 0a23 2323 2323 2323  ynthesis.#######
-0007e160: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d530: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d550: 2323 2323 2323 2323 2323 0a23 2320 5374  ##########.## St
+0007d560: 7269 6e67 4669 7820 6164 646f 6e27 730a  ringFix addon's.
+0007d570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d5a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d5b0: 2323 2323 2323 2323 2323 0a0a 6465 6620  ##########..def 
+0007d5c0: 7472 696d 5f68 6561 6465 7228 666e 616d  trim_header(fnam
+0007d5d0: 655f 6661 293a 0a20 2020 200a 2020 2020  e_fa):.    .    
+0007d5e0: 6620 3d20 6f70 656e 2866 6e61 6d65 5f66  f = open(fname_f
+0007d5f0: 612c 2027 7227 290a 2020 2020 6c69 6e65  a, 'r').    line
+0007d600: 7320 3d20 5b5d 0a20 2020 2063 6e74 203d  s = [].    cnt =
+0007d610: 2030 0a20 2020 2066 6f72 206c 696e 6520   0.    for line 
+0007d620: 696e 2066 3a0a 2020 2020 2020 2020 6966  in f:.        if
+0007d630: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
+0007d640: 0a20 2020 2020 2020 2020 2020 2068 6472  .            hdr
+0007d650: 203d 206c 696e 652e 7370 6c69 7428 2720   = line.split(' 
+0007d660: 2729 0a20 2020 2020 2020 2020 2020 206c  ').            l
+0007d670: 696e 6573 2e61 7070 656e 6428 6864 725b  ines.append(hdr[
+0007d680: 305d 2b27 5c6e 2729 0a20 2020 2020 2020  0]+'\n').       
+0007d690: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0007d6a0: 2020 206c 696e 6573 2e61 7070 656e 6428     lines.append(
+0007d6b0: 6c69 6e65 290a 2020 2020 662e 636c 6f73  line).    f.clos
+0007d6c0: 6528 290a 2020 2020 0a20 2020 2066 203d  e().    .    f =
+0007d6d0: 206f 7065 6e28 666e 616d 655f 6661 2c20   open(fname_fa, 
+0007d6e0: 2777 2b27 290a 2020 2020 662e 7772 6974  'w+').    f.writ
+0007d6f0: 656c 696e 6573 286c 696e 6573 290a 2020  elines(lines).  
+0007d700: 2020 662e 636c 6f73 6528 290a 2020 2020    f.close().    
+0007d710: 0a20 2020 200a 6465 6620 7472 696d 5f68  .    .def trim_h
+0007d720: 6561 6465 725f 616e 645f 6164 645f 7374  eader_and_add_st
+0007d730: 7261 6e64 5f69 6e66 6f28 666e 616d 655f  rand_info(fname_
+0007d740: 6661 2c20 6766 665f 6669 6c65 293a 0a20  fa, gff_file):. 
+0007d750: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
+0007d760: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
+0007d770: 6f61 645f 6774 6628 6766 665f 6669 6c65  oad_gtf(gff_file
+0007d780: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
+0007d790: 290a 2020 2020 6774 665f 6c69 6e65 735f  ).    gtf_lines_
+0007d7a0: 6c73 7420 3d20 7061 7273 655f 6774 665f  lst = parse_gtf_
+0007d7b0: 6c69 6e65 735f 616e 645f 7370 6c69 745f  lines_and_split_
+0007d7c0: 696e 746f 5f67 656e 6573 2820 6774 665f  into_genes( gtf_
+0007d7d0: 6c69 6e65 732c 2067 5f6f 725f 7420 3d20  lines, g_or_t = 
+0007d7e0: 2774 7261 6e73 6372 6970 7427 2c20 7665  'transcript', ve
+0007d7f0: 7262 6f73 6520 3d20 4661 6c73 6520 2920  rbose = False ) 
+0007d800: 2020 200a 2020 2020 7464 5f6c 7374 203d     .    td_lst =
+0007d810: 205b 5d0a 2020 2020 666f 7220 6c69 6e65   [].    for line
+0007d820: 7320 696e 2067 7466 5f6c 696e 6573 5f6c  s in gtf_lines_l
+0007d830: 7374 3a0a 2020 2020 2020 2020 7464 203d  st:.        td =
+0007d840: 2074 7261 6e73 6372 6970 745f 6465 7363   transcript_desc
+0007d850: 7269 7074 6f72 286c 696e 6573 290a 2020  riptor(lines).  
+0007d860: 2020 2020 2020 7464 5f6c 7374 2e61 7070        td_lst.app
+0007d870: 656e 6428 7464 290a 2020 2020 2020 2020  end(td).        
+0007d880: 2020 2020 0a20 2020 2066 203d 206f 7065      .    f = ope
+0007d890: 6e28 666e 616d 655f 6661 2c20 2772 2729  n(fname_fa, 'r')
+0007d8a0: 0a20 2020 206c 696e 6573 203d 205b 5d0a  .    lines = [].
+0007d8b0: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
+0007d8c0: 666f 7220 6c69 6e65 2069 6e20 663a 0a20  for line in f:. 
+0007d8d0: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
+0007d8e0: 5d20 3d3d 2027 3e27 3a0a 2020 2020 2020  ] == '>':.      
+0007d8f0: 2020 2020 2020 6864 7220 3d20 6c69 6e65        hdr = line
+0007d900: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
+0007d910: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
+0007d920: 7065 6e64 2868 6472 5b30 5d2b 2720 7374  pend(hdr[0]+' st
+0007d930: 7261 6e64 3a25 695c 6e27 2025 2074 645f  rand:%i\n' % td_
+0007d940: 6c73 745b 636e 745d 2e73 7472 616e 6420  lst[cnt].strand 
+0007d950: 290a 2020 2020 2020 2020 2020 2020 636e  ).            cn
+0007d960: 7420 2b3d 2031 0a20 2020 2020 2020 2065  t += 1.        e
+0007d970: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0007d980: 206c 696e 6573 2e61 7070 656e 6428 6c69   lines.append(li
+0007d990: 6e65 290a 2020 2020 662e 636c 6f73 6528  ne).    f.close(
+0007d9a0: 290a 2020 2020 0a20 2020 2066 203d 206f  ).    .    f = o
+0007d9b0: 7065 6e28 666e 616d 655f 6661 2c20 2777  pen(fname_fa, 'w
+0007d9c0: 2b27 290a 2020 2020 662e 7772 6974 656c  +').    f.writel
+0007d9d0: 696e 6573 286c 696e 6573 290a 2020 2020  ines(lines).    
+0007d9e0: 662e 636c 6f73 6528 290a 0a20 2020 2069  f.close()..    i
+0007d9f0: 6620 636e 7420 3d3d 206c 656e 2874 645f  f cnt == len(td_
+0007da00: 6c73 7429 3a0a 2020 2020 2020 2020 7072  lst):.        pr
+0007da10: 696e 7428 2746 4153 5441 2066 696c 6520  int('FASTA file 
+0007da20: 6765 6e65 7261 7465 6420 7375 6363 6573  generated succes
+0007da30: 7366 756c 6c79 2729 0a20 2020 2065 6c73  sfully').    els
+0007da40: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+0007da50: 2827 5741 524e 494e 473a 2025 6920 7e3d  ('WARNING: %i ~=
+0007da60: 2025 6927 2025 2028 636e 742c 206c 656e   %i' % (cnt, len
+0007da70: 2874 645f 6c73 7429 2920 290a 2020 2020  (td_lst)) ).    
+0007da80: 2020 2020 0a20 2020 2020 2020 200a 6465      .        .de
+0007da90: 6620 5374 7269 6e67 4669 785f 4746 4652  f StringFix_GFFR
+0007daa0: 6561 6428 6774 665f 6669 6c65 2c20 6765  ead(gtf_file, ge
+0007dab0: 6e6f 6d65 5f66 696c 652c 206e 5f63 6f72  nome_file, n_cor
+0007dac0: 6573 203d 2031 293a 0a20 2020 200a 2020  es = 1):.    .  
+0007dad0: 2020 6669 6c65 5f6e 616d 6573 203d 2067    file_names = g
+0007dae0: 7466 5f66 696c 652e 7370 6c69 7428 272e  tf_file.split('.
+0007daf0: 2729 0a20 2020 2066 6e61 6d65 203d 2027  ').    fname = '
+0007db00: 272e 6a6f 696e 2873 7420 666f 7220 7374  '.join(st for st
+0007db10: 2069 6e20 6669 6c65 5f6e 616d 6573 5b3a   in file_names[:
+0007db20: 2d31 5d20 290a 2020 2020 0a20 2020 2067  -1] ).    .    g
+0007db30: 7466 5f6c 696e 6573 2c20 6864 725f 6c69  tf_lines, hdr_li
+0007db40: 6e65 7320 3d20 6c6f 6164 5f67 7466 2867  nes = load_gtf(g
+0007db50: 7466 5f66 696c 652c 2076 6572 626f 7365  tf_file, verbose
+0007db60: 203d 2054 7275 6529 0a20 2020 2067 645f   = True).    gd_
+0007db70: 6c73 742c 2063 6872 7320 3d20 6765 745f  lst, chrs = get_
+0007db80: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
+0007db90: 6774 665f 6c69 6e65 732c 2067 656e 6f6d  gtf_lines, genom
+0007dba0: 6520 3d20 4e6f 6e65 2c20 6669 6c6c 203d  e = None, fill =
+0007dbb0: 2046 616c 7365 2c20 7665 7262 6f73 6520   False, verbose 
+0007dbc0: 3d20 5472 7565 2c20 6e5f 636f 7265 7320  = True, n_cores 
+0007dbd0: 3d20 3129 0a20 2020 2067 645f 6c73 7473  = 1).    gd_lsts
+0007dbe0: 2c20 6368 725f 6c73 7420 3d20 7061 636b  , chr_lst = pack
+0007dbf0: 5f67 656e 655f 6465 7363 7269 7074 6f72  _gene_descriptor
+0007dc00: 2820 6764 5f6c 7374 2c20 6368 7273 2029  ( gd_lst, chrs )
+0007dc10: 0a0a 2020 2020 6966 2067 656e 6f6d 655f  ..    if genome_
+0007dc20: 6669 6c65 2069 7320 4e6f 6e65 3a20 6765  file is None: ge
+0007dc30: 6e6f 6d65 203d 204e 6f6e 650a 2020 2020  nome = None.    
+0007dc40: 656c 7365 3a20 6765 6e6f 6d65 203d 206c  else: genome = l
+0007dc50: 6f61 645f 6765 6e6f 6d65 2867 656e 6f6d  oad_genome(genom
+0007dc60: 655f 6669 6c65 2c20 7665 7262 6f73 6520  e_file, verbose 
+0007dc70: 3d20 5472 7565 290a 0a20 2020 2066 6173  = True)..    fas
+0007dc80: 7461 5f6c 696e 6573 3220 3d20 5b5d 0a20  ta_lines2 = []. 
+0007dc90: 2020 2066 6173 7461 5f6c 696e 6573 203d     fasta_lines =
+0007dca0: 205b 5d0a 2020 2020 6764 7320 3d20 5b5d   [].    gds = []
+0007dcb0: 0a20 2020 2066 6f72 2067 646c 2069 6e20  .    for gdl in 
+0007dcc0: 6764 5f6c 7374 733a 2067 6473 203d 2067  gd_lsts: gds = g
+0007dcd0: 6473 202b 2067 646c 0a20 2020 2020 2020  ds + gdl.       
+0007dce0: 200a 2020 2020 7374 6172 745f 7469 6d65   .    start_time
+0007dcf0: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
+0007dd00: 2020 2070 7269 6e74 2827 4765 6e65 7261     print('Genera
+0007dd10: 7469 6e67 2074 7261 6e73 6372 6970 746f  ting transcripto
+0007dd20: 6d65 202e 2e20 272c 2065 6e64 3d27 2020  me .. ', end='  
+0007dd30: 2020 2729 0a20 2020 2063 6e74 5f74 7220    ').    cnt_tr 
+0007dd40: 3d20 300a 2020 2020 636e 745f 7072 203d  = 0.    cnt_pr =
+0007dd50: 2030 0a20 2020 2066 6f72 206d 2c20 6764   0.    for m, gd
+0007dd60: 2069 6e20 656e 756d 6572 6174 6528 6764   in enumerate(gd
+0007dd70: 7329 3a0a 2020 2020 2020 2020 636e 745f  s):.        cnt_
+0007dd80: 742c 2063 6e74 5f70 2c20 636e 745f 6520  t, cnt_p, cnt_e 
+0007dd90: 3d20 6764 2e75 7064 6174 655f 7464 5f69  = gd.update_td_i
+0007dda0: 6e66 6f28 6765 6e6f 6d65 2c20 7365 6c20  nfo(genome, sel 
+0007ddb0: 3d20 322c 2070 6570 7469 6465 203d 2054  = 2, peptide = T
+0007ddc0: 7275 6529 0a20 2020 2020 2020 2063 6e74  rue).        cnt
+0007ddd0: 5f74 7220 2b3d 2063 6e74 5f74 0a20 2020  _tr += cnt_t.   
+0007dde0: 2020 2020 2063 6e74 5f70 7220 2b3d 2063       cnt_pr += c
+0007ddf0: 6e74 5f70 0a20 2020 2020 2020 2023 2067  nt_p.        # g
+0007de00: 642e 6f72 6465 7228 290a 2020 2020 2020  d.order().      
+0007de10: 2020 6c31 2c20 6c32 203d 2067 642e 6765    l1, l2 = gd.ge
+0007de20: 745f 6661 7374 615f 6c69 6e65 735f 6672  t_fasta_lines_fr
+0007de30: 6f6d 5f65 786f 6e73 2867 656e 6f6d 652c  om_exons(genome,
+0007de40: 2073 656c 203d 2032 2c20 7065 7074 6964   sel = 2, peptid
+0007de50: 6520 3d20 5472 7565 290a 2020 2020 2020  e = True).      
+0007de60: 2020 6661 7374 615f 6c69 6e65 7320 3d20    fasta_lines = 
+0007de70: 6661 7374 615f 6c69 6e65 7320 2b20 6c31  fasta_lines + l1
+0007de80: 0a20 2020 2020 2020 2066 6173 7461 5f6c  .        fasta_l
+0007de90: 696e 6573 3220 3d20 6661 7374 615f 6c69  ines2 = fasta_li
+0007dea0: 6e65 7332 202b 206c 320a 2020 2020 2020  nes2 + l2.      
+0007deb0: 2020 6966 206d 2531 3030 203d 3d20 303a    if m%100 == 0:
+0007dec0: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
+0007ded0: 7469 6e67 2074 7261 6e73 6372 6970 746f  ting transcripto
+0007dee0: 6d65 202e 2e20 2569 2f25 6920 2825 692c  me .. %i/%i (%i,
+0007def0: 2569 2927 2025 2028 6d2c 206c 656e 2867  %i)' % (m, len(g
+0007df00: 6473 292c 2063 6e74 5f74 722c 2063 6e74  ds), cnt_tr, cnt
+0007df10: 5f70 7229 2c20 656e 643d 2720 2020 2027  _pr), end='    '
+0007df20: 290a 2020 2020 656c 6170 7365 645f 7469  ).    elapsed_ti
+0007df30: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+0007df40: 202d 2073 7461 7274 5f74 696d 650a 2020   - start_time.  
+0007df50: 2020 7072 696e 7428 275c 7247 656e 6572    print('\rGener
+0007df60: 6174 696e 6720 7472 616e 7363 7269 7074  ating transcript
+0007df70: 6f6d 6520 2e2e 2025 6920 646f 6e65 2069  ome .. %i done i
+0007df80: 6e20 2569 2873 2920 2825 692c 2569 2927  n %i(s) (%i,%i)'
+0007df90: 2025 2028 6c65 6e28 6764 7329 2c20 656c   % (len(gds), el
+0007dfa0: 6170 7365 645f 7469 6d65 2c20 636e 745f  apsed_time, cnt_
+0007dfb0: 7472 2c20 636e 745f 7072 2929 0a0a 2020  tr, cnt_pr))..  
+0007dfc0: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
+0007dfd0: 2e2e 2025 6920 7472 732c 2025 6920 7072  .. %i trs, %i pr
+0007dfe0: 7327 2025 2028 6c65 6e28 6661 7374 615f  s' % (len(fasta_
+0007dff0: 6c69 6e65 7329 2f32 2c20 6c65 6e28 6661  lines)/2, len(fa
+0007e000: 7374 615f 6c69 6e65 7332 292f 3229 202c  sta_lines2)/2) ,
+0007e010: 2065 6e64 203d 2027 272c 2066 6c75 7368   end = '', flush
+0007e020: 203d 2054 7275 6529 0a20 2020 2066 6e61   = True).    fna
+0007e030: 6d65 5f74 7220 3d20 666e 616d 6520 2b20  me_tr = fname + 
+0007e040: 275f 7472 616e 7363 7269 7074 6f6d 652e  '_transcriptome.
+0007e050: 6661 270a 2020 2020 6620 3d20 6f70 656e  fa'.    f = open
+0007e060: 2866 6e61 6d65 5f74 722c 2027 772b 2729  (fname_tr, 'w+')
+0007e070: 0a20 2020 2066 2e77 7269 7465 6c69 6e65  .    f.writeline
+0007e080: 7328 6661 7374 615f 6c69 6e65 7329 0a20  s(fasta_lines). 
+0007e090: 2020 2066 2e63 6c6f 7365 2829 0a0a 2020     f.close()..  
+0007e0a0: 2020 666e 616d 655f 7072 203d 2066 6e61    fname_pr = fna
+0007e0b0: 6d65 202b 2027 5f70 726f 7465 6f6d 652e  me + '_proteome.
+0007e0c0: 6661 270a 2020 2020 6620 3d20 6f70 656e  fa'.    f = open
+0007e0d0: 2866 6e61 6d65 5f70 722c 2027 772b 2729  (fname_pr, 'w+')
+0007e0e0: 0a20 2020 2066 2e77 7269 7465 6c69 6e65  .    f.writeline
+0007e0f0: 7328 6661 7374 615f 6c69 6e65 7332 290a  s(fasta_lines2).
+0007e100: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
+0007e110: 2020 2070 7269 6e74 2827 2064 6f6e 652e     print(' done.
+0007e120: 2729 0a20 2020 2070 7269 6e74 2827 2020  ').    print('  
+0007e130: 2025 7327 2025 2028 666e 616d 655f 7472   %s' % (fname_tr
+0007e140: 2920 290a 2020 2020 7072 696e 7428 2720  ) ).    print(' 
+0007e150: 2020 2573 2720 2520 2866 6e61 6d65 5f70    %s' % (fname_p
+0007e160: 7229 2029 0a0a 2020 2020 7265 7475 726e  r) )..    return
+0007e170: 2866 6e61 6d65 290a 0a0a 2323 2323 2323  (fname)...######
 0007e180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e1a0: 2323 230a 0a53 4e56 5f69 6e66 6f20 3d20  ###..SNV_info = 
-0007e1b0: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
-0007e1c0: 6474 7570 6c65 2827 534e 565f 696e 666f  dtuple('SNV_info
-0007e1d0: 272c 2027 6368 722c 2070 6f73 5f72 6566  ', 'chr, pos_ref
-0007e1e0: 2c20 706f 735f 6e65 772c 2067 656e 655f  , pos_new, gene_
-0007e1f0: 6964 2c20 6765 6e65 5f6e 616d 652c 2076  id, gene_name, v
-0007e200: 5f74 7970 652c 2076 5f6c 656e 2c20 6376  _type, v_len, cv
-0007e210: 675f 6465 7074 682c 2063 7667 5f66 7261  g_depth, cvg_fra
-0007e220: 632c 205c 0a20 2020 2020 2020 2020 2020  c, \.           
-0007e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e240: 2020 2020 2020 2020 7265 665f 7072 6576          ref_prev
-0007e250: 2c20 7265 665f 7365 712c 2072 6566 5f6e  , ref_seq, ref_n
-0007e260: 6578 742c 2061 6c74 5f70 7265 762c 2061  ext, alt_prev, a
-0007e270: 6c74 5f73 6571 2c20 616c 745f 6e65 7874  lt_seq, alt_next
-0007e280: 2729 2023 206f 6e65 2d62 6173 650a 0a4e  ') # one-base..N
-0007e290: 5749 4e20 3d20 330a 6465 6620 6669 6e64  WIN = 3.def find
-0007e2a0: 5f73 6e70 5f6f 6c64 2873 672c 2073 722c  _snp_old(sg, sr,
-0007e2b0: 2063 722c 2063 6872 6d2c 2070 6f73 5f61   cr, chrm, pos_a
-0007e2c0: 6273 2c20 6f73 2c20 6769 6e29 3a0a 2020  bs, os, gin):.  
-0007e2d0: 2020 0a20 2020 2073 6e76 5f69 6e66 6f5f    .    snv_info_
-0007e2e0: 6c73 7420 3d20 5b5d 0a20 2020 206c 656e  lst = [].    len
-0007e2f0: 5f74 6f5f 7465 7374 203d 206d 696e 286c  _to_test = min(l
-0007e300: 656e 2873 7229 2c6c 656e 2873 6729 290a  en(sr),len(sg)).
-0007e310: 0a20 2020 2073 7461 7274 203d 2030 0a20  .    start = 0. 
-0007e320: 2020 2065 6e64 203d 206d 696e 2820 3130     end = min( 10
-0007e330: 302c 206c 656e 5f74 6f5f 7465 7374 2029  0, len_to_test )
-0007e340: 0a20 2020 204e 203d 2069 6e74 286e 702e  .    N = int(np.
-0007e350: 6365 696c 2820 6c65 6e5f 746f 5f74 6573  ceil( len_to_tes
-0007e360: 742f 3130 3020 2929 0a20 2020 2023 2727  t/100 )).    #''
-0007e370: 270a 2020 2020 666f 7220 6e20 696e 2072  '.    for n in r
-0007e380: 616e 6765 284e 293a 0a20 2020 2020 2020  ange(N):.       
-0007e390: 200a 2020 2020 2020 2020 6966 2073 675b   .        if sg[
-0007e3a0: 7374 6172 743a 656e 645d 2021 3d20 7372  start:end] != sr
-0007e3b0: 5b73 7461 7274 3a65 6e64 5d3a 0a0a 2020  [start:end]:..  
-0007e3c0: 2020 2020 2020 2020 2020 7020 3d20 300a            p = 0.
-0007e3d0: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
-0007e3e0: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
-0007e3f0: 2020 2020 206c 656e 5f6c 7374 203d 205b       len_lst = [
-0007e400: 5d0a 2020 2020 2020 2020 2020 2020 6376  ].            cv
-0007e410: 675f 6c73 7420 3d20 5b5d 0a20 2020 2020  g_lst = [].     
-0007e420: 2020 2020 2020 2073 6e70 5f6c 7374 203d         snp_lst =
-0007e430: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0007e440: 736e 705f 6f72 675f 6c73 7420 3d20 5b5d  snp_org_lst = []
-0007e450: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0007e460: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-0007e470: 696e 2072 616e 6765 2873 7461 7274 2c20  in range(start, 
-0007e480: 656e 6429 3a0a 2020 2020 2020 2020 2020  end):.          
-0007e490: 2020 2020 2020 6966 2073 725b 6b5d 2021        if sr[k] !
-0007e4a0: 3d20 7367 5b6b 5d3a 0a20 2020 2020 2020  = sg[k]:.       
-0007e4b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007e4c0: 7020 3d3d 2030 3a20 706f 7320 3d20 6b0a  p == 0: pos = k.
-0007e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e4e0: 2020 2020 7020 2b3d 2031 0a20 2020 2020      p += 1.     
-0007e4f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0007e500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e510: 2020 2020 2069 6620 7020 3e20 303a 0a20       if p > 0:. 
-0007e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e530: 2020 2020 2020 2023 2063 7667 5f6c 7374         # cvg_lst
-0007e540: 2e61 7070 656e 6428 6e70 2e6d 6561 6e28  .append(np.mean(
-0007e550: 2063 725b 706f 733a 2870 6f73 2b70 295d   cr[pos:(pos+p)]
-0007e560: 2029 2029 0a20 2020 2020 2020 2020 2020   ) ).           
-0007e570: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0007e580: 6e70 5f6c 7374 2e61 7070 656e 6428 7372  np_lst.append(sr
-0007e590: 5b70 6f73 3a28 706f 732b 7029 5d29 0a20  [pos:(pos+p)]). 
-0007e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e5b0: 2020 2020 2020 2070 6f73 5f6c 7374 2e61         pos_lst.a
-0007e5c0: 7070 656e 6428 706f 7329 0a20 2020 2020  ppend(pos).     
-0007e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e5e0: 2020 206c 656e 5f6c 7374 2e61 7070 656e     len_lst.appen
-0007e5f0: 6428 7029 0a20 2020 2020 2020 2020 2020  d(p).           
-0007e600: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0007e610: 6e70 5f6f 7267 5f6c 7374 2e61 7070 656e  np_org_lst.appen
-0007e620: 6428 7367 5b70 6f73 3a28 706f 732b 7029  d(sg[pos:(pos+p)
-0007e630: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0007e640: 2020 2020 2020 2020 2020 2070 203d 2030             p = 0
-0007e650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e660: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0007e670: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-0007e680: 286c 656e 2870 6f73 5f6c 7374 2929 3a0a  (len(pos_lst)):.
-0007e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e6b0: 2070 3120 3d20 6d61 7828 302c 2870 6f73   p1 = max(0,(pos
-0007e6c0: 5f6c 7374 5b6b 5d2d 4e57 494e 2929 0a20  _lst[k]-NWIN)). 
-0007e6d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0007e6e0: 3220 3d20 6d69 6e28 6c65 6e5f 746f 5f74  2 = min(len_to_t
-0007e6f0: 6573 742c 2870 6f73 5f6c 7374 5b6b 5d2b  est,(pos_lst[k]+
-0007e700: 6c65 6e5f 6c73 745b 6b5d 2b4e 5749 4e29  len_lst[k]+NWIN)
-0007e710: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007e720: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0007e730: 2020 2073 6f70 203d 2073 675b 7031 3a70     sop = sg[p1:p
-0007e740: 6f73 5f6c 7374 5b6b 5d5d 0a20 2020 2020  os_lst[k]].     
-0007e750: 2020 2020 2020 2020 2020 2073 6f63 203d             soc =
-0007e760: 2073 675b 706f 735f 6c73 745b 6b5d 3a28   sg[pos_lst[k]:(
-0007e770: 706f 735f 6c73 745b 6b5d 2b6c 656e 5f6c  pos_lst[k]+len_l
-0007e780: 7374 5b6b 5d29 5d0a 2020 2020 2020 2020  st[k])].        
-0007e790: 2020 2020 2020 2020 736f 6e20 3d20 7367          son = sg
-0007e7a0: 5b28 706f 735f 6c73 745b 6b5d 2b6c 656e  [(pos_lst[k]+len
-0007e7b0: 5f6c 7374 5b6b 5d29 3a70 325d 0a20 2020  _lst[k]):p2].   
-0007e7c0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0007e7d0: 2020 2020 2020 2020 2020 2020 2020 736e                sn
-0007e7e0: 7020 3d20 7372 5b70 313a 706f 735f 6c73  p = sr[p1:pos_ls
-0007e7f0: 745b 6b5d 5d0a 2020 2020 2020 2020 2020  t[k]].          
-0007e800: 2020 2020 2020 736e 6320 3d20 7372 5b70        snc = sr[p
-0007e810: 6f73 5f6c 7374 5b6b 5d3a 2870 6f73 5f6c  os_lst[k]:(pos_l
-0007e820: 7374 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d  st[k]+len_lst[k]
-0007e830: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-0007e840: 2020 2073 6e6e 203d 2073 725b 2870 6f73     snn = sr[(pos
-0007e850: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
-0007e860: 6b5d 293a 7032 5d0a 2020 2020 2020 2020  k]):p2].        
-0007e870: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0007e880: 2020 2020 2020 2020 2073 6920 3d20 534e           si = SN
-0007e890: 565f 696e 666f 2863 6872 6d2c 2070 6f73  V_info(chrm, pos
-0007e8a0: 5f6c 7374 5b6b 5d2b 706f 735f 6162 732c  _lst[k]+pos_abs,
-0007e8b0: 2070 6f73 5f6c 7374 5b6b 5d2b 706f 735f   pos_lst[k]+pos_
-0007e8c0: 6162 732b 6f73 2c20 6769 6e5b 305d 2c20  abs+os, gin[0], 
-0007e8d0: 6769 6e5b 315d 2c20 2756 272c 206c 656e  gin[1], 'V', len
-0007e8e0: 5f6c 7374 5b6b 5d2c 205c 0a20 2020 2020  _lst[k], \.     
-0007e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e900: 2020 2020 2020 2020 2069 6e74 2863 725b           int(cr[
-0007e910: 706f 735f 6c73 745b 6b5d 5d29 2c20 312c  pos_lst[k]]), 1,
-0007e920: 2073 6f70 2c20 736f 632c 2073 6f6e 2c20   sop, soc, son, 
-0007e930: 736e 702c 2073 6e63 2c20 736e 6e20 290a  snp, snc, snn ).
-0007e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e950: 736e 765f 696e 666f 5f6c 7374 2e61 7070  snv_info_lst.app
-0007e960: 656e 6428 7369 290a 0a20 2020 2020 2020  end(si)..       
-0007e970: 2073 7461 7274 203d 2065 6e64 0a20 2020   start = end.   
-0007e980: 2020 2020 2065 6e64 203d 206d 696e 2820       end = min( 
-0007e990: 656e 6420 2b20 3130 302c 206c 656e 5f74  end + 100, len_t
-0007e9a0: 6f5f 7465 7374 2029 0a20 2020 2023 2727  o_test ).    #''
-0007e9b0: 2720 2020 2020 2020 2020 0a20 2020 2072  '         .    r
-0007e9c0: 6574 7572 6e28 736e 765f 696e 666f 5f6c  eturn(snv_info_l
-0007e9d0: 7374 290a 0a0a 6465 6620 6669 6e64 5f73  st)...def find_s
-0007e9e0: 6e70 2873 672c 2073 722c 2063 6d61 742c  np(sg, sr, cmat,
-0007e9f0: 2063 6872 6d2c 2070 6f73 5f61 6273 2c20   chrm, pos_abs, 
-0007ea00: 6f73 2c20 6769 6e29 3a0a 2020 2020 0a20  os, gin):.    . 
-0007ea10: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
-0007ea20: 3d20 5b5d 0a20 2020 206c 656e 5f74 6f5f  = [].    len_to_
-0007ea30: 7465 7374 203d 206d 696e 286c 656e 2873  test = min(len(s
-0007ea40: 7229 2c6c 656e 2873 6729 290a 0a20 2020  r),len(sg))..   
-0007ea50: 2063 7220 3d20 636d 6174 2e73 756d 2861   cr = cmat.sum(a
-0007ea60: 7869 7320 3d20 3029 0a20 2020 206e 7320  xis = 0).    ns 
-0007ea70: 3d20 6e70 2e61 7267 6d61 7828 2063 6d61  = np.argmax( cma
-0007ea80: 742c 2061 7869 733d 3020 290a 2020 2020  t, axis=0 ).    
-0007ea90: 7072 203d 2063 6d61 745b 6e73 2c6e 702e  pr = cmat[ns,np.
-0007eaa0: 6172 616e 6765 286c 656e 286e 7329 295d  arange(len(ns))]
-0007eab0: 2f63 720a 0a20 2020 2070 203d 2030 0a20  /cr..    p = 0. 
-0007eac0: 2020 2070 6f73 5f6c 7374 203d 205b 5d0a     pos_lst = [].
-0007ead0: 2020 2020 6c65 6e5f 6c73 7420 3d20 5b5d      len_lst = []
-0007eae0: 0a20 2020 2063 7667 5f6c 7374 203d 205b  .    cvg_lst = [
-0007eaf0: 5d0a 2020 2020 6366 725f 6c73 7420 3d20  ].    cfr_lst = 
-0007eb00: 5b5d 0a20 2020 2073 6e70 5f6c 7374 203d  [].    snp_lst =
-0007eb10: 205b 5d0a 2020 2020 736e 705f 6f72 675f   [].    snp_org_
-0007eb20: 6c73 7420 3d20 5b5d 0a20 2020 200a 2020  lst = [].    .  
-0007eb30: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-0007eb40: 286c 656e 5f74 6f5f 7465 7374 293a 0a20  (len_to_test):. 
-0007eb50: 2020 2020 2020 2069 6620 7372 5b6b 5d20         if sr[k] 
-0007eb60: 213d 2073 675b 6b5d 3a0a 2020 2020 2020  != sg[k]:.      
-0007eb70: 2020 2020 2020 6966 2070 203d 3d20 303a        if p == 0:
-0007eb80: 2070 6f73 203d 206b 0a20 2020 2020 2020   pos = k.       
-0007eb90: 2020 2020 2070 202b 3d20 310a 2020 2020       p += 1.    
-0007eba0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0007ebb0: 2020 2020 2020 6966 2070 203e 2030 3a0a        if p > 0:.
-0007ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ebd0: 2320 6376 675f 6c73 742e 6170 7065 6e64  # cvg_lst.append
-0007ebe0: 286e 702e 6d65 616e 2820 6372 5b70 6f73  (np.mean( cr[pos
-0007ebf0: 3a28 706f 732b 7029 5d20 2920 290a 2020  :(pos+p)] ) ).  
-0007ec00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0007ec10: 736e 705f 6c73 742e 6170 7065 6e64 2873  snp_lst.append(s
-0007ec20: 725b 706f 733a 2870 6f73 2b70 295d 290a  r[pos:(pos+p)]).
-0007ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ec40: 706f 735f 6c73 742e 6170 7065 6e64 2870  pos_lst.append(p
-0007ec50: 6f73 290a 2020 2020 2020 2020 2020 2020  os).            
-0007ec60: 2020 2020 6c65 6e5f 6c73 742e 6170 7065      len_lst.appe
-0007ec70: 6e64 2870 290a 2020 2020 2020 2020 2020  nd(p).          
-0007ec80: 2020 2020 2020 2320 736e 705f 6f72 675f        # snp_org_
-0007ec90: 6c73 742e 6170 7065 6e64 2873 675b 706f  lst.append(sg[po
-0007eca0: 733a 2870 6f73 2b70 295d 290a 2020 2020  s:(pos+p)]).    
-0007ecb0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-0007ecc0: 300a 2020 2020 2020 2020 2020 2020 0a20  0.            . 
-0007ecd0: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-0007ece0: 6528 6c65 6e28 706f 735f 6c73 7429 293a  e(len(pos_lst)):
-0007ecf0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0007ed00: 2020 7031 203d 206d 6178 2830 2c28 706f    p1 = max(0,(po
-0007ed10: 735f 6c73 745b 6b5d 2d4e 5749 4e29 290a  s_lst[k]-NWIN)).
-0007ed20: 2020 2020 2020 2020 7032 203d 206d 696e          p2 = min
-0007ed30: 286c 656e 5f74 6f5f 7465 7374 2c28 706f  (len_to_test,(po
-0007ed40: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
-0007ed50: 5b6b 5d2b 4e57 494e 2929 0a20 2020 2020  [k]+NWIN)).     
-0007ed60: 2020 200a 2020 2020 2020 2020 736f 7020     .        sop 
-0007ed70: 3d20 7367 5b70 313a 706f 735f 6c73 745b  = sg[p1:pos_lst[
-0007ed80: 6b5d 5d0a 2020 2020 2020 2020 736f 6320  k]].        soc 
-0007ed90: 3d20 7367 5b70 6f73 5f6c 7374 5b6b 5d3a  = sg[pos_lst[k]:
-0007eda0: 2870 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f  (pos_lst[k]+len_
-0007edb0: 6c73 745b 6b5d 295d 0a20 2020 2020 2020  lst[k])].       
-0007edc0: 2073 6f6e 203d 2073 675b 2870 6f73 5f6c   son = sg[(pos_l
-0007edd0: 7374 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d  st[k]+len_lst[k]
-0007ede0: 293a 7032 5d0a 2020 2020 2020 2020 0a20  ):p2].        . 
-0007edf0: 2020 2020 2020 2073 6e70 203d 2073 725b         snp = sr[
-0007ee00: 7031 3a70 6f73 5f6c 7374 5b6b 5d5d 0a20  p1:pos_lst[k]]. 
-0007ee10: 2020 2020 2020 2073 6e63 203d 2073 725b         snc = sr[
-0007ee20: 706f 735f 6c73 745b 6b5d 3a28 706f 735f  pos_lst[k]:(pos_
-0007ee30: 6c73 745b 6b5d 2b6c 656e 5f6c 7374 5b6b  lst[k]+len_lst[k
-0007ee40: 5d29 5d0a 2020 2020 2020 2020 736e 6e20  ])].        snn 
-0007ee50: 3d20 7372 5b28 706f 735f 6c73 745b 6b5d  = sr[(pos_lst[k]
-0007ee60: 2b6c 656e 5f6c 7374 5b6b 5d29 3a70 325d  +len_lst[k]):p2]
-0007ee70: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0007ee80: 2020 7369 203d 2053 4e56 5f69 6e66 6f28    si = SNV_info(
-0007ee90: 6368 726d 2c20 706f 735f 6c73 745b 6b5d  chrm, pos_lst[k]
-0007eea0: 2b70 6f73 5f61 6273 2c20 706f 735f 6c73  +pos_abs, pos_ls
-0007eeb0: 745b 6b5d 2b70 6f73 5f61 6273 2b6f 732c  t[k]+pos_abs+os,
-0007eec0: 2067 696e 5b30 5d2c 2067 696e 5b31 5d2c   gin[0], gin[1],
-0007eed0: 2027 5627 2c20 6c65 6e5f 6c73 745b 6b5d   'V', len_lst[k]
-0007eee0: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-0007eef0: 2020 2020 2020 2020 2020 696e 7428 6372            int(cr
-0007ef00: 5b70 6f73 5f6c 7374 5b6b 5d5d 292c 206e  [pos_lst[k]]), n
-0007ef10: 702e 726f 756e 6428 7072 5b70 6f73 5f6c  p.round(pr[pos_l
-0007ef20: 7374 5b6b 5d5d 2c33 292c 2073 6f70 2c20  st[k]],3), sop, 
-0007ef30: 736f 632c 2073 6f6e 2c20 736e 702c 2073  soc, son, snp, s
-0007ef40: 6e63 2c20 736e 6e20 290a 2020 2020 2020  nc, snn ).      
-0007ef50: 2020 736e 765f 696e 666f 5f6c 7374 2e61    snv_info_lst.a
-0007ef60: 7070 656e 6428 7369 290a 0a20 2020 2072  ppend(si)..    r
-0007ef70: 6574 7572 6e28 736e 765f 696e 666f 5f6c  eturn(snv_info_l
-0007ef80: 7374 290a 0a0a 6465 6620 636f 6d70 6172  st)...def compar
-0007ef90: 655f 7365 7132 2820 7331 2c20 7332 2029  e_seq2( s1, s2 )
-0007efa0: 3a0a 2020 2020 636e 7420 3d20 300a 2020  :.    cnt = 0.  
-0007efb0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-0007efc0: 286d 696e 286c 656e 2873 3129 2c6c 656e  (min(len(s1),len
-0007efd0: 2873 3229 2929 3a0a 2020 2020 2020 2020  (s2))):.        
-0007efe0: 636e 7420 2b3d 2028 7331 5b69 5d20 213d  cnt += (s1[i] !=
-0007eff0: 2073 325b 695d 290a 2020 2020 2320 6966   s2[i]).    # if
-0007f000: 206c 656e 2873 3129 2021 3d20 6c65 6e28   len(s1) != len(
-0007f010: 7332 293a 2070 7269 6e74 2827 5741 524e  s2): print('WARN
-0007f020: 494e 4720 696e 2063 6f6d 7061 7265 5f73  ING in compare_s
-0007f030: 6571 323a 2025 6920 213d 2025 6927 2025  eq2: %i != %i' %
-0007f040: 2028 6c65 6e28 7331 292c 6c65 6e28 7332   (len(s1),len(s2
-0007f050: 2929 2029 0a20 2020 2072 6574 7572 6e20  )) ).    return 
-0007f060: 636e 740a 0a0a 4f53 5f69 6e66 6f20 3d20  cnt...OS_info = 
-0007f070: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
-0007f080: 6474 7570 6c65 2827 4f53 5f69 6e66 6f27  dtuple('OS_info'
-0007f090: 2c20 276f 732c 2073 7461 7274 2c20 656e  , 'os, start, en
-0007f0a0: 6427 2920 2320 6f6e 652d 6261 7365 0a0a  d') # one-base..
-0007f0b0: 636c 6173 7320 6f66 6673 6574 5f66 696e  class offset_fin
-0007f0c0: 6465 723a 0a20 2020 200a 2020 2020 6465  der:.    .    de
-0007f0d0: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
-0007f0e0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6f  :.        self.o
-0007f0f0: 7369 5f6c 7374 203d 205b 5d0a 2020 2020  si_lst = [].    
-0007f100: 2020 2020 7365 6c66 2e6f 735f 6d61 7020      self.os_map 
-0007f110: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-0007f120: 656c 662e 6f73 5f70 7265 7620 3d20 300a  elf.os_prev = 0.
-0007f130: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
-0007f140: 2061 6464 2820 7365 6c66 2c20 6f73 2c20   add( self, os, 
-0007f150: 7374 6172 742c 2065 6e64 293a 0a20 2020  start, end):.   
-0007f160: 2020 2020 2073 656c 662e 6f73 695f 6c73       self.osi_ls
-0007f170: 742e 6170 7065 6e64 2820 4f53 5f69 6e66  t.append( OS_inf
-0007f180: 6f28 6f73 2c20 7374 6172 742c 2065 6e64  o(os, start, end
-0007f190: 2920 290a 2020 2020 2020 2020 0a20 2020  ) ).        .   
-0007f1a0: 2064 6566 2066 696e 645f 6f73 2820 7365   def find_os( se
-0007f1b0: 6c66 2c20 706f 7320 293a 0a20 2020 2020  lf, pos ):.     
-0007f1c0: 2020 206f 7320 3d20 300a 2020 2020 2020     os = 0.      
-0007f1d0: 2020 666f 7220 6f73 6920 696e 2073 656c    for osi in sel
-0007f1e0: 662e 6f73 695f 6c73 743a 0a20 2020 2020  f.osi_lst:.     
-0007f1f0: 2020 2020 2020 2069 6620 2870 6f73 203e         if (pos >
-0007f200: 3d20 6f73 692e 7374 6172 7429 2026 2028  = osi.start) & (
-0007f210: 706f 7320 3c20 6f73 692e 656e 6429 3a20  pos < osi.end): 
-0007f220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f230: 206f 7320 3d20 6f73 692e 6f73 0a20 2020   os = osi.os.   
-0007f240: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0007f250: 616b 0a20 2020 2020 2020 2072 6574 7572  ak.        retur
-0007f260: 6e20 6f73 0a0a 2020 2020 0a20 2020 2064  n os..    .    d
-0007f270: 6566 2066 696e 645f 6f73 5f73 6571 2820  ef find_os_seq( 
-0007f280: 7365 6c66 2c20 706f 732c 2070 7265 765f  self, pos, prev_
-0007f290: 692c 206d 6172 6b20 3d20 2727 2029 3a0a  i, mark = '' ):.
-0007f2a0: 2020 2020 2020 2020 6f73 203d 204e 6f6e          os = Non
-0007f2b0: 650a 2020 2020 2020 2020 6e65 7874 5f69  e.        next_i
-0007f2c0: 203d 2030 0a20 2020 2020 2020 2066 6f72   = 0.        for
-0007f2d0: 206b 2c20 6f73 6920 696e 2065 6e75 6d65   k, osi in enume
-0007f2e0: 7261 7465 2873 656c 662e 6f73 695f 6c73  rate(self.osi_ls
-0007f2f0: 745b 7072 6576 5f69 3a5d 293a 0a20 2020  t[prev_i:]):.   
-0007f300: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
-0007f310: 203e 3d20 6f73 692e 7374 6172 7429 2026   >= osi.start) &
-0007f320: 2028 706f 7320 3c20 6f73 692e 656e 6429   (pos < osi.end)
-0007f330: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0007f340: 2020 206f 7320 3d20 6f73 692e 6f73 0a20     os = osi.os. 
-0007f350: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0007f360: 6578 745f 6920 3d20 6b20 2b20 7072 6576  ext_i = k + prev
-0007f370: 5f69 200a 2020 2020 2020 2020 2020 2020  _i .            
-0007f380: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0007f390: 2020 6966 206f 7320 6973 204e 6f6e 653a    if os is None:
-0007f3a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0007f3b0: 206b 2c20 6f73 6920 696e 2065 6e75 6d65   k, osi in enume
-0007f3c0: 7261 7465 2873 656c 662e 6f73 695f 6c73  rate(self.osi_ls
-0007f3d0: 745b 3a70 7265 765f 695d 293a 0a20 2020  t[:prev_i]):.   
-0007f3e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007f3f0: 2870 6f73 203e 3d20 6f73 692e 7374 6172  (pos >= osi.star
-0007f400: 7429 2026 2028 706f 7320 3c20 6f73 692e  t) & (pos < osi.
-0007f410: 656e 6429 3a20 0a20 2020 2020 2020 2020  end): .         
-0007f420: 2020 2020 2020 2020 2020 206f 7320 3d20             os = 
-0007f430: 6f73 692e 6f73 0a20 2020 2020 2020 2020  osi.os.         
-0007f440: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-0007f450: 6920 3d20 6b0a 2020 2020 2020 2020 2020  i = k.          
-0007f460: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0007f470: 0a20 2020 2020 2020 2069 6620 6f73 2069  .        if os i
-0007f480: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0007f490: 2020 2020 6f73 203d 2073 656c 662e 6f73      os = self.os
-0007f4a0: 5f70 7265 760a 2020 2020 2020 2020 2020  _prev.          
-0007f4b0: 2020 2320 7072 696e 7428 2745 5252 4f52    # print('ERROR
-0007f4c0: 2069 6e20 6669 6e64 5f6f 735f 7365 713a   in find_os_seq:
-0007f4d0: 206f 7320 6973 204e 6f6e 6520 2573 2720   os is None %s' 
-0007f4e0: 2520 6d61 726b 2029 0a20 2020 2020 2020  % mark ).       
-0007f4f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0007f500: 2020 2073 656c 662e 6f73 5f70 7265 7620     self.os_prev 
-0007f510: 3d20 6f73 0a20 2020 2020 2020 2020 2020  = os.           
-0007f520: 200a 2020 2020 2020 2020 7265 7475 726e   .        return
-0007f530: 206f 732c 206e 6578 745f 690a 2020 2020   os, next_i.    
-0007f540: 0a20 2020 200a 2020 2020 6465 6620 6d61  .    .    def ma
-0007f550: 6b65 5f69 745f 636f 6d70 6163 7428 2073  ke_it_compact( s
-0007f560: 656c 6620 293a 0a0a 2020 2020 2020 2020  elf ):..        
-0007f570: 666f 7220 6b20 696e 2072 6576 6572 7365  for k in reverse
-0007f580: 6428 7261 6e67 6528 312c 6c65 6e28 7365  d(range(1,len(se
-0007f590: 6c66 2e6f 7369 5f6c 7374 2929 293a 0a20  lf.osi_lst))):. 
-0007f5a0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0007f5b0: 6c66 2e6f 7369 5f6c 7374 5b6b 5d2e 6f73  lf.osi_lst[k].os
-0007f5c0: 203d 3d20 7365 6c66 2e6f 7369 5f6c 7374   == self.osi_lst
-0007f5d0: 5b6b 2d31 5d2e 6f73 3a0a 2020 2020 2020  [k-1].os:.      
-0007f5e0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-0007f5f0: 7369 5f6c 7374 5b6b 2d31 5d20 3d20 4f53  si_lst[k-1] = OS
-0007f600: 5f69 6e66 6f28 2073 656c 662e 6f73 695f  _info( self.osi_
-0007f610: 6c73 745b 6b2d 315d 2e6f 732c 2073 656c  lst[k-1].os, sel
-0007f620: 662e 6f73 695f 6c73 745b 6b2d 315d 2e73  f.osi_lst[k-1].s
-0007f630: 7461 7274 2c20 7365 6c66 2e6f 7369 5f6c  tart, self.osi_l
-0007f640: 7374 5b6b 5d2e 656e 6420 290a 2020 2020  st[k].end ).    
-0007f650: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-0007f660: 7365 6c66 2e6f 7369 5f6c 7374 5b6b 5d0a  self.osi_lst[k].
-0007f670: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
-0007f680: 2067 6574 5f62 6e64 7279 2820 7365 6c66   get_bndry( self
-0007f690: 2c20 706f 7320 293a 0a20 2020 2020 2020  , pos ):.       
-0007f6a0: 206f 7320 3d20 300a 2020 2020 2020 2020   os = 0.        
-0007f6b0: 666f 7220 6f73 6920 696e 2073 656c 662e  for osi in self.
-0007f6c0: 6f73 695f 6c73 743a 0a20 2020 2020 2020  osi_lst:.       
-0007f6d0: 2020 2020 2069 6620 2870 6f73 203e 3d20       if (pos >= 
-0007f6e0: 6f73 692e 7374 6172 7429 3a20 0a20 2020  osi.start): .   
-0007f6f0: 2020 2020 2020 2020 2020 2020 206f 7320               os 
-0007f700: 3d20 6f73 692e 7374 6172 740a 2020 2020  = osi.start.    
-0007f710: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0007f720: 6b0a 2020 2020 2020 2020 7265 7475 726e  k.        return
-0007f730: 206f 730a 2020 2020 0a20 2020 2064 6566   os.    .    def
-0007f740: 2067 6574 5f62 6e64 7279 5f73 6571 2820   get_bndry_seq( 
-0007f750: 7365 6c66 2c20 706f 732c 2070 7265 765f  self, pos, prev_
-0007f760: 6920 293a 0a20 2020 2020 2020 206f 7320  i ):.        os 
-0007f770: 3d20 4e6f 6e65 0a20 2020 2020 2020 206e  = None.        n
-0007f780: 6578 745f 6920 3d20 300a 2020 2020 2020  ext_i = 0.      
-0007f790: 2020 666f 7220 6b2c 206f 7369 2069 6e20    for k, osi in 
-0007f7a0: 656e 756d 6572 6174 6528 7365 6c66 2e6f  enumerate(self.o
-0007f7b0: 7369 5f6c 7374 5b70 7265 765f 693a 5d29  si_lst[prev_i:])
-0007f7c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0007f7d0: 2028 706f 7320 3e3d 206f 7369 2e73 7461   (pos >= osi.sta
-0007f7e0: 7274 2920 2620 2870 6f73 203c 206f 7369  rt) & (pos < osi
-0007f7f0: 2e65 6e64 293a 200a 2020 2020 2020 2020  .end): .        
-0007f800: 2020 2020 2020 2020 6f73 203d 206f 7369          os = osi
-0007f810: 2e73 7461 7274 0a20 2020 2020 2020 2020  .start.         
-0007f820: 2020 2020 2020 206e 6578 745f 6920 3d20         next_i = 
-0007f830: 6b20 2b20 7072 6576 5f69 200a 2020 2020  k + prev_i .    
-0007f840: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0007f850: 6b0a 2020 2020 2020 2020 6966 206f 7320  k.        if os 
-0007f860: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0007f870: 2020 2020 2066 6f72 206b 2c20 6f73 6920       for k, osi 
-0007f880: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
-0007f890: 662e 6f73 695f 6c73 745b 3a70 7265 765f  f.osi_lst[:prev_
-0007f8a0: 695d 293a 0a20 2020 2020 2020 2020 2020  i]):.           
-0007f8b0: 2020 2020 2069 6620 2870 6f73 203e 3d20       if (pos >= 
-0007f8c0: 6f73 692e 7374 6172 7429 2026 2028 706f  osi.start) & (po
-0007f8d0: 7320 3c20 6f73 692e 656e 6429 3a20 0a20  s < osi.end): . 
-0007f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007f8f0: 2020 206f 7320 3d20 6f73 692e 7374 6172     os = osi.star
-0007f900: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0007f910: 2020 2020 2020 6e65 7874 5f69 203d 206b        next_i = k
-0007f920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f930: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0007f940: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0007f950: 6966 206f 7320 6973 204e 6f6e 653a 0a20  if os is None:. 
-0007f960: 2020 2020 2020 2020 2020 206f 7320 3d20             os = 
-0007f970: 300a 2020 2020 2020 2020 2020 2020 6e65  0.            ne
-0007f980: 7874 5f69 203d 2030 0a20 2020 2020 2020  xt_i = 0.       
-0007f990: 2020 2020 2070 7269 6e74 2827 4552 524f       print('ERRO
-0007f9a0: 5220 696e 2067 6574 5f62 6e64 7279 5f73  R in get_bndry_s
-0007f9b0: 6571 3a20 6f73 2069 7320 4e6f 6e65 2729  eq: os is None')
-0007f9c0: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-0007f9d0: 656c 662e 7072 696e 7428 290a 2020 2020  elf.print().    
-0007f9e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0007f9f0: 2072 6574 7572 6e20 6f73 2c20 6e65 7874   return os, next
-0007fa00: 5f69 0a20 2020 200a 2020 2020 0a20 2020  _i.    .    .   
-0007fa10: 2064 6566 2070 7269 6e74 2873 656c 6629   def print(self)
-0007fa20: 3a0a 2020 2020 2020 2020 666f 7220 6f73  :.        for os
-0007fa30: 6920 696e 2073 656c 662e 6f73 695f 6c73  i in self.osi_ls
-0007fa40: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
-0007fa50: 7269 6e74 2827 2569 202d 2025 693a 2025  rint('%i - %i: %
-0007fa60: 6927 2025 2028 6f73 692e 7374 6172 742c  i' % (osi.start,
-0007fa70: 206f 7369 2e65 6e64 2c20 6f73 692e 6f73   osi.end, osi.os
-0007fa80: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-0007fa90: 0a64 6566 2047 656e 6572 6174 655f 5265  .def Generate_Re
-0007faa0: 6665 7265 6e63 6528 6774 665f 6669 6c65  ference(gtf_file
-0007fab0: 2c20 6765 6e6f 6d65 5f66 696c 652c 2070  , genome_file, p
-0007fac0: 6570 7469 6465 203d 2054 7275 652c 206f  eptide = True, o
-0007fad0: 7574 5f64 6972 203d 204e 6f6e 652c 2073  ut_dir = None, s
-0007fae0: 7566 6669 7820 3d20 4e6f 6e65 293a 0a0a  uffix = None):..
-0007faf0: 2020 2020 6765 6e6f 6d65 203d 206c 6f61      genome = loa
-0007fb00: 645f 6765 6e6f 6d65 2867 656e 6f6d 655f  d_genome(genome_
-0007fb10: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
-0007fb20: 5472 7565 290a 0a20 2020 2067 7466 5f6c  True)..    gtf_l
-0007fb30: 696e 6573 2c20 6864 725f 6c69 6e65 7320  ines, hdr_lines 
-0007fb40: 3d20 6c6f 6164 5f67 7466 2867 7466 5f66  = load_gtf(gtf_f
-0007fb50: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
-0007fb60: 7275 6529 0a20 2020 2067 645f 6c73 742c  rue).    gd_lst,
-0007fb70: 2063 6872 7320 3d20 6765 745f 6765 6e65   chrs = get_gene
-0007fb80: 5f64 6573 6372 6970 746f 7228 6774 665f  _descriptor(gtf_
-0007fb90: 6c69 6e65 732c 2067 656e 6f6d 6520 3d20  lines, genome = 
-0007fba0: 4e6f 6e65 2c20 6669 6c6c 203d 2046 616c  None, fill = Fal
-0007fbb0: 7365 2c20 5c0a 2020 2020 2020 2020 2020  se, \.          
-0007fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007fbe0: 2063 6720 3d20 4661 6c73 652c 2076 6572   cg = False, ver
-0007fbf0: 626f 7365 203d 2054 7275 652c 206e 5f63  bose = True, n_c
-0007fc00: 6f72 6573 203d 2031 290a 2020 2020 6764  ores = 1).    gd
-0007fc10: 5f6c 7374 732c 2063 6872 5f6c 7374 203d  _lsts, chr_lst =
-0007fc20: 2070 6163 6b5f 6765 6e65 5f64 6573 6372   pack_gene_descr
-0007fc30: 6970 746f 7228 2067 645f 6c73 742c 2063  iptor( gd_lst, c
-0007fc40: 6872 7320 290a 2020 2020 0a0a 2020 2020  hrs ).    ..    
-0007fc50: 2320 6669 6c65 5f6e 616d 6520 3d20 6774  # file_name = gt
-0007fc60: 665f 6669 6c65 2e73 706c 6974 2827 2f27  f_file.split('/'
-0007fc70: 295b 2d31 5d0a 2020 2020 2320 666e 7320  )[-1].    # fns 
-0007fc80: 3d20 6669 6c65 5f6e 616d 652e 7370 6c69  = file_name.spli
-0007fc90: 7428 272e 2729 5b3a 2d31 5d0a 2020 2020  t('.')[:-1].    
-0007fca0: 666e 7320 3d20 6774 665f 6669 6c65 2e73  fns = gtf_file.s
-0007fcb0: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
-0007fcc0: 2020 2066 6e61 6d65 203d 2027 270a 2020     fname = ''.  
-0007fcd0: 2020 666f 7220 6b2c 2066 6e20 696e 2065    for k, fn in e
-0007fce0: 6e75 6d65 7261 7465 2866 6e73 293a 0a20  numerate(fns):. 
-0007fcf0: 2020 2020 2020 2069 6620 6b20 3e20 303a         if k > 0:
-0007fd00: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
-0007fd10: 6d65 203d 2066 6e61 6d65 202b 2027 2e27  me = fname + '.'
-0007fd20: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
-0007fd30: 2066 6e61 6d65 202b 2066 6e0a 2020 2020   fname + fn.    
-0007fd40: 6966 206f 7574 5f64 6972 2069 7320 6e6f  if out_dir is no
-0007fd50: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0007fd60: 6966 206f 7574 5f64 6972 5b2d 315d 203d  if out_dir[-1] =
-0007fd70: 3d20 272f 273a 0a20 2020 2020 2020 2020  = '/':.         
-0007fd80: 2020 2066 6e61 6d65 203d 206f 7574 5f64     fname = out_d
-0007fd90: 6972 202b 2066 6e61 6d65 0a20 2020 2020  ir + fname.     
-0007fda0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0007fdb0: 2020 2020 2066 6e61 6d65 203d 206f 7574       fname = out
-0007fdc0: 5f64 6972 202b 2027 2f27 202b 2066 6e61  _dir + '/' + fna
-0007fdd0: 6d65 0a0a 2020 2020 6966 2073 7566 6669  me..    if suffi
-0007fde0: 7820 6973 204e 6f6e 653a 2020 2020 0a20  x is None:    . 
-0007fdf0: 2020 2020 2020 2066 615f 6669 6c65 5f74         fa_file_t
-0007fe00: 7220 3d20 666e 616d 6520 2b20 275f 7472  r = fname + '_tr
-0007fe10: 616e 7363 7269 7074 6f6d 652e 6661 270a  anscriptome.fa'.
-0007fe20: 2020 2020 2020 2020 6661 5f66 696c 655f          fa_file_
-0007fe30: 7072 203d 2066 6e61 6d65 202b 2027 5f70  pr = fname + '_p
-0007fe40: 726f 7465 6f6d 652e 6661 270a 2020 2020  roteome.fa'.    
-0007fe50: 656c 7365 3a0a 2020 2020 2020 2020 6661  else:.        fa
-0007fe60: 5f66 696c 655f 7472 203d 2066 6e61 6d65  _file_tr = fname
-0007fe70: 202b 2027 5f25 735f 7472 616e 7363 7269   + '_%s_transcri
-0007fe80: 7074 6f6d 652e 6661 2720 2520 7375 6666  ptome.fa' % suff
-0007fe90: 6978 0a20 2020 2020 2020 2066 615f 6669  ix.        fa_fi
-0007fea0: 6c65 5f70 7220 3d20 666e 616d 6520 2b20  le_pr = fname + 
-0007feb0: 275f 2573 5f70 726f 7465 6f6d 652e 6661  '_%s_proteome.fa
-0007fec0: 2720 2520 7375 6666 6978 0a0a 2020 2020  ' % suffix..    
-0007fed0: 6661 5f74 7220 3d20 5b5d 0a20 2020 2066  fa_tr = [].    f
-0007fee0: 615f 7072 203d 205b 5d0a 2020 2020 0a20  a_pr = [].    . 
-0007fef0: 2020 2073 7461 7274 5f74 696d 6520 3d20     start_time = 
-0007ff00: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
-0007ff10: 6e74 7220 3d20 300a 0a20 2020 206d 6178  ntr = 0..    max
-0007ff20: 5f61 626e 203d 2030 0a20 2020 206d 6178  _abn = 0.    max
-0007ff30: 5f63 6f76 203d 2030 0a20 2020 2066 6f72  _cov = 0.    for
-0007ff40: 206b 6b2c 2063 6872 6d20 696e 2065 6e75   kk, chrm in enu
-0007ff50: 6d65 7261 7465 2863 6872 5f6c 7374 293a  merate(chr_lst):
-0007ff60: 0a20 2020 2020 2020 2066 6f72 2067 6420  .        for gd 
-0007ff70: 696e 2067 645f 6c73 7473 5b6b 6b5d 3a0a  in gd_lsts[kk]:.
-0007ff80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0007ff90: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
-0007ffa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007ffb0: 2069 6620 7464 2e61 626e 203e 2030 3a20   if td.abn > 0: 
-0007ffc0: 6d61 785f 6162 6e20 3d20 6d61 7828 206d  max_abn = max( m
-0007ffd0: 6178 5f61 626e 2c20 7464 2e61 626e 2029  ax_abn, td.abn )
-0007ffe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007fff0: 2069 6620 7464 2e63 6f76 203e 2030 3a20   if td.cov > 0: 
-00080000: 6d61 785f 636f 7620 3d20 6d61 7828 206d  max_cov = max( m
-00080010: 6178 5f63 6f76 2c20 7464 2e63 6f76 2029  ax_cov, td.cov )
-00080020: 0a0a 2020 2020 6966 206d 6178 5f61 626e  ..    if max_abn
-00080030: 203e 2030 3a20 6162 6e5f 7468 203d 204d   > 0: abn_th = M
-00080040: 494e 5f41 424e 5f54 4f5f 5345 4c0a 2020  IN_ABN_TO_SEL.  
-00080050: 2020 656c 7365 3a20 6162 6e5f 7468 203d    else: abn_th =
-00080060: 2030 0a20 2020 2069 6620 6d61 785f 636f   0.    if max_co
-00080070: 7620 3e20 303a 2063 6f76 5f74 6820 3d20  v > 0: cov_th = 
-00080080: 4d49 4e5f 434f 565f 544f 5f53 454c 0a20  MIN_COV_TO_SEL. 
-00080090: 2020 2065 6c73 653a 2063 6f76 5f74 6820     else: cov_th 
-000800a0: 3d20 300a 2020 2020 7072 696e 7428 2743  = 0.    print('C
-000800b0: 7574 6f66 663a 2041 203d 2025 352e 3266  utoff: A = %5.2f
-000800c0: 2c20 4320 3d20 2535 2e32 6620 2720 2520  , C = %5.2f ' % 
-000800d0: 2861 626e 5f74 682c 2063 6f76 5f74 6829  (abn_th, cov_th)
-000800e0: 290a 0a20 2020 2066 6f72 206b 6b2c 2063  )..    for kk, c
-000800f0: 6872 6d20 696e 2065 6e75 6d65 7261 7465  hrm in enumerate
-00080100: 2863 6872 5f6c 7374 293a 0a0a 2020 2020  (chr_lst):..    
-00080110: 2020 2020 7072 696e 7428 275c 7227 202b      print('\r' +
-00080120: 2027 2027 2a31 3030 2c20 656e 643d 2727   ' '*100, end=''
-00080130: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-00080140: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-00080150: 7247 656e 6572 6174 696e 6720 7265 6665  rGenerating refe
-00080160: 7265 6e63 6573 202e 2e20 2573 2020 2720  rences .. %s  ' 
-00080170: 2520 2863 6872 6d29 2c20 656e 6420 3d20  % (chrm), end = 
-00080180: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-00080190: 290a 0a20 2020 2020 2020 2066 6f72 2067  )..        for g
-000801a0: 6420 696e 2067 645f 6c73 7473 5b6b 6b5d  d in gd_lsts[kk]
-000801b0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-000801c0: 6764 2e6f 7264 6572 2829 0a20 2020 2020  gd.order().     
-000801d0: 2020 2020 2020 206e 7472 202b 3d20 6764         ntr += gd
-000801e0: 2e6e 7472 0a20 2020 2020 2020 2020 2020  .ntr.           
-000801f0: 2066 615f 742c 2066 615f 7020 3d20 6764   fa_t, fa_p = gd
-00080200: 2e67 6574 5f66 6173 7461 5f6c 696e 6573  .get_fasta_lines
-00080210: 5f66 726f 6d5f 6765 6e6f 6d65 2867 656e  _from_genome(gen
-00080220: 6f6d 652c 2061 626e 5f74 6820 3d20 6162  ome, abn_th = ab
-00080230: 6e5f 7468 2c20 636f 765f 7468 203d 2063  n_th, cov_th = c
-00080240: 6f76 5f74 682c 206c 656e 5f74 685f 743d  ov_th, len_th_t=
-00080250: 204d 494e 5f54 525f 4c45 4e47 5448 2c20   MIN_TR_LENGTH, 
-00080260: 6c65 6e5f 7468 5f70 203d 204d 494e 5f50  len_th_p = MIN_P
-00080270: 525f 4c45 4e47 5448 290a 2020 2020 2020  R_LENGTH).      
-00080280: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00080290: 2020 2023 2066 615f 7420 3d20 6669 6c74     # fa_t = filt
-000802a0: 6572 5f74 7273 5f6c 656e 2866 615f 742c  er_trs_len(fa_t,
-000802b0: 206d 696e 5f6c 656e 203d 204d 494e 5f54   min_len = MIN_T
-000802c0: 525f 4c45 4e47 5448 290a 2020 2020 2020  R_LENGTH).      
-000802d0: 2020 2020 2020 2320 6661 5f70 203d 2066        # fa_p = f
-000802e0: 696c 7465 725f 7472 735f 6c65 6e28 6661  ilter_trs_len(fa
-000802f0: 5f70 2c20 6d69 6e5f 6c65 6e20 3d20 4d49  _p, min_len = MI
-00080300: 4e5f 5052 5f4c 454e 4754 4829 0a20 2020  N_PR_LENGTH).   
-00080310: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00080320: 2020 2020 2020 6661 5f74 7220 3d20 6661        fa_tr = fa
-00080330: 5f74 7220 2b20 6661 5f74 0a20 2020 2020  _tr + fa_t.     
-00080340: 2020 2020 2020 2066 615f 7072 203d 2066         fa_pr = f
-00080350: 615f 7072 202b 2066 615f 700a 2020 2020  a_pr + fa_p.    
-00080360: 2020 2020 2020 2020 0a20 2020 200a 2020          .    .  
-00080370: 2020 6966 2028 6c65 6e28 6661 5f70 7229    if (len(fa_pr)
-00080380: 203d 3d20 3029 2026 2028 7065 7074 6964   == 0) & (peptid
-00080390: 6529 3a0a 2020 2020 2020 2020 6864 725f  e):.        hdr_
-000803a0: 6c73 742c 2074 7365 715f 6c73 7420 3d20  lst, tseq_lst = 
-000803b0: 5b5d 2c20 5b5d 0a20 2020 2020 2020 2066  [], [].        f
-000803c0: 6f72 206c 696e 6520 696e 2066 615f 7472  or line in fa_tr
-000803d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000803e0: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
-000803f0: 2068 6472 5f6c 7374 2e61 7070 656e 6428   hdr_lst.append(
-00080400: 6c69 6e65 5b31 3a2d 315d 290a 2020 2020  line[1:-1]).    
-00080410: 2020 2020 2020 2020 656c 7365 3a20 7473          else: ts
-00080420: 6571 5f6c 7374 2e61 7070 656e 6428 6c69  eq_lst.append(li
-00080430: 6e65 5b30 3a2d 315d 290a 0a20 2020 2020  ne[0:-1])..     
-00080440: 2020 2066 615f 7072 203d 2067 656e 5f70     fa_pr = gen_p
-00080450: 726f 7465 6f6d 655f 6672 6f6d 5f74 7261  roteome_from_tra
-00080460: 7363 7269 7074 6f6d 6528 6864 725f 6c73  scriptome(hdr_ls
-00080470: 742c 2074 7365 715f 6c73 742c 206c 656e  t, tseq_lst, len
-00080480: 5f74 6820 3d20 4d49 4e5f 5052 5f4c 454e  _th = MIN_PR_LEN
-00080490: 4754 482c 2076 6572 626f 7365 203d 2054  GTH, verbose = T
-000804a0: 7275 652c 2074 7261 7265 636f 203d 2046  rue, trareco = F
-000804b0: 616c 7365 290a 2020 2020 2020 2020 705f  alse).        p_
-000804c0: 6361 6e64 5f63 6e74 203d 206c 656e 2866  cand_cnt = len(f
-000804d0: 615f 7072 292f 320a 0a20 2020 2020 2020  a_pr)/2..       
-000804e0: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
-000804f0: 7469 6e67 2072 6566 6572 656e 6365 7320  ting references 
-00080500: 2e2e 2064 6f6e 652e 2025 6920 2d3e 2025  .. done. %i -> %
-00080510: 692c 2569 2720 2520 286e 7472 2c20 6c65  i,%i' % (ntr, le
-00080520: 6e28 6661 5f74 7229 2f32 2c20 705f 6361  n(fa_tr)/2, p_ca
-00080530: 6e64 5f63 6e74 2929 0a20 2020 2065 6c73  nd_cnt)).    els
-00080540: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
-00080550: 2827 5c72 4765 6e65 7261 7469 6e67 2072  ('\rGenerating r
-00080560: 6566 6572 656e 6365 7320 2e2e 2064 6f6e  eferences .. don
-00080570: 652e 2025 6920 2d3e 2025 6927 2025 2028  e. %i -> %i' % (
-00080580: 6e74 722c 206c 656e 2866 615f 7472 292f  ntr, len(fa_tr)/
-00080590: 3229 290a 0a20 2020 2070 7269 6e74 2827  2))..    print('
-000805a0: 5361 7669 6e67 2046 4153 5441 202e 2e27  Saving FASTA ..'
-000805b0: 2c20 656e 6420 3d20 2727 2c20 666c 7573  , end = '', flus
-000805c0: 6820 3d20 5472 7565 290a 2020 2020 6620  h = True).    f 
-000805d0: 3d20 6f70 656e 2866 615f 6669 6c65 5f74  = open(fa_file_t
-000805e0: 722c 2027 772b 2729 0a20 2020 2066 2e77  r, 'w+').    f.w
-000805f0: 7269 7465 6c69 6e65 7328 6661 5f74 7229  ritelines(fa_tr)
-00080600: 0a20 2020 2066 2e63 6c6f 7365 2829 0a0a  .    f.close()..
-00080610: 2020 2020 6966 2070 6570 7469 6465 3a0a      if peptide:.
-00080620: 2020 2020 2020 2020 7072 696e 7428 272e          print('.
-00080630: 272c 2065 6e64 3d27 2729 0a20 2020 2020  ', end='').     
-00080640: 2020 2066 203d 206f 7065 6e28 6661 5f66     f = open(fa_f
-00080650: 696c 655f 7072 2c20 2777 2b27 290a 2020  ile_pr, 'w+').  
-00080660: 2020 2020 2020 662e 7772 6974 656c 696e        f.writelin
-00080670: 6573 2866 615f 7072 290a 2020 2020 2020  es(fa_pr).      
-00080680: 2020 662e 636c 6f73 6528 290a 0a20 2020    f.close()..   
-00080690: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
-000806a0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-000806b0: 6172 745f 7469 6d65 0a20 2020 2070 7269  art_time.    pri
-000806c0: 6e74 2827 2064 6f6e 652e 2028 2569 2920  nt(' done. (%i) 
-000806d0: 2720 2520 2865 6c61 7073 6564 5f74 696d  ' % (elapsed_tim
-000806e0: 6529 290a 2020 2020 7072 696e 7428 2720  e)).    print(' 
-000806f0: 2020 2573 2720 2520 6661 5f66 696c 655f    %s' % fa_file_
-00080700: 7472 2029 0a20 2020 2069 6620 7065 7074  tr ).    if pept
-00080710: 6964 653a 2070 7269 6e74 2827 2020 2025  ide: print('   %
-00080720: 7327 2025 2066 615f 6669 6c65 5f70 7220  s' % fa_file_pr 
-00080730: 290a 2020 2020 0a20 2020 2072 6574 7572  ).    .    retur
-00080740: 6e20 6661 5f66 696c 655f 7472 2c20 6661  n fa_file_tr, fa
-00080750: 5f66 696c 655f 7072 0a20 2020 200a 0a64  _file_pr.    ..d
-00080760: 6566 206d 635f 636f 7265 5f72 6563 6f6e  ef mc_core_recon
-00080770: 7374 7275 6374 696f 6e28 6767 635f 7475  struction(ggc_tu
-00080780: 706c 6529 3a0a 2020 2020 0a20 2020 2067  ple):.    .    g
-00080790: 645f 7365 6c20 3d20 6767 635f 7475 706c  d_sel = ggc_tupl
-000807a0: 655b 305d 0a20 2020 2073 6571 5f6f 7267  e[0].    seq_org
-000807b0: 203d 2067 6763 5f74 7570 6c65 5b31 5d0a   = ggc_tuple[1].
-000807c0: 2020 2020 6368 726d 203d 2067 6763 5f74      chrm = ggc_t
-000807d0: 7570 6c65 5b32 5d0a 2020 2020 0a20 2020  uple[2].    .   
-000807e0: 2023 2067 645f 7365 6c20 3d20 736f 7274   # gd_sel = sort
-000807f0: 5f64 6573 6372 6970 746f 725f 6c73 7428  _descriptor_lst(
-00080800: 6764 5f73 656c 290a 2020 2020 6e5f 6764  gd_sel).    n_gd
-00080810: 203d 206c 656e 2867 645f 7365 6c29 0a0a   = len(gd_sel)..
-00080820: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-00080830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080840: 2323 2323 2323 230a 2020 2020 2323 2063  #######.    ## c
-00080850: 6f6c 6c65 6374 2072 676e 7320 616e 6420  ollect rgns and 
-00080860: 6d61 726b 2074 6865 6972 2070 6f73 0a20  mark their pos. 
-00080870: 2020 200a 2020 2020 7374 6172 745f 7469     .    start_ti
-00080880: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00080890: 0a20 2020 206c 6f63 5f6f 7320 3d20 6e70  .    loc_os = np
-000808a0: 2e7a 6572 6f73 286e 5f67 642c 6474 7970  .zeros(n_gd,dtyp
-000808b0: 653d 6e70 2e66 6c6f 6174 3332 290a 2020  e=np.float32).  
-000808c0: 2020 6e75 6d5f 6f73 203d 206e 702e 7a65    num_os = np.ze
-000808d0: 726f 7328 6e5f 6764 2c64 7479 7065 3d6e  ros(n_gd,dtype=n
-000808e0: 702e 666c 6f61 7433 3229 0a20 2020 2072  p.float32).    r
-000808f0: 616c 6c20 3d20 7265 6769 6f6e 7328 290a  all = regions().
-00080900: 2020 2020 4765 6e65 5f69 645f 6e61 6d65      Gene_id_name
-00080910: 203d 205b 5d0a 2020 2020 6764 5f69 6478   = [].    gd_idx
-00080920: 5f6f 665f 7267 6e20 3d20 5b5d 0a20 2020  _of_rgn = [].   
-00080930: 206f 735f 6375 7220 3d20 300a 2020 2020   os_cur = 0.    
-00080940: 725f 706f 7320 3d20 5b5d 0a20 2020 2066  r_pos = [].    f
-00080950: 6f72 206b 2c20 6764 2069 6e20 656e 756d  or k, gd in enum
-00080960: 6572 6174 6528 6764 5f73 656c 293a 0a0a  erate(gd_sel):..
-00080970: 2020 2020 2020 2020 2323 2063 6865 636b          ## check
-00080980: 2069 6620 616e 7920 4420 6f72 2049 206c   if any D or I l
-00080990: 6965 7320 7769 7468 696e 2061 6e20 6578  ies within an ex
-000809a0: 6f6e 0a20 2020 2020 2020 2066 6f72 2065  on.        for e
-000809b0: 2069 6e20 6764 2e65 786f 6e73 2e72 676e   in gd.exons.rgn
-000809c0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-000809d0: 6620 652e 7479 7065 203d 3d20 2764 656c  f e.type == 'del
-000809e0: 6574 696f 6e27 3a0a 2020 2020 2020 2020  etion':.        
-000809f0: 2020 2020 2020 2020 6220 3d20 4661 6c73          b = Fals
-00080a00: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00080a10: 2020 666f 7220 6320 696e 2067 642e 6578    for c in gd.ex
-00080a20: 6f6e 732e 7267 6e73 3a0a 2020 2020 2020  ons.rgns:.      
-00080a30: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00080a40: 2028 632e 7479 7065 203d 3d20 2765 786f   (c.type == 'exo
-00080a50: 6e27 293a 0a20 2020 2020 2020 2020 2020  n'):.           
-00080a60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00080a70: 652e 6861 735f 6578 745f 696e 7465 7273  e.has_ext_inters
-00080a80: 6563 7469 6f6e 5f77 6974 6828 6329 3a0a  ection_with(c):.
-00080a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080aa0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-00080ab0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00080ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080ad0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00080ae0: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
-00080af0: 2020 2020 2020 2020 2020 2069 6620 623a             if b:
-00080b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00080b10: 2020 2020 2070 7269 6e74 2827 5741 524e       print('WARN
-00080b20: 494e 473a 2044 2825 733a 2569 2d25 6929  ING: D(%s:%i-%i)
-00080b30: 206f 7665 726c 6170 7320 7769 7468 2045   overlaps with E
-00080b40: 2825 733a 2569 2d25 6929 2720 2520 5c0a  (%s:%i-%i)' % \.
-00080b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080b60: 2020 2020 2020 2020 2020 2865 2e63 6872            (e.chr
-00080b70: 2c20 652e 7374 6172 742c 2065 2e65 6e64  , e.start, e.end
-00080b80: 2c20 632e 6368 722c 2063 2e73 7461 7274  , c.chr, c.start
-00080b90: 2c20 632e 656e 6429 290a 2020 2020 2020  , c.end)).      
-00080ba0: 2020 2020 2020 2020 2020 2727 2720 2020            '''   
-00080bb0: 200a 2020 2020 2020 2020 2020 2020 656c   .            el
-00080bc0: 6966 2065 2e74 7970 6520 3d3d 2027 696e  if e.type == 'in
-00080bd0: 7365 7273 696f 6e27 3a0a 2020 2020 2020  sersion':.      
-00080be0: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
-00080bf0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00080c00: 2020 2020 666f 7220 6320 696e 2067 642e      for c in gd.
-00080c10: 6578 6f6e 732e 7267 6e73 3a0a 2020 2020  exons.rgns:.    
-00080c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080c30: 6966 2028 632e 7479 7065 203d 3d20 2765  if (c.type == 'e
-00080c40: 786f 6e27 293a 0a20 2020 2020 2020 2020  xon'):.         
-00080c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00080c60: 6620 2865 2e73 7461 7274 203e 2063 2e73  f (e.start > c.s
-00080c70: 7461 7274 2920 2620 2865 2e73 7461 7274  tart) & (e.start
-00080c80: 203c 2063 2e65 6e64 293a 0a20 2020 2020   < c.end):.     
-00080c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080ca0: 2020 2020 2020 2062 203d 2054 7275 650a         b = True.
-00080cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080cc0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00080cd0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00080ce0: 2020 2727 2720 2020 200a 2020 2020 2020    '''    .      
-00080cf0: 2020 2020 2020 2020 2020 6966 2062 3a0a            if b:.
-00080d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080d10: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
-00080d20: 4e47 3a20 4928 2573 3a25 692d 2569 2920  NG: I(%s:%i-%i) 
-00080d30: 6f76 6572 6c61 7073 2077 6974 6820 4528  overlaps with E(
-00080d40: 2573 3a25 692d 2569 2927 2025 205c 0a20  %s:%i-%i)' % \. 
-00080d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080d60: 2020 2020 2020 2020 2028 652e 6368 722c           (e.chr,
-00080d70: 2065 2e73 7461 7274 2c20 652e 656e 642c   e.start, e.end,
-00080d80: 2063 2e63 6872 2c20 632e 7374 6172 742c   c.chr, c.start,
-00080d90: 2063 2e65 6e64 2929 0a20 2020 2020 2020   c.end)).       
-00080da0: 2020 2020 2020 2020 2027 2727 2020 2020           '''    
-00080db0: 0a0a 2020 2020 2020 2020 6c6f 635f 6f73  ..        loc_os
-00080dc0: 5b6b 5d20 3d20 6f73 5f63 7572 0a20 2020  [k] = os_cur.   
-00080dd0: 2020 2020 206e 756d 5f6f 735b 6b5d 203d       num_os[k] =
-00080de0: 206c 656e 2867 642e 6578 6f6e 732e 7267   len(gd.exons.rg
-00080df0: 6e73 290a 2020 2020 2020 2020 7261 6c6c  ns).        rall
-00080e00: 2e72 676e 7320 3d20 7261 6c6c 2e72 676e  .rgns = rall.rgn
-00080e10: 7320 2b20 6764 2e65 786f 6e73 2e72 676e  s + gd.exons.rgn
-00080e20: 730a 2020 2020 2020 2020 675f 6964 5f6e  s.        g_id_n
-00080e30: 5f6e 616d 655f 6c73 7420 3d20 6764 2e67  _name_lst = gd.g
-00080e40: 6574 5f67 6964 5f6e 5f67 6e61 6d65 5f6c  et_gid_n_gname_l
-00080e50: 6973 7428 290a 2020 2020 2020 2020 4765  ist().        Ge
-00080e60: 6e65 5f69 645f 6e61 6d65 203d 2047 656e  ne_id_name = Gen
-00080e70: 655f 6964 5f6e 616d 6520 2b20 675f 6964  e_id_name + g_id
-00080e80: 5f6e 5f6e 616d 655f 6c73 740a 2020 2020  _n_name_lst.    
-00080e90: 2020 2020 6764 5f69 6478 5f6f 665f 7267      gd_idx_of_rg
-00080ea0: 6e20 3d20 6764 5f69 6478 5f6f 665f 7267  n = gd_idx_of_rg
-00080eb0: 6e20 2b20 5b6b 5d2a 6c65 6e28 6764 2e65  n + [k]*len(gd.e
-00080ec0: 786f 6e73 2e72 676e 7329 0a20 2020 2020  xons.rgns).     
-00080ed0: 2020 206f 735f 6375 7220 2b3d 206c 656e     os_cur += len
-00080ee0: 2867 642e 6578 6f6e 732e 7267 6e73 290a  (gd.exons.rgns).
-00080ef0: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-00080f00: 6e20 6764 2e65 786f 6e73 2e72 676e 733a  n gd.exons.rgns:
-00080f10: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
-00080f20: 5f70 6f73 2e61 7070 656e 6428 722e 656e  _pos.append(r.en
-00080f30: 6429 0a20 2020 2020 2020 2020 2020 2072  d).            r
-00080f40: 5f70 6f73 2e61 7070 656e 6428 722e 7374  _pos.append(r.st
-00080f50: 6172 7429 0a0a 2020 2020 2323 2323 2323  art)..    ######
-00080f60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080f70: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00080f80: 2020 2323 2067 6574 206f 7264 6572 2061    ## get order a
-00080f90: 6363 6f72 6469 6e67 2074 6f20 6c6f 6361  ccording to loca
-00080fa0: 7469 6f6e 0a20 2020 2072 5f70 6f73 203d  tion.    r_pos =
-00080fb0: 206e 702e 6172 7261 7928 725f 706f 7329   np.array(r_pos)
-00080fc0: 0a20 2020 206f 6472 203d 2072 5f70 6f73  .    odr = r_pos
-00080fd0: 2e61 7267 736f 7274 2829 0a0a 2020 2020  .argsort()..    
-00080fe0: 666f 7220 6b2c 206f 2069 6e20 656e 756d  for k, o in enum
-00080ff0: 6572 6174 6528 6f64 7229 3a0a 2020 2020  erate(odr):.    
-00081000: 2020 2020 7220 3d20 7261 6c6c 2e72 676e      r = rall.rgn
-00081010: 735b 6f5d 0a20 2020 2020 2020 2069 6620  s[o].        if 
-00081020: 722e 7479 7065 203d 3d20 2769 6e73 6572  r.type == 'inser
-00081030: 7369 6f6e 273a 0a20 2020 2020 2020 2020  sion':.         
-00081040: 2020 2072 7020 3d20 7261 6c6c 2e72 676e     rp = rall.rgn
-00081050: 735b 6f64 725b 6b2d 315d 5d0a 2020 2020  s[odr[k-1]].    
-00081060: 2020 2020 2020 2020 6966 2028 722e 7374          if (r.st
-00081070: 6172 7420 3d3d 2072 702e 7374 6172 7429  art == rp.start)
-00081080: 2026 2028 7270 2e74 7970 6520 3d3d 2027   & (rp.type == '
-00081090: 6578 6f6e 2729 3a0a 2020 2020 2020 2020  exon'):.        
-000810a0: 2020 2020 2020 2020 6f70 203d 206f 6472          op = odr
-000810b0: 5b6b 2d31 5d0a 2020 2020 2020 2020 2020  [k-1].          
-000810c0: 2020 2020 2020 6f64 725b 6b2d 315d 203d        odr[k-1] =
-000810d0: 206f 6472 5b6b 5d0a 2020 2020 2020 2020   odr[k].        
-000810e0: 2020 2020 2020 2020 6f64 725b 6b5d 203d          odr[k] =
-000810f0: 206f 700a 2020 2020 2020 2020 2020 2020   op.            
-00081100: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00081110: 2020 2020 2020 726e 203d 2072 616c 6c2e        rn = rall.
-00081120: 7267 6e73 5b6f 6472 5b6b 2b31 5d5d 0a20  rgns[odr[k+1]]. 
-00081130: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00081140: 6620 2872 6e2e 7374 6172 7420 3d3d 2072  f (rn.start == r
-00081150: 2e73 7461 7274 2920 2620 2872 6e2e 7479  .start) & (rn.ty
-00081160: 7065 203d 3d20 2765 786f 6e27 293a 0a20  pe == 'exon'):. 
-00081170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081180: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00081190: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000811a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000811b0: 2020 7072 696e 7428 2745 5252 4f52 2025    print('ERROR %
-000811c0: 693a 204e 6f20 636f 6e6e 6563 7469 6f6e  i: No connection
-000811d0: 2066 6f75 6e64 2066 6f72 2049 2025 692c   found for I %i,
-000811e0: 2573 2d25 692c 2573 2d25 692c 2573 2720  %s-%i,%s-%i,%s' 
-000811f0: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
-00081200: 2020 2020 2020 2020 2020 2020 2020 286b                (k
-00081210: 2c20 7270 2e73 7461 7274 2c72 702e 7479  , rp.start,rp.ty
-00081220: 7065 2c20 722e 7374 6172 742c 722e 7479  pe, r.start,r.ty
-00081230: 7065 2c20 726e 2e73 7461 7274 2c20 726e  pe, rn.start, rn
-00081240: 2e74 7970 6529 2029 0a0a 2020 2020 656c  .type) )..    el
-00081250: 6170 7365 645f 7469 6d65 203d 2074 696d  apsed_time = tim
-00081260: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
-00081270: 5f74 696d 650a 2020 2020 2320 7072 696e  _time.    # prin
-00081280: 7428 2720 2020 312e 2064 6f6e 6520 2825  t('   1. done (%
-00081290: 6929 2020 2720 2520 2865 6c61 7073 6564  i)  ' % (elapsed
-000812a0: 5f74 696d 6529 2c20 666c 7573 6820 3d20  _time), flush = 
-000812b0: 5472 7565 290a 2020 2020 2327 2727 0a0a  True).    #'''..
-000812c0: 2020 2020 2327 2727 0a20 2020 2023 2323      #'''.    ###
-000812d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000812e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000812f0: 2323 2323 2323 0a20 2020 2023 2320 6765  ######.    ## ge
-00081300: 7420 206f 6666 7365 745f 6669 6e64 6572  t  offset_finder
-00081310: 2061 6e64 206e 6577 2067 656e 6f6d 6520   and new genome 
-00081320: 7365 710a 2020 2020 0a20 2020 2073 7461  seq.    .    sta
-00081330: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
-00081340: 696d 6528 290a 2020 2020 6f66 203d 206f  ime().    of = o
-00081350: 6666 7365 745f 6669 6e64 6572 2829 0a20  ffset_finder(). 
-00081360: 2020 206f 735f 6375 7220 3d20 300a 2020     os_cur = 0.  
-00081370: 2020 7072 6576 5f70 6f73 203d 2031 2023    prev_pos = 1 #
-00081380: 206f 6e65 2d62 6173 650a 2020 2020 6c61   one-base.    la
-00081390: 7374 5f70 6f73 203d 2031 2023 206f 6e65  st_pos = 1 # one
-000813a0: 2d62 6173 650a 0a20 2020 2073 6571 5f6c  -base..    seq_l
-000813b0: 7374 203d 205b 5d0a 0a20 2020 2066 6f72  st = []..    for
-000813c0: 206d 2c20 6b20 696e 2065 6e75 6d65 7261   m, k in enumera
-000813d0: 7465 286f 6472 293a 0a20 2020 2020 2020  te(odr):.       
-000813e0: 2072 203d 2072 616c 6c2e 7267 6e73 5b6b   r = rall.rgns[k
-000813f0: 5d0a 0a20 2020 2020 2020 2069 6620 722e  ]..        if r.
-00081400: 7479 7065 203d 3d20 2765 786f 6e27 3a0a  type == 'exon':.
-00081410: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00081420: 722e 7374 6172 7429 203c 2028 7072 6576  r.start) < (prev
-00081430: 5f70 6f73 293a 0a20 2020 2020 2020 2020  _pos):.         
-00081440: 2020 2020 2020 2069 6620 722e 656e 6420         if r.end 
-00081450: 3c20 7072 6576 5f70 6f73 3a0a 2020 2020  < prev_pos:.    
-00081460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081470: 2320 7072 696e 7428 2725 6920 5741 524e  # print('%i WARN
-00081480: 494e 4720 2845 4129 3a20 2573 2c20 2569  ING (EA): %s, %i
-00081490: 2d25 6920 3c3d 2025 692c 2025 692f 2569  -%i <= %i, %i/%i
-000814a0: 2720 2520 286d 2c20 722e 6368 722c 2072  ' % (m, r.chr, r
-000814b0: 2e73 7461 7274 2c20 722e 656e 642c 2070  .start, r.end, p
-000814c0: 7265 765f 706f 732c 206d 2c20 6c65 6e28  rev_pos, m, len(
-000814d0: 6f64 7229 2920 290a 2020 2020 2020 2020  odr)) ).        
-000814e0: 2020 2020 2020 2020 2020 2020 735f 6f72              s_or
-000814f0: 6720 3d20 7365 715f 6f72 675b 2872 2e73  g = seq_org[(r.s
-00081500: 7461 7274 2d31 293a 2872 2e65 6e64 295d  tart-1):(r.end)]
-00081510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081520: 2020 2020 2072 2e63 6f6d 7061 7265 5f61       r.compare_a
-00081530: 6e64 5f72 6570 6c61 6365 5f4e 2873 5f6f  nd_replace_N(s_o
-00081540: 7267 290a 2020 2020 2020 2020 2020 2020  rg).            
-00081550: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00081560: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00081570: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00081580: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
-00081590: 2569 2057 4152 4e49 4e47 2028 4542 293a  %i WARNING (EB):
-000815a0: 2025 732c 2025 692d 2569 203c 3d20 2569   %s, %i-%i <= %i
-000815b0: 2720 2520 286d 2c20 722e 6368 722c 2072  ' % (m, r.chr, r
-000815c0: 2e73 7461 7274 2c20 722e 656e 642c 2070  .start, r.end, p
-000815d0: 7265 765f 706f 7329 2029 0a20 2020 2020  rev_pos) ).     
-000815e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000815f0: 5f6f 7267 203d 2073 6571 5f6f 7267 5b28  _org = seq_org[(
-00081600: 722e 7374 6172 742d 3129 3a28 722e 656e  r.start-1):(r.en
-00081610: 6429 5d0a 2020 2020 2020 2020 2020 2020  d)].            
-00081620: 2020 2020 2020 2020 722e 636f 6d70 6172          r.compar
-00081630: 655f 616e 645f 7265 706c 6163 655f 4e28  e_and_replace_N(
-00081640: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
-00081650: 2020 2020 2020 2020 2020 2073 7020 3d20             sp = 
-00081660: 2870 7265 765f 706f 732d 722e 7374 6172  (prev_pos-r.star
-00081670: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00081680: 2020 2020 2020 2073 6571 5f6c 7374 2e61         seq_lst.a
-00081690: 7070 656e 6428 722e 7365 715b 7370 3a5d  ppend(r.seq[sp:]
-000816a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-000816b0: 2020 2020 2020 206f 662e 6164 6428 206f         of.add( o
-000816c0: 735f 6375 722c 2070 7265 765f 706f 732c  s_cur, prev_pos,
-000816d0: 2072 2e65 6e64 2b31 2029 0a20 2020 2020   r.end+1 ).     
-000816e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000816f0: 7265 765f 706f 7320 3d20 722e 656e 642b  rev_pos = r.end+
-00081700: 310a 0a20 2020 2020 2020 2020 2020 2065  1..            e
-00081710: 6c73 653a 2020 2020 2020 2020 2020 2020  lse:            
-00081720: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00081730: 2020 2020 735f 6f72 6720 3d20 7365 715f      s_org = seq_
-00081740: 6f72 675b 2872 2e73 7461 7274 2d31 293a  org[(r.start-1):
-00081750: 2872 2e65 6e64 295d 0a20 2020 2020 2020  (r.end)].       
-00081760: 2020 2020 2020 2020 2023 6966 206c 656e           #if len
-00081770: 2873 5f6f 7267 2920 3d3d 206c 656e 2872  (s_org) == len(r
-00081780: 2e73 6571 293a 0a20 2020 2020 2020 2020  .seq):.         
-00081790: 2020 2020 2020 2072 2e63 6f6d 7061 7265         r.compare
-000817a0: 5f61 6e64 5f72 6570 6c61 6365 5f4e 2873  _and_replace_N(s
-000817b0: 5f6f 7267 290a 2020 2020 2020 2020 2020  _org).          
-000817c0: 2020 2020 2020 2320 656c 7365 3a20 2070        # else:  p
-000817d0: 7269 6e74 2820 2757 4152 4e49 4e47 3a20  rint( 'WARNING: 
-000817e0: 2569 2d25 6920 696e 2025 6920 7e3d 2025  %i-%i in %i ~= %
-000817f0: 6927 2025 2028 722e 7374 6172 742c 2072  i' % (r.start, r
-00081800: 2e65 6e64 2c20 6c65 6e28 735f 6f72 6729  .end, len(s_org)
-00081810: 2c20 6c65 6e28 722e 7365 7129 2920 290a  , len(r.seq)) ).
-00081820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081830: 2069 6620 722e 7374 6172 7420 3e20 7072   if r.start > pr
-00081840: 6576 5f70 6f73 3a0a 2020 2020 2020 2020  ev_pos:.        
-00081850: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
-00081860: 6c73 742e 6170 7065 6e64 2873 6571 5f6f  lst.append(seq_o
-00081870: 7267 5b28 7072 6576 5f70 6f73 2d31 293a  rg[(prev_pos-1):
-00081880: 2872 2e73 7461 7274 2d31 295d 290a 2020  (r.start-1)]).  
-00081890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000818a0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-000818b0: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
-000818c0: 6428 722e 7365 7129 0a20 2020 2020 2020  d(r.seq).       
-000818d0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-000818e0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-000818f0: 2e61 6464 2820 6f73 5f63 7572 2c20 7072  .add( os_cur, pr
-00081900: 6576 5f70 6f73 2c20 722e 656e 642b 3120  ev_pos, r.end+1 
-00081910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081920: 2020 7072 6576 5f70 6f73 203d 2072 2e65    prev_pos = r.e
-00081930: 6e64 2b31 0a20 2020 2020 2020 2020 2020  nd+1.           
-00081940: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00081950: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00081960: 2872 2e73 6571 2920 213d 206c 656e 2873  (r.seq) != len(s
-00081970: 5f6f 7267 293a 0a20 2020 2020 2020 2020  _org):.         
-00081980: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-00081990: 6e74 2820 2757 4152 4e49 4e47 3a20 2573  nt( 'WARNING: %s
-000819a0: 3a20 2569 2d25 6920 696e 2025 6920 7e3d  : %i-%i in %i ~=
-000819b0: 2025 6927 2025 2028 722e 6368 722c 2072   %i' % (r.chr, r
-000819c0: 2e73 7461 7274 2c20 722e 656e 642c 206c  .start, r.end, l
-000819d0: 656e 2873 5f6f 7267 292c 206c 656e 2872  en(s_org), len(r
-000819e0: 2e73 6571 2929 2029 0a20 2020 2020 2020  .seq)) ).       
-000819f0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00081a00: 6571 5f6c 7374 2e61 7070 656e 6428 735f  eq_lst.append(s_
-00081a10: 6f72 6729 0a20 2020 2020 2020 2020 2020  org).           
-00081a20: 2020 2020 2020 2020 2023 2072 2e73 6571           # r.seq
-00081a30: 203d 2072 6567 696f 6e28 722e 6368 722c   = region(r.chr,
-00081a40: 2072 2e73 7461 7274 2c20 722e 656e 642c   r.start, r.end,
-00081a50: 2072 2e74 7970 652c 2073 5f6f 7267 2c20   r.type, s_org, 
-00081a60: 6376 675f 6465 7020 3d20 4356 475f 4445  cvg_dep = CVG_DE
-00081a70: 5054 485f 544d 5020 290a 2020 2020 2020  PTH_TMP ).      
-00081a80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00081a90: 722e 6765 745f 6376 6728 290a 2020 2020  r.get_cvg().    
-00081aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081ab0: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00081ac0: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
-00081ad0: 2020 2065 6c69 6620 2872 2e74 7970 6520     elif (r.type 
-00081ae0: 3d3d 2027 696e 7365 7273 696f 6e27 2920  == 'insersion') 
-00081af0: 7c20 2872 2e74 7970 6520 3d3d 2027 4927  | (r.type == 'I'
-00081b00: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00081b10: 6966 2028 722e 7374 6172 7429 203c 2028  if (r.start) < (
-00081b20: 7072 6576 5f70 6f73 293a 0a20 2020 2020  prev_pos):.     
-00081b30: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-00081b40: 6e74 2827 5741 524e 494e 4720 2849 293a  nt('WARNING (I):
-00081b50: 2025 6920 2d20 2573 2c20 2569 203c 2025   %i - %s, %i < %
-00081b60: 6927 2025 2028 6d2c 2072 2e63 6872 2c20  i' % (m, r.chr, 
-00081b70: 722e 7374 6172 742c 2070 7265 765f 706f  r.start, prev_po
-00081b80: 7329 2029 0a20 2020 2020 2020 2020 2020  s) ).           
-00081b90: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00081ba0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00081bb0: 2020 2020 2020 2020 2020 2020 6f66 2e61              of.a
-00081bc0: 6464 2820 6f73 5f63 7572 2c20 7072 6576  dd( os_cur, prev
-00081bd0: 5f70 6f73 2c20 722e 7374 6172 7420 290a  _pos, r.start ).
-00081be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081bf0: 6f73 5f63 7572 202b 3d20 2872 2e65 6e64  os_cur += (r.end
-00081c00: 202d 2072 2e73 7461 7274 202b 2031 290a   - r.start + 1).
-00081c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081c20: 2069 6620 722e 7374 6172 7420 3e20 7072   if r.start > pr
-00081c30: 6576 5f70 6f73 3a0a 2020 2020 2020 2020  ev_pos:.        
-00081c40: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
-00081c50: 6c73 742e 6170 7065 6e64 2873 6571 5f6f  lst.append(seq_o
-00081c60: 7267 5b28 7072 6576 5f70 6f73 2d31 293a  rg[(prev_pos-1):
-00081c70: 2872 2e73 7461 7274 2d31 295d 290a 2020  (r.start-1)]).  
-00081c80: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00081c90: 715f 6c73 742e 6170 7065 6e64 2872 2e73  q_lst.append(r.s
-00081ca0: 6571 290a 0a20 2020 2020 2020 2020 2020  eq)..           
-00081cb0: 2020 2020 2070 7265 765f 706f 7320 3d20       prev_pos = 
-00081cc0: 722e 7374 6172 740a 0a20 2020 2020 2020  r.start..       
-00081cd0: 2065 6c69 6620 2872 2e74 7970 6520 3d3d   elif (r.type ==
-00081ce0: 2027 6465 6c65 7469 6f6e 2729 207c 2028   'deletion') | (
-00081cf0: 722e 7479 7065 203d 3d20 2744 2720 293a  r.type == 'D' ):
-00081d00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00081d10: 2872 2e73 7461 7274 2920 3c20 2870 7265  (r.start) < (pre
-00081d20: 765f 706f 7329 3a0a 2020 2020 2020 2020  v_pos):.        
-00081d30: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-00081d40: 2757 4152 4e49 4e47 2028 4429 3a20 2569  'WARNING (D): %i
-00081d50: 202d 2025 732c 2025 6920 3c3d 2025 6927   - %s, %i <= %i'
-00081d60: 2025 2028 6d2c 2072 2e63 6872 2c20 722e   % (m, r.chr, r.
-00081d70: 7374 6172 742c 2070 7265 765f 706f 7329  start, prev_pos)
-00081d80: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00081d90: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00081da0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00081db0: 2020 2020 2020 2020 2020 6f66 2e61 6464            of.add
-00081dc0: 2820 6f73 5f63 7572 2c20 7072 6576 5f70  ( os_cur, prev_p
-00081dd0: 6f73 2c20 722e 7374 6172 7420 290a 2020  os, r.start ).  
-00081de0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-00081df0: 5f63 7572 202d 3d20 2872 2e65 6e64 202d  _cur -= (r.end -
-00081e00: 2072 2e73 7461 7274 202b 2031 290a 2020   r.start + 1).  
-00081e10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00081e20: 6576 5f70 6f73 203d 2072 2e73 7461 7274  ev_pos = r.start
-00081e30: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00081e40: 2020 6f66 2e61 6464 2820 6f73 5f63 7572    of.add( os_cur
-00081e50: 2c20 7072 6576 5f70 6f73 2c20 722e 656e  , prev_pos, r.en
-00081e60: 642b 3120 290a 2020 2020 2020 2020 2020  d+1 ).          
-00081e70: 2020 2020 2020 7072 6576 5f70 6f73 203d        prev_pos =
-00081e80: 2072 2e65 6e64 2b31 0a0a 2020 2020 2020   r.end+1..      
-00081e90: 2020 6c61 7374 5f70 6f73 203d 2072 2e65    last_pos = r.e
-00081ea0: 6e64 0a0a 2020 2020 7365 715f 6c73 742e  nd..    seq_lst.
-00081eb0: 6170 7065 6e64 2873 6571 5f6f 7267 5b28  append(seq_org[(
-00081ec0: 7072 6576 5f70 6f73 2d31 293a 5d29 0a20  prev_pos-1):]). 
-00081ed0: 2020 2073 6571 5f6e 6577 203d 2027 272e     seq_new = ''.
-00081ee0: 6a6f 696e 2873 6571 5f6c 7374 290a 0a20  join(seq_lst).. 
-00081ef0: 2020 2023 2069 6620 6c61 7374 5f70 6f73     # if last_pos
-00081f00: 203e 2070 7265 765f 706f 733a 0a20 2020   > prev_pos:.   
-00081f10: 206f 662e 6164 6428 206f 735f 6375 722c   of.add( os_cur,
-00081f20: 2070 7265 765f 706f 732c 206c 656e 2873   prev_pos, len(s
-00081f30: 6571 5f6f 7267 2920 2b20 3130 3030 3030  eq_org) + 100000
-00081f40: 2029 0a0a 2020 2020 656c 6170 7365 645f   )..    elapsed_
-00081f50: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-00081f60: 2829 202d 2073 7461 7274 5f74 696d 650a  () - start_time.
-00081f70: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
-00081f80: 322e 2064 6f6e 6520 2825 6929 2020 2720  2. done (%i)  ' 
-00081f90: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
-00081fa0: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-00081fb0: 2020 2020 2327 2727 0a0a 2020 2020 2323      #'''..    ##
-00081fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081fe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081ff0: 2323 2323 2323 0a20 2020 2023 2320 5573  ######.    ## Us
-00082000: 6520 6f66 6673 6574 5f66 696e 6465 7220  e offset_finder 
-00082010: 746f 2063 6f72 7265 6374 2070 6f73 6974  to correct posit
-00082020: 696f 6e73 2069 6e20 4754 4620 656e 7472  ions in GTF entr
-00082030: 6965 730a 2020 2020 2323 2061 6c73 6f20  ies.    ## also 
-00082040: 6765 7420 7267 6e73 2066 7261 676d 656e  get rgns fragmen
-00082050: 7473 2077 6865 6e20 7370 6c69 7420 6973  ts when split is
-00082060: 2072 6571 7569 7265 640a 0a20 2020 206f   required..    o
-00082070: 662e 6d61 6b65 5f69 745f 636f 6d70 6163  f.make_it_compac
-00082080: 7428 290a 2020 2020 0a20 2020 2073 7461  t().    .    sta
-00082090: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
-000820a0: 696d 6528 290a 2020 2020 725f 746f 5f61  ime().    r_to_a
-000820b0: 6464 203d 205b 5d0a 2020 2020 706f 735f  dd = [].    pos_
-000820c0: 746f 5f61 6464 203d 205b 5d0a 2020 2020  to_add = [].    
-000820d0: 736e 765f 696e 666f 5f63 6872 203d 205b  snv_info_chr = [
-000820e0: 5d0a 0a20 2020 2066 6f72 2067 6420 696e  ]..    for gd in
-000820f0: 2067 645f 7365 6c3a 0a20 2020 2020 2020   gd_sel:.       
-00082100: 2067 642e 6e76 5f69 6e66 6f5f 6c73 7420   gd.nv_info_lst 
-00082110: 3d20 5b5d 0a0a 2020 2020 7072 6576 5f6f  = []..    prev_o
-00082120: 6669 203d 2030 0a20 2020 2076 5f63 6e74  fi = 0.    v_cnt
-00082130: 203d 2030 0a20 2020 2023 666f 7220 6b2c   = 0.    #for k,
-00082140: 2072 2069 6e20 656e 756d 6572 6174 6528   r in enumerate(
-00082150: 7261 6c6c 2e72 676e 7329 3a0a 2020 2020  rall.rgns):.    
-00082160: 666f 7220 6d2c 206b 2069 6e20 656e 756d  for m, k in enum
-00082170: 6572 6174 6528 6f64 7229 3a0a 2020 2020  erate(odr):.    
-00082180: 2020 2020 7220 3d20 7261 6c6c 2e72 676e      r = rall.rgn
-00082190: 735b 6b5d 0a20 2020 2020 2020 2067 696e  s[k].        gin
-000821a0: 203d 2047 656e 655f 6964 5f6e 616d 655b   = Gene_id_name[
-000821b0: 6b5d 0a20 2020 2020 2020 200a 2020 2020  k].        .    
-000821c0: 2020 2020 6f73 732c 2070 7265 765f 6f66      oss, prev_of
-000821d0: 3120 3d20 6f66 2e66 696e 645f 6f73 5f73  1 = of.find_os_s
-000821e0: 6571 2872 2e73 7461 7274 2c20 7072 6576  eq(r.start, prev
-000821f0: 5f6f 6669 290a 2020 2020 2020 2020 2320  _ofi).        # 
-00082200: 6f73 6520 3d20 6f73 730a 2020 2020 2020  ose = oss.      
-00082210: 2020 6f73 652c 2070 7265 765f 6f66 3220    ose, prev_of2 
-00082220: 3d20 6f66 2e66 696e 645f 6f73 5f73 6571  = of.find_os_seq
-00082230: 2872 2e65 6e64 2c20 7072 6576 5f6f 6669  (r.end, prev_ofi
-00082240: 290a 200a 2020 2020 2020 2020 722e 6765  ). .        r.ge
-00082250: 745f 6376 6728 290a 2020 2020 2020 2020  t_cvg().        
-00082260: 2320 6966 2072 2e63 7667 2069 7320 4e6f  # if r.cvg is No
-00082270: 6e65 3a20 722e 6376 6720 3d20 6e70 2e6f  ne: r.cvg = np.o
-00082280: 6e65 7328 6c65 6e28 722e 7365 7129 290a  nes(len(r.seq)).
-00082290: 0a20 2020 2020 2020 2069 6620 722e 7479  .        if r.ty
-000822a0: 7065 203d 3d20 2765 786f 6e27 3a0a 2020  pe == 'exon':.  
-000822b0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-000822c0: 2020 2020 2020 2069 6620 286f 7373 203d         if (oss =
-000822d0: 3d20 6f73 6529 3a0a 0a20 2020 2020 2020  = ose):..       
-000822e0: 2020 2020 2020 2020 2023 2073 695f 6c73           # si_ls
-000822f0: 7420 3d20 6669 6e64 5f73 6e70 2873 6571  t = find_snp(seq
-00082300: 5f6f 7267 5b28 722e 7374 6172 742d 3129  _org[(r.start-1)
-00082310: 3a72 2e65 6e64 5d2c 2072 2e73 6571 2c20  :r.end], r.seq, 
-00082320: 722e 6765 745f 6376 6728 292c 2063 6872  r.get_cvg(), chr
-00082330: 6d2c 2072 2e73 7461 7274 2c20 6f73 7329  m, r.start, oss)
-00082340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082350: 2073 695f 6c73 7420 3d20 6669 6e64 5f73   si_lst = find_s
-00082360: 6e70 2873 6571 5f6f 7267 5b28 722e 7374  np(seq_org[(r.st
-00082370: 6172 742d 3129 3a72 2e65 6e64 5d2c 2072  art-1):r.end], r
-00082380: 2e73 6571 2c20 722e 636d 6174 2c20 6368  .seq, r.cmat, ch
-00082390: 726d 2c20 722e 7374 6172 742c 206f 7373  rm, r.start, oss
-000823a0: 2c20 6769 6e29 0a20 2020 2020 2020 2020  , gin).         
-000823b0: 2020 2020 2020 2073 6e76 5f69 6e66 6f5f         snv_info_
-000823c0: 6368 7220 3d20 736e 765f 696e 666f 5f63  chr = snv_info_c
-000823d0: 6872 202b 2073 695f 6c73 740a 2020 2020  hr + si_lst.    
-000823e0: 2020 2020 2020 2020 2020 2020 6764 5f69              gd_i
-000823f0: 6478 203d 2067 645f 6964 785f 6f66 5f72  dx = gd_idx_of_r
-00082400: 676e 5b6b 5d0a 2020 2020 2020 2020 2020  gn[k].          
-00082410: 2020 2020 2020 6764 5f73 656c 5b67 645f        gd_sel[gd_
-00082420: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
-00082430: 203d 2067 645f 7365 6c5b 6764 5f69 6478   = gd_sel[gd_idx
-00082440: 5d2e 6e76 5f69 6e66 6f5f 6c73 7420 2b20  ].nv_info_lst + 
-00082450: 7369 5f6c 7374 0a0a 2020 2020 2020 2020  si_lst..        
-00082460: 2020 2020 2020 2020 722e 7374 6172 7420          r.start 
-00082470: 2b3d 206f 7373 0a20 2020 2020 2020 2020  += oss.         
-00082480: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
-00082490: 6f73 650a 2020 2020 2020 2020 2020 2020  ose.            
-000824a0: 2020 2020 7261 6c6c 2e72 676e 735b 6b5d      rall.rgns[k]
-000824b0: 203d 2072 2023 202e 636f 7079 2829 0a0a   = r # .copy()..
-000824c0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000824d0: 6620 286f 7373 203c 206f 7365 293a 2023  f (oss < ose): #
-000824e0: 2049 6e73 6572 7369 6f6e 2069 6e20 6265   Insersion in be
-000824f0: 7477 6565 6e0a 0a20 2020 2020 2020 2020  tween..         
-00082500: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-00082510: 2025 6920 6f73 7320 3c20 6f73 6527 2025   %i oss < ose' %
-00082520: 206b 290a 2020 2020 2020 2020 2020 2020   k).            
-00082530: 2020 2020 2320 722e 7072 696e 745f 7368      # r.print_sh
-00082540: 6f72 7428 290a 2020 2020 2020 2020 2020  ort().          
-00082550: 2020 2020 2020 702c 2070 7265 765f 6f66        p, prev_of
-00082560: 3220 3d20 6f66 2e67 6574 5f62 6e64 7279  2 = of.get_bndry
-00082570: 5f73 6571 286f 7365 2c20 7072 6576 5f6f  _seq(ose, prev_o
-00082580: 6669 290a 0a20 2020 2020 2020 2020 2020  fi)..           
-00082590: 2020 2020 2023 2320 7370 6c69 740a 2020       ## split.  
-000825a0: 2020 2020 2020 2020 2020 2020 2020 4c72                Lr
-000825b0: 203d 2072 2e65 6e64 202d 2072 2e73 7461   = r.end - r.sta
-000825c0: 7274 202b 310a 2020 2020 2020 2020 2020  rt +1.          
-000825d0: 2020 2020 2020 4c6e 203d 2072 2e65 6e64        Ln = r.end
-000825e0: 202d 2070 202b 2031 0a20 2020 2020 2020   - p + 1.       
-000825f0: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
-00082600: 203d 2072 6567 696f 6e28 2072 2e63 6872   = region( r.chr
-00082610: 2c20 702b 6f73 652c 2072 2e65 6e64 2b6f  , p+ose, r.end+o
-00082620: 7365 2c20 722e 7479 7065 2c20 722e 636d  se, r.type, r.cm
-00082630: 6174 5b3a 2c2d 4c6e 3a5d 2c20 7873 203d  at[:,-Ln:], xs =
-00082640: 2072 2e78 7329 0a20 2020 2020 2020 2020   r.xs).         
-00082650: 2020 2020 2020 2072 676e 5f6e 6577 2e67         rgn_new.g
-00082660: 6574 5f63 7667 2829 0a20 2020 2020 2020  et_cvg().       
-00082670: 2020 2020 2020 2020 2072 5f74 6f5f 6164           r_to_ad
-00082680: 642e 6170 7065 6e64 2872 676e 5f6e 6577  d.append(rgn_new
-00082690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000826a0: 2020 706f 735f 746f 5f61 6464 2e61 7070    pos_to_add.app
-000826b0: 656e 6428 6b2b 3129 0a0a 2020 2020 2020  end(k+1)..      
-000826c0: 2020 2020 2020 2020 2020 2320 7369 5f6c            # si_l
-000826d0: 7374 203d 2066 696e 645f 736e 7028 7365  st = find_snp(se
-000826e0: 715f 6f72 675b 2870 2d31 293a 722e 656e  q_org[(p-1):r.en
-000826f0: 645d 2c20 7267 6e5f 6e65 772e 7365 712c  d], rgn_new.seq,
-00082700: 2072 676e 5f6e 6577 2e67 6574 5f63 7667   rgn_new.get_cvg
-00082710: 2829 2c20 6368 726d 2c20 702c 206f 7365  (), chrm, p, ose
-00082720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00082730: 2020 7369 5f6c 7374 203d 2066 696e 645f    si_lst = find_
-00082740: 736e 7028 7365 715f 6f72 675b 2870 2d31  snp(seq_org[(p-1
-00082750: 293a 722e 656e 645d 2c20 7267 6e5f 6e65  ):r.end], rgn_ne
-00082760: 772e 7365 712c 2072 676e 5f6e 6577 2e63  w.seq, rgn_new.c
-00082770: 6d61 742c 2063 6872 6d2c 2070 2c20 6f73  mat, chrm, p, os
-00082780: 652c 2067 696e 290a 2020 2020 2020 2020  e, gin).        
-00082790: 2020 2020 2020 2020 736e 765f 696e 666f          snv_info
-000827a0: 5f63 6872 203d 2073 6e76 5f69 6e66 6f5f  _chr = snv_info_
-000827b0: 6368 7220 2b20 7369 5f6c 7374 0a20 2020  chr + si_lst.   
-000827c0: 2020 2020 2020 2020 2020 2020 2067 645f               gd_
-000827d0: 6964 7820 3d20 6764 5f69 6478 5f6f 665f  idx = gd_idx_of_
-000827e0: 7267 6e5b 6b5d 0a20 2020 2020 2020 2020  rgn[k].         
-000827f0: 2020 2020 2020 2067 645f 7365 6c5b 6764         gd_sel[gd
-00082800: 5f69 6478 5d2e 6e76 5f69 6e66 6f5f 6c73  _idx].nv_info_ls
-00082810: 7420 3d20 6764 5f73 656c 5b67 645f 6964  t = gd_sel[gd_id
-00082820: 785d 2e6e 765f 696e 666f 5f6c 7374 202b  x].nv_info_lst +
-00082830: 2073 695f 6c73 740a 0a20 2020 2020 2020   si_lst..       
-00082840: 2020 2020 2020 2020 2072 2e65 6e64 203d           r.end =
-00082850: 2070 2d31 2b6f 7373 0a20 2020 2020 2020   p-1+oss.       
-00082860: 2020 2020 2020 2020 2072 2e73 7461 7274           r.start
-00082870: 202b 3d20 6f73 730a 2020 2020 2020 2020   += oss.        
-00082880: 2020 2020 2020 2020 4c6e 203d 2072 2e65          Ln = r.e
-00082890: 6e64 202d 2072 2e73 7461 7274 202b 310a  nd - r.start +1.
-000828a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000828b0: 722e 636d 6174 203d 2072 2e63 6d61 745b  r.cmat = r.cmat[
-000828c0: 3a2c 3a4c 6e5d 0a20 2020 2020 2020 2020  :,:Ln].         
-000828d0: 2020 2020 2020 2072 2e73 6571 203d 2072         r.seq = r
-000828e0: 2e73 6571 5b3a 4c6e 5d0a 2020 2020 2020  .seq[:Ln].      
-000828f0: 2020 2020 2020 2020 2020 722e 6376 6720            r.cvg 
-00082900: 3d20 722e 6376 675b 3a4c 6e5d 0a20 2020  = r.cvg[:Ln].   
-00082910: 2020 2020 2020 2020 2020 2020 2023 2072               # r
-00082920: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
-00082930: 2020 2020 2020 2020 2020 2072 616c 6c2e             rall.
-00082940: 7267 6e73 5b6b 5d20 3d20 7220 2320 2e63  rgns[k] = r # .c
-00082950: 6f70 7928 290a 0a20 2020 2020 2020 2020  opy()..         
-00082960: 2020 2020 2020 2023 2073 695f 6c73 7420         # si_lst 
-00082970: 3d20 6669 6e64 5f73 6e70 2873 6571 5f6f  = find_snp(seq_o
-00082980: 7267 5b28 722e 7374 6172 742d 6f73 732d  rg[(r.start-oss-
-00082990: 3129 3a70 5d2c 2072 2e73 6571 2c20 722e  1):p], r.seq, r.
-000829a0: 6765 745f 6376 6728 292c 2063 6872 6d2c  get_cvg(), chrm,
-000829b0: 2072 2e73 7461 7274 2d6f 7373 2c20 6f73   r.start-oss, os
-000829c0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-000829d0: 2020 2073 695f 6c73 7420 3d20 6669 6e64     si_lst = find
-000829e0: 5f73 6e70 2873 6571 5f6f 7267 5b28 722e  _snp(seq_org[(r.
-000829f0: 7374 6172 742d 6f73 732d 3129 3a70 5d2c  start-oss-1):p],
-00082a00: 2072 2e73 6571 2c20 722e 636d 6174 2c20   r.seq, r.cmat, 
-00082a10: 6368 726d 2c20 722e 7374 6172 742d 6f73  chrm, r.start-os
-00082a20: 732c 206f 7373 2c20 6769 6e29 0a20 2020  s, oss, gin).   
-00082a30: 2020 2020 2020 2020 2020 2020 2073 6e76               snv
-00082a40: 5f69 6e66 6f5f 6368 7220 3d20 736e 765f  _info_chr = snv_
-00082a50: 696e 666f 5f63 6872 202b 2073 695f 6c73  info_chr + si_ls
-00082a60: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00082a70: 2020 6764 5f69 6478 203d 2067 645f 6964    gd_idx = gd_id
-00082a80: 785f 6f66 5f72 676e 5b6b 5d0a 2020 2020  x_of_rgn[k].    
-00082a90: 2020 2020 2020 2020 2020 2020 6764 5f73              gd_s
-00082aa0: 656c 5b67 645f 6964 785d 2e6e 765f 696e  el[gd_idx].nv_in
-00082ab0: 666f 5f6c 7374 203d 2067 645f 7365 6c5b  fo_lst = gd_sel[
-00082ac0: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
-00082ad0: 6c73 7420 2b20 7369 5f6c 7374 0a0a 2020  lst + si_lst..  
-00082ae0: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
-00082af0: 6f73 7320 3e20 6f73 6529 3a20 2320 6465  oss > ose): # de
-00082b00: 6c65 7469 6f6e 2069 6e20 6265 7477 6565  letion in betwee
-00082b10: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
-00082b20: 2020 2070 7269 6e74 2827 2020 2025 6920     print('   %i 
-00082b30: 6f73 7320 3e20 6f73 6527 2025 206b 290a  oss > ose' % k).
-00082b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082b50: 2320 722e 7072 696e 745f 7368 6f72 7428  # r.print_short(
-00082b60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00082b70: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
-00082b80: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
-00082b90: 286f 7365 2c20 7072 6576 5f6f 6669 290a  (ose, prev_ofi).
-00082ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082bb0: 4c64 203d 206f 7373 202d 206f 7365 0a0a  Ld = oss - ose..
-00082bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082bd0: 2323 2073 706c 6974 2028 666f 7220 4344  ## split (for CD
-00082be0: 5320 6f6e 6c79 290a 2020 2020 2020 2020  S only).        
-00082bf0: 2020 2020 2020 2020 4c72 203d 2072 2e65          Lr = r.e
-00082c00: 6e64 202d 2072 2e73 7461 7274 202b 310a  nd - r.start +1.
-00082c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082c20: 4c6e 203d 2072 2e65 6e64 202d 2070 202b  Ln = r.end - p +
-00082c30: 2031 202d 204c 640a 2020 2020 2020 2020   1 - Ld.        
-00082c40: 2020 2020 2020 2020 7267 6e5f 6e65 7720          rgn_new 
-00082c50: 3d20 7265 6769 6f6e 2820 722e 6368 722c  = region( r.chr,
-00082c60: 2070 2b4c 642b 6f73 652c 2072 2e65 6e64   p+Ld+ose, r.end
-00082c70: 2b6f 7365 2c20 722e 7479 7065 2c20 722e  +ose, r.type, r.
-00082c80: 636d 6174 5b3a 2c2d 4c6e 3a5d 2c20 7873  cmat[:,-Ln:], xs
-00082c90: 203d 2072 2e78 7329 0a20 2020 2020 2020   = r.xs).       
-00082ca0: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
-00082cb0: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
-00082cc0: 2020 2020 2020 2020 2020 2072 5f74 6f5f             r_to_
-00082cd0: 6164 642e 6170 7065 6e64 2872 676e 5f6e  add.append(rgn_n
-00082ce0: 6577 290a 2020 2020 2020 2020 2020 2020  ew).            
-00082cf0: 2020 2020 706f 735f 746f 5f61 6464 2e61      pos_to_add.a
-00082d00: 7070 656e 6428 6b2b 3129 0a0a 2020 2020  ppend(k+1)..    
-00082d10: 2020 2020 2020 2020 2020 2020 2320 7369              # si
-00082d20: 5f6c 7374 203d 2066 696e 645f 736e 7028  _lst = find_snp(
-00082d30: 7365 715f 6e65 775b 2872 676e 5f6e 6577  seq_new[(rgn_new
-00082d40: 2e73 7461 7274 2d31 293a 7267 6e5f 6e65  .start-1):rgn_ne
-00082d50: 772e 656e 645d 2c20 7267 6e5f 6e65 772e  w.end], rgn_new.
-00082d60: 7365 712c 2072 676e 5f6e 6577 2e67 6574  seq, rgn_new.get
-00082d70: 5f63 7667 2829 2c20 6368 726d 2c20 702c  _cvg(), chrm, p,
-00082d80: 206f 7365 290a 2020 2020 2020 2020 2020   ose).          
-00082d90: 2020 2020 2020 7369 5f6c 7374 203d 2066        si_lst = f
-00082da0: 696e 645f 736e 7028 7365 715f 6e65 775b  ind_snp(seq_new[
-00082db0: 2872 676e 5f6e 6577 2e73 7461 7274 2d31  (rgn_new.start-1
-00082dc0: 293a 7267 6e5f 6e65 772e 656e 645d 2c20  ):rgn_new.end], 
-00082dd0: 7267 6e5f 6e65 772e 7365 712c 2072 676e  rgn_new.seq, rgn
-00082de0: 5f6e 6577 2e63 6d61 742c 2063 6872 6d2c  _new.cmat, chrm,
-00082df0: 2070 2c20 6f73 652c 2067 696e 290a 2020   p, ose, gin).  
-00082e00: 2020 2020 2020 2020 2020 2020 2020 736e                sn
-00082e10: 765f 696e 666f 5f63 6872 203d 2073 6e76  v_info_chr = snv
-00082e20: 5f69 6e66 6f5f 6368 7220 2b20 7369 5f6c  _info_chr + si_l
-00082e30: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
-00082e40: 2020 2067 645f 6964 7820 3d20 6764 5f69     gd_idx = gd_i
-00082e50: 6478 5f6f 665f 7267 6e5b 6b5d 0a20 2020  dx_of_rgn[k].   
-00082e60: 2020 2020 2020 2020 2020 2020 2067 645f               gd_
-00082e70: 7365 6c5b 6764 5f69 6478 5d2e 6e76 5f69  sel[gd_idx].nv_i
-00082e80: 6e66 6f5f 6c73 7420 3d20 6764 5f73 656c  nfo_lst = gd_sel
-00082e90: 5b67 645f 6964 785d 2e6e 765f 696e 666f  [gd_idx].nv_info
-00082ea0: 5f6c 7374 202b 2073 695f 6c73 740a 0a20  _lst + si_lst.. 
-00082eb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00082ec0: 2e65 6e64 203d 2070 2d31 2b6f 7373 0a20  .end = p-1+oss. 
-00082ed0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00082ee0: 2e73 7461 7274 202b 3d20 6f73 730a 2020  .start += oss.  
-00082ef0: 2020 2020 2020 2020 2020 2020 2020 4c6e                Ln
-00082f00: 203d 2072 2e65 6e64 202d 2072 2e73 7461   = r.end - r.sta
-00082f10: 7274 202b 310a 2020 2020 2020 2020 2020  rt +1.          
-00082f20: 2020 2020 2020 722e 636d 6174 203d 2072        r.cmat = r
-00082f30: 2e63 6d61 745b 3a2c 3a4c 6e5d 0a20 2020  .cmat[:,:Ln].   
-00082f40: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
-00082f50: 6571 203d 2072 2e73 6571 5b3a 4c6e 5d0a  eq = r.seq[:Ln].
-00082f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082f70: 722e 6376 6720 3d20 722e 6376 675b 3a4c  r.cvg = r.cvg[:L
-00082f80: 6e5d 0a20 2020 2020 2020 2020 2020 2020  n].             
-00082f90: 2020 2023 2072 2e67 6574 5f63 7667 2829     # r.get_cvg()
-00082fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082fb0: 2072 616c 6c2e 7267 6e73 5b6b 5d20 3d20   rall.rgns[k] = 
-00082fc0: 7220 2320 2e63 6f70 7928 290a 0a20 2020  r # .copy()..   
-00082fd0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00082fe0: 695f 6c73 7420 3d20 6669 6e64 5f73 6e70  i_lst = find_snp
-00082ff0: 2873 6571 5f6f 7267 5b28 722e 7374 6172  (seq_org[(r.star
-00083000: 742d 6f73 732d 3129 3a70 5d2c 2072 2e73  t-oss-1):p], r.s
-00083010: 6571 2c20 722e 6765 745f 6376 6728 292c  eq, r.get_cvg(),
-00083020: 2063 6872 6d2c 2072 2e73 7461 7274 2d6f   chrm, r.start-o
-00083030: 7373 2c20 6f73 7329 0a20 2020 2020 2020  ss, oss).       
-00083040: 2020 2020 2020 2020 2073 695f 6c73 7420           si_lst 
-00083050: 3d20 6669 6e64 5f73 6e70 2873 6571 5f6f  = find_snp(seq_o
-00083060: 7267 5b28 722e 7374 6172 742d 6f73 732d  rg[(r.start-oss-
-00083070: 3129 3a70 5d2c 2072 2e73 6571 2c20 722e  1):p], r.seq, r.
-00083080: 636d 6174 2c20 6368 726d 2c20 722e 7374  cmat, chrm, r.st
-00083090: 6172 742d 6f73 732c 206f 7373 2c20 6769  art-oss, oss, gi
-000830a0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
-000830b0: 2020 2073 6e76 5f69 6e66 6f5f 6368 7220     snv_info_chr 
-000830c0: 3d20 736e 765f 696e 666f 5f63 6872 202b  = snv_info_chr +
-000830d0: 2073 695f 6c73 740a 2020 2020 2020 2020   si_lst.        
-000830e0: 2020 2020 2020 2020 6764 5f69 6478 203d          gd_idx =
-000830f0: 2067 645f 6964 785f 6f66 5f72 676e 5b6b   gd_idx_of_rgn[k
-00083100: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00083110: 2020 6764 5f73 656c 5b67 645f 6964 785d    gd_sel[gd_idx]
-00083120: 2e6e 765f 696e 666f 5f6c 7374 203d 2067  .nv_info_lst = g
-00083130: 645f 7365 6c5b 6764 5f69 6478 5d2e 6e76  d_sel[gd_idx].nv
-00083140: 5f69 6e66 6f5f 6c73 7420 2b20 7369 5f6c  _info_lst + si_l
-00083150: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
-00083160: 2020 200a 2020 2020 2020 2020 656c 6966     .        elif
-00083170: 2072 2e74 7970 6520 3d3d 2027 696e 7365   r.type == 'inse
-00083180: 7273 696f 6e27 3a0a 0a20 2020 2020 2020  rsion':..       
-00083190: 2020 2020 206f 7373 702c 2070 7265 765f       ossp, prev_
-000831a0: 6f66 3120 3d20 6f66 2e66 696e 645f 6f73  of1 = of.find_os
-000831b0: 5f73 6571 2872 2e73 7461 7274 2d31 2c20  _seq(r.start-1, 
-000831c0: 7072 6576 5f6f 6669 2c20 6d61 726b 203d  prev_ofi, mark =
-000831d0: 2027 4927 290a 0a20 2020 2020 2020 2020   'I')..         
-000831e0: 2020 2073 6f70 203d 2073 6571 5f6f 7267     sop = seq_org
-000831f0: 5b69 6e74 2872 2e73 7461 7274 2d28 4e57  [int(r.start-(NW
-00083200: 494e 2b31 2929 3a69 6e74 2872 2e73 7461  IN+1)):int(r.sta
-00083210: 7274 2d31 295d 0a20 2020 2020 2020 2020  rt-1)].         
-00083220: 2020 2073 6f63 203d 2027 2d27 0a20 2020     soc = '-'.   
-00083230: 2020 2020 2020 2020 2073 6f6e 203d 2073           son = s
-00083240: 6571 5f6f 7267 5b69 6e74 2872 2e73 7461  eq_org[int(r.sta
-00083250: 7274 2d31 293a 696e 7428 722e 7374 6172  rt-1):int(r.star
-00083260: 742b 284e 5749 4e2d 3129 295d 0a20 2020  t+(NWIN-1))].   
-00083270: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00083280: 2020 2020 2020 736e 7020 3d20 7365 715f        snp = seq_
-00083290: 6e65 775b 696e 7428 722e 7374 6172 742b  new[int(r.start+
-000832a0: 6f73 7370 2d28 4e57 494e 2b31 2929 3a69  ossp-(NWIN+1)):i
-000832b0: 6e74 2872 2e73 7461 7274 2b6f 7373 702d  nt(r.start+ossp-
-000832c0: 3129 5d0a 2020 2020 2020 2020 2020 2020  1)].            
-000832d0: 736e 6320 3d20 722e 7365 710a 2020 2020  snc = r.seq.    
-000832e0: 2020 2020 2020 2020 736e 6e20 3d20 7365          snn = se
-000832f0: 715f 6e65 775b 696e 7428 722e 7374 6172  q_new[int(r.star
-00083300: 742b 6f73 732d 3129 3a69 6e74 2872 2e73  t+oss-1):int(r.s
-00083310: 7461 7274 2b6f 7373 2b28 4e57 494e 2d31  tart+oss+(NWIN-1
-00083320: 2929 5d0a 2020 2020 2020 2020 2020 2020  ))].            
-00083330: 7369 203d 2053 4e56 5f69 6e66 6f28 6368  si = SNV_info(ch
-00083340: 726d 2c20 722e 7374 6172 742c 2072 2e73  rm, r.start, r.s
-00083350: 7461 7274 2b6f 7373 2c20 6769 6e5b 305d  tart+oss, gin[0]
-00083360: 2c20 6769 6e5b 315d 2c20 2749 272c 2072  , gin[1], 'I', r
-00083370: 2e67 6574 5f6c 656e 2829 2c20 696e 7428  .get_len(), int(
-00083380: 722e 6176 655f 6376 675f 6465 7074 6828  r.ave_cvg_depth(
-00083390: 2929 2c20 722e 6376 675f 6672 6163 2c20  )), r.cvg_frac, 
-000833a0: 736f 702c 2073 6f63 2c20 736f 6e2c 2073  sop, soc, son, s
-000833b0: 6e70 2c20 736e 632c 2073 6e6e 2029 0a20  np, snc, snn ). 
-000833c0: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
-000833d0: 6e66 6f5f 6368 722e 6170 7065 6e64 2873  nfo_chr.append(s
-000833e0: 6929 0a20 2020 2020 2020 2020 2020 2067  i).            g
-000833f0: 645f 6964 7820 3d20 6764 5f69 6478 5f6f  d_idx = gd_idx_o
-00083400: 665f 7267 6e5b 6b5d 0a20 2020 2020 2020  f_rgn[k].       
-00083410: 2020 2020 2067 645f 7365 6c5b 6764 5f69       gd_sel[gd_i
-00083420: 6478 5d2e 6e76 5f69 6e66 6f5f 6c73 742e  dx].nv_info_lst.
-00083430: 6170 7065 6e64 2873 6929 0a0a 2020 2020  append(si)..    
-00083440: 2020 2020 2020 2020 722e 7374 6172 7420          r.start 
-00083450: 2b3d 206f 7373 700a 2020 2020 2020 2020  += ossp.        
-00083460: 2020 2020 722e 656e 6420 2b3d 206f 7373      r.end += oss
-00083470: 7020 200a 2020 2020 2020 2020 2020 2020  p  .            
-00083480: 7261 6c6c 2e72 676e 735b 6b5d 203d 2072  rall.rgns[k] = r
-00083490: 2023 202e 636f 7079 2829 0a0a 2020 2020   # .copy()..    
-000834a0: 2020 2020 656c 6966 2072 2e74 7970 6520      elif r.type 
-000834b0: 3d3d 2027 6465 6c65 7469 6f6e 273a 0a0a  == 'deletion':..
-000834c0: 2020 2020 2020 2020 2020 2020 6f73 7370              ossp
-000834d0: 2c20 7072 6576 5f6f 6631 203d 206f 662e  , prev_of1 = of.
-000834e0: 6669 6e64 5f6f 735f 7365 7128 722e 7374  find_os_seq(r.st
-000834f0: 6172 742d 312c 2070 7265 765f 6f66 692c  art-1, prev_ofi,
-00083500: 206d 6172 6b20 3d20 2744 2729 0a0a 2020   mark = 'D')..  
-00083510: 2020 2020 2020 2020 2020 736f 7020 3d20            sop = 
-00083520: 7365 715f 6f72 675b 696e 7428 722e 7374  seq_org[int(r.st
-00083530: 6172 742d 284e 5749 4e2b 3129 293a 696e  art-(NWIN+1)):in
-00083540: 7428 722e 7374 6172 742d 3129 5d0a 2020  t(r.start-1)].  
-00083550: 2020 2020 2020 2020 2020 736f 6320 3d20            soc = 
-00083560: 7365 715f 6f72 675b 696e 7428 722e 7374  seq_org[int(r.st
-00083570: 6172 742d 3129 3a69 6e74 2872 2e65 6e64  art-1):int(r.end
-00083580: 295d 0a20 2020 2020 2020 2020 2020 2073  )].            s
-00083590: 6f6e 203d 2073 6571 5f6f 7267 5b69 6e74  on = seq_org[int
-000835a0: 2872 2e65 6e64 293a 696e 7428 722e 656e  (r.end):int(r.en
-000835b0: 642b 284e 5749 4e29 295d 0a20 2020 2020  d+(NWIN))].     
-000835c0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000835d0: 2020 2020 2320 736f 7020 3d20 7261 6c6c      # sop = rall
-000835e0: 2e72 676e 735b 6f64 725b 6d2d 315d 5d2e  .rgns[odr[m-1]].
-000835f0: 7365 715b 2d4e 5749 4e3a 5d0a 2020 2020  seq[-NWIN:].    
-00083600: 2020 2020 2020 2020 736e 7020 3d20 7365          snp = se
-00083610: 715f 6e65 775b 696e 7428 722e 7374 6172  q_new[int(r.star
-00083620: 742b 6f73 7370 2d28 4e57 494e 2b31 2929  t+ossp-(NWIN+1))
-00083630: 3a69 6e74 2872 2e73 7461 7274 2b6f 7373  :int(r.start+oss
-00083640: 702d 3129 5d0a 2020 2020 2020 2020 2020  p-1)].          
-00083650: 2020 736e 6320 3d20 272d 270a 2020 2020    snc = '-'.    
-00083660: 2020 2020 2020 2020 2320 736f 6e20 3d20          # son = 
-00083670: 7261 6c6c 2e72 676e 735b 6f64 725b 6d2b  rall.rgns[odr[m+
-00083680: 315d 5d2e 7365 715b 3a4e 5749 4e5d 0a20  1]].seq[:NWIN]. 
-00083690: 2020 2020 2020 2020 2020 2073 6e6e 203d             snn =
-000836a0: 2073 6571 5f6e 6577 5b69 6e74 2872 2e73   seq_new[int(r.s
-000836b0: 7461 7274 2b6f 7373 702d 3129 3a69 6e74  tart+ossp-1):int
-000836c0: 2872 2e73 7461 7274 2b6f 7373 702b 284e  (r.start+ossp+(N
-000836d0: 5749 4e2d 3129 295d 0a20 2020 2020 2020  WIN-1))].       
-000836e0: 2020 2020 2073 6920 3d20 534e 565f 696e       si = SNV_in
-000836f0: 666f 2863 6872 6d2c 2072 2e73 7461 7274  fo(chrm, r.start
-00083700: 2c20 722e 7374 6172 742b 6f73 732c 2067  , r.start+oss, g
-00083710: 696e 5b30 5d2c 2067 696e 5b31 5d2c 2027  in[0], gin[1], '
-00083720: 4427 2c20 722e 6765 745f 6c65 6e28 292c  D', r.get_len(),
-00083730: 2069 6e74 2872 2e61 7665 5f63 7667 5f64   int(r.ave_cvg_d
-00083740: 6570 7468 2829 292c 2072 2e63 7667 5f66  epth()), r.cvg_f
-00083750: 7261 632c 2073 6f70 2c20 736f 632c 2073  rac, sop, soc, s
-00083760: 6f6e 2c20 736e 702c 2073 6e63 2c20 736e  on, snp, snc, sn
-00083770: 6e20 290a 2020 2020 2020 2020 2020 2020  n ).            
-00083780: 736e 765f 696e 666f 5f63 6872 2e61 7070  snv_info_chr.app
-00083790: 656e 6428 7369 290a 2020 2020 2020 2020  end(si).        
-000837a0: 2020 2020 6764 5f69 6478 203d 2067 645f      gd_idx = gd_
-000837b0: 6964 785f 6f66 5f72 676e 5b6b 5d0a 2020  idx_of_rgn[k].  
-000837c0: 2020 2020 2020 2020 2020 6764 5f73 656c            gd_sel
-000837d0: 5b67 645f 6964 785d 2e6e 765f 696e 666f  [gd_idx].nv_info
-000837e0: 5f6c 7374 2e61 7070 656e 6428 7369 290a  _lst.append(si).
-000837f0: 0a20 2020 2020 2020 2020 2020 2072 2e73  .            r.s
-00083800: 7461 7274 202b 3d20 6f73 7370 0a20 2020  tart += ossp.   
-00083810: 2020 2020 2020 2020 2072 2e65 6e64 202b           r.end +
-00083820: 3d20 6f73 7370 2020 200a 2020 2020 2020  = ossp   .      
-00083830: 2020 2020 2020 7261 6c6c 2e72 676e 735b        rall.rgns[
-00083840: 6b5d 203d 2072 2023 202e 636f 7079 2829  k] = r # .copy()
-00083850: 0a0a 2020 2020 2020 2020 7072 6576 5f6f  ..        prev_o
-00083860: 6669 203d 2070 7265 765f 6f66 310a 0a20  fi = prev_of1.. 
-00083870: 2020 2065 6c61 7073 6564 5f74 696d 6520     elapsed_time 
-00083880: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
-00083890: 7374 6172 745f 7469 6d65 0a20 2020 2023  start_time.    #
-000838a0: 2070 7269 6e74 2827 2020 2033 2e20 646f   print('   3. do
-000838b0: 6e65 2028 2569 2920 2025 6927 2025 2028  ne (%i)  %i' % (
-000838c0: 656c 6170 7365 645f 7469 6d65 2c20 6c65  elapsed_time, le
-000838d0: 6e28 6f66 2e6f 7369 5f6c 7374 2929 2c20  n(of.osi_lst)), 
-000838e0: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-000838f0: 2020 0a20 2020 206e 765f 6c73 7420 3d20    .    nv_lst = 
-00083900: 5b5d 0a20 2020 2063 6e74 5f65 203d 2030  [].    cnt_e = 0
-00083910: 0a20 2020 2066 6f72 2067 6420 696e 2067  .    for gd in g
-00083920: 645f 7365 6c3a 0a20 2020 2020 2020 2066  d_sel:.        f
-00083930: 6f72 2074 6420 696e 2067 642e 7464 5f6c  or td in gd.td_l
-00083940: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00083950: 7464 2e67 6574 5f6f 7267 5f63 6f64 696e  td.get_org_codin
-00083960: 675f 7365 7128 2067 642e 6364 732e 7267  g_seq( gd.cds.rg
-00083970: 6e73 2c20 7365 715f 6f72 6720 290a 2020  ns, seq_org ).  
-00083980: 2020 2020 2020 6e76 5f6c 7374 5f74 6d70        nv_lst_tmp
-00083990: 2c20 636e 745f 6520 3d20 6764 2e67 6574  , cnt_e = gd.get
-000839a0: 5f67 656e 655f 6c65 7665 6c5f 6e76 5f69  _gene_level_nv_i
-000839b0: 6e66 6f28 636e 745f 6529 0a20 2020 2020  nfo(cnt_e).     
-000839c0: 2020 206e 765f 6c73 7420 3d20 6e76 5f6c     nv_lst = nv_l
-000839d0: 7374 202b 206e 765f 6c73 745f 746d 700a  st + nv_lst_tmp.
-000839e0: 2020 2020 736e 765f 696e 666f 5f63 6872      snv_info_chr
-000839f0: 203d 206e 765f 6c73 740a 2020 2020 2020   = nv_lst.      
-00083a00: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-00083a10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083a20: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
-00083a30: 2070 7574 2072 676e 7320 6261 636b 2074   put rgns back t
-00083a40: 6f20 6764 5f73 656c 0a20 2020 2023 2320  o gd_sel.    ## 
-00083a50: 616e 6420 616c 736f 2061 6464 206e 6577  and also add new
-00083a60: 2072 676e 7320 0a0a 2020 2020 7374 6172   rgns ..    star
-00083a70: 745f 7469 6d65 203d 2074 696d 652e 7469  t_time = time.ti
-00083a80: 6d65 2829 0a20 2020 2070 6f73 5f74 6f5f  me().    pos_to_
-00083a90: 6164 6420 3d20 6e70 2e61 7272 6179 2870  add = np.array(p
-00083aa0: 6f73 5f74 6f5f 6164 6429 0a20 2020 2066  os_to_add).    f
-00083ab0: 6f72 206b 2c20 6764 2069 6e20 656e 756d  or k, gd in enum
-00083ac0: 6572 6174 6528 6764 5f73 656c 293a 200a  erate(gd_sel): .
-00083ad0: 0a20 2020 2020 2020 2070 3120 3d20 696e  .        p1 = in
-00083ae0: 7428 6c6f 635f 6f73 5b6b 5d29 0a20 2020  t(loc_os[k]).   
-00083af0: 2020 2020 2070 3220 3d20 696e 7428 7031       p2 = int(p1
-00083b00: 202b 206e 756d 5f6f 735b 6b5d 290a 2020   + num_os[k]).  
-00083b10: 2020 2020 2020 2320 6764 2e65 786f 6e73        # gd.exons
-00083b20: 2e72 676e 7320 3d20 7261 6c6c 2e72 676e  .rgns = rall.rgn
-00083b30: 735b 7031 3a70 325d 0a20 2020 2020 2020  s[p1:p2].       
-00083b40: 2067 642e 6578 6f6e 732e 7267 6e73 203d   gd.exons.rgns =
-00083b50: 205b 7261 6c6c 2e72 676e 735b 7031 2b6d   [rall.rgns[p1+m
-00083b60: 5d20 666f 7220 6d20 696e 2072 616e 6765  ] for m in range
-00083b70: 2870 322d 7031 295d 0a20 2020 2020 2020  (p2-p1)].       
-00083b80: 2077 6820 3d20 7768 6963 6828 2028 706f   wh = which( (po
-00083b90: 735f 746f 5f61 6464 203e 3d20 7031 2920  s_to_add >= p1) 
-00083ba0: 2620 2870 6f73 5f74 6f5f 6164 6420 3c20  & (pos_to_add < 
-00083bb0: 7032 2920 290a 2020 2020 2020 2020 6966  p2) ).        if
-00083bc0: 206c 656e 2877 6829 203e 2030 3a0a 2020   len(wh) > 0:.  
-00083bd0: 2020 2020 2020 2020 2020 666f 7220 7720            for w 
-00083be0: 696e 2077 683a 2067 642e 6578 6f6e 732e  in wh: gd.exons.
-00083bf0: 7267 6e73 2e61 7070 656e 6428 725f 746f  rgns.append(r_to
-00083c00: 5f61 6464 5b77 5d29 0a0a 2020 2020 2323  _add[w])..    ##
-00083c10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083c20: 2323 2323 230a 2020 2020 2323 2072 656d  #####.    ## rem
-00083c30: 6f76 6520 6964 656c 6574 696f 6e20 0a20  ove ideletion . 
-00083c40: 2020 2023 2320 636f 6d62 696e 6520 7469     ## combine ti
-00083c50: 6c65 6420 6578 6f6e 730a 2020 2020 0a20  led exons.    . 
-00083c60: 2020 2066 6f72 2067 6420 696e 2067 645f     for gd in gd_
-00083c70: 7365 6c3a 0a20 2020 2020 2020 2067 642e  sel:.        gd.
-00083c80: 7265 6d6f 7665 5f69 6e64 656c 5f61 6e64  remove_indel_and
-00083c90: 5f63 6f6d 6269 6e65 5f66 7261 6773 2829  _combine_frags()
-00083ca0: 0a0a 2020 2020 2327 2727 0a20 2020 2065  ..    #'''.    e
-00083cb0: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
-00083cc0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-00083cd0: 745f 7469 6d65 0a20 2020 2023 2070 7269  t_time.    # pri
-00083ce0: 6e74 2827 2020 2033 622e 2064 6f6e 6520  nt('   3b. done 
-00083cf0: 2825 6929 2020 2720 2520 2865 6c61 7073  (%i)  ' % (elaps
-00083d00: 6564 5f74 696d 6529 2c20 666c 7573 6820  ed_time), flush 
-00083d10: 3d20 5472 7565 290a 2020 2020 0a0a 2020  = True).    ..  
-00083d20: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-00083d30: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
-00083d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083d50: 2323 2323 2323 230a 2020 2020 2323 2063  #######.    ## c
-00083d60: 6f64 696e 6720 7265 6769 6f6e 2075 7064  oding region upd
-00083d70: 6174 650a 0a20 2020 2073 7461 7274 5f74  ate..    start_t
-00083d80: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-00083d90: 290a 2020 2020 0a20 2020 2023 2320 636f  ).    .    ## co
-00083da0: 6c6c 6563 7420 7267 6e73 2061 6e64 206d  llect rgns and m
-00083db0: 6172 6b20 7468 6569 7220 706f 730a 2020  ark their pos.  
-00083dc0: 2020 6c6f 635f 6f73 203d 206e 702e 7a65    loc_os = np.ze
-00083dd0: 726f 7328 6e5f 6764 290a 2020 2020 6e75  ros(n_gd).    nu
-00083de0: 6d5f 6f73 203d 206e 702e 7a65 726f 7328  m_os = np.zeros(
-00083df0: 6e5f 6764 2c64 7479 7065 3d6e 702e 666c  n_gd,dtype=np.fl
-00083e00: 6f61 7433 3229 0a20 2020 2063 616c 6c20  oat32).    call 
-00083e10: 3d20 7265 6769 6f6e 7328 290a 2020 2020  = regions().    
-00083e20: 6f73 5f63 7572 203d 2030 0a20 2020 2063  os_cur = 0.    c
-00083e30: 5f70 6f73 203d 205b 5d0a 2020 2020 666f  _pos = [].    fo
-00083e40: 7220 6b2c 2067 6420 696e 2065 6e75 6d65  r k, gd in enume
-00083e50: 7261 7465 2867 645f 7365 6c29 3a0a 2020  rate(gd_sel):.  
-00083e60: 2020 2020 2020 6c6f 635f 6f73 5b6b 5d20        loc_os[k] 
-00083e70: 3d20 6f73 5f63 7572 0a20 2020 2020 2020  = os_cur.       
-00083e80: 206e 756d 5f6f 735b 6b5d 203d 206c 656e   num_os[k] = len
-00083e90: 2867 642e 6364 732e 7267 6e73 290a 2020  (gd.cds.rgns).  
-00083ea0: 2020 2020 2020 6361 6c6c 2e72 676e 7320        call.rgns 
-00083eb0: 3d20 6361 6c6c 2e72 676e 7320 2b20 6764  = call.rgns + gd
-00083ec0: 2e63 6473 2e72 676e 730a 2020 2020 2020  .cds.rgns.      
-00083ed0: 2020 6f73 5f63 7572 202b 3d20 6c65 6e28    os_cur += len(
-00083ee0: 6764 2e63 6473 2e72 676e 7329 0a0a 2020  gd.cds.rgns)..  
-00083ef0: 2020 2020 2020 666f 7220 7220 696e 2067        for r in g
-00083f00: 642e 6364 732e 7267 6e73 3a0a 2020 2020  d.cds.rgns:.    
-00083f10: 2020 2020 2020 2020 635f 706f 732e 6170          c_pos.ap
-00083f20: 7065 6e64 2872 2e73 7461 7274 290a 0a20  pend(r.start).. 
-00083f30: 2020 2023 2320 6765 7420 6f72 6465 7220     ## get order 
-00083f40: 6163 636f 7264 696e 6720 746f 206c 6f63  according to loc
-00083f50: 6174 696f 6e0a 2020 2020 635f 706f 7320  ation.    c_pos 
-00083f60: 3d20 6e70 2e61 7272 6179 2863 5f70 6f73  = np.array(c_pos
-00083f70: 290a 2020 2020 6f64 7220 3d20 635f 706f  ).    odr = c_po
-00083f80: 732e 6172 6773 6f72 7428 290a 0a20 2020  s.argsort()..   
-00083f90: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00083fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083fc0: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
-00083fd0: 2055 7365 206f 6666 7365 745f 6669 6e64   Use offset_find
-00083fe0: 6572 2074 6f20 636f 7272 6563 7420 706f  er to correct po
-00083ff0: 7369 7469 6f6e 7320 696e 2047 5446 2065  sitions in GTF e
-00084000: 6e74 7269 6573 0a20 2020 2023 2320 616c  ntries.    ## al
-00084010: 736f 2067 6574 2072 676e 7320 6672 6167  so get rgns frag
-00084020: 6d65 6e74 7320 7768 656e 2073 706c 6974  ments when split
-00084030: 2069 7320 7265 7175 6972 6564 0a0a 2020   is required..  
-00084040: 2020 635f 746f 5f61 6464 203d 205b 5d0a    c_to_add = [].
-00084050: 2020 2020 706f 735f 746f 5f61 6464 203d      pos_to_add =
-00084060: 205b 5d0a 0a20 2020 2070 7265 765f 6f66   []..    prev_of
-00084070: 6920 3d20 300a 2020 2020 2320 666f 7220  i = 0.    # for 
-00084080: 6b2c 2072 2069 6e20 656e 756d 6572 6174  k, r in enumerat
-00084090: 6528 6361 6c6c 2e72 676e 7329 3a0a 2020  e(call.rgns):.  
-000840a0: 2020 666f 7220 6d2c 206b 2069 6e20 656e    for m, k in en
-000840b0: 756d 6572 6174 6528 6f64 7229 3a0a 2020  umerate(odr):.  
-000840c0: 2020 2020 2020 7220 3d20 6361 6c6c 2e72        r = call.r
-000840d0: 676e 735b 6b5d 0a20 2020 2020 2020 200a  gns[k].        .
-000840e0: 2020 2020 2020 2020 2320 6f73 7320 3d20          # oss = 
-000840f0: 6f66 2e66 696e 645f 6f73 2872 2e73 7461  of.find_os(r.sta
-00084100: 7274 290a 2020 2020 2020 2020 2320 6f73  rt).        # os
-00084110: 6520 3d20 6f66 2e66 696e 645f 6f73 2872  e = of.find_os(r
-00084120: 2e65 6e64 290a 2020 2020 2020 2020 6f73  .end).        os
-00084130: 732c 2070 7265 765f 6f66 3120 3d20 6f66  s, prev_of1 = of
-00084140: 2e66 696e 645f 6f73 5f73 6571 2872 2e73  .find_os_seq(r.s
-00084150: 7461 7274 2c20 7072 6576 5f6f 6669 2c20  tart, prev_ofi, 
-00084160: 6d61 726b 203d 2027 4227 290a 2020 2020  mark = 'B').    
-00084170: 2020 2020 6f73 652c 2070 7265 765f 6f66      ose, prev_of
-00084180: 3220 3d20 6f66 2e66 696e 645f 6f73 5f73  2 = of.find_os_s
-00084190: 6571 2872 2e65 6e64 2c20 7072 6576 5f6f  eq(r.end, prev_o
-000841a0: 6669 2c20 6d61 726b 203d 2027 4327 290a  fi, mark = 'C').
-000841b0: 2020 2020 2020 2020 7072 6576 5f6f 6669          prev_ofi
-000841c0: 203d 2070 7265 765f 6f66 310a 0a20 2020   = prev_of1..   
-000841d0: 2020 2020 2069 6620 2872 2e74 7970 652e       if (r.type.
-000841e0: 6c6f 7765 7228 2920 3d3d 2027 7374 6172  lower() == 'star
-000841f0: 745f 636f 646f 6e27 2920 7c20 2872 2e74  t_codon') | (r.t
-00084200: 7970 652e 6c6f 7765 7228 2920 3d3d 2027  ype.lower() == '
-00084210: 7374 6f70 5f63 6f64 6f6e 2729 3a0a 2020  stop_codon'):.  
-00084220: 2020 2020 2020 2020 2020 722e 7374 6172            r.star
-00084230: 7420 2b3d 206f 7373 0a20 2020 2020 2020  t += oss.       
-00084240: 2020 2020 2072 2e65 6e64 202b 3d20 6f73       r.end += os
-00084250: 7320 2020 0a20 2020 2020 2020 2020 2020  s   .           
-00084260: 2063 616c 6c2e 7267 6e73 5b6b 5d20 3d20   call.rgns[k] = 
-00084270: 722e 636f 7079 2875 7064 6174 653d 4661  r.copy(update=Fa
-00084280: 6c73 6529 0a0a 2020 2020 2020 2020 656c  lse)..        el
-00084290: 7365 3a20 2023 2043 4453 2c20 6669 7665  se:  # CDS, five
-000842a0: 5f70 7269 6d65 5f75 7472 2c20 7468 7265  _prime_utr, thre
-000842b0: 655f 7072 696d 655f 7574 722c 202e 2e2e  e_prime_utr, ...
-000842c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000842d0: 286f 7373 203d 3d20 6f73 6529 3a0a 2020  (oss == ose):.  
-000842e0: 2020 2020 2020 2020 2020 2020 2020 722e                r.
-000842f0: 7374 6172 7420 2b3d 206f 7373 0a20 2020  start += oss.   
-00084300: 2020 2020 2020 2020 2020 2020 2072 2e65               r.e
-00084310: 6e64 202b 3d20 6f73 650a 2020 2020 2020  nd += ose.      
-00084320: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
-00084330: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
-00084340: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
-00084350: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00084360: 286f 7373 203c 206f 7365 293a 2023 2049  (oss < ose): # I
-00084370: 6e73 6572 7369 6f6e 206f 7220 6465 6c65  nsersion or dele
-00084380: 7469 6f6e 2069 6e20 6265 7477 6565 6e0a  tion in between.
-00084390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000843a0: 2023 2070 7269 6e74 2827 2020 2025 6920   # print('   %i 
-000843b0: 6f73 7320 3c20 6f73 6527 2025 206b 290a  oss < ose' % k).
-000843c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000843d0: 702c 2070 7265 765f 6f66 3220 3d20 6f66  p, prev_of2 = of
-000843e0: 2e67 6574 5f62 6e64 7279 5f73 6571 2872  .get_bndry_seq(r
-000843f0: 2e65 6e64 2c20 7072 6576 5f6f 6669 290a  .end, prev_ofi).
-00084400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00084410: 2023 2320 7370 6c69 740a 2020 2020 2020   ## split.      
-00084420: 2020 2020 2020 2020 2020 7267 6e5f 6e65            rgn_ne
-00084430: 7720 3d20 7265 6769 6f6e 2820 722e 6368  w = region( r.ch
-00084440: 722c 2070 2b6f 7365 2c20 722e 656e 642b  r, p+ose, r.end+
-00084450: 6f73 652c 2072 2e74 7970 652c 2078 7320  ose, r.type, xs 
-00084460: 3d20 722e 7873 290a 2020 2020 2020 2020  = r.xs).        
-00084470: 2020 2020 2020 2020 635f 746f 5f61 6464          c_to_add
-00084480: 2e61 7070 656e 6428 7267 6e5f 6e65 7729  .append(rgn_new)
-00084490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000844a0: 2070 6f73 5f74 6f5f 6164 642e 6170 7065   pos_to_add.appe
-000844b0: 6e64 286b 2b31 290a 0a20 2020 2020 2020  nd(k+1)..       
-000844c0: 2020 2020 2020 2020 2072 2e65 6e64 203d           r.end =
-000844d0: 2070 2d31 2b6f 7373 0a20 2020 2020 2020   p-1+oss.       
-000844e0: 2020 2020 2020 2020 2072 2e73 7461 7274           r.start
-000844f0: 202b 3d20 6f73 730a 2020 2020 2020 2020   += oss.        
-00084500: 2020 2020 2020 2020 6361 6c6c 2e72 676e          call.rgn
-00084510: 735b 6b5d 203d 2072 2e63 6f70 7928 7570  s[k] = r.copy(up
-00084520: 6461 7465 3d46 616c 7365 290a 0a20 2020  date=False)..   
-00084530: 2020 2020 2020 2020 2065 6c69 6620 286f           elif (o
-00084540: 7373 203e 206f 7365 293a 2023 2064 656c  ss > ose): # del
-00084550: 6574 696f 6e20 696e 2062 6574 7765 656e  etion in between
-00084560: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00084570: 2020 2320 7072 696e 7428 2720 2020 2569    # print('   %i
-00084580: 206f 7373 203e 206f 7365 2720 2520 6b29   oss > ose' % k)
-00084590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000845a0: 2070 2c20 7072 6576 5f6f 6632 203d 206f   p, prev_of2 = o
-000845b0: 662e 6765 745f 626e 6472 795f 7365 7128  f.get_bndry_seq(
-000845c0: 722e 656e 642c 2070 7265 765f 6f66 6929  r.end, prev_ofi)
-000845d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000845e0: 204c 6420 3d20 6f73 7320 2d20 6f73 650a   Ld = oss - ose.
-000845f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00084600: 2023 2320 7370 6c69 7420 2866 6f72 2043   ## split (for C
-00084610: 4453 206f 6e6c 7929 0a20 2020 2020 2020  DS only).       
-00084620: 2020 2020 2020 2020 2072 676e 5f6e 6577           rgn_new
-00084630: 203d 2072 6567 696f 6e28 2072 2e63 6872   = region( r.chr
-00084640: 2c20 702b 4c64 2b6f 7365 2c20 722e 656e  , p+Ld+ose, r.en
-00084650: 642b 6f73 652c 2072 2e74 7970 652c 2078  d+ose, r.type, x
-00084660: 7320 3d20 722e 7873 290a 2020 2020 2020  s = r.xs).      
-00084670: 2020 2020 2020 2020 2020 635f 746f 5f61            c_to_a
-00084680: 6464 2e61 7070 656e 6428 7267 6e5f 6e65  dd.append(rgn_ne
-00084690: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
-000846a0: 2020 2070 6f73 5f74 6f5f 6164 642e 6170     pos_to_add.ap
-000846b0: 7065 6e64 286b 2b31 290a 0a20 2020 2020  pend(k+1)..     
-000846c0: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
-000846d0: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
-000846e0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
-000846f0: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
-00084700: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
-00084710: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
-00084720: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
-00084730: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00084740: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00084750: 2020 2323 2070 7574 2072 676e 7320 6261    ## put rgns ba
-00084760: 636b 2074 6f20 6764 5f73 656c 0a20 2020  ck to gd_sel.   
-00084770: 2023 2320 616e 6420 616c 736f 2061 6464   ## and also add
-00084780: 206e 6577 2072 676e 7320 0a0a 2020 2020   new rgns ..    
-00084790: 706f 735f 746f 5f61 6464 203d 206e 702e  pos_to_add = np.
-000847a0: 6172 7261 7928 706f 735f 746f 5f61 6464  array(pos_to_add
-000847b0: 290a 2020 2020 666f 7220 6b2c 2067 6420  ).    for k, gd 
-000847c0: 696e 2065 6e75 6d65 7261 7465 2867 645f  in enumerate(gd_
-000847d0: 7365 6c29 3a20 0a0a 2020 2020 2020 2020  sel): ..        
-000847e0: 7031 203d 2069 6e74 286c 6f63 5f6f 735b  p1 = int(loc_os[
-000847f0: 6b5d 290a 2020 2020 2020 2020 7032 203d  k]).        p2 =
-00084800: 2069 6e74 2870 3120 2b20 6e75 6d5f 6f73   int(p1 + num_os
-00084810: 5b6b 5d29 0a20 2020 2020 2020 2067 642e  [k]).        gd.
-00084820: 6364 732e 7267 6e73 203d 205b 6361 6c6c  cds.rgns = [call
-00084830: 2e72 676e 735b 7031 2b6d 5d20 666f 7220  .rgns[p1+m] for 
-00084840: 6d20 696e 2072 616e 6765 2870 322d 7031  m in range(p2-p1
-00084850: 295d 0a20 2020 2020 2020 2077 6820 3d20  )].        wh = 
-00084860: 7768 6963 6828 2028 706f 735f 746f 5f61  which( (pos_to_a
-00084870: 6464 203e 3d20 7031 2920 2620 2870 6f73  dd >= p1) & (pos
-00084880: 5f74 6f5f 6164 6420 3c20 7032 2920 290a  _to_add < p2) ).
-00084890: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
-000848a0: 6829 203e 2030 3a0a 2020 2020 2020 2020  h) > 0:.        
-000848b0: 2020 2020 666f 7220 7720 696e 2077 683a      for w in wh:
-000848c0: 2067 642e 6364 732e 7267 6e73 2e61 7070   gd.cds.rgns.app
-000848d0: 656e 6428 635f 746f 5f61 6464 5b77 5d29  end(c_to_add[w])
-000848e0: 0a0a 2020 2020 656c 6170 7365 645f 7469  ..    elapsed_ti
-000848f0: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00084900: 202d 2073 7461 7274 5f74 696d 650a 2020   - start_time.  
-00084910: 2020 2320 7072 696e 7428 2720 2020 342e    # print('   4.
-00084920: 2064 6f6e 6520 2825 6929 2020 2720 2520   done (%i)  ' % 
-00084930: 2865 6c61 7073 6564 5f74 696d 6529 2c20  (elapsed_time), 
-00084940: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-00084950: 2020 0a20 2020 2023 2323 2323 2323 2323    .    #########
-00084960: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00084970: 2020 2020 2323 2063 6f64 696e 6720 7265      ## coding re
-00084980: 6769 6f6e 2075 7064 6174 650a 2020 2020  gion update.    
-00084990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000849a0: 2323 2323 2323 2323 0a0a 2020 2020 2323  ########..    ##
-000849b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000849c0: 2323 2323 2323 0a20 2020 2023 2320 496e  ######.    ## In
-000849d0: 7465 6772 6974 7920 6368 6563 6b0a 2020  tegrity check.  
-000849e0: 2020 0a20 2020 2073 7461 7274 5f74 696d    .    start_tim
-000849f0: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-00084a00: 2020 2020 6e5f 6261 7365 735f 746f 7461      n_bases_tota
-00084a10: 6c20 3d20 300a 2020 2020 6e5f 6572 5f62  l = 0.    n_er_b
-00084a20: 6173 6573 203d 2030 0a20 2020 206e 5f62  ases = 0.    n_b
-00084a30: 6c6b 5f74 6f74 616c 203d 2030 0a20 2020  lk_total = 0.   
-00084a40: 206e 5f65 725f 626c 6b20 3d20 300a 2020   n_er_blk = 0.  
-00084a50: 2020 6e70 6520 3d20 300a 2020 2020 6e70    npe = 0.    np
-00084a60: 7420 3d20 300a 2020 2020 666f 7220 6764  t = 0.    for gd
-00084a70: 2069 6e20 6764 5f73 656c 3a0a 2020 2020   in gd_sel:.    
-00084a80: 2020 2020 666f 7220 7220 696e 2067 642e      for r in gd.
-00084a90: 6578 6f6e 732e 7267 6e73 3a0a 2020 2020  exons.rgns:.    
-00084aa0: 2020 2020 2020 2020 6966 2072 2e74 7970          if r.typ
-00084ab0: 6520 213d 2027 6465 6c65 7469 6f6e 273a  e != 'deletion':
-00084ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00084ad0: 2073 3120 3d20 722e 7365 710a 2020 2020   s1 = r.seq.    
-00084ae0: 2020 2020 2020 2020 2020 2020 7332 203d              s2 =
-00084af0: 2073 6571 5f6e 6577 5b28 722e 7374 6172   seq_new[(r.star
-00084b00: 742d 3129 3a72 2e65 6e64 5d20 2320 6765  t-1):r.end] # ge
-00084b10: 6e6f 6d65 5b72 2e63 6872 5d2e 7365 715b  nome[r.chr].seq[
-00084b20: 2872 2e73 7461 7274 2d31 293a 722e 656e  (r.start-1):r.en
-00084b30: 645d 0a20 2020 2020 2020 2020 2020 2020  d].             
-00084b40: 2020 206e 5f65 7220 3d20 636f 6d70 6172     n_er = compar
-00084b50: 655f 7365 7132 2820 7331 2c20 7332 2029  e_seq2( s1, s2 )
-00084b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00084b70: 2023 2069 6620 6e5f 6572 203e 2030 3a20   # if n_er > 0: 
-00084b80: 7072 696e 7428 275c 6e53 313a 2025 735c  print('\nS1: %s\
-00084b90: 6e53 323a 2025 7327 2025 2028 7331 2c73  nS2: %s' % (s1,s
-00084ba0: 3229 290a 2020 2020 2020 2020 2020 2020  2)).            
-00084bb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00084bc0: 2020 2020 2020 2020 206e 5f62 6173 6573           n_bases
-00084bd0: 5f74 6f74 616c 202b 3d20 6c65 6e28 7331  _total += len(s1
-00084be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00084bf0: 2020 6e5f 6572 5f62 6173 6573 202b 3d20    n_er_bases += 
-00084c00: 6e5f 6572 0a20 2020 2020 2020 2020 2020  n_er.           
-00084c10: 2020 2020 206e 5f62 6c6b 5f74 6f74 616c       n_blk_total
-00084c20: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00084c30: 2020 2020 2020 6966 206e 5f65 7220 3e20        if n_er > 
-00084c40: 303a 206e 5f65 725f 626c 6b20 2b3d 2031  0: n_er_blk += 1
-00084c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00084c60: 2020 2020 200a 2020 2020 2020 2020 6e74       .        nt
-00084c70: 722c 206e 7072 2c20 6e65 7220 3d20 6764  r, npr, ner = gd
-00084c80: 2e75 7064 6174 655f 7464 5f69 6e66 6f28  .update_td_info(
-00084c90: 7365 6c20 3d20 312c 2070 6570 7469 6465  sel = 1, peptide
-00084ca0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-00084cb0: 206e 652c 206e 7420 3d20 6764 2e63 6f6d   ne, nt = gd.com
-00084cc0: 7061 7265 5f73 6571 735f 6672 6f6d 5f63  pare_seqs_from_c
-00084cd0: 6473 5f61 6e64 5f67 656e 6f6d 6528 7365  ds_and_genome(se
-00084ce0: 715f 6e65 7729 2023 2067 656e 6f6d 655b  q_new) # genome[
-00084cf0: 6764 2e63 6872 5d2e 7365 7129 0a20 2020  gd.chr].seq).   
-00084d00: 2020 2020 206e 7065 202b 3d20 6e65 0a20       npe += ne. 
-00084d10: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
-00084d20: 0a0a 2020 2020 2020 2020 2320 6966 206e  ..        # if n
-00084d30: 6572 203e 2030 3a20 7072 696e 7428 2749  er > 0: print('I
-00084d40: 6e74 6567 7269 7479 2063 6865 636b 2065  ntegrity check e
-00084d50: 7272 6f72 2041 2069 6e20 2573 3a20 2569  rror A in %s: %i
-00084d60: 202d 2025 692f 2569 2c20 2569 2f25 692c   - %i/%i, %i/%i,
-00084d70: 2025 692f 2569 2720 2520 2863 6872 6d2c   %i/%i' % (chrm,
-00084d80: 206e 6572 2c20 6e5f 6572 5f62 6173 6573   ner, n_er_bases
-00084d90: 2c20 6e5f 6261 7365 735f 746f 7461 6c2c  , n_bases_total,
-00084da0: 206e 5f65 725f 626c 6b2c 206e 5f62 6c6b   n_er_blk, n_blk
-00084db0: 5f74 6f74 616c 2c20 6e70 652c 206e 7074  _total, npe, npt
-00084dc0: 2920 290a 2020 2020 2020 2020 2320 6966  ) ).        # if
-00084dd0: 206e 5f65 7220 3e20 303a 2070 7269 6e74   n_er > 0: print
-00084de0: 2827 496e 7465 6772 6974 7920 6368 6563  ('Integrity chec
-00084df0: 6b20 6572 726f 7220 696e 2025 733a 2025  k error in %s: %
-00084e00: 6920 2d20 2569 2f25 692c 2025 692f 2569  i - %i/%i, %i/%i
-00084e10: 2c20 2569 2f25 6927 2025 2028 6368 726d  , %i/%i' % (chrm
-00084e20: 2c20 6e5f 6572 2c20 6e5f 6572 5f62 6173  , n_er, n_er_bas
-00084e30: 6573 2c20 6e5f 6261 7365 735f 746f 7461  es, n_bases_tota
-00084e40: 6c2c 206e 5f65 725f 626c 6b2c 206e 5f62  l, n_er_blk, n_b
-00084e50: 6c6b 5f74 6f74 616c 2c20 6e70 652c 206e  lk_total, npe, n
-00084e60: 7074 2920 290a 0a20 2020 2065 6c61 7073  pt) )..    elaps
-00084e70: 6564 5f74 696d 6520 3d20 7469 6d65 2e74  ed_time = time.t
-00084e80: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
-00084e90: 6d65 0a20 2020 2023 2070 7269 6e74 2827  me.    # print('
-00084ea0: 2020 2035 2e20 646f 6e65 2028 2569 2920     5. done (%i) 
-00084eb0: 2027 2025 2028 656c 6170 7365 645f 7469   ' % (elapsed_ti
-00084ec0: 6d65 292c 2066 6c75 7368 203d 2054 7275  me), flush = Tru
-00084ed0: 6529 0a20 2020 200a 2020 2020 6573 7461  e).    .    esta
-00084ee0: 7420 3d20 286e 5f62 6173 6573 5f74 6f74  t = (n_bases_tot
-00084ef0: 616c 2c20 6e5f 6572 5f62 6173 6573 2c20  al, n_er_bases, 
-00084f00: 6e5f 626c 6b5f 746f 7461 6c2c 206e 5f65  n_blk_total, n_e
-00084f10: 725f 626c 6b2c 206e 7074 2c20 6e70 6529  r_blk, npt, npe)
-00084f20: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
-00084f30: 2067 645f 7365 6c2c 2073 6571 5f6e 6577   gd_sel, seq_new
-00084f40: 2c20 736e 765f 696e 666f 5f63 6872 2c20  , snv_info_chr, 
-00084f50: 6f66 2c20 6368 726d 2c20 6573 7461 740a  of, chrm, estat.
-00084f60: 0a27 2727 0a4e 565f 696e 666f 5f65 7874  .'''.NV_info_ext
-00084f70: 5f74 7220 3d20 636f 6c6c 6563 7469 6f6e  _tr = collection
-00084f80: 732e 6e61 6d65 6474 7570 6c65 2827 4e56  s.namedtuple('NV
-00084f90: 5f69 6e66 6f5f 6578 745f 7472 272c 2027  _info_ext_tr', '
-00084fa0: 6368 722c 2070 6f73 5f72 6566 2c20 706f  chr, pos_ref, po
-00084fb0: 735f 6e65 772c 2067 656e 655f 6964 2c20  s_new, gene_id, 
-00084fc0: 6765 6e65 5f6e 616d 652c 2076 5f74 7970  gene_name, v_typ
-00084fd0: 652c 2076 5f6c 656e 2c20 6376 675f 6465  e, v_len, cvg_de
-00084fe0: 7074 682c 2063 7667 5f66 7261 632c 205c  pth, cvg_frac, \
-00084ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00085000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085010: 2020 2072 6566 5f70 7265 762c 2072 6566     ref_prev, ref
-00085020: 5f73 6571 2c20 7265 665f 6e65 7874 2c20  _seq, ref_next, 
-00085030: 616c 745f 7072 6576 2c20 616c 745f 7365  alt_prev, alt_se
-00085040: 712c 2061 6c74 5f6e 6578 742c 2076 5f63  q, alt_next, v_c
-00085050: 6c61 7373 2c20 5c0a 2020 2020 2020 2020  lass, \.        
-00085060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085070: 2020 2020 2020 2020 2020 765f 636c 6173            v_clas
-00085080: 735f 7472 2c20 7374 7261 6e64 2c20 6344  s_tr, strand, cD
-00085090: 4e41 5f63 6861 6e67 652c 2043 6f64 6f6e  NA_change, Codon
-000850a0: 5f63 6861 6e67 652c 2050 726f 7465 696e  _change, Protein
-000850b0: 5f63 6861 6e67 652c 2050 726f 7465 696e  _change, Protein
-000850c0: 5f63 6861 6e67 6532 2c20 4368 6563 6b27  _change2, Check'
-000850d0: 2920 2023 206f 6e65 2d62 6173 650a 0a64  )  # one-base..d
-000850e0: 6566 2077 7269 7465 5f74 6f5f 7663 6628  ef write_to_vcf(
-000850f0: 2073 6e76 5f69 6e66 6f5f 6c73 742c 2066   snv_info_lst, f
-00085100: 696c 655f 6e61 6d65 2029 3a0a 0a20 2020  ile_name ):..   
-00085110: 2069 6620 6c65 6e28 736e 765f 696e 666f   if len(snv_info
-00085120: 5f6c 7374 2920 3d3d 2030 3a0a 2020 2020  _lst) == 0:.    
-00085130: 2020 2020 7265 7475 726e 0a20 2020 200a      return.    .
-00085140: 2020 2020 6966 206c 656e 2873 6e76 5f69      if len(snv_i
-00085150: 6e66 6f5f 6c73 745b 305d 2920 3c3d 2032  nfo_lst[0]) <= 2
-00085160: 303a 0a20 2020 2020 2020 2070 6173 730a  0:.        pass.
-00085170: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00085180: 2020 6620 3d20 6f70 656e 2820 666e 616d    f = open( fnam
-00085190: 655f 7663 662c 2027 7774 2b27 2029 0a0a  e_vcf, 'wt+' )..
-000851a0: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
-000851b0: 5b27 2343 4852 4f4d 5c74 504f 535c 7449  ['#CHROM\tPOS\tI
-000851c0: 445c 7452 4546 5c74 414c 545c 7451 5541  D\tREF\tALT\tQUA
-000851d0: 4c5c 7446 494c 5445 525c 7449 4e46 4f27  L\tFILTER\tINFO'
-000851e0: 5d0a 2020 2020 2020 2020 666f 7220 6e69  ].        for ni
-000851f0: 2069 6e20 736e 765f 696e 666f 5f6c 7374   in snv_info_lst
-00085200: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
-00085210: 6420 3d0a 2020 2020 2020 2020 2020 2020  d =.            
-00085220: 5175 616c 203d 0a20 2020 2020 2020 2020  Qual =.         
-00085230: 2020 2046 696c 7465 7220 3d0a 2020 2020     Filter =.    
-00085240: 2020 2020 2020 2020 696e 666f 203d 2027          info = '
-00085250: 4143 3d25 693b 4146 270a 2020 2020 2020  AC=%i;AF'.      
-00085260: 2020 2020 2020 2725 735c 7425 695c 7425        '%s\t%i\t%
-00085270: 735c 7425 735c 7425 735c 7425 695c 7425  s\t%s\t%s\t%i\t%
-00085280: 735c 7425 735c 6e27 2025 2028 6e69 2e63  s\t%s\n' % (ni.c
-00085290: 6872 2c20 6e69 2e70 6f73 5f72 6566 2c20  hr, ni.pos_ref, 
-000852a0: 6d69 642c 206e 692e 7265 665f 7365 712c  mid, ni.ref_seq,
-000852b0: 206e 692e 616c 745f 7365 712c 2051 7561   ni.alt_seq, Qua
-000852c0: 6c2c 2069 6e66 6f29 0a0a 2020 2020 2020  l, info)..      
-000852d0: 2020 662e 636c 6f73 6528 290a 2020 2020    f.close().    
-000852e0: 2020 2020 0a20 2020 2072 6574 7572 6e0a      .    return.
-000852f0: 2727 270a 0a64 6566 206d 635f 636f 7265  '''..def mc_core
-00085300: 5f67 6574 5f67 7466 5f61 6e64 5f66 6173  _get_gtf_and_fas
-00085310: 7461 5f70 7428 6764 293a 0a20 2020 200a  ta_pt(gd):.    .
-00085320: 2020 2020 6e74 722c 206e 7072 2c20 6e65      ntr, npr, ne
-00085330: 7220 3d20 6764 2e75 7064 6174 655f 7464  r = gd.update_td
-00085340: 5f69 6e66 6f28 7365 6c20 3d20 312c 2070  _info(sel = 1, p
-00085350: 6570 7469 6465 203d 2054 7275 6529 0a20  eptide = True). 
-00085360: 2020 2067 7466 5f6c 696e 652c 2063 6e20     gtf_line, cn 
-00085370: 3d20 6764 2e67 6574 5f67 7466 5f6c 696e  = gd.get_gtf_lin
-00085380: 6573 5f66 726f 6d5f 6578 6f6e 7328 7365  es_from_exons(se
-00085390: 6c20 3d20 312c 2061 6464 5f73 6571 203d  l = 1, add_seq =
-000853a0: 2046 616c 7365 2c20 636f 6e6e 6563 7420   False, connect 
-000853b0: 3d20 5472 7565 290a 2020 2020 6c74 2c20  = True).    lt, 
-000853c0: 6c70 203d 2067 642e 6765 745f 6661 7374  lp = gd.get_fast
-000853d0: 615f 6c69 6e65 735f 6672 6f6d 5f65 786f  a_lines_from_exo
-000853e0: 6e73 2873 656c 203d 2031 2c20 7065 7074  ns(sel = 1, pept
-000853f0: 6964 6520 3d20 5472 7565 290a 2020 2020  ide = True).    
-00085400: 7265 7475 726e 2067 7466 5f6c 696e 652c  return gtf_line,
-00085410: 206c 742c 206c 702c 2067 642e 6368 722c   lt, lp, gd.chr,
-00085420: 206e 6572 2c20 636e 0a0a 0a27 2727 0a4e   ner, cn...'''.N
-00085430: 565f 696e 666f 5f65 7874 5f74 7220 3d20  V_info_ext_tr = 
-00085440: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
-00085450: 6474 7570 6c65 2827 4e56 5f69 6e66 6f5f  dtuple('NV_info_
-00085460: 6578 745f 7472 272c 2027 6368 722c 2070  ext_tr', 'chr, p
-00085470: 6f73 5f72 6566 2c20 706f 735f 6e65 772c  os_ref, pos_new,
-00085480: 2067 656e 655f 6964 2c20 6765 6e65 5f6e   gene_id, gene_n
-00085490: 616d 652c 2076 5f74 7970 652c 2076 5f6c  ame, v_type, v_l
-000854a0: 656e 2c20 6376 675f 6465 7074 682c 2063  en, cvg_depth, c
-000854b0: 7667 5f66 7261 632c 205c 0a20 2020 2020  vg_frac, \.     
-000854c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000854d0: 2020 2020 2020 2020 2020 2020 2072 6566               ref
-000854e0: 5f70 7265 762c 2072 6566 5f73 6571 2c20  _prev, ref_seq, 
-000854f0: 7265 665f 6e65 7874 2c20 616c 745f 7072  ref_next, alt_pr
-00085500: 6576 2c20 616c 745f 7365 712c 2061 6c74  ev, alt_seq, alt
-00085510: 5f6e 6578 742c 2076 5f63 6c61 7373 2c20  _next, v_class, 
-00085520: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00085530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085540: 2020 2020 765f 636c 6173 735f 7472 2c20      v_class_tr, 
-00085550: 7374 7261 6e64 2c20 6344 4e41 5f63 6861  strand, cDNA_cha
-00085560: 6e67 652c 2043 6f64 6f6e 5f63 6861 6e67  nge, Codon_chang
-00085570: 652c 2050 726f 7465 696e 5f63 6861 6e67  e, Protein_chang
-00085580: 652c 2050 726f 7465 696e 5f63 6861 6e67  e, Protein_chang
-00085590: 6532 2729 2023 2c20 4368 6563 6b27 2920  e2') #, Check') 
-000855a0: 2023 206f 6e65 2d62 6173 650a 2727 270a   # one-base.'''.
-000855b0: 0a4e 565f 696e 666f 5f74 7220 3d20 636f  .NV_info_tr = co
-000855c0: 6c6c 6563 7469 6f6e 732e 6e61 6d65 6474  llections.namedt
-000855d0: 7570 6c65 2827 4e56 5f69 6e66 6f5f 6578  uple('NV_info_ex
-000855e0: 745f 7472 272c 2027 6368 722c 2070 6f73  t_tr', 'chr, pos
-000855f0: 5f72 6566 2c20 6765 6e65 5f6e 616d 652c  _ref, gene_name,
-00085600: 2067 656e 655f 6964 2c20 765f 7479 7065   gene_id, v_type
-00085610: 2c20 765f 6c65 6e2c 205c 0a20 2020 2020  , v_len, \.     
-00085620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085630: 2020 2020 2020 2020 2020 2020 2063 7667               cvg
-00085640: 5f64 6570 7468 2c20 6376 675f 6672 6163  _depth, cvg_frac
-00085650: 2c20 7265 665f 7365 712c 2061 6c74 5f73  , ref_seq, alt_s
-00085660: 6571 2c20 5c0a 2020 2020 2020 2020 2020  eq, \.          
-00085670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085680: 2020 2020 2020 2020 7374 7261 6e64 2c20          strand, 
-00085690: 6344 4e41 5f63 6861 6e67 652c 2043 6f64  cDNA_change, Cod
-000856a0: 6f6e 5f63 6861 6e67 652c 2050 726f 7465  on_change, Prote
-000856b0: 696e 5f63 6861 6e67 652c 2050 726f 7465  in_change, Prote
-000856c0: 696e 5f63 6861 6e67 6532 2c20 765f 636c  in_change2, v_cl
-000856d0: 6173 7327 2920 0a0a 6465 6620 746f 5f6e  ass') ..def to_n
-000856e0: 765f 7369 6d70 6c65 2820 6e76 2029 3a0a  v_simple( nv ):.
-000856f0: 0a20 2020 206e 7669 203d 204e 565f 696e  .    nvi = NV_in
-00085700: 666f 5f74 7228 206e 762e 6368 722c 206e  fo_tr( nv.chr, n
-00085710: 762e 706f 735f 7265 662c 206e 762e 6765  v.pos_ref, nv.ge
-00085720: 6e65 5f6e 616d 652c 206e 762e 6765 6e65  ne_name, nv.gene
-00085730: 5f69 642c 206e 762e 765f 7479 7065 2c20  _id, nv.v_type, 
-00085740: 6e76 2e76 5f6c 656e 2c20 5c0a 2020 2020  nv.v_len, \.    
-00085750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085760: 2020 2020 2020 2020 2020 2020 6e76 2e63              nv.c
-00085770: 7667 5f64 6570 7468 2c20 6e76 2e63 7667  vg_depth, nv.cvg
-00085780: 5f66 7261 632c 206e 762e 7265 665f 7365  _frac, nv.ref_se
-00085790: 712c 206e 762e 616c 745f 7365 712c 205c  q, nv.alt_seq, \
-000857a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000857b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000857c0: 206e 762e 7374 7261 6e64 2c20 6e76 2e63   nv.strand, nv.c
-000857d0: 444e 415f 6368 616e 6765 2c20 6e76 2e43  DNA_change, nv.C
-000857e0: 6f64 6f6e 5f63 6861 6e67 652c 205c 0a20  odon_change, \. 
-000857f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085800: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00085810: 762e 5072 6f74 6569 6e5f 6368 616e 6765  v.Protein_change
-00085820: 2c20 6e76 2e50 726f 7465 696e 5f63 6861  , nv.Protein_cha
-00085830: 6e67 6532 2c20 6e76 2e76 5f63 6c61 7373  nge2, nv.v_class
-00085840: 5f74 7220 290a 2020 2020 7265 7475 726e  _tr ).    return
-00085850: 206e 7669 0a0a 6465 6620 5374 7269 6e67   nvi..def String
-00085860: 4669 785f 7379 6e74 6865 7369 7328 6774  Fix_synthesis(gt
-00085870: 665f 6669 6c65 2c20 6765 6e6f 6d65 5f66  f_file, genome_f
-00085880: 696c 652c 2072 6576 203d 2054 7275 652c  ile, rev = True,
-00085890: 206e 5f63 6f72 6573 203d 2031 2c20 6f75   n_cores = 1, ou
-000858a0: 745f 6469 7220 3d20 4e6f 6e65 2c20 6764  t_dir = None, gd
-000858b0: 7320 3d20 4e6f 6e65 293a 0a0a 2020 2020  s = None):..    
-000858c0: 2320 7072 696e 7428 2753 7472 696e 6746  # print('StringF
-000858d0: 6978 5f73 796e 7468 6573 6973 2073 7461  ix_synthesis sta
-000858e0: 7274 6564 2027 2c20 6461 7465 7469 6d65  rted ', datetime
-000858f0: 2e64 6174 6574 696d 652e 6e6f 7728 2929  .datetime.now())
-00085900: 0a20 2020 200a 2020 2020 6966 2069 7369  .    .    if isi
-00085910: 6e73 7461 6e63 6528 6765 6e6f 6d65 5f66  nstance(genome_f
-00085920: 696c 652c 2073 7472 293a 0a20 2020 2020  ile, str):.     
-00085930: 2020 2067 656e 6f6d 6520 3d20 6c6f 6164     genome = load
-00085940: 5f67 656e 6f6d 6528 6765 6e6f 6d65 5f66  _genome(genome_f
-00085950: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
-00085960: 7275 6529 0a20 2020 2065 6c73 653a 0a20  rue).    else:. 
-00085970: 2020 2020 2020 2067 656e 6f6d 6520 3d20         genome = 
-00085980: 6765 6e6f 6d65 5f66 696c 650a 0a20 2020  genome_file..   
-00085990: 2069 6620 6764 7320 6973 204e 6f6e 653a   if gds is None:
-000859a0: 0a20 2020 2020 2020 2067 7466 5f6c 696e  .        gtf_lin
-000859b0: 6573 2c20 6864 725f 6c69 6e65 7320 3d20  es, hdr_lines = 
-000859c0: 6c6f 6164 5f67 7466 2867 7466 5f66 696c  load_gtf(gtf_fil
-000859d0: 652c 2076 6572 626f 7365 203d 2054 7275  e, verbose = Tru
-000859e0: 6529 0a20 2020 2020 2020 2067 645f 6c73  e).        gd_ls
-000859f0: 742c 2063 6872 7320 3d20 6765 745f 6765  t, chrs = get_ge
-00085a00: 6e65 5f64 6573 6372 6970 746f 7228 6774  ne_descriptor(gt
-00085a10: 665f 6c69 6e65 732c 2067 656e 6f6d 6520  f_lines, genome 
-00085a20: 3d20 4e6f 6e65 2c20 6669 6c6c 203d 2054  = None, fill = T
-00085a30: 7275 652c 205c 0a20 2020 2020 2020 2020  rue, \.         
-00085a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085a60: 2020 2020 2020 6367 203d 2054 7275 652c        cg = True,
-00085a70: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
-00085a80: 206e 5f63 6f72 6573 203d 2031 290a 2020   n_cores = 1).  
-00085a90: 2020 2020 2020 6764 5f6c 7374 732c 2063        gd_lsts, c
-00085aa0: 6872 5f6c 7374 203d 2070 6163 6b5f 6765  hr_lst = pack_ge
-00085ab0: 6e65 5f64 6573 6372 6970 746f 7228 2067  ne_descriptor( g
-00085ac0: 645f 6c73 742c 2063 6872 7320 290a 2020  d_lst, chrs ).  
-00085ad0: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
-00085ae0: 6f72 2067 646c 2069 6e20 6764 5f6c 7374  or gdl in gd_lst
-00085af0: 733a 200a 2020 2020 2020 2020 2020 2020  s: .            
-00085b00: 666f 7220 6d2c 2067 6420 696e 2065 6e75  for m, gd in enu
-00085b10: 6d65 7261 7465 2867 646c 293a 0a20 2020  merate(gdl):.   
-00085b20: 2020 2020 2020 2020 2020 2020 2067 642e               gd.
-00085b30: 7365 745f 636f 765f 6e5f 6162 6e5f 7468  set_cov_n_abn_th
-00085b40: 2820 4d49 4e5f 434f 565f 544f 5f53 454c  ( MIN_COV_TO_SEL
-00085b50: 2c20 4d49 4e5f 4142 4e5f 544f 5f53 454c  , MIN_ABN_TO_SEL
-00085b60: 2029 0a0a 2020 2020 2020 2020 6e74 725f   )..        ntr_
-00085b70: 7661 6c69 6420 3d20 300a 2020 2020 2020  valid = 0.      
-00085b80: 2020 6767 635f 7475 706c 6520 3d20 5b5d    ggc_tuple = []
-00085b90: 0a20 2020 2020 2020 2063 6872 5f6c 7374  .        chr_lst
-00085ba0: 5f6e 6577 203d 205b 5d0a 2020 2020 2020  _new = [].      
-00085bb0: 2020 666f 7220 6b6b 2c20 6368 726d 2069    for kk, chrm i
-00085bc0: 6e20 656e 756d 6572 6174 6528 6368 725f  n enumerate(chr_
-00085bd0: 6c73 7429 3a0a 2020 2020 2020 2020 2020  lst):.          
-00085be0: 2020 6966 2063 6872 6d20 696e 2067 656e    if chrm in gen
-00085bf0: 6f6d 652e 6b65 7973 2829 3a0a 2020 2020  ome.keys():.    
-00085c00: 2020 2020 2020 2020 2020 2020 6368 725f              chr_
-00085c10: 6c73 745f 6e65 772e 6170 7065 6e64 2863  lst_new.append(c
-00085c20: 6872 6d29 0a20 2020 2020 2020 2020 2020  hrm).           
-00085c30: 2020 2020 2067 6763 5f74 7570 6c65 2e61       ggc_tuple.a
-00085c40: 7070 656e 6428 2028 6764 5f6c 7374 735b  ppend( (gd_lsts[
-00085c50: 6b6b 5d2c 2067 656e 6f6d 655b 6368 726d  kk], genome[chrm
-00085c60: 5d2e 7365 712c 2063 6872 6d29 2029 0a20  ].seq, chrm) ). 
-00085c70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00085c80: 6f72 2067 6420 696e 2067 645f 6c73 7473  or gd in gd_lsts
-00085c90: 5b6b 6b5d 3a0a 2020 2020 2020 2020 2020  [kk]:.          
-00085ca0: 2020 2020 2020 2020 2020 6e74 725f 7661            ntr_va
-00085cb0: 6c69 6420 2b3d 2067 642e 6e74 720a 2020  lid += gd.ntr.  
-00085cc0: 2020 2020 2020 2320 7072 696e 7428 274e        # print('N
-00085cd0: 5f74 7273 2076 616c 6964 203d 2025 6927  _trs valid = %i'
-00085ce0: 2025 206e 7472 5f76 616c 6964 290a 2020   % ntr_valid).  
-00085cf0: 2020 2020 2020 6465 6c20 6764 5f6c 7374        del gd_lst
-00085d00: 730a 0a20 2020 2065 6c73 653a 0a20 2020  s..    else:.   
-00085d10: 2020 2020 2067 7466 5f6c 696e 6573 2c20       gtf_lines, 
-00085d20: 6864 725f 6c69 6e65 7320 3d20 6c6f 6164  hdr_lines = load
-00085d30: 5f67 7466 2867 7466 5f66 696c 652c 2076  _gtf(gtf_file, v
-00085d40: 6572 626f 7365 203d 2046 616c 7365 2c20  erbose = False, 
-00085d50: 686f 203d 2054 7275 6529 0a0a 2020 2020  ho = True)..    
-00085d60: 2020 2020 666d 203d 207b 274d 273a 2027      fm = {'M': '
-00085d70: 6578 6f6e 272c 2027 4927 3a20 2769 6e73  exon', 'I': 'ins
-00085d80: 6572 7369 6f6e 272c 2027 4427 3a20 2764  ersion', 'D': 'd
-00085d90: 656c 6574 696f 6e27 7d0a 2020 2020 2020  eletion'}.      
-00085da0: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
-00085db0: 6e75 6d65 7261 7465 2867 6473 293a 0a20  numerate(gds):. 
-00085dc0: 2020 2020 2020 2020 2020 2067 642e 7365             gd.se
-00085dd0: 745f 636f 765f 6e5f 6162 6e5f 7468 2820  t_cov_n_abn_th( 
-00085de0: 4d49 4e5f 434f 565f 544f 5f53 454c 2c20  MIN_COV_TO_SEL, 
-00085df0: 4d49 4e5f 4142 4e5f 544f 5f53 454c 2029  MIN_ABN_TO_SEL )
-00085e00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00085e10: 286c 656e 2867 642e 7267 6e73 2e72 676e  (len(gd.rgns.rgn
-00085e20: 7329 203e 2030 293a 0a20 2020 2020 2020  s) > 0):.       
-00085e30: 2020 2020 2020 2020 2067 642e 6578 6f6e           gd.exon
-00085e40: 732e 7267 6e73 2c20 6764 2e72 676e 732e  s.rgns, gd.rgns.
-00085e50: 7267 6e73 203d 2067 642e 7267 6e73 2e72  rgns = gd.rgns.r
-00085e60: 676e 732c 2067 642e 6578 6f6e 732e 7267  gns, gd.exons.rg
-00085e70: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
-00085e80: 2020 2067 642e 7465 5f74 6f5f 6765 5f6d     gd.te_to_ge_m
-00085e90: 6170 732c 2067 642e 7472 5f74 6f5f 6772  aps, gd.tr_to_gr
-00085ea0: 5f6d 6170 7320 3d20 6764 2e74 725f 746f  _maps = gd.tr_to
-00085eb0: 5f67 725f 6d61 7073 2c20 6764 2e74 655f  _gr_maps, gd.te_
-00085ec0: 746f 5f67 655f 6d61 7073 0a20 2020 2020  to_ge_maps.     
-00085ed0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00085ee0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
-00085ef0: 2067 642e 6578 6f6e 732e 7267 6e73 3a0a   gd.exons.rgns:.
-00085f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085f10: 6966 2072 2e74 7970 6520 696e 2066 6d2e  if r.type in fm.
-00085f20: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-00085f30: 2020 2020 2020 2020 2020 2020 722e 7479              r.ty
-00085f40: 7065 203d 2066 6d5b 722e 7479 7065 5d0a  pe = fm[r.type].
-00085f50: 0a20 2020 2020 2020 2063 6872 7320 3d20  .        chrs = 
-00085f60: 5b5d 0a20 2020 2020 2020 2066 6f72 2067  [].        for g
-00085f70: 6420 696e 2067 6473 3a20 0a20 2020 2020  d in gds: .     
-00085f80: 2020 2020 2020 2063 6872 732e 6170 7065         chrs.appe
-00085f90: 6e64 2867 642e 6368 7229 0a0a 2020 2020  nd(gd.chr)..    
-00085fa0: 2020 2020 6368 725f 6c73 7420 3d20 6c69      chr_lst = li
-00085fb0: 7374 2873 6574 2863 6872 7329 290a 2020  st(set(chrs)).  
-00085fc0: 2020 2020 2020 6368 725f 6c73 742e 736f        chr_lst.so
-00085fd0: 7274 2829 0a20 2020 2020 2020 2063 6872  rt().        chr
-00085fe0: 7320 3d20 6e70 2e61 7272 6179 2863 6872  s = np.array(chr
-00085ff0: 7329 0a0a 2020 2020 2020 2020 6e74 725f  s)..        ntr_
-00086000: 7661 6c69 6420 3d20 300a 2020 2020 2020  valid = 0.      
-00086010: 2020 6767 635f 7475 706c 6520 3d20 5b5d    ggc_tuple = []
-00086020: 0a20 2020 2020 2020 2063 6872 5f6c 7374  .        chr_lst
-00086030: 5f6e 6577 203d 205b 5d0a 2020 2020 2020  _new = [].      
-00086040: 2020 666f 7220 6b6b 2c20 6368 726d 2069    for kk, chrm i
-00086050: 6e20 656e 756d 6572 6174 6528 6368 725f  n enumerate(chr_
-00086060: 6c73 7429 3a0a 2020 2020 2020 2020 2020  lst):.          
-00086070: 2020 6966 2063 6872 6d20 696e 2067 656e    if chrm in gen
-00086080: 6f6d 652e 6b65 7973 2829 3a0a 2020 2020  ome.keys():.    
-00086090: 2020 2020 2020 2020 2020 2020 7768 203d              wh =
-000860a0: 2077 6869 6368 2863 6872 7320 3d3d 2063   which(chrs == c
-000860b0: 6872 6d29 0a20 2020 2020 2020 2020 2020  hrm).           
-000860c0: 2020 2020 2069 6620 6c65 6e28 7768 2920       if len(wh) 
-000860d0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-000860e0: 2020 2020 2020 2020 2073 5f70 6f73 203d           s_pos =
-000860f0: 206e 702e 7a65 726f 7328 6c65 6e28 7768   np.zeros(len(wh
-00086100: 292c 6474 7970 653d 6e70 2e66 6c6f 6174  ),dtype=np.float
-00086110: 3332 290a 2020 2020 2020 2020 2020 2020  32).            
-00086120: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
-00086130: 2072 616e 6765 286c 656e 2877 6829 293a   range(len(wh)):
-00086140: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00086150: 2020 2020 2020 2020 2020 735f 706f 735b            s_pos[
-00086160: 6b5d 203d 2067 6473 5b77 685b 6b5d 5d2e  k] = gds[wh[k]].
-00086170: 6265 6769 6e0a 2020 2020 2020 2020 2020  begin.          
-00086180: 2020 2020 2020 2020 2020 2020 2020 6e74                nt
-00086190: 725f 7661 6c69 6420 2b3d 2067 642e 6e74  r_valid += gd.nt
-000861a0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-000861b0: 2020 2020 2020 6f64 7220 3d20 735f 706f        odr = s_po
-000861c0: 732e 6172 6773 6f72 7428 290a 0a20 2020  s.argsort()..   
-000861d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000861e0: 2063 6872 5f6c 7374 5f6e 6577 2e61 7070   chr_lst_new.app
-000861f0: 656e 6428 6368 726d 290a 2020 2020 2020  end(chrm).      
-00086200: 2020 2020 2020 2020 2020 2020 2020 6767                gg
-00086210: 635f 7475 706c 652e 6170 7065 6e64 2820  c_tuple.append( 
-00086220: 285b 2067 6473 5b77 685b 6f64 725b 6b5d  ([ gds[wh[odr[k]
-00086230: 5d5d 2066 6f72 206b 2069 6e20 7261 6e67  ]] for k in rang
-00086240: 6528 6c65 6e28 7768 2929 205d 2c20 6765  e(len(wh)) ], ge
-00086250: 6e6f 6d65 5b63 6872 6d5d 2e73 6571 2c20  nome[chrm].seq, 
-00086260: 6368 726d 2920 290a 0a20 2020 2020 2020  chrm) )..       
-00086270: 2023 2070 7269 6e74 2827 4e5f 7472 7320   # print('N_trs 
-00086280: 7661 6c69 6420 3d20 2569 2720 2520 6e74  valid = %i' % nt
-00086290: 725f 7661 6c69 6429 0a20 2020 2020 2020  r_valid).       
-000862a0: 2064 656c 2067 6473 0a0a 0a20 2020 2066   del gds...    f
-000862b0: 696c 655f 6e61 6d65 203d 2067 7466 5f66  ile_name = gtf_f
-000862c0: 696c 652e 7370 6c69 7428 272f 2729 5b2d  ile.split('/')[-
-000862d0: 315d 0a20 2020 2023 2066 6e61 6d65 203d  1].    # fname =
-000862e0: 2066 696c 655f 6e61 6d65 2e73 706c 6974   file_name.split
-000862f0: 2827 2e27 295b 305d 0a20 2020 2066 6e73  ('.')[0].    fns
-00086300: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
-00086310: 6974 2827 2e27 295b 3a2d 315d 0a20 2020  it('.')[:-1].   
-00086320: 2066 6e61 6d65 203d 2027 270a 2020 2020   fname = ''.    
-00086330: 666f 7220 6b2c 2066 6e20 696e 2065 6e75  for k, fn in enu
-00086340: 6d65 7261 7465 2866 6e73 293a 0a20 2020  merate(fns):.   
-00086350: 2020 2020 2069 6620 6b20 3e20 303a 0a20       if k > 0:. 
-00086360: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-00086370: 203d 2066 6e61 6d65 202b 2027 2e27 0a20   = fname + '.'. 
-00086380: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
-00086390: 6e61 6d65 202b 2066 6e0a 0a20 2020 2069  name + fn..    i
-000863a0: 6620 6f75 745f 6469 7220 6973 206e 6f74  f out_dir is not
-000863b0: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
-000863c0: 6620 6f75 745f 6469 725b 2d31 5d20 3d3d  f out_dir[-1] ==
-000863d0: 2027 2f27 3a0a 2020 2020 2020 2020 2020   '/':.          
-000863e0: 2020 666e 616d 6520 3d20 6f75 745f 6469    fname = out_di
-000863f0: 7220 2b20 666e 616d 650a 2020 2020 2020  r + fname.      
-00086400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00086410: 2020 2020 666e 616d 6520 3d20 6f75 745f      fname = out_
-00086420: 6469 7220 2b20 272f 2720 2b20 666e 616d  dir + '/' + fnam
-00086430: 650a 0a20 2020 2067 656e 6f6d 655f 6669  e..    genome_fi
-00086440: 6c65 5f6e 6577 203d 2066 6e61 6d65 202b  le_new = fname +
-00086450: 2027 5f63 7573 746f 6d69 7a65 645f 6765   '_customized_ge
-00086460: 6e6f 6d65 2e66 6127 0a20 2020 2067 7466  nome.fa'.    gtf
-00086470: 5f66 696c 655f 6e65 7720 3d20 666e 616d  _file_new = fnam
-00086480: 6520 2b20 275f 6375 7374 6f6d 697a 6564  e + '_customized
-00086490: 2e67 7466 270a 2020 2020 6661 5f66 696c  .gtf'.    fa_fil
-000864a0: 655f 7472 5f6e 6577 203d 2066 6e61 6d65  e_tr_new = fname
-000864b0: 202b 2027 5f74 7261 6e73 6372 6970 746f   + '_transcripto
-000864c0: 6d65 2e66 6127 0a20 2020 2066 615f 6669  me.fa'.    fa_fi
-000864d0: 6c65 5f70 725f 6e65 7720 3d20 666e 616d  le_pr_new = fnam
-000864e0: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
-000864f0: 6127 0a20 2020 2066 6e61 6d65 5f73 6e76  a'.    fname_snv
-00086500: 203d 2066 6e61 6d65 202b 2027 5f73 6e76   = fname + '_snv
-00086510: 5f73 756d 6d61 7279 2e74 7376 270a 2020  _summary.tsv'.  
-00086520: 2020 666e 616d 655f 7663 6620 3d20 666e    fname_vcf = fn
-00086530: 616d 6520 2b20 275f 736e 765f 7375 6d6d  ame + '_snv_summ
-00086540: 6172 792e 7663 6627 0a0a 2020 2020 2323  ary.vcf'..    ##
-00086550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086580: 2323 2323 0a20 2020 2063 6872 5f6c 7374  ####.    chr_lst
-00086590: 203d 2063 6872 5f6c 7374 5f6e 6577 0a0a   = chr_lst_new..
-000865a0: 2020 2020 6f66 5f64 6963 7420 3d20 7b7d      of_dict = {}
-000865b0: 0a20 2020 2023 2067 6473 5f6c 7374 203d  .    # gds_lst =
-000865c0: 205b 5d0a 2020 2020 2320 736e 765f 6c73   [].    # snv_ls
-000865d0: 7420 3d20 5b5d 0a20 2020 2067 6473 5f6e  t = [].    gds_n
-000865e0: 6577 203d 205b 5d0a 2020 2020 736e 765f  ew = [].    snv_
-000865f0: 696e 666f 5f6c 7374 203d 205b 5d0a 0a20  info_lst = [].. 
-00086600: 2020 206e 5f62 6173 6573 5f74 6f74 616c     n_bases_total
-00086610: 203d 2030 0a20 2020 206e 5f65 725f 6261   = 0.    n_er_ba
-00086620: 7365 7320 3d20 300a 2020 2020 6e5f 626c  ses = 0.    n_bl
-00086630: 6b5f 746f 7461 6c20 3d20 300a 2020 2020  k_total = 0.    
-00086640: 6e5f 6572 5f62 6c6b 203d 2030 0a20 2020  n_er_blk = 0.   
-00086650: 206e 7074 203d 2030 0a20 2020 206e 7065   npt = 0.    npe
-00086660: 203d 2030 0a20 2020 200a 2020 2020 7374   = 0.    .    st
-00086670: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
-00086680: 7469 6d65 2829 0a20 2020 2069 6620 286e  time().    if (n
-00086690: 5f63 6f72 6573 203d 3d20 3129 207c 2028  _cores == 1) | (
-000866a0: 6c65 6e28 6368 725f 6c73 7429 203d 3d20  len(chr_lst) == 
-000866b0: 3129 3a0a 2020 2020 2020 2020 666f 7220  1):.        for 
-000866c0: 6b6b 2069 6e20 7261 6e67 6528 6c65 6e28  kk in range(len(
-000866d0: 6368 725f 6c73 7429 293a 0a20 2020 2020  chr_lst)):.     
-000866e0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-000866f0: 2720 2b20 2720 272a 3130 302c 2065 6e64  ' + ' '*100, end
-00086700: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
-00086710: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-00086720: 7269 6e74 2827 5c72 5265 636f 6e73 7472  rint('\rReconstr
-00086730: 7563 7469 6e67 202e 2e20 2569 2f25 6920  ucting .. %i/%i 
-00086740: 2825 7329 2027 2025 2028 6b6b 2b31 2c20  (%s) ' % (kk+1, 
-00086750: 6c65 6e28 6368 725f 6c73 7429 2c20 6368  len(chr_lst), ch
-00086760: 725f 6c73 745b 6b6b 5d29 2c20 656e 6420  r_lst[kk]), end 
-00086770: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
-00086780: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00086790: 6764 5f73 656c 2c20 7365 715f 6e65 772c  gd_sel, seq_new,
-000867a0: 2073 6e76 5f69 6e66 6f5f 6368 722c 206f   snv_info_chr, o
-000867b0: 662c 2063 6872 6d2c 2065 7374 6174 203d  f, chrm, estat =
-000867c0: 206d 635f 636f 7265 5f72 6563 6f6e 7374   mc_core_reconst
-000867d0: 7275 6374 696f 6e28 6767 635f 7475 706c  ruction(ggc_tupl
-000867e0: 655b 6b6b 5d29 0a20 2020 2020 2020 2020  e[kk]).         
-000867f0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00086800: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00086810: 2020 2020 2020 2020 2020 6765 6e6f 6d65            genome
-00086820: 5b63 6872 6d5d 2e73 6571 203d 2073 6571  [chrm].seq = seq
-00086830: 5f6e 6577 0a20 2020 2020 2020 2020 2020  _new.           
-00086840: 206f 665f 6469 6374 5b63 6872 6d5d 203d   of_dict[chrm] =
-00086850: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-00086860: 2320 6764 735f 6c73 742e 6170 7065 6e64  # gds_lst.append
-00086870: 2867 645f 7365 6c29 0a20 2020 2020 2020  (gd_sel).       
-00086880: 2020 2020 2023 2073 6e76 5f6c 7374 2e61       # snv_lst.a
-00086890: 7070 656e 6428 736e 765f 696e 666f 5f63  ppend(snv_info_c
-000868a0: 6872 290a 2020 2020 2020 2020 2020 2020  hr).            
-000868b0: 6764 735f 6e65 7720 3d20 6764 735f 6e65  gds_new = gds_ne
-000868c0: 7720 2b20 6764 5f73 656c 0a20 2020 2020  w + gd_sel.     
-000868d0: 2020 2020 2020 2073 6e76 5f69 6e66 6f5f         snv_info_
-000868e0: 6c73 7420 3d20 736e 765f 696e 666f 5f6c  lst = snv_info_l
-000868f0: 7374 202b 2073 6e76 5f69 6e66 6f5f 6368  st + snv_info_ch
-00086900: 720a 0a20 2020 2020 2020 2020 2020 206e  r..            n
-00086910: 6274 2c20 6e62 652c 206e 6c74 2c20 6e6c  bt, nbe, nlt, nl
-00086920: 652c 206e 742c 206e 653d 2065 7374 6174  e, nt, ne= estat
-00086930: 0a20 2020 2020 2020 2020 2020 206e 5f62  .            n_b
-00086940: 6173 6573 5f74 6f74 616c 202b 3d20 6e62  ases_total += nb
-00086950: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
-00086960: 6572 5f62 6173 6573 202b 3d20 6e62 650a  er_bases += nbe.
-00086970: 2020 2020 2020 2020 2020 2020 6e5f 626c              n_bl
-00086980: 6b5f 746f 7461 6c20 2b3d 206e 6c74 0a20  k_total += nlt. 
-00086990: 2020 2020 2020 2020 2020 206e 5f65 725f             n_er_
-000869a0: 626c 6b20 2b3d 206e 6c65 0a20 2020 2020  blk += nle.     
-000869b0: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
-000869c0: 0a20 2020 2020 2020 2020 2020 206e 7065  .            npe
-000869d0: 202b 3d20 6e65 0a20 2020 2020 2020 2020   += ne.         
-000869e0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-000869f0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00086a00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00086a10: 6e75 6d5f 636f 7265 203d 206d 696e 2820  num_core = min( 
-00086a20: 6e5f 636f 7265 732c 2028 6370 755f 636f  n_cores, (cpu_co
-00086a30: 756e 7428 2920 2d20 3129 2029 0a20 2020  unt() - 1) ).   
-00086a40: 2020 2020 2023 2070 7269 6e74 2822 6e75       # print("nu
-00086a50: 6d20 636f 7265 7320 746f 2075 7365 203d  m cores to use =
-00086a60: 207b 7d22 2e66 6f72 6d61 7428 6e75 6d5f   {}".format(num_
-00086a70: 636f 7265 2929 0a20 2020 2020 2020 2070  core)).        p
-00086a80: 6f6f 6c20 3d20 506f 6f6c 286e 756d 5f63  ool = Pool(num_c
-00086a90: 6f72 6529 0a20 2020 2020 2020 2063 6e74  ore).        cnt
-00086aa0: 203d 2031 0a20 2020 2020 2020 2066 6f72   = 1.        for
-00086ab0: 2067 645f 7365 6c2c 2073 6571 5f6e 6577   gd_sel, seq_new
-00086ac0: 2c20 736e 765f 696e 666f 5f63 6872 2c20  , snv_info_chr, 
-00086ad0: 6f66 2c20 6368 726d 2c20 6573 7461 7420  of, chrm, estat 
-00086ae0: 696e 205c 0a20 2020 2020 2020 2020 2020  in \.           
-00086af0: 2070 6f6f 6c2e 696d 6170 5f75 6e6f 7264   pool.imap_unord
-00086b00: 6572 6564 286d 635f 636f 7265 5f72 6563  ered(mc_core_rec
-00086b10: 6f6e 7374 7275 6374 696f 6e2c 2067 6763  onstruction, ggc
-00086b20: 5f74 7570 6c65 293a 0a20 2020 2020 2020  _tuple):.       
-00086b30: 2020 2020 2023 2074 7164 6d2e 7471 646d       # tqdm.tqdm
-00086b40: 5f6e 6f74 6562 6f6f 6b28 706f 6f6c 2e69  _notebook(pool.i
-00086b50: 6d61 705f 756e 6f72 6465 7265 6428 6d63  map_unordered(mc
-00086b60: 5f63 6f72 655f 7265 636f 6e73 7472 7563  _core_reconstruc
-00086b70: 7469 6f6e 2c20 6767 635f 7475 706c 6529  tion, ggc_tuple)
-00086b80: 2c20 746f 7461 6c3d 6c65 6e28 6767 635f  , total=len(ggc_
-00086b90: 7475 706c 6529 293a 0a20 2020 2020 2020  tuple)):.       
-00086ba0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00086bb0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00086bc0: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
-00086bd0: 6d65 5b63 6872 6d5d 2e73 6571 203d 2073  me[chrm].seq = s
-00086be0: 6571 5f6e 6577 0a20 2020 2020 2020 2020  eq_new.         
-00086bf0: 2020 206f 665f 6469 6374 5b63 6872 6d5d     of_dict[chrm]
-00086c00: 203d 206f 660a 2020 2020 2020 2020 2020   = of.          
-00086c10: 2020 2320 6764 735f 6c73 742e 6170 7065    # gds_lst.appe
-00086c20: 6e64 2867 645f 7365 6c29 0a20 2020 2020  nd(gd_sel).     
-00086c30: 2020 2020 2020 2023 2073 6e76 5f6c 7374         # snv_lst
-00086c40: 2e61 7070 656e 6428 736e 765f 696e 666f  .append(snv_info
-00086c50: 5f63 6872 290a 2020 2020 2020 2020 2020  _chr).          
-00086c60: 2020 6764 735f 6e65 7720 3d20 6764 735f    gds_new = gds_
-00086c70: 6e65 7720 2b20 6764 5f73 656c 0a20 2020  new + gd_sel.   
-00086c80: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
-00086c90: 6f5f 6c73 7420 3d20 736e 765f 696e 666f  o_lst = snv_info
-00086ca0: 5f6c 7374 202b 2073 6e76 5f69 6e66 6f5f  _lst + snv_info_
-00086cb0: 6368 720a 2020 2020 2020 2020 2020 2020  chr.            
-00086cc0: 0a20 2020 2020 2020 2020 2020 206e 6274  .            nbt
-00086cd0: 2c20 6e62 652c 206e 6c74 2c20 6e6c 652c  , nbe, nlt, nle,
-00086ce0: 206e 742c 206e 653d 2065 7374 6174 0a20   nt, ne= estat. 
-00086cf0: 2020 2020 2020 2020 2020 206e 5f62 6173             n_bas
-00086d00: 6573 5f74 6f74 616c 202b 3d20 6e62 740a  es_total += nbt.
-00086d10: 2020 2020 2020 2020 2020 2020 6e5f 6572              n_er
-00086d20: 5f62 6173 6573 202b 3d20 6e62 650a 2020  _bases += nbe.  
-00086d30: 2020 2020 2020 2020 2020 6e5f 626c 6b5f            n_blk_
-00086d40: 746f 7461 6c20 2b3d 206e 6c74 0a20 2020  total += nlt.   
-00086d50: 2020 2020 2020 2020 206e 5f65 725f 626c           n_er_bl
-00086d60: 6b20 2b3d 206e 6c65 0a20 2020 2020 2020  k += nle.       
-00086d70: 2020 2020 206e 7074 202b 3d20 6e74 0a20       npt += nt. 
-00086d80: 2020 2020 2020 2020 2020 206e 7065 202b             npe +
-00086d90: 3d20 6e65 0a20 2020 2020 2020 2020 2020  = ne.           
-00086da0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00086db0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00086dc0: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
-00086dd0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00086de0: 6e74 2827 5c72 5265 636f 6e73 7472 7563  nt('\rReconstruc
-00086df0: 7469 6e67 2028 2569 2920 2e2e 2025 692f  ting (%i) .. %i/
-00086e00: 2569 2028 2573 2920 2020 2020 2020 2020  %i (%s)         
-00086e10: 2020 2027 2025 2028 6e75 6d5f 636f 7265     ' % (num_core
-00086e20: 2c20 636e 742c 206c 656e 2867 6763 5f74  , cnt, len(ggc_t
-00086e30: 7570 6c65 292c 2063 6872 6d29 2c20 656e  uple), chrm), en
-00086e40: 6420 3d20 2720 2020 2020 2020 2020 2020  d = '           
-00086e50: 2020 2020 2020 2020 2020 2729 0a20 2020            ').   
-00086e60: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00086e70: 2020 706f 6f6c 2e63 6c6f 7365 2829 0a20    pool.close(). 
-00086e80: 2020 2020 2020 2070 6f6f 6c2e 6a6f 696e         pool.join
-00086e90: 2829 0a20 2020 2020 2020 200a 2020 2020  ().        .    
-00086ea0: 2727 270a 2020 2020 6764 735f 6e65 7720  '''.    gds_new 
-00086eb0: 3d20 5b5d 0a20 2020 2073 6e76 5f69 6e66  = [].    snv_inf
-00086ec0: 6f5f 6c73 7420 3d20 5b5d 0a20 2020 2066  o_lst = [].    f
-00086ed0: 6f72 206b 6b2c 2063 6872 6d20 696e 2065  or kk, chrm in e
-00086ee0: 6e75 6d65 7261 7465 2863 6872 5f6c 7374  numerate(chr_lst
-00086ef0: 293a 0a20 2020 2020 2020 2067 6473 5f6e  ):.        gds_n
-00086f00: 6577 203d 2067 6473 5f6e 6577 202b 2067  ew = gds_new + g
-00086f10: 6473 5f6c 7374 5b6b 6b5d 0a20 2020 2020  ds_lst[kk].     
-00086f20: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
-00086f30: 3d20 736e 765f 696e 666f 5f6c 7374 202b  = snv_info_lst +
-00086f40: 2073 6e76 5f6c 7374 5b6b 6b5d 0a0a 2020   snv_lst[kk]..  
-00086f50: 2020 6465 6c20 6764 735f 6c73 740a 2020    del gds_lst.  
-00086f60: 2020 2327 2727 0a20 2020 2020 0a20 2020    #'''.     .   
-00086f70: 2065 6c61 7073 6564 5f74 696d 6532 203d   elapsed_time2 =
-00086f80: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
-00086f90: 7461 7274 5f74 696d 650a 2020 2020 7072  tart_time.    pr
-00086fa0: 696e 7428 275c 7252 6563 6f6e 7374 7275  int('\rReconstru
-00086fb0: 6374 696f 6e20 2e2e 2064 6f6e 652e 2028  ction .. done. (
-00086fc0: 2569 2920 2020 2020 2020 2020 2020 2027  %i)            '
-00086fd0: 2025 2028 656c 6170 7365 645f 7469 6d65   % (elapsed_time
-00086fe0: 3229 2c20 666c 7573 6820 3d20 5472 7565  2), flush = True
-00086ff0: 290a 2020 2020 7072 696e 7428 2749 6e74  ).    print('Int
-00087000: 6567 7269 7479 2063 6865 636b 3a20 2025  egrity check:  %
-00087010: 692f 2569 2c20 2569 2f25 692c 2025 692f  i/%i, %i/%i, %i/
-00087020: 2569 2720 2520 5c0a 2020 2020 2020 2020  %i' % \.        
-00087030: 2020 286e 5f65 725f 6261 7365 732c 206e    (n_er_bases, n
-00087040: 5f62 6173 6573 5f74 6f74 616c 2c20 6e5f  _bases_total, n_
-00087050: 6572 5f62 6c6b 2c20 6e5f 626c 6b5f 746f  er_blk, n_blk_to
-00087060: 7461 6c2c 206e 7065 2c20 6e70 7429 2c20  tal, npe, npt), 
-00087070: 666c 7573 6820 3d20 5472 7565 2029 0a20  flush = True ). 
-00087080: 2020 2020 200a 2020 2020 2727 2720 200a       .    '''  .
-00087090: 2020 2020 4e74 725f 616c 6c20 3d20 300a      Ntr_all = 0.
-000870a0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
-000870b0: 735f 6e65 773a 204e 7472 5f61 6c6c 202b  s_new: Ntr_all +
-000870c0: 3d20 6764 2e6e 7472 0a20 2020 2070 7269  = gd.ntr.    pri
-000870d0: 6e74 2827 4e5f 7472 2028 6166 7465 7229  nt('N_tr (after)
-000870e0: 203d 2025 6927 2025 204e 7472 5f61 6c6c   = %i' % Ntr_all
-000870f0: 290a 0a20 2020 206e 5f74 7220 3d20 300a  )..    n_tr = 0.
-00087100: 2020 2020 6e5f 6e65 675f 636f 7620 3d20      n_neg_cov = 
-00087110: 300a 2020 2020 6e5f 706f 735f 636f 7620  0.    n_pos_cov 
-00087120: 3d20 300a 2020 2020 666f 7220 6764 2069  = 0.    for gd i
-00087130: 6e20 6764 735f 6e65 773a 0a20 2020 2020  n gds_new:.     
-00087140: 2020 206e 5f74 7220 2b3d 2067 642e 6e74     n_tr += gd.nt
-00087150: 720a 2020 2020 2020 2020 666f 7220 7464  r.        for td
-00087160: 2069 6e20 6764 2e74 645f 6c73 743a 0a20   in gd.td_lst:. 
-00087170: 2020 2020 2020 2020 2020 2069 6620 7464             if td
-00087180: 2e63 6f76 203c 3d20 303a 206e 5f6e 6567  .cov <= 0: n_neg
-00087190: 5f63 6f76 202b 3d20 310a 2020 2020 2020  _cov += 1.      
-000871a0: 2020 2020 2020 656c 6966 2074 642e 636f        elif td.co
-000871b0: 7620 3e20 303a 206e 5f70 6f73 5f63 6f76  v > 0: n_pos_cov
-000871c0: 202b 3d20 310a 2020 2020 7072 696e 7428   += 1.    print(
-000871d0: 274e 5f74 7273 203d 2025 692c 2025 692c  'N_trs = %i, %i,
-000871e0: 2025 6927 2025 2028 6e5f 7472 2c20 6e5f   %i' % (n_tr, n_
-000871f0: 6e65 675f 636f 762c 206e 5f70 6f73 5f63  neg_cov, n_pos_c
-00087200: 6f76 2929 0a20 2020 2023 2727 270a 2020  ov)).    #'''.  
-00087210: 2020 2020 2020 0a20 2020 2073 7461 7274        .    start
-00087220: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
-00087230: 6528 290a 2020 2020 6774 665f 6c69 6e65  e().    gtf_line
-00087240: 7320 3d20 5b5d 0a20 2020 2066 615f 6c69  s = [].    fa_li
-00087250: 6e65 735f 7472 203d 205b 5d0a 2020 2020  nes_tr = [].    
-00087260: 6661 5f6c 696e 6573 5f70 7220 3d20 5b5d  fa_lines_pr = []
-00087270: 0a0a 2020 2020 2320 7361 7665 5f67 7466  ..    # save_gtf
-00087280: 3228 2066 6e61 6d65 2c20 6774 665f 6c69  2( fname, gtf_li
-00087290: 6e65 5f6c 7374 203d 204e 6f6e 652c 2068  ne_lst = None, h
-000872a0: 6472 203d 204e 6f6e 652c 2066 6f20 3d20  dr = None, fo = 
-000872b0: 4e6f 6e65 2063 6c6f 7365 203d 2046 616c  None close = Fal
-000872c0: 7365 2029 0a20 2020 200a 2020 2020 6966  se ).    .    if
-000872d0: 2072 6576 3a20 0a20 2020 2020 2020 2068   rev: .        h
-000872e0: 6472 5f6c 696e 6573 2e61 7070 656e 6428  dr_lines.append(
-000872f0: 2752 6566 2e20 6765 6e6f 6d65 3a20 2573  'Ref. genome: %s
-00087300: 2720 2520 6765 6e6f 6d65 5f66 696c 6529  ' % genome_file)
-00087310: 0a20 2020 2020 2020 2066 5f67 7466 203d  .        f_gtf =
-00087320: 2073 6176 655f 6774 6632 2820 6774 665f   save_gtf2( gtf_
-00087330: 6669 6c65 5f6e 6577 2c20 6774 665f 6c69  file_new, gtf_li
-00087340: 6e65 5f6c 7374 203d 204e 6f6e 652c 2068  ne_lst = None, h
-00087350: 6472 203d 2068 6472 5f6c 696e 6573 2029  dr = hdr_lines )
-00087360: 0a0a 2020 2020 6674 203d 206f 7065 6e28  ..    ft = open(
-00087370: 6661 5f66 696c 655f 7472 5f6e 6577 2c20  fa_file_tr_new, 
-00087380: 2777 2b27 290a 2020 2020 6670 203d 206f  'w+').    fp = o
-00087390: 7065 6e28 6661 5f66 696c 655f 7072 5f6e  pen(fa_file_pr_n
-000873a0: 6577 2c20 2777 2b27 290a 0a20 2020 2067  ew, 'w+')..    g
-000873b0: 6473 5f6e 6577 203d 2073 6f72 745f 6465  ds_new = sort_de
-000873c0: 7363 7269 7074 6f72 5f6c 7374 2867 6473  scriptor_lst(gds
-000873d0: 5f6e 6577 290a 2020 2020 636e 745f 6e6f  _new).    cnt_no
-000873e0: 6e65 203d 2030 0a20 2020 2070 7269 6e74  ne = 0.    print
-000873f0: 2827 4765 6e65 7261 7469 6e67 2047 5446  ('Generating GTF
-00087400: 2061 6e64 2054 7261 6e73 6372 6970 746f   and Transcripto
-00087410: 6d65 2f50 726f 7465 6f6d 6520 2e2e 2027  me/Proteome .. '
-00087420: 2c20 656e 643d 2720 2020 2027 290a 0a20  , end='    ').. 
-00087430: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
-00087440: 2031 3a0a 2020 2020 2020 2020 636e 745f   1:.        cnt_
-00087450: 7420 3d20 300a 2020 2020 2020 2020 636e  t = 0.        cn
-00087460: 745f 7020 3d20 300a 2020 2020 2020 2020  t_p = 0.        
-00087470: 666f 7220 6d2c 2067 6420 696e 2065 6e75  for m, gd in enu
-00087480: 6d65 7261 7465 2867 6473 5f6e 6577 293a  merate(gds_new):
-00087490: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-000874a0: 2020 2020 2020 2020 2020 6966 2028 6d2b            if (m+
-000874b0: 3129 2531 3030 203d 3d20 303a 2070 7269  1)%100 == 0: pri
-000874c0: 6e74 2827 5c72 4765 6e65 7261 7469 6e67  nt('\rGenerating
-000874d0: 2047 5446 2061 6e64 2054 7261 6e73 6372   GTF and Transcr
-000874e0: 6970 746f 6d65 2f50 726f 7465 6f6d 6520  iptome/Proteome 
-000874f0: 2e2e 2025 692f 2569 2720 2520 286d 2c20  .. %i/%i' % (m, 
-00087500: 6c65 6e28 6764 735f 6e65 7729 292c 2065  len(gds_new)), e
-00087510: 6e64 203d 2027 2020 2027 2c20 666c 7573  nd = '   ', flus
-00087520: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
-00087530: 2020 2020 2020 6e74 722c 206e 7072 2c20        ntr, npr, 
-00087540: 6e65 7220 3d20 6764 2e75 7064 6174 655f  ner = gd.update_
-00087550: 7464 5f69 6e66 6f28 7365 6c20 3d20 312c  td_info(sel = 1,
-00087560: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
-00087570: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00087580: 2020 2020 2020 2020 2067 7466 6c2c 2063           gtfl, c
-00087590: 6e20 3d20 6764 2e67 6574 5f67 7466 5f6c  n = gd.get_gtf_l
-000875a0: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
-000875b0: 7365 6c20 3d20 312c 2061 6464 5f73 6571  sel = 1, add_seq
-000875c0: 203d 2046 616c 7365 2c20 636f 6e6e 6563   = False, connec
-000875d0: 7420 3d20 5472 7565 290a 2020 2020 2020  t = True).      
-000875e0: 2020 2020 2020 636e 745f 6e6f 6e65 202b        cnt_none +
-000875f0: 3d20 636e 0a20 2020 2020 2020 2020 2020  = cn.           
-00087600: 206c 742c 206c 7020 3d20 6764 2e67 6574   lt, lp = gd.get
-00087610: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
-00087620: 6d5f 6578 6f6e 7328 7365 6c20 3d20 312c  m_exons(sel = 1,
-00087630: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
-00087640: 0a20 2020 2020 2020 2020 2020 206c 7420  .            lt 
-00087650: 3d20 6669 6c74 6572 5f74 7273 5f6c 656e  = filter_trs_len
-00087660: 286c 742c 206d 696e 5f6c 656e 203d 204d  (lt, min_len = M
-00087670: 494e 5f54 525f 4c45 4e47 5448 290a 2020  IN_TR_LENGTH).  
-00087680: 2020 2020 2020 2020 2020 6c70 203d 2066            lp = f
-00087690: 696c 7465 725f 7472 735f 6c65 6e28 6c70  ilter_trs_len(lp
-000876a0: 2c20 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f  , min_len = MIN_
-000876b0: 5052 5f4c 454e 4754 4829 0a20 2020 2020  PR_LENGTH).     
-000876c0: 2020 2020 2020 2069 6620 7265 763a 0a20         if rev:. 
-000876d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000876e0: 5f67 7466 203d 2073 6176 655f 6774 6632  _gtf = save_gtf2
-000876f0: 2820 6774 665f 6669 6c65 5f6e 6577 2c20  ( gtf_file_new, 
-00087700: 6774 665f 6c69 6e65 5f6c 7374 203d 2067  gtf_line_lst = g
-00087710: 7466 6c2c 2066 6f20 3d20 665f 6774 6620  tfl, fo = f_gtf 
-00087720: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
-00087730: 2020 2023 2067 7466 5f6c 696e 6573 203d     # gtf_lines =
-00087740: 2067 7466 5f6c 696e 6573 202b 2067 7466   gtf_lines + gtf
-00087750: 6c0a 2020 2020 2020 2020 0a20 2020 2020  l.        .     
-00087760: 2020 2020 2020 2066 742e 7772 6974 656c         ft.writel
-00087770: 696e 6573 286c 7429 0a20 2020 2020 2020  ines(lt).       
-00087780: 2020 2020 2066 702e 7772 6974 656c 696e       fp.writelin
-00087790: 6573 286c 7029 0a20 2020 2020 2020 2020  es(lp).         
-000877a0: 2020 2023 2066 615f 6c69 6e65 735f 7472     # fa_lines_tr
-000877b0: 203d 2066 615f 6c69 6e65 735f 7472 202b   = fa_lines_tr +
-000877c0: 206c 740a 2020 2020 2020 2020 2020 2020   lt.            
-000877d0: 2320 6661 5f6c 696e 6573 5f70 7220 3d20  # fa_lines_pr = 
-000877e0: 6661 5f6c 696e 6573 5f70 7220 2b20 6c70  fa_lines_pr + lp
-000877f0: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
-00087800: 5f74 202b 3d20 6c65 6e28 6c74 290a 2020  _t += len(lt).  
-00087810: 2020 2020 2020 2020 2020 636e 745f 7020            cnt_p 
-00087820: 2b3d 206c 656e 286c 7029 0a20 2020 2020  += len(lp).     
-00087830: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00087840: 656c 6170 7365 645f 7469 6d65 3220 3d20  elapsed_time2 = 
-00087850: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
-00087860: 6172 745f 7469 6d65 0a20 2020 2020 2020  art_time.       
-00087870: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
-00087880: 7469 6e67 2047 5446 2061 6e64 2054 7261  ting GTF and Tra
-00087890: 6e73 6372 6970 746f 6d65 2f50 726f 7465  nscriptome/Prote
-000878a0: 6f6d 6520 2e2e 2025 692c 2025 6920 646f  ome .. %i, %i do
-000878b0: 6e65 2e20 2825 6929 2027 2025 2028 6c65  ne. (%i) ' % (le
-000878c0: 6e28 6764 735f 6e65 7729 2c20 636e 745f  n(gds_new), cnt_
-000878d0: 6e6f 6e65 2c20 656c 6170 7365 645f 7469  none, elapsed_ti
-000878e0: 6d65 3229 2c20 666c 7573 6820 3d20 5472  me2), flush = Tr
-000878f0: 7565 290a 0a20 2020 2065 6c73 653a 0a20  ue)..    else:. 
-00087900: 2020 2020 2020 206e 756d 5f63 6f72 6520         num_core 
-00087910: 3d20 6d69 6e28 206e 5f63 6f72 6573 2c20  = min( n_cores, 
-00087920: 2863 7075 5f63 6f75 6e74 2829 202d 2031  (cpu_count() - 1
-00087930: 2920 290a 2020 2020 2020 2020 2320 7072  ) ).        # pr
-00087940: 696e 7428 226e 756d 2063 6f72 6573 2074  int("num cores t
-00087950: 6f20 7573 6520 3d20 7b7d 222e 666f 726d  o use = {}".form
-00087960: 6174 286e 756d 5f63 6f72 6529 290a 2020  at(num_core)).  
-00087970: 2020 2020 2020 706f 6f6c 203d 2050 6f6f        pool = Poo
-00087980: 6c28 6e75 6d5f 636f 7265 290a 2020 2020  l(num_core).    
-00087990: 2020 2020 636e 7420 3d20 310a 2020 2020      cnt = 1.    
-000879a0: 2020 2020 636e 745f 7420 3d20 300a 2020      cnt_t = 0.  
-000879b0: 2020 2020 2020 636e 745f 7020 3d20 300a        cnt_p = 0.
-000879c0: 2020 2020 2020 2020 666f 7220 6774 666c          for gtfl
-000879d0: 2c20 6c74 2c20 6c70 2c20 6368 726d 2c20  , lt, lp, chrm, 
-000879e0: 6e65 2c20 636e 2069 6e20 706f 6f6c 2e6d  ne, cn in pool.m
-000879f0: 6170 286d 635f 636f 7265 5f67 6574 5f67  ap(mc_core_get_g
-00087a00: 7466 5f61 6e64 5f66 6173 7461 5f70 742c  tf_and_fasta_pt,
-00087a10: 2067 6473 5f6e 6577 293a 0a20 2020 2020   gds_new):.     
-00087a20: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00087a30: 2020 2020 636e 745f 6e6f 6e65 202b 3d20      cnt_none += 
-00087a40: 636e 0a20 2020 2020 2020 2020 2020 2069  cn.            i
-00087a50: 6620 2863 6e74 2b31 2925 3130 3020 3d3d  f (cnt+1)%100 ==
-00087a60: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00087a70: 2020 2020 7072 696e 7428 275c 7247 656e      print('\rGen
-00087a80: 6572 6174 696e 6720 4754 4620 616e 6420  erating GTF and 
-00087a90: 5472 616e 7363 7269 7074 6f6d 652f 5072  Transcriptome/Pr
-00087aa0: 6f74 656f 6d65 202e 2e20 2569 2f25 6927  oteome .. %i/%i'
-00087ab0: 2025 2028 636e 742c 206c 656e 2867 6473   % (cnt, len(gds
-00087ac0: 5f6e 6577 2929 2c20 656e 6420 3d20 2720  _new)), end = ' 
-00087ad0: 2020 2729 0a20 2020 2020 2020 2020 2020    ').           
-00087ae0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00087af0: 2020 2020 2020 636e 7420 2b3d 2031 0a20        cnt += 1. 
-00087b00: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00087b10: 2020 2020 2020 2020 6c74 203d 2066 696c          lt = fil
-00087b20: 7465 725f 7472 735f 6c65 6e28 6c74 2c20  ter_trs_len(lt, 
-00087b30: 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f 5452  min_len = MIN_TR
-00087b40: 5f4c 454e 4754 4829 0a20 2020 2020 2020  _LENGTH).       
-00087b50: 2020 2020 206c 7020 3d20 6669 6c74 6572       lp = filter
-00087b60: 5f74 7273 5f6c 656e 286c 702c 206d 696e  _trs_len(lp, min
-00087b70: 5f6c 656e 203d 204d 494e 5f50 525f 4c45  _len = MIN_PR_LE
-00087b80: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
-00087b90: 2020 6966 2072 6576 3a0a 2020 2020 2020    if rev:.      
-00087ba0: 2020 2020 2020 2020 2020 665f 6774 6620            f_gtf 
-00087bb0: 3d20 7361 7665 5f67 7466 3228 2067 7466  = save_gtf2( gtf
-00087bc0: 5f66 696c 655f 6e65 772c 2067 7466 5f6c  _file_new, gtf_l
-00087bd0: 696e 655f 6c73 7420 3d20 6774 666c 2c20  ine_lst = gtfl, 
-00087be0: 666f 203d 2066 5f67 7466 2029 2020 0a20  fo = f_gtf )  . 
-00087bf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00087c00: 2067 7466 5f6c 696e 6573 203d 2067 7466   gtf_lines = gtf
-00087c10: 5f6c 696e 6573 202b 2067 7466 6c0a 0a20  _lines + gtfl.. 
-00087c20: 2020 2020 2020 2020 2020 2066 742e 7772             ft.wr
-00087c30: 6974 656c 696e 6573 286c 7429 0a20 2020  itelines(lt).   
-00087c40: 2020 2020 2020 2020 2066 702e 7772 6974           fp.writ
-00087c50: 656c 696e 6573 286c 7029 0a20 2020 2020  elines(lp).     
-00087c60: 2020 2020 2020 2023 2066 615f 6c69 6e65         # fa_line
-00087c70: 735f 7472 203d 2066 615f 6c69 6e65 735f  s_tr = fa_lines_
-00087c80: 7472 202b 206c 740a 2020 2020 2020 2020  tr + lt.        
-00087c90: 2020 2020 2320 6661 5f6c 696e 6573 5f70      # fa_lines_p
-00087ca0: 7220 3d20 6661 5f6c 696e 6573 5f70 7220  r = fa_lines_pr 
-00087cb0: 2b20 6c70 0a20 2020 2020 2020 2020 2020  + lp.           
-00087cc0: 2063 6e74 5f74 202b 3d20 6c65 6e28 6c74   cnt_t += len(lt
-00087cd0: 290a 2020 2020 2020 2020 2020 2020 636e  ).            cn
-00087ce0: 745f 7020 2b3d 206c 656e 286c 7029 0a20  t_p += len(lp). 
-00087cf0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00087d00: 2020 2020 706f 6f6c 2e63 6c6f 7365 2829      pool.close()
-00087d10: 0a20 2020 2020 2020 2070 6f6f 6c2e 6a6f  .        pool.jo
-00087d20: 696e 2829 0a0a 2020 2020 2020 2020 656c  in()..        el
-00087d30: 6170 7365 645f 7469 6d65 3220 3d20 7469  apsed_time2 = ti
-00087d40: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
-00087d50: 745f 7469 6d65 0a20 2020 2020 2020 2070  t_time.        p
-00087d60: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
-00087d70: 6e67 2047 5446 2061 6e64 2054 7261 6e73  ng GTF and Trans
-00087d80: 6372 6970 746f 6d65 2f50 726f 7465 6f6d  criptome/Proteom
-00087d90: 6520 2e2e 2064 6f6e 652e 2025 692c 2025  e .. done. %i, %
-00087da0: 692c 2025 6920 2825 6929 2027 2025 205c  i, %i (%i) ' % \
-00087db0: 0a20 2020 2020 2020 2020 2020 2020 2028  .              (
-00087dc0: 636e 745f 6e6f 6e65 2c20 696e 7428 636e  cnt_none, int(cn
-00087dd0: 745f 742f 3229 2c20 696e 7428 636e 745f  t_t/2), int(cnt_
-00087de0: 702f 3229 2c20 656c 6170 7365 645f 7469  p/2), elapsed_ti
-00087df0: 6d65 3229 290a 2020 2020 2020 2020 0a20  me2)).        . 
-00087e00: 2020 2069 6620 7265 763a 2073 6176 655f     if rev: save_
-00087e10: 6774 6632 2820 6774 665f 6669 6c65 5f6e  gtf2( gtf_file_n
-00087e20: 6577 2c20 6774 665f 6c69 6e65 5f6c 7374  ew, gtf_line_lst
-00087e30: 203d 204e 6f6e 652c 2066 6f20 3d20 665f   = None, fo = f_
-00087e40: 6774 662c 2063 6c6f 7365 203d 2054 7275  gtf, close = Tru
-00087e50: 6520 290a 2020 2020 6674 2e63 6c6f 7365  e ).    ft.close
-00087e60: 2829 0a20 2020 2066 702e 636c 6f73 6528  ().    fp.close(
-00087e70: 290a 0a20 2020 2023 2064 656c 2067 6473  )..    # del gds
-00087e80: 5f6e 6577 0a0a 2020 2020 2727 2720 2020  _new..    '''   
-00087e90: 200a 2020 2020 7374 6172 745f 7469 6d65   .    start_time
-00087ea0: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
-00087eb0: 2020 2070 7269 6e74 2827 5361 7669 6e67     print('Saving
-00087ec0: 2046 4153 5441 2028 2569 2c20 2569 202f   FASTA (%i, %i /
-00087ed0: 2025 6929 202e 2e27 2025 2028 6c65 6e28   %i) ..' % (len(
-00087ee0: 6661 5f6c 696e 6573 5f74 7229 2f32 2c20  fa_lines_tr)/2, 
-00087ef0: 6c65 6e28 6661 5f6c 696e 6573 5f70 7229  len(fa_lines_pr)
-00087f00: 2f32 2c20 6e5f 7472 292c 2065 6e64 203d  /2, n_tr), end =
-00087f10: 2027 272c 2066 6c75 7368 203d 2054 7275   '', flush = Tru
-00087f20: 6529 0a20 2020 2066 203d 206f 7065 6e28  e).    f = open(
-00087f30: 6661 5f66 696c 655f 7472 5f6e 6577 2c20  fa_file_tr_new, 
-00087f40: 2777 2b27 290a 2020 2020 662e 7772 6974  'w+').    f.writ
-00087f50: 656c 696e 6573 2866 615f 6c69 6e65 735f  elines(fa_lines_
-00087f60: 7472 290a 2020 2020 662e 636c 6f73 6528  tr).    f.close(
-00087f70: 290a 0a20 2020 2070 7269 6e74 2827 2e27  )..    print('.'
-00087f80: 2c20 656e 643d 2727 290a 2020 2020 6620  , end='').    f 
-00087f90: 3d20 6f70 656e 2866 615f 6669 6c65 5f70  = open(fa_file_p
-00087fa0: 725f 6e65 772c 2027 772b 2729 0a20 2020  r_new, 'w+').   
-00087fb0: 2066 2e77 7269 7465 6c69 6e65 7328 6661   f.writelines(fa
-00087fc0: 5f6c 696e 6573 5f70 7229 0a20 2020 2066  _lines_pr).    f
-00087fd0: 2e63 6c6f 7365 2829 0a0a 2020 2020 656c  .close()..    el
-00087fe0: 6170 7365 645f 7469 6d65 203d 2074 696d  apsed_time = tim
-00087ff0: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
-00088000: 5f74 696d 650a 2020 2020 7072 696e 7428  _time.    print(
-00088010: 2720 646f 6e65 2e20 2825 6929 2720 2520  ' done. (%i)' % 
-00088020: 2865 6c61 7073 6564 5f74 696d 6529 290a  (elapsed_time)).
-00088030: 2020 2020 2727 270a 0a20 2020 2070 7269      '''..    pri
-00088040: 6e74 2827 2020 2025 7327 2025 2066 615f  nt('   %s' % fa_
-00088050: 6669 6c65 5f74 725f 6e65 7720 290a 2020  file_tr_new ).  
-00088060: 2020 7072 696e 7428 2720 2020 2573 2720    print('   %s' 
-00088070: 2520 6661 5f66 696c 655f 7072 5f6e 6577  % fa_file_pr_new
-00088080: 2029 0a20 2020 2069 6620 7265 763a 2070   ).    if rev: p
-00088090: 7269 6e74 2827 2020 2025 7327 2025 2067  rint('   %s' % g
-000880a0: 7466 5f66 696c 655f 6e65 7729 0a0a 2020  tf_file_new)..  
-000880b0: 2020 736e 765f 6c73 7420 3d20 5b5d 0a20    snv_lst = []. 
-000880c0: 2020 2066 6f72 2073 6e76 2069 6e20 736e     for snv in sn
-000880d0: 765f 696e 666f 5f6c 7374 3a0a 2020 2020  v_info_lst:.    
-000880e0: 2020 2020 6e76 6920 3d20 746f 5f6e 765f      nvi = to_nv_
-000880f0: 7369 6d70 6c65 2820 736e 7620 290a 2020  simple( snv ).  
-00088100: 2020 2020 2020 736e 765f 6c73 742e 6170        snv_lst.ap
-00088110: 7065 6e64 286e 7669 290a 2020 2020 2020  pend(nvi).      
-00088120: 2020 0a20 2020 2064 665f 736e 7620 3d20    .    df_snv = 
-00088130: 7064 2e44 6174 6146 7261 6d65 2873 6e76  pd.DataFrame(snv
-00088140: 5f6c 7374 290a 2020 2020 6466 5f73 6e76  _lst).    df_snv
-00088150: 2e74 6f5f 6373 7628 666e 616d 655f 736e  .to_csv(fname_sn
-00088160: 762c 2073 6570 203d 2027 5c74 2729 0a20  v, sep = '\t'). 
-00088170: 2020 2070 7269 6e74 2827 534e 5620 7375     print('SNV su
-00088180: 6d6d 6172 7920 7361 7665 6420 746f 205c  mmary saved to \
-00088190: 6e20 2020 2573 2720 2520 666e 616d 655f  n   %s' % fname_
-000881a0: 736e 7629 0a20 2020 2023 2077 7269 7465  snv).    # write
-000881b0: 5f74 6f5f 7663 6628 2073 6e76 5f69 6e66  _to_vcf( snv_inf
-000881c0: 6f5f 6c73 742c 2066 6e61 6d65 5f76 6366  o_lst, fname_vcf
-000881d0: 2029 0a0a 2020 2020 2327 2727 2020 2020   )..    #'''    
-000881e0: 0a20 2020 2069 6620 7265 763a 0a20 2020  .    if rev:.   
-000881f0: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
-00088200: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-00088210: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
-00088220: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
-00088230: 6375 7374 6f6d 697a 6564 2067 656e 6f6d  customized genom
-00088240: 6520 2e2e 2027 2c20 656e 6420 3d20 2727  e .. ', end = ''
-00088250: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-00088260: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00088270: 2023 2068 6472 5f6c 696e 6573 2e61 7070   # hdr_lines.app
-00088280: 656e 6428 2752 6566 2e20 6765 6e6f 6d65  end('Ref. genome
-00088290: 3a20 2573 2720 2520 6765 6e6f 6d65 5f66  : %s' % genome_f
-000882a0: 696c 6529 0a20 2020 2020 2020 2023 2073  ile).        # s
-000882b0: 6176 655f 6774 6628 6774 665f 6669 6c65  ave_gtf(gtf_file
-000882c0: 5f6e 6577 2c20 6774 665f 6c69 6e65 732c  _new, gtf_lines,
-000882d0: 2068 6472 5f6c 696e 6573 290a 2020 2020   hdr_lines).    
-000882e0: 2020 2020 0a20 2020 2020 2020 2065 6c61      .        ela
-000882f0: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
-00088300: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
-00088310: 7469 6d65 0a20 2020 2020 2020 2070 7269  time.        pri
-00088320: 6e74 2827 2064 6f6e 652e 2025 6928 7329  nt(' done. %i(s)
-00088330: 205c 6e20 2020 2573 2720 2520 2865 6c61   \n   %s' % (ela
-00088340: 7073 6564 5f74 696d 652c 2067 7466 5f66  psed_time, gtf_f
-00088350: 696c 655f 6e65 7729 290a 2020 2020 2020  ile_new)).      
-00088360: 2020 2727 270a 2020 2020 2020 2020 2323    '''.        ##
-00088370: 2053 6176 6520 6765 6e6f 6d65 2063 6f72   Save genome cor
-00088380: 7265 6374 6564 0a20 2020 2020 2020 2070  rected.        p
-00088390: 7269 6e74 2827 596f 7520 6172 6520 616c  rint('You are al
-000883a0: 6d6f 7374 2064 6f6e 652e 205c 6e4c 6173  most done. \nLas
-000883b0: 7420 7374 6570 2069 7320 746f 2073 6176  t step is to sav
-000883c0: 6520 7468 6520 6669 7865 6420 6765 6e6f  e the fixed geno
-000883d0: 6d65 2e20 2729 0a20 2020 2020 2020 2073  me. ').        s
-000883e0: 6176 655f 6765 6e6f 6d65 2820 6765 6e6f  ave_genome( geno
-000883f0: 6d65 5f66 696c 655f 6e65 772c 2067 656e  me_file_new, gen
-00088400: 6f6d 652c 2076 6572 626f 7365 203d 2054  ome, verbose = T
-00088410: 7275 652c 2074 6974 6c65 203d 2027 4765  rue, title = 'Ge
-00088420: 6e6f 6d65 2d72 6576 2720 290a 2020 2020  nome-rev' ).    
-00088430: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
-00088440: 2720 2520 6765 6e6f 6d65 5f66 696c 655f  ' % genome_file_
-00088450: 6e65 7720 290a 0a20 2020 2070 7269 6e74  new )..    print
-00088460: 2827 5374 7269 6e67 4669 7820 6669 6e69  ('StringFix fini
-00088470: 7368 6564 2027 2c20 6461 7465 7469 6d65  shed ', datetime
-00088480: 2e64 6174 6574 696d 652e 6e6f 7728 2929  .datetime.now())
-00088490: 0a0a 2020 2020 7265 7475 726e 2066 6e61  ..    return fna
-000884a0: 6d65 2c20 6765 6e6f 6d65 5f66 696c 655f  me, genome_file_
-000884b0: 6e65 7720 232c 2067 6473 5f6e 6577 0a20  new #, gds_new. 
-000884c0: 2020 2023 2727 2720 2020 200a 0a64 6566     #'''    ..def
-000884d0: 2053 7472 696e 6746 6978 5f61 7373 656d   StringFix_assem
-000884e0: 626c 6528 2049 6e70 7574 203d 204e 6f6e  ble( Input = Non
-000884f0: 652c 2067 656e 6f6d 655f 6661 203d 204e  e, genome_fa = N
-00088500: 6f6e 652c 2061 6e6e 6f74 5f67 7466 203d  one, annot_gtf =
-00088510: 204e 6f6e 652c 206f 7574 5f64 6972 203d   None, out_dir =
-00088520: 2027 5346 6978 5f6f 7574 272c 205c 0a20   'SFix_out', \. 
-00088530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088540: 2020 2020 2020 206e 5f63 6f72 6573 203d         n_cores =
-00088550: 2034 2c20 6f75 745f 6375 7374 6f6d 5f67   4, out_custom_g
-00088560: 656e 6f6d 6520 3d20 4661 6c73 652c 2073  enome = False, s
-00088570: 7566 6669 7820 3d20 4e6f 6e65 2c20 5c0a  uffix = None, \.
-00088580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088590: 2020 2020 2020 2020 6d63 7620 3d20 302e          mcv = 0.
-000885a0: 352c 206d 6364 203d 2031 2c20 6d74 6c20  5, mcd = 1, mtl 
-000885b0: 3d20 3230 302c 206d 706c 203d 2035 302c  = 200, mpl = 50,
-000885c0: 206d 6469 203d 2032 2c20 6d64 6420 3d20   mdi = 2, mdd = 
-000885d0: 322c 206d 6470 203d 2033 2c20 5c0a 2020  2, mdp = 3, \.  
-000885e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000885f0: 2020 2020 2020 6d64 6620 3d20 302e 322c        mdf = 0.2,
-00088600: 206e 5f70 203d 2031 362c 2078 7361 203d   n_p = 16, xsa =
-00088610: 2054 7275 652c 206a 756d 705f 746f 203d   True, jump_to =
-00088620: 2030 2029 3a0a 0a20 2020 2070 7269 6e74   0 ):..    print
-00088630: 2827 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('+-------------
-00088640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00088650: 2d2b 2729 0a20 2020 2070 7269 6e74 2827  -+').    print('
-00088660: 7c20 2020 2020 2053 7472 696e 6766 6978  |      Stringfix
-00088670: 2076 2e25 7320 2020 2020 2020 7c27 2025   v.%s       |' %
-00088680: 2053 7472 696e 6746 6978 5f76 6572 7369   StringFix_versi
-00088690: 6f6e 290a 2020 2020 7072 696e 7428 272b  on).    print('+
-000886a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000886b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2b27  --------------+'
-000886c0: 290a 0a20 2020 2069 6620 496e 7075 7420  )..    if Input 
-000886d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000886e0: 2070 7269 6e74 2827 5573 6167 653a 2729   print('Usage:')
-000886f0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088700: 2531 3273 3a20 2720 2520 2761 7267 756d  %12s: ' % 'argum
-00088710: 656e 7427 2c20 2764 6573 6372 6970 7469  ent', 'descripti
-00088720: 6f6e 2720 290a 2020 2020 2020 2020 7072  on' ).        pr
-00088730: 696e 7428 2725 3132 733a 2027 2025 2027  int('%12s: ' % '
-00088740: 496e 7075 7427 2c20 2749 6e70 7574 2053  Input', 'Input S
-00088750: 414d 206f 7220 4241 4d20 6669 6c65 2e20  AM or BAM file. 
-00088760: 7079 6261 6d2e 7079 2069 7320 7265 7175  pybam.py is requ
-00088770: 6972 6564 2066 6f72 2042 414d 2069 6e70  ired for BAM inp
-00088780: 7574 2e27 2029 0a20 2020 2020 2020 2070  ut.' ).        p
-00088790: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
-000887a0: 2767 656e 6f6d 655f 6661 272c 2065 6e64  'genome_fa', end
-000887b0: 203d 2027 2729 0a20 2020 2020 2020 2070   = '').        p
-000887c0: 7269 6e74 2827 2047 656e 6f6d 6520 6661  rint(' Genome fa
-000887d0: 7374 6120 6669 6c65 2075 7365 6420 746f  sta file used to
-000887e0: 2067 656e 6572 6174 6520 7468 6520 696e   generate the in
-000887f0: 7075 7420 5341 4d2f 4241 4d2e 2027 2029  put SAM/BAM. ' )
-00088800: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088810: 2531 3273 2020 2049 7420 6973 2075 7365  %12s   It is use
-00088820: 6420 746f 2063 6f72 7265 6374 2073 6571  d to correct seq
-00088830: 7565 6e63 6573 206e 6f74 2063 6f76 6572  uences not cover
-00088840: 6564 2062 7920 7265 6164 732c 2027 2025  ed by reads, ' %
-00088850: 2027 2729 0a20 2020 2020 2020 2070 7269   '').        pri
-00088860: 6e74 2827 2531 3273 2020 2074 6f20 6964  nt('%12s   to id
-00088870: 656e 7469 6679 2053 4e50 7320 616e 6420  entify SNPs and 
-00088880: 746f 2067 656e 6572 6174 6520 6375 7374  to generate cust
-00088890: 6f6d 697a 6564 2067 656e 6f6d 652e 2027  omized genome. '
-000888a0: 2020 2520 2727 290a 2020 2020 2020 2020    % '').        
-000888b0: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
-000888c0: 2027 616e 6e6f 745f 6774 6627 2c20 2747   'annot_gtf', 'G
-000888d0: 5446 2f47 4646 2066 696c 6520 746f 2062  TF/GFF file to b
-000888e0: 6520 7573 6564 2066 6f72 2067 7569 6465  e used for guide
-000888f0: 2061 6e6e 6f74 6174 696f 6e27 2029 0a20   annotation' ). 
-00088900: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
-00088910: 3273 3a20 2720 2520 276f 7574 5f64 6972  2s: ' % 'out_dir
-00088920: 272c 2027 4f75 7470 7574 2064 6972 6563  ', 'Output direc
-00088930: 746f 7279 2720 290a 2020 2020 2020 2020  tory' ).        
-00088940: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
-00088950: 2027 6e5f 636f 7265 7327 2c20 274e 756d   'n_cores', 'Num
-00088960: 6265 7220 6f66 2063 6f72 6573 2074 6f20  ber of cores to 
-00088970: 7573 6527 2029 0a20 2020 2020 2020 2070  use' ).        p
-00088980: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
-00088990: 2773 7566 6669 7827 2c20 2753 7566 6669  'suffix', 'Suffi
-000889a0: 7820 746f 2062 6520 7573 6564 2066 6f72  x to be used for
-000889b0: 206f 7574 7075 7420 6669 6c65 206e 616d   output file nam
-000889c0: 6573 2720 290a 2020 2020 2020 2020 7072  es' ).        pr
-000889d0: 696e 7428 2725 3132 733a 2027 2025 2027  int('%12s: ' % '
-000889e0: 6d63 7627 2c20 274d 696e 696d 756d 2072  mcv', 'Minimum r
-000889f0: 6561 6420 636f 7665 7261 6765 2066 6f72  ead coverage for
-00088a00: 2069 6e63 6c75 7369 6f6e 2069 6e20 7468   inclusion in th
-00088a10: 6520 6f75 7470 7574 2047 5446 2f47 4646  e output GTF/GFF
-00088a20: 2720 290a 2020 2020 2020 2020 7072 696e  ' ).        prin
-00088a30: 7428 2725 3132 7320 2020 616e 6420 7472  t('%12s   and tr
-00088a40: 616e 7363 7269 7074 6f6d 652f 7072 6f74  anscriptome/prot
-00088a50: 656f 6d65 205b 307e 315d 2e20 466f 7220  eome [0~1]. For 
-00088a60: 6120 6c65 6e67 7468 204c 2074 7261 6e73  a length L trans
-00088a70: 6372 6970 742c 2027 2025 2027 2729 0a20  cript, ' % ''). 
-00088a80: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
-00088a90: 3273 2020 2069 7420 7769 6c6c 2062 6520  2s   it will be 
-00088aa0: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
-00088ab0: 6f75 7470 7574 2069 6620 6174 206c 6561  output if at lea
-00088ac0: 7374 206d 6376 2a4c 2062 6173 6573 2061  st mcv*L bases a
-00088ad0: 7265 2063 6f76 6572 6564 2062 7920 7265  re covered by re
-00088ae0: 6164 7320 2720 2025 2027 2729 0a20 2020  ads '  % '').   
-00088af0: 2020 2020 2070 7269 6e74 2827 2531 3273       print('%12s
-00088b00: 3a20 2720 2520 276d 6364 272c 2027 4d69  : ' % 'mcd', 'Mi
-00088b10: 6e69 6d75 6d20 6261 7365 2063 6f76 6572  nimum base cover
-00088b20: 6167 6520 6465 7074 6820 666f 7220 696e  age depth for in
-00088b30: 636c 7573 696f 6e20 696e 2074 6865 206f  clusion in the o
-00088b40: 7574 7075 7427 2029 0a20 2020 2020 2020  utput' ).       
-00088b50: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-00088b60: 2520 276d 746c 272c 2027 4d69 6e69 6d75  % 'mtl', 'Minimu
-00088b70: 6d20 7472 616e 7363 7269 7074 206c 656e  m transcript len
-00088b80: 6774 6820 696e 2062 6173 6573 2720 290a  gth in bases' ).
-00088b90: 2020 2020 2020 2020 7072 696e 7428 2725          print('%
-00088ba0: 3132 733a 2027 2025 2027 6d70 6c27 2c20  12s: ' % 'mpl', 
-00088bb0: 274d 696e 696d 756d 2070 726f 7465 696e  'Minimum protein
-00088bc0: 2028 616d 696e 6f20 6163 6964 2073 6571   (amino acid seq
-00088bd0: 7565 6e63 6529 206c 656e 6774 6827 2029  uence) length' )
-00088be0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088bf0: 2531 3273 3a20 2720 2520 276d 6469 272c  %12s: ' % 'mdi',
-00088c00: 2027 4d69 6e69 6d75 6d20 636f 7665 7261   'Minimum covera
-00088c10: 6765 2064 6570 7468 2066 6f72 2061 6e20  ge depth for an 
-00088c20: 696e 7365 7273 696f 6e20 746f 2062 6520  insersion to be 
-00088c30: 636f 6e73 6964 6572 6564 2076 616c 6964  considered valid
-00088c40: 205b 3e3d 312e 305d 2720 290a 2020 2020   [>=1.0]' ).    
-00088c50: 2020 2020 7072 696e 7428 2725 3132 733a      print('%12s:
-00088c60: 2027 2025 2027 6d64 6427 2c20 274d 696e   ' % 'mdd', 'Min
-00088c70: 696d 756d 2063 6f76 6572 6167 6520 6465  imum coverage de
-00088c80: 7074 6820 666f 7220 6120 6465 6c65 7469  pth for a deleti
-00088c90: 6f6e 2074 6f20 6265 2063 6f6e 7369 6465  on to be conside
-00088ca0: 7265 6420 7661 6c69 6420 5b3e 3d31 2e30  red valid [>=1.0
-00088cb0: 5d27 2029 0a20 2020 2020 2020 2070 7269  ]' ).        pri
+0007e1a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e1b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e1c0: 2323 2323 0a23 2320 5374 7269 6e67 4669  ####.## StringFi
+0007e1d0: 782d 7379 6e74 6865 7369 730a 2323 2323  x-synthesis.####
+0007e1e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e1f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e220: 2323 2323 2323 0a0a 534e 565f 696e 666f  ######..SNV_info
+0007e230: 203d 2063 6f6c 6c65 6374 696f 6e73 2e6e   = collections.n
+0007e240: 616d 6564 7475 706c 6528 2753 4e56 5f69  amedtuple('SNV_i
+0007e250: 6e66 6f27 2c20 2763 6872 2c20 706f 735f  nfo', 'chr, pos_
+0007e260: 7265 662c 2070 6f73 5f6e 6577 2c20 6765  ref, pos_new, ge
+0007e270: 6e65 5f69 642c 2067 656e 655f 6e61 6d65  ne_id, gene_name
+0007e280: 2c20 765f 7479 7065 2c20 765f 6c65 6e2c  , v_type, v_len,
+0007e290: 2063 7667 5f64 6570 7468 2c20 6376 675f   cvg_depth, cvg_
+0007e2a0: 6672 6163 2c20 5c0a 2020 2020 2020 2020  frac, \.        
+0007e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e2c0: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
+0007e2d0: 7265 762c 2072 6566 5f73 6571 2c20 7265  rev, ref_seq, re
+0007e2e0: 665f 6e65 7874 2c20 616c 745f 7072 6576  f_next, alt_prev
+0007e2f0: 2c20 616c 745f 7365 712c 2061 6c74 5f6e  , alt_seq, alt_n
+0007e300: 6578 7427 2920 2320 6f6e 652d 6261 7365  ext') # one-base
+0007e310: 0a0a 4e57 494e 203d 2033 0a64 6566 2066  ..NWIN = 3.def f
+0007e320: 696e 645f 736e 705f 6f6c 6428 7367 2c20  ind_snp_old(sg, 
+0007e330: 7372 2c20 6372 2c20 6368 726d 2c20 706f  sr, cr, chrm, po
+0007e340: 735f 6162 732c 206f 732c 2067 696e 293a  s_abs, os, gin):
+0007e350: 0a20 2020 200a 2020 2020 736e 765f 696e  .    .    snv_in
+0007e360: 666f 5f6c 7374 203d 205b 5d0a 2020 2020  fo_lst = [].    
+0007e370: 6c65 6e5f 746f 5f74 6573 7420 3d20 6d69  len_to_test = mi
+0007e380: 6e28 6c65 6e28 7372 292c 6c65 6e28 7367  n(len(sr),len(sg
+0007e390: 2929 0a0a 2020 2020 7374 6172 7420 3d20  ))..    start = 
+0007e3a0: 300a 2020 2020 656e 6420 3d20 6d69 6e28  0.    end = min(
+0007e3b0: 2031 3030 2c20 6c65 6e5f 746f 5f74 6573   100, len_to_tes
+0007e3c0: 7420 290a 2020 2020 4e20 3d20 696e 7428  t ).    N = int(
+0007e3d0: 6e70 2e63 6569 6c28 206c 656e 5f74 6f5f  np.ceil( len_to_
+0007e3e0: 7465 7374 2f31 3030 2029 290a 2020 2020  test/100 )).    
+0007e3f0: 2327 2727 0a20 2020 2066 6f72 206e 2069  #'''.    for n i
+0007e400: 6e20 7261 6e67 6528 4e29 3a0a 2020 2020  n range(N):.    
+0007e410: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+0007e420: 7367 5b73 7461 7274 3a65 6e64 5d20 213d  sg[start:end] !=
+0007e430: 2073 725b 7374 6172 743a 656e 645d 3a0a   sr[start:end]:.
+0007e440: 0a20 2020 2020 2020 2020 2020 2070 203d  .            p =
+0007e450: 2030 0a20 2020 2020 2020 2020 2020 2070   0.            p
+0007e460: 6f73 5f6c 7374 203d 205b 5d0a 2020 2020  os_lst = [].    
+0007e470: 2020 2020 2020 2020 6c65 6e5f 6c73 7420          len_lst 
+0007e480: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0007e490: 2063 7667 5f6c 7374 203d 205b 5d0a 2020   cvg_lst = [].  
+0007e4a0: 2020 2020 2020 2020 2020 736e 705f 6c73            snp_ls
+0007e4b0: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
+0007e4c0: 2020 2073 6e70 5f6f 7267 5f6c 7374 203d     snp_org_lst =
+0007e4d0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0007e4e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0007e4f0: 206b 2069 6e20 7261 6e67 6528 7374 6172   k in range(star
+0007e500: 742c 2065 6e64 293a 0a20 2020 2020 2020  t, end):.       
+0007e510: 2020 2020 2020 2020 2069 6620 7372 5b6b           if sr[k
+0007e520: 5d20 213d 2073 675b 6b5d 3a0a 2020 2020  ] != sg[k]:.    
+0007e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e540: 6966 2070 203d 3d20 303a 2070 6f73 203d  if p == 0: pos =
+0007e550: 206b 0a20 2020 2020 2020 2020 2020 2020   k.             
+0007e560: 2020 2020 2020 2070 202b 3d20 310a 2020         p += 1.  
+0007e570: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0007e580: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0007e590: 2020 2020 2020 2020 6966 2070 203e 2030          if p > 0
+0007e5a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007e5b0: 2020 2020 2020 2020 2020 2320 6376 675f            # cvg_
+0007e5c0: 6c73 742e 6170 7065 6e64 286e 702e 6d65  lst.append(np.me
+0007e5d0: 616e 2820 6372 5b70 6f73 3a28 706f 732b  an( cr[pos:(pos+
+0007e5e0: 7029 5d20 2920 290a 2020 2020 2020 2020  p)] ) ).        
+0007e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e600: 2320 736e 705f 6c73 742e 6170 7065 6e64  # snp_lst.append
+0007e610: 2873 725b 706f 733a 2870 6f73 2b70 295d  (sr[pos:(pos+p)]
+0007e620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007e630: 2020 2020 2020 2020 2020 706f 735f 6c73            pos_ls
+0007e640: 742e 6170 7065 6e64 2870 6f73 290a 2020  t.append(pos).  
+0007e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e660: 2020 2020 2020 6c65 6e5f 6c73 742e 6170        len_lst.ap
+0007e670: 7065 6e64 2870 290a 2020 2020 2020 2020  pend(p).        
+0007e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e690: 2320 736e 705f 6f72 675f 6c73 742e 6170  # snp_org_lst.ap
+0007e6a0: 7065 6e64 2873 675b 706f 733a 2870 6f73  pend(sg[pos:(pos
+0007e6b0: 2b70 295d 290a 2020 2020 2020 2020 2020  +p)]).          
+0007e6c0: 2020 2020 2020 2020 2020 2020 2020 7020                p 
+0007e6d0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0007e6e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0007e6f0: 2020 2020 2066 6f72 206b 2069 6e20 7261       for k in ra
+0007e700: 6e67 6528 6c65 6e28 706f 735f 6c73 7429  nge(len(pos_lst)
+0007e710: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0007e720: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0007e730: 2020 2020 7031 203d 206d 6178 2830 2c28      p1 = max(0,(
+0007e740: 706f 735f 6c73 745b 6b5d 2d4e 5749 4e29  pos_lst[k]-NWIN)
+0007e750: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007e760: 2020 7032 203d 206d 696e 286c 656e 5f74    p2 = min(len_t
+0007e770: 6f5f 7465 7374 2c28 706f 735f 6c73 745b  o_test,(pos_lst[
+0007e780: 6b5d 2b6c 656e 5f6c 7374 5b6b 5d2b 4e57  k]+len_lst[k]+NW
+0007e790: 494e 2929 0a20 2020 2020 2020 2020 2020  IN)).           
+0007e7a0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0007e7b0: 2020 2020 2020 736f 7020 3d20 7367 5b70        sop = sg[p
+0007e7c0: 313a 706f 735f 6c73 745b 6b5d 5d0a 2020  1:pos_lst[k]].  
+0007e7d0: 2020 2020 2020 2020 2020 2020 2020 736f                so
+0007e7e0: 6320 3d20 7367 5b70 6f73 5f6c 7374 5b6b  c = sg[pos_lst[k
+0007e7f0: 5d3a 2870 6f73 5f6c 7374 5b6b 5d2b 6c65  ]:(pos_lst[k]+le
+0007e800: 6e5f 6c73 745b 6b5d 295d 0a20 2020 2020  n_lst[k])].     
+0007e810: 2020 2020 2020 2020 2020 2073 6f6e 203d             son =
+0007e820: 2073 675b 2870 6f73 5f6c 7374 5b6b 5d2b   sg[(pos_lst[k]+
+0007e830: 6c65 6e5f 6c73 745b 6b5d 293a 7032 5d0a  len_lst[k]):p2].
+0007e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e860: 2073 6e70 203d 2073 725b 7031 3a70 6f73   snp = sr[p1:pos
+0007e870: 5f6c 7374 5b6b 5d5d 0a20 2020 2020 2020  _lst[k]].       
+0007e880: 2020 2020 2020 2020 2073 6e63 203d 2073           snc = s
+0007e890: 725b 706f 735f 6c73 745b 6b5d 3a28 706f  r[pos_lst[k]:(po
+0007e8a0: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
+0007e8b0: 5b6b 5d29 5d0a 2020 2020 2020 2020 2020  [k])].          
+0007e8c0: 2020 2020 2020 736e 6e20 3d20 7372 5b28        snn = sr[(
+0007e8d0: 706f 735f 6c73 745b 6b5d 2b6c 656e 5f6c  pos_lst[k]+len_l
+0007e8e0: 7374 5b6b 5d29 3a70 325d 0a20 2020 2020  st[k]):p2].     
+0007e8f0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0007e900: 2020 2020 2020 2020 2020 2020 7369 203d              si =
+0007e910: 2053 4e56 5f69 6e66 6f28 6368 726d 2c20   SNV_info(chrm, 
+0007e920: 706f 735f 6c73 745b 6b5d 2b70 6f73 5f61  pos_lst[k]+pos_a
+0007e930: 6273 2c20 706f 735f 6c73 745b 6b5d 2b70  bs, pos_lst[k]+p
+0007e940: 6f73 5f61 6273 2b6f 732c 2067 696e 5b30  os_abs+os, gin[0
+0007e950: 5d2c 2067 696e 5b31 5d2c 2027 5627 2c20  ], gin[1], 'V', 
+0007e960: 6c65 6e5f 6c73 745b 6b5d 2c20 5c0a 2020  len_lst[k], \.  
+0007e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e980: 2020 2020 2020 2020 2020 2020 696e 7428              int(
+0007e990: 6372 5b70 6f73 5f6c 7374 5b6b 5d5d 292c  cr[pos_lst[k]]),
+0007e9a0: 2031 2c20 736f 702c 2073 6f63 2c20 736f   1, sop, soc, so
+0007e9b0: 6e2c 2073 6e70 2c20 736e 632c 2073 6e6e  n, snp, snc, snn
+0007e9c0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0007e9d0: 2020 2073 6e76 5f69 6e66 6f5f 6c73 742e     snv_info_lst.
+0007e9e0: 6170 7065 6e64 2873 6929 0a0a 2020 2020  append(si)..    
+0007e9f0: 2020 2020 7374 6172 7420 3d20 656e 640a      start = end.
+0007ea00: 2020 2020 2020 2020 656e 6420 3d20 6d69          end = mi
+0007ea10: 6e28 2065 6e64 202b 2031 3030 2c20 6c65  n( end + 100, le
+0007ea20: 6e5f 746f 5f74 6573 7420 290a 2020 2020  n_to_test ).    
+0007ea30: 2327 2727 2020 2020 2020 2020 200a 2020  #'''         .  
+0007ea40: 2020 7265 7475 726e 2873 6e76 5f69 6e66    return(snv_inf
+0007ea50: 6f5f 6c73 7429 0a0a 0a64 6566 2066 696e  o_lst)...def fin
+0007ea60: 645f 736e 7028 7367 2c20 7372 2c20 636d  d_snp(sg, sr, cm
+0007ea70: 6174 2c20 6368 726d 2c20 706f 735f 6162  at, chrm, pos_ab
+0007ea80: 732c 206f 732c 2067 696e 293a 0a20 2020  s, os, gin):.   
+0007ea90: 200a 2020 2020 736e 765f 696e 666f 5f6c   .    snv_info_l
+0007eaa0: 7374 203d 205b 5d0a 2020 2020 6c65 6e5f  st = [].    len_
+0007eab0: 746f 5f74 6573 7420 3d20 6d69 6e28 6c65  to_test = min(le
+0007eac0: 6e28 7372 292c 6c65 6e28 7367 2929 0a0a  n(sr),len(sg))..
+0007ead0: 2020 2020 6372 203d 2063 6d61 742e 7375      cr = cmat.su
+0007eae0: 6d28 6178 6973 203d 2030 290a 2020 2020  m(axis = 0).    
+0007eaf0: 6e73 203d 206e 702e 6172 676d 6178 2820  ns = np.argmax( 
+0007eb00: 636d 6174 2c20 6178 6973 3d30 2029 0a20  cmat, axis=0 ). 
+0007eb10: 2020 2070 7220 3d20 636d 6174 5b6e 732c     pr = cmat[ns,
+0007eb20: 6e70 2e61 7261 6e67 6528 6c65 6e28 6e73  np.arange(len(ns
+0007eb30: 2929 5d2f 6372 0a0a 2020 2020 7020 3d20  ))]/cr..    p = 
+0007eb40: 300a 2020 2020 706f 735f 6c73 7420 3d20  0.    pos_lst = 
+0007eb50: 5b5d 0a20 2020 206c 656e 5f6c 7374 203d  [].    len_lst =
+0007eb60: 205b 5d0a 2020 2020 6376 675f 6c73 7420   [].    cvg_lst 
+0007eb70: 3d20 5b5d 0a20 2020 2063 6672 5f6c 7374  = [].    cfr_lst
+0007eb80: 203d 205b 5d0a 2020 2020 736e 705f 6c73   = [].    snp_ls
+0007eb90: 7420 3d20 5b5d 0a20 2020 2073 6e70 5f6f  t = [].    snp_o
+0007eba0: 7267 5f6c 7374 203d 205b 5d0a 2020 2020  rg_lst = [].    
+0007ebb0: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
+0007ebc0: 6e67 6528 6c65 6e5f 746f 5f74 6573 7429  nge(len_to_test)
+0007ebd0: 3a0a 2020 2020 2020 2020 6966 2073 725b  :.        if sr[
+0007ebe0: 6b5d 2021 3d20 7367 5b6b 5d3a 0a20 2020  k] != sg[k]:.   
+0007ebf0: 2020 2020 2020 2020 2069 6620 7020 3d3d           if p ==
+0007ec00: 2030 3a20 706f 7320 3d20 6b0a 2020 2020   0: pos = k.    
+0007ec10: 2020 2020 2020 2020 7020 2b3d 2031 0a20          p += 1. 
+0007ec20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0007ec30: 2020 2020 2020 2020 2069 6620 7020 3e20           if p > 
+0007ec40: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0007ec50: 2020 2023 2063 7667 5f6c 7374 2e61 7070     # cvg_lst.app
+0007ec60: 656e 6428 6e70 2e6d 6561 6e28 2063 725b  end(np.mean( cr[
+0007ec70: 706f 733a 2870 6f73 2b70 295d 2029 2029  pos:(pos+p)] ) )
+0007ec80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007ec90: 2023 2073 6e70 5f6c 7374 2e61 7070 656e   # snp_lst.appen
+0007eca0: 6428 7372 5b70 6f73 3a28 706f 732b 7029  d(sr[pos:(pos+p)
+0007ecb0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0007ecc0: 2020 2070 6f73 5f6c 7374 2e61 7070 656e     pos_lst.appen
+0007ecd0: 6428 706f 7329 0a20 2020 2020 2020 2020  d(pos).         
+0007ece0: 2020 2020 2020 206c 656e 5f6c 7374 2e61         len_lst.a
+0007ecf0: 7070 656e 6428 7029 0a20 2020 2020 2020  ppend(p).       
+0007ed00: 2020 2020 2020 2020 2023 2073 6e70 5f6f           # snp_o
+0007ed10: 7267 5f6c 7374 2e61 7070 656e 6428 7367  rg_lst.append(sg
+0007ed20: 5b70 6f73 3a28 706f 732b 7029 5d29 0a20  [pos:(pos+p)]). 
+0007ed30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0007ed40: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0007ed50: 200a 2020 2020 666f 7220 6b20 696e 2072   .    for k in r
+0007ed60: 616e 6765 286c 656e 2870 6f73 5f6c 7374  ange(len(pos_lst
+0007ed70: 2929 3a0a 2020 2020 2020 2020 0a20 2020  )):.        .   
+0007ed80: 2020 2020 2070 3120 3d20 6d61 7828 302c       p1 = max(0,
+0007ed90: 2870 6f73 5f6c 7374 5b6b 5d2d 4e57 494e  (pos_lst[k]-NWIN
+0007eda0: 2929 0a20 2020 2020 2020 2070 3220 3d20  )).        p2 = 
+0007edb0: 6d69 6e28 6c65 6e5f 746f 5f74 6573 742c  min(len_to_test,
+0007edc0: 2870 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f  (pos_lst[k]+len_
+0007edd0: 6c73 745b 6b5d 2b4e 5749 4e29 290a 2020  lst[k]+NWIN)).  
+0007ede0: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
+0007edf0: 6f70 203d 2073 675b 7031 3a70 6f73 5f6c  op = sg[p1:pos_l
+0007ee00: 7374 5b6b 5d5d 0a20 2020 2020 2020 2073  st[k]].        s
+0007ee10: 6f63 203d 2073 675b 706f 735f 6c73 745b  oc = sg[pos_lst[
+0007ee20: 6b5d 3a28 706f 735f 6c73 745b 6b5d 2b6c  k]:(pos_lst[k]+l
+0007ee30: 656e 5f6c 7374 5b6b 5d29 5d0a 2020 2020  en_lst[k])].    
+0007ee40: 2020 2020 736f 6e20 3d20 7367 5b28 706f      son = sg[(po
+0007ee50: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
+0007ee60: 5b6b 5d29 3a70 325d 0a20 2020 2020 2020  [k]):p2].       
+0007ee70: 200a 2020 2020 2020 2020 736e 7020 3d20   .        snp = 
+0007ee80: 7372 5b70 313a 706f 735f 6c73 745b 6b5d  sr[p1:pos_lst[k]
+0007ee90: 5d0a 2020 2020 2020 2020 736e 6320 3d20  ].        snc = 
+0007eea0: 7372 5b70 6f73 5f6c 7374 5b6b 5d3a 2870  sr[pos_lst[k]:(p
+0007eeb0: 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73  os_lst[k]+len_ls
+0007eec0: 745b 6b5d 295d 0a20 2020 2020 2020 2073  t[k])].        s
+0007eed0: 6e6e 203d 2073 725b 2870 6f73 5f6c 7374  nn = sr[(pos_lst
+0007eee0: 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d 293a  [k]+len_lst[k]):
+0007eef0: 7032 5d0a 2020 2020 2020 2020 0a20 2020  p2].        .   
+0007ef00: 2020 2020 2073 6920 3d20 534e 565f 696e       si = SNV_in
+0007ef10: 666f 2863 6872 6d2c 2070 6f73 5f6c 7374  fo(chrm, pos_lst
+0007ef20: 5b6b 5d2b 706f 735f 6162 732c 2070 6f73  [k]+pos_abs, pos
+0007ef30: 5f6c 7374 5b6b 5d2b 706f 735f 6162 732b  _lst[k]+pos_abs+
+0007ef40: 6f73 2c20 6769 6e5b 305d 2c20 6769 6e5b  os, gin[0], gin[
+0007ef50: 315d 2c20 2756 272c 206c 656e 5f6c 7374  1], 'V', len_lst
+0007ef60: 5b6b 5d2c 205c 0a20 2020 2020 2020 2020  [k], \.         
+0007ef70: 2020 2020 2020 2020 2020 2020 2069 6e74               int
+0007ef80: 2863 725b 706f 735f 6c73 745b 6b5d 5d29  (cr[pos_lst[k]])
+0007ef90: 2c20 6e70 2e72 6f75 6e64 2870 725b 706f  , np.round(pr[po
+0007efa0: 735f 6c73 745b 6b5d 5d2c 3329 2c20 736f  s_lst[k]],3), so
+0007efb0: 702c 2073 6f63 2c20 736f 6e2c 2073 6e70  p, soc, son, snp
+0007efc0: 2c20 736e 632c 2073 6e6e 2029 0a20 2020  , snc, snn ).   
+0007efd0: 2020 2020 2073 6e76 5f69 6e66 6f5f 6c73       snv_info_ls
+0007efe0: 742e 6170 7065 6e64 2873 6929 0a0a 2020  t.append(si)..  
+0007eff0: 2020 7265 7475 726e 2873 6e76 5f69 6e66    return(snv_inf
+0007f000: 6f5f 6c73 7429 0a0a 0a64 6566 2063 6f6d  o_lst)...def com
+0007f010: 7061 7265 5f73 6571 3228 2073 312c 2073  pare_seq2( s1, s
+0007f020: 3220 293a 0a20 2020 2063 6e74 203d 2030  2 ):.    cnt = 0
+0007f030: 0a20 2020 2066 6f72 2069 2069 6e20 7261  .    for i in ra
+0007f040: 6e67 6528 6d69 6e28 6c65 6e28 7331 292c  nge(min(len(s1),
+0007f050: 6c65 6e28 7332 2929 293a 0a20 2020 2020  len(s2))):.     
+0007f060: 2020 2063 6e74 202b 3d20 2873 315b 695d     cnt += (s1[i]
+0007f070: 2021 3d20 7332 5b69 5d29 0a20 2020 2023   != s2[i]).    #
+0007f080: 2069 6620 6c65 6e28 7331 2920 213d 206c   if len(s1) != l
+0007f090: 656e 2873 3229 3a20 7072 696e 7428 2757  en(s2): print('W
+0007f0a0: 4152 4e49 4e47 2069 6e20 636f 6d70 6172  ARNING in compar
+0007f0b0: 655f 7365 7132 3a20 2569 2021 3d20 2569  e_seq2: %i != %i
+0007f0c0: 2720 2520 286c 656e 2873 3129 2c6c 656e  ' % (len(s1),len
+0007f0d0: 2873 3229 2920 290a 2020 2020 7265 7475  (s2)) ).    retu
+0007f0e0: 726e 2063 6e74 0a0a 0a4f 535f 696e 666f  rn cnt...OS_info
+0007f0f0: 203d 2063 6f6c 6c65 6374 696f 6e73 2e6e   = collections.n
+0007f100: 616d 6564 7475 706c 6528 274f 535f 696e  amedtuple('OS_in
+0007f110: 666f 272c 2027 6f73 2c20 7374 6172 742c  fo', 'os, start,
+0007f120: 2065 6e64 2729 2023 206f 6e65 2d62 6173   end') # one-bas
+0007f130: 650a 0a63 6c61 7373 206f 6666 7365 745f  e..class offset_
+0007f140: 6669 6e64 6572 3a0a 2020 2020 0a20 2020  finder:.    .   
+0007f150: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0007f160: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+0007f170: 662e 6f73 695f 6c73 7420 3d20 5b5d 0a20  f.osi_lst = []. 
+0007f180: 2020 2020 2020 2073 656c 662e 6f73 5f6d         self.os_m
+0007f190: 6170 203d 204e 6f6e 650a 2020 2020 2020  ap = None.      
+0007f1a0: 2020 7365 6c66 2e6f 735f 7072 6576 203d    self.os_prev =
+0007f1b0: 2030 0a20 2020 2020 2020 200a 2020 2020   0.        .    
+0007f1c0: 6465 6620 6164 6428 2073 656c 662c 206f  def add( self, o
+0007f1d0: 732c 2073 7461 7274 2c20 656e 6429 3a0a  s, start, end):.
+0007f1e0: 2020 2020 2020 2020 7365 6c66 2e6f 7369          self.osi
+0007f1f0: 5f6c 7374 2e61 7070 656e 6428 204f 535f  _lst.append( OS_
+0007f200: 696e 666f 286f 732c 2073 7461 7274 2c20  info(os, start, 
+0007f210: 656e 6429 2029 0a20 2020 2020 2020 200a  end) ).        .
+0007f220: 2020 2020 6465 6620 6669 6e64 5f6f 7328      def find_os(
+0007f230: 2073 656c 662c 2070 6f73 2029 3a0a 2020   self, pos ):.  
+0007f240: 2020 2020 2020 6f73 203d 2030 0a20 2020        os = 0.   
+0007f250: 2020 2020 2066 6f72 206f 7369 2069 6e20       for osi in 
+0007f260: 7365 6c66 2e6f 7369 5f6c 7374 3a0a 2020  self.osi_lst:.  
+0007f270: 2020 2020 2020 2020 2020 6966 2028 706f            if (po
+0007f280: 7320 3e3d 206f 7369 2e73 7461 7274 2920  s >= osi.start) 
+0007f290: 2620 2870 6f73 203c 206f 7369 2e65 6e64  & (pos < osi.end
+0007f2a0: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
+0007f2b0: 2020 2020 6f73 203d 206f 7369 2e6f 730a      os = osi.os.
+0007f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007f2d0: 6272 6561 6b0a 2020 2020 2020 2020 7265  break.        re
+0007f2e0: 7475 726e 206f 730a 0a20 2020 200a 2020  turn os..    .  
+0007f2f0: 2020 6465 6620 6669 6e64 5f6f 735f 7365    def find_os_se
+0007f300: 7128 2073 656c 662c 2070 6f73 2c20 7072  q( self, pos, pr
+0007f310: 6576 5f69 2c20 6d61 726b 203d 2027 2720  ev_i, mark = '' 
+0007f320: 293a 0a20 2020 2020 2020 206f 7320 3d20  ):.        os = 
+0007f330: 4e6f 6e65 0a20 2020 2020 2020 206e 6578  None.        nex
+0007f340: 745f 6920 3d20 300a 2020 2020 2020 2020  t_i = 0.        
+0007f350: 666f 7220 6b2c 206f 7369 2069 6e20 656e  for k, osi in en
+0007f360: 756d 6572 6174 6528 7365 6c66 2e6f 7369  umerate(self.osi
+0007f370: 5f6c 7374 5b70 7265 765f 693a 5d29 3a0a  _lst[prev_i:]):.
+0007f380: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0007f390: 706f 7320 3e3d 206f 7369 2e73 7461 7274  pos >= osi.start
+0007f3a0: 2920 2620 2870 6f73 203c 206f 7369 2e65  ) & (pos < osi.e
+0007f3b0: 6e64 293a 200a 2020 2020 2020 2020 2020  nd): .          
+0007f3c0: 2020 2020 2020 6f73 203d 206f 7369 2e6f        os = osi.o
+0007f3d0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0007f3e0: 2020 6e65 7874 5f69 203d 206b 202b 2070    next_i = k + p
+0007f3f0: 7265 765f 6920 0a20 2020 2020 2020 2020  rev_i .         
+0007f400: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0007f410: 2020 2020 2069 6620 6f73 2069 7320 4e6f       if os is No
+0007f420: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0007f430: 666f 7220 6b2c 206f 7369 2069 6e20 656e  for k, osi in en
+0007f440: 756d 6572 6174 6528 7365 6c66 2e6f 7369  umerate(self.osi
+0007f450: 5f6c 7374 5b3a 7072 6576 5f69 5d29 3a0a  _lst[:prev_i]):.
+0007f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007f470: 6966 2028 706f 7320 3e3d 206f 7369 2e73  if (pos >= osi.s
+0007f480: 7461 7274 2920 2620 2870 6f73 203c 206f  tart) & (pos < o
+0007f490: 7369 2e65 6e64 293a 200a 2020 2020 2020  si.end): .      
+0007f4a0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+0007f4b0: 203d 206f 7369 2e6f 730a 2020 2020 2020   = osi.os.      
+0007f4c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0007f4d0: 7874 5f69 203d 206b 0a20 2020 2020 2020  xt_i = k.       
+0007f4e0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0007f4f0: 616b 0a0a 2020 2020 2020 2020 6966 206f  ak..        if o
+0007f500: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+0007f510: 2020 2020 2020 206f 7320 3d20 7365 6c66         os = self
+0007f520: 2e6f 735f 7072 6576 0a20 2020 2020 2020  .os_prev.       
+0007f530: 2020 2020 2023 2070 7269 6e74 2827 4552       # print('ER
+0007f540: 524f 5220 696e 2066 696e 645f 6f73 5f73  ROR in find_os_s
+0007f550: 6571 3a20 6f73 2069 7320 4e6f 6e65 2025  eq: os is None %
+0007f560: 7327 2025 206d 6172 6b20 290a 2020 2020  s' % mark ).    
+0007f570: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0007f580: 2020 2020 2020 7365 6c66 2e6f 735f 7072        self.os_pr
+0007f590: 6576 203d 206f 730a 2020 2020 2020 2020  ev = os.        
+0007f5a0: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
+0007f5b0: 7572 6e20 6f73 2c20 6e65 7874 5f69 0a20  urn os, next_i. 
+0007f5c0: 2020 200a 2020 2020 0a20 2020 2064 6566     .    .    def
+0007f5d0: 206d 616b 655f 6974 5f63 6f6d 7061 6374   make_it_compact
+0007f5e0: 2820 7365 6c66 2029 3a0a 0a20 2020 2020  ( self ):..     
+0007f5f0: 2020 2066 6f72 206b 2069 6e20 7265 7665     for k in reve
+0007f600: 7273 6564 2872 616e 6765 2831 2c6c 656e  rsed(range(1,len
+0007f610: 2873 656c 662e 6f73 695f 6c73 7429 2929  (self.osi_lst)))
+0007f620: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0007f630: 2073 656c 662e 6f73 695f 6c73 745b 6b5d   self.osi_lst[k]
+0007f640: 2e6f 7320 3d3d 2073 656c 662e 6f73 695f  .os == self.osi_
+0007f650: 6c73 745b 6b2d 315d 2e6f 733a 0a20 2020  lst[k-1].os:.   
+0007f660: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0007f670: 662e 6f73 695f 6c73 745b 6b2d 315d 203d  f.osi_lst[k-1] =
+0007f680: 204f 535f 696e 666f 2820 7365 6c66 2e6f   OS_info( self.o
+0007f690: 7369 5f6c 7374 5b6b 2d31 5d2e 6f73 2c20  si_lst[k-1].os, 
+0007f6a0: 7365 6c66 2e6f 7369 5f6c 7374 5b6b 2d31  self.osi_lst[k-1
+0007f6b0: 5d2e 7374 6172 742c 2073 656c 662e 6f73  ].start, self.os
+0007f6c0: 695f 6c73 745b 6b5d 2e65 6e64 2029 0a20  i_lst[k].end ). 
+0007f6d0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0007f6e0: 656c 2073 656c 662e 6f73 695f 6c73 745b  el self.osi_lst[
+0007f6f0: 6b5d 0a20 2020 2020 2020 200a 2020 2020  k].        .    
+0007f700: 6465 6620 6765 745f 626e 6472 7928 2073  def get_bndry( s
+0007f710: 656c 662c 2070 6f73 2029 3a0a 2020 2020  elf, pos ):.    
+0007f720: 2020 2020 6f73 203d 2030 0a20 2020 2020      os = 0.     
+0007f730: 2020 2066 6f72 206f 7369 2069 6e20 7365     for osi in se
+0007f740: 6c66 2e6f 7369 5f6c 7374 3a0a 2020 2020  lf.osi_lst:.    
+0007f750: 2020 2020 2020 2020 6966 2028 706f 7320          if (pos 
+0007f760: 3e3d 206f 7369 2e73 7461 7274 293a 200a  >= osi.start): .
+0007f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007f780: 6f73 203d 206f 7369 2e73 7461 7274 0a20  os = osi.start. 
+0007f790: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0007f7a0: 7265 616b 0a20 2020 2020 2020 2072 6574  reak.        ret
+0007f7b0: 7572 6e20 6f73 0a20 2020 200a 2020 2020  urn os.    .    
+0007f7c0: 6465 6620 6765 745f 626e 6472 795f 7365  def get_bndry_se
+0007f7d0: 7128 2073 656c 662c 2070 6f73 2c20 7072  q( self, pos, pr
+0007f7e0: 6576 5f69 2029 3a0a 2020 2020 2020 2020  ev_i ):.        
+0007f7f0: 6f73 203d 204e 6f6e 650a 2020 2020 2020  os = None.      
+0007f800: 2020 6e65 7874 5f69 203d 2030 0a20 2020    next_i = 0.   
+0007f810: 2020 2020 2066 6f72 206b 2c20 6f73 6920       for k, osi 
+0007f820: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
+0007f830: 662e 6f73 695f 6c73 745b 7072 6576 5f69  f.osi_lst[prev_i
+0007f840: 3a5d 293a 0a20 2020 2020 2020 2020 2020  :]):.           
+0007f850: 2069 6620 2870 6f73 203e 3d20 6f73 692e   if (pos >= osi.
+0007f860: 7374 6172 7429 2026 2028 706f 7320 3c20  start) & (pos < 
+0007f870: 6f73 692e 656e 6429 3a20 0a20 2020 2020  osi.end): .     
+0007f880: 2020 2020 2020 2020 2020 206f 7320 3d20             os = 
+0007f890: 6f73 692e 7374 6172 740a 2020 2020 2020  osi.start.      
+0007f8a0: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
+0007f8b0: 203d 206b 202b 2070 7265 765f 6920 0a20   = k + prev_i . 
+0007f8c0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0007f8d0: 7265 616b 0a20 2020 2020 2020 2069 6620  reak.        if 
+0007f8e0: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
+0007f8f0: 2020 2020 2020 2020 666f 7220 6b2c 206f          for k, o
+0007f900: 7369 2069 6e20 656e 756d 6572 6174 6528  si in enumerate(
+0007f910: 7365 6c66 2e6f 7369 5f6c 7374 5b3a 7072  self.osi_lst[:pr
+0007f920: 6576 5f69 5d29 3a0a 2020 2020 2020 2020  ev_i]):.        
+0007f930: 2020 2020 2020 2020 6966 2028 706f 7320          if (pos 
+0007f940: 3e3d 206f 7369 2e73 7461 7274 2920 2620  >= osi.start) & 
+0007f950: 2870 6f73 203c 206f 7369 2e65 6e64 293a  (pos < osi.end):
+0007f960: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0007f970: 2020 2020 2020 6f73 203d 206f 7369 2e73        os = osi.s
+0007f980: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
+0007f990: 2020 2020 2020 2020 206e 6578 745f 6920           next_i 
+0007f9a0: 3d20 6b0a 2020 2020 2020 2020 2020 2020  = k.            
+0007f9b0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0007f9c0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0007f9d0: 2020 2069 6620 6f73 2069 7320 4e6f 6e65     if os is None
+0007f9e0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+0007f9f0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0007fa00: 206e 6578 745f 6920 3d20 300a 2020 2020   next_i = 0.    
+0007fa10: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
+0007fa20: 5252 4f52 2069 6e20 6765 745f 626e 6472  RROR in get_bndr
+0007fa30: 795f 7365 713a 206f 7320 6973 204e 6f6e  y_seq: os is Non
+0007fa40: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+0007fa50: 2320 7365 6c66 2e70 7269 6e74 2829 0a20  # self.print(). 
+0007fa60: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0007fa70: 2020 2020 7265 7475 726e 206f 732c 206e      return os, n
+0007fa80: 6578 745f 690a 2020 2020 0a20 2020 200a  ext_i.    .    .
+0007fa90: 2020 2020 6465 6620 7072 696e 7428 7365      def print(se
+0007faa0: 6c66 293a 0a20 2020 2020 2020 2066 6f72  lf):.        for
+0007fab0: 206f 7369 2069 6e20 7365 6c66 2e6f 7369   osi in self.osi
+0007fac0: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
+0007fad0: 2020 7072 696e 7428 2725 6920 2d20 2569    print('%i - %i
+0007fae0: 3a20 2569 2720 2520 286f 7369 2e73 7461  : %i' % (osi.sta
+0007faf0: 7274 2c20 6f73 692e 656e 642c 206f 7369  rt, osi.end, osi
+0007fb00: 2e6f 7329 290a 0a20 2020 2020 2020 2020  .os))..         
+0007fb10: 2020 200a 6465 6620 4765 6e65 7261 7465     .def Generate
+0007fb20: 5f52 6566 6572 656e 6365 2867 7466 5f66  _Reference(gtf_f
+0007fb30: 696c 652c 2067 656e 6f6d 655f 6669 6c65  ile, genome_file
+0007fb40: 2c20 7065 7074 6964 6520 3d20 5472 7565  , peptide = True
+0007fb50: 2c20 6f75 745f 6469 7220 3d20 4e6f 6e65  , out_dir = None
+0007fb60: 2c20 7375 6666 6978 203d 204e 6f6e 6529  , suffix = None)
+0007fb70: 3a0a 0a20 2020 2067 656e 6f6d 6520 3d20  :..    genome = 
+0007fb80: 6c6f 6164 5f67 656e 6f6d 6528 6765 6e6f  load_genome(geno
+0007fb90: 6d65 5f66 696c 652c 2076 6572 626f 7365  me_file, verbose
+0007fba0: 203d 2054 7275 6529 0a0a 2020 2020 6774   = True)..    gt
+0007fbb0: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
+0007fbc0: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
+0007fbd0: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
+0007fbe0: 3d20 5472 7565 290a 2020 2020 6764 5f6c  = True).    gd_l
+0007fbf0: 7374 2c20 6368 7273 203d 2067 6574 5f67  st, chrs = get_g
+0007fc00: 656e 655f 6465 7363 7269 7074 6f72 2867  ene_descriptor(g
+0007fc10: 7466 5f6c 696e 6573 2c20 6765 6e6f 6d65  tf_lines, genome
+0007fc20: 203d 204e 6f6e 652c 2066 696c 6c20 3d20   = None, fill = 
+0007fc30: 4661 6c73 652c 205c 0a20 2020 2020 2020  False, \.       
+0007fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007fc60: 2020 2020 6367 203d 2046 616c 7365 2c20      cg = False, 
+0007fc70: 7665 7262 6f73 6520 3d20 5472 7565 2c20  verbose = True, 
+0007fc80: 6e5f 636f 7265 7320 3d20 3129 0a20 2020  n_cores = 1).   
+0007fc90: 2067 645f 6c73 7473 2c20 6368 725f 6c73   gd_lsts, chr_ls
+0007fca0: 7420 3d20 7061 636b 5f67 656e 655f 6465  t = pack_gene_de
+0007fcb0: 7363 7269 7074 6f72 2820 6764 5f6c 7374  scriptor( gd_lst
+0007fcc0: 2c20 6368 7273 2029 0a20 2020 200a 0a20  , chrs ).    .. 
+0007fcd0: 2020 2023 2066 696c 655f 6e61 6d65 203d     # file_name =
+0007fce0: 2067 7466 5f66 696c 652e 7370 6c69 7428   gtf_file.split(
+0007fcf0: 272f 2729 5b2d 315d 0a20 2020 2023 2066  '/')[-1].    # f
+0007fd00: 6e73 203d 2066 696c 655f 6e61 6d65 2e73  ns = file_name.s
+0007fd10: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
+0007fd20: 2020 2066 6e73 203d 2067 7466 5f66 696c     fns = gtf_fil
+0007fd30: 652e 7370 6c69 7428 272e 2729 5b3a 2d31  e.split('.')[:-1
+0007fd40: 5d0a 2020 2020 666e 616d 6520 3d20 2727  ].    fname = ''
+0007fd50: 0a20 2020 2066 6f72 206b 2c20 666e 2069  .    for k, fn i
+0007fd60: 6e20 656e 756d 6572 6174 6528 666e 7329  n enumerate(fns)
+0007fd70: 3a0a 2020 2020 2020 2020 6966 206b 203e  :.        if k >
+0007fd80: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0007fd90: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
+0007fda0: 272e 270a 2020 2020 2020 2020 666e 616d  '.'.        fnam
+0007fdb0: 6520 3d20 666e 616d 6520 2b20 666e 0a20  e = fname + fn. 
+0007fdc0: 2020 2069 6620 6f75 745f 6469 7220 6973     if out_dir is
+0007fdd0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0007fde0: 2020 2069 6620 6f75 745f 6469 725b 2d31     if out_dir[-1
+0007fdf0: 5d20 3d3d 2027 2f27 3a0a 2020 2020 2020  ] == '/':.      
+0007fe00: 2020 2020 2020 666e 616d 6520 3d20 6f75        fname = ou
+0007fe10: 745f 6469 7220 2b20 666e 616d 650a 2020  t_dir + fname.  
+0007fe20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0007fe30: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
+0007fe40: 6f75 745f 6469 7220 2b20 272f 2720 2b20  out_dir + '/' + 
+0007fe50: 666e 616d 650a 0a20 2020 2069 6620 7375  fname..    if su
+0007fe60: 6666 6978 2069 7320 4e6f 6e65 3a20 2020  ffix is None:   
+0007fe70: 200a 2020 2020 2020 2020 6661 5f66 696c   .        fa_fil
+0007fe80: 655f 7472 203d 2066 6e61 6d65 202b 2027  e_tr = fname + '
+0007fe90: 5f74 7261 6e73 6372 6970 746f 6d65 2e66  _transcriptome.f
+0007fea0: 6127 0a20 2020 2020 2020 2066 615f 6669  a'.        fa_fi
+0007feb0: 6c65 5f70 7220 3d20 666e 616d 6520 2b20  le_pr = fname + 
+0007fec0: 275f 7072 6f74 656f 6d65 2e66 6127 0a20  '_proteome.fa'. 
+0007fed0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0007fee0: 2066 615f 6669 6c65 5f74 7220 3d20 666e   fa_file_tr = fn
+0007fef0: 616d 6520 2b20 275f 2573 5f74 7261 6e73  ame + '_%s_trans
+0007ff00: 6372 6970 746f 6d65 2e66 6127 2025 2073  criptome.fa' % s
+0007ff10: 7566 6669 780a 2020 2020 2020 2020 6661  uffix.        fa
+0007ff20: 5f66 696c 655f 7072 203d 2066 6e61 6d65  _file_pr = fname
+0007ff30: 202b 2027 5f25 735f 7072 6f74 656f 6d65   + '_%s_proteome
+0007ff40: 2e66 6127 2025 2073 7566 6669 780a 0a20  .fa' % suffix.. 
+0007ff50: 2020 2066 615f 7472 203d 205b 5d0a 2020     fa_tr = [].  
+0007ff60: 2020 6661 5f70 7220 3d20 5b5d 0a20 2020    fa_pr = [].   
+0007ff70: 200a 2020 2020 7374 6172 745f 7469 6d65   .    start_time
+0007ff80: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
+0007ff90: 2020 206e 7472 203d 2030 0a0a 2020 2020     ntr = 0..    
+0007ffa0: 6d61 785f 6162 6e20 3d20 300a 2020 2020  max_abn = 0.    
+0007ffb0: 6d61 785f 636f 7620 3d20 300a 2020 2020  max_cov = 0.    
+0007ffc0: 666f 7220 6b6b 2c20 6368 726d 2069 6e20  for kk, chrm in 
+0007ffd0: 656e 756d 6572 6174 6528 6368 725f 6c73  enumerate(chr_ls
+0007ffe0: 7429 3a0a 2020 2020 2020 2020 666f 7220  t):.        for 
+0007fff0: 6764 2069 6e20 6764 5f6c 7374 735b 6b6b  gd in gd_lsts[kk
+00080000: 5d3a 0a20 2020 2020 2020 2020 2020 2066  ]:.            f
+00080010: 6f72 2074 6420 696e 2067 642e 7464 5f6c  or td in gd.td_l
+00080020: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00080030: 2020 2020 6966 2074 642e 6162 6e20 3e20      if td.abn > 
+00080040: 303a 206d 6178 5f61 626e 203d 206d 6178  0: max_abn = max
+00080050: 2820 6d61 785f 6162 6e2c 2074 642e 6162  ( max_abn, td.ab
+00080060: 6e20 290a 2020 2020 2020 2020 2020 2020  n ).            
+00080070: 2020 2020 6966 2074 642e 636f 7620 3e20      if td.cov > 
+00080080: 303a 206d 6178 5f63 6f76 203d 206d 6178  0: max_cov = max
+00080090: 2820 6d61 785f 636f 762c 2074 642e 636f  ( max_cov, td.co
+000800a0: 7620 290a 0a20 2020 2069 6620 6d61 785f  v )..    if max_
+000800b0: 6162 6e20 3e20 303a 2061 626e 5f74 6820  abn > 0: abn_th 
+000800c0: 3d20 4d49 4e5f 4142 4e5f 544f 5f53 454c  = MIN_ABN_TO_SEL
+000800d0: 0a20 2020 2065 6c73 653a 2061 626e 5f74  .    else: abn_t
+000800e0: 6820 3d20 300a 2020 2020 6966 206d 6178  h = 0.    if max
+000800f0: 5f63 6f76 203e 2030 3a20 636f 765f 7468  _cov > 0: cov_th
+00080100: 203d 204d 494e 5f43 4f56 5f54 4f5f 5345   = MIN_COV_TO_SE
+00080110: 4c0a 2020 2020 656c 7365 3a20 636f 765f  L.    else: cov_
+00080120: 7468 203d 2030 0a20 2020 2070 7269 6e74  th = 0.    print
+00080130: 2827 4375 746f 6666 3a20 4120 3d20 2535  ('Cutoff: A = %5
+00080140: 2e32 662c 2043 203d 2025 352e 3266 2027  .2f, C = %5.2f '
+00080150: 2025 2028 6162 6e5f 7468 2c20 636f 765f   % (abn_th, cov_
+00080160: 7468 2929 0a0a 2020 2020 666f 7220 6b6b  th))..    for kk
+00080170: 2c20 6368 726d 2069 6e20 656e 756d 6572  , chrm in enumer
+00080180: 6174 6528 6368 725f 6c73 7429 3a0a 0a20  ate(chr_lst):.. 
+00080190: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+000801a0: 2720 2b20 2720 272a 3130 302c 2065 6e64  ' + ' '*100, end
+000801b0: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
+000801c0: 6529 0a20 2020 2020 2020 2070 7269 6e74  e).        print
+000801d0: 2827 5c72 4765 6e65 7261 7469 6e67 2072  ('\rGenerating r
+000801e0: 6566 6572 656e 6365 7320 2e2e 2025 7320  eferences .. %s 
+000801f0: 2027 2025 2028 6368 726d 292c 2065 6e64   ' % (chrm), end
+00080200: 203d 2027 272c 2066 6c75 7368 203d 2054   = '', flush = T
+00080210: 7275 6529 0a0a 2020 2020 2020 2020 666f  rue)..        fo
+00080220: 7220 6764 2069 6e20 6764 5f6c 7374 735b  r gd in gd_lsts[
+00080230: 6b6b 5d3a 0a20 2020 2020 2020 2020 2020  kk]:.           
+00080240: 2023 2067 642e 6f72 6465 7228 290a 2020   # gd.order().  
+00080250: 2020 2020 2020 2020 2020 6e74 7220 2b3d            ntr +=
+00080260: 2067 642e 6e74 720a 2020 2020 2020 2020   gd.ntr.        
+00080270: 2020 2020 6661 5f74 2c20 6661 5f70 203d      fa_t, fa_p =
+00080280: 2067 642e 6765 745f 6661 7374 615f 6c69   gd.get_fasta_li
+00080290: 6e65 735f 6672 6f6d 5f67 656e 6f6d 6528  nes_from_genome(
+000802a0: 6765 6e6f 6d65 2c20 6162 6e5f 7468 203d  genome, abn_th =
+000802b0: 2061 626e 5f74 682c 2063 6f76 5f74 6820   abn_th, cov_th 
+000802c0: 3d20 636f 765f 7468 2c20 6c65 6e5f 7468  = cov_th, len_th
+000802d0: 5f74 3d20 4d49 4e5f 5452 5f4c 454e 4754  _t= MIN_TR_LENGT
+000802e0: 482c 206c 656e 5f74 685f 7020 3d20 4d49  H, len_th_p = MI
+000802f0: 4e5f 5052 5f4c 454e 4754 4829 0a20 2020  N_PR_LENGTH).   
+00080300: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00080310: 2020 2020 2020 2320 6661 5f74 203d 2066        # fa_t = f
+00080320: 696c 7465 725f 7472 735f 6c65 6e28 6661  ilter_trs_len(fa
+00080330: 5f74 2c20 6d69 6e5f 6c65 6e20 3d20 4d49  _t, min_len = MI
+00080340: 4e5f 5452 5f4c 454e 4754 4829 0a20 2020  N_TR_LENGTH).   
+00080350: 2020 2020 2020 2020 2023 2066 615f 7020           # fa_p 
+00080360: 3d20 6669 6c74 6572 5f74 7273 5f6c 656e  = filter_trs_len
+00080370: 2866 615f 702c 206d 696e 5f6c 656e 203d  (fa_p, min_len =
+00080380: 204d 494e 5f50 525f 4c45 4e47 5448 290a   MIN_PR_LENGTH).
+00080390: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000803a0: 2020 2020 2020 2020 2066 615f 7472 203d           fa_tr =
+000803b0: 2066 615f 7472 202b 2066 615f 740a 2020   fa_tr + fa_t.  
+000803c0: 2020 2020 2020 2020 2020 6661 5f70 7220            fa_pr 
+000803d0: 3d20 6661 5f70 7220 2b20 6661 5f70 0a20  = fa_pr + fa_p. 
+000803e0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+000803f0: 0a20 2020 2069 6620 286c 656e 2866 615f  .    if (len(fa_
+00080400: 7072 2920 3d3d 2030 2920 2620 2870 6570  pr) == 0) & (pep
+00080410: 7469 6465 293a 0a20 2020 2020 2020 2068  tide):.        h
+00080420: 6472 5f6c 7374 2c20 7473 6571 5f6c 7374  dr_lst, tseq_lst
+00080430: 203d 205b 5d2c 205b 5d0a 2020 2020 2020   = [], [].      
+00080440: 2020 666f 7220 6c69 6e65 2069 6e20 6661    for line in fa
+00080450: 5f74 723a 0a20 2020 2020 2020 2020 2020  _tr:.           
+00080460: 2069 6620 6c69 6e65 5b30 5d20 3d3d 2027   if line[0] == '
+00080470: 3e27 3a20 6864 725f 6c73 742e 6170 7065  >': hdr_lst.appe
+00080480: 6e64 286c 696e 655b 313a 2d31 5d29 0a20  nd(line[1:-1]). 
+00080490: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000804a0: 2074 7365 715f 6c73 742e 6170 7065 6e64   tseq_lst.append
+000804b0: 286c 696e 655b 303a 2d31 5d29 0a0a 2020  (line[0:-1])..  
+000804c0: 2020 2020 2020 6661 5f70 7220 3d20 6765        fa_pr = ge
+000804d0: 6e5f 7072 6f74 656f 6d65 5f66 726f 6d5f  n_proteome_from_
+000804e0: 7472 6173 6372 6970 746f 6d65 2868 6472  trascriptome(hdr
+000804f0: 5f6c 7374 2c20 7473 6571 5f6c 7374 2c20  _lst, tseq_lst, 
+00080500: 6c65 6e5f 7468 203d 204d 494e 5f50 525f  len_th = MIN_PR_
+00080510: 4c45 4e47 5448 2c20 7665 7262 6f73 6520  LENGTH, verbose 
+00080520: 3d20 5472 7565 2c20 7472 6172 6563 6f20  = True, trareco 
+00080530: 3d20 4661 6c73 6529 0a20 2020 2020 2020  = False).       
+00080540: 2070 5f63 616e 645f 636e 7420 3d20 6c65   p_cand_cnt = le
+00080550: 6e28 6661 5f70 7229 2f32 0a0a 2020 2020  n(fa_pr)/2..    
+00080560: 2020 2020 7072 696e 7428 275c 7247 656e      print('\rGen
+00080570: 6572 6174 696e 6720 7265 6665 7265 6e63  erating referenc
+00080580: 6573 202e 2e20 646f 6e65 2e20 2569 202d  es .. done. %i -
+00080590: 3e20 2569 2c25 6927 2025 2028 6e74 722c  > %i,%i' % (ntr,
+000805a0: 206c 656e 2866 615f 7472 292f 322c 2070   len(fa_tr)/2, p
+000805b0: 5f63 616e 645f 636e 7429 290a 2020 2020  _cand_cnt)).    
+000805c0: 656c 7365 3a0a 2020 2020 2020 2020 7072  else:.        pr
+000805d0: 696e 7428 275c 7247 656e 6572 6174 696e  int('\rGeneratin
+000805e0: 6720 7265 6665 7265 6e63 6573 202e 2e20  g references .. 
+000805f0: 646f 6e65 2e20 2569 202d 3e20 2569 2720  done. %i -> %i' 
+00080600: 2520 286e 7472 2c20 6c65 6e28 6661 5f74  % (ntr, len(fa_t
+00080610: 7229 2f32 2929 0a0a 2020 2020 7072 696e  r)/2))..    prin
+00080620: 7428 2753 6176 696e 6720 4641 5354 4120  t('Saving FASTA 
+00080630: 2e2e 272c 2065 6e64 203d 2027 272c 2066  ..', end = '', f
+00080640: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
+00080650: 2066 203d 206f 7065 6e28 6661 5f66 696c   f = open(fa_fil
+00080660: 655f 7472 2c20 2777 2b27 290a 2020 2020  e_tr, 'w+').    
+00080670: 662e 7772 6974 656c 696e 6573 2866 615f  f.writelines(fa_
+00080680: 7472 290a 2020 2020 662e 636c 6f73 6528  tr).    f.close(
+00080690: 290a 0a20 2020 2069 6620 7065 7074 6964  )..    if peptid
+000806a0: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+000806b0: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
+000806c0: 2020 2020 2020 6620 3d20 6f70 656e 2866        f = open(f
+000806d0: 615f 6669 6c65 5f70 722c 2027 772b 2729  a_file_pr, 'w+')
+000806e0: 0a20 2020 2020 2020 2066 2e77 7269 7465  .        f.write
+000806f0: 6c69 6e65 7328 6661 5f70 7229 0a20 2020  lines(fa_pr).   
+00080700: 2020 2020 2066 2e63 6c6f 7365 2829 0a0a       f.close()..
+00080710: 2020 2020 656c 6170 7365 645f 7469 6d65      elapsed_time
+00080720: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+00080730: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
+00080740: 7072 696e 7428 2720 646f 6e65 2e20 2825  print(' done. (%
+00080750: 6929 2027 2025 2028 656c 6170 7365 645f  i) ' % (elapsed_
+00080760: 7469 6d65 2929 0a20 2020 2070 7269 6e74  time)).    print
+00080770: 2827 2020 2025 7327 2025 2066 615f 6669  ('   %s' % fa_fi
+00080780: 6c65 5f74 7220 290a 2020 2020 6966 2070  le_tr ).    if p
+00080790: 6570 7469 6465 3a20 7072 696e 7428 2720  eptide: print(' 
+000807a0: 2020 2573 2720 2520 6661 5f66 696c 655f    %s' % fa_file_
+000807b0: 7072 2029 0a20 2020 200a 2020 2020 7265  pr ).    .    re
+000807c0: 7475 726e 2066 615f 6669 6c65 5f74 722c  turn fa_file_tr,
+000807d0: 2066 615f 6669 6c65 5f70 720a 2020 2020   fa_file_pr.    
+000807e0: 0a0a 6465 6620 6d63 5f63 6f72 655f 7265  ..def mc_core_re
+000807f0: 636f 6e73 7472 7563 7469 6f6e 2867 6763  construction(ggc
+00080800: 5f74 7570 6c65 293a 0a20 2020 200a 2020  _tuple):.    .  
+00080810: 2020 6764 5f73 656c 203d 2067 6763 5f74    gd_sel = ggc_t
+00080820: 7570 6c65 5b30 5d0a 2020 2020 7365 715f  uple[0].    seq_
+00080830: 6f72 6720 3d20 6767 635f 7475 706c 655b  org = ggc_tuple[
+00080840: 315d 0a20 2020 2063 6872 6d20 3d20 6767  1].    chrm = gg
+00080850: 635f 7475 706c 655b 325d 0a20 2020 200a  c_tuple[2].    .
+00080860: 2020 2020 2320 6764 5f73 656c 203d 2073      # gd_sel = s
+00080870: 6f72 745f 6465 7363 7269 7074 6f72 5f6c  ort_descriptor_l
+00080880: 7374 2867 645f 7365 6c29 0a20 2020 206e  st(gd_sel).    n
+00080890: 5f67 6420 3d20 6c65 6e28 6764 5f73 656c  _gd = len(gd_sel
+000808a0: 290a 0a20 2020 2023 2323 2323 2323 2323  )..    #########
+000808b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000808c0: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
+000808d0: 2320 636f 6c6c 6563 7420 7267 6e73 2061  # collect rgns a
+000808e0: 6e64 206d 6172 6b20 7468 6569 7220 706f  nd mark their po
+000808f0: 730a 2020 2020 0a20 2020 2073 7461 7274  s.    .    start
+00080900: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
+00080910: 6528 290a 2020 2020 6c6f 635f 6f73 203d  e().    loc_os =
+00080920: 206e 702e 7a65 726f 7328 6e5f 6764 2c64   np.zeros(n_gd,d
+00080930: 7479 7065 3d6e 702e 666c 6f61 7433 3229  type=np.float32)
+00080940: 0a20 2020 206e 756d 5f6f 7320 3d20 6e70  .    num_os = np
+00080950: 2e7a 6572 6f73 286e 5f67 642c 6474 7970  .zeros(n_gd,dtyp
+00080960: 653d 6e70 2e66 6c6f 6174 3332 290a 2020  e=np.float32).  
+00080970: 2020 7261 6c6c 203d 2072 6567 696f 6e73    rall = regions
+00080980: 2829 0a20 2020 2047 656e 655f 6964 5f6e  ().    Gene_id_n
+00080990: 616d 6520 3d20 5b5d 0a20 2020 2067 645f  ame = [].    gd_
+000809a0: 6964 785f 6f66 5f72 676e 203d 205b 5d0a  idx_of_rgn = [].
+000809b0: 2020 2020 6f73 5f63 7572 203d 2030 0a20      os_cur = 0. 
+000809c0: 2020 2072 5f70 6f73 203d 205b 5d0a 2020     r_pos = [].  
+000809d0: 2020 666f 7220 6b2c 2067 6420 696e 2065    for k, gd in e
+000809e0: 6e75 6d65 7261 7465 2867 645f 7365 6c29  numerate(gd_sel)
+000809f0: 3a0a 0a20 2020 2020 2020 2023 2320 6368  :..        ## ch
+00080a00: 6563 6b20 6966 2061 6e79 2044 206f 7220  eck if any D or 
+00080a10: 4920 6c69 6573 2077 6974 6869 6e20 616e  I lies within an
+00080a20: 2065 786f 6e0a 2020 2020 2020 2020 666f   exon.        fo
+00080a30: 7220 6520 696e 2067 642e 6578 6f6e 732e  r e in gd.exons.
+00080a40: 7267 6e73 3a0a 2020 2020 2020 2020 2020  rgns:.          
+00080a50: 2020 6966 2065 2e74 7970 6520 3d3d 2027    if e.type == '
+00080a60: 6465 6c65 7469 6f6e 273a 0a20 2020 2020  deletion':.     
+00080a70: 2020 2020 2020 2020 2020 2062 203d 2046             b = F
+00080a80: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00080a90: 2020 2020 2066 6f72 2063 2069 6e20 6764       for c in gd
+00080aa0: 2e65 786f 6e73 2e72 676e 733a 0a20 2020  .exons.rgns:.   
+00080ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080ac0: 2069 6620 2863 2e74 7970 6520 3d3d 2027   if (c.type == '
+00080ad0: 6578 6f6e 2729 3a0a 2020 2020 2020 2020  exon'):.        
+00080ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080af0: 6966 2065 2e68 6173 5f65 7874 5f69 6e74  if e.has_ext_int
+00080b00: 6572 7365 6374 696f 6e5f 7769 7468 2863  ersection_with(c
+00080b10: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00080b20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00080b30: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00080b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080b50: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00080b60: 2020 2020 2020 2020 2020 2727 270a 2020            '''.  
+00080b70: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00080b80: 2062 3a0a 2020 2020 2020 2020 2020 2020   b:.            
+00080b90: 2020 2020 2020 2020 7072 696e 7428 2757          print('W
+00080ba0: 4152 4e49 4e47 3a20 4428 2573 3a25 692d  ARNING: D(%s:%i-
+00080bb0: 2569 2920 6f76 6572 6c61 7073 2077 6974  %i) overlaps wit
+00080bc0: 6820 4528 2573 3a25 692d 2569 2927 2025  h E(%s:%i-%i)' %
+00080bd0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00080be0: 2020 2020 2020 2020 2020 2020 2028 652e               (e.
+00080bf0: 6368 722c 2065 2e73 7461 7274 2c20 652e  chr, e.start, e.
+00080c00: 656e 642c 2063 2e63 6872 2c20 632e 7374  end, c.chr, c.st
+00080c10: 6172 742c 2063 2e65 6e64 2929 0a20 2020  art, c.end)).   
+00080c20: 2020 2020 2020 2020 2020 2020 2027 2727               '''
+00080c30: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00080c40: 2065 6c69 6620 652e 7479 7065 203d 3d20   elif e.type == 
+00080c50: 2769 6e73 6572 7369 6f6e 273a 0a20 2020  'insersion':.   
+00080c60: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+00080c70: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00080c80: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
+00080c90: 6764 2e65 786f 6e73 2e72 676e 733a 0a20  gd.exons.rgns:. 
+00080ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080cb0: 2020 2069 6620 2863 2e74 7970 6520 3d3d     if (c.type ==
+00080cc0: 2027 6578 6f6e 2729 3a0a 2020 2020 2020   'exon'):.      
+00080cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080ce0: 2020 6966 2028 652e 7374 6172 7420 3e20    if (e.start > 
+00080cf0: 632e 7374 6172 7429 2026 2028 652e 7374  c.start) & (e.st
+00080d00: 6172 7420 3c20 632e 656e 6429 3a0a 2020  art < c.end):.  
+00080d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080d20: 2020 2020 2020 2020 2020 6220 3d20 5472            b = Tr
+00080d30: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00080d40: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00080d50: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00080d60: 2020 2020 2027 2727 2020 2020 0a20 2020       '''    .   
+00080d70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00080d80: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
+00080d90: 2020 2020 2020 2070 7269 6e74 2827 5741         print('WA
+00080da0: 524e 494e 473a 2049 2825 733a 2569 2d25  RNING: I(%s:%i-%
+00080db0: 6929 206f 7665 726c 6170 7320 7769 7468  i) overlaps with
+00080dc0: 2045 2825 733a 2569 2d25 6929 2720 2520   E(%s:%i-%i)' % 
+00080dd0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00080de0: 2020 2020 2020 2020 2020 2020 2865 2e63              (e.c
+00080df0: 6872 2c20 652e 7374 6172 742c 2065 2e65  hr, e.start, e.e
+00080e00: 6e64 2c20 632e 6368 722c 2063 2e73 7461  nd, c.chr, c.sta
+00080e10: 7274 2c20 632e 656e 6429 290a 2020 2020  rt, c.end)).    
+00080e20: 2020 2020 2020 2020 2020 2020 2727 2720              ''' 
+00080e30: 2020 200a 0a20 2020 2020 2020 206c 6f63     ..        loc
+00080e40: 5f6f 735b 6b5d 203d 206f 735f 6375 720a  _os[k] = os_cur.
+00080e50: 2020 2020 2020 2020 6e75 6d5f 6f73 5b6b          num_os[k
+00080e60: 5d20 3d20 6c65 6e28 6764 2e65 786f 6e73  ] = len(gd.exons
+00080e70: 2e72 676e 7329 0a20 2020 2020 2020 2072  .rgns).        r
+00080e80: 616c 6c2e 7267 6e73 203d 2072 616c 6c2e  all.rgns = rall.
+00080e90: 7267 6e73 202b 2067 642e 6578 6f6e 732e  rgns + gd.exons.
+00080ea0: 7267 6e73 0a20 2020 2020 2020 2067 5f69  rgns.        g_i
+00080eb0: 645f 6e5f 6e61 6d65 5f6c 7374 203d 2067  d_n_name_lst = g
+00080ec0: 642e 6765 745f 6769 645f 6e5f 676e 616d  d.get_gid_n_gnam
+00080ed0: 655f 6c69 7374 2829 0a20 2020 2020 2020  e_list().       
+00080ee0: 2047 656e 655f 6964 5f6e 616d 6520 3d20   Gene_id_name = 
+00080ef0: 4765 6e65 5f69 645f 6e61 6d65 202b 2067  Gene_id_name + g
+00080f00: 5f69 645f 6e5f 6e61 6d65 5f6c 7374 0a20  _id_n_name_lst. 
+00080f10: 2020 2020 2020 2067 645f 6964 785f 6f66         gd_idx_of
+00080f20: 5f72 676e 203d 2067 645f 6964 785f 6f66  _rgn = gd_idx_of
+00080f30: 5f72 676e 202b 205b 6b5d 2a6c 656e 2867  _rgn + [k]*len(g
+00080f40: 642e 6578 6f6e 732e 7267 6e73 290a 2020  d.exons.rgns).  
+00080f50: 2020 2020 2020 6f73 5f63 7572 202b 3d20        os_cur += 
+00080f60: 6c65 6e28 6764 2e65 786f 6e73 2e72 676e  len(gd.exons.rgn
+00080f70: 7329 0a0a 2020 2020 2020 2020 666f 7220  s)..        for 
+00080f80: 7220 696e 2067 642e 6578 6f6e 732e 7267  r in gd.exons.rg
+00080f90: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00080fa0: 2320 725f 706f 732e 6170 7065 6e64 2872  # r_pos.append(r
+00080fb0: 2e65 6e64 290a 2020 2020 2020 2020 2020  .end).          
+00080fc0: 2020 725f 706f 732e 6170 7065 6e64 2872    r_pos.append(r
+00080fd0: 2e73 7461 7274 290a 0a20 2020 2023 2323  .start)..    ###
+00080fe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080ff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081000: 0a20 2020 2023 2320 6765 7420 6f72 6465  .    ## get orde
+00081010: 7220 6163 636f 7264 696e 6720 746f 206c  r according to l
+00081020: 6f63 6174 696f 6e0a 2020 2020 725f 706f  ocation.    r_po
+00081030: 7320 3d20 6e70 2e61 7272 6179 2872 5f70  s = np.array(r_p
+00081040: 6f73 290a 2020 2020 6f64 7220 3d20 725f  os).    odr = r_
+00081050: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
+00081060: 2020 2066 6f72 206b 2c20 6f20 696e 2065     for k, o in e
+00081070: 6e75 6d65 7261 7465 286f 6472 293a 0a20  numerate(odr):. 
+00081080: 2020 2020 2020 2072 203d 2072 616c 6c2e         r = rall.
+00081090: 7267 6e73 5b6f 5d0a 2020 2020 2020 2020  rgns[o].        
+000810a0: 6966 2072 2e74 7970 6520 3d3d 2027 696e  if r.type == 'in
+000810b0: 7365 7273 696f 6e27 3a0a 2020 2020 2020  sersion':.      
+000810c0: 2020 2020 2020 7270 203d 2072 616c 6c2e        rp = rall.
+000810d0: 7267 6e73 5b6f 6472 5b6b 2d31 5d5d 0a20  rgns[odr[k-1]]. 
+000810e0: 2020 2020 2020 2020 2020 2069 6620 2872             if (r
+000810f0: 2e73 7461 7274 203d 3d20 7270 2e73 7461  .start == rp.sta
+00081100: 7274 2920 2620 2872 702e 7479 7065 203d  rt) & (rp.type =
+00081110: 3d20 2765 786f 6e27 293a 0a20 2020 2020  = 'exon'):.     
+00081120: 2020 2020 2020 2020 2020 206f 7020 3d20             op = 
+00081130: 6f64 725b 6b2d 315d 0a20 2020 2020 2020  odr[k-1].       
+00081140: 2020 2020 2020 2020 206f 6472 5b6b 2d31           odr[k-1
+00081150: 5d20 3d20 6f64 725b 6b5d 0a20 2020 2020  ] = odr[k].     
+00081160: 2020 2020 2020 2020 2020 206f 6472 5b6b             odr[k
+00081170: 5d20 3d20 6f70 0a20 2020 2020 2020 2020  ] = op.         
+00081180: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00081190: 2020 2020 2020 2020 2072 6e20 3d20 7261           rn = ra
+000811a0: 6c6c 2e72 676e 735b 6f64 725b 6b2b 315d  ll.rgns[odr[k+1]
+000811b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000811c0: 2020 6966 2028 726e 2e73 7461 7274 203d    if (rn.start =
+000811d0: 3d20 722e 7374 6172 7429 2026 2028 726e  = r.start) & (rn
+000811e0: 2e74 7970 6520 3d3d 2027 6578 6f6e 2729  .type == 'exon')
+000811f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00081200: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00081210: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00081220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081230: 2020 2020 2070 7269 6e74 2827 4552 524f       print('ERRO
+00081240: 5220 2569 3a20 4e6f 2063 6f6e 6e65 6374  R %i: No connect
+00081250: 696f 6e20 666f 756e 6420 666f 7220 4920  ion found for I 
+00081260: 2569 2c25 732d 2569 2c25 732d 2569 2c25  %i,%s-%i,%s-%i,%
+00081270: 7327 2025 205c 0a20 2020 2020 2020 2020  s' % \.         
+00081280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081290: 2028 6b2c 2072 702e 7374 6172 742c 7270   (k, rp.start,rp
+000812a0: 2e74 7970 652c 2072 2e73 7461 7274 2c72  .type, r.start,r
+000812b0: 2e74 7970 652c 2072 6e2e 7374 6172 742c  .type, rn.start,
+000812c0: 2072 6e2e 7479 7065 2920 290a 0a20 2020   rn.type) )..   
+000812d0: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
+000812e0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+000812f0: 6172 745f 7469 6d65 0a20 2020 2023 2070  art_time.    # p
+00081300: 7269 6e74 2827 2020 2031 2e20 646f 6e65  rint('   1. done
+00081310: 2028 2569 2920 2027 2025 2028 656c 6170   (%i)  ' % (elap
+00081320: 7365 645f 7469 6d65 292c 2066 6c75 7368  sed_time), flush
+00081330: 203d 2054 7275 6529 0a20 2020 2023 2727   = True).    #''
+00081340: 270a 0a20 2020 2023 2727 270a 2020 2020  '..    #'''.    
+00081350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081370: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00081380: 2067 6574 2020 6f66 6673 6574 5f66 696e   get  offset_fin
+00081390: 6465 7220 616e 6420 6e65 7720 6765 6e6f  der and new geno
+000813a0: 6d65 2073 6571 0a20 2020 200a 2020 2020  me seq.    .    
+000813b0: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
+000813c0: 652e 7469 6d65 2829 0a20 2020 206f 6620  e.time().    of 
+000813d0: 3d20 6f66 6673 6574 5f66 696e 6465 7228  = offset_finder(
+000813e0: 290a 2020 2020 6f73 5f63 7572 203d 2030  ).    os_cur = 0
+000813f0: 0a20 2020 2070 7265 765f 706f 7320 3d20  .    prev_pos = 
+00081400: 3120 2320 6f6e 652d 6261 7365 0a20 2020  1 # one-base.   
+00081410: 206c 6173 745f 706f 7320 3d20 3120 2320   last_pos = 1 # 
+00081420: 6f6e 652d 6261 7365 0a0a 2020 2020 7365  one-base..    se
+00081430: 715f 6c73 7420 3d20 5b5d 0a0a 2020 2020  q_lst = []..    
+00081440: 666f 7220 6d2c 206b 2069 6e20 656e 756d  for m, k in enum
+00081450: 6572 6174 6528 6f64 7229 3a0a 2020 2020  erate(odr):.    
+00081460: 2020 2020 7220 3d20 7261 6c6c 2e72 676e      r = rall.rgn
+00081470: 735b 6b5d 0a0a 2020 2020 2020 2020 6966  s[k]..        if
+00081480: 2072 2e74 7970 6520 3d3d 2027 6578 6f6e   r.type == 'exon
+00081490: 273a 0a20 2020 2020 2020 2020 2020 2069  ':.            i
+000814a0: 6620 2872 2e73 7461 7274 2920 3c20 2870  f (r.start) < (p
+000814b0: 7265 765f 706f 7329 3a0a 2020 2020 2020  rev_pos):.      
+000814c0: 2020 2020 2020 2020 2020 6966 2072 2e65            if r.e
+000814d0: 6e64 203c 2070 7265 765f 706f 733a 0a20  nd < prev_pos:. 
+000814e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000814f0: 2020 2023 2070 7269 6e74 2827 2569 2057     # print('%i W
+00081500: 4152 4e49 4e47 2028 4541 293a 2025 732c  ARNING (EA): %s,
+00081510: 2025 692d 2569 203c 3d20 2569 2c20 2569   %i-%i <= %i, %i
+00081520: 2f25 6927 2025 2028 6d2c 2072 2e63 6872  /%i' % (m, r.chr
+00081530: 2c20 722e 7374 6172 742c 2072 2e65 6e64  , r.start, r.end
+00081540: 2c20 7072 6576 5f70 6f73 2c20 6d2c 206c  , prev_pos, m, l
+00081550: 656e 286f 6472 2929 2029 0a20 2020 2020  en(odr)) ).     
+00081560: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00081570: 5f6f 7267 203d 2073 6571 5f6f 7267 5b28  _org = seq_org[(
+00081580: 722e 7374 6172 742d 3129 3a28 722e 656e  r.start-1):(r.en
+00081590: 6429 5d0a 2020 2020 2020 2020 2020 2020  d)].            
+000815a0: 2020 2020 2020 2020 722e 636f 6d70 6172          r.compar
+000815b0: 655f 616e 645f 7265 706c 6163 655f 4e28  e_and_replace_N(
+000815c0: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
+000815d0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+000815e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000815f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00081600: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+00081610: 7428 2725 6920 5741 524e 494e 4720 2845  t('%i WARNING (E
+00081620: 4229 3a20 2573 2c20 2569 2d25 6920 3c3d  B): %s, %i-%i <=
+00081630: 2025 6927 2025 2028 6d2c 2072 2e63 6872   %i' % (m, r.chr
+00081640: 2c20 722e 7374 6172 742c 2072 2e65 6e64  , r.start, r.end
+00081650: 2c20 7072 6576 5f70 6f73 2920 290a 2020  , prev_pos) ).  
+00081660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081670: 2020 735f 6f72 6720 3d20 7365 715f 6f72    s_org = seq_or
+00081680: 675b 2872 2e73 7461 7274 2d31 293a 2872  g[(r.start-1):(r
+00081690: 2e65 6e64 295d 0a20 2020 2020 2020 2020  .end)].         
+000816a0: 2020 2020 2020 2020 2020 2072 2e63 6f6d             r.com
+000816b0: 7061 7265 5f61 6e64 5f72 6570 6c61 6365  pare_and_replace
+000816c0: 5f4e 2873 5f6f 7267 290a 2020 2020 2020  _N(s_org).      
+000816d0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+000816e0: 203d 2028 7072 6576 5f70 6f73 2d72 2e73   = (prev_pos-r.s
+000816f0: 7461 7274 290a 2020 2020 2020 2020 2020  tart).          
+00081700: 2020 2020 2020 2020 2020 7365 715f 6c73            seq_ls
+00081710: 742e 6170 7065 6e64 2872 2e73 6571 5b73  t.append(r.seq[s
+00081720: 703a 5d29 0a0a 2020 2020 2020 2020 2020  p:])..          
+00081730: 2020 2020 2020 2020 2020 6f66 2e61 6464            of.add
+00081740: 2820 6f73 5f63 7572 2c20 7072 6576 5f70  ( os_cur, prev_p
+00081750: 6f73 2c20 722e 656e 642b 3120 290a 2020  os, r.end+1 ).  
+00081760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081770: 2020 7072 6576 5f70 6f73 203d 2072 2e65    prev_pos = r.e
+00081780: 6e64 2b31 0a0a 2020 2020 2020 2020 2020  nd+1..          
+00081790: 2020 656c 7365 3a20 2020 2020 2020 2020    else:         
+000817a0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+000817b0: 2020 2020 2020 2073 5f6f 7267 203d 2073         s_org = s
+000817c0: 6571 5f6f 7267 5b28 722e 7374 6172 742d  eq_org[(r.start-
+000817d0: 3129 3a28 722e 656e 6429 5d0a 2020 2020  1):(r.end)].    
+000817e0: 2020 2020 2020 2020 2020 2020 2369 6620              #if 
+000817f0: 6c65 6e28 735f 6f72 6729 203d 3d20 6c65  len(s_org) == le
+00081800: 6e28 722e 7365 7129 3a0a 2020 2020 2020  n(r.seq):.      
+00081810: 2020 2020 2020 2020 2020 722e 636f 6d70            r.comp
+00081820: 6172 655f 616e 645f 7265 706c 6163 655f  are_and_replace_
+00081830: 4e28 735f 6f72 6729 0a20 2020 2020 2020  N(s_org).       
+00081840: 2020 2020 2020 2020 2023 2065 6c73 653a           # else:
+00081850: 2020 7072 696e 7428 2027 5741 524e 494e    print( 'WARNIN
+00081860: 473a 2025 692d 2569 2069 6e20 2569 207e  G: %i-%i in %i ~
+00081870: 3d20 2569 2720 2520 2872 2e73 7461 7274  = %i' % (r.start
+00081880: 2c20 722e 656e 642c 206c 656e 2873 5f6f  , r.end, len(s_o
+00081890: 7267 292c 206c 656e 2872 2e73 6571 2929  rg), len(r.seq))
+000818a0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+000818b0: 2020 2020 6966 2072 2e73 7461 7274 203e      if r.start >
+000818c0: 2070 7265 765f 706f 733a 0a20 2020 2020   prev_pos:.     
+000818d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000818e0: 6571 5f6c 7374 2e61 7070 656e 6428 7365  eq_lst.append(se
+000818f0: 715f 6f72 675b 2870 7265 765f 706f 732d  q_org[(prev_pos-
+00081900: 3129 3a28 722e 7374 6172 742d 3129 5d29  1):(r.start-1)])
+00081910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081920: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00081930: 2020 2020 2020 7365 715f 6c73 742e 6170        seq_lst.ap
+00081940: 7065 6e64 2872 2e73 6571 290a 2020 2020  pend(r.seq).    
+00081950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081970: 206f 662e 6164 6428 206f 735f 6375 722c   of.add( os_cur,
+00081980: 2070 7265 765f 706f 732c 2072 2e65 6e64   prev_pos, r.end
+00081990: 2b31 2029 0a20 2020 2020 2020 2020 2020  +1 ).           
+000819a0: 2020 2020 2070 7265 765f 706f 7320 3d20       prev_pos = 
+000819b0: 722e 656e 642b 310a 2020 2020 2020 2020  r.end+1.        
+000819c0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000819d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000819e0: 6c65 6e28 722e 7365 7129 2021 3d20 6c65  len(r.seq) != le
+000819f0: 6e28 735f 6f72 6729 3a0a 2020 2020 2020  n(s_org):.      
+00081a00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00081a10: 7072 696e 7428 2027 5741 524e 494e 473a  print( 'WARNING:
+00081a20: 2025 733a 2025 692d 2569 2069 6e20 2569   %s: %i-%i in %i
+00081a30: 207e 3d20 2569 2720 2520 2872 2e63 6872   ~= %i' % (r.chr
+00081a40: 2c20 722e 7374 6172 742c 2072 2e65 6e64  , r.start, r.end
+00081a50: 2c20 6c65 6e28 735f 6f72 6729 2c20 6c65  , len(s_org), le
+00081a60: 6e28 722e 7365 7129 2920 290a 2020 2020  n(r.seq)) ).    
+00081a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081a80: 2320 7365 715f 6c73 742e 6170 7065 6e64  # seq_lst.append
+00081a90: 2873 5f6f 7267 290a 2020 2020 2020 2020  (s_org).        
+00081aa0: 2020 2020 2020 2020 2020 2020 2320 722e              # r.
+00081ab0: 7365 7120 3d20 7265 6769 6f6e 2872 2e63  seq = region(r.c
+00081ac0: 6872 2c20 722e 7374 6172 742c 2072 2e65  hr, r.start, r.e
+00081ad0: 6e64 2c20 722e 7479 7065 2c20 735f 6f72  nd, r.type, s_or
+00081ae0: 672c 2063 7667 5f64 6570 203d 2043 5647  g, cvg_dep = CVG
+00081af0: 5f44 4550 5448 5f54 4d50 2029 0a20 2020  _DEPTH_TMP ).   
+00081b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081b10: 2023 2072 2e67 6574 5f63 7667 2829 0a20   # r.get_cvg(). 
+00081b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081b30: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00081b40: 2020 2020 2020 2020 2020 2020 0a0a 2020              ..  
+00081b50: 2020 2020 2020 656c 6966 2028 722e 7479        elif (r.ty
+00081b60: 7065 203d 3d20 2769 6e73 6572 7369 6f6e  pe == 'insersion
+00081b70: 2729 207c 2028 722e 7479 7065 203d 3d20  ') | (r.type == 
+00081b80: 2749 2720 293a 0a20 2020 2020 2020 2020  'I' ):.         
+00081b90: 2020 2069 6620 2872 2e73 7461 7274 2920     if (r.start) 
+00081ba0: 3c20 2870 7265 765f 706f 7329 3a0a 2020  < (prev_pos):.  
+00081bb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00081bc0: 7072 696e 7428 2757 4152 4e49 4e47 2028  print('WARNING (
+00081bd0: 4929 3a20 2569 202d 2025 732c 2025 6920  I): %i - %s, %i 
+00081be0: 3c20 2569 2720 2520 286d 2c20 722e 6368  < %i' % (m, r.ch
+00081bf0: 722c 2072 2e73 7461 7274 2c20 7072 6576  r, r.start, prev
+00081c00: 5f70 6f73 2920 290a 2020 2020 2020 2020  _pos) ).        
+00081c10: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00081c20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00081c30: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00081c40: 662e 6164 6428 206f 735f 6375 722c 2070  f.add( os_cur, p
+00081c50: 7265 765f 706f 732c 2072 2e73 7461 7274  rev_pos, r.start
+00081c60: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00081c70: 2020 206f 735f 6375 7220 2b3d 2028 722e     os_cur += (r.
+00081c80: 656e 6420 2d20 722e 7374 6172 7420 2b20  end - r.start + 
+00081c90: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
+00081ca0: 2020 2020 6966 2072 2e73 7461 7274 203e      if r.start >
+00081cb0: 2070 7265 765f 706f 733a 0a20 2020 2020   prev_pos:.     
+00081cc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00081cd0: 6571 5f6c 7374 2e61 7070 656e 6428 7365  eq_lst.append(se
+00081ce0: 715f 6f72 675b 2870 7265 765f 706f 732d  q_org[(prev_pos-
+00081cf0: 3129 3a28 722e 7374 6172 742d 3129 5d29  1):(r.start-1)])
+00081d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081d10: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
+00081d20: 722e 7365 7129 0a0a 2020 2020 2020 2020  r.seq)..        
+00081d30: 2020 2020 2020 2020 7072 6576 5f70 6f73          prev_pos
+00081d40: 203d 2072 2e73 7461 7274 0a0a 2020 2020   = r.start..    
+00081d50: 2020 2020 656c 6966 2028 722e 7479 7065      elif (r.type
+00081d60: 203d 3d20 2764 656c 6574 696f 6e27 2920   == 'deletion') 
+00081d70: 7c20 2872 2e74 7970 6520 3d3d 2027 4427  | (r.type == 'D'
+00081d80: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00081d90: 6966 2028 722e 7374 6172 7429 203c 2028  if (r.start) < (
+00081da0: 7072 6576 5f70 6f73 293a 0a20 2020 2020  prev_pos):.     
+00081db0: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
+00081dc0: 6e74 2827 5741 524e 494e 4720 2844 293a  nt('WARNING (D):
+00081dd0: 2025 6920 2d20 2573 2c20 2569 203c 3d20   %i - %s, %i <= 
+00081de0: 2569 2720 2520 286d 2c20 722e 6368 722c  %i' % (m, r.chr,
+00081df0: 2072 2e73 7461 7274 2c20 7072 6576 5f70   r.start, prev_p
+00081e00: 6f73 2920 290a 2020 2020 2020 2020 2020  os) ).          
+00081e10: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00081e20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00081e30: 2020 2020 2020 2020 2020 2020 206f 662e               of.
+00081e40: 6164 6428 206f 735f 6375 722c 2070 7265  add( os_cur, pre
+00081e50: 765f 706f 732c 2072 2e73 7461 7274 2029  v_pos, r.start )
+00081e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081e70: 206f 735f 6375 7220 2d3d 2028 722e 656e   os_cur -= (r.en
+00081e80: 6420 2d20 722e 7374 6172 7420 2b20 3129  d - r.start + 1)
+00081e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081ea0: 2070 7265 765f 706f 7320 3d20 722e 7374   prev_pos = r.st
+00081eb0: 6172 740a 0a20 2020 2020 2020 2020 2020  art..           
+00081ec0: 2020 2020 206f 662e 6164 6428 206f 735f       of.add( os_
+00081ed0: 6375 722c 2070 7265 765f 706f 732c 2072  cur, prev_pos, r
+00081ee0: 2e65 6e64 2b31 2029 0a20 2020 2020 2020  .end+1 ).       
+00081ef0: 2020 2020 2020 2020 2070 7265 765f 706f           prev_po
+00081f00: 7320 3d20 722e 656e 642b 310a 0a20 2020  s = r.end+1..   
+00081f10: 2020 2020 206c 6173 745f 706f 7320 3d20       last_pos = 
+00081f20: 722e 656e 640a 0a20 2020 2073 6571 5f6c  r.end..    seq_l
+00081f30: 7374 2e61 7070 656e 6428 7365 715f 6f72  st.append(seq_or
+00081f40: 675b 2870 7265 765f 706f 732d 3129 3a5d  g[(prev_pos-1):]
+00081f50: 290a 2020 2020 7365 715f 6e65 7720 3d20  ).    seq_new = 
+00081f60: 2727 2e6a 6f69 6e28 7365 715f 6c73 7429  ''.join(seq_lst)
+00081f70: 0a0a 2020 2020 2320 6966 206c 6173 745f  ..    # if last_
+00081f80: 706f 7320 3e20 7072 6576 5f70 6f73 3a0a  pos > prev_pos:.
+00081f90: 2020 2020 6f66 2e61 6464 2820 6f73 5f63      of.add( os_c
+00081fa0: 7572 2c20 7072 6576 5f70 6f73 2c20 6c65  ur, prev_pos, le
+00081fb0: 6e28 7365 715f 6f72 6729 202b 2031 3030  n(seq_org) + 100
+00081fc0: 3030 3020 290a 0a20 2020 2065 6c61 7073  000 )..    elaps
+00081fd0: 6564 5f74 696d 6520 3d20 7469 6d65 2e74  ed_time = time.t
+00081fe0: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
+00081ff0: 6d65 0a20 2020 2023 2070 7269 6e74 2827  me.    # print('
+00082000: 2020 2032 2e20 646f 6e65 2028 2569 2920     2. done (%i) 
+00082010: 2027 2025 2028 656c 6170 7365 645f 7469   ' % (elapsed_ti
+00082020: 6d65 292c 2066 6c75 7368 203d 2054 7275  me), flush = Tru
+00082030: 6529 0a20 2020 2023 2727 270a 0a20 2020  e).    #'''..   
+00082040: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00082050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00082060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00082070: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00082080: 2055 7365 206f 6666 7365 745f 6669 6e64   Use offset_find
+00082090: 6572 2074 6f20 636f 7272 6563 7420 706f  er to correct po
+000820a0: 7369 7469 6f6e 7320 696e 2047 5446 2065  sitions in GTF e
+000820b0: 6e74 7269 6573 0a20 2020 2023 2320 616c  ntries.    ## al
+000820c0: 736f 2067 6574 2072 676e 7320 6672 6167  so get rgns frag
+000820d0: 6d65 6e74 7320 7768 656e 2073 706c 6974  ments when split
+000820e0: 2069 7320 7265 7175 6972 6564 0a0a 2020   is required..  
+000820f0: 2020 6f66 2e6d 616b 655f 6974 5f63 6f6d    of.make_it_com
+00082100: 7061 6374 2829 0a20 2020 200a 2020 2020  pact().    .    
+00082110: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
+00082120: 652e 7469 6d65 2829 0a20 2020 2072 5f74  e.time().    r_t
+00082130: 6f5f 6164 6420 3d20 5b5d 0a20 2020 2070  o_add = [].    p
+00082140: 6f73 5f74 6f5f 6164 6420 3d20 5b5d 0a20  os_to_add = []. 
+00082150: 2020 2073 6e76 5f69 6e66 6f5f 6368 7220     snv_info_chr 
+00082160: 3d20 5b5d 0a0a 2020 2020 666f 7220 6764  = []..    for gd
+00082170: 2069 6e20 6764 5f73 656c 3a0a 2020 2020   in gd_sel:.    
+00082180: 2020 2020 6764 2e6e 765f 696e 666f 5f6c      gd.nv_info_l
+00082190: 7374 203d 205b 5d0a 0a20 2020 2070 7265  st = []..    pre
+000821a0: 765f 6f66 6920 3d20 300a 2020 2020 765f  v_ofi = 0.    v_
+000821b0: 636e 7420 3d20 300a 2020 2020 2366 6f72  cnt = 0.    #for
+000821c0: 206b 2c20 7220 696e 2065 6e75 6d65 7261   k, r in enumera
+000821d0: 7465 2872 616c 6c2e 7267 6e73 293a 0a20  te(rall.rgns):. 
+000821e0: 2020 2066 6f72 206d 2c20 6b20 696e 2065     for m, k in e
+000821f0: 6e75 6d65 7261 7465 286f 6472 293a 0a20  numerate(odr):. 
+00082200: 2020 2020 2020 2072 203d 2072 616c 6c2e         r = rall.
+00082210: 7267 6e73 5b6b 5d0a 2020 2020 2020 2020  rgns[k].        
+00082220: 6769 6e20 3d20 4765 6e65 5f69 645f 6e61  gin = Gene_id_na
+00082230: 6d65 5b6b 5d0a 2020 2020 2020 2020 0a20  me[k].        . 
+00082240: 2020 2020 2020 206f 7373 2c20 7072 6576         oss, prev
+00082250: 5f6f 6631 203d 206f 662e 6669 6e64 5f6f  _of1 = of.find_o
+00082260: 735f 7365 7128 722e 7374 6172 742c 2070  s_seq(r.start, p
+00082270: 7265 765f 6f66 6929 0a20 2020 2020 2020  rev_ofi).       
+00082280: 2023 206f 7365 203d 206f 7373 0a20 2020   # ose = oss.   
+00082290: 2020 2020 206f 7365 2c20 7072 6576 5f6f       ose, prev_o
+000822a0: 6632 203d 206f 662e 6669 6e64 5f6f 735f  f2 = of.find_os_
+000822b0: 7365 7128 722e 656e 642c 2070 7265 765f  seq(r.end, prev_
+000822c0: 6f66 6929 0a20 0a20 2020 2020 2020 2072  ofi). .        r
+000822d0: 2e67 6574 5f63 7667 2829 0a20 2020 2020  .get_cvg().     
+000822e0: 2020 2023 2069 6620 722e 6376 6720 6973     # if r.cvg is
+000822f0: 204e 6f6e 653a 2072 2e63 7667 203d 206e   None: r.cvg = n
+00082300: 702e 6f6e 6573 286c 656e 2872 2e73 6571  p.ones(len(r.seq
+00082310: 2929 0a0a 2020 2020 2020 2020 6966 2072  ))..        if r
+00082320: 2e74 7970 6520 3d3d 2027 6578 6f6e 273a  .type == 'exon':
+00082330: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00082340: 2020 2020 2020 2020 2020 6966 2028 6f73            if (os
+00082350: 7320 3d3d 206f 7365 293a 0a0a 2020 2020  s == ose):..    
+00082360: 2020 2020 2020 2020 2020 2020 2320 7369              # si
+00082370: 5f6c 7374 203d 2066 696e 645f 736e 7028  _lst = find_snp(
+00082380: 7365 715f 6f72 675b 2872 2e73 7461 7274  seq_org[(r.start
+00082390: 2d31 293a 722e 656e 645d 2c20 722e 7365  -1):r.end], r.se
+000823a0: 712c 2072 2e67 6574 5f63 7667 2829 2c20  q, r.get_cvg(), 
+000823b0: 6368 726d 2c20 722e 7374 6172 742c 206f  chrm, r.start, o
+000823c0: 7373 290a 2020 2020 2020 2020 2020 2020  ss).            
+000823d0: 2020 2020 7369 5f6c 7374 203d 2066 696e      si_lst = fin
+000823e0: 645f 736e 7028 7365 715f 6f72 675b 2872  d_snp(seq_org[(r
+000823f0: 2e73 7461 7274 2d31 293a 722e 656e 645d  .start-1):r.end]
+00082400: 2c20 722e 7365 712c 2072 2e63 6d61 742c  , r.seq, r.cmat,
+00082410: 2063 6872 6d2c 2072 2e73 7461 7274 2c20   chrm, r.start, 
+00082420: 6f73 732c 2067 696e 290a 2020 2020 2020  oss, gin).      
+00082430: 2020 2020 2020 2020 2020 736e 765f 696e            snv_in
+00082440: 666f 5f63 6872 203d 2073 6e76 5f69 6e66  fo_chr = snv_inf
+00082450: 6f5f 6368 7220 2b20 7369 5f6c 7374 0a20  o_chr + si_lst. 
+00082460: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00082470: 645f 6964 7820 3d20 6764 5f69 6478 5f6f  d_idx = gd_idx_o
+00082480: 665f 7267 6e5b 6b5d 0a20 2020 2020 2020  f_rgn[k].       
+00082490: 2020 2020 2020 2020 2067 645f 7365 6c5b           gd_sel[
+000824a0: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
+000824b0: 6c73 7420 3d20 6764 5f73 656c 5b67 645f  lst = gd_sel[gd_
+000824c0: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
+000824d0: 202b 2073 695f 6c73 740a 0a20 2020 2020   + si_lst..     
+000824e0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
+000824f0: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
+00082500: 2020 2020 2020 2020 2020 722e 656e 6420            r.end 
+00082510: 2b3d 206f 7365 0a20 2020 2020 2020 2020  += ose.         
+00082520: 2020 2020 2020 2072 616c 6c2e 7267 6e73         rall.rgns
+00082530: 5b6b 5d20 3d20 7220 2320 2e63 6f70 7928  [k] = r # .copy(
+00082540: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
+00082550: 656c 6966 2028 6f73 7320 3c20 6f73 6529  elif (oss < ose)
+00082560: 3a20 2320 496e 7365 7273 696f 6e20 696e  : # Insersion in
+00082570: 2062 6574 7765 656e 0a0a 2020 2020 2020   between..      
+00082580: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00082590: 2720 2020 2569 206f 7373 203c 206f 7365  '   %i oss < ose
+000825a0: 2720 2520 6b29 0a20 2020 2020 2020 2020  ' % k).         
+000825b0: 2020 2020 2020 2023 2072 2e70 7269 6e74         # r.print
+000825c0: 5f73 686f 7274 2829 0a20 2020 2020 2020  _short().       
+000825d0: 2020 2020 2020 2020 2070 2c20 7072 6576           p, prev
+000825e0: 5f6f 6632 203d 206f 662e 6765 745f 626e  _of2 = of.get_bn
+000825f0: 6472 795f 7365 7128 6f73 652c 2070 7265  dry_seq(ose, pre
+00082600: 765f 6f66 6929 0a0a 2020 2020 2020 2020  v_ofi)..        
+00082610: 2020 2020 2020 2020 2323 2073 706c 6974          ## split
+00082620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00082630: 204c 7220 3d20 722e 656e 6420 2d20 722e   Lr = r.end - r.
+00082640: 7374 6172 7420 2b31 0a20 2020 2020 2020  start +1.       
+00082650: 2020 2020 2020 2020 204c 6e20 3d20 722e           Ln = r.
+00082660: 656e 6420 2d20 7020 2b20 310a 2020 2020  end - p + 1.    
+00082670: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
+00082680: 6e65 7720 3d20 7265 6769 6f6e 2820 722e  new = region( r.
+00082690: 6368 722c 2070 2b6f 7365 2c20 722e 656e  chr, p+ose, r.en
+000826a0: 642b 6f73 652c 2072 2e74 7970 652c 2072  d+ose, r.type, r
+000826b0: 2e63 6d61 745b 3a2c 2d4c 6e3a 5d2c 2078  .cmat[:,-Ln:], x
+000826c0: 7320 3d20 722e 7873 290a 2020 2020 2020  s = r.xs).      
+000826d0: 2020 2020 2020 2020 2020 7267 6e5f 6e65            rgn_ne
+000826e0: 772e 6765 745f 6376 6728 290a 2020 2020  w.get_cvg().    
+000826f0: 2020 2020 2020 2020 2020 2020 725f 746f              r_to
+00082700: 5f61 6464 2e61 7070 656e 6428 7267 6e5f  _add.append(rgn_
+00082710: 6e65 7729 0a20 2020 2020 2020 2020 2020  new).           
+00082720: 2020 2020 2070 6f73 5f74 6f5f 6164 642e       pos_to_add.
+00082730: 6170 7065 6e64 286b 2b31 290a 0a20 2020  append(k+1)..   
+00082740: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+00082750: 695f 6c73 7420 3d20 6669 6e64 5f73 6e70  i_lst = find_snp
+00082760: 2873 6571 5f6f 7267 5b28 702d 3129 3a72  (seq_org[(p-1):r
+00082770: 2e65 6e64 5d2c 2072 676e 5f6e 6577 2e73  .end], rgn_new.s
+00082780: 6571 2c20 7267 6e5f 6e65 772e 6765 745f  eq, rgn_new.get_
+00082790: 6376 6728 292c 2063 6872 6d2c 2070 2c20  cvg(), chrm, p, 
+000827a0: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
+000827b0: 2020 2020 2073 695f 6c73 7420 3d20 6669       si_lst = fi
+000827c0: 6e64 5f73 6e70 2873 6571 5f6f 7267 5b28  nd_snp(seq_org[(
+000827d0: 702d 3129 3a72 2e65 6e64 5d2c 2072 676e  p-1):r.end], rgn
+000827e0: 5f6e 6577 2e73 6571 2c20 7267 6e5f 6e65  _new.seq, rgn_ne
+000827f0: 772e 636d 6174 2c20 6368 726d 2c20 702c  w.cmat, chrm, p,
+00082800: 206f 7365 2c20 6769 6e29 0a20 2020 2020   ose, gin).     
+00082810: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
+00082820: 6e66 6f5f 6368 7220 3d20 736e 765f 696e  nfo_chr = snv_in
+00082830: 666f 5f63 6872 202b 2073 695f 6c73 740a  fo_chr + si_lst.
+00082840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082850: 6764 5f69 6478 203d 2067 645f 6964 785f  gd_idx = gd_idx_
+00082860: 6f66 5f72 676e 5b6b 5d0a 2020 2020 2020  of_rgn[k].      
+00082870: 2020 2020 2020 2020 2020 6764 5f73 656c            gd_sel
+00082880: 5b67 645f 6964 785d 2e6e 765f 696e 666f  [gd_idx].nv_info
+00082890: 5f6c 7374 203d 2067 645f 7365 6c5b 6764  _lst = gd_sel[gd
+000828a0: 5f69 6478 5d2e 6e76 5f69 6e66 6f5f 6c73  _idx].nv_info_ls
+000828b0: 7420 2b20 7369 5f6c 7374 0a0a 2020 2020  t + si_lst..    
+000828c0: 2020 2020 2020 2020 2020 2020 722e 656e              r.en
+000828d0: 6420 3d20 702d 312b 6f73 730a 2020 2020  d = p-1+oss.    
+000828e0: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
+000828f0: 6172 7420 2b3d 206f 7373 0a20 2020 2020  art += oss.     
+00082900: 2020 2020 2020 2020 2020 204c 6e20 3d20             Ln = 
+00082910: 722e 656e 6420 2d20 722e 7374 6172 7420  r.end - r.start 
+00082920: 2b31 0a20 2020 2020 2020 2020 2020 2020  +1.             
+00082930: 2020 2072 2e63 6d61 7420 3d20 722e 636d     r.cmat = r.cm
+00082940: 6174 5b3a 2c3a 4c6e 5d0a 2020 2020 2020  at[:,:Ln].      
+00082950: 2020 2020 2020 2020 2020 722e 7365 7120            r.seq 
+00082960: 3d20 722e 7365 715b 3a4c 6e5d 0a20 2020  = r.seq[:Ln].   
+00082970: 2020 2020 2020 2020 2020 2020 2072 2e63               r.c
+00082980: 7667 203d 2072 2e63 7667 5b3a 4c6e 5d0a  vg = r.cvg[:Ln].
+00082990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000829a0: 2320 722e 6765 745f 6376 6728 290a 2020  # r.get_cvg().  
+000829b0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000829c0: 6c6c 2e72 676e 735b 6b5d 203d 2072 2023  ll.rgns[k] = r #
+000829d0: 202e 636f 7079 2829 0a0a 2020 2020 2020   .copy()..      
+000829e0: 2020 2020 2020 2020 2020 2320 7369 5f6c            # si_l
+000829f0: 7374 203d 2066 696e 645f 736e 7028 7365  st = find_snp(se
+00082a00: 715f 6f72 675b 2872 2e73 7461 7274 2d6f  q_org[(r.start-o
+00082a10: 7373 2d31 293a 705d 2c20 722e 7365 712c  ss-1):p], r.seq,
+00082a20: 2072 2e67 6574 5f63 7667 2829 2c20 6368   r.get_cvg(), ch
+00082a30: 726d 2c20 722e 7374 6172 742d 6f73 732c  rm, r.start-oss,
+00082a40: 206f 7373 290a 2020 2020 2020 2020 2020   oss).          
+00082a50: 2020 2020 2020 7369 5f6c 7374 203d 2066        si_lst = f
+00082a60: 696e 645f 736e 7028 7365 715f 6f72 675b  ind_snp(seq_org[
+00082a70: 2872 2e73 7461 7274 2d6f 7373 2d31 293a  (r.start-oss-1):
+00082a80: 705d 2c20 722e 7365 712c 2072 2e63 6d61  p], r.seq, r.cma
+00082a90: 742c 2063 6872 6d2c 2072 2e73 7461 7274  t, chrm, r.start
+00082aa0: 2d6f 7373 2c20 6f73 732c 2067 696e 290a  -oss, oss, gin).
+00082ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082ac0: 736e 765f 696e 666f 5f63 6872 203d 2073  snv_info_chr = s
+00082ad0: 6e76 5f69 6e66 6f5f 6368 7220 2b20 7369  nv_info_chr + si
+00082ae0: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+00082af0: 2020 2020 2067 645f 6964 7820 3d20 6764       gd_idx = gd
+00082b00: 5f69 6478 5f6f 665f 7267 6e5b 6b5d 0a20  _idx_of_rgn[k]. 
+00082b10: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00082b20: 645f 7365 6c5b 6764 5f69 6478 5d2e 6e76  d_sel[gd_idx].nv
+00082b30: 5f69 6e66 6f5f 6c73 7420 3d20 6764 5f73  _info_lst = gd_s
+00082b40: 656c 5b67 645f 6964 785d 2e6e 765f 696e  el[gd_idx].nv_in
+00082b50: 666f 5f6c 7374 202b 2073 695f 6c73 740a  fo_lst + si_lst.
+00082b60: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00082b70: 6620 286f 7373 203e 206f 7365 293a 2023  f (oss > ose): #
+00082b80: 2064 656c 6574 696f 6e20 696e 2062 6574   deletion in bet
+00082b90: 7765 656e 0a0a 2020 2020 2020 2020 2020  ween..          
+00082ba0: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+00082bb0: 2569 206f 7373 203e 206f 7365 2720 2520  %i oss > ose' % 
+00082bc0: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+00082bd0: 2020 2023 2072 2e70 7269 6e74 5f73 686f     # r.print_sho
+00082be0: 7274 2829 0a20 2020 2020 2020 2020 2020  rt().           
+00082bf0: 2020 2020 2070 2c20 7072 6576 5f6f 6632       p, prev_of2
+00082c00: 203d 206f 662e 6765 745f 626e 6472 795f   = of.get_bndry_
+00082c10: 7365 7128 6f73 652c 2070 7265 765f 6f66  seq(ose, prev_of
+00082c20: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
+00082c30: 2020 204c 6420 3d20 6f73 7320 2d20 6f73     Ld = oss - os
+00082c40: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+00082c50: 2020 2023 2320 7370 6c69 7420 2866 6f72     ## split (for
+00082c60: 2043 4453 206f 6e6c 7929 0a20 2020 2020   CDS only).     
+00082c70: 2020 2020 2020 2020 2020 204c 7220 3d20             Lr = 
+00082c80: 722e 656e 6420 2d20 722e 7374 6172 7420  r.end - r.start 
+00082c90: 2b31 0a20 2020 2020 2020 2020 2020 2020  +1.             
+00082ca0: 2020 204c 6e20 3d20 722e 656e 6420 2d20     Ln = r.end - 
+00082cb0: 7020 2b20 3120 2d20 4c64 0a20 2020 2020  p + 1 - Ld.     
+00082cc0: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
+00082cd0: 6577 203d 2072 6567 696f 6e28 2072 2e63  ew = region( r.c
+00082ce0: 6872 2c20 702b 4c64 2b6f 7365 2c20 722e  hr, p+Ld+ose, r.
+00082cf0: 656e 642b 6f73 652c 2072 2e74 7970 652c  end+ose, r.type,
+00082d00: 2072 2e63 6d61 745b 3a2c 2d4c 6e3a 5d2c   r.cmat[:,-Ln:],
+00082d10: 2078 7320 3d20 722e 7873 290a 2020 2020   xs = r.xs).    
+00082d20: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
+00082d30: 6e65 772e 6765 745f 6376 6728 290a 2020  new.get_cvg().  
+00082d40: 2020 2020 2020 2020 2020 2020 2020 725f                r_
+00082d50: 746f 5f61 6464 2e61 7070 656e 6428 7267  to_add.append(rg
+00082d60: 6e5f 6e65 7729 0a20 2020 2020 2020 2020  n_new).         
+00082d70: 2020 2020 2020 2070 6f73 5f74 6f5f 6164         pos_to_ad
+00082d80: 642e 6170 7065 6e64 286b 2b31 290a 0a20  d.append(k+1).. 
+00082d90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00082da0: 2073 695f 6c73 7420 3d20 6669 6e64 5f73   si_lst = find_s
+00082db0: 6e70 2873 6571 5f6e 6577 5b28 7267 6e5f  np(seq_new[(rgn_
+00082dc0: 6e65 772e 7374 6172 742d 3129 3a72 676e  new.start-1):rgn
+00082dd0: 5f6e 6577 2e65 6e64 5d2c 2072 676e 5f6e  _new.end], rgn_n
+00082de0: 6577 2e73 6571 2c20 7267 6e5f 6e65 772e  ew.seq, rgn_new.
+00082df0: 6765 745f 6376 6728 292c 2063 6872 6d2c  get_cvg(), chrm,
+00082e00: 2070 2c20 6f73 6529 0a20 2020 2020 2020   p, ose).       
+00082e10: 2020 2020 2020 2020 2073 695f 6c73 7420           si_lst 
+00082e20: 3d20 6669 6e64 5f73 6e70 2873 6571 5f6e  = find_snp(seq_n
+00082e30: 6577 5b28 7267 6e5f 6e65 772e 7374 6172  ew[(rgn_new.star
+00082e40: 742d 3129 3a72 676e 5f6e 6577 2e65 6e64  t-1):rgn_new.end
+00082e50: 5d2c 2072 676e 5f6e 6577 2e73 6571 2c20  ], rgn_new.seq, 
+00082e60: 7267 6e5f 6e65 772e 636d 6174 2c20 6368  rgn_new.cmat, ch
+00082e70: 726d 2c20 702c 206f 7365 2c20 6769 6e29  rm, p, ose, gin)
+00082e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00082e90: 2073 6e76 5f69 6e66 6f5f 6368 7220 3d20   snv_info_chr = 
+00082ea0: 736e 765f 696e 666f 5f63 6872 202b 2073  snv_info_chr + s
+00082eb0: 695f 6c73 740a 2020 2020 2020 2020 2020  i_lst.          
+00082ec0: 2020 2020 2020 6764 5f69 6478 203d 2067        gd_idx = g
+00082ed0: 645f 6964 785f 6f66 5f72 676e 5b6b 5d0a  d_idx_of_rgn[k].
+00082ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082ef0: 6764 5f73 656c 5b67 645f 6964 785d 2e6e  gd_sel[gd_idx].n
+00082f00: 765f 696e 666f 5f6c 7374 203d 2067 645f  v_info_lst = gd_
+00082f10: 7365 6c5b 6764 5f69 6478 5d2e 6e76 5f69  sel[gd_idx].nv_i
+00082f20: 6e66 6f5f 6c73 7420 2b20 7369 5f6c 7374  nfo_lst + si_lst
+00082f30: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00082f40: 2020 722e 656e 6420 3d20 702d 312b 6f73    r.end = p-1+os
+00082f50: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00082f60: 2020 722e 7374 6172 7420 2b3d 206f 7373    r.start += oss
+00082f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00082f80: 204c 6e20 3d20 722e 656e 6420 2d20 722e   Ln = r.end - r.
+00082f90: 7374 6172 7420 2b31 0a20 2020 2020 2020  start +1.       
+00082fa0: 2020 2020 2020 2020 2072 2e63 6d61 7420           r.cmat 
+00082fb0: 3d20 722e 636d 6174 5b3a 2c3a 4c6e 5d0a  = r.cmat[:,:Ln].
+00082fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082fd0: 722e 7365 7120 3d20 722e 7365 715b 3a4c  r.seq = r.seq[:L
+00082fe0: 6e5d 0a20 2020 2020 2020 2020 2020 2020  n].             
+00082ff0: 2020 2072 2e63 7667 203d 2072 2e63 7667     r.cvg = r.cvg
+00083000: 5b3a 4c6e 5d0a 2020 2020 2020 2020 2020  [:Ln].          
+00083010: 2020 2020 2020 2320 722e 6765 745f 6376        # r.get_cv
+00083020: 6728 290a 2020 2020 2020 2020 2020 2020  g().            
+00083030: 2020 2020 7261 6c6c 2e72 676e 735b 6b5d      rall.rgns[k]
+00083040: 203d 2072 2023 202e 636f 7079 2829 0a0a   = r # .copy()..
+00083050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00083060: 2320 7369 5f6c 7374 203d 2066 696e 645f  # si_lst = find_
+00083070: 736e 7028 7365 715f 6f72 675b 2872 2e73  snp(seq_org[(r.s
+00083080: 7461 7274 2d6f 7373 2d31 293a 705d 2c20  tart-oss-1):p], 
+00083090: 722e 7365 712c 2072 2e67 6574 5f63 7667  r.seq, r.get_cvg
+000830a0: 2829 2c20 6368 726d 2c20 722e 7374 6172  (), chrm, r.star
+000830b0: 742d 6f73 732c 206f 7373 290a 2020 2020  t-oss, oss).    
+000830c0: 2020 2020 2020 2020 2020 2020 7369 5f6c              si_l
+000830d0: 7374 203d 2066 696e 645f 736e 7028 7365  st = find_snp(se
+000830e0: 715f 6f72 675b 2872 2e73 7461 7274 2d6f  q_org[(r.start-o
+000830f0: 7373 2d31 293a 705d 2c20 722e 7365 712c  ss-1):p], r.seq,
+00083100: 2072 2e63 6d61 742c 2063 6872 6d2c 2072   r.cmat, chrm, r
+00083110: 2e73 7461 7274 2d6f 7373 2c20 6f73 732c  .start-oss, oss,
+00083120: 2067 696e 290a 2020 2020 2020 2020 2020   gin).          
+00083130: 2020 2020 2020 736e 765f 696e 666f 5f63        snv_info_c
+00083140: 6872 203d 2073 6e76 5f69 6e66 6f5f 6368  hr = snv_info_ch
+00083150: 7220 2b20 7369 5f6c 7374 0a20 2020 2020  r + si_lst.     
+00083160: 2020 2020 2020 2020 2020 2067 645f 6964             gd_id
+00083170: 7820 3d20 6764 5f69 6478 5f6f 665f 7267  x = gd_idx_of_rg
+00083180: 6e5b 6b5d 0a20 2020 2020 2020 2020 2020  n[k].           
+00083190: 2020 2020 2067 645f 7365 6c5b 6764 5f69       gd_sel[gd_i
+000831a0: 6478 5d2e 6e76 5f69 6e66 6f5f 6c73 7420  dx].nv_info_lst 
+000831b0: 3d20 6764 5f73 656c 5b67 645f 6964 785d  = gd_sel[gd_idx]
+000831c0: 2e6e 765f 696e 666f 5f6c 7374 202b 2073  .nv_info_lst + s
+000831d0: 695f 6c73 740a 2020 2020 2020 2020 2020  i_lst.          
+000831e0: 2020 2020 2020 0a20 2020 2020 2020 2065        .        e
+000831f0: 6c69 6620 722e 7479 7065 203d 3d20 2769  lif r.type == 'i
+00083200: 6e73 6572 7369 6f6e 273a 0a0a 2020 2020  nsersion':..    
+00083210: 2020 2020 2020 2020 6f73 7370 2c20 7072          ossp, pr
+00083220: 6576 5f6f 6631 203d 206f 662e 6669 6e64  ev_of1 = of.find
+00083230: 5f6f 735f 7365 7128 722e 7374 6172 742d  _os_seq(r.start-
+00083240: 312c 2070 7265 765f 6f66 692c 206d 6172  1, prev_ofi, mar
+00083250: 6b20 3d20 2749 2729 0a0a 2020 2020 2020  k = 'I')..      
+00083260: 2020 2020 2020 736f 7020 3d20 7365 715f        sop = seq_
+00083270: 6f72 675b 696e 7428 722e 7374 6172 742d  org[int(r.start-
+00083280: 284e 5749 4e2b 3129 293a 696e 7428 722e  (NWIN+1)):int(r.
+00083290: 7374 6172 742d 3129 5d0a 2020 2020 2020  start-1)].      
+000832a0: 2020 2020 2020 736f 6320 3d20 272d 270a        soc = '-'.
+000832b0: 2020 2020 2020 2020 2020 2020 736f 6e20              son 
+000832c0: 3d20 7365 715f 6f72 675b 696e 7428 722e  = seq_org[int(r.
+000832d0: 7374 6172 742d 3129 3a69 6e74 2872 2e73  start-1):int(r.s
+000832e0: 7461 7274 2b28 4e57 494e 2d31 2929 5d0a  tart+(NWIN-1))].
+000832f0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00083300: 2020 2020 2020 2020 2073 6e70 203d 2073           snp = s
+00083310: 6571 5f6e 6577 5b69 6e74 2872 2e73 7461  eq_new[int(r.sta
+00083320: 7274 2b6f 7373 702d 284e 5749 4e2b 3129  rt+ossp-(NWIN+1)
+00083330: 293a 696e 7428 722e 7374 6172 742b 6f73  ):int(r.start+os
+00083340: 7370 2d31 295d 0a20 2020 2020 2020 2020  sp-1)].         
+00083350: 2020 2073 6e63 203d 2072 2e73 6571 0a20     snc = r.seq. 
+00083360: 2020 2020 2020 2020 2020 2073 6e6e 203d             snn =
+00083370: 2073 6571 5f6e 6577 5b69 6e74 2872 2e73   seq_new[int(r.s
+00083380: 7461 7274 2b6f 7373 2d31 293a 696e 7428  tart+oss-1):int(
+00083390: 722e 7374 6172 742b 6f73 732b 284e 5749  r.start+oss+(NWI
+000833a0: 4e2d 3129 295d 0a20 2020 2020 2020 2020  N-1))].         
+000833b0: 2020 2073 6920 3d20 534e 565f 696e 666f     si = SNV_info
+000833c0: 2863 6872 6d2c 2072 2e73 7461 7274 2c20  (chrm, r.start, 
+000833d0: 722e 7374 6172 742b 6f73 732c 2067 696e  r.start+oss, gin
+000833e0: 5b30 5d2c 2067 696e 5b31 5d2c 2027 4927  [0], gin[1], 'I'
+000833f0: 2c20 722e 6765 745f 6c65 6e28 292c 2069  , r.get_len(), i
+00083400: 6e74 2872 2e61 7665 5f63 7667 5f64 6570  nt(r.ave_cvg_dep
+00083410: 7468 2829 292c 2072 2e63 7667 5f66 7261  th()), r.cvg_fra
+00083420: 632c 2073 6f70 2c20 736f 632c 2073 6f6e  c, sop, soc, son
+00083430: 2c20 736e 702c 2073 6e63 2c20 736e 6e20  , snp, snc, snn 
+00083440: 290a 2020 2020 2020 2020 2020 2020 736e  ).            sn
+00083450: 765f 696e 666f 5f63 6872 2e61 7070 656e  v_info_chr.appen
+00083460: 6428 7369 290a 2020 2020 2020 2020 2020  d(si).          
+00083470: 2020 6764 5f69 6478 203d 2067 645f 6964    gd_idx = gd_id
+00083480: 785f 6f66 5f72 676e 5b6b 5d0a 2020 2020  x_of_rgn[k].    
+00083490: 2020 2020 2020 2020 6764 5f73 656c 5b67          gd_sel[g
+000834a0: 645f 6964 785d 2e6e 765f 696e 666f 5f6c  d_idx].nv_info_l
+000834b0: 7374 2e61 7070 656e 6428 7369 290a 0a20  st.append(si).. 
+000834c0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
+000834d0: 7274 202b 3d20 6f73 7370 0a20 2020 2020  rt += ossp.     
+000834e0: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
+000834f0: 6f73 7370 2020 0a20 2020 2020 2020 2020  ossp  .         
+00083500: 2020 2072 616c 6c2e 7267 6e73 5b6b 5d20     rall.rgns[k] 
+00083510: 3d20 7220 2320 2e63 6f70 7928 290a 0a20  = r # .copy().. 
+00083520: 2020 2020 2020 2065 6c69 6620 722e 7479         elif r.ty
+00083530: 7065 203d 3d20 2764 656c 6574 696f 6e27  pe == 'deletion'
+00083540: 3a0a 0a20 2020 2020 2020 2020 2020 206f  :..            o
+00083550: 7373 702c 2070 7265 765f 6f66 3120 3d20  ssp, prev_of1 = 
+00083560: 6f66 2e66 696e 645f 6f73 5f73 6571 2872  of.find_os_seq(r
+00083570: 2e73 7461 7274 2d31 2c20 7072 6576 5f6f  .start-1, prev_o
+00083580: 6669 2c20 6d61 726b 203d 2027 4427 290a  fi, mark = 'D').
+00083590: 0a20 2020 2020 2020 2020 2020 2073 6f70  .            sop
+000835a0: 203d 2073 6571 5f6f 7267 5b69 6e74 2872   = seq_org[int(r
+000835b0: 2e73 7461 7274 2d28 4e57 494e 2b31 2929  .start-(NWIN+1))
+000835c0: 3a69 6e74 2872 2e73 7461 7274 2d31 295d  :int(r.start-1)]
+000835d0: 0a20 2020 2020 2020 2020 2020 2073 6f63  .            soc
+000835e0: 203d 2073 6571 5f6f 7267 5b69 6e74 2872   = seq_org[int(r
+000835f0: 2e73 7461 7274 2d31 293a 696e 7428 722e  .start-1):int(r.
+00083600: 656e 6429 5d0a 2020 2020 2020 2020 2020  end)].          
+00083610: 2020 736f 6e20 3d20 7365 715f 6f72 675b    son = seq_org[
+00083620: 696e 7428 722e 656e 6429 3a69 6e74 2872  int(r.end):int(r
+00083630: 2e65 6e64 2b28 4e57 494e 2929 5d0a 2020  .end+(NWIN))].  
+00083640: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00083650: 2020 2020 2020 2023 2073 6f70 203d 2072         # sop = r
+00083660: 616c 6c2e 7267 6e73 5b6f 6472 5b6d 2d31  all.rgns[odr[m-1
+00083670: 5d5d 2e73 6571 5b2d 4e57 494e 3a5d 0a20  ]].seq[-NWIN:]. 
+00083680: 2020 2020 2020 2020 2020 2073 6e70 203d             snp =
+00083690: 2073 6571 5f6e 6577 5b69 6e74 2872 2e73   seq_new[int(r.s
+000836a0: 7461 7274 2b6f 7373 702d 284e 5749 4e2b  tart+ossp-(NWIN+
+000836b0: 3129 293a 696e 7428 722e 7374 6172 742b  1)):int(r.start+
+000836c0: 6f73 7370 2d31 295d 0a20 2020 2020 2020  ossp-1)].       
+000836d0: 2020 2020 2073 6e63 203d 2027 2d27 0a20       snc = '-'. 
+000836e0: 2020 2020 2020 2020 2020 2023 2073 6f6e             # son
+000836f0: 203d 2072 616c 6c2e 7267 6e73 5b6f 6472   = rall.rgns[odr
+00083700: 5b6d 2b31 5d5d 2e73 6571 5b3a 4e57 494e  [m+1]].seq[:NWIN
+00083710: 5d0a 2020 2020 2020 2020 2020 2020 736e  ].            sn
+00083720: 6e20 3d20 7365 715f 6e65 775b 696e 7428  n = seq_new[int(
+00083730: 722e 7374 6172 742b 6f73 7370 2d31 293a  r.start+ossp-1):
+00083740: 696e 7428 722e 7374 6172 742b 6f73 7370  int(r.start+ossp
+00083750: 2b28 4e57 494e 2d31 2929 5d0a 2020 2020  +(NWIN-1))].    
+00083760: 2020 2020 2020 2020 7369 203d 2053 4e56          si = SNV
+00083770: 5f69 6e66 6f28 6368 726d 2c20 722e 7374  _info(chrm, r.st
+00083780: 6172 742c 2072 2e73 7461 7274 2b6f 7373  art, r.start+oss
+00083790: 2c20 6769 6e5b 305d 2c20 6769 6e5b 315d  , gin[0], gin[1]
+000837a0: 2c20 2744 272c 2072 2e67 6574 5f6c 656e  , 'D', r.get_len
+000837b0: 2829 2c20 696e 7428 722e 6176 655f 6376  (), int(r.ave_cv
+000837c0: 675f 6465 7074 6828 2929 2c20 722e 6376  g_depth()), r.cv
+000837d0: 675f 6672 6163 2c20 736f 702c 2073 6f63  g_frac, sop, soc
+000837e0: 2c20 736f 6e2c 2073 6e70 2c20 736e 632c  , son, snp, snc,
+000837f0: 2073 6e6e 2029 0a20 2020 2020 2020 2020   snn ).         
+00083800: 2020 2073 6e76 5f69 6e66 6f5f 6368 722e     snv_info_chr.
+00083810: 6170 7065 6e64 2873 6929 0a20 2020 2020  append(si).     
+00083820: 2020 2020 2020 2067 645f 6964 7820 3d20         gd_idx = 
+00083830: 6764 5f69 6478 5f6f 665f 7267 6e5b 6b5d  gd_idx_of_rgn[k]
+00083840: 0a20 2020 2020 2020 2020 2020 2067 645f  .            gd_
+00083850: 7365 6c5b 6764 5f69 6478 5d2e 6e76 5f69  sel[gd_idx].nv_i
+00083860: 6e66 6f5f 6c73 742e 6170 7065 6e64 2873  nfo_lst.append(s
+00083870: 6929 0a0a 2020 2020 2020 2020 2020 2020  i)..            
+00083880: 722e 7374 6172 7420 2b3d 206f 7373 700a  r.start += ossp.
+00083890: 2020 2020 2020 2020 2020 2020 722e 656e              r.en
+000838a0: 6420 2b3d 206f 7373 7020 2020 0a20 2020  d += ossp   .   
+000838b0: 2020 2020 2020 2020 2072 616c 6c2e 7267           rall.rg
+000838c0: 6e73 5b6b 5d20 3d20 7220 2320 2e63 6f70  ns[k] = r # .cop
+000838d0: 7928 290a 0a20 2020 2020 2020 2070 7265  y()..        pre
+000838e0: 765f 6f66 6920 3d20 7072 6576 5f6f 6631  v_ofi = prev_of1
+000838f0: 0a0a 2020 2020 656c 6170 7365 645f 7469  ..    elapsed_ti
+00083900: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+00083910: 202d 2073 7461 7274 5f74 696d 650a 2020   - start_time.  
+00083920: 2020 2320 7072 696e 7428 2720 2020 332e    # print('   3.
+00083930: 2064 6f6e 6520 2825 6929 2020 2569 2720   done (%i)  %i' 
+00083940: 2520 2865 6c61 7073 6564 5f74 696d 652c  % (elapsed_time,
+00083950: 206c 656e 286f 662e 6f73 695f 6c73 7429   len(of.osi_lst)
+00083960: 292c 2066 6c75 7368 203d 2054 7275 6529  ), flush = True)
+00083970: 0a20 2020 200a 2020 2020 6e76 5f6c 7374  .    .    nv_lst
+00083980: 203d 205b 5d0a 2020 2020 636e 745f 6520   = [].    cnt_e 
+00083990: 3d20 300a 2020 2020 666f 7220 6764 2069  = 0.    for gd i
+000839a0: 6e20 6764 5f73 656c 3a0a 2020 2020 2020  n gd_sel:.      
+000839b0: 2020 666f 7220 7464 2069 6e20 6764 2e74    for td in gd.t
+000839c0: 645f 6c73 743a 0a20 2020 2020 2020 2020  d_lst:.         
+000839d0: 2020 2074 642e 6765 745f 6f72 675f 636f     td.get_org_co
+000839e0: 6469 6e67 5f73 6571 2820 6764 2e63 6473  ding_seq( gd.cds
+000839f0: 2e72 676e 732c 2073 6571 5f6f 7267 2029  .rgns, seq_org )
+00083a00: 0a20 2020 2020 2020 206e 765f 6c73 745f  .        nv_lst_
+00083a10: 746d 702c 2063 6e74 5f65 203d 2067 642e  tmp, cnt_e = gd.
+00083a20: 6765 745f 6765 6e65 5f6c 6576 656c 5f6e  get_gene_level_n
+00083a30: 765f 696e 666f 2863 6e74 5f65 290a 2020  v_info(cnt_e).  
+00083a40: 2020 2020 2020 6e76 5f6c 7374 203d 206e        nv_lst = n
+00083a50: 765f 6c73 7420 2b20 6e76 5f6c 7374 5f74  v_lst + nv_lst_t
+00083a60: 6d70 0a20 2020 2073 6e76 5f69 6e66 6f5f  mp.    snv_info_
+00083a70: 6368 7220 3d20 6e76 5f6c 7374 0a20 2020  chr = nv_lst.   
+00083a80: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00083a90: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+00083aa0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00083ab0: 2023 2320 7075 7420 7267 6e73 2062 6163   ## put rgns bac
+00083ac0: 6b20 746f 2067 645f 7365 6c0a 2020 2020  k to gd_sel.    
+00083ad0: 2323 2061 6e64 2061 6c73 6f20 6164 6420  ## and also add 
+00083ae0: 6e65 7720 7267 6e73 200a 0a20 2020 2073  new rgns ..    s
+00083af0: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
+00083b00: 2e74 696d 6528 290a 2020 2020 706f 735f  .time().    pos_
+00083b10: 746f 5f61 6464 203d 206e 702e 6172 7261  to_add = np.arra
+00083b20: 7928 706f 735f 746f 5f61 6464 290a 2020  y(pos_to_add).  
+00083b30: 2020 666f 7220 6b2c 2067 6420 696e 2065    for k, gd in e
+00083b40: 6e75 6d65 7261 7465 2867 645f 7365 6c29  numerate(gd_sel)
+00083b50: 3a20 0a0a 2020 2020 2020 2020 7031 203d  : ..        p1 =
+00083b60: 2069 6e74 286c 6f63 5f6f 735b 6b5d 290a   int(loc_os[k]).
+00083b70: 2020 2020 2020 2020 7032 203d 2069 6e74          p2 = int
+00083b80: 2870 3120 2b20 6e75 6d5f 6f73 5b6b 5d29  (p1 + num_os[k])
+00083b90: 0a20 2020 2020 2020 2023 2067 642e 6578  .        # gd.ex
+00083ba0: 6f6e 732e 7267 6e73 203d 2072 616c 6c2e  ons.rgns = rall.
+00083bb0: 7267 6e73 5b70 313a 7032 5d0a 2020 2020  rgns[p1:p2].    
+00083bc0: 2020 2020 6764 2e65 786f 6e73 2e72 676e      gd.exons.rgn
+00083bd0: 7320 3d20 5b72 616c 6c2e 7267 6e73 5b70  s = [rall.rgns[p
+00083be0: 312b 6d5d 2066 6f72 206d 2069 6e20 7261  1+m] for m in ra
+00083bf0: 6e67 6528 7032 2d70 3129 5d0a 2020 2020  nge(p2-p1)].    
+00083c00: 2020 2020 7768 203d 2077 6869 6368 2820      wh = which( 
+00083c10: 2870 6f73 5f74 6f5f 6164 6420 3e3d 2070  (pos_to_add >= p
+00083c20: 3129 2026 2028 706f 735f 746f 5f61 6464  1) & (pos_to_add
+00083c30: 203c 2070 3229 2029 0a20 2020 2020 2020   < p2) ).       
+00083c40: 2069 6620 6c65 6e28 7768 2920 3e20 303a   if len(wh) > 0:
+00083c50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00083c60: 2077 2069 6e20 7768 3a20 6764 2e65 786f   w in wh: gd.exo
+00083c70: 6e73 2e72 676e 732e 6170 7065 6e64 2872  ns.rgns.append(r
+00083c80: 5f74 6f5f 6164 645b 775d 290a 0a20 2020  _to_add[w])..   
+00083c90: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00083ca0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
+00083cb0: 7265 6d6f 7665 2069 6465 6c65 7469 6f6e  remove ideletion
+00083cc0: 200a 2020 2020 2323 2063 6f6d 6269 6e65   .    ## combine
+00083cd0: 2074 696c 6564 2065 786f 6e73 0a20 2020   tiled exons.   
+00083ce0: 200a 2020 2020 666f 7220 6764 2069 6e20   .    for gd in 
+00083cf0: 6764 5f73 656c 3a0a 2020 2020 2020 2020  gd_sel:.        
+00083d00: 6764 2e72 656d 6f76 655f 696e 6465 6c5f  gd.remove_indel_
+00083d10: 616e 645f 636f 6d62 696e 655f 6672 6167  and_combine_frag
+00083d20: 7328 290a 0a20 2020 2023 2727 270a 2020  s()..    #'''.  
+00083d30: 2020 656c 6170 7365 645f 7469 6d65 203d    elapsed_time =
+00083d40: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
+00083d50: 7461 7274 5f74 696d 650a 2020 2020 2320  tart_time.    # 
+00083d60: 7072 696e 7428 2720 2020 3362 2e20 646f  print('   3b. do
+00083d70: 6e65 2028 2569 2920 2027 2025 2028 656c  ne (%i)  ' % (el
+00083d80: 6170 7365 645f 7469 6d65 292c 2066 6c75  apsed_time), flu
+00083d90: 7368 203d 2054 7275 6529 0a20 2020 200a  sh = True).    .
+00083da0: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
+00083db0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00083dc0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+00083dd0: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
+00083de0: 2320 636f 6469 6e67 2072 6567 696f 6e20  # coding region 
+00083df0: 7570 6461 7465 0a0a 2020 2020 7374 6172  update..    star
+00083e00: 745f 7469 6d65 203d 2074 696d 652e 7469  t_time = time.ti
+00083e10: 6d65 2829 0a20 2020 200a 2020 2020 2323  me().    .    ##
+00083e20: 2063 6f6c 6c65 6374 2072 676e 7320 616e   collect rgns an
+00083e30: 6420 6d61 726b 2074 6865 6972 2070 6f73  d mark their pos
+00083e40: 0a20 2020 206c 6f63 5f6f 7320 3d20 6e70  .    loc_os = np
+00083e50: 2e7a 6572 6f73 286e 5f67 6429 0a20 2020  .zeros(n_gd).   
+00083e60: 206e 756d 5f6f 7320 3d20 6e70 2e7a 6572   num_os = np.zer
+00083e70: 6f73 286e 5f67 642c 6474 7970 653d 6e70  os(n_gd,dtype=np
+00083e80: 2e66 6c6f 6174 3332 290a 2020 2020 6361  .float32).    ca
+00083e90: 6c6c 203d 2072 6567 696f 6e73 2829 0a20  ll = regions(). 
+00083ea0: 2020 206f 735f 6375 7220 3d20 300a 2020     os_cur = 0.  
+00083eb0: 2020 635f 706f 7320 3d20 5b5d 0a20 2020    c_pos = [].   
+00083ec0: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
+00083ed0: 756d 6572 6174 6528 6764 5f73 656c 293a  umerate(gd_sel):
+00083ee0: 0a20 2020 2020 2020 206c 6f63 5f6f 735b  .        loc_os[
+00083ef0: 6b5d 203d 206f 735f 6375 720a 2020 2020  k] = os_cur.    
+00083f00: 2020 2020 6e75 6d5f 6f73 5b6b 5d20 3d20      num_os[k] = 
+00083f10: 6c65 6e28 6764 2e63 6473 2e72 676e 7329  len(gd.cds.rgns)
+00083f20: 0a20 2020 2020 2020 2063 616c 6c2e 7267  .        call.rg
+00083f30: 6e73 203d 2063 616c 6c2e 7267 6e73 202b  ns = call.rgns +
+00083f40: 2067 642e 6364 732e 7267 6e73 0a20 2020   gd.cds.rgns.   
+00083f50: 2020 2020 206f 735f 6375 7220 2b3d 206c       os_cur += l
+00083f60: 656e 2867 642e 6364 732e 7267 6e73 290a  en(gd.cds.rgns).
+00083f70: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
+00083f80: 6e20 6764 2e63 6473 2e72 676e 733a 0a20  n gd.cds.rgns:. 
+00083f90: 2020 2020 2020 2020 2020 2063 5f70 6f73             c_pos
+00083fa0: 2e61 7070 656e 6428 722e 7374 6172 7429  .append(r.start)
+00083fb0: 0a0a 2020 2020 2323 2067 6574 206f 7264  ..    ## get ord
+00083fc0: 6572 2061 6363 6f72 6469 6e67 2074 6f20  er according to 
+00083fd0: 6c6f 6361 7469 6f6e 0a20 2020 2063 5f70  location.    c_p
+00083fe0: 6f73 203d 206e 702e 6172 7261 7928 635f  os = np.array(c_
+00083ff0: 706f 7329 0a20 2020 206f 6472 203d 2063  pos).    odr = c
+00084000: 5f70 6f73 2e61 7267 736f 7274 2829 0a0a  _pos.argsort()..
+00084010: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+00084020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00084030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00084040: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00084050: 2023 2320 5573 6520 6f66 6673 6574 5f66   ## Use offset_f
+00084060: 696e 6465 7220 746f 2063 6f72 7265 6374  inder to correct
+00084070: 2070 6f73 6974 696f 6e73 2069 6e20 4754   positions in GT
+00084080: 4620 656e 7472 6965 730a 2020 2020 2323  F entries.    ##
+00084090: 2061 6c73 6f20 6765 7420 7267 6e73 2066   also get rgns f
+000840a0: 7261 676d 656e 7473 2077 6865 6e20 7370  ragments when sp
+000840b0: 6c69 7420 6973 2072 6571 7569 7265 640a  lit is required.
+000840c0: 0a20 2020 2063 5f74 6f5f 6164 6420 3d20  .    c_to_add = 
+000840d0: 5b5d 0a20 2020 2070 6f73 5f74 6f5f 6164  [].    pos_to_ad
+000840e0: 6420 3d20 5b5d 0a0a 2020 2020 7072 6576  d = []..    prev
+000840f0: 5f6f 6669 203d 2030 0a20 2020 2023 2066  _ofi = 0.    # f
+00084100: 6f72 206b 2c20 7220 696e 2065 6e75 6d65  or k, r in enume
+00084110: 7261 7465 2863 616c 6c2e 7267 6e73 293a  rate(call.rgns):
+00084120: 0a20 2020 2066 6f72 206d 2c20 6b20 696e  .    for m, k in
+00084130: 2065 6e75 6d65 7261 7465 286f 6472 293a   enumerate(odr):
+00084140: 0a20 2020 2020 2020 2072 203d 2063 616c  .        r = cal
+00084150: 6c2e 7267 6e73 5b6b 5d0a 2020 2020 2020  l.rgns[k].      
+00084160: 2020 0a20 2020 2020 2020 2023 206f 7373    .        # oss
+00084170: 203d 206f 662e 6669 6e64 5f6f 7328 722e   = of.find_os(r.
+00084180: 7374 6172 7429 0a20 2020 2020 2020 2023  start).        #
+00084190: 206f 7365 203d 206f 662e 6669 6e64 5f6f   ose = of.find_o
+000841a0: 7328 722e 656e 6429 0a20 2020 2020 2020  s(r.end).       
+000841b0: 206f 7373 2c20 7072 6576 5f6f 6631 203d   oss, prev_of1 =
+000841c0: 206f 662e 6669 6e64 5f6f 735f 7365 7128   of.find_os_seq(
+000841d0: 722e 7374 6172 742c 2070 7265 765f 6f66  r.start, prev_of
+000841e0: 692c 206d 6172 6b20 3d20 2742 2729 0a20  i, mark = 'B'). 
+000841f0: 2020 2020 2020 206f 7365 2c20 7072 6576         ose, prev
+00084200: 5f6f 6632 203d 206f 662e 6669 6e64 5f6f  _of2 = of.find_o
+00084210: 735f 7365 7128 722e 656e 642c 2070 7265  s_seq(r.end, pre
+00084220: 765f 6f66 692c 206d 6172 6b20 3d20 2743  v_ofi, mark = 'C
+00084230: 2729 0a20 2020 2020 2020 2070 7265 765f  ').        prev_
+00084240: 6f66 6920 3d20 7072 6576 5f6f 6631 0a0a  ofi = prev_of1..
+00084250: 2020 2020 2020 2020 6966 2028 722e 7479          if (r.ty
+00084260: 7065 2e6c 6f77 6572 2829 203d 3d20 2773  pe.lower() == 's
+00084270: 7461 7274 5f63 6f64 6f6e 2729 207c 2028  tart_codon') | (
+00084280: 722e 7479 7065 2e6c 6f77 6572 2829 203d  r.type.lower() =
+00084290: 3d20 2773 746f 705f 636f 646f 6e27 293a  = 'stop_codon'):
+000842a0: 0a20 2020 2020 2020 2020 2020 2072 2e73  .            r.s
+000842b0: 7461 7274 202b 3d20 6f73 730a 2020 2020  tart += oss.    
+000842c0: 2020 2020 2020 2020 722e 656e 6420 2b3d          r.end +=
+000842d0: 206f 7373 2020 200a 2020 2020 2020 2020   oss   .        
+000842e0: 2020 2020 6361 6c6c 2e72 676e 735b 6b5d      call.rgns[k]
+000842f0: 203d 2072 2e63 6f70 7928 7570 6461 7465   = r.copy(update
+00084300: 3d46 616c 7365 290a 0a20 2020 2020 2020  =False)..       
+00084310: 2065 6c73 653a 2020 2320 4344 532c 2066   else:  # CDS, f
+00084320: 6976 655f 7072 696d 655f 7574 722c 2074  ive_prime_utr, t
+00084330: 6872 6565 5f70 7269 6d65 5f75 7472 2c20  hree_prime_utr, 
+00084340: 2e2e 2e0a 2020 2020 2020 2020 2020 2020  ....            
+00084350: 6966 2028 6f73 7320 3d3d 206f 7365 293a  if (oss == ose):
+00084360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084370: 2072 2e73 7461 7274 202b 3d20 6f73 730a   r.start += oss.
+00084380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084390: 722e 656e 6420 2b3d 206f 7365 0a20 2020  r.end += ose.   
+000843a0: 2020 2020 2020 2020 2020 2020 2063 616c               cal
+000843b0: 6c2e 7267 6e73 5b6b 5d20 3d20 722e 636f  l.rgns[k] = r.co
+000843c0: 7079 2875 7064 6174 653d 4661 6c73 6529  py(update=False)
+000843d0: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000843e0: 6966 2028 6f73 7320 3c20 6f73 6529 3a20  if (oss < ose): 
+000843f0: 2320 496e 7365 7273 696f 6e20 6f72 2064  # Insersion or d
+00084400: 656c 6574 696f 6e20 696e 2062 6574 7765  eletion in betwe
+00084410: 656e 0a0a 2020 2020 2020 2020 2020 2020  en..            
+00084420: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
+00084430: 2569 206f 7373 203c 206f 7365 2720 2520  %i oss < ose' % 
+00084440: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+00084450: 2020 2070 2c20 7072 6576 5f6f 6632 203d     p, prev_of2 =
+00084460: 206f 662e 6765 745f 626e 6472 795f 7365   of.get_bndry_se
+00084470: 7128 722e 656e 642c 2070 7265 765f 6f66  q(r.end, prev_of
+00084480: 6929 0a0a 2020 2020 2020 2020 2020 2020  i)..            
+00084490: 2020 2020 2323 2073 706c 6974 0a20 2020      ## split.   
+000844a0: 2020 2020 2020 2020 2020 2020 2072 676e               rgn
+000844b0: 5f6e 6577 203d 2072 6567 696f 6e28 2072  _new = region( r
+000844c0: 2e63 6872 2c20 702b 6f73 652c 2072 2e65  .chr, p+ose, r.e
+000844d0: 6e64 2b6f 7365 2c20 722e 7479 7065 2c20  nd+ose, r.type, 
+000844e0: 7873 203d 2072 2e78 7329 0a20 2020 2020  xs = r.xs).     
+000844f0: 2020 2020 2020 2020 2020 2063 5f74 6f5f             c_to_
+00084500: 6164 642e 6170 7065 6e64 2872 676e 5f6e  add.append(rgn_n
+00084510: 6577 290a 2020 2020 2020 2020 2020 2020  ew).            
+00084520: 2020 2020 706f 735f 746f 5f61 6464 2e61      pos_to_add.a
+00084530: 7070 656e 6428 6b2b 3129 0a0a 2020 2020  ppend(k+1)..    
+00084540: 2020 2020 2020 2020 2020 2020 722e 656e              r.en
+00084550: 6420 3d20 702d 312b 6f73 730a 2020 2020  d = p-1+oss.    
+00084560: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
+00084570: 6172 7420 2b3d 206f 7373 0a20 2020 2020  art += oss.     
+00084580: 2020 2020 2020 2020 2020 2063 616c 6c2e             call.
+00084590: 7267 6e73 5b6b 5d20 3d20 722e 636f 7079  rgns[k] = r.copy
+000845a0: 2875 7064 6174 653d 4661 6c73 6529 0a0a  (update=False)..
+000845b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000845c0: 2028 6f73 7320 3e20 6f73 6529 3a20 2320   (oss > ose): # 
+000845d0: 6465 6c65 7469 6f6e 2069 6e20 6265 7477  deletion in betw
+000845e0: 6565 6e0a 0a20 2020 2020 2020 2020 2020  een..           
+000845f0: 2020 2020 2023 2070 7269 6e74 2827 2020       # print('  
+00084600: 2025 6920 6f73 7320 3e20 6f73 6527 2025   %i oss > ose' %
+00084610: 206b 290a 2020 2020 2020 2020 2020 2020   k).            
+00084620: 2020 2020 702c 2070 7265 765f 6f66 3220      p, prev_of2 
+00084630: 3d20 6f66 2e67 6574 5f62 6e64 7279 5f73  = of.get_bndry_s
+00084640: 6571 2872 2e65 6e64 2c20 7072 6576 5f6f  eq(r.end, prev_o
+00084650: 6669 290a 2020 2020 2020 2020 2020 2020  fi).            
+00084660: 2020 2020 4c64 203d 206f 7373 202d 206f      Ld = oss - o
+00084670: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
+00084680: 2020 2020 2323 2073 706c 6974 2028 666f      ## split (fo
+00084690: 7220 4344 5320 6f6e 6c79 290a 2020 2020  r CDS only).    
+000846a0: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
+000846b0: 6e65 7720 3d20 7265 6769 6f6e 2820 722e  new = region( r.
+000846c0: 6368 722c 2070 2b4c 642b 6f73 652c 2072  chr, p+Ld+ose, r
+000846d0: 2e65 6e64 2b6f 7365 2c20 722e 7479 7065  .end+ose, r.type
+000846e0: 2c20 7873 203d 2072 2e78 7329 0a20 2020  , xs = r.xs).   
+000846f0: 2020 2020 2020 2020 2020 2020 2063 5f74               c_t
+00084700: 6f5f 6164 642e 6170 7065 6e64 2872 676e  o_add.append(rgn
+00084710: 5f6e 6577 290a 2020 2020 2020 2020 2020  _new).          
+00084720: 2020 2020 2020 706f 735f 746f 5f61 6464        pos_to_add
+00084730: 2e61 7070 656e 6428 6b2b 3129 0a0a 2020  .append(k+1)..  
+00084740: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+00084750: 656e 6420 3d20 702d 312b 6f73 730a 2020  end = p-1+oss.  
+00084760: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+00084770: 7374 6172 7420 2b3d 206f 7373 0a20 2020  start += oss.   
+00084780: 2020 2020 2020 2020 2020 2020 2063 616c               cal
+00084790: 6c2e 7267 6e73 5b6b 5d20 3d20 722e 636f  l.rgns[k] = r.co
+000847a0: 7079 2875 7064 6174 653d 4661 6c73 6529  py(update=False)
+000847b0: 0a0a 2020 2020 2323 2323 2323 2323 2323  ..    ##########
+000847c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000847d0: 0a20 2020 2023 2320 7075 7420 7267 6e73  .    ## put rgns
+000847e0: 2062 6163 6b20 746f 2067 645f 7365 6c0a   back to gd_sel.
+000847f0: 2020 2020 2323 2061 6e64 2061 6c73 6f20      ## and also 
+00084800: 6164 6420 6e65 7720 7267 6e73 200a 0a20  add new rgns .. 
+00084810: 2020 2070 6f73 5f74 6f5f 6164 6420 3d20     pos_to_add = 
+00084820: 6e70 2e61 7272 6179 2870 6f73 5f74 6f5f  np.array(pos_to_
+00084830: 6164 6429 0a20 2020 2066 6f72 206b 2c20  add).    for k, 
+00084840: 6764 2069 6e20 656e 756d 6572 6174 6528  gd in enumerate(
+00084850: 6764 5f73 656c 293a 200a 0a20 2020 2020  gd_sel): ..     
+00084860: 2020 2070 3120 3d20 696e 7428 6c6f 635f     p1 = int(loc_
+00084870: 6f73 5b6b 5d29 0a20 2020 2020 2020 2070  os[k]).        p
+00084880: 3220 3d20 696e 7428 7031 202b 206e 756d  2 = int(p1 + num
+00084890: 5f6f 735b 6b5d 290a 2020 2020 2020 2020  _os[k]).        
+000848a0: 6764 2e63 6473 2e72 676e 7320 3d20 5b63  gd.cds.rgns = [c
+000848b0: 616c 6c2e 7267 6e73 5b70 312b 6d5d 2066  all.rgns[p1+m] f
+000848c0: 6f72 206d 2069 6e20 7261 6e67 6528 7032  or m in range(p2
+000848d0: 2d70 3129 5d0a 2020 2020 2020 2020 7768  -p1)].        wh
+000848e0: 203d 2077 6869 6368 2820 2870 6f73 5f74   = which( (pos_t
+000848f0: 6f5f 6164 6420 3e3d 2070 3129 2026 2028  o_add >= p1) & (
+00084900: 706f 735f 746f 5f61 6464 203c 2070 3229  pos_to_add < p2)
+00084910: 2029 0a20 2020 2020 2020 2069 6620 6c65   ).        if le
+00084920: 6e28 7768 2920 3e20 303a 0a20 2020 2020  n(wh) > 0:.     
+00084930: 2020 2020 2020 2066 6f72 2077 2069 6e20         for w in 
+00084940: 7768 3a20 6764 2e63 6473 2e72 676e 732e  wh: gd.cds.rgns.
+00084950: 6170 7065 6e64 2863 5f74 6f5f 6164 645b  append(c_to_add[
+00084960: 775d 290a 0a20 2020 2065 6c61 7073 6564  w])..    elapsed
+00084970: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
+00084980: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
+00084990: 0a20 2020 2023 2070 7269 6e74 2827 2020  .    # print('  
+000849a0: 2034 2e20 646f 6e65 2028 2569 2920 2027   4. done (%i)  '
+000849b0: 2025 2028 656c 6170 7365 645f 7469 6d65   % (elapsed_time
+000849c0: 292c 2066 6c75 7368 203d 2054 7275 6529  ), flush = True)
+000849d0: 0a20 2020 200a 2020 2020 2323 2323 2323  .    .    ######
+000849e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000849f0: 2323 0a20 2020 2023 2320 636f 6469 6e67  ##.    ## coding
+00084a00: 2072 6567 696f 6e20 7570 6461 7465 0a20   region update. 
+00084a10: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00084a20: 2323 2323 2323 2323 2323 230a 0a20 2020  ###########..   
+00084a30: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00084a40: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00084a50: 2049 6e74 6567 7269 7479 2063 6865 636b   Integrity check
+00084a60: 0a20 2020 200a 2020 2020 7374 6172 745f  .    .    start_
+00084a70: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+00084a80: 2829 0a20 2020 206e 5f62 6173 6573 5f74  ().    n_bases_t
+00084a90: 6f74 616c 203d 2030 0a20 2020 206e 5f65  otal = 0.    n_e
+00084aa0: 725f 6261 7365 7320 3d20 300a 2020 2020  r_bases = 0.    
+00084ab0: 6e5f 626c 6b5f 746f 7461 6c20 3d20 300a  n_blk_total = 0.
+00084ac0: 2020 2020 6e5f 6572 5f62 6c6b 203d 2030      n_er_blk = 0
+00084ad0: 0a20 2020 206e 7065 203d 2030 0a20 2020  .    npe = 0.   
+00084ae0: 206e 7074 203d 2030 0a20 2020 2066 6f72   npt = 0.    for
+00084af0: 2067 6420 696e 2067 645f 7365 6c3a 0a20   gd in gd_sel:. 
+00084b00: 2020 2020 2020 2066 6f72 2072 2069 6e20         for r in 
+00084b10: 6764 2e65 786f 6e73 2e72 676e 733a 0a20  gd.exons.rgns:. 
+00084b20: 2020 2020 2020 2020 2020 2069 6620 722e             if r.
+00084b30: 7479 7065 2021 3d20 2764 656c 6574 696f  type != 'deletio
+00084b40: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
+00084b50: 2020 2020 7331 203d 2072 2e73 6571 0a20      s1 = r.seq. 
+00084b60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00084b70: 3220 3d20 7365 715f 6e65 775b 2872 2e73  2 = seq_new[(r.s
+00084b80: 7461 7274 2d31 293a 722e 656e 645d 2023  tart-1):r.end] #
+00084b90: 2067 656e 6f6d 655b 722e 6368 725d 2e73   genome[r.chr].s
+00084ba0: 6571 5b28 722e 7374 6172 742d 3129 3a72  eq[(r.start-1):r
+00084bb0: 2e65 6e64 5d0a 2020 2020 2020 2020 2020  .end].          
+00084bc0: 2020 2020 2020 6e5f 6572 203d 2063 6f6d        n_er = com
+00084bd0: 7061 7265 5f73 6571 3228 2073 312c 2073  pare_seq2( s1, s
+00084be0: 3220 290a 2020 2020 2020 2020 2020 2020  2 ).            
+00084bf0: 2020 2020 2320 6966 206e 5f65 7220 3e20      # if n_er > 
+00084c00: 303a 2070 7269 6e74 2827 5c6e 5331 3a20  0: print('\nS1: 
+00084c10: 2573 5c6e 5332 3a20 2573 2720 2520 2873  %s\nS2: %s' % (s
+00084c20: 312c 7332 2929 0a20 2020 2020 2020 2020  1,s2)).         
+00084c30: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00084c40: 2020 2020 2020 2020 2020 2020 6e5f 6261              n_ba
+00084c50: 7365 735f 746f 7461 6c20 2b3d 206c 656e  ses_total += len
+00084c60: 2873 3129 0a20 2020 2020 2020 2020 2020  (s1).           
+00084c70: 2020 2020 206e 5f65 725f 6261 7365 7320       n_er_bases 
+00084c80: 2b3d 206e 5f65 720a 2020 2020 2020 2020  += n_er.        
+00084c90: 2020 2020 2020 2020 6e5f 626c 6b5f 746f          n_blk_to
+00084ca0: 7461 6c20 2b3d 2031 0a20 2020 2020 2020  tal += 1.       
+00084cb0: 2020 2020 2020 2020 2069 6620 6e5f 6572           if n_er
+00084cc0: 203e 2030 3a20 6e5f 6572 5f62 6c6b 202b   > 0: n_er_blk +
+00084cd0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00084ce0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00084cf0: 206e 7472 2c20 6e70 722c 206e 6572 203d   ntr, npr, ner =
+00084d00: 2067 642e 7570 6461 7465 5f74 645f 696e   gd.update_td_in
+00084d10: 666f 2873 656c 203d 2031 2c20 7065 7074  fo(sel = 1, pept
+00084d20: 6964 6520 3d20 5472 7565 290a 2020 2020  ide = True).    
+00084d30: 2020 2020 6e65 2c20 6e74 203d 2067 642e      ne, nt = gd.
+00084d40: 636f 6d70 6172 655f 7365 7173 5f66 726f  compare_seqs_fro
+00084d50: 6d5f 6364 735f 616e 645f 6765 6e6f 6d65  m_cds_and_genome
+00084d60: 2873 6571 5f6e 6577 2920 2320 6765 6e6f  (seq_new) # geno
+00084d70: 6d65 5b67 642e 6368 725d 2e73 6571 290a  me[gd.chr].seq).
+00084d80: 2020 2020 2020 2020 6e70 6520 2b3d 206e          npe += n
+00084d90: 650a 2020 2020 2020 2020 6e70 7420 2b3d  e.        npt +=
+00084da0: 206e 740a 0a20 2020 2020 2020 2023 2069   nt..        # i
+00084db0: 6620 6e65 7220 3e20 303a 2070 7269 6e74  f ner > 0: print
+00084dc0: 2827 496e 7465 6772 6974 7920 6368 6563  ('Integrity chec
+00084dd0: 6b20 6572 726f 7220 4120 696e 2025 733a  k error A in %s:
+00084de0: 2025 6920 2d20 2569 2f25 692c 2025 692f   %i - %i/%i, %i/
+00084df0: 2569 2c20 2569 2f25 6927 2025 2028 6368  %i, %i/%i' % (ch
+00084e00: 726d 2c20 6e65 722c 206e 5f65 725f 6261  rm, ner, n_er_ba
+00084e10: 7365 732c 206e 5f62 6173 6573 5f74 6f74  ses, n_bases_tot
+00084e20: 616c 2c20 6e5f 6572 5f62 6c6b 2c20 6e5f  al, n_er_blk, n_
+00084e30: 626c 6b5f 746f 7461 6c2c 206e 7065 2c20  blk_total, npe, 
+00084e40: 6e70 7429 2029 0a20 2020 2020 2020 2023  npt) ).        #
+00084e50: 2069 6620 6e5f 6572 203e 2030 3a20 7072   if n_er > 0: pr
+00084e60: 696e 7428 2749 6e74 6567 7269 7479 2063  int('Integrity c
+00084e70: 6865 636b 2065 7272 6f72 2069 6e20 2573  heck error in %s
+00084e80: 3a20 2569 202d 2025 692f 2569 2c20 2569  : %i - %i/%i, %i
+00084e90: 2f25 692c 2025 692f 2569 2720 2520 2863  /%i, %i/%i' % (c
+00084ea0: 6872 6d2c 206e 5f65 722c 206e 5f65 725f  hrm, n_er, n_er_
+00084eb0: 6261 7365 732c 206e 5f62 6173 6573 5f74  bases, n_bases_t
+00084ec0: 6f74 616c 2c20 6e5f 6572 5f62 6c6b 2c20  otal, n_er_blk, 
+00084ed0: 6e5f 626c 6b5f 746f 7461 6c2c 206e 7065  n_blk_total, npe
+00084ee0: 2c20 6e70 7429 2029 0a0a 2020 2020 656c  , npt) )..    el
+00084ef0: 6170 7365 645f 7469 6d65 203d 2074 696d  apsed_time = tim
+00084f00: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
+00084f10: 5f74 696d 650a 2020 2020 2320 7072 696e  _time.    # prin
+00084f20: 7428 2720 2020 352e 2064 6f6e 6520 2825  t('   5. done (%
+00084f30: 6929 2020 2720 2520 2865 6c61 7073 6564  i)  ' % (elapsed
+00084f40: 5f74 696d 6529 2c20 666c 7573 6820 3d20  _time), flush = 
+00084f50: 5472 7565 290a 2020 2020 0a20 2020 2065  True).    .    e
+00084f60: 7374 6174 203d 2028 6e5f 6261 7365 735f  stat = (n_bases_
+00084f70: 746f 7461 6c2c 206e 5f65 725f 6261 7365  total, n_er_base
+00084f80: 732c 206e 5f62 6c6b 5f74 6f74 616c 2c20  s, n_blk_total, 
+00084f90: 6e5f 6572 5f62 6c6b 2c20 6e70 742c 206e  n_er_blk, npt, n
+00084fa0: 7065 290a 2020 2020 0a20 2020 2072 6574  pe).    .    ret
+00084fb0: 7572 6e20 6764 5f73 656c 2c20 7365 715f  urn gd_sel, seq_
+00084fc0: 6e65 772c 2073 6e76 5f69 6e66 6f5f 6368  new, snv_info_ch
+00084fd0: 722c 206f 662c 2063 6872 6d2c 2065 7374  r, of, chrm, est
+00084fe0: 6174 0a0a 2727 270a 4e56 5f69 6e66 6f5f  at..'''.NV_info_
+00084ff0: 6578 745f 7472 203d 2063 6f6c 6c65 6374  ext_tr = collect
+00085000: 696f 6e73 2e6e 616d 6564 7475 706c 6528  ions.namedtuple(
+00085010: 274e 565f 696e 666f 5f65 7874 5f74 7227  'NV_info_ext_tr'
+00085020: 2c20 2763 6872 2c20 706f 735f 7265 662c  , 'chr, pos_ref,
+00085030: 2070 6f73 5f6e 6577 2c20 6765 6e65 5f69   pos_new, gene_i
+00085040: 642c 2067 656e 655f 6e61 6d65 2c20 765f  d, gene_name, v_
+00085050: 7479 7065 2c20 765f 6c65 6e2c 2063 7667  type, v_len, cvg
+00085060: 5f64 6570 7468 2c20 6376 675f 6672 6163  _depth, cvg_frac
+00085070: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00085080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085090: 2020 2020 2020 7265 665f 7072 6576 2c20        ref_prev, 
+000850a0: 7265 665f 7365 712c 2072 6566 5f6e 6578  ref_seq, ref_nex
+000850b0: 742c 2061 6c74 5f70 7265 762c 2061 6c74  t, alt_prev, alt
+000850c0: 5f73 6571 2c20 616c 745f 6e65 7874 2c20  _seq, alt_next, 
+000850d0: 765f 636c 6173 732c 205c 0a20 2020 2020  v_class, \.     
+000850e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000850f0: 2020 2020 2020 2020 2020 2020 2076 5f63               v_c
+00085100: 6c61 7373 5f74 722c 2073 7472 616e 642c  lass_tr, strand,
+00085110: 2063 444e 415f 6368 616e 6765 2c20 436f   cDNA_change, Co
+00085120: 646f 6e5f 6368 616e 6765 2c20 5072 6f74  don_change, Prot
+00085130: 6569 6e5f 6368 616e 6765 2c20 5072 6f74  ein_change, Prot
+00085140: 6569 6e5f 6368 616e 6765 322c 2043 6865  ein_change2, Che
+00085150: 636b 2729 2020 2320 6f6e 652d 6261 7365  ck')  # one-base
+00085160: 0a0a 6465 6620 7772 6974 655f 746f 5f76  ..def write_to_v
+00085170: 6366 2820 736e 765f 696e 666f 5f6c 7374  cf( snv_info_lst
+00085180: 2c20 6669 6c65 5f6e 616d 6520 293a 0a0a  , file_name ):..
+00085190: 2020 2020 6966 206c 656e 2873 6e76 5f69      if len(snv_i
+000851a0: 6e66 6f5f 6c73 7429 203d 3d20 303a 0a20  nfo_lst) == 0:. 
+000851b0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+000851c0: 2020 0a20 2020 2069 6620 6c65 6e28 736e    .    if len(sn
+000851d0: 765f 696e 666f 5f6c 7374 5b30 5d29 203c  v_info_lst[0]) <
+000851e0: 3d20 3230 3a0a 2020 2020 2020 2020 7061  = 20:.        pa
+000851f0: 7373 0a20 2020 2065 6c73 653a 0a20 2020  ss.    else:.   
+00085200: 2020 2020 2066 203d 206f 7065 6e28 2066       f = open( f
+00085210: 6e61 6d65 5f76 6366 2c20 2777 742b 2720  name_vcf, 'wt+' 
+00085220: 290a 0a20 2020 2020 2020 206c 696e 6573  )..        lines
+00085230: 203d 205b 2723 4348 524f 4d5c 7450 4f53   = ['#CHROM\tPOS
+00085240: 5c74 4944 5c74 5245 465c 7441 4c54 5c74  \tID\tREF\tALT\t
+00085250: 5155 414c 5c74 4649 4c54 4552 5c74 494e  QUAL\tFILTER\tIN
+00085260: 464f 275d 0a20 2020 2020 2020 2066 6f72  FO'].        for
+00085270: 206e 6920 696e 2073 6e76 5f69 6e66 6f5f   ni in snv_info_
+00085280: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
+00085290: 206d 6964 203d 0a20 2020 2020 2020 2020   mid =.         
+000852a0: 2020 2051 7561 6c20 3d0a 2020 2020 2020     Qual =.      
+000852b0: 2020 2020 2020 4669 6c74 6572 203d 0a20        Filter =. 
+000852c0: 2020 2020 2020 2020 2020 2069 6e66 6f20             info 
+000852d0: 3d20 2741 433d 2569 3b41 4627 0a20 2020  = 'AC=%i;AF'.   
+000852e0: 2020 2020 2020 2020 2027 2573 5c74 2569           '%s\t%i
+000852f0: 5c74 2573 5c74 2573 5c74 2573 5c74 2569  \t%s\t%s\t%s\t%i
+00085300: 5c74 2573 5c74 2573 5c6e 2720 2520 286e  \t%s\t%s\n' % (n
+00085310: 692e 6368 722c 206e 692e 706f 735f 7265  i.chr, ni.pos_re
+00085320: 662c 206d 6964 2c20 6e69 2e72 6566 5f73  f, mid, ni.ref_s
+00085330: 6571 2c20 6e69 2e61 6c74 5f73 6571 2c20  eq, ni.alt_seq, 
+00085340: 5175 616c 2c20 696e 666f 290a 0a20 2020  Qual, info)..   
+00085350: 2020 2020 2066 2e63 6c6f 7365 2829 0a20       f.close(). 
+00085360: 2020 2020 2020 200a 2020 2020 7265 7475         .    retu
+00085370: 726e 0a27 2727 0a0a 6465 6620 6d63 5f63  rn.'''..def mc_c
+00085380: 6f72 655f 6765 745f 6774 665f 616e 645f  ore_get_gtf_and_
+00085390: 6661 7374 615f 7074 2867 6429 3a0a 2020  fasta_pt(gd):.  
+000853a0: 2020 0a20 2020 206e 7472 2c20 6e70 722c    .    ntr, npr,
+000853b0: 206e 6572 203d 2067 642e 7570 6461 7465   ner = gd.update
+000853c0: 5f74 645f 696e 666f 2873 656c 203d 2031  _td_info(sel = 1
+000853d0: 2c20 7065 7074 6964 6520 3d20 5472 7565  , peptide = True
+000853e0: 290a 2020 2020 6774 665f 6c69 6e65 2c20  ).    gtf_line, 
+000853f0: 636e 203d 2067 642e 6765 745f 6774 665f  cn = gd.get_gtf_
+00085400: 6c69 6e65 735f 6672 6f6d 5f65 786f 6e73  lines_from_exons
+00085410: 2873 656c 203d 2031 2c20 6164 645f 7365  (sel = 1, add_se
+00085420: 7120 3d20 4661 6c73 652c 2063 6f6e 6e65  q = False, conne
+00085430: 6374 203d 2054 7275 6529 0a20 2020 206c  ct = True).    l
+00085440: 742c 206c 7020 3d20 6764 2e67 6574 5f66  t, lp = gd.get_f
+00085450: 6173 7461 5f6c 696e 6573 5f66 726f 6d5f  asta_lines_from_
+00085460: 6578 6f6e 7328 7365 6c20 3d20 312c 2070  exons(sel = 1, p
+00085470: 6570 7469 6465 203d 2054 7275 6529 0a20  eptide = True). 
+00085480: 2020 2072 6574 7572 6e20 6774 665f 6c69     return gtf_li
+00085490: 6e65 2c20 6c74 2c20 6c70 2c20 6764 2e63  ne, lt, lp, gd.c
+000854a0: 6872 2c20 6e65 722c 2063 6e0a 0a0a 2727  hr, ner, cn...''
+000854b0: 270a 4e56 5f69 6e66 6f5f 6578 745f 7472  '.NV_info_ext_tr
+000854c0: 203d 2063 6f6c 6c65 6374 696f 6e73 2e6e   = collections.n
+000854d0: 616d 6564 7475 706c 6528 274e 565f 696e  amedtuple('NV_in
+000854e0: 666f 5f65 7874 5f74 7227 2c20 2763 6872  fo_ext_tr', 'chr
+000854f0: 2c20 706f 735f 7265 662c 2070 6f73 5f6e  , pos_ref, pos_n
+00085500: 6577 2c20 6765 6e65 5f69 642c 2067 656e  ew, gene_id, gen
+00085510: 655f 6e61 6d65 2c20 765f 7479 7065 2c20  e_name, v_type, 
+00085520: 765f 6c65 6e2c 2063 7667 5f64 6570 7468  v_len, cvg_depth
+00085530: 2c20 6376 675f 6672 6163 2c20 5c0a 2020  , cvg_frac, \.  
+00085540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085560: 7265 665f 7072 6576 2c20 7265 665f 7365  ref_prev, ref_se
+00085570: 712c 2072 6566 5f6e 6578 742c 2061 6c74  q, ref_next, alt
+00085580: 5f70 7265 762c 2061 6c74 5f73 6571 2c20  _prev, alt_seq, 
+00085590: 616c 745f 6e65 7874 2c20 765f 636c 6173  alt_next, v_clas
+000855a0: 732c 205c 0a20 2020 2020 2020 2020 2020  s, \.           
+000855b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000855c0: 2020 2020 2020 2076 5f63 6c61 7373 5f74         v_class_t
+000855d0: 722c 2073 7472 616e 642c 2063 444e 415f  r, strand, cDNA_
+000855e0: 6368 616e 6765 2c20 436f 646f 6e5f 6368  change, Codon_ch
+000855f0: 616e 6765 2c20 5072 6f74 6569 6e5f 6368  ange, Protein_ch
+00085600: 616e 6765 2c20 5072 6f74 6569 6e5f 6368  ange, Protein_ch
+00085610: 616e 6765 3227 2920 232c 2043 6865 636b  ange2') #, Check
+00085620: 2729 2020 2320 6f6e 652d 6261 7365 0a27  ')  # one-base.'
+00085630: 2727 0a0a 4e56 5f69 6e66 6f5f 7472 203d  ''..NV_info_tr =
+00085640: 2063 6f6c 6c65 6374 696f 6e73 2e6e 616d   collections.nam
+00085650: 6564 7475 706c 6528 274e 565f 696e 666f  edtuple('NV_info
+00085660: 5f65 7874 5f74 7227 2c20 2763 6872 2c20  _ext_tr', 'chr, 
+00085670: 706f 735f 7265 662c 2067 656e 655f 6e61  pos_ref, gene_na
+00085680: 6d65 2c20 6765 6e65 5f69 642c 2076 5f74  me, gene_id, v_t
+00085690: 7970 652c 2076 5f6c 656e 2c20 5c0a 2020  ype, v_len, \.  
+000856a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000856b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000856c0: 6376 675f 6465 7074 682c 2063 7667 5f66  cvg_depth, cvg_f
+000856d0: 7261 632c 2072 6566 5f73 6571 2c20 616c  rac, ref_seq, al
+000856e0: 745f 7365 712c 205c 0a20 2020 2020 2020  t_seq, \.       
+000856f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085700: 2020 2020 2020 2020 2020 2073 7472 616e             stran
+00085710: 642c 2063 444e 415f 6368 616e 6765 2c20  d, cDNA_change, 
+00085720: 436f 646f 6e5f 6368 616e 6765 2c20 5072  Codon_change, Pr
+00085730: 6f74 6569 6e5f 6368 616e 6765 2c20 5072  otein_change, Pr
+00085740: 6f74 6569 6e5f 6368 616e 6765 322c 2076  otein_change2, v
+00085750: 5f63 6c61 7373 2729 200a 0a64 6566 2074  _class') ..def t
+00085760: 6f5f 6e76 5f73 696d 706c 6528 206e 7620  o_nv_simple( nv 
+00085770: 293a 0a0a 2020 2020 6e76 6920 3d20 4e56  ):..    nvi = NV
+00085780: 5f69 6e66 6f5f 7472 2820 6e76 2e63 6872  _info_tr( nv.chr
+00085790: 2c20 6e76 2e70 6f73 5f72 6566 2c20 6e76  , nv.pos_ref, nv
+000857a0: 2e67 656e 655f 6e61 6d65 2c20 6e76 2e67  .gene_name, nv.g
+000857b0: 656e 655f 6964 2c20 6e76 2e76 5f74 7970  ene_id, nv.v_typ
+000857c0: 652c 206e 762e 765f 6c65 6e2c 205c 0a20  e, nv.v_len, \. 
+000857d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000857e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000857f0: 762e 6376 675f 6465 7074 682c 206e 762e  v.cvg_depth, nv.
+00085800: 6376 675f 6672 6163 2c20 6e76 2e72 6566  cvg_frac, nv.ref
+00085810: 5f73 6571 2c20 6e76 2e61 6c74 5f73 6571  _seq, nv.alt_seq
+00085820: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00085830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085840: 2020 2020 6e76 2e73 7472 616e 642c 206e      nv.strand, n
+00085850: 762e 6344 4e41 5f63 6861 6e67 652c 206e  v.cDNA_change, n
+00085860: 762e 436f 646f 6e5f 6368 616e 6765 2c20  v.Codon_change, 
+00085870: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00085880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085890: 2020 6e76 2e50 726f 7465 696e 5f63 6861    nv.Protein_cha
+000858a0: 6e67 652c 206e 762e 5072 6f74 6569 6e5f  nge, nv.Protein_
+000858b0: 6368 616e 6765 322c 206e 762e 765f 636c  change2, nv.v_cl
+000858c0: 6173 735f 7472 2029 0a20 2020 2072 6574  ass_tr ).    ret
+000858d0: 7572 6e20 6e76 690a 0a64 6566 2053 7472  urn nvi..def Str
+000858e0: 696e 6746 6978 5f73 796e 7468 6573 6973  ingFix_synthesis
+000858f0: 2867 7466 5f66 696c 652c 2067 656e 6f6d  (gtf_file, genom
+00085900: 655f 6669 6c65 2c20 7265 7620 3d20 5472  e_file, rev = Tr
+00085910: 7565 2c20 6e5f 636f 7265 7320 3d20 312c  ue, n_cores = 1,
+00085920: 206f 7574 5f64 6972 203d 204e 6f6e 652c   out_dir = None,
+00085930: 2067 6473 203d 204e 6f6e 6529 3a0a 0a20   gds = None):.. 
+00085940: 2020 2023 2070 7269 6e74 2827 5374 7269     # print('Stri
+00085950: 6e67 4669 785f 7379 6e74 6865 7369 7320  ngFix_synthesis 
+00085960: 7374 6172 7465 6420 272c 2064 6174 6574  started ', datet
+00085970: 696d 652e 6461 7465 7469 6d65 2e6e 6f77  ime.datetime.now
+00085980: 2829 290a 2020 2020 0a20 2020 2069 6620  ()).    .    if 
+00085990: 6973 696e 7374 616e 6365 2867 656e 6f6d  isinstance(genom
+000859a0: 655f 6669 6c65 2c20 7374 7229 3a0a 2020  e_file, str):.  
+000859b0: 2020 2020 2020 6765 6e6f 6d65 203d 206c        genome = l
+000859c0: 6f61 645f 6765 6e6f 6d65 2867 656e 6f6d  oad_genome(genom
+000859d0: 655f 6669 6c65 2c20 7665 7262 6f73 6520  e_file, verbose 
+000859e0: 3d20 5472 7565 290a 2020 2020 656c 7365  = True).    else
+000859f0: 3a0a 2020 2020 2020 2020 6765 6e6f 6d65  :.        genome
+00085a00: 203d 2067 656e 6f6d 655f 6669 6c65 0a0a   = genome_file..
+00085a10: 2020 2020 6966 2067 6473 2069 7320 4e6f      if gds is No
+00085a20: 6e65 3a0a 2020 2020 2020 2020 6774 665f  ne:.        gtf_
+00085a30: 6c69 6e65 732c 2068 6472 5f6c 696e 6573  lines, hdr_lines
+00085a40: 203d 206c 6f61 645f 6774 6628 6774 665f   = load_gtf(gtf_
+00085a50: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
+00085a60: 5472 7565 290a 2020 2020 2020 2020 6764  True).        gd
+00085a70: 5f6c 7374 2c20 6368 7273 203d 2067 6574  _lst, chrs = get
+00085a80: 5f67 656e 655f 6465 7363 7269 7074 6f72  _gene_descriptor
+00085a90: 2867 7466 5f6c 696e 6573 2c20 6765 6e6f  (gtf_lines, geno
+00085aa0: 6d65 203d 204e 6f6e 652c 2066 696c 6c20  me = None, fill 
+00085ab0: 3d20 5472 7565 2c20 5c0a 2020 2020 2020  = True, \.      
+00085ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085ae0: 2020 2020 2020 2020 2063 6720 3d20 5472           cg = Tr
+00085af0: 7565 2c20 7665 7262 6f73 6520 3d20 5472  ue, verbose = Tr
+00085b00: 7565 2c20 6e5f 636f 7265 7320 3d20 3129  ue, n_cores = 1)
+00085b10: 0a20 2020 2020 2020 2067 645f 6c73 7473  .        gd_lsts
+00085b20: 2c20 6368 725f 6c73 7420 3d20 7061 636b  , chr_lst = pack
+00085b30: 5f67 656e 655f 6465 7363 7269 7074 6f72  _gene_descriptor
+00085b40: 2820 6764 5f6c 7374 2c20 6368 7273 2029  ( gd_lst, chrs )
+00085b50: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00085b60: 2020 666f 7220 6764 6c20 696e 2067 645f    for gdl in gd_
+00085b70: 6c73 7473 3a20 0a20 2020 2020 2020 2020  lsts: .         
+00085b80: 2020 2066 6f72 206d 2c20 6764 2069 6e20     for m, gd in 
+00085b90: 656e 756d 6572 6174 6528 6764 6c29 3a0a  enumerate(gdl):.
+00085ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085bb0: 6764 2e73 6574 5f63 6f76 5f6e 5f61 626e  gd.set_cov_n_abn
+00085bc0: 5f74 6828 204d 494e 5f43 4f56 5f54 4f5f  _th( MIN_COV_TO_
+00085bd0: 5345 4c2c 204d 494e 5f41 424e 5f54 4f5f  SEL, MIN_ABN_TO_
+00085be0: 5345 4c20 290a 0a20 2020 2020 2020 206e  SEL )..        n
+00085bf0: 7472 5f76 616c 6964 203d 2030 0a20 2020  tr_valid = 0.   
+00085c00: 2020 2020 2067 6763 5f74 7570 6c65 203d       ggc_tuple =
+00085c10: 205b 5d0a 2020 2020 2020 2020 6368 725f   [].        chr_
+00085c20: 6c73 745f 6e65 7720 3d20 5b5d 0a20 2020  lst_new = [].   
+00085c30: 2020 2020 2066 6f72 206b 6b2c 2063 6872       for kk, chr
+00085c40: 6d20 696e 2065 6e75 6d65 7261 7465 2863  m in enumerate(c
+00085c50: 6872 5f6c 7374 293a 0a20 2020 2020 2020  hr_lst):.       
+00085c60: 2020 2020 2069 6620 6368 726d 2069 6e20       if chrm in 
+00085c70: 6765 6e6f 6d65 2e6b 6579 7328 293a 0a20  genome.keys():. 
+00085c80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00085c90: 6872 5f6c 7374 5f6e 6577 2e61 7070 656e  hr_lst_new.appen
+00085ca0: 6428 6368 726d 290a 2020 2020 2020 2020  d(chrm).        
+00085cb0: 2020 2020 2020 2020 6767 635f 7475 706c          ggc_tupl
+00085cc0: 652e 6170 7065 6e64 2820 2867 645f 6c73  e.append( (gd_ls
+00085cd0: 7473 5b6b 6b5d 2c20 6765 6e6f 6d65 5b63  ts[kk], genome[c
+00085ce0: 6872 6d5d 2e73 6571 2c20 6368 726d 2920  hrm].seq, chrm) 
+00085cf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00085d00: 2020 666f 7220 6764 2069 6e20 6764 5f6c    for gd in gd_l
+00085d10: 7374 735b 6b6b 5d3a 0a20 2020 2020 2020  sts[kk]:.       
+00085d20: 2020 2020 2020 2020 2020 2020 206e 7472               ntr
+00085d30: 5f76 616c 6964 202b 3d20 6764 2e6e 7472  _valid += gd.ntr
+00085d40: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
+00085d50: 2827 4e5f 7472 7320 7661 6c69 6420 3d20  ('N_trs valid = 
+00085d60: 2569 2720 2520 6e74 725f 7661 6c69 6429  %i' % ntr_valid)
+00085d70: 0a20 2020 2020 2020 2064 656c 2067 645f  .        del gd_
+00085d80: 6c73 7473 0a0a 2020 2020 656c 7365 3a0a  lsts..    else:.
+00085d90: 2020 2020 2020 2020 6774 665f 6c69 6e65          gtf_line
+00085da0: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
+00085db0: 6f61 645f 6774 6628 6774 665f 6669 6c65  oad_gtf(gtf_file
+00085dc0: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
+00085dd0: 652c 2068 6f20 3d20 5472 7565 290a 0a20  e, ho = True).. 
+00085de0: 2020 2020 2020 2066 6d20 3d20 7b27 4d27         fm = {'M'
+00085df0: 3a20 2765 786f 6e27 2c20 2749 273a 2027  : 'exon', 'I': '
+00085e00: 696e 7365 7273 696f 6e27 2c20 2744 273a  insersion', 'D':
+00085e10: 2027 6465 6c65 7469 6f6e 277d 0a20 2020   'deletion'}.   
+00085e20: 2020 2020 2066 6f72 206d 2c20 6764 2069       for m, gd i
+00085e30: 6e20 656e 756d 6572 6174 6528 6764 7329  n enumerate(gds)
+00085e40: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
+00085e50: 2e73 6574 5f63 6f76 5f6e 5f61 626e 5f74  .set_cov_n_abn_t
+00085e60: 6828 204d 494e 5f43 4f56 5f54 4f5f 5345  h( MIN_COV_TO_SE
+00085e70: 4c2c 204d 494e 5f41 424e 5f54 4f5f 5345  L, MIN_ABN_TO_SE
+00085e80: 4c20 290a 2020 2020 2020 2020 2020 2020  L ).            
+00085e90: 6966 2028 6c65 6e28 6764 2e72 676e 732e  if (len(gd.rgns.
+00085ea0: 7267 6e73 2920 3e20 3029 3a0a 2020 2020  rgns) > 0):.    
+00085eb0: 2020 2020 2020 2020 2020 2020 6764 2e65              gd.e
+00085ec0: 786f 6e73 2e72 676e 732c 2067 642e 7267  xons.rgns, gd.rg
+00085ed0: 6e73 2e72 676e 7320 3d20 6764 2e72 676e  ns.rgns = gd.rgn
+00085ee0: 732e 7267 6e73 2c20 6764 2e65 786f 6e73  s.rgns, gd.exons
+00085ef0: 2e72 676e 730a 2020 2020 2020 2020 2020  .rgns.          
+00085f00: 2020 2020 2020 6764 2e74 655f 746f 5f67        gd.te_to_g
+00085f10: 655f 6d61 7073 2c20 6764 2e74 725f 746f  e_maps, gd.tr_to
+00085f20: 5f67 725f 6d61 7073 203d 2067 642e 7472  _gr_maps = gd.tr
+00085f30: 5f74 6f5f 6772 5f6d 6170 732c 2067 642e  _to_gr_maps, gd.
+00085f40: 7465 5f74 6f5f 6765 5f6d 6170 730a 2020  te_to_ge_maps.  
+00085f50: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00085f60: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+00085f70: 2069 6e20 6764 2e65 786f 6e73 2e72 676e   in gd.exons.rgn
+00085f80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00085f90: 2020 2069 6620 722e 7479 7065 2069 6e20     if r.type in 
+00085fa0: 666d 2e6b 6579 7328 293a 0a20 2020 2020  fm.keys():.     
+00085fb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00085fc0: 2e74 7970 6520 3d20 666d 5b72 2e74 7970  .type = fm[r.typ
+00085fd0: 655d 0a0a 2020 2020 2020 2020 6368 7273  e]..        chrs
+00085fe0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00085ff0: 7220 6764 2069 6e20 6764 733a 200a 2020  r gd in gds: .  
+00086000: 2020 2020 2020 2020 2020 6368 7273 2e61            chrs.a
+00086010: 7070 656e 6428 6764 2e63 6872 290a 0a20  ppend(gd.chr).. 
+00086020: 2020 2020 2020 2063 6872 5f6c 7374 203d         chr_lst =
+00086030: 206c 6973 7428 7365 7428 6368 7273 2929   list(set(chrs))
+00086040: 0a20 2020 2020 2020 2063 6872 5f6c 7374  .        chr_lst
+00086050: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
+00086060: 6368 7273 203d 206e 702e 6172 7261 7928  chrs = np.array(
+00086070: 6368 7273 290a 0a20 2020 2020 2020 206e  chrs)..        n
+00086080: 7472 5f76 616c 6964 203d 2030 0a20 2020  tr_valid = 0.   
+00086090: 2020 2020 2067 6763 5f74 7570 6c65 203d       ggc_tuple =
+000860a0: 205b 5d0a 2020 2020 2020 2020 6368 725f   [].        chr_
+000860b0: 6c73 745f 6e65 7720 3d20 5b5d 0a20 2020  lst_new = [].   
+000860c0: 2020 2020 2066 6f72 206b 6b2c 2063 6872       for kk, chr
+000860d0: 6d20 696e 2065 6e75 6d65 7261 7465 2863  m in enumerate(c
+000860e0: 6872 5f6c 7374 293a 0a20 2020 2020 2020  hr_lst):.       
+000860f0: 2020 2020 2069 6620 6368 726d 2069 6e20       if chrm in 
+00086100: 6765 6e6f 6d65 2e6b 6579 7328 293a 0a20  genome.keys():. 
+00086110: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00086120: 6820 3d20 7768 6963 6828 6368 7273 203d  h = which(chrs =
+00086130: 3d20 6368 726d 290a 2020 2020 2020 2020  = chrm).        
+00086140: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
+00086150: 6829 203e 2030 3a0a 2020 2020 2020 2020  h) > 0:.        
+00086160: 2020 2020 2020 2020 2020 2020 735f 706f              s_po
+00086170: 7320 3d20 6e70 2e7a 6572 6f73 286c 656e  s = np.zeros(len
+00086180: 2877 6829 2c64 7479 7065 3d6e 702e 666c  (wh),dtype=np.fl
+00086190: 6f61 7433 3229 0a20 2020 2020 2020 2020  oat32).         
+000861a0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+000861b0: 2069 6e20 7261 6e67 6528 6c65 6e28 7768   in range(len(wh
+000861c0: 2929 3a20 0a20 2020 2020 2020 2020 2020  )): .           
+000861d0: 2020 2020 2020 2020 2020 2020 2073 5f70               s_p
+000861e0: 6f73 5b6b 5d20 3d20 6764 735b 7768 5b6b  os[k] = gds[wh[k
+000861f0: 5d5d 2e62 6567 696e 0a20 2020 2020 2020  ]].begin.       
+00086200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086210: 206e 7472 5f76 616c 6964 202b 3d20 6764   ntr_valid += gd
+00086220: 2e6e 7472 0a20 2020 2020 2020 2020 2020  .ntr.           
+00086230: 2020 2020 2020 2020 206f 6472 203d 2073           odr = s
+00086240: 5f70 6f73 2e61 7267 736f 7274 2829 0a0a  _pos.argsort()..
+00086250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086260: 2020 2020 6368 725f 6c73 745f 6e65 772e      chr_lst_new.
+00086270: 6170 7065 6e64 2863 6872 6d29 0a20 2020  append(chrm).   
+00086280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086290: 2067 6763 5f74 7570 6c65 2e61 7070 656e   ggc_tuple.appen
+000862a0: 6428 2028 5b20 6764 735b 7768 5b6f 6472  d( ([ gds[wh[odr
+000862b0: 5b6b 5d5d 5d20 666f 7220 6b20 696e 2072  [k]]] for k in r
+000862c0: 616e 6765 286c 656e 2877 6829 2920 5d2c  ange(len(wh)) ],
+000862d0: 2067 656e 6f6d 655b 6368 726d 5d2e 7365   genome[chrm].se
+000862e0: 712c 2063 6872 6d29 2029 0a0a 2020 2020  q, chrm) )..    
+000862f0: 2020 2020 2320 7072 696e 7428 274e 5f74      # print('N_t
+00086300: 7273 2076 616c 6964 203d 2025 6927 2025  rs valid = %i' %
+00086310: 206e 7472 5f76 616c 6964 290a 2020 2020   ntr_valid).    
+00086320: 2020 2020 6465 6c20 6764 730a 0a0a 2020      del gds...  
+00086330: 2020 6669 6c65 5f6e 616d 6520 3d20 6774    file_name = gt
+00086340: 665f 6669 6c65 2e73 706c 6974 2827 2f27  f_file.split('/'
+00086350: 295b 2d31 5d0a 2020 2020 2320 666e 616d  )[-1].    # fnam
+00086360: 6520 3d20 6669 6c65 5f6e 616d 652e 7370  e = file_name.sp
+00086370: 6c69 7428 272e 2729 5b30 5d0a 2020 2020  lit('.')[0].    
+00086380: 666e 7320 3d20 6669 6c65 5f6e 616d 652e  fns = file_name.
+00086390: 7370 6c69 7428 272e 2729 5b3a 2d31 5d0a  split('.')[:-1].
+000863a0: 2020 2020 666e 616d 6520 3d20 2727 0a20      fname = ''. 
+000863b0: 2020 2066 6f72 206b 2c20 666e 2069 6e20     for k, fn in 
+000863c0: 656e 756d 6572 6174 6528 666e 7329 3a0a  enumerate(fns):.
+000863d0: 2020 2020 2020 2020 6966 206b 203e 2030          if k > 0
+000863e0: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
+000863f0: 616d 6520 3d20 666e 616d 6520 2b20 272e  ame = fname + '.
+00086400: 270a 2020 2020 2020 2020 666e 616d 6520  '.        fname 
+00086410: 3d20 666e 616d 6520 2b20 666e 0a0a 2020  = fname + fn..  
+00086420: 2020 6966 206f 7574 5f64 6972 2069 7320    if out_dir is 
+00086430: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00086440: 2020 6966 206f 7574 5f64 6972 5b2d 315d    if out_dir[-1]
+00086450: 203d 3d20 272f 273a 0a20 2020 2020 2020   == '/':.       
+00086460: 2020 2020 2066 6e61 6d65 203d 206f 7574       fname = out
+00086470: 5f64 6972 202b 2066 6e61 6d65 0a20 2020  _dir + fname.   
+00086480: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00086490: 2020 2020 2020 2066 6e61 6d65 203d 206f         fname = o
+000864a0: 7574 5f64 6972 202b 2027 2f27 202b 2066  ut_dir + '/' + f
+000864b0: 6e61 6d65 0a0a 2020 2020 6765 6e6f 6d65  name..    genome
+000864c0: 5f66 696c 655f 6e65 7720 3d20 666e 616d  _file_new = fnam
+000864d0: 6520 2b20 275f 6375 7374 6f6d 697a 6564  e + '_customized
+000864e0: 5f67 656e 6f6d 652e 6661 270a 2020 2020  _genome.fa'.    
+000864f0: 6774 665f 6669 6c65 5f6e 6577 203d 2066  gtf_file_new = f
+00086500: 6e61 6d65 202b 2027 5f63 7573 746f 6d69  name + '_customi
+00086510: 7a65 642e 6774 6627 0a20 2020 2066 615f  zed.gtf'.    fa_
+00086520: 6669 6c65 5f74 725f 6e65 7720 3d20 666e  file_tr_new = fn
+00086530: 616d 6520 2b20 275f 7472 616e 7363 7269  ame + '_transcri
+00086540: 7074 6f6d 652e 6661 270a 2020 2020 6661  ptome.fa'.    fa
+00086550: 5f66 696c 655f 7072 5f6e 6577 203d 2066  _file_pr_new = f
+00086560: 6e61 6d65 202b 2027 5f70 726f 7465 6f6d  name + '_proteom
+00086570: 652e 6661 270a 2020 2020 666e 616d 655f  e.fa'.    fname_
+00086580: 736e 7620 3d20 666e 616d 6520 2b20 275f  snv = fname + '_
+00086590: 736e 765f 7375 6d6d 6172 792e 7473 7627  snv_summary.tsv'
+000865a0: 0a20 2020 2066 6e61 6d65 5f76 6366 203d  .    fname_vcf =
+000865b0: 2066 6e61 6d65 202b 2027 5f73 6e76 5f73   fname + '_snv_s
+000865c0: 756d 6d61 7279 2e76 6366 270a 0a20 2020  ummary.vcf'..   
+000865d0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+000865e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000865f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086600: 2323 2323 2323 230a 2020 2020 6368 725f  #######.    chr_
+00086610: 6c73 7420 3d20 6368 725f 6c73 745f 6e65  lst = chr_lst_ne
+00086620: 770a 0a20 2020 206f 665f 6469 6374 203d  w..    of_dict =
+00086630: 207b 7d0a 2020 2020 2320 6764 735f 6c73   {}.    # gds_ls
+00086640: 7420 3d20 5b5d 0a20 2020 2023 2073 6e76  t = [].    # snv
+00086650: 5f6c 7374 203d 205b 5d0a 2020 2020 6764  _lst = [].    gd
+00086660: 735f 6e65 7720 3d20 5b5d 0a20 2020 2073  s_new = [].    s
+00086670: 6e76 5f69 6e66 6f5f 6c73 7420 3d20 5b5d  nv_info_lst = []
+00086680: 0a0a 2020 2020 6e5f 6261 7365 735f 746f  ..    n_bases_to
+00086690: 7461 6c20 3d20 300a 2020 2020 6e5f 6572  tal = 0.    n_er
+000866a0: 5f62 6173 6573 203d 2030 0a20 2020 206e  _bases = 0.    n
+000866b0: 5f62 6c6b 5f74 6f74 616c 203d 2030 0a20  _blk_total = 0. 
+000866c0: 2020 206e 5f65 725f 626c 6b20 3d20 300a     n_er_blk = 0.
+000866d0: 2020 2020 6e70 7420 3d20 300a 2020 2020      npt = 0.    
+000866e0: 6e70 6520 3d20 300a 2020 2020 0a20 2020  npe = 0.    .   
+000866f0: 2073 7461 7274 5f74 696d 6520 3d20 7469   start_time = ti
+00086700: 6d65 2e74 696d 6528 290a 2020 2020 6966  me.time().    if
+00086710: 2028 6e5f 636f 7265 7320 3d3d 2031 2920   (n_cores == 1) 
+00086720: 7c20 286c 656e 2863 6872 5f6c 7374 2920  | (len(chr_lst) 
+00086730: 3d3d 2031 293a 0a20 2020 2020 2020 2066  == 1):.        f
+00086740: 6f72 206b 6b20 696e 2072 616e 6765 286c  or kk in range(l
+00086750: 656e 2863 6872 5f6c 7374 2929 3a0a 2020  en(chr_lst)):.  
+00086760: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00086770: 275c 7227 202b 2027 2027 2a31 3030 2c20  '\r' + ' '*100, 
+00086780: 656e 643d 2727 2c20 666c 7573 6820 3d20  end='', flush = 
+00086790: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+000867a0: 2020 7072 696e 7428 275c 7252 6563 6f6e    print('\rRecon
+000867b0: 7374 7275 6374 696e 6720 2e2e 2025 692f  structing .. %i/
+000867c0: 2569 2028 2573 2920 2720 2520 286b 6b2b  %i (%s) ' % (kk+
+000867d0: 312c 206c 656e 2863 6872 5f6c 7374 292c  1, len(chr_lst),
+000867e0: 2063 6872 5f6c 7374 5b6b 6b5d 292c 2065   chr_lst[kk]), e
+000867f0: 6e64 203d 2027 272c 2066 6c75 7368 203d  nd = '', flush =
+00086800: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
+00086810: 2020 2067 645f 7365 6c2c 2073 6571 5f6e     gd_sel, seq_n
+00086820: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
+00086830: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
+00086840: 7420 3d20 6d63 5f63 6f72 655f 7265 636f  t = mc_core_reco
+00086850: 6e73 7472 7563 7469 6f6e 2867 6763 5f74  nstruction(ggc_t
+00086860: 7570 6c65 5b6b 6b5d 290a 2020 2020 2020  uple[kk]).      
+00086870: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+00086880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086890: 0a20 2020 2020 2020 2020 2020 2067 656e  .            gen
+000868a0: 6f6d 655b 6368 726d 5d2e 7365 7120 3d20  ome[chrm].seq = 
+000868b0: 7365 715f 6e65 770a 2020 2020 2020 2020  seq_new.        
+000868c0: 2020 2020 6f66 5f64 6963 745b 6368 726d      of_dict[chrm
+000868d0: 5d20 3d20 6f66 0a20 2020 2020 2020 2020  ] = of.         
+000868e0: 2020 2023 2067 6473 5f6c 7374 2e61 7070     # gds_lst.app
+000868f0: 656e 6428 6764 5f73 656c 290a 2020 2020  end(gd_sel).    
+00086900: 2020 2020 2020 2020 2320 736e 765f 6c73          # snv_ls
+00086910: 742e 6170 7065 6e64 2873 6e76 5f69 6e66  t.append(snv_inf
+00086920: 6f5f 6368 7229 0a20 2020 2020 2020 2020  o_chr).         
+00086930: 2020 2067 6473 5f6e 6577 203d 2067 6473     gds_new = gds
+00086940: 5f6e 6577 202b 2067 645f 7365 6c0a 2020  _new + gd_sel.  
+00086950: 2020 2020 2020 2020 2020 736e 765f 696e            snv_in
+00086960: 666f 5f6c 7374 203d 2073 6e76 5f69 6e66  fo_lst = snv_inf
+00086970: 6f5f 6c73 7420 2b20 736e 765f 696e 666f  o_lst + snv_info
+00086980: 5f63 6872 0a0a 2020 2020 2020 2020 2020  _chr..          
+00086990: 2020 6e62 742c 206e 6265 2c20 6e6c 742c    nbt, nbe, nlt,
+000869a0: 206e 6c65 2c20 6e74 2c20 6e65 3d20 6573   nle, nt, ne= es
+000869b0: 7461 740a 2020 2020 2020 2020 2020 2020  tat.            
+000869c0: 6e5f 6261 7365 735f 746f 7461 6c20 2b3d  n_bases_total +=
+000869d0: 206e 6274 0a20 2020 2020 2020 2020 2020   nbt.           
+000869e0: 206e 5f65 725f 6261 7365 7320 2b3d 206e   n_er_bases += n
+000869f0: 6265 0a20 2020 2020 2020 2020 2020 206e  be.            n
+00086a00: 5f62 6c6b 5f74 6f74 616c 202b 3d20 6e6c  _blk_total += nl
+00086a10: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
+00086a20: 6572 5f62 6c6b 202b 3d20 6e6c 650a 2020  er_blk += nle.  
+00086a30: 2020 2020 2020 2020 2020 6e70 7420 2b3d            npt +=
+00086a40: 206e 740a 2020 2020 2020 2020 2020 2020   nt.            
+00086a50: 6e70 6520 2b3d 206e 650a 2020 2020 2020  npe += ne.      
+00086a60: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+00086a70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086a80: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00086a90: 2020 206e 756d 5f63 6f72 6520 3d20 6d69     num_core = mi
+00086aa0: 6e28 206e 5f63 6f72 6573 2c20 2863 7075  n( n_cores, (cpu
+00086ab0: 5f63 6f75 6e74 2829 202d 2031 2920 290a  _count() - 1) ).
+00086ac0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00086ad0: 226e 756d 2063 6f72 6573 2074 6f20 7573  "num cores to us
+00086ae0: 6520 3d20 7b7d 222e 666f 726d 6174 286e  e = {}".format(n
+00086af0: 756d 5f63 6f72 6529 290a 2020 2020 2020  um_core)).      
+00086b00: 2020 706f 6f6c 203d 2050 6f6f 6c28 6e75    pool = Pool(nu
+00086b10: 6d5f 636f 7265 290a 2020 2020 2020 2020  m_core).        
+00086b20: 636e 7420 3d20 310a 2020 2020 2020 2020  cnt = 1.        
+00086b30: 666f 7220 6764 5f73 656c 2c20 7365 715f  for gd_sel, seq_
+00086b40: 6e65 772c 2073 6e76 5f69 6e66 6f5f 6368  new, snv_info_ch
+00086b50: 722c 206f 662c 2063 6872 6d2c 2065 7374  r, of, chrm, est
+00086b60: 6174 2069 6e20 5c0a 2020 2020 2020 2020  at in \.        
+00086b70: 2020 2020 706f 6f6c 2e69 6d61 705f 756e      pool.imap_un
+00086b80: 6f72 6465 7265 6428 6d63 5f63 6f72 655f  ordered(mc_core_
+00086b90: 7265 636f 6e73 7472 7563 7469 6f6e 2c20  reconstruction, 
+00086ba0: 6767 635f 7475 706c 6529 3a0a 2020 2020  ggc_tuple):.    
+00086bb0: 2020 2020 2020 2020 2320 7471 646d 2e74          # tqdm.t
+00086bc0: 7164 6d5f 6e6f 7465 626f 6f6b 2870 6f6f  qdm_notebook(poo
+00086bd0: 6c2e 696d 6170 5f75 6e6f 7264 6572 6564  l.imap_unordered
+00086be0: 286d 635f 636f 7265 5f72 6563 6f6e 7374  (mc_core_reconst
+00086bf0: 7275 6374 696f 6e2c 2067 6763 5f74 7570  ruction, ggc_tup
+00086c00: 6c65 292c 2074 6f74 616c 3d6c 656e 2867  le), total=len(g
+00086c10: 6763 5f74 7570 6c65 2929 3a0a 2020 2020  gc_tuple)):.    
+00086c20: 2020 2020 2020 2020 2323 2323 2323 2323          ########
+00086c30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086c40: 2323 0a20 2020 2020 2020 2020 2020 2067  ##.            g
+00086c50: 656e 6f6d 655b 6368 726d 5d2e 7365 7120  enome[chrm].seq 
+00086c60: 3d20 7365 715f 6e65 770a 2020 2020 2020  = seq_new.      
+00086c70: 2020 2020 2020 6f66 5f64 6963 745b 6368        of_dict[ch
+00086c80: 726d 5d20 3d20 6f66 0a20 2020 2020 2020  rm] = of.       
+00086c90: 2020 2020 2023 2067 6473 5f6c 7374 2e61       # gds_lst.a
+00086ca0: 7070 656e 6428 6764 5f73 656c 290a 2020  ppend(gd_sel).  
+00086cb0: 2020 2020 2020 2020 2020 2320 736e 765f            # snv_
+00086cc0: 6c73 742e 6170 7065 6e64 2873 6e76 5f69  lst.append(snv_i
+00086cd0: 6e66 6f5f 6368 7229 0a20 2020 2020 2020  nfo_chr).       
+00086ce0: 2020 2020 2067 6473 5f6e 6577 203d 2067       gds_new = g
+00086cf0: 6473 5f6e 6577 202b 2067 645f 7365 6c0a  ds_new + gd_sel.
+00086d00: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
+00086d10: 696e 666f 5f6c 7374 203d 2073 6e76 5f69  info_lst = snv_i
+00086d20: 6e66 6f5f 6c73 7420 2b20 736e 765f 696e  nfo_lst + snv_in
+00086d30: 666f 5f63 6872 0a20 2020 2020 2020 2020  fo_chr.         
+00086d40: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00086d50: 6e62 742c 206e 6265 2c20 6e6c 742c 206e  nbt, nbe, nlt, n
+00086d60: 6c65 2c20 6e74 2c20 6e65 3d20 6573 7461  le, nt, ne= esta
+00086d70: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
+00086d80: 6261 7365 735f 746f 7461 6c20 2b3d 206e  bases_total += n
+00086d90: 6274 0a20 2020 2020 2020 2020 2020 206e  bt.            n
+00086da0: 5f65 725f 6261 7365 7320 2b3d 206e 6265  _er_bases += nbe
+00086db0: 0a20 2020 2020 2020 2020 2020 206e 5f62  .            n_b
+00086dc0: 6c6b 5f74 6f74 616c 202b 3d20 6e6c 740a  lk_total += nlt.
+00086dd0: 2020 2020 2020 2020 2020 2020 6e5f 6572              n_er
+00086de0: 5f62 6c6b 202b 3d20 6e6c 650a 2020 2020  _blk += nle.    
+00086df0: 2020 2020 2020 2020 6e70 7420 2b3d 206e          npt += n
+00086e00: 740a 2020 2020 2020 2020 2020 2020 6e70  t.            np
+00086e10: 6520 2b3d 206e 650a 2020 2020 2020 2020  e += ne.        
+00086e20: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+00086e30: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+00086e40: 2020 2020 2020 2020 2020 2063 6e74 202b             cnt +
+00086e50: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00086e60: 7072 696e 7428 275c 7252 6563 6f6e 7374  print('\rReconst
+00086e70: 7275 6374 696e 6720 2825 6929 202e 2e20  ructing (%i) .. 
+00086e80: 2569 2f25 6920 2825 7329 2020 2020 2020  %i/%i (%s)      
+00086e90: 2020 2020 2020 2720 2520 286e 756d 5f63        ' % (num_c
+00086ea0: 6f72 652c 2063 6e74 2c20 6c65 6e28 6767  ore, cnt, len(gg
+00086eb0: 635f 7475 706c 6529 2c20 6368 726d 292c  c_tuple), chrm),
+00086ec0: 2065 6e64 203d 2027 2020 2020 2020 2020   end = '        
+00086ed0: 2020 2020 2020 2020 2020 2020 2027 290a               ').
+00086ee0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00086ef0: 2020 2020 2070 6f6f 6c2e 636c 6f73 6528       pool.close(
+00086f00: 290a 2020 2020 2020 2020 706f 6f6c 2e6a  ).        pool.j
+00086f10: 6f69 6e28 290a 2020 2020 2020 2020 0a20  oin().        . 
+00086f20: 2020 2027 2727 0a20 2020 2067 6473 5f6e     '''.    gds_n
+00086f30: 6577 203d 205b 5d0a 2020 2020 736e 765f  ew = [].    snv_
+00086f40: 696e 666f 5f6c 7374 203d 205b 5d0a 2020  info_lst = [].  
+00086f50: 2020 666f 7220 6b6b 2c20 6368 726d 2069    for kk, chrm i
+00086f60: 6e20 656e 756d 6572 6174 6528 6368 725f  n enumerate(chr_
+00086f70: 6c73 7429 3a0a 2020 2020 2020 2020 6764  lst):.        gd
+00086f80: 735f 6e65 7720 3d20 6764 735f 6e65 7720  s_new = gds_new 
+00086f90: 2b20 6764 735f 6c73 745b 6b6b 5d0a 2020  + gds_lst[kk].  
+00086fa0: 2020 2020 2020 736e 765f 696e 666f 5f6c        snv_info_l
+00086fb0: 7374 203d 2073 6e76 5f69 6e66 6f5f 6c73  st = snv_info_ls
+00086fc0: 7420 2b20 736e 765f 6c73 745b 6b6b 5d0a  t + snv_lst[kk].
+00086fd0: 0a20 2020 2064 656c 2067 6473 5f6c 7374  .    del gds_lst
+00086fe0: 0a20 2020 2023 2727 270a 2020 2020 200a  .    #'''.     .
+00086ff0: 2020 2020 656c 6170 7365 645f 7469 6d65      elapsed_time
+00087000: 3220 3d20 7469 6d65 2e74 696d 6528 2920  2 = time.time() 
+00087010: 2d20 7374 6172 745f 7469 6d65 0a20 2020  - start_time.   
+00087020: 2070 7269 6e74 2827 5c72 5265 636f 6e73   print('\rRecons
+00087030: 7472 7563 7469 6f6e 202e 2e20 646f 6e65  truction .. done
+00087040: 2e20 2825 6929 2020 2020 2020 2020 2020  . (%i)          
+00087050: 2020 2720 2520 2865 6c61 7073 6564 5f74    ' % (elapsed_t
+00087060: 696d 6532 292c 2066 6c75 7368 203d 2054  ime2), flush = T
+00087070: 7275 6529 0a20 2020 2070 7269 6e74 2827  rue).    print('
+00087080: 496e 7465 6772 6974 7920 6368 6563 6b3a  Integrity check:
+00087090: 2020 2569 2f25 692c 2025 692f 2569 2c20    %i/%i, %i/%i, 
+000870a0: 2569 2f25 6927 2025 205c 0a20 2020 2020  %i/%i' % \.     
+000870b0: 2020 2020 2028 6e5f 6572 5f62 6173 6573       (n_er_bases
+000870c0: 2c20 6e5f 6261 7365 735f 746f 7461 6c2c  , n_bases_total,
+000870d0: 206e 5f65 725f 626c 6b2c 206e 5f62 6c6b   n_er_blk, n_blk
+000870e0: 5f74 6f74 616c 2c20 6e70 652c 206e 7074  _total, npe, npt
+000870f0: 292c 2066 6c75 7368 203d 2054 7275 6520  ), flush = True 
+00087100: 290a 2020 2020 2020 0a20 2020 2027 2727  ).      .    '''
+00087110: 2020 0a20 2020 204e 7472 5f61 6c6c 203d    .    Ntr_all =
+00087120: 2030 0a20 2020 2066 6f72 2067 6420 696e   0.    for gd in
+00087130: 2067 6473 5f6e 6577 3a20 4e74 725f 616c   gds_new: Ntr_al
+00087140: 6c20 2b3d 2067 642e 6e74 720a 2020 2020  l += gd.ntr.    
+00087150: 7072 696e 7428 274e 5f74 7220 2861 6674  print('N_tr (aft
+00087160: 6572 2920 3d20 2569 2720 2520 4e74 725f  er) = %i' % Ntr_
+00087170: 616c 6c29 0a0a 2020 2020 6e5f 7472 203d  all)..    n_tr =
+00087180: 2030 0a20 2020 206e 5f6e 6567 5f63 6f76   0.    n_neg_cov
+00087190: 203d 2030 0a20 2020 206e 5f70 6f73 5f63   = 0.    n_pos_c
+000871a0: 6f76 203d 2030 0a20 2020 2066 6f72 2067  ov = 0.    for g
+000871b0: 6420 696e 2067 6473 5f6e 6577 3a0a 2020  d in gds_new:.  
+000871c0: 2020 2020 2020 6e5f 7472 202b 3d20 6764        n_tr += gd
+000871d0: 2e6e 7472 0a20 2020 2020 2020 2066 6f72  .ntr.        for
+000871e0: 2074 6420 696e 2067 642e 7464 5f6c 7374   td in gd.td_lst
+000871f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00087200: 2074 642e 636f 7620 3c3d 2030 3a20 6e5f   td.cov <= 0: n_
+00087210: 6e65 675f 636f 7620 2b3d 2031 0a20 2020  neg_cov += 1.   
+00087220: 2020 2020 2020 2020 2065 6c69 6620 7464           elif td
+00087230: 2e63 6f76 203e 2030 3a20 6e5f 706f 735f  .cov > 0: n_pos_
+00087240: 636f 7620 2b3d 2031 0a20 2020 2070 7269  cov += 1.    pri
+00087250: 6e74 2827 4e5f 7472 7320 3d20 2569 2c20  nt('N_trs = %i, 
+00087260: 2569 2c20 2569 2720 2520 286e 5f74 722c  %i, %i' % (n_tr,
+00087270: 206e 5f6e 6567 5f63 6f76 2c20 6e5f 706f   n_neg_cov, n_po
+00087280: 735f 636f 7629 290a 2020 2020 2327 2727  s_cov)).    #'''
+00087290: 0a20 2020 2020 2020 200a 2020 2020 7374  .        .    st
+000872a0: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
+000872b0: 7469 6d65 2829 0a20 2020 2067 7466 5f6c  time().    gtf_l
+000872c0: 696e 6573 203d 205b 5d0a 2020 2020 6661  ines = [].    fa
+000872d0: 5f6c 696e 6573 5f74 7220 3d20 5b5d 0a20  _lines_tr = []. 
+000872e0: 2020 2066 615f 6c69 6e65 735f 7072 203d     fa_lines_pr =
+000872f0: 205b 5d0a 0a20 2020 2023 2073 6176 655f   []..    # save_
+00087300: 6774 6632 2820 666e 616d 652c 2067 7466  gtf2( fname, gtf
+00087310: 5f6c 696e 655f 6c73 7420 3d20 4e6f 6e65  _line_lst = None
+00087320: 2c20 6864 7220 3d20 4e6f 6e65 2c20 666f  , hdr = None, fo
+00087330: 203d 204e 6f6e 6520 636c 6f73 6520 3d20   = None close = 
+00087340: 4661 6c73 6520 290a 2020 2020 0a20 2020  False ).    .   
+00087350: 2069 6620 7265 763a 200a 2020 2020 2020   if rev: .      
+00087360: 2020 6864 725f 6c69 6e65 732e 6170 7065    hdr_lines.appe
+00087370: 6e64 2827 5265 662e 2067 656e 6f6d 653a  nd('Ref. genome:
+00087380: 2025 7327 2025 2067 656e 6f6d 655f 6669   %s' % genome_fi
+00087390: 6c65 290a 2020 2020 2020 2020 665f 6774  le).        f_gt
+000873a0: 6620 3d20 7361 7665 5f67 7466 3228 2067  f = save_gtf2( g
+000873b0: 7466 5f66 696c 655f 6e65 772c 2067 7466  tf_file_new, gtf
+000873c0: 5f6c 696e 655f 6c73 7420 3d20 4e6f 6e65  _line_lst = None
+000873d0: 2c20 6864 7220 3d20 6864 725f 6c69 6e65  , hdr = hdr_line
+000873e0: 7320 290a 0a20 2020 2066 7420 3d20 6f70  s )..    ft = op
+000873f0: 656e 2866 615f 6669 6c65 5f74 725f 6e65  en(fa_file_tr_ne
+00087400: 772c 2027 772b 2729 0a20 2020 2066 7020  w, 'w+').    fp 
+00087410: 3d20 6f70 656e 2866 615f 6669 6c65 5f70  = open(fa_file_p
+00087420: 725f 6e65 772c 2027 772b 2729 0a0a 2020  r_new, 'w+')..  
+00087430: 2020 6764 735f 6e65 7720 3d20 736f 7274    gds_new = sort
+00087440: 5f64 6573 6372 6970 746f 725f 6c73 7428  _descriptor_lst(
+00087450: 6764 735f 6e65 7729 0a20 2020 2063 6e74  gds_new).    cnt
+00087460: 5f6e 6f6e 6520 3d20 300a 2020 2020 7072  _none = 0.    pr
+00087470: 696e 7428 2747 656e 6572 6174 696e 6720  int('Generating 
+00087480: 4754 4620 616e 6420 5472 616e 7363 7269  GTF and Transcri
+00087490: 7074 6f6d 652f 5072 6f74 656f 6d65 202e  ptome/Proteome .
+000874a0: 2e20 272c 2065 6e64 3d27 2020 2020 2729  . ', end='    ')
+000874b0: 0a0a 2020 2020 6966 206e 5f63 6f72 6573  ..    if n_cores
+000874c0: 203d 3d20 313a 0a20 2020 2020 2020 2063   == 1:.        c
+000874d0: 6e74 5f74 203d 2030 0a20 2020 2020 2020  nt_t = 0.       
+000874e0: 2063 6e74 5f70 203d 2030 0a20 2020 2020   cnt_p = 0.     
+000874f0: 2020 2066 6f72 206d 2c20 6764 2069 6e20     for m, gd in 
+00087500: 656e 756d 6572 6174 6528 6764 735f 6e65  enumerate(gds_ne
+00087510: 7729 3a0a 2020 2020 2020 2020 2020 2020  w):.            
+00087520: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00087530: 286d 2b31 2925 3130 3020 3d3d 2030 3a20  (m+1)%100 == 0: 
+00087540: 7072 696e 7428 275c 7247 656e 6572 6174  print('\rGenerat
+00087550: 696e 6720 4754 4620 616e 6420 5472 616e  ing GTF and Tran
+00087560: 7363 7269 7074 6f6d 652f 5072 6f74 656f  scriptome/Proteo
+00087570: 6d65 202e 2e20 2569 2f25 6927 2025 2028  me .. %i/%i' % (
+00087580: 6d2c 206c 656e 2867 6473 5f6e 6577 2929  m, len(gds_new))
+00087590: 2c20 656e 6420 3d20 2720 2020 272c 2066  , end = '   ', f
+000875a0: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
+000875b0: 2020 2020 2020 2020 206e 7472 2c20 6e70           ntr, np
+000875c0: 722c 206e 6572 203d 2067 642e 7570 6461  r, ner = gd.upda
+000875d0: 7465 5f74 645f 696e 666f 2873 656c 203d  te_td_info(sel =
+000875e0: 2031 2c20 7065 7074 6964 6520 3d20 5472   1, peptide = Tr
+000875f0: 7565 2920 2020 2020 2020 2020 2020 200a  ue)            .
+00087600: 2020 2020 2020 2020 2020 2020 6774 666c              gtfl
+00087610: 2c20 636e 203d 2067 642e 6765 745f 6774  , cn = gd.get_gt
+00087620: 665f 6c69 6e65 735f 6672 6f6d 5f65 786f  f_lines_from_exo
+00087630: 6e73 2873 656c 203d 2031 2c20 6164 645f  ns(sel = 1, add_
+00087640: 7365 7120 3d20 4661 6c73 652c 2063 6f6e  seq = False, con
+00087650: 6e65 6374 203d 2054 7275 6529 0a20 2020  nect = True).   
+00087660: 2020 2020 2020 2020 2063 6e74 5f6e 6f6e           cnt_non
+00087670: 6520 2b3d 2063 6e0a 2020 2020 2020 2020  e += cn.        
+00087680: 2020 2020 6c74 2c20 6c70 203d 2067 642e      lt, lp = gd.
+00087690: 6765 745f 6661 7374 615f 6c69 6e65 735f  get_fasta_lines_
+000876a0: 6672 6f6d 5f65 786f 6e73 2873 656c 203d  from_exons(sel =
+000876b0: 2031 2c20 7065 7074 6964 6520 3d20 5472   1, peptide = Tr
+000876c0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000876d0: 6c74 203d 2066 696c 7465 725f 7472 735f  lt = filter_trs_
+000876e0: 6c65 6e28 6c74 2c20 6d69 6e5f 6c65 6e20  len(lt, min_len 
+000876f0: 3d20 4d49 4e5f 5452 5f4c 454e 4754 4829  = MIN_TR_LENGTH)
+00087700: 0a20 2020 2020 2020 2020 2020 206c 7020  .            lp 
+00087710: 3d20 6669 6c74 6572 5f74 7273 5f6c 656e  = filter_trs_len
+00087720: 286c 702c 206d 696e 5f6c 656e 203d 204d  (lp, min_len = M
+00087730: 494e 5f50 525f 4c45 4e47 5448 290a 2020  IN_PR_LENGTH).  
+00087740: 2020 2020 2020 2020 2020 6966 2072 6576            if rev
+00087750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00087760: 2020 665f 6774 6620 3d20 7361 7665 5f67    f_gtf = save_g
+00087770: 7466 3228 2067 7466 5f66 696c 655f 6e65  tf2( gtf_file_ne
+00087780: 772c 2067 7466 5f6c 696e 655f 6c73 7420  w, gtf_line_lst 
+00087790: 3d20 6774 666c 2c20 666f 203d 2066 5f67  = gtfl, fo = f_g
+000877a0: 7466 2029 200a 2020 2020 2020 2020 2020  tf ) .          
+000877b0: 2020 2020 2020 2320 6774 665f 6c69 6e65        # gtf_line
+000877c0: 7320 3d20 6774 665f 6c69 6e65 7320 2b20  s = gtf_lines + 
+000877d0: 6774 666c 0a20 2020 2020 2020 200a 2020  gtfl.        .  
+000877e0: 2020 2020 2020 2020 2020 6674 2e77 7269            ft.wri
+000877f0: 7465 6c69 6e65 7328 6c74 290a 2020 2020  telines(lt).    
+00087800: 2020 2020 2020 2020 6670 2e77 7269 7465          fp.write
+00087810: 6c69 6e65 7328 6c70 290a 2020 2020 2020  lines(lp).      
+00087820: 2020 2020 2020 2320 6661 5f6c 696e 6573        # fa_lines
+00087830: 5f74 7220 3d20 6661 5f6c 696e 6573 5f74  _tr = fa_lines_t
+00087840: 7220 2b20 6c74 0a20 2020 2020 2020 2020  r + lt.         
+00087850: 2020 2023 2066 615f 6c69 6e65 735f 7072     # fa_lines_pr
+00087860: 203d 2066 615f 6c69 6e65 735f 7072 202b   = fa_lines_pr +
+00087870: 206c 700a 2020 2020 2020 2020 2020 2020   lp.            
+00087880: 636e 745f 7420 2b3d 206c 656e 286c 7429  cnt_t += len(lt)
+00087890: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
+000878a0: 5f70 202b 3d20 6c65 6e28 6c70 290a 2020  _p += len(lp).  
+000878b0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000878c0: 2020 2065 6c61 7073 6564 5f74 696d 6532     elapsed_time2
+000878d0: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+000878e0: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
+000878f0: 2020 2020 7072 696e 7428 275c 7247 656e      print('\rGen
+00087900: 6572 6174 696e 6720 4754 4620 616e 6420  erating GTF and 
+00087910: 5472 616e 7363 7269 7074 6f6d 652f 5072  Transcriptome/Pr
+00087920: 6f74 656f 6d65 202e 2e20 2569 2c20 2569  oteome .. %i, %i
+00087930: 2064 6f6e 652e 2028 2569 2920 2720 2520   done. (%i) ' % 
+00087940: 286c 656e 2867 6473 5f6e 6577 292c 2063  (len(gds_new), c
+00087950: 6e74 5f6e 6f6e 652c 2065 6c61 7073 6564  nt_none, elapsed
+00087960: 5f74 696d 6532 292c 2066 6c75 7368 203d  _time2), flush =
+00087970: 2054 7275 6529 0a0a 2020 2020 656c 7365   True)..    else
+00087980: 3a0a 2020 2020 2020 2020 6e75 6d5f 636f  :.        num_co
+00087990: 7265 203d 206d 696e 2820 6e5f 636f 7265  re = min( n_core
+000879a0: 732c 2028 6370 755f 636f 756e 7428 2920  s, (cpu_count() 
+000879b0: 2d20 3129 2029 0a20 2020 2020 2020 2023  - 1) ).        #
+000879c0: 2070 7269 6e74 2822 6e75 6d20 636f 7265   print("num core
+000879d0: 7320 746f 2075 7365 203d 207b 7d22 2e66  s to use = {}".f
+000879e0: 6f72 6d61 7428 6e75 6d5f 636f 7265 2929  ormat(num_core))
+000879f0: 0a20 2020 2020 2020 2070 6f6f 6c20 3d20  .        pool = 
+00087a00: 506f 6f6c 286e 756d 5f63 6f72 6529 0a20  Pool(num_core). 
+00087a10: 2020 2020 2020 2063 6e74 203d 2031 0a20         cnt = 1. 
+00087a20: 2020 2020 2020 2063 6e74 5f74 203d 2030         cnt_t = 0
+00087a30: 0a20 2020 2020 2020 2063 6e74 5f70 203d  .        cnt_p =
+00087a40: 2030 0a20 2020 2020 2020 2066 6f72 2067   0.        for g
+00087a50: 7466 6c2c 206c 742c 206c 702c 2063 6872  tfl, lt, lp, chr
+00087a60: 6d2c 206e 652c 2063 6e20 696e 2070 6f6f  m, ne, cn in poo
+00087a70: 6c2e 6d61 7028 6d63 5f63 6f72 655f 6765  l.map(mc_core_ge
+00087a80: 745f 6774 665f 616e 645f 6661 7374 615f  t_gtf_and_fasta_
+00087a90: 7074 2c20 6764 735f 6e65 7729 3a0a 2020  pt, gds_new):.  
+00087aa0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00087ab0: 2020 2020 2020 2063 6e74 5f6e 6f6e 6520         cnt_none 
+00087ac0: 2b3d 2063 6e0a 2020 2020 2020 2020 2020  += cn.          
+00087ad0: 2020 6966 2028 636e 742b 3129 2531 3030    if (cnt+1)%100
+00087ae0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00087af0: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+00087b00: 4765 6e65 7261 7469 6e67 2047 5446 2061  Generating GTF a
+00087b10: 6e64 2054 7261 6e73 6372 6970 746f 6d65  nd Transcriptome
+00087b20: 2f50 726f 7465 6f6d 6520 2e2e 2025 692f  /Proteome .. %i/
+00087b30: 2569 2720 2520 2863 6e74 2c20 6c65 6e28  %i' % (cnt, len(
+00087b40: 6764 735f 6e65 7729 292c 2065 6e64 203d  gds_new)), end =
+00087b50: 2027 2020 2027 290a 2020 2020 2020 2020   '   ').        
+00087b60: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00087b70: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
+00087b80: 310a 2020 2020 2020 2020 2020 2020 0a20  1.            . 
+00087b90: 2020 2020 2020 2020 2020 206c 7420 3d20             lt = 
+00087ba0: 6669 6c74 6572 5f74 7273 5f6c 656e 286c  filter_trs_len(l
+00087bb0: 742c 206d 696e 5f6c 656e 203d 204d 494e  t, min_len = MIN
+00087bc0: 5f54 525f 4c45 4e47 5448 290a 2020 2020  _TR_LENGTH).    
+00087bd0: 2020 2020 2020 2020 6c70 203d 2066 696c          lp = fil
+00087be0: 7465 725f 7472 735f 6c65 6e28 6c70 2c20  ter_trs_len(lp, 
+00087bf0: 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f 5052  min_len = MIN_PR
+00087c00: 5f4c 454e 4754 4829 0a20 2020 2020 2020  _LENGTH).       
+00087c10: 2020 2020 2069 6620 7265 763a 0a20 2020       if rev:.   
+00087c20: 2020 2020 2020 2020 2020 2020 2066 5f67               f_g
+00087c30: 7466 203d 2073 6176 655f 6774 6632 2820  tf = save_gtf2( 
+00087c40: 6774 665f 6669 6c65 5f6e 6577 2c20 6774  gtf_file_new, gt
+00087c50: 665f 6c69 6e65 5f6c 7374 203d 2067 7466  f_line_lst = gtf
+00087c60: 6c2c 2066 6f20 3d20 665f 6774 6620 2920  l, fo = f_gtf ) 
+00087c70: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00087c80: 2020 2320 6774 665f 6c69 6e65 7320 3d20    # gtf_lines = 
+00087c90: 6774 665f 6c69 6e65 7320 2b20 6774 666c  gtf_lines + gtfl
+00087ca0: 0a0a 2020 2020 2020 2020 2020 2020 6674  ..            ft
+00087cb0: 2e77 7269 7465 6c69 6e65 7328 6c74 290a  .writelines(lt).
+00087cc0: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
+00087cd0: 7269 7465 6c69 6e65 7328 6c70 290a 2020  ritelines(lp).  
+00087ce0: 2020 2020 2020 2020 2020 2320 6661 5f6c            # fa_l
+00087cf0: 696e 6573 5f74 7220 3d20 6661 5f6c 696e  ines_tr = fa_lin
+00087d00: 6573 5f74 7220 2b20 6c74 0a20 2020 2020  es_tr + lt.     
+00087d10: 2020 2020 2020 2023 2066 615f 6c69 6e65         # fa_line
+00087d20: 735f 7072 203d 2066 615f 6c69 6e65 735f  s_pr = fa_lines_
+00087d30: 7072 202b 206c 700a 2020 2020 2020 2020  pr + lp.        
+00087d40: 2020 2020 636e 745f 7420 2b3d 206c 656e      cnt_t += len
+00087d50: 286c 7429 0a20 2020 2020 2020 2020 2020  (lt).           
+00087d60: 2063 6e74 5f70 202b 3d20 6c65 6e28 6c70   cnt_p += len(lp
+00087d70: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+00087d80: 2020 2020 2020 2070 6f6f 6c2e 636c 6f73         pool.clos
+00087d90: 6528 290a 2020 2020 2020 2020 706f 6f6c  e().        pool
+00087da0: 2e6a 6f69 6e28 290a 0a20 2020 2020 2020  .join()..       
+00087db0: 2065 6c61 7073 6564 5f74 696d 6532 203d   elapsed_time2 =
+00087dc0: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
+00087dd0: 7461 7274 5f74 696d 650a 2020 2020 2020  tart_time.      
+00087de0: 2020 7072 696e 7428 275c 7247 656e 6572    print('\rGener
+00087df0: 6174 696e 6720 4754 4620 616e 6420 5472  ating GTF and Tr
+00087e00: 616e 7363 7269 7074 6f6d 652f 5072 6f74  anscriptome/Prot
+00087e10: 656f 6d65 202e 2e20 646f 6e65 2e20 2569  eome .. done. %i
+00087e20: 2c20 2569 2c20 2569 2028 2569 2920 2720  , %i, %i (%i) ' 
+00087e30: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
+00087e40: 2020 2863 6e74 5f6e 6f6e 652c 2069 6e74    (cnt_none, int
+00087e50: 2863 6e74 5f74 2f32 292c 2069 6e74 2863  (cnt_t/2), int(c
+00087e60: 6e74 5f70 2f32 292c 2065 6c61 7073 6564  nt_p/2), elapsed
+00087e70: 5f74 696d 6532 2929 0a20 2020 2020 2020  _time2)).       
+00087e80: 200a 2020 2020 6966 2072 6576 3a20 7361   .    if rev: sa
+00087e90: 7665 5f67 7466 3228 2067 7466 5f66 696c  ve_gtf2( gtf_fil
+00087ea0: 655f 6e65 772c 2067 7466 5f6c 696e 655f  e_new, gtf_line_
+00087eb0: 6c73 7420 3d20 4e6f 6e65 2c20 666f 203d  lst = None, fo =
+00087ec0: 2066 5f67 7466 2c20 636c 6f73 6520 3d20   f_gtf, close = 
+00087ed0: 5472 7565 2029 0a20 2020 2066 742e 636c  True ).    ft.cl
+00087ee0: 6f73 6528 290a 2020 2020 6670 2e63 6c6f  ose().    fp.clo
+00087ef0: 7365 2829 0a0a 2020 2020 2320 6465 6c20  se()..    # del 
+00087f00: 6764 735f 6e65 770a 0a20 2020 2027 2727  gds_new..    '''
+00087f10: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
+00087f20: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+00087f30: 290a 2020 2020 7072 696e 7428 2753 6176  ).    print('Sav
+00087f40: 696e 6720 4641 5354 4120 2825 692c 2025  ing FASTA (%i, %
+00087f50: 6920 2f20 2569 2920 2e2e 2720 2520 286c  i / %i) ..' % (l
+00087f60: 656e 2866 615f 6c69 6e65 735f 7472 292f  en(fa_lines_tr)/
+00087f70: 322c 206c 656e 2866 615f 6c69 6e65 735f  2, len(fa_lines_
+00087f80: 7072 292f 322c 206e 5f74 7229 2c20 656e  pr)/2, n_tr), en
+00087f90: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
+00087fa0: 5472 7565 290a 2020 2020 6620 3d20 6f70  True).    f = op
+00087fb0: 656e 2866 615f 6669 6c65 5f74 725f 6e65  en(fa_file_tr_ne
+00087fc0: 772c 2027 772b 2729 0a20 2020 2066 2e77  w, 'w+').    f.w
+00087fd0: 7269 7465 6c69 6e65 7328 6661 5f6c 696e  ritelines(fa_lin
+00087fe0: 6573 5f74 7229 0a20 2020 2066 2e63 6c6f  es_tr).    f.clo
+00087ff0: 7365 2829 0a0a 2020 2020 7072 696e 7428  se()..    print(
+00088000: 272e 272c 2065 6e64 3d27 2729 0a20 2020  '.', end='').   
+00088010: 2066 203d 206f 7065 6e28 6661 5f66 696c   f = open(fa_fil
+00088020: 655f 7072 5f6e 6577 2c20 2777 2b27 290a  e_pr_new, 'w+').
+00088030: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
+00088040: 2866 615f 6c69 6e65 735f 7072 290a 2020  (fa_lines_pr).  
+00088050: 2020 662e 636c 6f73 6528 290a 0a20 2020    f.close()..   
+00088060: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
+00088070: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+00088080: 6172 745f 7469 6d65 0a20 2020 2070 7269  art_time.    pri
+00088090: 6e74 2827 2064 6f6e 652e 2028 2569 2927  nt(' done. (%i)'
+000880a0: 2025 2028 656c 6170 7365 645f 7469 6d65   % (elapsed_time
+000880b0: 2929 0a20 2020 2027 2727 0a0a 2020 2020  )).    '''..    
+000880c0: 7072 696e 7428 2720 2020 2573 2720 2520  print('   %s' % 
+000880d0: 6661 5f66 696c 655f 7472 5f6e 6577 2029  fa_file_tr_new )
+000880e0: 0a20 2020 2070 7269 6e74 2827 2020 2025  .    print('   %
+000880f0: 7327 2025 2066 615f 6669 6c65 5f70 725f  s' % fa_file_pr_
+00088100: 6e65 7720 290a 2020 2020 6966 2072 6576  new ).    if rev
+00088110: 3a20 7072 696e 7428 2720 2020 2573 2720  : print('   %s' 
+00088120: 2520 6774 665f 6669 6c65 5f6e 6577 290a  % gtf_file_new).
+00088130: 0a20 2020 2073 6e76 5f6c 7374 203d 205b  .    snv_lst = [
+00088140: 5d0a 2020 2020 666f 7220 736e 7620 696e  ].    for snv in
+00088150: 2073 6e76 5f69 6e66 6f5f 6c73 743a 0a20   snv_info_lst:. 
+00088160: 2020 2020 2020 206e 7669 203d 2074 6f5f         nvi = to_
+00088170: 6e76 5f73 696d 706c 6528 2073 6e76 2029  nv_simple( snv )
+00088180: 0a20 2020 2020 2020 2073 6e76 5f6c 7374  .        snv_lst
+00088190: 2e61 7070 656e 6428 6e76 6929 0a0a 2020  .append(nvi)..  
+000881a0: 2020 6966 206c 656e 2873 6e76 5f6c 7374    if len(snv_lst
+000881b0: 2920 3e20 303a 0a20 2020 2020 2020 2064  ) > 0:.        d
+000881c0: 665f 736e 7620 3d20 7064 2e44 6174 6146  f_snv = pd.DataF
+000881d0: 7261 6d65 2873 6e76 5f6c 7374 290a 2020  rame(snv_lst).  
+000881e0: 2020 2020 2020 6466 5f73 6e76 2e74 6f5f        df_snv.to_
+000881f0: 6373 7628 666e 616d 655f 736e 762c 2073  csv(fname_snv, s
+00088200: 6570 203d 2027 5c74 2729 0a20 2020 2020  ep = '\t').     
+00088210: 2020 2070 7269 6e74 2827 534e 5620 7375     print('SNV su
+00088220: 6d6d 6172 7920 7361 7665 6420 746f 205c  mmary saved to \
+00088230: 6e20 2020 2573 2720 2520 666e 616d 655f  n   %s' % fname_
+00088240: 736e 7629 0a20 2020 2065 6c73 653a 0a20  snv).    else:. 
+00088250: 2020 2020 2020 2070 7269 6e74 2827 4e6f         print('No
+00088260: 2053 4e56 7320 666f 756e 642e 2027 290a   SNVs found. ').
+00088270: 2020 2020 2020 2020 0a20 2020 2023 2077          .    # w
+00088280: 7269 7465 5f74 6f5f 7663 6628 2073 6e76  rite_to_vcf( snv
+00088290: 5f69 6e66 6f5f 6c73 742c 2066 6e61 6d65  _info_lst, fname
+000882a0: 5f76 6366 2029 0a0a 2020 2020 2327 2727  _vcf )..    #'''
+000882b0: 2020 2020 0a20 2020 2069 6620 7265 763a      .    if rev:
+000882c0: 0a20 2020 2020 2020 2073 7461 7274 5f74  .        start_t
+000882d0: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+000882e0: 290a 2020 2020 2020 2020 2727 270a 2020  ).        '''.  
+000882f0: 2020 2020 2020 7072 696e 7428 2753 6176        print('Sav
+00088300: 696e 6720 6375 7374 6f6d 697a 6564 2067  ing customized g
+00088310: 656e 6f6d 6520 2e2e 2027 2c20 656e 6420  enome .. ', end 
+00088320: 3d20 2727 2c20 666c 7573 6820 3d20 5472  = '', flush = Tr
+00088330: 7565 290a 2020 2020 2020 2020 0a20 2020  ue).        .   
+00088340: 2020 2020 2023 2068 6472 5f6c 696e 6573       # hdr_lines
+00088350: 2e61 7070 656e 6428 2752 6566 2e20 6765  .append('Ref. ge
+00088360: 6e6f 6d65 3a20 2573 2720 2520 6765 6e6f  nome: %s' % geno
+00088370: 6d65 5f66 696c 6529 0a20 2020 2020 2020  me_file).       
+00088380: 2023 2073 6176 655f 6774 6628 6774 665f   # save_gtf(gtf_
+00088390: 6669 6c65 5f6e 6577 2c20 6774 665f 6c69  file_new, gtf_li
+000883a0: 6e65 732c 2068 6472 5f6c 696e 6573 290a  nes, hdr_lines).
+000883b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000883c0: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
+000883d0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+000883e0: 6172 745f 7469 6d65 0a20 2020 2020 2020  art_time.       
+000883f0: 2070 7269 6e74 2827 2064 6f6e 652e 2025   print(' done. %
+00088400: 6928 7329 205c 6e20 2020 2573 2720 2520  i(s) \n   %s' % 
+00088410: 2865 6c61 7073 6564 5f74 696d 652c 2067  (elapsed_time, g
+00088420: 7466 5f66 696c 655f 6e65 7729 290a 2020  tf_file_new)).  
+00088430: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+00088440: 2020 2323 2053 6176 6520 6765 6e6f 6d65    ## Save genome
+00088450: 2063 6f72 7265 6374 6564 0a20 2020 2020   corrected.     
+00088460: 2020 2070 7269 6e74 2827 596f 7520 6172     print('You ar
+00088470: 6520 616c 6d6f 7374 2064 6f6e 652e 205c  e almost done. \
+00088480: 6e4c 6173 7420 7374 6570 2069 7320 746f  nLast step is to
+00088490: 2073 6176 6520 7468 6520 6669 7865 6420   save the fixed 
+000884a0: 6765 6e6f 6d65 2e20 2729 0a20 2020 2020  genome. ').     
+000884b0: 2020 2073 6176 655f 6765 6e6f 6d65 2820     save_genome( 
+000884c0: 6765 6e6f 6d65 5f66 696c 655f 6e65 772c  genome_file_new,
+000884d0: 2067 656e 6f6d 652c 2076 6572 626f 7365   genome, verbose
+000884e0: 203d 2054 7275 652c 2074 6974 6c65 203d   = True, title =
+000884f0: 2027 4765 6e6f 6d65 2d72 6576 2720 290a   'Genome-rev' ).
+00088500: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+00088510: 2020 2573 2720 2520 6765 6e6f 6d65 5f66    %s' % genome_f
+00088520: 696c 655f 6e65 7720 290a 0a20 2020 2070  ile_new )..    p
+00088530: 7269 6e74 2827 5374 7269 6e67 4669 7820  rint('StringFix 
+00088540: 6669 6e69 7368 6564 2027 2c20 6461 7465  finished ', date
+00088550: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
+00088560: 7728 2929 0a0a 2020 2020 7265 7475 726e  w())..    return
+00088570: 2066 6e61 6d65 2c20 6765 6e6f 6d65 5f66   fname, genome_f
+00088580: 696c 655f 6e65 7720 232c 2067 6473 5f6e  ile_new #, gds_n
+00088590: 6577 0a20 2020 2023 2727 2720 2020 200a  ew.    #'''    .
+000885a0: 0a64 6566 2053 7472 696e 6746 6978 5f61  .def StringFix_a
+000885b0: 7373 656d 626c 6528 2049 6e70 7574 203d  ssemble( Input =
+000885c0: 204e 6f6e 652c 2067 656e 6f6d 655f 6661   None, genome_fa
+000885d0: 203d 204e 6f6e 652c 2061 6e6e 6f74 5f67   = None, annot_g
+000885e0: 7466 203d 204e 6f6e 652c 206f 7574 5f64  tf = None, out_d
+000885f0: 6972 203d 2027 5346 6978 5f6f 7574 272c  ir = 'SFix_out',
+00088600: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00088610: 2020 2020 2020 2020 2020 206e 5f63 6f72             n_cor
+00088620: 6573 203d 2034 2c20 6f75 745f 6375 7374  es = 4, out_cust
+00088630: 6f6d 5f67 656e 6f6d 6520 3d20 4661 6c73  om_genome = Fals
+00088640: 652c 2073 7566 6669 7820 3d20 4e6f 6e65  e, suffix = None
+00088650: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00088660: 2020 2020 2020 2020 2020 2020 6d63 7620              mcv 
+00088670: 3d20 302e 352c 206d 6364 203d 2031 2c20  = 0.5, mcd = 1, 
+00088680: 6d74 6c20 3d20 3230 302c 206d 706c 203d  mtl = 200, mpl =
+00088690: 2035 302c 206d 6469 203d 2032 2c20 6d64   50, mdi = 2, md
+000886a0: 6420 3d20 322c 206d 6470 203d 2033 2c20  d = 2, mdp = 3, 
+000886b0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+000886c0: 2020 2020 2020 2020 2020 6d64 6620 3d20            mdf = 
+000886d0: 302e 322c 206e 5f70 203d 2031 362c 2078  0.2, n_p = 16, x
+000886e0: 7361 203d 2054 7275 652c 206a 756d 705f  sa = True, jump_
+000886f0: 746f 203d 2030 2029 3a0a 0a20 2020 2070  to = 0 ):..    p
+00088700: 7269 6e74 2827 2b2d 2d2d 2d2d 2d2d 2d2d  rint('+---------
+00088710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00088720: 2d2d 2d2d 2d2b 2729 0a20 2020 2070 7269  -----+').    pri
+00088730: 6e74 2827 7c20 2020 2020 2053 7472 696e  nt('|      Strin
+00088740: 6766 6978 2076 2e25 7320 2020 2020 2020  gfix v.%s       
+00088750: 7c27 2025 2053 7472 696e 6746 6978 5f76  |' % StringFix_v
+00088760: 6572 7369 6f6e 290a 2020 2020 7072 696e  ersion).    prin
+00088770: 7428 272b 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('+------------
+00088780: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00088790: 2d2d 2b27 290a 0a20 2020 2069 6620 496e  --+')..    if In
+000887a0: 7075 7420 6973 204e 6f6e 653a 0a20 2020  put is None:.   
+000887b0: 2020 2020 2070 7269 6e74 2827 5573 6167       print('Usag
+000887c0: 653a 2729 0a20 2020 2020 2020 2070 7269  e:').        pri
+000887d0: 6e74 2827 2531 3273 3a20 2720 2520 2761  nt('%12s: ' % 'a
+000887e0: 7267 756d 656e 7427 2c20 2764 6573 6372  rgument', 'descr
+000887f0: 6970 7469 6f6e 2720 290a 2020 2020 2020  iption' ).      
+00088800: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
+00088810: 2025 2027 496e 7075 7427 2c20 2749 6e70   % 'Input', 'Inp
+00088820: 7574 2053 414d 206f 7220 4241 4d20 6669  ut SAM or BAM fi
+00088830: 6c65 2e20 7079 6261 6d2e 7079 2069 7320  le. pybam.py is 
+00088840: 7265 7175 6972 6564 2066 6f72 2042 414d  required for BAM
+00088850: 2069 6e70 7574 2e27 2029 0a20 2020 2020   input.' ).     
+00088860: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
+00088870: 2720 2520 2767 656e 6f6d 655f 6661 272c  ' % 'genome_fa',
+00088880: 2065 6e64 203d 2027 2729 0a20 2020 2020   end = '').     
+00088890: 2020 2070 7269 6e74 2827 2047 656e 6f6d     print(' Genom
+000888a0: 6520 6661 7374 6120 6669 6c65 2075 7365  e fasta file use
+000888b0: 6420 746f 2067 656e 6572 6174 6520 7468  d to generate th
+000888c0: 6520 696e 7075 7420 5341 4d2f 4241 4d2e  e input SAM/BAM.
+000888d0: 2027 2029 0a20 2020 2020 2020 2070 7269   ' ).        pri
+000888e0: 6e74 2827 2531 3273 2020 2049 7420 6973  nt('%12s   It is
+000888f0: 2075 7365 6420 746f 2063 6f72 7265 6374   used to correct
+00088900: 2073 6571 7565 6e63 6573 206e 6f74 2063   sequences not c
+00088910: 6f76 6572 6564 2062 7920 7265 6164 732c  overed by reads,
+00088920: 2027 2025 2027 2729 0a20 2020 2020 2020   ' % '').       
+00088930: 2070 7269 6e74 2827 2531 3273 2020 2074   print('%12s   t
+00088940: 6f20 6964 656e 7469 6679 2053 4e50 7320  o identify SNPs 
+00088950: 616e 6420 746f 2067 656e 6572 6174 6520  and to generate 
+00088960: 6375 7374 6f6d 697a 6564 2067 656e 6f6d  customized genom
+00088970: 652e 2027 2020 2520 2727 290a 2020 2020  e. '  % '').    
+00088980: 2020 2020 7072 696e 7428 2725 3132 733a      print('%12s:
+00088990: 2027 2025 2027 616e 6e6f 745f 6774 6627   ' % 'annot_gtf'
+000889a0: 2c20 2747 5446 2f47 4646 2066 696c 6520  , 'GTF/GFF file 
+000889b0: 746f 2062 6520 7573 6564 2066 6f72 2067  to be used for g
+000889c0: 7569 6465 2061 6e6e 6f74 6174 696f 6e27  uide annotation'
+000889d0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
+000889e0: 2827 2531 3273 3a20 2720 2520 276f 7574  ('%12s: ' % 'out
+000889f0: 5f64 6972 272c 2027 4f75 7470 7574 2064  _dir', 'Output d
+00088a00: 6972 6563 746f 7279 2720 290a 2020 2020  irectory' ).    
+00088a10: 2020 2020 7072 696e 7428 2725 3132 733a      print('%12s:
+00088a20: 2027 2025 2027 6e5f 636f 7265 7327 2c20   ' % 'n_cores', 
+00088a30: 274e 756d 6265 7220 6f66 2063 6f72 6573  'Number of cores
+00088a40: 2074 6f20 7573 6527 2029 0a20 2020 2020   to use' ).     
+00088a50: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
+00088a60: 2720 2520 2773 7566 6669 7827 2c20 2753  ' % 'suffix', 'S
+00088a70: 7566 6669 7820 746f 2062 6520 7573 6564  uffix to be used
+00088a80: 2066 6f72 206f 7574 7075 7420 6669 6c65   for output file
+00088a90: 206e 616d 6573 2720 290a 2020 2020 2020   names' ).      
+00088aa0: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
+00088ab0: 2025 2027 6d63 7627 2c20 274d 696e 696d   % 'mcv', 'Minim
+00088ac0: 756d 2072 6561 6420 636f 7665 7261 6765  um read coverage
+00088ad0: 2066 6f72 2069 6e63 6c75 7369 6f6e 2069   for inclusion i
+00088ae0: 6e20 7468 6520 6f75 7470 7574 2047 5446  n the output GTF
+00088af0: 2f47 4646 2720 290a 2020 2020 2020 2020  /GFF' ).        
+00088b00: 7072 696e 7428 2725 3132 7320 2020 616e  print('%12s   an
+00088b10: 6420 7472 616e 7363 7269 7074 6f6d 652f  d transcriptome/
+00088b20: 7072 6f74 656f 6d65 205b 307e 315d 2e20  proteome [0~1]. 
+00088b30: 466f 7220 6120 6c65 6e67 7468 204c 2074  For a length L t
+00088b40: 7261 6e73 6372 6970 742c 2027 2025 2027  ranscript, ' % '
+00088b50: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
+00088b60: 2827 2531 3273 2020 2069 7420 7769 6c6c  ('%12s   it will
+00088b70: 2062 6520 696e 636c 7564 6564 2069 6e20   be included in 
+00088b80: 7468 6520 6f75 7470 7574 2069 6620 6174  the output if at
+00088b90: 206c 6561 7374 206d 6376 2a4c 2062 6173   least mcv*L bas
+00088ba0: 6573 2061 7265 2063 6f76 6572 6564 2062  es are covered b
+00088bb0: 7920 7265 6164 7320 2720 2025 2027 2729  y reads '  % '')
+00088bc0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088bd0: 2531 3273 3a20 2720 2520 276d 6364 272c  %12s: ' % 'mcd',
+00088be0: 2027 4d69 6e69 6d75 6d20 6261 7365 2063   'Minimum base c
+00088bf0: 6f76 6572 6167 6520 6465 7074 6820 666f  overage depth fo
+00088c00: 7220 696e 636c 7573 696f 6e20 696e 2074  r inclusion in t
+00088c10: 6865 206f 7574 7075 7427 2029 0a20 2020  he output' ).   
+00088c20: 2020 2020 2070 7269 6e74 2827 2531 3273       print('%12s
+00088c30: 3a20 2720 2520 276d 746c 272c 2027 4d69  : ' % 'mtl', 'Mi
+00088c40: 6e69 6d75 6d20 7472 616e 7363 7269 7074  nimum transcript
+00088c50: 206c 656e 6774 6820 696e 2062 6173 6573   length in bases
+00088c60: 2720 290a 2020 2020 2020 2020 7072 696e  ' ).        prin
+00088c70: 7428 2725 3132 733a 2027 2025 2027 6d70  t('%12s: ' % 'mp
+00088c80: 6c27 2c20 274d 696e 696d 756d 2070 726f  l', 'Minimum pro
+00088c90: 7465 696e 2028 616d 696e 6f20 6163 6964  tein (amino acid
+00088ca0: 2073 6571 7565 6e63 6529 206c 656e 6774   sequence) lengt
+00088cb0: 6827 2029 0a20 2020 2020 2020 2070 7269  h' ).        pri
 00088cc0: 6e74 2827 2531 3273 3a20 2720 2520 276d  nt('%12s: ' % 'm
-00088cd0: 6470 272c 2027 4d69 6e69 6d75 6d20 636f  dp', 'Minimum co
+00088cd0: 6469 272c 2027 4d69 6e69 6d75 6d20 636f  di', 'Minimum co
 00088ce0: 7665 7261 6765 2064 6570 7468 2066 6f72  verage depth for
-00088cf0: 2053 4e50 2063 6f72 7265 6374 696f 6e20   SNP correction 
-00088d00: 5b3e 3d31 2e30 5d27 2029 0a20 2020 2020  [>=1.0]' ).     
-00088d10: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
-00088d20: 2720 2520 276d 6466 272c 2027 4d69 6e69  ' % 'mdf', 'Mini
-00088d30: 6d75 6d20 636f 7665 7261 6765 2064 6570  mum coverage dep
-00088d40: 7468 2066 7261 6374 696f 6e20 666f 7220  th fraction for 
-00088d50: 696e 7365 7273 696f 6e20 616e 6420 6465  insersion and de
+00088cf0: 2061 6e20 696e 7365 7273 696f 6e20 746f   an insersion to
+00088d00: 2062 6520 636f 6e73 6964 6572 6564 2076   be considered v
+00088d10: 616c 6964 205b 3e3d 312e 305d 2720 290a  alid [>=1.0]' ).
+00088d20: 2020 2020 2020 2020 7072 696e 7428 2725          print('%
+00088d30: 3132 733a 2027 2025 2027 6d64 6427 2c20  12s: ' % 'mdd', 
+00088d40: 274d 696e 696d 756d 2063 6f76 6572 6167  'Minimum coverag
+00088d50: 6520 6465 7074 6820 666f 7220 6120 6465  e depth for a de
 00088d60: 6c65 7469 6f6e 2074 6f20 6265 2063 6f6e  letion to be con
-00088d70: 7369 6465 7265 6420 7661 6c69 6420 2830  sidered valid (0
-00088d80: 7e31 2927 2029 0a20 2020 2020 2020 2070  ~1)' ).        p
-00088d90: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
-00088da0: 276a 756d 705f 746f 272c 2027 4a75 6d70  'jump_to', 'Jump
-00088db0: 2074 6f20 7374 6570 206a 205b 3020 6f72   to step j [0 or
-00088dc0: 2031 206f 7220 325d 2720 290a 2020 2020   1 or 2]' ).    
-00088dd0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00088de0: 7361 6d5f 6669 6c65 203d 2049 6e70 7574  sam_file = Input
-00088df0: 0a20 2020 2067 7466 5f66 696c 6520 3d20  .    gtf_file = 
-00088e00: 616e 6e6f 745f 6774 660a 0a20 2020 2069  annot_gtf..    i
-00088e10: 6620 5059 4241 4d5f 4552 523a 0a20 2020  f PYBAM_ERR:.   
-00088e20: 2020 2020 2070 7269 6e74 2827 5374 7269       print('Stri
-00088e30: 6e67 4669 7820 5741 524e 494e 473a 2070  ngFix WARNING: p
-00088e40: 7962 616d 206e 6f74 2061 7661 696c 6162  ybam not availab
-00088e50: 6c65 2e20 4163 6365 7074 2053 414d 2066  le. Accept SAM f
-00088e60: 696c 6520 6f6e 6c79 2e27 290a 0a20 2020  ile only.')..   
-00088e70: 2069 6620 2867 656e 6f6d 655f 6661 2069   if (genome_fa i
-00088e80: 7320 6e6f 7420 4e6f 6e65 2920 2620 2867  s not None) & (g
-00088e90: 7466 5f66 696c 6520 6973 206e 6f74 204e  tf_file is not N
-00088ea0: 6f6e 6529 3a0a 2020 2020 2020 2020 7072  one):.        pr
-00088eb0: 696e 7428 2753 7472 696e 6746 6978 2069  int('StringFix i
-00088ec0: 7320 7275 6e6e 696e 6720 696e 2061 6e6e  s running in ann
-00088ed0: 6f74 6174 696f 6e20 6775 6964 6564 206d  otation guided m
-00088ee0: 6f64 6520 7769 7468 2073 6571 7565 6e63  ode with sequenc
-00088ef0: 6520 636f 7272 6563 7469 6f6e 2e27 290a  e correction.').
-00088f00: 2020 2020 656c 6966 2028 6765 6e6f 6d65      elif (genome
-00088f10: 5f66 6120 6973 206e 6f74 204e 6f6e 6529  _fa is not None)
-00088f20: 2026 2028 6774 665f 6669 6c65 2069 7320   & (gtf_file is 
-00088f30: 4e6f 6e65 293a 0a20 2020 2020 2020 2070  None):.        p
-00088f40: 7269 6e74 2827 5374 7269 6e67 4669 7820  rint('StringFix 
-00088f50: 6973 2072 756e 6e69 6e67 2069 6e20 6765  is running in ge
-00088f60: 6e6f 6d65 2067 7569 6465 6420 6d6f 6465  nome guided mode
-00088f70: 2077 6974 6820 7365 7175 656e 6365 2063   with sequence c
-00088f80: 6f72 7265 6374 696f 6e2e 2729 0a20 2020  orrection.').   
-00088f90: 2065 6c69 6620 2867 656e 6f6d 655f 6661   elif (genome_fa
-00088fa0: 2069 7320 4e6f 6e65 2920 2620 2867 7466   is None) & (gtf
-00088fb0: 5f66 696c 6520 6973 204e 6f6e 6529 3a0a  _file is None):.
-00088fc0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-00088fd0: 7472 696e 6746 6978 2069 7320 7275 6e6e  tringFix is runn
-00088fe0: 696e 6720 696e 2067 656e 6f6d 6520 6775  ing in genome gu
-00088ff0: 6964 6564 206d 6f64 6520 7769 7468 6f75  ided mode withou
-00089000: 7420 7365 7175 656e 6365 2063 6f72 7265  t sequence corre
-00089010: 6374 696f 6e2e 2729 0a20 2020 2065 6c73  ction.').    els
-00089020: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
-00089030: 2827 5374 7269 6e67 4669 7820 6973 2072  ('StringFix is r
-00089040: 756e 6e69 6e67 2069 6e20 616e 6e6f 7461  unning in annota
-00089050: 7469 6f6e 2067 7569 6465 6420 6d6f 6465  tion guided mode
-00089060: 2077 6974 686f 7574 2073 6571 7565 6e63   without sequenc
-00089070: 6520 636f 7272 6563 7469 6f6e 2e27 290a  e correction.').
-00089080: 2020 2020 0a0a 2020 2020 2320 7265 7620      ..    # rev 
-00089090: 3d20 4661 6c73 650a 2020 2020 7265 7620  = False.    rev 
-000890a0: 3d20 6f75 745f 6375 7374 6f6d 5f67 656e  = out_custom_gen
-000890b0: 6f6d 650a 2020 2020 6362 7963 203d 2054  ome.    cbyc = T
-000890c0: 7275 6520 0a20 2020 2073 6120 3d20 320a  rue .    sa = 2.
-000890d0: 2020 2020 6966 2078 7361 3a20 7361 203d      if xsa: sa =
-000890e0: 2030 0a0a 2020 2020 4d49 4e5f 4356 475f   0..    MIN_CVG_
-000890f0: 464f 525f 534e 505f 434f 5252 4543 5449  FOR_SNP_CORRECTI
-00089100: 4f4e 203d 2069 6e74 286d 6470 290a 2020  ON = int(mdp).  
-00089110: 2020 495f 5641 4c49 445f 4356 4720 3d20    I_VALID_CVG = 
-00089120: 6d61 7828 312c 206e 702e 666c 6f61 7428  max(1, np.float(
-00089130: 6d64 6929 290a 2020 2020 445f 5641 4c49  mdi)).    D_VALI
-00089140: 445f 4356 4720 3d20 6d61 7828 312c 206e  D_CVG = max(1, n
-00089150: 702e 666c 6f61 7428 6d64 6429 290a 2020  p.float(mdd)).  
-00089160: 2020 495f 5641 4c49 445f 4346 5241 4320    I_VALID_CFRAC 
-00089170: 3d20 666c 6f61 7428 6d64 6629 0a20 2020  = float(mdf).   
-00089180: 2044 5f56 414c 4944 5f43 4652 4143 203d   D_VALID_CFRAC =
-00089190: 2066 6c6f 6174 286d 6466 290a 2020 2020   float(mdf).    
-000891a0: 4d49 4e5f 434f 565f 544f 5f53 454c 203d  MIN_COV_TO_SEL =
-000891b0: 206e 702e 666c 6f61 7428 6d63 7629 0a20   np.float(mcv). 
-000891c0: 2020 204d 494e 5f41 424e 5f54 4f5f 5345     MIN_ABN_TO_SE
-000891d0: 4c20 3d20 6e70 2e66 6c6f 6174 286d 6364  L = np.float(mcd
-000891e0: 290a 2020 2020 4d49 4e5f 5452 5f4c 454e  ).    MIN_TR_LEN
-000891f0: 4754 4820 3d20 696e 7428 6d74 6c29 0a20  GTH = int(mtl). 
-00089200: 2020 204d 494e 5f50 525f 4c45 4e47 5448     MIN_PR_LENGTH
-00089210: 203d 2069 6e74 286d 706c 290a 2020 2020   = int(mpl).    
-00089220: 4d41 585f 4e55 4d5f 5041 5448 5320 3d20  MAX_NUM_PATHS = 
-00089230: 696e 7428 6e5f 7029 0a20 2020 2047 454e  int(n_p).    GEN
-00089240: 5f41 4153 5f55 4e53 5045 4320 3d20 5472  _AAS_UNSPEC = Tr
-00089250: 7565 0a0a 2020 2020 6966 2067 7466 5f66  ue..    if gtf_f
-00089260: 696c 6520 6973 204e 6f6e 653a 0a20 2020  ile is None:.   
-00089270: 2020 2020 204d 4158 5f4e 554d 5f50 4154       MAX_NUM_PAT
-00089280: 4853 203d 2032 300a 2020 2020 2020 2020  HS = 20.        
-00089290: 4d49 4e5f 4e5f 5244 535f 5045 525f 4745  MIN_N_RDS_PER_GE
-000892a0: 4e45 203d 2033 300a 2020 2020 2020 2020  NE = 30.        
-000892b0: 5452 5f46 494c 5445 525f 5345 4c20 3d20  TR_FILTER_SEL = 
-000892c0: 320a 0a20 2020 2069 6620 6f75 745f 6469  2..    if out_di
-000892d0: 7220 6973 206e 6f74 204e 6f6e 653a 200a  r is not None: .
-000892e0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-000892f0: 732e 7061 7468 2e65 7869 7374 7328 6f75  s.path.exists(ou
-00089300: 745f 6469 7229 3a20 6f73 2e6d 6b64 6972  t_dir): os.mkdir
-00089310: 286f 7574 5f64 6972 290a 0a20 2020 2066  (out_dir)..    f
-00089320: 696c 655f 6f75 742c 2067 6473 2c20 6765  ile_out, gds, ge
-00089330: 6e6f 6d65 203d 2053 7472 696e 6746 6978  nome = StringFix
-00089340: 5f61 6e61 6c79 7369 7328 7361 6d5f 6669  _analysis(sam_fi
-00089350: 6c65 2c20 6774 6620 3d20 6774 665f 6669  le, gtf = gtf_fi
-00089360: 6c65 2c20 6765 6e6f 6d65 5f66 696c 6520  le, genome_file 
-00089370: 3d20 6765 6e6f 6d65 5f66 612c 206a 756d  = genome_fa, jum
-00089380: 7020 3d20 6a75 6d70 5f74 6f2c 205c 0a20  p = jump_to, \. 
-00089390: 2020 2020 2020 2020 2020 206e 5f63 6f72             n_cor
-000893a0: 6573 3d6e 5f63 6f72 6573 2c20 6f75 745f  es=n_cores, out_
-000893b0: 7472 203d 2054 7275 652c 2063 6279 6320  tr = True, cbyc 
-000893c0: 3d20 6362 7963 2c20 7375 6666 6978 203d  = cbyc, suffix =
-000893d0: 2073 7566 6669 782c 206f 7574 5f64 6972   suffix, out_dir
-000893e0: 203d 206f 7574 5f64 6972 2c20 7361 203d   = out_dir, sa =
-000893f0: 2073 6120 2920 0a0a 2020 2020 6966 2028   sa ) ..    if (
-00089400: 6764 7320 6973 206e 6f74 204e 6f6e 6529  gds is not None)
-00089410: 2026 2028 6a75 6d70 5f74 6f20 3c20 3229   & (jump_to < 2)
-00089420: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00089430: 2753 6176 696e 6720 6765 6e65 2064 6573  'Saving gene des
-00089440: 6372 6970 746f 7220 2e2e 2027 2c20 656e  criptor .. ', en
-00089450: 6420 3d20 2720 272c 2066 6c75 7368 203d  d = ' ', flush =
-00089460: 2054 7275 6529 0a20 2020 2020 2020 2077   True).        w
-00089470: 6974 6820 6f70 656e 2866 696c 655f 6f75  ith open(file_ou
-00089480: 7420 2b20 272e 6764 7327 2c20 2777 6227  t + '.gds', 'wb'
-00089490: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-000894a0: 2020 2020 7069 636b 6c65 2e64 756d 7028      pickle.dump(
-000894b0: 2028 6764 7329 2c20 6620 290a 2020 2020   (gds), f ).    
-000894c0: 2020 2020 7072 696e 7428 2764 6f6e 652e      print('done.
-000894d0: 2027 290a 2020 2020 656c 7365 3a0a 2020   ').    else:.  
-000894e0: 2020 2020 2020 7072 696e 7428 2753 7472        print('Str
-000894f0: 696e 6746 6978 2073 7461 7274 6564 2027  ingFix started '
-00089500: 2c20 6461 7465 7469 6d65 2e64 6174 6574  , datetime.datet
-00089510: 696d 652e 6e6f 7728 2929 0a20 2020 2020  ime.now()).     
-00089520: 2020 2070 7269 6e74 2827 4c6f 6164 696e     print('Loadin
-00089530: 6720 6765 6e65 2064 6573 6372 6970 746f  g gene descripto
-00089540: 7220 2e2e 2027 2c20 656e 6420 3d20 2720  r .. ', end = ' 
-00089550: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
-00089560: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-00089570: 656e 2866 696c 655f 6f75 7420 2b20 272e  en(file_out + '.
-00089580: 6764 7327 2c20 2772 6227 2920 6173 2066  gds', 'rb') as f
-00089590: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
-000895a0: 7320 3d20 7069 636b 6c65 2e6c 6f61 6428  s = pickle.load(
-000895b0: 2066 2029 0a20 2020 2020 2020 2067 656e   f ).        gen
-000895c0: 6f6d 6520 3d20 6765 6e6f 6d65 5f66 610a  ome = genome_fa.
-000895d0: 2020 2020 2020 2020 7072 696e 7428 2764          print('d
-000895e0: 6f6e 652e 2027 290a 2020 2020 0a20 2020  one. ').    .   
-000895f0: 2069 6620 2867 656e 6f6d 655f 6661 2069   if (genome_fa i
-00089600: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
-00089610: 2070 7269 6e74 2827 5374 7269 6e67 4669   print('StringFi
-00089620: 7820 6669 6e69 7368 6564 2027 2c20 6461  x finished ', da
-00089630: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-00089640: 6e6f 7728 2929 0a20 2020 2065 6c73 653a  now()).    else:
-00089650: 0a20 2020 2020 2020 2066 696c 655f 6f75  .        file_ou
-00089660: 742c 2066 696c 655f 6f75 745f 6765 6e6f  t, file_out_geno
-00089670: 6d65 203d 2053 7472 696e 6746 6978 5f73  me = StringFix_s
-00089680: 796e 7468 6573 6973 2820 6669 6c65 5f6f  ynthesis( file_o
-00089690: 7574 202b 2027 2e67 6666 272c 2067 656e  ut + '.gff', gen
-000896a0: 6f6d 652c 205c 0a20 2020 2020 2020 2020  ome, \.         
-000896b0: 2020 2020 2020 206e 5f63 6f72 6573 3d6e         n_cores=n
-000896c0: 5f63 6f72 6573 2c20 7265 7620 3d20 7265  _cores, rev = re
-000896d0: 762c 206f 7574 5f64 6972 203d 206f 7574  v, out_dir = out
-000896e0: 5f64 6972 2c20 6764 7320 3d20 6764 7320  _dir, gds = gds 
-000896f0: 290a 2020 2020 2020 2020 0a20 2020 2072  ).        .    r
-00089700: 6574 7572 6e20 6669 6c65 5f6f 7574 0a20  eturn file_out. 
-00089710: 2020 2020 2020 200a 0a23 2323 2323 2323         ..#######
-00089720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089730: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089750: 2323 0a23 2320 5374 7269 6e67 4669 782d  ##.## StringFix-
-00089760: 6164 646f 6e20 2020 2020 2020 2020 2020  addon           
-00089770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00089780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00089790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000897a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000897b0: 2020 2023 230a 2323 2064 6576 656c 6f70     ##.## develop
-000897c0: 6564 2062 7920 5365 6f6b 6879 756e 2059  ed by Seokhyun Y
-000897d0: 6f6f 6e20 2873 796f 6f6e 4064 6b75 2e65  oon (syoon@dku.e
-000897e0: 6475 2920 4f63 742e 2030 342c 2032 3032  du) Oct. 04, 202
-000897f0: 3020 2020 2323 0a23 2323 2323 2323 2323  0   ##.#########
+00088d70: 7369 6465 7265 6420 7661 6c69 6420 5b3e  sidered valid [>
+00088d80: 3d31 2e30 5d27 2029 0a20 2020 2020 2020  =1.0]' ).       
+00088d90: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088da0: 2520 276d 6470 272c 2027 4d69 6e69 6d75  % 'mdp', 'Minimu
+00088db0: 6d20 636f 7665 7261 6765 2064 6570 7468  m coverage depth
+00088dc0: 2066 6f72 2053 4e50 2063 6f72 7265 6374   for SNP correct
+00088dd0: 696f 6e20 5b3e 3d31 2e30 5d27 2029 0a20  ion [>=1.0]' ). 
+00088de0: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
+00088df0: 3273 3a20 2720 2520 276d 6466 272c 2027  2s: ' % 'mdf', '
+00088e00: 4d69 6e69 6d75 6d20 636f 7665 7261 6765  Minimum coverage
+00088e10: 2064 6570 7468 2066 7261 6374 696f 6e20   depth fraction 
+00088e20: 666f 7220 696e 7365 7273 696f 6e20 616e  for insersion an
+00088e30: 6420 6465 6c65 7469 6f6e 2074 6f20 6265  d deletion to be
+00088e40: 2063 6f6e 7369 6465 7265 6420 7661 6c69   considered vali
+00088e50: 6420 2830 7e31 2927 2029 0a20 2020 2020  d (0~1)' ).     
+00088e60: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
+00088e70: 2720 2520 276a 756d 705f 746f 272c 2027  ' % 'jump_to', '
+00088e80: 4a75 6d70 2074 6f20 7374 6570 206a 205b  Jump to step j [
+00088e90: 3020 6f72 2031 206f 7220 325d 2720 290a  0 or 1 or 2]' ).
+00088ea0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00088eb0: 2020 2020 7361 6d5f 6669 6c65 203d 2049      sam_file = I
+00088ec0: 6e70 7574 0a20 2020 2067 7466 5f66 696c  nput.    gtf_fil
+00088ed0: 6520 3d20 616e 6e6f 745f 6774 660a 0a20  e = annot_gtf.. 
+00088ee0: 2020 2069 6620 5059 4241 4d5f 4552 523a     if PYBAM_ERR:
+00088ef0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088f00: 5374 7269 6e67 4669 7820 5741 524e 494e  StringFix WARNIN
+00088f10: 473a 2070 7962 616d 206e 6f74 2061 7661  G: pybam not ava
+00088f20: 696c 6162 6c65 2e20 4163 6365 7074 2053  ilable. Accept S
+00088f30: 414d 2066 696c 6520 6f6e 6c79 2e27 290a  AM file only.').
+00088f40: 0a20 2020 2069 6620 2867 656e 6f6d 655f  .    if (genome_
+00088f50: 6661 2069 7320 6e6f 7420 4e6f 6e65 2920  fa is not None) 
+00088f60: 2620 2867 7466 5f66 696c 6520 6973 206e  & (gtf_file is n
+00088f70: 6f74 204e 6f6e 6529 3a0a 2020 2020 2020  ot None):.      
+00088f80: 2020 7072 696e 7428 2753 7472 696e 6746    print('StringF
+00088f90: 6978 2069 7320 7275 6e6e 696e 6720 696e  ix is running in
+00088fa0: 2061 6e6e 6f74 6174 696f 6e20 6775 6964   annotation guid
+00088fb0: 6564 206d 6f64 6520 7769 7468 2073 6571  ed mode with seq
+00088fc0: 7565 6e63 6520 636f 7272 6563 7469 6f6e  uence correction
+00088fd0: 2e27 290a 2020 2020 656c 6966 2028 6765  .').    elif (ge
+00088fe0: 6e6f 6d65 5f66 6120 6973 206e 6f74 204e  nome_fa is not N
+00088ff0: 6f6e 6529 2026 2028 6774 665f 6669 6c65  one) & (gtf_file
+00089000: 2069 7320 4e6f 6e65 293a 0a20 2020 2020   is None):.     
+00089010: 2020 2070 7269 6e74 2827 5374 7269 6e67     print('String
+00089020: 4669 7820 6973 2072 756e 6e69 6e67 2069  Fix is running i
+00089030: 6e20 6765 6e6f 6d65 2067 7569 6465 6420  n genome guided 
+00089040: 6d6f 6465 2077 6974 6820 7365 7175 656e  mode with sequen
+00089050: 6365 2063 6f72 7265 6374 696f 6e2e 2729  ce correction.')
+00089060: 0a20 2020 2065 6c69 6620 2867 656e 6f6d  .    elif (genom
+00089070: 655f 6661 2069 7320 4e6f 6e65 2920 2620  e_fa is None) & 
+00089080: 2867 7466 5f66 696c 6520 6973 204e 6f6e  (gtf_file is Non
+00089090: 6529 3a0a 2020 2020 2020 2020 7072 696e  e):.        prin
+000890a0: 7428 2753 7472 696e 6746 6978 2069 7320  t('StringFix is 
+000890b0: 7275 6e6e 696e 6720 696e 2067 656e 6f6d  running in genom
+000890c0: 6520 6775 6964 6564 206d 6f64 6520 7769  e guided mode wi
+000890d0: 7468 6f75 7420 7365 7175 656e 6365 2063  thout sequence c
+000890e0: 6f72 7265 6374 696f 6e2e 2729 0a20 2020  orrection.').   
+000890f0: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
+00089100: 7269 6e74 2827 5374 7269 6e67 4669 7820  rint('StringFix 
+00089110: 6973 2072 756e 6e69 6e67 2069 6e20 616e  is running in an
+00089120: 6e6f 7461 7469 6f6e 2067 7569 6465 6420  notation guided 
+00089130: 6d6f 6465 2077 6974 686f 7574 2073 6571  mode without seq
+00089140: 7565 6e63 6520 636f 7272 6563 7469 6f6e  uence correction
+00089150: 2e27 290a 2020 2020 0a0a 2020 2020 2320  .').    ..    # 
+00089160: 7265 7620 3d20 4661 6c73 650a 2020 2020  rev = False.    
+00089170: 7265 7620 3d20 6f75 745f 6375 7374 6f6d  rev = out_custom
+00089180: 5f67 656e 6f6d 650a 2020 2020 6362 7963  _genome.    cbyc
+00089190: 203d 2054 7275 6520 0a20 2020 2073 6120   = True .    sa 
+000891a0: 3d20 320a 2020 2020 6966 2078 7361 3a20  = 2.    if xsa: 
+000891b0: 7361 203d 2030 0a0a 2020 2020 4d49 4e5f  sa = 0..    MIN_
+000891c0: 4356 475f 464f 525f 534e 505f 434f 5252  CVG_FOR_SNP_CORR
+000891d0: 4543 5449 4f4e 203d 2069 6e74 286d 6470  ECTION = int(mdp
+000891e0: 290a 2020 2020 495f 5641 4c49 445f 4356  ).    I_VALID_CV
+000891f0: 4720 3d20 6d61 7828 312c 206e 702e 666c  G = max(1, np.fl
+00089200: 6f61 7428 6d64 6929 290a 2020 2020 445f  oat(mdi)).    D_
+00089210: 5641 4c49 445f 4356 4720 3d20 6d61 7828  VALID_CVG = max(
+00089220: 312c 206e 702e 666c 6f61 7428 6d64 6429  1, np.float(mdd)
+00089230: 290a 2020 2020 495f 5641 4c49 445f 4346  ).    I_VALID_CF
+00089240: 5241 4320 3d20 666c 6f61 7428 6d64 6629  RAC = float(mdf)
+00089250: 0a20 2020 2044 5f56 414c 4944 5f43 4652  .    D_VALID_CFR
+00089260: 4143 203d 2066 6c6f 6174 286d 6466 290a  AC = float(mdf).
+00089270: 2020 2020 4d49 4e5f 434f 565f 544f 5f53      MIN_COV_TO_S
+00089280: 454c 203d 206e 702e 666c 6f61 7428 6d63  EL = np.float(mc
+00089290: 7629 0a20 2020 204d 494e 5f41 424e 5f54  v).    MIN_ABN_T
+000892a0: 4f5f 5345 4c20 3d20 6e70 2e66 6c6f 6174  O_SEL = np.float
+000892b0: 286d 6364 290a 2020 2020 4d49 4e5f 5452  (mcd).    MIN_TR
+000892c0: 5f4c 454e 4754 4820 3d20 696e 7428 6d74  _LENGTH = int(mt
+000892d0: 6c29 0a20 2020 204d 494e 5f50 525f 4c45  l).    MIN_PR_LE
+000892e0: 4e47 5448 203d 2069 6e74 286d 706c 290a  NGTH = int(mpl).
+000892f0: 2020 2020 4d41 585f 4e55 4d5f 5041 5448      MAX_NUM_PATH
+00089300: 5320 3d20 696e 7428 6e5f 7029 0a20 2020  S = int(n_p).   
+00089310: 2047 454e 5f41 4153 5f55 4e53 5045 4320   GEN_AAS_UNSPEC 
+00089320: 3d20 5472 7565 0a0a 2020 2020 6966 2067  = True..    if g
+00089330: 7466 5f66 696c 6520 6973 204e 6f6e 653a  tf_file is None:
+00089340: 0a20 2020 2020 2020 204d 4158 5f4e 554d  .        MAX_NUM
+00089350: 5f50 4154 4853 203d 2032 300a 2020 2020  _PATHS = 20.    
+00089360: 2020 2020 4d49 4e5f 4e5f 5244 535f 5045      MIN_N_RDS_PE
+00089370: 525f 4745 4e45 203d 2033 300a 2020 2020  R_GENE = 30.    
+00089380: 2020 2020 5452 5f46 494c 5445 525f 5345      TR_FILTER_SE
+00089390: 4c20 3d20 320a 0a20 2020 2069 6620 6f75  L = 2..    if ou
+000893a0: 745f 6469 7220 6973 206e 6f74 204e 6f6e  t_dir is not Non
+000893b0: 653a 200a 2020 2020 2020 2020 6966 206e  e: .        if n
+000893c0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+000893d0: 7328 6f75 745f 6469 7229 3a20 6f73 2e6d  s(out_dir): os.m
+000893e0: 6b64 6972 286f 7574 5f64 6972 290a 0a20  kdir(out_dir).. 
+000893f0: 2020 2066 696c 655f 6f75 742c 2067 6473     file_out, gds
+00089400: 2c20 6765 6e6f 6d65 203d 2053 7472 696e  , genome = Strin
+00089410: 6746 6978 5f61 6e61 6c79 7369 7328 7361  gFix_analysis(sa
+00089420: 6d5f 6669 6c65 2c20 6774 6620 3d20 6774  m_file, gtf = gt
+00089430: 665f 6669 6c65 2c20 6765 6e6f 6d65 5f66  f_file, genome_f
+00089440: 696c 6520 3d20 6765 6e6f 6d65 5f66 612c  ile = genome_fa,
+00089450: 206a 756d 7020 3d20 6a75 6d70 5f74 6f2c   jump = jump_to,
+00089460: 205c 0a20 2020 2020 2020 2020 2020 206e   \.            n
+00089470: 5f63 6f72 6573 3d6e 5f63 6f72 6573 2c20  _cores=n_cores, 
+00089480: 6f75 745f 7472 203d 2054 7275 652c 2063  out_tr = True, c
+00089490: 6279 6320 3d20 6362 7963 2c20 7375 6666  byc = cbyc, suff
+000894a0: 6978 203d 2073 7566 6669 782c 206f 7574  ix = suffix, out
+000894b0: 5f64 6972 203d 206f 7574 5f64 6972 2c20  _dir = out_dir, 
+000894c0: 7361 203d 2073 6120 2920 0a0a 2020 2020  sa = sa ) ..    
+000894d0: 6966 2028 6764 7320 6973 206e 6f74 204e  if (gds is not N
+000894e0: 6f6e 6529 2026 2028 6a75 6d70 5f74 6f20  one) & (jump_to 
+000894f0: 3c20 3229 3a0a 2020 2020 2020 2020 7072  < 2):.        pr
+00089500: 696e 7428 2753 6176 696e 6720 6765 6e65  int('Saving gene
+00089510: 2064 6573 6372 6970 746f 7220 2e2e 2027   descriptor .. '
+00089520: 2c20 656e 6420 3d20 2720 272c 2066 6c75  , end = ' ', flu
+00089530: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
+00089540: 2020 2077 6974 6820 6f70 656e 2866 696c     with open(fil
+00089550: 655f 6f75 7420 2b20 272e 6764 7327 2c20  e_out + '.gds', 
+00089560: 2777 6227 2920 6173 2066 3a0a 2020 2020  'wb') as f:.    
+00089570: 2020 2020 2020 2020 7069 636b 6c65 2e64          pickle.d
+00089580: 756d 7028 2028 6764 7329 2c20 6620 290a  ump( (gds), f ).
+00089590: 2020 2020 2020 2020 7072 696e 7428 2764          print('d
+000895a0: 6f6e 652e 2027 290a 2020 2020 656c 7365  one. ').    else
+000895b0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+000895c0: 2753 7472 696e 6746 6978 2073 7461 7274  'StringFix start
+000895d0: 6564 2027 2c20 6461 7465 7469 6d65 2e64  ed ', datetime.d
+000895e0: 6174 6574 696d 652e 6e6f 7728 2929 0a20  atetime.now()). 
+000895f0: 2020 2020 2020 2070 7269 6e74 2827 4c6f         print('Lo
+00089600: 6164 696e 6720 6765 6e65 2064 6573 6372  ading gene descr
+00089610: 6970 746f 7220 2e2e 2027 2c20 656e 6420  iptor .. ', end 
+00089620: 3d20 2720 272c 2066 6c75 7368 203d 2054  = ' ', flush = T
+00089630: 7275 6529 0a20 2020 2020 2020 2077 6974  rue).        wit
+00089640: 6820 6f70 656e 2866 696c 655f 6f75 7420  h open(file_out 
+00089650: 2b20 272e 6764 7327 2c20 2772 6227 2920  + '.gds', 'rb') 
+00089660: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+00089670: 2020 6764 7320 3d20 7069 636b 6c65 2e6c    gds = pickle.l
+00089680: 6f61 6428 2066 2029 0a20 2020 2020 2020  oad( f ).       
+00089690: 2067 656e 6f6d 6520 3d20 6765 6e6f 6d65   genome = genome
+000896a0: 5f66 610a 2020 2020 2020 2020 7072 696e  _fa.        prin
+000896b0: 7428 2764 6f6e 652e 2027 290a 2020 2020  t('done. ').    
+000896c0: 0a20 2020 2069 6620 2867 656e 6f6d 655f  .    if (genome_
+000896d0: 6661 2069 7320 4e6f 6e65 293a 0a20 2020  fa is None):.   
+000896e0: 2020 2020 2070 7269 6e74 2827 5374 7269       print('Stri
+000896f0: 6e67 4669 7820 6669 6e69 7368 6564 2027  ngFix finished '
+00089700: 2c20 6461 7465 7469 6d65 2e64 6174 6574  , datetime.datet
+00089710: 696d 652e 6e6f 7728 2929 0a20 2020 2065  ime.now()).    e
+00089720: 6c73 653a 0a20 2020 2020 2020 2066 696c  lse:.        fil
+00089730: 655f 6f75 742c 2066 696c 655f 6f75 745f  e_out, file_out_
+00089740: 6765 6e6f 6d65 203d 2053 7472 696e 6746  genome = StringF
+00089750: 6978 5f73 796e 7468 6573 6973 2820 6669  ix_synthesis( fi
+00089760: 6c65 5f6f 7574 202b 2027 2e67 6666 272c  le_out + '.gff',
+00089770: 2067 656e 6f6d 652c 205c 0a20 2020 2020   genome, \.     
+00089780: 2020 2020 2020 2020 2020 206e 5f63 6f72             n_cor
+00089790: 6573 3d6e 5f63 6f72 6573 2c20 7265 7620  es=n_cores, rev 
+000897a0: 3d20 7265 762c 206f 7574 5f64 6972 203d  = rev, out_dir =
+000897b0: 206f 7574 5f64 6972 2c20 6764 7320 3d20   out_dir, gds = 
+000897c0: 6764 7320 290a 2020 2020 2020 2020 0a20  gds ).        . 
+000897d0: 2020 2072 6574 7572 6e20 6669 6c65 5f6f     return file_o
+000897e0: 7574 0a20 2020 2020 2020 200a 0a23 2323  ut.        ..###
+000897f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00089800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00089810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00089830: 0a0a 6465 6620 7768 6963 6828 2061 692c  ..def which( ai,
-00089840: 2076 616c 7565 203d 2054 7275 6520 2920   value = True ) 
-00089850: 3a0a 2020 2020 7768 203d 205b 5d0a 2020  :.    wh = [].  
-00089860: 2020 6120 3d20 6c69 7374 2861 6929 0a20    a = list(ai). 
-00089870: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-00089880: 6528 6c65 6e28 6129 293a 200a 2020 2020  e(len(a)): .    
-00089890: 2020 2020 6966 2061 5b6b 5d20 3d3d 2076      if a[k] == v
-000898a0: 616c 7565 3a20 0a20 2020 2020 2020 2020  alue: .         
-000898b0: 2020 2077 682e 6170 7065 6e64 286b 2920     wh.append(k) 
-000898c0: 0a20 2020 2072 6574 7572 6e28 7768 290a  .    return(wh).
-000898d0: 0a64 6566 2067 6574 5f69 6e66 6f5f 6672  .def get_info_fr
-000898e0: 6f6d 5f74 725f 6e61 6d65 2820 746e 7320  om_tr_name( tns 
-000898f0: 293a 0a20 2020 200a 2020 2020 6162 6e5f  ):.    .    abn_
-00089900: 6520 3d20 5b5d 0a20 2020 2074 706d 5f65  e = [].    tpm_e
-00089910: 203d 205b 5d0a 2020 2020 6966 7261 6320   = [].    ifrac 
-00089920: 3d20 5b5d 0a20 2020 2073 6964 7820 3d20  = [].    sidx = 
-00089930: 5b5d 0a20 2020 2067 5f73 697a 6520 3d20  [].    g_size = 
-00089940: 5b5d 0a20 2020 206e 5f65 786f 6e73 203d  [].    n_exons =
-00089950: 205b 5d0a 2020 2020 675f 766f 6c20 3d20   [].    g_vol = 
-00089960: 5b5d 0a20 2020 2069 636e 7420 3d20 5b5d  [].    icnt = []
-00089970: 0a20 2020 2074 5f6c 656e 203d 205b 5d0a  .    t_len = [].
-00089980: 2020 2020 7374 726e 6420 3d20 5b5d 0a20      strnd = []. 
-00089990: 2020 2063 646e 6720 3d20 5b5d 0a20 2020     cdng = [].   
-000899a0: 2066 6f72 206b 2c20 746e 2069 6e20 656e   for k, tn in en
-000899b0: 756d 6572 6174 6528 746e 7329 3a0a 2020  umerate(tns):.  
-000899c0: 2020 2020 2020 6864 7220 3d20 746e 2e73        hdr = tn.s
-000899d0: 706c 6974 2827 2027 290a 2020 2020 2020  plit(' ').      
-000899e0: 2020 6974 656d 7320 3d20 6864 725b 305d    items = hdr[0]
-000899f0: 2e73 706c 6974 2827 5f27 290a 2020 2020  .split('_').    
-00089a00: 2020 2020 7374 726e 642e 6170 7065 6e64      strnd.append
-00089a10: 2820 6974 656d 735b 325d 290a 2020 2020  ( items[2]).    
-00089a20: 2020 2020 6364 6e67 2e61 7070 656e 6428      cdng.append(
-00089a30: 2069 7465 6d73 5b33 5d29 0a20 2020 2020   items[3]).     
-00089a40: 2020 2073 6964 782e 6170 7065 6e64 2820     sidx.append( 
-00089a50: 2869 7465 6d73 5b34 5d29 2029 0a20 2020  (items[4]) ).   
-00089a60: 2020 2020 2067 5f73 697a 652e 6170 7065       g_size.appe
-00089a70: 6e64 2820 696e 7428 6974 656d 735b 355d  nd( int(items[5]
-00089a80: 2920 290a 2020 2020 2020 2020 6963 6e74  ) ).        icnt
-00089a90: 2e61 7070 656e 6428 2069 6e74 2869 7465  .append( int(ite
-00089aa0: 6d73 5b36 5d29 2029 0a20 2020 2020 2020  ms[6]) ).       
-00089ab0: 2076 616c 203d 2069 7465 6d73 5b37 5d2e   val = items[7].
-00089ac0: 7370 6c69 7428 273a 2729 0a20 2020 2020  split(':').     
-00089ad0: 2020 2061 626e 5f65 2e61 7070 656e 6428     abn_e.append(
-00089ae0: 2066 6c6f 6174 2876 616c 5b31 5d29 2029   float(val[1]) )
-00089af0: 0a20 2020 2020 2020 2076 616c 203d 2069  .        val = i
-00089b00: 7465 6d73 5b38 5d2e 7370 6c69 7428 273a  tems[8].split(':
-00089b10: 2729 0a20 2020 2020 2020 2074 706d 5f65  ').        tpm_e
-00089b20: 2e61 7070 656e 6428 2066 6c6f 6174 2876  .append( float(v
-00089b30: 616c 5b31 5d29 2029 0a20 2020 2020 2020  al[1]) ).       
-00089b40: 2076 616c 203d 2069 7465 6d73 5b39 5d2e   val = items[9].
-00089b50: 7370 6c69 7428 273a 2729 0a20 2020 2020  split(':').     
-00089b60: 2020 2069 6672 6163 2e61 7070 656e 6428     ifrac.append(
-00089b70: 2066 6c6f 6174 2876 616c 5b31 5d29 2029   float(val[1]) )
-00089b80: 0a20 2020 2020 2020 2076 616c 203d 2069  .        val = i
-00089b90: 7465 6d73 5b31 315d 2e73 706c 6974 2827  tems[11].split('
-00089ba0: 3a27 290a 2020 2020 2020 2020 6e5f 6578  :').        n_ex
-00089bb0: 6f6e 732e 6170 7065 6e64 2820 696e 7428  ons.append( int(
-00089bc0: 7661 6c5b 315d 2920 290a 2020 2020 2020  val[1]) ).      
-00089bd0: 2020 7661 6c20 3d20 6974 656d 735b 3132    val = items[12
-00089be0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-00089bf0: 2020 2020 2067 5f76 6f6c 2e61 7070 656e       g_vol.appen
-00089c00: 6428 2069 6e74 2876 616c 5b31 5d29 2029  d( int(val[1]) )
-00089c10: 0a20 2020 2020 2020 2076 616c 203d 2069  .        val = i
-00089c20: 7465 6d73 5b31 335d 2e73 706c 6974 2827  tems[13].split('
-00089c30: 3a27 290a 2020 2020 2020 2020 745f 6c65  :').        t_le
-00089c40: 6e2e 6170 7065 6e64 2820 696e 7428 7661  n.append( int(va
-00089c50: 6c5b 315d 2920 290a 2020 2020 0a20 2020  l[1]) ).    .   
-00089c60: 2064 6620 3d20 7064 2e44 6174 6146 7261   df = pd.DataFra
-00089c70: 6d65 2829 0a20 2020 200a 2020 2020 6466  me().    .    df
-00089c80: 5b27 7472 5f6e 616d 6527 5d20 3d20 746e  ['tr_name'] = tn
-00089c90: 730a 2020 2020 6466 5b27 6162 6e5f 6573  s.    df['abn_es
-00089ca0: 7427 5d20 3d20 6162 6e5f 650a 2020 2020  t'] = abn_e.    
-00089cb0: 6466 5b27 7470 6d5f 6573 7427 5d20 3d20  df['tpm_est'] = 
-00089cc0: 7470 6d5f 650a 2020 2020 6466 5b27 6769  tpm_e.    df['gi
-00089cd0: 6478 275d 203d 2073 6964 780a 2020 2020  dx'] = sidx.    
-00089ce0: 6466 5b27 6969 6478 275d 203d 2069 636e  df['iidx'] = icn
-00089cf0: 740a 2020 2020 6466 5b27 675f 7369 7a65  t.    df['g_size
-00089d00: 275d 203d 2067 5f73 697a 650a 2020 2020  '] = g_size.    
-00089d10: 6466 5b27 6973 6f5f 6672 6163 275d 203d  df['iso_frac'] =
-00089d20: 2069 6672 6163 0a20 2020 2064 665b 276e   ifrac.    df['n
-00089d30: 5f65 786f 6e73 275d 203d 206e 5f65 786f  _exons'] = n_exo
-00089d40: 6e73 0a20 2020 2064 665b 2767 5f76 6f6c  ns.    df['g_vol
-00089d50: 275d 203d 2067 5f76 6f6c 0a20 2020 2064  '] = g_vol.    d
-00089d60: 665b 276c 656e 6774 6827 5d20 3d20 745f  f['length'] = t_
-00089d70: 6c65 6e0a 2020 2020 6466 5b27 7374 7261  len.    df['stra
-00089d80: 6e64 275d 203d 2073 7472 6e64 0a20 2020  nd'] = strnd.   
-00089d90: 2064 665b 2743 5f6f 725f 4e27 5d20 3d20   df['C_or_N'] = 
-00089da0: 6364 6e67 0a20 2020 200a 2020 2020 6466  cdng.    .    df
-00089db0: 203d 2064 662e 7365 745f 696e 6465 7828   = df.set_index(
-00089dc0: 2774 725f 6e61 6d65 2729 0a20 2020 200a  'tr_name').    .
-00089dd0: 2020 2020 7265 7475 726e 2064 660a 0a64      return df..d
-00089de0: 6566 2067 6574 5f70 6572 666f 726d 616e  ef get_performan
-00089df0: 6365 2874 7269 6e66 6f2c 2063 7667 5f74  ce(trinfo, cvg_t
-00089e00: 6820 3d20 5b38 302c 3930 2c39 355d 2c20  h = [80,90,95], 
-00089e10: 665f 746f 5f73 6176 6520 3d20 4e6f 6e65  f_to_save = None
-00089e20: 2c20 7265 6620 3d20 302c 2076 6572 626f  , ref = 0, verbo
-00089e30: 7365 203d 2046 616c 7365 293a 0a20 2020  se = False):.   
-00089e40: 200a 2020 2020 2327 2727 0a20 2020 2069   .    #'''.    i
-00089e50: 6620 7265 6620 3d3d 2030 3a0a 2020 2020  f ref == 0:.    
-00089e60: 2020 2020 715f 6376 6720 3d20 2771 6376      q_cvg = 'qcv
-00089e70: 6727 0a20 2020 2020 2020 2071 5f6c 656e  g'.        q_len
-00089e80: 203d 2027 716c 656e 270a 2020 2020 2020   = 'qlen'.      
-00089e90: 2020 715f 6964 203d 2027 7169 6427 0a20    q_id = 'qid'. 
-00089ea0: 2020 2020 2020 2073 5f73 7461 7274 203d         s_start =
-00089eb0: 2027 7373 7461 7274 270a 2020 2020 2020   'sstart'.      
-00089ec0: 2020 735f 656e 6420 3d20 2773 656e 6427    s_end = 'send'
-00089ed0: 0a20 2020 2020 2020 2073 5f69 6420 3d20  .        s_id = 
-00089ee0: 2773 6964 270a 2020 2020 656c 7365 3a0a  'sid'.    else:.
-00089ef0: 2020 2020 2020 2020 715f 6376 6720 3d20          q_cvg = 
-00089f00: 2773 6376 6727 0a20 2020 2020 2020 2071  'scvg'.        q
-00089f10: 5f6c 656e 203d 2027 736c 656e 270a 2020  _len = 'slen'.  
-00089f20: 2020 2020 2020 715f 6964 203d 2027 7369        q_id = 'si
-00089f30: 6427 0a20 2020 2020 2020 2073 5f73 7461  d'.        s_sta
-00089f40: 7274 203d 2027 7173 7461 7274 270a 2020  rt = 'qstart'.  
-00089f50: 2020 2020 2020 735f 656e 6420 3d20 2771        s_end = 'q
-00089f60: 656e 6427 0a20 2020 2020 2020 2073 5f69  end'.        s_i
-00089f70: 6420 3d20 2771 6964 270a 2020 2020 2327  d = 'qid'.    #'
-00089f80: 2727 0a20 2020 200a 2020 2020 7169 6473  ''.    .    qids
-00089f90: 203d 2070 642e 756e 6971 7565 2874 7269   = pd.unique(tri
-00089fa0: 6e66 6f5b 715f 6964 5d29 0a20 2020 2073  nfo[q_id]).    s
-00089fb0: 6964 7320 3d20 7064 2e75 6e69 7175 6528  ids = pd.unique(
-00089fc0: 7472 696e 666f 5b73 5f69 645d 290a 2020  trinfo[s_id]).  
-00089fd0: 2020 7767 7420 3d20 6e70 2e7a 6572 6f73    wgt = np.zeros
-00089fe0: 285b 6c65 6e28 7169 6473 292c 6c65 6e28  ([len(qids),len(
-00089ff0: 7369 6473 295d 290a 2020 2020 6966 2076  sids)]).    if v
-0008a000: 6572 626f 7365 3a20 7072 696e 7428 274d  erbose: print('M
-0008a010: 6174 6368 696e 6720 2825 692c 2569 2920  atching (%i,%i) 
-0008a020: 2720 2520 2877 6774 2e73 6861 7065 292c  ' % (wgt.shape),
-0008a030: 2065 6e64 3d27 2729 0a0a 2020 2020 7169   end='')..    qi
-0008a040: 6478 203d 206e 702e 6675 6c6c 2874 7269  dx = np.full(tri
-0008a050: 6e66 6f2e 7368 6170 655b 305d 2c2d 312c  nfo.shape[0],-1,
-0008a060: 6474 7970 653d 696e 7429 0a20 2020 2066  dtype=int).    f
-0008a070: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
-0008a080: 6e28 7169 6473 2929 203a 0a20 2020 2020  n(qids)) :.     
-0008a090: 2020 2071 6964 203d 2071 6964 735b 6b5d     qid = qids[k]
-0008a0a0: 0a20 2020 2020 2020 2077 6820 3d20 7768  .        wh = wh
-0008a0b0: 6963 6828 2074 7269 6e66 6f5b 715f 6964  ich( trinfo[q_id
-0008a0c0: 5d20 3d3d 2071 6964 2029 0a20 2020 2020  ] == qid ).     
-0008a0d0: 2020 2071 6964 785b 7768 5d20 3d20 6b0a     qidx[wh] = k.
-0008a0e0: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
-0008a0f0: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
-0008a100: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
-0008a110: 7369 6478 203d 206e 702e 6675 6c6c 2874  sidx = np.full(t
-0008a120: 7269 6e66 6f2e 7368 6170 655b 305d 2c2d  rinfo.shape[0],-
-0008a130: 312c 6474 7970 653d 696e 7429 0a20 2020  1,dtype=int).   
-0008a140: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
-0008a150: 6c65 6e28 7369 6473 2929 203a 0a20 2020  len(sids)) :.   
-0008a160: 2020 2020 2073 6964 203d 2073 6964 735b       sid = sids[
-0008a170: 6b5d 0a20 2020 2020 2020 2077 6820 3d20  k].        wh = 
-0008a180: 7768 6963 6828 2074 7269 6e66 6f5b 735f  which( trinfo[s_
-0008a190: 6964 5d20 3d3d 2073 6964 2029 0a20 2020  id] == sid ).   
-0008a1a0: 2020 2020 2073 6964 785b 7768 5d20 3d20       sidx[wh] = 
-0008a1b0: 6b0a 2020 2020 2020 2020 0a20 2020 2069  k.        .    i
-0008a1c0: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
-0008a1d0: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
-0008a1e0: 2020 666f 7220 7720 696e 2072 616e 6765    for w in range
-0008a1f0: 286c 656e 2871 6964 7829 293a 0a20 2020  (len(qidx)):.   
-0008a200: 2020 2020 2077 6774 5b69 6e74 2871 6964       wgt[int(qid
-0008a210: 785b 775d 292c 2069 6e74 2873 6964 785b  x[w]), int(sidx[
-0008a220: 775d 295d 203d 202d 7472 696e 666f 5b71  w])] = -trinfo[q
-0008a230: 5f63 7667 5d5b 775d 0a0a 2020 2020 6966  _cvg][w]..    if
-0008a240: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
-0008a250: 275f 272c 2065 6e64 3d27 2729 0a20 2020  '_', end='').   
-0008a260: 2023 2070 7269 6e74 2877 6774 2e73 6861   # print(wgt.sha
-0008a270: 7065 290a 2020 2020 726f 775f 6964 782c  pe).    row_idx,
-0008a280: 2063 6f6c 5f69 6478 203d 206f 7074 696d   col_idx = optim
-0008a290: 697a 652e 6c69 6e65 6172 5f73 756d 5f61  ize.linear_sum_a
-0008a2a0: 7373 6967 6e6d 656e 7428 7767 7429 0a20  ssignment(wgt). 
-0008a2b0: 2020 200a 2020 2020 6966 2076 6572 626f     .    if verbo
-0008a2c0: 7365 3a20 7072 696e 7428 272e 272c 2065  se: print('.', e
-0008a2d0: 6e64 3d27 2729 0a20 2020 2064 665f 6c73  nd='').    df_ls
-0008a2e0: 7420 3d20 5b5d 0a20 2020 2066 6f72 206b  t = [].    for k
-0008a2f0: 2069 6e20 7261 6e67 6528 6c65 6e28 636f   in range(len(co
-0008a300: 6c5f 6964 7829 2920 3a0a 2020 2020 2020  l_idx)) :.      
-0008a310: 2020 7369 203d 2063 6f6c 5f69 6478 5b6b    si = col_idx[k
-0008a320: 5d0a 2020 2020 2020 2020 7768 203d 2077  ].        wh = w
-0008a330: 6869 6368 2873 6964 7820 3d3d 2073 6929  hich(sidx == si)
-0008a340: 0a20 2020 2020 2020 2077 203d 2077 6869  .        w = whi
-0008a350: 6368 2820 7169 6478 5b77 685d 203d 3d20  ch( qidx[wh] == 
-0008a360: 726f 775f 6964 785b 6b5d 2029 0a20 2020  row_idx[k] ).   
-0008a370: 2020 2020 2069 6620 6c65 6e28 7729 203e       if len(w) >
-0008a380: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0008a390: 6966 206c 656e 2877 2920 3e20 313a 2070  if len(w) > 1: p
-0008a3a0: 7269 6e74 2827 4552 524f 5220 696e 2067  rint('ERROR in g
-0008a3b0: 6574 5f70 6572 666f 726d 616e 6365 2829  et_performance()
-0008a3c0: 3a20 4c65 6e28 7729 203d 2025 6927 2025  : Len(w) = %i' %
-0008a3d0: 206c 656e 2877 2920 290a 2020 2020 2020   len(w) ).      
-0008a3e0: 2020 2020 2020 6964 7820 3d20 7768 5b77        idx = wh[w
-0008a3f0: 5b30 5d5d 0a20 2020 2020 2020 2020 2020  [0]].           
-0008a400: 2064 665f 6c73 742e 6170 7065 6e64 2874   df_lst.append(t
-0008a410: 7269 6e66 6f2e 696c 6f63 5b69 6478 5d29  rinfo.iloc[idx])
-0008a420: 0a20 2020 2020 2020 200a 2020 2020 6466  .        .    df
-0008a430: 5f73 656c 203d 2070 642e 4461 7461 4672  _sel = pd.DataFr
-0008a440: 616d 6528 6466 5f6c 7374 290a 2020 2020  ame(df_lst).    
-0008a450: 6966 2066 5f74 6f5f 7361 7665 2069 7320  if f_to_save is 
-0008a460: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0008a470: 2020 666e 616d 6520 3d20 2725 735f 626c    fname = '%s_bl
-0008a480: 6173 745f 7265 7375 6c74 2e74 7376 2720  ast_result.tsv' 
-0008a490: 2520 665f 746f 5f73 6176 650a 2020 2020  % f_to_save.    
-0008a4a0: 2020 2020 6466 5f73 656c 2e74 6f5f 6373      df_sel.to_cs
-0008a4b0: 7628 666e 616d 652c 2068 6561 6465 723d  v(fname, header=
-0008a4c0: 5472 7565 2c20 696e 6465 783d 4661 6c73  True, index=Fals
-0008a4d0: 652c 2073 6570 3d27 5c74 2729 0a20 2020  e, sep='\t').   
-0008a4e0: 2020 2020 2023 2069 6620 7665 7262 6f73       # if verbos
-0008a4f0: 653a 2070 7269 6e74 2827 2025 732e 2720  e: print(' %s.' 
-0008a500: 2520 666e 616d 652c 2065 6e64 3d27 2720  % fname, end='' 
-0008a510: 290a 2020 2020 0a20 2020 2069 6620 7665  ).    .    if ve
-0008a520: 7262 6f73 653a 2070 7269 6e74 2827 2e27  rbose: print('.'
-0008a530: 2c20 656e 643d 2727 290a 2020 2020 636e  , end='').    cn
-0008a540: 7420 3d20 6e70 2e7a 6572 6f73 286c 656e  t = np.zeros(len
-0008a550: 2863 7667 5f74 6829 290a 2020 2020 666f  (cvg_th)).    fo
-0008a560: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
-0008a570: 2863 7667 5f74 6829 293a 0a20 2020 2020  (cvg_th)):.     
-0008a580: 2020 2074 6820 3d20 6376 675f 7468 5b6b     th = cvg_th[k
-0008a590: 5d0a 2020 2020 2020 2020 7768 203d 2077  ].        wh = w
-0008a5a0: 6869 6368 2820 6466 5f73 656c 5b71 5f63  hich( df_sel[q_c
-0008a5b0: 7667 5d2a 3130 3020 3e3d 2074 6820 290a  vg]*100 >= th ).
-0008a5c0: 2020 2020 2020 2020 636e 745b 6b5d 203d          cnt[k] =
-0008a5d0: 206e 702e 696e 7428 6c65 6e28 7768 2929   np.int(len(wh))
-0008a5e0: 0a20 2020 2020 2020 200a 2020 2020 6966  .        .    if
-0008a5f0: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
-0008a600: 2720 646f 6e65 2e27 290a 0a20 2020 2064  ' done.')..    d
-0008a610: 203d 207b 2763 7667 5f74 6827 3a20 6376   = {'cvg_th': cv
-0008a620: 675f 7468 2c20 274e 5f72 6563 6f76 6572  g_th, 'N_recover
-0008a630: 6564 273a 2063 6e74 2e61 7374 7970 6528  ed': cnt.astype(
-0008a640: 696e 7429 2c20 2770 7265 6369 7369 6f6e  int), 'precision
-0008a650: 273a 206e 702e 726f 756e 6428 3130 302a  ': np.round(100*
-0008a660: 636e 742f 6c65 6e28 7369 6473 292c 3129  cnt/len(sids),1)
-0008a670: 7d0a 2020 2020 6466 5f70 6572 6620 3d20  }.    df_perf = 
-0008a680: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
-0008a690: 6120 3d20 6429 2023 2c20 636f 6c75 6d6e  a = d) #, column
-0008a6a0: 7320 3d20 5b27 6376 675f 7468 272c 276e  s = ['cvg_th','n
-0008a6b0: 5f72 6563 6f76 6572 6564 272c 2770 7265  _recovered','pre
-0008a6c0: 6369 7369 6f6e 275d 290a 2020 2020 0a20  cision']).    . 
-0008a6d0: 2020 2072 6574 7572 6e28 6466 5f70 6572     return(df_per
-0008a6e0: 662c 2064 665f 7365 6c29 0a0a 2020 2020  f, df_sel)..    
-0008a6f0: 0a64 6566 2072 756e 5f62 6c61 7374 2820  .def run_blast( 
-0008a700: 696e 7074 5f66 612c 2072 6566 5f66 612c  inpt_fa, ref_fa,
-0008a710: 2070 6174 685f 746f 5f62 6c61 7374 203d   path_to_blast =
-0008a720: 204e 6f6e 652c 2074 7261 7265 636f 203d   None, trareco =
-0008a730: 2046 616c 7365 2c20 7265 665f 696e 666f   False, ref_info
-0008a740: 203d 2046 616c 7365 2c20 5c0a 2020 2020   = False, \.    
-0008a750: 2020 2020 2020 2020 2020 2020 2064 6274               dbt
-0008a760: 7970 6520 3d20 276e 7563 6c27 2c20 7265  ype = 'nucl', re
-0008a770: 6620 3d20 302c 2073 6469 7620 3d20 3130  f = 0, sdiv = 10
-0008a780: 2c20 6d78 5f6e 6361 6e64 203d 2036 2c20  , mx_ncand = 6, 
-0008a790: 7665 7262 6f73 6520 3d20 4661 6c73 6529  verbose = False)
-0008a7a0: 3a0a 0a20 2020 2023 2727 270a 2020 2020  :..    #'''.    
-0008a7b0: 6966 2072 6566 203d 3d20 303a 0a20 2020  if ref == 0:.   
-0008a7c0: 2020 2020 2072 6566 5f74 7220 3d20 7265       ref_tr = re
-0008a7d0: 665f 6661 0a20 2020 2020 2020 2069 6e70  f_fa.        inp
-0008a7e0: 745f 7472 203d 2069 6e70 745f 6661 0a20  t_tr = inpt_fa. 
-0008a7f0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0008a800: 715f 6376 6720 3d20 2771 6376 6727 0a20  q_cvg = 'qcvg'. 
-0008a810: 2020 2020 2020 2071 5f6c 656e 203d 2027         q_len = '
-0008a820: 716c 656e 270a 2020 2020 2020 2020 715f  qlen'.        q_
-0008a830: 6964 203d 2027 7169 6427 0a20 2020 2020  id = 'qid'.     
-0008a840: 2020 2073 5f73 7461 7274 203d 2027 7373     s_start = 'ss
-0008a850: 7461 7274 270a 2020 2020 2020 2020 735f  tart'.        s_
-0008a860: 656e 6420 3d20 2773 656e 6427 0a20 2020  end = 'send'.   
-0008a870: 2020 2020 2073 5f69 6420 3d20 2773 6964       s_id = 'sid
-0008a880: 270a 2020 2020 656c 7365 3a0a 2020 2020  '.    else:.    
-0008a890: 2020 2020 7265 665f 7472 203d 2069 6e70      ref_tr = inp
-0008a8a0: 745f 6661 0a20 2020 2020 2020 2069 6e70  t_fa.        inp
-0008a8b0: 745f 7472 203d 2072 6566 5f66 610a 2020  t_tr = ref_fa.  
-0008a8c0: 2020 2020 2020 0a20 2020 2020 2020 2071        .        q
-0008a8d0: 5f63 7667 203d 2027 7363 7667 270a 2020  _cvg = 'scvg'.  
-0008a8e0: 2020 2020 2020 715f 6c65 6e20 3d20 2773        q_len = 's
-0008a8f0: 6c65 6e27 0a20 2020 2020 2020 2071 5f69  len'.        q_i
-0008a900: 6420 3d20 2773 6964 270a 2020 2020 2020  d = 'sid'.      
-0008a910: 2020 735f 7374 6172 7420 3d20 2771 7374    s_start = 'qst
-0008a920: 6172 7427 0a20 2020 2020 2020 2073 5f65  art'.        s_e
-0008a930: 6e64 203d 2027 7165 6e64 270a 2020 2020  nd = 'qend'.    
-0008a940: 2020 2020 735f 6964 203d 2027 7169 6427      s_id = 'qid'
-0008a950: 0a20 2020 2023 2727 270a 2020 2020 0a20  .    #'''.    . 
-0008a960: 2020 2066 696c 655f 6e61 6d65 7320 3d20     file_names = 
-0008a970: 696e 7074 5f74 722e 7370 6c69 7428 272e  inpt_tr.split('.
-0008a980: 2729 0a20 2020 2066 6e61 6d65 203d 2027  ').    fname = '
-0008a990: 272e 6a6f 696e 2873 7420 666f 7220 7374  '.join(st for st
-0008a9a0: 2069 6e20 6669 6c65 5f6e 616d 6573 5b3a   in file_names[:
-0008a9b0: 2d31 5d20 290a 0a20 2020 2074 6e5f 696e  -1] )..    tn_in
-0008a9c0: 203d 205b 5d0a 2020 2020 6620 3d20 6f70   = [].    f = op
-0008a9d0: 656e 2869 6e70 745f 7472 2c27 7227 290a  en(inpt_tr,'r').
-0008a9e0: 2020 2020 6361 6e64 5f63 6e74 203d 2030      cand_cnt = 0
-0008a9f0: 0a20 2020 2066 6f72 206c 696e 6520 696e  .    for line in
-0008aa00: 2066 3a0a 2020 2020 2020 2020 6966 206c   f:.        if l
-0008aa10: 696e 655b 305d 203d 3d20 273e 273a 0a20  ine[0] == '>':. 
-0008aa20: 2020 2020 2020 2020 2020 2074 6e5f 696e             tn_in
-0008aa30: 2e61 7070 656e 6428 6c69 6e65 5b31 3a2d  .append(line[1:-
-0008aa40: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-0008aa50: 6361 6e64 5f63 6e74 202b 3d20 310a 2020  cand_cnt += 1.  
-0008aa60: 2020 662e 636c 6f73 6528 290a 2020 2020    f.close().    
-0008aa70: 0a20 2020 2074 6e5f 7265 6620 3d20 5b5d  .    tn_ref = []
-0008aa80: 0a20 2020 2066 203d 206f 7065 6e28 7265  .    f = open(re
-0008aa90: 665f 7472 2c27 7227 290a 2020 2020 7265  f_tr,'r').    re
-0008aaa0: 665f 636e 7420 3d20 300a 2020 2020 666f  f_cnt = 0.    fo
-0008aab0: 7220 6c69 6e65 2069 6e20 663a 0a20 2020  r line in f:.   
-0008aac0: 2020 2020 2069 6620 6c69 6e65 5b30 5d20       if line[0] 
-0008aad0: 3d3d 2027 3e27 3a0a 2020 2020 2020 2020  == '>':.        
-0008aae0: 2020 2020 746e 5f72 6566 2e61 7070 656e      tn_ref.appen
-0008aaf0: 6428 6c69 6e65 5b31 3a2d 315d 290a 2020  d(line[1:-1]).  
-0008ab00: 2020 2020 2020 2020 2020 7265 665f 636e            ref_cn
-0008ab10: 7420 2b3d 2031 0a20 2020 2066 2e63 6c6f  t += 1.    f.clo
-0008ab20: 7365 2829 0a20 2020 2023 2070 7269 6e74  se().    # print
-0008ab30: 2827 4c65 6e3a 2025 692c 204e 753d 2025  ('Len: %i, Nu= %
-0008ab40: 6927 2025 2028 6c65 6e28 746e 292c 206c  i' % (len(tn), l
-0008ab50: 656e 2870 642e 756e 6971 7565 2874 6e29  en(pd.unique(tn)
-0008ab60: 2929 2c20 656e 643d 2727 2029 0a20 2020  )), end='' ).   
-0008ab70: 200a 2020 2020 6966 2072 6566 203d 3d20   .    if ref == 
-0008ab80: 303a 0a20 2020 2020 2020 2074 6e20 3d20  0:.        tn = 
-0008ab90: 746e 5f69 6e0a 2020 2020 2020 2020 6e5f  tn_in.        n_
-0008aba0: 6d61 785f 6361 6e64 7320 3d20 310a 2020  max_cands = 1.  
-0008abb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008abc0: 746e 203d 2074 6e5f 7265 660a 2020 2020  tn = tn_ref.    
-0008abd0: 2020 2020 6e5f 6d61 785f 6361 6e64 7320      n_max_cands 
-0008abe0: 3d20 206d 785f 6e63 616e 640a 2020 2020  =  mx_ncand.    
-0008abf0: 2020 2020 746d 7020 3d20 6361 6e64 5f63      tmp = cand_c
-0008ac00: 6e74 0a20 2020 2020 2020 2063 616e 645f  nt.        cand_
-0008ac10: 636e 7420 3d20 7265 665f 636e 740a 2020  cnt = ref_cnt.  
-0008ac20: 2020 2020 2020 7265 665f 636e 7420 3d20        ref_cnt = 
-0008ac30: 746d 700a 2020 2020 0a20 2020 2023 2320  tmp.    .    ## 
-0008ac40: 6d61 6b65 2062 6c61 7374 2064 6220 7769  make blast db wi
-0008ac50: 7468 2069 6e70 7574 5f74 720a 2020 2020  th input_tr.    
-0008ac60: 6966 2070 6174 685f 746f 5f62 6c61 7374  if path_to_blast
-0008ac70: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0008ac80: 2020 636d 6420 3d20 276d 616b 6562 6c61    cmd = 'makebla
-0008ac90: 7374 6462 202d 696e 2025 7320 2d64 6274  stdb -in %s -dbt
-0008aca0: 7970 6520 2573 2720 2520 2869 6e70 745f  ype %s' % (inpt_
-0008acb0: 7472 2c20 6462 7479 7065 290a 2020 2020  tr, dbtype).    
-0008acc0: 656c 7365 3a0a 2020 2020 2020 2020 636d  else:.        cm
-0008acd0: 6420 3d20 2725 732f 6d61 6b65 626c 6173  d = '%s/makeblas
-0008ace0: 7464 6220 2d69 6e20 2573 202d 6462 7479  tdb -in %s -dbty
-0008acf0: 7065 2025 7327 2025 2028 7061 7468 5f74  pe %s' % (path_t
-0008ad00: 6f5f 626c 6173 742c 2069 6e70 745f 7472  o_blast, inpt_tr
-0008ad10: 2c20 6462 7479 7065 290a 2020 2020 7265  , dbtype).    re
-0008ad20: 7320 3d20 7375 6270 726f 6365 7373 2e63  s = subprocess.c
-0008ad30: 6865 636b 5f6f 7574 7075 7428 636d 642c  heck_output(cmd,
-0008ad40: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-0008ad50: 2023 2070 7269 6e74 2872 6573 2e64 6563   # print(res.dec
-0008ad60: 6f64 6528 2777 696e 646f 7773 2d31 3235  ode('windows-125
-0008ad70: 3227 2929 0a20 0a20 2020 2073 7472 5f6f  2')). .    str_o
-0008ad80: 7074 696f 6e20 3d20 272d 6f75 7466 6d74  ption = '-outfmt
-0008ad90: 2022 3620 7173 6571 6964 2073 7365 7169   "6 qseqid sseqi
-0008ada0: 6420 716c 656e 206c 656e 6774 6820 736c  d qlen length sl
-0008adb0: 656e 2071 7374 6172 7420 7165 6e64 2073  en qstart qend s
-0008adc0: 7374 6172 7420 7365 6e64 206e 6964 656e  start send niden
-0008add0: 7420 6d69 736d 6174 6368 2067 6170 6f70  t mismatch gapop
-0008ade0: 656e 2071 636f 7673 2071 636f 7668 7370  en qcovs qcovhsp
-0008adf0: 2062 6974 7363 6f72 6522 202d 6e75 6d5f   bitscore" -num_
-0008ae00: 7468 7265 6164 7320 3420 2d6d 6178 5f74  threads 4 -max_t
-0008ae10: 6172 6765 745f 7365 7173 2025 6927 2025  arget_seqs %i' %
-0008ae20: 206e 5f6d 6178 5f63 616e 6473 0a0a 2020   n_max_cands..  
-0008ae30: 2020 6966 2064 6274 7970 6520 3d3d 2027    if dbtype == '
-0008ae40: 6e75 636c 273a 2070 7266 7820 3d20 276e  nucl': prfx = 'n
-0008ae50: 270a 2020 2020 656c 7365 3a20 7072 6678  '.    else: prfx
-0008ae60: 203d 2027 7027 0a20 2020 2020 2020 200a   = 'p'.        .
-0008ae70: 2020 2020 6966 2070 6174 685f 746f 5f62      if path_to_b
-0008ae80: 6c61 7374 2069 7320 4e6f 6e65 3a0a 2020  last is None:.  
-0008ae90: 2020 2020 2020 636d 6420 3d20 2762 6c61        cmd = 'bla
-0008aea0: 7374 2573 2025 7320 2d64 6220 2573 202d  st%s %s -db %s -
-0008aeb0: 7175 6572 7920 2573 202d 6f75 7420 2573  query %s -out %s
-0008aec0: 2e74 626c 7374 2720 2520 2870 7266 782c  .tblst' % (prfx,
-0008aed0: 2073 7472 5f6f 7074 696f 6e2c 2069 6e70   str_option, inp
-0008aee0: 745f 7472 2c20 7265 665f 7472 2c20 666e  t_tr, ref_tr, fn
-0008aef0: 616d 6529 0a20 2020 2065 6c73 653a 0a20  ame).    else:. 
-0008af00: 2020 2020 2020 2063 6d64 203d 2027 2573         cmd = '%s
-0008af10: 2f62 6c61 7374 2573 2025 7320 2d64 6220  /blast%s %s -db 
-0008af20: 2573 202d 7175 6572 7920 2573 202d 6f75  %s -query %s -ou
-0008af30: 7420 2573 2e74 626c 7374 2720 2520 2870  t %s.tblst' % (p
-0008af40: 6174 685f 746f 5f62 6c61 7374 2c20 7072  ath_to_blast, pr
-0008af50: 6678 2c20 7374 725f 6f70 7469 6f6e 2c20  fx, str_option, 
-0008af60: 696e 7074 5f74 722c 2072 6566 5f74 722c  inpt_tr, ref_tr,
-0008af70: 2066 6e61 6d65 290a 2020 2020 2020 2020   fname).        
-0008af80: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
-0008af90: 2070 7269 6e74 2822 5275 6e6e 696e 6720   print("Running 
-0008afa0: 426c 6173 742d 2573 2077 6974 6820 2569  Blast-%s with %i
-0008afb0: 2063 616e 642e 2025 6920 7265 662e 202e   cand. %i ref. .
-0008afc0: 2e2e 2022 2025 2028 6462 7479 7065 5b30  .. " % (dbtype[0
-0008afd0: 5d2e 7570 7065 7228 292c 6361 6e64 5f63  ].upper(),cand_c
-0008afe0: 6e74 2c20 7265 665f 636e 7429 2c20 656e  nt, ref_cnt), en
-0008aff0: 643d 2727 2c20 666c 7573 683d 5472 7565  d='', flush=True
-0008b000: 293b 0a20 2020 2072 6573 203d 2073 7562  );.    res = sub
-0008b010: 7072 6f63 6573 732e 6368 6563 6b5f 6f75  process.check_ou
-0008b020: 7470 7574 2863 6d64 2c20 7368 656c 6c3d  tput(cmd, shell=
-0008b030: 5472 7565 290a 2020 2020 2320 7072 696e  True).    # prin
-0008b040: 7428 7265 732e 6465 636f 6465 2827 7769  t(res.decode('wi
-0008b050: 6e64 6f77 732d 3132 3532 2729 290a 2020  ndows-1252')).  
-0008b060: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
-0008b070: 696e 7428 2764 6f6e 652e 2729 0a20 2020  int('done.').   
-0008b080: 200a 2020 2020 6f73 2e72 656d 6f76 6528   .    os.remove(
-0008b090: 2027 2573 2e25 7368 7227 2025 2028 696e   '%s.%shr' % (in
-0008b0a0: 7074 5f74 722c 2070 7266 7829 2029 0a20  pt_tr, prfx) ). 
-0008b0b0: 2020 206f 732e 7265 6d6f 7665 2820 2725     os.remove( '%
-0008b0c0: 732e 2573 696e 2720 2520 2869 6e70 745f  s.%sin' % (inpt_
-0008b0d0: 7472 2c20 7072 6678 2920 290a 2020 2020  tr, prfx) ).    
-0008b0e0: 6f73 2e72 656d 6f76 6528 2027 2573 2e25  os.remove( '%s.%
-0008b0f0: 7373 7127 2025 2028 696e 7074 5f74 722c  ssq' % (inpt_tr,
-0008b100: 2070 7266 7829 2029 0a20 2020 0a20 2020   prfx) ).   .   
-0008b110: 2063 6f6c 6e61 6d65 7320 3d20 5b27 7169   colnames = ['qi
-0008b120: 6427 2c20 2773 6964 272c 2027 716c 656e  d', 'sid', 'qlen
-0008b130: 272c 2027 616c 656e 272c 2027 736c 656e  ', 'alen', 'slen
-0008b140: 272c 2027 7173 7461 7274 272c 2027 7165  ', 'qstart', 'qe
-0008b150: 6e64 272c 2027 7373 7461 7274 272c 2027  nd', 'sstart', '
-0008b160: 7365 6e64 272c 205c 0a20 2020 2020 2020  send', \.       
-0008b170: 2020 2020 2020 2020 2027 6e69 6465 6e74           'nident
-0008b180: 272c 2027 6d69 736d 6174 6368 272c 2027  ', 'mismatch', '
-0008b190: 6761 706f 7065 6e27 2c20 2771 636f 7673  gapopen', 'qcovs
-0008b1a0: 272c 2027 7163 6f76 6873 7027 2c20 2762  ', 'qcovhsp', 'b
-0008b1b0: 6974 7363 6f72 6527 5d0a 2020 2020 7462  itscore'].    tb
-0008b1c0: 6c73 7420 3d20 2725 732e 7462 6c73 7427  lst = '%s.tblst'
-0008b1d0: 2025 2066 6e61 6d65 0a20 2020 2064 6620   % fname.    df 
-0008b1e0: 3d20 7064 2e72 6561 645f 6373 7628 7462  = pd.read_csv(tb
-0008b1f0: 6c73 742c 2068 6561 6465 7220 3d20 2769  lst, header = 'i
-0008b200: 6e66 6572 272c 206e 616d 6573 203d 2063  nfer', names = c
-0008b210: 6f6c 6e61 6d65 732c 2073 6570 3d27 5c74  olnames, sep='\t
-0008b220: 2729 0a20 2020 200a 2020 2020 6f73 2e72  ').    .    os.r
-0008b230: 656d 6f76 6528 2027 2573 2720 2520 2874  emove( '%s' % (t
-0008b240: 626c 7374 2920 290a 2020 2020 0a20 2020  blst) ).    .   
-0008b250: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
-0008b260: 6e74 2827 4e2e 6361 6e64 3a20 2569 2c20  nt('N.cand: %i, 
-0008b270: 4e2e 7375 626a 6563 742e 756e 6971 7565  N.subject.unique
-0008b280: 3a20 2569 2720 2520 286c 656e 2874 6e29  : %i' % (len(tn)
-0008b290: 2c20 6c65 6e28 7064 2e75 6e69 7175 6528  , len(pd.unique(
-0008b2a0: 6466 5b27 7369 6427 5d29 2929 2029 0a0a  df['sid']))) )..
-0008b2b0: 2020 2020 6466 5b27 7363 7667 275d 203d      df['scvg'] =
-0008b2c0: 2064 665b 2761 6c65 6e27 5d2f 6466 5b27   df['alen']/df['
-0008b2d0: 736c 656e 275d 0a20 2020 2064 665b 2771  slen'].    df['q
-0008b2e0: 6376 6727 5d20 3d20 6466 5b27 616c 656e  cvg'] = df['alen
-0008b2f0: 275d 2f64 665b 2771 6c65 6e27 5d0a 2020  ']/df['qlen'].  
-0008b300: 2020 2020 2020 0a20 2020 2069 6620 7472        .    if tr
-0008b310: 6172 6563 6f20 3d3d 2054 7275 653a 0a20  areco == True:. 
-0008b320: 2020 2020 2020 2061 626e 5f65 203d 205b         abn_e = [
-0008b330: 5d0a 2020 2020 2020 2020 7470 6d5f 6520  ].        tpm_e 
-0008b340: 3d20 5b5d 0a20 2020 2020 2020 2069 6672  = [].        ifr
-0008b350: 6163 203d 205b 5d0a 2020 2020 2020 2020  ac = [].        
-0008b360: 7369 6478 203d 205b 5d0a 2020 2020 2020  sidx = [].      
-0008b370: 2020 675f 7369 7a65 203d 205b 5d0a 2020    g_size = [].  
-0008b380: 2020 2020 2020 6e5f 6578 6f6e 7320 3d20        n_exons = 
-0008b390: 5b5d 0a20 2020 2020 2020 2067 5f76 6f6c  [].        g_vol
-0008b3a0: 203d 205b 5d0a 2020 2020 2020 2020 6963   = [].        ic
-0008b3b0: 6e74 203d 205b 5d0a 2020 2020 2020 2020  nt = [].        
-0008b3c0: 7374 726e 6420 3d20 5b5d 0a20 2020 2020  strnd = [].     
-0008b3d0: 2020 2063 646e 6720 3d20 5b5d 0a20 2020     cdng = [].   
-0008b3e0: 2020 2020 2066 6f72 206b 2069 6e20 7261       for k in ra
-0008b3f0: 6e67 6528 6466 2e73 6861 7065 5b30 5d29  nge(df.shape[0])
-0008b400: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0008b410: 7320 3d20 273e 2573 5f43 6872 2573 3a25  s = '>%s_Chr%s:%
-0008b420: 692d 2569 5f25 695f 2569 5f25 695f 4162  i-%i_%i_%i_%i_Ab
-0008b430: 6e3a 2534 2e33 665f 5450 4d3a 2534 2e32  n:%4.3f_TPM:%4.2
-0008b440: 665f 4946 7261 633a 2533 2e32 665c 6e27  f_IFrac:%3.2f\n'
-0008b450: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
-0008b460: 2520 2874 722e 7072 6566 6978 2c20 7472  % (tr.prefix, tr
-0008b470: 2e63 6872 2c20 7472 2e73 7461 7274 2c20  .chr, tr.start, 
-0008b480: 7472 2e65 6e64 2c20 7472 2e67 6964 782c  tr.end, tr.gidx,
-0008b490: 2074 722e 6772 705f 7369 7a65 2c20 7472   tr.grp_size, tr
-0008b4a0: 2e69 636e 742c 2074 722e 6162 6e2c 2074  .icnt, tr.abn, t
-0008b4b0: 722e 7470 6d2c 2074 722e 6973 6f5f 6672  r.tpm, tr.iso_fr
-0008b4c0: 6163 290a 2020 2020 2020 2020 2020 2020  ac).            
-0008b4d0: 6864 7220 3d20 6466 5b73 5f69 645d 5b6b  hdr = df[s_id][k
-0008b4e0: 5d2e 7370 6c69 7428 2720 2729 0a20 2020  ].split(' ').   
-0008b4f0: 2020 2020 2020 2020 2069 7465 6d73 203d           items =
-0008b500: 2068 6472 5b30 5d2e 7370 6c69 7428 275f   hdr[0].split('_
-0008b510: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
-0008b520: 7472 6e64 2e61 7070 656e 6428 2069 7465  trnd.append( ite
-0008b530: 6d73 5b32 5d29 0a20 2020 2020 2020 2020  ms[2]).         
-0008b540: 2020 2063 646e 672e 6170 7065 6e64 2820     cdng.append( 
-0008b550: 6974 656d 735b 335d 290a 2020 2020 2020  items[3]).      
-0008b560: 2020 2020 2020 7369 6478 2e61 7070 656e        sidx.appen
-0008b570: 6428 2028 6974 656d 735b 345d 2920 290a  d( (items[4]) ).
-0008b580: 2020 2020 2020 2020 2020 2020 675f 7369              g_si
-0008b590: 7a65 2e61 7070 656e 6428 2069 6e74 2869  ze.append( int(i
-0008b5a0: 7465 6d73 5b35 5d29 2029 0a20 2020 2020  tems[5]) ).     
-0008b5b0: 2020 2020 2020 2069 636e 742e 6170 7065         icnt.appe
-0008b5c0: 6e64 2820 696e 7428 6974 656d 735b 365d  nd( int(items[6]
-0008b5d0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0008b5e0: 7661 6c20 3d20 6974 656d 735b 375d 2e73  val = items[7].s
-0008b5f0: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-0008b600: 2020 2020 2020 6162 6e5f 652e 6170 7065        abn_e.appe
-0008b610: 6e64 2820 666c 6f61 7428 7661 6c5b 315d  nd( float(val[1]
-0008b620: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0008b630: 7661 6c20 3d20 6974 656d 735b 385d 2e73  val = items[8].s
-0008b640: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-0008b650: 2020 2020 2020 7470 6d5f 652e 6170 7065        tpm_e.appe
-0008b660: 6e64 2820 666c 6f61 7428 7661 6c5b 315d  nd( float(val[1]
-0008b670: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0008b680: 7661 6c20 3d20 6974 656d 735b 395d 2e73  val = items[9].s
-0008b690: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-0008b6a0: 2020 2020 2020 6966 7261 632e 6170 7065        ifrac.appe
-0008b6b0: 6e64 2820 666c 6f61 7428 7661 6c5b 315d  nd( float(val[1]
-0008b6c0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0008b6d0: 7661 6c20 3d20 6974 656d 735b 3131 5d2e  val = items[11].
-0008b6e0: 7370 6c69 7428 273a 2729 0a20 2020 2020  split(':').     
-0008b6f0: 2020 2020 2020 206e 5f65 786f 6e73 2e61         n_exons.a
-0008b700: 7070 656e 6428 2069 6e74 2876 616c 5b31  ppend( int(val[1
-0008b710: 5d29 2029 0a20 2020 2020 2020 2020 2020  ]) ).           
-0008b720: 2076 616c 203d 2069 7465 6d73 5b31 325d   val = items[12]
-0008b730: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0008b740: 2020 2020 2020 2020 675f 766f 6c2e 6170          g_vol.ap
-0008b750: 7065 6e64 2820 696e 7428 7661 6c5b 315d  pend( int(val[1]
-0008b760: 2920 290a 2020 2020 656c 7365 3a0a 2020  ) ).    else:.  
-0008b770: 2020 2020 2020 6162 6e5f 6520 3d20 6e70        abn_e = np
-0008b780: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
-0008b790: 305d 290a 2020 2020 2020 2020 7470 6d5f  0]).        tpm_
-0008b7a0: 6520 3d20 6e70 2e7a 6572 6f73 2864 662e  e = np.zeros(df.
-0008b7b0: 7368 6170 655b 305d 290a 2020 2020 2020  shape[0]).      
-0008b7c0: 2020 6966 7261 6320 3d20 6e70 2e7a 6572    ifrac = np.zer
-0008b7d0: 6f73 2864 662e 7368 6170 655b 305d 290a  os(df.shape[0]).
-0008b7e0: 2020 2020 2020 2020 7369 6478 203d 206e          sidx = n
-0008b7f0: 702e 6675 6c6c 2864 662e 7368 6170 655b  p.full(df.shape[
-0008b800: 305d 2c20 2727 290a 2020 2020 2020 2020  0], '').        
-0008b810: 675f 7369 7a65 203d 206e 702e 7a65 726f  g_size = np.zero
-0008b820: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
-0008b830: 2020 2020 2020 206e 5f65 786f 6e73 203d         n_exons =
-0008b840: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
-0008b850: 7065 5b30 5d29 0a20 2020 2020 2020 2067  pe[0]).        g
-0008b860: 5f76 6f6c 203d 206e 702e 7a65 726f 7328  _vol = np.zeros(
-0008b870: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
-0008b880: 2020 2020 2069 636e 7420 3d20 6e70 2e7a       icnt = np.z
-0008b890: 6572 6f73 2864 662e 7368 6170 655b 305d  eros(df.shape[0]
-0008b8a0: 290a 2020 2020 2020 2020 7374 726e 6420  ).        strnd 
-0008b8b0: 3d20 6e70 2e7a 6572 6f73 2864 662e 7368  = np.zeros(df.sh
-0008b8c0: 6170 655b 305d 290a 2020 2020 2020 2020  ape[0]).        
-0008b8d0: 6364 6e67 203d 206e 702e 7a65 726f 7328  cdng = np.zeros(
-0008b8e0: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
-0008b8f0: 2020 2020 200a 2020 2020 2327 2727 0a20       .    #'''. 
-0008b900: 2020 2072 6566 5f69 6e66 6f20 3d20 4661     ref_info = Fa
-0008b910: 6c73 650a 2020 2020 6966 206c 656e 2864  lse.    if len(d
-0008b920: 665b 715f 6964 5d5b 305d 2e73 706c 6974  f[q_id][0].split
-0008b930: 2827 3a27 2929 203d 3d20 343a 200a 2020  (':')) == 4: .  
-0008b940: 2020 2020 2020 7265 665f 696e 666f 203d        ref_info =
-0008b950: 2054 7275 650a 2020 2020 2020 2020 2320   True.        # 
-0008b960: 7072 696e 7428 2752 6566 5f69 6e66 6f20  print('Ref_info 
-0008b970: 6973 2074 7275 6527 290a 2020 2020 2020  is true').      
-0008b980: 2020 0a20 2020 2069 6620 7265 665f 696e    .    if ref_in
-0008b990: 666f 203d 3d20 5472 7565 3a0a 2020 2020  fo == True:.    
-0008b9a0: 2020 2020 6769 6420 3d20 5b5d 0a20 2020      gid = [].   
-0008b9b0: 2020 2020 2063 7667 203d 205b 5d0a 2020       cvg = [].  
-0008b9c0: 2020 2020 2020 6162 6e5f 7420 3d20 5b5d        abn_t = []
-0008b9d0: 0a20 2020 2020 2020 2074 706d 5f74 203d  .        tpm_t =
-0008b9e0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-0008b9f0: 6b20 696e 2072 616e 6765 2864 662e 7368  k in range(df.sh
-0008ba00: 6170 655b 305d 293a 0a20 2020 2020 2020  ape[0]):.       
-0008ba10: 2020 2020 2069 7465 6d73 203d 2064 665b       items = df[
-0008ba20: 715f 6964 5d5b 6b5d 2e73 706c 6974 2827  q_id][k].split('
-0008ba30: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
-0008ba40: 6769 642e 6170 7065 6e64 2820 6974 656d  gid.append( item
-0008ba50: 735b 305d 2029 0a20 2020 2020 2020 2020  s[0] ).         
-0008ba60: 2020 2063 7667 2e61 7070 656e 6428 2066     cvg.append( f
-0008ba70: 6c6f 6174 2869 7465 6d73 5b31 5d29 2029  loat(items[1]) )
-0008ba80: 0a20 2020 2020 2020 2020 2020 2061 626e  .            abn
-0008ba90: 5f74 2e61 7070 656e 6428 2066 6c6f 6174  _t.append( float
-0008baa0: 2869 7465 6d73 5b32 5d29 2029 0a20 2020  (items[2]) ).   
-0008bab0: 2020 2020 2020 2020 2074 706d 5f74 2e61           tpm_t.a
-0008bac0: 7070 656e 6428 2066 6c6f 6174 2869 7465  ppend( float(ite
-0008bad0: 6d73 5b33 5d29 2029 0a20 2020 2065 6c73  ms[3]) ).    els
-0008bae0: 653a 0a20 2020 2020 2020 2067 6964 203d  e:.        gid =
-0008baf0: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
-0008bb00: 7065 5b30 5d29 0a20 2020 2020 2020 2063  pe[0]).        c
-0008bb10: 7667 203d 206e 702e 7a65 726f 7328 6466  vg = np.zeros(df
-0008bb20: 2e73 6861 7065 5b30 5d29 0a20 2020 2020  .shape[0]).     
-0008bb30: 2020 2061 626e 5f74 203d 206e 702e 7a65     abn_t = np.ze
-0008bb40: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
-0008bb50: 0a20 2020 2020 2020 2074 706d 5f74 203d  .        tpm_t =
-0008bb60: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
-0008bb70: 7065 5b30 5d29 0a0a 2020 2020 2327 2727  pe[0])..    #'''
-0008bb80: 0a20 2020 2064 665b 2765 7870 5f63 7667  .    df['exp_cvg
-0008bb90: 275d 203d 2063 7667 0a20 2020 2064 665b  '] = cvg.    df[
-0008bba0: 2761 626e 5f74 7275 6527 5d20 3d20 6162  'abn_true'] = ab
-0008bbb0: 6e5f 740a 2020 2020 6466 5b27 6162 6e5f  n_t.    df['abn_
-0008bbc0: 6573 7427 5d20 3d20 6162 6e5f 650a 2020  est'] = abn_e.  
-0008bbd0: 2020 6466 5b27 7470 6d5f 7472 7565 275d    df['tpm_true']
-0008bbe0: 203d 2074 706d 5f74 0a20 2020 2064 665b   = tpm_t.    df[
-0008bbf0: 2774 706d 5f65 7374 275d 203d 2074 706d  'tpm_est'] = tpm
-0008bc00: 5f65 0a20 2020 2064 665b 2767 6964 7827  _e.    df['gidx'
-0008bc10: 5d20 3d20 7369 6478 0a20 2020 2064 665b  ] = sidx.    df[
-0008bc20: 2769 6964 7827 5d20 3d20 6963 6e74 0a20  'iidx'] = icnt. 
-0008bc30: 2020 2064 665b 2767 5f73 697a 6527 5d20     df['g_size'] 
-0008bc40: 3d20 675f 7369 7a65 0a20 2020 2064 665b  = g_size.    df[
-0008bc50: 2769 736f 5f66 7261 6327 5d20 3d20 6966  'iso_frac'] = if
-0008bc60: 7261 630a 2020 2020 6466 5b27 6e5f 6578  rac.    df['n_ex
-0008bc70: 6f6e 7327 5d20 3d20 6e5f 6578 6f6e 730a  ons'] = n_exons.
-0008bc80: 2020 2020 6466 5b27 675f 766f 6c27 5d20      df['g_vol'] 
-0008bc90: 3d20 675f 766f 6c0a 2020 2020 6466 5b27  = g_vol.    df['
-0008bca0: 7374 7261 6e64 275d 203d 2073 7472 6e64  strand'] = strnd
-0008bcb0: 0a20 2020 2064 665b 2743 5f6f 725f 4e27  .    df['C_or_N'
-0008bcc0: 5d20 3d20 6364 6e67 0a20 2020 2020 2020  ] = cdng.       
-0008bcd0: 200a 2020 2020 6220 3d20 6466 5b71 5f63   .    b = df[q_c
-0008bce0: 7667 5d20 3e3d 2030 2e38 0a20 2020 2064  vg] >= 0.8.    d
-0008bcf0: 665f 6e65 7720 3d20 6466 2e6c 6f63 5b62  f_new = df.loc[b
-0008bd00: 2c3a 5d0a 2020 2020 6466 203d 2064 665f  ,:].    df = df_
-0008bd10: 6e65 770a 2020 2020 0a20 2020 2066 756c  new.    .    ful
-0008bd20: 6c5f 6e61 6d65 7320 3d20 6466 5b71 5f69  l_names = df[q_i
-0008bd30: 645d 202b 2064 665b 735f 6964 5d0a 2020  d] + df[s_id].  
-0008bd40: 2020 666e 7320 3d20 7064 2e75 6e69 7175    fns = pd.uniqu
-0008bd50: 6528 6675 6c6c 5f6e 616d 6573 290a 2020  e(full_names).  
-0008bd60: 2020 6b20 3d20 300a 2020 2020 6466 5f6c    k = 0.    df_l
-0008bd70: 7374 203d 205b 5d0a 2020 2020 666f 7220  st = [].    for 
-0008bd80: 666e 2069 6e20 666e 733a 0a20 2020 2020  fn in fns:.     
-0008bd90: 2020 2077 6820 3d20 7768 6963 6828 6675     wh = which(fu
-0008bda0: 6c6c 5f6e 616d 6573 203d 3d20 666e 290a  ll_names == fn).
-0008bdb0: 2020 2020 2020 2020 6466 5f74 6d70 203d          df_tmp =
-0008bdc0: 2064 662e 696c 6f63 5b77 685d 0a20 2020   df.iloc[wh].   
-0008bdd0: 2020 2020 2071 6376 6720 3d20 6e70 2e61       qcvg = np.a
-0008bde0: 7272 6179 2820 6466 5f74 6d70 5b71 5f63  rray( df_tmp[q_c
-0008bdf0: 7667 5d20 290a 2020 2020 2020 2020 6f64  vg] ).        od
-0008be00: 7220 3d20 7163 7667 2e61 7267 736f 7274  r = qcvg.argsort
-0008be10: 2829 0a20 2020 2020 2020 2064 665f 6c73  ().        df_ls
-0008be20: 742e 6170 7065 6e64 2864 665f 746d 702e  t.append(df_tmp.
-0008be30: 696c 6f63 5b6f 6472 5b2d 315d 5d29 200a  iloc[odr[-1]]) .
-0008be40: 2020 2020 2020 2020 6b20 2b3d 2031 0a0a          k += 1..
-0008be50: 2020 2020 6966 206c 656e 2864 665f 6c73      if len(df_ls
-0008be60: 7429 203e 2030 3a0a 2020 2020 2020 2020  t) > 0:.        
-0008be70: 6466 5f73 656c 203d 2070 642e 4461 7461  df_sel = pd.Data
-0008be80: 4672 616d 6528 6466 5f6c 7374 290a 2020  Frame(df_lst).  
-0008be90: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
-0008bea0: 2020 2074 7269 6e66 6f20 3d20 2725 735f     trinfo = '%s_
-0008beb0: 626c 6173 745f 7265 7375 6c74 2e74 7376  blast_result.tsv
-0008bec0: 2720 2520 666e 616d 650a 2020 2020 2020  ' % fname.      
-0008bed0: 2020 6466 5f73 656c 2e74 6f5f 6373 7628    df_sel.to_csv(
-0008bee0: 7472 696e 666f 2c20 6865 6164 6572 3d54  trinfo, header=T
-0008bef0: 7275 652c 2069 6e64 6578 3d46 616c 7365  rue, index=False
-0008bf00: 2c20 7365 703d 275c 7427 290a 2020 2020  , sep='\t').    
-0008bf10: 2020 2020 2320 6966 2076 6572 626f 7365      # if verbose
-0008bf20: 3a20 7072 696e 7428 2754 7261 6e73 6372  : print('Transcr
-0008bf30: 6970 746f 6d65 2049 6e66 6f2e 2077 7269  iptome Info. wri
-0008bf40: 7474 656e 2074 6f20 5c6e 2020 2025 732e  tten to \n   %s.
-0008bf50: 2720 2520 7472 696e 666f 2029 0a0a 2020  ' % trinfo )..  
-0008bf60: 2020 2020 2020 6466 5f73 656c 203d 2070        df_sel = p
-0008bf70: 642e 7265 6164 5f63 7376 2874 7269 6e66  d.read_csv(trinf
-0008bf80: 6f2c 2073 6570 3d27 5c74 2729 0a20 2020  o, sep='\t').   
-0008bf90: 2020 2020 2023 2727 270a 0a20 2020 2020       #'''..     
-0008bfa0: 2020 2064 665f 7065 7266 2c20 6466 5f73     df_perf, df_s
-0008bfb0: 656c 203d 2067 6574 5f70 6572 666f 726d  el = get_perform
-0008bfc0: 616e 6365 2864 665f 7365 6c2c 2066 5f74  ance(df_sel, f_t
-0008bfd0: 6f5f 7361 7665 3d66 6e61 6d65 2c20 7265  o_save=fname, re
-0008bfe0: 6620 3d20 7265 662c 2076 6572 626f 7365  f = ref, verbose
-0008bff0: 3d76 6572 626f 7365 290a 2020 2020 2020  =verbose).      
-0008c000: 2020 6466 5f70 6572 665b 2770 7265 6369    df_perf['preci
-0008c010: 7369 6f6e 275d 203d 2072 6f75 6e64 2864  sion'] = round(d
-0008c020: 665f 7065 7266 5b27 4e5f 7265 636f 7665  f_perf['N_recove
-0008c030: 7265 6427 5d2a 3130 302f 6361 6e64 5f63  red']*100/cand_c
-0008c040: 6e74 2c31 290a 2020 2020 2020 2020 6466  nt,1).        df
-0008c050: 5f70 6572 665b 2773 656e 7369 7469 7669  _perf['sensitivi
-0008c060: 7479 275d 203d 2072 6f75 6e64 2864 665f  ty'] = round(df_
-0008c070: 7065 7266 5b27 4e5f 7265 636f 7665 7265  perf['N_recovere
-0008c080: 6427 5d2a 3130 302f 7265 665f 636e 742c  d']*100/ref_cnt,
-0008c090: 3129 0a20 2020 2020 2020 2023 2069 6620  1).        # if 
-0008c0a0: 7665 7262 6f73 653a 2070 7269 6e74 2864  verbose: print(d
-0008c0b0: 665f 7065 7266 290a 2020 2020 2020 2020  f_perf).        
-0008c0c0: 2020 200a 2020 2020 2020 2020 6966 2074     .        if t
-0008c0d0: 7261 7265 636f 203d 3d20 5472 7565 3a0a  rareco == True:.
-0008c0e0: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
-0008c0f0: 7220 3d20 6765 745f 696e 666f 5f66 726f  r = get_info_fro
-0008c100: 6d5f 7472 5f6e 616d 6528 2074 6e20 290a  m_tr_name( tn ).
-0008c110: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
-0008c120: 725b 2764 6574 6563 7465 6427 5d20 3d20  r['detected'] = 
-0008c130: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0008c140: 2020 6466 5f74 722e 6c6f 635b 6c69 7374    df_tr.loc[list
-0008c150: 2864 665f 7365 6c5b 735f 6964 5d29 2c27  (df_sel[s_id]),'
-0008c160: 6465 7465 6374 6564 275d 203d 2054 7275  detected'] = Tru
-0008c170: 6520 0a20 2020 2020 2020 2020 2020 2064  e .            d
-0008c180: 665f 7472 5b71 5f6c 656e 5d20 3d20 300a  f_tr[q_len] = 0.
-0008c190: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0008c1a0: 6d2c 2073 6964 2069 6e20 656e 756d 6572  m, sid in enumer
-0008c1b0: 6174 6528 6466 5f73 656c 5b73 5f69 645d  ate(df_sel[s_id]
-0008c1c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0008c1d0: 2020 2064 665f 7472 2e6c 6f63 5b73 6964     df_tr.loc[sid
-0008c1e0: 2c71 5f6c 656e 5d20 3d20 6e70 2e72 6f75  ,q_len] = np.rou
-0008c1f0: 6e64 2864 665f 7365 6c2e 696c 6f63 5b6d  nd(df_sel.iloc[m
-0008c200: 5d2e 716c 656e 290a 2020 2020 2020 2020  ].qlen).        
-0008c210: 2020 2020 6466 5f74 725b 735f 7374 6172      df_tr[s_star
-0008c220: 745d 203d 2030 0a20 2020 2020 2020 2020  t] = 0.         
-0008c230: 2020 2023 2064 665f 7472 2e6c 6f63 5b6c     # df_tr.loc[l
-0008c240: 6973 7428 6466 5f73 656c 5b27 7369 6427  ist(df_sel['sid'
-0008c250: 5d29 2c27 7363 7667 275d 203d 2064 665f  ]),'scvg'] = df_
-0008c260: 7365 6c2e 6c6f 635b 3a2c 2773 6376 6727  sel.loc[:,'scvg'
-0008c270: 5d20 0a20 2020 2020 2020 2020 2020 2066  ] .            f
-0008c280: 6f72 206d 2c20 7369 6420 696e 2065 6e75  or m, sid in enu
-0008c290: 6d65 7261 7465 2864 665f 7365 6c5b 735f  merate(df_sel[s_
-0008c2a0: 6964 5d29 3a0a 2020 2020 2020 2020 2020  id]):.          
-0008c2b0: 2020 2020 2020 6466 5f74 722e 6c6f 635b        df_tr.loc[
-0008c2c0: 7369 642c 735f 7374 6172 745d 203d 206e  sid,s_start] = n
-0008c2d0: 702e 726f 756e 6428 6466 5f73 656c 2e69  p.round(df_sel.i
-0008c2e0: 6c6f 635b 6d5d 2e73 7374 6172 7429 0a20  loc[m].sstart). 
-0008c2f0: 2020 2020 2020 2020 2020 2064 665f 7472             df_tr
-0008c300: 5b73 5f65 6e64 5d20 3d20 300a 2020 2020  [s_end] = 0.    
-0008c310: 2020 2020 2020 2020 2320 6466 5f74 722e          # df_tr.
-0008c320: 6c6f 635b 6c69 7374 2864 665f 7365 6c5b  loc[list(df_sel[
-0008c330: 2773 6964 275d 292c 2773 6376 6727 5d20  'sid']),'scvg'] 
-0008c340: 3d20 6466 5f73 656c 2e6c 6f63 5b3a 2c27  = df_sel.loc[:,'
-0008c350: 7363 7667 275d 200a 2020 2020 2020 2020  scvg'] .        
-0008c360: 2020 2020 666f 7220 6d2c 2073 6964 2069      for m, sid i
-0008c370: 6e20 656e 756d 6572 6174 6528 6466 5f73  n enumerate(df_s
-0008c380: 656c 5b73 5f69 645d 293a 0a20 2020 2020  el[s_id]):.     
-0008c390: 2020 2020 2020 2020 2020 2064 665f 7472             df_tr
-0008c3a0: 2e6c 6f63 5b73 6964 2c73 5f65 6e64 5d20  .loc[sid,s_end] 
-0008c3b0: 3d20 6e70 2e72 6f75 6e64 2864 665f 7365  = np.round(df_se
-0008c3c0: 6c2e 696c 6f63 5b6d 5d2e 7365 6e64 290a  l.iloc[m].send).
-0008c3d0: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
-0008c3e0: 7220 3d20 6466 5f74 722e 7265 7365 745f  r = df_tr.reset_
-0008c3f0: 696e 6465 7828 290a 2020 2020 2020 2020  index().        
-0008c400: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0008c410: 2020 6466 5f74 7220 3d20 4e6f 6e65 0a20    df_tr = None. 
-0008c420: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0008c430: 2020 2020 7265 7475 726e 2864 665f 7065      return(df_pe
-0008c440: 7266 2c20 6466 5f73 656c 2c20 6466 5f74  rf, df_sel, df_t
-0008c450: 7229 0a20 2020 200a 2020 2020 656c 7365  r).    .    else
-0008c460: 3a0a 2020 2020 2020 2020 6966 2076 6572  :.        if ver
-0008c470: 626f 7365 3a20 7072 696e 7428 274e 6f20  bose: print('No 
-0008c480: 7472 2066 6f75 6e64 2e20 2729 0a20 2020  tr found. ').   
-0008c490: 2020 2020 2072 6574 7572 6e28 4e6f 6e65       return(None
-0008c4a0: 2c4e 6f6e 652c 4e6f 6e65 290a 2020 2020  ,None,None).    
-0008c4b0: 0a0a 2323 2323 2323 2323 2323 2323 2323  ..##############
-0008c4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c4d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c500: 2323 2323 0a23 2320 4675 6e63 7469 6f6e  ####.## Function
-0008c510: 7320 746f 2028 3129 2073 656c 6563 7420  s to (1) select 
-0008c520: 7370 6563 6966 6963 2063 6872 6d20 616e  specific chrm an
-0008c530: 6420 2832 2920 6f6e 6c79 2063 6f64 696e  d (2) only codin
-0008c540: 6720 6765 6e65 7320 696e 2061 2047 5446  g genes in a GTF
-0008c550: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-0008c560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089820: 2323 2323 2323 0a23 2320 5374 7269 6e67  ######.## String
+00089830: 4669 782d 6164 646f 6e20 2020 2020 2020  Fix-addon       
+00089840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089880: 2020 2020 2020 2023 230a 2323 2064 6576         ##.## dev
+00089890: 656c 6f70 6564 2062 7920 5365 6f6b 6879  eloped by Seokhy
+000898a0: 756e 2059 6f6f 6e20 2873 796f 6f6e 4064  un Yoon (syoon@d
+000898b0: 6b75 2e65 6475 2920 4f63 742e 2030 342c  ku.edu) Oct. 04,
+000898c0: 2032 3032 3020 2020 2323 0a23 2323 2323   2020   ##.#####
+000898d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000898e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000898f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089900: 2323 2323 0a0a 6465 6620 7768 6963 6828  ####..def which(
+00089910: 2061 692c 2076 616c 7565 203d 2054 7275   ai, value = Tru
+00089920: 6520 2920 3a0a 2020 2020 7768 203d 205b  e ) :.    wh = [
+00089930: 5d0a 2020 2020 6120 3d20 6c69 7374 2861  ].    a = list(a
+00089940: 6929 0a20 2020 2066 6f72 206b 2069 6e20  i).    for k in 
+00089950: 7261 6e67 6528 6c65 6e28 6129 293a 200a  range(len(a)): .
+00089960: 2020 2020 2020 2020 6966 2061 5b6b 5d20          if a[k] 
+00089970: 3d3d 2076 616c 7565 3a20 0a20 2020 2020  == value: .     
+00089980: 2020 2020 2020 2077 682e 6170 7065 6e64         wh.append
+00089990: 286b 2920 0a20 2020 2072 6574 7572 6e28  (k) .    return(
+000899a0: 7768 290a 0a64 6566 2067 6574 5f69 6e66  wh)..def get_inf
+000899b0: 6f5f 6672 6f6d 5f74 725f 6e61 6d65 2820  o_from_tr_name( 
+000899c0: 746e 7320 293a 0a20 2020 200a 2020 2020  tns ):.    .    
+000899d0: 6162 6e5f 6520 3d20 5b5d 0a20 2020 2074  abn_e = [].    t
+000899e0: 706d 5f65 203d 205b 5d0a 2020 2020 6966  pm_e = [].    if
+000899f0: 7261 6320 3d20 5b5d 0a20 2020 2073 6964  rac = [].    sid
+00089a00: 7820 3d20 5b5d 0a20 2020 2067 5f73 697a  x = [].    g_siz
+00089a10: 6520 3d20 5b5d 0a20 2020 206e 5f65 786f  e = [].    n_exo
+00089a20: 6e73 203d 205b 5d0a 2020 2020 675f 766f  ns = [].    g_vo
+00089a30: 6c20 3d20 5b5d 0a20 2020 2069 636e 7420  l = [].    icnt 
+00089a40: 3d20 5b5d 0a20 2020 2074 5f6c 656e 203d  = [].    t_len =
+00089a50: 205b 5d0a 2020 2020 7374 726e 6420 3d20   [].    strnd = 
+00089a60: 5b5d 0a20 2020 2063 646e 6720 3d20 5b5d  [].    cdng = []
+00089a70: 0a20 2020 2066 6f72 206b 2c20 746e 2069  .    for k, tn i
+00089a80: 6e20 656e 756d 6572 6174 6528 746e 7329  n enumerate(tns)
+00089a90: 3a0a 2020 2020 2020 2020 6864 7220 3d20  :.        hdr = 
+00089aa0: 746e 2e73 706c 6974 2827 2027 290a 2020  tn.split(' ').  
+00089ab0: 2020 2020 2020 6974 656d 7320 3d20 6864        items = hd
+00089ac0: 725b 305d 2e73 706c 6974 2827 5f27 290a  r[0].split('_').
+00089ad0: 2020 2020 2020 2020 7374 726e 642e 6170          strnd.ap
+00089ae0: 7065 6e64 2820 6974 656d 735b 325d 290a  pend( items[2]).
+00089af0: 2020 2020 2020 2020 6364 6e67 2e61 7070          cdng.app
+00089b00: 656e 6428 2069 7465 6d73 5b33 5d29 0a20  end( items[3]). 
+00089b10: 2020 2020 2020 2073 6964 782e 6170 7065         sidx.appe
+00089b20: 6e64 2820 2869 7465 6d73 5b34 5d29 2029  nd( (items[4]) )
+00089b30: 0a20 2020 2020 2020 2067 5f73 697a 652e  .        g_size.
+00089b40: 6170 7065 6e64 2820 696e 7428 6974 656d  append( int(item
+00089b50: 735b 355d 2920 290a 2020 2020 2020 2020  s[5]) ).        
+00089b60: 6963 6e74 2e61 7070 656e 6428 2069 6e74  icnt.append( int
+00089b70: 2869 7465 6d73 5b36 5d29 2029 0a20 2020  (items[6]) ).   
+00089b80: 2020 2020 2076 616c 203d 2069 7465 6d73       val = items
+00089b90: 5b37 5d2e 7370 6c69 7428 273a 2729 0a20  [7].split(':'). 
+00089ba0: 2020 2020 2020 2061 626e 5f65 2e61 7070         abn_e.app
+00089bb0: 656e 6428 2066 6c6f 6174 2876 616c 5b31  end( float(val[1
+00089bc0: 5d29 2029 0a20 2020 2020 2020 2076 616c  ]) ).        val
+00089bd0: 203d 2069 7465 6d73 5b38 5d2e 7370 6c69   = items[8].spli
+00089be0: 7428 273a 2729 0a20 2020 2020 2020 2074  t(':').        t
+00089bf0: 706d 5f65 2e61 7070 656e 6428 2066 6c6f  pm_e.append( flo
+00089c00: 6174 2876 616c 5b31 5d29 2029 0a20 2020  at(val[1]) ).   
+00089c10: 2020 2020 2076 616c 203d 2069 7465 6d73       val = items
+00089c20: 5b39 5d2e 7370 6c69 7428 273a 2729 0a20  [9].split(':'). 
+00089c30: 2020 2020 2020 2069 6672 6163 2e61 7070         ifrac.app
+00089c40: 656e 6428 2066 6c6f 6174 2876 616c 5b31  end( float(val[1
+00089c50: 5d29 2029 0a20 2020 2020 2020 2076 616c  ]) ).        val
+00089c60: 203d 2069 7465 6d73 5b31 315d 2e73 706c   = items[11].spl
+00089c70: 6974 2827 3a27 290a 2020 2020 2020 2020  it(':').        
+00089c80: 6e5f 6578 6f6e 732e 6170 7065 6e64 2820  n_exons.append( 
+00089c90: 696e 7428 7661 6c5b 315d 2920 290a 2020  int(val[1]) ).  
+00089ca0: 2020 2020 2020 7661 6c20 3d20 6974 656d        val = item
+00089cb0: 735b 3132 5d2e 7370 6c69 7428 273a 2729  s[12].split(':')
+00089cc0: 0a20 2020 2020 2020 2067 5f76 6f6c 2e61  .        g_vol.a
+00089cd0: 7070 656e 6428 2069 6e74 2876 616c 5b31  ppend( int(val[1
+00089ce0: 5d29 2029 0a20 2020 2020 2020 2076 616c  ]) ).        val
+00089cf0: 203d 2069 7465 6d73 5b31 335d 2e73 706c   = items[13].spl
+00089d00: 6974 2827 3a27 290a 2020 2020 2020 2020  it(':').        
+00089d10: 745f 6c65 6e2e 6170 7065 6e64 2820 696e  t_len.append( in
+00089d20: 7428 7661 6c5b 315d 2920 290a 2020 2020  t(val[1]) ).    
+00089d30: 0a20 2020 2064 6620 3d20 7064 2e44 6174  .    df = pd.Dat
+00089d40: 6146 7261 6d65 2829 0a20 2020 200a 2020  aFrame().    .  
+00089d50: 2020 6466 5b27 7472 5f6e 616d 6527 5d20    df['tr_name'] 
+00089d60: 3d20 746e 730a 2020 2020 6466 5b27 6162  = tns.    df['ab
+00089d70: 6e5f 6573 7427 5d20 3d20 6162 6e5f 650a  n_est'] = abn_e.
+00089d80: 2020 2020 6466 5b27 7470 6d5f 6573 7427      df['tpm_est'
+00089d90: 5d20 3d20 7470 6d5f 650a 2020 2020 6466  ] = tpm_e.    df
+00089da0: 5b27 6769 6478 275d 203d 2073 6964 780a  ['gidx'] = sidx.
+00089db0: 2020 2020 6466 5b27 6969 6478 275d 203d      df['iidx'] =
+00089dc0: 2069 636e 740a 2020 2020 6466 5b27 675f   icnt.    df['g_
+00089dd0: 7369 7a65 275d 203d 2067 5f73 697a 650a  size'] = g_size.
+00089de0: 2020 2020 6466 5b27 6973 6f5f 6672 6163      df['iso_frac
+00089df0: 275d 203d 2069 6672 6163 0a20 2020 2064  '] = ifrac.    d
+00089e00: 665b 276e 5f65 786f 6e73 275d 203d 206e  f['n_exons'] = n
+00089e10: 5f65 786f 6e73 0a20 2020 2064 665b 2767  _exons.    df['g
+00089e20: 5f76 6f6c 275d 203d 2067 5f76 6f6c 0a20  _vol'] = g_vol. 
+00089e30: 2020 2064 665b 276c 656e 6774 6827 5d20     df['length'] 
+00089e40: 3d20 745f 6c65 6e0a 2020 2020 6466 5b27  = t_len.    df['
+00089e50: 7374 7261 6e64 275d 203d 2073 7472 6e64  strand'] = strnd
+00089e60: 0a20 2020 2064 665b 2743 5f6f 725f 4e27  .    df['C_or_N'
+00089e70: 5d20 3d20 6364 6e67 0a20 2020 200a 2020  ] = cdng.    .  
+00089e80: 2020 6466 203d 2064 662e 7365 745f 696e    df = df.set_in
+00089e90: 6465 7828 2774 725f 6e61 6d65 2729 0a20  dex('tr_name'). 
+00089ea0: 2020 200a 2020 2020 7265 7475 726e 2064     .    return d
+00089eb0: 660a 0a64 6566 2067 6574 5f70 6572 666f  f..def get_perfo
+00089ec0: 726d 616e 6365 2874 7269 6e66 6f2c 2063  rmance(trinfo, c
+00089ed0: 7667 5f74 6820 3d20 5b38 302c 3930 2c39  vg_th = [80,90,9
+00089ee0: 355d 2c20 665f 746f 5f73 6176 6520 3d20  5], f_to_save = 
+00089ef0: 4e6f 6e65 2c20 7265 6620 3d20 302c 2076  None, ref = 0, v
+00089f00: 6572 626f 7365 203d 2046 616c 7365 293a  erbose = False):
+00089f10: 0a20 2020 200a 2020 2020 2327 2727 0a20  .    .    #'''. 
+00089f20: 2020 2069 6620 7265 6620 3d3d 2030 3a0a     if ref == 0:.
+00089f30: 2020 2020 2020 2020 715f 6376 6720 3d20          q_cvg = 
+00089f40: 2771 6376 6727 0a20 2020 2020 2020 2071  'qcvg'.        q
+00089f50: 5f6c 656e 203d 2027 716c 656e 270a 2020  _len = 'qlen'.  
+00089f60: 2020 2020 2020 715f 6964 203d 2027 7169        q_id = 'qi
+00089f70: 6427 0a20 2020 2020 2020 2073 5f73 7461  d'.        s_sta
+00089f80: 7274 203d 2027 7373 7461 7274 270a 2020  rt = 'sstart'.  
+00089f90: 2020 2020 2020 735f 656e 6420 3d20 2773        s_end = 's
+00089fa0: 656e 6427 0a20 2020 2020 2020 2073 5f69  end'.        s_i
+00089fb0: 6420 3d20 2773 6964 270a 2020 2020 656c  d = 'sid'.    el
+00089fc0: 7365 3a0a 2020 2020 2020 2020 715f 6376  se:.        q_cv
+00089fd0: 6720 3d20 2773 6376 6727 0a20 2020 2020  g = 'scvg'.     
+00089fe0: 2020 2071 5f6c 656e 203d 2027 736c 656e     q_len = 'slen
+00089ff0: 270a 2020 2020 2020 2020 715f 6964 203d  '.        q_id =
+0008a000: 2027 7369 6427 0a20 2020 2020 2020 2073   'sid'.        s
+0008a010: 5f73 7461 7274 203d 2027 7173 7461 7274  _start = 'qstart
+0008a020: 270a 2020 2020 2020 2020 735f 656e 6420  '.        s_end 
+0008a030: 3d20 2771 656e 6427 0a20 2020 2020 2020  = 'qend'.       
+0008a040: 2073 5f69 6420 3d20 2771 6964 270a 2020   s_id = 'qid'.  
+0008a050: 2020 2327 2727 0a20 2020 200a 2020 2020    #'''.    .    
+0008a060: 7169 6473 203d 2070 642e 756e 6971 7565  qids = pd.unique
+0008a070: 2874 7269 6e66 6f5b 715f 6964 5d29 0a20  (trinfo[q_id]). 
+0008a080: 2020 2073 6964 7320 3d20 7064 2e75 6e69     sids = pd.uni
+0008a090: 7175 6528 7472 696e 666f 5b73 5f69 645d  que(trinfo[s_id]
+0008a0a0: 290a 2020 2020 7767 7420 3d20 6e70 2e7a  ).    wgt = np.z
+0008a0b0: 6572 6f73 285b 6c65 6e28 7169 6473 292c  eros([len(qids),
+0008a0c0: 6c65 6e28 7369 6473 295d 290a 2020 2020  len(sids)]).    
+0008a0d0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
+0008a0e0: 7428 274d 6174 6368 696e 6720 2825 692c  t('Matching (%i,
+0008a0f0: 2569 2920 2720 2520 2877 6774 2e73 6861  %i) ' % (wgt.sha
+0008a100: 7065 292c 2065 6e64 3d27 2729 0a0a 2020  pe), end='')..  
+0008a110: 2020 7169 6478 203d 206e 702e 6675 6c6c    qidx = np.full
+0008a120: 2874 7269 6e66 6f2e 7368 6170 655b 305d  (trinfo.shape[0]
+0008a130: 2c2d 312c 6474 7970 653d 696e 7429 0a20  ,-1,dtype=int). 
+0008a140: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
+0008a150: 6528 6c65 6e28 7169 6473 2929 203a 0a20  e(len(qids)) :. 
+0008a160: 2020 2020 2020 2071 6964 203d 2071 6964         qid = qid
+0008a170: 735b 6b5d 0a20 2020 2020 2020 2077 6820  s[k].        wh 
+0008a180: 3d20 7768 6963 6828 2074 7269 6e66 6f5b  = which( trinfo[
+0008a190: 715f 6964 5d20 3d3d 2071 6964 2029 0a20  q_id] == qid ). 
+0008a1a0: 2020 2020 2020 2071 6964 785b 7768 5d20         qidx[wh] 
+0008a1b0: 3d20 6b0a 2020 2020 2020 2020 0a20 2020  = k.        .   
+0008a1c0: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
+0008a1d0: 6e74 2827 2e27 2c20 656e 643d 2727 290a  nt('.', end='').
+0008a1e0: 2020 2020 7369 6478 203d 206e 702e 6675      sidx = np.fu
+0008a1f0: 6c6c 2874 7269 6e66 6f2e 7368 6170 655b  ll(trinfo.shape[
+0008a200: 305d 2c2d 312c 6474 7970 653d 696e 7429  0],-1,dtype=int)
+0008a210: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
+0008a220: 6e67 6528 6c65 6e28 7369 6473 2929 203a  nge(len(sids)) :
+0008a230: 0a20 2020 2020 2020 2073 6964 203d 2073  .        sid = s
+0008a240: 6964 735b 6b5d 0a20 2020 2020 2020 2077  ids[k].        w
+0008a250: 6820 3d20 7768 6963 6828 2074 7269 6e66  h = which( trinf
+0008a260: 6f5b 735f 6964 5d20 3d3d 2073 6964 2029  o[s_id] == sid )
+0008a270: 0a20 2020 2020 2020 2073 6964 785b 7768  .        sidx[wh
+0008a280: 5d20 3d20 6b0a 2020 2020 2020 2020 0a20  ] = k.        . 
+0008a290: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
+0008a2a0: 7269 6e74 2827 2e27 2c20 656e 643d 2727  rint('.', end=''
+0008a2b0: 290a 2020 2020 666f 7220 7720 696e 2072  ).    for w in r
+0008a2c0: 616e 6765 286c 656e 2871 6964 7829 293a  ange(len(qidx)):
+0008a2d0: 0a20 2020 2020 2020 2077 6774 5b69 6e74  .        wgt[int
+0008a2e0: 2871 6964 785b 775d 292c 2069 6e74 2873  (qidx[w]), int(s
+0008a2f0: 6964 785b 775d 295d 203d 202d 7472 696e  idx[w])] = -trin
+0008a300: 666f 5b71 5f63 7667 5d5b 775d 0a0a 2020  fo[q_cvg][w]..  
+0008a310: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
+0008a320: 696e 7428 275f 272c 2065 6e64 3d27 2729  int('_', end='')
+0008a330: 0a20 2020 2023 2070 7269 6e74 2877 6774  .    # print(wgt
+0008a340: 2e73 6861 7065 290a 2020 2020 726f 775f  .shape).    row_
+0008a350: 6964 782c 2063 6f6c 5f69 6478 203d 206f  idx, col_idx = o
+0008a360: 7074 696d 697a 652e 6c69 6e65 6172 5f73  ptimize.linear_s
+0008a370: 756d 5f61 7373 6967 6e6d 656e 7428 7767  um_assignment(wg
+0008a380: 7429 0a20 2020 200a 2020 2020 6966 2076  t).    .    if v
+0008a390: 6572 626f 7365 3a20 7072 696e 7428 272e  erbose: print('.
+0008a3a0: 272c 2065 6e64 3d27 2729 0a20 2020 2064  ', end='').    d
+0008a3b0: 665f 6c73 7420 3d20 5b5d 0a20 2020 2066  f_lst = [].    f
+0008a3c0: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
+0008a3d0: 6e28 636f 6c5f 6964 7829 2920 3a0a 2020  n(col_idx)) :.  
+0008a3e0: 2020 2020 2020 7369 203d 2063 6f6c 5f69        si = col_i
+0008a3f0: 6478 5b6b 5d0a 2020 2020 2020 2020 7768  dx[k].        wh
+0008a400: 203d 2077 6869 6368 2873 6964 7820 3d3d   = which(sidx ==
+0008a410: 2073 6929 0a20 2020 2020 2020 2077 203d   si).        w =
+0008a420: 2077 6869 6368 2820 7169 6478 5b77 685d   which( qidx[wh]
+0008a430: 203d 3d20 726f 775f 6964 785b 6b5d 2029   == row_idx[k] )
+0008a440: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0008a450: 7729 203e 2030 3a0a 2020 2020 2020 2020  w) > 0:.        
+0008a460: 2020 2020 6966 206c 656e 2877 2920 3e20      if len(w) > 
+0008a470: 313a 2070 7269 6e74 2827 4552 524f 5220  1: print('ERROR 
+0008a480: 696e 2067 6574 5f70 6572 666f 726d 616e  in get_performan
+0008a490: 6365 2829 3a20 4c65 6e28 7729 203d 2025  ce(): Len(w) = %
+0008a4a0: 6927 2025 206c 656e 2877 2920 290a 2020  i' % len(w) ).  
+0008a4b0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+0008a4c0: 7768 5b77 5b30 5d5d 0a20 2020 2020 2020  wh[w[0]].       
+0008a4d0: 2020 2020 2064 665f 6c73 742e 6170 7065       df_lst.appe
+0008a4e0: 6e64 2874 7269 6e66 6f2e 696c 6f63 5b69  nd(trinfo.iloc[i
+0008a4f0: 6478 5d29 0a20 2020 2020 2020 200a 2020  dx]).        .  
+0008a500: 2020 6466 5f73 656c 203d 2070 642e 4461    df_sel = pd.Da
+0008a510: 7461 4672 616d 6528 6466 5f6c 7374 290a  taFrame(df_lst).
+0008a520: 2020 2020 6966 2066 5f74 6f5f 7361 7665      if f_to_save
+0008a530: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0008a540: 2020 2020 2020 666e 616d 6520 3d20 2725        fname = '%
+0008a550: 735f 626c 6173 745f 7265 7375 6c74 2e74  s_blast_result.t
+0008a560: 7376 2720 2520 665f 746f 5f73 6176 650a  sv' % f_to_save.
+0008a570: 2020 2020 2020 2020 6466 5f73 656c 2e74          df_sel.t
+0008a580: 6f5f 6373 7628 666e 616d 652c 2068 6561  o_csv(fname, hea
+0008a590: 6465 723d 5472 7565 2c20 696e 6465 783d  der=True, index=
+0008a5a0: 4661 6c73 652c 2073 6570 3d27 5c74 2729  False, sep='\t')
+0008a5b0: 0a20 2020 2020 2020 2023 2069 6620 7665  .        # if ve
+0008a5c0: 7262 6f73 653a 2070 7269 6e74 2827 2025  rbose: print(' %
+0008a5d0: 732e 2720 2520 666e 616d 652c 2065 6e64  s.' % fname, end
+0008a5e0: 3d27 2720 290a 2020 2020 0a20 2020 2069  ='' ).    .    i
+0008a5f0: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
+0008a600: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
+0008a610: 2020 636e 7420 3d20 6e70 2e7a 6572 6f73    cnt = np.zeros
+0008a620: 286c 656e 2863 7667 5f74 6829 290a 2020  (len(cvg_th)).  
+0008a630: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
+0008a640: 286c 656e 2863 7667 5f74 6829 293a 0a20  (len(cvg_th)):. 
+0008a650: 2020 2020 2020 2074 6820 3d20 6376 675f         th = cvg_
+0008a660: 7468 5b6b 5d0a 2020 2020 2020 2020 7768  th[k].        wh
+0008a670: 203d 2077 6869 6368 2820 6466 5f73 656c   = which( df_sel
+0008a680: 5b71 5f63 7667 5d2a 3130 3020 3e3d 2074  [q_cvg]*100 >= t
+0008a690: 6820 290a 2020 2020 2020 2020 636e 745b  h ).        cnt[
+0008a6a0: 6b5d 203d 206e 702e 696e 7428 6c65 6e28  k] = np.int(len(
+0008a6b0: 7768 2929 0a20 2020 2020 2020 200a 2020  wh)).        .  
+0008a6c0: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
+0008a6d0: 696e 7428 2720 646f 6e65 2e27 290a 0a20  int(' done.').. 
+0008a6e0: 2020 2064 203d 207b 2763 7667 5f74 6827     d = {'cvg_th'
+0008a6f0: 3a20 6376 675f 7468 2c20 274e 5f72 6563  : cvg_th, 'N_rec
+0008a700: 6f76 6572 6564 273a 2063 6e74 2e61 7374  overed': cnt.ast
+0008a710: 7970 6528 696e 7429 2c20 2770 7265 6369  ype(int), 'preci
+0008a720: 7369 6f6e 273a 206e 702e 726f 756e 6428  sion': np.round(
+0008a730: 3130 302a 636e 742f 6c65 6e28 7369 6473  100*cnt/len(sids
+0008a740: 292c 3129 7d0a 2020 2020 6466 5f70 6572  ),1)}.    df_per
+0008a750: 6620 3d20 7064 2e44 6174 6146 7261 6d65  f = pd.DataFrame
+0008a760: 2864 6174 6120 3d20 6429 2023 2c20 636f  (data = d) #, co
+0008a770: 6c75 6d6e 7320 3d20 5b27 6376 675f 7468  lumns = ['cvg_th
+0008a780: 272c 276e 5f72 6563 6f76 6572 6564 272c  ','n_recovered',
+0008a790: 2770 7265 6369 7369 6f6e 275d 290a 2020  'precision']).  
+0008a7a0: 2020 0a20 2020 2072 6574 7572 6e28 6466    .    return(df
+0008a7b0: 5f70 6572 662c 2064 665f 7365 6c29 0a0a  _perf, df_sel)..
+0008a7c0: 2020 2020 0a64 6566 2072 756e 5f62 6c61      .def run_bla
+0008a7d0: 7374 2820 696e 7074 5f66 612c 2072 6566  st( inpt_fa, ref
+0008a7e0: 5f66 612c 2070 6174 685f 746f 5f62 6c61  _fa, path_to_bla
+0008a7f0: 7374 203d 204e 6f6e 652c 2074 7261 7265  st = None, trare
+0008a800: 636f 203d 2046 616c 7365 2c20 7265 665f  co = False, ref_
+0008a810: 696e 666f 203d 2046 616c 7365 2c20 5c0a  info = False, \.
+0008a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008a830: 2064 6274 7970 6520 3d20 276e 7563 6c27   dbtype = 'nucl'
+0008a840: 2c20 7265 6620 3d20 302c 2073 6469 7620  , ref = 0, sdiv 
+0008a850: 3d20 3130 2c20 6d78 5f6e 6361 6e64 203d  = 10, mx_ncand =
+0008a860: 2036 2c20 7665 7262 6f73 6520 3d20 4661   6, verbose = Fa
+0008a870: 6c73 6529 3a0a 0a20 2020 2023 2727 270a  lse):..    #'''.
+0008a880: 2020 2020 6966 2072 6566 203d 3d20 303a      if ref == 0:
+0008a890: 0a20 2020 2020 2020 2072 6566 5f74 7220  .        ref_tr 
+0008a8a0: 3d20 7265 665f 6661 0a20 2020 2020 2020  = ref_fa.       
+0008a8b0: 2069 6e70 745f 7472 203d 2069 6e70 745f   inpt_tr = inpt_
+0008a8c0: 6661 0a20 2020 2020 2020 200a 2020 2020  fa.        .    
+0008a8d0: 2020 2020 715f 6376 6720 3d20 2771 6376      q_cvg = 'qcv
+0008a8e0: 6727 0a20 2020 2020 2020 2071 5f6c 656e  g'.        q_len
+0008a8f0: 203d 2027 716c 656e 270a 2020 2020 2020   = 'qlen'.      
+0008a900: 2020 715f 6964 203d 2027 7169 6427 0a20    q_id = 'qid'. 
+0008a910: 2020 2020 2020 2073 5f73 7461 7274 203d         s_start =
+0008a920: 2027 7373 7461 7274 270a 2020 2020 2020   'sstart'.      
+0008a930: 2020 735f 656e 6420 3d20 2773 656e 6427    s_end = 'send'
+0008a940: 0a20 2020 2020 2020 2073 5f69 6420 3d20  .        s_id = 
+0008a950: 2773 6964 270a 2020 2020 656c 7365 3a0a  'sid'.    else:.
+0008a960: 2020 2020 2020 2020 7265 665f 7472 203d          ref_tr =
+0008a970: 2069 6e70 745f 6661 0a20 2020 2020 2020   inpt_fa.       
+0008a980: 2069 6e70 745f 7472 203d 2072 6566 5f66   inpt_tr = ref_f
+0008a990: 610a 2020 2020 2020 2020 0a20 2020 2020  a.        .     
+0008a9a0: 2020 2071 5f63 7667 203d 2027 7363 7667     q_cvg = 'scvg
+0008a9b0: 270a 2020 2020 2020 2020 715f 6c65 6e20  '.        q_len 
+0008a9c0: 3d20 2773 6c65 6e27 0a20 2020 2020 2020  = 'slen'.       
+0008a9d0: 2071 5f69 6420 3d20 2773 6964 270a 2020   q_id = 'sid'.  
+0008a9e0: 2020 2020 2020 735f 7374 6172 7420 3d20        s_start = 
+0008a9f0: 2771 7374 6172 7427 0a20 2020 2020 2020  'qstart'.       
+0008aa00: 2073 5f65 6e64 203d 2027 7165 6e64 270a   s_end = 'qend'.
+0008aa10: 2020 2020 2020 2020 735f 6964 203d 2027          s_id = '
+0008aa20: 7169 6427 0a20 2020 2023 2727 270a 2020  qid'.    #'''.  
+0008aa30: 2020 0a20 2020 2066 696c 655f 6e61 6d65    .    file_name
+0008aa40: 7320 3d20 696e 7074 5f74 722e 7370 6c69  s = inpt_tr.spli
+0008aa50: 7428 272e 2729 0a20 2020 2066 6e61 6d65  t('.').    fname
+0008aa60: 203d 2027 272e 6a6f 696e 2873 7420 666f   = ''.join(st fo
+0008aa70: 7220 7374 2069 6e20 6669 6c65 5f6e 616d  r st in file_nam
+0008aa80: 6573 5b3a 2d31 5d20 290a 0a20 2020 2074  es[:-1] )..    t
+0008aa90: 6e5f 696e 203d 205b 5d0a 2020 2020 6620  n_in = [].    f 
+0008aaa0: 3d20 6f70 656e 2869 6e70 745f 7472 2c27  = open(inpt_tr,'
+0008aab0: 7227 290a 2020 2020 6361 6e64 5f63 6e74  r').    cand_cnt
+0008aac0: 203d 2030 0a20 2020 2066 6f72 206c 696e   = 0.    for lin
+0008aad0: 6520 696e 2066 3a0a 2020 2020 2020 2020  e in f:.        
+0008aae0: 6966 206c 696e 655b 305d 203d 3d20 273e  if line[0] == '>
+0008aaf0: 273a 0a20 2020 2020 2020 2020 2020 2074  ':.            t
+0008ab00: 6e5f 696e 2e61 7070 656e 6428 6c69 6e65  n_in.append(line
+0008ab10: 5b31 3a2d 315d 290a 2020 2020 2020 2020  [1:-1]).        
+0008ab20: 2020 2020 6361 6e64 5f63 6e74 202b 3d20      cand_cnt += 
+0008ab30: 310a 2020 2020 662e 636c 6f73 6528 290a  1.    f.close().
+0008ab40: 2020 2020 0a20 2020 2074 6e5f 7265 6620      .    tn_ref 
+0008ab50: 3d20 5b5d 0a20 2020 2066 203d 206f 7065  = [].    f = ope
+0008ab60: 6e28 7265 665f 7472 2c27 7227 290a 2020  n(ref_tr,'r').  
+0008ab70: 2020 7265 665f 636e 7420 3d20 300a 2020    ref_cnt = 0.  
+0008ab80: 2020 666f 7220 6c69 6e65 2069 6e20 663a    for line in f:
+0008ab90: 0a20 2020 2020 2020 2069 6620 6c69 6e65  .        if line
+0008aba0: 5b30 5d20 3d3d 2027 3e27 3a0a 2020 2020  [0] == '>':.    
+0008abb0: 2020 2020 2020 2020 746e 5f72 6566 2e61          tn_ref.a
+0008abc0: 7070 656e 6428 6c69 6e65 5b31 3a2d 315d  ppend(line[1:-1]
+0008abd0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0008abe0: 665f 636e 7420 2b3d 2031 0a20 2020 2066  f_cnt += 1.    f
+0008abf0: 2e63 6c6f 7365 2829 0a20 2020 2023 2070  .close().    # p
+0008ac00: 7269 6e74 2827 4c65 6e3a 2025 692c 204e  rint('Len: %i, N
+0008ac10: 753d 2025 6927 2025 2028 6c65 6e28 746e  u= %i' % (len(tn
+0008ac20: 292c 206c 656e 2870 642e 756e 6971 7565  ), len(pd.unique
+0008ac30: 2874 6e29 2929 2c20 656e 643d 2727 2029  (tn))), end='' )
+0008ac40: 0a20 2020 200a 2020 2020 6966 2072 6566  .    .    if ref
+0008ac50: 203d 3d20 303a 0a20 2020 2020 2020 2074   == 0:.        t
+0008ac60: 6e20 3d20 746e 5f69 6e0a 2020 2020 2020  n = tn_in.      
+0008ac70: 2020 6e5f 6d61 785f 6361 6e64 7320 3d20    n_max_cands = 
+0008ac80: 310a 2020 2020 656c 7365 3a0a 2020 2020  1.    else:.    
+0008ac90: 2020 2020 746e 203d 2074 6e5f 7265 660a      tn = tn_ref.
+0008aca0: 2020 2020 2020 2020 6e5f 6d61 785f 6361          n_max_ca
+0008acb0: 6e64 7320 3d20 206d 785f 6e63 616e 640a  nds =  mx_ncand.
+0008acc0: 2020 2020 2020 2020 746d 7020 3d20 6361          tmp = ca
+0008acd0: 6e64 5f63 6e74 0a20 2020 2020 2020 2063  nd_cnt.        c
+0008ace0: 616e 645f 636e 7420 3d20 7265 665f 636e  and_cnt = ref_cn
+0008acf0: 740a 2020 2020 2020 2020 7265 665f 636e  t.        ref_cn
+0008ad00: 7420 3d20 746d 700a 2020 2020 0a20 2020  t = tmp.    .   
+0008ad10: 2023 2320 6d61 6b65 2062 6c61 7374 2064   ## make blast d
+0008ad20: 6220 7769 7468 2069 6e70 7574 5f74 720a  b with input_tr.
+0008ad30: 2020 2020 6966 2070 6174 685f 746f 5f62      if path_to_b
+0008ad40: 6c61 7374 2069 7320 4e6f 6e65 3a0a 2020  last is None:.  
+0008ad50: 2020 2020 2020 636d 6420 3d20 276d 616b        cmd = 'mak
+0008ad60: 6562 6c61 7374 6462 202d 696e 2025 7320  eblastdb -in %s 
+0008ad70: 2d64 6274 7970 6520 2573 2720 2520 2869  -dbtype %s' % (i
+0008ad80: 6e70 745f 7472 2c20 6462 7479 7065 290a  npt_tr, dbtype).
+0008ad90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008ada0: 2020 636d 6420 3d20 2725 732f 6d61 6b65    cmd = '%s/make
+0008adb0: 626c 6173 7464 6220 2d69 6e20 2573 202d  blastdb -in %s -
+0008adc0: 6462 7479 7065 2025 7327 2025 2028 7061  dbtype %s' % (pa
+0008add0: 7468 5f74 6f5f 626c 6173 742c 2069 6e70  th_to_blast, inp
+0008ade0: 745f 7472 2c20 6462 7479 7065 290a 2020  t_tr, dbtype).  
+0008adf0: 2020 7265 7320 3d20 7375 6270 726f 6365    res = subproce
+0008ae00: 7373 2e63 6865 636b 5f6f 7574 7075 7428  ss.check_output(
+0008ae10: 636d 642c 2073 6865 6c6c 3d54 7275 6529  cmd, shell=True)
+0008ae20: 0a20 2020 2023 2070 7269 6e74 2872 6573  .    # print(res
+0008ae30: 2e64 6563 6f64 6528 2777 696e 646f 7773  .decode('windows
+0008ae40: 2d31 3235 3227 2929 0a20 0a20 2020 2073  -1252')). .    s
+0008ae50: 7472 5f6f 7074 696f 6e20 3d20 272d 6f75  tr_option = '-ou
+0008ae60: 7466 6d74 2022 3620 7173 6571 6964 2073  tfmt "6 qseqid s
+0008ae70: 7365 7169 6420 716c 656e 206c 656e 6774  seqid qlen lengt
+0008ae80: 6820 736c 656e 2071 7374 6172 7420 7165  h slen qstart qe
+0008ae90: 6e64 2073 7374 6172 7420 7365 6e64 206e  nd sstart send n
+0008aea0: 6964 656e 7420 6d69 736d 6174 6368 2067  ident mismatch g
+0008aeb0: 6170 6f70 656e 2071 636f 7673 2071 636f  apopen qcovs qco
+0008aec0: 7668 7370 2062 6974 7363 6f72 6522 202d  vhsp bitscore" -
+0008aed0: 6e75 6d5f 7468 7265 6164 7320 3420 2d6d  num_threads 4 -m
+0008aee0: 6178 5f74 6172 6765 745f 7365 7173 2025  ax_target_seqs %
+0008aef0: 6927 2025 206e 5f6d 6178 5f63 616e 6473  i' % n_max_cands
+0008af00: 0a0a 2020 2020 6966 2064 6274 7970 6520  ..    if dbtype 
+0008af10: 3d3d 2027 6e75 636c 273a 2070 7266 7820  == 'nucl': prfx 
+0008af20: 3d20 276e 270a 2020 2020 656c 7365 3a20  = 'n'.    else: 
+0008af30: 7072 6678 203d 2027 7027 0a20 2020 2020  prfx = 'p'.     
+0008af40: 2020 200a 2020 2020 6966 2070 6174 685f     .    if path_
+0008af50: 746f 5f62 6c61 7374 2069 7320 4e6f 6e65  to_blast is None
+0008af60: 3a0a 2020 2020 2020 2020 636d 6420 3d20  :.        cmd = 
+0008af70: 2762 6c61 7374 2573 2025 7320 2d64 6220  'blast%s %s -db 
+0008af80: 2573 202d 7175 6572 7920 2573 202d 6f75  %s -query %s -ou
+0008af90: 7420 2573 2e74 626c 7374 2720 2520 2870  t %s.tblst' % (p
+0008afa0: 7266 782c 2073 7472 5f6f 7074 696f 6e2c  rfx, str_option,
+0008afb0: 2069 6e70 745f 7472 2c20 7265 665f 7472   inpt_tr, ref_tr
+0008afc0: 2c20 666e 616d 6529 0a20 2020 2065 6c73  , fname).    els
+0008afd0: 653a 0a20 2020 2020 2020 2063 6d64 203d  e:.        cmd =
+0008afe0: 2027 2573 2f62 6c61 7374 2573 2025 7320   '%s/blast%s %s 
+0008aff0: 2d64 6220 2573 202d 7175 6572 7920 2573  -db %s -query %s
+0008b000: 202d 6f75 7420 2573 2e74 626c 7374 2720   -out %s.tblst' 
+0008b010: 2520 2870 6174 685f 746f 5f62 6c61 7374  % (path_to_blast
+0008b020: 2c20 7072 6678 2c20 7374 725f 6f70 7469  , prfx, str_opti
+0008b030: 6f6e 2c20 696e 7074 5f74 722c 2072 6566  on, inpt_tr, ref
+0008b040: 5f74 722c 2066 6e61 6d65 290a 2020 2020  _tr, fname).    
+0008b050: 2020 2020 0a20 2020 2069 6620 7665 7262      .    if verb
+0008b060: 6f73 653a 2070 7269 6e74 2822 5275 6e6e  ose: print("Runn
+0008b070: 696e 6720 426c 6173 742d 2573 2077 6974  ing Blast-%s wit
+0008b080: 6820 2569 2063 616e 642e 2025 6920 7265  h %i cand. %i re
+0008b090: 662e 202e 2e2e 2022 2025 2028 6462 7479  f. ... " % (dbty
+0008b0a0: 7065 5b30 5d2e 7570 7065 7228 292c 6361  pe[0].upper(),ca
+0008b0b0: 6e64 5f63 6e74 2c20 7265 665f 636e 7429  nd_cnt, ref_cnt)
+0008b0c0: 2c20 656e 643d 2727 2c20 666c 7573 683d  , end='', flush=
+0008b0d0: 5472 7565 293b 0a20 2020 2072 6573 203d  True);.    res =
+0008b0e0: 2073 7562 7072 6f63 6573 732e 6368 6563   subprocess.chec
+0008b0f0: 6b5f 6f75 7470 7574 2863 6d64 2c20 7368  k_output(cmd, sh
+0008b100: 656c 6c3d 5472 7565 290a 2020 2020 2320  ell=True).    # 
+0008b110: 7072 696e 7428 7265 732e 6465 636f 6465  print(res.decode
+0008b120: 2827 7769 6e64 6f77 732d 3132 3532 2729  ('windows-1252')
+0008b130: 290a 2020 2020 6966 2076 6572 626f 7365  ).    if verbose
+0008b140: 3a20 7072 696e 7428 2764 6f6e 652e 2729  : print('done.')
+0008b150: 0a20 2020 200a 2020 2020 6f73 2e72 656d  .    .    os.rem
+0008b160: 6f76 6528 2027 2573 2e25 7368 7227 2025  ove( '%s.%shr' %
+0008b170: 2028 696e 7074 5f74 722c 2070 7266 7829   (inpt_tr, prfx)
+0008b180: 2029 0a20 2020 206f 732e 7265 6d6f 7665   ).    os.remove
+0008b190: 2820 2725 732e 2573 696e 2720 2520 2869  ( '%s.%sin' % (i
+0008b1a0: 6e70 745f 7472 2c20 7072 6678 2920 290a  npt_tr, prfx) ).
+0008b1b0: 2020 2020 6f73 2e72 656d 6f76 6528 2027      os.remove( '
+0008b1c0: 2573 2e25 7373 7127 2025 2028 696e 7074  %s.%ssq' % (inpt
+0008b1d0: 5f74 722c 2070 7266 7829 2029 0a20 2020  _tr, prfx) ).   
+0008b1e0: 0a20 2020 2063 6f6c 6e61 6d65 7320 3d20  .    colnames = 
+0008b1f0: 5b27 7169 6427 2c20 2773 6964 272c 2027  ['qid', 'sid', '
+0008b200: 716c 656e 272c 2027 616c 656e 272c 2027  qlen', 'alen', '
+0008b210: 736c 656e 272c 2027 7173 7461 7274 272c  slen', 'qstart',
+0008b220: 2027 7165 6e64 272c 2027 7373 7461 7274   'qend', 'sstart
+0008b230: 272c 2027 7365 6e64 272c 205c 0a20 2020  ', 'send', \.   
+0008b240: 2020 2020 2020 2020 2020 2020 2027 6e69               'ni
+0008b250: 6465 6e74 272c 2027 6d69 736d 6174 6368  dent', 'mismatch
+0008b260: 272c 2027 6761 706f 7065 6e27 2c20 2771  ', 'gapopen', 'q
+0008b270: 636f 7673 272c 2027 7163 6f76 6873 7027  covs', 'qcovhsp'
+0008b280: 2c20 2762 6974 7363 6f72 6527 5d0a 2020  , 'bitscore'].  
+0008b290: 2020 7462 6c73 7420 3d20 2725 732e 7462    tblst = '%s.tb
+0008b2a0: 6c73 7427 2025 2066 6e61 6d65 0a20 2020  lst' % fname.   
+0008b2b0: 2064 6620 3d20 7064 2e72 6561 645f 6373   df = pd.read_cs
+0008b2c0: 7628 7462 6c73 742c 2068 6561 6465 7220  v(tblst, header 
+0008b2d0: 3d20 2769 6e66 6572 272c 206e 616d 6573  = 'infer', names
+0008b2e0: 203d 2063 6f6c 6e61 6d65 732c 2073 6570   = colnames, sep
+0008b2f0: 3d27 5c74 2729 0a20 2020 200a 2020 2020  ='\t').    .    
+0008b300: 6f73 2e72 656d 6f76 6528 2027 2573 2720  os.remove( '%s' 
+0008b310: 2520 2874 626c 7374 2920 290a 2020 2020  % (tblst) ).    
+0008b320: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
+0008b330: 2070 7269 6e74 2827 4e2e 6361 6e64 3a20   print('N.cand: 
+0008b340: 2569 2c20 4e2e 7375 626a 6563 742e 756e  %i, N.subject.un
+0008b350: 6971 7565 3a20 2569 2720 2520 286c 656e  ique: %i' % (len
+0008b360: 2874 6e29 2c20 6c65 6e28 7064 2e75 6e69  (tn), len(pd.uni
+0008b370: 7175 6528 6466 5b27 7369 6427 5d29 2929  que(df['sid'])))
+0008b380: 2029 0a0a 2020 2020 6466 5b27 7363 7667   )..    df['scvg
+0008b390: 275d 203d 2064 665b 2761 6c65 6e27 5d2f  '] = df['alen']/
+0008b3a0: 6466 5b27 736c 656e 275d 0a20 2020 2064  df['slen'].    d
+0008b3b0: 665b 2771 6376 6727 5d20 3d20 6466 5b27  f['qcvg'] = df['
+0008b3c0: 616c 656e 275d 2f64 665b 2771 6c65 6e27  alen']/df['qlen'
+0008b3d0: 5d0a 2020 2020 2020 2020 0a20 2020 2069  ].        .    i
+0008b3e0: 6620 7472 6172 6563 6f20 3d3d 2054 7275  f trareco == Tru
+0008b3f0: 653a 0a20 2020 2020 2020 2061 626e 5f65  e:.        abn_e
+0008b400: 203d 205b 5d0a 2020 2020 2020 2020 7470   = [].        tp
+0008b410: 6d5f 6520 3d20 5b5d 0a20 2020 2020 2020  m_e = [].       
+0008b420: 2069 6672 6163 203d 205b 5d0a 2020 2020   ifrac = [].    
+0008b430: 2020 2020 7369 6478 203d 205b 5d0a 2020      sidx = [].  
+0008b440: 2020 2020 2020 675f 7369 7a65 203d 205b        g_size = [
+0008b450: 5d0a 2020 2020 2020 2020 6e5f 6578 6f6e  ].        n_exon
+0008b460: 7320 3d20 5b5d 0a20 2020 2020 2020 2067  s = [].        g
+0008b470: 5f76 6f6c 203d 205b 5d0a 2020 2020 2020  _vol = [].      
+0008b480: 2020 6963 6e74 203d 205b 5d0a 2020 2020    icnt = [].    
+0008b490: 2020 2020 7374 726e 6420 3d20 5b5d 0a20      strnd = []. 
+0008b4a0: 2020 2020 2020 2063 646e 6720 3d20 5b5d         cdng = []
+0008b4b0: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
+0008b4c0: 6e20 7261 6e67 6528 6466 2e73 6861 7065  n range(df.shape
+0008b4d0: 5b30 5d29 3a0a 2020 2020 2020 2020 2020  [0]):.          
+0008b4e0: 2020 2320 7320 3d20 273e 2573 5f43 6872    # s = '>%s_Chr
+0008b4f0: 2573 3a25 692d 2569 5f25 695f 2569 5f25  %s:%i-%i_%i_%i_%
+0008b500: 695f 4162 6e3a 2534 2e33 665f 5450 4d3a  i_Abn:%4.3f_TPM:
+0008b510: 2534 2e32 665f 4946 7261 633a 2533 2e32  %4.2f_IFrac:%3.2
+0008b520: 665c 6e27 200a 2020 2020 2020 2020 2020  f\n' .          
+0008b530: 2020 2320 2520 2874 722e 7072 6566 6978    # % (tr.prefix
+0008b540: 2c20 7472 2e63 6872 2c20 7472 2e73 7461  , tr.chr, tr.sta
+0008b550: 7274 2c20 7472 2e65 6e64 2c20 7472 2e67  rt, tr.end, tr.g
+0008b560: 6964 782c 2074 722e 6772 705f 7369 7a65  idx, tr.grp_size
+0008b570: 2c20 7472 2e69 636e 742c 2074 722e 6162  , tr.icnt, tr.ab
+0008b580: 6e2c 2074 722e 7470 6d2c 2074 722e 6973  n, tr.tpm, tr.is
+0008b590: 6f5f 6672 6163 290a 2020 2020 2020 2020  o_frac).        
+0008b5a0: 2020 2020 6864 7220 3d20 6466 5b73 5f69      hdr = df[s_i
+0008b5b0: 645d 5b6b 5d2e 7370 6c69 7428 2720 2729  d][k].split(' ')
+0008b5c0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+0008b5d0: 6d73 203d 2068 6472 5b30 5d2e 7370 6c69  ms = hdr[0].spli
+0008b5e0: 7428 275f 2729 0a20 2020 2020 2020 2020  t('_').         
+0008b5f0: 2020 2073 7472 6e64 2e61 7070 656e 6428     strnd.append(
+0008b600: 2069 7465 6d73 5b32 5d29 0a20 2020 2020   items[2]).     
+0008b610: 2020 2020 2020 2063 646e 672e 6170 7065         cdng.appe
+0008b620: 6e64 2820 6974 656d 735b 335d 290a 2020  nd( items[3]).  
+0008b630: 2020 2020 2020 2020 2020 7369 6478 2e61            sidx.a
+0008b640: 7070 656e 6428 2028 6974 656d 735b 345d  ppend( (items[4]
+0008b650: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+0008b660: 675f 7369 7a65 2e61 7070 656e 6428 2069  g_size.append( i
+0008b670: 6e74 2869 7465 6d73 5b35 5d29 2029 0a20  nt(items[5]) ). 
+0008b680: 2020 2020 2020 2020 2020 2069 636e 742e             icnt.
+0008b690: 6170 7065 6e64 2820 696e 7428 6974 656d  append( int(item
+0008b6a0: 735b 365d 2920 290a 2020 2020 2020 2020  s[6]) ).        
+0008b6b0: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
+0008b6c0: 375d 2e73 706c 6974 2827 3a27 290a 2020  7].split(':').  
+0008b6d0: 2020 2020 2020 2020 2020 6162 6e5f 652e            abn_e.
+0008b6e0: 6170 7065 6e64 2820 666c 6f61 7428 7661  append( float(va
+0008b6f0: 6c5b 315d 2920 290a 2020 2020 2020 2020  l[1]) ).        
+0008b700: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
+0008b710: 385d 2e73 706c 6974 2827 3a27 290a 2020  8].split(':').  
+0008b720: 2020 2020 2020 2020 2020 7470 6d5f 652e            tpm_e.
+0008b730: 6170 7065 6e64 2820 666c 6f61 7428 7661  append( float(va
+0008b740: 6c5b 315d 2920 290a 2020 2020 2020 2020  l[1]) ).        
+0008b750: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
+0008b760: 395d 2e73 706c 6974 2827 3a27 290a 2020  9].split(':').  
+0008b770: 2020 2020 2020 2020 2020 6966 7261 632e            ifrac.
+0008b780: 6170 7065 6e64 2820 666c 6f61 7428 7661  append( float(va
+0008b790: 6c5b 315d 2920 290a 2020 2020 2020 2020  l[1]) ).        
+0008b7a0: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
+0008b7b0: 3131 5d2e 7370 6c69 7428 273a 2729 0a20  11].split(':'). 
+0008b7c0: 2020 2020 2020 2020 2020 206e 5f65 786f             n_exo
+0008b7d0: 6e73 2e61 7070 656e 6428 2069 6e74 2876  ns.append( int(v
+0008b7e0: 616c 5b31 5d29 2029 0a20 2020 2020 2020  al[1]) ).       
+0008b7f0: 2020 2020 2076 616c 203d 2069 7465 6d73       val = items
+0008b800: 5b31 325d 2e73 706c 6974 2827 3a27 290a  [12].split(':').
+0008b810: 2020 2020 2020 2020 2020 2020 675f 766f              g_vo
+0008b820: 6c2e 6170 7065 6e64 2820 696e 7428 7661  l.append( int(va
+0008b830: 6c5b 315d 2920 290a 2020 2020 656c 7365  l[1]) ).    else
+0008b840: 3a0a 2020 2020 2020 2020 6162 6e5f 6520  :.        abn_e 
+0008b850: 3d20 6e70 2e7a 6572 6f73 2864 662e 7368  = np.zeros(df.sh
+0008b860: 6170 655b 305d 290a 2020 2020 2020 2020  ape[0]).        
+0008b870: 7470 6d5f 6520 3d20 6e70 2e7a 6572 6f73  tpm_e = np.zeros
+0008b880: 2864 662e 7368 6170 655b 305d 290a 2020  (df.shape[0]).  
+0008b890: 2020 2020 2020 6966 7261 6320 3d20 6e70        ifrac = np
+0008b8a0: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
+0008b8b0: 305d 290a 2020 2020 2020 2020 7369 6478  0]).        sidx
+0008b8c0: 203d 206e 702e 6675 6c6c 2864 662e 7368   = np.full(df.sh
+0008b8d0: 6170 655b 305d 2c20 2727 290a 2020 2020  ape[0], '').    
+0008b8e0: 2020 2020 675f 7369 7a65 203d 206e 702e      g_size = np.
+0008b8f0: 7a65 726f 7328 6466 2e73 6861 7065 5b30  zeros(df.shape[0
+0008b900: 5d29 0a20 2020 2020 2020 206e 5f65 786f  ]).        n_exo
+0008b910: 6e73 203d 206e 702e 7a65 726f 7328 6466  ns = np.zeros(df
+0008b920: 2e73 6861 7065 5b30 5d29 0a20 2020 2020  .shape[0]).     
+0008b930: 2020 2067 5f76 6f6c 203d 206e 702e 7a65     g_vol = np.ze
+0008b940: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
+0008b950: 0a20 2020 2020 2020 2069 636e 7420 3d20  .        icnt = 
+0008b960: 6e70 2e7a 6572 6f73 2864 662e 7368 6170  np.zeros(df.shap
+0008b970: 655b 305d 290a 2020 2020 2020 2020 7374  e[0]).        st
+0008b980: 726e 6420 3d20 6e70 2e7a 6572 6f73 2864  rnd = np.zeros(d
+0008b990: 662e 7368 6170 655b 305d 290a 2020 2020  f.shape[0]).    
+0008b9a0: 2020 2020 6364 6e67 203d 206e 702e 7a65      cdng = np.ze
+0008b9b0: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
+0008b9c0: 0a20 2020 2020 2020 200a 2020 2020 2327  .        .    #'
+0008b9d0: 2727 0a20 2020 2072 6566 5f69 6e66 6f20  ''.    ref_info 
+0008b9e0: 3d20 4661 6c73 650a 2020 2020 6966 206c  = False.    if l
+0008b9f0: 656e 2864 665b 715f 6964 5d5b 305d 2e73  en(df[q_id][0].s
+0008ba00: 706c 6974 2827 3a27 2929 203d 3d20 343a  plit(':')) == 4:
+0008ba10: 200a 2020 2020 2020 2020 7265 665f 696e   .        ref_in
+0008ba20: 666f 203d 2054 7275 650a 2020 2020 2020  fo = True.      
+0008ba30: 2020 2320 7072 696e 7428 2752 6566 5f69    # print('Ref_i
+0008ba40: 6e66 6f20 6973 2074 7275 6527 290a 2020  nfo is true').  
+0008ba50: 2020 2020 2020 0a20 2020 2069 6620 7265        .    if re
+0008ba60: 665f 696e 666f 203d 3d20 5472 7565 3a0a  f_info == True:.
+0008ba70: 2020 2020 2020 2020 6769 6420 3d20 5b5d          gid = []
+0008ba80: 0a20 2020 2020 2020 2063 7667 203d 205b  .        cvg = [
+0008ba90: 5d0a 2020 2020 2020 2020 6162 6e5f 7420  ].        abn_t 
+0008baa0: 3d20 5b5d 0a20 2020 2020 2020 2074 706d  = [].        tpm
+0008bab0: 5f74 203d 205b 5d0a 2020 2020 2020 2020  _t = [].        
+0008bac0: 666f 7220 6b20 696e 2072 616e 6765 2864  for k in range(d
+0008bad0: 662e 7368 6170 655b 305d 293a 0a20 2020  f.shape[0]):.   
+0008bae0: 2020 2020 2020 2020 2069 7465 6d73 203d           items =
+0008baf0: 2064 665b 715f 6964 5d5b 6b5d 2e73 706c   df[q_id][k].spl
+0008bb00: 6974 2827 3a27 290a 2020 2020 2020 2020  it(':').        
+0008bb10: 2020 2020 6769 642e 6170 7065 6e64 2820      gid.append( 
+0008bb20: 6974 656d 735b 305d 2029 0a20 2020 2020  items[0] ).     
+0008bb30: 2020 2020 2020 2063 7667 2e61 7070 656e         cvg.appen
+0008bb40: 6428 2066 6c6f 6174 2869 7465 6d73 5b31  d( float(items[1
+0008bb50: 5d29 2029 0a20 2020 2020 2020 2020 2020  ]) ).           
+0008bb60: 2061 626e 5f74 2e61 7070 656e 6428 2066   abn_t.append( f
+0008bb70: 6c6f 6174 2869 7465 6d73 5b32 5d29 2029  loat(items[2]) )
+0008bb80: 0a20 2020 2020 2020 2020 2020 2074 706d  .            tpm
+0008bb90: 5f74 2e61 7070 656e 6428 2066 6c6f 6174  _t.append( float
+0008bba0: 2869 7465 6d73 5b33 5d29 2029 0a20 2020  (items[3]) ).   
+0008bbb0: 2065 6c73 653a 0a20 2020 2020 2020 2067   else:.        g
+0008bbc0: 6964 203d 206e 702e 7a65 726f 7328 6466  id = np.zeros(df
+0008bbd0: 2e73 6861 7065 5b30 5d29 0a20 2020 2020  .shape[0]).     
+0008bbe0: 2020 2063 7667 203d 206e 702e 7a65 726f     cvg = np.zero
+0008bbf0: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
+0008bc00: 2020 2020 2020 2061 626e 5f74 203d 206e         abn_t = n
+0008bc10: 702e 7a65 726f 7328 6466 2e73 6861 7065  p.zeros(df.shape
+0008bc20: 5b30 5d29 0a20 2020 2020 2020 2074 706d  [0]).        tpm
+0008bc30: 5f74 203d 206e 702e 7a65 726f 7328 6466  _t = np.zeros(df
+0008bc40: 2e73 6861 7065 5b30 5d29 0a0a 2020 2020  .shape[0])..    
+0008bc50: 2327 2727 0a20 2020 2064 665b 2765 7870  #'''.    df['exp
+0008bc60: 5f63 7667 275d 203d 2063 7667 0a20 2020  _cvg'] = cvg.   
+0008bc70: 2064 665b 2761 626e 5f74 7275 6527 5d20   df['abn_true'] 
+0008bc80: 3d20 6162 6e5f 740a 2020 2020 6466 5b27  = abn_t.    df['
+0008bc90: 6162 6e5f 6573 7427 5d20 3d20 6162 6e5f  abn_est'] = abn_
+0008bca0: 650a 2020 2020 6466 5b27 7470 6d5f 7472  e.    df['tpm_tr
+0008bcb0: 7565 275d 203d 2074 706d 5f74 0a20 2020  ue'] = tpm_t.   
+0008bcc0: 2064 665b 2774 706d 5f65 7374 275d 203d   df['tpm_est'] =
+0008bcd0: 2074 706d 5f65 0a20 2020 2064 665b 2767   tpm_e.    df['g
+0008bce0: 6964 7827 5d20 3d20 7369 6478 0a20 2020  idx'] = sidx.   
+0008bcf0: 2064 665b 2769 6964 7827 5d20 3d20 6963   df['iidx'] = ic
+0008bd00: 6e74 0a20 2020 2064 665b 2767 5f73 697a  nt.    df['g_siz
+0008bd10: 6527 5d20 3d20 675f 7369 7a65 0a20 2020  e'] = g_size.   
+0008bd20: 2064 665b 2769 736f 5f66 7261 6327 5d20   df['iso_frac'] 
+0008bd30: 3d20 6966 7261 630a 2020 2020 6466 5b27  = ifrac.    df['
+0008bd40: 6e5f 6578 6f6e 7327 5d20 3d20 6e5f 6578  n_exons'] = n_ex
+0008bd50: 6f6e 730a 2020 2020 6466 5b27 675f 766f  ons.    df['g_vo
+0008bd60: 6c27 5d20 3d20 675f 766f 6c0a 2020 2020  l'] = g_vol.    
+0008bd70: 6466 5b27 7374 7261 6e64 275d 203d 2073  df['strand'] = s
+0008bd80: 7472 6e64 0a20 2020 2064 665b 2743 5f6f  trnd.    df['C_o
+0008bd90: 725f 4e27 5d20 3d20 6364 6e67 0a20 2020  r_N'] = cdng.   
+0008bda0: 2020 2020 200a 2020 2020 6220 3d20 6466       .    b = df
+0008bdb0: 5b71 5f63 7667 5d20 3e3d 2030 2e38 0a20  [q_cvg] >= 0.8. 
+0008bdc0: 2020 2064 665f 6e65 7720 3d20 6466 2e6c     df_new = df.l
+0008bdd0: 6f63 5b62 2c3a 5d0a 2020 2020 6466 203d  oc[b,:].    df =
+0008bde0: 2064 665f 6e65 770a 2020 2020 0a20 2020   df_new.    .   
+0008bdf0: 2066 756c 6c5f 6e61 6d65 7320 3d20 6466   full_names = df
+0008be00: 5b71 5f69 645d 202b 2064 665b 735f 6964  [q_id] + df[s_id
+0008be10: 5d0a 2020 2020 666e 7320 3d20 7064 2e75  ].    fns = pd.u
+0008be20: 6e69 7175 6528 6675 6c6c 5f6e 616d 6573  nique(full_names
+0008be30: 290a 2020 2020 6b20 3d20 300a 2020 2020  ).    k = 0.    
+0008be40: 6466 5f6c 7374 203d 205b 5d0a 2020 2020  df_lst = [].    
+0008be50: 666f 7220 666e 2069 6e20 666e 733a 0a20  for fn in fns:. 
+0008be60: 2020 2020 2020 2077 6820 3d20 7768 6963         wh = whic
+0008be70: 6828 6675 6c6c 5f6e 616d 6573 203d 3d20  h(full_names == 
+0008be80: 666e 290a 2020 2020 2020 2020 6466 5f74  fn).        df_t
+0008be90: 6d70 203d 2064 662e 696c 6f63 5b77 685d  mp = df.iloc[wh]
+0008bea0: 0a20 2020 2020 2020 2071 6376 6720 3d20  .        qcvg = 
+0008beb0: 6e70 2e61 7272 6179 2820 6466 5f74 6d70  np.array( df_tmp
+0008bec0: 5b71 5f63 7667 5d20 290a 2020 2020 2020  [q_cvg] ).      
+0008bed0: 2020 6f64 7220 3d20 7163 7667 2e61 7267    odr = qcvg.arg
+0008bee0: 736f 7274 2829 0a20 2020 2020 2020 2064  sort().        d
+0008bef0: 665f 6c73 742e 6170 7065 6e64 2864 665f  f_lst.append(df_
+0008bf00: 746d 702e 696c 6f63 5b6f 6472 5b2d 315d  tmp.iloc[odr[-1]
+0008bf10: 5d29 200a 2020 2020 2020 2020 6b20 2b3d  ]) .        k +=
+0008bf20: 2031 0a0a 2020 2020 6966 206c 656e 2864   1..    if len(d
+0008bf30: 665f 6c73 7429 203e 2030 3a0a 2020 2020  f_lst) > 0:.    
+0008bf40: 2020 2020 6466 5f73 656c 203d 2070 642e      df_sel = pd.
+0008bf50: 4461 7461 4672 616d 6528 6466 5f6c 7374  DataFrame(df_lst
+0008bf60: 290a 2020 2020 2020 2020 2327 2727 0a20  ).        #'''. 
+0008bf70: 2020 2020 2020 2074 7269 6e66 6f20 3d20         trinfo = 
+0008bf80: 2725 735f 626c 6173 745f 7265 7375 6c74  '%s_blast_result
+0008bf90: 2e74 7376 2720 2520 666e 616d 650a 2020  .tsv' % fname.  
+0008bfa0: 2020 2020 2020 6466 5f73 656c 2e74 6f5f        df_sel.to_
+0008bfb0: 6373 7628 7472 696e 666f 2c20 6865 6164  csv(trinfo, head
+0008bfc0: 6572 3d54 7275 652c 2069 6e64 6578 3d46  er=True, index=F
+0008bfd0: 616c 7365 2c20 7365 703d 275c 7427 290a  alse, sep='\t').
+0008bfe0: 2020 2020 2020 2020 2320 6966 2076 6572          # if ver
+0008bff0: 626f 7365 3a20 7072 696e 7428 2754 7261  bose: print('Tra
+0008c000: 6e73 6372 6970 746f 6d65 2049 6e66 6f2e  nscriptome Info.
+0008c010: 2077 7269 7474 656e 2074 6f20 5c6e 2020   written to \n  
+0008c020: 2025 732e 2720 2520 7472 696e 666f 2029   %s.' % trinfo )
+0008c030: 0a0a 2020 2020 2020 2020 6466 5f73 656c  ..        df_sel
+0008c040: 203d 2070 642e 7265 6164 5f63 7376 2874   = pd.read_csv(t
+0008c050: 7269 6e66 6f2c 2073 6570 3d27 5c74 2729  rinfo, sep='\t')
+0008c060: 0a20 2020 2020 2020 2023 2727 270a 0a20  .        #'''.. 
+0008c070: 2020 2020 2020 2064 665f 7065 7266 2c20         df_perf, 
+0008c080: 6466 5f73 656c 203d 2067 6574 5f70 6572  df_sel = get_per
+0008c090: 666f 726d 616e 6365 2864 665f 7365 6c2c  formance(df_sel,
+0008c0a0: 2066 5f74 6f5f 7361 7665 3d66 6e61 6d65   f_to_save=fname
+0008c0b0: 2c20 7265 6620 3d20 7265 662c 2076 6572  , ref = ref, ver
+0008c0c0: 626f 7365 3d76 6572 626f 7365 290a 2020  bose=verbose).  
+0008c0d0: 2020 2020 2020 6466 5f70 6572 665b 2770        df_perf['p
+0008c0e0: 7265 6369 7369 6f6e 275d 203d 2072 6f75  recision'] = rou
+0008c0f0: 6e64 2864 665f 7065 7266 5b27 4e5f 7265  nd(df_perf['N_re
+0008c100: 636f 7665 7265 6427 5d2a 3130 302f 6361  covered']*100/ca
+0008c110: 6e64 5f63 6e74 2c31 290a 2020 2020 2020  nd_cnt,1).      
+0008c120: 2020 6466 5f70 6572 665b 2773 656e 7369    df_perf['sensi
+0008c130: 7469 7669 7479 275d 203d 2072 6f75 6e64  tivity'] = round
+0008c140: 2864 665f 7065 7266 5b27 4e5f 7265 636f  (df_perf['N_reco
+0008c150: 7665 7265 6427 5d2a 3130 302f 7265 665f  vered']*100/ref_
+0008c160: 636e 742c 3129 0a20 2020 2020 2020 2023  cnt,1).        #
+0008c170: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
+0008c180: 6e74 2864 665f 7065 7266 290a 2020 2020  nt(df_perf).    
+0008c190: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0008c1a0: 6966 2074 7261 7265 636f 203d 3d20 5472  if trareco == Tr
+0008c1b0: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+0008c1c0: 6466 5f74 7220 3d20 6765 745f 696e 666f  df_tr = get_info
+0008c1d0: 5f66 726f 6d5f 7472 5f6e 616d 6528 2074  _from_tr_name( t
+0008c1e0: 6e20 290a 2020 2020 2020 2020 2020 2020  n ).            
+0008c1f0: 6466 5f74 725b 2764 6574 6563 7465 6427  df_tr['detected'
+0008c200: 5d20 3d20 4661 6c73 650a 2020 2020 2020  ] = False.      
+0008c210: 2020 2020 2020 6466 5f74 722e 6c6f 635b        df_tr.loc[
+0008c220: 6c69 7374 2864 665f 7365 6c5b 735f 6964  list(df_sel[s_id
+0008c230: 5d29 2c27 6465 7465 6374 6564 275d 203d  ]),'detected'] =
+0008c240: 2054 7275 6520 0a20 2020 2020 2020 2020   True .         
+0008c250: 2020 2064 665f 7472 5b71 5f6c 656e 5d20     df_tr[q_len] 
+0008c260: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0008c270: 666f 7220 6d2c 2073 6964 2069 6e20 656e  for m, sid in en
+0008c280: 756d 6572 6174 6528 6466 5f73 656c 5b73  umerate(df_sel[s
+0008c290: 5f69 645d 293a 0a20 2020 2020 2020 2020  _id]):.         
+0008c2a0: 2020 2020 2020 2064 665f 7472 2e6c 6f63         df_tr.loc
+0008c2b0: 5b73 6964 2c71 5f6c 656e 5d20 3d20 6e70  [sid,q_len] = np
+0008c2c0: 2e72 6f75 6e64 2864 665f 7365 6c2e 696c  .round(df_sel.il
+0008c2d0: 6f63 5b6d 5d2e 716c 656e 290a 2020 2020  oc[m].qlen).    
+0008c2e0: 2020 2020 2020 2020 6466 5f74 725b 735f          df_tr[s_
+0008c2f0: 7374 6172 745d 203d 2030 0a20 2020 2020  start] = 0.     
+0008c300: 2020 2020 2020 2023 2064 665f 7472 2e6c         # df_tr.l
+0008c310: 6f63 5b6c 6973 7428 6466 5f73 656c 5b27  oc[list(df_sel['
+0008c320: 7369 6427 5d29 2c27 7363 7667 275d 203d  sid']),'scvg'] =
+0008c330: 2064 665f 7365 6c2e 6c6f 635b 3a2c 2773   df_sel.loc[:,'s
+0008c340: 6376 6727 5d20 0a20 2020 2020 2020 2020  cvg'] .         
+0008c350: 2020 2066 6f72 206d 2c20 7369 6420 696e     for m, sid in
+0008c360: 2065 6e75 6d65 7261 7465 2864 665f 7365   enumerate(df_se
+0008c370: 6c5b 735f 6964 5d29 3a0a 2020 2020 2020  l[s_id]):.      
+0008c380: 2020 2020 2020 2020 2020 6466 5f74 722e            df_tr.
+0008c390: 6c6f 635b 7369 642c 735f 7374 6172 745d  loc[sid,s_start]
+0008c3a0: 203d 206e 702e 726f 756e 6428 6466 5f73   = np.round(df_s
+0008c3b0: 656c 2e69 6c6f 635b 6d5d 2e73 7374 6172  el.iloc[m].sstar
+0008c3c0: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
+0008c3d0: 665f 7472 5b73 5f65 6e64 5d20 3d20 300a  f_tr[s_end] = 0.
+0008c3e0: 2020 2020 2020 2020 2020 2020 2320 6466              # df
+0008c3f0: 5f74 722e 6c6f 635b 6c69 7374 2864 665f  _tr.loc[list(df_
+0008c400: 7365 6c5b 2773 6964 275d 292c 2773 6376  sel['sid']),'scv
+0008c410: 6727 5d20 3d20 6466 5f73 656c 2e6c 6f63  g'] = df_sel.loc
+0008c420: 5b3a 2c27 7363 7667 275d 200a 2020 2020  [:,'scvg'] .    
+0008c430: 2020 2020 2020 2020 666f 7220 6d2c 2073          for m, s
+0008c440: 6964 2069 6e20 656e 756d 6572 6174 6528  id in enumerate(
+0008c450: 6466 5f73 656c 5b73 5f69 645d 293a 0a20  df_sel[s_id]):. 
+0008c460: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0008c470: 665f 7472 2e6c 6f63 5b73 6964 2c73 5f65  f_tr.loc[sid,s_e
+0008c480: 6e64 5d20 3d20 6e70 2e72 6f75 6e64 2864  nd] = np.round(d
+0008c490: 665f 7365 6c2e 696c 6f63 5b6d 5d2e 7365  f_sel.iloc[m].se
+0008c4a0: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
+0008c4b0: 6466 5f74 7220 3d20 6466 5f74 722e 7265  df_tr = df_tr.re
+0008c4c0: 7365 745f 696e 6465 7828 290a 2020 2020  set_index().    
+0008c4d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008c4e0: 2020 2020 2020 6466 5f74 7220 3d20 4e6f        df_tr = No
+0008c4f0: 6e65 0a20 2020 2020 2020 2020 2020 200a  ne.            .
+0008c500: 2020 2020 2020 2020 7265 7475 726e 2864          return(d
+0008c510: 665f 7065 7266 2c20 6466 5f73 656c 2c20  f_perf, df_sel, 
+0008c520: 6466 5f74 7229 0a20 2020 200a 2020 2020  df_tr).    .    
+0008c530: 656c 7365 3a0a 2020 2020 2020 2020 6966  else:.        if
+0008c540: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
+0008c550: 274e 6f20 7472 2066 6f75 6e64 2e20 2729  'No tr found. ')
+0008c560: 0a20 2020 2020 2020 2072 6574 7572 6e28  .        return(
+0008c570: 4e6f 6e65 2c4e 6f6e 652c 4e6f 6e65 290a  None,None,None).
+0008c580: 2020 2020 0a0a 2323 2323 2323 2323 2323      ..##########
 0008c590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c5a0: 2323 230a 0a64 6566 2073 6f72 745f 6774  ###..def sort_gt
-0008c5b0: 665f 6c69 6e65 735f 6c73 7428 6774 665f  f_lines_lst(gtf_
-0008c5c0: 6c69 6e65 735f 6c73 7429 3a0a 2020 2020  lines_lst):.    
-0008c5d0: 0a20 2020 2063 6872 7320 3d20 5b5d 0a20  .    chrs = []. 
-0008c5e0: 2020 2066 6f72 206c 696e 6573 2069 6e20     for lines in 
-0008c5f0: 6774 665f 6c69 6e65 735f 6c73 743a 0a20  gtf_lines_lst:. 
-0008c600: 2020 2020 2020 2066 6972 7374 5f6c 696e         first_lin
-0008c610: 6520 3d20 6c69 6e65 735b 305d 0a20 2020  e = lines[0].   
-0008c620: 2020 2020 2063 6872 732e 6170 7065 6e64       chrs.append
-0008c630: 2866 6972 7374 5f6c 696e 652e 6368 7229  (first_line.chr)
-0008c640: 0a0a 2020 2020 6368 725f 7365 7420 3d20  ..    chr_set = 
-0008c650: 6c69 7374 2873 6574 2863 6872 7329 290a  list(set(chrs)).
-0008c660: 2020 2020 6368 725f 7365 742e 736f 7274      chr_set.sort
-0008c670: 2829 0a20 2020 2063 6872 7320 3d20 6e70  ().    chrs = np
-0008c680: 2e61 7272 6179 2863 6872 7329 0a0a 2020  .array(chrs)..  
-0008c690: 2020 6774 665f 6c73 745f 6e65 7720 3d20    gtf_lst_new = 
-0008c6a0: 5b5d 0a20 2020 2066 6f72 2063 2069 6e20  [].    for c in 
-0008c6b0: 6368 725f 7365 743a 0a20 2020 2020 2020  chr_set:.       
-0008c6c0: 2077 6820 3d20 7768 6963 6828 6368 7273   wh = which(chrs
-0008c6d0: 203d 3d20 6329 0a20 2020 2020 2020 2070   == c).        p
-0008c6e0: 7320 3d20 6e70 2e61 7272 6179 2820 5b67  s = np.array( [g
-0008c6f0: 7466 5f6c 696e 6573 5f6c 7374 5b77 5d5b  tf_lines_lst[w][
-0008c700: 305d 2e73 7461 7274 2066 6f72 2077 2069  0].start for w i
-0008c710: 6e20 7768 5d20 290a 2020 2020 2020 2020  n wh] ).        
-0008c720: 6f64 7232 203d 2070 732e 6172 6773 6f72  odr2 = ps.argsor
-0008c730: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
-0008c740: 6f20 696e 206f 6472 323a 0a20 2020 2020  o in odr2:.     
-0008c750: 2020 2020 2020 2077 203d 2077 685b 6f5d         w = wh[o]
-0008c760: 0a20 2020 2020 2020 2020 2020 2067 7466  .            gtf
-0008c770: 5f6c 7374 5f6e 6577 2e61 7070 656e 6428  _lst_new.append(
-0008c780: 6774 665f 6c69 6e65 735f 6c73 745b 775d  gtf_lines_lst[w]
-0008c790: 290a 2020 2020 2020 2020 0a20 2020 2072  ).        .    r
-0008c7a0: 6574 7572 6e20 6774 665f 6c73 745f 6e65  eturn gtf_lst_ne
-0008c7b0: 770a 0a0a 6465 6620 7365 6c65 6374 5f63  w...def select_c
-0008c7c0: 6f64 696e 675f 6765 6e65 735f 6672 6f6d  oding_genes_from
-0008c7d0: 5f67 7466 5f66 696c 6528 6774 665f 6669  _gtf_file(gtf_fi
-0008c7e0: 6c65 2c20 6765 6e6f 6d65 5f66 696c 6529  le, genome_file)
-0008c7f0: 3a0a 0a20 2020 2066 6e73 203d 2067 7466  :..    fns = gtf
-0008c800: 5f66 696c 652e 7370 6c69 7428 272e 2729  _file.split('.')
-0008c810: 5b3a 2d31 5d0a 2020 2020 666e 616d 6520  [:-1].    fname 
-0008c820: 3d20 2727 0a20 2020 2066 6f72 206b 2c20  = ''.    for k, 
-0008c830: 666e 2069 6e20 656e 756d 6572 6174 6528  fn in enumerate(
-0008c840: 666e 7329 3a0a 2020 2020 2020 2020 6966  fns):.        if
-0008c850: 206b 203e 2030 3a0a 2020 2020 2020 2020   k > 0:.        
-0008c860: 2020 2020 666e 616d 6520 3d20 666e 616d      fname = fnam
-0008c870: 6520 2b20 272e 270a 2020 2020 2020 2020  e + '.'.        
-0008c880: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
-0008c890: 666e 0a20 2020 200a 2020 2020 6774 665f  fn.    .    gtf_
-0008c8a0: 6c69 6e65 732c 2068 6472 5f6c 696e 6573  lines, hdr_lines
-0008c8b0: 203d 206c 6f61 645f 6774 6628 6774 665f   = load_gtf(gtf_
-0008c8c0: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
-0008c8d0: 5472 7565 290a 2020 2020 0a20 2020 2062  True).    .    b
-0008c8e0: 6173 655f 6364 7320 3d20 6765 745f 6261  ase_cds = get_ba
-0008c8f0: 7365 5f63 6473 5f66 726f 6d5f 6774 665f  se_cds_from_gtf_
-0008c900: 6c69 6e65 7328 6774 665f 6c69 6e65 7329  lines(gtf_lines)
-0008c910: 0a20 2020 2069 6620 6261 7365 5f63 6473  .    if base_cds
-0008c920: 203c 2030 3a0a 2020 2020 2020 2020 7072   < 0:.        pr
-0008c930: 696e 7428 2749 4e46 4f3a 204e 6f20 636f  int('INFO: No co
-0008c940: 6469 6e67 2069 6e66 6f72 6d61 7469 6f6e  ding information
-0008c950: 2070 726f 7669 6465 6420 696e 2074 6865   provided in the
-0008c960: 2047 5446 2f47 4646 2e27 290a 2020 2020   GTF/GFF.').    
-0008c970: 0a20 2020 2067 7466 5f6c 696e 6573 5f6c  .    gtf_lines_l
-0008c980: 7374 203d 2070 6172 7365 5f67 7466 5f6c  st = parse_gtf_l
-0008c990: 696e 6573 5f61 6e64 5f73 706c 6974 5f69  ines_and_split_i
-0008c9a0: 6e74 6f5f 6765 6e65 7328 2067 7466 5f6c  nto_genes( gtf_l
-0008c9b0: 696e 6573 2029 0a20 2020 2067 656e 6f6d  ines ).    genom
-0008c9c0: 6520 3d20 6c6f 6164 5f67 656e 6f6d 6528  e = load_genome(
-0008c9d0: 6765 6e6f 6d65 5f66 696c 6529 0a20 2020  genome_file).   
-0008c9e0: 2063 6872 7320 3d20 6765 6e6f 6d65 2e6b   chrs = genome.k
-0008c9f0: 6579 7328 290a 0a20 2020 2067 7466 5f6c  eys()..    gtf_l
-0008ca00: 696e 6573 5f6c 7374 5f6e 6577 203d 205b  ines_lst_new = [
-0008ca10: 5d0a 2020 2020 6363 6e74 203d 2030 0a20  ].    ccnt = 0. 
-0008ca20: 2020 2067 636e 7420 3d20 300a 2020 2020     gcnt = 0.    
-0008ca30: 666f 7220 6b2c 2067 6c69 6e65 7320 696e  for k, glines in
-0008ca40: 2065 6e75 6d65 7261 7465 2867 7466 5f6c   enumerate(gtf_l
-0008ca50: 696e 6573 5f6c 7374 293a 0a0a 2020 2020  ines_lst):..    
-0008ca60: 2020 2020 6966 2020 676c 696e 6573 5b30      if  glines[0
-0008ca70: 5d2e 6368 7220 696e 2063 6872 733a 0a20  ].chr in chrs:. 
-0008ca80: 2020 2020 2020 2020 2020 2074 725f 6c69             tr_li
-0008ca90: 6e65 735f 6c73 7420 3d20 7061 7273 655f  nes_lst = parse_
-0008caa0: 6774 665f 6c69 6e65 735f 616e 645f 7370  gtf_lines_and_sp
-0008cab0: 6c69 745f 696e 746f 5f67 656e 6573 2820  lit_into_genes( 
-0008cac0: 676c 696e 6573 2c20 2774 7261 6e73 6372  glines, 'transcr
-0008cad0: 6970 7427 2029 0a20 2020 2020 2020 2020  ipt' ).         
-0008cae0: 2020 206c 696e 6573 5f6e 6577 203d 205b     lines_new = [
-0008caf0: 5d0a 0a20 2020 2020 2020 2020 2020 2066  ]..            f
-0008cb00: 6f72 206c 696e 6573 2069 6e20 7472 5f6c  or lines in tr_l
-0008cb10: 696e 6573 5f6c 7374 3a0a 2020 2020 2020  ines_lst:.      
-0008cb20: 2020 2020 2020 2020 2020 6220 3d20 4661            b = Fa
-0008cb30: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0008cb40: 2020 2020 636e 7420 3d20 5b30 2c30 5d0a      cnt = [0,0].
-0008cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cb60: 666f 7220 6774 666c 696e 6520 696e 206c  for gtfline in l
-0008cb70: 696e 6573 3a0a 2020 2020 2020 2020 2020  ines:.          
-0008cb80: 2020 2020 2020 2020 2020 6966 2067 7466            if gtf
-0008cb90: 6c69 6e65 2e66 6561 7475 7265 203d 3d20  line.feature == 
-0008cba0: 2773 7461 7274 5f63 6f64 6f6e 273a 0a20  'start_codon':. 
-0008cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cbc0: 2020 2020 2020 2063 6e74 5b30 5d20 2b3d         cnt[0] +=
-0008cbd0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-0008cbe0: 2020 2020 2020 2069 6620 6774 666c 696e         if gtflin
-0008cbf0: 652e 6665 6174 7572 6520 3d3d 2027 7374  e.feature == 'st
-0008cc00: 6f70 5f63 6f64 6f6e 273a 0a20 2020 2020  op_codon':.     
-0008cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cc20: 2020 2063 6e74 5b31 5d20 2b3d 2031 0a20     cnt[1] += 1. 
-0008cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cc40: 2020 2069 6620 2863 6e74 5b30 5d20 3e20     if (cnt[0] > 
-0008cc50: 3029 2026 2028 636e 745b 315d 203e 2030  0) & (cnt[1] > 0
-0008cc60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0008cc70: 2020 2020 2020 2020 2020 2062 203d 2054             b = T
-0008cc80: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0008cc90: 2020 2020 2020 2020 2020 2020 6363 6e74              ccnt
-0008cca0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0008ccb0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0008ccc0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-0008ccd0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0008cce0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0008ccf0: 623a 206c 696e 6573 5f6e 6577 203d 206c  b: lines_new = l
-0008cd00: 696e 6573 5f6e 6577 202b 206c 696e 6573  ines_new + lines
-0008cd10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008cd20: 2067 636e 7420 2b3d 2031 0a20 2020 2020   gcnt += 1.     
-0008cd30: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0008cd40: 2020 2020 6966 206c 656e 286c 696e 6573      if len(lines
-0008cd50: 5f6e 6577 2920 3e20 303a 0a20 2020 2020  _new) > 0:.     
-0008cd60: 2020 2020 2020 2020 2020 2067 7466 5f6c             gtf_l
-0008cd70: 696e 6573 5f6c 7374 5f6e 6577 2e61 7070  ines_lst_new.app
-0008cd80: 656e 6428 6c69 6e65 735f 6e65 7729 0a20  end(lines_new). 
-0008cd90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0008cda0: 2020 2020 6966 206b 2531 3030 203d 3d20      if k%100 == 
-0008cdb0: 303a 2070 7269 6e74 2827 5c72 7061 7273  0: print('\rpars
-0008cdc0: 696e 6720 2e2e 2025 692f 2569 2028 2569  ing .. %i/%i (%i
-0008cdd0: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
-0008cde0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
-0008cdf0: 6363 6e74 2c20 6763 6e74 292c 2065 6e64  ccnt, gcnt), end
-0008ce00: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
-0008ce10: 6520 290a 0a20 2020 2070 7269 6e74 2827  e )..    print('
-0008ce20: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
-0008ce30: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
-0008ce40: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
-0008ce50: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
-0008ce60: 292c 2066 6c75 7368 203d 2054 7275 6520  ), flush = True 
-0008ce70: 290a 2020 2020 7072 696e 7428 2753 6f72  ).    print('Sor
-0008ce80: 7469 6e67 202e 2e20 272c 2065 6e64 3d27  ting .. ', end='
-0008ce90: 2729 0a20 2020 2067 7466 5f6c 696e 6573  ').    gtf_lines
-0008cea0: 5f6c 7374 5f6e 6577 203d 2073 6f72 745f  _lst_new = sort_
-0008ceb0: 6774 665f 6c69 6e65 735f 6c73 7428 6774  gtf_lines_lst(gt
-0008cec0: 665f 6c69 6e65 735f 6c73 745f 6e65 7729  f_lines_lst_new)
-0008ced0: 0a20 2020 2070 7269 6e74 2827 5c72 536f  .    print('\rSo
-0008cee0: 7274 696e 6720 2e2e 2064 6f6e 6527 290a  rting .. done').
-0008cef0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0008cf00: 2067 7466 5f6c 696e 6573 5f6e 6577 203d   gtf_lines_new =
-0008cf10: 205b 5d0a 2020 2020 666f 7220 6c69 6e65   [].    for line
-0008cf20: 7320 696e 2067 7466 5f6c 696e 6573 5f6c  s in gtf_lines_l
-0008cf30: 7374 5f6e 6577 3a0a 2020 2020 2020 2020  st_new:.        
-0008cf40: 6774 665f 6c69 6e65 735f 6e65 7720 3d20  gtf_lines_new = 
-0008cf50: 6774 665f 6c69 6e65 735f 6e65 7720 2b20  gtf_lines_new + 
-0008cf60: 6c69 6e65 730a 2020 2020 2020 2020 0a20  lines.        . 
-0008cf70: 2020 2066 6e61 6d65 203d 2066 6e61 6d65     fname = fname
-0008cf80: 202b 2027 5f63 6473 2e67 7466 270a 2020   + '_cds.gtf'.  
-0008cf90: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
-0008cfa0: 2e2e 2027 2c20 656e 643d 2727 290a 2020  .. ', end='').  
-0008cfb0: 2020 7361 7665 5f67 7466 2820 666e 616d    save_gtf( fnam
-0008cfc0: 652c 2067 7466 5f6c 696e 6573 5f6e 6577  e, gtf_lines_new
-0008cfd0: 2c20 6864 725f 6c69 6e65 7320 290a 2020  , hdr_lines ).  
-0008cfe0: 2020 7072 696e 7428 275c 7253 6176 696e    print('\rSavin
-0008cff0: 6720 2e2e 2064 6f6e 6527 290a 2020 2020  g .. done').    
-0008d000: 0a20 2020 2072 6574 7572 6e20 666e 616d  .    return fnam
-0008d010: 650a 2020 2020 0a0a 6465 6620 7365 6c65  e.    ..def sele
-0008d020: 6374 5f63 6872 5f66 726f 6d5f 6774 665f  ct_chr_from_gtf_
-0008d030: 6669 6c65 2867 7466 5f66 696c 652c 2063  file(gtf_file, c
-0008d040: 6872 6d73 203d 205b 5d29 3a0a 0a20 2020  hrms = []):..   
-0008d050: 2066 6e73 203d 2067 7466 5f66 696c 652e   fns = gtf_file.
-0008d060: 7370 6c69 7428 272e 2729 5b3a 2d31 5d0a  split('.')[:-1].
-0008d070: 2020 2020 666e 616d 6520 3d20 2727 0a20      fname = ''. 
-0008d080: 2020 2066 6f72 206b 2c20 666e 2069 6e20     for k, fn in 
-0008d090: 656e 756d 6572 6174 6528 666e 7329 3a0a  enumerate(fns):.
-0008d0a0: 2020 2020 2020 2020 6966 206b 203e 2030          if k > 0
-0008d0b0: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
-0008d0c0: 616d 6520 3d20 666e 616d 6520 2b20 272e  ame = fname + '.
-0008d0d0: 270a 2020 2020 2020 2020 666e 616d 6520  '.        fname 
-0008d0e0: 3d20 666e 616d 6520 2b20 666e 0a20 2020  = fname + fn.   
-0008d0f0: 200a 2020 2020 6774 665f 6c69 6e65 732c   .    gtf_lines,
-0008d100: 2068 6472 5f6c 696e 6573 203d 206c 6f61   hdr_lines = loa
-0008d110: 645f 6774 6628 6774 665f 6669 6c65 2c20  d_gtf(gtf_file, 
-0008d120: 7665 7262 6f73 6520 3d20 5472 7565 290a  verbose = True).
-0008d130: 2020 2020 0a20 2020 2067 7466 5f6c 696e      .    gtf_lin
-0008d140: 6573 5f6c 7374 203d 2070 6172 7365 5f67  es_lst = parse_g
-0008d150: 7466 5f6c 696e 6573 5f61 6e64 5f73 706c  tf_lines_and_spl
-0008d160: 6974 5f69 6e74 6f5f 6765 6e65 7328 2067  it_into_genes( g
-0008d170: 7466 5f6c 696e 6573 2029 0a0a 2020 2020  tf_lines )..    
-0008d180: 6774 665f 6c69 6e65 735f 6c73 745f 6e65  gtf_lines_lst_ne
-0008d190: 7720 3d20 5b5d 0a20 2020 2063 636e 7420  w = [].    ccnt 
-0008d1a0: 3d20 300a 2020 2020 6763 6e74 203d 2030  = 0.    gcnt = 0
-0008d1b0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-0008d1c0: 6365 2863 6872 6d73 2c20 7374 7229 3a0a  ce(chrms, str):.
-0008d1d0: 2020 2020 2020 2020 666f 7220 6b2c 206c          for k, l
-0008d1e0: 696e 6573 2069 6e20 656e 756d 6572 6174  ines in enumerat
-0008d1f0: 6528 6774 665f 6c69 6e65 735f 6c73 7429  e(gtf_lines_lst)
-0008d200: 3a0a 2020 2020 2020 2020 2020 2020 6220  :.            b 
-0008d210: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0008d220: 2020 2020 6966 206c 696e 6573 5b30 5d2e      if lines[0].
-0008d230: 6368 7220 3d3d 2063 6872 6d3a 200a 2020  chr == chrm: .  
-0008d240: 2020 2020 2020 2020 2020 2020 2020 6220                b 
-0008d250: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0008d260: 2020 2020 2020 2063 636e 7420 2b3d 2031         ccnt += 1
-0008d270: 0a20 2020 2020 2020 2020 2020 2067 636e  .            gcn
-0008d280: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-0008d290: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0008d2a0: 6966 206b 2531 3030 203d 3d20 303a 2070  if k%100 == 0: p
-0008d2b0: 7269 6e74 2827 5c72 7061 7273 696e 6720  rint('\rparsing 
-0008d2c0: 2e2e 2025 692f 2569 2028 2569 2f25 6929  .. %i/%i (%i/%i)
-0008d2d0: 2720 2520 286b 2c20 6c65 6e28 6774 665f  ' % (k, len(gtf_
-0008d2e0: 6c69 6e65 735f 6c73 7429 2c20 6363 6e74  lines_lst), ccnt
-0008d2f0: 2c20 6763 6e74 292c 2065 6e64 3d27 272c  , gcnt), end='',
-0008d300: 2066 6c75 7368 203d 2054 7275 6520 290a   flush = True ).
-0008d310: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-0008d320: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0008d330: 2020 2067 7466 5f6c 696e 6573 5f6c 7374     gtf_lines_lst
-0008d340: 5f6e 6577 2e61 7070 656e 6428 6c69 6e65  _new.append(line
-0008d350: 7329 0a20 2020 2065 6c73 653a 0a20 2020  s).    else:.   
-0008d360: 2020 2020 2066 6f72 2063 6872 6d20 696e       for chrm in
-0008d370: 2063 6872 6d73 3a0a 2020 2020 2020 2020   chrms:.        
-0008d380: 2020 2020 666f 7220 6b2c 206c 696e 6573      for k, lines
-0008d390: 2069 6e20 656e 756d 6572 6174 6528 6774   in enumerate(gt
-0008d3a0: 665f 6c69 6e65 735f 6c73 7429 3a0a 2020  f_lines_lst):.  
-0008d3b0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
-0008d3c0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0008d3d0: 2020 2020 2020 2020 6966 206c 696e 6573          if lines
-0008d3e0: 5b30 5d2e 6368 7220 3d3d 2063 6872 6d3a  [0].chr == chrm:
-0008d3f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0008d400: 2020 2020 2020 6220 3d20 5472 7565 0a20        b = True. 
-0008d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d420: 2020 2063 636e 7420 2b3d 2031 0a20 2020     ccnt += 1.   
-0008d430: 2020 2020 2020 2020 2020 2020 2067 636e               gcn
-0008d440: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-0008d450: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0008d460: 2020 2020 2020 2020 6966 206b 2531 3030          if k%100
-0008d470: 203d 3d20 303a 2070 7269 6e74 2827 5c72   == 0: print('\r
-0008d480: 7061 7273 696e 6720 2e2e 2025 692f 2569  parsing .. %i/%i
-0008d490: 2028 2569 2f25 6929 2720 2520 286b 2c20   (%i/%i)' % (k, 
-0008d4a0: 6c65 6e28 6774 665f 6c69 6e65 735f 6c73  len(gtf_lines_ls
-0008d4b0: 7429 2c20 6363 6e74 2c20 6763 6e74 292c  t), ccnt, gcnt),
-0008d4c0: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
-0008d4d0: 2054 7275 6520 290a 2020 2020 2020 2020   True ).        
-0008d4e0: 2020 2020 2020 2020 6966 2062 3a20 0a20          if b: . 
-0008d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d500: 2020 2067 7466 5f6c 696e 6573 5f6c 7374     gtf_lines_lst
-0008d510: 5f6e 6577 2e61 7070 656e 6428 6c69 6e65  _new.append(line
-0008d520: 7329 0a20 2020 2020 2020 2063 6872 6d20  s).        chrm 
-0008d530: 3d20 6368 726d 735b 305d 0a20 2020 2020  = chrms[0].     
-0008d540: 2020 2066 6f72 2063 2069 6e20 6368 726d     for c in chrm
-0008d550: 735b 313a 5d3a 0a20 2020 2020 2020 2020  s[1:]:.         
-0008d560: 2020 2063 6872 6d20 3d20 6368 726d 202b     chrm = chrm +
-0008d570: 2027 2c25 7327 2025 2063 0a20 2020 2020   ',%s' % c.     
-0008d580: 2020 2020 2020 200a 2020 2020 7072 696e         .    prin
-0008d590: 7428 275c 7270 6172 7369 6e67 202e 2e20  t('\rparsing .. 
-0008d5a0: 646f 6e65 2025 692f 2569 2028 2569 2f25  done %i/%i (%i/%
-0008d5b0: 6929 2720 2520 286b 2c20 6c65 6e28 6774  i)' % (k, len(gt
-0008d5c0: 665f 6c69 6e65 735f 6c73 7429 2c20 6363  f_lines_lst), cc
-0008d5d0: 6e74 2c20 6763 6e74 292c 2066 6c75 7368  nt, gcnt), flush
-0008d5e0: 203d 2054 7275 6520 290a 2020 2020 0a20   = True ).    . 
-0008d5f0: 2020 2070 7269 6e74 2827 536f 7274 696e     print('Sortin
-0008d600: 6720 2e2e 2027 2c20 656e 643d 2727 290a  g .. ', end='').
-0008d610: 2020 2020 6774 665f 6c69 6e65 735f 6c73      gtf_lines_ls
-0008d620: 745f 6e65 7720 3d20 736f 7274 5f67 7466  t_new = sort_gtf
-0008d630: 5f6c 696e 6573 5f6c 7374 2867 7466 5f6c  _lines_lst(gtf_l
-0008d640: 696e 6573 5f6c 7374 5f6e 6577 290a 2020  ines_lst_new).  
-0008d650: 2020 7072 696e 7428 275c 7253 6f72 7469    print('\rSorti
-0008d660: 6e67 202e 2e20 646f 6e65 2729 0a20 2020  ng .. done').   
-0008d670: 2020 2020 2020 2020 200a 2020 2020 6774           .    gt
-0008d680: 665f 6c69 6e65 735f 6e65 7720 3d20 5b5d  f_lines_new = []
-0008d690: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
-0008d6a0: 6e20 6774 665f 6c69 6e65 735f 6c73 745f  n gtf_lines_lst_
-0008d6b0: 6e65 773a 0a20 2020 2020 2020 2067 7466  new:.        gtf
-0008d6c0: 5f6c 696e 6573 5f6e 6577 203d 2067 7466  _lines_new = gtf
-0008d6d0: 5f6c 696e 6573 5f6e 6577 202b 206c 696e  _lines_new + lin
-0008d6e0: 6573 0a20 2020 200a 2020 2020 7072 696e  es.    .    prin
-0008d6f0: 7428 2753 6176 696e 6720 2e2e 2027 2c20  t('Saving .. ', 
-0008d700: 656e 643d 2727 290a 2020 2020 666e 616d  end='').    fnam
-0008d710: 6520 3d20 666e 616d 6520 2b20 275f 7365  e = fname + '_se
-0008d720: 6c5f 2573 2e67 7466 2720 2520 6368 726d  l_%s.gtf' % chrm
-0008d730: 0a20 2020 2073 6176 655f 6774 6628 2066  .    save_gtf( f
-0008d740: 6e61 6d65 2c20 6774 665f 6c69 6e65 735f  name, gtf_lines_
-0008d750: 6e65 772c 2068 6472 5f6c 696e 6573 2029  new, hdr_lines )
-0008d760: 0a20 2020 2070 7269 6e74 2827 5c72 5361  .    print('\rSa
-0008d770: 7669 6e67 202e 2e20 646f 6e65 2729 0a20  ving .. done'). 
-0008d780: 2020 200a 2020 2020 7265 7475 726e 2066     .    return f
-0008d790: 6e61 6d65 0a20 2020 200a 0a23 2323 2323  name.    ..#####
-0008d7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d7e0: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
-0008d7f0: 2046 756e 6374 696f 6e73 2074 6f20 6861   Functions to ha
-0008d800: 6e64 6c65 2073 696d 756c 6174 6564 2072  ndle simulated r
-0008d810: 6561 6473 2028 6164 6420 7472 6172 6563  eads (add trarec
-0008d820: 6f20 6865 6164 6572 2c20 7370 6c69 7420  o header, split 
-0008d830: 6661 7374 5129 0a23 2323 2323 2323 2323  fastQ).#########
-0008d840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c5a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c5b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c5c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c5d0: 2323 2323 2323 2323 0a23 2320 4675 6e63  ########.## Func
+0008c5e0: 7469 6f6e 7320 746f 2028 3129 2073 656c  tions to (1) sel
+0008c5f0: 6563 7420 7370 6563 6966 6963 2063 6872  ect specific chr
+0008c600: 6d20 616e 6420 2832 2920 6f6e 6c79 2063  m and (2) only c
+0008c610: 6f64 696e 6720 6765 6e65 7320 696e 2061  oding genes in a
+0008c620: 2047 5446 0a23 2323 2323 2323 2323 2323   GTF.###########
+0008c630: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c640: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c660: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c670: 2323 2323 2323 230a 0a64 6566 2073 6f72  #######..def sor
+0008c680: 745f 6774 665f 6c69 6e65 735f 6c73 7428  t_gtf_lines_lst(
+0008c690: 6774 665f 6c69 6e65 735f 6c73 7429 3a0a  gtf_lines_lst):.
+0008c6a0: 2020 2020 0a20 2020 2063 6872 7320 3d20      .    chrs = 
+0008c6b0: 5b5d 0a20 2020 2066 6f72 206c 696e 6573  [].    for lines
+0008c6c0: 2069 6e20 6774 665f 6c69 6e65 735f 6c73   in gtf_lines_ls
+0008c6d0: 743a 0a20 2020 2020 2020 2066 6972 7374  t:.        first
+0008c6e0: 5f6c 696e 6520 3d20 6c69 6e65 735b 305d  _line = lines[0]
+0008c6f0: 0a20 2020 2020 2020 2063 6872 732e 6170  .        chrs.ap
+0008c700: 7065 6e64 2866 6972 7374 5f6c 696e 652e  pend(first_line.
+0008c710: 6368 7229 0a0a 2020 2020 6368 725f 7365  chr)..    chr_se
+0008c720: 7420 3d20 6c69 7374 2873 6574 2863 6872  t = list(set(chr
+0008c730: 7329 290a 2020 2020 6368 725f 7365 742e  s)).    chr_set.
+0008c740: 736f 7274 2829 0a20 2020 2063 6872 7320  sort().    chrs 
+0008c750: 3d20 6e70 2e61 7272 6179 2863 6872 7329  = np.array(chrs)
+0008c760: 0a0a 2020 2020 6774 665f 6c73 745f 6e65  ..    gtf_lst_ne
+0008c770: 7720 3d20 5b5d 0a20 2020 2066 6f72 2063  w = [].    for c
+0008c780: 2069 6e20 6368 725f 7365 743a 0a20 2020   in chr_set:.   
+0008c790: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
+0008c7a0: 6368 7273 203d 3d20 6329 0a20 2020 2020  chrs == c).     
+0008c7b0: 2020 2070 7320 3d20 6e70 2e61 7272 6179     ps = np.array
+0008c7c0: 2820 5b67 7466 5f6c 696e 6573 5f6c 7374  ( [gtf_lines_lst
+0008c7d0: 5b77 5d5b 305d 2e73 7461 7274 2066 6f72  [w][0].start for
+0008c7e0: 2077 2069 6e20 7768 5d20 290a 2020 2020   w in wh] ).    
+0008c7f0: 2020 2020 6f64 7232 203d 2070 732e 6172      odr2 = ps.ar
+0008c800: 6773 6f72 7428 290a 2020 2020 2020 2020  gsort().        
+0008c810: 666f 7220 6f20 696e 206f 6472 323a 0a20  for o in odr2:. 
+0008c820: 2020 2020 2020 2020 2020 2077 203d 2077             w = w
+0008c830: 685b 6f5d 0a20 2020 2020 2020 2020 2020  h[o].           
+0008c840: 2067 7466 5f6c 7374 5f6e 6577 2e61 7070   gtf_lst_new.app
+0008c850: 656e 6428 6774 665f 6c69 6e65 735f 6c73  end(gtf_lines_ls
+0008c860: 745b 775d 290a 2020 2020 2020 2020 0a20  t[w]).        . 
+0008c870: 2020 2072 6574 7572 6e20 6774 665f 6c73     return gtf_ls
+0008c880: 745f 6e65 770a 0a0a 6465 6620 7365 6c65  t_new...def sele
+0008c890: 6374 5f63 6f64 696e 675f 6765 6e65 735f  ct_coding_genes_
+0008c8a0: 6672 6f6d 5f67 7466 5f66 696c 6528 6774  from_gtf_file(gt
+0008c8b0: 665f 6669 6c65 2c20 6765 6e6f 6d65 5f66  f_file, genome_f
+0008c8c0: 696c 6529 3a0a 0a20 2020 2066 6e73 203d  ile):..    fns =
+0008c8d0: 2067 7466 5f66 696c 652e 7370 6c69 7428   gtf_file.split(
+0008c8e0: 272e 2729 5b3a 2d31 5d0a 2020 2020 666e  '.')[:-1].    fn
+0008c8f0: 616d 6520 3d20 2727 0a20 2020 2066 6f72  ame = ''.    for
+0008c900: 206b 2c20 666e 2069 6e20 656e 756d 6572   k, fn in enumer
+0008c910: 6174 6528 666e 7329 3a0a 2020 2020 2020  ate(fns):.      
+0008c920: 2020 6966 206b 203e 2030 3a0a 2020 2020    if k > 0:.    
+0008c930: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
+0008c940: 666e 616d 6520 2b20 272e 270a 2020 2020  fname + '.'.    
+0008c950: 2020 2020 666e 616d 6520 3d20 666e 616d      fname = fnam
+0008c960: 6520 2b20 666e 0a20 2020 200a 2020 2020  e + fn.    .    
+0008c970: 6774 665f 6c69 6e65 732c 2068 6472 5f6c  gtf_lines, hdr_l
+0008c980: 696e 6573 203d 206c 6f61 645f 6774 6628  ines = load_gtf(
+0008c990: 6774 665f 6669 6c65 2c20 7665 7262 6f73  gtf_file, verbos
+0008c9a0: 6520 3d20 5472 7565 290a 2020 2020 0a20  e = True).    . 
+0008c9b0: 2020 2062 6173 655f 6364 7320 3d20 6765     base_cds = ge
+0008c9c0: 745f 6261 7365 5f63 6473 5f66 726f 6d5f  t_base_cds_from_
+0008c9d0: 6774 665f 6c69 6e65 7328 6774 665f 6c69  gtf_lines(gtf_li
+0008c9e0: 6e65 7329 0a20 2020 2069 6620 6261 7365  nes).    if base
+0008c9f0: 5f63 6473 203c 2030 3a0a 2020 2020 2020  _cds < 0:.      
+0008ca00: 2020 7072 696e 7428 2749 4e46 4f3a 204e    print('INFO: N
+0008ca10: 6f20 636f 6469 6e67 2069 6e66 6f72 6d61  o coding informa
+0008ca20: 7469 6f6e 2070 726f 7669 6465 6420 696e  tion provided in
+0008ca30: 2074 6865 2047 5446 2f47 4646 2e27 290a   the GTF/GFF.').
+0008ca40: 2020 2020 0a20 2020 2067 7466 5f6c 696e      .    gtf_lin
+0008ca50: 6573 5f6c 7374 203d 2070 6172 7365 5f67  es_lst = parse_g
+0008ca60: 7466 5f6c 696e 6573 5f61 6e64 5f73 706c  tf_lines_and_spl
+0008ca70: 6974 5f69 6e74 6f5f 6765 6e65 7328 2067  it_into_genes( g
+0008ca80: 7466 5f6c 696e 6573 2029 0a20 2020 2067  tf_lines ).    g
+0008ca90: 656e 6f6d 6520 3d20 6c6f 6164 5f67 656e  enome = load_gen
+0008caa0: 6f6d 6528 6765 6e6f 6d65 5f66 696c 6529  ome(genome_file)
+0008cab0: 0a20 2020 2063 6872 7320 3d20 6765 6e6f  .    chrs = geno
+0008cac0: 6d65 2e6b 6579 7328 290a 0a20 2020 2067  me.keys()..    g
+0008cad0: 7466 5f6c 696e 6573 5f6c 7374 5f6e 6577  tf_lines_lst_new
+0008cae0: 203d 205b 5d0a 2020 2020 6363 6e74 203d   = [].    ccnt =
+0008caf0: 2030 0a20 2020 2067 636e 7420 3d20 300a   0.    gcnt = 0.
+0008cb00: 2020 2020 666f 7220 6b2c 2067 6c69 6e65      for k, gline
+0008cb10: 7320 696e 2065 6e75 6d65 7261 7465 2867  s in enumerate(g
+0008cb20: 7466 5f6c 696e 6573 5f6c 7374 293a 0a0a  tf_lines_lst):..
+0008cb30: 2020 2020 2020 2020 6966 2020 676c 696e          if  glin
+0008cb40: 6573 5b30 5d2e 6368 7220 696e 2063 6872  es[0].chr in chr
+0008cb50: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
+0008cb60: 725f 6c69 6e65 735f 6c73 7420 3d20 7061  r_lines_lst = pa
+0008cb70: 7273 655f 6774 665f 6c69 6e65 735f 616e  rse_gtf_lines_an
+0008cb80: 645f 7370 6c69 745f 696e 746f 5f67 656e  d_split_into_gen
+0008cb90: 6573 2820 676c 696e 6573 2c20 2774 7261  es( glines, 'tra
+0008cba0: 6e73 6372 6970 7427 2029 0a20 2020 2020  nscript' ).     
+0008cbb0: 2020 2020 2020 206c 696e 6573 5f6e 6577         lines_new
+0008cbc0: 203d 205b 5d0a 0a20 2020 2020 2020 2020   = []..         
+0008cbd0: 2020 2066 6f72 206c 696e 6573 2069 6e20     for lines in 
+0008cbe0: 7472 5f6c 696e 6573 5f6c 7374 3a0a 2020  tr_lines_lst:.  
+0008cbf0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
+0008cc00: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0008cc10: 2020 2020 2020 2020 636e 7420 3d20 5b30          cnt = [0
+0008cc20: 2c30 5d0a 2020 2020 2020 2020 2020 2020  ,0].            
+0008cc30: 2020 2020 666f 7220 6774 666c 696e 6520      for gtfline 
+0008cc40: 696e 206c 696e 6573 3a0a 2020 2020 2020  in lines:.      
+0008cc50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0008cc60: 2067 7466 6c69 6e65 2e66 6561 7475 7265   gtfline.feature
+0008cc70: 203d 3d20 2773 7461 7274 5f63 6f64 6f6e   == 'start_codon
+0008cc80: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0008cc90: 2020 2020 2020 2020 2020 2063 6e74 5b30             cnt[0
+0008cca0: 5d20 2b3d 2031 0a20 2020 2020 2020 2020  ] += 1.         
+0008ccb0: 2020 2020 2020 2020 2020 2069 6620 6774             if gt
+0008ccc0: 666c 696e 652e 6665 6174 7572 6520 3d3d  fline.feature ==
+0008ccd0: 2027 7374 6f70 5f63 6f64 6f6e 273a 0a20   'stop_codon':. 
+0008cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008ccf0: 2020 2020 2020 2063 6e74 5b31 5d20 2b3d         cnt[1] +=
+0008cd00: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0008cd10: 2020 2020 2020 2069 6620 2863 6e74 5b30         if (cnt[0
+0008cd20: 5d20 3e20 3029 2026 2028 636e 745b 315d  ] > 0) & (cnt[1]
+0008cd30: 203e 2030 293a 0a20 2020 2020 2020 2020   > 0):.         
+0008cd40: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0008cd50: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0008cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cd70: 6363 6e74 202b 3d20 310a 2020 2020 2020  ccnt += 1.      
+0008cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cd90: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0008cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008cdc0: 2069 6620 623a 206c 696e 6573 5f6e 6577   if b: lines_new
+0008cdd0: 203d 206c 696e 6573 5f6e 6577 202b 206c   = lines_new + l
+0008cde0: 696e 6573 0a20 2020 2020 2020 2020 2020  ines.           
+0008cdf0: 2020 2020 2067 636e 7420 2b3d 2031 0a20       gcnt += 1. 
+0008ce00: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0008ce10: 2020 2020 2020 2020 6966 206c 656e 286c          if len(l
+0008ce20: 696e 6573 5f6e 6577 2920 3e20 303a 0a20  ines_new) > 0:. 
+0008ce30: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0008ce40: 7466 5f6c 696e 6573 5f6c 7374 5f6e 6577  tf_lines_lst_new
+0008ce50: 2e61 7070 656e 6428 6c69 6e65 735f 6e65  .append(lines_ne
+0008ce60: 7729 0a20 2020 2020 2020 2020 2020 200a  w).            .
+0008ce70: 2020 2020 2020 2020 6966 206b 2531 3030          if k%100
+0008ce80: 203d 3d20 303a 2070 7269 6e74 2827 5c72   == 0: print('\r
+0008ce90: 7061 7273 696e 6720 2e2e 2025 692f 2569  parsing .. %i/%i
+0008cea0: 2028 2569 2f25 6929 2720 2520 286b 2c20   (%i/%i)' % (k, 
+0008ceb0: 6c65 6e28 6774 665f 6c69 6e65 735f 6c73  len(gtf_lines_ls
+0008cec0: 7429 2c20 6363 6e74 2c20 6763 6e74 292c  t), ccnt, gcnt),
+0008ced0: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
+0008cee0: 2054 7275 6520 290a 0a20 2020 2070 7269   True )..    pri
+0008cef0: 6e74 2827 5c72 7061 7273 696e 6720 2e2e  nt('\rparsing ..
+0008cf00: 2025 692f 2569 2028 2569 2f25 6929 2720   %i/%i (%i/%i)' 
+0008cf10: 2520 286b 2c20 6c65 6e28 6774 665f 6c69  % (k, len(gtf_li
+0008cf20: 6e65 735f 6c73 7429 2c20 6363 6e74 2c20  nes_lst), ccnt, 
+0008cf30: 6763 6e74 292c 2066 6c75 7368 203d 2054  gcnt), flush = T
+0008cf40: 7275 6520 290a 2020 2020 7072 696e 7428  rue ).    print(
+0008cf50: 2753 6f72 7469 6e67 202e 2e20 272c 2065  'Sorting .. ', e
+0008cf60: 6e64 3d27 2729 0a20 2020 2067 7466 5f6c  nd='').    gtf_l
+0008cf70: 696e 6573 5f6c 7374 5f6e 6577 203d 2073  ines_lst_new = s
+0008cf80: 6f72 745f 6774 665f 6c69 6e65 735f 6c73  ort_gtf_lines_ls
+0008cf90: 7428 6774 665f 6c69 6e65 735f 6c73 745f  t(gtf_lines_lst_
+0008cfa0: 6e65 7729 0a20 2020 2070 7269 6e74 2827  new).    print('
+0008cfb0: 5c72 536f 7274 696e 6720 2e2e 2064 6f6e  \rSorting .. don
+0008cfc0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+0008cfd0: 0a20 2020 2067 7466 5f6c 696e 6573 5f6e  .    gtf_lines_n
+0008cfe0: 6577 203d 205b 5d0a 2020 2020 666f 7220  ew = [].    for 
+0008cff0: 6c69 6e65 7320 696e 2067 7466 5f6c 696e  lines in gtf_lin
+0008d000: 6573 5f6c 7374 5f6e 6577 3a0a 2020 2020  es_lst_new:.    
+0008d010: 2020 2020 6774 665f 6c69 6e65 735f 6e65      gtf_lines_ne
+0008d020: 7720 3d20 6774 665f 6c69 6e65 735f 6e65  w = gtf_lines_ne
+0008d030: 7720 2b20 6c69 6e65 730a 2020 2020 2020  w + lines.      
+0008d040: 2020 0a20 2020 2066 6e61 6d65 203d 2066    .    fname = f
+0008d050: 6e61 6d65 202b 2027 5f63 6473 2e67 7466  name + '_cds.gtf
+0008d060: 270a 2020 2020 7072 696e 7428 2753 6176  '.    print('Sav
+0008d070: 696e 6720 2e2e 2027 2c20 656e 643d 2727  ing .. ', end=''
+0008d080: 290a 2020 2020 7361 7665 5f67 7466 2820  ).    save_gtf( 
+0008d090: 666e 616d 652c 2067 7466 5f6c 696e 6573  fname, gtf_lines
+0008d0a0: 5f6e 6577 2c20 6864 725f 6c69 6e65 7320  _new, hdr_lines 
+0008d0b0: 290a 2020 2020 7072 696e 7428 275c 7253  ).    print('\rS
+0008d0c0: 6176 696e 6720 2e2e 2064 6f6e 6527 290a  aving .. done').
+0008d0d0: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
+0008d0e0: 666e 616d 650a 2020 2020 0a0a 6465 6620  fname.    ..def 
+0008d0f0: 7365 6c65 6374 5f63 6872 5f66 726f 6d5f  select_chr_from_
+0008d100: 6774 665f 6669 6c65 2867 7466 5f66 696c  gtf_file(gtf_fil
+0008d110: 652c 2063 6872 6d73 203d 205b 5d29 3a0a  e, chrms = []):.
+0008d120: 0a20 2020 2066 6e73 203d 2067 7466 5f66  .    fns = gtf_f
+0008d130: 696c 652e 7370 6c69 7428 272e 2729 5b3a  ile.split('.')[:
+0008d140: 2d31 5d0a 2020 2020 666e 616d 6520 3d20  -1].    fname = 
+0008d150: 2727 0a20 2020 2066 6f72 206b 2c20 666e  ''.    for k, fn
+0008d160: 2069 6e20 656e 756d 6572 6174 6528 666e   in enumerate(fn
+0008d170: 7329 3a0a 2020 2020 2020 2020 6966 206b  s):.        if k
+0008d180: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0008d190: 2020 666e 616d 6520 3d20 666e 616d 6520    fname = fname 
+0008d1a0: 2b20 272e 270a 2020 2020 2020 2020 666e  + '.'.        fn
+0008d1b0: 616d 6520 3d20 666e 616d 6520 2b20 666e  ame = fname + fn
+0008d1c0: 0a20 2020 200a 2020 2020 6774 665f 6c69  .    .    gtf_li
+0008d1d0: 6e65 732c 2068 6472 5f6c 696e 6573 203d  nes, hdr_lines =
+0008d1e0: 206c 6f61 645f 6774 6628 6774 665f 6669   load_gtf(gtf_fi
+0008d1f0: 6c65 2c20 7665 7262 6f73 6520 3d20 5472  le, verbose = Tr
+0008d200: 7565 290a 2020 2020 0a20 2020 2067 7466  ue).    .    gtf
+0008d210: 5f6c 696e 6573 5f6c 7374 203d 2070 6172  _lines_lst = par
+0008d220: 7365 5f67 7466 5f6c 696e 6573 5f61 6e64  se_gtf_lines_and
+0008d230: 5f73 706c 6974 5f69 6e74 6f5f 6765 6e65  _split_into_gene
+0008d240: 7328 2067 7466 5f6c 696e 6573 2029 0a0a  s( gtf_lines )..
+0008d250: 2020 2020 6774 665f 6c69 6e65 735f 6c73      gtf_lines_ls
+0008d260: 745f 6e65 7720 3d20 5b5d 0a20 2020 2063  t_new = [].    c
+0008d270: 636e 7420 3d20 300a 2020 2020 6763 6e74  cnt = 0.    gcnt
+0008d280: 203d 2030 0a20 2020 2069 6620 6973 696e   = 0.    if isin
+0008d290: 7374 616e 6365 2863 6872 6d73 2c20 7374  stance(chrms, st
+0008d2a0: 7229 3a0a 2020 2020 2020 2020 666f 7220  r):.        for 
+0008d2b0: 6b2c 206c 696e 6573 2069 6e20 656e 756d  k, lines in enum
+0008d2c0: 6572 6174 6528 6774 665f 6c69 6e65 735f  erate(gtf_lines_
+0008d2d0: 6c73 7429 3a0a 2020 2020 2020 2020 2020  lst):.          
+0008d2e0: 2020 6220 3d20 4661 6c73 650a 2020 2020    b = False.    
+0008d2f0: 2020 2020 2020 2020 6966 206c 696e 6573          if lines
+0008d300: 5b30 5d2e 6368 7220 3d3d 2063 6872 6d3a  [0].chr == chrm:
+0008d310: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0008d320: 2020 6220 3d20 5472 7565 0a20 2020 2020    b = True.     
+0008d330: 2020 2020 2020 2020 2020 2063 636e 7420             ccnt 
+0008d340: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0008d350: 2067 636e 7420 2b3d 2031 0a20 2020 2020   gcnt += 1.     
+0008d360: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0008d370: 2020 2020 6966 206b 2531 3030 203d 3d20      if k%100 == 
+0008d380: 303a 2070 7269 6e74 2827 5c72 7061 7273  0: print('\rpars
+0008d390: 696e 6720 2e2e 2025 692f 2569 2028 2569  ing .. %i/%i (%i
+0008d3a0: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
+0008d3b0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
+0008d3c0: 6363 6e74 2c20 6763 6e74 292c 2065 6e64  ccnt, gcnt), end
+0008d3d0: 3d27 272c 2066 6c75 7368 203d 2054 7275  ='', flush = Tru
+0008d3e0: 6520 290a 2020 2020 2020 2020 2020 2020  e ).            
+0008d3f0: 6966 2062 3a20 0a20 2020 2020 2020 2020  if b: .         
+0008d400: 2020 2020 2020 2067 7466 5f6c 696e 6573         gtf_lines
+0008d410: 5f6c 7374 5f6e 6577 2e61 7070 656e 6428  _lst_new.append(
+0008d420: 6c69 6e65 7329 0a20 2020 2065 6c73 653a  lines).    else:
+0008d430: 0a20 2020 2020 2020 2066 6f72 2063 6872  .        for chr
+0008d440: 6d20 696e 2063 6872 6d73 3a0a 2020 2020  m in chrms:.    
+0008d450: 2020 2020 2020 2020 666f 7220 6b2c 206c          for k, l
+0008d460: 696e 6573 2069 6e20 656e 756d 6572 6174  ines in enumerat
+0008d470: 6528 6774 665f 6c69 6e65 735f 6c73 7429  e(gtf_lines_lst)
+0008d480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0008d490: 2020 6220 3d20 4661 6c73 650a 2020 2020    b = False.    
+0008d4a0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0008d4b0: 696e 6573 5b30 5d2e 6368 7220 3d3d 2063  ines[0].chr == c
+0008d4c0: 6872 6d3a 200a 2020 2020 2020 2020 2020  hrm: .          
+0008d4d0: 2020 2020 2020 2020 2020 6220 3d20 5472            b = Tr
+0008d4e0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0008d4f0: 2020 2020 2020 2063 636e 7420 2b3d 2031         ccnt += 1
+0008d500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d510: 2067 636e 7420 2b3d 2031 0a20 2020 2020   gcnt += 1.     
+0008d520: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0008d530: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+0008d540: 2531 3030 203d 3d20 303a 2070 7269 6e74  %100 == 0: print
+0008d550: 2827 5c72 7061 7273 696e 6720 2e2e 2025  ('\rparsing .. %
+0008d560: 692f 2569 2028 2569 2f25 6929 2720 2520  i/%i (%i/%i)' % 
+0008d570: 286b 2c20 6c65 6e28 6774 665f 6c69 6e65  (k, len(gtf_line
+0008d580: 735f 6c73 7429 2c20 6363 6e74 2c20 6763  s_lst), ccnt, gc
+0008d590: 6e74 292c 2065 6e64 3d27 272c 2066 6c75  nt), end='', flu
+0008d5a0: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
+0008d5b0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+0008d5c0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0008d5d0: 2020 2020 2020 2067 7466 5f6c 696e 6573         gtf_lines
+0008d5e0: 5f6c 7374 5f6e 6577 2e61 7070 656e 6428  _lst_new.append(
+0008d5f0: 6c69 6e65 7329 0a20 2020 2020 2020 2063  lines).        c
+0008d600: 6872 6d20 3d20 6368 726d 735b 305d 0a20  hrm = chrms[0]. 
+0008d610: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
+0008d620: 6368 726d 735b 313a 5d3a 0a20 2020 2020  chrms[1:]:.     
+0008d630: 2020 2020 2020 2063 6872 6d20 3d20 6368         chrm = ch
+0008d640: 726d 202b 2027 2c25 7327 2025 2063 0a20  rm + ',%s' % c. 
+0008d650: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0008d660: 7072 696e 7428 275c 7270 6172 7369 6e67  print('\rparsing
+0008d670: 202e 2e20 646f 6e65 2025 692f 2569 2028   .. done %i/%i (
+0008d680: 2569 2f25 6929 2720 2520 286b 2c20 6c65  %i/%i)' % (k, le
+0008d690: 6e28 6774 665f 6c69 6e65 735f 6c73 7429  n(gtf_lines_lst)
+0008d6a0: 2c20 6363 6e74 2c20 6763 6e74 292c 2066  , ccnt, gcnt), f
+0008d6b0: 6c75 7368 203d 2054 7275 6520 290a 2020  lush = True ).  
+0008d6c0: 2020 0a20 2020 2070 7269 6e74 2827 536f    .    print('So
+0008d6d0: 7274 696e 6720 2e2e 2027 2c20 656e 643d  rting .. ', end=
+0008d6e0: 2727 290a 2020 2020 6774 665f 6c69 6e65  '').    gtf_line
+0008d6f0: 735f 6c73 745f 6e65 7720 3d20 736f 7274  s_lst_new = sort
+0008d700: 5f67 7466 5f6c 696e 6573 5f6c 7374 2867  _gtf_lines_lst(g
+0008d710: 7466 5f6c 696e 6573 5f6c 7374 5f6e 6577  tf_lines_lst_new
+0008d720: 290a 2020 2020 7072 696e 7428 275c 7253  ).    print('\rS
+0008d730: 6f72 7469 6e67 202e 2e20 646f 6e65 2729  orting .. done')
+0008d740: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0008d750: 2020 6774 665f 6c69 6e65 735f 6e65 7720    gtf_lines_new 
+0008d760: 3d20 5b5d 0a20 2020 2066 6f72 206c 696e  = [].    for lin
+0008d770: 6573 2069 6e20 6774 665f 6c69 6e65 735f  es in gtf_lines_
+0008d780: 6c73 745f 6e65 773a 0a20 2020 2020 2020  lst_new:.       
+0008d790: 2067 7466 5f6c 696e 6573 5f6e 6577 203d   gtf_lines_new =
+0008d7a0: 2067 7466 5f6c 696e 6573 5f6e 6577 202b   gtf_lines_new +
+0008d7b0: 206c 696e 6573 0a20 2020 200a 2020 2020   lines.    .    
+0008d7c0: 7072 696e 7428 2753 6176 696e 6720 2e2e  print('Saving ..
+0008d7d0: 2027 2c20 656e 643d 2727 290a 2020 2020   ', end='').    
+0008d7e0: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
+0008d7f0: 275f 7365 6c5f 2573 2e67 7466 2720 2520  '_sel_%s.gtf' % 
+0008d800: 6368 726d 0a20 2020 2073 6176 655f 6774  chrm.    save_gt
+0008d810: 6628 2066 6e61 6d65 2c20 6774 665f 6c69  f( fname, gtf_li
+0008d820: 6e65 735f 6e65 772c 2068 6472 5f6c 696e  nes_new, hdr_lin
+0008d830: 6573 2029 0a20 2020 2070 7269 6e74 2827  es ).    print('
+0008d840: 5c72 5361 7669 6e67 202e 2e20 646f 6e65  \rSaving .. done
+0008d850: 2729 0a20 2020 200a 2020 2020 7265 7475  ').    .    retu
+0008d860: 726e 2066 6e61 6d65 0a20 2020 200a 0a23  rn fname.    ..#
 0008d870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d880: 2323 2323 2323 2323 230a 0a64 6566 2066  #########..def f
-0008d890: 6173 7461 5f61 6464 5f74 7261 7265 636f  asta_add_trareco
-0008d8a0: 5f68 6561 6465 7228 2072 6566 5f74 722c  _header( ref_tr,
-0008d8b0: 2073 696d 5f70 726f 6669 6c65 2c20 7265   sim_profile, re
-0008d8c0: 6164 5f6c 656e 2c20 7375 6666 6978 203d  ad_len, suffix =
-0008d8d0: 204e 6f6e 652c 2063 6f76 5f74 6820 3d20   None, cov_th = 
-0008d8e0: 302e 3820 293a 0a20 2020 200a 2020 2020  0.8 ):.    .    
-0008d8f0: 636f 6c6e 616d 6573 203d 205b 276c 6f63  colnames = ['loc
-0008d900: 272c 2027 7469 6427 2c20 2763 6f64 696e  ', 'tid', 'codin
-0008d910: 6727 2c20 276c 656e 6774 6827 2c20 2765  g', 'length', 'e
-0008d920: 7870 5f66 7261 6327 2c20 2765 7870 5f6e  xp_frac', 'exp_n
-0008d930: 756d 272c 2027 6c69 625f 6672 6163 272c  um', 'lib_frac',
-0008d940: 2027 6c69 625f 6e75 6d27 2c20 5c0a 2020   'lib_num', \.  
-0008d950: 2020 2020 2020 2020 2020 2020 2020 2773                's
-0008d960: 6571 5f66 7261 6327 2c20 2773 6571 5f6e  eq_frac', 'seq_n
-0008d970: 756d 272c 2027 636f 765f 6672 6163 272c  um', 'cov_frac',
-0008d980: 2027 6368 6932 272c 2027 5663 6f65 6627   'chi2', 'Vcoef'
-0008d990: 5d0a 2020 2020 6466 5f70 726f 203d 2070  ].    df_pro = p
-0008d9a0: 642e 7265 6164 5f63 7376 2873 696d 5f70  d.read_csv(sim_p
-0008d9b0: 726f 6669 6c65 2c20 7365 703d 275c 7427  rofile, sep='\t'
-0008d9c0: 2c20 6865 6164 6572 203d 204e 6f6e 652c  , header = None,
-0008d9d0: 2069 6e64 6578 5f63 6f6c 203d 2031 2c20   index_col = 1, 
-0008d9e0: 6e61 6d65 7320 3d20 636f 6c6e 616d 6573  names = colnames
-0008d9f0: 290a 0a20 2020 2072 6566 203d 206c 6f61  )..    ref = loa
-0008da00: 645f 6661 7374 6128 7265 665f 7472 290a  d_fasta(ref_tr).
-0008da10: 0a20 2020 2064 665f 7072 6f5b 2761 626e  .    df_pro['abn
-0008da20: 275d 203d 2064 665f 7072 6f5b 2773 6571  '] = df_pro['seq
-0008da30: 5f6e 756d 275d 2a72 6561 645f 6c65 6e2f  _num']*read_len/
-0008da40: 6466 5f70 726f 5b27 6c65 6e67 7468 275d  df_pro['length']
-0008da50: 0a20 2020 2064 665f 7072 6f5b 2774 706d  .    df_pro['tpm
-0008da60: 275d 203d 2064 665f 7072 6f5b 2761 626e  '] = df_pro['abn
-0008da70: 275d 2a31 3030 3030 3030 2f28 6466 5f70  ']*1000000/(df_p
-0008da80: 726f 5b27 6162 6e27 5d2e 7375 6d28 2929  ro['abn'].sum())
-0008da90: 0a0a 2020 2020 6466 5f69 6478 203d 206e  ..    df_idx = n
-0008daa0: 702e 6172 7261 7928 6466 5f70 726f 2e69  p.array(df_pro.i
-0008dab0: 6e64 6578 2e76 616c 7565 732e 746f 6c69  ndex.values.toli
-0008dac0: 7374 2829 290a 2020 2020 636e 745f 6475  st()).    cnt_du
-0008dad0: 7020 3d20 300a 2020 2020 666f 7220 6b65  p = 0.    for ke
-0008dae0: 7920 696e 206c 6973 7428 7265 662e 6b65  y in list(ref.ke
-0008daf0: 7973 2829 293a 0a20 2020 2020 2020 2069  ys()):.        i
-0008db00: 6620 286b 6579 2069 6e20 6466 5f69 6478  f (key in df_idx
-0008db10: 2920 2620 286e 702e 7375 6d28 6466 5f69  ) & (np.sum(df_i
-0008db20: 6478 203d 3d20 6b65 7929 203d 3d20 3129  dx == key) == 1)
-0008db30: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0008db40: 2064 665f 7072 6f2e 6c6f 635b 6b65 795d   df_pro.loc[key]
-0008db50: 2e63 6f76 5f66 7261 6320 3e3d 2063 6f76  .cov_frac >= cov
-0008db60: 5f74 683a 0a20 2020 2020 2020 2020 2020  _th:.           
-0008db70: 2020 2020 2072 6566 5b6b 6579 5d2e 6865       ref[key].he
-0008db80: 6164 6572 203d 2027 2573 2063 6f76 5f66  ader = '%s cov_f
-0008db90: 7261 633a 2566 2061 626e 3a25 6620 7470  rac:%f abn:%f tp
-0008dba0: 6d3a 2566 2720 2520 2872 6566 5b6b 6579  m:%f' % (ref[key
-0008dbb0: 5d2e 6865 6164 6572 2c20 6466 5f70 726f  ].header, df_pro
-0008dbc0: 2e6c 6f63 5b6b 6579 5d2e 636f 765f 6672  .loc[key].cov_fr
-0008dbd0: 6163 2c20 6466 5f70 726f 2e6c 6f63 5b6b  ac, df_pro.loc[k
-0008dbe0: 6579 5d2e 6162 6e2c 2064 665f 7072 6f2e  ey].abn, df_pro.
-0008dbf0: 6c6f 635b 6b65 795d 2e74 706d 290a 2020  loc[key].tpm).  
-0008dc00: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0008dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008dc20: 7265 662e 706f 7028 6b65 7929 0a20 2020  ref.pop(key).   
-0008dc30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0008dc40: 2020 2020 2020 2069 6620 6466 5f70 726f         if df_pro
-0008dc50: 2e6c 6f63 5b6b 6579 5d2e 7368 6170 655b  .loc[key].shape[
-0008dc60: 305d 203e 2031 3a20 636e 745f 6475 7020  0] > 1: cnt_dup 
-0008dc70: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-0008dc80: 2072 6566 2e70 6f70 286b 6579 290a 0a20   ref.pop(key).. 
-0008dc90: 2020 2066 6e61 6d65 2c20 6578 7420 3d20     fname, ext = 
-0008dca0: 6765 745f 6669 6c65 5f6e 616d 6528 7265  get_file_name(re
-0008dcb0: 665f 7472 290a 2020 2020 6966 2073 7566  f_tr).    if suf
-0008dcc0: 6669 7820 6973 204e 6f6e 653a 0a20 2020  fix is None:.   
-0008dcd0: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-0008dce0: 6d65 202b 2027 5f63 6f76 2569 2e27 2025  me + '_cov%i.' %
-0008dcf0: 2069 6e74 2863 6f76 5f74 682a 3130 3029   int(cov_th*100)
-0008dd00: 202b 2065 7874 0a20 2020 2065 6c73 653a   + ext.    else:
-0008dd10: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
-0008dd20: 2066 6e61 6d65 202b 2027 5f25 735f 636f   fname + '_%s_co
-0008dd30: 7625 692e 2720 2520 2873 7566 6669 782c  v%i.' % (suffix,
-0008dd40: 2069 6e74 2863 6f76 5f74 682a 3130 3029   int(cov_th*100)
-0008dd50: 2920 2b20 6578 740a 0a20 2020 2073 6176  ) + ext..    sav
-0008dd60: 655f 6661 7374 6128 666e 616d 652c 2072  e_fasta(fname, r
-0008dd70: 6566 2c20 7469 746c 6520 3d20 666e 616d  ef, title = fnam
-0008dd80: 6529 0a20 2020 200a 0a64 6566 206c 6f61  e).    ..def loa
-0008dd90: 645f 6661 7374 7128 6669 6c65 5f67 656e  d_fastq(file_gen
-0008dda0: 6f6d 652c 2076 6572 626f 7365 203d 2046  ome, verbose = F
-0008ddb0: 616c 7365 2029 3a0a 0a20 2020 2067 656e  alse ):..    gen
-0008ddc0: 6f6d 6520 3d20 6469 6374 2829 0a20 2020  ome = dict().   
-0008ddd0: 2066 203d 206f 7065 6e28 6669 6c65 5f67   f = open(file_g
-0008dde0: 656e 6f6d 652c 2027 7227 290a 2020 2020  enome, 'r').    
-0008ddf0: 7363 6e74 203d 2030 0a20 2020 2070 7269  scnt = 0.    pri
-0008de00: 6e74 2827 5c72 4c6f 6164 696e 6720 6661  nt('\rLoading fa
-0008de10: 7374 5120 2e2e 2027 2c20 656e 643d 2727  stQ .. ', end=''
-0008de20: 2c20 666c 7573 683d 5472 7565 290a 2020  , flush=True).  
-0008de30: 2020 636e 7420 3d20 300a 2020 2020 666f    cnt = 0.    fo
-0008de40: 7220 6c69 6e65 2069 6e20 6620 3a0a 2020  r line in f :.  
-0008de50: 2020 2020 2020 6966 206c 696e 655b 305d        if line[0]
-0008de60: 203d 3d20 2740 273a 0a20 2020 2020 2020   == '@':.       
-0008de70: 2020 2020 2069 6620 636e 7420 3d3d 2034       if cnt == 4
-0008de80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0008de90: 2020 6765 6e6f 6d65 5b73 636e 745d 203d    genome[scnt] =
-0008dea0: 2047 656e 6f6d 6528 6864 722c 2073 6571   Genome(hdr, seq
-0008deb0: 2c20 7175 616c 290a 2020 2020 2020 2020  , qual).        
-0008dec0: 2020 2020 2020 2020 7363 6e74 202b 3d20          scnt += 
-0008ded0: 310a 2020 2020 2020 2020 2020 2020 636e  1.            cn
-0008dee0: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-0008def0: 2020 6864 7220 3d20 6c69 6e65 5b31 3a2d    hdr = line[1:-
-0008df00: 315d 0a20 2020 2020 2020 2020 2020 2063  1].            c
-0008df10: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008df20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0008df30: 2020 6966 2063 6e74 203d 3d20 313a 0a20    if cnt == 1:. 
-0008df40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008df50: 6571 203d 206c 696e 655b 3a2d 315d 0a20  eq = line[:-1]. 
-0008df60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0008df70: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008df80: 2020 2020 656c 6966 2063 6e74 203d 3d20      elif cnt == 
-0008df90: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-0008dfa0: 2020 2069 6620 6c69 6e65 5b30 5d20 3d3d     if line[0] ==
-0008dfb0: 2027 2b27 3a0a 2020 2020 2020 2020 2020   '+':.          
-0008dfc0: 2020 2020 2020 2020 2020 6964 7220 3d20            idr = 
-0008dfd0: 6c69 6e65 5b31 3a2d 315d 0a20 2020 2020  line[1:-1].     
-0008dfe0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0008dff0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008e000: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0008e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e020: 2020 7072 696e 7428 2745 5252 4f52 2069    print('ERROR i
-0008e030: 6e20 6661 7374 5120 6669 6c65 2729 0a20  n fastQ file'). 
-0008e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e050: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-0008e060: 2020 2020 2065 6c69 6620 636e 7420 3d3d       elif cnt ==
-0008e070: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
-0008e080: 2020 2020 7175 616c 203d 206c 696e 655b      qual = line[
-0008e090: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
-0008e0a0: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
-0008e0b0: 2020 6966 2063 6e74 203e 2030 3a0a 2020    if cnt > 0:.  
-0008e0c0: 2020 2020 2020 6765 6e6f 6d65 5b73 636e        genome[scn
-0008e0d0: 745d 203d 2047 656e 6f6d 6528 6864 722c  t] = Genome(hdr,
-0008e0e0: 2073 6571 2c20 7175 616c 290a 2020 2020   seq, qual).    
-0008e0f0: 2020 2020 7363 6e74 202b 3d20 310a 2020      scnt += 1.  
-0008e100: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0008e110: 2020 2070 7269 6e74 2827 5c72 4c6f 6164     print('\rLoad
-0008e120: 696e 6720 6661 7374 5120 2e2e 2064 6f6e  ing fastQ .. don
-0008e130: 652e 2020 4e75 6d2e 5365 7120 3d20 272c  e.  Num.Seq = ',
-0008e140: 2073 636e 742c 2027 2020 2027 2c20 666c   scnt, '   ', fl
-0008e150: 7573 683d 5472 7565 290a 2020 2020 662e  ush=True).    f.
-0008e160: 636c 6f73 6528 290a 2020 2020 7265 7475  close().    retu
-0008e170: 726e 2867 656e 6f6d 6529 0a0a 0a64 6566  rn(genome)...def
-0008e180: 2073 6176 655f 6661 7374 7128 2066 696c   save_fastq( fil
-0008e190: 655f 6765 6e6f 6d65 2c20 6765 6e6f 6d65  e_genome, genome
-0008e1a0: 5f64 6963 742c 2076 6572 626f 7365 203d  _dict, verbose =
-0008e1b0: 2046 616c 7365 2c20 7469 746c 6520 3d20   False, title = 
-0008e1c0: 2766 6173 7451 2720 293a 0a0a 2020 2020  'fastQ' ):..    
-0008e1d0: 7072 696e 7428 2753 6176 696e 6720 2573  print('Saving %s
-0008e1e0: 202e 2e27 2025 2074 6974 6c65 2c20 656e   ..' % title, en
-0008e1f0: 643d 2727 2c20 666c 7573 683d 5472 7565  d='', flush=True
-0008e200: 290a 2020 2020 2320 666f 7220 6720 696e  ).    # for g in
-0008e210: 2067 656e 6f6d 655f 6c73 7420 3a0a 2020   genome_lst :.  
-0008e220: 2020 4b65 7973 203d 2067 656e 6f6d 655f    Keys = genome_
-0008e230: 6469 6374 2e6b 6579 7328 290a 2020 2020  dict.keys().    
-0008e240: 6620 3d20 6f70 656e 2866 696c 655f 6765  f = open(file_ge
-0008e250: 6e6f 6d65 2c20 2777 742b 2729 0a20 2020  nome, 'wt+').   
-0008e260: 206c 696e 655f 6c73 7420 3d20 5b5d 0a20   line_lst = []. 
-0008e270: 2020 2066 6f72 206b 6579 2069 6e20 4b65     for key in Ke
-0008e280: 7973 3a0a 2020 2020 2020 2020 2320 7072  ys:.        # pr
-0008e290: 696e 7428 275c 7253 6176 696e 6720 2573  int('\rSaving %s
-0008e2a0: 202e 2e20 2573 2720 2520 2874 6974 6c65   .. %s' % (title
-0008e2b0: 2c20 6b65 7929 2c20 656e 643d 2720 2020  , key), end='   
-0008e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008e2d0: 2027 290a 2020 2020 2020 2020 6720 3d20   ').        g = 
-0008e2e0: 6765 6e6f 6d65 5f64 6963 745b 6b65 795d  genome_dict[key]
-0008e2f0: 0a20 2020 2020 2020 2073 203d 2027 4025  .        s = '@%
-0008e300: 735c 6e27 2025 2067 2e68 6561 6465 720a  s\n' % g.header.
-0008e310: 2020 2020 2020 2020 6c69 6e65 5f6c 7374          line_lst
-0008e320: 2e61 7070 656e 6428 7329 0a20 2020 2020  .append(s).     
-0008e330: 2020 206c 696e 655f 6c73 742e 6170 7065     line_lst.appe
-0008e340: 6e64 2867 2e73 6571 2e75 7070 6572 2829  nd(g.seq.upper()
-0008e350: 202b 2027 5c6e 2729 0a20 2020 2020 2020   + '\n').       
-0008e360: 206c 696e 655f 6c73 742e 6170 7065 6e64   line_lst.append
-0008e370: 2827 2b5c 6e27 290a 2020 2020 2020 2020  ('+\n').        
-0008e380: 6c69 6e65 5f6c 7374 2e61 7070 656e 6428  line_lst.append(
-0008e390: 672e 7175 616c 202b 2027 5c6e 2729 0a20  g.qual + '\n'). 
-0008e3a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0008e3b0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0008e3c0: 7428 272e 272c 2065 6e64 3d27 272c 2066  t('.', end='', f
-0008e3d0: 6c75 7368 3d54 7275 6529 0a0a 2020 2020  lush=True)..    
-0008e3e0: 662e 7772 6974 656c 696e 6573 2827 272e  f.writelines(''.
-0008e3f0: 6a6f 696e 286c 696e 655f 6c73 7429 290a  join(line_lst)).
-0008e400: 2020 2020 2020 2020 0a20 2020 2070 7269          .    pri
-0008e410: 6e74 2827 5c72 5361 7669 6e67 2025 7320  nt('\rSaving %s 
-0008e420: 2e2e 2064 6f6e 652e 2028 2569 2920 2020  .. done. (%i)   
-0008e430: 2020 2020 2020 2020 2020 2020 2027 2025               ' %
-0008e440: 2028 7469 746c 652c 206c 656e 284b 6579   (title, len(Key
-0008e450: 7329 292c 2066 6c75 7368 3d54 7275 6529  s)), flush=True)
-0008e460: 0a20 2020 2066 2e63 6c6f 7365 2829 0a20  .    f.close(). 
-0008e470: 2020 200a 0a20 2020 200a 6465 6620 6661     ..    .def fa
-0008e480: 7374 615f 7369 6d5f 7265 6164 5f73 706c  sta_sim_read_spl
-0008e490: 6974 2820 7369 6d5f 7265 6164 2c20 6473  it( sim_read, ds
-0008e4a0: 7220 3d20 3120 293a 0a20 2020 200a 2020  r = 1 ):.    .  
-0008e4b0: 2020 666e 616d 652c 2065 7874 203d 2067    fname, ext = g
-0008e4c0: 6574 5f70 6174 685f 6e61 6d65 2873 696d  et_path_name(sim
-0008e4d0: 5f72 6561 6429 0a0a 2020 2020 6661 5f61  _read)..    fa_a
-0008e4e0: 6c6c 203d 206c 6f61 645f 6661 7374 7128  ll = load_fastq(
-0008e4f0: 7369 6d5f 7265 6164 290a 2020 2020 0a20  sim_read).    . 
-0008e500: 2020 2066 6131 203d 207b 7d0a 2020 2020     fa1 = {}.    
-0008e510: 6661 3220 3d20 7b7d 0a20 2020 2063 6e74  fa2 = {}.    cnt
-0008e520: 203d 2030 0a20 2020 2063 6e74 5f31 203d   = 0.    cnt_1 =
-0008e530: 2030 0a20 2020 2063 6e74 5f32 203d 2030   0.    cnt_2 = 0
-0008e540: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
-0008e550: 6661 5f61 6c6c 2e6b 6579 7328 293a 0a20  fa_all.keys():. 
-0008e560: 2020 2020 2020 2066 615f 616c 6c5b 6b65         fa_all[ke
-0008e570: 795d 2e68 6561 6465 7220 3d20 6661 5f61  y].header = fa_a
-0008e580: 6c6c 5b6b 6579 5d2e 6865 6164 6572 5b3a  ll[key].header[:
-0008e590: 2d34 5d0a 2020 2020 2020 2020 6966 2063  -4].        if c
-0008e5a0: 6e74 2532 203d 3d20 303a 0a20 2020 2020  nt%2 == 0:.     
-0008e5b0: 2020 2020 2020 2069 6620 636e 745f 3125         if cnt_1%
-0008e5c0: 6473 7220 3d3d 2030 3a0a 2020 2020 2020  dsr == 0:.      
-0008e5d0: 2020 2020 2020 2020 2020 6661 5f61 6c6c            fa_all
-0008e5e0: 5b6b 6579 5d2e 6865 6164 6572 203d 2066  [key].header = f
-0008e5f0: 615f 616c 6c5b 6b65 795d 2e68 6561 6465  a_all[key].heade
-0008e600: 722e 7370 6c69 7428 2720 2729 5b30 5d20  r.split(' ')[0] 
-0008e610: 2b20 272f 3127 0a20 2020 2020 2020 2020  + '/1'.         
-0008e620: 2020 2020 2020 2066 6131 5b6b 6579 5d20         fa1[key] 
-0008e630: 3d20 6661 5f61 6c6c 5b6b 6579 5d0a 2020  = fa_all[key].  
-0008e640: 2020 2020 2020 2020 2020 636e 745f 3120            cnt_1 
-0008e650: 2b3d 2031 0a20 2020 2020 2020 2065 6c73  += 1.        els
-0008e660: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0008e670: 6620 636e 745f 3225 6473 7220 3d3d 2030  f cnt_2%dsr == 0
-0008e680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0008e690: 2020 6661 5f61 6c6c 5b6b 6579 5d2e 6865    fa_all[key].he
-0008e6a0: 6164 6572 203d 2066 615f 616c 6c5b 6b65  ader = fa_all[ke
-0008e6b0: 795d 2e68 6561 6465 722e 7370 6c69 7428  y].header.split(
-0008e6c0: 2720 2729 5b30 5d20 2b20 272f 3227 0a20  ' ')[0] + '/2'. 
-0008e6d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0008e6e0: 6132 5b6b 6579 5d20 3d20 6661 5f61 6c6c  a2[key] = fa_all
-0008e6f0: 5b6b 6579 5d0a 2020 2020 2020 2020 2020  [key].          
-0008e700: 2020 636e 745f 3220 2b3d 2031 0a0a 2020    cnt_2 += 1..  
-0008e710: 2020 2020 2020 636e 7420 2b3d 2031 0a0a        cnt += 1..
-0008e720: 2020 2020 6966 2064 7372 203d 3d20 313a      if dsr == 1:
-0008e730: 0a20 2020 2020 2020 2066 6e31 203d 2066  .        fn1 = f
-0008e740: 6e61 6d65 202b 2027 5f31 2e27 202b 2065  name + '_1.' + e
-0008e750: 7874 0a20 2020 2020 2020 2066 6e32 203d  xt.        fn2 =
-0008e760: 2066 6e61 6d65 202b 2027 5f32 2e27 202b   fname + '_2.' +
-0008e770: 2065 7874 0a20 2020 2065 6c73 653a 0a20   ext.    else:. 
-0008e780: 2020 2020 2020 2066 6e31 203d 2066 6e61         fn1 = fna
-0008e790: 6d65 202b 2028 275f 6473 2569 2720 2520  me + ('_ds%i' % 
-0008e7a0: 6473 7229 202b 2027 5f31 2e27 202b 2065  dsr) + '_1.' + e
-0008e7b0: 7874 0a20 2020 2020 2020 2066 6e32 203d  xt.        fn2 =
-0008e7c0: 2066 6e61 6d65 202b 2028 275f 6473 2569   fname + ('_ds%i
-0008e7d0: 2720 2520 6473 7229 202b 2027 5f32 2e27  ' % dsr) + '_2.'
-0008e7e0: 202b 2065 7874 0a20 2020 2073 6176 655f   + ext.    save_
-0008e7f0: 6661 7374 7128 666e 312c 2066 6131 290a  fastq(fn1, fa1).
-0008e800: 2020 2020 7361 7665 5f66 6173 7471 2866      save_fastq(f
-0008e810: 6e32 2c20 6661 3229 0a20 2020 200a 0a64  n2, fa2).    ..d
-0008e820: 6566 2066 6173 7461 5f73 696d 5f72 6561  ef fasta_sim_rea
-0008e830: 645f 646f 776e 7361 6d70 6c65 2820 7369  d_downsample( si
-0008e840: 6d5f 7265 6164 2c20 6473 7220 3d20 3120  m_read, dsr = 1 
-0008e850: 293a 0a20 2020 200a 2020 2020 666e 616d  ):.    .    fnam
-0008e860: 652c 2065 7874 203d 2067 6574 5f70 6174  e, ext = get_pat
-0008e870: 685f 6e61 6d65 2873 696d 5f72 6561 6429  h_name(sim_read)
-0008e880: 0a0a 2020 2020 6661 5f61 6c6c 203d 206c  ..    fa_all = l
-0008e890: 6f61 645f 6661 7374 7128 7369 6d5f 7265  oad_fastq(sim_re
-0008e8a0: 6164 290a 2020 2020 0a20 2020 2066 6120  ad).    .    fa 
-0008e8b0: 3d20 7b7d 0a20 2020 2063 6e74 203d 2030  = {}.    cnt = 0
-0008e8c0: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
-0008e8d0: 6661 5f61 6c6c 2e6b 6579 7328 293a 0a20  fa_all.keys():. 
-0008e8e0: 2020 2020 2020 2023 2066 615f 616c 6c5b         # fa_all[
-0008e8f0: 6b65 795d 2e68 6561 6465 7220 3d20 6661  key].header = fa
-0008e900: 5f61 6c6c 5b6b 6579 5d2e 6865 6164 6572  _all[key].header
-0008e910: 5b3a 2d34 5d0a 2020 2020 2020 2020 6966  [:-4].        if
-0008e920: 2063 6e74 2564 7372 203d 3d20 303a 0a20   cnt%dsr == 0:. 
-0008e930: 2020 2020 2020 2020 2020 2023 2066 615f             # fa_
-0008e940: 616c 6c5b 6b65 795d 2e68 6561 6465 7220  all[key].header 
-0008e950: 3d20 6661 5f61 6c6c 5b6b 6579 5d2e 6865  = fa_all[key].he
-0008e960: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
-0008e970: 2066 615b 6b65 795d 203d 2066 615f 616c   fa[key] = fa_al
-0008e980: 6c5b 6b65 795d 0a20 2020 2020 2020 2063  l[key].        c
-0008e990: 6e74 202b 3d20 310a 0a20 2020 2066 6e20  nt += 1..    fn 
-0008e9a0: 3d20 666e 616d 6520 2b20 2827 5f64 7325  = fname + ('_ds%
-0008e9b0: 692e 2720 2520 6473 7229 202b 2065 7874  i.' % dsr) + ext
-0008e9c0: 0a20 2020 2073 6176 655f 6661 7374 7128  .    save_fastq(
-0008e9d0: 666e 2c20 6661 290a 2020 2020 0a20 2020  fn, fa).    .   
-0008e9e0: 200a 2323 2323 2323 2323 2323 2323 2323   .##############
-0008e9f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea30: 2323 2323 0a23 2320 4675 6e63 7469 6f6e  ####.## Function
-0008ea40: 7320 746f 2061 6464 2053 4e56 2069 6e74  s to add SNV int
-0008ea50: 6f20 6120 6765 6e6f 6d65 0a23 2323 2323  o a genome.#####
-0008ea60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008ea90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008eaa0: 2323 2323 2323 2323 2323 2323 230a 0a53  #############..S
-0008eab0: 4e56 203d 2063 6f6c 6c65 6374 696f 6e73  NV = collections
-0008eac0: 2e6e 616d 6564 7475 706c 6528 2753 4e56  .namedtuple('SNV
-0008ead0: 272c 2027 6368 722c 2070 6f73 5f6e 6577  ', 'chr, pos_new
-0008eae0: 2c20 706f 735f 6f72 672c 2074 7970 652c  , pos_org, type,
-0008eaf0: 206c 656e 2c20 7365 715f 6e65 772c 2073   len, seq_new, s
-0008eb00: 6571 5f6f 7267 2c20 6578 5f73 7461 7274  eq_org, ex_start
-0008eb10: 2c20 6578 5f65 6e64 2729 0a0a 6465 6620  , ex_end')..def 
-0008eb20: 6765 745f 736e 765f 7479 7065 2870 692c  get_snv_type(pi,
-0008eb30: 2070 6429 3a0a 2020 2020 0a20 2020 2072   pd):.    .    r
-0008eb40: 6e20 3d20 6e70 2e72 616e 646f 6d2e 756e  n = np.random.un
-0008eb50: 6966 6f72 6d28 3130 3029 0a20 2020 2069  iform(100).    i
-0008eb60: 6620 726e 203c 2028 7069 2a31 3030 293a  f rn < (pi*100):
-0008eb70: 0a20 2020 2020 2020 2072 6574 7572 6e28  .        return(
-0008eb80: 3129 0a20 2020 2065 6c69 6620 726e 203c  1).    elif rn <
-0008eb90: 2028 7069 2b70 6929 2a31 3030 3a0a 2020   (pi+pi)*100:.  
-0008eba0: 2020 2020 2020 7265 7475 726e 2832 290a        return(2).
-0008ebb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0008ebc0: 2020 7265 7475 726e 2830 290a 2020 2020    return(0).    
-0008ebd0: 0a64 6566 2072 616e 645f 6e75 636c 656f  .def rand_nucleo
-0008ebe0: 7469 6465 5f65 7863 6570 7428 6e74 7329  tide_except(nts)
-0008ebf0: 3a0a 2020 2020 0a20 2020 206e 7473 5f6f  :.    .    nts_o
-0008ec00: 7574 203d 2027 270a 2020 2020 666f 7220  ut = ''.    for 
-0008ec10: 6e74 2069 6e20 6e74 733a 0a20 2020 2020  nt in nts:.     
-0008ec20: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
-0008ec30: 2020 2020 2020 2020 2020 2072 6e20 3d20             rn = 
-0008ec40: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
-0008ec50: 7428 302c 342c 3129 5b30 5d0a 2020 2020  t(0,4,1)[0].    
-0008ec60: 2020 2020 2020 2020 6e74 5f6e 6577 203d          nt_new =
-0008ec70: 204e 545f 6c73 745b 696e 7428 726e 295d   NT_lst[int(rn)]
-0008ec80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0008ec90: 6e74 5f6e 6577 2021 3d20 6e74 3a20 0a20  nt_new != nt: . 
-0008eca0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0008ecb0: 7473 5f6f 7574 203d 206e 7473 5f6f 7574  ts_out = nts_out
-0008ecc0: 202b 206e 745f 6e65 770a 2020 2020 2020   + nt_new.      
-0008ecd0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0008ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008ecf0: 2020 2020 0a20 2020 2072 6574 7572 6e28      .    return(
-0008ed00: 6e74 735f 6f75 7429 0a20 2020 2020 2020  nts_out).       
-0008ed10: 200a 6465 6620 7261 6e64 5f6e 7563 6c65   .def rand_nucle
-0008ed20: 6f74 6964 6573 286e 756d 293a 0a20 2020  otides(num):.   
-0008ed30: 200a 2020 2020 6e75 6d5f 7365 7120 3d20   .    num_seq = 
-0008ed40: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
-0008ed50: 7428 302c 342c 6e75 6d29 0a20 2020 206e  t(0,4,num).    n
-0008ed60: 745f 7374 7220 3d20 2727 2e6a 6f69 6e28  t_str = ''.join(
-0008ed70: 5b4e 545f 6c73 745b 6e5d 2066 6f72 206e  [NT_lst[n] for n
-0008ed80: 2069 6e20 6e75 6d5f 7365 715d 290a 2020   in num_seq]).  
-0008ed90: 2020 7265 7475 726e 286e 745f 7374 7229    return(nt_str)
-0008eda0: 0a0a 0a64 6566 2073 6176 655f 736e 765f  ...def save_snv_
-0008edb0: 696e 666f 5f6f 6c64 2820 6669 6c65 5f6e  info_old( file_n
-0008edc0: 616d 652c 2073 6e76 5f6c 7374 2c20 7665  ame, snv_lst, ve
-0008edd0: 7262 6f73 6520 3d20 4661 6c73 6520 293a  rbose = False ):
-0008ede0: 0a20 2020 200a 2020 2020 6620 3d20 6f70  .    .    f = op
-0008edf0: 656e 2866 696c 655f 6e61 6d65 2c20 2777  en(file_name, 'w
-0008ee00: 742b 2729 0a20 2020 2070 7269 6e74 2827  t+').    print('
-0008ee10: 5361 7669 6e67 2053 4e56 2069 6e66 6f2e  Saving SNV info.
-0008ee20: 2027 2c20 656e 643d 2727 290a 2020 2020   ', end='').    
-0008ee30: 7374 6570 203d 206e 702e 6365 696c 286c  step = np.ceil(l
-0008ee40: 656e 2873 6e76 5f6c 7374 292f 3230 290a  en(snv_lst)/20).
-0008ee50: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
-0008ee60: 6765 286c 656e 2873 6e76 5f6c 7374 2929  ge(len(snv_lst))
-0008ee70: 203a 0a20 2020 2020 2020 2073 6e76 203d   :.        snv =
-0008ee80: 2073 6e76 5f6c 7374 5b6b 5d0a 2020 2020   snv_lst[k].    
-0008ee90: 2020 2020 7320 3d20 2725 732c 2569 2c25      s = '%s,%i,%
-0008eea0: 692c 2573 2c25 692c 2573 2c25 735c 6e27  i,%s,%i,%s,%s\n'
-0008eeb0: 2025 205c 0a20 2020 2020 2020 2028 736e   % \.        (sn
-0008eec0: 762e 6368 722c 2073 6e76 2e70 6f73 5f6e  v.chr, snv.pos_n
-0008eed0: 6577 2c20 736e 762e 706f 735f 6f72 672c  ew, snv.pos_org,
-0008eee0: 2073 6e76 2e74 7970 652c 2073 6e76 2e6c   snv.type, snv.l
-0008eef0: 656e 2c20 736e 762e 7365 715f 6e65 772c  en, snv.seq_new,
-0008ef00: 2073 6e76 2e73 6571 5f6f 7267 2029 0a20   snv.seq_org ). 
-0008ef10: 2020 2020 2020 2066 2e77 7269 7465 6c69         f.writeli
-0008ef20: 6e65 7328 7329 0a20 2020 2020 2020 2069  nes(s).        i
-0008ef30: 6620 6b25 7374 6570 203d 3d20 303a 2070  f k%step == 0: p
-0008ef40: 7269 6e74 2827 2e27 2c65 6e64 3d27 2729  rint('.',end='')
-0008ef50: 0a20 2020 2020 2020 200a 2020 2020 7072  .        .    pr
-0008ef60: 696e 7428 2720 646f 6e65 2e20 2569 2073  int(' done. %i s
-0008ef70: 6e76 732e 2720 2520 6c65 6e28 736e 765f  nvs.' % len(snv_
-0008ef80: 6c73 7429 2029 0a20 2020 2066 2e63 6c6f  lst) ).    f.clo
-0008ef90: 7365 2829 0a0a 2020 2020 0a64 6566 2073  se()..    .def s
-0008efa0: 6176 655f 736e 765f 696e 666f 2820 6669  ave_snv_info( fi
-0008efb0: 6c65 5f6e 616d 652c 2073 6e76 5f6c 7374  le_name, snv_lst
-0008efc0: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
-0008efd0: 6520 293a 0a0a 2020 2020 6466 203d 2070  e ):..    df = p
-0008efe0: 642e 4461 7461 4672 616d 6528 736e 765f  d.DataFrame(snv_
-0008eff0: 6c73 7429 0a20 2020 2064 662e 746f 5f63  lst).    df.to_c
-0008f000: 7376 2866 696c 655f 6e61 6d65 2c20 696e  sv(file_name, in
-0008f010: 6465 783d 4661 6c73 652c 2073 6570 3d27  dex=False, sep='
-0008f020: 5c74 2729 0a0a 2020 2020 0a64 6566 2067  \t')..    .def g
-0008f030: 656e 6572 6174 655f 736e 765f 7769 7468  enerate_snv_with
-0008f040: 5f67 7466 2820 6765 6e6f 6d65 2c20 6774  _gtf( genome, gt
-0008f050: 665f 6c69 6e65 735f 736f 7274 6564 2c20  f_lines_sorted, 
-0008f060: 6d75 203d 2032 3030 2c20 6c69 203d 2033  mu = 200, li = 3
-0008f070: 2c20 6c64 203d 2033 2c20 6c76 203d 2032  , ld = 3, lv = 2
-0008f080: 2c20 7069 203d 2030 2e31 2c20 7064 203d  , pi = 0.1, pd =
-0008f090: 2030 2e31 2029 3a0a 2020 2020 0a20 2020   0.1 ):.    .   
-0008f0a0: 2070 7620 3d20 3120 2d20 7069 202d 2070   pv = 1 - pi - p
-0008f0b0: 640a 2020 2020 7072 696e 7428 6765 6e6f  d.    print(geno
-0008f0c0: 6d65 2e6e 616d 652c 2065 6e64 3d27 2027  me.name, end=' '
-0008f0d0: 290a 2020 2020 736e 765f 6c73 7420 3d20  ).    snv_lst = 
-0008f0e0: 5b5d 0a20 2020 2063 7572 5f70 6f73 5f6f  [].    cur_pos_o
-0008f0f0: 7267 203d 2030 0a20 2020 2063 7572 5f70  rg = 0.    cur_p
-0008f100: 6f73 5f6e 6577 203d 2063 7572 5f70 6f73  os_new = cur_pos
-0008f110: 5f6f 7267 0a20 2020 2073 6571 5f6e 6577  _org.    seq_new
-0008f120: 203d 2027 270a 2020 2020 7365 715f 6c73   = ''.    seq_ls
-0008f130: 7420 3d20 5b5d 0a20 2020 204d 6172 6769  t = [].    Margi
-0008f140: 6e20 3d20 6d61 7828 6c69 2c6d 6178 286c  n = max(li,max(l
-0008f150: 642c 6c76 2929 0a20 2020 200a 2020 2020  d,lv)).    .    
-0008f160: 7374 6570 203d 206e 702e 6365 696c 2867  step = np.ceil(g
-0008f170: 656e 6f6d 652e 6c65 6e2f 6d75 2f32 3030  enome.len/mu/200
-0008f180: 290a 2020 2020 0a20 2020 2063 6e74 203d  ).    .    cnt =
-0008f190: 2030 0a20 2020 2066 6f72 206c 696e 6520   0.    for line 
-0008f1a0: 696e 2067 7466 5f6c 696e 6573 5f73 6f72  in gtf_lines_sor
-0008f1b0: 7465 643a 0a20 2020 2020 2020 200a 2020  ted:.        .  
-0008f1c0: 2020 2020 2020 2320 6469 6666 203d 2063        # diff = c
-0008f1d0: 7572 5f70 6f73 5f6e 6577 202d 2063 7572  ur_pos_new - cur
-0008f1e0: 5f70 6f73 5f6f 7267 0a20 2020 2020 2020  _pos_org.       
-0008f1f0: 2053 7461 7274 203d 206c 696e 652e 7374   Start = line.st
-0008f200: 6172 740a 2020 2020 2020 2020 456e 6420  art.        End 
-0008f210: 3d20 6c69 6e65 2e65 6e64 0a20 2020 2020  = line.end.     
-0008f220: 2020 204c 203d 206e 702e 7261 6e64 6f6d     L = np.random
-0008f230: 2e72 616e 6469 6e74 2830 2c6d 752f 322c  .randint(0,mu/2,
-0008f240: 3129 5b30 5d0a 2020 2020 2020 2020 6966  1)[0].        if
-0008f250: 2063 7572 5f70 6f73 5f6f 7267 203c 2028   cur_pos_org < (
-0008f260: 6c69 6e65 2e73 7461 7274 2d31 2b4c 293a  line.start-1+L):
-0008f270: 0a20 2020 2020 2020 2020 2020 206e 6578  .            nex
-0008f280: 745f 706f 735f 6f72 6720 3d20 6c69 6e65  t_pos_org = line
-0008f290: 2e73 7461 7274 2d31 2b4c 0a20 2020 2020  .start-1+L.     
-0008f2a0: 2020 2020 2020 2073 6571 5f6c 7374 2e61         seq_lst.a
-0008f2b0: 7070 656e 6428 6765 6e6f 6d65 2e73 6571  ppend(genome.seq
-0008f2c0: 5b69 6e74 2863 7572 5f70 6f73 5f6f 7267  [int(cur_pos_org
-0008f2d0: 293a 696e 7428 6e65 7874 5f70 6f73 5f6f  ):int(next_pos_o
-0008f2e0: 7267 295d 290a 2020 2020 2020 2020 2020  rg)]).          
-0008f2f0: 2020 6375 725f 706f 735f 6e65 7720 2b3d    cur_pos_new +=
-0008f300: 2028 6e65 7874 5f70 6f73 5f6f 7267 2d63   (next_pos_org-c
-0008f310: 7572 5f70 6f73 5f6f 7267 290a 2020 2020  ur_pos_org).    
-0008f320: 2020 2020 2020 2020 6375 725f 706f 735f          cur_pos_
-0008f330: 6f72 6720 3d20 6e65 7874 5f70 6f73 5f6f  org = next_pos_o
-0008f340: 7267 0a20 2020 2020 2020 200a 2020 2020  rg.        .    
-0008f350: 2020 2020 7768 696c 6520 2863 7572 5f70      while (cur_p
-0008f360: 6f73 5f6f 7267 203c 2028 6c69 6e65 2e65  os_org < (line.e
-0008f370: 6e64 2d4d 6172 6769 6e29 2920 2620 2863  nd-Margin)) & (c
-0008f380: 7572 5f70 6f73 5f6f 7267 203e 2028 6c69  ur_pos_org > (li
-0008f390: 6e65 2e73 7461 7274 2b4d 6172 6769 6e29  ne.start+Margin)
-0008f3a0: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
-0008f3b0: 736e 765f 7479 7065 203d 2067 6574 5f73  snv_type = get_s
-0008f3c0: 6e76 5f74 7970 6528 7069 2c20 7076 290a  nv_type(pi, pv).
-0008f3d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0008f3e0: 736e 765f 7479 7065 203d 3d20 313a 2023  snv_type == 1: #
-0008f3f0: 2049 6e73 6572 7469 6f6e 0a20 2020 2020   Insertion.     
-0008f400: 2020 2020 2020 2020 2020 206e 203d 206e             n = n
-0008f410: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
-0008f420: 2830 2c6c 692c 2031 295b 305d 2b31 0a20  (0,li, 1)[0]+1. 
-0008f430: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f440: 6571 5f66 7261 6720 3d20 7261 6e64 5f6e  eq_frag = rand_n
-0008f450: 7563 6c65 6f74 6964 6573 286e 290a 2020  ucleotides(n).  
-0008f460: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0008f470: 7365 715f 6e65 7720 3d20 7365 715f 6e65  seq_new = seq_ne
-0008f480: 7720 2b20 7365 715f 6672 6167 0a20 2020  w + seq_frag.   
-0008f490: 2020 2020 2020 2020 2020 2020 2073 6571               seq
-0008f4a0: 5f6c 7374 2e61 7070 656e 6428 7365 715f  _lst.append(seq_
-0008f4b0: 6672 6167 290a 2020 2020 2020 2020 2020  frag).          
-0008f4c0: 2020 2020 2020 736e 7620 3d20 534e 5628        snv = SNV(
-0008f4d0: 2067 656e 6f6d 652e 6e61 6d65 2c20 6375   genome.name, cu
-0008f4e0: 725f 706f 735f 6e65 772b 312c 2063 7572  r_pos_new+1, cur
-0008f4f0: 5f70 6f73 5f6f 7267 2b31 2c20 2749 272c  _pos_org+1, 'I',
-0008f500: 206e 2c20 7365 715f 6672 6167 2c20 272d   n, seq_frag, '-
-0008f510: 272c 2053 7461 7274 2c20 456e 6420 2920  ', Start, End ) 
-0008f520: 2320 6d61 6b65 2069 7420 6f6e 652d 6261  # make it one-ba
-0008f530: 7365 2070 6f73 6974 696f 6e0a 2020 2020  se position.    
-0008f540: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
-0008f550: 6c73 742e 6170 7065 6e64 2873 6e76 290a  lst.append(snv).
-0008f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f570: 6375 725f 706f 735f 6e65 7720 2b3d 206c  cur_pos_new += l
-0008f580: 656e 2873 6571 5f66 7261 6729 0a0a 2020  en(seq_frag)..  
-0008f590: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-0008f5a0: 6e76 5f74 7970 6520 3d3d 2032 3a20 2320  nv_type == 2: # 
-0008f5b0: 4465 6c65 7469 6f6e 0a20 2020 2020 2020  Deletion.       
-0008f5c0: 2020 2020 2020 2020 206e 203d 206e 702e           n = np.
-0008f5d0: 7261 6e64 6f6d 2e72 616e 6469 6e74 2830  random.randint(0
-0008f5e0: 2c6c 642c 2031 295b 305d 2b31 0a20 2020  ,ld, 1)[0]+1.   
-0008f5f0: 2020 2020 2020 2020 2020 2020 2073 6571               seq
-0008f600: 5f66 7261 6720 3d20 6765 6e6f 6d65 2e73  _frag = genome.s
-0008f610: 6571 5b69 6e74 2863 7572 5f70 6f73 5f6f  eq[int(cur_pos_o
-0008f620: 7267 293a 696e 7428 6375 725f 706f 735f  rg):int(cur_pos_
-0008f630: 6f72 672b 6e29 5d0a 2020 2020 2020 2020  org+n)].        
-0008f640: 2020 2020 2020 2020 736e 7620 3d20 534e          snv = SN
-0008f650: 5628 2067 656e 6f6d 652e 6e61 6d65 2c20  V( genome.name, 
-0008f660: 6375 725f 706f 735f 6e65 772b 312c 2063  cur_pos_new+1, c
-0008f670: 7572 5f70 6f73 5f6f 7267 2b31 2c20 2744  ur_pos_org+1, 'D
-0008f680: 272c 206e 2c20 272d 272c 2073 6571 5f66  ', n, '-', seq_f
-0008f690: 7261 672c 2053 7461 7274 2c20 456e 6420  rag, Start, End 
-0008f6a0: 2920 2320 6d61 6b65 2069 7420 6f6e 652d  ) # make it one-
-0008f6b0: 6261 7365 2070 6f73 6974 696f 6e0a 2020  base position.  
-0008f6c0: 2020 2020 2020 2020 2020 2020 2020 736e                sn
-0008f6d0: 765f 6c73 742e 6170 7065 6e64 2873 6e76  v_lst.append(snv
-0008f6e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0008f6f0: 2020 6375 725f 706f 735f 6f72 6720 2b3d    cur_pos_org +=
-0008f700: 206e 0a0a 2020 2020 2020 2020 2020 2020   n..            
-0008f710: 656c 7365 3a20 2320 534e 500a 2020 2020  else: # SNP.    
-0008f720: 2020 2020 2020 2020 2020 2020 6e20 3d20              n = 
-0008f730: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
-0008f740: 7428 302c 6c76 2c20 3129 5b30 5d2b 3120  t(0,lv, 1)[0]+1 
-0008f750: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0008f760: 2020 2020 2020 2020 7365 715f 746d 7020          seq_tmp 
-0008f770: 3d20 6765 6e6f 6d65 2e73 6571 5b69 6e74  = genome.seq[int
-0008f780: 2863 7572 5f70 6f73 5f6f 7267 293a 696e  (cur_pos_org):in
-0008f790: 7428 6375 725f 706f 735f 6f72 672b 6e29  t(cur_pos_org+n)
-0008f7a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0008f7b0: 2020 7365 715f 6672 6167 203d 2072 616e    seq_frag = ran
-0008f7c0: 645f 6e75 636c 656f 7469 6465 5f65 7863  d_nucleotide_exc
-0008f7d0: 6570 7428 7365 715f 746d 7029 0a20 2020  ept(seq_tmp).   
-0008f7e0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0008f7f0: 6571 5f6e 6577 203d 2073 6571 5f6e 6577  eq_new = seq_new
-0008f800: 202b 2073 6571 5f66 7261 670a 2020 2020   + seq_frag.    
-0008f810: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
-0008f820: 6c73 742e 6170 7065 6e64 2873 6571 5f66  lst.append(seq_f
-0008f830: 7261 6729 0a20 2020 2020 2020 2020 2020  rag).           
-0008f840: 2020 2020 2073 6e76 203d 2053 4e56 2820       snv = SNV( 
-0008f850: 6765 6e6f 6d65 2e6e 616d 652c 2063 7572  genome.name, cur
-0008f860: 5f70 6f73 5f6e 6577 2b31 2c20 6375 725f  _pos_new+1, cur_
-0008f870: 706f 735f 6f72 672b 312c 2027 5627 2c20  pos_org+1, 'V', 
-0008f880: 6e2c 2073 6571 5f66 7261 672c 2073 6571  n, seq_frag, seq
-0008f890: 5f74 6d70 2c20 5374 6172 742c 2045 6e64  _tmp, Start, End
-0008f8a0: 2029 2023 206d 616b 6520 6974 206f 6e65   ) # make it one
-0008f8b0: 2d62 6173 6520 706f 7369 7469 6f6e 0a20  -base position. 
-0008f8c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f8d0: 6e76 5f6c 7374 2e61 7070 656e 6428 736e  nv_lst.append(sn
-0008f8e0: 7629 0a20 2020 2020 2020 2020 2020 2020  v).             
-0008f8f0: 2020 2063 7572 5f70 6f73 5f6e 6577 202b     cur_pos_new +
-0008f900: 3d20 6e0a 2020 2020 2020 2020 2020 2020  = n.            
-0008f910: 2020 2020 6375 725f 706f 735f 6f72 6720      cur_pos_org 
-0008f920: 2b3d 206e 0a0a 2020 2020 2020 2020 2020  += n..          
-0008f930: 2020 4c20 3d20 6e70 2e72 616e 646f 6d2e    L = np.random.
-0008f940: 7261 6e64 696e 7428 3230 2c6d 752c 3129  randint(20,mu,1)
-0008f950: 5b30 5d20 2320 7365 7061 7261 7465 2053  [0] # separate S
-0008f960: 4e56 2061 7420 6c65 6173 7420 3230 2062  NV at least 20 b
-0008f970: 6173 6573 0a20 2020 2020 2020 2020 2020  ases.           
-0008f980: 206e 6578 745f 706f 735f 6f72 6720 3d20   next_pos_org = 
-0008f990: 6375 725f 706f 735f 6f72 6720 2b20 4c0a  cur_pos_org + L.
-0008f9a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0008f9b0: 6578 745f 706f 735f 6f72 6720 3e3d 206c  ext_pos_org >= l
-0008f9c0: 696e 652e 656e 643a 2023 2028 6765 6e6f  ine.end: # (geno
-0008f9d0: 6d65 2e6c 656e 2d31 3030 293a 0a20 2020  me.len-100):.   
-0008f9e0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0008f9f0: 6571 5f6e 6577 203d 2073 6571 5f6e 6577  eq_new = seq_new
-0008fa00: 202b 2067 656e 6f6d 652e 7365 715b 696e   + genome.seq[in
-0008fa10: 7428 6375 725f 706f 735f 6f72 6729 3a5d  t(cur_pos_org):]
-0008fa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008fa30: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
-0008fa40: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
-0008fa50: 7572 5f70 6f73 5f6f 7267 293a 286c 696e  ur_pos_org):(lin
-0008fa60: 652e 656e 642b 3129 5d29 0a20 2020 2020  e.end+1)]).     
-0008fa70: 2020 2020 2020 2020 2020 2063 7572 5f70             cur_p
-0008fa80: 6f73 5f6e 6577 202b 3d20 2828 6c69 6e65  os_new += ((line
-0008fa90: 2e65 6e64 2b31 292d 6375 725f 706f 735f  .end+1)-cur_pos_
-0008faa0: 6f72 6729 0a20 2020 2020 2020 2020 2020  org).           
-0008fab0: 2020 2020 2063 7572 5f70 6f73 5f6f 7267       cur_pos_org
-0008fac0: 203d 2028 6c69 6e65 2e65 6e64 2b31 290a   = (line.end+1).
-0008fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008fae0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0008faf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008fb00: 2020 2020 2020 2020 2320 7365 715f 6e65          # seq_ne
-0008fb10: 7720 3d20 7365 715f 6e65 7720 2b20 6765  w = seq_new + ge
-0008fb20: 6e6f 6d65 2e73 6571 5b69 6e74 2863 7572  nome.seq[int(cur
-0008fb30: 5f70 6f73 5f6f 7267 293a 696e 7428 6e65  _pos_org):int(ne
-0008fb40: 7874 5f70 6f73 5f6f 7267 295d 0a20 2020  xt_pos_org)].   
-0008fb50: 2020 2020 2020 2020 2020 2020 2073 6571               seq
-0008fb60: 5f6c 7374 2e61 7070 656e 6428 6765 6e6f  _lst.append(geno
-0008fb70: 6d65 2e73 6571 5b69 6e74 2863 7572 5f70  me.seq[int(cur_p
-0008fb80: 6f73 5f6f 7267 293a 696e 7428 6e65 7874  os_org):int(next
-0008fb90: 5f70 6f73 5f6f 7267 295d 290a 2020 2020  _pos_org)]).    
-0008fba0: 2020 2020 2020 2020 2020 2020 6375 725f              cur_
-0008fbb0: 706f 735f 6e65 7720 2b3d 2028 6e65 7874  pos_new += (next
-0008fbc0: 5f70 6f73 5f6f 7267 2d63 7572 5f70 6f73  _pos_org-cur_pos
-0008fbd0: 5f6f 7267 290a 2020 2020 2020 2020 2020  _org).          
-0008fbe0: 2020 2020 2020 6375 725f 706f 735f 6f72        cur_pos_or
-0008fbf0: 6720 3d20 6e65 7874 5f70 6f73 5f6f 7267  g = next_pos_org
-0008fc00: 0a20 2020 2020 2020 2020 2020 2063 6e74  .            cnt
-0008fc10: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0008fc20: 2020 6966 2063 6e74 2573 7465 7020 3d3d    if cnt%step ==
-0008fc30: 2030 3a20 0a20 2020 2020 2020 2020 2020   0: .           
-0008fc40: 2020 2020 2070 7269 6e74 2827 5c72 2573       print('\r%s
-0008fc50: 202d 2025 692c 2025 692c 2025 6920 2720   - %i, %i, %i ' 
-0008fc60: 2520 2867 656e 6f6d 652e 6e61 6d65 2c20  % (genome.name, 
-0008fc70: 6375 725f 706f 735f 6f72 672c 2067 656e  cur_pos_org, gen
-0008fc80: 6f6d 652e 6c65 6e2c 2063 7572 5f70 6f73  ome.len, cur_pos
-0008fc90: 5f6e 6577 292c 2065 6e64 3d27 2729 0a20  _new), end=''). 
-0008fca0: 2020 2020 2020 0a20 2020 2069 6620 6375        .    if cu
-0008fcb0: 725f 706f 735f 6f72 6720 3c20 6765 6e6f  r_pos_org < geno
-0008fcc0: 6d65 2e6c 656e 3a0a 2020 2020 2020 2020  me.len:.        
-0008fcd0: 7365 715f 6c73 742e 6170 7065 6e64 2867  seq_lst.append(g
-0008fce0: 656e 6f6d 652e 7365 715b 696e 7428 6375  enome.seq[int(cu
-0008fcf0: 725f 706f 735f 6f72 6729 3a5d 290a 2020  r_pos_org):]).  
-0008fd00: 2020 0a20 2020 2073 6571 5f6e 6577 203d    .    seq_new =
-0008fd10: 2027 272e 6a6f 696e 2873 6571 5f6c 7374   ''.join(seq_lst
-0008fd20: 290a 2020 2020 2320 7375 6666 6978 203d  ).    # suffix =
-0008fd30: 2027 2d4c 2569 2d49 2569 2d44 2569 2d56   '-L%i-I%i-D%i-V
-0008fd40: 2569 2720 2520 286d 752c 6c69 2c6c 642c  %i' % (mu,li,ld,
-0008fd50: 6c76 290a 2020 2020 2320 6765 6e6f 6d65  lv).    # genome
-0008fd60: 5f6e 6577 203d 2047 656e 6f6d 6528 2067  _new = Genome( g
-0008fd70: 656e 6f6d 652e 6865 6164 6572 202b 2073  enome.header + s
-0008fd80: 7566 6669 782c 2073 6571 5f6e 6577 2029  uffix, seq_new )
-0008fd90: 0a20 2020 2067 656e 6f6d 655f 6e65 7720  .    genome_new 
-0008fda0: 3d20 4765 6e6f 6d65 2820 6765 6e6f 6d65  = Genome( genome
-0008fdb0: 2e68 6561 6465 722c 2073 6571 5f6e 6577  .header, seq_new
-0008fdc0: 2029 0a20 2020 2070 7269 6e74 2827 2064   ).    print(' d
-0008fdd0: 6f6e 652e 2729 0a20 2020 2020 2020 2020  one.').         
-0008fde0: 2020 200a 2020 2020 7265 7475 726e 2867     .    return(g
-0008fdf0: 656e 6f6d 655f 6e65 772c 2073 6e76 5f6c  enome_new, snv_l
-0008fe00: 7374 290a 2020 2020 0a23 2323 2323 2323  st).    .#######
-0008fe10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008fe20: 2323 2323 2323 2323 230a 2323 2050 6172  #########.## Par
-0008fe30: 616d 6574 6572 7320 666f 7220 534e 5620  ameters for SNV 
-0008fe40: 6765 6e65 7261 7469 6f6e 0a0a 505f 494e  generation..P_IN
-0008fe50: 5320 3d20 302e 3135 0a50 5f44 454c 203d  S = 0.15.P_DEL =
-0008fe60: 2030 2e31 350a 505f 534e 5020 3d20 3120   0.15.P_SNP = 1 
-0008fe70: 2d20 505f 494e 5320 2d20 505f 4445 4c0a  - P_INS - P_DEL.
-0008fe80: 0a4c 4920 3d20 330a 4c44 203d 2033 0a4c  .LI = 3.LD = 3.L
-0008fe90: 5620 3d20 320a 4c5f 494e 5445 525f 534e  V = 2.L_INTER_SN
-0008fea0: 5620 3d20 3230 300a 0a23 2323 2323 2323  V = 200..#######
-0008feb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008fec0: 2323 2323 2323 2323 230a 0a64 6566 2067  #########..def g
-0008fed0: 656e 6572 6174 655f 736e 7628 6765 6e6f  enerate_snv(geno
-0008fee0: 6d65 2c20 6774 665f 6c69 6e65 732c 206c  me, gtf_lines, l
-0008fef0: 5f69 6e74 6572 5f73 6e76 203d 204c 5f49  _inter_snv = L_I
-0008ff00: 4e54 4552 5f53 4e56 2c20 5c0a 2020 2020  NTER_SNV, \.    
-0008ff10: 2020 2020 2020 2020 2020 2020 206c 6920               li 
-0008ff20: 3d20 4c49 2c20 6c64 203d 204c 442c 206c  = LI, ld = LD, l
-0008ff30: 7620 3d20 4c56 2c20 7069 203d 2050 5f49  v = LV, pi = P_I
-0008ff40: 4e53 2c20 7064 203d 2050 5f44 454c 293a  NS, pd = P_DEL):
-0008ff50: 0a20 2020 200a 2020 2020 7076 203d 2031  .    .    pv = 1
-0008ff60: 202d 2070 6920 2d20 7064 0a20 2020 206e   - pi - pd.    n
-0008ff70: 702e 7261 6e64 6f6d 2e73 6565 6428 3029  p.random.seed(0)
-0008ff80: 0a20 2020 2070 7269 6e74 2827 4765 6e65  .    print('Gene
-0008ff90: 7261 7469 6e67 2053 4e56 2027 2c65 6e64  rating SNV ',end
-0008ffa0: 3d27 2729 0a20 2020 2046 6561 7475 7265  ='').    Feature
-0008ffb0: 7320 3d20 6765 745f 636f 6c28 6774 665f  s = get_col(gtf_
-0008ffc0: 6c69 6e65 732c 2032 290a 2020 2020 7768  lines, 2).    wh
-0008ffd0: 203d 2077 6869 6368 2820 4665 6174 7572   = which( Featur
-0008ffe0: 6573 2c20 2765 786f 6e27 2029 0a20 2020  es, 'exon' ).   
-0008fff0: 2067 7466 5f65 786f 6e73 203d 205b 6774   gtf_exons = [gt
-00090000: 665f 6c69 6e65 735b 775d 2066 6f72 2077  f_lines[w] for w
-00090010: 2069 6e20 7768 5d20 0a0a 2020 2020 2320   in wh] ..    # 
-00090020: 7072 696e 7428 6c65 6e28 4665 6174 7572  print(len(Featur
-00090030: 6573 2929 0a20 2020 2043 6872 7320 3d20  es)).    Chrs = 
-00090040: 6765 745f 636f 6c28 6774 665f 6578 6f6e  get_col(gtf_exon
-00090050: 732c 2030 290a 2020 2020 4368 725f 6e61  s, 0).    Chr_na
-00090060: 6d65 7320 3d20 736f 7274 6564 2873 6574  mes = sorted(set
-00090070: 2843 6872 7329 290a 0a20 2020 2073 6e76  (Chrs))..    snv
-00090080: 5f6c 7374 5f61 6c6c 203d 205b 5d0a 2020  _lst_all = [].  
-00090090: 2020 6765 6e6f 6d65 5f6e 6577 203d 207b    genome_new = {
-000900a0: 7d0a 2020 2020 666f 7220 4368 7220 696e  }.    for Chr in
-000900b0: 2043 6872 5f6e 616d 6573 3a0a 2020 2020   Chr_names:.    
-000900c0: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
-000900d0: 4368 7220 696e 2067 656e 6f6d 652e 6b65  Chr in genome.ke
-000900e0: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
-000900f0: 2020 7768 203d 2077 6869 6368 2820 4368    wh = which( Ch
-00090100: 7273 2c20 4368 7220 290a 2020 2020 2020  rs, Chr ).      
-00090110: 2020 2020 2020 6774 665f 6368 7220 3d20        gtf_chr = 
-00090120: 5b67 7466 5f65 786f 6e73 5b77 5d20 666f  [gtf_exons[w] fo
-00090130: 7220 7720 696e 2077 685d 0a20 2020 2020  r w in wh].     
-00090140: 2020 2020 2020 2050 6f73 5f73 7461 7274         Pos_start
-00090150: 203d 206e 702e 6172 7261 7928 2067 6574   = np.array( get
-00090160: 5f63 6f6c 2867 7466 5f63 6872 2c20 3329  _col(gtf_chr, 3)
-00090170: 2029 0a20 2020 2020 2020 2020 2020 206f   ).            o
-00090180: 6472 203d 2050 6f73 5f73 7461 7274 2e61  dr = Pos_start.a
-00090190: 7267 736f 7274 2829 0a0a 2020 2020 2020  rgsort()..      
-000901a0: 2020 2020 2020 6774 665f 6368 725f 736f        gtf_chr_so
-000901b0: 7274 6564 203d 205b 5d0a 2020 2020 2020  rted = [].      
-000901c0: 2020 2020 2020 7070 203d 2030 0a20 2020        pp = 0.   
-000901d0: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
-000901e0: 6e20 7261 6e67 6528 6c65 6e28 6774 665f  n range(len(gtf_
-000901f0: 6368 7229 293a 0a20 2020 2020 2020 2020  chr)):.         
-00090200: 2020 2020 2020 206c 696e 6520 3d20 6774         line = gt
-00090210: 665f 6368 725b 6f64 725b 6b5d 5d0a 2020  f_chr[odr[k]].  
-00090220: 2020 2020 2020 2020 2020 2020 2020 6774                gt
-00090230: 665f 6368 725f 736f 7274 6564 2e61 7070  f_chr_sorted.app
-00090240: 656e 6428 6c69 6e65 290a 2020 2020 2020  end(line).      
-00090250: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
-00090260: 652e 7374 6172 7420 3c20 7070 3a20 7072  e.start < pp: pr
-00090270: 696e 7428 6c69 6e65 290a 2020 2020 2020  int(line).      
-00090280: 2020 2020 2020 2020 2020 7070 203d 206c            pp = l
-00090290: 696e 652e 7374 6172 740a 0a20 2020 2020  ine.start..     
-000902a0: 2020 2020 2020 2067 6e6d 2c20 736e 765f         gnm, snv_
-000902b0: 6c73 7420 3d20 6765 6e65 7261 7465 5f73  lst = generate_s
-000902c0: 6e76 5f77 6974 685f 6774 6628 2067 656e  nv_with_gtf( gen
-000902d0: 6f6d 655b 4368 725d 2c20 6774 665f 6368  ome[Chr], gtf_ch
-000902e0: 725f 736f 7274 6564 2c20 6d75 203d 206c  r_sorted, mu = l
-000902f0: 5f69 6e74 6572 5f73 6e76 2c20 5c0a 2020  _inter_snv, \.  
-00090300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090330: 6c69 203d 206c 692c 206c 6420 3d20 6c64  li = li, ld = ld
-00090340: 2c20 6c76 203d 206c 762c 2070 6920 3d20  , lv = lv, pi = 
-00090350: 7069 2c20 7064 203d 2070 6420 290a 2020  pi, pd = pd ).  
-00090360: 2020 2020 2020 2020 2020 736e 765f 6c73            snv_ls
-00090370: 745f 616c 6c20 3d20 736e 765f 6c73 745f  t_all = snv_lst_
-00090380: 616c 6c20 2b20 736e 765f 6c73 740a 2020  all + snv_lst.  
-00090390: 2020 2020 2020 2020 2020 6765 6e6f 6d65            genome
-000903a0: 5f6e 6577 5b43 6872 5d20 3d20 676e 6d0a  _new[Chr] = gnm.
-000903b0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
-000903c0: 2867 656e 6f6d 655f 6e65 772c 2073 6e76  (genome_new, snv
-000903d0: 5f6c 7374 5f61 6c6c 2c20 4665 6174 7572  _lst_all, Featur
-000903e0: 6573 290a 2020 2020 0a23 2323 2323 2323  es).    .#######
-000903f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090430: 2323 2323 2323 2323 2323 230a 2323 2046  ###########.## F
-00090440: 756e 6374 696f 6e73 2066 6f72 2065 7661  unctions for eva
-00090450: 6c75 6174 696f 6e20 6f66 2053 4e56 2064  luation of SNV d
-00090460: 6574 6563 7469 6f6e 0a23 2323 2323 2323  etection.#######
-00090470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000904a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000904b0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-000904c0: 2067 6574 5f73 7061 6e5f 6c73 7428 7267   get_span_lst(rg
-000904d0: 6e73 5f6c 7374 5f6d 692c 2054 7970 6520  ns_lst_mi, Type 
-000904e0: 3d20 274d 2729 3a0a 2020 2020 0a20 2020  = 'M'):.    .   
-000904f0: 2073 7061 6e5f 6c73 7420 3d20 5b5d 0a20   span_lst = []. 
-00090500: 2020 2066 6f72 2072 5f6d 2069 6e20 7267     for r_m in rg
-00090510: 6e73 5f6c 7374 5f6d 693a 0a20 2020 2020  ns_lst_mi:.     
-00090520: 2020 2073 706e 203d 2072 5f6d 2e67 6574     spn = r_m.get
-00090530: 5f73 7061 6e28 290a 2020 2020 2020 2020  _span().        
-00090540: 7370 6e2e 7479 7065 203d 2054 7970 650a  spn.type = Type.
-00090550: 2020 2020 2020 2020 7370 616e 5f6c 7374          span_lst
-00090560: 2e61 7070 656e 6428 2073 706e 2029 0a20  .append( spn ). 
-00090570: 2020 2072 6574 7572 6e28 7370 616e 5f6c     return(span_l
-00090580: 7374 290a 0a23 2320 5365 6c65 6374 2053  st)..## Select S
-00090590: 4e56 2773 2074 6861 7420 6661 6c6c 7320  NV's that falls 
-000905a0: 7769 7468 696e 2074 6865 2063 6f76 6572  within the cover
-000905b0: 6564 2072 6567 696f 6e0a 6465 6620 7365  ed region.def se
-000905c0: 6c65 6374 5f73 6e76 7328 2064 665f 736e  lect_snvs( df_sn
-000905d0: 762c 2073 7061 6e5f 6c73 742c 2072 676e  v, span_lst, rgn
-000905e0: 735f 6c73 745f 6d69 2c20 5479 7065 203d  s_lst_mi, Type =
-000905f0: 2027 4d27 2c20 6d64 6576 203d 2031 3220   'M', mdev = 12 
-00090600: 293a 0a20 2020 200a 2020 2020 7072 696e  ):.    .    prin
-00090610: 7428 2743 6865 636b 696e 6720 696e 7465  t('Checking inte
-00090620: 7273 6563 7469 6f6e 202e 2e20 272c 2065  rsection .. ', e
-00090630: 6e64 3d27 2729 0a20 2020 2073 7465 7020  nd='').    step 
-00090640: 3d20 6e70 2e63 6569 6c28 6466 5f73 6e76  = np.ceil(df_snv
-00090650: 2e73 6861 7065 5b30 5d2f 3230 290a 2020  .shape[0]/20).  
-00090660: 2020 0a20 2020 2064 665f 736e 765b 2773    .    df_snv['s
-00090670: 7461 7274 275d 203d 2064 665f 736e 765b  tart'] = df_snv[
-00090680: 2770 6f73 5f6f 7267 275d 202d 206d 6465  'pos_org'] - mde
-00090690: 760a 2020 2020 6466 5f73 6e76 5b27 656e  v.    df_snv['en
-000906a0: 6427 5d20 3d20 6466 5f73 6e76 5b27 706f  d'] = df_snv['po
-000906b0: 735f 6f72 6727 5d20 2b20 6466 5f73 6e76  s_org'] + df_snv
-000906c0: 5b27 6c65 6e27 5d20 2b20 6d64 6576 0a20  ['len'] + mdev. 
-000906d0: 2020 2064 665f 736e 765b 2763 7667 275d     df_snv['cvg']
-000906e0: 203d 2030 0a0a 2020 2020 625f 7072 6f63   = 0..    b_proc
-000906f0: 203d 206e 702e 6675 6c6c 2864 665f 736e   = np.full(df_sn
-00090700: 762e 7368 6170 655b 305d 2c20 4661 6c73  v.shape[0], Fals
-00090710: 6529 0a20 2020 2066 6f72 206b 2c20 7370  e).    for k, sp
-00090720: 616e 2069 6e20 656e 756d 6572 6174 6528  an in enumerate(
-00090730: 7370 616e 5f6c 7374 293a 0a20 2020 2020  span_lst):.     
-00090740: 2020 2062 3020 3d20 6466 5f73 6e76 5b27     b0 = df_snv['
-00090750: 6368 7227 5d20 3d3d 2073 7061 6e2e 6368  chr'] == span.ch
-00090760: 720a 2020 2020 2020 2020 6231 203d 2028  r.        b1 = (
-00090770: 6466 5f73 6e76 5b27 7374 6172 7427 5d20  df_snv['start'] 
-00090780: 3e3d 2073 7061 6e2e 7374 6172 7429 2026  >= span.start) &
-00090790: 2028 2864 665f 736e 765b 2773 7461 7274   ((df_snv['start
-000907a0: 275d 203c 3d20 7370 616e 2e65 6e64 2929  '] <= span.end))
-000907b0: 0a20 2020 2020 2020 2062 3220 3d20 2864  .        b2 = (d
-000907c0: 665f 736e 765b 2765 6e64 275d 203e 3d20  f_snv['end'] >= 
-000907d0: 7370 616e 2e73 7461 7274 2920 2620 2828  span.start) & ((
-000907e0: 6466 5f73 6e76 5b27 656e 6427 5d20 3c3d  df_snv['end'] <=
-000907f0: 2073 7061 6e2e 656e 6429 290a 2020 2020   span.end)).    
-00090800: 2020 2020 6220 3d20 6230 2026 2028 6231      b = b0 & (b1
-00090810: 207c 2062 3229 2026 2028 625f 7072 6f63   | b2) & (b_proc
-00090820: 203d 3d20 4661 6c73 6529 0a20 2020 2020   == False).     
-00090830: 2020 2064 665f 736e 765f 746d 7020 3d20     df_snv_tmp = 
-00090840: 6466 5f73 6e76 5b62 5d0a 2020 2020 2020  df_snv[b].      
-00090850: 2020 666f 7220 6d2c 2072 6f77 2069 6e20    for m, row in 
-00090860: 6466 5f73 6e76 5f74 6d70 2e69 7465 7272  df_snv_tmp.iterr
-00090870: 6f77 7328 293a 0a20 2020 2020 2020 2020  ows():.         
-00090880: 2020 2072 676e 203d 2072 6567 696f 6e28     rgn = region(
-00090890: 2072 6f77 2e63 6872 2c20 726f 772e 7374   row.chr, row.st
-000908a0: 6172 742c 2072 6f77 2e65 6e64 2c20 5479  art, row.end, Ty
-000908b0: 7065 2029 0a20 2020 2020 2020 2020 2020  pe ).           
-000908c0: 2062 622c 2063 6320 3d20 7267 6e73 5f6c   bb, cc = rgns_l
-000908d0: 7374 5f6d 695b 6b5d 2e67 6574 5f69 6e74  st_mi[k].get_int
-000908e0: 6572 7365 6374 696f 6e5f 6376 6728 7267  ersection_cvg(rg
-000908f0: 6e29 200a 2020 2020 2020 2020 2020 2020  n) .            
-00090900: 6966 2062 623a 200a 2020 2020 2020 2020  if bb: .        
-00090910: 2020 2020 2020 2020 625f 7072 6f63 5b6d          b_proc[m
-00090920: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
-00090930: 2020 2020 2020 2020 2064 665f 736e 762e           df_snv.
-00090940: 6c6f 635b 6d2c 2763 7667 275d 203d 2063  loc[m,'cvg'] = c
-00090950: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
-00090960: 2020 0a20 2020 2020 2020 2023 2069 6620    .        # if 
-00090970: 6b25 7374 6570 203d 3d20 303a 2070 7269  k%step == 0: pri
-00090980: 6e74 2827 2e27 2c65 6e64 3d27 2729 0a20  nt('.',end=''). 
-00090990: 2020 2020 2020 2069 6620 6b25 3130 203d         if k%10 =
-000909a0: 3d20 303a 2020 2020 0a20 2020 2020 2020  = 0:    .       
-000909b0: 2020 2020 2070 7269 6e74 2827 5c72 4368       print('\rCh
-000909c0: 6563 6b69 6e67 2069 6e74 6572 7365 6374  ecking intersect
-000909d0: 696f 6e20 2e2e 2025 692f 2569 2028 2569  ion .. %i/%i (%i
-000909e0: 2927 2025 2028 6b2c 206c 656e 2873 7061  )' % (k, len(spa
-000909f0: 6e5f 6c73 7429 2c20 6e70 2e73 756d 2862  n_lst), np.sum(b
-00090a00: 5f70 726f 6329 292c 2065 6e64 3d27 2720  _proc)), end='' 
-00090a10: 290a 0a20 2020 2070 7269 6e74 2827 5c72  )..    print('\r
-00090a20: 4368 6563 6b69 6e67 2069 6e74 6572 7365  Checking interse
-00090a30: 6374 696f 6e20 2e2e 2064 6f6e 652e 2025  ction .. done. %
-00090a40: 6920 2d3e 2025 6927 2025 2028 6466 5f73  i -> %i' % (df_s
-00090a50: 6e76 2e73 6861 7065 5b30 5d2c 206e 702e  nv.shape[0], np.
-00090a60: 7375 6d28 625f 7072 6f63 2929 2029 0a20  sum(b_proc)) ). 
-00090a70: 2020 200a 2020 2020 6466 5f73 6e76 5f73     .    df_snv_s
-00090a80: 656c 203d 2028 6466 5f73 6e76 2e69 6c6f  el = (df_snv.ilo
-00090a90: 635b 625f 7072 6f63 5d29 2e63 6f70 7928  c[b_proc]).copy(
-00090aa0: 6465 6570 203d 2054 7275 6529 0a20 2020  deep = True).   
-00090ab0: 200a 2020 2020 7265 7475 726e 2864 665f   .    return(df_
-00090ac0: 736e 765f 7365 6c29 0a0a 0a64 6566 206d  snv_sel)...def m
-00090ad0: 6174 6368 696e 675f 736e 7673 2820 6466  atching_snvs( df
-00090ae0: 5f73 6e76 5f73 656c 2c20 6466 5f64 6574  _snv_sel, df_det
-00090af0: 6563 7465 642c 2064 6576 5f74 6f6c 203d  ected, dev_tol =
-00090b00: 2033 2029 3a0a 2020 2020 0a20 2020 2023   3 ):.    .    #
-00090b10: 2320 7468 6520 6461 7461 6672 616d 6573  # the dataframes
-00090b20: 206d 7573 6820 6265 2073 6f72 7465 6420   mush be sorted 
-00090b30: 6163 636f 7264 696e 6720 746f 2074 6865  according to the
-00090b40: 2070 6f73 6974 696f 6e20 2870 6f73 5f6e   position (pos_n
-00090b50: 6577 2c20 7374 6172 7429 0a20 2020 2064  ew, start).    d
-00090b60: 665f 745f 616c 6c20 3d20 6466 5f73 6e76  f_t_all = df_snv
-00090b70: 5f73 656c 0a20 2020 2064 665f 645f 616c  _sel.    df_d_al
-00090b80: 6c20 3d20 6466 5f64 6574 6563 7465 640a  l = df_detected.
-00090b90: 0a20 2020 2063 6e74 203d 2030 0a20 2020  .    cnt = 0.   
-00090ba0: 2063 6872 6d73 203d 2064 665f 745f 616c   chrms = df_t_al
-00090bb0: 6c5b 2763 6872 275d 0a20 2020 2063 6872  l['chr'].    chr
-00090bc0: 5f6c 7374 203d 206c 6973 7428 7365 7428  _lst = list(set(
-00090bd0: 6368 726d 7329 290a 2020 2020 6368 725f  chrms)).    chr_
-00090be0: 6c73 742e 736f 7274 2829 0a0a 2020 2020  lst.sort()..    
-00090bf0: 636e 7420 3d20 300a 2020 2020 4e5f 7420  cnt = 0.    N_t 
-00090c00: 3d20 300a 2020 2020 4e5f 6420 3d20 300a  = 0.    N_d = 0.
-00090c10: 2020 2020 666f 7220 6e2c 2063 6872 6d20      for n, chrm 
-00090c20: 696e 2065 6e75 6d65 7261 7465 2863 6872  in enumerate(chr
-00090c30: 5f6c 7374 293a 0a20 2020 2020 2020 200a  _lst):.        .
-00090c40: 2020 2020 2020 2020 6231 203d 2028 6466          b1 = (df
-00090c50: 5f74 5f61 6c6c 5b27 6368 7227 5d20 3d3d  _t_all['chr'] ==
-00090c60: 2063 6872 6d29 0a20 2020 2020 2020 2062   chrm).        b
-00090c70: 3220 3d20 2864 665f 645f 616c 6c5b 2763  2 = (df_d_all['c
-00090c80: 6872 275d 203d 3d20 6368 726d 290a 2020  hr'] == chrm).  
-00090c90: 2020 0a20 2020 2020 2020 2069 6620 286e    .        if (n
-00090ca0: 702e 7375 6d28 6231 2920 3d3d 2030 2920  p.sum(b1) == 0) 
-00090cb0: 7c20 286e 702e 7375 6d28 6232 2920 3d3d  | (np.sum(b2) ==
-00090cc0: 2030 293a 2020 2020 2020 2020 0a20 2020   0):        .   
-00090cd0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00090ce0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00090cf0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00090d00: 2020 2020 2064 665f 7420 3d20 6466 5f74       df_t = df_t
-00090d10: 5f61 6c6c 2e6c 6f63 5b62 312c 3a5d 2e63  _all.loc[b1,:].c
-00090d20: 6f70 7928 6465 6570 203d 2054 7275 6529  opy(deep = True)
-00090d30: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-00090d40: 6420 3d20 6466 5f64 5f61 6c6c 2e6c 6f63  d = df_d_all.loc
-00090d50: 5b62 322c 3a5d 2e63 6f70 7928 6465 6570  [b2,:].copy(deep
-00090d60: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-00090d70: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00090d80: 2020 6e5f 7461 7267 6574 203d 2064 665f    n_target = df_
-00090d90: 742e 7368 6170 655b 305d 0a20 2020 2020  t.shape[0].     
-00090da0: 2020 2020 2020 206e 5f64 6574 6563 7465         n_detecte
-00090db0: 6420 3d20 6466 5f64 2e73 6861 7065 5b30  d = df_d.shape[0
-00090dc0: 5d0a 2020 2020 2020 2020 2020 2020 0a20  ].            . 
-00090dd0: 2020 2020 2020 2020 2020 204e 5f74 202b             N_t +
-00090de0: 3d20 6e5f 7461 7267 6574 0a20 2020 2020  = n_target.     
-00090df0: 2020 2020 2020 204e 5f64 202b 3d20 6e5f         N_d += n_
-00090e00: 6465 7465 6374 6564 0a20 2020 2020 2020  detected.       
-00090e10: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00090e20: 2020 2320 7072 696e 7428 275c 724d 6174    # print('\rMat
-00090e30: 6368 696e 6720 2573 2027 2025 2028 6368  ching %s ' % (ch
-00090e40: 726d 2920 2c20 656e 643d 2727 290a 2020  rm) , end='').  
-00090e50: 2020 2020 2020 2020 2020 636e 745f 7420            cnt_t 
-00090e60: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00090e70: 636e 745f 6420 3d20 300a 2020 2020 2020  cnt_d = 0.      
-00090e80: 2020 2020 2020 6d61 7463 6820 3d20 6e70        match = np
-00090e90: 2e66 756c 6c28 6e5f 7461 7267 6574 2c20  .full(n_target, 
-00090ea0: 2d31 290a 2020 2020 2020 2020 2020 2020  -1).            
-00090eb0: 6469 7374 203d 206e 702e 6675 6c6c 286e  dist = np.full(n
-00090ec0: 5f74 6172 6765 742c 2030 290a 2020 2020  _target, 0).    
-00090ed0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00090ee0: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-00090ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00090f00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00090f10: 2020 6966 2028 636e 745f 6420 3e3d 206e    if (cnt_d >= n
-00090f20: 5f64 6574 6563 7465 6429 207c 2028 636e  _detected) | (cn
-00090f30: 745f 7420 3e3d 206e 5f74 6172 6765 7429  t_t >= n_target)
-00090f40: 3a20 6272 6561 6b0a 2020 2020 2020 2020  : break.        
-00090f50: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-00090f60: 724d 6174 6368 696e 6720 2573 2c20 2569  rMatching %s, %i
-00090f70: 2f25 6920 2e2e 2025 692f 2569 2c20 2569  /%i .. %i/%i, %i
-00090f80: 2f25 6920 2720 2520 5c0a 2020 2020 2020  /%i ' % \.      
-00090f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090fa0: 2863 6872 6d2c 206e 2c20 6c65 6e28 6368  (chrm, n, len(ch
-00090fb0: 725f 6c73 7429 2c20 636e 745f 742c 206e  r_lst), cnt_t, n
-00090fc0: 5f74 6172 6765 742c 2063 6e74 5f64 2c20  _target, cnt_d, 
-00090fd0: 6e5f 6465 7465 6374 6564 2920 2c20 656e  n_detected) , en
-00090fe0: 643d 2727 290a 0a20 2020 2020 2020 2020  d='')..         
-00090ff0: 2020 2020 2020 2070 5f74 203d 2064 665f         p_t = df_
-00091000: 742e 696c 6f63 5b63 6e74 5f74 5d2e 706f  t.iloc[cnt_t].po
-00091010: 735f 6f72 670a 2020 2020 2020 2020 2020  s_org.          
-00091020: 2020 2020 2020 705f 6420 3d20 6466 5f64        p_d = df_d
-00091030: 2e69 6c6f 635b 636e 745f 645d 2e70 6f73  .iloc[cnt_d].pos
-00091040: 5f6f 7267 0a20 2020 2020 2020 2020 2020  _org.           
-00091050: 2020 2020 2074 5f74 203d 2064 665f 742e       t_t = df_t.
-00091060: 696c 6f63 5b63 6e74 5f74 5d2e 7479 7065  iloc[cnt_t].type
-00091070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091080: 2074 5f64 203d 2064 665f 642e 696c 6f63   t_d = df_d.iloc
-00091090: 5b63 6e74 5f64 5d2e 7479 7065 0a20 2020  [cnt_d].type.   
-000910a0: 2020 2020 2020 2020 2020 2020 204c 5f74               L_t
-000910b0: 203d 206d 6178 286c 656e 2864 665f 742e   = max(len(df_t.
-000910c0: 696c 6f63 5b63 6e74 5f74 5d2e 7365 715f  iloc[cnt_t].seq_
-000910d0: 6f72 6729 2c20 6c65 6e28 6466 5f74 2e69  org), len(df_t.i
-000910e0: 6c6f 635b 636e 745f 745d 2e73 6571 5f6e  loc[cnt_t].seq_n
-000910f0: 6577 2929 0a20 2020 2020 2020 2020 2020  ew)).           
-00091100: 2020 2020 204c 5f64 203d 206d 6178 286c       L_d = max(l
-00091110: 656e 2864 665f 642e 696c 6f63 5b63 6e74  en(df_d.iloc[cnt
-00091120: 5f64 5d2e 7365 715f 6f72 6729 2c20 6c65  _d].seq_org), le
-00091130: 6e28 6466 5f64 2e69 6c6f 635b 636e 745f  n(df_d.iloc[cnt_
-00091140: 645d 2e73 6571 5f6e 6577 2929 0a0a 2020  d].seq_new))..  
-00091150: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00091160: 2028 705f 7429 203e 2028 705f 6420 2b20   (p_t) > (p_d + 
-00091170: 4c5f 6420 2b20 6465 765f 746f 6c29 3a0a  L_d + dev_tol):.
-00091180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091190: 2020 2020 636e 745f 6420 2b3d 2031 0a20      cnt_d += 1. 
-000911a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000911b0: 2020 2069 6620 636e 745f 6420 3e3d 206e     if cnt_d >= n
-000911c0: 5f64 6574 6563 7465 643a 2062 7265 616b  _detected: break
-000911d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000911e0: 2065 6c69 6620 2870 5f74 202b 204c 5f74   elif (p_t + L_t
-000911f0: 202b 2064 6576 5f74 6f6c 2920 3c20 2870   + dev_tol) < (p
-00091200: 5f64 293a 0a20 2020 2020 2020 2020 2020  _d):.           
-00091210: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
-00091220: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00091230: 2020 2020 2020 2020 6966 2063 6e74 5f74          if cnt_t
-00091240: 203e 3d20 6e5f 7461 7267 6574 3a20 6272   >= n_target: br
-00091250: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00091260: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00091270: 2020 2020 2020 2020 2020 2020 2020 6220                b 
-00091280: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00091290: 2020 2020 2020 2020 2020 2069 6620 2874             if (t
-000912a0: 5f74 203d 3d20 2756 2729 2026 2028 745f  _t == 'V') & (t_
-000912b0: 6420 3d3d 2027 5627 293a 0a20 2020 2020  d == 'V'):.     
-000912c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000912d0: 2020 2069 6620 6c65 6e28 6466 5f74 2e69     if len(df_t.i
-000912e0: 6c6f 635b 636e 745f 745d 2e73 6571 5f6e  loc[cnt_t].seq_n
-000912f0: 6577 2920 3d3d 206c 656e 2864 665f 642e  ew) == len(df_d.
-00091300: 696c 6f63 5b63 6e74 5f64 5d2e 7365 715f  iloc[cnt_d].seq_
-00091310: 6e65 7729 3a0a 2020 2020 2020 2020 2020  new):.          
-00091320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091330: 2020 6966 2028 705f 7420 3d3d 2070 5f64    if (p_t == p_d
-00091340: 2920 2620 2864 665f 742e 696c 6f63 5b63  ) & (df_t.iloc[c
-00091350: 6e74 5f74 5d2e 7365 715f 6e65 7720 3d3d  nt_t].seq_new ==
-00091360: 2064 665f 642e 696c 6f63 5b63 6e74 5f64   df_d.iloc[cnt_d
-00091370: 5d2e 7365 715f 6e65 7729 3a0a 2020 2020  ].seq_new):.    
-00091380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091390: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-000913a0: 685b 636e 745f 745d 203d 2063 6e74 5f64  h[cnt_t] = cnt_d
-000913b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000913c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000913d0: 2064 6973 745b 636e 745f 745d 203d 2070   dist[cnt_t] = p
-000913e0: 5f74 202d 2070 5f64 0a20 2020 2020 2020  _t - p_d.       
+0008d880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d8c0: 230a 2323 2046 756e 6374 696f 6e73 2074  #.## Functions t
+0008d8d0: 6f20 6861 6e64 6c65 2073 696d 756c 6174  o handle simulat
+0008d8e0: 6564 2072 6561 6473 2028 6164 6420 7472  ed reads (add tr
+0008d8f0: 6172 6563 6f20 6865 6164 6572 2c20 7370  areco header, sp
+0008d900: 6c69 7420 6661 7374 5129 0a23 2323 2323  lit fastQ).#####
+0008d910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d940: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d950: 2323 2323 2323 2323 2323 2323 230a 0a64  #############..d
+0008d960: 6566 2066 6173 7461 5f61 6464 5f74 7261  ef fasta_add_tra
+0008d970: 7265 636f 5f68 6561 6465 7228 2072 6566  reco_header( ref
+0008d980: 5f74 722c 2073 696d 5f70 726f 6669 6c65  _tr, sim_profile
+0008d990: 2c20 7265 6164 5f6c 656e 2c20 7375 6666  , read_len, suff
+0008d9a0: 6978 203d 204e 6f6e 652c 2063 6f76 5f74  ix = None, cov_t
+0008d9b0: 6820 3d20 302e 3820 293a 0a20 2020 200a  h = 0.8 ):.    .
+0008d9c0: 2020 2020 636f 6c6e 616d 6573 203d 205b      colnames = [
+0008d9d0: 276c 6f63 272c 2027 7469 6427 2c20 2763  'loc', 'tid', 'c
+0008d9e0: 6f64 696e 6727 2c20 276c 656e 6774 6827  oding', 'length'
+0008d9f0: 2c20 2765 7870 5f66 7261 6327 2c20 2765  , 'exp_frac', 'e
+0008da00: 7870 5f6e 756d 272c 2027 6c69 625f 6672  xp_num', 'lib_fr
+0008da10: 6163 272c 2027 6c69 625f 6e75 6d27 2c20  ac', 'lib_num', 
+0008da20: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0008da30: 2020 2773 6571 5f66 7261 6327 2c20 2773    'seq_frac', 's
+0008da40: 6571 5f6e 756d 272c 2027 636f 765f 6672  eq_num', 'cov_fr
+0008da50: 6163 272c 2027 6368 6932 272c 2027 5663  ac', 'chi2', 'Vc
+0008da60: 6f65 6627 5d0a 2020 2020 6466 5f70 726f  oef'].    df_pro
+0008da70: 203d 2070 642e 7265 6164 5f63 7376 2873   = pd.read_csv(s
+0008da80: 696d 5f70 726f 6669 6c65 2c20 7365 703d  im_profile, sep=
+0008da90: 275c 7427 2c20 6865 6164 6572 203d 204e  '\t', header = N
+0008daa0: 6f6e 652c 2069 6e64 6578 5f63 6f6c 203d  one, index_col =
+0008dab0: 2031 2c20 6e61 6d65 7320 3d20 636f 6c6e   1, names = coln
+0008dac0: 616d 6573 290a 0a20 2020 2072 6566 203d  ames)..    ref =
+0008dad0: 206c 6f61 645f 6661 7374 6128 7265 665f   load_fasta(ref_
+0008dae0: 7472 290a 0a20 2020 2064 665f 7072 6f5b  tr)..    df_pro[
+0008daf0: 2761 626e 275d 203d 2064 665f 7072 6f5b  'abn'] = df_pro[
+0008db00: 2773 6571 5f6e 756d 275d 2a72 6561 645f  'seq_num']*read_
+0008db10: 6c65 6e2f 6466 5f70 726f 5b27 6c65 6e67  len/df_pro['leng
+0008db20: 7468 275d 0a20 2020 2064 665f 7072 6f5b  th'].    df_pro[
+0008db30: 2774 706d 275d 203d 2064 665f 7072 6f5b  'tpm'] = df_pro[
+0008db40: 2761 626e 275d 2a31 3030 3030 3030 2f28  'abn']*1000000/(
+0008db50: 6466 5f70 726f 5b27 6162 6e27 5d2e 7375  df_pro['abn'].su
+0008db60: 6d28 2929 0a0a 2020 2020 6466 5f69 6478  m())..    df_idx
+0008db70: 203d 206e 702e 6172 7261 7928 6466 5f70   = np.array(df_p
+0008db80: 726f 2e69 6e64 6578 2e76 616c 7565 732e  ro.index.values.
+0008db90: 746f 6c69 7374 2829 290a 2020 2020 636e  tolist()).    cn
+0008dba0: 745f 6475 7020 3d20 300a 2020 2020 666f  t_dup = 0.    fo
+0008dbb0: 7220 6b65 7920 696e 206c 6973 7428 7265  r key in list(re
+0008dbc0: 662e 6b65 7973 2829 293a 0a20 2020 2020  f.keys()):.     
+0008dbd0: 2020 2069 6620 286b 6579 2069 6e20 6466     if (key in df
+0008dbe0: 5f69 6478 2920 2620 286e 702e 7375 6d28  _idx) & (np.sum(
+0008dbf0: 6466 5f69 6478 203d 3d20 6b65 7929 203d  df_idx == key) =
+0008dc00: 3d20 3129 3a0a 2020 2020 2020 2020 2020  = 1):.          
+0008dc10: 2020 6966 2064 665f 7072 6f2e 6c6f 635b    if df_pro.loc[
+0008dc20: 6b65 795d 2e63 6f76 5f66 7261 6320 3e3d  key].cov_frac >=
+0008dc30: 2063 6f76 5f74 683a 0a20 2020 2020 2020   cov_th:.       
+0008dc40: 2020 2020 2020 2020 2072 6566 5b6b 6579           ref[key
+0008dc50: 5d2e 6865 6164 6572 203d 2027 2573 2063  ].header = '%s c
+0008dc60: 6f76 5f66 7261 633a 2566 2061 626e 3a25  ov_frac:%f abn:%
+0008dc70: 6620 7470 6d3a 2566 2720 2520 2872 6566  f tpm:%f' % (ref
+0008dc80: 5b6b 6579 5d2e 6865 6164 6572 2c20 6466  [key].header, df
+0008dc90: 5f70 726f 2e6c 6f63 5b6b 6579 5d2e 636f  _pro.loc[key].co
+0008dca0: 765f 6672 6163 2c20 6466 5f70 726f 2e6c  v_frac, df_pro.l
+0008dcb0: 6f63 5b6b 6579 5d2e 6162 6e2c 2064 665f  oc[key].abn, df_
+0008dcc0: 7072 6f2e 6c6f 635b 6b65 795d 2e74 706d  pro.loc[key].tpm
+0008dcd0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0008dce0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0008dcf0: 2020 2020 7265 662e 706f 7028 6b65 7929      ref.pop(key)
+0008dd00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0008dd10: 2020 2020 2020 2020 2020 2069 6620 6466             if df
+0008dd20: 5f70 726f 2e6c 6f63 5b6b 6579 5d2e 7368  _pro.loc[key].sh
+0008dd30: 6170 655b 305d 203e 2031 3a20 636e 745f  ape[0] > 1: cnt_
+0008dd40: 6475 7020 2b3d 2031 0a20 2020 2020 2020  dup += 1.       
+0008dd50: 2020 2020 2072 6566 2e70 6f70 286b 6579       ref.pop(key
+0008dd60: 290a 0a20 2020 2066 6e61 6d65 2c20 6578  )..    fname, ex
+0008dd70: 7420 3d20 6765 745f 6669 6c65 5f6e 616d  t = get_file_nam
+0008dd80: 6528 7265 665f 7472 290a 2020 2020 6966  e(ref_tr).    if
+0008dd90: 2073 7566 6669 7820 6973 204e 6f6e 653a   suffix is None:
+0008dda0: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
+0008ddb0: 2066 6e61 6d65 202b 2027 5f63 6f76 2569   fname + '_cov%i
+0008ddc0: 2e27 2025 2069 6e74 2863 6f76 5f74 682a  .' % int(cov_th*
+0008ddd0: 3130 3029 202b 2065 7874 0a20 2020 2065  100) + ext.    e
+0008dde0: 6c73 653a 0a20 2020 2020 2020 2066 6e61  lse:.        fna
+0008ddf0: 6d65 203d 2066 6e61 6d65 202b 2027 5f25  me = fname + '_%
+0008de00: 735f 636f 7625 692e 2720 2520 2873 7566  s_cov%i.' % (suf
+0008de10: 6669 782c 2069 6e74 2863 6f76 5f74 682a  fix, int(cov_th*
+0008de20: 3130 3029 2920 2b20 6578 740a 0a20 2020  100)) + ext..   
+0008de30: 2073 6176 655f 6661 7374 6128 666e 616d   save_fasta(fnam
+0008de40: 652c 2072 6566 2c20 7469 746c 6520 3d20  e, ref, title = 
+0008de50: 666e 616d 6529 0a20 2020 200a 0a64 6566  fname).    ..def
+0008de60: 206c 6f61 645f 6661 7374 7128 6669 6c65   load_fastq(file
+0008de70: 5f67 656e 6f6d 652c 2076 6572 626f 7365  _genome, verbose
+0008de80: 203d 2046 616c 7365 2029 3a0a 0a20 2020   = False ):..   
+0008de90: 2067 656e 6f6d 6520 3d20 6469 6374 2829   genome = dict()
+0008dea0: 0a20 2020 2066 203d 206f 7065 6e28 6669  .    f = open(fi
+0008deb0: 6c65 5f67 656e 6f6d 652c 2027 7227 290a  le_genome, 'r').
+0008dec0: 2020 2020 7363 6e74 203d 2030 0a20 2020      scnt = 0.   
+0008ded0: 2070 7269 6e74 2827 5c72 4c6f 6164 696e   print('\rLoadin
+0008dee0: 6720 6661 7374 5120 2e2e 2027 2c20 656e  g fastQ .. ', en
+0008def0: 643d 2727 2c20 666c 7573 683d 5472 7565  d='', flush=True
+0008df00: 290a 2020 2020 636e 7420 3d20 300a 2020  ).    cnt = 0.  
+0008df10: 2020 666f 7220 6c69 6e65 2069 6e20 6620    for line in f 
+0008df20: 3a0a 2020 2020 2020 2020 6966 206c 696e  :.        if lin
+0008df30: 655b 305d 203d 3d20 2740 273a 0a20 2020  e[0] == '@':.   
+0008df40: 2020 2020 2020 2020 2069 6620 636e 7420           if cnt 
+0008df50: 3d3d 2034 3a0a 2020 2020 2020 2020 2020  == 4:.          
+0008df60: 2020 2020 2020 6765 6e6f 6d65 5b73 636e        genome[scn
+0008df70: 745d 203d 2047 656e 6f6d 6528 6864 722c  t] = Genome(hdr,
+0008df80: 2073 6571 2c20 7175 616c 290a 2020 2020   seq, qual).    
+0008df90: 2020 2020 2020 2020 2020 2020 7363 6e74              scnt
+0008dfa0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0008dfb0: 2020 636e 7420 3d20 300a 2020 2020 2020    cnt = 0.      
+0008dfc0: 2020 2020 2020 6864 7220 3d20 6c69 6e65        hdr = line
+0008dfd0: 5b31 3a2d 315d 0a20 2020 2020 2020 2020  [1:-1].         
+0008dfe0: 2020 2063 6e74 202b 3d20 310a 2020 2020     cnt += 1.    
+0008dff0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008e000: 2020 2020 2020 6966 2063 6e74 203d 3d20        if cnt == 
+0008e010: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+0008e020: 2020 2073 6571 203d 206c 696e 655b 3a2d     seq = line[:-
+0008e030: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+0008e040: 2020 2063 6e74 202b 3d20 310a 2020 2020     cnt += 1.    
+0008e050: 2020 2020 2020 2020 656c 6966 2063 6e74          elif cnt
+0008e060: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
+0008e070: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
+0008e080: 5d20 3d3d 2027 2b27 3a0a 2020 2020 2020  ] == '+':.      
+0008e090: 2020 2020 2020 2020 2020 2020 2020 6964                id
+0008e0a0: 7220 3d20 6c69 6e65 5b31 3a2d 315d 0a20  r = line[1:-1]. 
+0008e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008e0c0: 2020 2063 6e74 202b 3d20 310a 2020 2020     cnt += 1.    
+0008e0d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0008e0e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0008e0f0: 2020 2020 2020 7072 696e 7428 2745 5252        print('ERR
+0008e100: 4f52 2069 6e20 6661 7374 5120 6669 6c65  OR in fastQ file
+0008e110: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0008e120: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0008e130: 2020 2020 2020 2020 2065 6c69 6620 636e           elif cn
+0008e140: 7420 3d3d 2033 3a0a 2020 2020 2020 2020  t == 3:.        
+0008e150: 2020 2020 2020 2020 7175 616c 203d 206c          qual = l
+0008e160: 696e 655b 3a2d 315d 0a20 2020 2020 2020  ine[:-1].       
+0008e170: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
+0008e180: 310a 2020 2020 6966 2063 6e74 203e 2030  1.    if cnt > 0
+0008e190: 3a0a 2020 2020 2020 2020 6765 6e6f 6d65  :.        genome
+0008e1a0: 5b73 636e 745d 203d 2047 656e 6f6d 6528  [scnt] = Genome(
+0008e1b0: 6864 722c 2073 6571 2c20 7175 616c 290a  hdr, seq, qual).
+0008e1c0: 2020 2020 2020 2020 7363 6e74 202b 3d20          scnt += 
+0008e1d0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0008e1e0: 2020 0a20 2020 2070 7269 6e74 2827 5c72    .    print('\r
+0008e1f0: 4c6f 6164 696e 6720 6661 7374 5120 2e2e  Loading fastQ ..
+0008e200: 2064 6f6e 652e 2020 4e75 6d2e 5365 7120   done.  Num.Seq 
+0008e210: 3d20 272c 2073 636e 742c 2027 2020 2027  = ', scnt, '   '
+0008e220: 2c20 666c 7573 683d 5472 7565 290a 2020  , flush=True).  
+0008e230: 2020 662e 636c 6f73 6528 290a 2020 2020    f.close().    
+0008e240: 7265 7475 726e 2867 656e 6f6d 6529 0a0a  return(genome)..
+0008e250: 0a64 6566 2073 6176 655f 6661 7374 7128  .def save_fastq(
+0008e260: 2066 696c 655f 6765 6e6f 6d65 2c20 6765   file_genome, ge
+0008e270: 6e6f 6d65 5f64 6963 742c 2076 6572 626f  nome_dict, verbo
+0008e280: 7365 203d 2046 616c 7365 2c20 7469 746c  se = False, titl
+0008e290: 6520 3d20 2766 6173 7451 2720 293a 0a0a  e = 'fastQ' ):..
+0008e2a0: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
+0008e2b0: 6720 2573 202e 2e27 2025 2074 6974 6c65  g %s ..' % title
+0008e2c0: 2c20 656e 643d 2727 2c20 666c 7573 683d  , end='', flush=
+0008e2d0: 5472 7565 290a 2020 2020 2320 666f 7220  True).    # for 
+0008e2e0: 6720 696e 2067 656e 6f6d 655f 6c73 7420  g in genome_lst 
+0008e2f0: 3a0a 2020 2020 4b65 7973 203d 2067 656e  :.    Keys = gen
+0008e300: 6f6d 655f 6469 6374 2e6b 6579 7328 290a  ome_dict.keys().
+0008e310: 2020 2020 6620 3d20 6f70 656e 2866 696c      f = open(fil
+0008e320: 655f 6765 6e6f 6d65 2c20 2777 742b 2729  e_genome, 'wt+')
+0008e330: 0a20 2020 206c 696e 655f 6c73 7420 3d20  .    line_lst = 
+0008e340: 5b5d 0a20 2020 2066 6f72 206b 6579 2069  [].    for key i
+0008e350: 6e20 4b65 7973 3a0a 2020 2020 2020 2020  n Keys:.        
+0008e360: 2320 7072 696e 7428 275c 7253 6176 696e  # print('\rSavin
+0008e370: 6720 2573 202e 2e20 2573 2720 2520 2874  g %s .. %s' % (t
+0008e380: 6974 6c65 2c20 6b65 7929 2c20 656e 643d  itle, key), end=
+0008e390: 2720 2020 2020 2020 2020 2020 2020 2020  '               
+0008e3a0: 2020 2020 2027 290a 2020 2020 2020 2020       ').        
+0008e3b0: 6720 3d20 6765 6e6f 6d65 5f64 6963 745b  g = genome_dict[
+0008e3c0: 6b65 795d 0a20 2020 2020 2020 2073 203d  key].        s =
+0008e3d0: 2027 4025 735c 6e27 2025 2067 2e68 6561   '@%s\n' % g.hea
+0008e3e0: 6465 720a 2020 2020 2020 2020 6c69 6e65  der.        line
+0008e3f0: 5f6c 7374 2e61 7070 656e 6428 7329 0a20  _lst.append(s). 
+0008e400: 2020 2020 2020 206c 696e 655f 6c73 742e         line_lst.
+0008e410: 6170 7065 6e64 2867 2e73 6571 2e75 7070  append(g.seq.upp
+0008e420: 6572 2829 202b 2027 5c6e 2729 0a20 2020  er() + '\n').   
+0008e430: 2020 2020 206c 696e 655f 6c73 742e 6170       line_lst.ap
+0008e440: 7065 6e64 2827 2b5c 6e27 290a 2020 2020  pend('+\n').    
+0008e450: 2020 2020 6c69 6e65 5f6c 7374 2e61 7070      line_lst.app
+0008e460: 656e 6428 672e 7175 616c 202b 2027 5c6e  end(g.qual + '\n
+0008e470: 2729 0a20 2020 2020 2020 200a 2020 2020  ').        .    
+0008e480: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+0008e490: 7072 696e 7428 272e 272c 2065 6e64 3d27  print('.', end='
+0008e4a0: 272c 2066 6c75 7368 3d54 7275 6529 0a0a  ', flush=True)..
+0008e4b0: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
+0008e4c0: 2827 272e 6a6f 696e 286c 696e 655f 6c73  (''.join(line_ls
+0008e4d0: 7429 290a 2020 2020 2020 2020 0a20 2020  t)).        .   
+0008e4e0: 2070 7269 6e74 2827 5c72 5361 7669 6e67   print('\rSaving
+0008e4f0: 2025 7320 2e2e 2064 6f6e 652e 2028 2569   %s .. done. (%i
+0008e500: 2920 2020 2020 2020 2020 2020 2020 2020  )               
+0008e510: 2027 2025 2028 7469 746c 652c 206c 656e   ' % (title, len
+0008e520: 284b 6579 7329 292c 2066 6c75 7368 3d54  (Keys)), flush=T
+0008e530: 7275 6529 0a20 2020 2066 2e63 6c6f 7365  rue).    f.close
+0008e540: 2829 0a20 2020 200a 0a20 2020 200a 6465  ().    ..    .de
+0008e550: 6620 6661 7374 615f 7369 6d5f 7265 6164  f fasta_sim_read
+0008e560: 5f73 706c 6974 2820 7369 6d5f 7265 6164  _split( sim_read
+0008e570: 2c20 6473 7220 3d20 3120 293a 0a20 2020  , dsr = 1 ):.   
+0008e580: 200a 2020 2020 666e 616d 652c 2065 7874   .    fname, ext
+0008e590: 203d 2067 6574 5f70 6174 685f 6e61 6d65   = get_path_name
+0008e5a0: 2873 696d 5f72 6561 6429 0a0a 2020 2020  (sim_read)..    
+0008e5b0: 6661 5f61 6c6c 203d 206c 6f61 645f 6661  fa_all = load_fa
+0008e5c0: 7374 7128 7369 6d5f 7265 6164 290a 2020  stq(sim_read).  
+0008e5d0: 2020 0a20 2020 2066 6131 203d 207b 7d0a    .    fa1 = {}.
+0008e5e0: 2020 2020 6661 3220 3d20 7b7d 0a20 2020      fa2 = {}.   
+0008e5f0: 2063 6e74 203d 2030 0a20 2020 2063 6e74   cnt = 0.    cnt
+0008e600: 5f31 203d 2030 0a20 2020 2063 6e74 5f32  _1 = 0.    cnt_2
+0008e610: 203d 2030 0a20 2020 2066 6f72 206b 6579   = 0.    for key
+0008e620: 2069 6e20 6661 5f61 6c6c 2e6b 6579 7328   in fa_all.keys(
+0008e630: 293a 0a20 2020 2020 2020 2066 615f 616c  ):.        fa_al
+0008e640: 6c5b 6b65 795d 2e68 6561 6465 7220 3d20  l[key].header = 
+0008e650: 6661 5f61 6c6c 5b6b 6579 5d2e 6865 6164  fa_all[key].head
+0008e660: 6572 5b3a 2d34 5d0a 2020 2020 2020 2020  er[:-4].        
+0008e670: 6966 2063 6e74 2532 203d 3d20 303a 0a20  if cnt%2 == 0:. 
+0008e680: 2020 2020 2020 2020 2020 2069 6620 636e             if cn
+0008e690: 745f 3125 6473 7220 3d3d 2030 3a0a 2020  t_1%dsr == 0:.  
+0008e6a0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0008e6b0: 5f61 6c6c 5b6b 6579 5d2e 6865 6164 6572  _all[key].header
+0008e6c0: 203d 2066 615f 616c 6c5b 6b65 795d 2e68   = fa_all[key].h
+0008e6d0: 6561 6465 722e 7370 6c69 7428 2720 2729  eader.split(' ')
+0008e6e0: 5b30 5d20 2b20 272f 3127 0a20 2020 2020  [0] + '/1'.     
+0008e6f0: 2020 2020 2020 2020 2020 2066 6131 5b6b             fa1[k
+0008e700: 6579 5d20 3d20 6661 5f61 6c6c 5b6b 6579  ey] = fa_all[key
+0008e710: 5d0a 2020 2020 2020 2020 2020 2020 636e  ].            cn
+0008e720: 745f 3120 2b3d 2031 0a20 2020 2020 2020  t_1 += 1.       
+0008e730: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0008e740: 2020 2069 6620 636e 745f 3225 6473 7220     if cnt_2%dsr 
+0008e750: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+0008e760: 2020 2020 2020 6661 5f61 6c6c 5b6b 6579        fa_all[key
+0008e770: 5d2e 6865 6164 6572 203d 2066 615f 616c  ].header = fa_al
+0008e780: 6c5b 6b65 795d 2e68 6561 6465 722e 7370  l[key].header.sp
+0008e790: 6c69 7428 2720 2729 5b30 5d20 2b20 272f  lit(' ')[0] + '/
+0008e7a0: 3227 0a20 2020 2020 2020 2020 2020 2020  2'.             
+0008e7b0: 2020 2066 6132 5b6b 6579 5d20 3d20 6661     fa2[key] = fa
+0008e7c0: 5f61 6c6c 5b6b 6579 5d0a 2020 2020 2020  _all[key].      
+0008e7d0: 2020 2020 2020 636e 745f 3220 2b3d 2031        cnt_2 += 1
+0008e7e0: 0a0a 2020 2020 2020 2020 636e 7420 2b3d  ..        cnt +=
+0008e7f0: 2031 0a0a 2020 2020 6966 2064 7372 203d   1..    if dsr =
+0008e800: 3d20 313a 0a20 2020 2020 2020 2066 6e31  = 1:.        fn1
+0008e810: 203d 2066 6e61 6d65 202b 2027 5f31 2e27   = fname + '_1.'
+0008e820: 202b 2065 7874 0a20 2020 2020 2020 2066   + ext.        f
+0008e830: 6e32 203d 2066 6e61 6d65 202b 2027 5f32  n2 = fname + '_2
+0008e840: 2e27 202b 2065 7874 0a20 2020 2065 6c73  .' + ext.    els
+0008e850: 653a 0a20 2020 2020 2020 2066 6e31 203d  e:.        fn1 =
+0008e860: 2066 6e61 6d65 202b 2028 275f 6473 2569   fname + ('_ds%i
+0008e870: 2720 2520 6473 7229 202b 2027 5f31 2e27  ' % dsr) + '_1.'
+0008e880: 202b 2065 7874 0a20 2020 2020 2020 2066   + ext.        f
+0008e890: 6e32 203d 2066 6e61 6d65 202b 2028 275f  n2 = fname + ('_
+0008e8a0: 6473 2569 2720 2520 6473 7229 202b 2027  ds%i' % dsr) + '
+0008e8b0: 5f32 2e27 202b 2065 7874 0a20 2020 2073  _2.' + ext.    s
+0008e8c0: 6176 655f 6661 7374 7128 666e 312c 2066  ave_fastq(fn1, f
+0008e8d0: 6131 290a 2020 2020 7361 7665 5f66 6173  a1).    save_fas
+0008e8e0: 7471 2866 6e32 2c20 6661 3229 0a20 2020  tq(fn2, fa2).   
+0008e8f0: 200a 0a64 6566 2066 6173 7461 5f73 696d   ..def fasta_sim
+0008e900: 5f72 6561 645f 646f 776e 7361 6d70 6c65  _read_downsample
+0008e910: 2820 7369 6d5f 7265 6164 2c20 6473 7220  ( sim_read, dsr 
+0008e920: 3d20 3120 293a 0a20 2020 200a 2020 2020  = 1 ):.    .    
+0008e930: 666e 616d 652c 2065 7874 203d 2067 6574  fname, ext = get
+0008e940: 5f70 6174 685f 6e61 6d65 2873 696d 5f72  _path_name(sim_r
+0008e950: 6561 6429 0a0a 2020 2020 6661 5f61 6c6c  ead)..    fa_all
+0008e960: 203d 206c 6f61 645f 6661 7374 7128 7369   = load_fastq(si
+0008e970: 6d5f 7265 6164 290a 2020 2020 0a20 2020  m_read).    .   
+0008e980: 2066 6120 3d20 7b7d 0a20 2020 2063 6e74   fa = {}.    cnt
+0008e990: 203d 2030 0a20 2020 2066 6f72 206b 6579   = 0.    for key
+0008e9a0: 2069 6e20 6661 5f61 6c6c 2e6b 6579 7328   in fa_all.keys(
+0008e9b0: 293a 0a20 2020 2020 2020 2023 2066 615f  ):.        # fa_
+0008e9c0: 616c 6c5b 6b65 795d 2e68 6561 6465 7220  all[key].header 
+0008e9d0: 3d20 6661 5f61 6c6c 5b6b 6579 5d2e 6865  = fa_all[key].he
+0008e9e0: 6164 6572 5b3a 2d34 5d0a 2020 2020 2020  ader[:-4].      
+0008e9f0: 2020 6966 2063 6e74 2564 7372 203d 3d20    if cnt%dsr == 
+0008ea00: 303a 0a20 2020 2020 2020 2020 2020 2023  0:.            #
+0008ea10: 2066 615f 616c 6c5b 6b65 795d 2e68 6561   fa_all[key].hea
+0008ea20: 6465 7220 3d20 6661 5f61 6c6c 5b6b 6579  der = fa_all[key
+0008ea30: 5d2e 6865 6164 6572 0a20 2020 2020 2020  ].header.       
+0008ea40: 2020 2020 2066 615b 6b65 795d 203d 2066       fa[key] = f
+0008ea50: 615f 616c 6c5b 6b65 795d 0a20 2020 2020  a_all[key].     
+0008ea60: 2020 2063 6e74 202b 3d20 310a 0a20 2020     cnt += 1..   
+0008ea70: 2066 6e20 3d20 666e 616d 6520 2b20 2827   fn = fname + ('
+0008ea80: 5f64 7325 692e 2720 2520 6473 7229 202b  _ds%i.' % dsr) +
+0008ea90: 2065 7874 0a20 2020 2073 6176 655f 6661   ext.    save_fa
+0008eaa0: 7374 7128 666e 2c20 6661 290a 2020 2020  stq(fn, fa).    
+0008eab0: 0a20 2020 200a 2323 2323 2323 2323 2323  .    .##########
+0008eac0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008ead0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eae0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eaf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eb00: 2323 2323 2323 2323 0a23 2320 4675 6e63  ########.## Func
+0008eb10: 7469 6f6e 7320 746f 2061 6464 2053 4e56  tions to add SNV
+0008eb20: 2069 6e74 6f20 6120 6765 6e6f 6d65 0a23   into a genome.#
+0008eb30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eb40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eb50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eb60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eb70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008eb80: 230a 0a53 4e56 203d 2063 6f6c 6c65 6374  #..SNV = collect
+0008eb90: 696f 6e73 2e6e 616d 6564 7475 706c 6528  ions.namedtuple(
+0008eba0: 2753 4e56 272c 2027 6368 722c 2070 6f73  'SNV', 'chr, pos
+0008ebb0: 5f6e 6577 2c20 706f 735f 6f72 672c 2074  _new, pos_org, t
+0008ebc0: 7970 652c 206c 656e 2c20 7365 715f 6e65  ype, len, seq_ne
+0008ebd0: 772c 2073 6571 5f6f 7267 2c20 6578 5f73  w, seq_org, ex_s
+0008ebe0: 7461 7274 2c20 6578 5f65 6e64 2729 0a0a  tart, ex_end')..
+0008ebf0: 6465 6620 6765 745f 736e 765f 7479 7065  def get_snv_type
+0008ec00: 2870 692c 2070 6429 3a0a 2020 2020 0a20  (pi, pd):.    . 
+0008ec10: 2020 2072 6e20 3d20 6e70 2e72 616e 646f     rn = np.rando
+0008ec20: 6d2e 756e 6966 6f72 6d28 3130 3029 0a20  m.uniform(100). 
+0008ec30: 2020 2069 6620 726e 203c 2028 7069 2a31     if rn < (pi*1
+0008ec40: 3030 293a 0a20 2020 2020 2020 2072 6574  00):.        ret
+0008ec50: 7572 6e28 3129 0a20 2020 2065 6c69 6620  urn(1).    elif 
+0008ec60: 726e 203c 2028 7069 2b70 6929 2a31 3030  rn < (pi+pi)*100
+0008ec70: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0008ec80: 2832 290a 2020 2020 656c 7365 3a0a 2020  (2).    else:.  
+0008ec90: 2020 2020 2020 7265 7475 726e 2830 290a        return(0).
+0008eca0: 2020 2020 0a64 6566 2072 616e 645f 6e75      .def rand_nu
+0008ecb0: 636c 656f 7469 6465 5f65 7863 6570 7428  cleotide_except(
+0008ecc0: 6e74 7329 3a0a 2020 2020 0a20 2020 206e  nts):.    .    n
+0008ecd0: 7473 5f6f 7574 203d 2027 270a 2020 2020  ts_out = ''.    
+0008ece0: 666f 7220 6e74 2069 6e20 6e74 733a 0a20  for nt in nts:. 
+0008ecf0: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
+0008ed00: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0008ed10: 6e20 3d20 6e70 2e72 616e 646f 6d2e 7261  n = np.random.ra
+0008ed20: 6e64 696e 7428 302c 342c 3129 5b30 5d0a  ndint(0,4,1)[0].
+0008ed30: 2020 2020 2020 2020 2020 2020 6e74 5f6e              nt_n
+0008ed40: 6577 203d 204e 545f 6c73 745b 696e 7428  ew = NT_lst[int(
+0008ed50: 726e 295d 0a20 2020 2020 2020 2020 2020  rn)].           
+0008ed60: 2069 6620 6e74 5f6e 6577 2021 3d20 6e74   if nt_new != nt
+0008ed70: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0008ed80: 2020 206e 7473 5f6f 7574 203d 206e 7473     nts_out = nts
+0008ed90: 5f6f 7574 202b 206e 745f 6e65 770a 2020  _out + nt_new.  
+0008eda0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0008edb0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0008edc0: 2020 2020 2020 2020 0a20 2020 2072 6574          .    ret
+0008edd0: 7572 6e28 6e74 735f 6f75 7429 0a20 2020  urn(nts_out).   
+0008ede0: 2020 2020 200a 6465 6620 7261 6e64 5f6e       .def rand_n
+0008edf0: 7563 6c65 6f74 6964 6573 286e 756d 293a  ucleotides(num):
+0008ee00: 0a20 2020 200a 2020 2020 6e75 6d5f 7365  .    .    num_se
+0008ee10: 7120 3d20 6e70 2e72 616e 646f 6d2e 7261  q = np.random.ra
+0008ee20: 6e64 696e 7428 302c 342c 6e75 6d29 0a20  ndint(0,4,num). 
+0008ee30: 2020 206e 745f 7374 7220 3d20 2727 2e6a     nt_str = ''.j
+0008ee40: 6f69 6e28 5b4e 545f 6c73 745b 6e5d 2066  oin([NT_lst[n] f
+0008ee50: 6f72 206e 2069 6e20 6e75 6d5f 7365 715d  or n in num_seq]
+0008ee60: 290a 2020 2020 7265 7475 726e 286e 745f  ).    return(nt_
+0008ee70: 7374 7229 0a0a 0a64 6566 2073 6176 655f  str)...def save_
+0008ee80: 736e 765f 696e 666f 5f6f 6c64 2820 6669  snv_info_old( fi
+0008ee90: 6c65 5f6e 616d 652c 2073 6e76 5f6c 7374  le_name, snv_lst
+0008eea0: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
+0008eeb0: 6520 293a 0a20 2020 200a 2020 2020 6620  e ):.    .    f 
+0008eec0: 3d20 6f70 656e 2866 696c 655f 6e61 6d65  = open(file_name
+0008eed0: 2c20 2777 742b 2729 0a20 2020 2070 7269  , 'wt+').    pri
+0008eee0: 6e74 2827 5361 7669 6e67 2053 4e56 2069  nt('Saving SNV i
+0008eef0: 6e66 6f2e 2027 2c20 656e 643d 2727 290a  nfo. ', end='').
+0008ef00: 2020 2020 7374 6570 203d 206e 702e 6365      step = np.ce
+0008ef10: 696c 286c 656e 2873 6e76 5f6c 7374 292f  il(len(snv_lst)/
+0008ef20: 3230 290a 2020 2020 666f 7220 6b20 696e  20).    for k in
+0008ef30: 2072 616e 6765 286c 656e 2873 6e76 5f6c   range(len(snv_l
+0008ef40: 7374 2929 203a 0a20 2020 2020 2020 2073  st)) :.        s
+0008ef50: 6e76 203d 2073 6e76 5f6c 7374 5b6b 5d0a  nv = snv_lst[k].
+0008ef60: 2020 2020 2020 2020 7320 3d20 2725 732c          s = '%s,
+0008ef70: 2569 2c25 692c 2573 2c25 692c 2573 2c25  %i,%i,%s,%i,%s,%
+0008ef80: 735c 6e27 2025 205c 0a20 2020 2020 2020  s\n' % \.       
+0008ef90: 2028 736e 762e 6368 722c 2073 6e76 2e70   (snv.chr, snv.p
+0008efa0: 6f73 5f6e 6577 2c20 736e 762e 706f 735f  os_new, snv.pos_
+0008efb0: 6f72 672c 2073 6e76 2e74 7970 652c 2073  org, snv.type, s
+0008efc0: 6e76 2e6c 656e 2c20 736e 762e 7365 715f  nv.len, snv.seq_
+0008efd0: 6e65 772c 2073 6e76 2e73 6571 5f6f 7267  new, snv.seq_org
+0008efe0: 2029 0a20 2020 2020 2020 2066 2e77 7269   ).        f.wri
+0008eff0: 7465 6c69 6e65 7328 7329 0a20 2020 2020  telines(s).     
+0008f000: 2020 2069 6620 6b25 7374 6570 203d 3d20     if k%step == 
+0008f010: 303a 2070 7269 6e74 2827 2e27 2c65 6e64  0: print('.',end
+0008f020: 3d27 2729 0a20 2020 2020 2020 200a 2020  ='').        .  
+0008f030: 2020 7072 696e 7428 2720 646f 6e65 2e20    print(' done. 
+0008f040: 2569 2073 6e76 732e 2720 2520 6c65 6e28  %i snvs.' % len(
+0008f050: 736e 765f 6c73 7429 2029 0a20 2020 2066  snv_lst) ).    f
+0008f060: 2e63 6c6f 7365 2829 0a0a 2020 2020 0a64  .close()..    .d
+0008f070: 6566 2073 6176 655f 736e 765f 696e 666f  ef save_snv_info
+0008f080: 2820 6669 6c65 5f6e 616d 652c 2073 6e76  ( file_name, snv
+0008f090: 5f6c 7374 2c20 7665 7262 6f73 6520 3d20  _lst, verbose = 
+0008f0a0: 4661 6c73 6520 293a 0a0a 2020 2020 6466  False ):..    df
+0008f0b0: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
+0008f0c0: 736e 765f 6c73 7429 0a20 2020 2064 662e  snv_lst).    df.
+0008f0d0: 746f 5f63 7376 2866 696c 655f 6e61 6d65  to_csv(file_name
+0008f0e0: 2c20 696e 6465 783d 4661 6c73 652c 2073  , index=False, s
+0008f0f0: 6570 3d27 5c74 2729 0a0a 2020 2020 0a64  ep='\t')..    .d
+0008f100: 6566 2067 656e 6572 6174 655f 736e 765f  ef generate_snv_
+0008f110: 7769 7468 5f67 7466 2820 6765 6e6f 6d65  with_gtf( genome
+0008f120: 2c20 6774 665f 6c69 6e65 735f 736f 7274  , gtf_lines_sort
+0008f130: 6564 2c20 6d75 203d 2032 3030 2c20 6c69  ed, mu = 200, li
+0008f140: 203d 2033 2c20 6c64 203d 2033 2c20 6c76   = 3, ld = 3, lv
+0008f150: 203d 2032 2c20 7069 203d 2030 2e31 2c20   = 2, pi = 0.1, 
+0008f160: 7064 203d 2030 2e31 2029 3a0a 2020 2020  pd = 0.1 ):.    
+0008f170: 0a20 2020 2070 7620 3d20 3120 2d20 7069  .    pv = 1 - pi
+0008f180: 202d 2070 640a 2020 2020 7072 696e 7428   - pd.    print(
+0008f190: 6765 6e6f 6d65 2e6e 616d 652c 2065 6e64  genome.name, end
+0008f1a0: 3d27 2027 290a 2020 2020 736e 765f 6c73  =' ').    snv_ls
+0008f1b0: 7420 3d20 5b5d 0a20 2020 2063 7572 5f70  t = [].    cur_p
+0008f1c0: 6f73 5f6f 7267 203d 2030 0a20 2020 2063  os_org = 0.    c
+0008f1d0: 7572 5f70 6f73 5f6e 6577 203d 2063 7572  ur_pos_new = cur
+0008f1e0: 5f70 6f73 5f6f 7267 0a20 2020 2073 6571  _pos_org.    seq
+0008f1f0: 5f6e 6577 203d 2027 270a 2020 2020 7365  _new = ''.    se
+0008f200: 715f 6c73 7420 3d20 5b5d 0a20 2020 204d  q_lst = [].    M
+0008f210: 6172 6769 6e20 3d20 6d61 7828 6c69 2c6d  argin = max(li,m
+0008f220: 6178 286c 642c 6c76 2929 0a20 2020 200a  ax(ld,lv)).    .
+0008f230: 2020 2020 7374 6570 203d 206e 702e 6365      step = np.ce
+0008f240: 696c 2867 656e 6f6d 652e 6c65 6e2f 6d75  il(genome.len/mu
+0008f250: 2f32 3030 290a 2020 2020 0a20 2020 2063  /200).    .    c
+0008f260: 6e74 203d 2030 0a20 2020 2066 6f72 206c  nt = 0.    for l
+0008f270: 696e 6520 696e 2067 7466 5f6c 696e 6573  ine in gtf_lines
+0008f280: 5f73 6f72 7465 643a 0a20 2020 2020 2020  _sorted:.       
+0008f290: 200a 2020 2020 2020 2020 2320 6469 6666   .        # diff
+0008f2a0: 203d 2063 7572 5f70 6f73 5f6e 6577 202d   = cur_pos_new -
+0008f2b0: 2063 7572 5f70 6f73 5f6f 7267 0a20 2020   cur_pos_org.   
+0008f2c0: 2020 2020 2053 7461 7274 203d 206c 696e       Start = lin
+0008f2d0: 652e 7374 6172 740a 2020 2020 2020 2020  e.start.        
+0008f2e0: 456e 6420 3d20 6c69 6e65 2e65 6e64 0a20  End = line.end. 
+0008f2f0: 2020 2020 2020 204c 203d 206e 702e 7261         L = np.ra
+0008f300: 6e64 6f6d 2e72 616e 6469 6e74 2830 2c6d  ndom.randint(0,m
+0008f310: 752f 322c 3129 5b30 5d0a 2020 2020 2020  u/2,1)[0].      
+0008f320: 2020 6966 2063 7572 5f70 6f73 5f6f 7267    if cur_pos_org
+0008f330: 203c 2028 6c69 6e65 2e73 7461 7274 2d31   < (line.start-1
+0008f340: 2b4c 293a 0a20 2020 2020 2020 2020 2020  +L):.           
+0008f350: 206e 6578 745f 706f 735f 6f72 6720 3d20   next_pos_org = 
+0008f360: 6c69 6e65 2e73 7461 7274 2d31 2b4c 0a20  line.start-1+L. 
+0008f370: 2020 2020 2020 2020 2020 2073 6571 5f6c             seq_l
+0008f380: 7374 2e61 7070 656e 6428 6765 6e6f 6d65  st.append(genome
+0008f390: 2e73 6571 5b69 6e74 2863 7572 5f70 6f73  .seq[int(cur_pos
+0008f3a0: 5f6f 7267 293a 696e 7428 6e65 7874 5f70  _org):int(next_p
+0008f3b0: 6f73 5f6f 7267 295d 290a 2020 2020 2020  os_org)]).      
+0008f3c0: 2020 2020 2020 6375 725f 706f 735f 6e65        cur_pos_ne
+0008f3d0: 7720 2b3d 2028 6e65 7874 5f70 6f73 5f6f  w += (next_pos_o
+0008f3e0: 7267 2d63 7572 5f70 6f73 5f6f 7267 290a  rg-cur_pos_org).
+0008f3f0: 2020 2020 2020 2020 2020 2020 6375 725f              cur_
+0008f400: 706f 735f 6f72 6720 3d20 6e65 7874 5f70  pos_org = next_p
+0008f410: 6f73 5f6f 7267 0a20 2020 2020 2020 200a  os_org.        .
+0008f420: 2020 2020 2020 2020 7768 696c 6520 2863          while (c
+0008f430: 7572 5f70 6f73 5f6f 7267 203c 2028 6c69  ur_pos_org < (li
+0008f440: 6e65 2e65 6e64 2d4d 6172 6769 6e29 2920  ne.end-Margin)) 
+0008f450: 2620 2863 7572 5f70 6f73 5f6f 7267 203e  & (cur_pos_org >
+0008f460: 2028 6c69 6e65 2e73 7461 7274 2b4d 6172   (line.start+Mar
+0008f470: 6769 6e29 293a 0a0a 2020 2020 2020 2020  gin)):..        
+0008f480: 2020 2020 736e 765f 7479 7065 203d 2067      snv_type = g
+0008f490: 6574 5f73 6e76 5f74 7970 6528 7069 2c20  et_snv_type(pi, 
+0008f4a0: 7076 290a 0a20 2020 2020 2020 2020 2020  pv)..           
+0008f4b0: 2069 6620 736e 765f 7479 7065 203d 3d20   if snv_type == 
+0008f4c0: 313a 2023 2049 6e73 6572 7469 6f6e 0a20  1: # Insertion. 
+0008f4d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0008f4e0: 203d 206e 702e 7261 6e64 6f6d 2e72 616e   = np.random.ran
+0008f4f0: 6469 6e74 2830 2c6c 692c 2031 295b 305d  dint(0,li, 1)[0]
+0008f500: 2b31 0a20 2020 2020 2020 2020 2020 2020  +1.             
+0008f510: 2020 2073 6571 5f66 7261 6720 3d20 7261     seq_frag = ra
+0008f520: 6e64 5f6e 7563 6c65 6f74 6964 6573 286e  nd_nucleotides(n
+0008f530: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0008f540: 2020 2320 7365 715f 6e65 7720 3d20 7365    # seq_new = se
+0008f550: 715f 6e65 7720 2b20 7365 715f 6672 6167  q_new + seq_frag
+0008f560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008f570: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
+0008f580: 7365 715f 6672 6167 290a 2020 2020 2020  seq_frag).      
+0008f590: 2020 2020 2020 2020 2020 736e 7620 3d20            snv = 
+0008f5a0: 534e 5628 2067 656e 6f6d 652e 6e61 6d65  SNV( genome.name
+0008f5b0: 2c20 6375 725f 706f 735f 6e65 772b 312c  , cur_pos_new+1,
+0008f5c0: 2063 7572 5f70 6f73 5f6f 7267 2b31 2c20   cur_pos_org+1, 
+0008f5d0: 2749 272c 206e 2c20 7365 715f 6672 6167  'I', n, seq_frag
+0008f5e0: 2c20 272d 272c 2053 7461 7274 2c20 456e  , '-', Start, En
+0008f5f0: 6420 2920 2320 6d61 6b65 2069 7420 6f6e  d ) # make it on
+0008f600: 652d 6261 7365 2070 6f73 6974 696f 6e0a  e-base position.
+0008f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f620: 736e 765f 6c73 742e 6170 7065 6e64 2873  snv_lst.append(s
+0008f630: 6e76 290a 2020 2020 2020 2020 2020 2020  nv).            
+0008f640: 2020 2020 6375 725f 706f 735f 6e65 7720      cur_pos_new 
+0008f650: 2b3d 206c 656e 2873 6571 5f66 7261 6729  += len(seq_frag)
+0008f660: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0008f670: 6966 2073 6e76 5f74 7970 6520 3d3d 2032  if snv_type == 2
+0008f680: 3a20 2320 4465 6c65 7469 6f6e 0a20 2020  : # Deletion.   
+0008f690: 2020 2020 2020 2020 2020 2020 206e 203d               n =
+0008f6a0: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
+0008f6b0: 6e74 2830 2c6c 642c 2031 295b 305d 2b31  nt(0,ld, 1)[0]+1
+0008f6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008f6d0: 2073 6571 5f66 7261 6720 3d20 6765 6e6f   seq_frag = geno
+0008f6e0: 6d65 2e73 6571 5b69 6e74 2863 7572 5f70  me.seq[int(cur_p
+0008f6f0: 6f73 5f6f 7267 293a 696e 7428 6375 725f  os_org):int(cur_
+0008f700: 706f 735f 6f72 672b 6e29 5d0a 2020 2020  pos_org+n)].    
+0008f710: 2020 2020 2020 2020 2020 2020 736e 7620              snv 
+0008f720: 3d20 534e 5628 2067 656e 6f6d 652e 6e61  = SNV( genome.na
+0008f730: 6d65 2c20 6375 725f 706f 735f 6e65 772b  me, cur_pos_new+
+0008f740: 312c 2063 7572 5f70 6f73 5f6f 7267 2b31  1, cur_pos_org+1
+0008f750: 2c20 2744 272c 206e 2c20 272d 272c 2073  , 'D', n, '-', s
+0008f760: 6571 5f66 7261 672c 2053 7461 7274 2c20  eq_frag, Start, 
+0008f770: 456e 6420 2920 2320 6d61 6b65 2069 7420  End ) # make it 
+0008f780: 6f6e 652d 6261 7365 2070 6f73 6974 696f  one-base positio
+0008f790: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0008f7a0: 2020 736e 765f 6c73 742e 6170 7065 6e64    snv_lst.append
+0008f7b0: 2873 6e76 290a 2020 2020 2020 2020 2020  (snv).          
+0008f7c0: 2020 2020 2020 6375 725f 706f 735f 6f72        cur_pos_or
+0008f7d0: 6720 2b3d 206e 0a0a 2020 2020 2020 2020  g += n..        
+0008f7e0: 2020 2020 656c 7365 3a20 2320 534e 500a      else: # SNP.
+0008f7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f800: 6e20 3d20 6e70 2e72 616e 646f 6d2e 7261  n = np.random.ra
+0008f810: 6e64 696e 7428 302c 6c76 2c20 3129 5b30  ndint(0,lv, 1)[0
+0008f820: 5d2b 3120 2020 2020 2020 200a 2020 2020  ]+1        .    
+0008f830: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
+0008f840: 746d 7020 3d20 6765 6e6f 6d65 2e73 6571  tmp = genome.seq
+0008f850: 5b69 6e74 2863 7572 5f70 6f73 5f6f 7267  [int(cur_pos_org
+0008f860: 293a 696e 7428 6375 725f 706f 735f 6f72  ):int(cur_pos_or
+0008f870: 672b 6e29 5d0a 2020 2020 2020 2020 2020  g+n)].          
+0008f880: 2020 2020 2020 7365 715f 6672 6167 203d        seq_frag =
+0008f890: 2072 616e 645f 6e75 636c 656f 7469 6465   rand_nucleotide
+0008f8a0: 5f65 7863 6570 7428 7365 715f 746d 7029  _except(seq_tmp)
+0008f8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008f8c0: 2023 2073 6571 5f6e 6577 203d 2073 6571   # seq_new = seq
+0008f8d0: 5f6e 6577 202b 2073 6571 5f66 7261 670a  _new + seq_frag.
+0008f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f8f0: 7365 715f 6c73 742e 6170 7065 6e64 2873  seq_lst.append(s
+0008f900: 6571 5f66 7261 6729 0a20 2020 2020 2020  eq_frag).       
+0008f910: 2020 2020 2020 2020 2073 6e76 203d 2053           snv = S
+0008f920: 4e56 2820 6765 6e6f 6d65 2e6e 616d 652c  NV( genome.name,
+0008f930: 2063 7572 5f70 6f73 5f6e 6577 2b31 2c20   cur_pos_new+1, 
+0008f940: 6375 725f 706f 735f 6f72 672b 312c 2027  cur_pos_org+1, '
+0008f950: 5627 2c20 6e2c 2073 6571 5f66 7261 672c  V', n, seq_frag,
+0008f960: 2073 6571 5f74 6d70 2c20 5374 6172 742c   seq_tmp, Start,
+0008f970: 2045 6e64 2029 2023 206d 616b 6520 6974   End ) # make it
+0008f980: 206f 6e65 2d62 6173 6520 706f 7369 7469   one-base positi
+0008f990: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+0008f9a0: 2020 2073 6e76 5f6c 7374 2e61 7070 656e     snv_lst.appen
+0008f9b0: 6428 736e 7629 0a20 2020 2020 2020 2020  d(snv).         
+0008f9c0: 2020 2020 2020 2063 7572 5f70 6f73 5f6e         cur_pos_n
+0008f9d0: 6577 202b 3d20 6e0a 2020 2020 2020 2020  ew += n.        
+0008f9e0: 2020 2020 2020 2020 6375 725f 706f 735f          cur_pos_
+0008f9f0: 6f72 6720 2b3d 206e 0a0a 2020 2020 2020  org += n..      
+0008fa00: 2020 2020 2020 4c20 3d20 6e70 2e72 616e        L = np.ran
+0008fa10: 646f 6d2e 7261 6e64 696e 7428 3230 2c6d  dom.randint(20,m
+0008fa20: 752c 3129 5b30 5d20 2320 7365 7061 7261  u,1)[0] # separa
+0008fa30: 7465 2053 4e56 2061 7420 6c65 6173 7420  te SNV at least 
+0008fa40: 3230 2062 6173 6573 0a20 2020 2020 2020  20 bases.       
+0008fa50: 2020 2020 206e 6578 745f 706f 735f 6f72       next_pos_or
+0008fa60: 6720 3d20 6375 725f 706f 735f 6f72 6720  g = cur_pos_org 
+0008fa70: 2b20 4c0a 2020 2020 2020 2020 2020 2020  + L.            
+0008fa80: 6966 206e 6578 745f 706f 735f 6f72 6720  if next_pos_org 
+0008fa90: 3e3d 206c 696e 652e 656e 643a 2023 2028  >= line.end: # (
+0008faa0: 6765 6e6f 6d65 2e6c 656e 2d31 3030 293a  genome.len-100):
+0008fab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008fac0: 2023 2073 6571 5f6e 6577 203d 2073 6571   # seq_new = seq
+0008fad0: 5f6e 6577 202b 2067 656e 6f6d 652e 7365  _new + genome.se
+0008fae0: 715b 696e 7428 6375 725f 706f 735f 6f72  q[int(cur_pos_or
+0008faf0: 6729 3a5d 0a20 2020 2020 2020 2020 2020  g):].           
+0008fb00: 2020 2020 2073 6571 5f6c 7374 2e61 7070       seq_lst.app
+0008fb10: 656e 6428 6765 6e6f 6d65 2e73 6571 5b69  end(genome.seq[i
+0008fb20: 6e74 2863 7572 5f70 6f73 5f6f 7267 293a  nt(cur_pos_org):
+0008fb30: 286c 696e 652e 656e 642b 3129 5d29 0a20  (line.end+1)]). 
+0008fb40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0008fb50: 7572 5f70 6f73 5f6e 6577 202b 3d20 2828  ur_pos_new += ((
+0008fb60: 6c69 6e65 2e65 6e64 2b31 292d 6375 725f  line.end+1)-cur_
+0008fb70: 706f 735f 6f72 6729 0a20 2020 2020 2020  pos_org).       
+0008fb80: 2020 2020 2020 2020 2063 7572 5f70 6f73           cur_pos
+0008fb90: 5f6f 7267 203d 2028 6c69 6e65 2e65 6e64  _org = (line.end
+0008fba0: 2b31 290a 2020 2020 2020 2020 2020 2020  +1).            
+0008fbb0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+0008fbc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0008fbd0: 2020 2020 2020 2020 2020 2020 2320 7365              # se
+0008fbe0: 715f 6e65 7720 3d20 7365 715f 6e65 7720  q_new = seq_new 
+0008fbf0: 2b20 6765 6e6f 6d65 2e73 6571 5b69 6e74  + genome.seq[int
+0008fc00: 2863 7572 5f70 6f73 5f6f 7267 293a 696e  (cur_pos_org):in
+0008fc10: 7428 6e65 7874 5f70 6f73 5f6f 7267 295d  t(next_pos_org)]
+0008fc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008fc30: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
+0008fc40: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
+0008fc50: 7572 5f70 6f73 5f6f 7267 293a 696e 7428  ur_pos_org):int(
+0008fc60: 6e65 7874 5f70 6f73 5f6f 7267 295d 290a  next_pos_org)]).
+0008fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008fc80: 6375 725f 706f 735f 6e65 7720 2b3d 2028  cur_pos_new += (
+0008fc90: 6e65 7874 5f70 6f73 5f6f 7267 2d63 7572  next_pos_org-cur
+0008fca0: 5f70 6f73 5f6f 7267 290a 2020 2020 2020  _pos_org).      
+0008fcb0: 2020 2020 2020 2020 2020 6375 725f 706f            cur_po
+0008fcc0: 735f 6f72 6720 3d20 6e65 7874 5f70 6f73  s_org = next_pos
+0008fcd0: 5f6f 7267 0a20 2020 2020 2020 2020 2020  _org.           
+0008fce0: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
+0008fcf0: 2020 2020 2020 6966 2063 6e74 2573 7465        if cnt%ste
+0008fd00: 7020 3d3d 2030 3a20 0a20 2020 2020 2020  p == 0: .       
+0008fd10: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0008fd20: 5c72 2573 202d 2025 692c 2025 692c 2025  \r%s - %i, %i, %
+0008fd30: 6920 2720 2520 2867 656e 6f6d 652e 6e61  i ' % (genome.na
+0008fd40: 6d65 2c20 6375 725f 706f 735f 6f72 672c  me, cur_pos_org,
+0008fd50: 2067 656e 6f6d 652e 6c65 6e2c 2063 7572   genome.len, cur
+0008fd60: 5f70 6f73 5f6e 6577 292c 2065 6e64 3d27  _pos_new), end='
+0008fd70: 2729 0a20 2020 2020 2020 0a20 2020 2069  ').       .    i
+0008fd80: 6620 6375 725f 706f 735f 6f72 6720 3c20  f cur_pos_org < 
+0008fd90: 6765 6e6f 6d65 2e6c 656e 3a0a 2020 2020  genome.len:.    
+0008fda0: 2020 2020 7365 715f 6c73 742e 6170 7065      seq_lst.appe
+0008fdb0: 6e64 2867 656e 6f6d 652e 7365 715b 696e  nd(genome.seq[in
+0008fdc0: 7428 6375 725f 706f 735f 6f72 6729 3a5d  t(cur_pos_org):]
+0008fdd0: 290a 2020 2020 0a20 2020 2073 6571 5f6e  ).    .    seq_n
+0008fde0: 6577 203d 2027 272e 6a6f 696e 2873 6571  ew = ''.join(seq
+0008fdf0: 5f6c 7374 290a 2020 2020 2320 7375 6666  _lst).    # suff
+0008fe00: 6978 203d 2027 2d4c 2569 2d49 2569 2d44  ix = '-L%i-I%i-D
+0008fe10: 2569 2d56 2569 2720 2520 286d 752c 6c69  %i-V%i' % (mu,li
+0008fe20: 2c6c 642c 6c76 290a 2020 2020 2320 6765  ,ld,lv).    # ge
+0008fe30: 6e6f 6d65 5f6e 6577 203d 2047 656e 6f6d  nome_new = Genom
+0008fe40: 6528 2067 656e 6f6d 652e 6865 6164 6572  e( genome.header
+0008fe50: 202b 2073 7566 6669 782c 2073 6571 5f6e   + suffix, seq_n
+0008fe60: 6577 2029 0a20 2020 2067 656e 6f6d 655f  ew ).    genome_
+0008fe70: 6e65 7720 3d20 4765 6e6f 6d65 2820 6765  new = Genome( ge
+0008fe80: 6e6f 6d65 2e68 6561 6465 722c 2073 6571  nome.header, seq
+0008fe90: 5f6e 6577 2029 0a20 2020 2070 7269 6e74  _new ).    print
+0008fea0: 2827 2064 6f6e 652e 2729 0a20 2020 2020  (' done.').     
+0008feb0: 2020 2020 2020 200a 2020 2020 7265 7475         .    retu
+0008fec0: 726e 2867 656e 6f6d 655f 6e65 772c 2073  rn(genome_new, s
+0008fed0: 6e76 5f6c 7374 290a 2020 2020 0a23 2323  nv_lst).    .###
+0008fee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008fef0: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
+0008ff00: 2050 6172 616d 6574 6572 7320 666f 7220   Parameters for 
+0008ff10: 534e 5620 6765 6e65 7261 7469 6f6e 0a0a  SNV generation..
+0008ff20: 505f 494e 5320 3d20 302e 3135 0a50 5f44  P_INS = 0.15.P_D
+0008ff30: 454c 203d 2030 2e31 350a 505f 534e 5020  EL = 0.15.P_SNP 
+0008ff40: 3d20 3120 2d20 505f 494e 5320 2d20 505f  = 1 - P_INS - P_
+0008ff50: 4445 4c0a 0a4c 4920 3d20 330a 4c44 203d  DEL..LI = 3.LD =
+0008ff60: 2033 0a4c 5620 3d20 320a 4c5f 494e 5445   3.LV = 2.L_INTE
+0008ff70: 525f 534e 5620 3d20 3230 300a 0a23 2323  R_SNV = 200..###
+0008ff80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008ff90: 2323 2323 2323 2323 2323 2323 230a 0a64  #############..d
+0008ffa0: 6566 2067 656e 6572 6174 655f 736e 7628  ef generate_snv(
+0008ffb0: 6765 6e6f 6d65 2c20 6774 665f 6c69 6e65  genome, gtf_line
+0008ffc0: 732c 206c 5f69 6e74 6572 5f73 6e76 203d  s, l_inter_snv =
+0008ffd0: 204c 5f49 4e54 4552 5f53 4e56 2c20 5c0a   L_INTER_SNV, \.
+0008ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008fff0: 206c 6920 3d20 4c49 2c20 6c64 203d 204c   li = LI, ld = L
+00090000: 442c 206c 7620 3d20 4c56 2c20 7069 203d  D, lv = LV, pi =
+00090010: 2050 5f49 4e53 2c20 7064 203d 2050 5f44   P_INS, pd = P_D
+00090020: 454c 293a 0a20 2020 200a 2020 2020 7076  EL):.    .    pv
+00090030: 203d 2031 202d 2070 6920 2d20 7064 0a20   = 1 - pi - pd. 
+00090040: 2020 206e 702e 7261 6e64 6f6d 2e73 6565     np.random.see
+00090050: 6428 3029 0a20 2020 2070 7269 6e74 2827  d(0).    print('
+00090060: 4765 6e65 7261 7469 6e67 2053 4e56 2027  Generating SNV '
+00090070: 2c65 6e64 3d27 2729 0a20 2020 2046 6561  ,end='').    Fea
+00090080: 7475 7265 7320 3d20 6765 745f 636f 6c28  tures = get_col(
+00090090: 6774 665f 6c69 6e65 732c 2032 290a 2020  gtf_lines, 2).  
+000900a0: 2020 7768 203d 2077 6869 6368 2820 4665    wh = which( Fe
+000900b0: 6174 7572 6573 2c20 2765 786f 6e27 2029  atures, 'exon' )
+000900c0: 0a20 2020 2067 7466 5f65 786f 6e73 203d  .    gtf_exons =
+000900d0: 205b 6774 665f 6c69 6e65 735b 775d 2066   [gtf_lines[w] f
+000900e0: 6f72 2077 2069 6e20 7768 5d20 0a0a 2020  or w in wh] ..  
+000900f0: 2020 2320 7072 696e 7428 6c65 6e28 4665    # print(len(Fe
+00090100: 6174 7572 6573 2929 0a20 2020 2043 6872  atures)).    Chr
+00090110: 7320 3d20 6765 745f 636f 6c28 6774 665f  s = get_col(gtf_
+00090120: 6578 6f6e 732c 2030 290a 2020 2020 4368  exons, 0).    Ch
+00090130: 725f 6e61 6d65 7320 3d20 736f 7274 6564  r_names = sorted
+00090140: 2873 6574 2843 6872 7329 290a 0a20 2020  (set(Chrs))..   
+00090150: 2073 6e76 5f6c 7374 5f61 6c6c 203d 205b   snv_lst_all = [
+00090160: 5d0a 2020 2020 6765 6e6f 6d65 5f6e 6577  ].    genome_new
+00090170: 203d 207b 7d0a 2020 2020 666f 7220 4368   = {}.    for Ch
+00090180: 7220 696e 2043 6872 5f6e 616d 6573 3a0a  r in Chr_names:.
+00090190: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000901a0: 2069 6620 4368 7220 696e 2067 656e 6f6d   if Chr in genom
+000901b0: 652e 6b65 7973 2829 3a0a 2020 2020 2020  e.keys():.      
+000901c0: 2020 2020 2020 7768 203d 2077 6869 6368        wh = which
+000901d0: 2820 4368 7273 2c20 4368 7220 290a 2020  ( Chrs, Chr ).  
+000901e0: 2020 2020 2020 2020 2020 6774 665f 6368            gtf_ch
+000901f0: 7220 3d20 5b67 7466 5f65 786f 6e73 5b77  r = [gtf_exons[w
+00090200: 5d20 666f 7220 7720 696e 2077 685d 0a20  ] for w in wh]. 
+00090210: 2020 2020 2020 2020 2020 2050 6f73 5f73             Pos_s
+00090220: 7461 7274 203d 206e 702e 6172 7261 7928  tart = np.array(
+00090230: 2067 6574 5f63 6f6c 2867 7466 5f63 6872   get_col(gtf_chr
+00090240: 2c20 3329 2029 0a20 2020 2020 2020 2020  , 3) ).         
+00090250: 2020 206f 6472 203d 2050 6f73 5f73 7461     odr = Pos_sta
+00090260: 7274 2e61 7267 736f 7274 2829 0a0a 2020  rt.argsort()..  
+00090270: 2020 2020 2020 2020 2020 6774 665f 6368            gtf_ch
+00090280: 725f 736f 7274 6564 203d 205b 5d0a 2020  r_sorted = [].  
+00090290: 2020 2020 2020 2020 2020 7070 203d 2030            pp = 0
+000902a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000902b0: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
+000902c0: 6774 665f 6368 7229 293a 0a20 2020 2020  gtf_chr)):.     
+000902d0: 2020 2020 2020 2020 2020 206c 696e 6520             line 
+000902e0: 3d20 6774 665f 6368 725b 6f64 725b 6b5d  = gtf_chr[odr[k]
+000902f0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00090300: 2020 6774 665f 6368 725f 736f 7274 6564    gtf_chr_sorted
+00090310: 2e61 7070 656e 6428 6c69 6e65 290a 2020  .append(line).  
+00090320: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00090330: 206c 696e 652e 7374 6172 7420 3c20 7070   line.start < pp
+00090340: 3a20 7072 696e 7428 6c69 6e65 290a 2020  : print(line).  
+00090350: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00090360: 203d 206c 696e 652e 7374 6172 740a 0a20   = line.start.. 
+00090370: 2020 2020 2020 2020 2020 2067 6e6d 2c20             gnm, 
+00090380: 736e 765f 6c73 7420 3d20 6765 6e65 7261  snv_lst = genera
+00090390: 7465 5f73 6e76 5f77 6974 685f 6774 6628  te_snv_with_gtf(
+000903a0: 2067 656e 6f6d 655b 4368 725d 2c20 6774   genome[Chr], gt
+000903b0: 665f 6368 725f 736f 7274 6564 2c20 6d75  f_chr_sorted, mu
+000903c0: 203d 206c 5f69 6e74 6572 5f73 6e76 2c20   = l_inter_snv, 
+000903d0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+000903e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000903f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090400: 2020 2020 6c69 203d 206c 692c 206c 6420      li = li, ld 
+00090410: 3d20 6c64 2c20 6c76 203d 206c 762c 2070  = ld, lv = lv, p
+00090420: 6920 3d20 7069 2c20 7064 203d 2070 6420  i = pi, pd = pd 
+00090430: 290a 2020 2020 2020 2020 2020 2020 736e  ).            sn
+00090440: 765f 6c73 745f 616c 6c20 3d20 736e 765f  v_lst_all = snv_
+00090450: 6c73 745f 616c 6c20 2b20 736e 765f 6c73  lst_all + snv_ls
+00090460: 740a 2020 2020 2020 2020 2020 2020 6765  t.            ge
+00090470: 6e6f 6d65 5f6e 6577 5b43 6872 5d20 3d20  nome_new[Chr] = 
+00090480: 676e 6d0a 2020 2020 200a 2020 2020 7265  gnm.     .    re
+00090490: 7475 726e 2867 656e 6f6d 655f 6e65 772c  turn(genome_new,
+000904a0: 2073 6e76 5f6c 7374 5f61 6c6c 2c20 4665   snv_lst_all, Fe
+000904b0: 6174 7572 6573 290a 2020 2020 0a23 2323  atures).    .###
+000904c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000904d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000904e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000904f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090500: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00090510: 2323 2046 756e 6374 696f 6e73 2066 6f72  ## Functions for
+00090520: 2065 7661 6c75 6174 696f 6e20 6f66 2053   evaluation of S
+00090530: 4e56 2064 6574 6563 7469 6f6e 0a23 2323  NV detection.###
+00090540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090580: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00090590: 0a64 6566 2067 6574 5f73 7061 6e5f 6c73  .def get_span_ls
+000905a0: 7428 7267 6e73 5f6c 7374 5f6d 692c 2054  t(rgns_lst_mi, T
+000905b0: 7970 6520 3d20 274d 2729 3a0a 2020 2020  ype = 'M'):.    
+000905c0: 0a20 2020 2073 7061 6e5f 6c73 7420 3d20  .    span_lst = 
+000905d0: 5b5d 0a20 2020 2066 6f72 2072 5f6d 2069  [].    for r_m i
+000905e0: 6e20 7267 6e73 5f6c 7374 5f6d 693a 0a20  n rgns_lst_mi:. 
+000905f0: 2020 2020 2020 2073 706e 203d 2072 5f6d         spn = r_m
+00090600: 2e67 6574 5f73 7061 6e28 290a 2020 2020  .get_span().    
+00090610: 2020 2020 7370 6e2e 7479 7065 203d 2054      spn.type = T
+00090620: 7970 650a 2020 2020 2020 2020 7370 616e  ype.        span
+00090630: 5f6c 7374 2e61 7070 656e 6428 2073 706e  _lst.append( spn
+00090640: 2029 0a20 2020 2072 6574 7572 6e28 7370   ).    return(sp
+00090650: 616e 5f6c 7374 290a 0a23 2320 5365 6c65  an_lst)..## Sele
+00090660: 6374 2053 4e56 2773 2074 6861 7420 6661  ct SNV's that fa
+00090670: 6c6c 7320 7769 7468 696e 2074 6865 2063  lls within the c
+00090680: 6f76 6572 6564 2072 6567 696f 6e0a 6465  overed region.de
+00090690: 6620 7365 6c65 6374 5f73 6e76 7328 2064  f select_snvs( d
+000906a0: 665f 736e 762c 2073 7061 6e5f 6c73 742c  f_snv, span_lst,
+000906b0: 2072 676e 735f 6c73 745f 6d69 2c20 5479   rgns_lst_mi, Ty
+000906c0: 7065 203d 2027 4d27 2c20 6d64 6576 203d  pe = 'M', mdev =
+000906d0: 2031 3220 293a 0a20 2020 200a 2020 2020   12 ):.    .    
+000906e0: 7072 696e 7428 2743 6865 636b 696e 6720  print('Checking 
+000906f0: 696e 7465 7273 6563 7469 6f6e 202e 2e20  intersection .. 
+00090700: 272c 2065 6e64 3d27 2729 0a20 2020 2073  ', end='').    s
+00090710: 7465 7020 3d20 6e70 2e63 6569 6c28 6466  tep = np.ceil(df
+00090720: 5f73 6e76 2e73 6861 7065 5b30 5d2f 3230  _snv.shape[0]/20
+00090730: 290a 2020 2020 0a20 2020 2064 665f 736e  ).    .    df_sn
+00090740: 765b 2773 7461 7274 275d 203d 2064 665f  v['start'] = df_
+00090750: 736e 765b 2770 6f73 5f6f 7267 275d 202d  snv['pos_org'] -
+00090760: 206d 6465 760a 2020 2020 6466 5f73 6e76   mdev.    df_snv
+00090770: 5b27 656e 6427 5d20 3d20 6466 5f73 6e76  ['end'] = df_snv
+00090780: 5b27 706f 735f 6f72 6727 5d20 2b20 6466  ['pos_org'] + df
+00090790: 5f73 6e76 5b27 6c65 6e27 5d20 2b20 6d64  _snv['len'] + md
+000907a0: 6576 0a20 2020 2064 665f 736e 765b 2763  ev.    df_snv['c
+000907b0: 7667 275d 203d 2030 0a0a 2020 2020 625f  vg'] = 0..    b_
+000907c0: 7072 6f63 203d 206e 702e 6675 6c6c 2864  proc = np.full(d
+000907d0: 665f 736e 762e 7368 6170 655b 305d 2c20  f_snv.shape[0], 
+000907e0: 4661 6c73 6529 0a20 2020 2066 6f72 206b  False).    for k
+000907f0: 2c20 7370 616e 2069 6e20 656e 756d 6572  , span in enumer
+00090800: 6174 6528 7370 616e 5f6c 7374 293a 0a20  ate(span_lst):. 
+00090810: 2020 2020 2020 2062 3020 3d20 6466 5f73         b0 = df_s
+00090820: 6e76 5b27 6368 7227 5d20 3d3d 2073 7061  nv['chr'] == spa
+00090830: 6e2e 6368 720a 2020 2020 2020 2020 6231  n.chr.        b1
+00090840: 203d 2028 6466 5f73 6e76 5b27 7374 6172   = (df_snv['star
+00090850: 7427 5d20 3e3d 2073 7061 6e2e 7374 6172  t'] >= span.star
+00090860: 7429 2026 2028 2864 665f 736e 765b 2773  t) & ((df_snv['s
+00090870: 7461 7274 275d 203c 3d20 7370 616e 2e65  tart'] <= span.e
+00090880: 6e64 2929 0a20 2020 2020 2020 2062 3220  nd)).        b2 
+00090890: 3d20 2864 665f 736e 765b 2765 6e64 275d  = (df_snv['end']
+000908a0: 203e 3d20 7370 616e 2e73 7461 7274 2920   >= span.start) 
+000908b0: 2620 2828 6466 5f73 6e76 5b27 656e 6427  & ((df_snv['end'
+000908c0: 5d20 3c3d 2073 7061 6e2e 656e 6429 290a  ] <= span.end)).
+000908d0: 2020 2020 2020 2020 6220 3d20 6230 2026          b = b0 &
+000908e0: 2028 6231 207c 2062 3229 2026 2028 625f   (b1 | b2) & (b_
+000908f0: 7072 6f63 203d 3d20 4661 6c73 6529 0a20  proc == False). 
+00090900: 2020 2020 2020 2064 665f 736e 765f 746d         df_snv_tm
+00090910: 7020 3d20 6466 5f73 6e76 5b62 5d0a 2020  p = df_snv[b].  
+00090920: 2020 2020 2020 666f 7220 6d2c 2072 6f77        for m, row
+00090930: 2069 6e20 6466 5f73 6e76 5f74 6d70 2e69   in df_snv_tmp.i
+00090940: 7465 7272 6f77 7328 293a 0a20 2020 2020  terrows():.     
+00090950: 2020 2020 2020 2072 676e 203d 2072 6567         rgn = reg
+00090960: 696f 6e28 2072 6f77 2e63 6872 2c20 726f  ion( row.chr, ro
+00090970: 772e 7374 6172 742c 2072 6f77 2e65 6e64  w.start, row.end
+00090980: 2c20 5479 7065 2029 0a20 2020 2020 2020  , Type ).       
+00090990: 2020 2020 2062 622c 2063 6320 3d20 7267       bb, cc = rg
+000909a0: 6e73 5f6c 7374 5f6d 695b 6b5d 2e67 6574  ns_lst_mi[k].get
+000909b0: 5f69 6e74 6572 7365 6374 696f 6e5f 6376  _intersection_cv
+000909c0: 6728 7267 6e29 200a 2020 2020 2020 2020  g(rgn) .        
+000909d0: 2020 2020 6966 2062 623a 200a 2020 2020      if bb: .    
+000909e0: 2020 2020 2020 2020 2020 2020 625f 7072              b_pr
+000909f0: 6f63 5b6d 5d20 3d20 5472 7565 0a20 2020  oc[m] = True.   
+00090a00: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00090a10: 736e 762e 6c6f 635b 6d2c 2763 7667 275d  snv.loc[m,'cvg']
+00090a20: 203d 2063 630a 2020 2020 2020 2020 2020   = cc.          
+00090a30: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00090a40: 2069 6620 6b25 7374 6570 203d 3d20 303a   if k%step == 0:
+00090a50: 2070 7269 6e74 2827 2e27 2c65 6e64 3d27   print('.',end='
+00090a60: 2729 0a20 2020 2020 2020 2069 6620 6b25  ').        if k%
+00090a70: 3130 203d 3d20 303a 2020 2020 0a20 2020  10 == 0:    .   
+00090a80: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00090a90: 5c72 4368 6563 6b69 6e67 2069 6e74 6572  \rChecking inter
+00090aa0: 7365 6374 696f 6e20 2e2e 2025 692f 2569  section .. %i/%i
+00090ab0: 2028 2569 2927 2025 2028 6b2c 206c 656e   (%i)' % (k, len
+00090ac0: 2873 7061 6e5f 6c73 7429 2c20 6e70 2e73  (span_lst), np.s
+00090ad0: 756d 2862 5f70 726f 6329 292c 2065 6e64  um(b_proc)), end
+00090ae0: 3d27 2720 290a 0a20 2020 2070 7269 6e74  ='' )..    print
+00090af0: 2827 5c72 4368 6563 6b69 6e67 2069 6e74  ('\rChecking int
+00090b00: 6572 7365 6374 696f 6e20 2e2e 2064 6f6e  ersection .. don
+00090b10: 652e 2025 6920 2d3e 2025 6927 2025 2028  e. %i -> %i' % (
+00090b20: 6466 5f73 6e76 2e73 6861 7065 5b30 5d2c  df_snv.shape[0],
+00090b30: 206e 702e 7375 6d28 625f 7072 6f63 2929   np.sum(b_proc))
+00090b40: 2029 0a20 2020 200a 2020 2020 6466 5f73   ).    .    df_s
+00090b50: 6e76 5f73 656c 203d 2028 6466 5f73 6e76  nv_sel = (df_snv
+00090b60: 2e69 6c6f 635b 625f 7072 6f63 5d29 2e63  .iloc[b_proc]).c
+00090b70: 6f70 7928 6465 6570 203d 2054 7275 6529  opy(deep = True)
+00090b80: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
+00090b90: 2864 665f 736e 765f 7365 6c29 0a0a 0a64  (df_snv_sel)...d
+00090ba0: 6566 206d 6174 6368 696e 675f 736e 7673  ef matching_snvs
+00090bb0: 2820 6466 5f73 6e76 5f73 656c 2c20 6466  ( df_snv_sel, df
+00090bc0: 5f64 6574 6563 7465 642c 2064 6576 5f74  _detected, dev_t
+00090bd0: 6f6c 203d 2033 2029 3a0a 2020 2020 0a20  ol = 3 ):.    . 
+00090be0: 2020 2023 2320 7468 6520 6461 7461 6672     ## the datafr
+00090bf0: 616d 6573 206d 7573 6820 6265 2073 6f72  ames mush be sor
+00090c00: 7465 6420 6163 636f 7264 696e 6720 746f  ted according to
+00090c10: 2074 6865 2070 6f73 6974 696f 6e20 2870   the position (p
+00090c20: 6f73 5f6e 6577 2c20 7374 6172 7429 0a20  os_new, start). 
+00090c30: 2020 2064 665f 745f 616c 6c20 3d20 6466     df_t_all = df
+00090c40: 5f73 6e76 5f73 656c 0a20 2020 2064 665f  _snv_sel.    df_
+00090c50: 645f 616c 6c20 3d20 6466 5f64 6574 6563  d_all = df_detec
+00090c60: 7465 640a 0a20 2020 2063 6e74 203d 2030  ted..    cnt = 0
+00090c70: 0a20 2020 2063 6872 6d73 203d 2064 665f  .    chrms = df_
+00090c80: 745f 616c 6c5b 2763 6872 275d 0a20 2020  t_all['chr'].   
+00090c90: 2063 6872 5f6c 7374 203d 206c 6973 7428   chr_lst = list(
+00090ca0: 7365 7428 6368 726d 7329 290a 2020 2020  set(chrms)).    
+00090cb0: 6368 725f 6c73 742e 736f 7274 2829 0a0a  chr_lst.sort()..
+00090cc0: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
+00090cd0: 4e5f 7420 3d20 300a 2020 2020 4e5f 6420  N_t = 0.    N_d 
+00090ce0: 3d20 300a 2020 2020 666f 7220 6e2c 2063  = 0.    for n, c
+00090cf0: 6872 6d20 696e 2065 6e75 6d65 7261 7465  hrm in enumerate
+00090d00: 2863 6872 5f6c 7374 293a 0a20 2020 2020  (chr_lst):.     
+00090d10: 2020 200a 2020 2020 2020 2020 6231 203d     .        b1 =
+00090d20: 2028 6466 5f74 5f61 6c6c 5b27 6368 7227   (df_t_all['chr'
+00090d30: 5d20 3d3d 2063 6872 6d29 0a20 2020 2020  ] == chrm).     
+00090d40: 2020 2062 3220 3d20 2864 665f 645f 616c     b2 = (df_d_al
+00090d50: 6c5b 2763 6872 275d 203d 3d20 6368 726d  l['chr'] == chrm
+00090d60: 290a 2020 2020 0a20 2020 2020 2020 2069  ).    .        i
+00090d70: 6620 286e 702e 7375 6d28 6231 2920 3d3d  f (np.sum(b1) ==
+00090d80: 2030 2920 7c20 286e 702e 7375 6d28 6232   0) | (np.sum(b2
+00090d90: 2920 3d3d 2030 293a 2020 2020 2020 2020  ) == 0):        
+00090da0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00090db0: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
+00090dc0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00090dd0: 2020 2020 2020 2020 2064 665f 7420 3d20           df_t = 
+00090de0: 6466 5f74 5f61 6c6c 2e6c 6f63 5b62 312c  df_t_all.loc[b1,
+00090df0: 3a5d 2e63 6f70 7928 6465 6570 203d 2054  :].copy(deep = T
+00090e00: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00090e10: 2064 665f 6420 3d20 6466 5f64 5f61 6c6c   df_d = df_d_all
+00090e20: 2e6c 6f63 5b62 322c 3a5d 2e63 6f70 7928  .loc[b2,:].copy(
+00090e30: 6465 6570 203d 2054 7275 6529 0a20 2020  deep = True).   
+00090e40: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00090e50: 2020 2020 2020 6e5f 7461 7267 6574 203d        n_target =
+00090e60: 2064 665f 742e 7368 6170 655b 305d 0a20   df_t.shape[0]. 
+00090e70: 2020 2020 2020 2020 2020 206e 5f64 6574             n_det
+00090e80: 6563 7465 6420 3d20 6466 5f64 2e73 6861  ected = df_d.sha
+00090e90: 7065 5b30 5d0a 2020 2020 2020 2020 2020  pe[0].          
+00090ea0: 2020 0a20 2020 2020 2020 2020 2020 204e    .            N
+00090eb0: 5f74 202b 3d20 6e5f 7461 7267 6574 0a20  _t += n_target. 
+00090ec0: 2020 2020 2020 2020 2020 204e 5f64 202b             N_d +
+00090ed0: 3d20 6e5f 6465 7465 6374 6564 0a20 2020  = n_detected.   
+00090ee0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00090ef0: 2020 2020 2020 2320 7072 696e 7428 275c        # print('\
+00090f00: 724d 6174 6368 696e 6720 2573 2027 2025  rMatching %s ' %
+00090f10: 2028 6368 726d 2920 2c20 656e 643d 2727   (chrm) , end=''
+00090f20: 290a 2020 2020 2020 2020 2020 2020 636e  ).            cn
+00090f30: 745f 7420 3d20 300a 2020 2020 2020 2020  t_t = 0.        
+00090f40: 2020 2020 636e 745f 6420 3d20 300a 2020      cnt_d = 0.  
+00090f50: 2020 2020 2020 2020 2020 6d61 7463 6820            match 
+00090f60: 3d20 6e70 2e66 756c 6c28 6e5f 7461 7267  = np.full(n_targ
+00090f70: 6574 2c20 2d31 290a 2020 2020 2020 2020  et, -1).        
+00090f80: 2020 2020 6469 7374 203d 206e 702e 6675      dist = np.fu
+00090f90: 6c6c 286e 5f74 6172 6765 742c 2030 290a  ll(n_target, 0).
+00090fa0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00090fb0: 2020 2020 2020 2020 2077 6869 6c65 2054           while T
+00090fc0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+00090fd0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00090fe0: 2020 2020 2020 6966 2028 636e 745f 6420        if (cnt_d 
+00090ff0: 3e3d 206e 5f64 6574 6563 7465 6429 207c  >= n_detected) |
+00091000: 2028 636e 745f 7420 3e3d 206e 5f74 6172   (cnt_t >= n_tar
+00091010: 6765 7429 3a20 6272 6561 6b0a 2020 2020  get): break.    
+00091020: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00091030: 7428 275c 724d 6174 6368 696e 6720 2573  t('\rMatching %s
+00091040: 2c20 2569 2f25 6920 2e2e 2025 692f 2569  , %i/%i .. %i/%i
+00091050: 2c20 2569 2f25 6920 2720 2520 5c0a 2020  , %i/%i ' % \.  
+00091060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091070: 2020 2020 2863 6872 6d2c 206e 2c20 6c65      (chrm, n, le
+00091080: 6e28 6368 725f 6c73 7429 2c20 636e 745f  n(chr_lst), cnt_
+00091090: 742c 206e 5f74 6172 6765 742c 2063 6e74  t, n_target, cnt
+000910a0: 5f64 2c20 6e5f 6465 7465 6374 6564 2920  _d, n_detected) 
+000910b0: 2c20 656e 643d 2727 290a 0a20 2020 2020  , end='')..     
+000910c0: 2020 2020 2020 2020 2020 2070 5f74 203d             p_t =
+000910d0: 2064 665f 742e 696c 6f63 5b63 6e74 5f74   df_t.iloc[cnt_t
+000910e0: 5d2e 706f 735f 6f72 670a 2020 2020 2020  ].pos_org.      
+000910f0: 2020 2020 2020 2020 2020 705f 6420 3d20            p_d = 
+00091100: 6466 5f64 2e69 6c6f 635b 636e 745f 645d  df_d.iloc[cnt_d]
+00091110: 2e70 6f73 5f6f 7267 0a20 2020 2020 2020  .pos_org.       
+00091120: 2020 2020 2020 2020 2074 5f74 203d 2064           t_t = d
+00091130: 665f 742e 696c 6f63 5b63 6e74 5f74 5d2e  f_t.iloc[cnt_t].
+00091140: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
+00091150: 2020 2020 2074 5f64 203d 2064 665f 642e       t_d = df_d.
+00091160: 696c 6f63 5b63 6e74 5f64 5d2e 7479 7065  iloc[cnt_d].type
+00091170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091180: 204c 5f74 203d 206d 6178 286c 656e 2864   L_t = max(len(d
+00091190: 665f 742e 696c 6f63 5b63 6e74 5f74 5d2e  f_t.iloc[cnt_t].
+000911a0: 7365 715f 6f72 6729 2c20 6c65 6e28 6466  seq_org), len(df
+000911b0: 5f74 2e69 6c6f 635b 636e 745f 745d 2e73  _t.iloc[cnt_t].s
+000911c0: 6571 5f6e 6577 2929 0a20 2020 2020 2020  eq_new)).       
+000911d0: 2020 2020 2020 2020 204c 5f64 203d 206d           L_d = m
+000911e0: 6178 286c 656e 2864 665f 642e 696c 6f63  ax(len(df_d.iloc
+000911f0: 5b63 6e74 5f64 5d2e 7365 715f 6f72 6729  [cnt_d].seq_org)
+00091200: 2c20 6c65 6e28 6466 5f64 2e69 6c6f 635b  , len(df_d.iloc[
+00091210: 636e 745f 645d 2e73 6571 5f6e 6577 2929  cnt_d].seq_new))
+00091220: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00091230: 2020 6966 2028 705f 7429 203e 2028 705f    if (p_t) > (p_
+00091240: 6420 2b20 4c5f 6420 2b20 6465 765f 746f  d + L_d + dev_to
+00091250: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
+00091260: 2020 2020 2020 2020 636e 745f 6420 2b3d          cnt_d +=
+00091270: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00091280: 2020 2020 2020 2069 6620 636e 745f 6420         if cnt_d 
+00091290: 3e3d 206e 5f64 6574 6563 7465 643a 2062  >= n_detected: b
+000912a0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+000912b0: 2020 2020 2065 6c69 6620 2870 5f74 202b       elif (p_t +
+000912c0: 204c 5f74 202b 2064 6576 5f74 6f6c 2920   L_t + dev_tol) 
+000912d0: 3c20 2870 5f64 293a 0a20 2020 2020 2020  < (p_d):.       
+000912e0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
+000912f0: 5f74 202b 3d20 310a 2020 2020 2020 2020  _t += 1.        
+00091300: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00091310: 6e74 5f74 203e 3d20 6e5f 7461 7267 6574  nt_t >= n_target
+00091320: 3a20 6272 6561 6b0a 2020 2020 2020 2020  : break.        
+00091330: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00091340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091350: 2020 6220 3d20 5472 7565 0a20 2020 2020    b = True.     
+00091360: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00091370: 6620 2874 5f74 203d 3d20 2756 2729 2026  f (t_t == 'V') &
+00091380: 2028 745f 6420 3d3d 2027 5627 293a 0a20   (t_d == 'V'):. 
+00091390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000913a0: 2020 2020 2020 2069 6620 6c65 6e28 6466         if len(df
+000913b0: 5f74 2e69 6c6f 635b 636e 745f 745d 2e73  _t.iloc[cnt_t].s
+000913c0: 6571 5f6e 6577 2920 3d3d 206c 656e 2864  eq_new) == len(d
+000913d0: 665f 642e 696c 6f63 5b63 6e74 5f64 5d2e  f_d.iloc[cnt_d].
+000913e0: 7365 715f 6e65 7729 3a0a 2020 2020 2020  seq_new):.      
 000913f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091400: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
-00091410: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00091420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091430: 2020 2020 636e 745f 6420 2b3d 2031 0a20      cnt_d += 1. 
-00091440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091450: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00091460: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00091470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091480: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00091400: 2020 2020 2020 6966 2028 705f 7420 3d3d        if (p_t ==
+00091410: 2070 5f64 2920 2620 2864 665f 742e 696c   p_d) & (df_t.il
+00091420: 6f63 5b63 6e74 5f74 5d2e 7365 715f 6e65  oc[cnt_t].seq_ne
+00091430: 7720 3d3d 2064 665f 642e 696c 6f63 5b63  w == df_d.iloc[c
+00091440: 6e74 5f64 5d2e 7365 715f 6e65 7729 3a0a  nt_d].seq_new):.
+00091450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091470: 6d61 7463 685b 636e 745f 745d 203d 2063  match[cnt_t] = c
+00091480: 6e74 5f64 0a20 2020 2020 2020 2020 2020  nt_d.           
 00091490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914a0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-000914b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000914a0: 2020 2020 2064 6973 745b 636e 745f 745d       dist[cnt_t]
+000914b0: 203d 2070 5f74 202d 2070 5f64 0a20 2020   = p_t - p_d.   
 000914c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914d0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
-000914e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914f0: 2020 2020 6d61 7463 685b 636e 745f 745d      match[cnt_t]
-00091500: 203d 2063 6e74 5f64 0a20 2020 2020 2020   = cnt_d.       
-00091510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091520: 2020 2020 2020 2020 2064 6973 745b 636e           dist[cn
-00091530: 745f 745d 203d 2070 5f74 202d 2070 5f64  t_t] = p_t - p_d
-00091540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091560: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
-00091570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091580: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-00091590: 6420 2b3d 2031 0a20 2020 2020 2020 2020  d += 1.         
-000915a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000915b0: 2020 2020 2020 2062 203d 2046 616c 7365         b = False
-000915c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000915d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000915e0: 2027 2727 0a20 2020 2020 2020 2020 2020   '''.           
-000915f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00091600: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00091610: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00091620: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-00091630: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000914d0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
+000914e0: 5f74 202b 3d20 310a 2020 2020 2020 2020  _t += 1.        
+000914f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091500: 2020 2020 2020 2020 636e 745f 6420 2b3d          cnt_d +=
+00091510: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00091520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091530: 2020 2062 203d 2046 616c 7365 0a20 2020     b = False.   
+00091540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091550: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00091560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091570: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00091580: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+00091590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915a0: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
+000915b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915c0: 2020 2020 2020 2020 6d61 7463 685b 636e          match[cn
+000915d0: 745f 745d 203d 2063 6e74 5f64 0a20 2020  t_t] = cnt_d.   
+000915e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915f0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+00091600: 745b 636e 745f 745d 203d 2070 5f74 202d  t[cnt_t] = p_t -
+00091610: 2070 5f64 0a20 2020 2020 2020 2020 2020   p_d.           
+00091620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091630: 2020 2020 2063 6e74 5f74 202b 3d20 310a       cnt_t += 1.
 00091640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091650: 2020 2020 2069 6620 623a 0a20 2020 2020       if b:.     
-00091660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091670: 2020 2020 2020 2063 6e74 5f74 202b 3d20         cnt_t += 
-00091680: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00091690: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-000916a0: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
-000916b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000916c0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-000916d0: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
-000916e0: 745f 7420 3d3d 2027 4927 2920 2620 2874  t_t == 'I') & (t
-000916f0: 5f64 203d 3d20 2744 2729 3a0a 2020 2020  _d == 'D'):.    
+00091650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091660: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
+00091670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091680: 2020 2020 2020 2020 2020 2062 203d 2046             b = F
+00091690: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+000916a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000916b0: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
+000916c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000916d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000916e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000916f0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
 00091700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091710: 2020 2020 6d61 7463 685b 636e 745f 745d      match[cnt_t]
-00091720: 203d 2063 6e74 5f64 0a20 2020 2020 2020   = cnt_d.       
+00091710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091720: 2020 2020 2020 2020 2069 6620 623a 0a20           if b:. 
 00091730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091740: 2064 6973 745b 636e 745f 745d 203d 2070   dist[cnt_t] = p
-00091750: 5f74 202d 2070 5f64 0a20 2020 2020 2020  _t - p_d.       
+00091740: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
+00091750: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
 00091760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091770: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
+00091770: 2020 636e 745f 6420 2b3d 2031 0a20 2020    cnt_d += 1.   
 00091780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091790: 2020 2020 636e 745f 6420 2b3d 2031 0a20      cnt_d += 1. 
-000917a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000917b0: 2020 2020 2020 2062 203d 2046 616c 7365         b = False
-000917c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000917d0: 2020 2020 2020 656c 6966 2028 745f 7420        elif (t_t 
-000917e0: 3d3d 2027 4427 2920 2620 2874 5f64 203d  == 'D') & (t_d =
-000917f0: 3d20 2749 2729 3a0a 2020 2020 2020 2020  = 'I'):.        
+00091790: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+000917a0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000917b0: 6966 2028 745f 7420 3d3d 2027 4927 2920  if (t_t == 'I') 
+000917c0: 2620 2874 5f64 203d 3d20 2744 2729 3a0a  & (t_d == 'D'):.
+000917d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000917e0: 2020 2020 2020 2020 6d61 7463 685b 636e          match[cn
+000917f0: 745f 745d 203d 2063 6e74 5f64 0a20 2020  t_t] = cnt_d.   
 00091800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091810: 6d61 7463 685b 636e 745f 745d 203d 2063  match[cnt_t] = c
-00091820: 6e74 5f64 0a20 2020 2020 2020 2020 2020  nt_d.           
-00091830: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-00091840: 745b 636e 745f 745d 203d 2070 5f74 202d  t[cnt_t] = p_t -
-00091850: 2070 5f64 0a20 2020 2020 2020 2020 2020   p_d.           
-00091860: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
-00091870: 5f74 202b 3d20 310a 2020 2020 2020 2020  _t += 1.        
-00091880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091890: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
-000918a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918b0: 2020 2062 203d 2046 616c 7365 0a20 2020     b = False.   
-000918c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000918d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000918e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000918f0: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
+00091810: 2020 2020 2064 6973 745b 636e 745f 745d       dist[cnt_t]
+00091820: 203d 2070 5f74 202d 2070 5f64 0a20 2020   = p_t - p_d.   
+00091830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091840: 2020 2020 2063 6e74 5f74 202b 3d20 310a       cnt_t += 1.
+00091850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091860: 2020 2020 2020 2020 636e 745f 6420 2b3d          cnt_d +=
+00091870: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00091880: 2020 2020 2020 2020 2020 2062 203d 2046             b = F
+00091890: 616c 7365 0a0a 2020 2020 2020 2020 2020  alse..          
+000918a0: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
+000918b0: 745f 7420 3d3d 2027 4427 2920 2620 2874  t_t == 'D') & (t
+000918c0: 5f64 203d 3d20 2749 2729 3a0a 2020 2020  _d == 'I'):.    
+000918d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000918e0: 2020 2020 6d61 7463 685b 636e 745f 745d      match[cnt_t]
+000918f0: 203d 2063 6e74 5f64 0a20 2020 2020 2020   = cnt_d.       
 00091900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091910: 2020 2020 2320 636e 745f 6420 2b3d 2031      # cnt_d += 1
-00091920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091930: 2020 2020 2020 2020 2069 6620 2863 6e74           if (cnt
-00091940: 5f64 203e 3d20 6e5f 6465 7465 6374 6564  _d >= n_detected
-00091950: 2920 7c20 2863 6e74 5f74 203e 3d20 6e5f  ) | (cnt_t >= n_
-00091960: 7461 7267 6574 293a 2062 7265 616b 0a20  target): break. 
+00091910: 2064 6973 745b 636e 745f 745d 203d 2070   dist[cnt_t] = p
+00091920: 5f74 202d 2070 5f64 0a20 2020 2020 2020  _t - p_d.       
+00091930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091940: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
+00091950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091960: 2020 2020 636e 745f 6420 2b3d 2031 0a20      cnt_d += 1. 
 00091970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091980: 2020 2020 2020 200a 0a20 2020 2020 2020         ..       
-00091990: 2020 2020 2062 203d 206d 6174 6368 203e       b = match >
-000919a0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-000919b0: 7768 5f74 203d 2077 6869 6368 2862 290a  wh_t = which(b).
-000919c0: 2020 2020 2020 2020 2020 2020 7768 5f64              wh_d
-000919d0: 203d 206d 6174 6368 5b77 685f 745d 0a20   = match[wh_t]. 
-000919e0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-000919f0: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
-00091a00: 685f 7429 203e 2030 3a0a 2020 2020 2020  h_t) > 0:.      
-00091a10: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
-00091a20: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00091a30: 2020 2020 2020 2020 2020 2064 665f 745b             df_t[
-00091a40: 2764 6973 7427 5d20 3d20 6469 7374 0a20  'dist'] = dist. 
-00091a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091a60: 2020 2064 6631 203d 2064 665f 742e 696c     df1 = df_t.il
-00091a70: 6f63 5b77 685f 745d 2e63 6f70 7928 6465  oc[wh_t].copy(de
-00091a80: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
-00091a90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00091aa0: 6632 203d 2064 665f 642e 696c 6f63 5b77  f2 = df_d.iloc[w
-00091ab0: 685f 645d 2e63 6f70 7928 6465 6570 203d  h_d].copy(deep =
-00091ac0: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
-00091ad0: 2020 2020 2020 2020 2020 2063 6e74 202b             cnt +
-00091ae0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00091af0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00091b00: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00091b10: 5f74 5b27 6469 7374 275d 203d 2064 6973  _t['dist'] = dis
-00091b20: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00091b30: 2020 2020 2020 6466 3120 3d20 7064 2e63        df1 = pd.c
-00091b40: 6f6e 6361 7428 5b64 6631 2c20 6466 5f74  oncat([df1, df_t
-00091b50: 2e69 6c6f 635b 7768 5f74 5d2e 636f 7079  .iloc[wh_t].copy
-00091b60: 2864 6565 7020 3d20 5472 7565 295d 290a  (deep = True)]).
-00091b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091b80: 2020 2020 6466 3220 3d20 7064 2e63 6f6e      df2 = pd.con
-00091b90: 6361 7428 5b64 6632 2c20 6466 5f64 2e69  cat([df2, df_d.i
-00091ba0: 6c6f 635b 7768 5f64 5d2e 636f 7079 2864  loc[wh_d].copy(d
-00091bb0: 6565 7020 3d20 5472 7565 295d 290a 2020  eep = True)]).  
-00091bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091bd0: 2020 636e 7420 2b3d 2031 0a20 2020 2020    cnt += 1.     
-00091be0: 2020 2020 2020 0a20 2020 2070 7269 6e74        .    print
-00091bf0: 2827 5c72 4d61 7463 6869 6e67 202e 2e20  ('\rMatching .. 
-00091c00: 646f 6e65 2e20 272c 2065 6e64 203d 2027  done. ', end = '
-00091c10: 2729 0a20 2020 2069 6620 636e 7420 3e20  ').    if cnt > 
-00091c20: 303a 0a20 2020 2020 2020 2064 6632 203d  0:.        df2 =
-00091c30: 2064 6632 2e72 656e 616d 6528 2063 6f6c   df2.rename( col
-00091c40: 756d 6e73 203d 207b 2763 6872 273a 2027  umns = {'chr': '
-00091c50: 6368 725f 6427 2c20 2774 7970 6527 3a20  chr_d', 'type': 
-00091c60: 2774 7970 655f 6427 2c20 2770 6f73 5f6f  'type_d', 'pos_o
-00091c70: 7267 273a 2027 706f 735f 6f72 675f 6427  rg': 'pos_org_d'
-00091c80: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00091c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091ca0: 2020 2020 2773 6571 5f6f 7267 273a 2027      'seq_org': '
-00091cb0: 7365 715f 6f72 675f 6427 2c20 2773 6571  seq_org_d', 'seq
-00091cc0: 5f6e 6577 273a 2027 7365 715f 6e65 775f  _new': 'seq_new_
-00091cd0: 6427 7d20 290a 2020 2020 2020 2020 7365  d'} ).        se
-00091ce0: 6c5f 636f 6c5f 7420 3d20 5b27 6368 7227  l_col_t = ['chr'
-00091cf0: 2c20 2774 7970 6527 2c20 2770 6f73 5f6f  , 'type', 'pos_o
-00091d00: 7267 272c 2027 7365 715f 6f72 6727 2c20  rg', 'seq_org', 
-00091d10: 2773 6571 5f6e 6577 272c 2027 6469 7374  'seq_new', 'dist
-00091d20: 275d 0a20 2020 2020 2020 2073 656c 5f63  '].        sel_c
-00091d30: 6f6c 5f64 203d 205b 2769 6427 2c20 2763  ol_d = ['id', 'c
-00091d40: 6872 5f64 272c 2027 7479 7065 5f64 272c  hr_d', 'type_d',
-00091d50: 2027 706f 735f 6f72 675f 6427 2c20 2773   'pos_org_d', 's
-00091d60: 6571 5f6f 7267 5f64 272c 2027 7365 715f  eq_org_d', 'seq_
-00091d70: 6e65 775f 6427 5d0a 2020 2020 2020 2020  new_d'].        
-00091d80: 6466 312e 696e 6465 7820 3d20 7064 2e49  df1.index = pd.I
-00091d90: 6e64 6578 285b 6b20 666f 7220 6b20 696e  ndex([k for k in
-00091da0: 2072 616e 6765 2864 6631 2e73 6861 7065   range(df1.shape
-00091db0: 5b30 5d29 5d29 0a20 2020 2020 2020 2064  [0])]).        d
-00091dc0: 6632 2e69 6e64 6578 203d 2070 642e 496e  f2.index = pd.In
-00091dd0: 6465 7828 5b6b 2066 6f72 206b 2069 6e20  dex([k for k in 
-00091de0: 7261 6e67 6528 6466 322e 7368 6170 655b  range(df2.shape[
-00091df0: 305d 295d 290a 2020 2020 2020 2020 6466  0])]).        df
-00091e00: 203d 2070 642e 636f 6e63 6174 2820 5b64   = pd.concat( [d
-00091e10: 6631 5b73 656c 5f63 6f6c 5f74 5d2c 2064  f1[sel_col_t], d
-00091e20: 6632 5b73 656c 5f63 6f6c 5f64 5d5d 2c20  f2[sel_col_d]], 
-00091e30: 6178 6973 203d 2031 2c20 736f 7274 3d46  axis = 1, sort=F
-00091e40: 616c 7365 2029 2020 2020 2020 2020 0a20  alse )        . 
-00091e50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00091e60: 2020 2020 7365 6e73 203d 2031 3030 2a64      sens = 100*d
-00091e70: 662e 7368 6170 655b 305d 2f4e 5f74 0a20  f.shape[0]/N_t. 
-00091e80: 2020 2020 2020 2070 7265 6320 3d20 3130         prec = 10
-00091e90: 302a 6466 2e73 6861 7065 5b30 5d2f 4e5f  0*df.shape[0]/N_
-00091ea0: 640a 2020 2020 2020 2020 7072 696e 7428  d.        print(
-00091eb0: 2720 4e5f 743a 2025 692c 204e 5f64 3a20  ' N_t: %i, N_d: 
-00091ec0: 2569 202d 3e20 2569 2028 7365 6e73 3a20  %i -> %i (sens: 
-00091ed0: 2534 2e31 662c 2070 7265 633a 2025 342e  %4.1f, prec: %4.
-00091ee0: 3166 2920 2720 2520 5c0a 2020 2020 2020  1f) ' % \.      
-00091ef0: 2020 2020 2020 2020 284e 5f74 2c20 4e5f          (N_t, N_
-00091f00: 642c 2064 662e 7368 6170 655b 305d 2c20  d, df.shape[0], 
-00091f10: 7365 6e73 2c20 7072 6563 2929 0a20 2020  sens, prec)).   
-00091f20: 2020 2020 2072 6574 7572 6e20 6466 2c20       return df, 
-00091f30: 7072 6563 2c20 7365 6e73 2c20 6466 2e73  prec, sens, df.s
-00091f40: 6861 7065 5b30 5d2c 204e 5f64 2c20 4e5f  hape[0], N_d, N_
-00091f50: 740a 2020 2020 656c 7365 3a0a 2020 2020  t.    else:.    
-00091f60: 2020 2020 7072 696e 7428 2720 2729 0a20      print(' '). 
-00091f70: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00091f80: 6e65 2c20 302c 2030 2c20 302c 2030 2c20  ne, 0, 0, 0, 0, 
-00091f90: 300a 2020 2020 2020 2020 2020 2020 0a23  0.            .#
-00091fa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091fc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091fd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091fe0: 2323 2323 2323 2323 230a 2323 2053 656f  #########.## Seo
-00091ff0: 6b68 7975 6e20 596f 6f6e 2028 7379 6f6f  khyun Yoon (syoo
-00092000: 6e40 646b 752e 6564 7529 204f 6374 2e20  n@dku.edu) Oct. 
-00092010: 3034 2c20 3230 3230 0a23 2323 2323 2323  04, 2020.#######
-00092020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00092060: 2323 230a 0a0a 0a0a 2020 2020 2020 2020  ###.....        
-00092070: 0a                                       .
+00091980: 2020 2020 2020 2062 203d 2046 616c 7365         b = False
+00091990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000919a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000919b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000919c0: 2020 2023 2063 6e74 5f74 202b 3d20 310a     # cnt_t += 1.
+000919d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000919e0: 2020 2020 2020 2020 2320 636e 745f 6420          # cnt_d 
+000919f0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00091a00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00091a10: 2863 6e74 5f64 203e 3d20 6e5f 6465 7465  (cnt_d >= n_dete
+00091a20: 6374 6564 2920 7c20 2863 6e74 5f74 203e  cted) | (cnt_t >
+00091a30: 3d20 6e5f 7461 7267 6574 293a 2062 7265  = n_target): bre
+00091a40: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+00091a50: 2020 2020 2020 2020 2020 200a 0a20 2020             ..   
+00091a60: 2020 2020 2020 2020 2062 203d 206d 6174           b = mat
+00091a70: 6368 203e 3d20 300a 2020 2020 2020 2020  ch >= 0.        
+00091a80: 2020 2020 7768 5f74 203d 2077 6869 6368      wh_t = which
+00091a90: 2862 290a 2020 2020 2020 2020 2020 2020  (b).            
+00091aa0: 7768 5f64 203d 206d 6174 6368 5b77 685f  wh_d = match[wh_
+00091ab0: 745d 0a20 2020 2020 2020 2020 2020 200a  t].            .
+00091ac0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00091ad0: 656e 2877 685f 7429 203e 2030 3a0a 2020  en(wh_t) > 0:.  
+00091ae0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00091af0: 2063 6e74 203d 3d20 303a 0a20 2020 2020   cnt == 0:.     
+00091b00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00091b10: 665f 745b 2764 6973 7427 5d20 3d20 6469  f_t['dist'] = di
+00091b20: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
+00091b30: 2020 2020 2020 2064 6631 203d 2064 665f         df1 = df_
+00091b40: 742e 696c 6f63 5b77 685f 745d 2e63 6f70  t.iloc[wh_t].cop
+00091b50: 7928 6465 6570 203d 2054 7275 6529 0a20  y(deep = True). 
+00091b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091b70: 2020 2064 6632 203d 2064 665f 642e 696c     df2 = df_d.il
+00091b80: 6f63 5b77 685f 645d 2e63 6f70 7928 6465  oc[wh_d].copy(de
+00091b90: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
+00091ba0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00091bb0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+00091bc0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00091bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091be0: 2020 6466 5f74 5b27 6469 7374 275d 203d    df_t['dist'] =
+00091bf0: 2064 6973 740a 2020 2020 2020 2020 2020   dist.          
+00091c00: 2020 2020 2020 2020 2020 6466 3120 3d20            df1 = 
+00091c10: 7064 2e63 6f6e 6361 7428 5b64 6631 2c20  pd.concat([df1, 
+00091c20: 6466 5f74 2e69 6c6f 635b 7768 5f74 5d2e  df_t.iloc[wh_t].
+00091c30: 636f 7079 2864 6565 7020 3d20 5472 7565  copy(deep = True
+00091c40: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00091c50: 2020 2020 2020 2020 6466 3220 3d20 7064          df2 = pd
+00091c60: 2e63 6f6e 6361 7428 5b64 6632 2c20 6466  .concat([df2, df
+00091c70: 5f64 2e69 6c6f 635b 7768 5f64 5d2e 636f  _d.iloc[wh_d].co
+00091c80: 7079 2864 6565 7020 3d20 5472 7565 295d  py(deep = True)]
+00091c90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00091ca0: 2020 2020 2020 636e 7420 2b3d 2031 0a20        cnt += 1. 
+00091cb0: 2020 2020 2020 2020 2020 0a20 2020 2070            .    p
+00091cc0: 7269 6e74 2827 5c72 4d61 7463 6869 6e67  rint('\rMatching
+00091cd0: 202e 2e20 646f 6e65 2e20 272c 2065 6e64   .. done. ', end
+00091ce0: 203d 2027 2729 0a20 2020 2069 6620 636e   = '').    if cn
+00091cf0: 7420 3e20 303a 0a20 2020 2020 2020 2064  t > 0:.        d
+00091d00: 6632 203d 2064 6632 2e72 656e 616d 6528  f2 = df2.rename(
+00091d10: 2063 6f6c 756d 6e73 203d 207b 2763 6872   columns = {'chr
+00091d20: 273a 2027 6368 725f 6427 2c20 2774 7970  ': 'chr_d', 'typ
+00091d30: 6527 3a20 2774 7970 655f 6427 2c20 2770  e': 'type_d', 'p
+00091d40: 6f73 5f6f 7267 273a 2027 706f 735f 6f72  os_org': 'pos_or
+00091d50: 675f 6427 2c20 5c0a 2020 2020 2020 2020  g_d', \.        
+00091d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091d70: 2020 2020 2020 2020 2773 6571 5f6f 7267          'seq_org
+00091d80: 273a 2027 7365 715f 6f72 675f 6427 2c20  ': 'seq_org_d', 
+00091d90: 2773 6571 5f6e 6577 273a 2027 7365 715f  'seq_new': 'seq_
+00091da0: 6e65 775f 6427 7d20 290a 2020 2020 2020  new_d'} ).      
+00091db0: 2020 7365 6c5f 636f 6c5f 7420 3d20 5b27    sel_col_t = ['
+00091dc0: 6368 7227 2c20 2774 7970 6527 2c20 2770  chr', 'type', 'p
+00091dd0: 6f73 5f6f 7267 272c 2027 7365 715f 6f72  os_org', 'seq_or
+00091de0: 6727 2c20 2773 6571 5f6e 6577 272c 2027  g', 'seq_new', '
+00091df0: 6469 7374 275d 0a20 2020 2020 2020 2073  dist'].        s
+00091e00: 656c 5f63 6f6c 5f64 203d 205b 2769 6427  el_col_d = ['id'
+00091e10: 2c20 2763 6872 5f64 272c 2027 7479 7065  , 'chr_d', 'type
+00091e20: 5f64 272c 2027 706f 735f 6f72 675f 6427  _d', 'pos_org_d'
+00091e30: 2c20 2773 6571 5f6f 7267 5f64 272c 2027  , 'seq_org_d', '
+00091e40: 7365 715f 6e65 775f 6427 5d0a 2020 2020  seq_new_d'].    
+00091e50: 2020 2020 6466 312e 696e 6465 7820 3d20      df1.index = 
+00091e60: 7064 2e49 6e64 6578 285b 6b20 666f 7220  pd.Index([k for 
+00091e70: 6b20 696e 2072 616e 6765 2864 6631 2e73  k in range(df1.s
+00091e80: 6861 7065 5b30 5d29 5d29 0a20 2020 2020  hape[0])]).     
+00091e90: 2020 2064 6632 2e69 6e64 6578 203d 2070     df2.index = p
+00091ea0: 642e 496e 6465 7828 5b6b 2066 6f72 206b  d.Index([k for k
+00091eb0: 2069 6e20 7261 6e67 6528 6466 322e 7368   in range(df2.sh
+00091ec0: 6170 655b 305d 295d 290a 2020 2020 2020  ape[0])]).      
+00091ed0: 2020 6466 203d 2070 642e 636f 6e63 6174    df = pd.concat
+00091ee0: 2820 5b64 6631 5b73 656c 5f63 6f6c 5f74  ( [df1[sel_col_t
+00091ef0: 5d2c 2064 6632 5b73 656c 5f63 6f6c 5f64  ], df2[sel_col_d
+00091f00: 5d5d 2c20 6178 6973 203d 2031 2c20 736f  ]], axis = 1, so
+00091f10: 7274 3d46 616c 7365 2029 2020 2020 2020  rt=False )      
+00091f20: 2020 0a20 2020 2020 2020 2020 2020 200a    .            .
+00091f30: 2020 2020 2020 2020 7365 6e73 203d 2031          sens = 1
+00091f40: 3030 2a64 662e 7368 6170 655b 305d 2f4e  00*df.shape[0]/N
+00091f50: 5f74 0a20 2020 2020 2020 2070 7265 6320  _t.        prec 
+00091f60: 3d20 3130 302a 6466 2e73 6861 7065 5b30  = 100*df.shape[0
+00091f70: 5d2f 4e5f 640a 2020 2020 2020 2020 7072  ]/N_d.        pr
+00091f80: 696e 7428 2720 4e5f 743a 2025 692c 204e  int(' N_t: %i, N
+00091f90: 5f64 3a20 2569 202d 3e20 2569 2028 7365  _d: %i -> %i (se
+00091fa0: 6e73 3a20 2534 2e31 662c 2070 7265 633a  ns: %4.1f, prec:
+00091fb0: 2025 342e 3166 2920 2720 2520 5c0a 2020   %4.1f) ' % \.  
+00091fc0: 2020 2020 2020 2020 2020 2020 284e 5f74              (N_t
+00091fd0: 2c20 4e5f 642c 2064 662e 7368 6170 655b  , N_d, df.shape[
+00091fe0: 305d 2c20 7365 6e73 2c20 7072 6563 2929  0], sens, prec))
+00091ff0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00092000: 6466 2c20 7072 6563 2c20 7365 6e73 2c20  df, prec, sens, 
+00092010: 6466 2e73 6861 7065 5b30 5d2c 204e 5f64  df.shape[0], N_d
+00092020: 2c20 4e5f 740a 2020 2020 656c 7365 3a0a  , N_t.    else:.
+00092030: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+00092040: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
+00092050: 6e20 4e6f 6e65 2c20 302c 2030 2c20 302c  n None, 0, 0, 0,
+00092060: 2030 2c20 300a 2020 2020 2020 2020 2020   0, 0.          
+00092070: 2020 0a23 2323 2323 2323 2323 2323 2323    .#############
+00092080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000920a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000920b0: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
+000920c0: 2053 656f 6b68 7975 6e20 596f 6f6e 2028   Seokhyun Yoon (
+000920d0: 7379 6f6f 6e40 646b 752e 6564 7529 204f  syoon@dku.edu) O
+000920e0: 6374 2e20 3034 2c20 3230 3230 0a23 2323  ct. 04, 2020.###
+000920f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00092130: 2323 2323 2323 230a 0a0a 0a0a 2020 2020  #######.....    
+00092140: 2020 2020 0a                                 .
```

### Comparing `StringFix-0.6.9/StringFix/pybam.py` & `StringFix-0.7.0/StringFix/pybam.py`

 * *Files identical despite different names*

### Comparing `StringFix-0.6.9/StringFix/run_sfix.py` & `StringFix-0.7.0/StringFix/run_sfix.py`

 * *Files 0% similar despite different names*

```diff
@@ -64,15 +64,15 @@
     args = parser.parse_args()
     return args, parser
 
 
 def main():
 
     print('+------------------------------+')
-    print('|      Stringfix v.0.6.9       |')
+    print('|      Stringfix v.0.7.0       |')
     print('+------------------------------+')
 
     args, parser = get_args()
 
     if (args.input is None): # | (args.gtf is None) | (args.gnm is None):
         parser.print_help()
         return
```

### Comparing `StringFix-0.6.9/StringFix.egg-info/PKG-INFO` & `StringFix-0.7.0/StringFix.egg-info/PKG-INFO`

 * *Files 15% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.6.9
+Version: 0.7.0
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.6.9/setup.py` & `StringFix-0.7.0/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from setuptools import setup, find_packages
 
 setup(
     #    . setup.py     .
     name                = 'StringFix',
     #    .   0.1  0.0.1 .
-    version             = '0.6.9',
+    version             = '0.7.0',
     #     .
     description         = 'Annotation guided transcriptome assembly program.',
     #    .
     author              = 'Joongho Lee, Seokhyun Yoon',
     #    .
     author_email        = 'syoon@dku.edu',
     #   url .  github  .
```

