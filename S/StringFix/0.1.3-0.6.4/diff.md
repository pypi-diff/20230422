# Comparing `tmp/StringFix-0.1.3.tar.gz` & `tmp/StringFix-0.6.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "StringFix-0.1.3.tar", last modified: Thu Apr 20 05:44:45 2023, max compression
+gzip compressed data, was "StringFix-0.6.4.tar", last modified: Sat Apr 22 02:24:13 2023, max compression
```

## Comparing `StringFix-0.1.3.tar` & `StringFix-0.6.4.tar`

### file list

```diff
@@ -1,20 +1,19 @@
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-20 05:44:45.587616 StringFix-0.1.3/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.1.3/LICENSE
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.1.3/MANIFEST.in
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-20 05:44:45.587616 StringFix-0.1.3/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.1.3/README.md
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-20 05:44:45.587616 StringFix-0.1.3/StringFix/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.1.3/StringFix/__init__.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)   597755 2023-04-20 03:05:32.000000 StringFix-0.1.3/StringFix/core.py
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     7380 2023-04-20 03:05:32.000000 StringFix-0.1.3/StringFix/stringfix.py
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-20 05:44:45.587616 StringFix-0.1.3/StringFix.egg-info/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-20 05:44:45.000000 StringFix-0.1.3/StringFix.egg-info/PKG-INFO
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-20 05:44:45.000000 StringFix-0.1.3/StringFix.egg-info/SOURCES.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-20 05:44:45.000000 StringFix-0.1.3/StringFix.egg-info/dependency_links.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-20 05:44:45.000000 StringFix-0.1.3/StringFix.egg-info/not-zip-safe
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-20 05:44:45.000000 StringFix-0.1.3/StringFix.egg-info/requires.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       16 2023-04-20 05:44:45.000000 StringFix-0.1.3/StringFix.egg-info/top_level.txt
--rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-20 05:44:45.587616 StringFix-0.1.3/setup.cfg
--rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-20 05:43:16.000000 StringFix-0.1.3/setup.py
-drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-20 05:44:45.587616 StringFix-0.1.3/tests/
--rw-rw-r--   0 syoon     (1001) syoon     (1001)      100 2023-04-20 03:05:32.000000 StringFix-0.1.3/tests/__init__.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 02:24:13.230015 StringFix-0.6.4/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    35821 2023-04-20 03:05:32.000000 StringFix-0.6.4/LICENSE
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       60 2023-04-20 03:25:54.000000 StringFix-0.6.4/MANIFEST.in
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 02:24:13.230015 StringFix-0.6.4/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      111 2023-04-20 03:25:54.000000 StringFix-0.6.4/README.md
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 02:24:13.230015 StringFix-0.6.4/StringFix/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      163 2023-04-20 05:42:13.000000 StringFix-0.6.4/StringFix/__init__.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)   597843 2023-04-22 02:21:48.000000 StringFix-0.6.4/StringFix/core.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)    53685 2023-04-22 02:22:03.000000 StringFix-0.6.4/StringFix/pybam.py
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     7621 2023-04-22 02:21:35.000000 StringFix-0.6.4/StringFix/run_sfix.py
+drwxrwxr-x   0 syoon     (1001) syoon     (1001)        0 2023-04-22 02:24:13.230015 StringFix-0.6.4/StringFix.egg-info/
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      676 2023-04-22 02:24:13.000000 StringFix-0.6.4/StringFix.egg-info/PKG-INFO
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)      325 2023-04-22 02:24:13.000000 StringFix-0.6.4/StringFix.egg-info/SOURCES.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 02:24:13.000000 StringFix-0.6.4/StringFix.egg-info/dependency_links.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)        1 2023-04-22 02:24:13.000000 StringFix-0.6.4/StringFix.egg-info/not-zip-safe
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       27 2023-04-22 02:24:13.000000 StringFix-0.6.4/StringFix.egg-info/requires.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       10 2023-04-22 02:24:13.000000 StringFix-0.6.4/StringFix.egg-info/top_level.txt
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)       79 2023-04-22 02:24:13.234015 StringFix-0.6.4/setup.cfg
+-rw-rw-r--   0 syoon     (1001) syoon     (1001)     2669 2023-04-22 02:24:07.000000 StringFix-0.6.4/setup.py
```

### Comparing `StringFix-0.1.3/LICENSE` & `StringFix-0.6.4/LICENSE`

 * *Files identical despite different names*

### Comparing `StringFix-0.1.3/PKG-INFO` & `StringFix-0.6.4/PKG-INFO`

 * *Files 15% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.1.3
+Version: 0.6.4
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.1.3/StringFix/core.py` & `StringFix-0.6.4/StringFix/core.py`

 * *Files 0% similar despite different names*

```diff
@@ -30525,6836 +30525,6842 @@
 000773c0: 2c20 6362 7963 203d 2046 616c 7365 2c20  , cbyc = False, 
 000773d0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
 000773e0: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
 000773f0: 203d 2031 2c20 6d69 6e5f 6672 6167 735f   = 1, min_frags_
 00077400: 7065 725f 6765 6e65 203d 2032 2c20 6c65  per_gene = 2, le
 00077410: 6e5f 7468 203d 204d 494e 5f54 525f 4c45  n_th = MIN_TR_LE
 00077420: 4e47 5448 2c20 6f75 745f 7472 203d 2046  NGTH, out_tr = F
-00077430: 616c 7365 2c20 7361 765f 7267 6e20 3d20  alse, sav_rgn = 
-00077440: 4661 6c73 652c 206f 7574 5f64 6972 203d  False, out_dir =
-00077450: 204e 6f6e 6520 293a 0a20 2020 2027 2727   None ):.    '''
-00077460: 0a20 2020 2069 6620 6774 6620 6973 204e  .    if gtf is N
-00077470: 6f6e 653a 0a20 2020 2020 2020 2070 7269  one:.        pri
-00077480: 6e74 2827 4552 524f 523a 204e 6f20 4754  nt('ERROR: No GT
-00077490: 462f 4746 4620 6669 6c65 2070 726f 7669  F/GFF file provi
-000774a0: 6465 642e 2729 0a20 2020 2020 2020 2072  ded.').        r
-000774b0: 6574 7572 6e0a 2020 2020 2327 2727 0a20  eturn.    #'''. 
-000774c0: 2020 200a 2020 2020 6d65 7468 6f64 203d     .    method =
-000774d0: 2027 6c61 7373 6f27 0a20 2020 204e 7265   'lasso'.    Nre
-000774e0: 6320 3d20 300a 2020 2020 5374 6172 7420  c = 0.    Start 
-000774f0: 3d20 300a 2020 2020 0a20 2020 2066 696c  = 0.    .    fil
-00077500: 655f 6e61 6d65 7320 3d20 7361 6d5f 6669  e_names = sam_fi
-00077510: 6c65 2e73 706c 6974 2827 2f27 295b 2d31  le.split('/')[-1
-00077520: 5d0a 2020 2020 666e 7320 3d20 6669 6c65  ].    fns = file
-00077530: 5f6e 616d 6573 2e73 706c 6974 2827 2e27  _names.split('.'
-00077540: 295b 3a2d 315d 0a20 2020 2066 6e61 6d65  )[:-1].    fname
-00077550: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
-00077560: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
-00077570: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
-00077580: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
-00077590: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-000775a0: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
-000775b0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
-000775c0: 2066 6e0a 0a20 2020 2069 6620 6f75 745f   fn..    if out_
-000775d0: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
-000775e0: 0a20 2020 2020 2020 2069 6620 6f75 745f  .        if out_
-000775f0: 6469 725b 2d31 5d20 3d3d 2027 2f27 3a0a  dir[-1] == '/':.
-00077600: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
-00077610: 6520 3d20 6f75 745f 6469 7220 2b20 666e  e = out_dir + fn
-00077620: 616d 650a 2020 2020 2020 2020 656c 7365  ame.        else
-00077630: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
-00077640: 616d 6520 3d20 6f75 745f 6469 7220 2b20  ame = out_dir + 
-00077650: 272f 2720 2b20 666e 616d 650a 0a20 2020  '/' + fname..   
-00077660: 2069 6620 7375 6666 6978 2069 7320 6e6f   if suffix is no
-00077670: 7420 4e6f 6e65 3a20 2020 200a 2020 2020  t None:    .    
-00077680: 2020 2020 666e 616d 6520 3d20 666e 616d      fname = fnam
-00077690: 6520 2b20 275f 2720 2b20 7375 6666 6978  e + '_' + suffix
-000776a0: 0a0a 2020 2020 6966 206a 756d 7020 3e20  ..    if jump > 
-000776b0: 313a 2072 6574 7572 6e20 666e 616d 652c  1: return fname,
-000776c0: 204e 6f6e 652c 204e 6f6e 650a 0a20 2020   None, None..   
-000776d0: 204e 554d 5f43 4f52 4553 203d 206e 5f63   NUM_CORES = n_c
-000776e0: 6f72 6573 0a20 2020 2073 7461 7274 5f74  ores.    start_t
-000776f0: 696d 6531 203d 2074 696d 652e 7469 6d65  ime1 = time.time
-00077700: 2829 0a20 2020 2073 7461 7274 5f74 696d  ().    start_tim
-00077710: 6532 203d 2074 696d 652e 7469 6d65 2829  e2 = time.time()
-00077720: 0a20 2020 2069 6620 6a75 6d70 2532 203d  .    if jump%2 =
-00077730: 3d20 303a 0a0a 2020 2020 2020 2020 4754  = 0:..        GT
-00077740: 465f 6c73 7420 3d20 5b5d 0a20 2020 2020  F_lst = [].     
-00077750: 2020 2072 676e 735f 6c73 745f 6d69 203d     rgns_lst_mi =
-00077760: 205b 5d0a 2020 2020 2020 2020 7267 6e73   [].        rgns
-00077770: 5f6c 7374 5f6e 6420 3d20 5b5d 0a20 2020  _lst_nd = [].   
-00077780: 2020 2020 2072 676e 735f 6c73 745f 7374       rgns_lst_st
-00077790: 203d 205b 5d0a 0a20 2020 2020 2020 2063   = []..        c
-000777a0: 6e74 203d 2030 0a20 2020 2020 2020 206d  nt = 0.        m
-000777b0: 785f 6c65 6e20 3d20 3132 0a20 2020 2020  x_len = 12.     
-000777c0: 2020 2065 725f 636f 6465 203d 2030 0a20     er_code = 0. 
-000777d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000777e0: 7072 696e 7428 2753 7472 696e 6746 6978  print('StringFix
-000777f0: 2073 7461 7274 6564 2027 2c20 6461 7465   started ', date
-00077800: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
-00077810: 7728 2929 0a20 2020 2020 2020 2073 6f20  w()).        so 
-00077820: 3d20 7361 6d5f 6f62 6a28 7361 6d5f 6669  = sam_obj(sam_fi
-00077830: 6c65 2c20 7361 203d 2073 6129 0a20 2020  le, sa = sa).   
-00077840: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-00077850: 206e 5f63 6f72 6573 203d 3d20 313a 206e   n_cores == 1: n
-00077860: 756d 5f70 6172 616c 6c65 6c5f 6368 756e  um_parallel_chun
-00077870: 6b73 203d 2034 0a20 2020 2020 2020 2065  ks = 4.        e
-00077880: 6c73 653a 206e 756d 5f70 6172 616c 6c65  lse: num_paralle
-00077890: 6c5f 6368 756e 6b73 203d 204e 554d 5f50  l_chunks = NUM_P
-000778a0: 4152 414c 4c45 4c5f 4348 554e 4b53 0a20  ARALLEL_CHUNKS. 
-000778b0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000778c0: 625f 636e 7420 3d20 300a 2020 2020 2020  b_cnt = 0.      
-000778d0: 2020 725f 6c73 745f 6f66 5f6c 7374 203d    r_lst_of_lst =
-000778e0: 205b 5d0a 2020 2020 2020 2020 0a20 2020   [].        .   
-000778f0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00077900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00077430: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00077440: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00077450: 5f72 676e 203d 2046 616c 7365 2c20 6f75  _rgn = False, ou
+00077460: 745f 6469 7220 3d20 4e6f 6e65 2029 3a0a  t_dir = None ):.
+00077470: 2020 2020 2727 270a 2020 2020 6966 2067      '''.    if g
+00077480: 7466 2069 7320 4e6f 6e65 3a0a 2020 2020  tf is None:.    
+00077490: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
+000774a0: 3a20 4e6f 2047 5446 2f47 4646 2066 696c  : No GTF/GFF fil
+000774b0: 6520 7072 6f76 6964 6564 2e27 290a 2020  e provided.').  
+000774c0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+000774d0: 2023 2727 270a 2020 2020 0a20 2020 206d   #'''.    .    m
+000774e0: 6574 686f 6420 3d20 276c 6173 736f 270a  ethod = 'lasso'.
+000774f0: 2020 2020 4e72 6563 203d 2030 0a20 2020      Nrec = 0.   
+00077500: 2053 7461 7274 203d 2030 0a20 2020 200a   Start = 0.    .
+00077510: 2020 2020 6669 6c65 5f6e 616d 6573 203d      file_names =
+00077520: 2073 616d 5f66 696c 652e 7370 6c69 7428   sam_file.split(
+00077530: 272f 2729 5b2d 315d 0a20 2020 2066 6e73  '/')[-1].    fns
+00077540: 203d 2066 696c 655f 6e61 6d65 732e 7370   = file_names.sp
+00077550: 6c69 7428 272e 2729 5b3a 2d31 5d0a 2020  lit('.')[:-1].  
+00077560: 2020 666e 616d 6520 3d20 2727 0a20 2020    fname = ''.   
+00077570: 2066 6f72 206b 2c20 666e 2069 6e20 656e   for k, fn in en
+00077580: 756d 6572 6174 6528 666e 7329 3a0a 2020  umerate(fns):.  
+00077590: 2020 2020 2020 6966 206b 203e 2030 3a0a        if k > 0:.
+000775a0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+000775b0: 6520 3d20 666e 616d 6520 2b20 272e 270a  e = fname + '.'.
+000775c0: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
+000775d0: 666e 616d 6520 2b20 666e 0a0a 2020 2020  fname + fn..    
+000775e0: 6966 206f 7574 5f64 6972 2069 7320 6e6f  if out_dir is no
+000775f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00077600: 6966 206f 7574 5f64 6972 5b2d 315d 203d  if out_dir[-1] =
+00077610: 3d20 272f 273a 0a20 2020 2020 2020 2020  = '/':.         
+00077620: 2020 2066 6e61 6d65 203d 206f 7574 5f64     fname = out_d
+00077630: 6972 202b 2066 6e61 6d65 0a20 2020 2020  ir + fname.     
+00077640: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00077650: 2020 2020 2066 6e61 6d65 203d 206f 7574       fname = out
+00077660: 5f64 6972 202b 2027 2f27 202b 2066 6e61  _dir + '/' + fna
+00077670: 6d65 0a0a 2020 2020 6966 2073 7566 6669  me..    if suffi
+00077680: 7820 6973 206e 6f74 204e 6f6e 653a 2020  x is not None:  
+00077690: 2020 0a20 2020 2020 2020 2066 6e61 6d65    .        fname
+000776a0: 203d 2066 6e61 6d65 202b 2027 5f27 202b   = fname + '_' +
+000776b0: 2073 7566 6669 780a 0a20 2020 2069 6620   suffix..    if 
+000776c0: 6a75 6d70 203e 2031 3a20 7265 7475 726e  jump > 1: return
+000776d0: 2066 6e61 6d65 2c20 4e6f 6e65 2c20 4e6f   fname, None, No
+000776e0: 6e65 0a0a 2020 2020 4e55 4d5f 434f 5245  ne..    NUM_CORE
+000776f0: 5320 3d20 6e5f 636f 7265 730a 2020 2020  S = n_cores.    
+00077700: 7374 6172 745f 7469 6d65 3120 3d20 7469  start_time1 = ti
+00077710: 6d65 2e74 696d 6528 290a 2020 2020 7374  me.time().    st
+00077720: 6172 745f 7469 6d65 3220 3d20 7469 6d65  art_time2 = time
+00077730: 2e74 696d 6528 290a 2020 2020 6966 206a  .time().    if j
+00077740: 756d 7025 3220 3d3d 2030 3a0a 0a20 2020  ump%2 == 0:..   
+00077750: 2020 2020 2047 5446 5f6c 7374 203d 205b       GTF_lst = [
+00077760: 5d0a 2020 2020 2020 2020 7267 6e73 5f6c  ].        rgns_l
+00077770: 7374 5f6d 6920 3d20 5b5d 0a20 2020 2020  st_mi = [].     
+00077780: 2020 2072 676e 735f 6c73 745f 6e64 203d     rgns_lst_nd =
+00077790: 205b 5d0a 2020 2020 2020 2020 7267 6e73   [].        rgns
+000777a0: 5f6c 7374 5f73 7420 3d20 5b5d 0a0a 2020  _lst_st = []..  
+000777b0: 2020 2020 2020 636e 7420 3d20 300a 2020        cnt = 0.  
+000777c0: 2020 2020 2020 6d78 5f6c 656e 203d 2031        mx_len = 1
+000777d0: 320a 2020 2020 2020 2020 6572 5f63 6f64  2.        er_cod
+000777e0: 6520 3d20 300a 2020 2020 2020 2020 0a20  e = 0.        . 
+000777f0: 2020 2020 2020 2070 7269 6e74 2827 5374         print('St
+00077800: 7269 6e67 4669 7820 7374 6172 7465 6420  ringFix started 
+00077810: 272c 2064 6174 6574 696d 652e 6461 7465  ', datetime.date
+00077820: 7469 6d65 2e6e 6f77 2829 290a 2020 2020  time.now()).    
+00077830: 2020 2020 736f 203d 2073 616d 5f6f 626a      so = sam_obj
+00077840: 2873 616d 5f66 696c 652c 2073 6120 3d20  (sam_file, sa = 
+00077850: 7361 290a 2020 2020 2020 2020 0a20 2020  sa).        .   
+00077860: 2020 2020 2069 6620 6e5f 636f 7265 7320       if n_cores 
+00077870: 3d3d 2031 3a20 6e75 6d5f 7061 7261 6c6c  == 1: num_parall
+00077880: 656c 5f63 6875 6e6b 7320 3d20 340a 2020  el_chunks = 4.  
+00077890: 2020 2020 2020 656c 7365 3a20 6e75 6d5f        else: num_
+000778a0: 7061 7261 6c6c 656c 5f63 6875 6e6b 7320  parallel_chunks 
+000778b0: 3d20 4e55 4d5f 5041 5241 4c4c 454c 5f43  = NUM_PARALLEL_C
+000778c0: 4855 4e4b 530a 2020 2020 2020 2020 0a20  HUNKS.        . 
+000778d0: 2020 2020 2020 2062 5f63 6e74 203d 2030         b_cnt = 0
+000778e0: 0a20 2020 2020 2020 2072 5f6c 7374 5f6f  .        r_lst_o
+000778f0: 665f 6c73 7420 3d20 5b5d 0a20 2020 2020  f_lst = [].     
+00077900: 2020 200a 2020 2020 2020 2020 2323 2323     .        ####
 00077910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00077920: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00077930: 2020 2020 2020 0a20 2020 2020 2020 206d        .        m
-00077940: 6564 5f66 7261 675f 6c65 6e20 3d20 300a  ed_frag_len = 0.
-00077950: 2020 2020 2020 2020 6966 2063 6279 633a          if cbyc:
-00077960: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00077970: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00077980: 275c 7242 7569 6c64 696e 6720 6c6f 6369  '\rBuilding loci
-00077990: 2026 2043 4d61 7420 2729 2023 202c 2065   & CMat ') # , e
-000779a0: 6e64 3d27 2729 0a20 2020 2020 2020 2020  nd='').         
-000779b0: 2020 2063 6e74 5f63 203d 2030 0a20 2020     cnt_c = 0.   
-000779c0: 2020 2020 2020 2020 2077 6869 6c65 2054           while T
-000779d0: 7275 653a 0a0a 2020 2020 2020 2020 2020  rue:..          
-000779e0: 2020 2020 2020 7374 6172 745f 7469 6d65        start_time
-000779f0: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
-00077a00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00077a10: 725f 636f 6465 2c20 7361 6d5f 6c73 742c  r_code, sam_lst,
-00077a20: 206e 756d 5f72 6561 6473 203d 2073 6f2e   num_reads = so.
-00077a30: 6765 745f 6f6e 655f 6f76 6572 6c61 7065  get_one_overlape
-00077a40: 645f 7361 6d28 290a 0a20 2020 2020 2020  d_sam()..       
-00077a50: 2020 2020 2020 2020 2069 6620 6572 5f63           if er_c
-00077a60: 6f64 6520 3d3d 204e 4f54 5f53 4f52 5445  ode == NOT_SORTE
-00077a70: 443a 0a20 2020 2020 2020 2020 2020 2020  D:.             
-00077a80: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00077a90: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00077aa0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00077ab0: 2020 2020 2020 2069 6620 625f 636e 7420         if b_cnt 
-00077ac0: 3d3d 2030 3a20 725f 6c73 745f 6f66 5f6c  == 0: r_lst_of_l
-00077ad0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-00077ae0: 2020 2020 2020 2020 2020 2020 625f 636e              b_cn
-00077af0: 7420 2b3d 206c 656e 2873 616d 5f6c 7374  t += len(sam_lst
-00077b00: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00077b10: 2020 2020 2020 2073 616d 5f6c 7374 2e61         sam_lst.a
-00077b20: 7070 656e 6428 7361 290a 2020 2020 2020  ppend(sa).      
-00077b30: 2020 2020 2020 2020 2020 2020 2020 725f                r_
-00077b40: 6c73 745f 6f66 5f6c 7374 2e61 7070 656e  lst_of_lst.appen
-00077b50: 6428 2073 616d 5f6c 7374 2029 2023 2028  d( sam_lst ) # (
-00077b60: 7361 6d5f 6c73 742c 2073 6129 2029 0a20  sam_lst, sa) ). 
-00077b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077b80: 2020 2023 2072 5f6c 7374 5f6f 665f 6c73     # r_lst_of_ls
-00077b90: 742e 6170 7065 6e64 2820 2873 616d 5f6c  t.append( (sam_l
-00077ba0: 7374 2c20 7361 2920 290a 0a20 2020 2020  st, sa) )..     
-00077bb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00077bc0: 6620 6e5f 636f 7265 7320 3d3d 2031 3a20  f n_cores == 1: 
-00077bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077be0: 2020 2020 2020 2020 2069 6620 2862 5f63           if (b_c
-00077bf0: 6e74 203d 3d20 6e75 6d5f 7061 7261 6c6c  nt == num_parall
-00077c00: 656c 5f63 6875 6e6b 7329 207c 2028 6572  el_chunks) | (er
-00077c10: 5f63 6f64 6520 3d3d 204e 4f5f 4d4f 5245  _code == NO_MORE
-00077c20: 5f4c 494e 4529 3a20 625f 636e 7420 3d20  _LINE): b_cnt = 
-00077c30: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00077c40: 2020 2020 2020 656c 7365 3a20 0a20 2020        else: .   
-00077c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077c60: 2020 2020 2023 2069 6620 2865 725f 636f       # if (er_co
-00077c70: 6465 203d 3d20 4e45 575f 4348 524d 2920  de == NEW_CHRM) 
-00077c80: 7c20 2865 725f 636f 6465 203d 3d20 4e4f  | (er_code == NO
-00077c90: 5f4d 4f52 455f 4c49 4e45 293a 2062 5f63  _MORE_LINE): b_c
-00077ca0: 6e74 203d 2030 0a20 2020 2020 2020 2020  nt = 0.         
-00077cb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00077cc0: 6620 2828 625f 636e 7420 3e20 6e75 6d5f  f ((b_cnt > num_
-00077cd0: 7061 7261 6c6c 656c 5f63 6875 6e6b 7329  parallel_chunks)
-00077ce0: 2026 2028 6572 5f63 6f64 6520 3d3d 204e   & (er_code == N
-00077cf0: 4557 5f43 4852 4d29 2920 7c20 2865 725f  EW_CHRM)) | (er_
-00077d00: 636f 6465 203d 3d20 4e4f 5f4d 4f52 455f  code == NO_MORE_
-00077d10: 4c49 4e45 293a 2062 5f63 6e74 203d 2030  LINE): b_cnt = 0
-00077d20: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00077d30: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
-00077d40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00077d50: 6620 625f 636e 7420 3d3d 2030 3a0a 0a20  f b_cnt == 0:.. 
-00077d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077d70: 2020 2020 2020 2074 6c65 6e20 3d20 5b5d         tlen = []
-00077d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077d90: 2020 2020 2020 2020 2066 6f72 2072 5f6c           for r_l
-00077da0: 7374 2069 6e20 725f 6c73 745f 6f66 5f6c  st in r_lst_of_l
-00077db0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00077dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077dd0: 666f 7220 736c 2069 6e20 725f 6c73 745b  for sl in r_lst[
-00077de0: 3a2d 315d 3a0a 2020 2020 2020 2020 2020  :-1]:.          
-00077df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077e00: 2020 2020 2020 746c 656e 2e61 7070 656e        tlen.appen
-00077e10: 6428 736c 2e74 6c65 6e29 0a20 2020 2020  d(sl.tlen).     
-00077e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077e30: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00077e40: 6e28 746c 656e 2920 3e20 3130 3030 3030  n(tlen) > 100000
-00077e50: 3a20 6272 6561 6b0a 2020 2020 2020 2020  : break.        
-00077e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077e70: 6d66 6c20 3d20 6e70 2e6d 6564 6961 6e28  mfl = np.median(
-00077e80: 746c 656e 290a 2020 2020 2020 2020 2020  tlen).          
-00077e90: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00077ea0: 645f 6672 6167 5f6c 656e 202b 3d20 6d66  d_frag_len += mf
-00077eb0: 6c20 0a0a 2020 2020 2020 2020 2020 2020  l ..            
-00077ec0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00077ed0: 5f63 6f72 6573 203d 3d20 313a 0a20 2020  _cores == 1:.   
-00077ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077ef0: 2020 2020 2020 2020 2023 2063 6872 5f6e           # chr_n
-00077f00: 616d 6520 3d20 7361 6d5f 6c73 745b 305d  ame = sam_lst[0]
-00077f10: 2e72 6e61 6d65 0a20 2020 2020 2020 2020  .rname.         
-00077f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f30: 2020 2063 6872 5f6c 7374 203d 205b 5d0a     chr_lst = [].
-00077f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f50: 2020 2020 2020 2020 2020 2020 6368 725f              chr_
-00077f60: 6e61 6d65 203d 2027 270a 2020 2020 2020  name = ''.      
-00077f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077f80: 2020 2020 2020 666f 7220 725f 6c73 7420        for r_lst 
-00077f90: 696e 2072 5f6c 7374 5f6f 665f 6c73 743a  in r_lst_of_lst:
-00077fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00077fc0: 2069 6620 725f 6c73 745b 305d 2e72 6e61   if r_lst[0].rna
-00077fd0: 6d65 206e 6f74 2069 6e20 6368 725f 6c73  me not in chr_ls
-00077fe0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00077ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078000: 2020 2020 2020 2063 6872 5f6c 7374 2e61         chr_lst.a
-00078010: 7070 656e 6428 725f 6c73 745b 305d 2e72  ppend(r_lst[0].r
-00078020: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00078030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078040: 2020 2020 2020 2020 2020 6368 725f 6e61            chr_na
-00078050: 6d65 203d 2063 6872 5f6e 616d 6520 2b20  me = chr_name + 
-00078060: 2725 7320 2720 2520 2872 5f6c 7374 5b30  '%s ' % (r_lst[0
-00078070: 5d2e 726e 616d 6529 0a20 2020 2020 2020  ].rname).       
-00078080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078090: 2020 2020 2069 6620 6c65 6e28 6368 725f       if len(chr_
-000780a0: 6e61 6d65 2920 3e20 3530 3a20 0a20 2020  name) > 50: .   
-000780b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000780c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000780d0: 2863 6e74 5f63 203d 3d20 3029 2026 2028  (cnt_c == 0) & (
-000780e0: 6572 5f63 6f64 6520 3d3d 204e 4f5f 4d4f  er_code == NO_MO
-000780f0: 5245 5f4c 494e 4529 3a20 6368 725f 6e61  RE_LINE): chr_na
-00078100: 6d65 203d 2027 2027 0a20 2020 2020 2020  me = ' '.       
-00078110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078120: 2020 2020 2020 2020 2065 6c73 653a 2063           else: c
-00078130: 6872 5f6e 616d 6520 3d20 276f 7468 6572  hr_name = 'other
-00078140: 7327 0a20 2020 2020 2020 2020 2020 2020  s'.             
-00078150: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00078160: 5f6d 695f 6c73 742c 2072 5f6e 645f 6c73  _mi_lst, r_nd_ls
-00078170: 742c 2072 5f73 745f 6c73 7420 3d20 6275  t, r_st_lst = bu
-00078180: 696c 645f 636f 6e74 6967 7328 725f 6c73  ild_contigs(r_ls
-00078190: 745f 6f66 5f6c 7374 2c20 6368 725f 6e61  t_of_lst, chr_na
-000781a0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-000781b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000781c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000781d0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-000781e0: 725f 6e61 6d65 203d 2027 270a 2020 2020  r_name = ''.    
-000781f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078200: 2020 2020 2020 2020 2320 6966 2028 636e          # if (cn
-00078210: 745f 6320 3e20 3029 207c 2028 6572 5f63  t_c > 0) | (er_c
-00078220: 6f64 6520 213d 204e 4f5f 4d4f 5245 5f4c  ode != NO_MORE_L
-00078230: 494e 4529 3a0a 2020 2020 2020 2020 2020  INE):.          
-00078240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078250: 2020 6368 725f 6c73 7420 3d20 5b5d 0a20    chr_lst = []. 
-00078260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078270: 2020 2020 2020 2020 2020 2063 6872 5f6e             chr_n
-00078280: 616d 6520 3d20 2727 0a20 2020 2020 2020  ame = ''.       
-00078290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000782a0: 2020 2020 2066 6f72 2072 5f6c 7374 2069       for r_lst i
-000782b0: 6e20 725f 6c73 745f 6f66 5f6c 7374 3a0a  n r_lst_of_lst:.
-000782c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000782d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000782e0: 6966 2072 5f6c 7374 5b30 5d2e 726e 616d  if r_lst[0].rnam
-000782f0: 6520 6e6f 7420 696e 2063 6872 5f6c 7374  e not in chr_lst
-00078300: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00078310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078320: 2020 2020 2020 6368 725f 6c73 742e 6170        chr_lst.ap
-00078330: 7065 6e64 2872 5f6c 7374 5b30 5d2e 726e  pend(r_lst[0].rn
-00078340: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00078350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078360: 2020 2020 2020 2020 2063 6872 5f6e 616d           chr_nam
-00078370: 6520 3d20 6368 725f 6e61 6d65 202b 2027  e = chr_name + '
-00078380: 2573 2027 2025 2028 725f 6c73 745b 305d  %s ' % (r_lst[0]
-00078390: 2e72 6e61 6d65 290a 2020 2020 2020 2020  .rname).        
-000783a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000783b0: 2020 2020 6966 206c 656e 2863 6872 5f6e      if len(chr_n
-000783c0: 616d 6529 203e 2035 303a 200a 2020 2020  ame) > 50: .    
-000783d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000783e0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000783f0: 636e 745f 6320 3d3d 2030 2920 2620 2865  cnt_c == 0) & (e
-00078400: 725f 636f 6465 203d 3d20 4e4f 5f4d 4f52  r_code == NO_MOR
-00078410: 455f 4c49 4e45 293a 2063 6872 5f6e 616d  E_LINE): chr_nam
-00078420: 6520 3d20 2720 270a 2020 2020 2020 2020  e = ' '.        
-00078430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078440: 2020 2020 2020 2020 656c 7365 3a20 6368          else: ch
-00078450: 725f 6e61 6d65 203d 2027 6f74 6865 7273  r_name = 'others
-00078460: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00078470: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00078480: 6966 2063 6e74 5f63 203d 3d20 303a 2070  if cnt_c == 0: p
-00078490: 7269 6e74 2827 2027 290a 0a20 2020 2020  rint(' ')..     
-000784a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000784b0: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
-000784c0: 6533 203d 2074 696d 652e 7469 6d65 2829  e3 = time.time()
-000784d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000784e0: 2020 2020 2020 2020 2020 2020 2072 5f6d               r_m
-000784f0: 695f 6c73 742c 2072 5f6e 645f 6c73 742c  i_lst, r_nd_lst,
-00078500: 2072 5f73 745f 6c73 7420 3d20 6275 696c   r_st_lst = buil
-00078510: 645f 636f 6e74 6967 735f 6d63 2872 5f6c  d_contigs_mc(r_l
-00078520: 7374 5f6f 665f 6c73 742c 206e 5f63 6f72  st_of_lst, n_cor
-00078530: 6573 2c20 6368 725f 6e61 6d65 290a 0a20  es, chr_name).. 
-00078540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078550: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00078560: 2863 6e74 5f63 203e 2030 2920 7c20 2865  (cnt_c > 0) | (e
-00078570: 725f 636f 6465 2021 3d20 4e4f 5f4d 4f52  r_code != NO_MOR
-00078580: 455f 4c49 4e45 293a 0a20 2020 2020 2020  E_LINE):.       
-00078590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000785a0: 2020 2020 2065 6c61 7073 6564 5f74 696d       elapsed_tim
-000785b0: 6533 203d 2074 696d 652e 7469 6d65 2829  e3 = time.time()
-000785c0: 202d 2073 7461 7274 5f74 696d 6533 0a20   - start_time3. 
-000785d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000785e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000785f0: 2827 5c72 2720 2b20 2720 272a 3130 302c  ('\r' + ' '*100,
-00078600: 2065 6e64 3d27 272c 2066 6c75 7368 203d   end='', flush =
-00078610: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
-00078620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078630: 2020 2070 7269 6e74 2827 5c72 2020 2070     print('\r   p
-00078640: 726f 6365 7373 696e 6720 2573 2e2e 2e20  rocessing %s... 
-00078650: 646f 6e65 2e20 2825 6929 2028 2569 722c  done. (%i) (%ir,
-00078660: 2025 6963 2c20 2569 2927 205c 0a20 2020   %ic, %i)' \.   
-00078670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078680: 2020 2020 2020 2020 2020 2020 2020 2025                 %
-00078690: 2028 6368 725f 6e61 6d65 2c20 656c 6170   (chr_name, elap
-000786a0: 7365 645f 7469 6d65 332c 2069 6e74 2873  sed_time3, int(s
-000786b0: 6f2e 6e75 6d5f 7265 6164 7329 2c20 6c65  o.num_reads), le
-000786c0: 6e28 725f 6c73 745f 6f66 5f6c 7374 292c  n(r_lst_of_lst),
-000786d0: 206d 666c 292c 2066 6c75 7368 203d 2054   mfl), flush = T
-000786e0: 7275 6529 2023 2c20 656e 643d 2727 290a  rue) #, end='').
-000786f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00078700: 2020 2020 2020 2020 2072 676e 735f 6c73           rgns_ls
-00078710: 745f 6d69 203d 2072 676e 735f 6c73 745f  t_mi = rgns_lst_
-00078720: 6d69 202b 2072 5f6d 695f 6c73 740a 2020  mi + r_mi_lst.  
-00078730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078740: 2020 2020 2020 7267 6e73 5f6c 7374 5f6e        rgns_lst_n
-00078750: 6420 3d20 7267 6e73 5f6c 7374 5f6e 6420  d = rgns_lst_nd 
-00078760: 2b20 725f 6e64 5f6c 7374 0a20 2020 2020  + r_nd_lst.     
-00078770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078780: 2020 2072 676e 735f 6c73 745f 7374 203d     rgns_lst_st =
-00078790: 2072 676e 735f 6c73 745f 7374 202b 2072   rgns_lst_st + r
-000787a0: 5f73 745f 6c73 740a 2020 2020 2020 2020  _st_lst.        
-000787b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000787c0: 2020 2020 2020 2020 2069 6620 6572 5f63           if er_c
-000787d0: 6f64 6520 3d3d 204e 4f5f 4d4f 5245 5f4c  ode == NO_MORE_L
-000787e0: 494e 453a 2062 7265 616b 0a20 2020 2020  INE: break.     
-000787f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078800: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00078810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078820: 2020 2020 2063 6e74 5f63 202b 3d20 310a       cnt_c += 1.
-00078830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078840: 2020 2020 2327 2727 0a0a 2020 2020 2020      #'''..      
-00078850: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-00078860: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-00078870: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00078880: 636e 745f 6320 3e20 303a 0a20 2020 2020  cnt_c > 0:.     
-00078890: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000788a0: 6620 636e 7425 3130 3020 3d3d 2030 3a0a  f cnt%100 == 0:.
-000788b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000788c0: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-000788d0: 7227 202b 2027 2027 2a31 3030 2c20 656e  r' + ' '*100, en
-000788e0: 643d 2727 2c20 666c 7573 6820 3d20 5472  d='', flush = Tr
-000788f0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00078900: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00078910: 7428 275c 7220 2020 6c6f 6164 696e 6720  t('\r   loading 
-00078920: 2825 6972 2c20 2569 632c 2025 7329 2027  (%ir, %ic, %s) '
-00078930: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00078940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078950: 2025 2028 696e 7428 736f 2e6e 756d 5f72   % (int(so.num_r
-00078960: 6561 6473 292c 2063 6e74 2c20 7361 6d5f  eads), cnt, sam_
-00078970: 6c73 745b 305d 2e72 6e61 6d65 292c 2065  lst[0].rname), e
-00078980: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
-00078990: 7275 6529 0a0a 2020 2020 2020 2020 2020  rue)..          
-000789a0: 2020 2020 2020 2020 2020 6966 2065 725f            if er_
-000789b0: 636f 6465 203d 3d20 4e4f 5f4d 4f52 455f  code == NO_MORE_
-000789c0: 4c49 4e45 3a20 6272 6561 6b0a 0a20 2020  LINE: break..   
-000789d0: 2020 2020 2020 2020 206d 6564 5f66 7261           med_fra
-000789e0: 675f 6c65 6e20 3d20 6e70 2e69 6e74 286d  g_len = np.int(m
-000789f0: 6564 5f66 7261 675f 6c65 6e2f 2863 6e74  ed_frag_len/(cnt
-00078a00: 5f63 2b31 2929 0a0a 2020 2020 2020 2020  _c+1))..        
-00078a10: 2020 2020 656c 6170 7365 645f 7469 6d65      elapsed_time
-00078a20: 3120 3d20 7469 6d65 2e74 696d 6528 2920  1 = time.time() 
-00078a30: 2d20 7374 6172 745f 7469 6d65 320a 2020  - start_time2.  
-00078a40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00078a50: 275c 7242 7569 6c64 696e 6720 6c6f 6369  '\rBuilding loci
-00078a60: 2026 2043 4d61 7420 2e2e 2e20 646f 6e65   & CMat ... done
-00078a70: 2028 2569 292e 2028 2569 722c 2025 6963   (%i). (%ir, %ic
-00078a80: 2c20 2569 2920 2720 5c0a 2020 2020 2020  , %i) ' \.      
-00078a90: 2020 2020 2020 2020 2020 2020 2520 2869              % (i
-00078aa0: 6e74 2865 6c61 7073 6564 5f74 696d 6531  nt(elapsed_time1
-00078ab0: 292c 2069 6e74 2873 6f2e 6e75 6d5f 7265  ), int(so.num_re
-00078ac0: 6164 7329 2c20 636e 742c 206d 6564 5f66  ads), cnt, med_f
-00078ad0: 7261 675f 6c65 6e29 2029 0a0a 2020 2020  rag_len) )..    
-00078ae0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00078af0: 2020 0a20 2020 2020 2020 2020 2020 2070    .            p
-00078b00: 7269 6e74 2827 5c72 4c6f 6164 696e 6720  rint('\rLoading 
-00078b10: 5341 4d20 6c69 6e65 7320 2e2e 2e2e 2e2e  SAM lines ......
-00078b20: 2020 272c 2065 6e64 3d27 2729 2020 2020    ', end='')    
-00078b30: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00078b40: 2077 6869 6c65 2054 7275 653a 0a0a 2020   while True:..  
-00078b50: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00078b60: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
-00078b70: 7469 6d65 2829 0a20 2020 2020 2020 2020  time().         
-00078b80: 2020 2020 2020 2065 725f 636f 6465 2c20         er_code, 
-00078b90: 7361 6d5f 6c73 742c 206e 756d 5f72 6561  sam_lst, num_rea
-00078ba0: 6473 203d 2073 6f2e 6765 745f 6f6e 655f  ds = so.get_one_
-00078bb0: 6f76 6572 6c61 7065 645f 7361 6d28 290a  overlaped_sam().
-00078bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00078bd0: 2069 6620 6572 5f63 6f64 6520 3d3d 204e   if er_code == N
-00078be0: 4f54 5f53 4f52 5445 443a 0a20 2020 2020  OT_SORTED:.     
-00078bf0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00078c00: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-00078c10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00078c20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00078c30: 616d 5f6c 7374 2e61 7070 656e 6428 7361  am_lst.append(sa
-00078c40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00078c50: 2020 2020 2020 725f 6c73 745f 6f66 5f6c        r_lst_of_l
-00078c60: 7374 2e61 7070 656e 6428 2073 616d 5f6c  st.append( sam_l
-00078c70: 7374 2029 2023 2028 7361 6d5f 6c73 742c  st ) # (sam_lst,
-00078c80: 2073 6129 2029 0a20 2020 2020 2020 2020   sa) ).         
-00078c90: 2020 2020 2020 2020 2020 2023 2072 5f6c             # r_l
-00078ca0: 7374 5f6f 665f 6c73 742e 6170 7065 6e64  st_of_lst.append
-00078cb0: 2820 2873 616d 5f6c 7374 2c20 7361 2920  ( (sam_lst, sa) 
-00078cc0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00078cd0: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
-00078ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078cf0: 2020 2020 6966 2063 6e74 2531 3030 203d      if cnt%100 =
-00078d00: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00078d10: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00078d20: 6e74 2827 5c72 2720 2b20 2720 272a 3130  nt('\r' + ' '*10
-00078d30: 302c 2065 6e64 3d27 272c 2066 6c75 7368  0, end='', flush
-00078d40: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
-00078d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078d60: 2070 7269 6e74 2827 5c72 4c6f 6164 696e   print('\rLoadin
-00078d70: 6720 5341 4d20 6c69 6e65 7320 2e2e 2e2e  g SAM lines ....
-00078d80: 2e2e 2028 2569 722c 2025 6963 2920 2720  .. (%ir, %ic) ' 
-00078d90: 2520 2869 6e74 2873 6f2e 6e75 6d5f 7265  % (int(so.num_re
-00078da0: 6164 7329 2c20 636e 7429 2c20 656e 643d  ads), cnt), end=
-00078db0: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
-00078dc0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00078dd0: 2020 2020 2020 2069 6620 6572 5f63 6f64         if er_cod
-00078de0: 6520 3d3d 204e 4f5f 4d4f 5245 5f4c 494e  e == NO_MORE_LIN
-00078df0: 453a 2062 7265 616b 0a0a 2020 2020 2020  E: break..      
-00078e00: 2020 2020 2020 746c 656e 203d 205b 5d0a        tlen = [].
-00078e10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00078e20: 725f 6c73 7420 696e 2072 5f6c 7374 5f6f  r_lst in r_lst_o
-00078e30: 665f 6c73 743a 0a20 2020 2020 2020 2020  f_lst:.         
-00078e40: 2020 2020 2020 2066 6f72 2073 6c20 696e         for sl in
-00078e50: 2072 5f6c 7374 5b3a 2d31 5d3a 0a20 2020   r_lst[:-1]:.   
-00078e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078e70: 2074 6c65 6e2e 6170 7065 6e64 2873 6c2e   tlen.append(sl.
-00078e80: 746c 656e 290a 2020 2020 2020 2020 2020  tlen).          
-00078e90: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00078ea0: 2874 6c65 6e29 203e 2031 3030 3030 303a  (tlen) > 100000:
-00078eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00078ec0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00078ed0: 2020 2020 2020 2020 2020 206d 6564 5f66             med_f
-00078ee0: 7261 675f 6c65 6e20 3d20 6e70 2e6d 6564  rag_len = np.med
-00078ef0: 6961 6e28 746c 656e 290a 0a20 2020 2020  ian(tlen)..     
-00078f00: 2020 2020 2020 2023 2727 270a 2020 2020         #'''.    
-00078f10: 2020 2020 2020 2020 656c 6170 7365 645f          elapsed_
-00078f20: 7469 6d65 3120 3d20 7469 6d65 2e74 696d  time1 = time.tim
-00078f30: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
-00078f40: 310a 2020 2020 2020 2020 2020 2020 7072  1.            pr
-00078f50: 696e 7428 275c 7227 202b 2027 2027 2a31  int('\r' + ' '*1
-00078f60: 3030 2c20 656e 643d 2727 2c20 666c 7573  00, end='', flus
-00078f70: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
-00078f80: 2020 2020 2020 7072 696e 7428 275c 724c        print('\rL
-00078f90: 6f61 6469 6e67 2053 414d 206c 696e 6573  oading SAM lines
-00078fa0: 202e 2e2e 2e2e 2e20 646f 6e65 2028 2569   ...... done (%i
-00078fb0: 292e 2028 2569 722c 2025 6963 2920 2720  ). (%ir, %ic) ' 
-00078fc0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00078fd0: 2020 2020 2520 2869 6e74 2865 6c61 7073      % (int(elaps
-00078fe0: 6564 5f74 696d 6531 292c 2069 6e74 2873  ed_time1), int(s
-00078ff0: 6f2e 6e75 6d5f 7265 6164 7329 2c20 636e  o.num_reads), cn
-00079000: 7429 2c20 666c 7573 6820 3d20 5472 7565  t), flush = True
-00079010: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00079020: 7461 7274 5f74 696d 6532 203d 2074 696d  tart_time2 = tim
-00079030: 652e 7469 6d65 2829 0a0a 2020 2020 2020  e.time()..      
-00079040: 2020 2020 2020 6966 206e 5f63 6f72 6573        if n_cores
-00079050: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00079060: 2020 2020 2020 2070 7269 6e74 2827 4275         print('Bu
-00079070: 696c 6469 6e67 206c 6f63 6920 2620 434d  ilding loci & CM
-00079080: 6174 202e 2e2e 2027 2c20 656e 643d 2727  at ... ', end=''
-00079090: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000790a0: 2020 725f 6d69 5f6c 7374 2c20 725f 6e64    r_mi_lst, r_nd
-000790b0: 5f6c 7374 2c20 725f 7374 5f6c 7374 203d  _lst, r_st_lst =
-000790c0: 2062 7569 6c64 5f63 6f6e 7469 6773 2872   build_contigs(r
-000790d0: 5f6c 7374 5f6f 665f 6c73 7429 0a20 2020  _lst_of_lst).   
-000790e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000790f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00079100: 7269 6e74 2827 4275 696c 6469 6e67 206c  rint('Building l
-00079110: 6f63 6920 2620 434d 6174 202e 2e2e 2027  oci & CMat ... '
-00079120: 2c20 656e 643d 2727 290a 2020 2020 2020  , end='').      
-00079130: 2020 2020 2020 2020 2020 725f 6d69 5f6c            r_mi_l
-00079140: 7374 2c20 725f 6e64 5f6c 7374 2c20 725f  st, r_nd_lst, r_
-00079150: 7374 5f6c 7374 203d 2062 7569 6c64 5f63  st_lst = build_c
-00079160: 6f6e 7469 6773 5f6d 6328 725f 6c73 745f  ontigs_mc(r_lst_
-00079170: 6f66 5f6c 7374 2c20 6e5f 636f 7265 7329  of_lst, n_cores)
-00079180: 0a0a 2020 2020 2020 2020 2020 2020 7267  ..            rg
-00079190: 6e73 5f6c 7374 5f6d 6920 3d20 7267 6e73  ns_lst_mi = rgns
-000791a0: 5f6c 7374 5f6d 6920 2b20 725f 6d69 5f6c  _lst_mi + r_mi_l
-000791b0: 7374 0a20 2020 2020 2020 2020 2020 2072  st.            r
-000791c0: 676e 735f 6c73 745f 6e64 203d 2072 676e  gns_lst_nd = rgn
-000791d0: 735f 6c73 745f 6e64 202b 2072 5f6e 645f  s_lst_nd + r_nd_
-000791e0: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
-000791f0: 7267 6e73 5f6c 7374 5f73 7420 3d20 7267  rgns_lst_st = rg
-00079200: 6e73 5f6c 7374 5f73 7420 2b20 725f 7374  ns_lst_st + r_st
-00079210: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
-00079220: 2023 2727 2720 0a20 2020 2020 2020 2020   #''' .         
-00079230: 2020 0a20 2020 2020 2020 2020 2020 2065    .            e
-00079240: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
-00079250: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00079260: 7274 5f74 696d 6532 0a20 2020 2020 2020  rt_time2.       
-00079270: 2020 2020 2070 7269 6e74 2827 5c72 4275       print('\rBu
-00079280: 696c 6469 6e67 206c 6f63 6920 2620 434d  ilding loci & CM
-00079290: 6174 202e 2e2e 2064 6f6e 6520 2825 6929  at ... done (%i)
-000792a0: 2e20 2569 722c 2025 6963 2c20 6d65 642e  . %ir, %ic, med.
-000792b0: 6672 6167 2e6c 656e 203d 2025 6920 2720  frag.len = %i ' 
-000792c0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-000792d0: 2020 2020 2520 2869 6e74 2865 6c61 7073      % (int(elaps
-000792e0: 6564 5f74 696d 6531 292c 2069 6e74 2873  ed_time1), int(s
-000792f0: 6f2e 6e75 6d5f 7265 6164 7329 2c20 636e  o.num_reads), cn
-00079300: 742c 206d 6564 5f66 7261 675f 6c65 6e29  t, med_frag_len)
-00079310: 2029 0a20 2020 2020 2020 2020 2020 200a   ).            .
-00079320: 2020 2020 2020 2020 2323 2323 2323 2323          ########
-00079330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00077920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00077930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00077940: 2323 2323 0a20 2020 2020 2020 200a 2020  ####.        .  
+00077950: 2020 2020 2020 6d65 645f 6672 6167 5f6c        med_frag_l
+00077960: 656e 203d 2030 0a20 2020 2020 2020 2069  en = 0.        i
+00077970: 6620 6362 7963 3a0a 2020 2020 2020 2020  f cbyc:.        
+00077980: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00077990: 2070 7269 6e74 2827 5c72 4275 696c 6469   print('\rBuildi
+000779a0: 6e67 206c 6f63 6920 2620 434d 6174 2027  ng loci & CMat '
+000779b0: 2920 2320 2c20 656e 643d 2727 290a 2020  ) # , end='').  
+000779c0: 2020 2020 2020 2020 2020 636e 745f 6320            cnt_c 
+000779d0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+000779e0: 7768 696c 6520 5472 7565 3a0a 0a20 2020  while True:..   
+000779f0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00077a00: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
+00077a10: 696d 6528 290a 2020 2020 2020 2020 2020  ime().          
+00077a20: 2020 2020 2020 6572 5f63 6f64 652c 2073        er_code, s
+00077a30: 616d 5f6c 7374 2c20 6e75 6d5f 7265 6164  am_lst, num_read
+00077a40: 7320 3d20 736f 2e67 6574 5f6f 6e65 5f6f  s = so.get_one_o
+00077a50: 7665 726c 6170 6564 5f73 616d 2829 0a0a  verlaped_sam()..
+00077a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077a70: 6966 2065 725f 636f 6465 203d 3d20 4e4f  if er_code == NO
+00077a80: 545f 534f 5254 4544 3a0a 2020 2020 2020  T_SORTED:.      
+00077a90: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00077aa0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00077ab0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00077ac0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00077ad0: 2062 5f63 6e74 203d 3d20 303a 2072 5f6c   b_cnt == 0: r_l
+00077ae0: 7374 5f6f 665f 6c73 7420 3d20 5b5d 0a20  st_of_lst = []. 
+00077af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077b00: 2020 2062 5f63 6e74 202b 3d20 6c65 6e28     b_cnt += len(
+00077b10: 7361 6d5f 6c73 7429 0a0a 2020 2020 2020  sam_lst)..      
+00077b20: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00077b30: 6d5f 6c73 742e 6170 7065 6e64 2873 6129  m_lst.append(sa)
+00077b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00077b50: 2020 2020 2072 5f6c 7374 5f6f 665f 6c73       r_lst_of_ls
+00077b60: 742e 6170 7065 6e64 2820 7361 6d5f 6c73  t.append( sam_ls
+00077b70: 7420 2920 2320 2873 616d 5f6c 7374 2c20  t ) # (sam_lst, 
+00077b80: 7361 2920 290a 2020 2020 2020 2020 2020  sa) ).          
+00077b90: 2020 2020 2020 2020 2020 2320 725f 6c73            # r_ls
+00077ba0: 745f 6f66 5f6c 7374 2e61 7070 656e 6428  t_of_lst.append(
+00077bb0: 2028 7361 6d5f 6c73 742c 2073 6129 2029   (sam_lst, sa) )
+00077bc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00077bd0: 2020 2020 2020 6966 206e 5f63 6f72 6573        if n_cores
+00077be0: 203d 3d20 313a 200a 2020 2020 2020 2020   == 1: .        
+00077bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077c00: 6966 2028 625f 636e 7420 3d3d 206e 756d  if (b_cnt == num
+00077c10: 5f70 6172 616c 6c65 6c5f 6368 756e 6b73  _parallel_chunks
+00077c20: 2920 7c20 2865 725f 636f 6465 203d 3d20  ) | (er_code == 
+00077c30: 4e4f 5f4d 4f52 455f 4c49 4e45 293a 2062  NO_MORE_LINE): b
+00077c40: 5f63 6e74 203d 2030 0a20 2020 2020 2020  _cnt = 0.       
+00077c50: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00077c60: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+00077c70: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+00077c80: 2028 6572 5f63 6f64 6520 3d3d 204e 4557   (er_code == NEW
+00077c90: 5f43 4852 4d29 207c 2028 6572 5f63 6f64  _CHRM) | (er_cod
+00077ca0: 6520 3d3d 204e 4f5f 4d4f 5245 5f4c 494e  e == NO_MORE_LIN
+00077cb0: 4529 3a20 625f 636e 7420 3d20 300a 2020  E): b_cnt = 0.  
+00077cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077cd0: 2020 2020 2020 6966 2028 2862 5f63 6e74        if ((b_cnt
+00077ce0: 203e 206e 756d 5f70 6172 616c 6c65 6c5f   > num_parallel_
+00077cf0: 6368 756e 6b73 2920 2620 2865 725f 636f  chunks) & (er_co
+00077d00: 6465 203d 3d20 4e45 575f 4348 524d 2929  de == NEW_CHRM))
+00077d10: 207c 2028 6572 5f63 6f64 6520 3d3d 204e   | (er_code == N
+00077d20: 4f5f 4d4f 5245 5f4c 494e 4529 3a20 625f  O_MORE_LINE): b_
+00077d30: 636e 7420 3d20 300a 0a20 2020 2020 2020  cnt = 0..       
+00077d40: 2020 2020 2020 2020 2020 2020 2023 2727               #''
+00077d50: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00077d60: 2020 2020 2020 6966 2062 5f63 6e74 203d        if b_cnt =
+00077d70: 3d20 303a 0a0a 2020 2020 2020 2020 2020  = 0:..          
+00077d80: 2020 2020 2020 2020 2020 2020 2020 746c                tl
+00077d90: 656e 203d 205b 5d0a 2020 2020 2020 2020  en = [].        
+00077da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077db0: 666f 7220 725f 6c73 7420 696e 2072 5f6c  for r_lst in r_l
+00077dc0: 7374 5f6f 665f 6c73 743a 0a20 2020 2020  st_of_lst:.     
+00077dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077de0: 2020 2020 2020 2066 6f72 2073 6c20 696e         for sl in
+00077df0: 2072 5f6c 7374 5b3a 2d31 5d3a 0a20 2020   r_lst[:-1]:.   
+00077e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e10: 2020 2020 2020 2020 2020 2020 2074 6c65               tle
+00077e20: 6e2e 6170 7065 6e64 2873 6c2e 746c 656e  n.append(sl.tlen
+00077e30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00077e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e50: 2020 6966 206c 656e 2874 6c65 6e29 203e    if len(tlen) >
+00077e60: 2031 3030 3030 303a 2062 7265 616b 0a20   100000: break. 
+00077e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077e80: 2020 2020 2020 206d 666c 203d 206e 702e         mfl = np.
+00077e90: 6d65 6469 616e 2874 6c65 6e29 0a20 2020  median(tlen).   
+00077ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077eb0: 2020 2020 206d 6564 5f66 7261 675f 6c65       med_frag_le
+00077ec0: 6e20 2b3d 206d 666c 200a 0a20 2020 2020  n += mfl ..     
+00077ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077ee0: 2020 2069 6620 6e5f 636f 7265 7320 3d3d     if n_cores ==
+00077ef0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00077f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077f10: 2320 6368 725f 6e61 6d65 203d 2073 616d  # chr_name = sam
+00077f20: 5f6c 7374 5b30 5d2e 726e 616d 650a 2020  _lst[0].rname.  
+00077f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077f40: 2020 2020 2020 2020 2020 6368 725f 6c73            chr_ls
+00077f50: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
+00077f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077f70: 2020 2063 6872 5f6e 616d 6520 3d20 2727     chr_name = ''
+00077f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00077f90: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00077fa0: 2072 5f6c 7374 2069 6e20 725f 6c73 745f   r_lst in r_lst_
+00077fb0: 6f66 5f6c 7374 3a0a 2020 2020 2020 2020  of_lst:.        
+00077fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077fd0: 2020 2020 2020 2020 6966 2072 5f6c 7374          if r_lst
+00077fe0: 5b30 5d2e 726e 616d 6520 6e6f 7420 696e  [0].rname not in
+00077ff0: 2063 6872 5f6c 7374 3a0a 2020 2020 2020   chr_lst:.      
+00078000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078010: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00078020: 725f 6c73 742e 6170 7065 6e64 2872 5f6c  r_lst.append(r_l
+00078030: 7374 5b30 5d2e 726e 616d 6529 0a20 2020  st[0].rname).   
+00078040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078060: 2063 6872 5f6e 616d 6520 3d20 6368 725f   chr_name = chr_
+00078070: 6e61 6d65 202b 2027 2573 2027 2025 2028  name + '%s ' % (
+00078080: 725f 6c73 745b 305d 2e72 6e61 6d65 290a  r_lst[0].rname).
+00078090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000780a0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000780b0: 656e 2863 6872 5f6e 616d 6529 203e 2035  en(chr_name) > 5
+000780c0: 303a 200a 2020 2020 2020 2020 2020 2020  0: .            
+000780d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000780e0: 2020 2020 6966 2028 636e 745f 6320 3d3d      if (cnt_c ==
+000780f0: 2030 2920 2620 2865 725f 636f 6465 203d   0) & (er_code =
+00078100: 3d20 4e4f 5f4d 4f52 455f 4c49 4e45 293a  = NO_MORE_LINE):
+00078110: 2063 6872 5f6e 616d 6520 3d20 2720 270a   chr_name = ' '.
+00078120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078140: 656c 7365 3a20 6368 725f 6e61 6d65 203d  else: chr_name =
+00078150: 2027 6f74 6865 7273 270a 2020 2020 2020   'others'.      
+00078160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078170: 2020 2020 2020 725f 6d69 5f6c 7374 2c20        r_mi_lst, 
+00078180: 725f 6e64 5f6c 7374 2c20 725f 7374 5f6c  r_nd_lst, r_st_l
+00078190: 7374 203d 2062 7569 6c64 5f63 6f6e 7469  st = build_conti
+000781a0: 6773 2872 5f6c 7374 5f6f 665f 6c73 742c  gs(r_lst_of_lst,
+000781b0: 2063 6872 5f6e 616d 6529 0a20 2020 2020   chr_name).     
+000781c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000781d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000781e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000781f0: 2020 2020 2063 6872 5f6e 616d 6520 3d20       chr_name = 
+00078200: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+00078210: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00078220: 2069 6620 2863 6e74 5f63 203e 2030 2920   if (cnt_c > 0) 
+00078230: 7c20 2865 725f 636f 6465 2021 3d20 4e4f  | (er_code != NO
+00078240: 5f4d 4f52 455f 4c49 4e45 293a 0a20 2020  _MORE_LINE):.   
+00078250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078260: 2020 2020 2020 2020 2063 6872 5f6c 7374           chr_lst
+00078270: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00078280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078290: 2020 6368 725f 6e61 6d65 203d 2027 270a    chr_name = ''.
+000782a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000782b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000782c0: 725f 6c73 7420 696e 2072 5f6c 7374 5f6f  r_lst in r_lst_o
+000782d0: 665f 6c73 743a 0a20 2020 2020 2020 2020  f_lst:.         
+000782e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000782f0: 2020 2020 2020 2069 6620 725f 6c73 745b         if r_lst[
+00078300: 305d 2e72 6e61 6d65 206e 6f74 2069 6e20  0].rname not in 
+00078310: 6368 725f 6c73 743a 0a20 2020 2020 2020  chr_lst:.       
+00078320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078330: 2020 2020 2020 2020 2020 2020 2063 6872               chr
+00078340: 5f6c 7374 2e61 7070 656e 6428 725f 6c73  _lst.append(r_ls
+00078350: 745b 305d 2e72 6e61 6d65 290a 2020 2020  t[0].rname).    
+00078360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078380: 6368 725f 6e61 6d65 203d 2063 6872 5f6e  chr_name = chr_n
+00078390: 616d 6520 2b20 2725 7320 2720 2520 2872  ame + '%s ' % (r
+000783a0: 5f6c 7374 5b30 5d2e 726e 616d 6529 0a20  _lst[0].rname). 
+000783b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000783c0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+000783d0: 6e28 6368 725f 6e61 6d65 2920 3e20 3530  n(chr_name) > 50
+000783e0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+000783f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078400: 2020 2069 6620 2863 6e74 5f63 203d 3d20     if (cnt_c == 
+00078410: 3029 2026 2028 6572 5f63 6f64 6520 3d3d  0) & (er_code ==
+00078420: 204e 4f5f 4d4f 5245 5f4c 494e 4529 3a20   NO_MORE_LINE): 
+00078430: 6368 725f 6e61 6d65 203d 2027 2027 0a20  chr_name = ' '. 
+00078440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078450: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00078460: 6c73 653a 2063 6872 5f6e 616d 6520 3d20  lse: chr_name = 
+00078470: 276f 7468 6572 7327 0a20 2020 2020 2020  'others'.       
+00078480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078490: 2020 2020 2023 2069 6620 636e 745f 6320       # if cnt_c 
+000784a0: 3d3d 2030 3a20 7072 696e 7428 2720 2729  == 0: print(' ')
+000784b0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000784c0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000784d0: 6172 745f 7469 6d65 3320 3d20 7469 6d65  art_time3 = time
+000784e0: 2e74 696d 6528 290a 2020 2020 2020 2020  .time().        
+000784f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078500: 2020 2020 725f 6d69 5f6c 7374 2c20 725f      r_mi_lst, r_
+00078510: 6e64 5f6c 7374 2c20 725f 7374 5f6c 7374  nd_lst, r_st_lst
+00078520: 203d 2062 7569 6c64 5f63 6f6e 7469 6773   = build_contigs
+00078530: 5f6d 6328 725f 6c73 745f 6f66 5f6c 7374  _mc(r_lst_of_lst
+00078540: 2c20 6e5f 636f 7265 732c 2063 6872 5f6e  , n_cores, chr_n
+00078550: 616d 6529 0a0a 2020 2020 2020 2020 2020  ame)..          
+00078560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078570: 2020 2320 6966 2028 636e 745f 6320 3e20    # if (cnt_c > 
+00078580: 3029 207c 2028 6572 5f63 6f64 6520 213d  0) | (er_code !=
+00078590: 204e 4f5f 4d4f 5245 5f4c 494e 4529 3a0a   NO_MORE_LINE):.
+000785a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000785b0: 2020 2020 2020 2020 2020 2020 656c 6170              elap
+000785c0: 7365 645f 7469 6d65 3320 3d20 7469 6d65  sed_time3 = time
+000785d0: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
+000785e0: 7469 6d65 330a 2020 2020 2020 2020 2020  time3.          
+000785f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078600: 2020 7072 696e 7428 275c 7227 202b 2027    print('\r' + '
+00078610: 2027 2a31 3030 2c20 656e 643d 2727 2c20   '*100, end='', 
+00078620: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
+00078630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078640: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00078650: 275c 7220 2020 7072 6f63 6573 7369 6e67  '\r   processing
+00078660: 2025 732e 2e2e 2064 6f6e 652e 2028 2569   %s... done. (%i
+00078670: 2920 2825 6972 2c20 2569 632c 2025 6929  ) (%ir, %ic, %i)
+00078680: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
+00078690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000786a0: 2020 2020 2020 2520 2863 6872 5f6e 616d        % (chr_nam
+000786b0: 652c 2065 6c61 7073 6564 5f74 696d 6533  e, elapsed_time3
+000786c0: 2c20 696e 7428 736f 2e6e 756d 5f72 6561  , int(so.num_rea
+000786d0: 6473 292c 206c 656e 2872 5f6c 7374 5f6f  ds), len(r_lst_o
+000786e0: 665f 6c73 7429 2c20 6d66 6c29 2c20 666c  f_lst), mfl), fl
+000786f0: 7573 6820 3d20 5472 7565 2920 232c 2065  ush = True) #, e
+00078700: 6e64 3d27 2729 0a0a 2020 2020 2020 2020  nd='')..        
+00078710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078720: 7267 6e73 5f6c 7374 5f6d 6920 3d20 7267  rgns_lst_mi = rg
+00078730: 6e73 5f6c 7374 5f6d 6920 2b20 725f 6d69  ns_lst_mi + r_mi
+00078740: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+00078750: 2020 2020 2020 2020 2020 2020 2072 676e               rgn
+00078760: 735f 6c73 745f 6e64 203d 2072 676e 735f  s_lst_nd = rgns_
+00078770: 6c73 745f 6e64 202b 2072 5f6e 645f 6c73  lst_nd + r_nd_ls
+00078780: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00078790: 2020 2020 2020 2020 2020 7267 6e73 5f6c            rgns_l
+000787a0: 7374 5f73 7420 3d20 7267 6e73 5f6c 7374  st_st = rgns_lst
+000787b0: 5f73 7420 2b20 725f 7374 5f6c 7374 0a20  _st + r_st_lst. 
+000787c0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000787d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000787e0: 6966 2065 725f 636f 6465 203d 3d20 4e4f  if er_code == NO
+000787f0: 5f4d 4f52 455f 4c49 4e45 3a20 6272 6561  _MORE_LINE: brea
+00078800: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00078810: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00078820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078830: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+00078840: 6320 2b3d 2031 0a20 2020 2020 2020 2020  c += 1.         
+00078850: 2020 2020 2020 2020 2020 2023 2727 270a             #'''.
+00078860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078870: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
+00078880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078890: 2020 2320 6966 2063 6e74 5f63 203e 2030    # if cnt_c > 0
+000788a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000788b0: 2020 2020 2020 6966 2063 6e74 2531 3030        if cnt%100
+000788c0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000788d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000788e0: 7269 6e74 2827 5c72 2720 2b20 2720 272a  rint('\r' + ' '*
+000788f0: 3130 302c 2065 6e64 3d27 272c 2066 6c75  100, end='', flu
+00078900: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
+00078910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078920: 2020 2070 7269 6e74 2827 5c72 2020 206c     print('\r   l
+00078930: 6f61 6469 6e67 2028 2569 722c 2025 6963  oading (%ir, %ic
+00078940: 2c20 2573 2920 2720 5c0a 2020 2020 2020  , %s) ' \.      
+00078950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078960: 2020 2020 2020 2020 2520 2869 6e74 2873          % (int(s
+00078970: 6f2e 6e75 6d5f 7265 6164 7329 2c20 636e  o.num_reads), cn
+00078980: 742c 2073 616d 5f6c 7374 5b30 5d2e 726e  t, sam_lst[0].rn
+00078990: 616d 6529 2c20 656e 643d 2727 2c20 666c  ame), end='', fl
+000789a0: 7573 6820 3d20 5472 7565 290a 0a20 2020  ush = True)..   
+000789b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000789c0: 2069 6620 6572 5f63 6f64 6520 3d3d 204e   if er_code == N
+000789d0: 4f5f 4d4f 5245 5f4c 494e 453a 2062 7265  O_MORE_LINE: bre
+000789e0: 616b 0a0a 2020 2020 2020 2020 2020 2020  ak..            
+000789f0: 6d65 645f 6672 6167 5f6c 656e 203d 206e  med_frag_len = n
+00078a00: 702e 696e 7428 6d65 645f 6672 6167 5f6c  p.int(med_frag_l
+00078a10: 656e 2f28 636e 745f 632b 3129 290a 0a20  en/(cnt_c+1)).. 
+00078a20: 2020 2020 2020 2020 2020 2065 6c61 7073             elaps
+00078a30: 6564 5f74 696d 6531 203d 2074 696d 652e  ed_time1 = time.
+00078a40: 7469 6d65 2829 202d 2073 7461 7274 5f74  time() - start_t
+00078a50: 696d 6532 0a20 2020 2020 2020 2020 2020  ime2.           
+00078a60: 2070 7269 6e74 2827 5c72 4275 696c 6469   print('\rBuildi
+00078a70: 6e67 206c 6f63 6920 2620 434d 6174 202e  ng loci & CMat .
+00078a80: 2e2e 2064 6f6e 6520 2825 6929 2e20 2825  .. done (%i). (%
+00078a90: 6972 2c20 2569 632c 2025 6929 2027 205c  ir, %ic, %i) ' \
+00078aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00078ab0: 2020 2025 2028 696e 7428 656c 6170 7365     % (int(elapse
+00078ac0: 645f 7469 6d65 3129 2c20 696e 7428 736f  d_time1), int(so
+00078ad0: 2e6e 756d 5f72 6561 6473 292c 2063 6e74  .num_reads), cnt
+00078ae0: 2c20 6d65 645f 6672 6167 5f6c 656e 2920  , med_frag_len) 
+00078af0: 290a 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00078b00: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00078b10: 2020 2020 2020 7072 696e 7428 275c 724c        print('\rL
+00078b20: 6f61 6469 6e67 2053 414d 206c 696e 6573  oading SAM lines
+00078b30: 202e 2e2e 2e2e 2e20 2027 2c20 656e 643d   ......  ', end=
+00078b40: 2727 2920 2020 2020 2020 200a 2020 2020  '')        .    
+00078b50: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
+00078b60: 7565 3a0a 0a20 2020 2020 2020 2020 2020  ue:..           
+00078b70: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
+00078b80: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
+00078b90: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00078ba0: 5f63 6f64 652c 2073 616d 5f6c 7374 2c20  _code, sam_lst, 
+00078bb0: 6e75 6d5f 7265 6164 7320 3d20 736f 2e67  num_reads = so.g
+00078bc0: 6574 5f6f 6e65 5f6f 7665 726c 6170 6564  et_one_overlaped
+00078bd0: 5f73 616d 2829 0a0a 2020 2020 2020 2020  _sam()..        
+00078be0: 2020 2020 2020 2020 6966 2065 725f 636f          if er_co
+00078bf0: 6465 203d 3d20 4e4f 545f 534f 5254 4544  de == NOT_SORTED
+00078c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00078c10: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00078c20: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00078c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00078c40: 2020 2020 2020 7361 6d5f 6c73 742e 6170        sam_lst.ap
+00078c50: 7065 6e64 2873 6129 0a20 2020 2020 2020  pend(sa).       
+00078c60: 2020 2020 2020 2020 2020 2020 2072 5f6c               r_l
+00078c70: 7374 5f6f 665f 6c73 742e 6170 7065 6e64  st_of_lst.append
+00078c80: 2820 7361 6d5f 6c73 7420 2920 2320 2873  ( sam_lst ) # (s
+00078c90: 616d 5f6c 7374 2c20 7361 2920 290a 2020  am_lst, sa) ).  
+00078ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078cb0: 2020 2320 725f 6c73 745f 6f66 5f6c 7374    # r_lst_of_lst
+00078cc0: 2e61 7070 656e 6428 2028 7361 6d5f 6c73  .append( (sam_ls
+00078cd0: 742c 2073 6129 2029 0a0a 2020 2020 2020  t, sa) )..      
+00078ce0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+00078cf0: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
+00078d00: 2020 2020 2020 2020 2020 2069 6620 636e             if cn
+00078d10: 7425 3130 3020 3d3d 2030 3a0a 2020 2020  t%100 == 0:.    
+00078d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078d30: 2020 2020 7072 696e 7428 275c 7227 202b      print('\r' +
+00078d40: 2027 2027 2a31 3030 2c20 656e 643d 2727   ' '*100, end=''
+00078d50: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+00078d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078d70: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
+00078d80: 724c 6f61 6469 6e67 2053 414d 206c 696e  rLoading SAM lin
+00078d90: 6573 202e 2e2e 2e2e 2e20 2825 6972 2c20  es ...... (%ir, 
+00078da0: 2569 6329 2027 2025 2028 696e 7428 736f  %ic) ' % (int(so
+00078db0: 2e6e 756d 5f72 6561 6473 292c 2063 6e74  .num_reads), cnt
+00078dc0: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
+00078dd0: 203d 2054 7275 6529 0a0a 2020 2020 2020   = True)..      
+00078de0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00078df0: 2065 725f 636f 6465 203d 3d20 4e4f 5f4d   er_code == NO_M
+00078e00: 4f52 455f 4c49 4e45 3a20 6272 6561 6b0a  ORE_LINE: break.
+00078e10: 0a20 2020 2020 2020 2020 2020 2074 6c65  .            tle
+00078e20: 6e20 3d20 5b5d 0a20 2020 2020 2020 2020  n = [].         
+00078e30: 2020 2066 6f72 2072 5f6c 7374 2069 6e20     for r_lst in 
+00078e40: 725f 6c73 745f 6f66 5f6c 7374 3a0a 2020  r_lst_of_lst:.  
+00078e50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00078e60: 7220 736c 2069 6e20 725f 6c73 745b 3a2d  r sl in r_lst[:-
+00078e70: 315d 3a0a 2020 2020 2020 2020 2020 2020  1]:.            
+00078e80: 2020 2020 2020 2020 746c 656e 2e61 7070          tlen.app
+00078e90: 656e 6428 736c 2e74 6c65 6e29 0a20 2020  end(sl.tlen).   
+00078ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078eb0: 2069 6620 6c65 6e28 746c 656e 2920 3e20   if len(tlen) > 
+00078ec0: 3130 3030 3030 3a0a 2020 2020 2020 2020  100000:.        
+00078ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078ee0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00078ef0: 2020 6d65 645f 6672 6167 5f6c 656e 203d    med_frag_len =
+00078f00: 206e 702e 6d65 6469 616e 2874 6c65 6e29   np.median(tlen)
+00078f10: 0a0a 2020 2020 2020 2020 2020 2020 2327  ..            #'
+00078f20: 2727 0a20 2020 2020 2020 2020 2020 2065  ''.            e
+00078f30: 6c61 7073 6564 5f74 696d 6531 203d 2074  lapsed_time1 = t
+00078f40: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
+00078f50: 7274 5f74 696d 6531 0a20 2020 2020 2020  rt_time1.       
+00078f60: 2020 2020 2070 7269 6e74 2827 5c72 2720       print('\r' 
+00078f70: 2b20 2720 272a 3130 302c 2065 6e64 3d27  + ' '*100, end='
+00078f80: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
+00078f90: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00078fa0: 6e74 2827 5c72 4c6f 6164 696e 6720 5341  nt('\rLoading SA
+00078fb0: 4d20 6c69 6e65 7320 2e2e 2e2e 2e2e 2064  M lines ...... d
+00078fc0: 6f6e 6520 2825 6929 2e20 2825 6972 2c20  one (%i). (%ir, 
+00078fd0: 2569 6329 2027 205c 0a20 2020 2020 2020  %ic) ' \.       
+00078fe0: 2020 2020 2020 2020 2020 2025 2028 696e             % (in
+00078ff0: 7428 656c 6170 7365 645f 7469 6d65 3129  t(elapsed_time1)
+00079000: 2c20 696e 7428 736f 2e6e 756d 5f72 6561  , int(so.num_rea
+00079010: 6473 292c 2063 6e74 292c 2066 6c75 7368  ds), cnt), flush
+00079020: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
+00079030: 2020 2020 2020 7374 6172 745f 7469 6d65        start_time
+00079040: 3220 3d20 7469 6d65 2e74 696d 6528 290a  2 = time.time().
+00079050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00079060: 6e5f 636f 7265 7320 3d3d 2031 3a0a 2020  n_cores == 1:.  
+00079070: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00079080: 696e 7428 2742 7569 6c64 696e 6720 6c6f  int('Building lo
+00079090: 6369 2026 2043 4d61 7420 2e2e 2e20 272c  ci & CMat ... ',
+000790a0: 2065 6e64 3d27 2729 0a20 2020 2020 2020   end='').       
+000790b0: 2020 2020 2020 2020 2072 5f6d 695f 6c73           r_mi_ls
+000790c0: 742c 2072 5f6e 645f 6c73 742c 2072 5f73  t, r_nd_lst, r_s
+000790d0: 745f 6c73 7420 3d20 6275 696c 645f 636f  t_lst = build_co
+000790e0: 6e74 6967 7328 725f 6c73 745f 6f66 5f6c  ntigs(r_lst_of_l
+000790f0: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
+00079100: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00079110: 2020 2020 2020 7072 696e 7428 2742 7569        print('Bui
+00079120: 6c64 696e 6720 6c6f 6369 2026 2043 4d61  lding loci & CMa
+00079130: 7420 2e2e 2e20 272c 2065 6e64 3d27 2729  t ... ', end='')
+00079140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00079150: 2072 5f6d 695f 6c73 742c 2072 5f6e 645f   r_mi_lst, r_nd_
+00079160: 6c73 742c 2072 5f73 745f 6c73 7420 3d20  lst, r_st_lst = 
+00079170: 6275 696c 645f 636f 6e74 6967 735f 6d63  build_contigs_mc
+00079180: 2872 5f6c 7374 5f6f 665f 6c73 742c 206e  (r_lst_of_lst, n
+00079190: 5f63 6f72 6573 290a 0a20 2020 2020 2020  _cores)..       
+000791a0: 2020 2020 2072 676e 735f 6c73 745f 6d69       rgns_lst_mi
+000791b0: 203d 2072 676e 735f 6c73 745f 6d69 202b   = rgns_lst_mi +
+000791c0: 2072 5f6d 695f 6c73 740a 2020 2020 2020   r_mi_lst.      
+000791d0: 2020 2020 2020 7267 6e73 5f6c 7374 5f6e        rgns_lst_n
+000791e0: 6420 3d20 7267 6e73 5f6c 7374 5f6e 6420  d = rgns_lst_nd 
+000791f0: 2b20 725f 6e64 5f6c 7374 0a20 2020 2020  + r_nd_lst.     
+00079200: 2020 2020 2020 2072 676e 735f 6c73 745f         rgns_lst_
+00079210: 7374 203d 2072 676e 735f 6c73 745f 7374  st = rgns_lst_st
+00079220: 202b 2072 5f73 745f 6c73 740a 2020 2020   + r_st_lst.    
+00079230: 2020 2020 2020 2020 2327 2727 200a 2020          #''' .  
+00079240: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00079250: 2020 2020 2020 656c 6170 7365 645f 7469        elapsed_ti
+00079260: 6d65 3120 3d20 7469 6d65 2e74 696d 6528  me1 = time.time(
+00079270: 2920 2d20 7374 6172 745f 7469 6d65 320a  ) - start_time2.
+00079280: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00079290: 7428 275c 7242 7569 6c64 696e 6720 6c6f  t('\rBuilding lo
+000792a0: 6369 2026 2043 4d61 7420 2e2e 2e20 646f  ci & CMat ... do
+000792b0: 6e65 2028 2569 292e 2025 6972 2c20 2569  ne (%i). %ir, %i
+000792c0: 632c 206d 6564 2e66 7261 672e 6c65 6e20  c, med.frag.len 
+000792d0: 3d20 2569 2027 205c 0a20 2020 2020 2020  = %i ' \.       
+000792e0: 2020 2020 2020 2020 2020 2025 2028 696e             % (in
+000792f0: 7428 656c 6170 7365 645f 7469 6d65 3129  t(elapsed_time1)
+00079300: 2c20 696e 7428 736f 2e6e 756d 5f72 6561  , int(so.num_rea
+00079310: 6473 292c 2063 6e74 2c20 6d65 645f 6672  ds), cnt, med_fr
+00079320: 6167 5f6c 656e 2920 290a 2020 2020 2020  ag_len) ).      
+00079330: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
 00079340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00079350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00079360: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00079370: 2020 6465 6c20 725f 6c73 745f 6f66 5f6c    del r_lst_of_l
-00079380: 7374 0a20 2020 2020 2020 2027 2727 0a20  st.        '''. 
-00079390: 2020 2020 2020 2063 6e74 5f69 203d 2030         cnt_i = 0
-000793a0: 0a20 2020 2020 2020 2063 6e74 5f73 203d  .        cnt_s =
-000793b0: 2030 0a20 2020 2020 2020 2063 6e74 5f74   0.        cnt_t
-000793c0: 203d 2030 0a20 2020 2020 2020 2066 6f72   = 0.        for
-000793d0: 2072 676e 7320 696e 2072 676e 735f 6c73   rgns in rgns_ls
-000793e0: 745f 7374 3a20 0a20 2020 2020 2020 2020  t_st: .         
-000793f0: 2020 2066 6f72 2072 2069 6e20 7267 6e73     for r in rgns
-00079400: 2e72 676e 733a 0a20 2020 2020 2020 2020  .rgns:.         
-00079410: 2020 2020 2020 2069 6620 722e 7479 7065         if r.type
-00079420: 203d 3d20 2749 273a 2063 6e74 5f69 202b   == 'I': cnt_i +
-00079430: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00079440: 2020 2020 656c 6966 2072 2e74 7970 6520      elif r.type 
-00079450: 3d3d 2027 5327 3a20 636e 745f 7320 2b3d  == 'S': cnt_s +=
-00079460: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00079470: 2020 2065 6c69 6620 722e 7479 7065 203d     elif r.type =
-00079480: 3d20 2754 273a 2063 6e74 5f74 202b 3d20  = 'T': cnt_t += 
-00079490: 310a 2020 2020 2020 2020 7072 696e 7428  1.        print(
-000794a0: 2027 436e 7420 492f 532f 5420 3d20 2569   'Cnt I/S/T = %i
-000794b0: 2c20 2569 2c20 2569 2027 2025 2028 636e  , %i, %i ' % (cn
-000794c0: 745f 692c 2063 6e74 5f73 2c20 636e 745f  t_i, cnt_s, cnt_
-000794d0: 7429 2029 0a20 2020 2020 2020 2027 2727  t) ).        '''
-000794e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000794f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00079500: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00079510: 2066 6f72 2072 2069 6e20 7267 6e73 5f6c   for r in rgns_l
-00079520: 7374 5f6d 693a 2072 2e73 6574 5f63 7667  st_mi: r.set_cvg
-00079530: 2829 0a20 2020 2020 2020 2066 6f72 2072  ().        for r
-00079540: 2069 6e20 7267 6e73 5f6c 7374 5f6e 643a   in rgns_lst_nd:
-00079550: 2072 2e73 6574 5f63 7667 2829 0a20 2020   r.set_cvg().   
-00079560: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
-00079570: 6e73 5f6c 7374 5f73 743a 2072 2e73 6574  ns_lst_st: r.set
-00079580: 5f63 7667 2829 0a20 2020 2020 2020 2020  _cvg().         
-00079590: 2020 200a 2020 2020 2020 2020 736f 2e63     .        so.c
-000795a0: 6c6f 7365 2829 0a20 2020 2020 2020 206e  lose().        n
-000795b0: 5f72 6561 6473 2c20 6e5f 6261 7365 732c  _reads, n_bases,
-000795c0: 2072 645f 6c65 6e20 3d20 736f 2e6e 756d   rd_len = so.num
-000795d0: 5f72 6561 6473 2c20 736f 2e6e 756d 5f62  _reads, so.num_b
-000795e0: 6173 6573 2c20 736f 2e72 6561 645f 6c65  ases, so.read_le
-000795f0: 6e0a 2020 2020 2020 2020 7264 5f6c 656e  n.        rd_len
-00079600: 203d 2073 6f2e 7265 6164 5f6c 656e 0a20   = so.read_len. 
-00079610: 2020 2020 2020 2065 6c61 7073 6564 5f74         elapsed_t
-00079620: 696d 6531 203d 2074 696d 652e 7469 6d65  ime1 = time.time
-00079630: 2829 202d 2073 7461 7274 5f74 696d 6532  () - start_time2
-00079640: 0a0a 2020 2020 2020 2020 2327 2727 0a20  ..        #'''. 
-00079650: 2020 2020 2020 2070 7269 6e74 2827 5361         print('Sa
-00079660: 7669 6e67 206c 6f63 6920 2620 636f 6e73  ving loci & cons
-00079670: 656e 7375 7320 6d61 7472 6963 6573 202e  ensus matrices .
-00079680: 2e2e 2e2e 272c 2065 6e64 3d27 272c 2066  ....', end='', f
-00079690: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
-000796a0: 2020 2020 2073 6176 655f 7267 6e73 5f6f       save_rgns_o
-000796b0: 626a 2866 6e61 6d65 202b 2027 2e72 676e  bj(fname + '.rgn
-000796c0: 7327 2c20 7267 6e73 5f6c 7374 5f6d 692c  s', rgns_lst_mi,
-000796d0: 2072 676e 735f 6c73 745f 6e64 2c20 7267   rgns_lst_nd, rg
-000796e0: 6e73 5f6c 7374 5f73 742c 2073 6f2e 7265  ns_lst_st, so.re
-000796f0: 6164 5f6c 656e 2c20 736f 2e6e 756d 5f72  ad_len, so.num_r
-00079700: 6561 6473 2c20 6d65 645f 6672 6167 5f6c  eads, med_frag_l
-00079710: 656e 2029 0a0a 2020 2020 2020 2020 2320  en )..        # 
-00079720: 7072 696e 7428 272e 272c 2065 6e64 3d27  print('.', end='
-00079730: 2729 0a20 2020 2020 2020 2022 2222 0a20  ').        """. 
-00079740: 2020 2020 2020 2073 6176 655f 7267 6e73         save_rgns
-00079750: 2820 666e 616d 6520 2b20 275f 7267 6e73  ( fname + '_rgns
-00079760: 5f6d 695f 2569 2e74 7874 2720 2520 7361  _mi_%i.txt' % sa
-00079770: 2c20 7267 6e73 5f6c 7374 5f6d 692c 2073  , rgns_lst_mi, s
-00079780: 6f2e 7265 6164 5f6c 656e 2c20 736f 2e6e  o.read_len, so.n
-00079790: 756d 5f72 6561 6473 2029 0a20 2020 2020  um_reads ).     
-000797a0: 2020 2070 7269 6e74 2827 2e27 2c20 656e     print('.', en
-000797b0: 643d 2727 290a 2020 2020 2020 2020 2222  d='').        ""
-000797c0: 220a 2020 2020 2020 2020 2320 7361 7665  ".        # save
-000797d0: 5f72 676e 7328 2066 6e61 6d65 202b 2027  _rgns( fname + '
-000797e0: 5f72 676e 735f 6e64 5f25 692e 7478 7427  _rgns_nd_%i.txt'
-000797f0: 2025 2073 612c 2072 676e 735f 6c73 745f   % sa, rgns_lst_
-00079800: 6e64 2c20 736f 2e72 6561 645f 6c65 6e2c  nd, so.read_len,
-00079810: 2073 6f2e 6e75 6d5f 7265 6164 7320 290a   so.num_reads ).
-00079820: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-00079830: 272e 272c 2065 6e64 3d27 2729 0a20 2020  '.', end='').   
-00079840: 2020 2020 2023 2073 6176 655f 7267 6e73       # save_rgns
-00079850: 2820 666e 616d 6520 2b20 275f 7267 6e73  ( fname + '_rgns
-00079860: 5f69 5f25 695f 686f 2e74 7874 2720 2520  _i_%i_ho.txt' % 
-00079870: 7361 2c20 7267 6e73 5f6c 7374 5f73 742c  sa, rgns_lst_st,
-00079880: 2073 6f2e 7265 6164 5f6c 656e 2c20 736f   so.read_len, so
-00079890: 2e6e 756d 5f72 6561 6473 2c20 686f 203d  .num_reads, ho =
-000798a0: 2054 7275 6520 290a 2020 2020 2020 2020   True ).        
-000798b0: 2320 7072 696e 7428 272e 272c 2065 6e64  # print('.', end
-000798c0: 3d27 2729 0a20 2020 2020 2020 200a 2020  ='').        .  
-000798d0: 2020 2020 2020 2320 7361 7665 5f72 676e        # save_rgn
-000798e0: 7328 2066 6e61 6d65 202b 2027 5f72 676e  s( fname + '_rgn
-000798f0: 735f 6d5f 2569 5f68 6f2e 7478 7427 2025  s_m_%i_ho.txt' %
-00079900: 2073 612c 2072 676e 735f 6c73 745f 6d69   sa, rgns_lst_mi
-00079910: 2c20 736f 2e72 6561 645f 6c65 6e2c 2073  , so.read_len, s
-00079920: 6f2e 6e75 6d5f 7265 6164 732c 2068 6f20  o.num_reads, ho 
-00079930: 3d20 5472 7565 2029 0a20 2020 2020 2020  = True ).       
-00079940: 2023 2070 7269 6e74 2827 2e27 2c20 656e   # print('.', en
-00079950: 643d 2727 290a 2020 2020 2020 2020 2320  d='').        # 
-00079960: 6774 665f 6c69 6e65 5f6c 7374 203d 2067  gtf_line_lst = g
-00079970: 6574 5f67 7466 5f6c 696e 6573 2820 7267  et_gtf_lines( rg
-00079980: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
-00079990: 6c73 745f 6e64 2029 0a20 2020 2020 2020  lst_nd ).       
-000799a0: 2023 2073 6176 655f 6774 6628 2066 6e61   # save_gtf( fna
-000799b0: 6d65 2b27 5f72 6567 696f 6e73 2e67 7466  me+'_regions.gtf
-000799c0: 272c 2067 7466 5f6c 696e 655f 6c73 7420  ', gtf_line_lst 
-000799d0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-000799e0: 2720 646f 6e65 2729 0a20 2020 2020 2020  ' done').       
-000799f0: 2023 2727 270a 2020 2020 0a20 2020 2065   #'''.    .    e
-00079a00: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
-00079a10: 6e74 2827 5374 7269 6e67 4669 7820 7374  nt('StringFix st
-00079a20: 6172 7465 6420 272c 2064 6174 6574 696d  arted ', datetim
-00079a30: 652e 6461 7465 7469 6d65 2e6e 6f77 2829  e.datetime.now()
-00079a40: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00079a50: 274c 6f61 6469 6e67 206c 6f63 6920 2620  'Loading loci & 
-00079a60: 636f 6e73 656e 7375 7320 6d61 7472 6963  consensus matric
-00079a70: 6573 202e 2e2e 272c 2065 6e64 3d27 2729  es ...', end='')
-00079a80: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00079a90: 2020 6461 7461 203d 206c 6f61 645f 7267    data = load_rg
-00079aa0: 6e73 5f6f 626a 2866 6e61 6d65 202b 2027  ns_obj(fname + '
-00079ab0: 2e72 676e 7327 290a 2020 2020 2020 2020  .rgns').        
-00079ac0: 6966 206c 656e 2864 6174 6129 203d 3d20  if len(data) == 
-00079ad0: 353a 0a20 2020 2020 2020 2020 2020 2072  5:.            r
-00079ae0: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
-00079af0: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
-00079b00: 745f 7374 2c20 7264 5f6c 656e 2c20 6e5f  t_st, rd_len, n_
-00079b10: 7265 6164 7320 3d20 6461 7461 0a20 2020  reads = data.   
-00079b20: 2020 2020 2020 2020 206d 6564 5f66 7261           med_fra
-00079b30: 675f 6c65 6e20 3d20 3330 300a 2020 2020  g_len = 300.    
-00079b40: 2020 2020 2020 2020 6465 6c20 6461 7461          del data
-00079b50: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00079b60: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
-00079b70: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
-00079b80: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
-00079b90: 2c20 7264 5f6c 656e 2c20 6e5f 7265 6164  , rd_len, n_read
-00079ba0: 732c 206d 6564 5f66 7261 675f 6c65 6e20  s, med_frag_len 
-00079bb0: 3d20 6461 7461 0a20 2020 2020 2020 2020  = data.         
-00079bc0: 2020 2064 656c 2064 6174 610a 2020 2020     del data.    
-00079bd0: 2020 2020 7072 696e 7428 2720 646f 6e65      print(' done
-00079be0: 2e27 290a 2020 2020 2020 2020 0a20 2020  .').        .   
-00079bf0: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
-00079c00: 6e73 5f6c 7374 5f6d 693a 2072 2e73 6574  ns_lst_mi: r.set
-00079c10: 5f63 7667 2829 0a20 2020 2020 2020 2066  _cvg().        f
-00079c20: 6f72 2072 2069 6e20 7267 6e73 5f6c 7374  or r in rgns_lst
-00079c30: 5f6e 643a 2072 2e73 6574 5f63 7667 2829  _nd: r.set_cvg()
-00079c40: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-00079c50: 6e20 7267 6e73 5f6c 7374 5f73 743a 2072  n rgns_lst_st: r
-00079c60: 2e73 6574 5f63 7667 2829 0a20 2020 2020  .set_cvg().     
-00079c70: 2020 2065 725f 636f 6465 203d 204e 4f5f     er_code = NO_
-00079c80: 4d4f 5245 5f4c 494e 450a 2020 2020 2020  MORE_LINE.      
-00079c90: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00079ca0: 2020 2065 6c61 7073 6564 5f74 696d 6531     elapsed_time1
-00079cb0: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
-00079cc0: 2073 7461 7274 5f74 696d 6531 0a20 2020   start_time1.   
-00079cd0: 2020 2020 2020 2020 200a 2020 2020 6966           .    if
-00079ce0: 2065 725f 636f 6465 2021 3d20 4e4f 5f4d   er_code != NO_M
-00079cf0: 4f52 455f 4c49 4e45 3a0a 2020 2020 2020  ORE_LINE:.      
-00079d00: 2020 7072 696e 7428 2745 5252 4f52 3a20    print('ERROR: 
-00079d10: 696e 7075 7420 616c 6967 6e6d 656e 7473  input alignments
-00079d20: 2077 6572 6520 4e4f 5420 736f 7274 6564   were NOT sorted
-00079d30: 2e27 290a 2020 2020 656c 7365 3a0a 2020  .').    else:.  
-00079d40: 2020 2020 2020 6764 7320 3d20 4e6f 6e65        gds = None
-00079d50: 0a20 2020 2020 2020 2069 6620 6a75 6d70  .        if jump
-00079d60: 203c 2032 3a0a 2020 2020 2020 2020 2020   < 2:.          
-00079d70: 2020 0a20 2020 2020 2020 2020 2020 2076    .            v
-00079d80: 5f74 6820 3d20 7264 5f6c 656e 2a6d 696e  _th = rd_len*min
-00079d90: 5f66 7261 6773 5f70 6572 5f67 656e 650a  _frags_per_gene.
-00079da0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-00079db0: 2067 7466 2069 7320 4e6f 6e65 3a0a 2020   gtf is None:.  
-00079dc0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00079dd0: 7267 6e73 5f6c 7374 5f6d 692c 2072 676e  rgns_lst_mi, rgn
-00079de0: 735f 6c73 745f 6e64 2c20 7267 6e73 5f6c  s_lst_nd, rgns_l
-00079df0: 7374 5f73 7420 3d20 6669 6c74 6572 5f72  st_st = filter_r
-00079e00: 676e 7328 7267 6e73 5f6c 7374 5f6d 692c  gns(rgns_lst_mi,
-00079e10: 2072 676e 735f 6c73 745f 6e64 2c20 7267   rgns_lst_nd, rg
-00079e20: 6e73 5f6c 7374 5f73 742c 2076 5f74 682c  ns_lst_st, v_th,
-00079e30: 2073 5f74 6820 3d20 4d41 585f 5045 5243   s_th = MAX_PERC
-00079e40: 454e 545f 5345 4329 0a0a 2020 2020 2020  ENT_SEC)..      
-00079e50: 2020 2020 2020 6764 735f 756e 6d61 7070        gds_unmapp
-00079e60: 6564 203d 204e 6f6e 650a 2020 2020 2020  ed = None.      
-00079e70: 2020 2020 2020 6966 2067 7466 2069 7320        if gtf is 
-00079e80: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00079e90: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00079ea0: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
-00079eb0: 6e6f 6d65 5f66 696c 6520 6973 204e 6f6e  nome_file is Non
-00079ec0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00079ed0: 2020 2020 2020 2067 656e 6f6d 6520 3d20         genome = 
-00079ee0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00079ef0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00079f00: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00079f10: 656e 6f6d 6520 3d20 6c6f 6164 5f67 656e  enome = load_gen
-00079f20: 6f6d 6528 6765 6e6f 6d65 5f66 696c 652c  ome(genome_file,
-00079f30: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
-00079f40: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00079f50: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
-00079f60: 696c 6528 6774 6620 2b20 272e 6774 7827  ile(gtf + '.gtx'
-00079f70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00079f80: 2020 2020 2020 2070 7269 6e74 2827 4c6f         print('Lo
-00079f90: 6164 696e 6720 4754 4678 202e 2e20 272c  ading GTFx .. ',
-00079fa0: 2065 6e64 203d 2027 2027 2c20 666c 7573   end = ' ', flus
-00079fb0: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
-00079fc0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-00079fd0: 7468 206f 7065 6e28 6774 6620 2b20 272e  th open(gtf + '.
-00079fe0: 6774 7827 2c20 2772 6227 2920 6173 2066  gtx', 'rb') as f
-00079ff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0007a000: 2020 2020 2020 2020 2020 2867 645f 6c73            (gd_ls
-0007a010: 742c 2063 6872 7329 203d 2070 6963 6b6c  t, chrs) = pickl
-0007a020: 652e 6c6f 6164 2820 6620 290a 2020 2020  e.load( f ).    
-0007a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a040: 7072 696e 7428 2764 6f6e 652e 2027 290a  print('done. ').
-0007a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a060: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0007a070: 2020 2020 2020 2020 2020 6774 665f 6c69            gtf_li
-0007a080: 6e65 732c 2068 6472 5f6c 696e 6573 203d  nes, hdr_lines =
-0007a090: 206c 6f61 645f 6774 6628 6774 662c 2076   load_gtf(gtf, v
-0007a0a0: 6572 626f 7365 203d 2054 7275 6529 0a20  erbose = True). 
-0007a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a0c0: 2020 2067 645f 6c73 742c 2063 6872 7320     gd_lst, chrs 
-0007a0d0: 3d20 6765 745f 6765 6e65 5f64 6573 6372  = get_gene_descr
-0007a0e0: 6970 746f 7228 6774 665f 6c69 6e65 732c  iptor(gtf_lines,
-0007a0f0: 2067 656e 6f6d 6520 3d20 6765 6e6f 6d65   genome = genome
-0007a100: 2c20 6669 6c6c 203d 2046 616c 7365 2c20  , fill = False, 
-0007a110: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0007a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a150: 2020 2076 6572 626f 7365 203d 2054 7275     verbose = Tru
-0007a160: 652c 206e 5f63 6f72 6573 203d 206e 5f63  e, n_cores = n_c
-0007a170: 6f72 6573 290a 2020 2020 2020 2020 2020  ores).          
-0007a180: 2020 2020 2020 2020 2020 6465 6c20 6774            del gt
-0007a190: 665f 6c69 6e65 730a 2020 2020 2020 2020  f_lines.        
-0007a1a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0007a1b0: 7428 2753 6176 696e 6720 4754 4678 202e  t('Saving GTFx .
-0007a1c0: 2e20 272c 2065 6e64 203d 2027 2027 2c20  . ', end = ' ', 
-0007a1d0: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-0007a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a1f0: 2020 7769 7468 206f 7065 6e28 6774 6620    with open(gtf 
-0007a200: 2b20 272e 6774 7827 2c20 2777 6227 2920  + '.gtx', 'wb') 
-0007a210: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-0007a220: 2020 2020 2020 2020 2020 2020 2020 7069                pi
-0007a230: 636b 6c65 2e64 756d 7028 2028 6764 5f6c  ckle.dump( (gd_l
-0007a240: 7374 2c20 6368 7273 292c 2066 2029 0a20  st, chrs), f ). 
-0007a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a260: 2020 2070 7269 6e74 2827 646f 6e65 2e20     print('done. 
-0007a270: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-0007a280: 2020 2020 6764 5f6c 7374 5f6f 665f 6c73      gd_lst_of_ls
-0007a290: 742c 2063 6872 5f6c 7374 203d 2070 6163  t, chr_lst = pac
-0007a2a0: 6b5f 6765 6e65 5f64 6573 6372 6970 746f  k_gene_descripto
-0007a2b0: 7228 2067 645f 6c73 742c 2063 6872 7320  r( gd_lst, chrs 
-0007a2c0: 2920 2020 2020 2020 2020 2020 2020 2020  )               
-0007a2d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007a2e0: 2020 2020 2067 6473 2c20 7267 6e73 5f6c       gds, rgns_l
-0007a2f0: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
-0007a300: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
-0007a310: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
-0007a320: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0007a330: 2020 2020 2020 7061 7273 655f 616e 645f        parse_and_
-0007a340: 636f 6d62 696e 655f 6765 6e65 735f 616e  combine_genes_an
-0007a350: 645f 7267 6e73 2867 645f 6c73 745f 6f66  d_rgns(gd_lst_of
-0007a360: 5f6c 7374 2c20 6368 725f 6c73 742c 2072  _lst, chr_lst, r
-0007a370: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
-0007a380: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
-0007a390: 745f 7374 2c20 5c0a 2020 2020 2020 2020  t_st, \.        
-0007a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a3c0: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
-0007a3d0: 6f72 6573 203d 206e 5f63 6f72 6573 2c20  ores = n_cores, 
-0007a3e0: 6765 6e6f 6d65 203d 2067 656e 6f6d 652c  genome = genome,
-0007a3f0: 2076 6572 626f 7365 203d 2054 7275 6520   verbose = True 
-0007a400: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007a410: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
-0007a420: 2020 2020 2020 2020 4e74 7273 203d 2030          Ntrs = 0
-0007a430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a440: 204e 7472 7332 203d 2030 0a20 2020 2020   Ntrs2 = 0.     
-0007a450: 2020 2020 2020 2020 2020 2066 6f72 2067             for g
-0007a460: 6420 696e 2067 6473 3a0a 2020 2020 2020  d in gds:.      
-0007a470: 2020 2020 2020 2020 2020 2020 2020 4e74                Nt
-0007a480: 7273 202b 3d20 6764 2e6e 7472 0a20 2020  rs += gd.ntr.   
-0007a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a4a0: 2066 6f72 2074 6420 696e 2067 642e 7464   for td in gd.td
-0007a4b0: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
-0007a4c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0007a4d0: 206c 656e 2874 642e 7465 5f74 6f5f 6765   len(td.te_to_ge
-0007a4e0: 5f6d 6170 2920 3e20 303a 204e 7472 7332  _map) > 0: Ntrs2
-0007a4f0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0007a500: 2020 2020 2020 7072 696e 7428 274e 7472        print('Ntr
-0007a510: 7320 3d20 2569 2c20 2569 2027 2025 2028  s = %i, %i ' % (
-0007a520: 4e74 7273 2c20 4e74 7273 3229 2029 0a20  Ntrs, Ntrs2) ). 
-0007a530: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0007a540: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
-0007a550: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0007a560: 2020 2020 2020 6764 7320 3d20 4e6f 6e65        gds = None
-0007a570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a580: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
-0007a590: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0007a5a0: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-0007a5b0: 2073 6176 5f72 676e 3a0a 2020 2020 2020   sav_rgn:.      
-0007a5c0: 2020 2020 2020 2020 2020 7361 7665 5f72            save_r
-0007a5d0: 676e 735f 6f62 6a28 666e 616d 6520 2b20  gns_obj(fname + 
-0007a5e0: 275f 7365 6c65 6374 6564 2e72 676e 7327  '_selected.rgns'
-0007a5f0: 2c20 7267 6e73 5f6c 7374 5f6d 692c 2072  , rgns_lst_mi, r
-0007a600: 676e 735f 6c73 745f 6e64 2c20 7267 6e73  gns_lst_nd, rgns
-0007a610: 5f6c 7374 5f73 742c 2072 645f 6c65 6e2c  _lst_st, rd_len,
-0007a620: 206e 5f72 6561 6473 2029 0a20 2020 2020   n_reads ).     
-0007a630: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0007a640: 2020 2020 6966 206e 5f63 6f72 6573 203d      if n_cores =
-0007a650: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0007a660: 2020 2020 2054 725f 6c73 742c 2049 735f       Tr_lst, Is_
-0007a670: 6c73 742c 2047 5446 5f6c 7374 2c20 6d6e  lst, GTF_lst, mn
-0007a680: 5f6c 7374 2c20 6772 705f 6c73 742c 2067  _lst, grp_lst, g
-0007a690: 6473 2c20 6574 732c 2065 7478 203d 205c  ds, ets, etx = \
-0007a6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007a6b0: 2020 2020 2020 2020 2067 6574 5f74 7261           get_tra
-0007a6c0: 6e73 6372 6970 7473 2820 7267 6e73 5f6c  nscripts( rgns_l
-0007a6d0: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
-0007a6e0: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
-0007a6f0: 2072 645f 6c65 6e2c 205c 0a20 2020 2020   rd_len, \.     
-0007a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a720: 2020 2020 6764 732c 206c 656e 5f74 682c      gds, len_th,
-0007a730: 206d 6574 686f 642c 204e 7265 632c 2073   method, Nrec, s
-0007a740: 7461 7274 203d 2053 7461 7274 2c20 7665  tart = Start, ve
-0007a750: 7262 6f73 653d 5472 7565 2029 0a20 2020  rbose=True ).   
-0007a760: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0007a770: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0007a780: 725f 6c73 742c 2049 735f 6c73 742c 2047  r_lst, Is_lst, G
-0007a790: 5446 5f6c 7374 2c20 6d6e 5f6c 7374 2c20  TF_lst, mn_lst, 
-0007a7a0: 6772 705f 6c73 742c 2067 6473 2c20 6574  grp_lst, gds, et
-0007a7b0: 732c 2065 7478 203d 205c 0a20 2020 2020  s, etx = \.     
-0007a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a7d0: 2020 2067 6574 5f74 7261 6e73 6372 6970     get_transcrip
-0007a7e0: 7473 5f6d 6328 2072 676e 735f 6c73 745f  ts_mc( rgns_lst_
-0007a7f0: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 642c  mi, rgns_lst_nd,
-0007a800: 2072 676e 735f 6c73 745f 7374 2c20 7264   rgns_lst_st, rd
-0007a810: 5f6c 656e 2c20 5c0a 2020 2020 2020 2020  _len, \.        
-0007a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a840: 2020 2020 6764 732c 206e 5f63 6f72 6573      gds, n_cores
-0007a850: 2c20 6c65 6e5f 7468 2c20 6d65 7468 6f64  , len_th, method
-0007a860: 2c20 4e72 6563 2c20 7374 6172 7420 3d20  , Nrec, start = 
-0007a870: 5374 6172 742c 2076 6572 626f 7365 3d54  Start, verbose=T
-0007a880: 7275 6520 290a 2020 2020 2020 2020 2020  rue ).          
-0007a890: 2020 0a20 2020 2020 2020 2020 2020 2065    .            e
-0007a8a0: 7473 203d 206e 702e 6172 7261 7928 6574  ts = np.array(et
-0007a8b0: 732c 2064 7479 7065 203d 2069 6e74 290a  s, dtype = int).
-0007a8c0: 2020 2020 2020 2020 2020 2020 6574 7820              etx 
-0007a8d0: 3d20 6e70 2e61 7272 6179 2865 7478 2c20  = np.array(etx, 
-0007a8e0: 6474 7970 6520 3d20 696e 7429 0a20 2020  dtype = int).   
-0007a8f0: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
-0007a900: 2827 456c 6170 6165 6420 7469 6d65 733a  ('Elapaed times:
-0007a910: 2027 2c20 6574 732c 2065 7478 290a 2020   ', ets, etx).  
-0007a920: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
-0007a930: 645f 7469 6d65 3220 3d20 7469 6d65 2e74  d_time2 = time.t
-0007a940: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
-0007a950: 6d65 310a 2020 2020 2020 2020 2020 2020  me1.            
-0007a960: 6e5f 6368 756e 6b73 203d 206c 656e 2872  n_chunks = len(r
-0007a970: 676e 735f 6c73 745f 6d69 290a 0a20 2020  gns_lst_mi)..   
-0007a980: 2020 2020 2020 2020 2064 656c 2072 676e           del rgn
-0007a990: 735f 6c73 745f 6d69 0a20 2020 2020 2020  s_lst_mi.       
-0007a9a0: 2020 2020 2064 656c 2072 676e 735f 6c73       del rgns_ls
-0007a9b0: 745f 6e64 0a20 2020 2020 2020 2020 2020  t_nd.           
-0007a9c0: 2064 656c 2072 676e 735f 6c73 745f 7374   del rgns_lst_st
-0007a9d0: 0a0a 2020 2020 2020 2020 2020 2020 2327  ..            #'
-0007a9e0: 2727 0a20 2020 2020 2020 2020 2020 2069  ''.            i
-0007a9f0: 6620 6774 6620 6973 206e 6f74 204e 6f6e  f gtf is not Non
-0007aa00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0007aa10: 2020 204e 7472 7320 3d20 300a 2020 2020     Ntrs = 0.    
-0007aa20: 2020 2020 2020 2020 2020 2020 4e74 7273              Ntrs
-0007aa30: 3220 3d20 300a 2020 2020 2020 2020 2020  2 = 0.          
-0007aa40: 2020 2020 2020 4e74 7273 3320 3d20 300a        Ntrs3 = 0.
-0007aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007aa60: 666f 7220 6764 2069 6e20 6764 733a 0a20  for gd in gds:. 
+00079360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00079370: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
+00079380: 0a20 2020 2020 2020 2064 656c 2072 5f6c  .        del r_l
+00079390: 7374 5f6f 665f 6c73 740a 2020 2020 2020  st_of_lst.      
+000793a0: 2020 2727 270a 2020 2020 2020 2020 636e    '''.        cn
+000793b0: 745f 6920 3d20 300a 2020 2020 2020 2020  t_i = 0.        
+000793c0: 636e 745f 7320 3d20 300a 2020 2020 2020  cnt_s = 0.      
+000793d0: 2020 636e 745f 7420 3d20 300a 2020 2020    cnt_t = 0.    
+000793e0: 2020 2020 666f 7220 7267 6e73 2069 6e20      for rgns in 
+000793f0: 7267 6e73 5f6c 7374 5f73 743a 200a 2020  rgns_lst_st: .  
+00079400: 2020 2020 2020 2020 2020 666f 7220 7220            for r 
+00079410: 696e 2072 676e 732e 7267 6e73 3a0a 2020  in rgns.rgns:.  
+00079420: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00079430: 2072 2e74 7970 6520 3d3d 2027 4927 3a20   r.type == 'I': 
+00079440: 636e 745f 6920 2b3d 2031 0a20 2020 2020  cnt_i += 1.     
+00079450: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00079460: 722e 7479 7065 203d 3d20 2753 273a 2063  r.type == 'S': c
+00079470: 6e74 5f73 202b 3d20 310a 2020 2020 2020  nt_s += 1.      
+00079480: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
+00079490: 2e74 7970 6520 3d3d 2027 5427 3a20 636e  .type == 'T': cn
+000794a0: 745f 7420 2b3d 2031 0a20 2020 2020 2020  t_t += 1.       
+000794b0: 2070 7269 6e74 2820 2743 6e74 2049 2f53   print( 'Cnt I/S
+000794c0: 2f54 203d 2025 692c 2025 692c 2025 6920  /T = %i, %i, %i 
+000794d0: 2720 2520 2863 6e74 5f69 2c20 636e 745f  ' % (cnt_i, cnt_
+000794e0: 732c 2063 6e74 5f74 2920 290a 2020 2020  s, cnt_t) ).    
+000794f0: 2020 2020 2727 2720 2020 2020 2020 2020      '''         
+00079500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079510: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00079520: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+00079530: 2072 676e 735f 6c73 745f 6d69 3a20 722e   rgns_lst_mi: r.
+00079540: 7365 745f 6376 6728 290a 2020 2020 2020  set_cvg().      
+00079550: 2020 666f 7220 7220 696e 2072 676e 735f    for r in rgns_
+00079560: 6c73 745f 6e64 3a20 722e 7365 745f 6376  lst_nd: r.set_cv
+00079570: 6728 290a 2020 2020 2020 2020 666f 7220  g().        for 
+00079580: 7220 696e 2072 676e 735f 6c73 745f 7374  r in rgns_lst_st
+00079590: 3a20 722e 7365 745f 6376 6728 290a 2020  : r.set_cvg().  
+000795a0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000795b0: 2020 2073 6f2e 636c 6f73 6528 290a 2020     so.close().  
+000795c0: 2020 2020 2020 6e5f 7265 6164 732c 206e        n_reads, n
+000795d0: 5f62 6173 6573 2c20 7264 5f6c 656e 203d  _bases, rd_len =
+000795e0: 2073 6f2e 6e75 6d5f 7265 6164 732c 2073   so.num_reads, s
+000795f0: 6f2e 6e75 6d5f 6261 7365 732c 2073 6f2e  o.num_bases, so.
+00079600: 7265 6164 5f6c 656e 0a20 2020 2020 2020  read_len.       
+00079610: 2072 645f 6c65 6e20 3d20 736f 2e72 6561   rd_len = so.rea
+00079620: 645f 6c65 6e0a 2020 2020 2020 2020 656c  d_len.        el
+00079630: 6170 7365 645f 7469 6d65 3120 3d20 7469  apsed_time1 = ti
+00079640: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+00079650: 745f 7469 6d65 320a 0a20 2020 2020 2020  t_time2..       
+00079660: 2023 2727 270a 2020 2020 2020 2020 6966   #'''.        if
+00079670: 2073 6176 5f72 676e 3a0a 2020 2020 2020   sav_rgn:.      
+00079680: 2020 2020 2020 7072 696e 7428 2753 6176        print('Sav
+00079690: 696e 6720 6c6f 6369 2026 2063 6f6e 7365  ing loci & conse
+000796a0: 6e73 7573 206d 6174 7269 6365 7320 2e2e  nsus matrices ..
+000796b0: 2e2e 2e27 2c20 656e 643d 2727 2c20 666c  ...', end='', fl
+000796c0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+000796d0: 2020 2020 2020 2020 7361 7665 5f72 676e          save_rgn
+000796e0: 735f 6f62 6a28 666e 616d 6520 2b20 272e  s_obj(fname + '.
+000796f0: 7267 6e73 272c 2072 676e 735f 6c73 745f  rgns', rgns_lst_
+00079700: 6d69 2c20 7267 6e73 5f6c 7374 5f6e 642c  mi, rgns_lst_nd,
+00079710: 2072 676e 735f 6c73 745f 7374 2c20 736f   rgns_lst_st, so
+00079720: 2e72 6561 645f 6c65 6e2c 2073 6f2e 6e75  .read_len, so.nu
+00079730: 6d5f 7265 6164 732c 206d 6564 5f66 7261  m_reads, med_fra
+00079740: 675f 6c65 6e20 290a 2020 2020 2020 2020  g_len ).        
+00079750: 2020 2020 7072 696e 7428 2720 646f 6e65      print(' done
+00079760: 2729 0a0a 2020 2020 2020 2020 2320 7072  ')..        # pr
+00079770: 696e 7428 272e 272c 2065 6e64 3d27 2729  int('.', end='')
+00079780: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00079790: 2020 2020 2073 6176 655f 7267 6e73 2820       save_rgns( 
+000797a0: 666e 616d 6520 2b20 275f 7267 6e73 5f6d  fname + '_rgns_m
+000797b0: 695f 2569 2e74 7874 2720 2520 7361 2c20  i_%i.txt' % sa, 
+000797c0: 7267 6e73 5f6c 7374 5f6d 692c 2073 6f2e  rgns_lst_mi, so.
+000797d0: 7265 6164 5f6c 656e 2c20 736f 2e6e 756d  read_len, so.num
+000797e0: 5f72 6561 6473 2029 0a20 2020 2020 2020  _reads ).       
+000797f0: 2070 7269 6e74 2827 2e27 2c20 656e 643d   print('.', end=
+00079800: 2727 290a 2020 2020 2020 2020 2222 220a  '').        """.
+00079810: 2020 2020 2020 2020 2320 7361 7665 5f72          # save_r
+00079820: 676e 7328 2066 6e61 6d65 202b 2027 5f72  gns( fname + '_r
+00079830: 676e 735f 6e64 5f25 692e 7478 7427 2025  gns_nd_%i.txt' %
+00079840: 2073 612c 2072 676e 735f 6c73 745f 6e64   sa, rgns_lst_nd
+00079850: 2c20 736f 2e72 6561 645f 6c65 6e2c 2073  , so.read_len, s
+00079860: 6f2e 6e75 6d5f 7265 6164 7320 290a 2020  o.num_reads ).  
+00079870: 2020 2020 2020 2320 7072 696e 7428 272e        # print('.
+00079880: 272c 2065 6e64 3d27 2729 0a20 2020 2020  ', end='').     
+00079890: 2020 2023 2073 6176 655f 7267 6e73 2820     # save_rgns( 
+000798a0: 666e 616d 6520 2b20 275f 7267 6e73 5f69  fname + '_rgns_i
+000798b0: 5f25 695f 686f 2e74 7874 2720 2520 7361  _%i_ho.txt' % sa
+000798c0: 2c20 7267 6e73 5f6c 7374 5f73 742c 2073  , rgns_lst_st, s
+000798d0: 6f2e 7265 6164 5f6c 656e 2c20 736f 2e6e  o.read_len, so.n
+000798e0: 756d 5f72 6561 6473 2c20 686f 203d 2054  um_reads, ho = T
+000798f0: 7275 6520 290a 2020 2020 2020 2020 2320  rue ).        # 
+00079900: 7072 696e 7428 272e 272c 2065 6e64 3d27  print('.', end='
+00079910: 2729 0a20 2020 2020 2020 200a 2020 2020  ').        .    
+00079920: 2020 2020 2320 7361 7665 5f72 676e 7328      # save_rgns(
+00079930: 2066 6e61 6d65 202b 2027 5f72 676e 735f   fname + '_rgns_
+00079940: 6d5f 2569 5f68 6f2e 7478 7427 2025 2073  m_%i_ho.txt' % s
+00079950: 612c 2072 676e 735f 6c73 745f 6d69 2c20  a, rgns_lst_mi, 
+00079960: 736f 2e72 6561 645f 6c65 6e2c 2073 6f2e  so.read_len, so.
+00079970: 6e75 6d5f 7265 6164 732c 2068 6f20 3d20  num_reads, ho = 
+00079980: 5472 7565 2029 0a20 2020 2020 2020 2023  True ).        #
+00079990: 2070 7269 6e74 2827 2e27 2c20 656e 643d   print('.', end=
+000799a0: 2727 290a 2020 2020 2020 2020 2320 6774  '').        # gt
+000799b0: 665f 6c69 6e65 5f6c 7374 203d 2067 6574  f_line_lst = get
+000799c0: 5f67 7466 5f6c 696e 6573 2820 7267 6e73  _gtf_lines( rgns
+000799d0: 5f6c 7374 5f6d 692c 2072 676e 735f 6c73  _lst_mi, rgns_ls
+000799e0: 745f 6e64 2029 0a20 2020 2020 2020 2023  t_nd ).        #
+000799f0: 2073 6176 655f 6774 6628 2066 6e61 6d65   save_gtf( fname
+00079a00: 2b27 5f72 6567 696f 6e73 2e67 7466 272c  +'_regions.gtf',
+00079a10: 2067 7466 5f6c 696e 655f 6c73 7420 290a   gtf_line_lst ).
+00079a20: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00079a30: 2720 646f 6e65 2729 0a20 2020 2020 2020  ' done').       
+00079a40: 2023 2727 270a 2020 2020 0a20 2020 2065   #'''.    .    e
+00079a50: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
+00079a60: 6e74 2827 5374 7269 6e67 4669 7820 7374  nt('StringFix st
+00079a70: 6172 7465 6420 272c 2064 6174 6574 696d  arted ', datetim
+00079a80: 652e 6461 7465 7469 6d65 2e6e 6f77 2829  e.datetime.now()
+00079a90: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00079aa0: 274c 6f61 6469 6e67 206c 6f63 6920 2620  'Loading loci & 
+00079ab0: 636f 6e73 656e 7375 7320 6d61 7472 6963  consensus matric
+00079ac0: 6573 202e 2e2e 272c 2065 6e64 3d27 2729  es ...', end='')
+00079ad0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00079ae0: 2020 6461 7461 203d 206c 6f61 645f 7267    data = load_rg
+00079af0: 6e73 5f6f 626a 2866 6e61 6d65 202b 2027  ns_obj(fname + '
+00079b00: 2e72 676e 7327 290a 2020 2020 2020 2020  .rgns').        
+00079b10: 6966 206c 656e 2864 6174 6129 203d 3d20  if len(data) == 
+00079b20: 353a 0a20 2020 2020 2020 2020 2020 2072  5:.            r
+00079b30: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
+00079b40: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
+00079b50: 745f 7374 2c20 7264 5f6c 656e 2c20 6e5f  t_st, rd_len, n_
+00079b60: 7265 6164 7320 3d20 6461 7461 0a20 2020  reads = data.   
+00079b70: 2020 2020 2020 2020 206d 6564 5f66 7261           med_fra
+00079b80: 675f 6c65 6e20 3d20 3330 300a 2020 2020  g_len = 300.    
+00079b90: 2020 2020 2020 2020 6465 6c20 6461 7461          del data
+00079ba0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00079bb0: 2020 2020 2020 2020 2020 2072 676e 735f             rgns_
+00079bc0: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
+00079bd0: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
+00079be0: 2c20 7264 5f6c 656e 2c20 6e5f 7265 6164  , rd_len, n_read
+00079bf0: 732c 206d 6564 5f66 7261 675f 6c65 6e20  s, med_frag_len 
+00079c00: 3d20 6461 7461 0a20 2020 2020 2020 2020  = data.         
+00079c10: 2020 2064 656c 2064 6174 610a 2020 2020     del data.    
+00079c20: 2020 2020 7072 696e 7428 2720 646f 6e65      print(' done
+00079c30: 2e27 290a 2020 2020 2020 2020 0a20 2020  .').        .   
+00079c40: 2020 2020 2066 6f72 2072 2069 6e20 7267       for r in rg
+00079c50: 6e73 5f6c 7374 5f6d 693a 2072 2e73 6574  ns_lst_mi: r.set
+00079c60: 5f63 7667 2829 0a20 2020 2020 2020 2066  _cvg().        f
+00079c70: 6f72 2072 2069 6e20 7267 6e73 5f6c 7374  or r in rgns_lst
+00079c80: 5f6e 643a 2072 2e73 6574 5f63 7667 2829  _nd: r.set_cvg()
+00079c90: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
+00079ca0: 6e20 7267 6e73 5f6c 7374 5f73 743a 2072  n rgns_lst_st: r
+00079cb0: 2e73 6574 5f63 7667 2829 0a20 2020 2020  .set_cvg().     
+00079cc0: 2020 2065 725f 636f 6465 203d 204e 4f5f     er_code = NO_
+00079cd0: 4d4f 5245 5f4c 494e 450a 2020 2020 2020  MORE_LINE.      
+00079ce0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00079cf0: 2020 2065 6c61 7073 6564 5f74 696d 6531     elapsed_time1
+00079d00: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+00079d10: 2073 7461 7274 5f74 696d 6531 0a20 2020   start_time1.   
+00079d20: 2020 2020 2020 2020 200a 2020 2020 6966           .    if
+00079d30: 2065 725f 636f 6465 2021 3d20 4e4f 5f4d   er_code != NO_M
+00079d40: 4f52 455f 4c49 4e45 3a0a 2020 2020 2020  ORE_LINE:.      
+00079d50: 2020 7072 696e 7428 2745 5252 4f52 3a20    print('ERROR: 
+00079d60: 696e 7075 7420 616c 6967 6e6d 656e 7473  input alignments
+00079d70: 2077 6572 6520 4e4f 5420 736f 7274 6564   were NOT sorted
+00079d80: 2e27 290a 2020 2020 656c 7365 3a0a 2020  .').    else:.  
+00079d90: 2020 2020 2020 6764 7320 3d20 4e6f 6e65        gds = None
+00079da0: 0a20 2020 2020 2020 2069 6620 6a75 6d70  .        if jump
+00079db0: 203c 2032 3a0a 2020 2020 2020 2020 2020   < 2:.          
+00079dc0: 2020 0a20 2020 2020 2020 2020 2020 2076    .            v
+00079dd0: 5f74 6820 3d20 7264 5f6c 656e 2a6d 696e  _th = rd_len*min
+00079de0: 5f66 7261 6773 5f70 6572 5f67 656e 650a  _frags_per_gene.
+00079df0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+00079e00: 2067 7466 2069 7320 4e6f 6e65 3a0a 2020   gtf is None:.  
+00079e10: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00079e20: 7267 6e73 5f6c 7374 5f6d 692c 2072 676e  rgns_lst_mi, rgn
+00079e30: 735f 6c73 745f 6e64 2c20 7267 6e73 5f6c  s_lst_nd, rgns_l
+00079e40: 7374 5f73 7420 3d20 6669 6c74 6572 5f72  st_st = filter_r
+00079e50: 676e 7328 7267 6e73 5f6c 7374 5f6d 692c  gns(rgns_lst_mi,
+00079e60: 2072 676e 735f 6c73 745f 6e64 2c20 7267   rgns_lst_nd, rg
+00079e70: 6e73 5f6c 7374 5f73 742c 2076 5f74 682c  ns_lst_st, v_th,
+00079e80: 2073 5f74 6820 3d20 4d41 585f 5045 5243   s_th = MAX_PERC
+00079e90: 454e 545f 5345 4329 0a0a 2020 2020 2020  ENT_SEC)..      
+00079ea0: 2020 2020 2020 6764 735f 756e 6d61 7070        gds_unmapp
+00079eb0: 6564 203d 204e 6f6e 650a 2020 2020 2020  ed = None.      
+00079ec0: 2020 2020 2020 6966 2067 7466 2069 7320        if gtf is 
+00079ed0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00079ee0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00079ef0: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
+00079f00: 6e6f 6d65 5f66 696c 6520 6973 204e 6f6e  nome_file is Non
+00079f10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00079f20: 2020 2020 2020 2067 656e 6f6d 6520 3d20         genome = 
+00079f30: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00079f40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00079f50: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00079f60: 656e 6f6d 6520 3d20 6c6f 6164 5f67 656e  enome = load_gen
+00079f70: 6f6d 6528 6765 6e6f 6d65 5f66 696c 652c  ome(genome_file,
+00079f80: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
+00079f90: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00079fa0: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
+00079fb0: 696c 6528 6774 6620 2b20 272e 6774 7827  ile(gtf + '.gtx'
+00079fc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00079fd0: 2020 2020 2020 2070 7269 6e74 2827 4c6f         print('Lo
+00079fe0: 6164 696e 6720 4754 4678 202e 2e20 272c  ading GTFx .. ',
+00079ff0: 2065 6e64 203d 2027 2027 2c20 666c 7573   end = ' ', flus
+0007a000: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
+0007a010: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0007a020: 7468 206f 7065 6e28 6774 6620 2b20 272e  th open(gtf + '.
+0007a030: 6774 7827 2c20 2772 6227 2920 6173 2066  gtx', 'rb') as f
+0007a040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007a050: 2020 2020 2020 2020 2020 2867 645f 6c73            (gd_ls
+0007a060: 742c 2063 6872 7329 203d 2070 6963 6b6c  t, chrs) = pickl
+0007a070: 652e 6c6f 6164 2820 6620 290a 2020 2020  e.load( f ).    
+0007a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a090: 7072 696e 7428 2764 6f6e 652e 2027 290a  print('done. ').
+0007a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a0b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0007a0c0: 2020 2020 2020 2020 2020 6774 665f 6c69            gtf_li
+0007a0d0: 6e65 732c 2068 6472 5f6c 696e 6573 203d  nes, hdr_lines =
+0007a0e0: 206c 6f61 645f 6774 6628 6774 662c 2076   load_gtf(gtf, v
+0007a0f0: 6572 626f 7365 203d 2054 7275 6529 0a20  erbose = True). 
+0007a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a110: 2020 2067 645f 6c73 742c 2063 6872 7320     gd_lst, chrs 
+0007a120: 3d20 6765 745f 6765 6e65 5f64 6573 6372  = get_gene_descr
+0007a130: 6970 746f 7228 6774 665f 6c69 6e65 732c  iptor(gtf_lines,
+0007a140: 2067 656e 6f6d 6520 3d20 6765 6e6f 6d65   genome = genome
+0007a150: 2c20 6669 6c6c 203d 2046 616c 7365 2c20  , fill = False, 
+0007a160: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0007a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a1a0: 2020 2076 6572 626f 7365 203d 2054 7275     verbose = Tru
+0007a1b0: 652c 206e 5f63 6f72 6573 203d 206e 5f63  e, n_cores = n_c
+0007a1c0: 6f72 6573 290a 2020 2020 2020 2020 2020  ores).          
+0007a1d0: 2020 2020 2020 2020 2020 6465 6c20 6774            del gt
+0007a1e0: 665f 6c69 6e65 730a 2020 2020 2020 2020  f_lines.        
+0007a1f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0007a200: 7428 2753 6176 696e 6720 4754 4678 202e  t('Saving GTFx .
+0007a210: 2e20 272c 2065 6e64 203d 2027 2027 2c20  . ', end = ' ', 
+0007a220: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
+0007a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a240: 2020 7769 7468 206f 7065 6e28 6774 6620    with open(gtf 
+0007a250: 2b20 272e 6774 7827 2c20 2777 6227 2920  + '.gtx', 'wb') 
+0007a260: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0007a270: 2020 2020 2020 2020 2020 2020 2020 7069                pi
+0007a280: 636b 6c65 2e64 756d 7028 2028 6764 5f6c  ckle.dump( (gd_l
+0007a290: 7374 2c20 6368 7273 292c 2066 2029 0a20  st, chrs), f ). 
+0007a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a2b0: 2020 2070 7269 6e74 2827 646f 6e65 2e20     print('done. 
+0007a2c0: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+0007a2d0: 2020 2020 6764 5f6c 7374 5f6f 665f 6c73      gd_lst_of_ls
+0007a2e0: 742c 2063 6872 5f6c 7374 203d 2070 6163  t, chr_lst = pac
+0007a2f0: 6b5f 6765 6e65 5f64 6573 6372 6970 746f  k_gene_descripto
+0007a300: 7228 2067 645f 6c73 742c 2063 6872 7320  r( gd_lst, chrs 
+0007a310: 2920 2020 2020 2020 2020 2020 2020 2020  )               
+0007a320: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007a330: 2020 2020 2067 6473 2c20 7267 6e73 5f6c       gds, rgns_l
+0007a340: 7374 5f6d 692c 2072 676e 735f 6c73 745f  st_mi, rgns_lst_
+0007a350: 6e64 2c20 7267 6e73 5f6c 7374 5f73 742c  nd, rgns_lst_st,
+0007a360: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
+0007a370: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0007a380: 2020 2020 2020 7061 7273 655f 616e 645f        parse_and_
+0007a390: 636f 6d62 696e 655f 6765 6e65 735f 616e  combine_genes_an
+0007a3a0: 645f 7267 6e73 2867 645f 6c73 745f 6f66  d_rgns(gd_lst_of
+0007a3b0: 5f6c 7374 2c20 6368 725f 6c73 742c 2072  _lst, chr_lst, r
+0007a3c0: 676e 735f 6c73 745f 6d69 2c20 7267 6e73  gns_lst_mi, rgns
+0007a3d0: 5f6c 7374 5f6e 642c 2072 676e 735f 6c73  _lst_nd, rgns_ls
+0007a3e0: 745f 7374 2c20 5c0a 2020 2020 2020 2020  t_st, \.        
+0007a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a410: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
+0007a420: 6f72 6573 203d 206e 5f63 6f72 6573 2c20  ores = n_cores, 
+0007a430: 6765 6e6f 6d65 203d 2067 656e 6f6d 652c  genome = genome,
+0007a440: 2076 6572 626f 7365 203d 2054 7275 6520   verbose = True 
+0007a450: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0007a460: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
+0007a470: 2020 2020 2020 2020 4e74 7273 203d 2030          Ntrs = 0
+0007a480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a490: 204e 7472 7332 203d 2030 0a20 2020 2020   Ntrs2 = 0.     
+0007a4a0: 2020 2020 2020 2020 2020 2066 6f72 2067             for g
+0007a4b0: 6420 696e 2067 6473 3a0a 2020 2020 2020  d in gds:.      
+0007a4c0: 2020 2020 2020 2020 2020 2020 2020 4e74                Nt
+0007a4d0: 7273 202b 3d20 6764 2e6e 7472 0a20 2020  rs += gd.ntr.   
+0007a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a4f0: 2066 6f72 2074 6420 696e 2067 642e 7464   for td in gd.td
+0007a500: 5f6c 7374 3a0a 2020 2020 2020 2020 2020  _lst:.          
+0007a510: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0007a520: 206c 656e 2874 642e 7465 5f74 6f5f 6765   len(td.te_to_ge
+0007a530: 5f6d 6170 2920 3e20 303a 204e 7472 7332  _map) > 0: Ntrs2
+0007a540: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0007a550: 2020 2020 2020 7072 696e 7428 274e 7472        print('Ntr
+0007a560: 7320 3d20 2569 2c20 2569 2027 2025 2028  s = %i, %i ' % (
+0007a570: 4e74 7273 2c20 4e74 7273 3229 2029 0a20  Ntrs, Ntrs2) ). 
+0007a580: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0007a590: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+0007a5a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0007a5b0: 2020 2020 2020 6764 7320 3d20 4e6f 6e65        gds = None
+0007a5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007a5d0: 2067 6473 5f75 6e6d 6170 7065 6420 3d20   gds_unmapped = 
+0007a5e0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0007a5f0: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
+0007a600: 6966 2073 6176 5f72 676e 3a0a 2020 2020  if sav_rgn:.    
+0007a610: 2020 2020 2020 2020 2320 2020 2020 7361          #     sa
+0007a620: 7665 5f72 676e 735f 6f62 6a28 666e 616d  ve_rgns_obj(fnam
+0007a630: 6520 2b20 275f 7365 6c65 6374 6564 2e72  e + '_selected.r
+0007a640: 676e 7327 2c20 7267 6e73 5f6c 7374 5f6d  gns', rgns_lst_m
+0007a650: 692c 2072 676e 735f 6c73 745f 6e64 2c20  i, rgns_lst_nd, 
+0007a660: 7267 6e73 5f6c 7374 5f73 742c 2072 645f  rgns_lst_st, rd_
+0007a670: 6c65 6e2c 206e 5f72 6561 6473 2029 0a20  len, n_reads ). 
+0007a680: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0007a690: 2020 2020 2020 2020 6966 206e 5f63 6f72          if n_cor
+0007a6a0: 6573 203d 3d20 313a 0a20 2020 2020 2020  es == 1:.       
+0007a6b0: 2020 2020 2020 2020 2054 725f 6c73 742c           Tr_lst,
+0007a6c0: 2049 735f 6c73 742c 2047 5446 5f6c 7374   Is_lst, GTF_lst
+0007a6d0: 2c20 6d6e 5f6c 7374 2c20 6772 705f 6c73  , mn_lst, grp_ls
+0007a6e0: 742c 2067 6473 2c20 6574 732c 2065 7478  t, gds, ets, etx
+0007a6f0: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
+0007a700: 2020 2020 2020 2020 2020 2020 2067 6574               get
+0007a710: 5f74 7261 6e73 6372 6970 7473 2820 7267  _transcripts( rg
+0007a720: 6e73 5f6c 7374 5f6d 692c 2072 676e 735f  ns_lst_mi, rgns_
+0007a730: 6c73 745f 6e64 2c20 7267 6e73 5f6c 7374  lst_nd, rgns_lst
+0007a740: 5f73 742c 2072 645f 6c65 6e2c 205c 0a20  _st, rd_len, \. 
+0007a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a770: 2020 2020 2020 2020 6764 732c 206c 656e          gds, len
+0007a780: 5f74 682c 206d 6574 686f 642c 204e 7265  _th, method, Nre
+0007a790: 632c 2073 7461 7274 203d 2053 7461 7274  c, start = Start
+0007a7a0: 2c20 7665 7262 6f73 653d 5472 7565 2029  , verbose=True )
+0007a7b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0007a7c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0007a7d0: 2020 2054 725f 6c73 742c 2049 735f 6c73     Tr_lst, Is_ls
+0007a7e0: 742c 2047 5446 5f6c 7374 2c20 6d6e 5f6c  t, GTF_lst, mn_l
+0007a7f0: 7374 2c20 6772 705f 6c73 742c 2067 6473  st, grp_lst, gds
+0007a800: 2c20 6574 732c 2065 7478 203d 205c 0a20  , ets, etx = \. 
+0007a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a820: 2020 2020 2020 2067 6574 5f74 7261 6e73         get_trans
+0007a830: 6372 6970 7473 5f6d 6328 2072 676e 735f  cripts_mc( rgns_
+0007a840: 6c73 745f 6d69 2c20 7267 6e73 5f6c 7374  lst_mi, rgns_lst
+0007a850: 5f6e 642c 2072 676e 735f 6c73 745f 7374  _nd, rgns_lst_st
+0007a860: 2c20 7264 5f6c 656e 2c20 5c0a 2020 2020  , rd_len, \.    
+0007a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a890: 2020 2020 2020 2020 6764 732c 206e 5f63          gds, n_c
+0007a8a0: 6f72 6573 2c20 6c65 6e5f 7468 2c20 6d65  ores, len_th, me
+0007a8b0: 7468 6f64 2c20 4e72 6563 2c20 7374 6172  thod, Nrec, star
+0007a8c0: 7420 3d20 5374 6172 742c 2076 6572 626f  t = Start, verbo
+0007a8d0: 7365 3d54 7275 6520 290a 2020 2020 2020  se=True ).      
+0007a8e0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0007a8f0: 2020 2065 7473 203d 206e 702e 6172 7261     ets = np.arra
+0007a900: 7928 6574 732c 2064 7479 7065 203d 2069  y(ets, dtype = i
+0007a910: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+0007a920: 6574 7820 3d20 6e70 2e61 7272 6179 2865  etx = np.array(e
+0007a930: 7478 2c20 6474 7970 6520 3d20 696e 7429  tx, dtype = int)
+0007a940: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
+0007a950: 7269 6e74 2827 456c 6170 6165 6420 7469  rint('Elapaed ti
+0007a960: 6d65 733a 2027 2c20 6574 732c 2065 7478  mes: ', ets, etx
+0007a970: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0007a980: 6170 7365 645f 7469 6d65 3220 3d20 7469  apsed_time2 = ti
+0007a990: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+0007a9a0: 745f 7469 6d65 310a 2020 2020 2020 2020  t_time1.        
+0007a9b0: 2020 2020 6e5f 6368 756e 6b73 203d 206c      n_chunks = l
+0007a9c0: 656e 2872 676e 735f 6c73 745f 6d69 290a  en(rgns_lst_mi).
+0007a9d0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+0007a9e0: 2072 676e 735f 6c73 745f 6d69 0a20 2020   rgns_lst_mi.   
+0007a9f0: 2020 2020 2020 2020 2064 656c 2072 676e           del rgn
+0007aa00: 735f 6c73 745f 6e64 0a20 2020 2020 2020  s_lst_nd.       
+0007aa10: 2020 2020 2064 656c 2072 676e 735f 6c73       del rgns_ls
+0007aa20: 745f 7374 0a0a 2020 2020 2020 2020 2020  t_st..          
+0007aa30: 2020 2327 2727 0a20 2020 2020 2020 2020    #'''.         
+0007aa40: 2020 2069 6620 6774 6620 6973 206e 6f74     if gtf is not
+0007aa50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0007aa60: 2020 2020 2020 204e 7472 7320 3d20 300a         Ntrs = 0.
 0007aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007aa80: 2020 204e 7472 7320 2b3d 2067 642e 6e74     Ntrs += gd.nt
-0007aa90: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0007aaa0: 2020 2020 2020 666f 7220 7464 2069 6e20        for td in 
-0007aab0: 6764 2e74 645f 6c73 743a 0a20 2020 2020  gd.td_lst:.     
-0007aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007aad0: 2020 2069 6620 6c65 6e28 7464 2e74 655f     if len(td.te_
-0007aae0: 746f 5f67 655f 6d61 7029 203e 2030 3a20  to_ge_map) > 0: 
-0007aaf0: 4e74 7273 3220 2b3d 2031 0a20 2020 2020  Ntrs2 += 1.     
-0007ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ab10: 2020 2069 6620 6c65 6e28 7464 2e74 725f     if len(td.tr_
-0007ab20: 746f 5f67 725f 6d61 7029 203e 2030 3a20  to_gr_map) > 0: 
-0007ab30: 4e74 7273 3320 2b3d 2031 0a0a 2020 2020  Ntrs3 += 1..    
-0007ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ab50: 6e5f 6e65 6720 3d20 300a 2020 2020 2020  n_neg = 0.      
-0007ab60: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0007ab70: 7220 7464 2069 6e20 6764 2e74 645f 6c73  r td in gd.td_ls
-0007ab80: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0007ab90: 2020 2020 2020 2020 2020 2069 6620 7464             if td
-0007aba0: 2e61 626e 203c 2030 3a20 6e5f 6e65 6720  .abn < 0: n_neg 
-0007abb0: 2b3d 2031 0a0a 2020 2020 2020 2020 2020  += 1..          
-0007abc0: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-0007abd0: 2569 2c20 2569 2c20 2569 2028 2569 2920  %i, %i, %i (%i) 
-0007abe0: 7472 7320 6672 6f6d 2025 6920 6368 756e  trs from %i chun
-0007abf0: 636b 732f 6765 6e65 7320 2825 6929 2720  cks/genes (%i)' 
-0007ac00: 2520 284e 7472 732c 204e 7472 7332 2c20  % (Ntrs, Ntrs2, 
-0007ac10: 4e74 7273 332c 206e 5f6e 6567 2c20 6e5f  Ntrs3, n_neg, n_
-0007ac20: 6368 756e 6b73 2c20 696e 7428 656c 6170  chunks, int(elap
-0007ac30: 7365 645f 7469 6d65 3229 2920 290a 0a20  sed_time2)) ).. 
-0007ac40: 2020 2020 2020 2020 2020 2023 2066 6e61             # fna
-0007ac50: 6d65 203d 2066 6e61 6d65 202b 2027 5f73  me = fname + '_s
-0007ac60: 6125 6927 2025 2073 610a 2020 2020 2020  a%i' % sa.      
-0007ac70: 2020 2020 2020 666e 616d 655f 7472 203d        fname_tr =
-0007ac80: 2066 6e61 6d65 202b 2027 5f74 7261 6e73   fname + '_trans
-0007ac90: 6372 6970 746f 6d65 2e66 6127 0a20 2020  criptome.fa'.   
-0007aca0: 2020 2020 2020 2020 2066 6e61 6d65 5f70           fname_p
-0007acb0: 7220 3d20 666e 616d 6520 2b20 275f 7072  r = fname + '_pr
-0007acc0: 6f74 656f 6d65 2e66 6127 0a20 2020 2020  oteome.fa'.     
-0007acd0: 2020 2020 2020 2066 6e61 6d65 5f67 6666         fname_gff
-0007ace0: 203d 2066 6e61 6d65 202b 2027 2e67 6666   = fname + '.gff
-0007acf0: 270a 2020 2020 2020 2020 2020 2020 666e  '.            fn
-0007ad00: 616d 655f 6578 7020 3d20 666e 616d 6520  ame_exp = fname 
-0007ad10: 2b20 275f 6578 705f 7072 6f66 696c 652e  + '_exp_profile.
-0007ad20: 7473 7627 0a20 2020 2020 2020 2020 2020  tsv'.           
-0007ad30: 2066 6e61 6d65 5f73 6e76 203d 2066 6e61   fname_snv = fna
-0007ad40: 6d65 202b 2027 5f73 6e76 5f73 756d 6d61  me + '_snv_summa
-0007ad50: 7279 2e74 7376 270a 0a20 2020 2020 2020  ry.tsv'..       
-0007ad60: 2020 2020 2069 6620 6764 7320 6973 206e       if gds is n
-0007ad70: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0007ad80: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007ad90: 2020 2020 2020 2020 2020 745f 6162 6e20            t_abn 
-0007ada0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0007adb0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
-0007adc0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0007add0: 2020 2020 2020 2067 642e 7365 745f 636f         gd.set_co
-0007ade0: 765f 6e5f 6162 6e5f 7468 2820 4d49 4e5f  v_n_abn_th( MIN_
-0007adf0: 434f 565f 544f 5f53 454c 2c20 4d49 4e5f  COV_TO_SEL, MIN_
-0007ae00: 4142 4e5f 544f 5f53 454c 2029 0a20 2020  ABN_TO_SEL ).   
-0007ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ae20: 206e 7472 2c20 6e70 722c 206e 6520 3d20   ntr, npr, ne = 
-0007ae30: 6764 2e75 7064 6174 655f 7464 5f69 6e66  gd.update_td_inf
-0007ae40: 6f28 290a 2020 2020 2020 2020 2020 2020  o().            
-0007ae50: 2020 2020 2020 2020 745f 6162 6e20 2b3d          t_abn +=
-0007ae60: 2067 642e 6765 745f 746f 7461 6c5f 6162   gd.get_total_ab
-0007ae70: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
-0007ae80: 2020 2020 6966 2074 5f61 626e 203d 3d20      if t_abn == 
-0007ae90: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0007aea0: 2020 2020 2020 2074 5f61 626e 203d 2031         t_abn = 1
-0007aeb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007aec0: 2020 2020 2070 7269 6e74 2827 546f 7461       print('Tota
-0007aed0: 6c20 766f 6c75 6d65 203d 2025 6927 2025  l volume = %i' %
-0007aee0: 2074 5f61 626e 290a 2020 2020 2020 2020   t_abn).        
-0007aef0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007af00: 2020 2020 2020 2020 2020 2020 206e 6620               nf 
-0007af10: 3d20 3130 3030 3030 302f 745f 6162 6e0a  = 1000000/t_abn.
-0007af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007af30: 666f 7220 6764 2069 6e20 6764 733a 0a20  for gd in gds:. 
+0007aa80: 4e74 7273 3220 3d20 300a 2020 2020 2020  Ntrs2 = 0.      
+0007aa90: 2020 2020 2020 2020 2020 4e74 7273 3320            Ntrs3 
+0007aaa0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0007aab0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
+0007aac0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0007aad0: 2020 2020 2020 204e 7472 7320 2b3d 2067         Ntrs += g
+0007aae0: 642e 6e74 720a 2020 2020 2020 2020 2020  d.ntr.          
+0007aaf0: 2020 2020 2020 2020 2020 666f 7220 7464            for td
+0007ab00: 2069 6e20 6764 2e74 645f 6c73 743a 0a20   in gd.td_lst:. 
+0007ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ab20: 2020 2020 2020 2069 6620 6c65 6e28 7464         if len(td
+0007ab30: 2e74 655f 746f 5f67 655f 6d61 7029 203e  .te_to_ge_map) >
+0007ab40: 2030 3a20 4e74 7273 3220 2b3d 2031 0a20   0: Ntrs2 += 1. 
+0007ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ab60: 2020 2020 2020 2069 6620 6c65 6e28 7464         if len(td
+0007ab70: 2e74 725f 746f 5f67 725f 6d61 7029 203e  .tr_to_gr_map) >
+0007ab80: 2030 3a20 4e74 7273 3320 2b3d 2031 0a0a   0: Ntrs3 += 1..
+0007ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007aba0: 2020 2020 6e5f 6e65 6720 3d20 300a 2020      n_neg = 0.  
+0007abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007abc0: 2020 666f 7220 7464 2069 6e20 6764 2e74    for td in gd.t
+0007abd0: 645f 6c73 743a 0a20 2020 2020 2020 2020  d_lst:.         
+0007abe0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0007abf0: 6620 7464 2e61 626e 203c 2030 3a20 6e5f  f td.abn < 0: n_
+0007ac00: 6e65 6720 2b3d 2031 0a0a 2020 2020 2020  neg += 1..      
+0007ac10: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0007ac20: 2720 2020 2569 2c20 2569 2c20 2569 2028  '   %i, %i, %i (
+0007ac30: 2569 2920 7472 7320 6672 6f6d 2025 6920  %i) trs from %i 
+0007ac40: 6368 756e 636b 732f 6765 6e65 7320 2825  chuncks/genes (%
+0007ac50: 6929 2720 2520 284e 7472 732c 204e 7472  i)' % (Ntrs, Ntr
+0007ac60: 7332 2c20 4e74 7273 332c 206e 5f6e 6567  s2, Ntrs3, n_neg
+0007ac70: 2c20 6e5f 6368 756e 6b73 2c20 696e 7428  , n_chunks, int(
+0007ac80: 656c 6170 7365 645f 7469 6d65 3229 2920  elapsed_time2)) 
+0007ac90: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0007aca0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
+0007acb0: 2027 5f73 6125 6927 2025 2073 610a 2020   '_sa%i' % sa.  
+0007acc0: 2020 2020 2020 2020 2020 666e 616d 655f            fname_
+0007acd0: 7472 203d 2066 6e61 6d65 202b 2027 5f74  tr = fname + '_t
+0007ace0: 7261 6e73 6372 6970 746f 6d65 2e66 6127  ranscriptome.fa'
+0007acf0: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
+0007ad00: 6d65 5f70 7220 3d20 666e 616d 6520 2b20  me_pr = fname + 
+0007ad10: 275f 7072 6f74 656f 6d65 2e66 6127 0a20  '_proteome.fa'. 
+0007ad20: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
+0007ad30: 5f67 6666 203d 2066 6e61 6d65 202b 2027  _gff = fname + '
+0007ad40: 2e67 6666 270a 2020 2020 2020 2020 2020  .gff'.          
+0007ad50: 2020 666e 616d 655f 6578 7020 3d20 666e    fname_exp = fn
+0007ad60: 616d 6520 2b20 275f 6578 705f 7072 6f66  ame + '_exp_prof
+0007ad70: 696c 652e 7473 7627 0a20 2020 2020 2020  ile.tsv'.       
+0007ad80: 2020 2020 2066 6e61 6d65 5f73 6e76 203d       fname_snv =
+0007ad90: 2066 6e61 6d65 202b 2027 5f73 6e76 5f73   fname + '_snv_s
+0007ada0: 756d 6d61 7279 2e74 7376 270a 0a20 2020  ummary.tsv'..   
+0007adb0: 2020 2020 2020 2020 2069 6620 6764 7320           if gds 
+0007adc0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0007add0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0007ade0: 2020 2020 2020 2020 2020 2020 2020 745f                t_
+0007adf0: 6162 6e20 3d20 300a 2020 2020 2020 2020  abn = 0.        
+0007ae00: 2020 2020 2020 2020 666f 7220 6764 2069          for gd i
+0007ae10: 6e20 6764 733a 0a20 2020 2020 2020 2020  n gds:.         
+0007ae20: 2020 2020 2020 2020 2020 2067 642e 7365             gd.se
+0007ae30: 745f 636f 765f 6e5f 6162 6e5f 7468 2820  t_cov_n_abn_th( 
+0007ae40: 4d49 4e5f 434f 565f 544f 5f53 454c 2c20  MIN_COV_TO_SEL, 
+0007ae50: 4d49 4e5f 4142 4e5f 544f 5f53 454c 2029  MIN_ABN_TO_SEL )
+0007ae60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007ae70: 2020 2020 206e 7472 2c20 6e70 722c 206e       ntr, npr, n
+0007ae80: 6520 3d20 6764 2e75 7064 6174 655f 7464  e = gd.update_td
+0007ae90: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
+0007aea0: 2020 2020 2020 2020 2020 2020 745f 6162              t_ab
+0007aeb0: 6e20 2b3d 2067 642e 6765 745f 746f 7461  n += gd.get_tota
+0007aec0: 6c5f 6162 6e28 290a 2020 2020 2020 2020  l_abn().        
+0007aed0: 2020 2020 2020 2020 6966 2074 5f61 626e          if t_abn
+0007aee0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0007aef0: 2020 2020 2020 2020 2020 2074 5f61 626e             t_abn
+0007af00: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
+0007af10: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0007af20: 546f 7461 6c20 766f 6c75 6d65 203d 2025  Total volume = %
+0007af30: 6927 2025 2074 5f61 626e 290a 2020 2020  i' % t_abn).    
 0007af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007af50: 2020 2067 642e 7365 745f 7472 5f69 6e66     gd.set_tr_inf
-0007af60: 6f28 206e 6620 290a 0a20 2020 2020 2020  o( nf )..       
-0007af70: 2020 2020 2020 2020 2069 6620 6764 735f           if gds_
-0007af80: 756e 6d61 7070 6564 2069 7320 6e6f 7420  unmapped is not 
-0007af90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0007afa0: 2020 2020 2020 2020 2020 6966 2028 4d49            if (MI
-0007afb0: 4e5f 434f 565f 544f 5f53 454c 203d 3d20  N_COV_TO_SEL == 
-0007afc0: 3029 2026 2028 6c65 6e28 6764 735f 756e  0) & (len(gds_un
-0007afd0: 6d61 7070 6564 2920 3e20 3029 3a20 0a20  mapped) > 0): . 
-0007afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007aff0: 2020 2020 2020 206e 7472 203d 2030 0a20         ntr = 0. 
-0007b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b010: 2020 2020 2020 2066 6f72 2067 6420 696e         for gd in
-0007b020: 2067 6473 5f75 6e6d 6170 7065 643a 0a20   gds_unmapped:. 
-0007b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b040: 2020 2020 2020 2020 2020 206e 7472 202b             ntr +
-0007b050: 3d20 6764 2e6e 7472 0a20 2020 2020 2020  = gd.ntr.       
-0007b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b070: 2020 2020 2067 642e 7365 745f 636f 765f       gd.set_cov_
-0007b080: 6e5f 6162 6e5f 7468 2820 4d49 4e5f 434f  n_abn_th( MIN_CO
-0007b090: 565f 544f 5f53 454c 2c20 4d49 4e5f 4142  V_TO_SEL, MIN_AB
-0007b0a0: 4e5f 544f 5f53 454c 2029 0a20 2020 2020  N_TO_SEL ).     
+0007af50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007af60: 206e 6620 3d20 3130 3030 3030 302f 745f   nf = 1000000/t_
+0007af70: 6162 6e0a 2020 2020 2020 2020 2020 2020  abn.            
+0007af80: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
+0007af90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0007afa0: 2020 2020 2020 2067 642e 7365 745f 7472         gd.set_tr
+0007afb0: 5f69 6e66 6f28 206e 6620 290a 0a20 2020  _info( nf )..   
+0007afc0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007afd0: 6764 735f 756e 6d61 7070 6564 2069 7320  gds_unmapped is 
+0007afe0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0007aff0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0007b000: 2028 4d49 4e5f 434f 565f 544f 5f53 454c   (MIN_COV_TO_SEL
+0007b010: 203d 3d20 3029 2026 2028 6c65 6e28 6764   == 0) & (len(gd
+0007b020: 735f 756e 6d61 7070 6564 2920 3e20 3029  s_unmapped) > 0)
+0007b030: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0007b040: 2020 2020 2020 2020 2020 206e 7472 203d             ntr =
+0007b050: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+0007b060: 2020 2020 2020 2020 2020 2066 6f72 2067             for g
+0007b070: 6420 696e 2067 6473 5f75 6e6d 6170 7065  d in gds_unmappe
+0007b080: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+0007b090: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0007b0a0: 7472 202b 3d20 6764 2e6e 7472 0a20 2020  tr += gd.ntr.   
 0007b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b0c0: 2020 2020 2020 2067 642e 7570 6461 7465         gd.update
-0007b0d0: 5f74 645f 696e 666f 2829 0a20 2020 2020  _td_info().     
-0007b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b0f0: 2020 2067 6473 203d 2067 6473 202b 2067     gds = gds + g
-0007b100: 6473 5f75 6e6d 6170 7065 640a 2020 2020  ds_unmapped.    
-0007b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b120: 2020 2020 7072 696e 7428 2720 2020 2569      print('   %i
-0007b130: 2c25 6920 756e 6d61 7070 6564 2067 656e  ,%i unmapped gen
-0007b140: 6573 2f74 7273 2077 6572 6520 6164 6465  es/trs were adde
-0007b150: 642e 2720 2520 286c 656e 2867 6473 5f75  d.' % (len(gds_u
-0007b160: 6e6d 6170 7065 6429 2c20 6e74 7229 2029  nmapped), ntr) )
-0007b170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007b180: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0007b190: 2020 2020 2020 6764 7320 3d20 736f 7274        gds = sort
-0007b1a0: 5f64 6573 6372 6970 746f 725f 6c73 7428  _descriptor_lst(
-0007b1b0: 6764 7329 0a0a 2020 2020 2020 2020 2020  gds)..          
-0007b1c0: 2020 2020 2020 2327 2727 0a20 2020 2020        #'''.     
-0007b1d0: 2020 2020 2020 2020 2020 2073 7461 7274             start
-0007b1e0: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
-0007b1f0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0007b200: 2020 2020 7072 696e 7428 2747 656e 6572      print('Gener
-0007b210: 6174 696e 6720 696e 7465 726d 6564 6961  ating intermedia
-0007b220: 7465 2047 4646 2061 6e64 2054 7261 6e73  te GFF and Trans
-0007b230: 6372 6970 746f 6d65 202e 2e20 272c 2065  criptome .. ', e
-0007b240: 6e64 3d27 2020 2020 2729 0a20 2020 2020  nd='    ').     
-0007b250: 2020 2020 2020 2020 2020 2067 7466 5f6c             gtf_l
-0007b260: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
-0007b270: 2020 2020 2020 2020 2020 6661 7374 615f            fasta_
-0007b280: 6c69 6e65 7320 3d20 5b5d 0a20 2020 2020  lines = [].     
-0007b290: 2020 2020 2020 2020 2020 2066 6173 7461             fasta
-0007b2a0: 5f6c 696e 6573 3220 3d20 5b5d 0a20 2020  _lines2 = [].   
-0007b2b0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
-0007b2c0: 5f6e 6f6e 6520 3d20 300a 0a20 2020 2020  _none = 0..     
-0007b2d0: 2020 2020 2020 2020 2020 2068 6472 5f6c             hdr_l
-0007b2e0: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
-0007b2f0: 2020 2020 2020 2020 2020 6864 725f 6c69            hdr_li
-0007b300: 6e65 732e 6170 7065 6e64 2827 5374 7269  nes.append('Stri
-0007b310: 6e67 4669 7820 7665 7273 696f 6e20 2573  ngFix version %s
-0007b320: 2720 2520 5374 7269 6e67 4669 785f 7665  ' % StringFix_ve
-0007b330: 7273 696f 6e20 290a 2020 2020 2020 2020  rsion ).        
-0007b340: 2020 2020 2020 2020 6864 725f 6c69 6e65          hdr_line
-0007b350: 732e 6170 7065 6e64 2827 496e 7075 7420  s.append('Input 
-0007b360: 5341 4d2f 4241 4d3a 2025 7327 2025 2073  SAM/BAM: %s' % s
-0007b370: 616d 5f66 696c 6529 0a20 2020 2020 2020  am_file).       
-0007b380: 2020 2020 2020 2020 2069 6620 6774 6620           if gtf 
-0007b390: 6973 206e 6f74 204e 6f6e 653a 2068 6472  is not None: hdr
-0007b3a0: 5f6c 696e 6573 2e61 7070 656e 6428 2752  _lines.append('R
-0007b3b0: 6566 2e20 4754 462f 4746 463a 2025 7327  ef. GTF/GFF: %s'
-0007b3c0: 2025 2067 7466 290a 2020 2020 2020 2020   % gtf).        
-0007b3d0: 2020 2020 2020 2020 6864 725f 6c69 6e65          hdr_line
-0007b3e0: 732e 6170 7065 6e64 2827 5265 6164 206c  s.append('Read l
-0007b3f0: 656e 6774 683a 2025 6927 2025 2072 645f  ength: %i' % rd_
-0007b400: 6c65 6e29 0a20 2020 2020 2020 2020 2020  len).           
-0007b410: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0007b420: 2020 2020 2020 665f 6774 6620 3d20 7361        f_gtf = sa
-0007b430: 7665 5f67 7466 3228 666e 616d 655f 6766  ve_gtf2(fname_gf
-0007b440: 662c 2067 7466 5f6c 696e 655f 6c73 7420  f, gtf_line_lst 
-0007b450: 3d20 4e6f 6e65 2c20 6864 7220 3d20 6864  = None, hdr = hd
-0007b460: 725f 6c69 6e65 7329 0a20 2020 2020 2020  r_lines).       
-0007b470: 2020 2020 2020 2020 2069 6620 6f75 745f           if out_
-0007b480: 7472 3a0a 2020 2020 2020 2020 2020 2020  tr:.            
-0007b490: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
-0007b4a0: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-0007b4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007b4c0: 2020 2020 2066 5f74 203d 206f 7065 6e28       f_t = open(
-0007b4d0: 666e 616d 655f 7472 2c20 2777 2b27 290a  fname_tr, 'w+').
-0007b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b4f0: 2020 2020 2320 6966 2028 6774 6620 6973      # if (gtf is
-0007b500: 204e 6f6e 6529 3a20 665f 7020 3d20 6f70   None): f_p = op
-0007b510: 656e 2866 6e61 6d65 5f70 722c 2027 772b  en(fname_pr, 'w+
-0007b520: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-0007b530: 2020 2020 6966 206e 5f63 6f72 6573 203d      if n_cores =
-0007b540: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0007b550: 2020 2020 2020 2020 2066 6f72 206d 2c20           for m, 
-0007b560: 6764 2069 6e20 656e 756d 6572 6174 6528  gd in enumerate(
-0007b570: 6764 7329 3a0a 2020 2020 2020 2020 2020  gds):.          
-0007b580: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0007b590: 206d 2531 3030 203d 3d20 303a 2070 7269   m%100 == 0: pri
-0007b5a0: 6e74 2827 5c72 4765 6e65 7261 7469 6e67  nt('\rGenerating
-0007b5b0: 2069 6e74 6572 6d65 6469 6174 6520 4754   intermediate GT
-0007b5c0: 4620 616e 6420 7472 616e 7363 7269 7074  F and transcript
-0007b5d0: 6f6d 6520 2e2e 2025 692f 2569 2720 2520  ome .. %i/%i' % 
-0007b5e0: 286d 2c20 6c65 6e28 6764 7329 292c 2065  (m, len(gds)), e
-0007b5f0: 6e64 203d 2027 2020 2027 290a 2020 2020  nd = '   ').    
-0007b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b610: 2020 2020 2320 6e74 722c 206e 7072 2c20      # ntr, npr, 
-0007b620: 6e65 203d 2067 642e 7570 6461 7465 5f74  ne = gd.update_t
-0007b630: 645f 696e 666f 2829 0a20 2020 2020 2020  d_info().       
-0007b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b650: 2067 7466 6c2c 2063 6e20 3d20 6764 2e67   gtfl, cn = gd.g
-0007b660: 6574 5f67 7466 5f6c 696e 6573 5f66 726f  et_gtf_lines_fro
-0007b670: 6d5f 6578 6f6e 7328 290a 2020 2020 2020  m_exons().      
-0007b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b690: 2020 665f 6774 6620 3d20 7361 7665 5f67    f_gtf = save_g
-0007b6a0: 7466 3228 666e 616d 655f 6766 662c 2067  tf2(fname_gff, g
-0007b6b0: 7466 5f6c 696e 655f 6c73 7420 3d20 6774  tf_line_lst = gt
-0007b6c0: 666c 2c20 666f 203d 2066 5f67 7466 290a  fl, fo = f_gtf).
-0007b6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007b6e0: 2020 2020 2020 2020 2063 6e74 5f6e 6f6e           cnt_non
-0007b6f0: 6520 2b3d 2063 6e0a 2020 2020 2020 2020  e += cn.        
-0007b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b710: 6966 206f 7574 5f74 723a 0a20 2020 2020  if out_tr:.     
-0007b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b730: 2020 2020 2020 206c 312c 206c 3220 3d20         l1, l2 = 
-0007b740: 6764 2e67 6574 5f66 6173 7461 5f6c 696e  gd.get_fasta_lin
-0007b750: 6573 5f66 726f 6d5f 6578 6f6e 7328 7065  es_from_exons(pe
-0007b760: 7074 6964 6520 3d20 4661 6c73 6529 0a20  ptide = False). 
+0007b0c0: 2020 2020 2020 2020 2067 642e 7365 745f           gd.set_
+0007b0d0: 636f 765f 6e5f 6162 6e5f 7468 2820 4d49  cov_n_abn_th( MI
+0007b0e0: 4e5f 434f 565f 544f 5f53 454c 2c20 4d49  N_COV_TO_SEL, MI
+0007b0f0: 4e5f 4142 4e5f 544f 5f53 454c 2029 0a20  N_ABN_TO_SEL ). 
+0007b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b110: 2020 2020 2020 2020 2020 2067 642e 7570             gd.up
+0007b120: 6461 7465 5f74 645f 696e 666f 2829 0a20  date_td_info(). 
+0007b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b140: 2020 2020 2020 2067 6473 203d 2067 6473         gds = gds
+0007b150: 202b 2067 6473 5f75 6e6d 6170 7065 640a   + gds_unmapped.
+0007b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b170: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+0007b180: 2020 2569 2c25 6920 756e 6d61 7070 6564    %i,%i unmapped
+0007b190: 2067 656e 6573 2f74 7273 2077 6572 6520   genes/trs were 
+0007b1a0: 6164 6465 642e 2720 2520 286c 656e 2867  added.' % (len(g
+0007b1b0: 6473 5f75 6e6d 6170 7065 6429 2c20 6e74  ds_unmapped), nt
+0007b1c0: 7229 2029 0a20 2020 2020 2020 2020 2020  r) ).           
+0007b1d0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007b1e0: 2020 2020 2020 2020 2020 6764 7320 3d20            gds = 
+0007b1f0: 736f 7274 5f64 6573 6372 6970 746f 725f  sort_descriptor_
+0007b200: 6c73 7428 6764 7329 0a0a 2020 2020 2020  lst(gds)..      
+0007b210: 2020 2020 2020 2020 2020 2327 2727 0a20            #'''. 
+0007b220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0007b230: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
+0007b240: 2e74 696d 6528 290a 2020 2020 2020 2020  .time().        
+0007b250: 2020 2020 2020 2020 7072 696e 7428 2747          print('G
+0007b260: 656e 6572 6174 696e 6720 696e 7465 726d  enerating interm
+0007b270: 6564 6961 7465 2047 4646 2061 6e64 2054  ediate GFF and T
+0007b280: 7261 6e73 6372 6970 746f 6d65 202e 2e20  ranscriptome .. 
+0007b290: 272c 2065 6e64 3d27 2020 2020 2729 0a20  ', end='    '). 
+0007b2a0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0007b2b0: 7466 5f6c 696e 6573 203d 205b 5d0a 2020  tf_lines = [].  
+0007b2c0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0007b2d0: 7374 615f 6c69 6e65 7320 3d20 5b5d 0a20  sta_lines = []. 
+0007b2e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007b2f0: 6173 7461 5f6c 696e 6573 3220 3d20 5b5d  asta_lines2 = []
+0007b300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007b310: 2063 6e74 5f6e 6f6e 6520 3d20 300a 0a20   cnt_none = 0.. 
+0007b320: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0007b330: 6472 5f6c 696e 6573 203d 205b 5d0a 2020  dr_lines = [].  
+0007b340: 2020 2020 2020 2020 2020 2020 2020 6864                hd
+0007b350: 725f 6c69 6e65 732e 6170 7065 6e64 2827  r_lines.append('
+0007b360: 5374 7269 6e67 4669 7820 7665 7273 696f  StringFix versio
+0007b370: 6e20 2573 2720 2520 5374 7269 6e67 4669  n %s' % StringFi
+0007b380: 785f 7665 7273 696f 6e20 290a 2020 2020  x_version ).    
+0007b390: 2020 2020 2020 2020 2020 2020 6864 725f              hdr_
+0007b3a0: 6c69 6e65 732e 6170 7065 6e64 2827 496e  lines.append('In
+0007b3b0: 7075 7420 5341 4d2f 4241 4d3a 2025 7327  put SAM/BAM: %s'
+0007b3c0: 2025 2073 616d 5f66 696c 6529 0a20 2020   % sam_file).   
+0007b3d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007b3e0: 6774 6620 6973 206e 6f74 204e 6f6e 653a  gtf is not None:
+0007b3f0: 2068 6472 5f6c 696e 6573 2e61 7070 656e   hdr_lines.appen
+0007b400: 6428 2752 6566 2e20 4754 462f 4746 463a  d('Ref. GTF/GFF:
+0007b410: 2025 7327 2025 2067 7466 290a 2020 2020   %s' % gtf).    
+0007b420: 2020 2020 2020 2020 2020 2020 6864 725f              hdr_
+0007b430: 6c69 6e65 732e 6170 7065 6e64 2827 5265  lines.append('Re
+0007b440: 6164 206c 656e 6774 683a 2025 6927 2025  ad length: %i' %
+0007b450: 2072 645f 6c65 6e29 0a20 2020 2020 2020   rd_len).       
+0007b460: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007b470: 2020 2020 2020 2020 2020 665f 6774 6620            f_gtf 
+0007b480: 3d20 7361 7665 5f67 7466 3228 666e 616d  = save_gtf2(fnam
+0007b490: 655f 6766 662c 2067 7466 5f6c 696e 655f  e_gff, gtf_line_
+0007b4a0: 6c73 7420 3d20 4e6f 6e65 2c20 6864 7220  lst = None, hdr 
+0007b4b0: 3d20 6864 725f 6c69 6e65 7329 0a20 2020  = hdr_lines).   
+0007b4c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007b4d0: 6f75 745f 7472 3a0a 2020 2020 2020 2020  out_tr:.        
+0007b4e0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0007b4f0: 745f 7469 6d65 203d 2074 696d 652e 7469  t_time = time.ti
+0007b500: 6d65 2829 0a20 2020 2020 2020 2020 2020  me().           
+0007b510: 2020 2020 2020 2020 2066 5f74 203d 206f           f_t = o
+0007b520: 7065 6e28 666e 616d 655f 7472 2c20 2777  pen(fname_tr, 'w
+0007b530: 2b27 290a 2020 2020 2020 2020 2020 2020  +').            
+0007b540: 2020 2020 2020 2020 2320 6966 2028 6774          # if (gt
+0007b550: 6620 6973 204e 6f6e 6529 3a20 665f 7020  f is None): f_p 
+0007b560: 3d20 6f70 656e 2866 6e61 6d65 5f70 722c  = open(fname_pr,
+0007b570: 2027 772b 2729 0a0a 2020 2020 2020 2020   'w+')..        
+0007b580: 2020 2020 2020 2020 6966 206e 5f63 6f72          if n_cor
+0007b590: 6573 203d 3d20 313a 0a20 2020 2020 2020  es == 1:.       
+0007b5a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0007b5b0: 206d 2c20 6764 2069 6e20 656e 756d 6572   m, gd in enumer
+0007b5c0: 6174 6528 6764 7329 3a0a 2020 2020 2020  ate(gds):.      
+0007b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b5e0: 2020 6966 206d 2531 3030 203d 3d20 303a    if m%100 == 0:
+0007b5f0: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
+0007b600: 7469 6e67 2069 6e74 6572 6d65 6469 6174  ting intermediat
+0007b610: 6520 4754 4620 616e 6420 7472 616e 7363  e GTF and transc
+0007b620: 7269 7074 6f6d 6520 2e2e 2025 692f 2569  riptome .. %i/%i
+0007b630: 2720 2520 286d 2c20 6c65 6e28 6764 7329  ' % (m, len(gds)
+0007b640: 292c 2065 6e64 203d 2027 2020 2027 290a  ), end = '   ').
+0007b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b660: 2020 2020 2020 2020 2320 6e74 722c 206e          # ntr, n
+0007b670: 7072 2c20 6e65 203d 2067 642e 7570 6461  pr, ne = gd.upda
+0007b680: 7465 5f74 645f 696e 666f 2829 0a20 2020  te_td_info().   
+0007b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b6a0: 2020 2020 2067 7466 6c2c 2063 6e20 3d20       gtfl, cn = 
+0007b6b0: 6764 2e67 6574 5f67 7466 5f6c 696e 6573  gd.get_gtf_lines
+0007b6c0: 5f66 726f 6d5f 6578 6f6e 7328 290a 2020  _from_exons().  
+0007b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b6e0: 2020 2020 2020 665f 6774 6620 3d20 7361        f_gtf = sa
+0007b6f0: 7665 5f67 7466 3228 666e 616d 655f 6766  ve_gtf2(fname_gf
+0007b700: 662c 2067 7466 5f6c 696e 655f 6c73 7420  f, gtf_line_lst 
+0007b710: 3d20 6774 666c 2c20 666f 203d 2066 5f67  = gtfl, fo = f_g
+0007b720: 7466 290a 0a20 2020 2020 2020 2020 2020  tf)..           
+0007b730: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
+0007b740: 5f6e 6f6e 6520 2b3d 2063 6e0a 2020 2020  _none += cn.    
+0007b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b760: 2020 2020 6966 206f 7574 5f74 723a 0a20      if out_tr:. 
 0007b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b780: 2020 2020 2020 2020 2020 2066 5f74 2e77             f_t.w
-0007b790: 7269 7465 6c69 6e65 7328 2727 2e6a 6f69  ritelines(''.joi
-0007b7a0: 6e28 6c31 2929 0a20 2020 2020 2020 2020  n(l1)).         
-0007b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b7c0: 2020 2023 2069 6620 2867 7466 2069 7320     # if (gtf is 
-0007b7d0: 4e6f 6e65 293a 2066 5f70 2e77 7269 7465  None): f_p.write
-0007b7e0: 6c69 6e65 7328 2727 2e6a 6f69 6e28 6c32  lines(''.join(l2
-0007b7f0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0007b800: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0007b810: 2020 2020 2020 2020 2020 2020 206e 756d               num
-0007b820: 5f63 6f72 6520 3d20 6d69 6e28 206e 5f63  _core = min( n_c
-0007b830: 6f72 6573 2c20 2863 7075 5f63 6f75 6e74  ores, (cpu_count
-0007b840: 2829 202d 2031 2920 290a 2020 2020 2020  () - 1) ).      
-0007b850: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0007b860: 6f6c 203d 2050 6f6f 6c28 6e75 6d5f 636f  ol = Pool(num_co
-0007b870: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
-0007b880: 2020 2020 2020 2020 6d20 3d20 310a 2020          m = 1.  
-0007b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b8a0: 2020 666f 7220 6774 666c 2c20 6c31 2c20    for gtfl, l1, 
-0007b8b0: 6c32 2c20 6e65 2c20 636e 2069 6e20 706f  l2, ne, cn in po
-0007b8c0: 6f6c 2e6d 6170 286d 635f 636f 7265 5f67  ol.map(mc_core_g
-0007b8d0: 6574 5f67 7466 5f61 6e64 5f66 6173 7461  et_gtf_and_fasta
-0007b8e0: 5f70 662c 2067 6473 293a 0a20 2020 2020  _pf, gds):.     
-0007b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b900: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0007b910: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0007b920: 2531 3030 203d 3d20 303a 2070 7269 6e74  %100 == 0: print
-0007b930: 2827 5c72 4765 6e65 7261 7469 6e67 2069  ('\rGenerating i
-0007b940: 6e74 6572 6d65 6469 6174 6520 4754 4620  ntermediate GTF 
-0007b950: 616e 6420 7472 616e 7363 7269 7074 6f6d  and transcriptom
-0007b960: 6520 2e2e 2025 692f 2569 2720 2520 286d  e .. %i/%i' % (m
-0007b970: 2c20 6c65 6e28 6764 7329 292c 2065 6e64  , len(gds)), end
-0007b980: 203d 2027 2020 2027 290a 2020 2020 2020   = '   ').      
-0007b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b9a0: 2020 6d20 2b3d 2031 0a20 2020 2020 2020    m += 1.       
-0007b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b9c0: 2066 5f67 7466 203d 2073 6176 655f 6774   f_gtf = save_gt
-0007b9d0: 6632 2866 6e61 6d65 5f67 6666 2c20 6774  f2(fname_gff, gt
-0007b9e0: 665f 6c69 6e65 5f6c 7374 203d 2067 7466  f_line_lst = gtf
-0007b9f0: 6c2c 2066 6f20 3d20 665f 6774 6629 0a0a  l, fo = f_gtf)..
+0007b780: 2020 2020 2020 2020 2020 206c 312c 206c             l1, l
+0007b790: 3220 3d20 6764 2e67 6574 5f66 6173 7461  2 = gd.get_fasta
+0007b7a0: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
+0007b7b0: 7328 7065 7074 6964 6520 3d20 4661 6c73  s(peptide = Fals
+0007b7c0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0007b7d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007b7e0: 5f74 2e77 7269 7465 6c69 6e65 7328 2727  _t.writelines(''
+0007b7f0: 2e6a 6f69 6e28 6c31 2929 0a20 2020 2020  .join(l1)).     
+0007b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b810: 2020 2020 2020 2023 2069 6620 2867 7466         # if (gtf
+0007b820: 2069 7320 4e6f 6e65 293a 2066 5f70 2e77   is None): f_p.w
+0007b830: 7269 7465 6c69 6e65 7328 2727 2e6a 6f69  ritelines(''.joi
+0007b840: 6e28 6c32 2929 0a20 2020 2020 2020 2020  n(l2)).         
+0007b850: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0007b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b870: 206e 756d 5f63 6f72 6520 3d20 6d69 6e28   num_core = min(
+0007b880: 206e 5f63 6f72 6573 2c20 2863 7075 5f63   n_cores, (cpu_c
+0007b890: 6f75 6e74 2829 202d 2031 2920 290a 2020  ount() - 1) ).  
+0007b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b8b0: 2020 706f 6f6c 203d 2050 6f6f 6c28 6e75    pool = Pool(nu
+0007b8c0: 6d5f 636f 7265 290a 2020 2020 2020 2020  m_core).        
+0007b8d0: 2020 2020 2020 2020 2020 2020 6d20 3d20              m = 
+0007b8e0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0007b8f0: 2020 2020 2020 666f 7220 6774 666c 2c20        for gtfl, 
+0007b900: 6c31 2c20 6c32 2c20 6e65 2c20 636e 2069  l1, l2, ne, cn i
+0007b910: 6e20 706f 6f6c 2e6d 6170 286d 635f 636f  n pool.map(mc_co
+0007b920: 7265 5f67 6574 5f67 7466 5f61 6e64 5f66  re_get_gtf_and_f
+0007b930: 6173 7461 5f70 662c 2067 6473 293a 0a20  asta_pf, gds):. 
+0007b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b950: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0007b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b970: 6966 206d 2531 3030 203d 3d20 303a 2070  if m%100 == 0: p
+0007b980: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
+0007b990: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
+0007b9a0: 4754 4620 616e 6420 7472 616e 7363 7269  GTF and transcri
+0007b9b0: 7074 6f6d 6520 2e2e 2025 692f 2569 2720  ptome .. %i/%i' 
+0007b9c0: 2520 286d 2c20 6c65 6e28 6764 7329 292c  % (m, len(gds)),
+0007b9d0: 2065 6e64 203d 2027 2020 2027 290a 2020   end = '   ').  
+0007b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b9f0: 2020 2020 2020 6d20 2b3d 2031 0a20 2020        m += 1.   
 0007ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ba10: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
-0007ba20: 202b 3d20 636e 0a20 2020 2020 2020 2020   += cn.         
-0007ba30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0007ba40: 6620 6f75 745f 7472 3a0a 2020 2020 2020  f out_tr:.      
-0007ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ba60: 2020 2020 2020 665f 742e 7772 6974 656c        f_t.writel
-0007ba70: 696e 6573 2827 272e 6a6f 696e 286c 3129  ines(''.join(l1)
-0007ba80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007ba90: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0007ba10: 2020 2020 2066 5f67 7466 203d 2073 6176       f_gtf = sav
+0007ba20: 655f 6774 6632 2866 6e61 6d65 5f67 6666  e_gtf2(fname_gff
+0007ba30: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
+0007ba40: 2067 7466 6c2c 2066 6f20 3d20 665f 6774   gtfl, fo = f_gt
+0007ba50: 6629 0a0a 2020 2020 2020 2020 2020 2020  f)..            
+0007ba60: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+0007ba70: 6e6f 6e65 202b 3d20 636e 0a20 2020 2020  none += cn.     
+0007ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ba90: 2020 2069 6620 6f75 745f 7472 3a0a 2020     if out_tr:.  
 0007baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bab0: 2020 2070 6f6f 6c2e 636c 6f73 6528 290a     pool.close().
-0007bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bad0: 2020 2020 706f 6f6c 2e6a 6f69 6e28 290a      pool.join().
-0007bae0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007baf0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-0007bb00: 655f 6774 6632 2866 6e61 6d65 5f67 6666  e_gtf2(fname_gff
-0007bb10: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
-0007bb20: 204e 6f6e 652c 2066 6f20 3d20 665f 6774   None, fo = f_gt
-0007bb30: 662c 2063 6c6f 7365 203d 2054 7275 6529  f, close = True)
+0007bab0: 2020 2020 2020 2020 2020 665f 742e 7772            f_t.wr
+0007bac0: 6974 656c 696e 6573 2827 272e 6a6f 696e  itelines(''.join
+0007bad0: 286c 3129 290a 2020 2020 2020 2020 2020  (l1)).          
+0007bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007baf0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0007bb00: 2020 2020 2020 2070 6f6f 6c2e 636c 6f73         pool.clos
+0007bb10: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+0007bb20: 2020 2020 2020 2020 706f 6f6c 2e6a 6f69          pool.joi
+0007bb30: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
 0007bb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007bb50: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0007bb60: 2020 6966 206f 7574 5f74 723a 0a20 2020    if out_tr:.   
-0007bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bb80: 2066 5f74 2e63 6c6f 7365 2829 0a20 2020   f_t.close().   
-0007bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bba0: 2023 2069 6620 2867 7466 2069 7320 4e6f   # if (gtf is No
-0007bbb0: 6e65 293a 2066 5f70 2e63 6c6f 7365 2829  ne): f_p.close()
+0007bb50: 2073 6176 655f 6774 6632 2866 6e61 6d65   save_gtf2(fname
+0007bb60: 5f67 6666 2c20 6774 665f 6c69 6e65 5f6c  _gff, gtf_line_l
+0007bb70: 7374 203d 204e 6f6e 652c 2066 6f20 3d20  st = None, fo = 
+0007bb80: 665f 6774 662c 2063 6c6f 7365 203d 2054  f_gtf, close = T
+0007bb90: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0007bba0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0007bbb0: 2020 2020 2020 6966 206f 7574 5f74 723a        if out_tr:
 0007bbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007bbd0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0007bbe0: 2020 2020 2020 656c 6170 7365 645f 7469        elapsed_ti
-0007bbf0: 6d65 3220 3d20 7469 6d65 2e74 696d 6528  me2 = time.time(
-0007bc00: 2920 2d20 7374 6172 745f 7469 6d65 0a20  ) - start_time. 
-0007bc10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0007bc20: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
-0007bc30: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
-0007bc40: 4754 4620 616e 6420 7472 616e 7363 7269  GTF and transcri
-0007bc50: 7074 6f6d 6520 2e2e 2025 692c 2025 692c  ptome .. %i, %i,
-0007bc60: 2025 6920 646f 6e65 2028 2569 2920 2027   %i done (%i)  '
-0007bc70: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0007bc80: 2020 2020 2020 2020 2020 2520 286c 656e            % (len
-0007bc90: 2866 6173 7461 5f6c 696e 6573 292f 322c  (fasta_lines)/2,
-0007bca0: 206c 656e 2867 6473 292c 2063 6e74 5f6e   len(gds), cnt_n
-0007bcb0: 6f6e 652c 2065 6c61 7073 6564 5f74 696d  one, elapsed_tim
-0007bcc0: 6532 2929 0a20 2020 2020 2020 2020 2020  e2)).           
-0007bcd0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0007bce0: 2020 2020 2020 656c 6170 7365 645f 7469        elapsed_ti
-0007bcf0: 6d65 3320 3d20 7469 6d65 2e74 696d 6528  me3 = time.time(
-0007bd00: 2920 2d20 7374 6172 745f 7469 6d65 0a0a  ) - start_time..
-0007bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bd20: 7072 696e 7428 2720 2020 2573 2028 2569  print('   %s (%i
-0007bd30: 2927 2025 2028 666e 616d 655f 6766 662c  )' % (fname_gff,
-0007bd40: 2065 6c61 7073 6564 5f74 696d 6533 2920   elapsed_time3) 
-0007bd50: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007bd60: 2020 2069 6620 2867 7466 2069 7320 4e6f     if (gtf is No
-0007bd70: 6e65 2920 2620 2867 656e 6f6d 6520 6973  ne) & (genome is
-0007bd80: 204e 6f6e 6529 3a0a 0a20 2020 2020 2020   None):..       
-0007bd90: 2020 2020 2020 2020 2020 2020 206e 765f               nv_
-0007bda0: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
-0007bdb0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0007bdc0: 2067 6420 696e 2067 6473 3a0a 2020 2020   gd in gds:.    
-0007bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bde0: 2020 2020 6764 2e66 696e 645f 736e 705f      gd.find_snp_
-0007bdf0: 6672 6f6d 5f72 676e 7328 290a 2020 2020  from_rgns().    
-0007be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007be10: 2020 2020 6e76 5f6c 7374 203d 206e 765f      nv_lst = nv_
-0007be20: 6c73 7420 2b20 6764 2e67 6574 5f67 656e  lst + gd.get_gen
-0007be30: 655f 6c65 7665 6c5f 6e76 5f69 6e66 6f28  e_level_nv_info(
-0007be40: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0007be50: 2020 2020 2020 2064 6620 3d20 7064 2e44         df = pd.D
-0007be60: 6174 6146 7261 6d65 286e 765f 6c73 7429  ataFrame(nv_lst)
-0007be70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007be80: 2020 2020 2064 665f 736e 7620 3d20 6466       df_snv = df
-0007be90: 5b5b 2763 6872 272c 2027 706f 735f 7265  [['chr', 'pos_re
-0007bea0: 6627 2c20 2772 6566 5f73 6571 272c 2027  f', 'ref_seq', '
-0007beb0: 616c 745f 7365 7127 2c20 2763 7667 5f64  alt_seq', 'cvg_d
-0007bec0: 6570 7468 272c 2027 6376 675f 6672 6163  epth', 'cvg_frac
-0007bed0: 272c 2027 765f 7479 7065 272c 2027 765f  ', 'v_type', 'v_
-0007bee0: 6c65 6e27 2c20 2776 5f63 6c61 7373 272c  len', 'v_class',
-0007bef0: 2027 765f 636c 6173 735f 7472 275d 5d0a   'v_class_tr']].
-0007bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bf10: 2020 2020 6466 5f73 6e76 2e74 6f5f 6373      df_snv.to_cs
-0007bf20: 7628 666e 616d 655f 736e 762c 2073 6570  v(fname_snv, sep
-0007bf30: 3d27 5c74 2729 0a20 2020 2020 2020 2020  ='\t').         
-0007bf40: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0007bf50: 2827 534e 5620 7375 6d6d 6172 7920 7361  ('SNV summary sa
-0007bf60: 7665 6420 746f 205c 6e20 2020 2573 2720  ved to \n   %s' 
-0007bf70: 2520 666e 616d 655f 736e 7629 0a20 2020  % fname_snv).   
-0007bf80: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0007bf90: 2020 2020 2020 2020 2020 2020 2020 7464                td
-0007bfa0: 5f65 7870 5f69 6e66 6f20 3d20 5b5d 0a20  _exp_info = []. 
-0007bfb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007bfc0: 6f72 206d 2c20 6764 2069 6e20 656e 756d  or m, gd in enum
-0007bfd0: 6572 6174 6528 6764 7329 3a0a 2020 2020  erate(gds):.    
-0007bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007bff0: 7469 7320 3d20 6764 2e67 6574 5f74 645f  tis = gd.get_td_
-0007c000: 6578 705f 696e 666f 2829 0a20 2020 2020  exp_info().     
-0007c010: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0007c020: 645f 6578 705f 696e 666f 203d 2074 645f  d_exp_info = td_
-0007c030: 6578 705f 696e 666f 202b 2074 6973 0a20  exp_info + tis. 
-0007c040: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0007c050: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007c060: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0007c070: 7464 5f65 7870 5f69 6e66 6f20 3d20 7064  td_exp_info = pd
-0007c080: 2e44 6174 6146 7261 6d65 2874 645f 6578  .DataFrame(td_ex
-0007c090: 705f 696e 666f 290a 2020 2020 2020 2020  p_info).        
-0007c0a0: 2020 2020 2020 2020 6162 6e5f 7375 6d20          abn_sum 
-0007c0b0: 3d20 6466 5f74 645f 6578 705f 696e 666f  = df_td_exp_info
-0007c0c0: 5b27 6162 6e27 5d2e 7375 6d28 290a 2020  ['abn'].sum().  
-0007c0d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0007c0e0: 2061 626e 5f73 756d 203e 2030 3a0a 2020   abn_sum > 0:.  
-0007c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c100: 2020 6e66 203d 2031 3030 3030 3030 2f61    nf = 1000000/a
-0007c110: 626e 5f73 756d 0a20 2020 2020 2020 2020  bn_sum.         
-0007c120: 2020 2020 2020 2020 2020 2064 665f 7464             df_td
-0007c130: 5f65 7870 5f69 6e66 6f5b 2774 706d 275d  _exp_info['tpm']
-0007c140: 203d 2064 665f 7464 5f65 7870 5f69 6e66   = df_td_exp_inf
-0007c150: 6f5b 2761 626e 275d 2a6e 660a 2020 2020  o['abn']*nf.    
-0007c160: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007c170: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0007c180: 7464 5f65 7870 5f69 6e66 6f2e 746f 5f63  td_exp_info.to_c
-0007c190: 7376 2866 6e61 6d65 5f65 7870 2c20 7365  sv(fname_exp, se
-0007c1a0: 703d 275c 7427 290a 2020 2020 2020 2020  p='\t').        
-0007c1b0: 2020 2020 2020 2020 7072 696e 7428 2754          print('T
-0007c1c0: 7261 6e73 6372 6970 7420 6578 7072 6573  ranscript expres
-0007c1d0: 7369 6f6e 2070 726f 6669 6c65 2073 6176  sion profile sav
-0007c1e0: 6564 2074 6f20 5c6e 2020 2025 7327 2025  ed to \n   %s' %
-0007c1f0: 2066 6e61 6d65 5f65 7870 290a 0a20 2020   fname_exp)..   
-0007c200: 2020 2020 2020 2020 2069 6620 2867 7466           if (gtf
-0007c210: 2069 7320 4e6f 6e65 293a 0a0a 2020 2020   is None):..    
-0007c220: 2020 2020 2020 2020 2020 2020 5472 5f6c              Tr_l
-0007c230: 7374 203d 2054 725f 6c73 7420 2b20 4973  st = Tr_lst + Is
-0007c240: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
-0007c250: 2020 2020 2074 725f 7365 6c20 3d20 5b5d       tr_sel = []
-0007c260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c270: 2069 6620 6c65 6e28 5472 5f6c 7374 2920   if len(Tr_lst) 
-0007c280: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0007c290: 2020 2020 2020 2020 2066 6f72 2074 7220           for tr 
-0007c2a0: 696e 2054 725f 6c73 743a 200a 2020 2020  in Tr_lst: .    
-0007c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c2c0: 2020 2020 6966 2028 6c65 6e28 7472 2e73      if (len(tr.s
-0007c2d0: 6571 2920 3e3d 206c 656e 5f74 6829 3a0a  eq) >= len_th):.
-0007c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c2f0: 2020 2020 2020 2020 2020 2020 7472 5f73              tr_s
-0007c300: 656c 2e61 7070 656e 6428 7472 290a 0a20  el.append(tr).. 
+0007bbd0: 2020 2020 2066 5f74 2e63 6c6f 7365 2829       f_t.close()
+0007bbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007bbf0: 2020 2020 2023 2069 6620 2867 7466 2069       # if (gtf i
+0007bc00: 7320 4e6f 6e65 293a 2066 5f70 2e63 6c6f  s None): f_p.clo
+0007bc10: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+0007bc20: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007bc30: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
+0007bc40: 645f 7469 6d65 3220 3d20 7469 6d65 2e74  d_time2 = time.t
+0007bc50: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
+0007bc60: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0007bc70: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
+0007bc80: 7261 7469 6e67 2069 6e74 6572 6d65 6469  rating intermedi
+0007bc90: 6174 6520 4754 4620 616e 6420 7472 616e  ate GTF and tran
+0007bca0: 7363 7269 7074 6f6d 6520 2e2e 2025 692c  scriptome .. %i,
+0007bcb0: 2025 692c 2025 6920 646f 6e65 2028 2569   %i, %i done (%i
+0007bcc0: 2920 2027 205c 0a20 2020 2020 2020 2020  )  ' \.         
+0007bcd0: 2020 2020 2020 2020 2020 2020 2020 2520                % 
+0007bce0: 286c 656e 2866 6173 7461 5f6c 696e 6573  (len(fasta_lines
+0007bcf0: 292f 322c 206c 656e 2867 6473 292c 2063  )/2, len(gds), c
+0007bd00: 6e74 5f6e 6f6e 652c 2065 6c61 7073 6564  nt_none, elapsed
+0007bd10: 5f74 696d 6532 2929 0a20 2020 2020 2020  _time2)).       
+0007bd20: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007bd30: 2020 2020 2020 2020 2020 656c 6170 7365            elapse
+0007bd40: 645f 7469 6d65 3320 3d20 7469 6d65 2e74  d_time3 = time.t
+0007bd50: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
+0007bd60: 6d65 0a0a 2020 2020 2020 2020 2020 2020  me..            
+0007bd70: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
+0007bd80: 2028 2569 2927 2025 2028 666e 616d 655f   (%i)' % (fname_
+0007bd90: 6766 662c 2065 6c61 7073 6564 5f74 696d  gff, elapsed_tim
+0007bda0: 6533 2920 290a 0a20 2020 2020 2020 2020  e3) )..         
+0007bdb0: 2020 2020 2020 2069 6620 5472 7565 3a20         if True: 
+0007bdc0: 2320 2867 656e 6f6d 655f 6669 6c65 2069  # (genome_file i
+0007bdd0: 7320 4e6f 6e65 2920 2620 2867 7466 2069  s None) & (gtf i
+0007bde0: 7320 4e6f 6e65 290a 0a20 2020 2020 2020  s None)..       
+0007bdf0: 2020 2020 2020 2020 2020 2020 206e 765f               nv_
+0007be00: 6c73 7420 3d20 5b5d 0a20 2020 2020 2020  lst = [].       
+0007be10: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0007be20: 2067 6420 696e 2067 6473 3a0a 2020 2020   gd in gds:.    
+0007be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007be40: 2020 2020 6764 2e66 696e 645f 736e 705f      gd.find_snp_
+0007be50: 6672 6f6d 5f72 676e 7328 290a 2020 2020  from_rgns().    
+0007be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007be70: 2020 2020 6e76 5f6c 7374 203d 206e 765f      nv_lst = nv_
+0007be80: 6c73 7420 2b20 6764 2e67 6574 5f67 656e  lst + gd.get_gen
+0007be90: 655f 6c65 7665 6c5f 6e76 5f69 6e66 6f28  e_level_nv_info(
+0007bea0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0007beb0: 2020 2020 2020 2064 6620 3d20 7064 2e44         df = pd.D
+0007bec0: 6174 6146 7261 6d65 286e 765f 6c73 7429  ataFrame(nv_lst)
+0007bed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007bee0: 2020 2020 2064 665f 736e 7620 3d20 6466       df_snv = df
+0007bef0: 5b5b 2763 6872 272c 2027 706f 735f 7265  [['chr', 'pos_re
+0007bf00: 6627 2c20 2772 6566 5f73 6571 272c 2027  f', 'ref_seq', '
+0007bf10: 616c 745f 7365 7127 2c20 2763 7667 5f64  alt_seq', 'cvg_d
+0007bf20: 6570 7468 272c 2027 6376 675f 6672 6163  epth', 'cvg_frac
+0007bf30: 272c 2027 765f 7479 7065 272c 2027 765f  ', 'v_type', 'v_
+0007bf40: 6c65 6e27 2c20 2776 5f63 6c61 7373 272c  len', 'v_class',
+0007bf50: 2027 765f 636c 6173 735f 7472 275d 5d0a   'v_class_tr']].
+0007bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007bf70: 2020 2020 6466 5f73 6e76 2e74 6f5f 6373      df_snv.to_cs
+0007bf80: 7628 666e 616d 655f 736e 762c 2073 6570  v(fname_snv, sep
+0007bf90: 3d27 5c74 2729 0a20 2020 2020 2020 2020  ='\t').         
+0007bfa0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0007bfb0: 2827 534e 5620 7375 6d6d 6172 7920 7361  ('SNV summary sa
+0007bfc0: 7665 6420 746f 205c 6e20 2020 2573 2720  ved to \n   %s' 
+0007bfd0: 2520 666e 616d 655f 736e 7629 0a20 2020  % fname_snv).   
+0007bfe0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0007bff0: 2020 2020 2020 2020 2020 2020 2020 7464                td
+0007c000: 5f65 7870 5f69 6e66 6f20 3d20 5b5d 0a20  _exp_info = []. 
+0007c010: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0007c020: 6f72 206d 2c20 6764 2069 6e20 656e 756d  or m, gd in enum
+0007c030: 6572 6174 6528 6764 7329 3a0a 2020 2020  erate(gds):.    
+0007c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c050: 7469 7320 3d20 6764 2e67 6574 5f74 645f  tis = gd.get_td_
+0007c060: 6578 705f 696e 666f 2829 0a20 2020 2020  exp_info().     
+0007c070: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0007c080: 645f 6578 705f 696e 666f 203d 2074 645f  d_exp_info = td_
+0007c090: 6578 705f 696e 666f 202b 2074 6973 0a20  exp_info + tis. 
+0007c0a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0007c0b0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0007c0c0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+0007c0d0: 7464 5f65 7870 5f69 6e66 6f20 3d20 7064  td_exp_info = pd
+0007c0e0: 2e44 6174 6146 7261 6d65 2874 645f 6578  .DataFrame(td_ex
+0007c0f0: 705f 696e 666f 290a 2020 2020 2020 2020  p_info).        
+0007c100: 2020 2020 2020 2020 6162 6e5f 7375 6d20          abn_sum 
+0007c110: 3d20 6466 5f74 645f 6578 705f 696e 666f  = df_td_exp_info
+0007c120: 5b27 6162 6e27 5d2e 7375 6d28 290a 2020  ['abn'].sum().  
+0007c130: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0007c140: 2061 626e 5f73 756d 203e 2030 3a0a 2020   abn_sum > 0:.  
+0007c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c160: 2020 6e66 203d 2031 3030 3030 3030 2f61    nf = 1000000/a
+0007c170: 626e 5f73 756d 0a20 2020 2020 2020 2020  bn_sum.         
+0007c180: 2020 2020 2020 2020 2020 2064 665f 7464             df_td
+0007c190: 5f65 7870 5f69 6e66 6f5b 2774 706d 275d  _exp_info['tpm']
+0007c1a0: 203d 2064 665f 7464 5f65 7870 5f69 6e66   = df_td_exp_inf
+0007c1b0: 6f5b 2761 626e 275d 2a6e 660a 2020 2020  o['abn']*nf.    
+0007c1c0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0007c1d0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+0007c1e0: 7464 5f65 7870 5f69 6e66 6f2e 746f 5f63  td_exp_info.to_c
+0007c1f0: 7376 2866 6e61 6d65 5f65 7870 2c20 7365  sv(fname_exp, se
+0007c200: 703d 275c 7427 290a 2020 2020 2020 2020  p='\t').        
+0007c210: 2020 2020 2020 2020 7072 696e 7428 2754          print('T
+0007c220: 7261 6e73 6372 6970 7420 6578 7072 6573  ranscript expres
+0007c230: 7369 6f6e 2070 726f 6669 6c65 2073 6176  sion profile sav
+0007c240: 6564 2074 6f20 5c6e 2020 2025 7327 2025  ed to \n   %s' %
+0007c250: 2066 6e61 6d65 5f65 7870 290a 0a20 2020   fname_exp)..   
+0007c260: 2020 2020 2020 2020 2069 6620 2867 7466           if (gtf
+0007c270: 2069 7320 4e6f 6e65 293a 0a0a 2020 2020   is None):..    
+0007c280: 2020 2020 2020 2020 2020 2020 5472 5f6c              Tr_l
+0007c290: 7374 203d 2054 725f 6c73 7420 2b20 4973  st = Tr_lst + Is
+0007c2a0: 5f6c 7374 0a20 2020 2020 2020 2020 2020  _lst.           
+0007c2b0: 2020 2020 2074 725f 7365 6c20 3d20 5b5d       tr_sel = []
+0007c2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c2d0: 2069 6620 6c65 6e28 5472 5f6c 7374 2920   if len(Tr_lst) 
+0007c2e0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0007c2f0: 2020 2020 2020 2020 2066 6f72 2074 7220           for tr 
+0007c300: 696e 2054 725f 6c73 743a 200a 2020 2020  in Tr_lst: .    
 0007c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c320: 2020 2074 725f 7365 6c20 3d20 6765 745f     tr_sel = get_
-0007c330: 7470 6d28 7472 5f73 656c 290a 0a20 2020  tpm(tr_sel)..   
-0007c340: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0007c350: 6c65 6e28 7472 5f73 656c 2920 3e20 303a  len(tr_sel) > 0:
-0007c360: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007c370: 2020 2020 2020 6966 2054 525f 4649 4c54        if TR_FILT
-0007c380: 4552 5f53 454c 203d 3d20 313a 0a20 2020  ER_SEL == 1:.   
-0007c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c3a0: 2020 2020 2074 725f 7365 6c20 3d20 6669       tr_sel = fi
-0007c3b0: 6c74 6572 5f74 7273 5f31 2820 7472 5f73  lter_trs_1( tr_s
-0007c3c0: 656c 2c20 7264 5f6c 656e 2c20 675f 7468  el, rd_len, g_th
-0007c3d0: 203d 204d 494e 5f4e 5f52 4453 5f50 4552   = MIN_N_RDS_PER
-0007c3e0: 5f47 454e 452c 2061 626e 5f74 685f 7420  _GENE, abn_th_t 
-0007c3f0: 3d20 4d49 4e5f 4142 4e5f 544f 5f53 454c  = MIN_ABN_TO_SEL
-0007c400: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-0007c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c430: 2020 2061 626e 5f74 685f 6920 3d20 4d49     abn_th_i = MI
-0007c440: 4e5f 4142 4e5f 544f 5f53 454c 2c20 6973  N_ABN_TO_SEL, is
-0007c450: 6f5f 6672 6163 5f74 6820 3d20 4d49 4e5f  o_frac_th = MIN_
-0007c460: 4953 4f5f 4652 4143 2c20 6c65 6e5f 7468  ISO_FRAC, len_th
-0007c470: 203d 204d 494e 5f54 525f 4c45 4e47 5448   = MIN_TR_LENGTH
-0007c480: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007c490: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0007c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c4b0: 2020 2020 7472 5f73 656c 203d 2066 696c      tr_sel = fil
-0007c4c0: 7465 725f 7472 735f 3228 2074 725f 7365  ter_trs_2( tr_se
-0007c4d0: 6c2c 2072 645f 6c65 6e2c 2067 5f74 6820  l, rd_len, g_th 
-0007c4e0: 3d20 4d49 4e5f 4e5f 5244 535f 5045 525f  = MIN_N_RDS_PER_
-0007c4f0: 4745 4e45 2c20 6162 6e5f 7468 5f74 203d  GENE, abn_th_t =
-0007c500: 204d 494e 5f41 424e 5f54 4f5f 5345 4c2c   MIN_ABN_TO_SEL,
-0007c510: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0007c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c540: 2020 6162 6e5f 7468 5f69 203d 204d 494e    abn_th_i = MIN
-0007c550: 5f41 424e 5f54 4f5f 5345 4c2c 2069 736f  _ABN_TO_SEL, iso
-0007c560: 5f66 7261 635f 7468 203d 204d 494e 5f49  _frac_th = MIN_I
-0007c570: 534f 5f46 5241 432c 206c 656e 5f74 6820  SO_FRAC, len_th 
-0007c580: 3d20 4d49 4e5f 5452 5f4c 454e 4754 4829  = MIN_TR_LENGTH)
-0007c590: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007c5a0: 2020 2020 2020 666e 616d 655f 7472 203d        fname_tr =
-0007c5b0: 2066 6e61 6d65 202b 2027 5f74 7261 6e73   fname + '_trans
-0007c5c0: 6372 6970 746f 6d65 2e66 6127 0a20 2020  criptome.fa'.   
-0007c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c5e0: 2066 6e61 6d65 5f70 7220 3d20 666e 616d   fname_pr = fnam
-0007c5f0: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
-0007c600: 6127 0a20 2020 2020 2020 2020 2020 200a  a'.            .
-0007c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c620: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
-0007c630: 6720 2e2e 2027 2c20 656e 6420 3d20 2727  g .. ', end = ''
-0007c640: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
-0007c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c660: 2020 2020 7361 7665 5f74 7261 6e73 6372      save_transcr
-0007c670: 6970 7473 3228 2066 6e61 6d65 5f74 722c  ipts2( fname_tr,
-0007c680: 2074 725f 7365 6c20 290a 0a20 2020 2020   tr_sel )..     
-0007c690: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0007c6a0: 6472 5f6c 7374 2c20 7473 6571 5f6c 7374  dr_lst, tseq_lst
-0007c6b0: 203d 206c 6f61 645f 6661 7374 6131 2820   = load_fasta1( 
-0007c6c0: 666e 616d 655f 7472 2c20 7665 7262 6f73  fname_tr, verbos
-0007c6d0: 6520 3d20 4661 6c73 6529 0a20 2020 2020  e = False).     
-0007c6e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0007c6f0: 616e 645f 636e 7420 3d20 6c65 6e28 7473  and_cnt = len(ts
-0007c700: 6571 5f6c 7374 290a 0a20 2020 2020 2020  eq_lst)..       
-0007c710: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-0007c720: 6573 203d 2067 656e 5f70 726f 7465 6f6d  es = gen_proteom
-0007c730: 655f 6672 6f6d 5f74 7261 7363 7269 7074  e_from_trascript
-0007c740: 6f6d 6528 6864 725f 6c73 742c 2074 7365  ome(hdr_lst, tse
-0007c750: 715f 6c73 742c 206c 656e 5f74 6820 3d20  q_lst, len_th = 
-0007c760: 4d49 4e5f 5052 5f4c 454e 4754 482c 2076  MIN_PR_LENGTH, v
-0007c770: 6572 626f 7365 203d 2046 616c 7365 2c20  erbose = False, 
-0007c780: 7472 6172 6563 6f20 3d20 4661 6c73 6529  trareco = False)
-0007c790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007c7a0: 2020 2020 2070 5f63 616e 645f 636e 7420       p_cand_cnt 
-0007c7b0: 3d20 6c65 6e28 6c69 6e65 7329 2f32 0a20  = len(lines)/2. 
-0007c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c7d0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0007c7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c7f0: 6620 3d20 6f70 656e 2866 6e61 6d65 5f70  f = open(fname_p
-0007c800: 722c 2777 2b27 290a 2020 2020 2020 2020  r,'w+').        
-0007c810: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-0007c820: 6974 656c 696e 6573 286c 696e 6573 290a  itelines(lines).
-0007c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c840: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
-0007c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007c860: 2020 2070 7269 6e74 2827 2064 6f6e 652e     print(' done.
-0007c870: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0007c880: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-0007c890: 2025 7327 2025 2028 666e 616d 655f 7472   %s' % (fname_tr
-0007c8a0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0007c8b0: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-0007c8c0: 2020 2573 2720 2520 2866 6e61 6d65 5f70    %s' % (fname_p
-0007c8d0: 7229 2029 0a20 2020 2020 2020 2020 2020  r) ).           
-0007c8e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0007c8f0: 2020 2025 7327 2025 2028 666e 616d 655f     %s' % (fname_
-0007c900: 6766 6629 2029 0a0a 2020 2020 2320 7072  gff) )..    # pr
-0007c910: 696e 7428 2753 7472 696e 6746 6978 5f61  int('StringFix_a
-0007c920: 6e61 6c79 7369 7320 6669 6e69 7368 6564  nalysis finished
-0007c930: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
-0007c940: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
-0007c950: 2072 6574 7572 6e20 666e 616d 652c 2067   return fname, g
-0007c960: 6473 2c20 6765 6e6f 6d65 200a 0a0a 4765  ds, genome ...Ge
-0007c970: 6e65 5f54 725f 696e 666f 203d 2063 6f6c  ne_Tr_info = col
-0007c980: 6c65 6374 696f 6e73 2e6e 616d 6564 7475  lections.namedtu
-0007c990: 706c 6528 2747 656e 655f 5472 5f69 6e66  ple('Gene_Tr_inf
-0007c9a0: 6f27 2c20 2774 725f 6964 2c20 7472 5f6e  o', 'tr_id, tr_n
-0007c9b0: 616d 652c 2067 656e 655f 6964 2c20 6765  ame, gene_id, ge
-0007c9c0: 6e65 5f6e 616d 652c 2062 696f 7479 7065  ne_name, biotype
-0007c9d0: 2c20 6368 722c 2073 7461 7274 2c20 656e  , chr, start, en
-0007c9e0: 642c 2073 7472 616e 642c 2063 6f64 696e  d, strand, codin
-0007c9f0: 672c 206e 756d 5f65 786f 6e73 2c20 7472  g, num_exons, tr
-0007ca00: 5f6c 656e 2720 290a 0a64 6566 2062 7569  _len' )..def bui
-0007ca10: 6c64 5f67 656e 655f 7472 616e 7363 7269  ld_gene_transcri
-0007ca20: 7074 5f74 6162 6c65 2820 6774 665f 6669  pt_table( gtf_fi
-0007ca30: 6c65 2029 3a0a 0a20 2020 2067 7466 5f6c  le ):..    gtf_l
-0007ca40: 696e 6573 2c20 6864 725f 6c69 6e65 7320  ines, hdr_lines 
-0007ca50: 3d20 6c6f 6164 5f67 7466 2820 6774 665f  = load_gtf( gtf_
-0007ca60: 6669 6c65 2c20 7665 7262 6f73 6520 3d20  file, verbose = 
-0007ca70: 5472 7565 290a 2020 2020 6764 5f6c 7374  True).    gd_lst
-0007ca80: 2c20 6368 7273 203d 2067 6574 5f67 656e  , chrs = get_gen
-0007ca90: 655f 6465 7363 7269 7074 6f72 2867 7466  e_descriptor(gtf
-0007caa0: 5f6c 696e 6573 2c20 6765 6e6f 6d65 203d  _lines, genome =
-0007cab0: 204e 6f6e 652c 2066 696c 6c20 3d20 4661   None, fill = Fa
-0007cac0: 6c73 652c 205c 0a20 2020 2020 2020 2020  lse, \.         
-0007cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cb00: 2020 2020 2076 6572 626f 7365 203d 2054       verbose = T
-0007cb10: 7275 652c 206e 5f63 6f72 6573 203d 2031  rue, n_cores = 1
-0007cb20: 290a 2020 2020 6465 6c20 6774 665f 6c69  ).    del gtf_li
-0007cb30: 6e65 730a 0a20 2020 2063 6872 5f6c 7374  nes..    chr_lst
-0007cb40: 203d 206c 6973 7428 7365 7428 6368 7273   = list(set(chrs
-0007cb50: 2929 0a20 2020 2063 6872 5f6c 7374 2e73  )).    chr_lst.s
-0007cb60: 6f72 7428 290a 2020 2020 6368 7273 203d  ort().    chrs =
-0007cb70: 206e 702e 6172 7261 7928 6368 7273 290a   np.array(chrs).
-0007cb80: 0a20 2020 2067 745f 6c73 7420 3d20 5b5d  .    gt_lst = []
-0007cb90: 0a20 2020 2066 6f72 2063 6872 6d20 696e  .    for chrm in
-0007cba0: 2063 6872 5f6c 7374 3a0a 2020 2020 2020   chr_lst:.      
-0007cbb0: 2020 7768 203d 2077 6869 6368 2863 6872    wh = which(chr
-0007cbc0: 7320 3d3d 2063 6872 6d29 0a0a 2020 2020  s == chrm)..    
-0007cbd0: 2020 2020 735f 706f 7320 3d20 6e70 2e7a      s_pos = np.z
-0007cbe0: 6572 6f73 286c 656e 2877 6829 290a 2020  eros(len(wh)).  
-0007cbf0: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
-0007cc00: 616e 6765 286c 656e 2877 6829 293a 200a  ange(len(wh)): .
-0007cc10: 2020 2020 2020 2020 2020 2020 735f 706f              s_po
-0007cc20: 735b 6b5d 203d 2067 645f 6c73 745b 7768  s[k] = gd_lst[wh
-0007cc30: 5b6b 5d5d 2e62 6567 696e 0a20 2020 2020  [k]].begin.     
-0007cc40: 2020 206f 6472 203d 2073 5f70 6f73 2e61     odr = s_pos.a
-0007cc50: 7267 736f 7274 2829 0a0a 2020 2020 2020  rgsort()..      
-0007cc60: 2020 6764 5f73 656c 5f6f 7264 6572 6564    gd_sel_ordered
-0007cc70: 203d 205b 6764 5f6c 7374 5b77 685b 6f64   = [gd_lst[wh[od
-0007cc80: 725b 6b5d 5d5d 2066 6f72 206b 2069 6e20  r[k]]] for k in 
-0007cc90: 7261 6e67 6528 6c65 6e28 7768 2929 5d0a  range(len(wh))].
-0007cca0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-0007ccb0: 6764 2069 6e20 656e 756d 6572 6174 6528  gd in enumerate(
-0007ccc0: 6764 5f73 656c 5f6f 7264 6572 6564 293a  gd_sel_ordered):
-0007ccd0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0007cce0: 206d 2c20 7464 2069 6e20 656e 756d 6572   m, td in enumer
-0007ccf0: 6174 6528 6764 2e74 645f 6c73 7429 3a0a  ate(gd.td_lst):.
-0007cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007cd10: 7469 6420 3d20 7464 2e74 6964 0a20 2020  tid = td.tid.   
-0007cd20: 2020 2020 2020 2020 2020 2020 2074 6e61               tna
-0007cd30: 6d65 203d 2074 642e 746e 616d 650a 2020  me = td.tname.  
-0007cd40: 2020 2020 2020 2020 2020 2020 2020 6769                gi
-0007cd50: 6420 3d20 7464 2e67 6964 0a20 2020 2020  d = td.gid.     
-0007cd60: 2020 2020 2020 2020 2020 2067 6e61 6d65             gname
-0007cd70: 203d 2074 642e 676e 616d 650a 2020 2020   = td.gname.    
-0007cd80: 2020 2020 2020 2020 2020 2020 6269 6f74              biot
-0007cd90: 7970 6520 3d20 7464 2e62 696f 7479 7065  ype = td.biotype
-0007cda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007cdb0: 2073 7461 7274 203d 2074 642e 6265 6769   start = td.begi
-0007cdc0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-0007cdd0: 2020 656e 6420 3d20 7464 2e65 6e64 0a20    end = td.end. 
-0007cde0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0007cdf0: 5f65 7820 3d20 7464 2e6e 6578 6f6e 730a  _ex = td.nexons.
-0007ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007ce10: 746c 656e 203d 2074 642e 746c 656e 0a20  tlen = td.tlen. 
-0007ce20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0007ce30: 7472 616e 6420 3d20 6765 745f 635f 6672  trand = get_c_fr
-0007ce40: 6f6d 5f69 7374 7261 6e64 2820 7464 2e69  om_istrand( td.i
-0007ce50: 7374 7261 6e64 2029 0a20 2020 2020 2020  strand ).       
-0007ce60: 2020 2020 2020 2020 2063 6473 203d 2067           cds = g
-0007ce70: 6574 5f73 7472 5f66 726f 6d5f 6963 646e  et_str_from_icdn
-0007ce80: 6728 2074 642e 6963 6473 2029 0a0a 2020  g( td.icds )..  
-0007ce90: 2020 2020 2020 2020 2020 2020 2020 6774                gt
-0007cea0: 6520 3d20 4765 6e65 5f54 725f 696e 666f  e = Gene_Tr_info
-0007ceb0: 2820 7469 642c 2074 6e61 6d65 2c20 6769  ( tid, tname, gi
-0007cec0: 642c 2067 6e61 6d65 2c20 6269 6f74 7970  d, gname, biotyp
-0007ced0: 652c 2063 6872 6d2c 2073 7461 7274 2c20  e, chrm, start, 
-0007cee0: 656e 642c 2073 7472 616e 642c 2063 6473  end, strand, cds
-0007cef0: 2c20 6e5f 6578 2c20 746c 656e 2029 0a20  , n_ex, tlen ). 
-0007cf00: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0007cf10: 745f 6c73 742e 6170 7065 6e64 2867 7465  t_lst.append(gte
-0007cf20: 290a 0a20 2020 2070 7269 6e74 2827 5c6e  )..    print('\n
-0007cf30: 5361 7669 6e67 202e 2e20 2027 2c20 656e  Saving ..  ', en
-0007cf40: 6420 3d20 2727 290a 2020 2020 6466 203d  d = '').    df =
-0007cf50: 2070 642e 4461 7461 4672 616d 6528 6774   pd.DataFrame(gt
-0007cf60: 5f6c 7374 290a 2020 2020 6669 6c65 5f6f  _lst).    file_o
-0007cf70: 7574 203d 2067 7466 5f66 696c 6520 2b20  ut = gtf_file + 
-0007cf80: 272e 7472 616e 7363 7269 7074 5f69 6e66  '.transcript_inf
-0007cf90: 6f2e 7473 7627 0a20 2020 2064 662e 746f  o.tsv'.    df.to
-0007cfa0: 5f63 7376 2866 696c 655f 6f75 742c 2073  _csv(file_out, s
-0007cfb0: 6570 203d 2027 5c74 2729 0a20 2020 2070  ep = '\t').    p
-0007cfc0: 7269 6e74 2827 646f 6e65 2e27 290a 0a20  rint('done.').. 
-0007cfd0: 2020 2070 7269 6e74 2827 5472 616e 7363     print('Transc
-0007cfe0: 7269 7074 2069 6e66 6f2e 2073 6176 6564  ript info. saved
-0007cff0: 2074 6f20 2573 2720 2520 6669 6c65 5f6f   to %s' % file_o
-0007d000: 7574 290a 0a20 2020 2072 6574 7572 6e20  ut)..    return 
-0007d010: 6774 5f6c 7374 0a0a 2727 270a 6465 6620  gt_lst..'''.def 
-0007d020: 4765 6e65 7261 7465 5f50 726f 7465 6f6d  Generate_Proteom
-0007d030: 6528 7472 5f66 612c 206c 656e 5f74 6820  e(tr_fa, len_th 
-0007d040: 3d20 4d49 4e5f 5052 5f4c 454e 4754 482c  = MIN_PR_LENGTH,
-0007d050: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
-0007d060: 206d 785f 636e 7420 3d20 302c 2074 7261   mx_cnt = 0, tra
-0007d070: 7265 636f 203d 2046 616c 7365 2c20 666e  reco = False, fn
-0007d080: 616d 655f 6f75 7420 3d20 4e6f 6e65 293a  ame_out = None):
-0007d090: 0a20 2020 200a 2020 2020 6669 6c65 5f6e  .    .    file_n
-0007d0a0: 616d 6520 3d20 7472 5f66 612e 7370 6c69  ame = tr_fa.spli
-0007d0b0: 7428 272f 2729 5b2d 315d 0a20 2020 2066  t('/')[-1].    f
-0007d0c0: 6e73 203d 2066 696c 655f 6e61 6d65 2e73  ns = file_name.s
-0007d0d0: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
-0007d0e0: 2020 2066 6e61 6d65 203d 2027 270a 2020     fname = ''.  
-0007d0f0: 2020 666f 7220 6b2c 2066 6e20 696e 2065    for k, fn in e
-0007d100: 6e75 6d65 7261 7465 2866 6e73 293a 0a20  numerate(fns):. 
-0007d110: 2020 2020 2020 2069 6620 6b20 3e20 303a         if k > 0:
-0007d120: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
-0007d130: 6d65 203d 2066 6e61 6d65 202b 2027 2e27  me = fname + '.'
-0007d140: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
-0007d150: 2066 6e61 6d65 202b 2066 6e0a 2020 2020   fname + fn.    
-0007d160: 0a20 2020 2068 6472 5f6c 7374 2c20 7473  .    hdr_lst, ts
-0007d170: 6571 5f6c 7374 203d 206c 6f61 645f 6661  eq_lst = load_fa
-0007d180: 7374 6131 2874 725f 6661 2c20 7665 7262  sta1(tr_fa, verb
-0007d190: 6f73 6520 3d20 4661 6c73 6529 0a20 2020  ose = False).   
-0007d1a0: 2063 616e 645f 636e 7420 3d20 6c65 6e28   cand_cnt = len(
-0007d1b0: 7473 6571 5f6c 7374 290a 0a20 2020 206c  tseq_lst)..    l
-0007d1c0: 696e 6573 203d 2067 656e 5f70 726f 7465  ines = gen_prote
-0007d1d0: 6f6d 655f 6672 6f6d 5f74 7261 7363 7269  ome_from_trascri
-0007d1e0: 7074 6f6d 6528 6864 725f 6c73 742c 2074  ptome(hdr_lst, t
-0007d1f0: 7365 715f 6c73 742c 206c 656e 5f74 6820  seq_lst, len_th 
-0007d200: 3d20 6c65 6e5f 7468 2c20 7665 7262 6f73  = len_th, verbos
-0007d210: 6520 3d20 7665 7262 6f73 652c 2074 7261  e = verbose, tra
-0007d220: 7265 636f 203d 2074 7261 7265 636f 290a  reco = trareco).
-0007d230: 2020 2020 705f 6361 6e64 5f63 6e74 203d      p_cand_cnt =
-0007d240: 206c 656e 286c 696e 6573 292f 320a 2020   len(lines)/2.  
-0007d250: 2020 2020 2020 2020 2020 0a20 2020 2069            .    i
-0007d260: 6620 666e 616d 655f 6f75 7420 6973 204e  f fname_out is N
-0007d270: 6f6e 653a 2066 6e61 6d65 5f6f 7574 203d  one: fname_out =
-0007d280: 2066 6e61 6d65 202b 2027 5f70 726f 7465   fname + '_prote
-0007d290: 6f6d 652e 6661 270a 2020 2020 6620 3d20  ome.fa'.    f = 
-0007d2a0: 6f70 656e 2866 6e61 6d65 5f6f 7574 2c27  open(fname_out,'
-0007d2b0: 772b 2729 0a20 2020 2066 2e77 7269 7465  w+').    f.write
-0007d2c0: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
-0007d2d0: 2066 2e63 6c6f 7365 2829 0a20 2020 2020   f.close().     
-0007d2e0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0007d2f0: 6966 2076 6572 626f 7365 3a20 0a20 2020  if verbose: .   
-0007d300: 2020 2020 2070 7269 6e74 2827 4141 5365       print('AASe
-0007d310: 7120 7361 7665 6420 746f 2025 7327 2025  q saved to %s' %
-0007d320: 2028 666e 616d 655f 6f75 7429 290a 2020   (fname_out)).  
-0007d330: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
-0007d340: 6e20 666e 616d 655f 6f75 740a 2727 270a  n fname_out.'''.
-0007d350: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-0007d360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d380: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d390: 2323 2323 2323 2323 2323 230a 2323 2053  ###########.## S
-0007d3a0: 7472 696e 6746 6978 2061 6464 6f6e 2773  tringFix addon's
-0007d3b0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+0007c320: 2020 2020 6966 2028 6c65 6e28 7472 2e73      if (len(tr.s
+0007c330: 6571 2920 3e3d 206c 656e 5f74 6829 3a0a  eq) >= len_th):.
+0007c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c350: 2020 2020 2020 2020 2020 2020 7472 5f73              tr_s
+0007c360: 656c 2e61 7070 656e 6428 7472 290a 0a20  el.append(tr).. 
+0007c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c380: 2020 2074 725f 7365 6c20 3d20 6765 745f     tr_sel = get_
+0007c390: 7470 6d28 7472 5f73 656c 290a 0a20 2020  tpm(tr_sel)..   
+0007c3a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007c3b0: 6c65 6e28 7472 5f73 656c 2920 3e20 303a  len(tr_sel) > 0:
+0007c3c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0007c3d0: 2020 2020 2020 6966 2054 525f 4649 4c54        if TR_FILT
+0007c3e0: 4552 5f53 454c 203d 3d20 313a 0a20 2020  ER_SEL == 1:.   
+0007c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c400: 2020 2020 2074 725f 7365 6c20 3d20 6669       tr_sel = fi
+0007c410: 6c74 6572 5f74 7273 5f31 2820 7472 5f73  lter_trs_1( tr_s
+0007c420: 656c 2c20 7264 5f6c 656e 2c20 675f 7468  el, rd_len, g_th
+0007c430: 203d 204d 494e 5f4e 5f52 4453 5f50 4552   = MIN_N_RDS_PER
+0007c440: 5f47 454e 452c 2061 626e 5f74 685f 7420  _GENE, abn_th_t 
+0007c450: 3d20 4d49 4e5f 4142 4e5f 544f 5f53 454c  = MIN_ABN_TO_SEL
+0007c460: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+0007c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c490: 2020 2061 626e 5f74 685f 6920 3d20 4d49     abn_th_i = MI
+0007c4a0: 4e5f 4142 4e5f 544f 5f53 454c 2c20 6973  N_ABN_TO_SEL, is
+0007c4b0: 6f5f 6672 6163 5f74 6820 3d20 4d49 4e5f  o_frac_th = MIN_
+0007c4c0: 4953 4f5f 4652 4143 2c20 6c65 6e5f 7468  ISO_FRAC, len_th
+0007c4d0: 203d 204d 494e 5f54 525f 4c45 4e47 5448   = MIN_TR_LENGTH
+0007c4e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007c4f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0007c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c510: 2020 2020 7472 5f73 656c 203d 2066 696c      tr_sel = fil
+0007c520: 7465 725f 7472 735f 3228 2074 725f 7365  ter_trs_2( tr_se
+0007c530: 6c2c 2072 645f 6c65 6e2c 2067 5f74 6820  l, rd_len, g_th 
+0007c540: 3d20 4d49 4e5f 4e5f 5244 535f 5045 525f  = MIN_N_RDS_PER_
+0007c550: 4745 4e45 2c20 6162 6e5f 7468 5f74 203d  GENE, abn_th_t =
+0007c560: 204d 494e 5f41 424e 5f54 4f5f 5345 4c2c   MIN_ABN_TO_SEL,
+0007c570: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0007c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c5a0: 2020 6162 6e5f 7468 5f69 203d 204d 494e    abn_th_i = MIN
+0007c5b0: 5f41 424e 5f54 4f5f 5345 4c2c 2069 736f  _ABN_TO_SEL, iso
+0007c5c0: 5f66 7261 635f 7468 203d 204d 494e 5f49  _frac_th = MIN_I
+0007c5d0: 534f 5f46 5241 432c 206c 656e 5f74 6820  SO_FRAC, len_th 
+0007c5e0: 3d20 4d49 4e5f 5452 5f4c 454e 4754 4829  = MIN_TR_LENGTH)
+0007c5f0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0007c600: 2020 2020 2020 666e 616d 655f 7472 203d        fname_tr =
+0007c610: 2066 6e61 6d65 202b 2027 5f74 7261 6e73   fname + '_trans
+0007c620: 6372 6970 746f 6d65 2e66 6127 0a20 2020  criptome.fa'.   
+0007c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c640: 2066 6e61 6d65 5f70 7220 3d20 666e 616d   fname_pr = fnam
+0007c650: 6520 2b20 275f 7072 6f74 656f 6d65 2e66  e + '_proteome.f
+0007c660: 6127 0a20 2020 2020 2020 2020 2020 200a  a'.            .
+0007c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c680: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
+0007c690: 6720 2e2e 2027 2c20 656e 6420 3d20 2727  g .. ', end = ''
+0007c6a0: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+0007c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c6c0: 2020 2020 7361 7665 5f74 7261 6e73 6372      save_transcr
+0007c6d0: 6970 7473 3228 2066 6e61 6d65 5f74 722c  ipts2( fname_tr,
+0007c6e0: 2074 725f 7365 6c20 290a 0a20 2020 2020   tr_sel )..     
+0007c6f0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0007c700: 6472 5f6c 7374 2c20 7473 6571 5f6c 7374  dr_lst, tseq_lst
+0007c710: 203d 206c 6f61 645f 6661 7374 6131 2820   = load_fasta1( 
+0007c720: 666e 616d 655f 7472 2c20 7665 7262 6f73  fname_tr, verbos
+0007c730: 6520 3d20 4661 6c73 6529 0a20 2020 2020  e = False).     
+0007c740: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0007c750: 616e 645f 636e 7420 3d20 6c65 6e28 7473  and_cnt = len(ts
+0007c760: 6571 5f6c 7374 290a 0a20 2020 2020 2020  eq_lst)..       
+0007c770: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+0007c780: 6573 203d 2067 656e 5f70 726f 7465 6f6d  es = gen_proteom
+0007c790: 655f 6672 6f6d 5f74 7261 7363 7269 7074  e_from_trascript
+0007c7a0: 6f6d 6528 6864 725f 6c73 742c 2074 7365  ome(hdr_lst, tse
+0007c7b0: 715f 6c73 742c 206c 656e 5f74 6820 3d20  q_lst, len_th = 
+0007c7c0: 4d49 4e5f 5052 5f4c 454e 4754 482c 2076  MIN_PR_LENGTH, v
+0007c7d0: 6572 626f 7365 203d 2046 616c 7365 2c20  erbose = False, 
+0007c7e0: 7472 6172 6563 6f20 3d20 4661 6c73 6529  trareco = False)
+0007c7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007c800: 2020 2020 2070 5f63 616e 645f 636e 7420       p_cand_cnt 
+0007c810: 3d20 6c65 6e28 6c69 6e65 7329 2f32 0a20  = len(lines)/2. 
+0007c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c830: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0007c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c850: 6620 3d20 6f70 656e 2866 6e61 6d65 5f70  f = open(fname_p
+0007c860: 722c 2777 2b27 290a 2020 2020 2020 2020  r,'w+').        
+0007c870: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0007c880: 6974 656c 696e 6573 286c 696e 6573 290a  itelines(lines).
+0007c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c8a0: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
+0007c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007c8c0: 2020 2070 7269 6e74 2827 2064 6f6e 652e     print(' done.
+0007c8d0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0007c8e0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+0007c8f0: 2025 7327 2025 2028 666e 616d 655f 7472   %s' % (fname_tr
+0007c900: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+0007c910: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+0007c920: 2020 2573 2720 2520 2866 6e61 6d65 5f70    %s' % (fname_p
+0007c930: 7229 2029 0a20 2020 2020 2020 2020 2020  r) ).           
+0007c940: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0007c950: 2020 2025 7327 2025 2028 666e 616d 655f     %s' % (fname_
+0007c960: 6766 6629 2029 0a0a 2020 2020 2320 7072  gff) )..    # pr
+0007c970: 696e 7428 2753 7472 696e 6746 6978 5f61  int('StringFix_a
+0007c980: 6e61 6c79 7369 7320 6669 6e69 7368 6564  nalysis finished
+0007c990: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
+0007c9a0: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
+0007c9b0: 2072 6574 7572 6e20 666e 616d 652c 2067   return fname, g
+0007c9c0: 6473 200a 0a0a 4765 6e65 5f54 725f 696e  ds ...Gene_Tr_in
+0007c9d0: 666f 203d 2063 6f6c 6c65 6374 696f 6e73  fo = collections
+0007c9e0: 2e6e 616d 6564 7475 706c 6528 2747 656e  .namedtuple('Gen
+0007c9f0: 655f 5472 5f69 6e66 6f27 2c20 2774 725f  e_Tr_info', 'tr_
+0007ca00: 6964 2c20 7472 5f6e 616d 652c 2067 656e  id, tr_name, gen
+0007ca10: 655f 6964 2c20 6765 6e65 5f6e 616d 652c  e_id, gene_name,
+0007ca20: 2062 696f 7479 7065 2c20 6368 722c 2073   biotype, chr, s
+0007ca30: 7461 7274 2c20 656e 642c 2073 7472 616e  tart, end, stran
+0007ca40: 642c 2063 6f64 696e 672c 206e 756d 5f65  d, coding, num_e
+0007ca50: 786f 6e73 2c20 7472 5f6c 656e 2720 290a  xons, tr_len' ).
+0007ca60: 0a64 6566 2062 7569 6c64 5f67 656e 655f  .def build_gene_
+0007ca70: 7472 616e 7363 7269 7074 5f74 6162 6c65  transcript_table
+0007ca80: 2820 6774 665f 6669 6c65 2029 3a0a 0a20  ( gtf_file ):.. 
+0007ca90: 2020 2067 7466 5f6c 696e 6573 2c20 6864     gtf_lines, hd
+0007caa0: 725f 6c69 6e65 7320 3d20 6c6f 6164 5f67  r_lines = load_g
+0007cab0: 7466 2820 6774 665f 6669 6c65 2c20 7665  tf( gtf_file, ve
+0007cac0: 7262 6f73 6520 3d20 5472 7565 290a 2020  rbose = True).  
+0007cad0: 2020 6764 5f6c 7374 2c20 6368 7273 203d    gd_lst, chrs =
+0007cae0: 2067 6574 5f67 656e 655f 6465 7363 7269   get_gene_descri
+0007caf0: 7074 6f72 2867 7466 5f6c 696e 6573 2c20  ptor(gtf_lines, 
+0007cb00: 6765 6e6f 6d65 203d 204e 6f6e 652c 2066  genome = None, f
+0007cb10: 696c 6c20 3d20 4661 6c73 652c 205c 0a20  ill = False, \. 
+0007cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007cb50: 2020 2020 2020 2020 2020 2020 2076 6572               ver
+0007cb60: 626f 7365 203d 2054 7275 652c 206e 5f63  bose = True, n_c
+0007cb70: 6f72 6573 203d 2031 290a 2020 2020 6465  ores = 1).    de
+0007cb80: 6c20 6774 665f 6c69 6e65 730a 0a20 2020  l gtf_lines..   
+0007cb90: 2063 6872 5f6c 7374 203d 206c 6973 7428   chr_lst = list(
+0007cba0: 7365 7428 6368 7273 2929 0a20 2020 2063  set(chrs)).    c
+0007cbb0: 6872 5f6c 7374 2e73 6f72 7428 290a 2020  hr_lst.sort().  
+0007cbc0: 2020 6368 7273 203d 206e 702e 6172 7261    chrs = np.arra
+0007cbd0: 7928 6368 7273 290a 0a20 2020 2067 745f  y(chrs)..    gt_
+0007cbe0: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
+0007cbf0: 2063 6872 6d20 696e 2063 6872 5f6c 7374   chrm in chr_lst
+0007cc00: 3a0a 2020 2020 2020 2020 7768 203d 2077  :.        wh = w
+0007cc10: 6869 6368 2863 6872 7320 3d3d 2063 6872  hich(chrs == chr
+0007cc20: 6d29 0a0a 2020 2020 2020 2020 735f 706f  m)..        s_po
+0007cc30: 7320 3d20 6e70 2e7a 6572 6f73 286c 656e  s = np.zeros(len
+0007cc40: 2877 6829 290a 2020 2020 2020 2020 666f  (wh)).        fo
+0007cc50: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
+0007cc60: 2877 6829 293a 200a 2020 2020 2020 2020  (wh)): .        
+0007cc70: 2020 2020 735f 706f 735b 6b5d 203d 2067      s_pos[k] = g
+0007cc80: 645f 6c73 745b 7768 5b6b 5d5d 2e62 6567  d_lst[wh[k]].beg
+0007cc90: 696e 0a20 2020 2020 2020 206f 6472 203d  in.        odr =
+0007cca0: 2073 5f70 6f73 2e61 7267 736f 7274 2829   s_pos.argsort()
+0007ccb0: 0a0a 2020 2020 2020 2020 6764 5f73 656c  ..        gd_sel
+0007ccc0: 5f6f 7264 6572 6564 203d 205b 6764 5f6c  _ordered = [gd_l
+0007ccd0: 7374 5b77 685b 6f64 725b 6b5d 5d5d 2066  st[wh[odr[k]]] f
+0007cce0: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
+0007ccf0: 6e28 7768 2929 5d0a 0a20 2020 2020 2020  n(wh))]..       
+0007cd00: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
+0007cd10: 756d 6572 6174 6528 6764 5f73 656c 5f6f  umerate(gd_sel_o
+0007cd20: 7264 6572 6564 293a 0a20 2020 2020 2020  rdered):.       
+0007cd30: 2020 2020 2066 6f72 206d 2c20 7464 2069       for m, td i
+0007cd40: 6e20 656e 756d 6572 6174 6528 6764 2e74  n enumerate(gd.t
+0007cd50: 645f 6c73 7429 3a0a 2020 2020 2020 2020  d_lst):.        
+0007cd60: 2020 2020 2020 2020 7469 6420 3d20 7464          tid = td
+0007cd70: 2e74 6964 0a20 2020 2020 2020 2020 2020  .tid.           
+0007cd80: 2020 2020 2074 6e61 6d65 203d 2074 642e       tname = td.
+0007cd90: 746e 616d 650a 2020 2020 2020 2020 2020  tname.          
+0007cda0: 2020 2020 2020 6769 6420 3d20 7464 2e67        gid = td.g
+0007cdb0: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
+0007cdc0: 2020 2067 6e61 6d65 203d 2074 642e 676e     gname = td.gn
+0007cdd0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0007cde0: 2020 2020 6269 6f74 7970 6520 3d20 7464      biotype = td
+0007cdf0: 2e62 696f 7479 7065 0a20 2020 2020 2020  .biotype.       
+0007ce00: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+0007ce10: 2074 642e 6265 6769 6e0a 2020 2020 2020   td.begin.      
+0007ce20: 2020 2020 2020 2020 2020 656e 6420 3d20            end = 
+0007ce30: 7464 2e65 6e64 0a20 2020 2020 2020 2020  td.end.         
+0007ce40: 2020 2020 2020 206e 5f65 7820 3d20 7464         n_ex = td
+0007ce50: 2e6e 6578 6f6e 730a 2020 2020 2020 2020  .nexons.        
+0007ce60: 2020 2020 2020 2020 746c 656e 203d 2074          tlen = t
+0007ce70: 642e 746c 656e 0a20 2020 2020 2020 2020  d.tlen.         
+0007ce80: 2020 2020 2020 2073 7472 616e 6420 3d20         strand = 
+0007ce90: 6765 745f 635f 6672 6f6d 5f69 7374 7261  get_c_from_istra
+0007cea0: 6e64 2820 7464 2e69 7374 7261 6e64 2029  nd( td.istrand )
+0007ceb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007cec0: 2063 6473 203d 2067 6574 5f73 7472 5f66   cds = get_str_f
+0007ced0: 726f 6d5f 6963 646e 6728 2074 642e 6963  rom_icdng( td.ic
+0007cee0: 6473 2029 0a0a 2020 2020 2020 2020 2020  ds )..          
+0007cef0: 2020 2020 2020 6774 6520 3d20 4765 6e65        gte = Gene
+0007cf00: 5f54 725f 696e 666f 2820 7469 642c 2074  _Tr_info( tid, t
+0007cf10: 6e61 6d65 2c20 6769 642c 2067 6e61 6d65  name, gid, gname
+0007cf20: 2c20 6269 6f74 7970 652c 2063 6872 6d2c  , biotype, chrm,
+0007cf30: 2073 7461 7274 2c20 656e 642c 2073 7472   start, end, str
+0007cf40: 616e 642c 2063 6473 2c20 6e5f 6578 2c20  and, cds, n_ex, 
+0007cf50: 746c 656e 2029 0a20 2020 2020 2020 2020  tlen ).         
+0007cf60: 2020 2020 2020 2067 745f 6c73 742e 6170         gt_lst.ap
+0007cf70: 7065 6e64 2867 7465 290a 0a20 2020 2070  pend(gte)..    p
+0007cf80: 7269 6e74 2827 5c6e 5361 7669 6e67 202e  rint('\nSaving .
+0007cf90: 2e20 2027 2c20 656e 6420 3d20 2727 290a  .  ', end = '').
+0007cfa0: 2020 2020 6466 203d 2070 642e 4461 7461      df = pd.Data
+0007cfb0: 4672 616d 6528 6774 5f6c 7374 290a 2020  Frame(gt_lst).  
+0007cfc0: 2020 6669 6c65 5f6f 7574 203d 2067 7466    file_out = gtf
+0007cfd0: 5f66 696c 6520 2b20 272e 7472 616e 7363  _file + '.transc
+0007cfe0: 7269 7074 5f69 6e66 6f2e 7473 7627 0a20  ript_info.tsv'. 
+0007cff0: 2020 2064 662e 746f 5f63 7376 2866 696c     df.to_csv(fil
+0007d000: 655f 6f75 742c 2073 6570 203d 2027 5c74  e_out, sep = '\t
+0007d010: 2729 0a20 2020 2070 7269 6e74 2827 646f  ').    print('do
+0007d020: 6e65 2e27 290a 0a20 2020 2070 7269 6e74  ne.')..    print
+0007d030: 2827 5472 616e 7363 7269 7074 2069 6e66  ('Transcript inf
+0007d040: 6f2e 2073 6176 6564 2074 6f20 2573 2720  o. saved to %s' 
+0007d050: 2520 6669 6c65 5f6f 7574 290a 0a20 2020  % file_out)..   
+0007d060: 2072 6574 7572 6e20 6774 5f6c 7374 0a0a   return gt_lst..
+0007d070: 2727 270a 6465 6620 4765 6e65 7261 7465  '''.def Generate
+0007d080: 5f50 726f 7465 6f6d 6528 7472 5f66 612c  _Proteome(tr_fa,
+0007d090: 206c 656e 5f74 6820 3d20 4d49 4e5f 5052   len_th = MIN_PR
+0007d0a0: 5f4c 454e 4754 482c 2076 6572 626f 7365  _LENGTH, verbose
+0007d0b0: 203d 2054 7275 652c 206d 785f 636e 7420   = True, mx_cnt 
+0007d0c0: 3d20 302c 2074 7261 7265 636f 203d 2046  = 0, trareco = F
+0007d0d0: 616c 7365 2c20 666e 616d 655f 6f75 7420  alse, fname_out 
+0007d0e0: 3d20 4e6f 6e65 293a 0a20 2020 200a 2020  = None):.    .  
+0007d0f0: 2020 6669 6c65 5f6e 616d 6520 3d20 7472    file_name = tr
+0007d100: 5f66 612e 7370 6c69 7428 272f 2729 5b2d  _fa.split('/')[-
+0007d110: 315d 0a20 2020 2066 6e73 203d 2066 696c  1].    fns = fil
+0007d120: 655f 6e61 6d65 2e73 706c 6974 2827 2e27  e_name.split('.'
+0007d130: 295b 3a2d 315d 0a20 2020 2066 6e61 6d65  )[:-1].    fname
+0007d140: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
+0007d150: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
+0007d160: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
+0007d170: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
+0007d180: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
+0007d190: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
+0007d1a0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
+0007d1b0: 2066 6e0a 2020 2020 0a20 2020 2068 6472   fn.    .    hdr
+0007d1c0: 5f6c 7374 2c20 7473 6571 5f6c 7374 203d  _lst, tseq_lst =
+0007d1d0: 206c 6f61 645f 6661 7374 6131 2874 725f   load_fasta1(tr_
+0007d1e0: 6661 2c20 7665 7262 6f73 6520 3d20 4661  fa, verbose = Fa
+0007d1f0: 6c73 6529 0a20 2020 2063 616e 645f 636e  lse).    cand_cn
+0007d200: 7420 3d20 6c65 6e28 7473 6571 5f6c 7374  t = len(tseq_lst
+0007d210: 290a 0a20 2020 206c 696e 6573 203d 2067  )..    lines = g
+0007d220: 656e 5f70 726f 7465 6f6d 655f 6672 6f6d  en_proteome_from
+0007d230: 5f74 7261 7363 7269 7074 6f6d 6528 6864  _trascriptome(hd
+0007d240: 725f 6c73 742c 2074 7365 715f 6c73 742c  r_lst, tseq_lst,
+0007d250: 206c 656e 5f74 6820 3d20 6c65 6e5f 7468   len_th = len_th
+0007d260: 2c20 7665 7262 6f73 6520 3d20 7665 7262  , verbose = verb
+0007d270: 6f73 652c 2074 7261 7265 636f 203d 2074  ose, trareco = t
+0007d280: 7261 7265 636f 290a 2020 2020 705f 6361  rareco).    p_ca
+0007d290: 6e64 5f63 6e74 203d 206c 656e 286c 696e  nd_cnt = len(lin
+0007d2a0: 6573 292f 320a 2020 2020 2020 2020 2020  es)/2.          
+0007d2b0: 2020 0a20 2020 2069 6620 666e 616d 655f    .    if fname_
+0007d2c0: 6f75 7420 6973 204e 6f6e 653a 2066 6e61  out is None: fna
+0007d2d0: 6d65 5f6f 7574 203d 2066 6e61 6d65 202b  me_out = fname +
+0007d2e0: 2027 5f70 726f 7465 6f6d 652e 6661 270a   '_proteome.fa'.
+0007d2f0: 2020 2020 6620 3d20 6f70 656e 2866 6e61      f = open(fna
+0007d300: 6d65 5f6f 7574 2c27 772b 2729 0a20 2020  me_out,'w+').   
+0007d310: 2066 2e77 7269 7465 6c69 6e65 7328 6c69   f.writelines(li
+0007d320: 6e65 7329 0a20 2020 2066 2e63 6c6f 7365  nes).    f.close
+0007d330: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0007d340: 2020 200a 2020 2020 6966 2076 6572 626f     .    if verbo
+0007d350: 7365 3a20 0a20 2020 2020 2020 2070 7269  se: .        pri
+0007d360: 6e74 2827 4141 5365 7120 7361 7665 6420  nt('AASeq saved 
+0007d370: 746f 2025 7327 2025 2028 666e 616d 655f  to %s' % (fname_
+0007d380: 6f75 7429 290a 2020 2020 2020 2020 0a20  out)).        . 
+0007d390: 2020 2072 6574 7572 6e20 666e 616d 655f     return fname_
+0007d3a0: 6f75 740a 2727 270a 0a23 2323 2323 2323  out.'''..#######
+0007d3b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d3c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d3d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007d3e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007d3f0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
-0007d400: 2074 7269 6d5f 6865 6164 6572 2866 6e61   trim_header(fna
-0007d410: 6d65 5f66 6129 3a0a 2020 2020 0a20 2020  me_fa):.    .   
-0007d420: 2066 203d 206f 7065 6e28 666e 616d 655f   f = open(fname_
-0007d430: 6661 2c20 2772 2729 0a20 2020 206c 696e  fa, 'r').    lin
-0007d440: 6573 203d 205b 5d0a 2020 2020 636e 7420  es = [].    cnt 
-0007d450: 3d20 300a 2020 2020 666f 7220 6c69 6e65  = 0.    for line
-0007d460: 2069 6e20 663a 0a20 2020 2020 2020 2069   in f:.        i
-0007d470: 6620 6c69 6e65 5b30 5d20 3d3d 2027 3e27  f line[0] == '>'
-0007d480: 3a0a 2020 2020 2020 2020 2020 2020 6864  :.            hd
-0007d490: 7220 3d20 6c69 6e65 2e73 706c 6974 2827  r = line.split('
-0007d4a0: 2027 290a 2020 2020 2020 2020 2020 2020   ').            
-0007d4b0: 6c69 6e65 732e 6170 7065 6e64 2868 6472  lines.append(hdr
-0007d4c0: 5b30 5d2b 275c 6e27 290a 2020 2020 2020  [0]+'\n').      
-0007d4d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0007d4e0: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
-0007d4f0: 286c 696e 6529 0a20 2020 2066 2e63 6c6f  (line).    f.clo
-0007d500: 7365 2829 0a20 2020 200a 2020 2020 6620  se().    .    f 
-0007d510: 3d20 6f70 656e 2866 6e61 6d65 5f66 612c  = open(fname_fa,
-0007d520: 2027 772b 2729 0a20 2020 2066 2e77 7269   'w+').    f.wri
-0007d530: 7465 6c69 6e65 7328 6c69 6e65 7329 0a20  telines(lines). 
-0007d540: 2020 2066 2e63 6c6f 7365 2829 0a20 2020     f.close().   
-0007d550: 200a 2020 2020 0a64 6566 2074 7269 6d5f   .    .def trim_
-0007d560: 6865 6164 6572 5f61 6e64 5f61 6464 5f73  header_and_add_s
-0007d570: 7472 616e 645f 696e 666f 2866 6e61 6d65  trand_info(fname
-0007d580: 5f66 612c 2067 6666 5f66 696c 6529 3a0a  _fa, gff_file):.
-0007d590: 2020 2020 0a20 2020 2067 7466 5f6c 696e      .    gtf_lin
-0007d5a0: 6573 2c20 6864 725f 6c69 6e65 7320 3d20  es, hdr_lines = 
-0007d5b0: 6c6f 6164 5f67 7466 2867 6666 5f66 696c  load_gtf(gff_fil
-0007d5c0: 652c 2076 6572 626f 7365 203d 2054 7275  e, verbose = Tru
-0007d5d0: 6529 0a20 2020 2067 7466 5f6c 696e 6573  e).    gtf_lines
-0007d5e0: 5f6c 7374 203d 2070 6172 7365 5f67 7466  _lst = parse_gtf
-0007d5f0: 5f6c 696e 6573 5f61 6e64 5f73 706c 6974  _lines_and_split
-0007d600: 5f69 6e74 6f5f 6765 6e65 7328 2067 7466  _into_genes( gtf
-0007d610: 5f6c 696e 6573 2c20 675f 6f72 5f74 203d  _lines, g_or_t =
-0007d620: 2027 7472 616e 7363 7269 7074 272c 2076   'transcript', v
-0007d630: 6572 626f 7365 203d 2046 616c 7365 2029  erbose = False )
-0007d640: 2020 2020 0a20 2020 2074 645f 6c73 7420      .    td_lst 
-0007d650: 3d20 5b5d 0a20 2020 2066 6f72 206c 696e  = [].    for lin
-0007d660: 6573 2069 6e20 6774 665f 6c69 6e65 735f  es in gtf_lines_
-0007d670: 6c73 743a 0a20 2020 2020 2020 2074 6420  lst:.        td 
-0007d680: 3d20 7472 616e 7363 7269 7074 5f64 6573  = transcript_des
-0007d690: 6372 6970 746f 7228 6c69 6e65 7329 0a20  criptor(lines). 
-0007d6a0: 2020 2020 2020 2074 645f 6c73 742e 6170         td_lst.ap
-0007d6b0: 7065 6e64 2874 6429 0a20 2020 2020 2020  pend(td).       
-0007d6c0: 2020 2020 200a 2020 2020 6620 3d20 6f70       .    f = op
-0007d6d0: 656e 2866 6e61 6d65 5f66 612c 2027 7227  en(fname_fa, 'r'
-0007d6e0: 290a 2020 2020 6c69 6e65 7320 3d20 5b5d  ).    lines = []
-0007d6f0: 0a20 2020 2063 6e74 203d 2030 0a20 2020  .    cnt = 0.   
-0007d700: 2066 6f72 206c 696e 6520 696e 2066 3a0a   for line in f:.
-0007d710: 2020 2020 2020 2020 6966 206c 696e 655b          if line[
-0007d720: 305d 203d 3d20 273e 273a 0a20 2020 2020  0] == '>':.     
-0007d730: 2020 2020 2020 2068 6472 203d 206c 696e         hdr = lin
-0007d740: 652e 7370 6c69 7428 2720 2729 0a20 2020  e.split(' ').   
-0007d750: 2020 2020 2020 2020 206c 696e 6573 2e61           lines.a
-0007d760: 7070 656e 6428 6864 725b 305d 2b27 2073  ppend(hdr[0]+' s
-0007d770: 7472 616e 643a 2569 5c6e 2720 2520 7464  trand:%i\n' % td
-0007d780: 5f6c 7374 5b63 6e74 5d2e 7374 7261 6e64  _lst[cnt].strand
-0007d790: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-0007d7a0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0007d7b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0007d7c0: 2020 6c69 6e65 732e 6170 7065 6e64 286c    lines.append(l
-0007d7d0: 696e 6529 0a20 2020 2066 2e63 6c6f 7365  ine).    f.close
-0007d7e0: 2829 0a20 2020 200a 2020 2020 6620 3d20  ().    .    f = 
-0007d7f0: 6f70 656e 2866 6e61 6d65 5f66 612c 2027  open(fname_fa, '
-0007d800: 772b 2729 0a20 2020 2066 2e77 7269 7465  w+').    f.write
-0007d810: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
-0007d820: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
-0007d830: 6966 2063 6e74 203d 3d20 6c65 6e28 7464  if cnt == len(td
-0007d840: 5f6c 7374 293a 0a20 2020 2020 2020 2070  _lst):.        p
-0007d850: 7269 6e74 2827 4641 5354 4120 6669 6c65  rint('FASTA file
-0007d860: 2067 656e 6572 6174 6564 2073 7563 6365   generated succe
-0007d870: 7373 6675 6c6c 7927 290a 2020 2020 656c  ssfully').    el
-0007d880: 7365 3a0a 2020 2020 2020 2020 7072 696e  se:.        prin
-0007d890: 7428 2757 4152 4e49 4e47 3a20 2569 207e  t('WARNING: %i ~
-0007d8a0: 3d20 2569 2720 2520 2863 6e74 2c20 6c65  = %i' % (cnt, le
-0007d8b0: 6e28 7464 5f6c 7374 2929 2029 0a20 2020  n(td_lst)) ).   
-0007d8c0: 2020 2020 200a 2020 2020 2020 2020 0a64       .        .d
-0007d8d0: 6566 2053 7472 696e 6746 6978 5f47 4646  ef StringFix_GFF
-0007d8e0: 5265 6164 2867 7466 5f66 696c 652c 2067  Read(gtf_file, g
-0007d8f0: 656e 6f6d 655f 6669 6c65 2c20 6e5f 636f  enome_file, n_co
-0007d900: 7265 7320 3d20 3129 3a0a 2020 2020 0a20  res = 1):.    . 
-0007d910: 2020 2066 696c 655f 6e61 6d65 7320 3d20     file_names = 
-0007d920: 6774 665f 6669 6c65 2e73 706c 6974 2827  gtf_file.split('
-0007d930: 2e27 290a 2020 2020 666e 616d 6520 3d20  .').    fname = 
-0007d940: 2727 2e6a 6f69 6e28 7374 2066 6f72 2073  ''.join(st for s
-0007d950: 7420 696e 2066 696c 655f 6e61 6d65 735b  t in file_names[
-0007d960: 3a2d 315d 2029 0a20 2020 200a 2020 2020  :-1] ).    .    
-0007d970: 6774 665f 6c69 6e65 732c 2068 6472 5f6c  gtf_lines, hdr_l
-0007d980: 696e 6573 203d 206c 6f61 645f 6774 6628  ines = load_gtf(
-0007d990: 6774 665f 6669 6c65 2c20 7665 7262 6f73  gtf_file, verbos
-0007d9a0: 6520 3d20 5472 7565 290a 2020 2020 6764  e = True).    gd
-0007d9b0: 5f6c 7374 2c20 6368 7273 203d 2067 6574  _lst, chrs = get
-0007d9c0: 5f67 656e 655f 6465 7363 7269 7074 6f72  _gene_descriptor
-0007d9d0: 2867 7466 5f6c 696e 6573 2c20 6765 6e6f  (gtf_lines, geno
-0007d9e0: 6d65 203d 204e 6f6e 652c 2066 696c 6c20  me = None, fill 
-0007d9f0: 3d20 4661 6c73 652c 2076 6572 626f 7365  = False, verbose
-0007da00: 203d 2054 7275 652c 206e 5f63 6f72 6573   = True, n_cores
-0007da10: 203d 2031 290a 2020 2020 6764 5f6c 7374   = 1).    gd_lst
-0007da20: 732c 2063 6872 5f6c 7374 203d 2070 6163  s, chr_lst = pac
-0007da30: 6b5f 6765 6e65 5f64 6573 6372 6970 746f  k_gene_descripto
-0007da40: 7228 2067 645f 6c73 742c 2063 6872 7320  r( gd_lst, chrs 
-0007da50: 290a 0a20 2020 2069 6620 6765 6e6f 6d65  )..    if genome
-0007da60: 5f66 696c 6520 6973 204e 6f6e 653a 2067  _file is None: g
-0007da70: 656e 6f6d 6520 3d20 4e6f 6e65 0a20 2020  enome = None.   
-0007da80: 2065 6c73 653a 2067 656e 6f6d 6520 3d20   else: genome = 
-0007da90: 6c6f 6164 5f67 656e 6f6d 6528 6765 6e6f  load_genome(geno
-0007daa0: 6d65 5f66 696c 652c 2076 6572 626f 7365  me_file, verbose
-0007dab0: 203d 2054 7275 6529 0a0a 2020 2020 6661   = True)..    fa
-0007dac0: 7374 615f 6c69 6e65 7332 203d 205b 5d0a  sta_lines2 = [].
-0007dad0: 2020 2020 6661 7374 615f 6c69 6e65 7320      fasta_lines 
-0007dae0: 3d20 5b5d 0a20 2020 2067 6473 203d 205b  = [].    gds = [
-0007daf0: 5d0a 2020 2020 666f 7220 6764 6c20 696e  ].    for gdl in
-0007db00: 2067 645f 6c73 7473 3a20 6764 7320 3d20   gd_lsts: gds = 
-0007db10: 6764 7320 2b20 6764 6c0a 2020 2020 2020  gds + gdl.      
-0007db20: 2020 0a20 2020 2073 7461 7274 5f74 696d    .    start_tim
-0007db30: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-0007db40: 2020 2020 7072 696e 7428 2747 656e 6572      print('Gener
-0007db50: 6174 696e 6720 7472 616e 7363 7269 7074  ating transcript
-0007db60: 6f6d 6520 2e2e 2027 2c20 656e 643d 2720  ome .. ', end=' 
-0007db70: 2020 2027 290a 2020 2020 636e 745f 7472     ').    cnt_tr
-0007db80: 203d 2030 0a20 2020 2063 6e74 5f70 7220   = 0.    cnt_pr 
-0007db90: 3d20 300a 2020 2020 666f 7220 6d2c 2067  = 0.    for m, g
-0007dba0: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
-0007dbb0: 6473 293a 0a20 2020 2020 2020 2063 6e74  ds):.        cnt
-0007dbc0: 5f74 2c20 636e 745f 702c 2063 6e74 5f65  _t, cnt_p, cnt_e
-0007dbd0: 203d 2067 642e 7570 6461 7465 5f74 645f   = gd.update_td_
-0007dbe0: 696e 666f 2867 656e 6f6d 652c 2073 656c  info(genome, sel
-0007dbf0: 203d 2032 2c20 7065 7074 6964 6520 3d20   = 2, peptide = 
-0007dc00: 5472 7565 290a 2020 2020 2020 2020 636e  True).        cn
-0007dc10: 745f 7472 202b 3d20 636e 745f 740a 2020  t_tr += cnt_t.  
-0007dc20: 2020 2020 2020 636e 745f 7072 202b 3d20        cnt_pr += 
-0007dc30: 636e 745f 700a 2020 2020 2020 2020 2320  cnt_p.        # 
-0007dc40: 6764 2e6f 7264 6572 2829 0a20 2020 2020  gd.order().     
-0007dc50: 2020 206c 312c 206c 3220 3d20 6764 2e67     l1, l2 = gd.g
-0007dc60: 6574 5f66 6173 7461 5f6c 696e 6573 5f66  et_fasta_lines_f
-0007dc70: 726f 6d5f 6578 6f6e 7328 6765 6e6f 6d65  rom_exons(genome
-0007dc80: 2c20 7365 6c20 3d20 322c 2070 6570 7469  , sel = 2, pepti
-0007dc90: 6465 203d 2054 7275 6529 0a20 2020 2020  de = True).     
-0007dca0: 2020 2066 6173 7461 5f6c 696e 6573 203d     fasta_lines =
-0007dcb0: 2066 6173 7461 5f6c 696e 6573 202b 206c   fasta_lines + l
-0007dcc0: 310a 2020 2020 2020 2020 6661 7374 615f  1.        fasta_
-0007dcd0: 6c69 6e65 7332 203d 2066 6173 7461 5f6c  lines2 = fasta_l
-0007dce0: 696e 6573 3220 2b20 6c32 0a20 2020 2020  ines2 + l2.     
-0007dcf0: 2020 2069 6620 6d25 3130 3020 3d3d 2030     if m%100 == 0
-0007dd00: 3a20 7072 696e 7428 275c 7247 656e 6572  : print('\rGener
-0007dd10: 6174 696e 6720 7472 616e 7363 7269 7074  ating transcript
-0007dd20: 6f6d 6520 2e2e 2025 692f 2569 2028 2569  ome .. %i/%i (%i
-0007dd30: 2c25 6929 2720 2520 286d 2c20 6c65 6e28  ,%i)' % (m, len(
-0007dd40: 6764 7329 2c20 636e 745f 7472 2c20 636e  gds), cnt_tr, cn
-0007dd50: 745f 7072 292c 2065 6e64 3d27 2020 2020  t_pr), end='    
-0007dd60: 2729 0a20 2020 2065 6c61 7073 6564 5f74  ').    elapsed_t
-0007dd70: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-0007dd80: 2920 2d20 7374 6172 745f 7469 6d65 0a20  ) - start_time. 
-0007dd90: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
-0007dda0: 7261 7469 6e67 2074 7261 6e73 6372 6970  rating transcrip
-0007ddb0: 746f 6d65 202e 2e20 2569 2064 6f6e 6520  tome .. %i done 
-0007ddc0: 696e 2025 6928 7329 2028 2569 2c25 6929  in %i(s) (%i,%i)
-0007ddd0: 2720 2520 286c 656e 2867 6473 292c 2065  ' % (len(gds), e
-0007dde0: 6c61 7073 6564 5f74 696d 652c 2063 6e74  lapsed_time, cnt
-0007ddf0: 5f74 722c 2063 6e74 5f70 7229 290a 0a20  _tr, cnt_pr)).. 
-0007de00: 2020 2070 7269 6e74 2827 5361 7669 6e67     print('Saving
-0007de10: 202e 2e20 2569 2074 7273 2c20 2569 2070   .. %i trs, %i p
-0007de20: 7273 2720 2520 286c 656e 2866 6173 7461  rs' % (len(fasta
-0007de30: 5f6c 696e 6573 292f 322c 206c 656e 2866  _lines)/2, len(f
-0007de40: 6173 7461 5f6c 696e 6573 3229 2f32 2920  asta_lines2)/2) 
-0007de50: 2c20 656e 6420 3d20 2727 2c20 666c 7573  , end = '', flus
-0007de60: 6820 3d20 5472 7565 290a 2020 2020 666e  h = True).    fn
-0007de70: 616d 655f 7472 203d 2066 6e61 6d65 202b  ame_tr = fname +
-0007de80: 2027 5f74 7261 6e73 6372 6970 746f 6d65   '_transcriptome
-0007de90: 2e66 6127 0a20 2020 2066 203d 206f 7065  .fa'.    f = ope
-0007dea0: 6e28 666e 616d 655f 7472 2c20 2777 2b27  n(fname_tr, 'w+'
-0007deb0: 290a 2020 2020 662e 7772 6974 656c 696e  ).    f.writelin
-0007dec0: 6573 2866 6173 7461 5f6c 696e 6573 290a  es(fasta_lines).
-0007ded0: 2020 2020 662e 636c 6f73 6528 290a 0a20      f.close().. 
-0007dee0: 2020 2066 6e61 6d65 5f70 7220 3d20 666e     fname_pr = fn
-0007def0: 616d 6520 2b20 275f 7072 6f74 656f 6d65  ame + '_proteome
-0007df00: 2e66 6127 0a20 2020 2066 203d 206f 7065  .fa'.    f = ope
-0007df10: 6e28 666e 616d 655f 7072 2c20 2777 2b27  n(fname_pr, 'w+'
-0007df20: 290a 2020 2020 662e 7772 6974 656c 696e  ).    f.writelin
-0007df30: 6573 2866 6173 7461 5f6c 696e 6573 3229  es(fasta_lines2)
-0007df40: 0a20 2020 2066 2e63 6c6f 7365 2829 0a0a  .    f.close()..
-0007df50: 2020 2020 7072 696e 7428 2720 646f 6e65      print(' done
-0007df60: 2e27 290a 2020 2020 7072 696e 7428 2720  .').    print(' 
-0007df70: 2020 2573 2720 2520 2866 6e61 6d65 5f74    %s' % (fname_t
-0007df80: 7229 2029 0a20 2020 2070 7269 6e74 2827  r) ).    print('
-0007df90: 2020 2025 7327 2025 2028 666e 616d 655f     %s' % (fname_
-0007dfa0: 7072 2920 290a 0a20 2020 2072 6574 7572  pr) )..    retur
-0007dfb0: 6e28 666e 616d 6529 0a0a 0a23 2323 2323  n(fname)...#####
-0007dfc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007dfd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007dfe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007dff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e000: 2323 2323 230a 2323 2053 7472 696e 6746  #####.## StringF
-0007e010: 6978 2d73 796e 7468 6573 6973 0a23 2323  ix-synthesis.###
+0007d3f0: 2323 230a 2323 2053 7472 696e 6746 6978  ###.## StringFix
+0007d400: 2061 6464 6f6e 2773 0a23 2323 2323 2323   addon's.#######
+0007d410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007d450: 2323 230a 0a64 6566 2074 7269 6d5f 6865  ###..def trim_he
+0007d460: 6164 6572 2866 6e61 6d65 5f66 6129 3a0a  ader(fname_fa):.
+0007d470: 2020 2020 0a20 2020 2066 203d 206f 7065      .    f = ope
+0007d480: 6e28 666e 616d 655f 6661 2c20 2772 2729  n(fname_fa, 'r')
+0007d490: 0a20 2020 206c 696e 6573 203d 205b 5d0a  .    lines = [].
+0007d4a0: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
+0007d4b0: 666f 7220 6c69 6e65 2069 6e20 663a 0a20  for line in f:. 
+0007d4c0: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
+0007d4d0: 5d20 3d3d 2027 3e27 3a0a 2020 2020 2020  ] == '>':.      
+0007d4e0: 2020 2020 2020 6864 7220 3d20 6c69 6e65        hdr = line
+0007d4f0: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
+0007d500: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
+0007d510: 7065 6e64 2868 6472 5b30 5d2b 275c 6e27  pend(hdr[0]+'\n'
+0007d520: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0007d530: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0007d540: 732e 6170 7065 6e64 286c 696e 6529 0a20  s.append(line). 
+0007d550: 2020 2066 2e63 6c6f 7365 2829 0a20 2020     f.close().   
+0007d560: 200a 2020 2020 6620 3d20 6f70 656e 2866   .    f = open(f
+0007d570: 6e61 6d65 5f66 612c 2027 772b 2729 0a20  name_fa, 'w+'). 
+0007d580: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
+0007d590: 6c69 6e65 7329 0a20 2020 2066 2e63 6c6f  lines).    f.clo
+0007d5a0: 7365 2829 0a20 2020 200a 2020 2020 0a64  se().    .    .d
+0007d5b0: 6566 2074 7269 6d5f 6865 6164 6572 5f61  ef trim_header_a
+0007d5c0: 6e64 5f61 6464 5f73 7472 616e 645f 696e  nd_add_strand_in
+0007d5d0: 666f 2866 6e61 6d65 5f66 612c 2067 6666  fo(fname_fa, gff
+0007d5e0: 5f66 696c 6529 3a0a 2020 2020 0a20 2020  _file):.    .   
+0007d5f0: 2067 7466 5f6c 696e 6573 2c20 6864 725f   gtf_lines, hdr_
+0007d600: 6c69 6e65 7320 3d20 6c6f 6164 5f67 7466  lines = load_gtf
+0007d610: 2867 6666 5f66 696c 652c 2076 6572 626f  (gff_file, verbo
+0007d620: 7365 203d 2054 7275 6529 0a20 2020 2067  se = True).    g
+0007d630: 7466 5f6c 696e 6573 5f6c 7374 203d 2070  tf_lines_lst = p
+0007d640: 6172 7365 5f67 7466 5f6c 696e 6573 5f61  arse_gtf_lines_a
+0007d650: 6e64 5f73 706c 6974 5f69 6e74 6f5f 6765  nd_split_into_ge
+0007d660: 6e65 7328 2067 7466 5f6c 696e 6573 2c20  nes( gtf_lines, 
+0007d670: 675f 6f72 5f74 203d 2027 7472 616e 7363  g_or_t = 'transc
+0007d680: 7269 7074 272c 2076 6572 626f 7365 203d  ript', verbose =
+0007d690: 2046 616c 7365 2029 2020 2020 0a20 2020   False )    .   
+0007d6a0: 2074 645f 6c73 7420 3d20 5b5d 0a20 2020   td_lst = [].   
+0007d6b0: 2066 6f72 206c 696e 6573 2069 6e20 6774   for lines in gt
+0007d6c0: 665f 6c69 6e65 735f 6c73 743a 0a20 2020  f_lines_lst:.   
+0007d6d0: 2020 2020 2074 6420 3d20 7472 616e 7363       td = transc
+0007d6e0: 7269 7074 5f64 6573 6372 6970 746f 7228  ript_descriptor(
+0007d6f0: 6c69 6e65 7329 0a20 2020 2020 2020 2074  lines).        t
+0007d700: 645f 6c73 742e 6170 7065 6e64 2874 6429  d_lst.append(td)
+0007d710: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0007d720: 2020 6620 3d20 6f70 656e 2866 6e61 6d65    f = open(fname
+0007d730: 5f66 612c 2027 7227 290a 2020 2020 6c69  _fa, 'r').    li
+0007d740: 6e65 7320 3d20 5b5d 0a20 2020 2063 6e74  nes = [].    cnt
+0007d750: 203d 2030 0a20 2020 2066 6f72 206c 696e   = 0.    for lin
+0007d760: 6520 696e 2066 3a0a 2020 2020 2020 2020  e in f:.        
+0007d770: 6966 206c 696e 655b 305d 203d 3d20 273e  if line[0] == '>
+0007d780: 273a 0a20 2020 2020 2020 2020 2020 2068  ':.            h
+0007d790: 6472 203d 206c 696e 652e 7370 6c69 7428  dr = line.split(
+0007d7a0: 2720 2729 0a20 2020 2020 2020 2020 2020  ' ').           
+0007d7b0: 206c 696e 6573 2e61 7070 656e 6428 6864   lines.append(hd
+0007d7c0: 725b 305d 2b27 2073 7472 616e 643a 2569  r[0]+' strand:%i
+0007d7d0: 5c6e 2720 2520 7464 5f6c 7374 5b63 6e74  \n' % td_lst[cnt
+0007d7e0: 5d2e 7374 7261 6e64 2029 0a20 2020 2020  ].strand ).     
+0007d7f0: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
+0007d800: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0007d810: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
+0007d820: 6170 7065 6e64 286c 696e 6529 0a20 2020  append(line).   
+0007d830: 2066 2e63 6c6f 7365 2829 0a20 2020 200a   f.close().    .
+0007d840: 2020 2020 6620 3d20 6f70 656e 2866 6e61      f = open(fna
+0007d850: 6d65 5f66 612c 2027 772b 2729 0a20 2020  me_fa, 'w+').   
+0007d860: 2066 2e77 7269 7465 6c69 6e65 7328 6c69   f.writelines(li
+0007d870: 6e65 7329 0a20 2020 2066 2e63 6c6f 7365  nes).    f.close
+0007d880: 2829 0a0a 2020 2020 6966 2063 6e74 203d  ()..    if cnt =
+0007d890: 3d20 6c65 6e28 7464 5f6c 7374 293a 0a20  = len(td_lst):. 
+0007d8a0: 2020 2020 2020 2070 7269 6e74 2827 4641         print('FA
+0007d8b0: 5354 4120 6669 6c65 2067 656e 6572 6174  STA file generat
+0007d8c0: 6564 2073 7563 6365 7373 6675 6c6c 7927  ed successfully'
+0007d8d0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+0007d8e0: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
+0007d8f0: 4e47 3a20 2569 207e 3d20 2569 2720 2520  NG: %i ~= %i' % 
+0007d900: 2863 6e74 2c20 6c65 6e28 7464 5f6c 7374  (cnt, len(td_lst
+0007d910: 2929 2029 0a20 2020 2020 2020 200a 2020  )) ).        .  
+0007d920: 2020 2020 2020 0a64 6566 2053 7472 696e        .def Strin
+0007d930: 6746 6978 5f47 4646 5265 6164 2867 7466  gFix_GFFRead(gtf
+0007d940: 5f66 696c 652c 2067 656e 6f6d 655f 6669  _file, genome_fi
+0007d950: 6c65 2c20 6e5f 636f 7265 7320 3d20 3129  le, n_cores = 1)
+0007d960: 3a0a 2020 2020 0a20 2020 2066 696c 655f  :.    .    file_
+0007d970: 6e61 6d65 7320 3d20 6774 665f 6669 6c65  names = gtf_file
+0007d980: 2e73 706c 6974 2827 2e27 290a 2020 2020  .split('.').    
+0007d990: 666e 616d 6520 3d20 2727 2e6a 6f69 6e28  fname = ''.join(
+0007d9a0: 7374 2066 6f72 2073 7420 696e 2066 696c  st for st in fil
+0007d9b0: 655f 6e61 6d65 735b 3a2d 315d 2029 0a20  e_names[:-1] ). 
+0007d9c0: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
+0007d9d0: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
+0007d9e0: 6f61 645f 6774 6628 6774 665f 6669 6c65  oad_gtf(gtf_file
+0007d9f0: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
+0007da00: 290a 2020 2020 6764 5f6c 7374 2c20 6368  ).    gd_lst, ch
+0007da10: 7273 203d 2067 6574 5f67 656e 655f 6465  rs = get_gene_de
+0007da20: 7363 7269 7074 6f72 2867 7466 5f6c 696e  scriptor(gtf_lin
+0007da30: 6573 2c20 6765 6e6f 6d65 203d 204e 6f6e  es, genome = Non
+0007da40: 652c 2066 696c 6c20 3d20 4661 6c73 652c  e, fill = False,
+0007da50: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
+0007da60: 206e 5f63 6f72 6573 203d 2031 290a 2020   n_cores = 1).  
+0007da70: 2020 6764 5f6c 7374 732c 2063 6872 5f6c    gd_lsts, chr_l
+0007da80: 7374 203d 2070 6163 6b5f 6765 6e65 5f64  st = pack_gene_d
+0007da90: 6573 6372 6970 746f 7228 2067 645f 6c73  escriptor( gd_ls
+0007daa0: 742c 2063 6872 7320 290a 0a20 2020 2069  t, chrs )..    i
+0007dab0: 6620 6765 6e6f 6d65 5f66 696c 6520 6973  f genome_file is
+0007dac0: 204e 6f6e 653a 2067 656e 6f6d 6520 3d20   None: genome = 
+0007dad0: 4e6f 6e65 0a20 2020 2065 6c73 653a 2067  None.    else: g
+0007dae0: 656e 6f6d 6520 3d20 6c6f 6164 5f67 656e  enome = load_gen
+0007daf0: 6f6d 6528 6765 6e6f 6d65 5f66 696c 652c  ome(genome_file,
+0007db00: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
+0007db10: 0a0a 2020 2020 6661 7374 615f 6c69 6e65  ..    fasta_line
+0007db20: 7332 203d 205b 5d0a 2020 2020 6661 7374  s2 = [].    fast
+0007db30: 615f 6c69 6e65 7320 3d20 5b5d 0a20 2020  a_lines = [].   
+0007db40: 2067 6473 203d 205b 5d0a 2020 2020 666f   gds = [].    fo
+0007db50: 7220 6764 6c20 696e 2067 645f 6c73 7473  r gdl in gd_lsts
+0007db60: 3a20 6764 7320 3d20 6764 7320 2b20 6764  : gds = gds + gd
+0007db70: 6c0a 2020 2020 2020 2020 0a20 2020 2073  l.        .    s
+0007db80: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
+0007db90: 2e74 696d 6528 290a 2020 2020 7072 696e  .time().    prin
+0007dba0: 7428 2747 656e 6572 6174 696e 6720 7472  t('Generating tr
+0007dbb0: 616e 7363 7269 7074 6f6d 6520 2e2e 2027  anscriptome .. '
+0007dbc0: 2c20 656e 643d 2720 2020 2027 290a 2020  , end='    ').  
+0007dbd0: 2020 636e 745f 7472 203d 2030 0a20 2020    cnt_tr = 0.   
+0007dbe0: 2063 6e74 5f70 7220 3d20 300a 2020 2020   cnt_pr = 0.    
+0007dbf0: 666f 7220 6d2c 2067 6420 696e 2065 6e75  for m, gd in enu
+0007dc00: 6d65 7261 7465 2867 6473 293a 0a20 2020  merate(gds):.   
+0007dc10: 2020 2020 2063 6e74 5f74 2c20 636e 745f       cnt_t, cnt_
+0007dc20: 702c 2063 6e74 5f65 203d 2067 642e 7570  p, cnt_e = gd.up
+0007dc30: 6461 7465 5f74 645f 696e 666f 2867 656e  date_td_info(gen
+0007dc40: 6f6d 652c 2073 656c 203d 2032 2c20 7065  ome, sel = 2, pe
+0007dc50: 7074 6964 6520 3d20 5472 7565 290a 2020  ptide = True).  
+0007dc60: 2020 2020 2020 636e 745f 7472 202b 3d20        cnt_tr += 
+0007dc70: 636e 745f 740a 2020 2020 2020 2020 636e  cnt_t.        cn
+0007dc80: 745f 7072 202b 3d20 636e 745f 700a 2020  t_pr += cnt_p.  
+0007dc90: 2020 2020 2020 2320 6764 2e6f 7264 6572        # gd.order
+0007dca0: 2829 0a20 2020 2020 2020 206c 312c 206c  ().        l1, l
+0007dcb0: 3220 3d20 6764 2e67 6574 5f66 6173 7461  2 = gd.get_fasta
+0007dcc0: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
+0007dcd0: 7328 6765 6e6f 6d65 2c20 7365 6c20 3d20  s(genome, sel = 
+0007dce0: 322c 2070 6570 7469 6465 203d 2054 7275  2, peptide = Tru
+0007dcf0: 6529 0a20 2020 2020 2020 2066 6173 7461  e).        fasta
+0007dd00: 5f6c 696e 6573 203d 2066 6173 7461 5f6c  _lines = fasta_l
+0007dd10: 696e 6573 202b 206c 310a 2020 2020 2020  ines + l1.      
+0007dd20: 2020 6661 7374 615f 6c69 6e65 7332 203d    fasta_lines2 =
+0007dd30: 2066 6173 7461 5f6c 696e 6573 3220 2b20   fasta_lines2 + 
+0007dd40: 6c32 0a20 2020 2020 2020 2069 6620 6d25  l2.        if m%
+0007dd50: 3130 3020 3d3d 2030 3a20 7072 696e 7428  100 == 0: print(
+0007dd60: 275c 7247 656e 6572 6174 696e 6720 7472  '\rGenerating tr
+0007dd70: 616e 7363 7269 7074 6f6d 6520 2e2e 2025  anscriptome .. %
+0007dd80: 692f 2569 2028 2569 2c25 6929 2720 2520  i/%i (%i,%i)' % 
+0007dd90: 286d 2c20 6c65 6e28 6764 7329 2c20 636e  (m, len(gds), cn
+0007dda0: 745f 7472 2c20 636e 745f 7072 292c 2065  t_tr, cnt_pr), e
+0007ddb0: 6e64 3d27 2020 2020 2729 0a20 2020 2065  nd='    ').    e
+0007ddc0: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
+0007ddd0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+0007dde0: 745f 7469 6d65 0a20 2020 2070 7269 6e74  t_time.    print
+0007ddf0: 2827 5c72 4765 6e65 7261 7469 6e67 2074  ('\rGenerating t
+0007de00: 7261 6e73 6372 6970 746f 6d65 202e 2e20  ranscriptome .. 
+0007de10: 2569 2064 6f6e 6520 696e 2025 6928 7329  %i done in %i(s)
+0007de20: 2028 2569 2c25 6929 2720 2520 286c 656e   (%i,%i)' % (len
+0007de30: 2867 6473 292c 2065 6c61 7073 6564 5f74  (gds), elapsed_t
+0007de40: 696d 652c 2063 6e74 5f74 722c 2063 6e74  ime, cnt_tr, cnt
+0007de50: 5f70 7229 290a 0a20 2020 2070 7269 6e74  _pr))..    print
+0007de60: 2827 5361 7669 6e67 202e 2e20 2569 2074  ('Saving .. %i t
+0007de70: 7273 2c20 2569 2070 7273 2720 2520 286c  rs, %i prs' % (l
+0007de80: 656e 2866 6173 7461 5f6c 696e 6573 292f  en(fasta_lines)/
+0007de90: 322c 206c 656e 2866 6173 7461 5f6c 696e  2, len(fasta_lin
+0007dea0: 6573 3229 2f32 2920 2c20 656e 6420 3d20  es2)/2) , end = 
+0007deb0: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
+0007dec0: 290a 2020 2020 666e 616d 655f 7472 203d  ).    fname_tr =
+0007ded0: 2066 6e61 6d65 202b 2027 5f74 7261 6e73   fname + '_trans
+0007dee0: 6372 6970 746f 6d65 2e66 6127 0a20 2020  criptome.fa'.   
+0007def0: 2066 203d 206f 7065 6e28 666e 616d 655f   f = open(fname_
+0007df00: 7472 2c20 2777 2b27 290a 2020 2020 662e  tr, 'w+').    f.
+0007df10: 7772 6974 656c 696e 6573 2866 6173 7461  writelines(fasta
+0007df20: 5f6c 696e 6573 290a 2020 2020 662e 636c  _lines).    f.cl
+0007df30: 6f73 6528 290a 0a20 2020 2066 6e61 6d65  ose()..    fname
+0007df40: 5f70 7220 3d20 666e 616d 6520 2b20 275f  _pr = fname + '_
+0007df50: 7072 6f74 656f 6d65 2e66 6127 0a20 2020  proteome.fa'.   
+0007df60: 2066 203d 206f 7065 6e28 666e 616d 655f   f = open(fname_
+0007df70: 7072 2c20 2777 2b27 290a 2020 2020 662e  pr, 'w+').    f.
+0007df80: 7772 6974 656c 696e 6573 2866 6173 7461  writelines(fasta
+0007df90: 5f6c 696e 6573 3229 0a20 2020 2066 2e63  _lines2).    f.c
+0007dfa0: 6c6f 7365 2829 0a0a 2020 2020 7072 696e  lose()..    prin
+0007dfb0: 7428 2720 646f 6e65 2e27 290a 2020 2020  t(' done.').    
+0007dfc0: 7072 696e 7428 2720 2020 2573 2720 2520  print('   %s' % 
+0007dfd0: 2866 6e61 6d65 5f74 7229 2029 0a20 2020  (fname_tr) ).   
+0007dfe0: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
+0007dff0: 2028 666e 616d 655f 7072 2920 290a 0a20   (fname_pr) ).. 
+0007e000: 2020 2072 6574 7572 6e28 666e 616d 6529     return(fname)
+0007e010: 0a0a 0a23 2323 2323 2323 2323 2323 2323  ...#############
 0007e020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0007e040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0007e060: 2323 2323 2323 230a 0a53 4e56 5f69 6e66  #######..SNV_inf
-0007e070: 6f20 3d20 636f 6c6c 6563 7469 6f6e 732e  o = collections.
-0007e080: 6e61 6d65 6474 7570 6c65 2827 534e 565f  namedtuple('SNV_
-0007e090: 696e 666f 272c 2027 6368 722c 2070 6f73  info', 'chr, pos
-0007e0a0: 5f72 6566 2c20 706f 735f 6e65 772c 2067  _ref, pos_new, g
-0007e0b0: 656e 655f 6964 2c20 6765 6e65 5f6e 616d  ene_id, gene_nam
-0007e0c0: 652c 2076 5f74 7970 652c 2076 5f6c 656e  e, v_type, v_len
-0007e0d0: 2c20 6376 675f 6465 7074 682c 2063 7667  , cvg_depth, cvg
-0007e0e0: 5f66 7261 632c 205c 0a20 2020 2020 2020  _frac, \.       
-0007e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e100: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
-0007e110: 7072 6576 2c20 7265 665f 7365 712c 2072  prev, ref_seq, r
-0007e120: 6566 5f6e 6578 742c 2061 6c74 5f70 7265  ef_next, alt_pre
-0007e130: 762c 2061 6c74 5f73 6571 2c20 616c 745f  v, alt_seq, alt_
-0007e140: 6e65 7874 2729 2023 206f 6e65 2d62 6173  next') # one-bas
-0007e150: 650a 0a4e 5749 4e20 3d20 330a 6465 6620  e..NWIN = 3.def 
-0007e160: 6669 6e64 5f73 6e70 5f6f 6c64 2873 672c  find_snp_old(sg,
-0007e170: 2073 722c 2063 722c 2063 6872 6d2c 2070   sr, cr, chrm, p
-0007e180: 6f73 5f61 6273 2c20 6f73 2c20 6769 6e29  os_abs, os, gin)
-0007e190: 3a0a 2020 2020 0a20 2020 2073 6e76 5f69  :.    .    snv_i
-0007e1a0: 6e66 6f5f 6c73 7420 3d20 5b5d 0a20 2020  nfo_lst = [].   
-0007e1b0: 206c 656e 5f74 6f5f 7465 7374 203d 206d   len_to_test = m
-0007e1c0: 696e 286c 656e 2873 7229 2c6c 656e 2873  in(len(sr),len(s
-0007e1d0: 6729 290a 0a20 2020 2073 7461 7274 203d  g))..    start =
-0007e1e0: 2030 0a20 2020 2065 6e64 203d 206d 696e   0.    end = min
-0007e1f0: 2820 3130 302c 206c 656e 5f74 6f5f 7465  ( 100, len_to_te
-0007e200: 7374 2029 0a20 2020 204e 203d 2069 6e74  st ).    N = int
-0007e210: 286e 702e 6365 696c 2820 6c65 6e5f 746f  (np.ceil( len_to
-0007e220: 5f74 6573 742f 3130 3020 2929 0a20 2020  _test/100 )).   
-0007e230: 2023 2727 270a 2020 2020 666f 7220 6e20   #'''.    for n 
-0007e240: 696e 2072 616e 6765 284e 293a 0a20 2020  in range(N):.   
-0007e250: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-0007e260: 2073 675b 7374 6172 743a 656e 645d 2021   sg[start:end] !
-0007e270: 3d20 7372 5b73 7461 7274 3a65 6e64 5d3a  = sr[start:end]:
-0007e280: 0a0a 2020 2020 2020 2020 2020 2020 7020  ..            p 
-0007e290: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0007e2a0: 706f 735f 6c73 7420 3d20 5b5d 0a20 2020  pos_lst = [].   
-0007e2b0: 2020 2020 2020 2020 206c 656e 5f6c 7374           len_lst
-0007e2c0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0007e2d0: 2020 6376 675f 6c73 7420 3d20 5b5d 0a20    cvg_lst = []. 
-0007e2e0: 2020 2020 2020 2020 2020 2073 6e70 5f6c             snp_l
-0007e2f0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-0007e300: 2020 2020 736e 705f 6f72 675f 6c73 7420      snp_org_lst 
-0007e310: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0007e320: 200a 2020 2020 2020 2020 2020 2020 666f   .            fo
-0007e330: 7220 6b20 696e 2072 616e 6765 2873 7461  r k in range(sta
-0007e340: 7274 2c20 656e 6429 3a0a 2020 2020 2020  rt, end):.      
-0007e350: 2020 2020 2020 2020 2020 6966 2073 725b            if sr[
-0007e360: 6b5d 2021 3d20 7367 5b6b 5d3a 0a20 2020  k] != sg[k]:.   
-0007e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e380: 2069 6620 7020 3d3d 2030 3a20 706f 7320   if p == 0: pos 
-0007e390: 3d20 6b0a 2020 2020 2020 2020 2020 2020  = k.            
-0007e3a0: 2020 2020 2020 2020 7020 2b3d 2031 0a20          p += 1. 
-0007e3b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0007e3c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0007e3d0: 2020 2020 2020 2020 2069 6620 7020 3e20           if p > 
-0007e3e0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0007e3f0: 2020 2020 2020 2020 2020 2023 2063 7667             # cvg
-0007e400: 5f6c 7374 2e61 7070 656e 6428 6e70 2e6d  _lst.append(np.m
-0007e410: 6561 6e28 2063 725b 706f 733a 2870 6f73  ean( cr[pos:(pos
-0007e420: 2b70 295d 2029 2029 0a20 2020 2020 2020  +p)] ) ).       
-0007e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e440: 2023 2073 6e70 5f6c 7374 2e61 7070 656e   # snp_lst.appen
-0007e450: 6428 7372 5b70 6f73 3a28 706f 732b 7029  d(sr[pos:(pos+p)
-0007e460: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0007e470: 2020 2020 2020 2020 2020 2070 6f73 5f6c             pos_l
-0007e480: 7374 2e61 7070 656e 6428 706f 7329 0a20  st.append(pos). 
-0007e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e4a0: 2020 2020 2020 206c 656e 5f6c 7374 2e61         len_lst.a
-0007e4b0: 7070 656e 6428 7029 0a20 2020 2020 2020  ppend(p).       
+0007e050: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
+0007e060: 2053 7472 696e 6746 6978 2d73 796e 7468   StringFix-synth
+0007e070: 6573 6973 0a23 2323 2323 2323 2323 2323  esis.###########
+0007e080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e0a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0007e0b0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0007e0c0: 0a53 4e56 5f69 6e66 6f20 3d20 636f 6c6c  .SNV_info = coll
+0007e0d0: 6563 7469 6f6e 732e 6e61 6d65 6474 7570  ections.namedtup
+0007e0e0: 6c65 2827 534e 565f 696e 666f 272c 2027  le('SNV_info', '
+0007e0f0: 6368 722c 2070 6f73 5f72 6566 2c20 706f  chr, pos_ref, po
+0007e100: 735f 6e65 772c 2067 656e 655f 6964 2c20  s_new, gene_id, 
+0007e110: 6765 6e65 5f6e 616d 652c 2076 5f74 7970  gene_name, v_typ
+0007e120: 652c 2076 5f6c 656e 2c20 6376 675f 6465  e, v_len, cvg_de
+0007e130: 7074 682c 2063 7667 5f66 7261 632c 205c  pth, cvg_frac, \
+0007e140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e160: 2020 2020 7265 665f 7072 6576 2c20 7265      ref_prev, re
+0007e170: 665f 7365 712c 2072 6566 5f6e 6578 742c  f_seq, ref_next,
+0007e180: 2061 6c74 5f70 7265 762c 2061 6c74 5f73   alt_prev, alt_s
+0007e190: 6571 2c20 616c 745f 6e65 7874 2729 2023  eq, alt_next') #
+0007e1a0: 206f 6e65 2d62 6173 650a 0a4e 5749 4e20   one-base..NWIN 
+0007e1b0: 3d20 330a 6465 6620 6669 6e64 5f73 6e70  = 3.def find_snp
+0007e1c0: 5f6f 6c64 2873 672c 2073 722c 2063 722c  _old(sg, sr, cr,
+0007e1d0: 2063 6872 6d2c 2070 6f73 5f61 6273 2c20   chrm, pos_abs, 
+0007e1e0: 6f73 2c20 6769 6e29 3a0a 2020 2020 0a20  os, gin):.    . 
+0007e1f0: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
+0007e200: 3d20 5b5d 0a20 2020 206c 656e 5f74 6f5f  = [].    len_to_
+0007e210: 7465 7374 203d 206d 696e 286c 656e 2873  test = min(len(s
+0007e220: 7229 2c6c 656e 2873 6729 290a 0a20 2020  r),len(sg))..   
+0007e230: 2073 7461 7274 203d 2030 0a20 2020 2065   start = 0.    e
+0007e240: 6e64 203d 206d 696e 2820 3130 302c 206c  nd = min( 100, l
+0007e250: 656e 5f74 6f5f 7465 7374 2029 0a20 2020  en_to_test ).   
+0007e260: 204e 203d 2069 6e74 286e 702e 6365 696c   N = int(np.ceil
+0007e270: 2820 6c65 6e5f 746f 5f74 6573 742f 3130  ( len_to_test/10
+0007e280: 3020 2929 0a20 2020 2023 2727 270a 2020  0 )).    #'''.  
+0007e290: 2020 666f 7220 6e20 696e 2072 616e 6765    for n in range
+0007e2a0: 284e 293a 0a20 2020 2020 2020 200a 2020  (N):.        .  
+0007e2b0: 2020 2020 2020 6966 2073 675b 7374 6172        if sg[star
+0007e2c0: 743a 656e 645d 2021 3d20 7372 5b73 7461  t:end] != sr[sta
+0007e2d0: 7274 3a65 6e64 5d3a 0a0a 2020 2020 2020  rt:end]:..      
+0007e2e0: 2020 2020 2020 7020 3d20 300a 2020 2020        p = 0.    
+0007e2f0: 2020 2020 2020 2020 706f 735f 6c73 7420          pos_lst 
+0007e300: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0007e310: 206c 656e 5f6c 7374 203d 205b 5d0a 2020   len_lst = [].  
+0007e320: 2020 2020 2020 2020 2020 6376 675f 6c73            cvg_ls
+0007e330: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
+0007e340: 2020 2073 6e70 5f6c 7374 203d 205b 5d0a     snp_lst = [].
+0007e350: 2020 2020 2020 2020 2020 2020 736e 705f              snp_
+0007e360: 6f72 675f 6c73 7420 3d20 5b5d 0a20 2020  org_lst = [].   
+0007e370: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007e380: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
+0007e390: 616e 6765 2873 7461 7274 2c20 656e 6429  ange(start, end)
+0007e3a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0007e3b0: 2020 6966 2073 725b 6b5d 2021 3d20 7367    if sr[k] != sg
+0007e3c0: 5b6b 5d3a 0a20 2020 2020 2020 2020 2020  [k]:.           
+0007e3d0: 2020 2020 2020 2020 2069 6620 7020 3d3d           if p ==
+0007e3e0: 2030 3a20 706f 7320 3d20 6b0a 2020 2020   0: pos = k.    
+0007e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e400: 7020 2b3d 2031 0a20 2020 2020 2020 2020  p += 1.         
+0007e410: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0007e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e430: 2069 6620 7020 3e20 303a 0a20 2020 2020   if p > 0:.     
+0007e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e450: 2020 2023 2063 7667 5f6c 7374 2e61 7070     # cvg_lst.app
+0007e460: 656e 6428 6e70 2e6d 6561 6e28 2063 725b  end(np.mean( cr[
+0007e470: 706f 733a 2870 6f73 2b70 295d 2029 2029  pos:(pos+p)] ) )
+0007e480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e490: 2020 2020 2020 2020 2023 2073 6e70 5f6c           # snp_l
+0007e4a0: 7374 2e61 7070 656e 6428 7372 5b70 6f73  st.append(sr[pos
+0007e4b0: 3a28 706f 732b 7029 5d29 0a20 2020 2020  :(pos+p)]).     
 0007e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e4d0: 2023 2073 6e70 5f6f 7267 5f6c 7374 2e61   # snp_org_lst.a
-0007e4e0: 7070 656e 6428 7367 5b70 6f73 3a28 706f  ppend(sg[pos:(po
-0007e4f0: 732b 7029 5d29 0a20 2020 2020 2020 2020  s+p)]).         
-0007e500: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0007e510: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0007e520: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0007e530: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
-0007e540: 616e 6765 286c 656e 2870 6f73 5f6c 7374  ange(len(pos_lst
-0007e550: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0007e560: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0007e570: 2020 2020 2070 3120 3d20 6d61 7828 302c       p1 = max(0,
-0007e580: 2870 6f73 5f6c 7374 5b6b 5d2d 4e57 494e  (pos_lst[k]-NWIN
-0007e590: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0007e5a0: 2020 2070 3220 3d20 6d69 6e28 6c65 6e5f     p2 = min(len_
-0007e5b0: 746f 5f74 6573 742c 2870 6f73 5f6c 7374  to_test,(pos_lst
-0007e5c0: 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d 2b4e  [k]+len_lst[k]+N
-0007e5d0: 5749 4e29 290a 2020 2020 2020 2020 2020  WIN)).          
-0007e5e0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0007e5f0: 2020 2020 2020 2073 6f70 203d 2073 675b         sop = sg[
-0007e600: 7031 3a70 6f73 5f6c 7374 5b6b 5d5d 0a20  p1:pos_lst[k]]. 
-0007e610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0007e620: 6f63 203d 2073 675b 706f 735f 6c73 745b  oc = sg[pos_lst[
-0007e630: 6b5d 3a28 706f 735f 6c73 745b 6b5d 2b6c  k]:(pos_lst[k]+l
-0007e640: 656e 5f6c 7374 5b6b 5d29 5d0a 2020 2020  en_lst[k])].    
-0007e650: 2020 2020 2020 2020 2020 2020 736f 6e20              son 
-0007e660: 3d20 7367 5b28 706f 735f 6c73 745b 6b5d  = sg[(pos_lst[k]
-0007e670: 2b6c 656e 5f6c 7374 5b6b 5d29 3a70 325d  +len_lst[k]):p2]
-0007e680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007e690: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0007e6a0: 2020 736e 7020 3d20 7372 5b70 313a 706f    snp = sr[p1:po
-0007e6b0: 735f 6c73 745b 6b5d 5d0a 2020 2020 2020  s_lst[k]].      
-0007e6c0: 2020 2020 2020 2020 2020 736e 6320 3d20            snc = 
-0007e6d0: 7372 5b70 6f73 5f6c 7374 5b6b 5d3a 2870  sr[pos_lst[k]:(p
-0007e6e0: 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73  os_lst[k]+len_ls
-0007e6f0: 745b 6b5d 295d 0a20 2020 2020 2020 2020  t[k])].         
-0007e700: 2020 2020 2020 2073 6e6e 203d 2073 725b         snn = sr[
-0007e710: 2870 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f  (pos_lst[k]+len_
-0007e720: 6c73 745b 6b5d 293a 7032 5d0a 2020 2020  lst[k]):p2].    
-0007e730: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007e740: 2020 2020 2020 2020 2020 2020 2073 6920               si 
-0007e750: 3d20 534e 565f 696e 666f 2863 6872 6d2c  = SNV_info(chrm,
-0007e760: 2070 6f73 5f6c 7374 5b6b 5d2b 706f 735f   pos_lst[k]+pos_
-0007e770: 6162 732c 2070 6f73 5f6c 7374 5b6b 5d2b  abs, pos_lst[k]+
-0007e780: 706f 735f 6162 732b 6f73 2c20 6769 6e5b  pos_abs+os, gin[
-0007e790: 305d 2c20 6769 6e5b 315d 2c20 2756 272c  0], gin[1], 'V',
-0007e7a0: 206c 656e 5f6c 7374 5b6b 5d2c 205c 0a20   len_lst[k], \. 
-0007e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e7c0: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-0007e7d0: 2863 725b 706f 735f 6c73 745b 6b5d 5d29  (cr[pos_lst[k]])
-0007e7e0: 2c20 312c 2073 6f70 2c20 736f 632c 2073  , 1, sop, soc, s
-0007e7f0: 6f6e 2c20 736e 702c 2073 6e63 2c20 736e  on, snp, snc, sn
-0007e800: 6e20 290a 2020 2020 2020 2020 2020 2020  n ).            
-0007e810: 2020 2020 736e 765f 696e 666f 5f6c 7374      snv_info_lst
-0007e820: 2e61 7070 656e 6428 7369 290a 0a20 2020  .append(si)..   
-0007e830: 2020 2020 2073 7461 7274 203d 2065 6e64       start = end
-0007e840: 0a20 2020 2020 2020 2065 6e64 203d 206d  .        end = m
-0007e850: 696e 2820 656e 6420 2b20 3130 302c 206c  in( end + 100, l
-0007e860: 656e 5f74 6f5f 7465 7374 2029 0a20 2020  en_to_test ).   
-0007e870: 2023 2727 2720 2020 2020 2020 2020 0a20   #'''         . 
-0007e880: 2020 2072 6574 7572 6e28 736e 765f 696e     return(snv_in
-0007e890: 666f 5f6c 7374 290a 0a0a 6465 6620 6669  fo_lst)...def fi
-0007e8a0: 6e64 5f73 6e70 2873 672c 2073 722c 2063  nd_snp(sg, sr, c
-0007e8b0: 6d61 742c 2063 6872 6d2c 2070 6f73 5f61  mat, chrm, pos_a
-0007e8c0: 6273 2c20 6f73 2c20 6769 6e29 3a0a 2020  bs, os, gin):.  
-0007e8d0: 2020 0a20 2020 2073 6e76 5f69 6e66 6f5f    .    snv_info_
-0007e8e0: 6c73 7420 3d20 5b5d 0a20 2020 206c 656e  lst = [].    len
-0007e8f0: 5f74 6f5f 7465 7374 203d 206d 696e 286c  _to_test = min(l
-0007e900: 656e 2873 7229 2c6c 656e 2873 6729 290a  en(sr),len(sg)).
-0007e910: 0a20 2020 2063 7220 3d20 636d 6174 2e73  .    cr = cmat.s
-0007e920: 756d 2861 7869 7320 3d20 3029 0a20 2020  um(axis = 0).   
-0007e930: 206e 7320 3d20 6e70 2e61 7267 6d61 7828   ns = np.argmax(
-0007e940: 2063 6d61 742c 2061 7869 733d 3020 290a   cmat, axis=0 ).
-0007e950: 2020 2020 7072 203d 2063 6d61 745b 6e73      pr = cmat[ns
-0007e960: 2c6e 702e 6172 616e 6765 286c 656e 286e  ,np.arange(len(n
-0007e970: 7329 295d 2f63 720a 0a20 2020 2070 203d  s))]/cr..    p =
-0007e980: 2030 0a20 2020 2070 6f73 5f6c 7374 203d   0.    pos_lst =
-0007e990: 205b 5d0a 2020 2020 6c65 6e5f 6c73 7420   [].    len_lst 
-0007e9a0: 3d20 5b5d 0a20 2020 2063 7667 5f6c 7374  = [].    cvg_lst
-0007e9b0: 203d 205b 5d0a 2020 2020 6366 725f 6c73   = [].    cfr_ls
-0007e9c0: 7420 3d20 5b5d 0a20 2020 2073 6e70 5f6c  t = [].    snp_l
-0007e9d0: 7374 203d 205b 5d0a 2020 2020 736e 705f  st = [].    snp_
-0007e9e0: 6f72 675f 6c73 7420 3d20 5b5d 0a20 2020  org_lst = [].   
-0007e9f0: 200a 2020 2020 666f 7220 6b20 696e 2072   .    for k in r
-0007ea00: 616e 6765 286c 656e 5f74 6f5f 7465 7374  ange(len_to_test
-0007ea10: 293a 0a20 2020 2020 2020 2069 6620 7372  ):.        if sr
-0007ea20: 5b6b 5d20 213d 2073 675b 6b5d 3a0a 2020  [k] != sg[k]:.  
-0007ea30: 2020 2020 2020 2020 2020 6966 2070 203d            if p =
-0007ea40: 3d20 303a 2070 6f73 203d 206b 0a20 2020  = 0: pos = k.   
-0007ea50: 2020 2020 2020 2020 2070 202b 3d20 310a           p += 1.
-0007ea60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0007ea70: 2020 2020 2020 2020 2020 6966 2070 203e            if p >
-0007ea80: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0007ea90: 2020 2020 2320 6376 675f 6c73 742e 6170      # cvg_lst.ap
-0007eaa0: 7065 6e64 286e 702e 6d65 616e 2820 6372  pend(np.mean( cr
-0007eab0: 5b70 6f73 3a28 706f 732b 7029 5d20 2920  [pos:(pos+p)] ) 
-0007eac0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0007ead0: 2020 2320 736e 705f 6c73 742e 6170 7065    # snp_lst.appe
-0007eae0: 6e64 2873 725b 706f 733a 2870 6f73 2b70  nd(sr[pos:(pos+p
-0007eaf0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
-0007eb00: 2020 2020 706f 735f 6c73 742e 6170 7065      pos_lst.appe
-0007eb10: 6e64 2870 6f73 290a 2020 2020 2020 2020  nd(pos).        
-0007eb20: 2020 2020 2020 2020 6c65 6e5f 6c73 742e          len_lst.
-0007eb30: 6170 7065 6e64 2870 290a 2020 2020 2020  append(p).      
-0007eb40: 2020 2020 2020 2020 2020 2320 736e 705f            # snp_
-0007eb50: 6f72 675f 6c73 742e 6170 7065 6e64 2873  org_lst.append(s
-0007eb60: 675b 706f 733a 2870 6f73 2b70 295d 290a  g[pos:(pos+p)]).
+0007e4d0: 2020 2070 6f73 5f6c 7374 2e61 7070 656e     pos_lst.appen
+0007e4e0: 6428 706f 7329 0a20 2020 2020 2020 2020  d(pos).         
+0007e4f0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0007e500: 656e 5f6c 7374 2e61 7070 656e 6428 7029  en_lst.append(p)
+0007e510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e520: 2020 2020 2020 2020 2023 2073 6e70 5f6f           # snp_o
+0007e530: 7267 5f6c 7374 2e61 7070 656e 6428 7367  rg_lst.append(sg
+0007e540: 5b70 6f73 3a28 706f 732b 7029 5d29 0a20  [pos:(pos+p)]). 
+0007e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e560: 2020 2020 2020 2070 203d 2030 0a20 2020         p = 0.   
+0007e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e580: 200a 2020 2020 2020 2020 2020 2020 666f   .            fo
+0007e590: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
+0007e5a0: 2870 6f73 5f6c 7374 2929 3a0a 2020 2020  (pos_lst)):.    
+0007e5b0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0007e5c0: 2020 2020 2020 2020 2020 2020 2070 3120               p1 
+0007e5d0: 3d20 6d61 7828 302c 2870 6f73 5f6c 7374  = max(0,(pos_lst
+0007e5e0: 5b6b 5d2d 4e57 494e 2929 0a20 2020 2020  [k]-NWIN)).     
+0007e5f0: 2020 2020 2020 2020 2020 2070 3220 3d20             p2 = 
+0007e600: 6d69 6e28 6c65 6e5f 746f 5f74 6573 742c  min(len_to_test,
+0007e610: 2870 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f  (pos_lst[k]+len_
+0007e620: 6c73 745b 6b5d 2b4e 5749 4e29 290a 2020  lst[k]+NWIN)).  
+0007e630: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0007e640: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0007e650: 6f70 203d 2073 675b 7031 3a70 6f73 5f6c  op = sg[p1:pos_l
+0007e660: 7374 5b6b 5d5d 0a20 2020 2020 2020 2020  st[k]].         
+0007e670: 2020 2020 2020 2073 6f63 203d 2073 675b         soc = sg[
+0007e680: 706f 735f 6c73 745b 6b5d 3a28 706f 735f  pos_lst[k]:(pos_
+0007e690: 6c73 745b 6b5d 2b6c 656e 5f6c 7374 5b6b  lst[k]+len_lst[k
+0007e6a0: 5d29 5d0a 2020 2020 2020 2020 2020 2020  ])].            
+0007e6b0: 2020 2020 736f 6e20 3d20 7367 5b28 706f      son = sg[(po
+0007e6c0: 735f 6c73 745b 6b5d 2b6c 656e 5f6c 7374  s_lst[k]+len_lst
+0007e6d0: 5b6b 5d29 3a70 325d 0a20 2020 2020 2020  [k]):p2].       
+0007e6e0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0007e6f0: 2020 2020 2020 2020 2020 736e 7020 3d20            snp = 
+0007e700: 7372 5b70 313a 706f 735f 6c73 745b 6b5d  sr[p1:pos_lst[k]
+0007e710: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0007e720: 2020 736e 6320 3d20 7372 5b70 6f73 5f6c    snc = sr[pos_l
+0007e730: 7374 5b6b 5d3a 2870 6f73 5f6c 7374 5b6b  st[k]:(pos_lst[k
+0007e740: 5d2b 6c65 6e5f 6c73 745b 6b5d 295d 0a20  ]+len_lst[k])]. 
+0007e750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0007e760: 6e6e 203d 2073 725b 2870 6f73 5f6c 7374  nn = sr[(pos_lst
+0007e770: 5b6b 5d2b 6c65 6e5f 6c73 745b 6b5d 293a  [k]+len_lst[k]):
+0007e780: 7032 5d0a 2020 2020 2020 2020 2020 2020  p2].            
+0007e790: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0007e7a0: 2020 2020 2073 6920 3d20 534e 565f 696e       si = SNV_in
+0007e7b0: 666f 2863 6872 6d2c 2070 6f73 5f6c 7374  fo(chrm, pos_lst
+0007e7c0: 5b6b 5d2b 706f 735f 6162 732c 2070 6f73  [k]+pos_abs, pos
+0007e7d0: 5f6c 7374 5b6b 5d2b 706f 735f 6162 732b  _lst[k]+pos_abs+
+0007e7e0: 6f73 2c20 6769 6e5b 305d 2c20 6769 6e5b  os, gin[0], gin[
+0007e7f0: 315d 2c20 2756 272c 206c 656e 5f6c 7374  1], 'V', len_lst
+0007e800: 5b6b 5d2c 205c 0a20 2020 2020 2020 2020  [k], \.         
+0007e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e820: 2020 2020 2069 6e74 2863 725b 706f 735f       int(cr[pos_
+0007e830: 6c73 745b 6b5d 5d29 2c20 312c 2073 6f70  lst[k]]), 1, sop
+0007e840: 2c20 736f 632c 2073 6f6e 2c20 736e 702c  , soc, son, snp,
+0007e850: 2073 6e63 2c20 736e 6e20 290a 2020 2020   snc, snn ).    
+0007e860: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
+0007e870: 696e 666f 5f6c 7374 2e61 7070 656e 6428  info_lst.append(
+0007e880: 7369 290a 0a20 2020 2020 2020 2073 7461  si)..        sta
+0007e890: 7274 203d 2065 6e64 0a20 2020 2020 2020  rt = end.       
+0007e8a0: 2065 6e64 203d 206d 696e 2820 656e 6420   end = min( end 
+0007e8b0: 2b20 3130 302c 206c 656e 5f74 6f5f 7465  + 100, len_to_te
+0007e8c0: 7374 2029 0a20 2020 2023 2727 2720 2020  st ).    #'''   
+0007e8d0: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
+0007e8e0: 6e28 736e 765f 696e 666f 5f6c 7374 290a  n(snv_info_lst).
+0007e8f0: 0a0a 6465 6620 6669 6e64 5f73 6e70 2873  ..def find_snp(s
+0007e900: 672c 2073 722c 2063 6d61 742c 2063 6872  g, sr, cmat, chr
+0007e910: 6d2c 2070 6f73 5f61 6273 2c20 6f73 2c20  m, pos_abs, os, 
+0007e920: 6769 6e29 3a0a 2020 2020 0a20 2020 2073  gin):.    .    s
+0007e930: 6e76 5f69 6e66 6f5f 6c73 7420 3d20 5b5d  nv_info_lst = []
+0007e940: 0a20 2020 206c 656e 5f74 6f5f 7465 7374  .    len_to_test
+0007e950: 203d 206d 696e 286c 656e 2873 7229 2c6c   = min(len(sr),l
+0007e960: 656e 2873 6729 290a 0a20 2020 2063 7220  en(sg))..    cr 
+0007e970: 3d20 636d 6174 2e73 756d 2861 7869 7320  = cmat.sum(axis 
+0007e980: 3d20 3029 0a20 2020 206e 7320 3d20 6e70  = 0).    ns = np
+0007e990: 2e61 7267 6d61 7828 2063 6d61 742c 2061  .argmax( cmat, a
+0007e9a0: 7869 733d 3020 290a 2020 2020 7072 203d  xis=0 ).    pr =
+0007e9b0: 2063 6d61 745b 6e73 2c6e 702e 6172 616e   cmat[ns,np.aran
+0007e9c0: 6765 286c 656e 286e 7329 295d 2f63 720a  ge(len(ns))]/cr.
+0007e9d0: 0a20 2020 2070 203d 2030 0a20 2020 2070  .    p = 0.    p
+0007e9e0: 6f73 5f6c 7374 203d 205b 5d0a 2020 2020  os_lst = [].    
+0007e9f0: 6c65 6e5f 6c73 7420 3d20 5b5d 0a20 2020  len_lst = [].   
+0007ea00: 2063 7667 5f6c 7374 203d 205b 5d0a 2020   cvg_lst = [].  
+0007ea10: 2020 6366 725f 6c73 7420 3d20 5b5d 0a20    cfr_lst = []. 
+0007ea20: 2020 2073 6e70 5f6c 7374 203d 205b 5d0a     snp_lst = [].
+0007ea30: 2020 2020 736e 705f 6f72 675f 6c73 7420      snp_org_lst 
+0007ea40: 3d20 5b5d 0a20 2020 200a 2020 2020 666f  = [].    .    fo
+0007ea50: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
+0007ea60: 5f74 6f5f 7465 7374 293a 0a20 2020 2020  _to_test):.     
+0007ea70: 2020 2069 6620 7372 5b6b 5d20 213d 2073     if sr[k] != s
+0007ea80: 675b 6b5d 3a0a 2020 2020 2020 2020 2020  g[k]:.          
+0007ea90: 2020 6966 2070 203d 3d20 303a 2070 6f73    if p == 0: pos
+0007eaa0: 203d 206b 0a20 2020 2020 2020 2020 2020   = k.           
+0007eab0: 2070 202b 3d20 310a 2020 2020 2020 2020   p += 1.        
+0007eac0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0007ead0: 2020 6966 2070 203e 2030 3a0a 2020 2020    if p > 0:.    
+0007eae0: 2020 2020 2020 2020 2020 2020 2320 6376              # cv
+0007eaf0: 675f 6c73 742e 6170 7065 6e64 286e 702e  g_lst.append(np.
+0007eb00: 6d65 616e 2820 6372 5b70 6f73 3a28 706f  mean( cr[pos:(po
+0007eb10: 732b 7029 5d20 2920 290a 2020 2020 2020  s+p)] ) ).      
+0007eb20: 2020 2020 2020 2020 2020 2320 736e 705f            # snp_
+0007eb30: 6c73 742e 6170 7065 6e64 2873 725b 706f  lst.append(sr[po
+0007eb40: 733a 2870 6f73 2b70 295d 290a 2020 2020  s:(pos+p)]).    
+0007eb50: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
+0007eb60: 6c73 742e 6170 7065 6e64 2870 6f73 290a  lst.append(pos).
 0007eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007eb80: 7020 3d20 300a 2020 2020 2020 2020 2020  p = 0.          
-0007eb90: 2020 0a20 2020 2066 6f72 206b 2069 6e20    .    for k in 
-0007eba0: 7261 6e67 6528 6c65 6e28 706f 735f 6c73  range(len(pos_ls
-0007ebb0: 7429 293a 0a20 2020 2020 2020 200a 2020  t)):.        .  
-0007ebc0: 2020 2020 2020 7031 203d 206d 6178 2830        p1 = max(0
-0007ebd0: 2c28 706f 735f 6c73 745b 6b5d 2d4e 5749  ,(pos_lst[k]-NWI
-0007ebe0: 4e29 290a 2020 2020 2020 2020 7032 203d  N)).        p2 =
-0007ebf0: 206d 696e 286c 656e 5f74 6f5f 7465 7374   min(len_to_test
-0007ec00: 2c28 706f 735f 6c73 745b 6b5d 2b6c 656e  ,(pos_lst[k]+len
-0007ec10: 5f6c 7374 5b6b 5d2b 4e57 494e 2929 0a20  _lst[k]+NWIN)). 
-0007ec20: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0007ec30: 736f 7020 3d20 7367 5b70 313a 706f 735f  sop = sg[p1:pos_
-0007ec40: 6c73 745b 6b5d 5d0a 2020 2020 2020 2020  lst[k]].        
-0007ec50: 736f 6320 3d20 7367 5b70 6f73 5f6c 7374  soc = sg[pos_lst
-0007ec60: 5b6b 5d3a 2870 6f73 5f6c 7374 5b6b 5d2b  [k]:(pos_lst[k]+
-0007ec70: 6c65 6e5f 6c73 745b 6b5d 295d 0a20 2020  len_lst[k])].   
-0007ec80: 2020 2020 2073 6f6e 203d 2073 675b 2870       son = sg[(p
-0007ec90: 6f73 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73  os_lst[k]+len_ls
-0007eca0: 745b 6b5d 293a 7032 5d0a 2020 2020 2020  t[k]):p2].      
-0007ecb0: 2020 0a20 2020 2020 2020 2073 6e70 203d    .        snp =
-0007ecc0: 2073 725b 7031 3a70 6f73 5f6c 7374 5b6b   sr[p1:pos_lst[k
-0007ecd0: 5d5d 0a20 2020 2020 2020 2073 6e63 203d  ]].        snc =
-0007ece0: 2073 725b 706f 735f 6c73 745b 6b5d 3a28   sr[pos_lst[k]:(
-0007ecf0: 706f 735f 6c73 745b 6b5d 2b6c 656e 5f6c  pos_lst[k]+len_l
-0007ed00: 7374 5b6b 5d29 5d0a 2020 2020 2020 2020  st[k])].        
-0007ed10: 736e 6e20 3d20 7372 5b28 706f 735f 6c73  snn = sr[(pos_ls
-0007ed20: 745b 6b5d 2b6c 656e 5f6c 7374 5b6b 5d29  t[k]+len_lst[k])
-0007ed30: 3a70 325d 0a20 2020 2020 2020 200a 2020  :p2].        .  
-0007ed40: 2020 2020 2020 7369 203d 2053 4e56 5f69        si = SNV_i
-0007ed50: 6e66 6f28 6368 726d 2c20 706f 735f 6c73  nfo(chrm, pos_ls
-0007ed60: 745b 6b5d 2b70 6f73 5f61 6273 2c20 706f  t[k]+pos_abs, po
-0007ed70: 735f 6c73 745b 6b5d 2b70 6f73 5f61 6273  s_lst[k]+pos_abs
-0007ed80: 2b6f 732c 2067 696e 5b30 5d2c 2067 696e  +os, gin[0], gin
-0007ed90: 5b31 5d2c 2027 5627 2c20 6c65 6e5f 6c73  [1], 'V', len_ls
-0007eda0: 745b 6b5d 2c20 5c0a 2020 2020 2020 2020  t[k], \.        
-0007edb0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0007edc0: 7428 6372 5b70 6f73 5f6c 7374 5b6b 5d5d  t(cr[pos_lst[k]]
-0007edd0: 292c 206e 702e 726f 756e 6428 7072 5b70  ), np.round(pr[p
-0007ede0: 6f73 5f6c 7374 5b6b 5d5d 2c33 292c 2073  os_lst[k]],3), s
-0007edf0: 6f70 2c20 736f 632c 2073 6f6e 2c20 736e  op, soc, son, sn
-0007ee00: 702c 2073 6e63 2c20 736e 6e20 290a 2020  p, snc, snn ).  
-0007ee10: 2020 2020 2020 736e 765f 696e 666f 5f6c        snv_info_l
-0007ee20: 7374 2e61 7070 656e 6428 7369 290a 0a20  st.append(si).. 
-0007ee30: 2020 2072 6574 7572 6e28 736e 765f 696e     return(snv_in
-0007ee40: 666f 5f6c 7374 290a 0a0a 6465 6620 636f  fo_lst)...def co
-0007ee50: 6d70 6172 655f 7365 7132 2820 7331 2c20  mpare_seq2( s1, 
-0007ee60: 7332 2029 3a0a 2020 2020 636e 7420 3d20  s2 ):.    cnt = 
-0007ee70: 300a 2020 2020 666f 7220 6920 696e 2072  0.    for i in r
-0007ee80: 616e 6765 286d 696e 286c 656e 2873 3129  ange(min(len(s1)
-0007ee90: 2c6c 656e 2873 3229 2929 3a0a 2020 2020  ,len(s2))):.    
-0007eea0: 2020 2020 636e 7420 2b3d 2028 7331 5b69      cnt += (s1[i
-0007eeb0: 5d20 213d 2073 325b 695d 290a 2020 2020  ] != s2[i]).    
-0007eec0: 2320 6966 206c 656e 2873 3129 2021 3d20  # if len(s1) != 
-0007eed0: 6c65 6e28 7332 293a 2070 7269 6e74 2827  len(s2): print('
-0007eee0: 5741 524e 494e 4720 696e 2063 6f6d 7061  WARNING in compa
-0007eef0: 7265 5f73 6571 323a 2025 6920 213d 2025  re_seq2: %i != %
-0007ef00: 6927 2025 2028 6c65 6e28 7331 292c 6c65  i' % (len(s1),le
-0007ef10: 6e28 7332 2929 2029 0a20 2020 2072 6574  n(s2)) ).    ret
-0007ef20: 7572 6e20 636e 740a 0a0a 4f53 5f69 6e66  urn cnt...OS_inf
-0007ef30: 6f20 3d20 636f 6c6c 6563 7469 6f6e 732e  o = collections.
-0007ef40: 6e61 6d65 6474 7570 6c65 2827 4f53 5f69  namedtuple('OS_i
-0007ef50: 6e66 6f27 2c20 276f 732c 2073 7461 7274  nfo', 'os, start
-0007ef60: 2c20 656e 6427 2920 2320 6f6e 652d 6261  , end') # one-ba
-0007ef70: 7365 0a0a 636c 6173 7320 6f66 6673 6574  se..class offset
-0007ef80: 5f66 696e 6465 723a 0a20 2020 200a 2020  _finder:.    .  
-0007ef90: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0007efa0: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
-0007efb0: 6c66 2e6f 7369 5f6c 7374 203d 205b 5d0a  lf.osi_lst = [].
-0007efc0: 2020 2020 2020 2020 7365 6c66 2e6f 735f          self.os_
-0007efd0: 6d61 7020 3d20 4e6f 6e65 0a20 2020 2020  map = None.     
-0007efe0: 2020 2073 656c 662e 6f73 5f70 7265 7620     self.os_prev 
-0007eff0: 3d20 300a 2020 2020 2020 2020 0a20 2020  = 0.        .   
-0007f000: 2064 6566 2061 6464 2820 7365 6c66 2c20   def add( self, 
-0007f010: 6f73 2c20 7374 6172 742c 2065 6e64 293a  os, start, end):
-0007f020: 0a20 2020 2020 2020 2073 656c 662e 6f73  .        self.os
-0007f030: 695f 6c73 742e 6170 7065 6e64 2820 4f53  i_lst.append( OS
-0007f040: 5f69 6e66 6f28 6f73 2c20 7374 6172 742c  _info(os, start,
-0007f050: 2065 6e64 2920 290a 2020 2020 2020 2020   end) ).        
-0007f060: 0a20 2020 2064 6566 2066 696e 645f 6f73  .    def find_os
-0007f070: 2820 7365 6c66 2c20 706f 7320 293a 0a20  ( self, pos ):. 
-0007f080: 2020 2020 2020 206f 7320 3d20 300a 2020         os = 0.  
-0007f090: 2020 2020 2020 666f 7220 6f73 6920 696e        for osi in
-0007f0a0: 2073 656c 662e 6f73 695f 6c73 743a 0a20   self.osi_lst:. 
-0007f0b0: 2020 2020 2020 2020 2020 2069 6620 2870             if (p
-0007f0c0: 6f73 203e 3d20 6f73 692e 7374 6172 7429  os >= osi.start)
-0007f0d0: 2026 2028 706f 7320 3c20 6f73 692e 656e   & (pos < osi.en
-0007f0e0: 6429 3a20 0a20 2020 2020 2020 2020 2020  d): .           
-0007f0f0: 2020 2020 206f 7320 3d20 6f73 692e 6f73       os = osi.os
-0007f100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f110: 2062 7265 616b 0a20 2020 2020 2020 2072   break.        r
-0007f120: 6574 7572 6e20 6f73 0a0a 2020 2020 0a20  eturn os..    . 
-0007f130: 2020 2064 6566 2066 696e 645f 6f73 5f73     def find_os_s
-0007f140: 6571 2820 7365 6c66 2c20 706f 732c 2070  eq( self, pos, p
-0007f150: 7265 765f 692c 206d 6172 6b20 3d20 2727  rev_i, mark = ''
-0007f160: 2029 3a0a 2020 2020 2020 2020 6f73 203d   ):.        os =
-0007f170: 204e 6f6e 650a 2020 2020 2020 2020 6e65   None.        ne
-0007f180: 7874 5f69 203d 2030 0a20 2020 2020 2020  xt_i = 0.       
-0007f190: 2066 6f72 206b 2c20 6f73 6920 696e 2065   for k, osi in e
-0007f1a0: 6e75 6d65 7261 7465 2873 656c 662e 6f73  numerate(self.os
-0007f1b0: 695f 6c73 745b 7072 6576 5f69 3a5d 293a  i_lst[prev_i:]):
-0007f1c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0007f1d0: 2870 6f73 203e 3d20 6f73 692e 7374 6172  (pos >= osi.star
-0007f1e0: 7429 2026 2028 706f 7320 3c20 6f73 692e  t) & (pos < osi.
-0007f1f0: 656e 6429 3a20 0a20 2020 2020 2020 2020  end): .         
-0007f200: 2020 2020 2020 206f 7320 3d20 6f73 692e         os = osi.
-0007f210: 6f73 0a20 2020 2020 2020 2020 2020 2020  os.             
-0007f220: 2020 206e 6578 745f 6920 3d20 6b20 2b20     next_i = k + 
-0007f230: 7072 6576 5f69 200a 2020 2020 2020 2020  prev_i .        
-0007f240: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0007f250: 2020 2020 2020 6966 206f 7320 6973 204e        if os is N
-0007f260: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0007f270: 2066 6f72 206b 2c20 6f73 6920 696e 2065   for k, osi in e
-0007f280: 6e75 6d65 7261 7465 2873 656c 662e 6f73  numerate(self.os
-0007f290: 695f 6c73 745b 3a70 7265 765f 695d 293a  i_lst[:prev_i]):
-0007f2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f2b0: 2069 6620 2870 6f73 203e 3d20 6f73 692e   if (pos >= osi.
-0007f2c0: 7374 6172 7429 2026 2028 706f 7320 3c20  start) & (pos < 
-0007f2d0: 6f73 692e 656e 6429 3a20 0a20 2020 2020  osi.end): .     
-0007f2e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0007f2f0: 7320 3d20 6f73 692e 6f73 0a20 2020 2020  s = osi.os.     
-0007f300: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0007f310: 6578 745f 6920 3d20 6b0a 2020 2020 2020  ext_i = k.      
-0007f320: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0007f330: 6561 6b0a 0a20 2020 2020 2020 2069 6620  eak..        if 
-0007f340: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
-0007f350: 2020 2020 2020 2020 6f73 203d 2073 656c          os = sel
-0007f360: 662e 6f73 5f70 7265 760a 2020 2020 2020  f.os_prev.      
-0007f370: 2020 2020 2020 2320 7072 696e 7428 2745        # print('E
-0007f380: 5252 4f52 2069 6e20 6669 6e64 5f6f 735f  RROR in find_os_
-0007f390: 7365 713a 206f 7320 6973 204e 6f6e 6520  seq: os is None 
-0007f3a0: 2573 2720 2520 6d61 726b 2029 0a20 2020  %s' % mark ).   
-0007f3b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0007f3c0: 2020 2020 2020 2073 656c 662e 6f73 5f70         self.os_p
-0007f3d0: 7265 7620 3d20 6f73 0a20 2020 2020 2020  rev = os.       
-0007f3e0: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
-0007f3f0: 7475 726e 206f 732c 206e 6578 745f 690a  turn os, next_i.
-0007f400: 2020 2020 0a20 2020 200a 2020 2020 6465      .    .    de
-0007f410: 6620 6d61 6b65 5f69 745f 636f 6d70 6163  f make_it_compac
-0007f420: 7428 2073 656c 6620 293a 0a0a 2020 2020  t( self ):..    
-0007f430: 2020 2020 666f 7220 6b20 696e 2072 6576      for k in rev
-0007f440: 6572 7365 6428 7261 6e67 6528 312c 6c65  ersed(range(1,le
-0007f450: 6e28 7365 6c66 2e6f 7369 5f6c 7374 2929  n(self.osi_lst))
-0007f460: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0007f470: 6620 7365 6c66 2e6f 7369 5f6c 7374 5b6b  f self.osi_lst[k
-0007f480: 5d2e 6f73 203d 3d20 7365 6c66 2e6f 7369  ].os == self.osi
-0007f490: 5f6c 7374 5b6b 2d31 5d2e 6f73 3a0a 2020  _lst[k-1].os:.  
-0007f4a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0007f4b0: 6c66 2e6f 7369 5f6c 7374 5b6b 2d31 5d20  lf.osi_lst[k-1] 
-0007f4c0: 3d20 4f53 5f69 6e66 6f28 2073 656c 662e  = OS_info( self.
-0007f4d0: 6f73 695f 6c73 745b 6b2d 315d 2e6f 732c  osi_lst[k-1].os,
-0007f4e0: 2073 656c 662e 6f73 695f 6c73 745b 6b2d   self.osi_lst[k-
-0007f4f0: 315d 2e73 7461 7274 2c20 7365 6c66 2e6f  1].start, self.o
-0007f500: 7369 5f6c 7374 5b6b 5d2e 656e 6420 290a  si_lst[k].end ).
-0007f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007f520: 6465 6c20 7365 6c66 2e6f 7369 5f6c 7374  del self.osi_lst
-0007f530: 5b6b 5d0a 2020 2020 2020 2020 0a20 2020  [k].        .   
-0007f540: 2064 6566 2067 6574 5f62 6e64 7279 2820   def get_bndry( 
-0007f550: 7365 6c66 2c20 706f 7320 293a 0a20 2020  self, pos ):.   
-0007f560: 2020 2020 206f 7320 3d20 300a 2020 2020       os = 0.    
-0007f570: 2020 2020 666f 7220 6f73 6920 696e 2073      for osi in s
-0007f580: 656c 662e 6f73 695f 6c73 743a 0a20 2020  elf.osi_lst:.   
-0007f590: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
-0007f5a0: 203e 3d20 6f73 692e 7374 6172 7429 3a20   >= osi.start): 
-0007f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0007f5c0: 206f 7320 3d20 6f73 692e 7374 6172 740a   os = osi.start.
-0007f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007f5e0: 6272 6561 6b0a 2020 2020 2020 2020 7265  break.        re
-0007f5f0: 7475 726e 206f 730a 2020 2020 0a20 2020  turn os.    .   
-0007f600: 2064 6566 2067 6574 5f62 6e64 7279 5f73   def get_bndry_s
-0007f610: 6571 2820 7365 6c66 2c20 706f 732c 2070  eq( self, pos, p
-0007f620: 7265 765f 6920 293a 0a20 2020 2020 2020  rev_i ):.       
-0007f630: 206f 7320 3d20 4e6f 6e65 0a20 2020 2020   os = None.     
-0007f640: 2020 206e 6578 745f 6920 3d20 300a 2020     next_i = 0.  
-0007f650: 2020 2020 2020 666f 7220 6b2c 206f 7369        for k, osi
-0007f660: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-0007f670: 6c66 2e6f 7369 5f6c 7374 5b70 7265 765f  lf.osi_lst[prev_
-0007f680: 693a 5d29 3a0a 2020 2020 2020 2020 2020  i:]):.          
-0007f690: 2020 6966 2028 706f 7320 3e3d 206f 7369    if (pos >= osi
-0007f6a0: 2e73 7461 7274 2920 2620 2870 6f73 203c  .start) & (pos <
-0007f6b0: 206f 7369 2e65 6e64 293a 200a 2020 2020   osi.end): .    
-0007f6c0: 2020 2020 2020 2020 2020 2020 6f73 203d              os =
-0007f6d0: 206f 7369 2e73 7461 7274 0a20 2020 2020   osi.start.     
-0007f6e0: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-0007f6f0: 6920 3d20 6b20 2b20 7072 6576 5f69 200a  i = k + prev_i .
-0007f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007f710: 6272 6561 6b0a 2020 2020 2020 2020 6966  break.        if
-0007f720: 206f 7320 6973 204e 6f6e 653a 0a20 2020   os is None:.   
-0007f730: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
-0007f740: 6f73 6920 696e 2065 6e75 6d65 7261 7465  osi in enumerate
-0007f750: 2873 656c 662e 6f73 695f 6c73 745b 3a70  (self.osi_lst[:p
-0007f760: 7265 765f 695d 293a 0a20 2020 2020 2020  rev_i]):.       
-0007f770: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
-0007f780: 203e 3d20 6f73 692e 7374 6172 7429 2026   >= osi.start) &
-0007f790: 2028 706f 7320 3c20 6f73 692e 656e 6429   (pos < osi.end)
-0007f7a0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0007f7b0: 2020 2020 2020 206f 7320 3d20 6f73 692e         os = osi.
-0007f7c0: 7374 6172 740a 2020 2020 2020 2020 2020  start.          
-0007f7d0: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
-0007f7e0: 203d 206b 0a20 2020 2020 2020 2020 2020   = k.           
-0007f7f0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-0007f800: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0007f810: 2020 2020 6966 206f 7320 6973 204e 6f6e      if os is Non
-0007f820: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-0007f830: 7320 3d20 300a 2020 2020 2020 2020 2020  s = 0.          
-0007f840: 2020 6e65 7874 5f69 203d 2030 0a20 2020    next_i = 0.   
-0007f850: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0007f860: 4552 524f 5220 696e 2067 6574 5f62 6e64  ERROR in get_bnd
-0007f870: 7279 5f73 6571 3a20 6f73 2069 7320 4e6f  ry_seq: os is No
-0007f880: 6e65 2729 0a20 2020 2020 2020 2020 2020  ne').           
-0007f890: 2023 2073 656c 662e 7072 696e 7428 290a   # self.print().
-0007f8a0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0007f8b0: 2020 2020 2072 6574 7572 6e20 6f73 2c20       return os, 
-0007f8c0: 6e65 7874 5f69 0a20 2020 200a 2020 2020  next_i.    .    
-0007f8d0: 0a20 2020 2064 6566 2070 7269 6e74 2873  .    def print(s
-0007f8e0: 656c 6629 3a0a 2020 2020 2020 2020 666f  elf):.        fo
-0007f8f0: 7220 6f73 6920 696e 2073 656c 662e 6f73  r osi in self.os
-0007f900: 695f 6c73 743a 0a20 2020 2020 2020 2020  i_lst:.         
-0007f910: 2020 2070 7269 6e74 2827 2569 202d 2025     print('%i - %
-0007f920: 693a 2025 6927 2025 2028 6f73 692e 7374  i: %i' % (osi.st
-0007f930: 6172 742c 206f 7369 2e65 6e64 2c20 6f73  art, osi.end, os
-0007f940: 692e 6f73 2929 0a0a 2020 2020 2020 2020  i.os))..        
-0007f950: 2020 2020 0a64 6566 2047 656e 6572 6174      .def Generat
-0007f960: 655f 5265 6665 7265 6e63 6528 6774 665f  e_Reference(gtf_
-0007f970: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
-0007f980: 652c 2070 6570 7469 6465 203d 2054 7275  e, peptide = Tru
-0007f990: 652c 206f 7574 5f64 6972 203d 204e 6f6e  e, out_dir = Non
-0007f9a0: 652c 2073 7566 6669 7820 3d20 4e6f 6e65  e, suffix = None
-0007f9b0: 293a 0a0a 2020 2020 6765 6e6f 6d65 203d  ):..    genome =
-0007f9c0: 206c 6f61 645f 6765 6e6f 6d65 2867 656e   load_genome(gen
-0007f9d0: 6f6d 655f 6669 6c65 2c20 7665 7262 6f73  ome_file, verbos
-0007f9e0: 6520 3d20 5472 7565 290a 0a20 2020 2067  e = True)..    g
-0007f9f0: 7466 5f6c 696e 6573 2c20 6864 725f 6c69  tf_lines, hdr_li
-0007fa00: 6e65 7320 3d20 6c6f 6164 5f67 7466 2867  nes = load_gtf(g
-0007fa10: 7466 5f66 696c 652c 2076 6572 626f 7365  tf_file, verbose
-0007fa20: 203d 2054 7275 6529 0a20 2020 2067 645f   = True).    gd_
-0007fa30: 6c73 742c 2063 6872 7320 3d20 6765 745f  lst, chrs = get_
-0007fa40: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
-0007fa50: 6774 665f 6c69 6e65 732c 2067 656e 6f6d  gtf_lines, genom
-0007fa60: 6520 3d20 4e6f 6e65 2c20 6669 6c6c 203d  e = None, fill =
-0007fa70: 2046 616c 7365 2c20 5c0a 2020 2020 2020   False, \.      
-0007fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007faa0: 2020 2020 2063 6720 3d20 4661 6c73 652c       cg = False,
-0007fab0: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
-0007fac0: 206e 5f63 6f72 6573 203d 2031 290a 2020   n_cores = 1).  
-0007fad0: 2020 6764 5f6c 7374 732c 2063 6872 5f6c    gd_lsts, chr_l
-0007fae0: 7374 203d 2070 6163 6b5f 6765 6e65 5f64  st = pack_gene_d
-0007faf0: 6573 6372 6970 746f 7228 2067 645f 6c73  escriptor( gd_ls
-0007fb00: 742c 2063 6872 7320 290a 2020 2020 0a0a  t, chrs ).    ..
-0007fb10: 2020 2020 2320 6669 6c65 5f6e 616d 6520      # file_name 
-0007fb20: 3d20 6774 665f 6669 6c65 2e73 706c 6974  = gtf_file.split
-0007fb30: 2827 2f27 295b 2d31 5d0a 2020 2020 2320  ('/')[-1].    # 
-0007fb40: 666e 7320 3d20 6669 6c65 5f6e 616d 652e  fns = file_name.
-0007fb50: 7370 6c69 7428 272e 2729 5b3a 2d31 5d0a  split('.')[:-1].
-0007fb60: 2020 2020 666e 7320 3d20 6774 665f 6669      fns = gtf_fi
-0007fb70: 6c65 2e73 706c 6974 2827 2e27 295b 3a2d  le.split('.')[:-
-0007fb80: 315d 0a20 2020 2066 6e61 6d65 203d 2027  1].    fname = '
-0007fb90: 270a 2020 2020 666f 7220 6b2c 2066 6e20  '.    for k, fn 
-0007fba0: 696e 2065 6e75 6d65 7261 7465 2866 6e73  in enumerate(fns
-0007fbb0: 293a 0a20 2020 2020 2020 2069 6620 6b20  ):.        if k 
-0007fbc0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0007fbd0: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
-0007fbe0: 2027 2e27 0a20 2020 2020 2020 2066 6e61   '.'.        fna
-0007fbf0: 6d65 203d 2066 6e61 6d65 202b 2066 6e0a  me = fname + fn.
-0007fc00: 2020 2020 6966 206f 7574 5f64 6972 2069      if out_dir i
-0007fc10: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0007fc20: 2020 2020 6966 206f 7574 5f64 6972 5b2d      if out_dir[-
-0007fc30: 315d 203d 3d20 272f 273a 0a20 2020 2020  1] == '/':.     
-0007fc40: 2020 2020 2020 2066 6e61 6d65 203d 206f         fname = o
-0007fc50: 7574 5f64 6972 202b 2066 6e61 6d65 0a20  ut_dir + fname. 
-0007fc60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0007fc70: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
-0007fc80: 206f 7574 5f64 6972 202b 2027 2f27 202b   out_dir + '/' +
-0007fc90: 2066 6e61 6d65 0a0a 2020 2020 6966 2073   fname..    if s
-0007fca0: 7566 6669 7820 6973 204e 6f6e 653a 2020  uffix is None:  
-0007fcb0: 2020 0a20 2020 2020 2020 2066 615f 6669    .        fa_fi
-0007fcc0: 6c65 5f74 7220 3d20 666e 616d 6520 2b20  le_tr = fname + 
-0007fcd0: 275f 7472 616e 7363 7269 7074 6f6d 652e  '_transcriptome.
-0007fce0: 6661 270a 2020 2020 2020 2020 6661 5f66  fa'.        fa_f
-0007fcf0: 696c 655f 7072 203d 2066 6e61 6d65 202b  ile_pr = fname +
-0007fd00: 2027 5f70 726f 7465 6f6d 652e 6661 270a   '_proteome.fa'.
-0007fd10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0007fd20: 2020 6661 5f66 696c 655f 7472 203d 2066    fa_file_tr = f
-0007fd30: 6e61 6d65 202b 2027 5f25 735f 7472 616e  name + '_%s_tran
-0007fd40: 7363 7269 7074 6f6d 652e 6661 2720 2520  scriptome.fa' % 
-0007fd50: 7375 6666 6978 0a20 2020 2020 2020 2066  suffix.        f
-0007fd60: 615f 6669 6c65 5f70 7220 3d20 666e 616d  a_file_pr = fnam
-0007fd70: 6520 2b20 275f 2573 5f70 726f 7465 6f6d  e + '_%s_proteom
-0007fd80: 652e 6661 2720 2520 7375 6666 6978 0a0a  e.fa' % suffix..
-0007fd90: 2020 2020 6661 5f74 7220 3d20 5b5d 0a20      fa_tr = []. 
-0007fda0: 2020 2066 615f 7072 203d 205b 5d0a 2020     fa_pr = [].  
-0007fdb0: 2020 0a20 2020 2073 7461 7274 5f74 696d    .    start_tim
-0007fdc0: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-0007fdd0: 2020 2020 6e74 7220 3d20 300a 0a20 2020      ntr = 0..   
-0007fde0: 206d 6178 5f61 626e 203d 2030 0a20 2020   max_abn = 0.   
-0007fdf0: 206d 6178 5f63 6f76 203d 2030 0a20 2020   max_cov = 0.   
-0007fe00: 2066 6f72 206b 6b2c 2063 6872 6d20 696e   for kk, chrm in
-0007fe10: 2065 6e75 6d65 7261 7465 2863 6872 5f6c   enumerate(chr_l
-0007fe20: 7374 293a 0a20 2020 2020 2020 2066 6f72  st):.        for
-0007fe30: 2067 6420 696e 2067 645f 6c73 7473 5b6b   gd in gd_lsts[k
-0007fe40: 6b5d 3a0a 2020 2020 2020 2020 2020 2020  k]:.            
-0007fe50: 666f 7220 7464 2069 6e20 6764 2e74 645f  for td in gd.td_
-0007fe60: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
-0007fe70: 2020 2020 2069 6620 7464 2e61 626e 203e       if td.abn >
-0007fe80: 2030 3a20 6d61 785f 6162 6e20 3d20 6d61   0: max_abn = ma
-0007fe90: 7828 206d 6178 5f61 626e 2c20 7464 2e61  x( max_abn, td.a
-0007fea0: 626e 2029 0a20 2020 2020 2020 2020 2020  bn ).           
-0007feb0: 2020 2020 2069 6620 7464 2e63 6f76 203e       if td.cov >
-0007fec0: 2030 3a20 6d61 785f 636f 7620 3d20 6d61   0: max_cov = ma
-0007fed0: 7828 206d 6178 5f63 6f76 2c20 7464 2e63  x( max_cov, td.c
-0007fee0: 6f76 2029 0a0a 2020 2020 6966 206d 6178  ov )..    if max
-0007fef0: 5f61 626e 203e 2030 3a20 6162 6e5f 7468  _abn > 0: abn_th
-0007ff00: 203d 204d 494e 5f41 424e 5f54 4f5f 5345   = MIN_ABN_TO_SE
-0007ff10: 4c0a 2020 2020 656c 7365 3a20 6162 6e5f  L.    else: abn_
-0007ff20: 7468 203d 2030 0a20 2020 2069 6620 6d61  th = 0.    if ma
-0007ff30: 785f 636f 7620 3e20 303a 2063 6f76 5f74  x_cov > 0: cov_t
-0007ff40: 6820 3d20 4d49 4e5f 434f 565f 544f 5f53  h = MIN_COV_TO_S
-0007ff50: 454c 0a20 2020 2065 6c73 653a 2063 6f76  EL.    else: cov
-0007ff60: 5f74 6820 3d20 300a 2020 2020 7072 696e  _th = 0.    prin
-0007ff70: 7428 2743 7574 6f66 663a 2041 203d 2025  t('Cutoff: A = %
-0007ff80: 352e 3266 2c20 4320 3d20 2535 2e32 6620  5.2f, C = %5.2f 
-0007ff90: 2720 2520 2861 626e 5f74 682c 2063 6f76  ' % (abn_th, cov
-0007ffa0: 5f74 6829 290a 0a20 2020 2066 6f72 206b  _th))..    for k
-0007ffb0: 6b2c 2063 6872 6d20 696e 2065 6e75 6d65  k, chrm in enume
-0007ffc0: 7261 7465 2863 6872 5f6c 7374 293a 0a0a  rate(chr_lst):..
-0007ffd0: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
-0007ffe0: 7227 202b 2027 2027 2a31 3030 2c20 656e  r' + ' '*100, en
-0007fff0: 643d 2727 2c20 666c 7573 6820 3d20 5472  d='', flush = Tr
-00080000: 7565 290a 2020 2020 2020 2020 7072 696e  ue).        prin
-00080010: 7428 275c 7247 656e 6572 6174 696e 6720  t('\rGenerating 
-00080020: 7265 6665 7265 6e63 6573 202e 2e20 2573  references .. %s
-00080030: 2020 2720 2520 2863 6872 6d29 2c20 656e    ' % (chrm), en
-00080040: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
-00080050: 5472 7565 290a 0a20 2020 2020 2020 2066  True)..        f
-00080060: 6f72 2067 6420 696e 2067 645f 6c73 7473  or gd in gd_lsts
-00080070: 5b6b 6b5d 3a0a 2020 2020 2020 2020 2020  [kk]:.          
-00080080: 2020 2320 6764 2e6f 7264 6572 2829 0a20    # gd.order(). 
-00080090: 2020 2020 2020 2020 2020 206e 7472 202b             ntr +
-000800a0: 3d20 6764 2e6e 7472 0a20 2020 2020 2020  = gd.ntr.       
-000800b0: 2020 2020 2066 615f 742c 2066 615f 7020       fa_t, fa_p 
-000800c0: 3d20 6764 2e67 6574 5f66 6173 7461 5f6c  = gd.get_fasta_l
-000800d0: 696e 6573 5f66 726f 6d5f 6765 6e6f 6d65  ines_from_genome
-000800e0: 2867 656e 6f6d 652c 2061 626e 5f74 6820  (genome, abn_th 
-000800f0: 3d20 6162 6e5f 7468 2c20 636f 765f 7468  = abn_th, cov_th
-00080100: 203d 2063 6f76 5f74 682c 206c 656e 5f74   = cov_th, len_t
-00080110: 685f 743d 204d 494e 5f54 525f 4c45 4e47  h_t= MIN_TR_LENG
-00080120: 5448 2c20 6c65 6e5f 7468 5f70 203d 204d  TH, len_th_p = M
-00080130: 494e 5f50 525f 4c45 4e47 5448 290a 2020  IN_PR_LENGTH).  
-00080140: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00080150: 2020 2020 2020 2023 2066 615f 7420 3d20         # fa_t = 
-00080160: 6669 6c74 6572 5f74 7273 5f6c 656e 2866  filter_trs_len(f
-00080170: 615f 742c 206d 696e 5f6c 656e 203d 204d  a_t, min_len = M
-00080180: 494e 5f54 525f 4c45 4e47 5448 290a 2020  IN_TR_LENGTH).  
-00080190: 2020 2020 2020 2020 2020 2320 6661 5f70            # fa_p
-000801a0: 203d 2066 696c 7465 725f 7472 735f 6c65   = filter_trs_le
-000801b0: 6e28 6661 5f70 2c20 6d69 6e5f 6c65 6e20  n(fa_p, min_len 
-000801c0: 3d20 4d49 4e5f 5052 5f4c 454e 4754 4829  = MIN_PR_LENGTH)
-000801d0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-000801e0: 2020 2020 2020 2020 2020 6661 5f74 7220            fa_tr 
-000801f0: 3d20 6661 5f74 7220 2b20 6661 5f74 0a20  = fa_tr + fa_t. 
-00080200: 2020 2020 2020 2020 2020 2066 615f 7072             fa_pr
-00080210: 203d 2066 615f 7072 202b 2066 615f 700a   = fa_pr + fa_p.
-00080220: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00080230: 200a 2020 2020 6966 2028 6c65 6e28 6661   .    if (len(fa
-00080240: 5f70 7229 203d 3d20 3029 2026 2028 7065  _pr) == 0) & (pe
-00080250: 7074 6964 6529 3a0a 2020 2020 2020 2020  ptide):.        
-00080260: 6864 725f 6c73 742c 2074 7365 715f 6c73  hdr_lst, tseq_ls
-00080270: 7420 3d20 5b5d 2c20 5b5d 0a20 2020 2020  t = [], [].     
-00080280: 2020 2066 6f72 206c 696e 6520 696e 2066     for line in f
-00080290: 615f 7472 3a0a 2020 2020 2020 2020 2020  a_tr:.          
-000802a0: 2020 6966 206c 696e 655b 305d 203d 3d20    if line[0] == 
-000802b0: 273e 273a 2068 6472 5f6c 7374 2e61 7070  '>': hdr_lst.app
-000802c0: 656e 6428 6c69 6e65 5b31 3a2d 315d 290a  end(line[1:-1]).
-000802d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000802e0: 3a20 7473 6571 5f6c 7374 2e61 7070 656e  : tseq_lst.appen
-000802f0: 6428 6c69 6e65 5b30 3a2d 315d 290a 0a20  d(line[0:-1]).. 
-00080300: 2020 2020 2020 2066 615f 7072 203d 2067         fa_pr = g
-00080310: 656e 5f70 726f 7465 6f6d 655f 6672 6f6d  en_proteome_from
-00080320: 5f74 7261 7363 7269 7074 6f6d 6528 6864  _trascriptome(hd
-00080330: 725f 6c73 742c 2074 7365 715f 6c73 742c  r_lst, tseq_lst,
-00080340: 206c 656e 5f74 6820 3d20 4d49 4e5f 5052   len_th = MIN_PR
-00080350: 5f4c 454e 4754 482c 2076 6572 626f 7365  _LENGTH, verbose
-00080360: 203d 2054 7275 652c 2074 7261 7265 636f   = True, trareco
-00080370: 203d 2046 616c 7365 290a 2020 2020 2020   = False).      
-00080380: 2020 705f 6361 6e64 5f63 6e74 203d 206c    p_cand_cnt = l
-00080390: 656e 2866 615f 7072 292f 320a 0a20 2020  en(fa_pr)/2..   
-000803a0: 2020 2020 2070 7269 6e74 2827 5c72 4765       print('\rGe
-000803b0: 6e65 7261 7469 6e67 2072 6566 6572 656e  nerating referen
-000803c0: 6365 7320 2e2e 2064 6f6e 652e 2025 6920  ces .. done. %i 
-000803d0: 2d3e 2025 692c 2569 2720 2520 286e 7472  -> %i,%i' % (ntr
-000803e0: 2c20 6c65 6e28 6661 5f74 7229 2f32 2c20  , len(fa_tr)/2, 
-000803f0: 705f 6361 6e64 5f63 6e74 2929 0a20 2020  p_cand_cnt)).   
-00080400: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
-00080410: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
-00080420: 6e67 2072 6566 6572 656e 6365 7320 2e2e  ng references ..
-00080430: 2064 6f6e 652e 2025 6920 2d3e 2025 6927   done. %i -> %i'
-00080440: 2025 2028 6e74 722c 206c 656e 2866 615f   % (ntr, len(fa_
-00080450: 7472 292f 3229 290a 0a20 2020 2070 7269  tr)/2))..    pri
-00080460: 6e74 2827 5361 7669 6e67 2046 4153 5441  nt('Saving FASTA
-00080470: 202e 2e27 2c20 656e 6420 3d20 2727 2c20   ..', end = '', 
-00080480: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-00080490: 2020 6620 3d20 6f70 656e 2866 615f 6669    f = open(fa_fi
-000804a0: 6c65 5f74 722c 2027 772b 2729 0a20 2020  le_tr, 'w+').   
-000804b0: 2066 2e77 7269 7465 6c69 6e65 7328 6661   f.writelines(fa
-000804c0: 5f74 7229 0a20 2020 2066 2e63 6c6f 7365  _tr).    f.close
-000804d0: 2829 0a0a 2020 2020 6966 2070 6570 7469  ()..    if pepti
-000804e0: 6465 3a0a 2020 2020 2020 2020 7072 696e  de:.        prin
-000804f0: 7428 272e 272c 2065 6e64 3d27 2729 0a20  t('.', end=''). 
-00080500: 2020 2020 2020 2066 203d 206f 7065 6e28         f = open(
-00080510: 6661 5f66 696c 655f 7072 2c20 2777 2b27  fa_file_pr, 'w+'
-00080520: 290a 2020 2020 2020 2020 662e 7772 6974  ).        f.writ
-00080530: 656c 696e 6573 2866 615f 7072 290a 2020  elines(fa_pr).  
-00080540: 2020 2020 2020 662e 636c 6f73 6528 290a        f.close().
-00080550: 0a20 2020 2065 6c61 7073 6564 5f74 696d  .    elapsed_tim
-00080560: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
-00080570: 2d20 7374 6172 745f 7469 6d65 0a20 2020  - start_time.   
-00080580: 2070 7269 6e74 2827 2064 6f6e 652e 2028   print(' done. (
-00080590: 2569 2920 2720 2520 2865 6c61 7073 6564  %i) ' % (elapsed
-000805a0: 5f74 696d 6529 290a 2020 2020 7072 696e  _time)).    prin
-000805b0: 7428 2720 2020 2573 2720 2520 6661 5f66  t('   %s' % fa_f
-000805c0: 696c 655f 7472 2029 0a20 2020 2069 6620  ile_tr ).    if 
-000805d0: 7065 7074 6964 653a 2070 7269 6e74 2827  peptide: print('
-000805e0: 2020 2025 7327 2025 2066 615f 6669 6c65     %s' % fa_file
-000805f0: 5f70 7220 290a 2020 2020 0a20 2020 2072  _pr ).    .    r
-00080600: 6574 7572 6e20 6661 5f66 696c 655f 7472  eturn fa_file_tr
-00080610: 2c20 6661 5f66 696c 655f 7072 0a20 2020  , fa_file_pr.   
-00080620: 200a 0a64 6566 206d 635f 636f 7265 5f72   ..def mc_core_r
-00080630: 6563 6f6e 7374 7275 6374 696f 6e28 6767  econstruction(gg
-00080640: 635f 7475 706c 6529 3a0a 2020 2020 0a20  c_tuple):.    . 
-00080650: 2020 2067 645f 7365 6c20 3d20 6767 635f     gd_sel = ggc_
-00080660: 7475 706c 655b 305d 0a20 2020 2073 6571  tuple[0].    seq
-00080670: 5f6f 7267 203d 2067 6763 5f74 7570 6c65  _org = ggc_tuple
-00080680: 5b31 5d0a 2020 2020 6368 726d 203d 2067  [1].    chrm = g
-00080690: 6763 5f74 7570 6c65 5b32 5d0a 2020 2020  gc_tuple[2].    
-000806a0: 0a20 2020 2023 2067 645f 7365 6c20 3d20  .    # gd_sel = 
-000806b0: 736f 7274 5f64 6573 6372 6970 746f 725f  sort_descriptor_
-000806c0: 6c73 7428 6764 5f73 656c 290a 2020 2020  lst(gd_sel).    
-000806d0: 6e5f 6764 203d 206c 656e 2867 645f 7365  n_gd = len(gd_se
-000806e0: 6c29 0a0a 2020 2020 2323 2323 2323 2323  l)..    ########
-000806f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080700: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00080710: 2323 2063 6f6c 6c65 6374 2072 676e 7320  ## collect rgns 
-00080720: 616e 6420 6d61 726b 2074 6865 6972 2070  and mark their p
-00080730: 6f73 0a20 2020 200a 2020 2020 7374 6172  os.    .    star
-00080740: 745f 7469 6d65 203d 2074 696d 652e 7469  t_time = time.ti
-00080750: 6d65 2829 0a20 2020 206c 6f63 5f6f 7320  me().    loc_os 
-00080760: 3d20 6e70 2e7a 6572 6f73 286e 5f67 642c  = np.zeros(n_gd,
-00080770: 6474 7970 653d 6e70 2e66 6c6f 6174 3332  dtype=np.float32
-00080780: 290a 2020 2020 6e75 6d5f 6f73 203d 206e  ).    num_os = n
-00080790: 702e 7a65 726f 7328 6e5f 6764 2c64 7479  p.zeros(n_gd,dty
-000807a0: 7065 3d6e 702e 666c 6f61 7433 3229 0a20  pe=np.float32). 
-000807b0: 2020 2072 616c 6c20 3d20 7265 6769 6f6e     rall = region
-000807c0: 7328 290a 2020 2020 4765 6e65 5f69 645f  s().    Gene_id_
-000807d0: 6e61 6d65 203d 205b 5d0a 2020 2020 6764  name = [].    gd
-000807e0: 5f69 6478 5f6f 665f 7267 6e20 3d20 5b5d  _idx_of_rgn = []
-000807f0: 0a20 2020 206f 735f 6375 7220 3d20 300a  .    os_cur = 0.
-00080800: 2020 2020 725f 706f 7320 3d20 5b5d 0a20      r_pos = []. 
-00080810: 2020 2066 6f72 206b 2c20 6764 2069 6e20     for k, gd in 
-00080820: 656e 756d 6572 6174 6528 6764 5f73 656c  enumerate(gd_sel
-00080830: 293a 0a0a 2020 2020 2020 2020 2323 2063  ):..        ## c
-00080840: 6865 636b 2069 6620 616e 7920 4420 6f72  heck if any D or
-00080850: 2049 206c 6965 7320 7769 7468 696e 2061   I lies within a
-00080860: 6e20 6578 6f6e 0a20 2020 2020 2020 2066  n exon.        f
-00080870: 6f72 2065 2069 6e20 6764 2e65 786f 6e73  or e in gd.exons
-00080880: 2e72 676e 733a 0a20 2020 2020 2020 2020  .rgns:.         
-00080890: 2020 2069 6620 652e 7479 7065 203d 3d20     if e.type == 
-000808a0: 2764 656c 6574 696f 6e27 3a0a 2020 2020  'deletion':.    
-000808b0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-000808c0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-000808d0: 2020 2020 2020 666f 7220 6320 696e 2067        for c in g
-000808e0: 642e 6578 6f6e 732e 7267 6e73 3a0a 2020  d.exons.rgns:.  
-000808f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080900: 2020 6966 2028 632e 7479 7065 203d 3d20    if (c.type == 
-00080910: 2765 786f 6e27 293a 0a20 2020 2020 2020  'exon'):.       
-00080920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080930: 2069 6620 652e 6861 735f 6578 745f 696e   if e.has_ext_in
-00080940: 7465 7273 6563 7469 6f6e 5f77 6974 6828  tersection_with(
-00080950: 6329 3a0a 2020 2020 2020 2020 2020 2020  c):.            
-00080960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080970: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
-00080980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080990: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-000809a0: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
-000809b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000809c0: 6620 623a 0a20 2020 2020 2020 2020 2020  f b:.           
-000809d0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000809e0: 5741 524e 494e 473a 2044 2825 733a 2569  WARNING: D(%s:%i
-000809f0: 2d25 6929 206f 7665 726c 6170 7320 7769  -%i) overlaps wi
-00080a00: 7468 2045 2825 733a 2569 2d25 6929 2720  th E(%s:%i-%i)' 
-00080a10: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
-00080a20: 2020 2020 2020 2020 2020 2020 2020 2865                (e
-00080a30: 2e63 6872 2c20 652e 7374 6172 742c 2065  .chr, e.start, e
-00080a40: 2e65 6e64 2c20 632e 6368 722c 2063 2e73  .end, c.chr, c.s
-00080a50: 7461 7274 2c20 632e 656e 6429 290a 2020  tart, c.end)).  
-00080a60: 2020 2020 2020 2020 2020 2020 2020 2727                ''
-00080a70: 2720 2020 200a 2020 2020 2020 2020 2020  '    .          
-00080a80: 2020 656c 6966 2065 2e74 7970 6520 3d3d    elif e.type ==
-00080a90: 2027 696e 7365 7273 696f 6e27 3a0a 2020   'insersion':.  
-00080aa0: 2020 2020 2020 2020 2020 2020 2020 6220                b 
-00080ab0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00080ac0: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
-00080ad0: 2067 642e 6578 6f6e 732e 7267 6e73 3a0a   gd.exons.rgns:.
-00080ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080af0: 2020 2020 6966 2028 632e 7479 7065 203d      if (c.type =
-00080b00: 3d20 2765 786f 6e27 293a 0a20 2020 2020  = 'exon'):.     
+0007eb80: 6c65 6e5f 6c73 742e 6170 7065 6e64 2870  len_lst.append(p
+0007eb90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0007eba0: 2020 2320 736e 705f 6f72 675f 6c73 742e    # snp_org_lst.
+0007ebb0: 6170 7065 6e64 2873 675b 706f 733a 2870  append(sg[pos:(p
+0007ebc0: 6f73 2b70 295d 290a 2020 2020 2020 2020  os+p)]).        
+0007ebd0: 2020 2020 2020 2020 7020 3d20 300a 2020          p = 0.  
+0007ebe0: 2020 2020 2020 2020 2020 0a20 2020 2066            .    f
+0007ebf0: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
+0007ec00: 6e28 706f 735f 6c73 7429 293a 0a20 2020  n(pos_lst)):.   
+0007ec10: 2020 2020 200a 2020 2020 2020 2020 7031       .        p1
+0007ec20: 203d 206d 6178 2830 2c28 706f 735f 6c73   = max(0,(pos_ls
+0007ec30: 745b 6b5d 2d4e 5749 4e29 290a 2020 2020  t[k]-NWIN)).    
+0007ec40: 2020 2020 7032 203d 206d 696e 286c 656e      p2 = min(len
+0007ec50: 5f74 6f5f 7465 7374 2c28 706f 735f 6c73  _to_test,(pos_ls
+0007ec60: 745b 6b5d 2b6c 656e 5f6c 7374 5b6b 5d2b  t[k]+len_lst[k]+
+0007ec70: 4e57 494e 2929 0a20 2020 2020 2020 200a  NWIN)).        .
+0007ec80: 2020 2020 2020 2020 736f 7020 3d20 7367          sop = sg
+0007ec90: 5b70 313a 706f 735f 6c73 745b 6b5d 5d0a  [p1:pos_lst[k]].
+0007eca0: 2020 2020 2020 2020 736f 6320 3d20 7367          soc = sg
+0007ecb0: 5b70 6f73 5f6c 7374 5b6b 5d3a 2870 6f73  [pos_lst[k]:(pos
+0007ecc0: 5f6c 7374 5b6b 5d2b 6c65 6e5f 6c73 745b  _lst[k]+len_lst[
+0007ecd0: 6b5d 295d 0a20 2020 2020 2020 2073 6f6e  k])].        son
+0007ece0: 203d 2073 675b 2870 6f73 5f6c 7374 5b6b   = sg[(pos_lst[k
+0007ecf0: 5d2b 6c65 6e5f 6c73 745b 6b5d 293a 7032  ]+len_lst[k]):p2
+0007ed00: 5d0a 2020 2020 2020 2020 0a20 2020 2020  ].        .     
+0007ed10: 2020 2073 6e70 203d 2073 725b 7031 3a70     snp = sr[p1:p
+0007ed20: 6f73 5f6c 7374 5b6b 5d5d 0a20 2020 2020  os_lst[k]].     
+0007ed30: 2020 2073 6e63 203d 2073 725b 706f 735f     snc = sr[pos_
+0007ed40: 6c73 745b 6b5d 3a28 706f 735f 6c73 745b  lst[k]:(pos_lst[
+0007ed50: 6b5d 2b6c 656e 5f6c 7374 5b6b 5d29 5d0a  k]+len_lst[k])].
+0007ed60: 2020 2020 2020 2020 736e 6e20 3d20 7372          snn = sr
+0007ed70: 5b28 706f 735f 6c73 745b 6b5d 2b6c 656e  [(pos_lst[k]+len
+0007ed80: 5f6c 7374 5b6b 5d29 3a70 325d 0a20 2020  _lst[k]):p2].   
+0007ed90: 2020 2020 200a 2020 2020 2020 2020 7369       .        si
+0007eda0: 203d 2053 4e56 5f69 6e66 6f28 6368 726d   = SNV_info(chrm
+0007edb0: 2c20 706f 735f 6c73 745b 6b5d 2b70 6f73  , pos_lst[k]+pos
+0007edc0: 5f61 6273 2c20 706f 735f 6c73 745b 6b5d  _abs, pos_lst[k]
+0007edd0: 2b70 6f73 5f61 6273 2b6f 732c 2067 696e  +pos_abs+os, gin
+0007ede0: 5b30 5d2c 2067 696e 5b31 5d2c 2027 5627  [0], gin[1], 'V'
+0007edf0: 2c20 6c65 6e5f 6c73 745b 6b5d 2c20 5c0a  , len_lst[k], \.
+0007ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007ee10: 2020 2020 2020 696e 7428 6372 5b70 6f73        int(cr[pos
+0007ee20: 5f6c 7374 5b6b 5d5d 292c 206e 702e 726f  _lst[k]]), np.ro
+0007ee30: 756e 6428 7072 5b70 6f73 5f6c 7374 5b6b  und(pr[pos_lst[k
+0007ee40: 5d5d 2c33 292c 2073 6f70 2c20 736f 632c  ]],3), sop, soc,
+0007ee50: 2073 6f6e 2c20 736e 702c 2073 6e63 2c20   son, snp, snc, 
+0007ee60: 736e 6e20 290a 2020 2020 2020 2020 736e  snn ).        sn
+0007ee70: 765f 696e 666f 5f6c 7374 2e61 7070 656e  v_info_lst.appen
+0007ee80: 6428 7369 290a 0a20 2020 2072 6574 7572  d(si)..    retur
+0007ee90: 6e28 736e 765f 696e 666f 5f6c 7374 290a  n(snv_info_lst).
+0007eea0: 0a0a 6465 6620 636f 6d70 6172 655f 7365  ..def compare_se
+0007eeb0: 7132 2820 7331 2c20 7332 2029 3a0a 2020  q2( s1, s2 ):.  
+0007eec0: 2020 636e 7420 3d20 300a 2020 2020 666f    cnt = 0.    fo
+0007eed0: 7220 6920 696e 2072 616e 6765 286d 696e  r i in range(min
+0007eee0: 286c 656e 2873 3129 2c6c 656e 2873 3229  (len(s1),len(s2)
+0007eef0: 2929 3a0a 2020 2020 2020 2020 636e 7420  )):.        cnt 
+0007ef00: 2b3d 2028 7331 5b69 5d20 213d 2073 325b  += (s1[i] != s2[
+0007ef10: 695d 290a 2020 2020 2320 6966 206c 656e  i]).    # if len
+0007ef20: 2873 3129 2021 3d20 6c65 6e28 7332 293a  (s1) != len(s2):
+0007ef30: 2070 7269 6e74 2827 5741 524e 494e 4720   print('WARNING 
+0007ef40: 696e 2063 6f6d 7061 7265 5f73 6571 323a  in compare_seq2:
+0007ef50: 2025 6920 213d 2025 6927 2025 2028 6c65   %i != %i' % (le
+0007ef60: 6e28 7331 292c 6c65 6e28 7332 2929 2029  n(s1),len(s2)) )
+0007ef70: 0a20 2020 2072 6574 7572 6e20 636e 740a  .    return cnt.
+0007ef80: 0a0a 4f53 5f69 6e66 6f20 3d20 636f 6c6c  ..OS_info = coll
+0007ef90: 6563 7469 6f6e 732e 6e61 6d65 6474 7570  ections.namedtup
+0007efa0: 6c65 2827 4f53 5f69 6e66 6f27 2c20 276f  le('OS_info', 'o
+0007efb0: 732c 2073 7461 7274 2c20 656e 6427 2920  s, start, end') 
+0007efc0: 2320 6f6e 652d 6261 7365 0a0a 636c 6173  # one-base..clas
+0007efd0: 7320 6f66 6673 6574 5f66 696e 6465 723a  s offset_finder:
+0007efe0: 0a20 2020 200a 2020 2020 6465 6620 5f5f  .    .    def __
+0007eff0: 696e 6974 5f5f 2873 656c 6629 3a0a 2020  init__(self):.  
+0007f000: 2020 2020 2020 7365 6c66 2e6f 7369 5f6c        self.osi_l
+0007f010: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+0007f020: 7365 6c66 2e6f 735f 6d61 7020 3d20 4e6f  self.os_map = No
+0007f030: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+0007f040: 6f73 5f70 7265 7620 3d20 300a 2020 2020  os_prev = 0.    
+0007f050: 2020 2020 0a20 2020 2064 6566 2061 6464      .    def add
+0007f060: 2820 7365 6c66 2c20 6f73 2c20 7374 6172  ( self, os, star
+0007f070: 742c 2065 6e64 293a 0a20 2020 2020 2020  t, end):.       
+0007f080: 2073 656c 662e 6f73 695f 6c73 742e 6170   self.osi_lst.ap
+0007f090: 7065 6e64 2820 4f53 5f69 6e66 6f28 6f73  pend( OS_info(os
+0007f0a0: 2c20 7374 6172 742c 2065 6e64 2920 290a  , start, end) ).
+0007f0b0: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
+0007f0c0: 2066 696e 645f 6f73 2820 7365 6c66 2c20   find_os( self, 
+0007f0d0: 706f 7320 293a 0a20 2020 2020 2020 206f  pos ):.        o
+0007f0e0: 7320 3d20 300a 2020 2020 2020 2020 666f  s = 0.        fo
+0007f0f0: 7220 6f73 6920 696e 2073 656c 662e 6f73  r osi in self.os
+0007f100: 695f 6c73 743a 0a20 2020 2020 2020 2020  i_lst:.         
+0007f110: 2020 2069 6620 2870 6f73 203e 3d20 6f73     if (pos >= os
+0007f120: 692e 7374 6172 7429 2026 2028 706f 7320  i.start) & (pos 
+0007f130: 3c20 6f73 692e 656e 6429 3a20 0a20 2020  < osi.end): .   
+0007f140: 2020 2020 2020 2020 2020 2020 206f 7320               os 
+0007f150: 3d20 6f73 692e 6f73 0a20 2020 2020 2020  = osi.os.       
+0007f160: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0007f170: 2020 2020 2020 2072 6574 7572 6e20 6f73         return os
+0007f180: 0a0a 2020 2020 0a20 2020 2064 6566 2066  ..    .    def f
+0007f190: 696e 645f 6f73 5f73 6571 2820 7365 6c66  ind_os_seq( self
+0007f1a0: 2c20 706f 732c 2070 7265 765f 692c 206d  , pos, prev_i, m
+0007f1b0: 6172 6b20 3d20 2727 2029 3a0a 2020 2020  ark = '' ):.    
+0007f1c0: 2020 2020 6f73 203d 204e 6f6e 650a 2020      os = None.  
+0007f1d0: 2020 2020 2020 6e65 7874 5f69 203d 2030        next_i = 0
+0007f1e0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+0007f1f0: 6f73 6920 696e 2065 6e75 6d65 7261 7465  osi in enumerate
+0007f200: 2873 656c 662e 6f73 695f 6c73 745b 7072  (self.osi_lst[pr
+0007f210: 6576 5f69 3a5d 293a 0a20 2020 2020 2020  ev_i:]):.       
+0007f220: 2020 2020 2069 6620 2870 6f73 203e 3d20       if (pos >= 
+0007f230: 6f73 692e 7374 6172 7429 2026 2028 706f  osi.start) & (po
+0007f240: 7320 3c20 6f73 692e 656e 6429 3a20 0a20  s < osi.end): . 
+0007f250: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0007f260: 7320 3d20 6f73 692e 6f73 0a20 2020 2020  s = osi.os.     
+0007f270: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+0007f280: 6920 3d20 6b20 2b20 7072 6576 5f69 200a  i = k + prev_i .
+0007f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007f2a0: 6272 6561 6b0a 2020 2020 2020 2020 6966  break.        if
+0007f2b0: 206f 7320 6973 204e 6f6e 653a 0a20 2020   os is None:.   
+0007f2c0: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
+0007f2d0: 6f73 6920 696e 2065 6e75 6d65 7261 7465  osi in enumerate
+0007f2e0: 2873 656c 662e 6f73 695f 6c73 745b 3a70  (self.osi_lst[:p
+0007f2f0: 7265 765f 695d 293a 0a20 2020 2020 2020  rev_i]):.       
+0007f300: 2020 2020 2020 2020 2069 6620 2870 6f73           if (pos
+0007f310: 203e 3d20 6f73 692e 7374 6172 7429 2026   >= osi.start) &
+0007f320: 2028 706f 7320 3c20 6f73 692e 656e 6429   (pos < osi.end)
+0007f330: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0007f340: 2020 2020 2020 206f 7320 3d20 6f73 692e         os = osi.
+0007f350: 6f73 0a20 2020 2020 2020 2020 2020 2020  os.             
+0007f360: 2020 2020 2020 206e 6578 745f 6920 3d20         next_i = 
+0007f370: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0007f380: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
+0007f390: 2020 2020 2069 6620 6f73 2069 7320 4e6f       if os is No
+0007f3a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0007f3b0: 6f73 203d 2073 656c 662e 6f73 5f70 7265  os = self.os_pre
+0007f3c0: 760a 2020 2020 2020 2020 2020 2020 2320  v.            # 
+0007f3d0: 7072 696e 7428 2745 5252 4f52 2069 6e20  print('ERROR in 
+0007f3e0: 6669 6e64 5f6f 735f 7365 713a 206f 7320  find_os_seq: os 
+0007f3f0: 6973 204e 6f6e 6520 2573 2720 2520 6d61  is None %s' % ma
+0007f400: 726b 2029 0a20 2020 2020 2020 2065 6c73  rk ).        els
+0007f410: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+0007f420: 656c 662e 6f73 5f70 7265 7620 3d20 6f73  elf.os_prev = os
+0007f430: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0007f440: 2020 2020 2020 7265 7475 726e 206f 732c        return os,
+0007f450: 206e 6578 745f 690a 2020 2020 0a20 2020   next_i.    .   
+0007f460: 200a 2020 2020 6465 6620 6d61 6b65 5f69   .    def make_i
+0007f470: 745f 636f 6d70 6163 7428 2073 656c 6620  t_compact( self 
+0007f480: 293a 0a0a 2020 2020 2020 2020 666f 7220  ):..        for 
+0007f490: 6b20 696e 2072 6576 6572 7365 6428 7261  k in reversed(ra
+0007f4a0: 6e67 6528 312c 6c65 6e28 7365 6c66 2e6f  nge(1,len(self.o
+0007f4b0: 7369 5f6c 7374 2929 293a 0a20 2020 2020  si_lst))):.     
+0007f4c0: 2020 2020 2020 2069 6620 7365 6c66 2e6f         if self.o
+0007f4d0: 7369 5f6c 7374 5b6b 5d2e 6f73 203d 3d20  si_lst[k].os == 
+0007f4e0: 7365 6c66 2e6f 7369 5f6c 7374 5b6b 2d31  self.osi_lst[k-1
+0007f4f0: 5d2e 6f73 3a0a 2020 2020 2020 2020 2020  ].os:.          
+0007f500: 2020 2020 2020 7365 6c66 2e6f 7369 5f6c        self.osi_l
+0007f510: 7374 5b6b 2d31 5d20 3d20 4f53 5f69 6e66  st[k-1] = OS_inf
+0007f520: 6f28 2073 656c 662e 6f73 695f 6c73 745b  o( self.osi_lst[
+0007f530: 6b2d 315d 2e6f 732c 2073 656c 662e 6f73  k-1].os, self.os
+0007f540: 695f 6c73 745b 6b2d 315d 2e73 7461 7274  i_lst[k-1].start
+0007f550: 2c20 7365 6c66 2e6f 7369 5f6c 7374 5b6b  , self.osi_lst[k
+0007f560: 5d2e 656e 6420 290a 2020 2020 2020 2020  ].end ).        
+0007f570: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+0007f580: 2e6f 7369 5f6c 7374 5b6b 5d0a 2020 2020  .osi_lst[k].    
+0007f590: 2020 2020 0a20 2020 2064 6566 2067 6574      .    def get
+0007f5a0: 5f62 6e64 7279 2820 7365 6c66 2c20 706f  _bndry( self, po
+0007f5b0: 7320 293a 0a20 2020 2020 2020 206f 7320  s ):.        os 
+0007f5c0: 3d20 300a 2020 2020 2020 2020 666f 7220  = 0.        for 
+0007f5d0: 6f73 6920 696e 2073 656c 662e 6f73 695f  osi in self.osi_
+0007f5e0: 6c73 743a 0a20 2020 2020 2020 2020 2020  lst:.           
+0007f5f0: 2069 6620 2870 6f73 203e 3d20 6f73 692e   if (pos >= osi.
+0007f600: 7374 6172 7429 3a20 0a20 2020 2020 2020  start): .       
+0007f610: 2020 2020 2020 2020 206f 7320 3d20 6f73           os = os
+0007f620: 692e 7374 6172 740a 2020 2020 2020 2020  i.start.        
+0007f630: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0007f640: 2020 2020 2020 7265 7475 726e 206f 730a        return os.
+0007f650: 2020 2020 0a20 2020 2064 6566 2067 6574      .    def get
+0007f660: 5f62 6e64 7279 5f73 6571 2820 7365 6c66  _bndry_seq( self
+0007f670: 2c20 706f 732c 2070 7265 765f 6920 293a  , pos, prev_i ):
+0007f680: 0a20 2020 2020 2020 206f 7320 3d20 4e6f  .        os = No
+0007f690: 6e65 0a20 2020 2020 2020 206e 6578 745f  ne.        next_
+0007f6a0: 6920 3d20 300a 2020 2020 2020 2020 666f  i = 0.        fo
+0007f6b0: 7220 6b2c 206f 7369 2069 6e20 656e 756d  r k, osi in enum
+0007f6c0: 6572 6174 6528 7365 6c66 2e6f 7369 5f6c  erate(self.osi_l
+0007f6d0: 7374 5b70 7265 765f 693a 5d29 3a0a 2020  st[prev_i:]):.  
+0007f6e0: 2020 2020 2020 2020 2020 6966 2028 706f            if (po
+0007f6f0: 7320 3e3d 206f 7369 2e73 7461 7274 2920  s >= osi.start) 
+0007f700: 2620 2870 6f73 203c 206f 7369 2e65 6e64  & (pos < osi.end
+0007f710: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
+0007f720: 2020 2020 6f73 203d 206f 7369 2e73 7461      os = osi.sta
+0007f730: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
+0007f740: 2020 206e 6578 745f 6920 3d20 6b20 2b20     next_i = k + 
+0007f750: 7072 6576 5f69 200a 2020 2020 2020 2020  prev_i .        
+0007f760: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0007f770: 2020 2020 2020 6966 206f 7320 6973 204e        if os is N
+0007f780: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0007f790: 2066 6f72 206b 2c20 6f73 6920 696e 2065   for k, osi in e
+0007f7a0: 6e75 6d65 7261 7465 2873 656c 662e 6f73  numerate(self.os
+0007f7b0: 695f 6c73 745b 3a70 7265 765f 695d 293a  i_lst[:prev_i]):
+0007f7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007f7d0: 2069 6620 2870 6f73 203e 3d20 6f73 692e   if (pos >= osi.
+0007f7e0: 7374 6172 7429 2026 2028 706f 7320 3c20  start) & (pos < 
+0007f7f0: 6f73 692e 656e 6429 3a20 0a20 2020 2020  osi.end): .     
+0007f800: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0007f810: 7320 3d20 6f73 692e 7374 6172 740a 2020  s = osi.start.  
+0007f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007f830: 2020 6e65 7874 5f69 203d 206b 0a20 2020    next_i = k.   
+0007f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007f850: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+0007f860: 2020 200a 2020 2020 2020 2020 6966 206f     .        if o
+0007f870: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+0007f880: 2020 2020 2020 206f 7320 3d20 300a 2020         os = 0.  
+0007f890: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
+0007f8a0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0007f8b0: 2070 7269 6e74 2827 4552 524f 5220 696e   print('ERROR in
+0007f8c0: 2067 6574 5f62 6e64 7279 5f73 6571 3a20   get_bndry_seq: 
+0007f8d0: 6f73 2069 7320 4e6f 6e65 2729 0a20 2020  os is None').   
+0007f8e0: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+0007f8f0: 7072 696e 7428 290a 2020 2020 2020 2020  print().        
+0007f900: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
+0007f910: 7572 6e20 6f73 2c20 6e65 7874 5f69 0a20  urn os, next_i. 
+0007f920: 2020 200a 2020 2020 0a20 2020 2064 6566     .    .    def
+0007f930: 2070 7269 6e74 2873 656c 6629 3a0a 2020   print(self):.  
+0007f940: 2020 2020 2020 666f 7220 6f73 6920 696e        for osi in
+0007f950: 2073 656c 662e 6f73 695f 6c73 743a 0a20   self.osi_lst:. 
+0007f960: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0007f970: 2827 2569 202d 2025 693a 2025 6927 2025  ('%i - %i: %i' %
+0007f980: 2028 6f73 692e 7374 6172 742c 206f 7369   (osi.start, osi
+0007f990: 2e65 6e64 2c20 6f73 692e 6f73 2929 0a0a  .end, osi.os))..
+0007f9a0: 2020 2020 2020 2020 2020 2020 0a64 6566              .def
+0007f9b0: 2047 656e 6572 6174 655f 5265 6665 7265   Generate_Refere
+0007f9c0: 6e63 6528 6774 665f 6669 6c65 2c20 6765  nce(gtf_file, ge
+0007f9d0: 6e6f 6d65 5f66 696c 652c 2070 6570 7469  nome_file, pepti
+0007f9e0: 6465 203d 2054 7275 652c 206f 7574 5f64  de = True, out_d
+0007f9f0: 6972 203d 204e 6f6e 652c 2073 7566 6669  ir = None, suffi
+0007fa00: 7820 3d20 4e6f 6e65 293a 0a0a 2020 2020  x = None):..    
+0007fa10: 6765 6e6f 6d65 203d 206c 6f61 645f 6765  genome = load_ge
+0007fa20: 6e6f 6d65 2867 656e 6f6d 655f 6669 6c65  nome(genome_file
+0007fa30: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
+0007fa40: 290a 0a20 2020 2067 7466 5f6c 696e 6573  )..    gtf_lines
+0007fa50: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
+0007fa60: 6164 5f67 7466 2867 7466 5f66 696c 652c  ad_gtf(gtf_file,
+0007fa70: 2076 6572 626f 7365 203d 2054 7275 6529   verbose = True)
+0007fa80: 0a20 2020 2067 645f 6c73 742c 2063 6872  .    gd_lst, chr
+0007fa90: 7320 3d20 6765 745f 6765 6e65 5f64 6573  s = get_gene_des
+0007faa0: 6372 6970 746f 7228 6774 665f 6c69 6e65  criptor(gtf_line
+0007fab0: 732c 2067 656e 6f6d 6520 3d20 4e6f 6e65  s, genome = None
+0007fac0: 2c20 6669 6c6c 203d 2046 616c 7365 2c20  , fill = False, 
+0007fad0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0007fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007faf0: 2020 2020 2020 2020 2020 2020 2063 6720               cg 
+0007fb00: 3d20 4661 6c73 652c 2076 6572 626f 7365  = False, verbose
+0007fb10: 203d 2054 7275 652c 206e 5f63 6f72 6573   = True, n_cores
+0007fb20: 203d 2031 290a 2020 2020 6764 5f6c 7374   = 1).    gd_lst
+0007fb30: 732c 2063 6872 5f6c 7374 203d 2070 6163  s, chr_lst = pac
+0007fb40: 6b5f 6765 6e65 5f64 6573 6372 6970 746f  k_gene_descripto
+0007fb50: 7228 2067 645f 6c73 742c 2063 6872 7320  r( gd_lst, chrs 
+0007fb60: 290a 2020 2020 0a0a 2020 2020 2320 6669  ).    ..    # fi
+0007fb70: 6c65 5f6e 616d 6520 3d20 6774 665f 6669  le_name = gtf_fi
+0007fb80: 6c65 2e73 706c 6974 2827 2f27 295b 2d31  le.split('/')[-1
+0007fb90: 5d0a 2020 2020 2320 666e 7320 3d20 6669  ].    # fns = fi
+0007fba0: 6c65 5f6e 616d 652e 7370 6c69 7428 272e  le_name.split('.
+0007fbb0: 2729 5b3a 2d31 5d0a 2020 2020 666e 7320  ')[:-1].    fns 
+0007fbc0: 3d20 6774 665f 6669 6c65 2e73 706c 6974  = gtf_file.split
+0007fbd0: 2827 2e27 295b 3a2d 315d 0a20 2020 2066  ('.')[:-1].    f
+0007fbe0: 6e61 6d65 203d 2027 270a 2020 2020 666f  name = ''.    fo
+0007fbf0: 7220 6b2c 2066 6e20 696e 2065 6e75 6d65  r k, fn in enume
+0007fc00: 7261 7465 2866 6e73 293a 0a20 2020 2020  rate(fns):.     
+0007fc10: 2020 2069 6620 6b20 3e20 303a 0a20 2020     if k > 0:.   
+0007fc20: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
+0007fc30: 2066 6e61 6d65 202b 2027 2e27 0a20 2020   fname + '.'.   
+0007fc40: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
+0007fc50: 6d65 202b 2066 6e0a 2020 2020 6966 206f  me + fn.    if o
+0007fc60: 7574 5f64 6972 2069 7320 6e6f 7420 4e6f  ut_dir is not No
+0007fc70: 6e65 3a0a 2020 2020 2020 2020 6966 206f  ne:.        if o
+0007fc80: 7574 5f64 6972 5b2d 315d 203d 3d20 272f  ut_dir[-1] == '/
+0007fc90: 273a 0a20 2020 2020 2020 2020 2020 2066  ':.            f
+0007fca0: 6e61 6d65 203d 206f 7574 5f64 6972 202b  name = out_dir +
+0007fcb0: 2066 6e61 6d65 0a20 2020 2020 2020 2065   fname.        e
+0007fcc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0007fcd0: 2066 6e61 6d65 203d 206f 7574 5f64 6972   fname = out_dir
+0007fce0: 202b 2027 2f27 202b 2066 6e61 6d65 0a0a   + '/' + fname..
+0007fcf0: 2020 2020 6966 2073 7566 6669 7820 6973      if suffix is
+0007fd00: 204e 6f6e 653a 2020 2020 0a20 2020 2020   None:    .     
+0007fd10: 2020 2066 615f 6669 6c65 5f74 7220 3d20     fa_file_tr = 
+0007fd20: 666e 616d 6520 2b20 275f 7472 616e 7363  fname + '_transc
+0007fd30: 7269 7074 6f6d 652e 6661 270a 2020 2020  riptome.fa'.    
+0007fd40: 2020 2020 6661 5f66 696c 655f 7072 203d      fa_file_pr =
+0007fd50: 2066 6e61 6d65 202b 2027 5f70 726f 7465   fname + '_prote
+0007fd60: 6f6d 652e 6661 270a 2020 2020 656c 7365  ome.fa'.    else
+0007fd70: 3a0a 2020 2020 2020 2020 6661 5f66 696c  :.        fa_fil
+0007fd80: 655f 7472 203d 2066 6e61 6d65 202b 2027  e_tr = fname + '
+0007fd90: 5f25 735f 7472 616e 7363 7269 7074 6f6d  _%s_transcriptom
+0007fda0: 652e 6661 2720 2520 7375 6666 6978 0a20  e.fa' % suffix. 
+0007fdb0: 2020 2020 2020 2066 615f 6669 6c65 5f70         fa_file_p
+0007fdc0: 7220 3d20 666e 616d 6520 2b20 275f 2573  r = fname + '_%s
+0007fdd0: 5f70 726f 7465 6f6d 652e 6661 2720 2520  _proteome.fa' % 
+0007fde0: 7375 6666 6978 0a0a 2020 2020 6661 5f74  suffix..    fa_t
+0007fdf0: 7220 3d20 5b5d 0a20 2020 2066 615f 7072  r = [].    fa_pr
+0007fe00: 203d 205b 5d0a 2020 2020 0a20 2020 2073   = [].    .    s
+0007fe10: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
+0007fe20: 2e74 696d 6528 290a 2020 2020 6e74 7220  .time().    ntr 
+0007fe30: 3d20 300a 0a20 2020 206d 6178 5f61 626e  = 0..    max_abn
+0007fe40: 203d 2030 0a20 2020 206d 6178 5f63 6f76   = 0.    max_cov
+0007fe50: 203d 2030 0a20 2020 2066 6f72 206b 6b2c   = 0.    for kk,
+0007fe60: 2063 6872 6d20 696e 2065 6e75 6d65 7261   chrm in enumera
+0007fe70: 7465 2863 6872 5f6c 7374 293a 0a20 2020  te(chr_lst):.   
+0007fe80: 2020 2020 2066 6f72 2067 6420 696e 2067       for gd in g
+0007fe90: 645f 6c73 7473 5b6b 6b5d 3a0a 2020 2020  d_lsts[kk]:.    
+0007fea0: 2020 2020 2020 2020 666f 7220 7464 2069          for td i
+0007feb0: 6e20 6764 2e74 645f 6c73 743a 0a20 2020  n gd.td_lst:.   
+0007fec0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007fed0: 7464 2e61 626e 203e 2030 3a20 6d61 785f  td.abn > 0: max_
+0007fee0: 6162 6e20 3d20 6d61 7828 206d 6178 5f61  abn = max( max_a
+0007fef0: 626e 2c20 7464 2e61 626e 2029 0a20 2020  bn, td.abn ).   
+0007ff00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0007ff10: 7464 2e63 6f76 203e 2030 3a20 6d61 785f  td.cov > 0: max_
+0007ff20: 636f 7620 3d20 6d61 7828 206d 6178 5f63  cov = max( max_c
+0007ff30: 6f76 2c20 7464 2e63 6f76 2029 0a0a 2020  ov, td.cov )..  
+0007ff40: 2020 6966 206d 6178 5f61 626e 203e 2030    if max_abn > 0
+0007ff50: 3a20 6162 6e5f 7468 203d 204d 494e 5f41  : abn_th = MIN_A
+0007ff60: 424e 5f54 4f5f 5345 4c0a 2020 2020 656c  BN_TO_SEL.    el
+0007ff70: 7365 3a20 6162 6e5f 7468 203d 2030 0a20  se: abn_th = 0. 
+0007ff80: 2020 2069 6620 6d61 785f 636f 7620 3e20     if max_cov > 
+0007ff90: 303a 2063 6f76 5f74 6820 3d20 4d49 4e5f  0: cov_th = MIN_
+0007ffa0: 434f 565f 544f 5f53 454c 0a20 2020 2065  COV_TO_SEL.    e
+0007ffb0: 6c73 653a 2063 6f76 5f74 6820 3d20 300a  lse: cov_th = 0.
+0007ffc0: 2020 2020 7072 696e 7428 2743 7574 6f66      print('Cutof
+0007ffd0: 663a 2041 203d 2025 352e 3266 2c20 4320  f: A = %5.2f, C 
+0007ffe0: 3d20 2535 2e32 6620 2720 2520 2861 626e  = %5.2f ' % (abn
+0007fff0: 5f74 682c 2063 6f76 5f74 6829 290a 0a20  _th, cov_th)).. 
+00080000: 2020 2066 6f72 206b 6b2c 2063 6872 6d20     for kk, chrm 
+00080010: 696e 2065 6e75 6d65 7261 7465 2863 6872  in enumerate(chr
+00080020: 5f6c 7374 293a 0a0a 2020 2020 2020 2020  _lst):..        
+00080030: 7072 696e 7428 275c 7227 202b 2027 2027  print('\r' + ' '
+00080040: 2a31 3030 2c20 656e 643d 2727 2c20 666c  *100, end='', fl
+00080050: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+00080060: 2020 2020 7072 696e 7428 275c 7247 656e      print('\rGen
+00080070: 6572 6174 696e 6720 7265 6665 7265 6e63  erating referenc
+00080080: 6573 202e 2e20 2573 2020 2720 2520 2863  es .. %s  ' % (c
+00080090: 6872 6d29 2c20 656e 6420 3d20 2727 2c20  hrm), end = '', 
+000800a0: 666c 7573 6820 3d20 5472 7565 290a 0a20  flush = True).. 
+000800b0: 2020 2020 2020 2066 6f72 2067 6420 696e         for gd in
+000800c0: 2067 645f 6c73 7473 5b6b 6b5d 3a0a 2020   gd_lsts[kk]:.  
+000800d0: 2020 2020 2020 2020 2020 2320 6764 2e6f            # gd.o
+000800e0: 7264 6572 2829 0a20 2020 2020 2020 2020  rder().         
+000800f0: 2020 206e 7472 202b 3d20 6764 2e6e 7472     ntr += gd.ntr
+00080100: 0a20 2020 2020 2020 2020 2020 2066 615f  .            fa_
+00080110: 742c 2066 615f 7020 3d20 6764 2e67 6574  t, fa_p = gd.get
+00080120: 5f66 6173 7461 5f6c 696e 6573 5f66 726f  _fasta_lines_fro
+00080130: 6d5f 6765 6e6f 6d65 2867 656e 6f6d 652c  m_genome(genome,
+00080140: 2061 626e 5f74 6820 3d20 6162 6e5f 7468   abn_th = abn_th
+00080150: 2c20 636f 765f 7468 203d 2063 6f76 5f74  , cov_th = cov_t
+00080160: 682c 206c 656e 5f74 685f 743d 204d 494e  h, len_th_t= MIN
+00080170: 5f54 525f 4c45 4e47 5448 2c20 6c65 6e5f  _TR_LENGTH, len_
+00080180: 7468 5f70 203d 204d 494e 5f50 525f 4c45  th_p = MIN_PR_LE
+00080190: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
+000801a0: 2020 0a20 2020 2020 2020 2020 2020 2023    .            #
+000801b0: 2066 615f 7420 3d20 6669 6c74 6572 5f74   fa_t = filter_t
+000801c0: 7273 5f6c 656e 2866 615f 742c 206d 696e  rs_len(fa_t, min
+000801d0: 5f6c 656e 203d 204d 494e 5f54 525f 4c45  _len = MIN_TR_LE
+000801e0: 4e47 5448 290a 2020 2020 2020 2020 2020  NGTH).          
+000801f0: 2020 2320 6661 5f70 203d 2066 696c 7465    # fa_p = filte
+00080200: 725f 7472 735f 6c65 6e28 6661 5f70 2c20  r_trs_len(fa_p, 
+00080210: 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f 5052  min_len = MIN_PR
+00080220: 5f4c 454e 4754 4829 0a20 2020 2020 2020  _LENGTH).       
+00080230: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00080240: 2020 6661 5f74 7220 3d20 6661 5f74 7220    fa_tr = fa_tr 
+00080250: 2b20 6661 5f74 0a20 2020 2020 2020 2020  + fa_t.         
+00080260: 2020 2066 615f 7072 203d 2066 615f 7072     fa_pr = fa_pr
+00080270: 202b 2066 615f 700a 2020 2020 2020 2020   + fa_p.        
+00080280: 2020 2020 0a20 2020 200a 2020 2020 6966      .    .    if
+00080290: 2028 6c65 6e28 6661 5f70 7229 203d 3d20   (len(fa_pr) == 
+000802a0: 3029 2026 2028 7065 7074 6964 6529 3a0a  0) & (peptide):.
+000802b0: 2020 2020 2020 2020 6864 725f 6c73 742c          hdr_lst,
+000802c0: 2074 7365 715f 6c73 7420 3d20 5b5d 2c20   tseq_lst = [], 
+000802d0: 5b5d 0a20 2020 2020 2020 2066 6f72 206c  [].        for l
+000802e0: 696e 6520 696e 2066 615f 7472 3a0a 2020  ine in fa_tr:.  
+000802f0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
+00080300: 655b 305d 203d 3d20 273e 273a 2068 6472  e[0] == '>': hdr
+00080310: 5f6c 7374 2e61 7070 656e 6428 6c69 6e65  _lst.append(line
+00080320: 5b31 3a2d 315d 290a 2020 2020 2020 2020  [1:-1]).        
+00080330: 2020 2020 656c 7365 3a20 7473 6571 5f6c      else: tseq_l
+00080340: 7374 2e61 7070 656e 6428 6c69 6e65 5b30  st.append(line[0
+00080350: 3a2d 315d 290a 0a20 2020 2020 2020 2066  :-1])..        f
+00080360: 615f 7072 203d 2067 656e 5f70 726f 7465  a_pr = gen_prote
+00080370: 6f6d 655f 6672 6f6d 5f74 7261 7363 7269  ome_from_trascri
+00080380: 7074 6f6d 6528 6864 725f 6c73 742c 2074  ptome(hdr_lst, t
+00080390: 7365 715f 6c73 742c 206c 656e 5f74 6820  seq_lst, len_th 
+000803a0: 3d20 4d49 4e5f 5052 5f4c 454e 4754 482c  = MIN_PR_LENGTH,
+000803b0: 2076 6572 626f 7365 203d 2054 7275 652c   verbose = True,
+000803c0: 2074 7261 7265 636f 203d 2046 616c 7365   trareco = False
+000803d0: 290a 2020 2020 2020 2020 705f 6361 6e64  ).        p_cand
+000803e0: 5f63 6e74 203d 206c 656e 2866 615f 7072  _cnt = len(fa_pr
+000803f0: 292f 320a 0a20 2020 2020 2020 2070 7269  )/2..        pri
+00080400: 6e74 2827 5c72 4765 6e65 7261 7469 6e67  nt('\rGenerating
+00080410: 2072 6566 6572 656e 6365 7320 2e2e 2064   references .. d
+00080420: 6f6e 652e 2025 6920 2d3e 2025 692c 2569  one. %i -> %i,%i
+00080430: 2720 2520 286e 7472 2c20 6c65 6e28 6661  ' % (ntr, len(fa
+00080440: 5f74 7229 2f32 2c20 705f 6361 6e64 5f63  _tr)/2, p_cand_c
+00080450: 6e74 2929 0a20 2020 2065 6c73 653a 0a20  nt)).    else:. 
+00080460: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+00080470: 4765 6e65 7261 7469 6e67 2072 6566 6572  Generating refer
+00080480: 656e 6365 7320 2e2e 2064 6f6e 652e 2025  ences .. done. %
+00080490: 6920 2d3e 2025 6927 2025 2028 6e74 722c  i -> %i' % (ntr,
+000804a0: 206c 656e 2866 615f 7472 292f 3229 290a   len(fa_tr)/2)).
+000804b0: 0a20 2020 2070 7269 6e74 2827 5361 7669  .    print('Savi
+000804c0: 6e67 2046 4153 5441 202e 2e27 2c20 656e  ng FASTA ..', en
+000804d0: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
+000804e0: 5472 7565 290a 2020 2020 6620 3d20 6f70  True).    f = op
+000804f0: 656e 2866 615f 6669 6c65 5f74 722c 2027  en(fa_file_tr, '
+00080500: 772b 2729 0a20 2020 2066 2e77 7269 7465  w+').    f.write
+00080510: 6c69 6e65 7328 6661 5f74 7229 0a20 2020  lines(fa_tr).   
+00080520: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
+00080530: 6966 2070 6570 7469 6465 3a0a 2020 2020  if peptide:.    
+00080540: 2020 2020 7072 696e 7428 272e 272c 2065      print('.', e
+00080550: 6e64 3d27 2729 0a20 2020 2020 2020 2066  nd='').        f
+00080560: 203d 206f 7065 6e28 6661 5f66 696c 655f   = open(fa_file_
+00080570: 7072 2c20 2777 2b27 290a 2020 2020 2020  pr, 'w+').      
+00080580: 2020 662e 7772 6974 656c 696e 6573 2866    f.writelines(f
+00080590: 615f 7072 290a 2020 2020 2020 2020 662e  a_pr).        f.
+000805a0: 636c 6f73 6528 290a 0a20 2020 2065 6c61  close()..    ela
+000805b0: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
+000805c0: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
+000805d0: 7469 6d65 0a20 2020 2070 7269 6e74 2827  time.    print('
+000805e0: 2064 6f6e 652e 2028 2569 2920 2720 2520   done. (%i) ' % 
+000805f0: 2865 6c61 7073 6564 5f74 696d 6529 290a  (elapsed_time)).
+00080600: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
+00080610: 2720 2520 6661 5f66 696c 655f 7472 2029  ' % fa_file_tr )
+00080620: 0a20 2020 2069 6620 7065 7074 6964 653a  .    if peptide:
+00080630: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
+00080640: 2066 615f 6669 6c65 5f70 7220 290a 2020   fa_file_pr ).  
+00080650: 2020 0a20 2020 2072 6574 7572 6e20 6661    .    return fa
+00080660: 5f66 696c 655f 7472 2c20 6661 5f66 696c  _file_tr, fa_fil
+00080670: 655f 7072 0a20 2020 200a 0a64 6566 206d  e_pr.    ..def m
+00080680: 635f 636f 7265 5f72 6563 6f6e 7374 7275  c_core_reconstru
+00080690: 6374 696f 6e28 6767 635f 7475 706c 6529  ction(ggc_tuple)
+000806a0: 3a0a 2020 2020 0a20 2020 2067 645f 7365  :.    .    gd_se
+000806b0: 6c20 3d20 6767 635f 7475 706c 655b 305d  l = ggc_tuple[0]
+000806c0: 0a20 2020 2073 6571 5f6f 7267 203d 2067  .    seq_org = g
+000806d0: 6763 5f74 7570 6c65 5b31 5d0a 2020 2020  gc_tuple[1].    
+000806e0: 6368 726d 203d 2067 6763 5f74 7570 6c65  chrm = ggc_tuple
+000806f0: 5b32 5d0a 2020 2020 0a20 2020 2023 2067  [2].    .    # g
+00080700: 645f 7365 6c20 3d20 736f 7274 5f64 6573  d_sel = sort_des
+00080710: 6372 6970 746f 725f 6c73 7428 6764 5f73  criptor_lst(gd_s
+00080720: 656c 290a 2020 2020 6e5f 6764 203d 206c  el).    n_gd = l
+00080730: 656e 2867 645f 7365 6c29 0a0a 2020 2020  en(gd_sel)..    
+00080740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080760: 2323 230a 2020 2020 2323 2063 6f6c 6c65  ###.    ## colle
+00080770: 6374 2072 676e 7320 616e 6420 6d61 726b  ct rgns and mark
+00080780: 2074 6865 6972 2070 6f73 0a20 2020 200a   their pos.    .
+00080790: 2020 2020 7374 6172 745f 7469 6d65 203d      start_time =
+000807a0: 2074 696d 652e 7469 6d65 2829 0a20 2020   time.time().   
+000807b0: 206c 6f63 5f6f 7320 3d20 6e70 2e7a 6572   loc_os = np.zer
+000807c0: 6f73 286e 5f67 642c 6474 7970 653d 6e70  os(n_gd,dtype=np
+000807d0: 2e66 6c6f 6174 3332 290a 2020 2020 6e75  .float32).    nu
+000807e0: 6d5f 6f73 203d 206e 702e 7a65 726f 7328  m_os = np.zeros(
+000807f0: 6e5f 6764 2c64 7479 7065 3d6e 702e 666c  n_gd,dtype=np.fl
+00080800: 6f61 7433 3229 0a20 2020 2072 616c 6c20  oat32).    rall 
+00080810: 3d20 7265 6769 6f6e 7328 290a 2020 2020  = regions().    
+00080820: 4765 6e65 5f69 645f 6e61 6d65 203d 205b  Gene_id_name = [
+00080830: 5d0a 2020 2020 6764 5f69 6478 5f6f 665f  ].    gd_idx_of_
+00080840: 7267 6e20 3d20 5b5d 0a20 2020 206f 735f  rgn = [].    os_
+00080850: 6375 7220 3d20 300a 2020 2020 725f 706f  cur = 0.    r_po
+00080860: 7320 3d20 5b5d 0a20 2020 2066 6f72 206b  s = [].    for k
+00080870: 2c20 6764 2069 6e20 656e 756d 6572 6174  , gd in enumerat
+00080880: 6528 6764 5f73 656c 293a 0a0a 2020 2020  e(gd_sel):..    
+00080890: 2020 2020 2323 2063 6865 636b 2069 6620      ## check if 
+000808a0: 616e 7920 4420 6f72 2049 206c 6965 7320  any D or I lies 
+000808b0: 7769 7468 696e 2061 6e20 6578 6f6e 0a20  within an exon. 
+000808c0: 2020 2020 2020 2066 6f72 2065 2069 6e20         for e in 
+000808d0: 6764 2e65 786f 6e73 2e72 676e 733a 0a20  gd.exons.rgns:. 
+000808e0: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
+000808f0: 7479 7065 203d 3d20 2764 656c 6574 696f  type == 'deletio
+00080900: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
+00080910: 2020 2020 6220 3d20 4661 6c73 650a 2020      b = False.  
+00080920: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00080930: 7220 6320 696e 2067 642e 6578 6f6e 732e  r c in gd.exons.
+00080940: 7267 6e73 3a0a 2020 2020 2020 2020 2020  rgns:.          
+00080950: 2020 2020 2020 2020 2020 6966 2028 632e            if (c.
+00080960: 7479 7065 203d 3d20 2765 786f 6e27 293a  type == 'exon'):
+00080970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00080980: 2020 2020 2020 2020 2069 6620 652e 6861           if e.ha
+00080990: 735f 6578 745f 696e 7465 7273 6563 7469  s_ext_intersecti
+000809a0: 6f6e 5f77 6974 6828 6329 3a0a 2020 2020  on_with(c):.    
+000809b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000809c0: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
+000809d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000809e0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000809f0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+00080a00: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+00080a10: 2020 2020 2020 2069 6620 623a 0a20 2020         if b:.   
+00080a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080a30: 2070 7269 6e74 2827 5741 524e 494e 473a   print('WARNING:
+00080a40: 2044 2825 733a 2569 2d25 6929 206f 7665   D(%s:%i-%i) ove
+00080a50: 726c 6170 7320 7769 7468 2045 2825 733a  rlaps with E(%s:
+00080a60: 2569 2d25 6929 2720 2520 5c0a 2020 2020  %i-%i)' % \.    
+00080a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080a80: 2020 2020 2020 2865 2e63 6872 2c20 652e        (e.chr, e.
+00080a90: 7374 6172 742c 2065 2e65 6e64 2c20 632e  start, e.end, c.
+00080aa0: 6368 722c 2063 2e73 7461 7274 2c20 632e  chr, c.start, c.
+00080ab0: 656e 6429 290a 2020 2020 2020 2020 2020  end)).          
+00080ac0: 2020 2020 2020 2727 2720 2020 200a 2020        '''    .  
+00080ad0: 2020 2020 2020 2020 2020 656c 6966 2065            elif e
+00080ae0: 2e74 7970 6520 3d3d 2027 696e 7365 7273  .type == 'insers
+00080af0: 696f 6e27 3a0a 2020 2020 2020 2020 2020  ion':.          
+00080b00: 2020 2020 2020 6220 3d20 4661 6c73 650a        b = False.
 00080b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080b20: 2020 2069 6620 2865 2e73 7461 7274 203e     if (e.start >
-00080b30: 2063 2e73 7461 7274 2920 2620 2865 2e73   c.start) & (e.s
-00080b40: 7461 7274 203c 2063 2e65 6e64 293a 0a20  tart < c.end):. 
-00080b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080b60: 2020 2020 2020 2020 2020 2062 203d 2054             b = T
-00080b70: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00080b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080b90: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00080ba0: 2020 2020 2020 2727 2720 2020 200a 2020        '''    .  
-00080bb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00080bc0: 2062 3a0a 2020 2020 2020 2020 2020 2020   b:.            
-00080bd0: 2020 2020 2020 2020 7072 696e 7428 2757          print('W
-00080be0: 4152 4e49 4e47 3a20 4928 2573 3a25 692d  ARNING: I(%s:%i-
-00080bf0: 2569 2920 6f76 6572 6c61 7073 2077 6974  %i) overlaps wit
-00080c00: 6820 4528 2573 3a25 692d 2569 2927 2025  h E(%s:%i-%i)' %
-00080c10: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00080c20: 2020 2020 2020 2020 2020 2020 2028 652e               (e.
-00080c30: 6368 722c 2065 2e73 7461 7274 2c20 652e  chr, e.start, e.
-00080c40: 656e 642c 2063 2e63 6872 2c20 632e 7374  end, c.chr, c.st
-00080c50: 6172 742c 2063 2e65 6e64 2929 0a20 2020  art, c.end)).   
-00080c60: 2020 2020 2020 2020 2020 2020 2027 2727               '''
-00080c70: 2020 2020 0a0a 2020 2020 2020 2020 6c6f      ..        lo
-00080c80: 635f 6f73 5b6b 5d20 3d20 6f73 5f63 7572  c_os[k] = os_cur
-00080c90: 0a20 2020 2020 2020 206e 756d 5f6f 735b  .        num_os[
-00080ca0: 6b5d 203d 206c 656e 2867 642e 6578 6f6e  k] = len(gd.exon
-00080cb0: 732e 7267 6e73 290a 2020 2020 2020 2020  s.rgns).        
-00080cc0: 7261 6c6c 2e72 676e 7320 3d20 7261 6c6c  rall.rgns = rall
-00080cd0: 2e72 676e 7320 2b20 6764 2e65 786f 6e73  .rgns + gd.exons
-00080ce0: 2e72 676e 730a 2020 2020 2020 2020 675f  .rgns.        g_
-00080cf0: 6964 5f6e 5f6e 616d 655f 6c73 7420 3d20  id_n_name_lst = 
-00080d00: 6764 2e67 6574 5f67 6964 5f6e 5f67 6e61  gd.get_gid_n_gna
-00080d10: 6d65 5f6c 6973 7428 290a 2020 2020 2020  me_list().      
-00080d20: 2020 4765 6e65 5f69 645f 6e61 6d65 203d    Gene_id_name =
-00080d30: 2047 656e 655f 6964 5f6e 616d 6520 2b20   Gene_id_name + 
-00080d40: 675f 6964 5f6e 5f6e 616d 655f 6c73 740a  g_id_n_name_lst.
-00080d50: 2020 2020 2020 2020 6764 5f69 6478 5f6f          gd_idx_o
-00080d60: 665f 7267 6e20 3d20 6764 5f69 6478 5f6f  f_rgn = gd_idx_o
-00080d70: 665f 7267 6e20 2b20 5b6b 5d2a 6c65 6e28  f_rgn + [k]*len(
-00080d80: 6764 2e65 786f 6e73 2e72 676e 7329 0a20  gd.exons.rgns). 
-00080d90: 2020 2020 2020 206f 735f 6375 7220 2b3d         os_cur +=
-00080da0: 206c 656e 2867 642e 6578 6f6e 732e 7267   len(gd.exons.rg
-00080db0: 6e73 290a 0a20 2020 2020 2020 2066 6f72  ns)..        for
-00080dc0: 2072 2069 6e20 6764 2e65 786f 6e73 2e72   r in gd.exons.r
-00080dd0: 676e 733a 0a20 2020 2020 2020 2020 2020  gns:.           
-00080de0: 2023 2072 5f70 6f73 2e61 7070 656e 6428   # r_pos.append(
-00080df0: 722e 656e 6429 0a20 2020 2020 2020 2020  r.end).         
-00080e00: 2020 2072 5f70 6f73 2e61 7070 656e 6428     r_pos.append(
-00080e10: 722e 7374 6172 7429 0a0a 2020 2020 2323  r.start)..    ##
-00080e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00080e40: 230a 2020 2020 2323 2067 6574 206f 7264  #.    ## get ord
-00080e50: 6572 2061 6363 6f72 6469 6e67 2074 6f20  er according to 
-00080e60: 6c6f 6361 7469 6f6e 0a20 2020 2072 5f70  location.    r_p
-00080e70: 6f73 203d 206e 702e 6172 7261 7928 725f  os = np.array(r_
-00080e80: 706f 7329 0a20 2020 206f 6472 203d 2072  pos).    odr = r
-00080e90: 5f70 6f73 2e61 7267 736f 7274 2829 0a0a  _pos.argsort()..
-00080ea0: 2020 2020 666f 7220 6b2c 206f 2069 6e20      for k, o in 
-00080eb0: 656e 756d 6572 6174 6528 6f64 7229 3a0a  enumerate(odr):.
-00080ec0: 2020 2020 2020 2020 7220 3d20 7261 6c6c          r = rall
-00080ed0: 2e72 676e 735b 6f5d 0a20 2020 2020 2020  .rgns[o].       
-00080ee0: 2069 6620 722e 7479 7065 203d 3d20 2769   if r.type == 'i
-00080ef0: 6e73 6572 7369 6f6e 273a 0a20 2020 2020  nsersion':.     
-00080f00: 2020 2020 2020 2072 7020 3d20 7261 6c6c         rp = rall
-00080f10: 2e72 676e 735b 6f64 725b 6b2d 315d 5d0a  .rgns[odr[k-1]].
-00080f20: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00080f30: 722e 7374 6172 7420 3d3d 2072 702e 7374  r.start == rp.st
-00080f40: 6172 7429 2026 2028 7270 2e74 7970 6520  art) & (rp.type 
-00080f50: 3d3d 2027 6578 6f6e 2729 3a0a 2020 2020  == 'exon'):.    
-00080f60: 2020 2020 2020 2020 2020 2020 6f70 203d              op =
-00080f70: 206f 6472 5b6b 2d31 5d0a 2020 2020 2020   odr[k-1].      
-00080f80: 2020 2020 2020 2020 2020 6f64 725b 6b2d            odr[k-
-00080f90: 315d 203d 206f 6472 5b6b 5d0a 2020 2020  1] = odr[k].    
-00080fa0: 2020 2020 2020 2020 2020 2020 6f64 725b              odr[
-00080fb0: 6b5d 203d 206f 700a 2020 2020 2020 2020  k] = op.        
-00080fc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00080fd0: 2020 2020 2020 2020 2020 726e 203d 2072            rn = r
-00080fe0: 616c 6c2e 7267 6e73 5b6f 6472 5b6b 2b31  all.rgns[odr[k+1
-00080ff0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-00081000: 2020 2069 6620 2872 6e2e 7374 6172 7420     if (rn.start 
-00081010: 3d3d 2072 2e73 7461 7274 2920 2620 2872  == r.start) & (r
-00081020: 6e2e 7479 7065 203d 3d20 2765 786f 6e27  n.type == 'exon'
-00081030: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00081040: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00081050: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00081060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00081070: 2020 2020 2020 7072 696e 7428 2745 5252        print('ERR
-00081080: 4f52 2025 693a 204e 6f20 636f 6e6e 6563  OR %i: No connec
-00081090: 7469 6f6e 2066 6f75 6e64 2066 6f72 2049  tion found for I
-000810a0: 2025 692c 2573 2d25 692c 2573 2d25 692c   %i,%s-%i,%s-%i,
-000810b0: 2573 2720 2520 5c0a 2020 2020 2020 2020  %s' % \.        
-000810c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000810d0: 2020 286b 2c20 7270 2e73 7461 7274 2c72    (k, rp.start,r
-000810e0: 702e 7479 7065 2c20 722e 7374 6172 742c  p.type, r.start,
-000810f0: 722e 7479 7065 2c20 726e 2e73 7461 7274  r.type, rn.start
-00081100: 2c20 726e 2e74 7970 6529 2029 0a0a 2020  , rn.type) )..  
-00081110: 2020 656c 6170 7365 645f 7469 6d65 203d    elapsed_time =
-00081120: 2074 696d 652e 7469 6d65 2829 202d 2073   time.time() - s
-00081130: 7461 7274 5f74 696d 650a 2020 2020 2320  tart_time.    # 
-00081140: 7072 696e 7428 2720 2020 312e 2064 6f6e  print('   1. don
-00081150: 6520 2825 6929 2020 2720 2520 2865 6c61  e (%i)  ' % (ela
-00081160: 7073 6564 5f74 696d 6529 2c20 666c 7573  psed_time), flus
-00081170: 6820 3d20 5472 7565 290a 2020 2020 2327  h = True).    #'
-00081180: 2727 0a0a 2020 2020 2327 2727 0a20 2020  ''..    #'''.   
-00081190: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-000811a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000811b0: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
-000811c0: 2320 6765 7420 206f 6666 7365 745f 6669  # get  offset_fi
-000811d0: 6e64 6572 2061 6e64 206e 6577 2067 656e  nder and new gen
-000811e0: 6f6d 6520 7365 710a 2020 2020 0a20 2020  ome seq.    .   
-000811f0: 2073 7461 7274 5f74 696d 6520 3d20 7469   start_time = ti
-00081200: 6d65 2e74 696d 6528 290a 2020 2020 6f66  me.time().    of
-00081210: 203d 206f 6666 7365 745f 6669 6e64 6572   = offset_finder
-00081220: 2829 0a20 2020 206f 735f 6375 7220 3d20  ().    os_cur = 
-00081230: 300a 2020 2020 7072 6576 5f70 6f73 203d  0.    prev_pos =
-00081240: 2031 2023 206f 6e65 2d62 6173 650a 2020   1 # one-base.  
-00081250: 2020 6c61 7374 5f70 6f73 203d 2031 2023    last_pos = 1 #
-00081260: 206f 6e65 2d62 6173 650a 0a20 2020 2073   one-base..    s
-00081270: 6571 5f6c 7374 203d 205b 5d0a 0a20 2020  eq_lst = []..   
-00081280: 2066 6f72 206d 2c20 6b20 696e 2065 6e75   for m, k in enu
-00081290: 6d65 7261 7465 286f 6472 293a 0a20 2020  merate(odr):.   
-000812a0: 2020 2020 2072 203d 2072 616c 6c2e 7267       r = rall.rg
-000812b0: 6e73 5b6b 5d0a 0a20 2020 2020 2020 2069  ns[k]..        i
-000812c0: 6620 722e 7479 7065 203d 3d20 2765 786f  f r.type == 'exo
-000812d0: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-000812e0: 6966 2028 722e 7374 6172 7429 203c 2028  if (r.start) < (
-000812f0: 7072 6576 5f70 6f73 293a 0a20 2020 2020  prev_pos):.     
-00081300: 2020 2020 2020 2020 2020 2069 6620 722e             if r.
-00081310: 656e 6420 3c20 7072 6576 5f70 6f73 3a0a  end < prev_pos:.
-00081320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081330: 2020 2020 2320 7072 696e 7428 2725 6920      # print('%i 
-00081340: 5741 524e 494e 4720 2845 4129 3a20 2573  WARNING (EA): %s
-00081350: 2c20 2569 2d25 6920 3c3d 2025 692c 2025  , %i-%i <= %i, %
-00081360: 692f 2569 2720 2520 286d 2c20 722e 6368  i/%i' % (m, r.ch
-00081370: 722c 2072 2e73 7461 7274 2c20 722e 656e  r, r.start, r.en
-00081380: 642c 2070 7265 765f 706f 732c 206d 2c20  d, prev_pos, m, 
-00081390: 6c65 6e28 6f64 7229 2920 290a 2020 2020  len(odr)) ).    
-000813a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000813b0: 735f 6f72 6720 3d20 7365 715f 6f72 675b  s_org = seq_org[
-000813c0: 2872 2e73 7461 7274 2d31 293a 2872 2e65  (r.start-1):(r.e
-000813d0: 6e64 295d 0a20 2020 2020 2020 2020 2020  nd)].           
-000813e0: 2020 2020 2020 2020 2072 2e63 6f6d 7061           r.compa
-000813f0: 7265 5f61 6e64 5f72 6570 6c61 6365 5f4e  re_and_replace_N
-00081400: 2873 5f6f 7267 290a 2020 2020 2020 2020  (s_org).        
-00081410: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00081420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081430: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00081440: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-00081450: 6e74 2827 2569 2057 4152 4e49 4e47 2028  nt('%i WARNING (
-00081460: 4542 293a 2025 732c 2025 692d 2569 203c  EB): %s, %i-%i <
-00081470: 3d20 2569 2720 2520 286d 2c20 722e 6368  = %i' % (m, r.ch
-00081480: 722c 2072 2e73 7461 7274 2c20 722e 656e  r, r.start, r.en
-00081490: 642c 2070 7265 765f 706f 7329 2029 0a20  d, prev_pos) ). 
-000814a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000814b0: 2020 2073 5f6f 7267 203d 2073 6571 5f6f     s_org = seq_o
-000814c0: 7267 5b28 722e 7374 6172 742d 3129 3a28  rg[(r.start-1):(
-000814d0: 722e 656e 6429 5d0a 2020 2020 2020 2020  r.end)].        
-000814e0: 2020 2020 2020 2020 2020 2020 722e 636f              r.co
-000814f0: 6d70 6172 655f 616e 645f 7265 706c 6163  mpare_and_replac
-00081500: 655f 4e28 735f 6f72 6729 0a20 2020 2020  e_N(s_org).     
-00081510: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00081520: 7020 3d20 2870 7265 765f 706f 732d 722e  p = (prev_pos-r.
-00081530: 7374 6172 7429 0a20 2020 2020 2020 2020  start).         
-00081540: 2020 2020 2020 2020 2020 2073 6571 5f6c             seq_l
-00081550: 7374 2e61 7070 656e 6428 722e 7365 715b  st.append(r.seq[
-00081560: 7370 3a5d 290a 0a20 2020 2020 2020 2020  sp:])..         
-00081570: 2020 2020 2020 2020 2020 206f 662e 6164             of.ad
-00081580: 6428 206f 735f 6375 722c 2070 7265 765f  d( os_cur, prev_
-00081590: 706f 732c 2072 2e65 6e64 2b31 2029 0a20  pos, r.end+1 ). 
-000815a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000815b0: 2020 2070 7265 765f 706f 7320 3d20 722e     prev_pos = r.
-000815c0: 656e 642b 310a 0a20 2020 2020 2020 2020  end+1..         
-000815d0: 2020 2065 6c73 653a 2020 2020 2020 2020     else:        
-000815e0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000815f0: 2020 2020 2020 2020 735f 6f72 6720 3d20          s_org = 
-00081600: 7365 715f 6f72 675b 2872 2e73 7461 7274  seq_org[(r.start
-00081610: 2d31 293a 2872 2e65 6e64 295d 0a20 2020  -1):(r.end)].   
-00081620: 2020 2020 2020 2020 2020 2020 2023 6966               #if
-00081630: 206c 656e 2873 5f6f 7267 2920 3d3d 206c   len(s_org) == l
-00081640: 656e 2872 2e73 6571 293a 0a20 2020 2020  en(r.seq):.     
-00081650: 2020 2020 2020 2020 2020 2072 2e63 6f6d             r.com
-00081660: 7061 7265 5f61 6e64 5f72 6570 6c61 6365  pare_and_replace
-00081670: 5f4e 2873 5f6f 7267 290a 2020 2020 2020  _N(s_org).      
-00081680: 2020 2020 2020 2020 2020 2320 656c 7365            # else
-00081690: 3a20 2070 7269 6e74 2820 2757 4152 4e49  :  print( 'WARNI
-000816a0: 4e47 3a20 2569 2d25 6920 696e 2025 6920  NG: %i-%i in %i 
-000816b0: 7e3d 2025 6927 2025 2028 722e 7374 6172  ~= %i' % (r.star
-000816c0: 742c 2072 2e65 6e64 2c20 6c65 6e28 735f  t, r.end, len(s_
-000816d0: 6f72 6729 2c20 6c65 6e28 722e 7365 7129  org), len(r.seq)
-000816e0: 2920 290a 0a20 2020 2020 2020 2020 2020  ) )..           
-000816f0: 2020 2020 2069 6620 722e 7374 6172 7420       if r.start 
-00081700: 3e20 7072 6576 5f70 6f73 3a0a 2020 2020  > prev_pos:.    
-00081710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081720: 7365 715f 6c73 742e 6170 7065 6e64 2873  seq_lst.append(s
-00081730: 6571 5f6f 7267 5b28 7072 6576 5f70 6f73  eq_org[(prev_pos
-00081740: 2d31 293a 2872 2e73 7461 7274 2d31 295d  -1):(r.start-1)]
-00081750: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081760: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00081770: 2020 2020 2020 2073 6571 5f6c 7374 2e61         seq_lst.a
-00081780: 7070 656e 6428 722e 7365 7129 0a20 2020  ppend(r.seq).   
-00081790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000817a0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000817b0: 2020 6f66 2e61 6464 2820 6f73 5f63 7572    of.add( os_cur
-000817c0: 2c20 7072 6576 5f70 6f73 2c20 722e 656e  , prev_pos, r.en
-000817d0: 642b 3120 290a 2020 2020 2020 2020 2020  d+1 ).          
-000817e0: 2020 2020 2020 7072 6576 5f70 6f73 203d        prev_pos =
-000817f0: 2072 2e65 6e64 2b31 0a20 2020 2020 2020   r.end+1.       
-00081800: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00081810: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00081820: 206c 656e 2872 2e73 6571 2920 213d 206c   len(r.seq) != l
-00081830: 656e 2873 5f6f 7267 293a 0a20 2020 2020  en(s_org):.     
-00081840: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00081850: 2070 7269 6e74 2820 2757 4152 4e49 4e47   print( 'WARNING
-00081860: 3a20 2573 3a20 2569 2d25 6920 696e 2025  : %s: %i-%i in %
-00081870: 6920 7e3d 2025 6927 2025 2028 722e 6368  i ~= %i' % (r.ch
-00081880: 722c 2072 2e73 7461 7274 2c20 722e 656e  r, r.start, r.en
-00081890: 642c 206c 656e 2873 5f6f 7267 292c 206c  d, len(s_org), l
-000818a0: 656e 2872 2e73 6571 2929 2029 0a20 2020  en(r.seq)) ).   
-000818b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000818c0: 2023 2073 6571 5f6c 7374 2e61 7070 656e   # seq_lst.appen
-000818d0: 6428 735f 6f72 6729 0a20 2020 2020 2020  d(s_org).       
-000818e0: 2020 2020 2020 2020 2020 2020 2023 2072               # r
-000818f0: 2e73 6571 203d 2072 6567 696f 6e28 722e  .seq = region(r.
-00081900: 6368 722c 2072 2e73 7461 7274 2c20 722e  chr, r.start, r.
-00081910: 656e 642c 2072 2e74 7970 652c 2073 5f6f  end, r.type, s_o
-00081920: 7267 2c20 6376 675f 6465 7020 3d20 4356  rg, cvg_dep = CV
-00081930: 475f 4445 5054 485f 544d 5020 290a 2020  G_DEPTH_TMP ).  
-00081940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081950: 2020 2320 722e 6765 745f 6376 6728 290a    # r.get_cvg().
-00081960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081970: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00081980: 2020 2020 2020 2020 2020 2020 200a 0a20               .. 
-00081990: 2020 2020 2020 2065 6c69 6620 2872 2e74         elif (r.t
-000819a0: 7970 6520 3d3d 2027 696e 7365 7273 696f  ype == 'insersio
-000819b0: 6e27 2920 7c20 2872 2e74 7970 6520 3d3d  n') | (r.type ==
-000819c0: 2027 4927 2029 3a0a 2020 2020 2020 2020   'I' ):.        
-000819d0: 2020 2020 6966 2028 722e 7374 6172 7429      if (r.start)
-000819e0: 203c 2028 7072 6576 5f70 6f73 293a 0a20   < (prev_pos):. 
-000819f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00081a00: 2070 7269 6e74 2827 5741 524e 494e 4720   print('WARNING 
-00081a10: 2849 293a 2025 6920 2d20 2573 2c20 2569  (I): %i - %s, %i
-00081a20: 203c 2025 6927 2025 2028 6d2c 2072 2e63   < %i' % (m, r.c
-00081a30: 6872 2c20 722e 7374 6172 742c 2070 7265  hr, r.start, pre
-00081a40: 765f 706f 7329 2029 0a20 2020 2020 2020  v_pos) ).       
-00081a50: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00081a60: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00081a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081a80: 6f66 2e61 6464 2820 6f73 5f63 7572 2c20  of.add( os_cur, 
-00081a90: 7072 6576 5f70 6f73 2c20 722e 7374 6172  prev_pos, r.star
-00081aa0: 7420 290a 2020 2020 2020 2020 2020 2020  t ).            
-00081ab0: 2020 2020 6f73 5f63 7572 202b 3d20 2872      os_cur += (r
-00081ac0: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
-00081ad0: 2031 290a 0a20 2020 2020 2020 2020 2020   1)..           
-00081ae0: 2020 2020 2069 6620 722e 7374 6172 7420       if r.start 
-00081af0: 3e20 7072 6576 5f70 6f73 3a0a 2020 2020  > prev_pos:.    
-00081b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00081b10: 7365 715f 6c73 742e 6170 7065 6e64 2873  seq_lst.append(s
-00081b20: 6571 5f6f 7267 5b28 7072 6576 5f70 6f73  eq_org[(prev_pos
-00081b30: 2d31 293a 2872 2e73 7461 7274 2d31 295d  -1):(r.start-1)]
-00081b40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081b50: 2020 7365 715f 6c73 742e 6170 7065 6e64    seq_lst.append
-00081b60: 2872 2e73 6571 290a 0a20 2020 2020 2020  (r.seq)..       
-00081b70: 2020 2020 2020 2020 2070 7265 765f 706f           prev_po
-00081b80: 7320 3d20 722e 7374 6172 740a 0a20 2020  s = r.start..   
-00081b90: 2020 2020 2065 6c69 6620 2872 2e74 7970       elif (r.typ
-00081ba0: 6520 3d3d 2027 6465 6c65 7469 6f6e 2729  e == 'deletion')
-00081bb0: 207c 2028 722e 7479 7065 203d 3d20 2744   | (r.type == 'D
-00081bc0: 2720 293a 0a20 2020 2020 2020 2020 2020  ' ):.           
-00081bd0: 2069 6620 2872 2e73 7461 7274 2920 3c20   if (r.start) < 
-00081be0: 2870 7265 765f 706f 7329 3a0a 2020 2020  (prev_pos):.    
-00081bf0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00081c00: 696e 7428 2757 4152 4e49 4e47 2028 4429  int('WARNING (D)
-00081c10: 3a20 2569 202d 2025 732c 2025 6920 3c3d  : %i - %s, %i <=
-00081c20: 2025 6927 2025 2028 6d2c 2072 2e63 6872   %i' % (m, r.chr
-00081c30: 2c20 722e 7374 6172 742c 2070 7265 765f  , r.start, prev_
-00081c40: 706f 7329 2029 0a20 2020 2020 2020 2020  pos) ).         
-00081c50: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00081c60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00081c70: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-00081c80: 2e61 6464 2820 6f73 5f63 7572 2c20 7072  .add( os_cur, pr
-00081c90: 6576 5f70 6f73 2c20 722e 7374 6172 7420  ev_pos, r.start 
-00081ca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081cb0: 2020 6f73 5f63 7572 202d 3d20 2872 2e65    os_cur -= (r.e
-00081cc0: 6e64 202d 2072 2e73 7461 7274 202b 2031  nd - r.start + 1
-00081cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00081ce0: 2020 7072 6576 5f70 6f73 203d 2072 2e73    prev_pos = r.s
-00081cf0: 7461 7274 0a0a 2020 2020 2020 2020 2020  tart..          
-00081d00: 2020 2020 2020 6f66 2e61 6464 2820 6f73        of.add( os
-00081d10: 5f63 7572 2c20 7072 6576 5f70 6f73 2c20  _cur, prev_pos, 
-00081d20: 722e 656e 642b 3120 290a 2020 2020 2020  r.end+1 ).      
+00080b20: 666f 7220 6320 696e 2067 642e 6578 6f6e  for c in gd.exon
+00080b30: 732e 7267 6e73 3a0a 2020 2020 2020 2020  s.rgns:.        
+00080b40: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00080b50: 632e 7479 7065 203d 3d20 2765 786f 6e27  c.type == 'exon'
+00080b60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00080b70: 2020 2020 2020 2020 2020 2069 6620 2865             if (e
+00080b80: 2e73 7461 7274 203e 2063 2e73 7461 7274  .start > c.start
+00080b90: 2920 2620 2865 2e73 7461 7274 203c 2063  ) & (e.start < c
+00080ba0: 2e65 6e64 293a 0a20 2020 2020 2020 2020  .end):.         
+00080bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080bc0: 2020 2062 203d 2054 7275 650a 2020 2020     b = True.    
+00080bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080be0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00080bf0: 2020 2020 2020 2020 2020 2020 2020 2727                ''
+00080c00: 2720 2020 200a 2020 2020 2020 2020 2020  '    .          
+00080c10: 2020 2020 2020 6966 2062 3a0a 2020 2020        if b:.    
+00080c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080c30: 7072 696e 7428 2757 4152 4e49 4e47 3a20  print('WARNING: 
+00080c40: 4928 2573 3a25 692d 2569 2920 6f76 6572  I(%s:%i-%i) over
+00080c50: 6c61 7073 2077 6974 6820 4528 2573 3a25  laps with E(%s:%
+00080c60: 692d 2569 2927 2025 205c 0a20 2020 2020  i-%i)' % \.     
+00080c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00080c80: 2020 2020 2028 652e 6368 722c 2065 2e73       (e.chr, e.s
+00080c90: 7461 7274 2c20 652e 656e 642c 2063 2e63  tart, e.end, c.c
+00080ca0: 6872 2c20 632e 7374 6172 742c 2063 2e65  hr, c.start, c.e
+00080cb0: 6e64 2929 0a20 2020 2020 2020 2020 2020  nd)).           
+00080cc0: 2020 2020 2027 2727 2020 2020 0a0a 2020       '''    ..  
+00080cd0: 2020 2020 2020 6c6f 635f 6f73 5b6b 5d20        loc_os[k] 
+00080ce0: 3d20 6f73 5f63 7572 0a20 2020 2020 2020  = os_cur.       
+00080cf0: 206e 756d 5f6f 735b 6b5d 203d 206c 656e   num_os[k] = len
+00080d00: 2867 642e 6578 6f6e 732e 7267 6e73 290a  (gd.exons.rgns).
+00080d10: 2020 2020 2020 2020 7261 6c6c 2e72 676e          rall.rgn
+00080d20: 7320 3d20 7261 6c6c 2e72 676e 7320 2b20  s = rall.rgns + 
+00080d30: 6764 2e65 786f 6e73 2e72 676e 730a 2020  gd.exons.rgns.  
+00080d40: 2020 2020 2020 675f 6964 5f6e 5f6e 616d        g_id_n_nam
+00080d50: 655f 6c73 7420 3d20 6764 2e67 6574 5f67  e_lst = gd.get_g
+00080d60: 6964 5f6e 5f67 6e61 6d65 5f6c 6973 7428  id_n_gname_list(
+00080d70: 290a 2020 2020 2020 2020 4765 6e65 5f69  ).        Gene_i
+00080d80: 645f 6e61 6d65 203d 2047 656e 655f 6964  d_name = Gene_id
+00080d90: 5f6e 616d 6520 2b20 675f 6964 5f6e 5f6e  _name + g_id_n_n
+00080da0: 616d 655f 6c73 740a 2020 2020 2020 2020  ame_lst.        
+00080db0: 6764 5f69 6478 5f6f 665f 7267 6e20 3d20  gd_idx_of_rgn = 
+00080dc0: 6764 5f69 6478 5f6f 665f 7267 6e20 2b20  gd_idx_of_rgn + 
+00080dd0: 5b6b 5d2a 6c65 6e28 6764 2e65 786f 6e73  [k]*len(gd.exons
+00080de0: 2e72 676e 7329 0a20 2020 2020 2020 206f  .rgns).        o
+00080df0: 735f 6375 7220 2b3d 206c 656e 2867 642e  s_cur += len(gd.
+00080e00: 6578 6f6e 732e 7267 6e73 290a 0a20 2020  exons.rgns)..   
+00080e10: 2020 2020 2066 6f72 2072 2069 6e20 6764       for r in gd
+00080e20: 2e65 786f 6e73 2e72 676e 733a 0a20 2020  .exons.rgns:.   
+00080e30: 2020 2020 2020 2020 2023 2072 5f70 6f73           # r_pos
+00080e40: 2e61 7070 656e 6428 722e 656e 6429 0a20  .append(r.end). 
+00080e50: 2020 2020 2020 2020 2020 2072 5f70 6f73             r_pos
+00080e60: 2e61 7070 656e 6428 722e 7374 6172 7429  .append(r.start)
+00080e70: 0a0a 2020 2020 2323 2323 2323 2323 2323  ..    ##########
+00080e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00080e90: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00080ea0: 2067 6574 206f 7264 6572 2061 6363 6f72   get order accor
+00080eb0: 6469 6e67 2074 6f20 6c6f 6361 7469 6f6e  ding to location
+00080ec0: 0a20 2020 2072 5f70 6f73 203d 206e 702e  .    r_pos = np.
+00080ed0: 6172 7261 7928 725f 706f 7329 0a20 2020  array(r_pos).   
+00080ee0: 206f 6472 203d 2072 5f70 6f73 2e61 7267   odr = r_pos.arg
+00080ef0: 736f 7274 2829 0a0a 2020 2020 666f 7220  sort()..    for 
+00080f00: 6b2c 206f 2069 6e20 656e 756d 6572 6174  k, o in enumerat
+00080f10: 6528 6f64 7229 3a0a 2020 2020 2020 2020  e(odr):.        
+00080f20: 7220 3d20 7261 6c6c 2e72 676e 735b 6f5d  r = rall.rgns[o]
+00080f30: 0a20 2020 2020 2020 2069 6620 722e 7479  .        if r.ty
+00080f40: 7065 203d 3d20 2769 6e73 6572 7369 6f6e  pe == 'insersion
+00080f50: 273a 0a20 2020 2020 2020 2020 2020 2072  ':.            r
+00080f60: 7020 3d20 7261 6c6c 2e72 676e 735b 6f64  p = rall.rgns[od
+00080f70: 725b 6b2d 315d 5d0a 2020 2020 2020 2020  r[k-1]].        
+00080f80: 2020 2020 6966 2028 722e 7374 6172 7420      if (r.start 
+00080f90: 3d3d 2072 702e 7374 6172 7429 2026 2028  == rp.start) & (
+00080fa0: 7270 2e74 7970 6520 3d3d 2027 6578 6f6e  rp.type == 'exon
+00080fb0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+00080fc0: 2020 2020 6f70 203d 206f 6472 5b6b 2d31      op = odr[k-1
+00080fd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00080fe0: 2020 6f64 725b 6b2d 315d 203d 206f 6472    odr[k-1] = odr
+00080ff0: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
+00081000: 2020 2020 6f64 725b 6b5d 203d 206f 700a      odr[k] = op.
+00081010: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00081020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00081030: 2020 726e 203d 2072 616c 6c2e 7267 6e73    rn = rall.rgns
+00081040: 5b6f 6472 5b6b 2b31 5d5d 0a20 2020 2020  [odr[k+1]].     
+00081050: 2020 2020 2020 2020 2020 2069 6620 2872             if (r
+00081060: 6e2e 7374 6172 7420 3d3d 2072 2e73 7461  n.start == r.sta
+00081070: 7274 2920 2620 2872 6e2e 7479 7065 203d  rt) & (rn.type =
+00081080: 3d20 2765 786f 6e27 293a 0a20 2020 2020  = 'exon'):.     
+00081090: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000810a0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+000810b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000810c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000810d0: 696e 7428 2745 5252 4f52 2025 693a 204e  int('ERROR %i: N
+000810e0: 6f20 636f 6e6e 6563 7469 6f6e 2066 6f75  o connection fou
+000810f0: 6e64 2066 6f72 2049 2025 692c 2573 2d25  nd for I %i,%s-%
+00081100: 692c 2573 2d25 692c 2573 2720 2520 5c0a  i,%s-%i,%s' % \.
+00081110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081120: 2020 2020 2020 2020 2020 286b 2c20 7270            (k, rp
+00081130: 2e73 7461 7274 2c72 702e 7479 7065 2c20  .start,rp.type, 
+00081140: 722e 7374 6172 742c 722e 7479 7065 2c20  r.start,r.type, 
+00081150: 726e 2e73 7461 7274 2c20 726e 2e74 7970  rn.start, rn.typ
+00081160: 6529 2029 0a0a 2020 2020 656c 6170 7365  e) )..    elapse
+00081170: 645f 7469 6d65 203d 2074 696d 652e 7469  d_time = time.ti
+00081180: 6d65 2829 202d 2073 7461 7274 5f74 696d  me() - start_tim
+00081190: 650a 2020 2020 2320 7072 696e 7428 2720  e.    # print(' 
+000811a0: 2020 312e 2064 6f6e 6520 2825 6929 2020    1. done (%i)  
+000811b0: 2720 2520 2865 6c61 7073 6564 5f74 696d  ' % (elapsed_tim
+000811c0: 6529 2c20 666c 7573 6820 3d20 5472 7565  e), flush = True
+000811d0: 290a 2020 2020 2327 2727 0a0a 2020 2020  ).    #'''..    
+000811e0: 2327 2727 0a20 2020 2023 2323 2323 2323  #'''.    #######
+000811f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081210: 2323 0a20 2020 2023 2320 6765 7420 206f  ##.    ## get  o
+00081220: 6666 7365 745f 6669 6e64 6572 2061 6e64  ffset_finder and
+00081230: 206e 6577 2067 656e 6f6d 6520 7365 710a   new genome seq.
+00081240: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
+00081250: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+00081260: 290a 2020 2020 6f66 203d 206f 6666 7365  ).    of = offse
+00081270: 745f 6669 6e64 6572 2829 0a20 2020 206f  t_finder().    o
+00081280: 735f 6375 7220 3d20 300a 2020 2020 7072  s_cur = 0.    pr
+00081290: 6576 5f70 6f73 203d 2031 2023 206f 6e65  ev_pos = 1 # one
+000812a0: 2d62 6173 650a 2020 2020 6c61 7374 5f70  -base.    last_p
+000812b0: 6f73 203d 2031 2023 206f 6e65 2d62 6173  os = 1 # one-bas
+000812c0: 650a 0a20 2020 2073 6571 5f6c 7374 203d  e..    seq_lst =
+000812d0: 205b 5d0a 0a20 2020 2066 6f72 206d 2c20   []..    for m, 
+000812e0: 6b20 696e 2065 6e75 6d65 7261 7465 286f  k in enumerate(o
+000812f0: 6472 293a 0a20 2020 2020 2020 2072 203d  dr):.        r =
+00081300: 2072 616c 6c2e 7267 6e73 5b6b 5d0a 0a20   rall.rgns[k].. 
+00081310: 2020 2020 2020 2069 6620 722e 7479 7065         if r.type
+00081320: 203d 3d20 2765 786f 6e27 3a0a 2020 2020   == 'exon':.    
+00081330: 2020 2020 2020 2020 6966 2028 722e 7374          if (r.st
+00081340: 6172 7429 203c 2028 7072 6576 5f70 6f73  art) < (prev_pos
+00081350: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00081360: 2020 2069 6620 722e 656e 6420 3c20 7072     if r.end < pr
+00081370: 6576 5f70 6f73 3a0a 2020 2020 2020 2020  ev_pos:.        
+00081380: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+00081390: 696e 7428 2725 6920 5741 524e 494e 4720  int('%i WARNING 
+000813a0: 2845 4129 3a20 2573 2c20 2569 2d25 6920  (EA): %s, %i-%i 
+000813b0: 3c3d 2025 692c 2025 692f 2569 2720 2520  <= %i, %i/%i' % 
+000813c0: 286d 2c20 722e 6368 722c 2072 2e73 7461  (m, r.chr, r.sta
+000813d0: 7274 2c20 722e 656e 642c 2070 7265 765f  rt, r.end, prev_
+000813e0: 706f 732c 206d 2c20 6c65 6e28 6f64 7229  pos, m, len(odr)
+000813f0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+00081400: 2020 2020 2020 2020 735f 6f72 6720 3d20          s_org = 
+00081410: 7365 715f 6f72 675b 2872 2e73 7461 7274  seq_org[(r.start
+00081420: 2d31 293a 2872 2e65 6e64 295d 0a20 2020  -1):(r.end)].   
+00081430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081440: 2072 2e63 6f6d 7061 7265 5f61 6e64 5f72   r.compare_and_r
+00081450: 6570 6c61 6365 5f4e 2873 5f6f 7267 290a  eplace_N(s_org).
+00081460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081470: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00081480: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00081490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000814a0: 2020 2023 2070 7269 6e74 2827 2569 2057     # print('%i W
+000814b0: 4152 4e49 4e47 2028 4542 293a 2025 732c  ARNING (EB): %s,
+000814c0: 2025 692d 2569 203c 3d20 2569 2720 2520   %i-%i <= %i' % 
+000814d0: 286d 2c20 722e 6368 722c 2072 2e73 7461  (m, r.chr, r.sta
+000814e0: 7274 2c20 722e 656e 642c 2070 7265 765f  rt, r.end, prev_
+000814f0: 706f 7329 2029 0a20 2020 2020 2020 2020  pos) ).         
+00081500: 2020 2020 2020 2020 2020 2073 5f6f 7267             s_org
+00081510: 203d 2073 6571 5f6f 7267 5b28 722e 7374   = seq_org[(r.st
+00081520: 6172 742d 3129 3a28 722e 656e 6429 5d0a  art-1):(r.end)].
+00081530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081540: 2020 2020 722e 636f 6d70 6172 655f 616e      r.compare_an
+00081550: 645f 7265 706c 6163 655f 4e28 735f 6f72  d_replace_N(s_or
+00081560: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
+00081570: 2020 2020 2020 2073 7020 3d20 2870 7265         sp = (pre
+00081580: 765f 706f 732d 722e 7374 6172 7429 0a20  v_pos-r.start). 
+00081590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000815a0: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
+000815b0: 6428 722e 7365 715b 7370 3a5d 290a 0a20  d(r.seq[sp:]).. 
+000815c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000815d0: 2020 206f 662e 6164 6428 206f 735f 6375     of.add( os_cu
+000815e0: 722c 2070 7265 765f 706f 732c 2072 2e65  r, prev_pos, r.e
+000815f0: 6e64 2b31 2029 0a20 2020 2020 2020 2020  nd+1 ).         
+00081600: 2020 2020 2020 2020 2020 2070 7265 765f             prev_
+00081610: 706f 7320 3d20 722e 656e 642b 310a 0a20  pos = r.end+1.. 
+00081620: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00081630: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00081640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00081650: 735f 6f72 6720 3d20 7365 715f 6f72 675b  s_org = seq_org[
+00081660: 2872 2e73 7461 7274 2d31 293a 2872 2e65  (r.start-1):(r.e
+00081670: 6e64 295d 0a20 2020 2020 2020 2020 2020  nd)].           
+00081680: 2020 2020 2023 6966 206c 656e 2873 5f6f       #if len(s_o
+00081690: 7267 2920 3d3d 206c 656e 2872 2e73 6571  rg) == len(r.seq
+000816a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000816b0: 2020 2072 2e63 6f6d 7061 7265 5f61 6e64     r.compare_and
+000816c0: 5f72 6570 6c61 6365 5f4e 2873 5f6f 7267  _replace_N(s_org
+000816d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000816e0: 2020 2320 656c 7365 3a20 2070 7269 6e74    # else:  print
+000816f0: 2820 2757 4152 4e49 4e47 3a20 2569 2d25  ( 'WARNING: %i-%
+00081700: 6920 696e 2025 6920 7e3d 2025 6927 2025  i in %i ~= %i' %
+00081710: 2028 722e 7374 6172 742c 2072 2e65 6e64   (r.start, r.end
+00081720: 2c20 6c65 6e28 735f 6f72 6729 2c20 6c65  , len(s_org), le
+00081730: 6e28 722e 7365 7129 2920 290a 0a20 2020  n(r.seq)) )..   
+00081740: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00081750: 722e 7374 6172 7420 3e20 7072 6576 5f70  r.start > prev_p
+00081760: 6f73 3a0a 2020 2020 2020 2020 2020 2020  os:.            
+00081770: 2020 2020 2020 2020 7365 715f 6c73 742e          seq_lst.
+00081780: 6170 7065 6e64 2873 6571 5f6f 7267 5b28  append(seq_org[(
+00081790: 7072 6576 5f70 6f73 2d31 293a 2872 2e73  prev_pos-1):(r.s
+000817a0: 7461 7274 2d31 295d 290a 2020 2020 2020  tart-1)]).      
+000817b0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+000817c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000817d0: 6571 5f6c 7374 2e61 7070 656e 6428 722e  eq_lst.append(r.
+000817e0: 7365 7129 0a20 2020 2020 2020 2020 2020  seq).           
+000817f0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00081800: 2020 2020 2020 2020 2020 6f66 2e61 6464            of.add
+00081810: 2820 6f73 5f63 7572 2c20 7072 6576 5f70  ( os_cur, prev_p
+00081820: 6f73 2c20 722e 656e 642b 3120 290a 2020  os, r.end+1 ).  
+00081830: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00081840: 6576 5f70 6f73 203d 2072 2e65 6e64 2b31  ev_pos = r.end+1
+00081850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081860: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00081870: 2020 2020 2020 6966 206c 656e 2872 2e73        if len(r.s
+00081880: 6571 2920 213d 206c 656e 2873 5f6f 7267  eq) != len(s_org
+00081890: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000818a0: 2020 2020 2020 2023 2070 7269 6e74 2820         # print( 
+000818b0: 2757 4152 4e49 4e47 3a20 2573 3a20 2569  'WARNING: %s: %i
+000818c0: 2d25 6920 696e 2025 6920 7e3d 2025 6927  -%i in %i ~= %i'
+000818d0: 2025 2028 722e 6368 722c 2072 2e73 7461   % (r.chr, r.sta
+000818e0: 7274 2c20 722e 656e 642c 206c 656e 2873  rt, r.end, len(s
+000818f0: 5f6f 7267 292c 206c 656e 2872 2e73 6571  _org), len(r.seq
+00081900: 2929 2029 0a20 2020 2020 2020 2020 2020  )) ).           
+00081910: 2020 2020 2020 2020 2023 2073 6571 5f6c           # seq_l
+00081920: 7374 2e61 7070 656e 6428 735f 6f72 6729  st.append(s_org)
+00081930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081940: 2020 2020 2023 2072 2e73 6571 203d 2072       # r.seq = r
+00081950: 6567 696f 6e28 722e 6368 722c 2072 2e73  egion(r.chr, r.s
+00081960: 7461 7274 2c20 722e 656e 642c 2072 2e74  tart, r.end, r.t
+00081970: 7970 652c 2073 5f6f 7267 2c20 6376 675f  ype, s_org, cvg_
+00081980: 6465 7020 3d20 4356 475f 4445 5054 485f  dep = CVG_DEPTH_
+00081990: 544d 5020 290a 2020 2020 2020 2020 2020  TMP ).          
+000819a0: 2020 2020 2020 2020 2020 2320 722e 6765            # r.ge
+000819b0: 745f 6376 6728 290a 2020 2020 2020 2020  t_cvg().        
+000819c0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+000819d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000819e0: 2020 2020 200a 0a20 2020 2020 2020 2065       ..        e
+000819f0: 6c69 6620 2872 2e74 7970 6520 3d3d 2027  lif (r.type == '
+00081a00: 696e 7365 7273 696f 6e27 2920 7c20 2872  insersion') | (r
+00081a10: 2e74 7970 6520 3d3d 2027 4927 2029 3a0a  .type == 'I' ):.
+00081a20: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00081a30: 722e 7374 6172 7429 203c 2028 7072 6576  r.start) < (prev
+00081a40: 5f70 6f73 293a 0a20 2020 2020 2020 2020  _pos):.         
+00081a50: 2020 2020 2020 2023 2070 7269 6e74 2827         # print('
+00081a60: 5741 524e 494e 4720 2849 293a 2025 6920  WARNING (I): %i 
+00081a70: 2d20 2573 2c20 2569 203c 2025 6927 2025  - %s, %i < %i' %
+00081a80: 2028 6d2c 2072 2e63 6872 2c20 722e 7374   (m, r.chr, r.st
+00081a90: 6172 742c 2070 7265 765f 706f 7329 2029  art, prev_pos) )
+00081aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081ab0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00081ac0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00081ad0: 2020 2020 2020 2020 6f66 2e61 6464 2820          of.add( 
+00081ae0: 6f73 5f63 7572 2c20 7072 6576 5f70 6f73  os_cur, prev_pos
+00081af0: 2c20 722e 7374 6172 7420 290a 2020 2020  , r.start ).    
+00081b00: 2020 2020 2020 2020 2020 2020 6f73 5f63              os_c
+00081b10: 7572 202b 3d20 2872 2e65 6e64 202d 2072  ur += (r.end - r
+00081b20: 2e73 7461 7274 202b 2031 290a 0a20 2020  .start + 1)..   
+00081b30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00081b40: 722e 7374 6172 7420 3e20 7072 6576 5f70  r.start > prev_p
+00081b50: 6f73 3a0a 2020 2020 2020 2020 2020 2020  os:.            
+00081b60: 2020 2020 2020 2020 7365 715f 6c73 742e          seq_lst.
+00081b70: 6170 7065 6e64 2873 6571 5f6f 7267 5b28  append(seq_org[(
+00081b80: 7072 6576 5f70 6f73 2d31 293a 2872 2e73  prev_pos-1):(r.s
+00081b90: 7461 7274 2d31 295d 290a 2020 2020 2020  tart-1)]).      
+00081ba0: 2020 2020 2020 2020 2020 7365 715f 6c73            seq_ls
+00081bb0: 742e 6170 7065 6e64 2872 2e73 6571 290a  t.append(r.seq).
+00081bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00081bd0: 2070 7265 765f 706f 7320 3d20 722e 7374   prev_pos = r.st
+00081be0: 6172 740a 0a20 2020 2020 2020 2065 6c69  art..        eli
+00081bf0: 6620 2872 2e74 7970 6520 3d3d 2027 6465  f (r.type == 'de
+00081c00: 6c65 7469 6f6e 2729 207c 2028 722e 7479  letion') | (r.ty
+00081c10: 7065 203d 3d20 2744 2720 293a 0a20 2020  pe == 'D' ):.   
+00081c20: 2020 2020 2020 2020 2069 6620 2872 2e73           if (r.s
+00081c30: 7461 7274 2920 3c20 2870 7265 765f 706f  tart) < (prev_po
+00081c40: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00081c50: 2020 2020 2320 7072 696e 7428 2757 4152      # print('WAR
+00081c60: 4e49 4e47 2028 4429 3a20 2569 202d 2025  NING (D): %i - %
+00081c70: 732c 2025 6920 3c3d 2025 6927 2025 2028  s, %i <= %i' % (
+00081c80: 6d2c 2072 2e63 6872 2c20 722e 7374 6172  m, r.chr, r.star
+00081c90: 742c 2070 7265 765f 706f 7329 2029 0a20  t, prev_pos) ). 
+00081ca0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00081cb0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+00081cc0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00081cd0: 2020 2020 2020 6f66 2e61 6464 2820 6f73        of.add( os
+00081ce0: 5f63 7572 2c20 7072 6576 5f70 6f73 2c20  _cur, prev_pos, 
+00081cf0: 722e 7374 6172 7420 290a 2020 2020 2020  r.start ).      
+00081d00: 2020 2020 2020 2020 2020 6f73 5f63 7572            os_cur
+00081d10: 202d 3d20 2872 2e65 6e64 202d 2072 2e73   -= (r.end - r.s
+00081d20: 7461 7274 202b 2031 290a 2020 2020 2020  tart + 1).      
 00081d30: 2020 2020 2020 2020 2020 7072 6576 5f70            prev_p
-00081d40: 6f73 203d 2072 2e65 6e64 2b31 0a0a 2020  os = r.end+1..  
-00081d50: 2020 2020 2020 6c61 7374 5f70 6f73 203d        last_pos =
-00081d60: 2072 2e65 6e64 0a0a 2020 2020 7365 715f   r.end..    seq_
-00081d70: 6c73 742e 6170 7065 6e64 2873 6571 5f6f  lst.append(seq_o
-00081d80: 7267 5b28 7072 6576 5f70 6f73 2d31 293a  rg[(prev_pos-1):
-00081d90: 5d29 0a20 2020 2073 6571 5f6e 6577 203d  ]).    seq_new =
-00081da0: 2027 272e 6a6f 696e 2873 6571 5f6c 7374   ''.join(seq_lst
-00081db0: 290a 0a20 2020 2023 2069 6620 6c61 7374  )..    # if last
-00081dc0: 5f70 6f73 203e 2070 7265 765f 706f 733a  _pos > prev_pos:
-00081dd0: 0a20 2020 206f 662e 6164 6428 206f 735f  .    of.add( os_
-00081de0: 6375 722c 2070 7265 765f 706f 732c 206c  cur, prev_pos, l
-00081df0: 656e 2873 6571 5f6f 7267 2920 2b20 3130  en(seq_org) + 10
-00081e00: 3030 3030 2029 0a0a 2020 2020 656c 6170  0000 )..    elap
-00081e10: 7365 645f 7469 6d65 203d 2074 696d 652e  sed_time = time.
-00081e20: 7469 6d65 2829 202d 2073 7461 7274 5f74  time() - start_t
-00081e30: 696d 650a 2020 2020 2320 7072 696e 7428  ime.    # print(
-00081e40: 2720 2020 322e 2064 6f6e 6520 2825 6929  '   2. done (%i)
-00081e50: 2020 2720 2520 2865 6c61 7073 6564 5f74    ' % (elapsed_t
-00081e60: 696d 6529 2c20 666c 7573 6820 3d20 5472  ime), flush = Tr
-00081e70: 7565 290a 2020 2020 2327 2727 0a0a 2020  ue).    #'''..  
-00081e80: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-00081e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081ea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00081eb0: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
-00081ec0: 2320 5573 6520 6f66 6673 6574 5f66 696e  # Use offset_fin
-00081ed0: 6465 7220 746f 2063 6f72 7265 6374 2070  der to correct p
-00081ee0: 6f73 6974 696f 6e73 2069 6e20 4754 4620  ositions in GTF 
-00081ef0: 656e 7472 6965 730a 2020 2020 2323 2061  entries.    ## a
-00081f00: 6c73 6f20 6765 7420 7267 6e73 2066 7261  lso get rgns fra
-00081f10: 676d 656e 7473 2077 6865 6e20 7370 6c69  gments when spli
-00081f20: 7420 6973 2072 6571 7569 7265 640a 0a20  t is required.. 
-00081f30: 2020 206f 662e 6d61 6b65 5f69 745f 636f     of.make_it_co
-00081f40: 6d70 6163 7428 290a 2020 2020 0a20 2020  mpact().    .   
-00081f50: 2073 7461 7274 5f74 696d 6520 3d20 7469   start_time = ti
-00081f60: 6d65 2e74 696d 6528 290a 2020 2020 725f  me.time().    r_
-00081f70: 746f 5f61 6464 203d 205b 5d0a 2020 2020  to_add = [].    
-00081f80: 706f 735f 746f 5f61 6464 203d 205b 5d0a  pos_to_add = [].
-00081f90: 2020 2020 736e 765f 696e 666f 5f63 6872      snv_info_chr
-00081fa0: 203d 205b 5d0a 0a20 2020 2066 6f72 2067   = []..    for g
-00081fb0: 6420 696e 2067 645f 7365 6c3a 0a20 2020  d in gd_sel:.   
-00081fc0: 2020 2020 2067 642e 6e76 5f69 6e66 6f5f       gd.nv_info_
-00081fd0: 6c73 7420 3d20 5b5d 0a0a 2020 2020 7072  lst = []..    pr
-00081fe0: 6576 5f6f 6669 203d 2030 0a20 2020 2076  ev_ofi = 0.    v
-00081ff0: 5f63 6e74 203d 2030 0a20 2020 2023 666f  _cnt = 0.    #fo
-00082000: 7220 6b2c 2072 2069 6e20 656e 756d 6572  r k, r in enumer
-00082010: 6174 6528 7261 6c6c 2e72 676e 7329 3a0a  ate(rall.rgns):.
-00082020: 2020 2020 666f 7220 6d2c 206b 2069 6e20      for m, k in 
-00082030: 656e 756d 6572 6174 6528 6f64 7229 3a0a  enumerate(odr):.
-00082040: 2020 2020 2020 2020 7220 3d20 7261 6c6c          r = rall
-00082050: 2e72 676e 735b 6b5d 0a20 2020 2020 2020  .rgns[k].       
-00082060: 2067 696e 203d 2047 656e 655f 6964 5f6e   gin = Gene_id_n
-00082070: 616d 655b 6b5d 0a20 2020 2020 2020 200a  ame[k].        .
-00082080: 2020 2020 2020 2020 6f73 732c 2070 7265          oss, pre
-00082090: 765f 6f66 3120 3d20 6f66 2e66 696e 645f  v_of1 = of.find_
-000820a0: 6f73 5f73 6571 2872 2e73 7461 7274 2c20  os_seq(r.start, 
-000820b0: 7072 6576 5f6f 6669 290a 2020 2020 2020  prev_ofi).      
-000820c0: 2020 2320 6f73 6520 3d20 6f73 730a 2020    # ose = oss.  
-000820d0: 2020 2020 2020 6f73 652c 2070 7265 765f        ose, prev_
-000820e0: 6f66 3220 3d20 6f66 2e66 696e 645f 6f73  of2 = of.find_os
-000820f0: 5f73 6571 2872 2e65 6e64 2c20 7072 6576  _seq(r.end, prev
-00082100: 5f6f 6669 290a 200a 2020 2020 2020 2020  _ofi). .        
-00082110: 722e 6765 745f 6376 6728 290a 2020 2020  r.get_cvg().    
-00082120: 2020 2020 2320 6966 2072 2e63 7667 2069      # if r.cvg i
-00082130: 7320 4e6f 6e65 3a20 722e 6376 6720 3d20  s None: r.cvg = 
-00082140: 6e70 2e6f 6e65 7328 6c65 6e28 722e 7365  np.ones(len(r.se
-00082150: 7129 290a 0a20 2020 2020 2020 2069 6620  q))..        if 
-00082160: 722e 7479 7065 203d 3d20 2765 786f 6e27  r.type == 'exon'
-00082170: 3a0a 2020 2020 2020 2020 2020 2020 0a20  :.            . 
-00082180: 2020 2020 2020 2020 2020 2069 6620 286f             if (o
-00082190: 7373 203d 3d20 6f73 6529 3a0a 0a20 2020  ss == ose):..   
-000821a0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-000821b0: 695f 6c73 7420 3d20 6669 6e64 5f73 6e70  i_lst = find_snp
-000821c0: 2873 6571 5f6f 7267 5b28 722e 7374 6172  (seq_org[(r.star
-000821d0: 742d 3129 3a72 2e65 6e64 5d2c 2072 2e73  t-1):r.end], r.s
-000821e0: 6571 2c20 722e 6765 745f 6376 6728 292c  eq, r.get_cvg(),
-000821f0: 2063 6872 6d2c 2072 2e73 7461 7274 2c20   chrm, r.start, 
-00082200: 6f73 7329 0a20 2020 2020 2020 2020 2020  oss).           
-00082210: 2020 2020 2073 695f 6c73 7420 3d20 6669       si_lst = fi
-00082220: 6e64 5f73 6e70 2873 6571 5f6f 7267 5b28  nd_snp(seq_org[(
-00082230: 722e 7374 6172 742d 3129 3a72 2e65 6e64  r.start-1):r.end
-00082240: 5d2c 2072 2e73 6571 2c20 722e 636d 6174  ], r.seq, r.cmat
-00082250: 2c20 6368 726d 2c20 722e 7374 6172 742c  , chrm, r.start,
-00082260: 206f 7373 2c20 6769 6e29 0a20 2020 2020   oss, gin).     
-00082270: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
-00082280: 6e66 6f5f 6368 7220 3d20 736e 765f 696e  nfo_chr = snv_in
-00082290: 666f 5f63 6872 202b 2073 695f 6c73 740a  fo_chr + si_lst.
-000822a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000822b0: 6764 5f69 6478 203d 2067 645f 6964 785f  gd_idx = gd_idx_
-000822c0: 6f66 5f72 676e 5b6b 5d0a 2020 2020 2020  of_rgn[k].      
-000822d0: 2020 2020 2020 2020 2020 6764 5f73 656c            gd_sel
-000822e0: 5b67 645f 6964 785d 2e6e 765f 696e 666f  [gd_idx].nv_info
-000822f0: 5f6c 7374 203d 2067 645f 7365 6c5b 6764  _lst = gd_sel[gd
-00082300: 5f69 6478 5d2e 6e76 5f69 6e66 6f5f 6c73  _idx].nv_info_ls
-00082310: 7420 2b20 7369 5f6c 7374 0a0a 2020 2020  t + si_lst..    
-00082320: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
-00082330: 6172 7420 2b3d 206f 7373 0a20 2020 2020  art += oss.     
-00082340: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
-00082350: 202b 3d20 6f73 650a 2020 2020 2020 2020   += ose.        
-00082360: 2020 2020 2020 2020 7261 6c6c 2e72 676e          rall.rgn
-00082370: 735b 6b5d 203d 2072 2023 202e 636f 7079  s[k] = r # .copy
-00082380: 2829 0a0a 0a20 2020 2020 2020 2020 2020  ()...           
-00082390: 2065 6c69 6620 286f 7373 203c 206f 7365   elif (oss < ose
-000823a0: 293a 2023 2049 6e73 6572 7369 6f6e 2069  ): # Insersion i
-000823b0: 6e20 6265 7477 6565 6e0a 0a20 2020 2020  n between..     
-000823c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000823d0: 2827 2020 2025 6920 6f73 7320 3c20 6f73  ('   %i oss < os
-000823e0: 6527 2025 206b 290a 2020 2020 2020 2020  e' % k).        
-000823f0: 2020 2020 2020 2020 2320 722e 7072 696e          # r.prin
-00082400: 745f 7368 6f72 7428 290a 2020 2020 2020  t_short().      
-00082410: 2020 2020 2020 2020 2020 702c 2070 7265            p, pre
-00082420: 765f 6f66 3220 3d20 6f66 2e67 6574 5f62  v_of2 = of.get_b
-00082430: 6e64 7279 5f73 6571 286f 7365 2c20 7072  ndry_seq(ose, pr
-00082440: 6576 5f6f 6669 290a 0a20 2020 2020 2020  ev_ofi)..       
-00082450: 2020 2020 2020 2020 2023 2320 7370 6c69           ## spli
-00082460: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00082470: 2020 4c72 203d 2072 2e65 6e64 202d 2072    Lr = r.end - r
-00082480: 2e73 7461 7274 202b 310a 2020 2020 2020  .start +1.      
-00082490: 2020 2020 2020 2020 2020 4c6e 203d 2072            Ln = r
-000824a0: 2e65 6e64 202d 2070 202b 2031 0a20 2020  .end - p + 1.   
-000824b0: 2020 2020 2020 2020 2020 2020 2072 676e               rgn
-000824c0: 5f6e 6577 203d 2072 6567 696f 6e28 2072  _new = region( r
-000824d0: 2e63 6872 2c20 702b 6f73 652c 2072 2e65  .chr, p+ose, r.e
-000824e0: 6e64 2b6f 7365 2c20 722e 7479 7065 2c20  nd+ose, r.type, 
-000824f0: 722e 636d 6174 5b3a 2c2d 4c6e 3a5d 2c20  r.cmat[:,-Ln:], 
-00082500: 7873 203d 2072 2e78 7329 0a20 2020 2020  xs = r.xs).     
-00082510: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
-00082520: 6577 2e67 6574 5f63 7667 2829 0a20 2020  ew.get_cvg().   
-00082530: 2020 2020 2020 2020 2020 2020 2072 5f74               r_t
-00082540: 6f5f 6164 642e 6170 7065 6e64 2872 676e  o_add.append(rgn
-00082550: 5f6e 6577 290a 2020 2020 2020 2020 2020  _new).          
-00082560: 2020 2020 2020 706f 735f 746f 5f61 6464        pos_to_add
-00082570: 2e61 7070 656e 6428 6b2b 3129 0a0a 2020  .append(k+1)..  
-00082580: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00082590: 7369 5f6c 7374 203d 2066 696e 645f 736e  si_lst = find_sn
-000825a0: 7028 7365 715f 6f72 675b 2870 2d31 293a  p(seq_org[(p-1):
-000825b0: 722e 656e 645d 2c20 7267 6e5f 6e65 772e  r.end], rgn_new.
-000825c0: 7365 712c 2072 676e 5f6e 6577 2e67 6574  seq, rgn_new.get
-000825d0: 5f63 7667 2829 2c20 6368 726d 2c20 702c  _cvg(), chrm, p,
-000825e0: 206f 7365 290a 2020 2020 2020 2020 2020   ose).          
-000825f0: 2020 2020 2020 7369 5f6c 7374 203d 2066        si_lst = f
-00082600: 696e 645f 736e 7028 7365 715f 6f72 675b  ind_snp(seq_org[
-00082610: 2870 2d31 293a 722e 656e 645d 2c20 7267  (p-1):r.end], rg
-00082620: 6e5f 6e65 772e 7365 712c 2072 676e 5f6e  n_new.seq, rgn_n
-00082630: 6577 2e63 6d61 742c 2063 6872 6d2c 2070  ew.cmat, chrm, p
-00082640: 2c20 6f73 652c 2067 696e 290a 2020 2020  , ose, gin).    
-00082650: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
-00082660: 696e 666f 5f63 6872 203d 2073 6e76 5f69  info_chr = snv_i
-00082670: 6e66 6f5f 6368 7220 2b20 7369 5f6c 7374  nfo_chr + si_lst
-00082680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082690: 2067 645f 6964 7820 3d20 6764 5f69 6478   gd_idx = gd_idx
-000826a0: 5f6f 665f 7267 6e5b 6b5d 0a20 2020 2020  _of_rgn[k].     
-000826b0: 2020 2020 2020 2020 2020 2067 645f 7365             gd_se
-000826c0: 6c5b 6764 5f69 6478 5d2e 6e76 5f69 6e66  l[gd_idx].nv_inf
-000826d0: 6f5f 6c73 7420 3d20 6764 5f73 656c 5b67  o_lst = gd_sel[g
-000826e0: 645f 6964 785d 2e6e 765f 696e 666f 5f6c  d_idx].nv_info_l
-000826f0: 7374 202b 2073 695f 6c73 740a 0a20 2020  st + si_lst..   
-00082700: 2020 2020 2020 2020 2020 2020 2072 2e65               r.e
-00082710: 6e64 203d 2070 2d31 2b6f 7373 0a20 2020  nd = p-1+oss.   
-00082720: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
-00082730: 7461 7274 202b 3d20 6f73 730a 2020 2020  tart += oss.    
-00082740: 2020 2020 2020 2020 2020 2020 4c6e 203d              Ln =
-00082750: 2072 2e65 6e64 202d 2072 2e73 7461 7274   r.end - r.start
-00082760: 202b 310a 2020 2020 2020 2020 2020 2020   +1.            
-00082770: 2020 2020 722e 636d 6174 203d 2072 2e63      r.cmat = r.c
-00082780: 6d61 745b 3a2c 3a4c 6e5d 0a20 2020 2020  mat[:,:Ln].     
-00082790: 2020 2020 2020 2020 2020 2072 2e73 6571             r.seq
-000827a0: 203d 2072 2e73 6571 5b3a 4c6e 5d0a 2020   = r.seq[:Ln].  
-000827b0: 2020 2020 2020 2020 2020 2020 2020 722e                r.
-000827c0: 6376 6720 3d20 722e 6376 675b 3a4c 6e5d  cvg = r.cvg[:Ln]
-000827d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000827e0: 2023 2072 2e67 6574 5f63 7667 2829 0a20   # r.get_cvg(). 
-000827f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00082800: 616c 6c2e 7267 6e73 5b6b 5d20 3d20 7220  all.rgns[k] = r 
-00082810: 2320 2e63 6f70 7928 290a 0a20 2020 2020  # .copy()..     
-00082820: 2020 2020 2020 2020 2020 2023 2073 695f             # si_
-00082830: 6c73 7420 3d20 6669 6e64 5f73 6e70 2873  lst = find_snp(s
-00082840: 6571 5f6f 7267 5b28 722e 7374 6172 742d  eq_org[(r.start-
-00082850: 6f73 732d 3129 3a70 5d2c 2072 2e73 6571  oss-1):p], r.seq
-00082860: 2c20 722e 6765 745f 6376 6728 292c 2063  , r.get_cvg(), c
-00082870: 6872 6d2c 2072 2e73 7461 7274 2d6f 7373  hrm, r.start-oss
-00082880: 2c20 6f73 7329 0a20 2020 2020 2020 2020  , oss).         
-00082890: 2020 2020 2020 2073 695f 6c73 7420 3d20         si_lst = 
-000828a0: 6669 6e64 5f73 6e70 2873 6571 5f6f 7267  find_snp(seq_org
-000828b0: 5b28 722e 7374 6172 742d 6f73 732d 3129  [(r.start-oss-1)
-000828c0: 3a70 5d2c 2072 2e73 6571 2c20 722e 636d  :p], r.seq, r.cm
-000828d0: 6174 2c20 6368 726d 2c20 722e 7374 6172  at, chrm, r.star
-000828e0: 742d 6f73 732c 206f 7373 2c20 6769 6e29  t-oss, oss, gin)
-000828f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082900: 2073 6e76 5f69 6e66 6f5f 6368 7220 3d20   snv_info_chr = 
-00082910: 736e 765f 696e 666f 5f63 6872 202b 2073  snv_info_chr + s
-00082920: 695f 6c73 740a 2020 2020 2020 2020 2020  i_lst.          
-00082930: 2020 2020 2020 6764 5f69 6478 203d 2067        gd_idx = g
-00082940: 645f 6964 785f 6f66 5f72 676e 5b6b 5d0a  d_idx_of_rgn[k].
-00082950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082960: 6764 5f73 656c 5b67 645f 6964 785d 2e6e  gd_sel[gd_idx].n
-00082970: 765f 696e 666f 5f6c 7374 203d 2067 645f  v_info_lst = gd_
-00082980: 7365 6c5b 6764 5f69 6478 5d2e 6e76 5f69  sel[gd_idx].nv_i
-00082990: 6e66 6f5f 6c73 7420 2b20 7369 5f6c 7374  nfo_lst + si_lst
-000829a0: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000829b0: 6966 2028 6f73 7320 3e20 6f73 6529 3a20  if (oss > ose): 
-000829c0: 2320 6465 6c65 7469 6f6e 2069 6e20 6265  # deletion in be
-000829d0: 7477 6565 6e0a 0a20 2020 2020 2020 2020  tween..         
-000829e0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-000829f0: 2025 6920 6f73 7320 3e20 6f73 6527 2025   %i oss > ose' %
-00082a00: 206b 290a 2020 2020 2020 2020 2020 2020   k).            
-00082a10: 2020 2020 2320 722e 7072 696e 745f 7368      # r.print_sh
-00082a20: 6f72 7428 290a 2020 2020 2020 2020 2020  ort().          
-00082a30: 2020 2020 2020 702c 2070 7265 765f 6f66        p, prev_of
-00082a40: 3220 3d20 6f66 2e67 6574 5f62 6e64 7279  2 = of.get_bndry
-00082a50: 5f73 6571 286f 7365 2c20 7072 6576 5f6f  _seq(ose, prev_o
-00082a60: 6669 290a 2020 2020 2020 2020 2020 2020  fi).            
-00082a70: 2020 2020 4c64 203d 206f 7373 202d 206f      Ld = oss - o
-00082a80: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
-00082a90: 2020 2020 2323 2073 706c 6974 2028 666f      ## split (fo
-00082aa0: 7220 4344 5320 6f6e 6c79 290a 2020 2020  r CDS only).    
-00082ab0: 2020 2020 2020 2020 2020 2020 4c72 203d              Lr =
-00082ac0: 2072 2e65 6e64 202d 2072 2e73 7461 7274   r.end - r.start
-00082ad0: 202b 310a 2020 2020 2020 2020 2020 2020   +1.            
-00082ae0: 2020 2020 4c6e 203d 2072 2e65 6e64 202d      Ln = r.end -
-00082af0: 2070 202b 2031 202d 204c 640a 2020 2020   p + 1 - Ld.    
-00082b00: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
-00082b10: 6e65 7720 3d20 7265 6769 6f6e 2820 722e  new = region( r.
-00082b20: 6368 722c 2070 2b4c 642b 6f73 652c 2072  chr, p+Ld+ose, r
-00082b30: 2e65 6e64 2b6f 7365 2c20 722e 7479 7065  .end+ose, r.type
-00082b40: 2c20 722e 636d 6174 5b3a 2c2d 4c6e 3a5d  , r.cmat[:,-Ln:]
-00082b50: 2c20 7873 203d 2072 2e78 7329 0a20 2020  , xs = r.xs).   
-00082b60: 2020 2020 2020 2020 2020 2020 2072 676e               rgn
-00082b70: 5f6e 6577 2e67 6574 5f63 7667 2829 0a20  _new.get_cvg(). 
-00082b80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00082b90: 5f74 6f5f 6164 642e 6170 7065 6e64 2872  _to_add.append(r
-00082ba0: 676e 5f6e 6577 290a 2020 2020 2020 2020  gn_new).        
-00082bb0: 2020 2020 2020 2020 706f 735f 746f 5f61          pos_to_a
-00082bc0: 6464 2e61 7070 656e 6428 6b2b 3129 0a0a  dd.append(k+1)..
-00082bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082be0: 2320 7369 5f6c 7374 203d 2066 696e 645f  # si_lst = find_
-00082bf0: 736e 7028 7365 715f 6e65 775b 2872 676e  snp(seq_new[(rgn
-00082c00: 5f6e 6577 2e73 7461 7274 2d31 293a 7267  _new.start-1):rg
-00082c10: 6e5f 6e65 772e 656e 645d 2c20 7267 6e5f  n_new.end], rgn_
-00082c20: 6e65 772e 7365 712c 2072 676e 5f6e 6577  new.seq, rgn_new
-00082c30: 2e67 6574 5f63 7667 2829 2c20 6368 726d  .get_cvg(), chrm
-00082c40: 2c20 702c 206f 7365 290a 2020 2020 2020  , p, ose).      
-00082c50: 2020 2020 2020 2020 2020 7369 5f6c 7374            si_lst
-00082c60: 203d 2066 696e 645f 736e 7028 7365 715f   = find_snp(seq_
-00082c70: 6e65 775b 2872 676e 5f6e 6577 2e73 7461  new[(rgn_new.sta
-00082c80: 7274 2d31 293a 7267 6e5f 6e65 772e 656e  rt-1):rgn_new.en
-00082c90: 645d 2c20 7267 6e5f 6e65 772e 7365 712c  d], rgn_new.seq,
-00082ca0: 2072 676e 5f6e 6577 2e63 6d61 742c 2063   rgn_new.cmat, c
-00082cb0: 6872 6d2c 2070 2c20 6f73 652c 2067 696e  hrm, p, ose, gin
-00082cc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00082cd0: 2020 736e 765f 696e 666f 5f63 6872 203d    snv_info_chr =
-00082ce0: 2073 6e76 5f69 6e66 6f5f 6368 7220 2b20   snv_info_chr + 
-00082cf0: 7369 5f6c 7374 0a20 2020 2020 2020 2020  si_lst.         
-00082d00: 2020 2020 2020 2067 645f 6964 7820 3d20         gd_idx = 
-00082d10: 6764 5f69 6478 5f6f 665f 7267 6e5b 6b5d  gd_idx_of_rgn[k]
-00082d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082d30: 2067 645f 7365 6c5b 6764 5f69 6478 5d2e   gd_sel[gd_idx].
-00082d40: 6e76 5f69 6e66 6f5f 6c73 7420 3d20 6764  nv_info_lst = gd
-00082d50: 5f73 656c 5b67 645f 6964 785d 2e6e 765f  _sel[gd_idx].nv_
-00082d60: 696e 666f 5f6c 7374 202b 2073 695f 6c73  info_lst + si_ls
-00082d70: 740a 0a20 2020 2020 2020 2020 2020 2020  t..             
-00082d80: 2020 2072 2e65 6e64 203d 2070 2d31 2b6f     r.end = p-1+o
-00082d90: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
-00082da0: 2020 2072 2e73 7461 7274 202b 3d20 6f73     r.start += os
-00082db0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00082dc0: 2020 4c6e 203d 2072 2e65 6e64 202d 2072    Ln = r.end - r
-00082dd0: 2e73 7461 7274 202b 310a 2020 2020 2020  .start +1.      
-00082de0: 2020 2020 2020 2020 2020 722e 636d 6174            r.cmat
-00082df0: 203d 2072 2e63 6d61 745b 3a2c 3a4c 6e5d   = r.cmat[:,:Ln]
-00082e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082e10: 2072 2e73 6571 203d 2072 2e73 6571 5b3a   r.seq = r.seq[:
-00082e20: 4c6e 5d0a 2020 2020 2020 2020 2020 2020  Ln].            
-00082e30: 2020 2020 722e 6376 6720 3d20 722e 6376      r.cvg = r.cv
-00082e40: 675b 3a4c 6e5d 0a20 2020 2020 2020 2020  g[:Ln].         
-00082e50: 2020 2020 2020 2023 2072 2e67 6574 5f63         # r.get_c
-00082e60: 7667 2829 0a20 2020 2020 2020 2020 2020  vg().           
-00082e70: 2020 2020 2072 616c 6c2e 7267 6e73 5b6b       rall.rgns[k
-00082e80: 5d20 3d20 7220 2320 2e63 6f70 7928 290a  ] = r # .copy().
-00082e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00082ea0: 2023 2073 695f 6c73 7420 3d20 6669 6e64   # si_lst = find
-00082eb0: 5f73 6e70 2873 6571 5f6f 7267 5b28 722e  _snp(seq_org[(r.
-00082ec0: 7374 6172 742d 6f73 732d 3129 3a70 5d2c  start-oss-1):p],
-00082ed0: 2072 2e73 6571 2c20 722e 6765 745f 6376   r.seq, r.get_cv
-00082ee0: 6728 292c 2063 6872 6d2c 2072 2e73 7461  g(), chrm, r.sta
-00082ef0: 7274 2d6f 7373 2c20 6f73 7329 0a20 2020  rt-oss, oss).   
-00082f00: 2020 2020 2020 2020 2020 2020 2073 695f               si_
-00082f10: 6c73 7420 3d20 6669 6e64 5f73 6e70 2873  lst = find_snp(s
-00082f20: 6571 5f6f 7267 5b28 722e 7374 6172 742d  eq_org[(r.start-
-00082f30: 6f73 732d 3129 3a70 5d2c 2072 2e73 6571  oss-1):p], r.seq
-00082f40: 2c20 722e 636d 6174 2c20 6368 726d 2c20  , r.cmat, chrm, 
-00082f50: 722e 7374 6172 742d 6f73 732c 206f 7373  r.start-oss, oss
-00082f60: 2c20 6769 6e29 0a20 2020 2020 2020 2020  , gin).         
-00082f70: 2020 2020 2020 2073 6e76 5f69 6e66 6f5f         snv_info_
-00082f80: 6368 7220 3d20 736e 765f 696e 666f 5f63  chr = snv_info_c
-00082f90: 6872 202b 2073 695f 6c73 740a 2020 2020  hr + si_lst.    
-00082fa0: 2020 2020 2020 2020 2020 2020 6764 5f69              gd_i
-00082fb0: 6478 203d 2067 645f 6964 785f 6f66 5f72  dx = gd_idx_of_r
-00082fc0: 676e 5b6b 5d0a 2020 2020 2020 2020 2020  gn[k].          
-00082fd0: 2020 2020 2020 6764 5f73 656c 5b67 645f        gd_sel[gd_
-00082fe0: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
-00082ff0: 203d 2067 645f 7365 6c5b 6764 5f69 6478   = gd_sel[gd_idx
-00083000: 5d2e 6e76 5f69 6e66 6f5f 6c73 7420 2b20  ].nv_info_lst + 
-00083010: 7369 5f6c 7374 0a20 2020 2020 2020 2020  si_lst.         
-00083020: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00083030: 656c 6966 2072 2e74 7970 6520 3d3d 2027  elif r.type == '
-00083040: 696e 7365 7273 696f 6e27 3a0a 0a20 2020  insersion':..   
-00083050: 2020 2020 2020 2020 206f 7373 702c 2070           ossp, p
-00083060: 7265 765f 6f66 3120 3d20 6f66 2e66 696e  rev_of1 = of.fin
-00083070: 645f 6f73 5f73 6571 2872 2e73 7461 7274  d_os_seq(r.start
-00083080: 2d31 2c20 7072 6576 5f6f 6669 2c20 6d61  -1, prev_ofi, ma
-00083090: 726b 203d 2027 4927 290a 0a20 2020 2020  rk = 'I')..     
-000830a0: 2020 2020 2020 2073 6f70 203d 2073 6571         sop = seq
-000830b0: 5f6f 7267 5b69 6e74 2872 2e73 7461 7274  _org[int(r.start
-000830c0: 2d28 4e57 494e 2b31 2929 3a69 6e74 2872  -(NWIN+1)):int(r
-000830d0: 2e73 7461 7274 2d31 295d 0a20 2020 2020  .start-1)].     
-000830e0: 2020 2020 2020 2073 6f63 203d 2027 2d27         soc = '-'
-000830f0: 0a20 2020 2020 2020 2020 2020 2073 6f6e  .            son
-00083100: 203d 2073 6571 5f6f 7267 5b69 6e74 2872   = seq_org[int(r
-00083110: 2e73 7461 7274 2d31 293a 696e 7428 722e  .start-1):int(r.
-00083120: 7374 6172 742b 284e 5749 4e2d 3129 295d  start+(NWIN-1))]
-00083130: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00083140: 2020 2020 2020 2020 2020 736e 7020 3d20            snp = 
-00083150: 7365 715f 6e65 775b 696e 7428 722e 7374  seq_new[int(r.st
-00083160: 6172 742b 6f73 7370 2d28 4e57 494e 2b31  art+ossp-(NWIN+1
-00083170: 2929 3a69 6e74 2872 2e73 7461 7274 2b6f  )):int(r.start+o
-00083180: 7373 702d 3129 5d0a 2020 2020 2020 2020  ssp-1)].        
-00083190: 2020 2020 736e 6320 3d20 722e 7365 710a      snc = r.seq.
-000831a0: 2020 2020 2020 2020 2020 2020 736e 6e20              snn 
-000831b0: 3d20 7365 715f 6e65 775b 696e 7428 722e  = seq_new[int(r.
-000831c0: 7374 6172 742b 6f73 732d 3129 3a69 6e74  start+oss-1):int
-000831d0: 2872 2e73 7461 7274 2b6f 7373 2b28 4e57  (r.start+oss+(NW
-000831e0: 494e 2d31 2929 5d0a 2020 2020 2020 2020  IN-1))].        
-000831f0: 2020 2020 7369 203d 2053 4e56 5f69 6e66      si = SNV_inf
-00083200: 6f28 6368 726d 2c20 722e 7374 6172 742c  o(chrm, r.start,
-00083210: 2072 2e73 7461 7274 2b6f 7373 2c20 6769   r.start+oss, gi
-00083220: 6e5b 305d 2c20 6769 6e5b 315d 2c20 2749  n[0], gin[1], 'I
-00083230: 272c 2072 2e67 6574 5f6c 656e 2829 2c20  ', r.get_len(), 
-00083240: 696e 7428 722e 6176 655f 6376 675f 6465  int(r.ave_cvg_de
-00083250: 7074 6828 2929 2c20 722e 6376 675f 6672  pth()), r.cvg_fr
-00083260: 6163 2c20 736f 702c 2073 6f63 2c20 736f  ac, sop, soc, so
-00083270: 6e2c 2073 6e70 2c20 736e 632c 2073 6e6e  n, snp, snc, snn
-00083280: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00083290: 6e76 5f69 6e66 6f5f 6368 722e 6170 7065  nv_info_chr.appe
-000832a0: 6e64 2873 6929 0a20 2020 2020 2020 2020  nd(si).         
-000832b0: 2020 2067 645f 6964 7820 3d20 6764 5f69     gd_idx = gd_i
-000832c0: 6478 5f6f 665f 7267 6e5b 6b5d 0a20 2020  dx_of_rgn[k].   
-000832d0: 2020 2020 2020 2020 2067 645f 7365 6c5b           gd_sel[
-000832e0: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
-000832f0: 6c73 742e 6170 7065 6e64 2873 6929 0a0a  lst.append(si)..
-00083300: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
-00083310: 6172 7420 2b3d 206f 7373 700a 2020 2020  art += ossp.    
-00083320: 2020 2020 2020 2020 722e 656e 6420 2b3d          r.end +=
-00083330: 206f 7373 7020 200a 2020 2020 2020 2020   ossp  .        
-00083340: 2020 2020 7261 6c6c 2e72 676e 735b 6b5d      rall.rgns[k]
-00083350: 203d 2072 2023 202e 636f 7079 2829 0a0a   = r # .copy()..
-00083360: 2020 2020 2020 2020 656c 6966 2072 2e74          elif r.t
-00083370: 7970 6520 3d3d 2027 6465 6c65 7469 6f6e  ype == 'deletion
-00083380: 273a 0a0a 2020 2020 2020 2020 2020 2020  ':..            
-00083390: 6f73 7370 2c20 7072 6576 5f6f 6631 203d  ossp, prev_of1 =
-000833a0: 206f 662e 6669 6e64 5f6f 735f 7365 7128   of.find_os_seq(
-000833b0: 722e 7374 6172 742d 312c 2070 7265 765f  r.start-1, prev_
-000833c0: 6f66 692c 206d 6172 6b20 3d20 2744 2729  ofi, mark = 'D')
-000833d0: 0a0a 2020 2020 2020 2020 2020 2020 736f  ..            so
-000833e0: 7020 3d20 7365 715f 6f72 675b 696e 7428  p = seq_org[int(
-000833f0: 722e 7374 6172 742d 284e 5749 4e2b 3129  r.start-(NWIN+1)
-00083400: 293a 696e 7428 722e 7374 6172 742d 3129  ):int(r.start-1)
-00083410: 5d0a 2020 2020 2020 2020 2020 2020 736f  ].            so
-00083420: 6320 3d20 7365 715f 6f72 675b 696e 7428  c = seq_org[int(
-00083430: 722e 7374 6172 742d 3129 3a69 6e74 2872  r.start-1):int(r
-00083440: 2e65 6e64 295d 0a20 2020 2020 2020 2020  .end)].         
-00083450: 2020 2073 6f6e 203d 2073 6571 5f6f 7267     son = seq_org
-00083460: 5b69 6e74 2872 2e65 6e64 293a 696e 7428  [int(r.end):int(
-00083470: 722e 656e 642b 284e 5749 4e29 295d 0a20  r.end+(NWIN))]. 
-00083480: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00083490: 2020 2020 2020 2020 2320 736f 7020 3d20          # sop = 
-000834a0: 7261 6c6c 2e72 676e 735b 6f64 725b 6d2d  rall.rgns[odr[m-
-000834b0: 315d 5d2e 7365 715b 2d4e 5749 4e3a 5d0a  1]].seq[-NWIN:].
-000834c0: 2020 2020 2020 2020 2020 2020 736e 7020              snp 
-000834d0: 3d20 7365 715f 6e65 775b 696e 7428 722e  = seq_new[int(r.
-000834e0: 7374 6172 742b 6f73 7370 2d28 4e57 494e  start+ossp-(NWIN
-000834f0: 2b31 2929 3a69 6e74 2872 2e73 7461 7274  +1)):int(r.start
-00083500: 2b6f 7373 702d 3129 5d0a 2020 2020 2020  +ossp-1)].      
-00083510: 2020 2020 2020 736e 6320 3d20 272d 270a        snc = '-'.
-00083520: 2020 2020 2020 2020 2020 2020 2320 736f              # so
-00083530: 6e20 3d20 7261 6c6c 2e72 676e 735b 6f64  n = rall.rgns[od
-00083540: 725b 6d2b 315d 5d2e 7365 715b 3a4e 5749  r[m+1]].seq[:NWI
-00083550: 4e5d 0a20 2020 2020 2020 2020 2020 2073  N].            s
-00083560: 6e6e 203d 2073 6571 5f6e 6577 5b69 6e74  nn = seq_new[int
-00083570: 2872 2e73 7461 7274 2b6f 7373 702d 3129  (r.start+ossp-1)
-00083580: 3a69 6e74 2872 2e73 7461 7274 2b6f 7373  :int(r.start+oss
-00083590: 702b 284e 5749 4e2d 3129 295d 0a20 2020  p+(NWIN-1))].   
-000835a0: 2020 2020 2020 2020 2073 6920 3d20 534e           si = SN
-000835b0: 565f 696e 666f 2863 6872 6d2c 2072 2e73  V_info(chrm, r.s
-000835c0: 7461 7274 2c20 722e 7374 6172 742b 6f73  tart, r.start+os
-000835d0: 732c 2067 696e 5b30 5d2c 2067 696e 5b31  s, gin[0], gin[1
-000835e0: 5d2c 2027 4427 2c20 722e 6765 745f 6c65  ], 'D', r.get_le
-000835f0: 6e28 292c 2069 6e74 2872 2e61 7665 5f63  n(), int(r.ave_c
-00083600: 7667 5f64 6570 7468 2829 292c 2072 2e63  vg_depth()), r.c
-00083610: 7667 5f66 7261 632c 2073 6f70 2c20 736f  vg_frac, sop, so
-00083620: 632c 2073 6f6e 2c20 736e 702c 2073 6e63  c, son, snp, snc
-00083630: 2c20 736e 6e20 290a 2020 2020 2020 2020  , snn ).        
-00083640: 2020 2020 736e 765f 696e 666f 5f63 6872      snv_info_chr
-00083650: 2e61 7070 656e 6428 7369 290a 2020 2020  .append(si).    
-00083660: 2020 2020 2020 2020 6764 5f69 6478 203d          gd_idx =
-00083670: 2067 645f 6964 785f 6f66 5f72 676e 5b6b   gd_idx_of_rgn[k
-00083680: 5d0a 2020 2020 2020 2020 2020 2020 6764  ].            gd
-00083690: 5f73 656c 5b67 645f 6964 785d 2e6e 765f  _sel[gd_idx].nv_
-000836a0: 696e 666f 5f6c 7374 2e61 7070 656e 6428  info_lst.append(
-000836b0: 7369 290a 0a20 2020 2020 2020 2020 2020  si)..           
-000836c0: 2072 2e73 7461 7274 202b 3d20 6f73 7370   r.start += ossp
-000836d0: 0a20 2020 2020 2020 2020 2020 2072 2e65  .            r.e
-000836e0: 6e64 202b 3d20 6f73 7370 2020 200a 2020  nd += ossp   .  
-000836f0: 2020 2020 2020 2020 2020 7261 6c6c 2e72            rall.r
-00083700: 676e 735b 6b5d 203d 2072 2023 202e 636f  gns[k] = r # .co
-00083710: 7079 2829 0a0a 2020 2020 2020 2020 7072  py()..        pr
-00083720: 6576 5f6f 6669 203d 2070 7265 765f 6f66  ev_ofi = prev_of
-00083730: 310a 0a20 2020 2065 6c61 7073 6564 5f74  1..    elapsed_t
-00083740: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-00083750: 2920 2d20 7374 6172 745f 7469 6d65 0a20  ) - start_time. 
-00083760: 2020 2023 2070 7269 6e74 2827 2020 2033     # print('   3
-00083770: 2e20 646f 6e65 2028 2569 2920 2025 6927  . done (%i)  %i'
-00083780: 2025 2028 656c 6170 7365 645f 7469 6d65   % (elapsed_time
-00083790: 2c20 6c65 6e28 6f66 2e6f 7369 5f6c 7374  , len(of.osi_lst
-000837a0: 2929 2c20 666c 7573 6820 3d20 5472 7565  )), flush = True
-000837b0: 290a 2020 2020 0a20 2020 206e 765f 6c73  ).    .    nv_ls
-000837c0: 7420 3d20 5b5d 0a20 2020 2066 6f72 2067  t = [].    for g
-000837d0: 6420 696e 2067 645f 7365 6c3a 0a20 2020  d in gd_sel:.   
-000837e0: 2020 2020 2066 6f72 2074 6420 696e 2067       for td in g
-000837f0: 642e 7464 5f6c 7374 3a0a 2020 2020 2020  d.td_lst:.      
-00083800: 2020 2020 2020 7464 2e67 6574 5f6f 7267        td.get_org
-00083810: 5f63 6f64 696e 675f 7365 7128 2067 642e  _coding_seq( gd.
-00083820: 6364 732e 7267 6e73 2c20 7365 715f 6f72  cds.rgns, seq_or
-00083830: 6720 290a 2020 2020 2020 2020 6e76 5f6c  g ).        nv_l
-00083840: 7374 203d 206e 765f 6c73 7420 2b20 6764  st = nv_lst + gd
-00083850: 2e67 6574 5f67 656e 655f 6c65 7665 6c5f  .get_gene_level_
-00083860: 6e76 5f69 6e66 6f28 290a 2020 2020 736e  nv_info().    sn
-00083870: 765f 696e 666f 5f63 6872 203d 206e 765f  v_info_chr = nv_
-00083880: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
-00083890: 2020 2020 0a20 2020 2023 2323 2323 2323      .    #######
-000838a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000838b0: 2323 230a 2020 2020 2323 2070 7574 2072  ###.    ## put r
-000838c0: 676e 7320 6261 636b 2074 6f20 6764 5f73  gns back to gd_s
-000838d0: 656c 0a20 2020 2023 2320 616e 6420 616c  el.    ## and al
-000838e0: 736f 2061 6464 206e 6577 2072 676e 7320  so add new rgns 
-000838f0: 0a0a 2020 2020 7374 6172 745f 7469 6d65  ..    start_time
-00083900: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
-00083910: 2020 2070 6f73 5f74 6f5f 6164 6420 3d20     pos_to_add = 
-00083920: 6e70 2e61 7272 6179 2870 6f73 5f74 6f5f  np.array(pos_to_
-00083930: 6164 6429 0a20 2020 2066 6f72 206b 2c20  add).    for k, 
-00083940: 6764 2069 6e20 656e 756d 6572 6174 6528  gd in enumerate(
-00083950: 6764 5f73 656c 293a 200a 0a20 2020 2020  gd_sel): ..     
-00083960: 2020 2070 3120 3d20 696e 7428 6c6f 635f     p1 = int(loc_
-00083970: 6f73 5b6b 5d29 0a20 2020 2020 2020 2070  os[k]).        p
-00083980: 3220 3d20 696e 7428 7031 202b 206e 756d  2 = int(p1 + num
-00083990: 5f6f 735b 6b5d 290a 2020 2020 2020 2020  _os[k]).        
-000839a0: 2320 6764 2e65 786f 6e73 2e72 676e 7320  # gd.exons.rgns 
-000839b0: 3d20 7261 6c6c 2e72 676e 735b 7031 3a70  = rall.rgns[p1:p
-000839c0: 325d 0a20 2020 2020 2020 2067 642e 6578  2].        gd.ex
-000839d0: 6f6e 732e 7267 6e73 203d 205b 7261 6c6c  ons.rgns = [rall
-000839e0: 2e72 676e 735b 7031 2b6d 5d20 666f 7220  .rgns[p1+m] for 
-000839f0: 6d20 696e 2072 616e 6765 2870 322d 7031  m in range(p2-p1
-00083a00: 295d 0a20 2020 2020 2020 2077 6820 3d20  )].        wh = 
-00083a10: 7768 6963 6828 2028 706f 735f 746f 5f61  which( (pos_to_a
-00083a20: 6464 203e 3d20 7031 2920 2620 2870 6f73  dd >= p1) & (pos
-00083a30: 5f74 6f5f 6164 6420 3c20 7032 2920 290a  _to_add < p2) ).
-00083a40: 2020 2020 2020 2020 6966 206c 656e 2877          if len(w
-00083a50: 6829 203e 2030 3a0a 2020 2020 2020 2020  h) > 0:.        
-00083a60: 2020 2020 666f 7220 7720 696e 2077 683a      for w in wh:
-00083a70: 2067 642e 6578 6f6e 732e 7267 6e73 2e61   gd.exons.rgns.a
-00083a80: 7070 656e 6428 725f 746f 5f61 6464 5b77  ppend(r_to_add[w
-00083a90: 5d29 0a0a 2020 2020 2323 2323 2323 2323  ])..    ########
-00083aa0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00083ab0: 2020 2020 2323 2072 656d 6f76 6520 6964      ## remove id
-00083ac0: 656c 6574 696f 6e20 0a20 2020 2023 2320  eletion .    ## 
-00083ad0: 636f 6d62 696e 6520 7469 6c65 6420 6578  combine tiled ex
-00083ae0: 6f6e 730a 2020 2020 0a20 2020 2066 6f72  ons.    .    for
-00083af0: 2067 6420 696e 2067 645f 7365 6c3a 0a20   gd in gd_sel:. 
-00083b00: 2020 2020 2020 2067 642e 7265 6d6f 7665         gd.remove
-00083b10: 5f69 6e64 656c 5f61 6e64 5f63 6f6d 6269  _indel_and_combi
-00083b20: 6e65 5f66 7261 6773 2829 0a0a 2020 2020  ne_frags()..    
-00083b30: 2327 2727 0a20 2020 2065 6c61 7073 6564  #'''.    elapsed
-00083b40: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
-00083b50: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
-00083b60: 0a20 2020 2023 2070 7269 6e74 2827 2020  .    # print('  
-00083b70: 2033 622e 2064 6f6e 6520 2825 6929 2020   3b. done (%i)  
-00083b80: 2720 2520 2865 6c61 7073 6564 5f74 696d  ' % (elapsed_tim
-00083b90: 6529 2c20 666c 7573 6820 3d20 5472 7565  e), flush = True
-00083ba0: 290a 2020 2020 0a0a 2020 2020 2323 2323  ).    ..    ####
-00083bb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083bc0: 2323 2323 0a20 2020 2023 2323 2323 2323  ####.    #######
-00083bd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083be0: 230a 2020 2020 2323 2063 6f64 696e 6720  #.    ## coding 
-00083bf0: 7265 6769 6f6e 2075 7064 6174 650a 0a20  region update.. 
-00083c00: 2020 2073 7461 7274 5f74 696d 6520 3d20     start_time = 
-00083c10: 7469 6d65 2e74 696d 6528 290a 2020 2020  time.time().    
-00083c20: 0a20 2020 2023 2320 636f 6c6c 6563 7420  .    ## collect 
-00083c30: 7267 6e73 2061 6e64 206d 6172 6b20 7468  rgns and mark th
-00083c40: 6569 7220 706f 730a 2020 2020 6c6f 635f  eir pos.    loc_
-00083c50: 6f73 203d 206e 702e 7a65 726f 7328 6e5f  os = np.zeros(n_
-00083c60: 6764 290a 2020 2020 6e75 6d5f 6f73 203d  gd).    num_os =
-00083c70: 206e 702e 7a65 726f 7328 6e5f 6764 2c64   np.zeros(n_gd,d
-00083c80: 7479 7065 3d6e 702e 666c 6f61 7433 3229  type=np.float32)
-00083c90: 0a20 2020 2063 616c 6c20 3d20 7265 6769  .    call = regi
-00083ca0: 6f6e 7328 290a 2020 2020 6f73 5f63 7572  ons().    os_cur
-00083cb0: 203d 2030 0a20 2020 2063 5f70 6f73 203d   = 0.    c_pos =
-00083cc0: 205b 5d0a 2020 2020 666f 7220 6b2c 2067   [].    for k, g
-00083cd0: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
-00083ce0: 645f 7365 6c29 3a0a 2020 2020 2020 2020  d_sel):.        
-00083cf0: 6c6f 635f 6f73 5b6b 5d20 3d20 6f73 5f63  loc_os[k] = os_c
-00083d00: 7572 0a20 2020 2020 2020 206e 756d 5f6f  ur.        num_o
-00083d10: 735b 6b5d 203d 206c 656e 2867 642e 6364  s[k] = len(gd.cd
-00083d20: 732e 7267 6e73 290a 2020 2020 2020 2020  s.rgns).        
-00083d30: 6361 6c6c 2e72 676e 7320 3d20 6361 6c6c  call.rgns = call
-00083d40: 2e72 676e 7320 2b20 6764 2e63 6473 2e72  .rgns + gd.cds.r
-00083d50: 676e 730a 2020 2020 2020 2020 6f73 5f63  gns.        os_c
-00083d60: 7572 202b 3d20 6c65 6e28 6764 2e63 6473  ur += len(gd.cds
-00083d70: 2e72 676e 7329 0a0a 2020 2020 2020 2020  .rgns)..        
-00083d80: 666f 7220 7220 696e 2067 642e 6364 732e  for r in gd.cds.
-00083d90: 7267 6e73 3a0a 2020 2020 2020 2020 2020  rgns:.          
-00083da0: 2020 635f 706f 732e 6170 7065 6e64 2872    c_pos.append(r
-00083db0: 2e73 7461 7274 290a 0a20 2020 2023 2320  .start)..    ## 
-00083dc0: 6765 7420 6f72 6465 7220 6163 636f 7264  get order accord
-00083dd0: 696e 6720 746f 206c 6f63 6174 696f 6e0a  ing to location.
-00083de0: 2020 2020 635f 706f 7320 3d20 6e70 2e61      c_pos = np.a
-00083df0: 7272 6179 2863 5f70 6f73 290a 2020 2020  rray(c_pos).    
-00083e00: 6f64 7220 3d20 635f 706f 732e 6172 6773  odr = c_pos.args
-00083e10: 6f72 7428 290a 0a20 2020 2023 2323 2323  ort()..    #####
-00083e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00083e50: 2323 230a 2020 2020 2323 2055 7365 206f  ###.    ## Use o
-00083e60: 6666 7365 745f 6669 6e64 6572 2074 6f20  ffset_finder to 
-00083e70: 636f 7272 6563 7420 706f 7369 7469 6f6e  correct position
-00083e80: 7320 696e 2047 5446 2065 6e74 7269 6573  s in GTF entries
-00083e90: 0a20 2020 2023 2320 616c 736f 2067 6574  .    ## also get
-00083ea0: 2072 676e 7320 6672 6167 6d65 6e74 7320   rgns fragments 
-00083eb0: 7768 656e 2073 706c 6974 2069 7320 7265  when split is re
-00083ec0: 7175 6972 6564 0a0a 2020 2020 635f 746f  quired..    c_to
-00083ed0: 5f61 6464 203d 205b 5d0a 2020 2020 706f  _add = [].    po
-00083ee0: 735f 746f 5f61 6464 203d 205b 5d0a 0a20  s_to_add = [].. 
-00083ef0: 2020 2070 7265 765f 6f66 6920 3d20 300a     prev_ofi = 0.
-00083f00: 2020 2020 2320 666f 7220 6b2c 2072 2069      # for k, r i
-00083f10: 6e20 656e 756d 6572 6174 6528 6361 6c6c  n enumerate(call
-00083f20: 2e72 676e 7329 3a0a 2020 2020 666f 7220  .rgns):.    for 
-00083f30: 6d2c 206b 2069 6e20 656e 756d 6572 6174  m, k in enumerat
-00083f40: 6528 6f64 7229 3a0a 2020 2020 2020 2020  e(odr):.        
-00083f50: 7220 3d20 6361 6c6c 2e72 676e 735b 6b5d  r = call.rgns[k]
-00083f60: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00083f70: 2020 2320 6f73 7320 3d20 6f66 2e66 696e    # oss = of.fin
-00083f80: 645f 6f73 2872 2e73 7461 7274 290a 2020  d_os(r.start).  
-00083f90: 2020 2020 2020 2320 6f73 6520 3d20 6f66        # ose = of
-00083fa0: 2e66 696e 645f 6f73 2872 2e65 6e64 290a  .find_os(r.end).
-00083fb0: 2020 2020 2020 2020 6f73 732c 2070 7265          oss, pre
-00083fc0: 765f 6f66 3120 3d20 6f66 2e66 696e 645f  v_of1 = of.find_
-00083fd0: 6f73 5f73 6571 2872 2e73 7461 7274 2c20  os_seq(r.start, 
-00083fe0: 7072 6576 5f6f 6669 2c20 6d61 726b 203d  prev_ofi, mark =
-00083ff0: 2027 4227 290a 2020 2020 2020 2020 6f73   'B').        os
-00084000: 652c 2070 7265 765f 6f66 3220 3d20 6f66  e, prev_of2 = of
-00084010: 2e66 696e 645f 6f73 5f73 6571 2872 2e65  .find_os_seq(r.e
-00084020: 6e64 2c20 7072 6576 5f6f 6669 2c20 6d61  nd, prev_ofi, ma
-00084030: 726b 203d 2027 4327 290a 2020 2020 2020  rk = 'C').      
-00084040: 2020 7072 6576 5f6f 6669 203d 2070 7265    prev_ofi = pre
-00084050: 765f 6f66 310a 0a20 2020 2020 2020 2069  v_of1..        i
-00084060: 6620 2872 2e74 7970 652e 6c6f 7765 7228  f (r.type.lower(
-00084070: 2920 3d3d 2027 7374 6172 745f 636f 646f  ) == 'start_codo
-00084080: 6e27 2920 7c20 2872 2e74 7970 652e 6c6f  n') | (r.type.lo
-00084090: 7765 7228 2920 3d3d 2027 7374 6f70 5f63  wer() == 'stop_c
-000840a0: 6f64 6f6e 2729 3a0a 2020 2020 2020 2020  odon'):.        
-000840b0: 2020 2020 722e 7374 6172 7420 2b3d 206f      r.start += o
-000840c0: 7373 0a20 2020 2020 2020 2020 2020 2072  ss.            r
-000840d0: 2e65 6e64 202b 3d20 6f73 7320 2020 0a20  .end += oss   . 
-000840e0: 2020 2020 2020 2020 2020 2063 616c 6c2e             call.
-000840f0: 7267 6e73 5b6b 5d20 3d20 722e 636f 7079  rgns[k] = r.copy
-00084100: 2875 7064 6174 653d 4661 6c73 6529 0a0a  (update=False)..
-00084110: 2020 2020 2020 2020 656c 7365 3a20 2023          else:  #
-00084120: 2043 4453 2c20 6669 7665 5f70 7269 6d65   CDS, five_prime
-00084130: 5f75 7472 2c20 7468 7265 655f 7072 696d  _utr, three_prim
-00084140: 655f 7574 722c 202e 2e2e 0a20 2020 2020  e_utr, ....     
-00084150: 2020 2020 2020 2069 6620 286f 7373 203d         if (oss =
-00084160: 3d20 6f73 6529 3a0a 2020 2020 2020 2020  = ose):.        
-00084170: 2020 2020 2020 2020 722e 7374 6172 7420          r.start 
-00084180: 2b3d 206f 7373 0a20 2020 2020 2020 2020  += oss.         
-00084190: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
-000841a0: 6f73 650a 2020 2020 2020 2020 2020 2020  ose.            
-000841b0: 2020 2020 6361 6c6c 2e72 676e 735b 6b5d      call.rgns[k]
-000841c0: 203d 2072 2e63 6f70 7928 7570 6461 7465   = r.copy(update
-000841d0: 3d46 616c 7365 290a 0a20 2020 2020 2020  =False)..       
-000841e0: 2020 2020 2065 6c69 6620 286f 7373 203c       elif (oss <
-000841f0: 206f 7365 293a 2023 2049 6e73 6572 7369   ose): # Insersi
-00084200: 6f6e 206f 7220 6465 6c65 7469 6f6e 2069  on or deletion i
-00084210: 6e20 6265 7477 6565 6e0a 0a20 2020 2020  n between..     
-00084220: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-00084230: 6e74 2827 2020 2025 6920 6f73 7320 3c20  nt('   %i oss < 
-00084240: 6f73 6527 2025 206b 290a 2020 2020 2020  ose' % k).      
-00084250: 2020 2020 2020 2020 2020 702c 2070 7265            p, pre
-00084260: 765f 6f66 3220 3d20 6f66 2e67 6574 5f62  v_of2 = of.get_b
-00084270: 6e64 7279 5f73 6571 2872 2e65 6e64 2c20  ndry_seq(r.end, 
-00084280: 7072 6576 5f6f 6669 290a 0a20 2020 2020  prev_ofi)..     
-00084290: 2020 2020 2020 2020 2020 2023 2320 7370             ## sp
-000842a0: 6c69 740a 2020 2020 2020 2020 2020 2020  lit.            
-000842b0: 2020 2020 7267 6e5f 6e65 7720 3d20 7265      rgn_new = re
-000842c0: 6769 6f6e 2820 722e 6368 722c 2070 2b6f  gion( r.chr, p+o
-000842d0: 7365 2c20 722e 656e 642b 6f73 652c 2072  se, r.end+ose, r
-000842e0: 2e74 7970 652c 2078 7320 3d20 722e 7873  .type, xs = r.xs
-000842f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00084300: 2020 635f 746f 5f61 6464 2e61 7070 656e    c_to_add.appen
-00084310: 6428 7267 6e5f 6e65 7729 0a20 2020 2020  d(rgn_new).     
-00084320: 2020 2020 2020 2020 2020 2070 6f73 5f74             pos_t
-00084330: 6f5f 6164 642e 6170 7065 6e64 286b 2b31  o_add.append(k+1
-00084340: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00084350: 2020 2072 2e65 6e64 203d 2070 2d31 2b6f     r.end = p-1+o
-00084360: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
-00084370: 2020 2072 2e73 7461 7274 202b 3d20 6f73     r.start += os
-00084380: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00084390: 2020 6361 6c6c 2e72 676e 735b 6b5d 203d    call.rgns[k] =
-000843a0: 2072 2e63 6f70 7928 7570 6461 7465 3d46   r.copy(update=F
-000843b0: 616c 7365 290a 0a20 2020 2020 2020 2020  alse)..         
-000843c0: 2020 2065 6c69 6620 286f 7373 203e 206f     elif (oss > o
-000843d0: 7365 293a 2023 2064 656c 6574 696f 6e20  se): # deletion 
-000843e0: 696e 2062 6574 7765 656e 0a0a 2020 2020  in between..    
-000843f0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00084400: 696e 7428 2720 2020 2569 206f 7373 203e  int('   %i oss >
-00084410: 206f 7365 2720 2520 6b29 0a20 2020 2020   ose' % k).     
-00084420: 2020 2020 2020 2020 2020 2070 2c20 7072             p, pr
-00084430: 6576 5f6f 6632 203d 206f 662e 6765 745f  ev_of2 = of.get_
-00084440: 626e 6472 795f 7365 7128 722e 656e 642c  bndry_seq(r.end,
-00084450: 2070 7265 765f 6f66 6929 0a20 2020 2020   prev_ofi).     
-00084460: 2020 2020 2020 2020 2020 204c 6420 3d20             Ld = 
-00084470: 6f73 7320 2d20 6f73 650a 0a20 2020 2020  oss - ose..     
-00084480: 2020 2020 2020 2020 2020 2023 2320 7370             ## sp
-00084490: 6c69 7420 2866 6f72 2043 4453 206f 6e6c  lit (for CDS onl
-000844a0: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-000844b0: 2020 2072 676e 5f6e 6577 203d 2072 6567     rgn_new = reg
-000844c0: 696f 6e28 2072 2e63 6872 2c20 702b 4c64  ion( r.chr, p+Ld
-000844d0: 2b6f 7365 2c20 722e 656e 642b 6f73 652c  +ose, r.end+ose,
-000844e0: 2072 2e74 7970 652c 2078 7320 3d20 722e   r.type, xs = r.
-000844f0: 7873 290a 2020 2020 2020 2020 2020 2020  xs).            
-00084500: 2020 2020 635f 746f 5f61 6464 2e61 7070      c_to_add.app
-00084510: 656e 6428 7267 6e5f 6e65 7729 0a20 2020  end(rgn_new).   
-00084520: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00084530: 5f74 6f5f 6164 642e 6170 7065 6e64 286b  _to_add.append(k
-00084540: 2b31 290a 0a20 2020 2020 2020 2020 2020  +1)..           
-00084550: 2020 2020 2072 2e65 6e64 203d 2070 2d31       r.end = p-1
-00084560: 2b6f 7373 0a20 2020 2020 2020 2020 2020  +oss.           
-00084570: 2020 2020 2072 2e73 7461 7274 202b 3d20       r.start += 
-00084580: 6f73 730a 2020 2020 2020 2020 2020 2020  oss.            
-00084590: 2020 2020 6361 6c6c 2e72 676e 735b 6b5d      call.rgns[k]
-000845a0: 203d 2072 2e63 6f70 7928 7570 6461 7465   = r.copy(update
-000845b0: 3d46 616c 7365 290a 0a20 2020 2023 2323  =False)..    ###
-000845c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000845d0: 2323 2323 2323 230a 2020 2020 2323 2070  #######.    ## p
-000845e0: 7574 2072 676e 7320 6261 636b 2074 6f20  ut rgns back to 
-000845f0: 6764 5f73 656c 0a20 2020 2023 2320 616e  gd_sel.    ## an
-00084600: 6420 616c 736f 2061 6464 206e 6577 2072  d also add new r
-00084610: 676e 7320 0a0a 2020 2020 706f 735f 746f  gns ..    pos_to
-00084620: 5f61 6464 203d 206e 702e 6172 7261 7928  _add = np.array(
-00084630: 706f 735f 746f 5f61 6464 290a 2020 2020  pos_to_add).    
-00084640: 666f 7220 6b2c 2067 6420 696e 2065 6e75  for k, gd in enu
-00084650: 6d65 7261 7465 2867 645f 7365 6c29 3a20  merate(gd_sel): 
-00084660: 0a0a 2020 2020 2020 2020 7031 203d 2069  ..        p1 = i
-00084670: 6e74 286c 6f63 5f6f 735b 6b5d 290a 2020  nt(loc_os[k]).  
-00084680: 2020 2020 2020 7032 203d 2069 6e74 2870        p2 = int(p
-00084690: 3120 2b20 6e75 6d5f 6f73 5b6b 5d29 0a20  1 + num_os[k]). 
-000846a0: 2020 2020 2020 2067 642e 6364 732e 7267         gd.cds.rg
-000846b0: 6e73 203d 205b 6361 6c6c 2e72 676e 735b  ns = [call.rgns[
-000846c0: 7031 2b6d 5d20 666f 7220 6d20 696e 2072  p1+m] for m in r
-000846d0: 616e 6765 2870 322d 7031 295d 0a20 2020  ange(p2-p1)].   
-000846e0: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
-000846f0: 2028 706f 735f 746f 5f61 6464 203e 3d20   (pos_to_add >= 
-00084700: 7031 2920 2620 2870 6f73 5f74 6f5f 6164  p1) & (pos_to_ad
-00084710: 6420 3c20 7032 2920 290a 2020 2020 2020  d < p2) ).      
-00084720: 2020 6966 206c 656e 2877 6829 203e 2030    if len(wh) > 0
-00084730: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00084740: 7220 7720 696e 2077 683a 2067 642e 6364  r w in wh: gd.cd
-00084750: 732e 7267 6e73 2e61 7070 656e 6428 635f  s.rgns.append(c_
-00084760: 746f 5f61 6464 5b77 5d29 0a0a 2020 2020  to_add[w])..    
-00084770: 656c 6170 7365 645f 7469 6d65 203d 2074  elapsed_time = t
-00084780: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
-00084790: 7274 5f74 696d 650a 2020 2020 2320 7072  rt_time.    # pr
-000847a0: 696e 7428 2720 2020 342e 2064 6f6e 6520  int('   4. done 
-000847b0: 2825 6929 2020 2720 2520 2865 6c61 7073  (%i)  ' % (elaps
-000847c0: 6564 5f74 696d 6529 2c20 666c 7573 6820  ed_time), flush 
-000847d0: 3d20 5472 7565 290a 2020 2020 0a20 2020  = True).    .   
-000847e0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-000847f0: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
-00084800: 2063 6f64 696e 6720 7265 6769 6f6e 2075   coding region u
-00084810: 7064 6174 650a 2020 2020 2323 2323 2323  pdate.    ######
-00084820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00084830: 2323 0a0a 2020 2020 2323 2323 2323 2323  ##..    ########
+00081d40: 6f73 203d 2072 2e73 7461 7274 0a0a 2020  os = r.start..  
+00081d50: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+00081d60: 2e61 6464 2820 6f73 5f63 7572 2c20 7072  .add( os_cur, pr
+00081d70: 6576 5f70 6f73 2c20 722e 656e 642b 3120  ev_pos, r.end+1 
+00081d80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00081d90: 2020 7072 6576 5f70 6f73 203d 2072 2e65    prev_pos = r.e
+00081da0: 6e64 2b31 0a0a 2020 2020 2020 2020 6c61  nd+1..        la
+00081db0: 7374 5f70 6f73 203d 2072 2e65 6e64 0a0a  st_pos = r.end..
+00081dc0: 2020 2020 7365 715f 6c73 742e 6170 7065      seq_lst.appe
+00081dd0: 6e64 2873 6571 5f6f 7267 5b28 7072 6576  nd(seq_org[(prev
+00081de0: 5f70 6f73 2d31 293a 5d29 0a20 2020 2073  _pos-1):]).    s
+00081df0: 6571 5f6e 6577 203d 2027 272e 6a6f 696e  eq_new = ''.join
+00081e00: 2873 6571 5f6c 7374 290a 0a20 2020 2023  (seq_lst)..    #
+00081e10: 2069 6620 6c61 7374 5f70 6f73 203e 2070   if last_pos > p
+00081e20: 7265 765f 706f 733a 0a20 2020 206f 662e  rev_pos:.    of.
+00081e30: 6164 6428 206f 735f 6375 722c 2070 7265  add( os_cur, pre
+00081e40: 765f 706f 732c 206c 656e 2873 6571 5f6f  v_pos, len(seq_o
+00081e50: 7267 2920 2b20 3130 3030 3030 2029 0a0a  rg) + 100000 )..
+00081e60: 2020 2020 656c 6170 7365 645f 7469 6d65      elapsed_time
+00081e70: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+00081e80: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
+00081e90: 2320 7072 696e 7428 2720 2020 322e 2064  # print('   2. d
+00081ea0: 6f6e 6520 2825 6929 2020 2720 2520 2865  one (%i)  ' % (e
+00081eb0: 6c61 7073 6564 5f74 696d 6529 2c20 666c  lapsed_time), fl
+00081ec0: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+00081ed0: 2327 2727 0a0a 2020 2020 2323 2323 2323  #'''..    ######
+00081ee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081ef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081f00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00081f10: 2323 0a20 2020 2023 2320 5573 6520 6f66  ##.    ## Use of
+00081f20: 6673 6574 5f66 696e 6465 7220 746f 2063  fset_finder to c
+00081f30: 6f72 7265 6374 2070 6f73 6974 696f 6e73  orrect positions
+00081f40: 2069 6e20 4754 4620 656e 7472 6965 730a   in GTF entries.
+00081f50: 2020 2020 2323 2061 6c73 6f20 6765 7420      ## also get 
+00081f60: 7267 6e73 2066 7261 676d 656e 7473 2077  rgns fragments w
+00081f70: 6865 6e20 7370 6c69 7420 6973 2072 6571  hen split is req
+00081f80: 7569 7265 640a 0a20 2020 206f 662e 6d61  uired..    of.ma
+00081f90: 6b65 5f69 745f 636f 6d70 6163 7428 290a  ke_it_compact().
+00081fa0: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
+00081fb0: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+00081fc0: 290a 2020 2020 725f 746f 5f61 6464 203d  ).    r_to_add =
+00081fd0: 205b 5d0a 2020 2020 706f 735f 746f 5f61   [].    pos_to_a
+00081fe0: 6464 203d 205b 5d0a 2020 2020 736e 765f  dd = [].    snv_
+00081ff0: 696e 666f 5f63 6872 203d 205b 5d0a 0a20  info_chr = [].. 
+00082000: 2020 2066 6f72 2067 6420 696e 2067 645f     for gd in gd_
+00082010: 7365 6c3a 0a20 2020 2020 2020 2067 642e  sel:.        gd.
+00082020: 6e76 5f69 6e66 6f5f 6c73 7420 3d20 5b5d  nv_info_lst = []
+00082030: 0a0a 2020 2020 7072 6576 5f6f 6669 203d  ..    prev_ofi =
+00082040: 2030 0a20 2020 2076 5f63 6e74 203d 2030   0.    v_cnt = 0
+00082050: 0a20 2020 2023 666f 7220 6b2c 2072 2069  .    #for k, r i
+00082060: 6e20 656e 756d 6572 6174 6528 7261 6c6c  n enumerate(rall
+00082070: 2e72 676e 7329 3a0a 2020 2020 666f 7220  .rgns):.    for 
+00082080: 6d2c 206b 2069 6e20 656e 756d 6572 6174  m, k in enumerat
+00082090: 6528 6f64 7229 3a0a 2020 2020 2020 2020  e(odr):.        
+000820a0: 7220 3d20 7261 6c6c 2e72 676e 735b 6b5d  r = rall.rgns[k]
+000820b0: 0a20 2020 2020 2020 2067 696e 203d 2047  .        gin = G
+000820c0: 656e 655f 6964 5f6e 616d 655b 6b5d 0a20  ene_id_name[k]. 
+000820d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000820e0: 6f73 732c 2070 7265 765f 6f66 3120 3d20  oss, prev_of1 = 
+000820f0: 6f66 2e66 696e 645f 6f73 5f73 6571 2872  of.find_os_seq(r
+00082100: 2e73 7461 7274 2c20 7072 6576 5f6f 6669  .start, prev_ofi
+00082110: 290a 2020 2020 2020 2020 2320 6f73 6520  ).        # ose 
+00082120: 3d20 6f73 730a 2020 2020 2020 2020 6f73  = oss.        os
+00082130: 652c 2070 7265 765f 6f66 3220 3d20 6f66  e, prev_of2 = of
+00082140: 2e66 696e 645f 6f73 5f73 6571 2872 2e65  .find_os_seq(r.e
+00082150: 6e64 2c20 7072 6576 5f6f 6669 290a 200a  nd, prev_ofi). .
+00082160: 2020 2020 2020 2020 722e 6765 745f 6376          r.get_cv
+00082170: 6728 290a 2020 2020 2020 2020 2320 6966  g().        # if
+00082180: 2072 2e63 7667 2069 7320 4e6f 6e65 3a20   r.cvg is None: 
+00082190: 722e 6376 6720 3d20 6e70 2e6f 6e65 7328  r.cvg = np.ones(
+000821a0: 6c65 6e28 722e 7365 7129 290a 0a20 2020  len(r.seq))..   
+000821b0: 2020 2020 2069 6620 722e 7479 7065 203d       if r.type =
+000821c0: 3d20 2765 786f 6e27 3a0a 2020 2020 2020  = 'exon':.      
+000821d0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+000821e0: 2020 2069 6620 286f 7373 203d 3d20 6f73     if (oss == os
+000821f0: 6529 3a0a 0a20 2020 2020 2020 2020 2020  e):..           
+00082200: 2020 2020 2023 2073 695f 6c73 7420 3d20       # si_lst = 
+00082210: 6669 6e64 5f73 6e70 2873 6571 5f6f 7267  find_snp(seq_org
+00082220: 5b28 722e 7374 6172 742d 3129 3a72 2e65  [(r.start-1):r.e
+00082230: 6e64 5d2c 2072 2e73 6571 2c20 722e 6765  nd], r.seq, r.ge
+00082240: 745f 6376 6728 292c 2063 6872 6d2c 2072  t_cvg(), chrm, r
+00082250: 2e73 7461 7274 2c20 6f73 7329 0a20 2020  .start, oss).   
+00082260: 2020 2020 2020 2020 2020 2020 2073 695f               si_
+00082270: 6c73 7420 3d20 6669 6e64 5f73 6e70 2873  lst = find_snp(s
+00082280: 6571 5f6f 7267 5b28 722e 7374 6172 742d  eq_org[(r.start-
+00082290: 3129 3a72 2e65 6e64 5d2c 2072 2e73 6571  1):r.end], r.seq
+000822a0: 2c20 722e 636d 6174 2c20 6368 726d 2c20  , r.cmat, chrm, 
+000822b0: 722e 7374 6172 742c 206f 7373 2c20 6769  r.start, oss, gi
+000822c0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+000822d0: 2020 2073 6e76 5f69 6e66 6f5f 6368 7220     snv_info_chr 
+000822e0: 3d20 736e 765f 696e 666f 5f63 6872 202b  = snv_info_chr +
+000822f0: 2073 695f 6c73 740a 2020 2020 2020 2020   si_lst.        
+00082300: 2020 2020 2020 2020 6764 5f69 6478 203d          gd_idx =
+00082310: 2067 645f 6964 785f 6f66 5f72 676e 5b6b   gd_idx_of_rgn[k
+00082320: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00082330: 2020 6764 5f73 656c 5b67 645f 6964 785d    gd_sel[gd_idx]
+00082340: 2e6e 765f 696e 666f 5f6c 7374 203d 2067  .nv_info_lst = g
+00082350: 645f 7365 6c5b 6764 5f69 6478 5d2e 6e76  d_sel[gd_idx].nv
+00082360: 5f69 6e66 6f5f 6c73 7420 2b20 7369 5f6c  _info_lst + si_l
+00082370: 7374 0a0a 2020 2020 2020 2020 2020 2020  st..            
+00082380: 2020 2020 722e 7374 6172 7420 2b3d 206f      r.start += o
+00082390: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
+000823a0: 2020 2072 2e65 6e64 202b 3d20 6f73 650a     r.end += ose.
+000823b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000823c0: 7261 6c6c 2e72 676e 735b 6b5d 203d 2072  rall.rgns[k] = r
+000823d0: 2023 202e 636f 7079 2829 0a0a 0a20 2020   # .copy()...   
+000823e0: 2020 2020 2020 2020 2065 6c69 6620 286f           elif (o
+000823f0: 7373 203c 206f 7365 293a 2023 2049 6e73  ss < ose): # Ins
+00082400: 6572 7369 6f6e 2069 6e20 6265 7477 6565  ersion in betwee
+00082410: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+00082420: 2020 2070 7269 6e74 2827 2020 2025 6920     print('   %i 
+00082430: 6f73 7320 3c20 6f73 6527 2025 206b 290a  oss < ose' % k).
+00082440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082450: 2320 722e 7072 696e 745f 7368 6f72 7428  # r.print_short(
+00082460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00082470: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
+00082480: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
+00082490: 286f 7365 2c20 7072 6576 5f6f 6669 290a  (ose, prev_ofi).
+000824a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000824b0: 2023 2320 7370 6c69 740a 2020 2020 2020   ## split.      
+000824c0: 2020 2020 2020 2020 2020 4c72 203d 2072            Lr = r
+000824d0: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
+000824e0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+000824f0: 2020 4c6e 203d 2072 2e65 6e64 202d 2070    Ln = r.end - p
+00082500: 202b 2031 0a20 2020 2020 2020 2020 2020   + 1.           
+00082510: 2020 2020 2072 676e 5f6e 6577 203d 2072       rgn_new = r
+00082520: 6567 696f 6e28 2072 2e63 6872 2c20 702b  egion( r.chr, p+
+00082530: 6f73 652c 2072 2e65 6e64 2b6f 7365 2c20  ose, r.end+ose, 
+00082540: 722e 7479 7065 2c20 722e 636d 6174 5b3a  r.type, r.cmat[:
+00082550: 2c2d 4c6e 3a5d 2c20 7873 203d 2072 2e78  ,-Ln:], xs = r.x
+00082560: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00082570: 2020 2072 676e 5f6e 6577 2e67 6574 5f63     rgn_new.get_c
+00082580: 7667 2829 0a20 2020 2020 2020 2020 2020  vg().           
+00082590: 2020 2020 2072 5f74 6f5f 6164 642e 6170       r_to_add.ap
+000825a0: 7065 6e64 2872 676e 5f6e 6577 290a 2020  pend(rgn_new).  
+000825b0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+000825c0: 735f 746f 5f61 6464 2e61 7070 656e 6428  s_to_add.append(
+000825d0: 6b2b 3129 0a0a 2020 2020 2020 2020 2020  k+1)..          
+000825e0: 2020 2020 2020 2320 7369 5f6c 7374 203d        # si_lst =
+000825f0: 2066 696e 645f 736e 7028 7365 715f 6f72   find_snp(seq_or
+00082600: 675b 2870 2d31 293a 722e 656e 645d 2c20  g[(p-1):r.end], 
+00082610: 7267 6e5f 6e65 772e 7365 712c 2072 676e  rgn_new.seq, rgn
+00082620: 5f6e 6577 2e67 6574 5f63 7667 2829 2c20  _new.get_cvg(), 
+00082630: 6368 726d 2c20 702c 206f 7365 290a 2020  chrm, p, ose).  
+00082640: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00082650: 5f6c 7374 203d 2066 696e 645f 736e 7028  _lst = find_snp(
+00082660: 7365 715f 6f72 675b 2870 2d31 293a 722e  seq_org[(p-1):r.
+00082670: 656e 645d 2c20 7267 6e5f 6e65 772e 7365  end], rgn_new.se
+00082680: 712c 2072 676e 5f6e 6577 2e63 6d61 742c  q, rgn_new.cmat,
+00082690: 2063 6872 6d2c 2070 2c20 6f73 652c 2067   chrm, p, ose, g
+000826a0: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+000826b0: 2020 2020 736e 765f 696e 666f 5f63 6872      snv_info_chr
+000826c0: 203d 2073 6e76 5f69 6e66 6f5f 6368 7220   = snv_info_chr 
+000826d0: 2b20 7369 5f6c 7374 0a20 2020 2020 2020  + si_lst.       
+000826e0: 2020 2020 2020 2020 2067 645f 6964 7820           gd_idx 
+000826f0: 3d20 6764 5f69 6478 5f6f 665f 7267 6e5b  = gd_idx_of_rgn[
+00082700: 6b5d 0a20 2020 2020 2020 2020 2020 2020  k].             
+00082710: 2020 2067 645f 7365 6c5b 6764 5f69 6478     gd_sel[gd_idx
+00082720: 5d2e 6e76 5f69 6e66 6f5f 6c73 7420 3d20  ].nv_info_lst = 
+00082730: 6764 5f73 656c 5b67 645f 6964 785d 2e6e  gd_sel[gd_idx].n
+00082740: 765f 696e 666f 5f6c 7374 202b 2073 695f  v_info_lst + si_
+00082750: 6c73 740a 0a20 2020 2020 2020 2020 2020  lst..           
+00082760: 2020 2020 2072 2e65 6e64 203d 2070 2d31       r.end = p-1
+00082770: 2b6f 7373 0a20 2020 2020 2020 2020 2020  +oss.           
+00082780: 2020 2020 2072 2e73 7461 7274 202b 3d20       r.start += 
+00082790: 6f73 730a 2020 2020 2020 2020 2020 2020  oss.            
+000827a0: 2020 2020 4c6e 203d 2072 2e65 6e64 202d      Ln = r.end -
+000827b0: 2072 2e73 7461 7274 202b 310a 2020 2020   r.start +1.    
+000827c0: 2020 2020 2020 2020 2020 2020 722e 636d              r.cm
+000827d0: 6174 203d 2072 2e63 6d61 745b 3a2c 3a4c  at = r.cmat[:,:L
+000827e0: 6e5d 0a20 2020 2020 2020 2020 2020 2020  n].             
+000827f0: 2020 2072 2e73 6571 203d 2072 2e73 6571     r.seq = r.seq
+00082800: 5b3a 4c6e 5d0a 2020 2020 2020 2020 2020  [:Ln].          
+00082810: 2020 2020 2020 722e 6376 6720 3d20 722e        r.cvg = r.
+00082820: 6376 675b 3a4c 6e5d 0a20 2020 2020 2020  cvg[:Ln].       
+00082830: 2020 2020 2020 2020 2023 2072 2e67 6574           # r.get
+00082840: 5f63 7667 2829 0a20 2020 2020 2020 2020  _cvg().         
+00082850: 2020 2020 2020 2072 616c 6c2e 7267 6e73         rall.rgns
+00082860: 5b6b 5d20 3d20 7220 2320 2e63 6f70 7928  [k] = r # .copy(
+00082870: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00082880: 2020 2023 2073 695f 6c73 7420 3d20 6669     # si_lst = fi
+00082890: 6e64 5f73 6e70 2873 6571 5f6f 7267 5b28  nd_snp(seq_org[(
+000828a0: 722e 7374 6172 742d 6f73 732d 3129 3a70  r.start-oss-1):p
+000828b0: 5d2c 2072 2e73 6571 2c20 722e 6765 745f  ], r.seq, r.get_
+000828c0: 6376 6728 292c 2063 6872 6d2c 2072 2e73  cvg(), chrm, r.s
+000828d0: 7461 7274 2d6f 7373 2c20 6f73 7329 0a20  tart-oss, oss). 
+000828e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000828f0: 695f 6c73 7420 3d20 6669 6e64 5f73 6e70  i_lst = find_snp
+00082900: 2873 6571 5f6f 7267 5b28 722e 7374 6172  (seq_org[(r.star
+00082910: 742d 6f73 732d 3129 3a70 5d2c 2072 2e73  t-oss-1):p], r.s
+00082920: 6571 2c20 722e 636d 6174 2c20 6368 726d  eq, r.cmat, chrm
+00082930: 2c20 722e 7374 6172 742d 6f73 732c 206f  , r.start-oss, o
+00082940: 7373 2c20 6769 6e29 0a20 2020 2020 2020  ss, gin).       
+00082950: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
+00082960: 6f5f 6368 7220 3d20 736e 765f 696e 666f  o_chr = snv_info
+00082970: 5f63 6872 202b 2073 695f 6c73 740a 2020  _chr + si_lst.  
+00082980: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+00082990: 5f69 6478 203d 2067 645f 6964 785f 6f66  _idx = gd_idx_of
+000829a0: 5f72 676e 5b6b 5d0a 2020 2020 2020 2020  _rgn[k].        
+000829b0: 2020 2020 2020 2020 6764 5f73 656c 5b67          gd_sel[g
+000829c0: 645f 6964 785d 2e6e 765f 696e 666f 5f6c  d_idx].nv_info_l
+000829d0: 7374 203d 2067 645f 7365 6c5b 6764 5f69  st = gd_sel[gd_i
+000829e0: 6478 5d2e 6e76 5f69 6e66 6f5f 6c73 7420  dx].nv_info_lst 
+000829f0: 2b20 7369 5f6c 7374 0a0a 2020 2020 2020  + si_lst..      
+00082a00: 2020 2020 2020 656c 6966 2028 6f73 7320        elif (oss 
+00082a10: 3e20 6f73 6529 3a20 2320 6465 6c65 7469  > ose): # deleti
+00082a20: 6f6e 2069 6e20 6265 7477 6565 6e0a 0a20  on in between.. 
+00082a30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00082a40: 7269 6e74 2827 2020 2025 6920 6f73 7320  rint('   %i oss 
+00082a50: 3e20 6f73 6527 2025 206b 290a 2020 2020  > ose' % k).    
+00082a60: 2020 2020 2020 2020 2020 2020 2320 722e              # r.
+00082a70: 7072 696e 745f 7368 6f72 7428 290a 2020  print_short().  
+00082a80: 2020 2020 2020 2020 2020 2020 2020 702c                p,
+00082a90: 2070 7265 765f 6f66 3220 3d20 6f66 2e67   prev_of2 = of.g
+00082aa0: 6574 5f62 6e64 7279 5f73 6571 286f 7365  et_bndry_seq(ose
+00082ab0: 2c20 7072 6576 5f6f 6669 290a 2020 2020  , prev_ofi).    
+00082ac0: 2020 2020 2020 2020 2020 2020 4c64 203d              Ld =
+00082ad0: 206f 7373 202d 206f 7365 0a0a 2020 2020   oss - ose..    
+00082ae0: 2020 2020 2020 2020 2020 2020 2323 2073              ## s
+00082af0: 706c 6974 2028 666f 7220 4344 5320 6f6e  plit (for CDS on
+00082b00: 6c79 290a 2020 2020 2020 2020 2020 2020  ly).            
+00082b10: 2020 2020 4c72 203d 2072 2e65 6e64 202d      Lr = r.end -
+00082b20: 2072 2e73 7461 7274 202b 310a 2020 2020   r.start +1.    
+00082b30: 2020 2020 2020 2020 2020 2020 4c6e 203d              Ln =
+00082b40: 2072 2e65 6e64 202d 2070 202b 2031 202d   r.end - p + 1 -
+00082b50: 204c 640a 2020 2020 2020 2020 2020 2020   Ld.            
+00082b60: 2020 2020 7267 6e5f 6e65 7720 3d20 7265      rgn_new = re
+00082b70: 6769 6f6e 2820 722e 6368 722c 2070 2b4c  gion( r.chr, p+L
+00082b80: 642b 6f73 652c 2072 2e65 6e64 2b6f 7365  d+ose, r.end+ose
+00082b90: 2c20 722e 7479 7065 2c20 722e 636d 6174  , r.type, r.cmat
+00082ba0: 5b3a 2c2d 4c6e 3a5d 2c20 7873 203d 2072  [:,-Ln:], xs = r
+00082bb0: 2e78 7329 0a20 2020 2020 2020 2020 2020  .xs).           
+00082bc0: 2020 2020 2072 676e 5f6e 6577 2e67 6574       rgn_new.get
+00082bd0: 5f63 7667 2829 0a20 2020 2020 2020 2020  _cvg().         
+00082be0: 2020 2020 2020 2072 5f74 6f5f 6164 642e         r_to_add.
+00082bf0: 6170 7065 6e64 2872 676e 5f6e 6577 290a  append(rgn_new).
+00082c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082c10: 706f 735f 746f 5f61 6464 2e61 7070 656e  pos_to_add.appen
+00082c20: 6428 6b2b 3129 0a0a 2020 2020 2020 2020  d(k+1)..        
+00082c30: 2020 2020 2020 2020 2320 7369 5f6c 7374          # si_lst
+00082c40: 203d 2066 696e 645f 736e 7028 7365 715f   = find_snp(seq_
+00082c50: 6e65 775b 2872 676e 5f6e 6577 2e73 7461  new[(rgn_new.sta
+00082c60: 7274 2d31 293a 7267 6e5f 6e65 772e 656e  rt-1):rgn_new.en
+00082c70: 645d 2c20 7267 6e5f 6e65 772e 7365 712c  d], rgn_new.seq,
+00082c80: 2072 676e 5f6e 6577 2e67 6574 5f63 7667   rgn_new.get_cvg
+00082c90: 2829 2c20 6368 726d 2c20 702c 206f 7365  (), chrm, p, ose
+00082ca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00082cb0: 2020 7369 5f6c 7374 203d 2066 696e 645f    si_lst = find_
+00082cc0: 736e 7028 7365 715f 6e65 775b 2872 676e  snp(seq_new[(rgn
+00082cd0: 5f6e 6577 2e73 7461 7274 2d31 293a 7267  _new.start-1):rg
+00082ce0: 6e5f 6e65 772e 656e 645d 2c20 7267 6e5f  n_new.end], rgn_
+00082cf0: 6e65 772e 7365 712c 2072 676e 5f6e 6577  new.seq, rgn_new
+00082d00: 2e63 6d61 742c 2063 6872 6d2c 2070 2c20  .cmat, chrm, p, 
+00082d10: 6f73 652c 2067 696e 290a 2020 2020 2020  ose, gin).      
+00082d20: 2020 2020 2020 2020 2020 736e 765f 696e            snv_in
+00082d30: 666f 5f63 6872 203d 2073 6e76 5f69 6e66  fo_chr = snv_inf
+00082d40: 6f5f 6368 7220 2b20 7369 5f6c 7374 0a20  o_chr + si_lst. 
+00082d50: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00082d60: 645f 6964 7820 3d20 6764 5f69 6478 5f6f  d_idx = gd_idx_o
+00082d70: 665f 7267 6e5b 6b5d 0a20 2020 2020 2020  f_rgn[k].       
+00082d80: 2020 2020 2020 2020 2067 645f 7365 6c5b           gd_sel[
+00082d90: 6764 5f69 6478 5d2e 6e76 5f69 6e66 6f5f  gd_idx].nv_info_
+00082da0: 6c73 7420 3d20 6764 5f73 656c 5b67 645f  lst = gd_sel[gd_
+00082db0: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
+00082dc0: 202b 2073 695f 6c73 740a 0a20 2020 2020   + si_lst..     
+00082dd0: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
+00082de0: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
+00082df0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
+00082e00: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
+00082e10: 2020 2020 2020 2020 2020 4c6e 203d 2072            Ln = r
+00082e20: 2e65 6e64 202d 2072 2e73 7461 7274 202b  .end - r.start +
+00082e30: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00082e40: 2020 722e 636d 6174 203d 2072 2e63 6d61    r.cmat = r.cma
+00082e50: 745b 3a2c 3a4c 6e5d 0a20 2020 2020 2020  t[:,:Ln].       
+00082e60: 2020 2020 2020 2020 2072 2e73 6571 203d           r.seq =
+00082e70: 2072 2e73 6571 5b3a 4c6e 5d0a 2020 2020   r.seq[:Ln].    
+00082e80: 2020 2020 2020 2020 2020 2020 722e 6376              r.cv
+00082e90: 6720 3d20 722e 6376 675b 3a4c 6e5d 0a20  g = r.cvg[:Ln]. 
+00082ea0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00082eb0: 2072 2e67 6574 5f63 7667 2829 0a20 2020   r.get_cvg().   
+00082ec0: 2020 2020 2020 2020 2020 2020 2072 616c               ral
+00082ed0: 6c2e 7267 6e73 5b6b 5d20 3d20 7220 2320  l.rgns[k] = r # 
+00082ee0: 2e63 6f70 7928 290a 0a20 2020 2020 2020  .copy()..       
+00082ef0: 2020 2020 2020 2020 2023 2073 695f 6c73           # si_ls
+00082f00: 7420 3d20 6669 6e64 5f73 6e70 2873 6571  t = find_snp(seq
+00082f10: 5f6f 7267 5b28 722e 7374 6172 742d 6f73  _org[(r.start-os
+00082f20: 732d 3129 3a70 5d2c 2072 2e73 6571 2c20  s-1):p], r.seq, 
+00082f30: 722e 6765 745f 6376 6728 292c 2063 6872  r.get_cvg(), chr
+00082f40: 6d2c 2072 2e73 7461 7274 2d6f 7373 2c20  m, r.start-oss, 
+00082f50: 6f73 7329 0a20 2020 2020 2020 2020 2020  oss).           
+00082f60: 2020 2020 2073 695f 6c73 7420 3d20 6669       si_lst = fi
+00082f70: 6e64 5f73 6e70 2873 6571 5f6f 7267 5b28  nd_snp(seq_org[(
+00082f80: 722e 7374 6172 742d 6f73 732d 3129 3a70  r.start-oss-1):p
+00082f90: 5d2c 2072 2e73 6571 2c20 722e 636d 6174  ], r.seq, r.cmat
+00082fa0: 2c20 6368 726d 2c20 722e 7374 6172 742d  , chrm, r.start-
+00082fb0: 6f73 732c 206f 7373 2c20 6769 6e29 0a20  oss, oss, gin). 
+00082fc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00082fd0: 6e76 5f69 6e66 6f5f 6368 7220 3d20 736e  nv_info_chr = sn
+00082fe0: 765f 696e 666f 5f63 6872 202b 2073 695f  v_info_chr + si_
+00082ff0: 6c73 740a 2020 2020 2020 2020 2020 2020  lst.            
+00083000: 2020 2020 6764 5f69 6478 203d 2067 645f      gd_idx = gd_
+00083010: 6964 785f 6f66 5f72 676e 5b6b 5d0a 2020  idx_of_rgn[k].  
+00083020: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+00083030: 5f73 656c 5b67 645f 6964 785d 2e6e 765f  _sel[gd_idx].nv_
+00083040: 696e 666f 5f6c 7374 203d 2067 645f 7365  info_lst = gd_se
+00083050: 6c5b 6764 5f69 6478 5d2e 6e76 5f69 6e66  l[gd_idx].nv_inf
+00083060: 6f5f 6c73 7420 2b20 7369 5f6c 7374 0a20  o_lst + si_lst. 
+00083070: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00083080: 2020 2020 2020 2020 656c 6966 2072 2e74          elif r.t
+00083090: 7970 6520 3d3d 2027 696e 7365 7273 696f  ype == 'insersio
+000830a0: 6e27 3a0a 0a20 2020 2020 2020 2020 2020  n':..           
+000830b0: 206f 7373 702c 2070 7265 765f 6f66 3120   ossp, prev_of1 
+000830c0: 3d20 6f66 2e66 696e 645f 6f73 5f73 6571  = of.find_os_seq
+000830d0: 2872 2e73 7461 7274 2d31 2c20 7072 6576  (r.start-1, prev
+000830e0: 5f6f 6669 2c20 6d61 726b 203d 2027 4927  _ofi, mark = 'I'
+000830f0: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00083100: 6f70 203d 2073 6571 5f6f 7267 5b69 6e74  op = seq_org[int
+00083110: 2872 2e73 7461 7274 2d28 4e57 494e 2b31  (r.start-(NWIN+1
+00083120: 2929 3a69 6e74 2872 2e73 7461 7274 2d31  )):int(r.start-1
+00083130: 295d 0a20 2020 2020 2020 2020 2020 2073  )].            s
+00083140: 6f63 203d 2027 2d27 0a20 2020 2020 2020  oc = '-'.       
+00083150: 2020 2020 2073 6f6e 203d 2073 6571 5f6f       son = seq_o
+00083160: 7267 5b69 6e74 2872 2e73 7461 7274 2d31  rg[int(r.start-1
+00083170: 293a 696e 7428 722e 7374 6172 742b 284e  ):int(r.start+(N
+00083180: 5749 4e2d 3129 295d 0a20 2020 2020 2020  WIN-1))].       
+00083190: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+000831a0: 2020 736e 7020 3d20 7365 715f 6e65 775b    snp = seq_new[
+000831b0: 696e 7428 722e 7374 6172 742b 6f73 7370  int(r.start+ossp
+000831c0: 2d28 4e57 494e 2b31 2929 3a69 6e74 2872  -(NWIN+1)):int(r
+000831d0: 2e73 7461 7274 2b6f 7373 702d 3129 5d0a  .start+ossp-1)].
+000831e0: 2020 2020 2020 2020 2020 2020 736e 6320              snc 
+000831f0: 3d20 722e 7365 710a 2020 2020 2020 2020  = r.seq.        
+00083200: 2020 2020 736e 6e20 3d20 7365 715f 6e65      snn = seq_ne
+00083210: 775b 696e 7428 722e 7374 6172 742b 6f73  w[int(r.start+os
+00083220: 732d 3129 3a69 6e74 2872 2e73 7461 7274  s-1):int(r.start
+00083230: 2b6f 7373 2b28 4e57 494e 2d31 2929 5d0a  +oss+(NWIN-1))].
+00083240: 2020 2020 2020 2020 2020 2020 7369 203d              si =
+00083250: 2053 4e56 5f69 6e66 6f28 6368 726d 2c20   SNV_info(chrm, 
+00083260: 722e 7374 6172 742c 2072 2e73 7461 7274  r.start, r.start
+00083270: 2b6f 7373 2c20 6769 6e5b 305d 2c20 6769  +oss, gin[0], gi
+00083280: 6e5b 315d 2c20 2749 272c 2072 2e67 6574  n[1], 'I', r.get
+00083290: 5f6c 656e 2829 2c20 696e 7428 722e 6176  _len(), int(r.av
+000832a0: 655f 6376 675f 6465 7074 6828 2929 2c20  e_cvg_depth()), 
+000832b0: 722e 6376 675f 6672 6163 2c20 736f 702c  r.cvg_frac, sop,
+000832c0: 2073 6f63 2c20 736f 6e2c 2073 6e70 2c20   soc, son, snp, 
+000832d0: 736e 632c 2073 6e6e 2029 0a20 2020 2020  snc, snn ).     
+000832e0: 2020 2020 2020 2073 6e76 5f69 6e66 6f5f         snv_info_
+000832f0: 6368 722e 6170 7065 6e64 2873 6929 0a20  chr.append(si). 
+00083300: 2020 2020 2020 2020 2020 2067 645f 6964             gd_id
+00083310: 7820 3d20 6764 5f69 6478 5f6f 665f 7267  x = gd_idx_of_rg
+00083320: 6e5b 6b5d 0a20 2020 2020 2020 2020 2020  n[k].           
+00083330: 2067 645f 7365 6c5b 6764 5f69 6478 5d2e   gd_sel[gd_idx].
+00083340: 6e76 5f69 6e66 6f5f 6c73 742e 6170 7065  nv_info_lst.appe
+00083350: 6e64 2873 6929 0a0a 2020 2020 2020 2020  nd(si)..        
+00083360: 2020 2020 722e 7374 6172 7420 2b3d 206f      r.start += o
+00083370: 7373 700a 2020 2020 2020 2020 2020 2020  ssp.            
+00083380: 722e 656e 6420 2b3d 206f 7373 7020 200a  r.end += ossp  .
+00083390: 2020 2020 2020 2020 2020 2020 7261 6c6c              rall
+000833a0: 2e72 676e 735b 6b5d 203d 2072 2023 202e  .rgns[k] = r # .
+000833b0: 636f 7079 2829 0a0a 2020 2020 2020 2020  copy()..        
+000833c0: 656c 6966 2072 2e74 7970 6520 3d3d 2027  elif r.type == '
+000833d0: 6465 6c65 7469 6f6e 273a 0a0a 2020 2020  deletion':..    
+000833e0: 2020 2020 2020 2020 6f73 7370 2c20 7072          ossp, pr
+000833f0: 6576 5f6f 6631 203d 206f 662e 6669 6e64  ev_of1 = of.find
+00083400: 5f6f 735f 7365 7128 722e 7374 6172 742d  _os_seq(r.start-
+00083410: 312c 2070 7265 765f 6f66 692c 206d 6172  1, prev_ofi, mar
+00083420: 6b20 3d20 2744 2729 0a0a 2020 2020 2020  k = 'D')..      
+00083430: 2020 2020 2020 736f 7020 3d20 7365 715f        sop = seq_
+00083440: 6f72 675b 696e 7428 722e 7374 6172 742d  org[int(r.start-
+00083450: 284e 5749 4e2b 3129 293a 696e 7428 722e  (NWIN+1)):int(r.
+00083460: 7374 6172 742d 3129 5d0a 2020 2020 2020  start-1)].      
+00083470: 2020 2020 2020 736f 6320 3d20 7365 715f        soc = seq_
+00083480: 6f72 675b 696e 7428 722e 7374 6172 742d  org[int(r.start-
+00083490: 3129 3a69 6e74 2872 2e65 6e64 295d 0a20  1):int(r.end)]. 
+000834a0: 2020 2020 2020 2020 2020 2073 6f6e 203d             son =
+000834b0: 2073 6571 5f6f 7267 5b69 6e74 2872 2e65   seq_org[int(r.e
+000834c0: 6e64 293a 696e 7428 722e 656e 642b 284e  nd):int(r.end+(N
+000834d0: 5749 4e29 295d 0a20 2020 2020 2020 2020  WIN))].         
+000834e0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+000834f0: 2320 736f 7020 3d20 7261 6c6c 2e72 676e  # sop = rall.rgn
+00083500: 735b 6f64 725b 6d2d 315d 5d2e 7365 715b  s[odr[m-1]].seq[
+00083510: 2d4e 5749 4e3a 5d0a 2020 2020 2020 2020  -NWIN:].        
+00083520: 2020 2020 736e 7020 3d20 7365 715f 6e65      snp = seq_ne
+00083530: 775b 696e 7428 722e 7374 6172 742b 6f73  w[int(r.start+os
+00083540: 7370 2d28 4e57 494e 2b31 2929 3a69 6e74  sp-(NWIN+1)):int
+00083550: 2872 2e73 7461 7274 2b6f 7373 702d 3129  (r.start+ossp-1)
+00083560: 5d0a 2020 2020 2020 2020 2020 2020 736e  ].            sn
+00083570: 6320 3d20 272d 270a 2020 2020 2020 2020  c = '-'.        
+00083580: 2020 2020 2320 736f 6e20 3d20 7261 6c6c      # son = rall
+00083590: 2e72 676e 735b 6f64 725b 6d2b 315d 5d2e  .rgns[odr[m+1]].
+000835a0: 7365 715b 3a4e 5749 4e5d 0a20 2020 2020  seq[:NWIN].     
+000835b0: 2020 2020 2020 2073 6e6e 203d 2073 6571         snn = seq
+000835c0: 5f6e 6577 5b69 6e74 2872 2e73 7461 7274  _new[int(r.start
+000835d0: 2b6f 7373 702d 3129 3a69 6e74 2872 2e73  +ossp-1):int(r.s
+000835e0: 7461 7274 2b6f 7373 702b 284e 5749 4e2d  tart+ossp+(NWIN-
+000835f0: 3129 295d 0a20 2020 2020 2020 2020 2020  1))].           
+00083600: 2073 6920 3d20 534e 565f 696e 666f 2863   si = SNV_info(c
+00083610: 6872 6d2c 2072 2e73 7461 7274 2c20 722e  hrm, r.start, r.
+00083620: 7374 6172 742b 6f73 732c 2067 696e 5b30  start+oss, gin[0
+00083630: 5d2c 2067 696e 5b31 5d2c 2027 4427 2c20  ], gin[1], 'D', 
+00083640: 722e 6765 745f 6c65 6e28 292c 2069 6e74  r.get_len(), int
+00083650: 2872 2e61 7665 5f63 7667 5f64 6570 7468  (r.ave_cvg_depth
+00083660: 2829 292c 2072 2e63 7667 5f66 7261 632c  ()), r.cvg_frac,
+00083670: 2073 6f70 2c20 736f 632c 2073 6f6e 2c20   sop, soc, son, 
+00083680: 736e 702c 2073 6e63 2c20 736e 6e20 290a  snp, snc, snn ).
+00083690: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
+000836a0: 696e 666f 5f63 6872 2e61 7070 656e 6428  info_chr.append(
+000836b0: 7369 290a 2020 2020 2020 2020 2020 2020  si).            
+000836c0: 6764 5f69 6478 203d 2067 645f 6964 785f  gd_idx = gd_idx_
+000836d0: 6f66 5f72 676e 5b6b 5d0a 2020 2020 2020  of_rgn[k].      
+000836e0: 2020 2020 2020 6764 5f73 656c 5b67 645f        gd_sel[gd_
+000836f0: 6964 785d 2e6e 765f 696e 666f 5f6c 7374  idx].nv_info_lst
+00083700: 2e61 7070 656e 6428 7369 290a 0a20 2020  .append(si)..   
+00083710: 2020 2020 2020 2020 2072 2e73 7461 7274           r.start
+00083720: 202b 3d20 6f73 7370 0a20 2020 2020 2020   += ossp.       
+00083730: 2020 2020 2072 2e65 6e64 202b 3d20 6f73       r.end += os
+00083740: 7370 2020 200a 2020 2020 2020 2020 2020  sp   .          
+00083750: 2020 7261 6c6c 2e72 676e 735b 6b5d 203d    rall.rgns[k] =
+00083760: 2072 2023 202e 636f 7079 2829 0a0a 2020   r # .copy()..  
+00083770: 2020 2020 2020 7072 6576 5f6f 6669 203d        prev_ofi =
+00083780: 2070 7265 765f 6f66 310a 0a20 2020 2065   prev_of1..    e
+00083790: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
+000837a0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+000837b0: 745f 7469 6d65 0a20 2020 2023 2070 7269  t_time.    # pri
+000837c0: 6e74 2827 2020 2033 2e20 646f 6e65 2028  nt('   3. done (
+000837d0: 2569 2920 2025 6927 2025 2028 656c 6170  %i)  %i' % (elap
+000837e0: 7365 645f 7469 6d65 2c20 6c65 6e28 6f66  sed_time, len(of
+000837f0: 2e6f 7369 5f6c 7374 2929 2c20 666c 7573  .osi_lst)), flus
+00083800: 6820 3d20 5472 7565 290a 2020 2020 0a20  h = True).    . 
+00083810: 2020 206e 765f 6c73 7420 3d20 5b5d 0a20     nv_lst = []. 
+00083820: 2020 2066 6f72 2067 6420 696e 2067 645f     for gd in gd_
+00083830: 7365 6c3a 0a20 2020 2020 2020 2066 6f72  sel:.        for
+00083840: 2074 6420 696e 2067 642e 7464 5f6c 7374   td in gd.td_lst
+00083850: 3a0a 2020 2020 2020 2020 2020 2020 7464  :.            td
+00083860: 2e67 6574 5f6f 7267 5f63 6f64 696e 675f  .get_org_coding_
+00083870: 7365 7128 2067 642e 6364 732e 7267 6e73  seq( gd.cds.rgns
+00083880: 2c20 7365 715f 6f72 6720 290a 2020 2020  , seq_org ).    
+00083890: 2020 2020 6e76 5f6c 7374 203d 206e 765f      nv_lst = nv_
+000838a0: 6c73 7420 2b20 6764 2e67 6574 5f67 656e  lst + gd.get_gen
+000838b0: 655f 6c65 7665 6c5f 6e76 5f69 6e66 6f28  e_level_nv_info(
+000838c0: 290a 2020 2020 736e 765f 696e 666f 5f63  ).    snv_info_c
+000838d0: 6872 203d 206e 765f 6c73 740a 2020 2020  hr = nv_lst.    
+000838e0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000838f0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00083900: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
+00083910: 2323 2070 7574 2072 676e 7320 6261 636b  ## put rgns back
+00083920: 2074 6f20 6764 5f73 656c 0a20 2020 2023   to gd_sel.    #
+00083930: 2320 616e 6420 616c 736f 2061 6464 206e  # and also add n
+00083940: 6577 2072 676e 7320 0a0a 2020 2020 7374  ew rgns ..    st
+00083950: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
+00083960: 7469 6d65 2829 0a20 2020 2070 6f73 5f74  time().    pos_t
+00083970: 6f5f 6164 6420 3d20 6e70 2e61 7272 6179  o_add = np.array
+00083980: 2870 6f73 5f74 6f5f 6164 6429 0a20 2020  (pos_to_add).   
+00083990: 2066 6f72 206b 2c20 6764 2069 6e20 656e   for k, gd in en
+000839a0: 756d 6572 6174 6528 6764 5f73 656c 293a  umerate(gd_sel):
+000839b0: 200a 0a20 2020 2020 2020 2070 3120 3d20   ..        p1 = 
+000839c0: 696e 7428 6c6f 635f 6f73 5b6b 5d29 0a20  int(loc_os[k]). 
+000839d0: 2020 2020 2020 2070 3220 3d20 696e 7428         p2 = int(
+000839e0: 7031 202b 206e 756d 5f6f 735b 6b5d 290a  p1 + num_os[k]).
+000839f0: 2020 2020 2020 2020 2320 6764 2e65 786f          # gd.exo
+00083a00: 6e73 2e72 676e 7320 3d20 7261 6c6c 2e72  ns.rgns = rall.r
+00083a10: 676e 735b 7031 3a70 325d 0a20 2020 2020  gns[p1:p2].     
+00083a20: 2020 2067 642e 6578 6f6e 732e 7267 6e73     gd.exons.rgns
+00083a30: 203d 205b 7261 6c6c 2e72 676e 735b 7031   = [rall.rgns[p1
+00083a40: 2b6d 5d20 666f 7220 6d20 696e 2072 616e  +m] for m in ran
+00083a50: 6765 2870 322d 7031 295d 0a20 2020 2020  ge(p2-p1)].     
+00083a60: 2020 2077 6820 3d20 7768 6963 6828 2028     wh = which( (
+00083a70: 706f 735f 746f 5f61 6464 203e 3d20 7031  pos_to_add >= p1
+00083a80: 2920 2620 2870 6f73 5f74 6f5f 6164 6420  ) & (pos_to_add 
+00083a90: 3c20 7032 2920 290a 2020 2020 2020 2020  < p2) ).        
+00083aa0: 6966 206c 656e 2877 6829 203e 2030 3a0a  if len(wh) > 0:.
+00083ab0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00083ac0: 7720 696e 2077 683a 2067 642e 6578 6f6e  w in wh: gd.exon
+00083ad0: 732e 7267 6e73 2e61 7070 656e 6428 725f  s.rgns.append(r_
+00083ae0: 746f 5f61 6464 5b77 5d29 0a0a 2020 2020  to_add[w])..    
+00083af0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083b00: 2323 2323 2323 230a 2020 2020 2323 2072  #######.    ## r
+00083b10: 656d 6f76 6520 6964 656c 6574 696f 6e20  emove ideletion 
+00083b20: 0a20 2020 2023 2320 636f 6d62 696e 6520  .    ## combine 
+00083b30: 7469 6c65 6420 6578 6f6e 730a 2020 2020  tiled exons.    
+00083b40: 0a20 2020 2066 6f72 2067 6420 696e 2067  .    for gd in g
+00083b50: 645f 7365 6c3a 0a20 2020 2020 2020 2067  d_sel:.        g
+00083b60: 642e 7265 6d6f 7665 5f69 6e64 656c 5f61  d.remove_indel_a
+00083b70: 6e64 5f63 6f6d 6269 6e65 5f66 7261 6773  nd_combine_frags
+00083b80: 2829 0a0a 2020 2020 2327 2727 0a20 2020  ()..    #'''.   
+00083b90: 2065 6c61 7073 6564 5f74 696d 6520 3d20   elapsed_time = 
+00083ba0: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+00083bb0: 6172 745f 7469 6d65 0a20 2020 2023 2070  art_time.    # p
+00083bc0: 7269 6e74 2827 2020 2033 622e 2064 6f6e  rint('   3b. don
+00083bd0: 6520 2825 6929 2020 2720 2520 2865 6c61  e (%i)  ' % (ela
+00083be0: 7073 6564 5f74 696d 6529 2c20 666c 7573  psed_time), flus
+00083bf0: 6820 3d20 5472 7565 290a 2020 2020 0a0a  h = True).    ..
+00083c00: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+00083c10: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00083c20: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00083c30: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+00083c40: 2063 6f64 696e 6720 7265 6769 6f6e 2075   coding region u
+00083c50: 7064 6174 650a 0a20 2020 2073 7461 7274  pdate..    start
+00083c60: 5f74 696d 6520 3d20 7469 6d65 2e74 696d  _time = time.tim
+00083c70: 6528 290a 2020 2020 0a20 2020 2023 2320  e().    .    ## 
+00083c80: 636f 6c6c 6563 7420 7267 6e73 2061 6e64  collect rgns and
+00083c90: 206d 6172 6b20 7468 6569 7220 706f 730a   mark their pos.
+00083ca0: 2020 2020 6c6f 635f 6f73 203d 206e 702e      loc_os = np.
+00083cb0: 7a65 726f 7328 6e5f 6764 290a 2020 2020  zeros(n_gd).    
+00083cc0: 6e75 6d5f 6f73 203d 206e 702e 7a65 726f  num_os = np.zero
+00083cd0: 7328 6e5f 6764 2c64 7479 7065 3d6e 702e  s(n_gd,dtype=np.
+00083ce0: 666c 6f61 7433 3229 0a20 2020 2063 616c  float32).    cal
+00083cf0: 6c20 3d20 7265 6769 6f6e 7328 290a 2020  l = regions().  
+00083d00: 2020 6f73 5f63 7572 203d 2030 0a20 2020    os_cur = 0.   
+00083d10: 2063 5f70 6f73 203d 205b 5d0a 2020 2020   c_pos = [].    
+00083d20: 666f 7220 6b2c 2067 6420 696e 2065 6e75  for k, gd in enu
+00083d30: 6d65 7261 7465 2867 645f 7365 6c29 3a0a  merate(gd_sel):.
+00083d40: 2020 2020 2020 2020 6c6f 635f 6f73 5b6b          loc_os[k
+00083d50: 5d20 3d20 6f73 5f63 7572 0a20 2020 2020  ] = os_cur.     
+00083d60: 2020 206e 756d 5f6f 735b 6b5d 203d 206c     num_os[k] = l
+00083d70: 656e 2867 642e 6364 732e 7267 6e73 290a  en(gd.cds.rgns).
+00083d80: 2020 2020 2020 2020 6361 6c6c 2e72 676e          call.rgn
+00083d90: 7320 3d20 6361 6c6c 2e72 676e 7320 2b20  s = call.rgns + 
+00083da0: 6764 2e63 6473 2e72 676e 730a 2020 2020  gd.cds.rgns.    
+00083db0: 2020 2020 6f73 5f63 7572 202b 3d20 6c65      os_cur += le
+00083dc0: 6e28 6764 2e63 6473 2e72 676e 7329 0a0a  n(gd.cds.rgns)..
+00083dd0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+00083de0: 2067 642e 6364 732e 7267 6e73 3a0a 2020   gd.cds.rgns:.  
+00083df0: 2020 2020 2020 2020 2020 635f 706f 732e            c_pos.
+00083e00: 6170 7065 6e64 2872 2e73 7461 7274 290a  append(r.start).
+00083e10: 0a20 2020 2023 2320 6765 7420 6f72 6465  .    ## get orde
+00083e20: 7220 6163 636f 7264 696e 6720 746f 206c  r according to l
+00083e30: 6f63 6174 696f 6e0a 2020 2020 635f 706f  ocation.    c_po
+00083e40: 7320 3d20 6e70 2e61 7272 6179 2863 5f70  s = np.array(c_p
+00083e50: 6f73 290a 2020 2020 6f64 7220 3d20 635f  os).    odr = c_
+00083e60: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
+00083e70: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00083e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00083ea0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
+00083eb0: 2323 2055 7365 206f 6666 7365 745f 6669  ## Use offset_fi
+00083ec0: 6e64 6572 2074 6f20 636f 7272 6563 7420  nder to correct 
+00083ed0: 706f 7369 7469 6f6e 7320 696e 2047 5446  positions in GTF
+00083ee0: 2065 6e74 7269 6573 0a20 2020 2023 2320   entries.    ## 
+00083ef0: 616c 736f 2067 6574 2072 676e 7320 6672  also get rgns fr
+00083f00: 6167 6d65 6e74 7320 7768 656e 2073 706c  agments when spl
+00083f10: 6974 2069 7320 7265 7175 6972 6564 0a0a  it is required..
+00083f20: 2020 2020 635f 746f 5f61 6464 203d 205b      c_to_add = [
+00083f30: 5d0a 2020 2020 706f 735f 746f 5f61 6464  ].    pos_to_add
+00083f40: 203d 205b 5d0a 0a20 2020 2070 7265 765f   = []..    prev_
+00083f50: 6f66 6920 3d20 300a 2020 2020 2320 666f  ofi = 0.    # fo
+00083f60: 7220 6b2c 2072 2069 6e20 656e 756d 6572  r k, r in enumer
+00083f70: 6174 6528 6361 6c6c 2e72 676e 7329 3a0a  ate(call.rgns):.
+00083f80: 2020 2020 666f 7220 6d2c 206b 2069 6e20      for m, k in 
+00083f90: 656e 756d 6572 6174 6528 6f64 7229 3a0a  enumerate(odr):.
+00083fa0: 2020 2020 2020 2020 7220 3d20 6361 6c6c          r = call
+00083fb0: 2e72 676e 735b 6b5d 0a20 2020 2020 2020  .rgns[k].       
+00083fc0: 200a 2020 2020 2020 2020 2320 6f73 7320   .        # oss 
+00083fd0: 3d20 6f66 2e66 696e 645f 6f73 2872 2e73  = of.find_os(r.s
+00083fe0: 7461 7274 290a 2020 2020 2020 2020 2320  tart).        # 
+00083ff0: 6f73 6520 3d20 6f66 2e66 696e 645f 6f73  ose = of.find_os
+00084000: 2872 2e65 6e64 290a 2020 2020 2020 2020  (r.end).        
+00084010: 6f73 732c 2070 7265 765f 6f66 3120 3d20  oss, prev_of1 = 
+00084020: 6f66 2e66 696e 645f 6f73 5f73 6571 2872  of.find_os_seq(r
+00084030: 2e73 7461 7274 2c20 7072 6576 5f6f 6669  .start, prev_ofi
+00084040: 2c20 6d61 726b 203d 2027 4227 290a 2020  , mark = 'B').  
+00084050: 2020 2020 2020 6f73 652c 2070 7265 765f        ose, prev_
+00084060: 6f66 3220 3d20 6f66 2e66 696e 645f 6f73  of2 = of.find_os
+00084070: 5f73 6571 2872 2e65 6e64 2c20 7072 6576  _seq(r.end, prev
+00084080: 5f6f 6669 2c20 6d61 726b 203d 2027 4327  _ofi, mark = 'C'
+00084090: 290a 2020 2020 2020 2020 7072 6576 5f6f  ).        prev_o
+000840a0: 6669 203d 2070 7265 765f 6f66 310a 0a20  fi = prev_of1.. 
+000840b0: 2020 2020 2020 2069 6620 2872 2e74 7970         if (r.typ
+000840c0: 652e 6c6f 7765 7228 2920 3d3d 2027 7374  e.lower() == 'st
+000840d0: 6172 745f 636f 646f 6e27 2920 7c20 2872  art_codon') | (r
+000840e0: 2e74 7970 652e 6c6f 7765 7228 2920 3d3d  .type.lower() ==
+000840f0: 2027 7374 6f70 5f63 6f64 6f6e 2729 3a0a   'stop_codon'):.
+00084100: 2020 2020 2020 2020 2020 2020 722e 7374              r.st
+00084110: 6172 7420 2b3d 206f 7373 0a20 2020 2020  art += oss.     
+00084120: 2020 2020 2020 2072 2e65 6e64 202b 3d20         r.end += 
+00084130: 6f73 7320 2020 0a20 2020 2020 2020 2020  oss   .         
+00084140: 2020 2063 616c 6c2e 7267 6e73 5b6b 5d20     call.rgns[k] 
+00084150: 3d20 722e 636f 7079 2875 7064 6174 653d  = r.copy(update=
+00084160: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+00084170: 656c 7365 3a20 2023 2043 4453 2c20 6669  else:  # CDS, fi
+00084180: 7665 5f70 7269 6d65 5f75 7472 2c20 7468  ve_prime_utr, th
+00084190: 7265 655f 7072 696d 655f 7574 722c 202e  ree_prime_utr, .
+000841a0: 2e2e 0a20 2020 2020 2020 2020 2020 2069  ...            i
+000841b0: 6620 286f 7373 203d 3d20 6f73 6529 3a0a  f (oss == ose):.
+000841c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000841d0: 722e 7374 6172 7420 2b3d 206f 7373 0a20  r.start += oss. 
+000841e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000841f0: 2e65 6e64 202b 3d20 6f73 650a 2020 2020  .end += ose.    
+00084200: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+00084210: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
+00084220: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
+00084230: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00084240: 6620 286f 7373 203c 206f 7365 293a 2023  f (oss < ose): #
+00084250: 2049 6e73 6572 7369 6f6e 206f 7220 6465   Insersion or de
+00084260: 6c65 7469 6f6e 2069 6e20 6265 7477 6565  letion in betwee
+00084270: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+00084280: 2020 2023 2070 7269 6e74 2827 2020 2025     # print('   %
+00084290: 6920 6f73 7320 3c20 6f73 6527 2025 206b  i oss < ose' % k
+000842a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000842b0: 2020 702c 2070 7265 765f 6f66 3220 3d20    p, prev_of2 = 
+000842c0: 6f66 2e67 6574 5f62 6e64 7279 5f73 6571  of.get_bndry_seq
+000842d0: 2872 2e65 6e64 2c20 7072 6576 5f6f 6669  (r.end, prev_ofi
+000842e0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000842f0: 2020 2023 2320 7370 6c69 740a 2020 2020     ## split.    
+00084300: 2020 2020 2020 2020 2020 2020 7267 6e5f              rgn_
+00084310: 6e65 7720 3d20 7265 6769 6f6e 2820 722e  new = region( r.
+00084320: 6368 722c 2070 2b6f 7365 2c20 722e 656e  chr, p+ose, r.en
+00084330: 642b 6f73 652c 2072 2e74 7970 652c 2078  d+ose, r.type, x
+00084340: 7320 3d20 722e 7873 290a 2020 2020 2020  s = r.xs).      
+00084350: 2020 2020 2020 2020 2020 635f 746f 5f61            c_to_a
+00084360: 6464 2e61 7070 656e 6428 7267 6e5f 6e65  dd.append(rgn_ne
+00084370: 7729 0a20 2020 2020 2020 2020 2020 2020  w).             
+00084380: 2020 2070 6f73 5f74 6f5f 6164 642e 6170     pos_to_add.ap
+00084390: 7065 6e64 286b 2b31 290a 0a20 2020 2020  pend(k+1)..     
+000843a0: 2020 2020 2020 2020 2020 2072 2e65 6e64             r.end
+000843b0: 203d 2070 2d31 2b6f 7373 0a20 2020 2020   = p-1+oss.     
+000843c0: 2020 2020 2020 2020 2020 2072 2e73 7461             r.sta
+000843d0: 7274 202b 3d20 6f73 730a 2020 2020 2020  rt += oss.      
+000843e0: 2020 2020 2020 2020 2020 6361 6c6c 2e72            call.r
+000843f0: 676e 735b 6b5d 203d 2072 2e63 6f70 7928  gns[k] = r.copy(
+00084400: 7570 6461 7465 3d46 616c 7365 290a 0a20  update=False).. 
+00084410: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00084420: 286f 7373 203e 206f 7365 293a 2023 2064  (oss > ose): # d
+00084430: 656c 6574 696f 6e20 696e 2062 6574 7765  eletion in betwe
+00084440: 656e 0a0a 2020 2020 2020 2020 2020 2020  en..            
+00084450: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
+00084460: 2569 206f 7373 203e 206f 7365 2720 2520  %i oss > ose' % 
+00084470: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+00084480: 2020 2070 2c20 7072 6576 5f6f 6632 203d     p, prev_of2 =
+00084490: 206f 662e 6765 745f 626e 6472 795f 7365   of.get_bndry_se
+000844a0: 7128 722e 656e 642c 2070 7265 765f 6f66  q(r.end, prev_of
+000844b0: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
+000844c0: 2020 204c 6420 3d20 6f73 7320 2d20 6f73     Ld = oss - os
+000844d0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+000844e0: 2020 2023 2320 7370 6c69 7420 2866 6f72     ## split (for
+000844f0: 2043 4453 206f 6e6c 7929 0a20 2020 2020   CDS only).     
+00084500: 2020 2020 2020 2020 2020 2072 676e 5f6e             rgn_n
+00084510: 6577 203d 2072 6567 696f 6e28 2072 2e63  ew = region( r.c
+00084520: 6872 2c20 702b 4c64 2b6f 7365 2c20 722e  hr, p+Ld+ose, r.
+00084530: 656e 642b 6f73 652c 2072 2e74 7970 652c  end+ose, r.type,
+00084540: 2078 7320 3d20 722e 7873 290a 2020 2020   xs = r.xs).    
+00084550: 2020 2020 2020 2020 2020 2020 635f 746f              c_to
+00084560: 5f61 6464 2e61 7070 656e 6428 7267 6e5f  _add.append(rgn_
+00084570: 6e65 7729 0a20 2020 2020 2020 2020 2020  new).           
+00084580: 2020 2020 2070 6f73 5f74 6f5f 6164 642e       pos_to_add.
+00084590: 6170 7065 6e64 286b 2b31 290a 0a20 2020  append(k+1)..   
+000845a0: 2020 2020 2020 2020 2020 2020 2072 2e65               r.e
+000845b0: 6e64 203d 2070 2d31 2b6f 7373 0a20 2020  nd = p-1+oss.   
+000845c0: 2020 2020 2020 2020 2020 2020 2072 2e73               r.s
+000845d0: 7461 7274 202b 3d20 6f73 730a 2020 2020  tart += oss.    
+000845e0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+000845f0: 2e72 676e 735b 6b5d 203d 2072 2e63 6f70  .rgns[k] = r.cop
+00084600: 7928 7570 6461 7465 3d46 616c 7365 290a  y(update=False).
+00084610: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
+00084620: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00084630: 2020 2020 2323 2070 7574 2072 676e 7320      ## put rgns 
+00084640: 6261 636b 2074 6f20 6764 5f73 656c 0a20  back to gd_sel. 
+00084650: 2020 2023 2320 616e 6420 616c 736f 2061     ## and also a
+00084660: 6464 206e 6577 2072 676e 7320 0a0a 2020  dd new rgns ..  
+00084670: 2020 706f 735f 746f 5f61 6464 203d 206e    pos_to_add = n
+00084680: 702e 6172 7261 7928 706f 735f 746f 5f61  p.array(pos_to_a
+00084690: 6464 290a 2020 2020 666f 7220 6b2c 2067  dd).    for k, g
+000846a0: 6420 696e 2065 6e75 6d65 7261 7465 2867  d in enumerate(g
+000846b0: 645f 7365 6c29 3a20 0a0a 2020 2020 2020  d_sel): ..      
+000846c0: 2020 7031 203d 2069 6e74 286c 6f63 5f6f    p1 = int(loc_o
+000846d0: 735b 6b5d 290a 2020 2020 2020 2020 7032  s[k]).        p2
+000846e0: 203d 2069 6e74 2870 3120 2b20 6e75 6d5f   = int(p1 + num_
+000846f0: 6f73 5b6b 5d29 0a20 2020 2020 2020 2067  os[k]).        g
+00084700: 642e 6364 732e 7267 6e73 203d 205b 6361  d.cds.rgns = [ca
+00084710: 6c6c 2e72 676e 735b 7031 2b6d 5d20 666f  ll.rgns[p1+m] fo
+00084720: 7220 6d20 696e 2072 616e 6765 2870 322d  r m in range(p2-
+00084730: 7031 295d 0a20 2020 2020 2020 2077 6820  p1)].        wh 
+00084740: 3d20 7768 6963 6828 2028 706f 735f 746f  = which( (pos_to
+00084750: 5f61 6464 203e 3d20 7031 2920 2620 2870  _add >= p1) & (p
+00084760: 6f73 5f74 6f5f 6164 6420 3c20 7032 2920  os_to_add < p2) 
+00084770: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+00084780: 2877 6829 203e 2030 3a0a 2020 2020 2020  (wh) > 0:.      
+00084790: 2020 2020 2020 666f 7220 7720 696e 2077        for w in w
+000847a0: 683a 2067 642e 6364 732e 7267 6e73 2e61  h: gd.cds.rgns.a
+000847b0: 7070 656e 6428 635f 746f 5f61 6464 5b77  ppend(c_to_add[w
+000847c0: 5d29 0a0a 2020 2020 656c 6170 7365 645f  ])..    elapsed_
+000847d0: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+000847e0: 2829 202d 2073 7461 7274 5f74 696d 650a  () - start_time.
+000847f0: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
+00084800: 342e 2064 6f6e 6520 2825 6929 2020 2720  4. done (%i)  ' 
+00084810: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
+00084820: 2c20 666c 7573 6820 3d20 5472 7565 290a  , flush = True).
+00084830: 2020 2020 0a20 2020 2023 2323 2323 2323      .    #######
 00084840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00084850: 0a20 2020 2023 2320 496e 7465 6772 6974  .    ## Integrit
-00084860: 7920 6368 6563 6b0a 2020 2020 0a20 2020  y check.    .   
-00084870: 2073 7461 7274 5f74 696d 6520 3d20 7469   start_time = ti
-00084880: 6d65 2e74 696d 6528 290a 2020 2020 6e5f  me.time().    n_
-00084890: 6261 7365 735f 746f 7461 6c20 3d20 300a  bases_total = 0.
-000848a0: 2020 2020 6e5f 6572 5f62 6173 6573 203d      n_er_bases =
-000848b0: 2030 0a20 2020 206e 5f62 6c6b 5f74 6f74   0.    n_blk_tot
-000848c0: 616c 203d 2030 0a20 2020 206e 5f65 725f  al = 0.    n_er_
-000848d0: 626c 6b20 3d20 300a 2020 2020 6e70 6520  blk = 0.    npe 
-000848e0: 3d20 300a 2020 2020 6e70 7420 3d20 300a  = 0.    npt = 0.
-000848f0: 2020 2020 666f 7220 6764 2069 6e20 6764      for gd in gd
-00084900: 5f73 656c 3a0a 2020 2020 2020 2020 666f  _sel:.        fo
-00084910: 7220 7220 696e 2067 642e 6578 6f6e 732e  r r in gd.exons.
-00084920: 7267 6e73 3a0a 2020 2020 2020 2020 2020  rgns:.          
-00084930: 2020 6966 2072 2e74 7970 6520 213d 2027    if r.type != '
-00084940: 6465 6c65 7469 6f6e 273a 0a20 2020 2020  deletion':.     
-00084950: 2020 2020 2020 2020 2020 2073 3120 3d20             s1 = 
-00084960: 722e 7365 710a 2020 2020 2020 2020 2020  r.seq.          
-00084970: 2020 2020 2020 7332 203d 2073 6571 5f6e        s2 = seq_n
-00084980: 6577 5b28 722e 7374 6172 742d 3129 3a72  ew[(r.start-1):r
-00084990: 2e65 6e64 5d20 2320 6765 6e6f 6d65 5b72  .end] # genome[r
-000849a0: 2e63 6872 5d2e 7365 715b 2872 2e73 7461  .chr].seq[(r.sta
-000849b0: 7274 2d31 293a 722e 656e 645d 0a20 2020  rt-1):r.end].   
-000849c0: 2020 2020 2020 2020 2020 2020 206e 5f65               n_e
-000849d0: 7220 3d20 636f 6d70 6172 655f 7365 7132  r = compare_seq2
-000849e0: 2820 7331 2c20 7332 2029 0a20 2020 2020  ( s1, s2 ).     
-000849f0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00084a00: 6e5f 6572 203e 2030 3a20 7072 696e 7428  n_er > 0: print(
-00084a10: 275c 6e53 313a 2025 735c 6e53 323a 2025  '\nS1: %s\nS2: %
-00084a20: 7327 2025 2028 7331 2c73 3229 290a 2020  s' % (s1,s2)).  
-00084a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084a40: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-00084a50: 2020 206e 5f62 6173 6573 5f74 6f74 616c     n_bases_total
-00084a60: 202b 3d20 6c65 6e28 7331 290a 2020 2020   += len(s1).    
-00084a70: 2020 2020 2020 2020 2020 2020 6e5f 6572              n_er
-00084a80: 5f62 6173 6573 202b 3d20 6e5f 6572 0a20  _bases += n_er. 
-00084a90: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00084aa0: 5f62 6c6b 5f74 6f74 616c 202b 3d20 310a  _blk_total += 1.
-00084ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084ac0: 6966 206e 5f65 7220 3e20 303a 206e 5f65  if n_er > 0: n_e
-00084ad0: 725f 626c 6b20 2b3d 2031 0a20 2020 2020  r_blk += 1.     
-00084ae0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00084af0: 2020 2020 2020 2020 6e74 722c 206e 7072          ntr, npr
-00084b00: 2c20 6e65 7220 3d20 6764 2e75 7064 6174  , ner = gd.updat
-00084b10: 655f 7464 5f69 6e66 6f28 7365 6c20 3d20  e_td_info(sel = 
-00084b20: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
-00084b30: 6529 0a20 2020 2020 2020 206e 652c 206e  e).        ne, n
-00084b40: 7420 3d20 6764 2e63 6f6d 7061 7265 5f73  t = gd.compare_s
-00084b50: 6571 735f 6672 6f6d 5f63 6473 5f61 6e64  eqs_from_cds_and
-00084b60: 5f67 656e 6f6d 6528 7365 715f 6e65 7729  _genome(seq_new)
-00084b70: 2023 2067 656e 6f6d 655b 6764 2e63 6872   # genome[gd.chr
-00084b80: 5d2e 7365 7129 0a20 2020 2020 2020 206e  ].seq).        n
-00084b90: 7065 202b 3d20 6e65 0a20 2020 2020 2020  pe += ne.       
-00084ba0: 206e 7074 202b 3d20 6e74 0a0a 2020 2020   npt += nt..    
-00084bb0: 2020 2020 2320 6966 206e 6572 203e 2030      # if ner > 0
-00084bc0: 3a20 7072 696e 7428 2749 6e74 6567 7269  : print('Integri
-00084bd0: 7479 2063 6865 636b 2065 7272 6f72 2041  ty check error A
-00084be0: 2069 6e20 2573 3a20 2569 202d 2025 692f   in %s: %i - %i/
-00084bf0: 2569 2c20 2569 2f25 692c 2025 692f 2569  %i, %i/%i, %i/%i
-00084c00: 2720 2520 2863 6872 6d2c 206e 6572 2c20  ' % (chrm, ner, 
-00084c10: 6e5f 6572 5f62 6173 6573 2c20 6e5f 6261  n_er_bases, n_ba
-00084c20: 7365 735f 746f 7461 6c2c 206e 5f65 725f  ses_total, n_er_
-00084c30: 626c 6b2c 206e 5f62 6c6b 5f74 6f74 616c  blk, n_blk_total
-00084c40: 2c20 6e70 652c 206e 7074 2920 290a 2020  , npe, npt) ).  
-00084c50: 2020 2020 2020 2320 6966 206e 5f65 7220        # if n_er 
-00084c60: 3e20 303a 2070 7269 6e74 2827 496e 7465  > 0: print('Inte
-00084c70: 6772 6974 7920 6368 6563 6b20 6572 726f  grity check erro
-00084c80: 7220 696e 2025 733a 2025 6920 2d20 2569  r in %s: %i - %i
-00084c90: 2f25 692c 2025 692f 2569 2c20 2569 2f25  /%i, %i/%i, %i/%
-00084ca0: 6927 2025 2028 6368 726d 2c20 6e5f 6572  i' % (chrm, n_er
-00084cb0: 2c20 6e5f 6572 5f62 6173 6573 2c20 6e5f  , n_er_bases, n_
-00084cc0: 6261 7365 735f 746f 7461 6c2c 206e 5f65  bases_total, n_e
-00084cd0: 725f 626c 6b2c 206e 5f62 6c6b 5f74 6f74  r_blk, n_blk_tot
-00084ce0: 616c 2c20 6e70 652c 206e 7074 2920 290a  al, npe, npt) ).
-00084cf0: 0a20 2020 2065 6c61 7073 6564 5f74 696d  .    elapsed_tim
-00084d00: 6520 3d20 7469 6d65 2e74 696d 6528 2920  e = time.time() 
-00084d10: 2d20 7374 6172 745f 7469 6d65 0a20 2020  - start_time.   
-00084d20: 2023 2070 7269 6e74 2827 2020 2035 2e20   # print('   5. 
-00084d30: 646f 6e65 2028 2569 2920 2027 2025 2028  done (%i)  ' % (
-00084d40: 656c 6170 7365 645f 7469 6d65 292c 2066  elapsed_time), f
-00084d50: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
-00084d60: 200a 2020 2020 6573 7461 7420 3d20 286e   .    estat = (n
-00084d70: 5f62 6173 6573 5f74 6f74 616c 2c20 6e5f  _bases_total, n_
-00084d80: 6572 5f62 6173 6573 2c20 6e5f 626c 6b5f  er_bases, n_blk_
-00084d90: 746f 7461 6c2c 206e 5f65 725f 626c 6b2c  total, n_er_blk,
-00084da0: 206e 7074 2c20 6e70 6529 0a20 2020 200a   npt, npe).    .
-00084db0: 2020 2020 7265 7475 726e 2067 645f 7365      return gd_se
-00084dc0: 6c2c 2073 6571 5f6e 6577 2c20 736e 765f  l, seq_new, snv_
-00084dd0: 696e 666f 5f63 6872 2c20 6f66 2c20 6368  info_chr, of, ch
-00084de0: 726d 2c20 6573 7461 740a 0a27 2727 0a4e  rm, estat..'''.N
-00084df0: 565f 696e 666f 5f65 7874 5f74 7220 3d20  V_info_ext_tr = 
-00084e00: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
-00084e10: 6474 7570 6c65 2827 4e56 5f69 6e66 6f5f  dtuple('NV_info_
-00084e20: 6578 745f 7472 272c 2027 6368 722c 2070  ext_tr', 'chr, p
-00084e30: 6f73 5f72 6566 2c20 706f 735f 6e65 772c  os_ref, pos_new,
-00084e40: 2067 656e 655f 6964 2c20 6765 6e65 5f6e   gene_id, gene_n
-00084e50: 616d 652c 2076 5f74 7970 652c 2076 5f6c  ame, v_type, v_l
-00084e60: 656e 2c20 6376 675f 6465 7074 682c 2063  en, cvg_depth, c
-00084e70: 7667 5f66 7261 632c 205c 0a20 2020 2020  vg_frac, \.     
-00084e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084e90: 2020 2020 2020 2020 2020 2020 2072 6566               ref
-00084ea0: 5f70 7265 762c 2072 6566 5f73 6571 2c20  _prev, ref_seq, 
-00084eb0: 7265 665f 6e65 7874 2c20 616c 745f 7072  ref_next, alt_pr
-00084ec0: 6576 2c20 616c 745f 7365 712c 2061 6c74  ev, alt_seq, alt
-00084ed0: 5f6e 6578 742c 2076 5f63 6c61 7373 2c20  _next, v_class, 
-00084ee0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00084ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084f00: 2020 2020 765f 636c 6173 735f 7472 2c20      v_class_tr, 
-00084f10: 7374 7261 6e64 2c20 6344 4e41 5f63 6861  strand, cDNA_cha
-00084f20: 6e67 652c 2043 6f64 6f6e 5f63 6861 6e67  nge, Codon_chang
-00084f30: 652c 2050 726f 7465 696e 5f63 6861 6e67  e, Protein_chang
-00084f40: 652c 2050 726f 7465 696e 5f63 6861 6e67  e, Protein_chang
-00084f50: 6532 2c20 4368 6563 6b27 2920 2023 206f  e2, Check')  # o
-00084f60: 6e65 2d62 6173 650a 0a64 6566 2077 7269  ne-base..def wri
-00084f70: 7465 5f74 6f5f 7663 6628 2073 6e76 5f69  te_to_vcf( snv_i
-00084f80: 6e66 6f5f 6c73 742c 2066 696c 655f 6e61  nfo_lst, file_na
-00084f90: 6d65 2029 3a0a 0a20 2020 2069 6620 6c65  me ):..    if le
-00084fa0: 6e28 736e 765f 696e 666f 5f6c 7374 2920  n(snv_info_lst) 
-00084fb0: 3d3d 2030 3a0a 2020 2020 2020 2020 7265  == 0:.        re
-00084fc0: 7475 726e 0a20 2020 200a 2020 2020 6966  turn.    .    if
-00084fd0: 206c 656e 2873 6e76 5f69 6e66 6f5f 6c73   len(snv_info_ls
-00084fe0: 745b 305d 2920 3c3d 2032 303a 0a20 2020  t[0]) <= 20:.   
-00084ff0: 2020 2020 2070 6173 730a 2020 2020 656c       pass.    el
-00085000: 7365 3a0a 2020 2020 2020 2020 6620 3d20  se:.        f = 
-00085010: 6f70 656e 2820 666e 616d 655f 7663 662c  open( fname_vcf,
-00085020: 2027 7774 2b27 2029 0a0a 2020 2020 2020   'wt+' )..      
-00085030: 2020 6c69 6e65 7320 3d20 5b27 2343 4852    lines = ['#CHR
-00085040: 4f4d 5c74 504f 535c 7449 445c 7452 4546  OM\tPOS\tID\tREF
-00085050: 5c74 414c 545c 7451 5541 4c5c 7446 494c  \tALT\tQUAL\tFIL
-00085060: 5445 525c 7449 4e46 4f27 5d0a 2020 2020  TER\tINFO'].    
-00085070: 2020 2020 666f 7220 6e69 2069 6e20 736e      for ni in sn
-00085080: 765f 696e 666f 5f6c 7374 3a0a 2020 2020  v_info_lst:.    
-00085090: 2020 2020 2020 2020 6d69 6420 3d0a 2020          mid =.  
-000850a0: 2020 2020 2020 2020 2020 5175 616c 203d            Qual =
-000850b0: 0a20 2020 2020 2020 2020 2020 2046 696c  .            Fil
-000850c0: 7465 7220 3d0a 2020 2020 2020 2020 2020  ter =.          
-000850d0: 2020 696e 666f 203d 2027 4143 3d25 693b    info = 'AC=%i;
-000850e0: 4146 270a 2020 2020 2020 2020 2020 2020  AF'.            
-000850f0: 2725 735c 7425 695c 7425 735c 7425 735c  '%s\t%i\t%s\t%s\
-00085100: 7425 735c 7425 695c 7425 735c 7425 735c  t%s\t%i\t%s\t%s\
-00085110: 6e27 2025 2028 6e69 2e63 6872 2c20 6e69  n' % (ni.chr, ni
-00085120: 2e70 6f73 5f72 6566 2c20 6d69 642c 206e  .pos_ref, mid, n
-00085130: 692e 7265 665f 7365 712c 206e 692e 616c  i.ref_seq, ni.al
-00085140: 745f 7365 712c 2051 7561 6c2c 2069 6e66  t_seq, Qual, inf
-00085150: 6f29 0a0a 2020 2020 2020 2020 662e 636c  o)..        f.cl
-00085160: 6f73 6528 290a 2020 2020 2020 2020 0a20  ose().        . 
-00085170: 2020 2072 6574 7572 6e0a 2727 270a 0a64     return.'''..d
-00085180: 6566 206d 635f 636f 7265 5f67 6574 5f67  ef mc_core_get_g
-00085190: 7466 5f61 6e64 5f66 6173 7461 5f70 7428  tf_and_fasta_pt(
-000851a0: 6764 293a 0a20 2020 200a 2020 2020 6e74  gd):.    .    nt
-000851b0: 722c 206e 7072 2c20 6e65 7220 3d20 6764  r, npr, ner = gd
-000851c0: 2e75 7064 6174 655f 7464 5f69 6e66 6f28  .update_td_info(
-000851d0: 7365 6c20 3d20 312c 2070 6570 7469 6465  sel = 1, peptide
-000851e0: 203d 2054 7275 6529 0a20 2020 2067 7466   = True).    gtf
-000851f0: 5f6c 696e 652c 2063 6e20 3d20 6764 2e67  _line, cn = gd.g
-00085200: 6574 5f67 7466 5f6c 696e 6573 5f66 726f  et_gtf_lines_fro
-00085210: 6d5f 6578 6f6e 7328 7365 6c20 3d20 312c  m_exons(sel = 1,
-00085220: 2061 6464 5f73 6571 203d 2046 616c 7365   add_seq = False
-00085230: 2c20 636f 6e6e 6563 7420 3d20 5472 7565  , connect = True
-00085240: 290a 2020 2020 6c74 2c20 6c70 203d 2067  ).    lt, lp = g
-00085250: 642e 6765 745f 6661 7374 615f 6c69 6e65  d.get_fasta_line
-00085260: 735f 6672 6f6d 5f65 786f 6e73 2873 656c  s_from_exons(sel
-00085270: 203d 2031 2c20 7065 7074 6964 6520 3d20   = 1, peptide = 
-00085280: 5472 7565 290a 2020 2020 7265 7475 726e  True).    return
-00085290: 2067 7466 5f6c 696e 652c 206c 742c 206c   gtf_line, lt, l
-000852a0: 702c 2067 642e 6368 722c 206e 6572 2c20  p, gd.chr, ner, 
-000852b0: 636e 0a0a 0a27 2727 0a4e 565f 696e 666f  cn...'''.NV_info
-000852c0: 5f65 7874 5f74 7220 3d20 636f 6c6c 6563  _ext_tr = collec
-000852d0: 7469 6f6e 732e 6e61 6d65 6474 7570 6c65  tions.namedtuple
-000852e0: 2827 4e56 5f69 6e66 6f5f 6578 745f 7472  ('NV_info_ext_tr
-000852f0: 272c 2027 6368 722c 2070 6f73 5f72 6566  ', 'chr, pos_ref
-00085300: 2c20 706f 735f 6e65 772c 2067 656e 655f  , pos_new, gene_
-00085310: 6964 2c20 6765 6e65 5f6e 616d 652c 2076  id, gene_name, v
-00085320: 5f74 7970 652c 2076 5f6c 656e 2c20 6376  _type, v_len, cv
-00085330: 675f 6465 7074 682c 2063 7667 5f66 7261  g_depth, cvg_fra
-00085340: 632c 205c 0a20 2020 2020 2020 2020 2020  c, \.           
-00085350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085360: 2020 2020 2020 2072 6566 5f70 7265 762c         ref_prev,
-00085370: 2072 6566 5f73 6571 2c20 7265 665f 6e65   ref_seq, ref_ne
-00085380: 7874 2c20 616c 745f 7072 6576 2c20 616c  xt, alt_prev, al
-00085390: 745f 7365 712c 2061 6c74 5f6e 6578 742c  t_seq, alt_next,
-000853a0: 2076 5f63 6c61 7373 2c20 5c0a 2020 2020   v_class, \.    
-000853b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000853c0: 2020 2020 2020 2020 2020 2020 2020 765f                v_
-000853d0: 636c 6173 735f 7472 2c20 7374 7261 6e64  class_tr, strand
-000853e0: 2c20 6344 4e41 5f63 6861 6e67 652c 2043  , cDNA_change, C
-000853f0: 6f64 6f6e 5f63 6861 6e67 652c 2050 726f  odon_change, Pro
-00085400: 7465 696e 5f63 6861 6e67 652c 2050 726f  tein_change, Pro
-00085410: 7465 696e 5f63 6861 6e67 6532 2729 2023  tein_change2') #
-00085420: 2c20 4368 6563 6b27 2920 2023 206f 6e65  , Check')  # one
-00085430: 2d62 6173 650a 2727 270a 0a4e 565f 696e  -base.'''..NV_in
-00085440: 666f 5f74 7220 3d20 636f 6c6c 6563 7469  fo_tr = collecti
-00085450: 6f6e 732e 6e61 6d65 6474 7570 6c65 2827  ons.namedtuple('
-00085460: 4e56 5f69 6e66 6f5f 6578 745f 7472 272c  NV_info_ext_tr',
-00085470: 2027 6368 722c 2070 6f73 5f72 6566 2c20   'chr, pos_ref, 
-00085480: 6765 6e65 5f6e 616d 652c 2067 656e 655f  gene_name, gene_
-00085490: 6964 2c20 765f 7479 7065 2c20 765f 6c65  id, v_type, v_le
-000854a0: 6e2c 205c 0a20 2020 2020 2020 2020 2020  n, \.           
-000854b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000854c0: 2020 2020 2020 2063 7667 5f64 6570 7468         cvg_depth
-000854d0: 2c20 6376 675f 6672 6163 2c20 7265 665f  , cvg_frac, ref_
-000854e0: 7365 712c 2061 6c74 5f73 6571 2c20 5c0a  seq, alt_seq, \.
-000854f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084850: 230a 2020 2020 2323 2063 6f64 696e 6720  #.    ## coding 
+00084860: 7265 6769 6f6e 2075 7064 6174 650a 2020  region update.  
+00084870: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+00084880: 2323 2323 2323 2323 2323 0a0a 2020 2020  ##########..    
+00084890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000848a0: 2323 2323 2323 2323 0a20 2020 2023 2320  ########.    ## 
+000848b0: 496e 7465 6772 6974 7920 6368 6563 6b0a  Integrity check.
+000848c0: 2020 2020 0a20 2020 2073 7461 7274 5f74      .    start_t
+000848d0: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+000848e0: 290a 2020 2020 6e5f 6261 7365 735f 746f  ).    n_bases_to
+000848f0: 7461 6c20 3d20 300a 2020 2020 6e5f 6572  tal = 0.    n_er
+00084900: 5f62 6173 6573 203d 2030 0a20 2020 206e  _bases = 0.    n
+00084910: 5f62 6c6b 5f74 6f74 616c 203d 2030 0a20  _blk_total = 0. 
+00084920: 2020 206e 5f65 725f 626c 6b20 3d20 300a     n_er_blk = 0.
+00084930: 2020 2020 6e70 6520 3d20 300a 2020 2020      npe = 0.    
+00084940: 6e70 7420 3d20 300a 2020 2020 666f 7220  npt = 0.    for 
+00084950: 6764 2069 6e20 6764 5f73 656c 3a0a 2020  gd in gd_sel:.  
+00084960: 2020 2020 2020 666f 7220 7220 696e 2067        for r in g
+00084970: 642e 6578 6f6e 732e 7267 6e73 3a0a 2020  d.exons.rgns:.  
+00084980: 2020 2020 2020 2020 2020 6966 2072 2e74            if r.t
+00084990: 7970 6520 213d 2027 6465 6c65 7469 6f6e  ype != 'deletion
+000849a0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+000849b0: 2020 2073 3120 3d20 722e 7365 710a 2020     s1 = r.seq.  
+000849c0: 2020 2020 2020 2020 2020 2020 2020 7332                s2
+000849d0: 203d 2073 6571 5f6e 6577 5b28 722e 7374   = seq_new[(r.st
+000849e0: 6172 742d 3129 3a72 2e65 6e64 5d20 2320  art-1):r.end] # 
+000849f0: 6765 6e6f 6d65 5b72 2e63 6872 5d2e 7365  genome[r.chr].se
+00084a00: 715b 2872 2e73 7461 7274 2d31 293a 722e  q[(r.start-1):r.
+00084a10: 656e 645d 0a20 2020 2020 2020 2020 2020  end].           
+00084a20: 2020 2020 206e 5f65 7220 3d20 636f 6d70       n_er = comp
+00084a30: 6172 655f 7365 7132 2820 7331 2c20 7332  are_seq2( s1, s2
+00084a40: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00084a50: 2020 2023 2069 6620 6e5f 6572 203e 2030     # if n_er > 0
+00084a60: 3a20 7072 696e 7428 275c 6e53 313a 2025  : print('\nS1: %
+00084a70: 735c 6e53 323a 2025 7327 2025 2028 7331  s\nS2: %s' % (s1
+00084a80: 2c73 3229 290a 2020 2020 2020 2020 2020  ,s2)).          
+00084a90: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00084aa0: 2020 2020 2020 2020 2020 206e 5f62 6173             n_bas
+00084ab0: 6573 5f74 6f74 616c 202b 3d20 6c65 6e28  es_total += len(
+00084ac0: 7331 290a 2020 2020 2020 2020 2020 2020  s1).            
+00084ad0: 2020 2020 6e5f 6572 5f62 6173 6573 202b      n_er_bases +
+00084ae0: 3d20 6e5f 6572 0a20 2020 2020 2020 2020  = n_er.         
+00084af0: 2020 2020 2020 206e 5f62 6c6b 5f74 6f74         n_blk_tot
+00084b00: 616c 202b 3d20 310a 2020 2020 2020 2020  al += 1.        
+00084b10: 2020 2020 2020 2020 6966 206e 5f65 7220          if n_er 
+00084b20: 3e20 303a 206e 5f65 725f 626c 6b20 2b3d  > 0: n_er_blk +=
+00084b30: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00084b40: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00084b50: 6e74 722c 206e 7072 2c20 6e65 7220 3d20  ntr, npr, ner = 
+00084b60: 6764 2e75 7064 6174 655f 7464 5f69 6e66  gd.update_td_inf
+00084b70: 6f28 7365 6c20 3d20 312c 2070 6570 7469  o(sel = 1, pepti
+00084b80: 6465 203d 2054 7275 6529 0a20 2020 2020  de = True).     
+00084b90: 2020 206e 652c 206e 7420 3d20 6764 2e63     ne, nt = gd.c
+00084ba0: 6f6d 7061 7265 5f73 6571 735f 6672 6f6d  ompare_seqs_from
+00084bb0: 5f63 6473 5f61 6e64 5f67 656e 6f6d 6528  _cds_and_genome(
+00084bc0: 7365 715f 6e65 7729 2023 2067 656e 6f6d  seq_new) # genom
+00084bd0: 655b 6764 2e63 6872 5d2e 7365 7129 0a20  e[gd.chr].seq). 
+00084be0: 2020 2020 2020 206e 7065 202b 3d20 6e65         npe += ne
+00084bf0: 0a20 2020 2020 2020 206e 7074 202b 3d20  .        npt += 
+00084c00: 6e74 0a0a 2020 2020 2020 2020 2320 6966  nt..        # if
+00084c10: 206e 6572 203e 2030 3a20 7072 696e 7428   ner > 0: print(
+00084c20: 2749 6e74 6567 7269 7479 2063 6865 636b  'Integrity check
+00084c30: 2065 7272 6f72 2041 2069 6e20 2573 3a20   error A in %s: 
+00084c40: 2569 202d 2025 692f 2569 2c20 2569 2f25  %i - %i/%i, %i/%
+00084c50: 692c 2025 692f 2569 2720 2520 2863 6872  i, %i/%i' % (chr
+00084c60: 6d2c 206e 6572 2c20 6e5f 6572 5f62 6173  m, ner, n_er_bas
+00084c70: 6573 2c20 6e5f 6261 7365 735f 746f 7461  es, n_bases_tota
+00084c80: 6c2c 206e 5f65 725f 626c 6b2c 206e 5f62  l, n_er_blk, n_b
+00084c90: 6c6b 5f74 6f74 616c 2c20 6e70 652c 206e  lk_total, npe, n
+00084ca0: 7074 2920 290a 2020 2020 2020 2020 2320  pt) ).        # 
+00084cb0: 6966 206e 5f65 7220 3e20 303a 2070 7269  if n_er > 0: pri
+00084cc0: 6e74 2827 496e 7465 6772 6974 7920 6368  nt('Integrity ch
+00084cd0: 6563 6b20 6572 726f 7220 696e 2025 733a  eck error in %s:
+00084ce0: 2025 6920 2d20 2569 2f25 692c 2025 692f   %i - %i/%i, %i/
+00084cf0: 2569 2c20 2569 2f25 6927 2025 2028 6368  %i, %i/%i' % (ch
+00084d00: 726d 2c20 6e5f 6572 2c20 6e5f 6572 5f62  rm, n_er, n_er_b
+00084d10: 6173 6573 2c20 6e5f 6261 7365 735f 746f  ases, n_bases_to
+00084d20: 7461 6c2c 206e 5f65 725f 626c 6b2c 206e  tal, n_er_blk, n
+00084d30: 5f62 6c6b 5f74 6f74 616c 2c20 6e70 652c  _blk_total, npe,
+00084d40: 206e 7074 2920 290a 0a20 2020 2065 6c61   npt) )..    ela
+00084d50: 7073 6564 5f74 696d 6520 3d20 7469 6d65  psed_time = time
+00084d60: 2e74 696d 6528 2920 2d20 7374 6172 745f  .time() - start_
+00084d70: 7469 6d65 0a20 2020 2023 2070 7269 6e74  time.    # print
+00084d80: 2827 2020 2035 2e20 646f 6e65 2028 2569  ('   5. done (%i
+00084d90: 2920 2027 2025 2028 656c 6170 7365 645f  )  ' % (elapsed_
+00084da0: 7469 6d65 292c 2066 6c75 7368 203d 2054  time), flush = T
+00084db0: 7275 6529 0a20 2020 200a 2020 2020 6573  rue).    .    es
+00084dc0: 7461 7420 3d20 286e 5f62 6173 6573 5f74  tat = (n_bases_t
+00084dd0: 6f74 616c 2c20 6e5f 6572 5f62 6173 6573  otal, n_er_bases
+00084de0: 2c20 6e5f 626c 6b5f 746f 7461 6c2c 206e  , n_blk_total, n
+00084df0: 5f65 725f 626c 6b2c 206e 7074 2c20 6e70  _er_blk, npt, np
+00084e00: 6529 0a20 2020 200a 2020 2020 7265 7475  e).    .    retu
+00084e10: 726e 2067 645f 7365 6c2c 2073 6571 5f6e  rn gd_sel, seq_n
+00084e20: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
+00084e30: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
+00084e40: 740a 0a27 2727 0a4e 565f 696e 666f 5f65  t..'''.NV_info_e
+00084e50: 7874 5f74 7220 3d20 636f 6c6c 6563 7469  xt_tr = collecti
+00084e60: 6f6e 732e 6e61 6d65 6474 7570 6c65 2827  ons.namedtuple('
+00084e70: 4e56 5f69 6e66 6f5f 6578 745f 7472 272c  NV_info_ext_tr',
+00084e80: 2027 6368 722c 2070 6f73 5f72 6566 2c20   'chr, pos_ref, 
+00084e90: 706f 735f 6e65 772c 2067 656e 655f 6964  pos_new, gene_id
+00084ea0: 2c20 6765 6e65 5f6e 616d 652c 2076 5f74  , gene_name, v_t
+00084eb0: 7970 652c 2076 5f6c 656e 2c20 6376 675f  ype, v_len, cvg_
+00084ec0: 6465 7074 682c 2063 7667 5f66 7261 632c  depth, cvg_frac,
+00084ed0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00084ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084ef0: 2020 2020 2072 6566 5f70 7265 762c 2072       ref_prev, r
+00084f00: 6566 5f73 6571 2c20 7265 665f 6e65 7874  ef_seq, ref_next
+00084f10: 2c20 616c 745f 7072 6576 2c20 616c 745f  , alt_prev, alt_
+00084f20: 7365 712c 2061 6c74 5f6e 6578 742c 2076  seq, alt_next, v
+00084f30: 5f63 6c61 7373 2c20 5c0a 2020 2020 2020  _class, \.      
+00084f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084f50: 2020 2020 2020 2020 2020 2020 765f 636c              v_cl
+00084f60: 6173 735f 7472 2c20 7374 7261 6e64 2c20  ass_tr, strand, 
+00084f70: 6344 4e41 5f63 6861 6e67 652c 2043 6f64  cDNA_change, Cod
+00084f80: 6f6e 5f63 6861 6e67 652c 2050 726f 7465  on_change, Prote
+00084f90: 696e 5f63 6861 6e67 652c 2050 726f 7465  in_change, Prote
+00084fa0: 696e 5f63 6861 6e67 6532 2c20 4368 6563  in_change2, Chec
+00084fb0: 6b27 2920 2023 206f 6e65 2d62 6173 650a  k')  # one-base.
+00084fc0: 0a64 6566 2077 7269 7465 5f74 6f5f 7663  .def write_to_vc
+00084fd0: 6628 2073 6e76 5f69 6e66 6f5f 6c73 742c  f( snv_info_lst,
+00084fe0: 2066 696c 655f 6e61 6d65 2029 3a0a 0a20   file_name ):.. 
+00084ff0: 2020 2069 6620 6c65 6e28 736e 765f 696e     if len(snv_in
+00085000: 666f 5f6c 7374 2920 3d3d 2030 3a0a 2020  fo_lst) == 0:.  
+00085010: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00085020: 200a 2020 2020 6966 206c 656e 2873 6e76   .    if len(snv
+00085030: 5f69 6e66 6f5f 6c73 745b 305d 2920 3c3d  _info_lst[0]) <=
+00085040: 2032 303a 0a20 2020 2020 2020 2070 6173   20:.        pas
+00085050: 730a 2020 2020 656c 7365 3a0a 2020 2020  s.    else:.    
+00085060: 2020 2020 6620 3d20 6f70 656e 2820 666e      f = open( fn
+00085070: 616d 655f 7663 662c 2027 7774 2b27 2029  ame_vcf, 'wt+' )
+00085080: 0a0a 2020 2020 2020 2020 6c69 6e65 7320  ..        lines 
+00085090: 3d20 5b27 2343 4852 4f4d 5c74 504f 535c  = ['#CHROM\tPOS\
+000850a0: 7449 445c 7452 4546 5c74 414c 545c 7451  tID\tREF\tALT\tQ
+000850b0: 5541 4c5c 7446 494c 5445 525c 7449 4e46  UAL\tFILTER\tINF
+000850c0: 4f27 5d0a 2020 2020 2020 2020 666f 7220  O'].        for 
+000850d0: 6e69 2069 6e20 736e 765f 696e 666f 5f6c  ni in snv_info_l
+000850e0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+000850f0: 6d69 6420 3d0a 2020 2020 2020 2020 2020  mid =.          
+00085100: 2020 5175 616c 203d 0a20 2020 2020 2020    Qual =.       
+00085110: 2020 2020 2046 696c 7465 7220 3d0a 2020       Filter =.  
+00085120: 2020 2020 2020 2020 2020 696e 666f 203d            info =
+00085130: 2027 4143 3d25 693b 4146 270a 2020 2020   'AC=%i;AF'.    
+00085140: 2020 2020 2020 2020 2725 735c 7425 695c          '%s\t%i\
+00085150: 7425 735c 7425 735c 7425 735c 7425 695c  t%s\t%s\t%s\t%i\
+00085160: 7425 735c 7425 735c 6e27 2025 2028 6e69  t%s\t%s\n' % (ni
+00085170: 2e63 6872 2c20 6e69 2e70 6f73 5f72 6566  .chr, ni.pos_ref
+00085180: 2c20 6d69 642c 206e 692e 7265 665f 7365  , mid, ni.ref_se
+00085190: 712c 206e 692e 616c 745f 7365 712c 2051  q, ni.alt_seq, Q
+000851a0: 7561 6c2c 2069 6e66 6f29 0a0a 2020 2020  ual, info)..    
+000851b0: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
+000851c0: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
+000851d0: 6e0a 2727 270a 0a64 6566 206d 635f 636f  n.'''..def mc_co
+000851e0: 7265 5f67 6574 5f67 7466 5f61 6e64 5f66  re_get_gtf_and_f
+000851f0: 6173 7461 5f70 7428 6764 293a 0a20 2020  asta_pt(gd):.   
+00085200: 200a 2020 2020 6e74 722c 206e 7072 2c20   .    ntr, npr, 
+00085210: 6e65 7220 3d20 6764 2e75 7064 6174 655f  ner = gd.update_
+00085220: 7464 5f69 6e66 6f28 7365 6c20 3d20 312c  td_info(sel = 1,
+00085230: 2070 6570 7469 6465 203d 2054 7275 6529   peptide = True)
+00085240: 0a20 2020 2067 7466 5f6c 696e 652c 2063  .    gtf_line, c
+00085250: 6e20 3d20 6764 2e67 6574 5f67 7466 5f6c  n = gd.get_gtf_l
+00085260: 696e 6573 5f66 726f 6d5f 6578 6f6e 7328  ines_from_exons(
+00085270: 7365 6c20 3d20 312c 2061 6464 5f73 6571  sel = 1, add_seq
+00085280: 203d 2046 616c 7365 2c20 636f 6e6e 6563   = False, connec
+00085290: 7420 3d20 5472 7565 290a 2020 2020 6c74  t = True).    lt
+000852a0: 2c20 6c70 203d 2067 642e 6765 745f 6661  , lp = gd.get_fa
+000852b0: 7374 615f 6c69 6e65 735f 6672 6f6d 5f65  sta_lines_from_e
+000852c0: 786f 6e73 2873 656c 203d 2031 2c20 7065  xons(sel = 1, pe
+000852d0: 7074 6964 6520 3d20 5472 7565 290a 2020  ptide = True).  
+000852e0: 2020 7265 7475 726e 2067 7466 5f6c 696e    return gtf_lin
+000852f0: 652c 206c 742c 206c 702c 2067 642e 6368  e, lt, lp, gd.ch
+00085300: 722c 206e 6572 2c20 636e 0a0a 0a27 2727  r, ner, cn...'''
+00085310: 0a4e 565f 696e 666f 5f65 7874 5f74 7220  .NV_info_ext_tr 
+00085320: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
+00085330: 6d65 6474 7570 6c65 2827 4e56 5f69 6e66  medtuple('NV_inf
+00085340: 6f5f 6578 745f 7472 272c 2027 6368 722c  o_ext_tr', 'chr,
+00085350: 2070 6f73 5f72 6566 2c20 706f 735f 6e65   pos_ref, pos_ne
+00085360: 772c 2067 656e 655f 6964 2c20 6765 6e65  w, gene_id, gene
+00085370: 5f6e 616d 652c 2076 5f74 7970 652c 2076  _name, v_type, v
+00085380: 5f6c 656e 2c20 6376 675f 6465 7074 682c  _len, cvg_depth,
+00085390: 2063 7667 5f66 7261 632c 205c 0a20 2020   cvg_frac, \.   
+000853a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000853b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000853c0: 6566 5f70 7265 762c 2072 6566 5f73 6571  ef_prev, ref_seq
+000853d0: 2c20 7265 665f 6e65 7874 2c20 616c 745f  , ref_next, alt_
+000853e0: 7072 6576 2c20 616c 745f 7365 712c 2061  prev, alt_seq, a
+000853f0: 6c74 5f6e 6578 742c 2076 5f63 6c61 7373  lt_next, v_class
+00085400: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00085410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085420: 2020 2020 2020 765f 636c 6173 735f 7472        v_class_tr
+00085430: 2c20 7374 7261 6e64 2c20 6344 4e41 5f63  , strand, cDNA_c
+00085440: 6861 6e67 652c 2043 6f64 6f6e 5f63 6861  hange, Codon_cha
+00085450: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
+00085460: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
+00085470: 6e67 6532 2729 2023 2c20 4368 6563 6b27  nge2') #, Check'
+00085480: 2920 2023 206f 6e65 2d62 6173 650a 2727  )  # one-base.''
+00085490: 270a 0a4e 565f 696e 666f 5f74 7220 3d20  '..NV_info_tr = 
+000854a0: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
+000854b0: 6474 7570 6c65 2827 4e56 5f69 6e66 6f5f  dtuple('NV_info_
+000854c0: 6578 745f 7472 272c 2027 6368 722c 2070  ext_tr', 'chr, p
+000854d0: 6f73 5f72 6566 2c20 6765 6e65 5f6e 616d  os_ref, gene_nam
+000854e0: 652c 2067 656e 655f 6964 2c20 765f 7479  e, gene_id, v_ty
+000854f0: 7065 2c20 765f 6c65 6e2c 205c 0a20 2020  pe, v_len, \.   
 00085500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085510: 2020 7374 7261 6e64 2c20 6344 4e41 5f63    strand, cDNA_c
-00085520: 6861 6e67 652c 2043 6f64 6f6e 5f63 6861  hange, Codon_cha
-00085530: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
-00085540: 6e67 652c 2050 726f 7465 696e 5f63 6861  nge, Protein_cha
-00085550: 6e67 6532 2c20 765f 636c 6173 7327 2920  nge2, v_class') 
-00085560: 0a0a 6465 6620 746f 5f6e 765f 7369 6d70  ..def to_nv_simp
-00085570: 6c65 2820 6e76 2029 3a0a 0a20 2020 206e  le( nv ):..    n
-00085580: 7669 203d 204e 565f 696e 666f 5f74 7228  vi = NV_info_tr(
-00085590: 206e 762e 6368 722c 206e 762e 706f 735f   nv.chr, nv.pos_
-000855a0: 7265 662c 206e 762e 6765 6e65 5f6e 616d  ref, nv.gene_nam
-000855b0: 652c 206e 762e 6765 6e65 5f69 642c 206e  e, nv.gene_id, n
-000855c0: 762e 765f 7479 7065 2c20 6e76 2e76 5f6c  v.v_type, nv.v_l
-000855d0: 656e 2c20 5c0a 2020 2020 2020 2020 2020  en, \.          
-000855e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000855f0: 2020 2020 2020 6e76 2e63 7667 5f64 6570        nv.cvg_dep
-00085600: 7468 2c20 6e76 2e63 7667 5f66 7261 632c  th, nv.cvg_frac,
-00085610: 206e 762e 7265 665f 7365 712c 206e 762e   nv.ref_seq, nv.
-00085620: 616c 745f 7365 712c 205c 0a20 2020 2020  alt_seq, \.     
+00085510: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00085520: 7667 5f64 6570 7468 2c20 6376 675f 6672  vg_depth, cvg_fr
+00085530: 6163 2c20 7265 665f 7365 712c 2061 6c74  ac, ref_seq, alt
+00085540: 5f73 6571 2c20 5c0a 2020 2020 2020 2020  _seq, \.        
+00085550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085560: 2020 2020 2020 2020 2020 7374 7261 6e64            strand
+00085570: 2c20 6344 4e41 5f63 6861 6e67 652c 2043  , cDNA_change, C
+00085580: 6f64 6f6e 5f63 6861 6e67 652c 2050 726f  odon_change, Pro
+00085590: 7465 696e 5f63 6861 6e67 652c 2050 726f  tein_change, Pro
+000855a0: 7465 696e 5f63 6861 6e67 6532 2c20 765f  tein_change2, v_
+000855b0: 636c 6173 7327 2920 0a0a 6465 6620 746f  class') ..def to
+000855c0: 5f6e 765f 7369 6d70 6c65 2820 6e76 2029  _nv_simple( nv )
+000855d0: 3a0a 0a20 2020 206e 7669 203d 204e 565f  :..    nvi = NV_
+000855e0: 696e 666f 5f74 7228 206e 762e 6368 722c  info_tr( nv.chr,
+000855f0: 206e 762e 706f 735f 7265 662c 206e 762e   nv.pos_ref, nv.
+00085600: 6765 6e65 5f6e 616d 652c 206e 762e 6765  gene_name, nv.ge
+00085610: 6e65 5f69 642c 206e 762e 765f 7479 7065  ne_id, nv.v_type
+00085620: 2c20 6e76 2e76 5f6c 656e 2c20 5c0a 2020  , nv.v_len, \.  
 00085630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085640: 2020 2020 2020 2020 2020 206e 762e 7374             nv.st
-00085650: 7261 6e64 2c20 6e76 2e63 444e 415f 6368  rand, nv.cDNA_ch
-00085660: 616e 6765 2c20 6e76 2e43 6f64 6f6e 5f63  ange, nv.Codon_c
-00085670: 6861 6e67 652c 205c 0a20 2020 2020 2020  hange, \.       
-00085680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085690: 2020 2020 2020 2020 206e 762e 5072 6f74           nv.Prot
-000856a0: 6569 6e5f 6368 616e 6765 2c20 6e76 2e50  ein_change, nv.P
-000856b0: 726f 7465 696e 5f63 6861 6e67 6532 2c20  rotein_change2, 
-000856c0: 6e76 2e76 5f63 6c61 7373 5f74 7220 290a  nv.v_class_tr ).
-000856d0: 2020 2020 7265 7475 726e 206e 7669 0a0a      return nvi..
-000856e0: 6465 6620 5374 7269 6e67 4669 785f 7379  def StringFix_sy
-000856f0: 6e74 6865 7369 7328 6774 665f 6669 6c65  nthesis(gtf_file
-00085700: 2c20 6765 6e6f 6d65 5f66 696c 652c 2072  , genome_file, r
-00085710: 6576 203d 2054 7275 652c 206e 5f63 6f72  ev = True, n_cor
-00085720: 6573 203d 2031 2c20 6f75 745f 6469 7220  es = 1, out_dir 
-00085730: 3d20 4e6f 6e65 2c20 6764 7320 3d20 4e6f  = None, gds = No
-00085740: 6e65 293a 0a0a 2020 2020 2320 7072 696e  ne):..    # prin
-00085750: 7428 2753 7472 696e 6746 6978 5f73 796e  t('StringFix_syn
-00085760: 7468 6573 6973 2073 7461 7274 6564 2027  thesis started '
-00085770: 2c20 6461 7465 7469 6d65 2e64 6174 6574  , datetime.datet
-00085780: 696d 652e 6e6f 7728 2929 0a20 2020 200a  ime.now()).    .
-00085790: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000857a0: 6528 6765 6e6f 6d65 5f66 696c 652c 2073  e(genome_file, s
-000857b0: 7472 293a 0a20 2020 2020 2020 2067 656e  tr):.        gen
-000857c0: 6f6d 6520 3d20 6c6f 6164 5f67 656e 6f6d  ome = load_genom
-000857d0: 6528 6765 6e6f 6d65 5f66 696c 652c 2076  e(genome_file, v
-000857e0: 6572 626f 7365 203d 2054 7275 6529 0a20  erbose = True). 
-000857f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00085800: 2067 656e 6f6d 6520 3d20 6765 6e6f 6d65   genome = genome
-00085810: 5f66 696c 650a 0a20 2020 2069 6620 6764  _file..    if gd
-00085820: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00085830: 2020 2067 7466 5f6c 696e 6573 2c20 6864     gtf_lines, hd
-00085840: 725f 6c69 6e65 7320 3d20 6c6f 6164 5f67  r_lines = load_g
-00085850: 7466 2867 7466 5f66 696c 652c 2076 6572  tf(gtf_file, ver
-00085860: 626f 7365 203d 2054 7275 6529 0a20 2020  bose = True).   
-00085870: 2020 2020 2067 645f 6c73 742c 2063 6872       gd_lst, chr
-00085880: 7320 3d20 6765 745f 6765 6e65 5f64 6573  s = get_gene_des
-00085890: 6372 6970 746f 7228 6774 665f 6c69 6e65  criptor(gtf_line
-000858a0: 732c 2067 656e 6f6d 6520 3d20 4e6f 6e65  s, genome = None
-000858b0: 2c20 6669 6c6c 203d 2054 7275 652c 205c  , fill = True, \
-000858c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000858d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000858e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000858f0: 6367 203d 2054 7275 652c 2076 6572 626f  cg = True, verbo
-00085900: 7365 203d 2054 7275 652c 206e 5f63 6f72  se = True, n_cor
-00085910: 6573 203d 2031 290a 2020 2020 2020 2020  es = 1).        
-00085920: 6764 5f6c 7374 732c 2063 6872 5f6c 7374  gd_lsts, chr_lst
-00085930: 203d 2070 6163 6b5f 6765 6e65 5f64 6573   = pack_gene_des
-00085940: 6372 6970 746f 7228 2067 645f 6c73 742c  criptor( gd_lst,
-00085950: 2063 6872 7320 290a 2020 2020 2020 2020   chrs ).        
-00085960: 0a20 2020 2020 2020 2066 6f72 2067 646c  .        for gdl
-00085970: 2069 6e20 6764 5f6c 7374 733a 200a 2020   in gd_lsts: .  
-00085980: 2020 2020 2020 2020 2020 666f 7220 6d2c            for m,
-00085990: 2067 6420 696e 2065 6e75 6d65 7261 7465   gd in enumerate
-000859a0: 2867 646c 293a 0a20 2020 2020 2020 2020  (gdl):.         
-000859b0: 2020 2020 2020 2067 642e 7365 745f 636f         gd.set_co
-000859c0: 765f 6e5f 6162 6e5f 7468 2820 4d49 4e5f  v_n_abn_th( MIN_
-000859d0: 434f 565f 544f 5f53 454c 2c20 4d49 4e5f  COV_TO_SEL, MIN_
-000859e0: 4142 4e5f 544f 5f53 454c 2029 0a0a 2020  ABN_TO_SEL )..  
-000859f0: 2020 2020 2020 6e74 725f 7661 6c69 6420        ntr_valid 
-00085a00: 3d20 300a 2020 2020 2020 2020 6767 635f  = 0.        ggc_
-00085a10: 7475 706c 6520 3d20 5b5d 0a20 2020 2020  tuple = [].     
-00085a20: 2020 2063 6872 5f6c 7374 5f6e 6577 203d     chr_lst_new =
-00085a30: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-00085a40: 6b6b 2c20 6368 726d 2069 6e20 656e 756d  kk, chrm in enum
-00085a50: 6572 6174 6528 6368 725f 6c73 7429 3a0a  erate(chr_lst):.
-00085a60: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00085a70: 6872 6d20 696e 2067 656e 6f6d 652e 6b65  hrm in genome.ke
-00085a80: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
-00085a90: 2020 2020 2020 6368 725f 6c73 745f 6e65        chr_lst_ne
-00085aa0: 772e 6170 7065 6e64 2863 6872 6d29 0a20  w.append(chrm). 
-00085ab0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00085ac0: 6763 5f74 7570 6c65 2e61 7070 656e 6428  gc_tuple.append(
-00085ad0: 2028 6764 5f6c 7374 735b 6b6b 5d2c 2067   (gd_lsts[kk], g
-00085ae0: 656e 6f6d 655b 6368 726d 5d2e 7365 712c  enome[chrm].seq,
-00085af0: 2063 6872 6d29 2029 0a20 2020 2020 2020   chrm) ).       
-00085b00: 2020 2020 2020 2020 2066 6f72 2067 6420           for gd 
-00085b10: 696e 2067 645f 6c73 7473 5b6b 6b5d 3a0a  in gd_lsts[kk]:.
-00085b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085b30: 2020 2020 6e74 725f 7661 6c69 6420 2b3d      ntr_valid +=
-00085b40: 2067 642e 6e74 720a 2020 2020 2020 2020   gd.ntr.        
-00085b50: 2320 7072 696e 7428 274e 5f74 7273 2076  # print('N_trs v
-00085b60: 616c 6964 203d 2025 6927 2025 206e 7472  alid = %i' % ntr
-00085b70: 5f76 616c 6964 290a 2020 2020 2020 2020  _valid).        
-00085b80: 6465 6c20 6764 5f6c 7374 730a 0a20 2020  del gd_lsts..   
-00085b90: 2065 6c73 653a 0a20 2020 2020 2020 2067   else:.        g
-00085ba0: 7466 5f6c 696e 6573 2c20 6864 725f 6c69  tf_lines, hdr_li
-00085bb0: 6e65 7320 3d20 6c6f 6164 5f67 7466 2867  nes = load_gtf(g
-00085bc0: 7466 5f66 696c 652c 2076 6572 626f 7365  tf_file, verbose
-00085bd0: 203d 2046 616c 7365 2c20 686f 203d 2054   = False, ho = T
-00085be0: 7275 6529 0a0a 2020 2020 2020 2020 666d  rue)..        fm
-00085bf0: 203d 207b 274d 273a 2027 6578 6f6e 272c   = {'M': 'exon',
-00085c00: 2027 4927 3a20 2769 6e73 6572 7369 6f6e   'I': 'insersion
-00085c10: 272c 2027 4427 3a20 2764 656c 6574 696f  ', 'D': 'deletio
-00085c20: 6e27 7d0a 2020 2020 2020 2020 666f 7220  n'}.        for 
-00085c30: 6d2c 2067 6420 696e 2065 6e75 6d65 7261  m, gd in enumera
-00085c40: 7465 2867 6473 293a 0a20 2020 2020 2020  te(gds):.       
-00085c50: 2020 2020 2067 642e 7365 745f 636f 765f       gd.set_cov_
-00085c60: 6e5f 6162 6e5f 7468 2820 4d49 4e5f 434f  n_abn_th( MIN_CO
-00085c70: 565f 544f 5f53 454c 2c20 4d49 4e5f 4142  V_TO_SEL, MIN_AB
-00085c80: 4e5f 544f 5f53 454c 2029 0a20 2020 2020  N_TO_SEL ).     
-00085c90: 2020 2020 2020 2069 6620 286c 656e 2867         if (len(g
-00085ca0: 642e 7267 6e73 2e72 676e 7329 203e 2030  d.rgns.rgns) > 0
-00085cb0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00085cc0: 2020 2067 642e 6578 6f6e 732e 7267 6e73     gd.exons.rgns
-00085cd0: 2c20 6764 2e72 676e 732e 7267 6e73 203d  , gd.rgns.rgns =
-00085ce0: 2067 642e 7267 6e73 2e72 676e 732c 2067   gd.rgns.rgns, g
-00085cf0: 642e 6578 6f6e 732e 7267 6e73 0a20 2020  d.exons.rgns.   
-00085d00: 2020 2020 2020 2020 2020 2020 2067 642e               gd.
-00085d10: 7465 5f74 6f5f 6765 5f6d 6170 732c 2067  te_to_ge_maps, g
-00085d20: 642e 7472 5f74 6f5f 6772 5f6d 6170 7320  d.tr_to_gr_maps 
-00085d30: 3d20 6764 2e74 725f 746f 5f67 725f 6d61  = gd.tr_to_gr_ma
-00085d40: 7073 2c20 6764 2e74 655f 746f 5f67 655f  ps, gd.te_to_ge_
-00085d50: 6d61 7073 0a20 2020 2020 2020 2020 2020  maps.           
-00085d60: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00085d70: 2020 666f 7220 7220 696e 2067 642e 6578    for r in gd.ex
-00085d80: 6f6e 732e 7267 6e73 3a0a 2020 2020 2020  ons.rgns:.      
-00085d90: 2020 2020 2020 2020 2020 6966 2072 2e74            if r.t
-00085da0: 7970 6520 696e 2066 6d2e 6b65 7973 2829  ype in fm.keys()
-00085db0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00085dc0: 2020 2020 2020 722e 7479 7065 203d 2066        r.type = f
-00085dd0: 6d5b 722e 7479 7065 5d0a 0a20 2020 2020  m[r.type]..     
-00085de0: 2020 2063 6872 7320 3d20 5b5d 0a20 2020     chrs = [].   
-00085df0: 2020 2020 2066 6f72 2067 6420 696e 2067       for gd in g
-00085e00: 6473 3a20 0a20 2020 2020 2020 2020 2020  ds: .           
-00085e10: 2063 6872 732e 6170 7065 6e64 2867 642e   chrs.append(gd.
-00085e20: 6368 7229 0a0a 2020 2020 2020 2020 6368  chr)..        ch
-00085e30: 725f 6c73 7420 3d20 6c69 7374 2873 6574  r_lst = list(set
-00085e40: 2863 6872 7329 290a 2020 2020 2020 2020  (chrs)).        
-00085e50: 6368 725f 6c73 742e 736f 7274 2829 0a20  chr_lst.sort(). 
-00085e60: 2020 2020 2020 2063 6872 7320 3d20 6e70         chrs = np
-00085e70: 2e61 7272 6179 2863 6872 7329 0a0a 2020  .array(chrs)..  
-00085e80: 2020 2020 2020 6e74 725f 7661 6c69 6420        ntr_valid 
-00085e90: 3d20 300a 2020 2020 2020 2020 6767 635f  = 0.        ggc_
-00085ea0: 7475 706c 6520 3d20 5b5d 0a20 2020 2020  tuple = [].     
-00085eb0: 2020 2063 6872 5f6c 7374 5f6e 6577 203d     chr_lst_new =
-00085ec0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-00085ed0: 6b6b 2c20 6368 726d 2069 6e20 656e 756d  kk, chrm in enum
-00085ee0: 6572 6174 6528 6368 725f 6c73 7429 3a0a  erate(chr_lst):.
-00085ef0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00085f00: 6872 6d20 696e 2067 656e 6f6d 652e 6b65  hrm in genome.ke
-00085f10: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
-00085f20: 2020 2020 2020 7768 203d 2077 6869 6368        wh = which
-00085f30: 2863 6872 7320 3d3d 2063 6872 6d29 0a20  (chrs == chrm). 
-00085f40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00085f50: 6620 6c65 6e28 7768 2920 3e20 303a 0a20  f len(wh) > 0:. 
-00085f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085f70: 2020 2073 5f70 6f73 203d 206e 702e 7a65     s_pos = np.ze
-00085f80: 726f 7328 6c65 6e28 7768 292c 6474 7970  ros(len(wh),dtyp
-00085f90: 653d 6e70 2e66 6c6f 6174 3332 290a 2020  e=np.float32).  
-00085fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085fb0: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-00085fc0: 286c 656e 2877 6829 293a 200a 2020 2020  (len(wh)): .    
-00085fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085fe0: 2020 2020 735f 706f 735b 6b5d 203d 2067      s_pos[k] = g
-00085ff0: 6473 5b77 685b 6b5d 5d2e 6265 6769 6e0a  ds[wh[k]].begin.
-00086000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086010: 2020 2020 2020 2020 6e74 725f 7661 6c69          ntr_vali
-00086020: 6420 2b3d 2067 642e 6e74 720a 2020 2020  d += gd.ntr.    
-00086030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086040: 6f64 7220 3d20 735f 706f 732e 6172 6773  odr = s_pos.args
-00086050: 6f72 7428 290a 0a20 2020 2020 2020 2020  ort()..         
-00086060: 2020 2020 2020 2020 2020 2063 6872 5f6c             chr_l
-00086070: 7374 5f6e 6577 2e61 7070 656e 6428 6368  st_new.append(ch
-00086080: 726d 290a 2020 2020 2020 2020 2020 2020  rm).            
-00086090: 2020 2020 2020 2020 6767 635f 7475 706c          ggc_tupl
-000860a0: 652e 6170 7065 6e64 2820 285b 2067 6473  e.append( ([ gds
-000860b0: 5b77 685b 6f64 725b 6b5d 5d5d 2066 6f72  [wh[odr[k]]] for
-000860c0: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
-000860d0: 7768 2929 205d 2c20 6765 6e6f 6d65 5b63  wh)) ], genome[c
-000860e0: 6872 6d5d 2e73 6571 2c20 6368 726d 2920  hrm].seq, chrm) 
-000860f0: 290a 0a20 2020 2020 2020 2023 2070 7269  )..        # pri
-00086100: 6e74 2827 4e5f 7472 7320 7661 6c69 6420  nt('N_trs valid 
-00086110: 3d20 2569 2720 2520 6e74 725f 7661 6c69  = %i' % ntr_vali
-00086120: 6429 0a20 2020 2020 2020 2064 656c 2067  d).        del g
-00086130: 6473 0a0a 0a20 2020 2066 696c 655f 6e61  ds...    file_na
-00086140: 6d65 203d 2067 7466 5f66 696c 652e 7370  me = gtf_file.sp
-00086150: 6c69 7428 272f 2729 5b2d 315d 0a20 2020  lit('/')[-1].   
-00086160: 2023 2066 6e61 6d65 203d 2066 696c 655f   # fname = file_
-00086170: 6e61 6d65 2e73 706c 6974 2827 2e27 295b  name.split('.')[
-00086180: 305d 0a20 2020 2066 6e73 203d 2066 696c  0].    fns = fil
-00086190: 655f 6e61 6d65 2e73 706c 6974 2827 2e27  e_name.split('.'
-000861a0: 295b 3a2d 315d 0a20 2020 2066 6e61 6d65  )[:-1].    fname
-000861b0: 203d 2027 270a 2020 2020 666f 7220 6b2c   = ''.    for k,
-000861c0: 2066 6e20 696e 2065 6e75 6d65 7261 7465   fn in enumerate
-000861d0: 2866 6e73 293a 0a20 2020 2020 2020 2069  (fns):.        i
-000861e0: 6620 6b20 3e20 303a 0a20 2020 2020 2020  f k > 0:.       
-000861f0: 2020 2020 2066 6e61 6d65 203d 2066 6e61       fname = fna
-00086200: 6d65 202b 2027 2e27 0a20 2020 2020 2020  me + '.'.       
-00086210: 2066 6e61 6d65 203d 2066 6e61 6d65 202b   fname = fname +
-00086220: 2066 6e0a 0a20 2020 2069 6620 6f75 745f   fn..    if out_
-00086230: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
-00086240: 0a20 2020 2020 2020 2069 6620 6f75 745f  .        if out_
-00086250: 6469 725b 2d31 5d20 3d3d 2027 2f27 3a0a  dir[-1] == '/':.
-00086260: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
-00086270: 6520 3d20 6f75 745f 6469 7220 2b20 666e  e = out_dir + fn
-00086280: 616d 650a 2020 2020 2020 2020 656c 7365  ame.        else
-00086290: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
-000862a0: 616d 6520 3d20 6f75 745f 6469 7220 2b20  ame = out_dir + 
-000862b0: 272f 2720 2b20 666e 616d 650a 0a20 2020  '/' + fname..   
-000862c0: 2067 656e 6f6d 655f 6669 6c65 5f6e 6577   genome_file_new
-000862d0: 203d 2066 6e61 6d65 202b 2027 5f63 7573   = fname + '_cus
-000862e0: 746f 6d69 7a65 645f 6765 6e6f 6d65 2e66  tomized_genome.f
-000862f0: 6127 0a20 2020 2067 7466 5f66 696c 655f  a'.    gtf_file_
-00086300: 6e65 7720 3d20 666e 616d 6520 2b20 275f  new = fname + '_
-00086310: 6375 7374 6f6d 697a 6564 2e67 7466 270a  customized.gtf'.
-00086320: 2020 2020 6661 5f66 696c 655f 7472 5f6e      fa_file_tr_n
-00086330: 6577 203d 2066 6e61 6d65 202b 2027 5f74  ew = fname + '_t
-00086340: 7261 6e73 6372 6970 746f 6d65 2e66 6127  ranscriptome.fa'
-00086350: 0a20 2020 2066 615f 6669 6c65 5f70 725f  .    fa_file_pr_
-00086360: 6e65 7720 3d20 666e 616d 6520 2b20 275f  new = fname + '_
-00086370: 7072 6f74 656f 6d65 2e66 6127 0a20 2020  proteome.fa'.   
-00086380: 2066 6e61 6d65 5f73 6e76 203d 2066 6e61   fname_snv = fna
-00086390: 6d65 202b 2027 5f73 6e76 5f73 756d 6d61  me + '_snv_summa
-000863a0: 7279 2e74 7376 270a 2020 2020 666e 616d  ry.tsv'.    fnam
-000863b0: 655f 7663 6620 3d20 666e 616d 6520 2b20  e_vcf = fname + 
-000863c0: 275f 736e 765f 7375 6d6d 6172 792e 7663  '_snv_summary.vc
-000863d0: 6627 0a0a 2020 2020 2323 2323 2323 2323  f'..    ########
-000863e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000863f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086400: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-00086410: 2020 2063 6872 5f6c 7374 203d 2063 6872     chr_lst = chr
-00086420: 5f6c 7374 5f6e 6577 0a0a 2020 2020 6f66  _lst_new..    of
-00086430: 5f64 6963 7420 3d20 7b7d 0a20 2020 2023  _dict = {}.    #
-00086440: 2067 6473 5f6c 7374 203d 205b 5d0a 2020   gds_lst = [].  
-00086450: 2020 2320 736e 765f 6c73 7420 3d20 5b5d    # snv_lst = []
-00086460: 0a20 2020 2067 6473 5f6e 6577 203d 205b  .    gds_new = [
-00086470: 5d0a 2020 2020 736e 765f 696e 666f 5f6c  ].    snv_info_l
-00086480: 7374 203d 205b 5d0a 0a20 2020 206e 5f62  st = []..    n_b
-00086490: 6173 6573 5f74 6f74 616c 203d 2030 0a20  ases_total = 0. 
-000864a0: 2020 206e 5f65 725f 6261 7365 7320 3d20     n_er_bases = 
-000864b0: 300a 2020 2020 6e5f 626c 6b5f 746f 7461  0.    n_blk_tota
-000864c0: 6c20 3d20 300a 2020 2020 6e5f 6572 5f62  l = 0.    n_er_b
-000864d0: 6c6b 203d 2030 0a20 2020 206e 7074 203d  lk = 0.    npt =
-000864e0: 2030 0a20 2020 206e 7065 203d 2030 0a20   0.    npe = 0. 
-000864f0: 2020 200a 2020 2020 7374 6172 745f 7469     .    start_ti
-00086500: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00086510: 0a20 2020 2069 6620 286e 5f63 6f72 6573  .    if (n_cores
-00086520: 203d 3d20 3129 207c 2028 6c65 6e28 6368   == 1) | (len(ch
-00086530: 725f 6c73 7429 203d 3d20 3129 3a0a 2020  r_lst) == 1):.  
-00086540: 2020 2020 2020 666f 7220 6b6b 2069 6e20        for kk in 
-00086550: 7261 6e67 6528 6c65 6e28 6368 725f 6c73  range(len(chr_ls
-00086560: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
-00086570: 2070 7269 6e74 2827 5c72 2720 2b20 2720   print('\r' + ' 
-00086580: 272a 3130 302c 2065 6e64 3d27 272c 2066  '*100, end='', f
-00086590: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
-000865a0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000865b0: 5c72 5265 636f 6e73 7472 7563 7469 6e67  \rReconstructing
-000865c0: 202e 2e20 2569 2f25 6920 2825 7329 2027   .. %i/%i (%s) '
-000865d0: 2025 2028 6b6b 2b31 2c20 6c65 6e28 6368   % (kk+1, len(ch
-000865e0: 725f 6c73 7429 2c20 6368 725f 6c73 745b  r_lst), chr_lst[
-000865f0: 6b6b 5d29 2c20 656e 6420 3d20 2727 2c20  kk]), end = '', 
-00086600: 666c 7573 6820 3d20 5472 7565 290a 2020  flush = True).  
-00086610: 2020 2020 2020 2020 2020 6764 5f73 656c            gd_sel
-00086620: 2c20 7365 715f 6e65 772c 2073 6e76 5f69  , seq_new, snv_i
-00086630: 6e66 6f5f 6368 722c 206f 662c 2063 6872  nfo_chr, of, chr
-00086640: 6d2c 2065 7374 6174 203d 206d 635f 636f  m, estat = mc_co
-00086650: 7265 5f72 6563 6f6e 7374 7275 6374 696f  re_reconstructio
-00086660: 6e28 6767 635f 7475 706c 655b 6b6b 5d29  n(ggc_tuple[kk])
-00086670: 0a20 2020 2020 2020 2020 2020 2023 2323  .            ###
-00086680: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086690: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
-000866a0: 2020 2020 6765 6e6f 6d65 5b63 6872 6d5d      genome[chrm]
-000866b0: 2e73 6571 203d 2073 6571 5f6e 6577 0a20  .seq = seq_new. 
-000866c0: 2020 2020 2020 2020 2020 206f 665f 6469             of_di
-000866d0: 6374 5b63 6872 6d5d 203d 206f 660a 2020  ct[chrm] = of.  
-000866e0: 2020 2020 2020 2020 2020 2320 6764 735f            # gds_
-000866f0: 6c73 742e 6170 7065 6e64 2867 645f 7365  lst.append(gd_se
-00086700: 6c29 0a20 2020 2020 2020 2020 2020 2023  l).            #
-00086710: 2073 6e76 5f6c 7374 2e61 7070 656e 6428   snv_lst.append(
-00086720: 736e 765f 696e 666f 5f63 6872 290a 2020  snv_info_chr).  
-00086730: 2020 2020 2020 2020 2020 6764 735f 6e65            gds_ne
-00086740: 7720 3d20 6764 735f 6e65 7720 2b20 6764  w = gds_new + gd
-00086750: 5f73 656c 0a20 2020 2020 2020 2020 2020  _sel.           
-00086760: 2073 6e76 5f69 6e66 6f5f 6c73 7420 3d20   snv_info_lst = 
-00086770: 736e 765f 696e 666f 5f6c 7374 202b 2073  snv_info_lst + s
-00086780: 6e76 5f69 6e66 6f5f 6368 720a 0a20 2020  nv_info_chr..   
-00086790: 2020 2020 2020 2020 206e 6274 2c20 6e62           nbt, nb
-000867a0: 652c 206e 6c74 2c20 6e6c 652c 206e 742c  e, nlt, nle, nt,
-000867b0: 206e 653d 2065 7374 6174 0a20 2020 2020   ne= estat.     
-000867c0: 2020 2020 2020 206e 5f62 6173 6573 5f74         n_bases_t
-000867d0: 6f74 616c 202b 3d20 6e62 740a 2020 2020  otal += nbt.    
-000867e0: 2020 2020 2020 2020 6e5f 6572 5f62 6173          n_er_bas
-000867f0: 6573 202b 3d20 6e62 650a 2020 2020 2020  es += nbe.      
-00086800: 2020 2020 2020 6e5f 626c 6b5f 746f 7461        n_blk_tota
-00086810: 6c20 2b3d 206e 6c74 0a20 2020 2020 2020  l += nlt.       
-00086820: 2020 2020 206e 5f65 725f 626c 6b20 2b3d       n_er_blk +=
-00086830: 206e 6c65 0a20 2020 2020 2020 2020 2020   nle.           
-00086840: 206e 7074 202b 3d20 6e74 0a20 2020 2020   npt += nt.     
-00086850: 2020 2020 2020 206e 7065 202b 3d20 6e65         npe += ne
-00086860: 0a20 2020 2020 2020 2020 2020 2023 2323  .            ###
-00086870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086880: 2323 2323 2323 230a 2020 2020 656c 7365  #######.    else
-00086890: 3a0a 2020 2020 2020 2020 6e75 6d5f 636f  :.        num_co
-000868a0: 7265 203d 206d 696e 2820 6e5f 636f 7265  re = min( n_core
-000868b0: 732c 2028 6370 755f 636f 756e 7428 2920  s, (cpu_count() 
-000868c0: 2d20 3129 2029 0a20 2020 2020 2020 2023  - 1) ).        #
-000868d0: 2070 7269 6e74 2822 6e75 6d20 636f 7265   print("num core
-000868e0: 7320 746f 2075 7365 203d 207b 7d22 2e66  s to use = {}".f
-000868f0: 6f72 6d61 7428 6e75 6d5f 636f 7265 2929  ormat(num_core))
-00086900: 0a20 2020 2020 2020 2070 6f6f 6c20 3d20  .        pool = 
-00086910: 506f 6f6c 286e 756d 5f63 6f72 6529 0a20  Pool(num_core). 
-00086920: 2020 2020 2020 2063 6e74 203d 2031 0a20         cnt = 1. 
-00086930: 2020 2020 2020 2066 6f72 2067 645f 7365         for gd_se
-00086940: 6c2c 2073 6571 5f6e 6577 2c20 736e 765f  l, seq_new, snv_
-00086950: 696e 666f 5f63 6872 2c20 6f66 2c20 6368  info_chr, of, ch
-00086960: 726d 2c20 6573 7461 7420 696e 205c 0a20  rm, estat in \. 
-00086970: 2020 2020 2020 2020 2020 2070 6f6f 6c2e             pool.
-00086980: 696d 6170 5f75 6e6f 7264 6572 6564 286d  imap_unordered(m
-00086990: 635f 636f 7265 5f72 6563 6f6e 7374 7275  c_core_reconstru
-000869a0: 6374 696f 6e2c 2067 6763 5f74 7570 6c65  ction, ggc_tuple
-000869b0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-000869c0: 2074 7164 6d2e 7471 646d 5f6e 6f74 6562   tqdm.tqdm_noteb
-000869d0: 6f6f 6b28 706f 6f6c 2e69 6d61 705f 756e  ook(pool.imap_un
-000869e0: 6f72 6465 7265 6428 6d63 5f63 6f72 655f  ordered(mc_core_
-000869f0: 7265 636f 6e73 7472 7563 7469 6f6e 2c20  reconstruction, 
-00086a00: 6767 635f 7475 706c 6529 2c20 746f 7461  ggc_tuple), tota
-00086a10: 6c3d 6c65 6e28 6767 635f 7475 706c 6529  l=len(ggc_tuple)
-00086a20: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-00086a30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086a40: 2323 2323 2323 2323 230a 2020 2020 2020  #########.      
-00086a50: 2020 2020 2020 6765 6e6f 6d65 5b63 6872        genome[chr
-00086a60: 6d5d 2e73 6571 203d 2073 6571 5f6e 6577  m].seq = seq_new
-00086a70: 0a20 2020 2020 2020 2020 2020 206f 665f  .            of_
-00086a80: 6469 6374 5b63 6872 6d5d 203d 206f 660a  dict[chrm] = of.
-00086a90: 2020 2020 2020 2020 2020 2020 2320 6764              # gd
-00086aa0: 735f 6c73 742e 6170 7065 6e64 2867 645f  s_lst.append(gd_
-00086ab0: 7365 6c29 0a20 2020 2020 2020 2020 2020  sel).           
-00086ac0: 2023 2073 6e76 5f6c 7374 2e61 7070 656e   # snv_lst.appen
-00086ad0: 6428 736e 765f 696e 666f 5f63 6872 290a  d(snv_info_chr).
-00086ae0: 2020 2020 2020 2020 2020 2020 6764 735f              gds_
-00086af0: 6e65 7720 3d20 6764 735f 6e65 7720 2b20  new = gds_new + 
-00086b00: 6764 5f73 656c 0a20 2020 2020 2020 2020  gd_sel.         
-00086b10: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
-00086b20: 3d20 736e 765f 696e 666f 5f6c 7374 202b  = snv_info_lst +
-00086b30: 2073 6e76 5f69 6e66 6f5f 6368 720a 2020   snv_info_chr.  
-00086b40: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00086b50: 2020 2020 2020 206e 6274 2c20 6e62 652c         nbt, nbe,
-00086b60: 206e 6c74 2c20 6e6c 652c 206e 742c 206e   nlt, nle, nt, n
-00086b70: 653d 2065 7374 6174 0a20 2020 2020 2020  e= estat.       
-00086b80: 2020 2020 206e 5f62 6173 6573 5f74 6f74       n_bases_tot
-00086b90: 616c 202b 3d20 6e62 740a 2020 2020 2020  al += nbt.      
-00086ba0: 2020 2020 2020 6e5f 6572 5f62 6173 6573        n_er_bases
-00086bb0: 202b 3d20 6e62 650a 2020 2020 2020 2020   += nbe.        
-00086bc0: 2020 2020 6e5f 626c 6b5f 746f 7461 6c20      n_blk_total 
-00086bd0: 2b3d 206e 6c74 0a20 2020 2020 2020 2020  += nlt.         
-00086be0: 2020 206e 5f65 725f 626c 6b20 2b3d 206e     n_er_blk += n
-00086bf0: 6c65 0a20 2020 2020 2020 2020 2020 206e  le.            n
-00086c00: 7074 202b 3d20 6e74 0a20 2020 2020 2020  pt += nt.       
-00086c10: 2020 2020 206e 7065 202b 3d20 6e65 0a20       npe += ne. 
-00086c20: 2020 2020 2020 2020 2020 2023 2323 2323             #####
-00086c30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00086c40: 2323 2323 230a 2020 2020 2020 2020 2020  #####.          
-00086c50: 2020 636e 7420 2b3d 2031 0a20 2020 2020    cnt += 1.     
-00086c60: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
-00086c70: 5265 636f 6e73 7472 7563 7469 6e67 2028  Reconstructing (
-00086c80: 2569 2920 2e2e 2025 692f 2569 2028 2573  %i) .. %i/%i (%s
-00086c90: 2920 2020 2020 2020 2020 2020 2027 2025  )            ' %
-00086ca0: 2028 6e75 6d5f 636f 7265 2c20 636e 742c   (num_core, cnt,
-00086cb0: 206c 656e 2867 6763 5f74 7570 6c65 292c   len(ggc_tuple),
-00086cc0: 2063 6872 6d29 2c20 656e 6420 3d20 2720   chrm), end = ' 
-00086cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086ce0: 2020 2020 2729 0a20 2020 2020 2020 2020      ').         
-00086cf0: 2020 200a 2020 2020 2020 2020 706f 6f6c     .        pool
-00086d00: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-00086d10: 2070 6f6f 6c2e 6a6f 696e 2829 0a20 2020   pool.join().   
-00086d20: 2020 2020 200a 2020 2020 2727 270a 2020       .    '''.  
-00086d30: 2020 6764 735f 6e65 7720 3d20 5b5d 0a20    gds_new = []. 
-00086d40: 2020 2073 6e76 5f69 6e66 6f5f 6c73 7420     snv_info_lst 
-00086d50: 3d20 5b5d 0a20 2020 2066 6f72 206b 6b2c  = [].    for kk,
-00086d60: 2063 6872 6d20 696e 2065 6e75 6d65 7261   chrm in enumera
-00086d70: 7465 2863 6872 5f6c 7374 293a 0a20 2020  te(chr_lst):.   
-00086d80: 2020 2020 2067 6473 5f6e 6577 203d 2067       gds_new = g
-00086d90: 6473 5f6e 6577 202b 2067 6473 5f6c 7374  ds_new + gds_lst
-00086da0: 5b6b 6b5d 0a20 2020 2020 2020 2073 6e76  [kk].        snv
-00086db0: 5f69 6e66 6f5f 6c73 7420 3d20 736e 765f  _info_lst = snv_
-00086dc0: 696e 666f 5f6c 7374 202b 2073 6e76 5f6c  info_lst + snv_l
-00086dd0: 7374 5b6b 6b5d 0a0a 2020 2020 6465 6c20  st[kk]..    del 
-00086de0: 6764 735f 6c73 740a 2020 2020 2327 2727  gds_lst.    #'''
-00086df0: 0a20 2020 2020 0a20 2020 2065 6c61 7073  .     .    elaps
-00086e00: 6564 5f74 696d 6532 203d 2074 696d 652e  ed_time2 = time.
-00086e10: 7469 6d65 2829 202d 2073 7461 7274 5f74  time() - start_t
-00086e20: 696d 650a 2020 2020 7072 696e 7428 275c  ime.    print('\
-00086e30: 7252 6563 6f6e 7374 7275 6374 696f 6e20  rReconstruction 
-00086e40: 2e2e 2064 6f6e 652e 2028 2569 2920 2020  .. done. (%i)   
-00086e50: 2020 2020 2020 2020 2027 2025 2028 656c           ' % (el
-00086e60: 6170 7365 645f 7469 6d65 3229 2c20 666c  apsed_time2), fl
-00086e70: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
-00086e80: 7072 696e 7428 2749 6e74 6567 7269 7479  print('Integrity
-00086e90: 2063 6865 636b 3a20 2025 692f 2569 2c20   check:  %i/%i, 
-00086ea0: 2569 2f25 692c 2025 692f 2569 2720 2520  %i/%i, %i/%i' % 
-00086eb0: 5c0a 2020 2020 2020 2020 2020 286e 5f65  \.          (n_e
-00086ec0: 725f 6261 7365 732c 206e 5f62 6173 6573  r_bases, n_bases
-00086ed0: 5f74 6f74 616c 2c20 6e5f 6572 5f62 6c6b  _total, n_er_blk
-00086ee0: 2c20 6e5f 626c 6b5f 746f 7461 6c2c 206e  , n_blk_total, n
-00086ef0: 7065 2c20 6e70 7429 2c20 666c 7573 6820  pe, npt), flush 
-00086f00: 3d20 5472 7565 2029 0a20 2020 2020 200a  = True ).      .
-00086f10: 2020 2020 2727 2720 200a 2020 2020 4e74      '''  .    Nt
-00086f20: 725f 616c 6c20 3d20 300a 2020 2020 666f  r_all = 0.    fo
-00086f30: 7220 6764 2069 6e20 6764 735f 6e65 773a  r gd in gds_new:
-00086f40: 204e 7472 5f61 6c6c 202b 3d20 6764 2e6e   Ntr_all += gd.n
-00086f50: 7472 0a20 2020 2070 7269 6e74 2827 4e5f  tr.    print('N_
-00086f60: 7472 2028 6166 7465 7229 203d 2025 6927  tr (after) = %i'
-00086f70: 2025 204e 7472 5f61 6c6c 290a 0a20 2020   % Ntr_all)..   
-00086f80: 206e 5f74 7220 3d20 300a 2020 2020 6e5f   n_tr = 0.    n_
-00086f90: 6e65 675f 636f 7620 3d20 300a 2020 2020  neg_cov = 0.    
-00086fa0: 6e5f 706f 735f 636f 7620 3d20 300a 2020  n_pos_cov = 0.  
-00086fb0: 2020 666f 7220 6764 2069 6e20 6764 735f    for gd in gds_
-00086fc0: 6e65 773a 0a20 2020 2020 2020 206e 5f74  new:.        n_t
-00086fd0: 7220 2b3d 2067 642e 6e74 720a 2020 2020  r += gd.ntr.    
-00086fe0: 2020 2020 666f 7220 7464 2069 6e20 6764      for td in gd
-00086ff0: 2e74 645f 6c73 743a 0a20 2020 2020 2020  .td_lst:.       
-00087000: 2020 2020 2069 6620 7464 2e63 6f76 203c       if td.cov <
-00087010: 3d20 303a 206e 5f6e 6567 5f63 6f76 202b  = 0: n_neg_cov +
-00087020: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00087030: 656c 6966 2074 642e 636f 7620 3e20 303a  elif td.cov > 0:
-00087040: 206e 5f70 6f73 5f63 6f76 202b 3d20 310a   n_pos_cov += 1.
-00087050: 2020 2020 7072 696e 7428 274e 5f74 7273      print('N_trs
-00087060: 203d 2025 692c 2025 692c 2025 6927 2025   = %i, %i, %i' %
-00087070: 2028 6e5f 7472 2c20 6e5f 6e65 675f 636f   (n_tr, n_neg_co
-00087080: 762c 206e 5f70 6f73 5f63 6f76 2929 0a20  v, n_pos_cov)). 
-00087090: 2020 2023 2727 270a 2020 2020 2020 2020     #'''.        
-000870a0: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
-000870b0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-000870c0: 2020 6774 665f 6c69 6e65 7320 3d20 5b5d    gtf_lines = []
-000870d0: 0a20 2020 2066 615f 6c69 6e65 735f 7472  .    fa_lines_tr
-000870e0: 203d 205b 5d0a 2020 2020 6661 5f6c 696e   = [].    fa_lin
-000870f0: 6573 5f70 7220 3d20 5b5d 0a0a 2020 2020  es_pr = []..    
-00087100: 2320 7361 7665 5f67 7466 3228 2066 6e61  # save_gtf2( fna
-00087110: 6d65 2c20 6774 665f 6c69 6e65 5f6c 7374  me, gtf_line_lst
-00087120: 203d 204e 6f6e 652c 2068 6472 203d 204e   = None, hdr = N
-00087130: 6f6e 652c 2066 6f20 3d20 4e6f 6e65 2063  one, fo = None c
-00087140: 6c6f 7365 203d 2046 616c 7365 2029 0a20  lose = False ). 
-00087150: 2020 200a 2020 2020 6966 2072 6576 3a20     .    if rev: 
-00087160: 0a20 2020 2020 2020 2068 6472 5f6c 696e  .        hdr_lin
-00087170: 6573 2e61 7070 656e 6428 2752 6566 2e20  es.append('Ref. 
-00087180: 6765 6e6f 6d65 3a20 2573 2720 2520 6765  genome: %s' % ge
-00087190: 6e6f 6d65 5f66 696c 6529 0a20 2020 2020  nome_file).     
-000871a0: 2020 2066 5f67 7466 203d 2073 6176 655f     f_gtf = save_
-000871b0: 6774 6632 2820 6774 665f 6669 6c65 5f6e  gtf2( gtf_file_n
-000871c0: 6577 2c20 6774 665f 6c69 6e65 5f6c 7374  ew, gtf_line_lst
-000871d0: 203d 204e 6f6e 652c 2068 6472 203d 2068   = None, hdr = h
-000871e0: 6472 5f6c 696e 6573 2029 0a0a 2020 2020  dr_lines )..    
-000871f0: 6674 203d 206f 7065 6e28 6661 5f66 696c  ft = open(fa_fil
-00087200: 655f 7472 5f6e 6577 2c20 2777 2b27 290a  e_tr_new, 'w+').
-00087210: 2020 2020 6670 203d 206f 7065 6e28 6661      fp = open(fa
-00087220: 5f66 696c 655f 7072 5f6e 6577 2c20 2777  _file_pr_new, 'w
-00087230: 2b27 290a 0a20 2020 2067 6473 5f6e 6577  +')..    gds_new
-00087240: 203d 2073 6f72 745f 6465 7363 7269 7074   = sort_descript
-00087250: 6f72 5f6c 7374 2867 6473 5f6e 6577 290a  or_lst(gds_new).
-00087260: 2020 2020 636e 745f 6e6f 6e65 203d 2030      cnt_none = 0
-00087270: 0a20 2020 2070 7269 6e74 2827 4765 6e65  .    print('Gene
-00087280: 7261 7469 6e67 2047 5446 2061 6e64 2054  rating GTF and T
-00087290: 7261 6e73 6372 6970 746f 6d65 2f50 726f  ranscriptome/Pro
-000872a0: 7465 6f6d 6520 2e2e 2027 2c20 656e 643d  teome .. ', end=
-000872b0: 2720 2020 2027 290a 0a20 2020 2069 6620  '    ')..    if 
-000872c0: 6e5f 636f 7265 7320 3d3d 2031 3a0a 2020  n_cores == 1:.  
-000872d0: 2020 2020 2020 636e 745f 7420 3d20 300a        cnt_t = 0.
-000872e0: 2020 2020 2020 2020 636e 745f 7020 3d20          cnt_p = 
-000872f0: 300a 2020 2020 2020 2020 666f 7220 6d2c  0.        for m,
-00087300: 2067 6420 696e 2065 6e75 6d65 7261 7465   gd in enumerate
-00087310: 2867 6473 5f6e 6577 293a 0a20 2020 2020  (gds_new):.     
-00087320: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00087330: 2020 2020 6966 2028 6d2b 3129 2531 3030      if (m+1)%100
-00087340: 203d 3d20 303a 2070 7269 6e74 2827 5c72   == 0: print('\r
-00087350: 4765 6e65 7261 7469 6e67 2047 5446 2061  Generating GTF a
-00087360: 6e64 2054 7261 6e73 6372 6970 746f 6d65  nd Transcriptome
-00087370: 2f50 726f 7465 6f6d 6520 2e2e 2025 692f  /Proteome .. %i/
-00087380: 2569 2720 2520 286d 2c20 6c65 6e28 6764  %i' % (m, len(gd
-00087390: 735f 6e65 7729 292c 2065 6e64 203d 2027  s_new)), end = '
-000873a0: 2020 2027 2c20 666c 7573 6820 3d20 5472     ', flush = Tr
-000873b0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-000873c0: 6e74 722c 206e 7072 2c20 6e65 7220 3d20  ntr, npr, ner = 
-000873d0: 6764 2e75 7064 6174 655f 7464 5f69 6e66  gd.update_td_inf
-000873e0: 6f28 7365 6c20 3d20 312c 2070 6570 7469  o(sel = 1, pepti
-000873f0: 6465 203d 2054 7275 6529 2020 2020 2020  de = True)      
-00087400: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00087410: 2020 2067 7466 6c2c 2063 6e20 3d20 6764     gtfl, cn = gd
-00087420: 2e67 6574 5f67 7466 5f6c 696e 6573 5f66  .get_gtf_lines_f
-00087430: 726f 6d5f 6578 6f6e 7328 7365 6c20 3d20  rom_exons(sel = 
-00087440: 312c 2061 6464 5f73 6571 203d 2046 616c  1, add_seq = Fal
-00087450: 7365 2c20 636f 6e6e 6563 7420 3d20 5472  se, connect = Tr
-00087460: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00087470: 636e 745f 6e6f 6e65 202b 3d20 636e 0a20  cnt_none += cn. 
-00087480: 2020 2020 2020 2020 2020 206c 742c 206c             lt, l
-00087490: 7020 3d20 6764 2e67 6574 5f66 6173 7461  p = gd.get_fasta
-000874a0: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
-000874b0: 7328 7365 6c20 3d20 312c 2070 6570 7469  s(sel = 1, pepti
-000874c0: 6465 203d 2054 7275 6529 0a20 2020 2020  de = True).     
-000874d0: 2020 2020 2020 206c 7420 3d20 6669 6c74         lt = filt
-000874e0: 6572 5f74 7273 5f6c 656e 286c 742c 206d  er_trs_len(lt, m
-000874f0: 696e 5f6c 656e 203d 204d 494e 5f54 525f  in_len = MIN_TR_
-00087500: 4c45 4e47 5448 290a 2020 2020 2020 2020  LENGTH).        
-00087510: 2020 2020 6c70 203d 2066 696c 7465 725f      lp = filter_
-00087520: 7472 735f 6c65 6e28 6c70 2c20 6d69 6e5f  trs_len(lp, min_
-00087530: 6c65 6e20 3d20 4d49 4e5f 5052 5f4c 454e  len = MIN_PR_LEN
-00087540: 4754 4829 0a20 2020 2020 2020 2020 2020  GTH).           
-00087550: 2069 6620 7265 763a 0a20 2020 2020 2020   if rev:.       
-00087560: 2020 2020 2020 2020 2066 5f67 7466 203d           f_gtf =
-00087570: 2073 6176 655f 6774 6632 2820 6774 665f   save_gtf2( gtf_
-00087580: 6669 6c65 5f6e 6577 2c20 6774 665f 6c69  file_new, gtf_li
-00087590: 6e65 5f6c 7374 203d 2067 7466 6c2c 2066  ne_lst = gtfl, f
-000875a0: 6f20 3d20 665f 6774 6620 2920 0a20 2020  o = f_gtf ) .   
-000875b0: 2020 2020 2020 2020 2020 2020 2023 2067               # g
-000875c0: 7466 5f6c 696e 6573 203d 2067 7466 5f6c  tf_lines = gtf_l
-000875d0: 696e 6573 202b 2067 7466 6c0a 2020 2020  ines + gtfl.    
-000875e0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-000875f0: 2066 742e 7772 6974 656c 696e 6573 286c   ft.writelines(l
-00087600: 7429 0a20 2020 2020 2020 2020 2020 2066  t).            f
-00087610: 702e 7772 6974 656c 696e 6573 286c 7029  p.writelines(lp)
-00087620: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-00087630: 615f 6c69 6e65 735f 7472 203d 2066 615f  a_lines_tr = fa_
-00087640: 6c69 6e65 735f 7472 202b 206c 740a 2020  lines_tr + lt.  
-00087650: 2020 2020 2020 2020 2020 2320 6661 5f6c            # fa_l
-00087660: 696e 6573 5f70 7220 3d20 6661 5f6c 696e  ines_pr = fa_lin
-00087670: 6573 5f70 7220 2b20 6c70 0a20 2020 2020  es_pr + lp.     
-00087680: 2020 2020 2020 2063 6e74 5f74 202b 3d20         cnt_t += 
-00087690: 6c65 6e28 6c74 290a 2020 2020 2020 2020  len(lt).        
-000876a0: 2020 2020 636e 745f 7020 2b3d 206c 656e      cnt_p += len
-000876b0: 286c 7029 0a20 2020 2020 2020 2020 2020  (lp).           
-000876c0: 200a 2020 2020 2020 2020 656c 6170 7365   .        elapse
-000876d0: 645f 7469 6d65 3220 3d20 7469 6d65 2e74  d_time2 = time.t
-000876e0: 696d 6528 2920 2d20 7374 6172 745f 7469  ime() - start_ti
-000876f0: 6d65 0a20 2020 2020 2020 2070 7269 6e74  me.        print
-00087700: 2827 5c72 4765 6e65 7261 7469 6e67 2047  ('\rGenerating G
-00087710: 5446 2061 6e64 2054 7261 6e73 6372 6970  TF and Transcrip
-00087720: 746f 6d65 2f50 726f 7465 6f6d 6520 2e2e  tome/Proteome ..
-00087730: 2025 692c 2025 6920 646f 6e65 2e20 2825   %i, %i done. (%
-00087740: 6929 2027 2025 2028 6c65 6e28 6764 735f  i) ' % (len(gds_
-00087750: 6e65 7729 2c20 636e 745f 6e6f 6e65 2c20  new), cnt_none, 
-00087760: 656c 6170 7365 645f 7469 6d65 3229 2c20  elapsed_time2), 
-00087770: 666c 7573 6820 3d20 5472 7565 290a 0a20  flush = True).. 
-00087780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00087790: 206e 756d 5f63 6f72 6520 3d20 6d69 6e28   num_core = min(
-000877a0: 206e 5f63 6f72 6573 2c20 2863 7075 5f63   n_cores, (cpu_c
-000877b0: 6f75 6e74 2829 202d 2031 2920 290a 2020  ount() - 1) ).  
-000877c0: 2020 2020 2020 2320 7072 696e 7428 226e        # print("n
-000877d0: 756d 2063 6f72 6573 2074 6f20 7573 6520  um cores to use 
-000877e0: 3d20 7b7d 222e 666f 726d 6174 286e 756d  = {}".format(num
-000877f0: 5f63 6f72 6529 290a 2020 2020 2020 2020  _core)).        
-00087800: 706f 6f6c 203d 2050 6f6f 6c28 6e75 6d5f  pool = Pool(num_
-00087810: 636f 7265 290a 2020 2020 2020 2020 636e  core).        cn
-00087820: 7420 3d20 310a 2020 2020 2020 2020 636e  t = 1.        cn
-00087830: 745f 7420 3d20 300a 2020 2020 2020 2020  t_t = 0.        
-00087840: 636e 745f 7020 3d20 300a 2020 2020 2020  cnt_p = 0.      
-00087850: 2020 666f 7220 6774 666c 2c20 6c74 2c20    for gtfl, lt, 
-00087860: 6c70 2c20 6368 726d 2c20 6e65 2c20 636e  lp, chrm, ne, cn
-00087870: 2069 6e20 706f 6f6c 2e6d 6170 286d 635f   in pool.map(mc_
-00087880: 636f 7265 5f67 6574 5f67 7466 5f61 6e64  core_get_gtf_and
-00087890: 5f66 6173 7461 5f70 742c 2067 6473 5f6e  _fasta_pt, gds_n
-000878a0: 6577 293a 0a20 2020 2020 2020 2020 2020  ew):.           
-000878b0: 200a 2020 2020 2020 2020 2020 2020 636e   .            cn
-000878c0: 745f 6e6f 6e65 202b 3d20 636e 0a20 2020  t_none += cn.   
-000878d0: 2020 2020 2020 2020 2069 6620 2863 6e74           if (cnt
-000878e0: 2b31 2925 3130 3020 3d3d 2030 3a0a 2020  +1)%100 == 0:.  
-000878f0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00087900: 696e 7428 275c 7247 656e 6572 6174 696e  int('\rGeneratin
-00087910: 6720 4754 4620 616e 6420 5472 616e 7363  g GTF and Transc
-00087920: 7269 7074 6f6d 652f 5072 6f74 656f 6d65  riptome/Proteome
-00087930: 202e 2e20 2569 2f25 6927 2025 2028 636e   .. %i/%i' % (cn
-00087940: 742c 206c 656e 2867 6473 5f6e 6577 2929  t, len(gds_new))
-00087950: 2c20 656e 6420 3d20 2720 2020 2729 0a20  , end = '   '). 
-00087960: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00087970: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-00087980: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
-00087990: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-000879a0: 2020 6c74 203d 2066 696c 7465 725f 7472    lt = filter_tr
-000879b0: 735f 6c65 6e28 6c74 2c20 6d69 6e5f 6c65  s_len(lt, min_le
-000879c0: 6e20 3d20 4d49 4e5f 5452 5f4c 454e 4754  n = MIN_TR_LENGT
-000879d0: 4829 0a20 2020 2020 2020 2020 2020 206c  H).            l
-000879e0: 7020 3d20 6669 6c74 6572 5f74 7273 5f6c  p = filter_trs_l
-000879f0: 656e 286c 702c 206d 696e 5f6c 656e 203d  en(lp, min_len =
-00087a00: 204d 494e 5f50 525f 4c45 4e47 5448 290a   MIN_PR_LENGTH).
-00087a10: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00087a20: 6576 3a0a 2020 2020 2020 2020 2020 2020  ev:.            
-00087a30: 2020 2020 665f 6774 6620 3d20 7361 7665      f_gtf = save
-00087a40: 5f67 7466 3228 2067 7466 5f66 696c 655f  _gtf2( gtf_file_
-00087a50: 6e65 772c 2067 7466 5f6c 696e 655f 6c73  new, gtf_line_ls
-00087a60: 7420 3d20 6774 666c 2c20 666f 203d 2066  t = gtfl, fo = f
-00087a70: 5f67 7466 2029 2020 0a20 2020 2020 2020  _gtf )  .       
-00087a80: 2020 2020 2020 2020 2023 2067 7466 5f6c           # gtf_l
-00087a90: 696e 6573 203d 2067 7466 5f6c 696e 6573  ines = gtf_lines
-00087aa0: 202b 2067 7466 6c0a 0a20 2020 2020 2020   + gtfl..       
-00087ab0: 2020 2020 2066 742e 7772 6974 656c 696e       ft.writelin
-00087ac0: 6573 286c 7429 0a20 2020 2020 2020 2020  es(lt).         
-00087ad0: 2020 2066 702e 7772 6974 656c 696e 6573     fp.writelines
-00087ae0: 286c 7029 0a20 2020 2020 2020 2020 2020  (lp).           
-00087af0: 2023 2066 615f 6c69 6e65 735f 7472 203d   # fa_lines_tr =
-00087b00: 2066 615f 6c69 6e65 735f 7472 202b 206c   fa_lines_tr + l
-00087b10: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
-00087b20: 6661 5f6c 696e 6573 5f70 7220 3d20 6661  fa_lines_pr = fa
-00087b30: 5f6c 696e 6573 5f70 7220 2b20 6c70 0a20  _lines_pr + lp. 
-00087b40: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
-00087b50: 202b 3d20 6c65 6e28 6c74 290a 2020 2020   += len(lt).    
-00087b60: 2020 2020 2020 2020 636e 745f 7020 2b3d          cnt_p +=
-00087b70: 206c 656e 286c 7029 0a20 2020 2020 2020   len(lp).       
-00087b80: 2020 2020 200a 2020 2020 2020 2020 706f       .        po
-00087b90: 6f6c 2e63 6c6f 7365 2829 0a20 2020 2020  ol.close().     
-00087ba0: 2020 2070 6f6f 6c2e 6a6f 696e 2829 0a0a     pool.join()..
-00087bb0: 2020 2020 2020 2020 656c 6170 7365 645f          elapsed_
-00087bc0: 7469 6d65 3220 3d20 7469 6d65 2e74 696d  time2 = time.tim
-00087bd0: 6528 2920 2d20 7374 6172 745f 7469 6d65  e() - start_time
-00087be0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00087bf0: 5c72 4765 6e65 7261 7469 6e67 2047 5446  \rGenerating GTF
-00087c00: 2061 6e64 2054 7261 6e73 6372 6970 746f   and Transcripto
-00087c10: 6d65 2f50 726f 7465 6f6d 6520 2e2e 2064  me/Proteome .. d
-00087c20: 6f6e 652e 2025 692c 2025 692c 2025 6920  one. %i, %i, %i 
-00087c30: 2825 6929 2027 2025 205c 0a20 2020 2020  (%i) ' % \.     
-00087c40: 2020 2020 2020 2020 2028 636e 745f 6e6f           (cnt_no
-00087c50: 6e65 2c20 696e 7428 636e 745f 742f 3229  ne, int(cnt_t/2)
-00087c60: 2c20 696e 7428 636e 745f 702f 3229 2c20  , int(cnt_p/2), 
-00087c70: 656c 6170 7365 645f 7469 6d65 3229 290a  elapsed_time2)).
-00087c80: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
-00087c90: 7265 763a 2073 6176 655f 6774 6632 2820  rev: save_gtf2( 
-00087ca0: 6774 665f 6669 6c65 5f6e 6577 2c20 6774  gtf_file_new, gt
-00087cb0: 665f 6c69 6e65 5f6c 7374 203d 204e 6f6e  f_line_lst = Non
-00087cc0: 652c 2066 6f20 3d20 665f 6774 662c 2063  e, fo = f_gtf, c
-00087cd0: 6c6f 7365 203d 2054 7275 6520 290a 2020  lose = True ).  
-00087ce0: 2020 6674 2e63 6c6f 7365 2829 0a20 2020    ft.close().   
-00087cf0: 2066 702e 636c 6f73 6528 290a 0a20 2020   fp.close()..   
-00087d00: 2023 2064 656c 2067 6473 5f6e 6577 0a0a   # del gds_new..
-00087d10: 2020 2020 2727 2720 2020 200a 2020 2020      '''    .    
-00087d20: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
-00087d30: 652e 7469 6d65 2829 0a20 2020 2070 7269  e.time().    pri
-00087d40: 6e74 2827 5361 7669 6e67 2046 4153 5441  nt('Saving FASTA
-00087d50: 2028 2569 2c20 2569 202f 2025 6929 202e   (%i, %i / %i) .
-00087d60: 2e27 2025 2028 6c65 6e28 6661 5f6c 696e  .' % (len(fa_lin
-00087d70: 6573 5f74 7229 2f32 2c20 6c65 6e28 6661  es_tr)/2, len(fa
-00087d80: 5f6c 696e 6573 5f70 7229 2f32 2c20 6e5f  _lines_pr)/2, n_
-00087d90: 7472 292c 2065 6e64 203d 2027 272c 2066  tr), end = '', f
-00087da0: 6c75 7368 203d 2054 7275 6529 0a20 2020  lush = True).   
-00087db0: 2066 203d 206f 7065 6e28 6661 5f66 696c   f = open(fa_fil
-00087dc0: 655f 7472 5f6e 6577 2c20 2777 2b27 290a  e_tr_new, 'w+').
-00087dd0: 2020 2020 662e 7772 6974 656c 696e 6573      f.writelines
-00087de0: 2866 615f 6c69 6e65 735f 7472 290a 2020  (fa_lines_tr).  
-00087df0: 2020 662e 636c 6f73 6528 290a 0a20 2020    f.close()..   
-00087e00: 2070 7269 6e74 2827 2e27 2c20 656e 643d   print('.', end=
-00087e10: 2727 290a 2020 2020 6620 3d20 6f70 656e  '').    f = open
-00087e20: 2866 615f 6669 6c65 5f70 725f 6e65 772c  (fa_file_pr_new,
-00087e30: 2027 772b 2729 0a20 2020 2066 2e77 7269   'w+').    f.wri
-00087e40: 7465 6c69 6e65 7328 6661 5f6c 696e 6573  telines(fa_lines
-00087e50: 5f70 7229 0a20 2020 2066 2e63 6c6f 7365  _pr).    f.close
-00087e60: 2829 0a0a 2020 2020 656c 6170 7365 645f  ()..    elapsed_
-00087e70: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-00087e80: 2829 202d 2073 7461 7274 5f74 696d 650a  () - start_time.
-00087e90: 2020 2020 7072 696e 7428 2720 646f 6e65      print(' done
-00087ea0: 2e20 2825 6929 2720 2520 2865 6c61 7073  . (%i)' % (elaps
-00087eb0: 6564 5f74 696d 6529 290a 2020 2020 2727  ed_time)).    ''
-00087ec0: 270a 0a20 2020 2070 7269 6e74 2827 2020  '..    print('  
-00087ed0: 2025 7327 2025 2066 615f 6669 6c65 5f74   %s' % fa_file_t
-00087ee0: 725f 6e65 7720 290a 2020 2020 7072 696e  r_new ).    prin
-00087ef0: 7428 2720 2020 2573 2720 2520 6661 5f66  t('   %s' % fa_f
-00087f00: 696c 655f 7072 5f6e 6577 2029 0a20 2020  ile_pr_new ).   
-00087f10: 2069 6620 7265 763a 2070 7269 6e74 2827   if rev: print('
-00087f20: 2020 2025 7327 2025 2067 7466 5f66 696c     %s' % gtf_fil
-00087f30: 655f 6e65 7729 0a0a 2020 2020 736e 765f  e_new)..    snv_
-00087f40: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
-00087f50: 2073 6e76 2069 6e20 736e 765f 696e 666f   snv in snv_info
-00087f60: 5f6c 7374 3a0a 2020 2020 2020 2020 6e76  _lst:.        nv
-00087f70: 6920 3d20 746f 5f6e 765f 7369 6d70 6c65  i = to_nv_simple
-00087f80: 2820 736e 7620 290a 2020 2020 2020 2020  ( snv ).        
-00087f90: 736e 765f 6c73 742e 6170 7065 6e64 286e  snv_lst.append(n
-00087fa0: 7669 290a 2020 2020 2020 2020 0a20 2020  vi).        .   
-00087fb0: 2064 665f 736e 7620 3d20 7064 2e44 6174   df_snv = pd.Dat
-00087fc0: 6146 7261 6d65 2873 6e76 5f6c 7374 290a  aFrame(snv_lst).
-00087fd0: 2020 2020 6466 5f73 6e76 2e74 6f5f 6373      df_snv.to_cs
-00087fe0: 7628 666e 616d 655f 736e 762c 2073 6570  v(fname_snv, sep
-00087ff0: 203d 2027 5c74 2729 0a20 2020 2070 7269   = '\t').    pri
-00088000: 6e74 2827 534e 5620 7375 6d6d 6172 7920  nt('SNV summary 
-00088010: 7361 7665 6420 746f 205c 6e20 2020 2573  saved to \n   %s
-00088020: 2720 2520 666e 616d 655f 736e 7629 0a20  ' % fname_snv). 
-00088030: 2020 2023 2077 7269 7465 5f74 6f5f 7663     # write_to_vc
-00088040: 6628 2073 6e76 5f69 6e66 6f5f 6c73 742c  f( snv_info_lst,
-00088050: 2066 6e61 6d65 5f76 6366 2029 0a0a 2020   fname_vcf )..  
-00088060: 2020 2327 2727 2020 2020 0a20 2020 2069    #'''    .    i
-00088070: 6620 7265 763a 0a20 2020 2020 2020 2073  f rev:.        s
-00088080: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
-00088090: 2e74 696d 6528 290a 2020 2020 2020 2020  .time().        
-000880a0: 2727 270a 2020 2020 2020 2020 7072 696e  '''.        prin
-000880b0: 7428 2753 6176 696e 6720 6375 7374 6f6d  t('Saving custom
-000880c0: 697a 6564 2067 656e 6f6d 6520 2e2e 2027  ized genome .. '
-000880d0: 2c20 656e 6420 3d20 2727 2c20 666c 7573  , end = '', flus
-000880e0: 6820 3d20 5472 7565 290a 2020 2020 2020  h = True).      
-000880f0: 2020 0a20 2020 2020 2020 2023 2068 6472    .        # hdr
-00088100: 5f6c 696e 6573 2e61 7070 656e 6428 2752  _lines.append('R
-00088110: 6566 2e20 6765 6e6f 6d65 3a20 2573 2720  ef. genome: %s' 
-00088120: 2520 6765 6e6f 6d65 5f66 696c 6529 0a20  % genome_file). 
-00088130: 2020 2020 2020 2023 2073 6176 655f 6774         # save_gt
-00088140: 6628 6774 665f 6669 6c65 5f6e 6577 2c20  f(gtf_file_new, 
-00088150: 6774 665f 6c69 6e65 732c 2068 6472 5f6c  gtf_lines, hdr_l
-00088160: 696e 6573 290a 2020 2020 2020 2020 0a20  ines).        . 
-00088170: 2020 2020 2020 2065 6c61 7073 6564 5f74         elapsed_t
-00088180: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-00088190: 2920 2d20 7374 6172 745f 7469 6d65 0a20  ) - start_time. 
-000881a0: 2020 2020 2020 2070 7269 6e74 2827 2064         print(' d
-000881b0: 6f6e 652e 2025 6928 7329 205c 6e20 2020  one. %i(s) \n   
-000881c0: 2573 2720 2520 2865 6c61 7073 6564 5f74  %s' % (elapsed_t
-000881d0: 696d 652c 2067 7466 5f66 696c 655f 6e65  ime, gtf_file_ne
-000881e0: 7729 290a 2020 2020 2020 2020 2727 270a  w)).        '''.
-000881f0: 2020 2020 2020 2020 2323 2053 6176 6520          ## Save 
-00088200: 6765 6e6f 6d65 2063 6f72 7265 6374 6564  genome corrected
-00088210: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088220: 596f 7520 6172 6520 616c 6d6f 7374 2064  You are almost d
-00088230: 6f6e 652e 205c 6e4c 6173 7420 7374 6570  one. \nLast step
-00088240: 2069 7320 746f 2073 6176 6520 7468 6520   is to save the 
-00088250: 6669 7865 6420 6765 6e6f 6d65 2e20 2729  fixed genome. ')
-00088260: 0a20 2020 2020 2020 2073 6176 655f 6765  .        save_ge
-00088270: 6e6f 6d65 2820 6765 6e6f 6d65 5f66 696c  nome( genome_fil
-00088280: 655f 6e65 772c 2067 656e 6f6d 652c 2076  e_new, genome, v
-00088290: 6572 626f 7365 203d 2054 7275 652c 2074  erbose = True, t
-000882a0: 6974 6c65 203d 2027 4765 6e6f 6d65 2d72  itle = 'Genome-r
-000882b0: 6576 2720 290a 2020 2020 2020 2020 7072  ev' ).        pr
-000882c0: 696e 7428 2720 2020 2573 2720 2520 6765  int('   %s' % ge
-000882d0: 6e6f 6d65 5f66 696c 655f 6e65 7720 290a  nome_file_new ).
-000882e0: 0a20 2020 2070 7269 6e74 2827 5374 7269  .    print('Stri
-000882f0: 6e67 4669 7820 6669 6e69 7368 6564 2027  ngFix finished '
-00088300: 2c20 6461 7465 7469 6d65 2e64 6174 6574  , datetime.datet
-00088310: 696d 652e 6e6f 7728 2929 0a0a 2020 2020  ime.now())..    
-00088320: 7265 7475 726e 2066 6e61 6d65 2c20 6765  return fname, ge
-00088330: 6e6f 6d65 5f66 696c 655f 6e65 7720 232c  nome_file_new #,
-00088340: 2067 6473 5f6e 6577 0a20 2020 2023 2727   gds_new.    #''
-00088350: 2720 2020 200a 0a64 6566 2053 7472 696e  '    ..def Strin
-00088360: 6746 6978 5f61 7373 656d 626c 6528 2049  gFix_assemble( I
-00088370: 6e70 7574 203d 204e 6f6e 652c 2067 656e  nput = None, gen
-00088380: 6f6d 655f 6661 203d 204e 6f6e 652c 2061  ome_fa = None, a
-00088390: 6e6e 6f74 5f67 7466 203d 204e 6f6e 652c  nnot_gtf = None,
-000883a0: 206f 7574 5f64 6972 203d 2027 5346 6978   out_dir = 'SFix
-000883b0: 5f6f 7574 272c 205c 0a20 2020 2020 2020  _out', \.       
-000883c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000883d0: 206e 5f63 6f72 6573 203d 2034 2c20 6f75   n_cores = 4, ou
-000883e0: 745f 6375 7374 6f6d 5f67 656e 6f6d 6520  t_custom_genome 
-000883f0: 3d20 4661 6c73 652c 2073 7566 6669 7820  = False, suffix 
-00088400: 3d20 4e6f 6e65 2c20 5c0a 2020 2020 2020  = None, \.      
-00088410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088420: 2020 6d63 7620 3d20 302e 352c 206d 6364    mcv = 0.5, mcd
-00088430: 203d 2031 2c20 6d74 6c20 3d20 3230 302c   = 1, mtl = 200,
-00088440: 206d 706c 203d 2035 302c 206d 6469 203d   mpl = 50, mdi =
-00088450: 2032 2c20 6d64 6420 3d20 322c 206d 6470   2, mdd = 2, mdp
-00088460: 203d 2033 2c20 5c0a 2020 2020 2020 2020   = 3, \.        
-00088470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088480: 6d64 6620 3d20 302e 322c 206e 5f70 203d  mdf = 0.2, n_p =
-00088490: 2031 362c 2078 7361 203d 2054 7275 652c   16, xsa = True,
-000884a0: 206a 756d 705f 746f 203d 2030 2029 3a0a   jump_to = 0 ):.
-000884b0: 0a20 2020 2070 7269 6e74 2827 2b2d 2d2d  .    print('+---
-000884c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000884d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2b 2729 0a20  -----------+'). 
-000884e0: 2020 2070 7269 6e74 2827 7c20 2020 2020     print('|     
-000884f0: 2053 7472 696e 6766 6978 2076 2e25 7320   Stringfix v.%s 
-00088500: 2020 2020 2020 7c27 2025 2053 7472 696e        |' % Strin
-00088510: 6746 6978 5f76 6572 7369 6f6e 290a 2020  gFix_version).  
-00088520: 2020 7072 696e 7428 272b 2d2d 2d2d 2d2d    print('+------
-00088530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00088540: 2d2d 2d2d 2d2d 2d2d 2b27 290a 0a20 2020  --------+')..   
-00088550: 2069 6620 496e 7075 7420 6973 204e 6f6e   if Input is Non
-00088560: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
-00088570: 2827 5573 6167 653a 2729 0a20 2020 2020  ('Usage:').     
-00088580: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
-00088590: 2720 2520 2761 7267 756d 656e 7427 2c20  ' % 'argument', 
-000885a0: 2764 6573 6372 6970 7469 6f6e 2720 290a  'description' ).
-000885b0: 2020 2020 2020 2020 7072 696e 7428 2725          print('%
-000885c0: 3132 733a 2027 2025 2027 496e 7075 7427  12s: ' % 'Input'
-000885d0: 2c20 2749 6e70 7574 2053 414d 206f 7220  , 'Input SAM or 
-000885e0: 4241 4d20 6669 6c65 2e20 7079 6261 6d2e  BAM file. pybam.
-000885f0: 7079 2069 7320 7265 7175 6972 6564 2066  py is required f
-00088600: 6f72 2042 414d 2069 6e70 7574 2e27 2029  or BAM input.' )
-00088610: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088620: 2531 3273 3a20 2720 2520 2767 656e 6f6d  %12s: ' % 'genom
-00088630: 655f 6661 272c 2065 6e64 203d 2027 2729  e_fa', end = '')
-00088640: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088650: 2047 656e 6f6d 6520 6661 7374 6120 6669   Genome fasta fi
-00088660: 6c65 2075 7365 6420 746f 2067 656e 6572  le used to gener
-00088670: 6174 6520 7468 6520 696e 7075 7420 5341  ate the input SA
-00088680: 4d2f 4241 4d2e 2027 2029 0a20 2020 2020  M/BAM. ' ).     
-00088690: 2020 2070 7269 6e74 2827 2531 3273 2020     print('%12s  
-000886a0: 2049 7420 6973 2075 7365 6420 746f 2063   It is used to c
-000886b0: 6f72 7265 6374 2073 6571 7565 6e63 6573  orrect sequences
-000886c0: 206e 6f74 2063 6f76 6572 6564 2062 7920   not covered by 
-000886d0: 7265 6164 732c 2027 2025 2027 2729 0a20  reads, ' % ''). 
-000886e0: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
-000886f0: 3273 2020 2074 6f20 6964 656e 7469 6679  2s   to identify
-00088700: 2053 4e50 7320 616e 6420 746f 2067 656e   SNPs and to gen
-00088710: 6572 6174 6520 6375 7374 6f6d 697a 6564  erate customized
-00088720: 2067 656e 6f6d 652e 2027 2020 2520 2727   genome. '  % ''
-00088730: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00088740: 2725 3132 733a 2027 2025 2027 616e 6e6f  '%12s: ' % 'anno
-00088750: 745f 6774 6627 2c20 2747 5446 2f47 4646  t_gtf', 'GTF/GFF
-00088760: 2066 696c 6520 746f 2062 6520 7573 6564   file to be used
-00088770: 2066 6f72 2067 7569 6465 2061 6e6e 6f74   for guide annot
-00088780: 6174 696f 6e27 2029 0a20 2020 2020 2020  ation' ).       
-00088790: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
-000887a0: 2520 276f 7574 5f64 6972 272c 2027 4f75  % 'out_dir', 'Ou
-000887b0: 7470 7574 2064 6972 6563 746f 7279 2720  tput directory' 
-000887c0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-000887d0: 2725 3132 733a 2027 2025 2027 6e5f 636f  '%12s: ' % 'n_co
-000887e0: 7265 7327 2c20 274e 756d 6265 7220 6f66  res', 'Number of
-000887f0: 2063 6f72 6573 2074 6f20 7573 6527 2029   cores to use' )
-00088800: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088810: 2531 3273 3a20 2720 2520 2773 7566 6669  %12s: ' % 'suffi
-00088820: 7827 2c20 2753 7566 6669 7820 746f 2062  x', 'Suffix to b
-00088830: 6520 7573 6564 2066 6f72 206f 7574 7075  e used for outpu
-00088840: 7420 6669 6c65 206e 616d 6573 2720 290a  t file names' ).
-00088850: 2020 2020 2020 2020 7072 696e 7428 2725          print('%
-00088860: 3132 733a 2027 2025 2027 6d63 7627 2c20  12s: ' % 'mcv', 
-00088870: 274d 696e 696d 756d 2072 6561 6420 636f  'Minimum read co
-00088880: 7665 7261 6765 2066 6f72 2069 6e63 6c75  verage for inclu
-00088890: 7369 6f6e 2069 6e20 7468 6520 6f75 7470  sion in the outp
-000888a0: 7574 2047 5446 2f47 4646 2720 290a 2020  ut GTF/GFF' ).  
-000888b0: 2020 2020 2020 7072 696e 7428 2725 3132        print('%12
-000888c0: 7320 2020 616e 6420 7472 616e 7363 7269  s   and transcri
-000888d0: 7074 6f6d 652f 7072 6f74 656f 6d65 205b  ptome/proteome [
-000888e0: 307e 315d 2e20 466f 7220 6120 6c65 6e67  0~1]. For a leng
-000888f0: 7468 204c 2074 7261 6e73 6372 6970 742c  th L transcript,
-00088900: 2027 2025 2027 2729 0a20 2020 2020 2020   ' % '').       
-00088910: 2070 7269 6e74 2827 2531 3273 2020 2069   print('%12s   i
-00088920: 7420 7769 6c6c 2062 6520 696e 636c 7564  t will be includ
-00088930: 6564 2069 6e20 7468 6520 6f75 7470 7574  ed in the output
-00088940: 2069 6620 6174 206c 6561 7374 206d 6376   if at least mcv
-00088950: 2a4c 2062 6173 6573 2061 7265 2063 6f76  *L bases are cov
-00088960: 6572 6564 2062 7920 7265 6164 7320 2720  ered by reads ' 
-00088970: 2025 2027 2729 0a20 2020 2020 2020 2070   % '').        p
-00088980: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
-00088990: 276d 6364 272c 2027 4d69 6e69 6d75 6d20  'mcd', 'Minimum 
-000889a0: 6261 7365 2063 6f76 6572 6167 6520 6465  base coverage de
-000889b0: 7074 6820 666f 7220 696e 636c 7573 696f  pth for inclusio
-000889c0: 6e20 696e 2074 6865 206f 7574 7075 7427  n in the output'
-000889d0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
-000889e0: 2827 2531 3273 3a20 2720 2520 276d 746c  ('%12s: ' % 'mtl
-000889f0: 272c 2027 4d69 6e69 6d75 6d20 7472 616e  ', 'Minimum tran
-00088a00: 7363 7269 7074 206c 656e 6774 6820 696e  script length in
-00088a10: 2062 6173 6573 2720 290a 2020 2020 2020   bases' ).      
-00088a20: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
-00088a30: 2025 2027 6d70 6c27 2c20 274d 696e 696d   % 'mpl', 'Minim
-00088a40: 756d 2070 726f 7465 696e 2028 616d 696e  um protein (amin
-00088a50: 6f20 6163 6964 2073 6571 7565 6e63 6529  o acid sequence)
-00088a60: 206c 656e 6774 6827 2029 0a20 2020 2020   length' ).     
-00088a70: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
-00088a80: 2720 2520 276d 6469 272c 2027 4d69 6e69  ' % 'mdi', 'Mini
-00088a90: 6d75 6d20 636f 7665 7261 6765 2064 6570  mum coverage dep
-00088aa0: 7468 2066 6f72 2061 6e20 696e 7365 7273  th for an insers
-00088ab0: 696f 6e20 746f 2062 6520 636f 6e73 6964  ion to be consid
-00088ac0: 6572 6564 2076 616c 6964 205b 3e3d 312e  ered valid [>=1.
-00088ad0: 305d 2720 290a 2020 2020 2020 2020 7072  0]' ).        pr
-00088ae0: 696e 7428 2725 3132 733a 2027 2025 2027  int('%12s: ' % '
-00088af0: 6d64 6427 2c20 274d 696e 696d 756d 2063  mdd', 'Minimum c
-00088b00: 6f76 6572 6167 6520 6465 7074 6820 666f  overage depth fo
-00088b10: 7220 6120 6465 6c65 7469 6f6e 2074 6f20  r a deletion to 
-00088b20: 6265 2063 6f6e 7369 6465 7265 6420 7661  be considered va
-00088b30: 6c69 6420 5b3e 3d31 2e30 5d27 2029 0a20  lid [>=1.0]' ). 
-00088b40: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
-00088b50: 3273 3a20 2720 2520 276d 6470 272c 2027  2s: ' % 'mdp', '
-00088b60: 4d69 6e69 6d75 6d20 636f 7665 7261 6765  Minimum coverage
-00088b70: 2064 6570 7468 2066 6f72 2053 4e50 2063   depth for SNP c
-00088b80: 6f72 7265 6374 696f 6e20 5b3e 3d31 2e30  orrection [>=1.0
-00088b90: 5d27 2029 0a20 2020 2020 2020 2070 7269  ]' ).        pri
-00088ba0: 6e74 2827 2531 3273 3a20 2720 2520 276d  nt('%12s: ' % 'm
-00088bb0: 6466 272c 2027 4d69 6e69 6d75 6d20 636f  df', 'Minimum co
-00088bc0: 7665 7261 6765 2064 6570 7468 2066 7261  verage depth fra
-00088bd0: 6374 696f 6e20 666f 7220 696e 7365 7273  ction for insers
-00088be0: 696f 6e20 616e 6420 6465 6c65 7469 6f6e  ion and deletion
-00088bf0: 2074 6f20 6265 2063 6f6e 7369 6465 7265   to be considere
-00088c00: 6420 7661 6c69 6420 2830 7e31 2927 2029  d valid (0~1)' )
-00088c10: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088c20: 2531 3273 3a20 2720 2520 276a 756d 705f  %12s: ' % 'jump_
-00088c30: 746f 272c 2027 4a75 6d70 2074 6f20 7374  to', 'Jump to st
-00088c40: 6570 206a 205b 3020 6f72 2031 206f 7220  ep j [0 or 1 or 
-00088c50: 325d 2720 290a 2020 2020 2020 2020 7265  2]' ).        re
-00088c60: 7475 726e 0a0a 2020 2020 7361 6d5f 6669  turn..    sam_fi
-00088c70: 6c65 203d 2049 6e70 7574 0a20 2020 2067  le = Input.    g
-00088c80: 7466 5f66 696c 6520 3d20 616e 6e6f 745f  tf_file = annot_
-00088c90: 6774 660a 0a20 2020 2069 6620 5059 4241  gtf..    if PYBA
-00088ca0: 4d5f 4552 523a 0a20 2020 2020 2020 2070  M_ERR:.        p
-00088cb0: 7269 6e74 2827 5374 7269 6e67 4669 7820  rint('StringFix 
-00088cc0: 5741 524e 494e 473a 2070 7962 616d 206e  WARNING: pybam n
-00088cd0: 6f74 2061 7661 696c 6162 6c65 2e20 4163  ot available. Ac
-00088ce0: 6365 7074 2053 414d 2066 696c 6520 6f6e  cept SAM file on
-00088cf0: 6c79 2e27 290a 0a20 2020 2069 6620 2867  ly.')..    if (g
-00088d00: 656e 6f6d 655f 6661 2069 7320 6e6f 7420  enome_fa is not 
-00088d10: 4e6f 6e65 2920 2620 2867 7466 5f66 696c  None) & (gtf_fil
-00088d20: 6520 6973 206e 6f74 204e 6f6e 6529 3a0a  e is not None):.
-00088d30: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-00088d40: 7472 696e 6746 6978 2069 7320 7275 6e6e  tringFix is runn
-00088d50: 696e 6720 696e 2061 6e6e 6f74 6174 696f  ing in annotatio
-00088d60: 6e20 6775 6964 6564 206d 6f64 6520 7769  n guided mode wi
-00088d70: 7468 2073 6571 7565 6e63 6520 636f 7272  th sequence corr
-00088d80: 6563 7469 6f6e 2e27 290a 2020 2020 656c  ection.').    el
-00088d90: 6966 2028 6765 6e6f 6d65 5f66 6120 6973  if (genome_fa is
-00088da0: 206e 6f74 204e 6f6e 6529 2026 2028 6774   not None) & (gt
-00088db0: 665f 6669 6c65 2069 7320 4e6f 6e65 293a  f_file is None):
-00088dc0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00088dd0: 5374 7269 6e67 4669 7820 6973 2072 756e  StringFix is run
-00088de0: 6e69 6e67 2069 6e20 6765 6e6f 6d65 2067  ning in genome g
-00088df0: 7569 6465 6420 6d6f 6465 2077 6974 6820  uided mode with 
-00088e00: 7365 7175 656e 6365 2063 6f72 7265 6374  sequence correct
-00088e10: 696f 6e2e 2729 0a20 2020 2065 6c69 6620  ion.').    elif 
-00088e20: 2867 656e 6f6d 655f 6661 2069 7320 4e6f  (genome_fa is No
-00088e30: 6e65 2920 2620 2867 7466 5f66 696c 6520  ne) & (gtf_file 
-00088e40: 6973 204e 6f6e 6529 3a0a 2020 2020 2020  is None):.      
-00088e50: 2020 7072 696e 7428 2753 7472 696e 6746    print('StringF
-00088e60: 6978 2069 7320 7275 6e6e 696e 6720 696e  ix is running in
-00088e70: 2067 656e 6f6d 6520 6775 6964 6564 206d   genome guided m
-00088e80: 6f64 6520 7769 7468 6f75 7420 7365 7175  ode without sequ
-00088e90: 656e 6365 2063 6f72 7265 6374 696f 6e2e  ence correction.
-00088ea0: 2729 0a20 2020 2065 6c73 653a 0a20 2020  ').    else:.   
-00088eb0: 2020 2020 2070 7269 6e74 2827 5374 7269       print('Stri
-00088ec0: 6e67 4669 7820 6973 2072 756e 6e69 6e67  ngFix is running
-00088ed0: 2069 6e20 616e 6e6f 7461 7469 6f6e 2067   in annotation g
-00088ee0: 7569 6465 6420 6d6f 6465 2077 6974 686f  uided mode witho
-00088ef0: 7574 2073 6571 7565 6e63 6520 636f 7272  ut sequence corr
-00088f00: 6563 7469 6f6e 2e27 290a 2020 2020 0a0a  ection.').    ..
-00088f10: 2020 2020 2320 7265 7620 3d20 4661 6c73      # rev = Fals
-00088f20: 650a 2020 2020 7265 7620 3d20 6f75 745f  e.    rev = out_
-00088f30: 6375 7374 6f6d 5f67 656e 6f6d 650a 2020  custom_genome.  
-00088f40: 2020 6362 7963 203d 2054 7275 6520 0a20    cbyc = True . 
-00088f50: 2020 2073 6120 3d20 320a 2020 2020 6966     sa = 2.    if
-00088f60: 2078 7361 3a20 7361 203d 2030 0a0a 2020   xsa: sa = 0..  
-00088f70: 2020 4d49 4e5f 4356 475f 464f 525f 534e    MIN_CVG_FOR_SN
-00088f80: 505f 434f 5252 4543 5449 4f4e 203d 2069  P_CORRECTION = i
-00088f90: 6e74 286d 6470 290a 2020 2020 495f 5641  nt(mdp).    I_VA
-00088fa0: 4c49 445f 4356 4720 3d20 6d61 7828 312c  LID_CVG = max(1,
-00088fb0: 206e 702e 666c 6f61 7428 6d64 6929 290a   np.float(mdi)).
-00088fc0: 2020 2020 445f 5641 4c49 445f 4356 4720      D_VALID_CVG 
-00088fd0: 3d20 6d61 7828 312c 206e 702e 666c 6f61  = max(1, np.floa
-00088fe0: 7428 6d64 6429 290a 2020 2020 495f 5641  t(mdd)).    I_VA
-00088ff0: 4c49 445f 4346 5241 4320 3d20 666c 6f61  LID_CFRAC = floa
-00089000: 7428 6d64 6629 0a20 2020 2044 5f56 414c  t(mdf).    D_VAL
-00089010: 4944 5f43 4652 4143 203d 2066 6c6f 6174  ID_CFRAC = float
-00089020: 286d 6466 290a 2020 2020 4d49 4e5f 434f  (mdf).    MIN_CO
-00089030: 565f 544f 5f53 454c 203d 206e 702e 666c  V_TO_SEL = np.fl
-00089040: 6f61 7428 6d63 7629 0a20 2020 204d 494e  oat(mcv).    MIN
-00089050: 5f41 424e 5f54 4f5f 5345 4c20 3d20 6e70  _ABN_TO_SEL = np
-00089060: 2e66 6c6f 6174 286d 6364 290a 2020 2020  .float(mcd).    
-00089070: 4d49 4e5f 5452 5f4c 454e 4754 4820 3d20  MIN_TR_LENGTH = 
-00089080: 696e 7428 6d74 6c29 0a20 2020 204d 494e  int(mtl).    MIN
-00089090: 5f50 525f 4c45 4e47 5448 203d 2069 6e74  _PR_LENGTH = int
-000890a0: 286d 706c 290a 2020 2020 4d41 585f 4e55  (mpl).    MAX_NU
-000890b0: 4d5f 5041 5448 5320 3d20 696e 7428 6e5f  M_PATHS = int(n_
-000890c0: 7029 0a20 2020 2047 454e 5f41 4153 5f55  p).    GEN_AAS_U
-000890d0: 4e53 5045 4320 3d20 5472 7565 0a0a 2020  NSPEC = True..  
-000890e0: 2020 6966 2067 7466 5f66 696c 6520 6973    if gtf_file is
-000890f0: 204e 6f6e 653a 0a20 2020 2020 2020 204d   None:.        M
-00089100: 4158 5f4e 554d 5f50 4154 4853 203d 2032  AX_NUM_PATHS = 2
-00089110: 300a 2020 2020 2020 2020 4d49 4e5f 4e5f  0.        MIN_N_
-00089120: 5244 535f 5045 525f 4745 4e45 203d 2033  RDS_PER_GENE = 3
-00089130: 300a 2020 2020 2020 2020 5452 5f46 494c  0.        TR_FIL
-00089140: 5445 525f 5345 4c20 3d20 320a 0a20 2020  TER_SEL = 2..   
-00089150: 2069 6620 6f75 745f 6469 7220 6973 206e   if out_dir is n
-00089160: 6f74 204e 6f6e 653a 200a 2020 2020 2020  ot None: .      
-00089170: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-00089180: 2e65 7869 7374 7328 6f75 745f 6469 7229  .exists(out_dir)
-00089190: 3a20 6f73 2e6d 6b64 6972 286f 7574 5f64  : os.mkdir(out_d
-000891a0: 6972 290a 0a20 2020 2066 696c 655f 6f75  ir)..    file_ou
-000891b0: 742c 2067 6473 2c20 6765 6e6f 6d65 203d  t, gds, genome =
-000891c0: 2053 7472 696e 6746 6978 5f61 6e61 6c79   StringFix_analy
-000891d0: 7369 7328 7361 6d5f 6669 6c65 2c20 6774  sis(sam_file, gt
-000891e0: 6620 3d20 6774 665f 6669 6c65 2c20 6765  f = gtf_file, ge
-000891f0: 6e6f 6d65 5f66 696c 6520 3d20 6765 6e6f  nome_file = geno
-00089200: 6d65 5f66 612c 206a 756d 7020 3d20 6a75  me_fa, jump = ju
-00089210: 6d70 5f74 6f2c 205c 0a20 2020 2020 2020  mp_to, \.       
-00089220: 2020 2020 206e 5f63 6f72 6573 3d6e 5f63       n_cores=n_c
-00089230: 6f72 6573 2c20 6f75 745f 7472 203d 2054  ores, out_tr = T
-00089240: 7275 652c 2063 6279 6320 3d20 6362 7963  rue, cbyc = cbyc
-00089250: 2c20 7375 6666 6978 203d 2073 7566 6669  , suffix = suffi
-00089260: 782c 206f 7574 5f64 6972 203d 206f 7574  x, out_dir = out
-00089270: 5f64 6972 2c20 7361 203d 2073 6120 2920  _dir, sa = sa ) 
-00089280: 0a0a 2020 2020 6966 2028 6764 7320 6973  ..    if (gds is
-00089290: 206e 6f74 204e 6f6e 6529 2026 2028 6a75   not None) & (ju
-000892a0: 6d70 5f74 6f20 3c20 3229 3a0a 2020 2020  mp_to < 2):.    
-000892b0: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
-000892c0: 6720 6765 6e65 2064 6573 6372 6970 746f  g gene descripto
-000892d0: 7220 2e2e 2027 2c20 656e 6420 3d20 2720  r .. ', end = ' 
-000892e0: 272c 2066 6c75 7368 203d 2054 7275 6529  ', flush = True)
-000892f0: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-00089300: 656e 2866 696c 655f 6f75 7420 2b20 272e  en(file_out + '.
-00089310: 6764 7327 2c20 2777 6227 2920 6173 2066  gds', 'wb') as f
-00089320: 3a0a 2020 2020 2020 2020 2020 2020 7069  :.            pi
-00089330: 636b 6c65 2e64 756d 7028 2028 6764 7329  ckle.dump( (gds)
-00089340: 2c20 6620 290a 2020 2020 2020 2020 7072  , f ).        pr
-00089350: 696e 7428 2764 6f6e 652e 2027 290a 2020  int('done. ').  
-00089360: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00089370: 7072 696e 7428 2753 7472 696e 6746 6978  print('StringFix
-00089380: 2073 7461 7274 6564 2027 2c20 6461 7465   started ', date
-00089390: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
-000893a0: 7728 2929 0a20 2020 2020 2020 2070 7269  w()).        pri
-000893b0: 6e74 2827 4c6f 6164 696e 6720 6765 6e65  nt('Loading gene
-000893c0: 2064 6573 6372 6970 746f 7220 2e2e 2027   descriptor .. '
-000893d0: 2c20 656e 6420 3d20 2720 272c 2066 6c75  , end = ' ', flu
-000893e0: 7368 203d 2054 7275 6529 0a20 2020 2020  sh = True).     
-000893f0: 2020 2077 6974 6820 6f70 656e 2866 696c     with open(fil
-00089400: 655f 6f75 7420 2b20 272e 6764 7327 2c20  e_out + '.gds', 
-00089410: 2772 6227 2920 6173 2066 3a0a 2020 2020  'rb') as f:.    
-00089420: 2020 2020 2020 2020 6764 7320 3d20 7069          gds = pi
-00089430: 636b 6c65 2e6c 6f61 6428 2066 2029 0a20  ckle.load( f ). 
-00089440: 2020 2020 2020 2067 656e 6f6d 6520 3d20         genome = 
-00089450: 6765 6e6f 6d65 5f66 610a 2020 2020 2020  genome_fa.      
-00089460: 2020 7072 696e 7428 2764 6f6e 652e 2027    print('done. '
-00089470: 290a 2020 2020 0a20 2020 2069 6620 2867  ).    .    if (g
-00089480: 656e 6f6d 655f 6661 2069 7320 4e6f 6e65  enome_fa is None
-00089490: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
-000894a0: 2827 5374 7269 6e67 4669 7820 6669 6e69  ('StringFix fini
-000894b0: 7368 6564 2027 2c20 6461 7465 7469 6d65  shed ', datetime
-000894c0: 2e64 6174 6574 696d 652e 6e6f 7728 2929  .datetime.now())
-000894d0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-000894e0: 2020 2066 696c 655f 6f75 742c 2066 696c     file_out, fil
-000894f0: 655f 6f75 745f 6765 6e6f 6d65 203d 2053  e_out_genome = S
-00089500: 7472 696e 6746 6978 5f73 796e 7468 6573  tringFix_synthes
-00089510: 6973 2820 6669 6c65 5f6f 7574 202b 2027  is( file_out + '
-00089520: 2e67 6666 272c 2067 656e 6f6d 652c 205c  .gff', genome, \
-00089530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00089540: 206e 5f63 6f72 6573 3d6e 5f63 6f72 6573   n_cores=n_cores
-00089550: 2c20 7265 7620 3d20 7265 762c 206f 7574  , rev = rev, out
-00089560: 5f64 6972 203d 206f 7574 5f64 6972 2c20  _dir = out_dir, 
-00089570: 6764 7320 3d20 6764 7320 290a 2020 2020  gds = gds ).    
-00089580: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
-00089590: 6669 6c65 5f6f 7574 0a20 2020 2020 2020  file_out.       
-000895a0: 200a 0a23 2323 2323 2323 2323 2323 2323   ..#############
-000895b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000895c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000895d0: 2323 2323 2323 2323 2323 2323 0a23 2320  ############.## 
-000895e0: 5374 7269 6e67 4669 782d 6164 646f 6e20  StringFix-addon 
-000895f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00089600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00089610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00089620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00089630: 2020 2020 2020 2020 2020 2020 2023 230a               ##.
-00089640: 2323 2064 6576 656c 6f70 6564 2062 7920  ## developed by 
-00089650: 5365 6f6b 6879 756e 2059 6f6f 6e20 2873  Seokhyun Yoon (s
-00089660: 796f 6f6e 4064 6b75 2e65 6475 2920 4f63  yoon@dku.edu) Oc
-00089670: 742e 2030 342c 2032 3032 3020 2020 2323  t. 04, 2020   ##
-00089680: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-00089690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000896a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000896b0: 2323 2323 2323 2323 2323 0a0a 6465 6620  ##########..def 
-000896c0: 7768 6963 6828 2061 692c 2076 616c 7565  which( ai, value
-000896d0: 203d 2054 7275 6520 2920 3a0a 2020 2020   = True ) :.    
-000896e0: 7768 203d 205b 5d0a 2020 2020 6120 3d20  wh = [].    a = 
-000896f0: 6c69 7374 2861 6929 0a20 2020 2066 6f72  list(ai).    for
-00089700: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
-00089710: 6129 293a 200a 2020 2020 2020 2020 6966  a)): .        if
-00089720: 2061 5b6b 5d20 3d3d 2076 616c 7565 3a20   a[k] == value: 
-00089730: 0a20 2020 2020 2020 2020 2020 2077 682e  .            wh.
-00089740: 6170 7065 6e64 286b 2920 0a20 2020 2072  append(k) .    r
-00089750: 6574 7572 6e28 7768 290a 0a64 6566 2067  eturn(wh)..def g
-00089760: 6574 5f69 6e66 6f5f 6672 6f6d 5f74 725f  et_info_from_tr_
-00089770: 6e61 6d65 2820 746e 7320 293a 0a20 2020  name( tns ):.   
-00089780: 200a 2020 2020 6162 6e5f 6520 3d20 5b5d   .    abn_e = []
-00089790: 0a20 2020 2074 706d 5f65 203d 205b 5d0a  .    tpm_e = [].
-000897a0: 2020 2020 6966 7261 6320 3d20 5b5d 0a20      ifrac = []. 
-000897b0: 2020 2073 6964 7820 3d20 5b5d 0a20 2020     sidx = [].   
-000897c0: 2067 5f73 697a 6520 3d20 5b5d 0a20 2020   g_size = [].   
-000897d0: 206e 5f65 786f 6e73 203d 205b 5d0a 2020   n_exons = [].  
-000897e0: 2020 675f 766f 6c20 3d20 5b5d 0a20 2020    g_vol = [].   
-000897f0: 2069 636e 7420 3d20 5b5d 0a20 2020 2074   icnt = [].    t
-00089800: 5f6c 656e 203d 205b 5d0a 2020 2020 7374  _len = [].    st
-00089810: 726e 6420 3d20 5b5d 0a20 2020 2063 646e  rnd = [].    cdn
-00089820: 6720 3d20 5b5d 0a20 2020 2066 6f72 206b  g = [].    for k
-00089830: 2c20 746e 2069 6e20 656e 756d 6572 6174  , tn in enumerat
-00089840: 6528 746e 7329 3a0a 2020 2020 2020 2020  e(tns):.        
-00089850: 6864 7220 3d20 746e 2e73 706c 6974 2827  hdr = tn.split('
-00089860: 2027 290a 2020 2020 2020 2020 6974 656d   ').        item
-00089870: 7320 3d20 6864 725b 305d 2e73 706c 6974  s = hdr[0].split
-00089880: 2827 5f27 290a 2020 2020 2020 2020 7374  ('_').        st
-00089890: 726e 642e 6170 7065 6e64 2820 6974 656d  rnd.append( item
-000898a0: 735b 325d 290a 2020 2020 2020 2020 6364  s[2]).        cd
-000898b0: 6e67 2e61 7070 656e 6428 2069 7465 6d73  ng.append( items
-000898c0: 5b33 5d29 0a20 2020 2020 2020 2073 6964  [3]).        sid
-000898d0: 782e 6170 7065 6e64 2820 2869 7465 6d73  x.append( (items
-000898e0: 5b34 5d29 2029 0a20 2020 2020 2020 2067  [4]) ).        g
-000898f0: 5f73 697a 652e 6170 7065 6e64 2820 696e  _size.append( in
-00089900: 7428 6974 656d 735b 355d 2920 290a 2020  t(items[5]) ).  
-00089910: 2020 2020 2020 6963 6e74 2e61 7070 656e        icnt.appen
-00089920: 6428 2069 6e74 2869 7465 6d73 5b36 5d29  d( int(items[6])
-00089930: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-00089940: 2069 7465 6d73 5b37 5d2e 7370 6c69 7428   items[7].split(
-00089950: 273a 2729 0a20 2020 2020 2020 2061 626e  ':').        abn
-00089960: 5f65 2e61 7070 656e 6428 2066 6c6f 6174  _e.append( float
-00089970: 2876 616c 5b31 5d29 2029 0a20 2020 2020  (val[1]) ).     
-00089980: 2020 2076 616c 203d 2069 7465 6d73 5b38     val = items[8
-00089990: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
-000899a0: 2020 2020 2074 706d 5f65 2e61 7070 656e       tpm_e.appen
-000899b0: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
-000899c0: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
-000899d0: 2069 7465 6d73 5b39 5d2e 7370 6c69 7428   items[9].split(
-000899e0: 273a 2729 0a20 2020 2020 2020 2069 6672  ':').        ifr
-000899f0: 6163 2e61 7070 656e 6428 2066 6c6f 6174  ac.append( float
-00089a00: 2876 616c 5b31 5d29 2029 0a20 2020 2020  (val[1]) ).     
-00089a10: 2020 2076 616c 203d 2069 7465 6d73 5b31     val = items[1
-00089a20: 315d 2e73 706c 6974 2827 3a27 290a 2020  1].split(':').  
-00089a30: 2020 2020 2020 6e5f 6578 6f6e 732e 6170        n_exons.ap
-00089a40: 7065 6e64 2820 696e 7428 7661 6c5b 315d  pend( int(val[1]
-00089a50: 2920 290a 2020 2020 2020 2020 7661 6c20  ) ).        val 
-00089a60: 3d20 6974 656d 735b 3132 5d2e 7370 6c69  = items[12].spli
-00089a70: 7428 273a 2729 0a20 2020 2020 2020 2067  t(':').        g
-00089a80: 5f76 6f6c 2e61 7070 656e 6428 2069 6e74  _vol.append( int
-00089a90: 2876 616c 5b31 5d29 2029 0a20 2020 2020  (val[1]) ).     
-00089aa0: 2020 2076 616c 203d 2069 7465 6d73 5b31     val = items[1
-00089ab0: 335d 2e73 706c 6974 2827 3a27 290a 2020  3].split(':').  
-00089ac0: 2020 2020 2020 745f 6c65 6e2e 6170 7065        t_len.appe
-00089ad0: 6e64 2820 696e 7428 7661 6c5b 315d 2920  nd( int(val[1]) 
-00089ae0: 290a 2020 2020 0a20 2020 2064 6620 3d20  ).    .    df = 
-00089af0: 7064 2e44 6174 6146 7261 6d65 2829 0a20  pd.DataFrame(). 
-00089b00: 2020 200a 2020 2020 6466 5b27 7472 5f6e     .    df['tr_n
-00089b10: 616d 6527 5d20 3d20 746e 730a 2020 2020  ame'] = tns.    
-00089b20: 6466 5b27 6162 6e5f 6573 7427 5d20 3d20  df['abn_est'] = 
-00089b30: 6162 6e5f 650a 2020 2020 6466 5b27 7470  abn_e.    df['tp
-00089b40: 6d5f 6573 7427 5d20 3d20 7470 6d5f 650a  m_est'] = tpm_e.
-00089b50: 2020 2020 6466 5b27 6769 6478 275d 203d      df['gidx'] =
-00089b60: 2073 6964 780a 2020 2020 6466 5b27 6969   sidx.    df['ii
-00089b70: 6478 275d 203d 2069 636e 740a 2020 2020  dx'] = icnt.    
-00089b80: 6466 5b27 675f 7369 7a65 275d 203d 2067  df['g_size'] = g
-00089b90: 5f73 697a 650a 2020 2020 6466 5b27 6973  _size.    df['is
-00089ba0: 6f5f 6672 6163 275d 203d 2069 6672 6163  o_frac'] = ifrac
-00089bb0: 0a20 2020 2064 665b 276e 5f65 786f 6e73  .    df['n_exons
-00089bc0: 275d 203d 206e 5f65 786f 6e73 0a20 2020  '] = n_exons.   
-00089bd0: 2064 665b 2767 5f76 6f6c 275d 203d 2067   df['g_vol'] = g
-00089be0: 5f76 6f6c 0a20 2020 2064 665b 276c 656e  _vol.    df['len
-00089bf0: 6774 6827 5d20 3d20 745f 6c65 6e0a 2020  gth'] = t_len.  
-00089c00: 2020 6466 5b27 7374 7261 6e64 275d 203d    df['strand'] =
-00089c10: 2073 7472 6e64 0a20 2020 2064 665b 2743   strnd.    df['C
-00089c20: 5f6f 725f 4e27 5d20 3d20 6364 6e67 0a20  _or_N'] = cdng. 
-00089c30: 2020 200a 2020 2020 6466 203d 2064 662e     .    df = df.
-00089c40: 7365 745f 696e 6465 7828 2774 725f 6e61  set_index('tr_na
-00089c50: 6d65 2729 0a20 2020 200a 2020 2020 7265  me').    .    re
-00089c60: 7475 726e 2064 660a 0a64 6566 2067 6574  turn df..def get
-00089c70: 5f70 6572 666f 726d 616e 6365 2874 7269  _performance(tri
-00089c80: 6e66 6f2c 2063 7667 5f74 6820 3d20 5b38  nfo, cvg_th = [8
-00089c90: 302c 3930 2c39 355d 2c20 665f 746f 5f73  0,90,95], f_to_s
-00089ca0: 6176 6520 3d20 4e6f 6e65 2c20 7265 6620  ave = None, ref 
-00089cb0: 3d20 302c 2076 6572 626f 7365 203d 2046  = 0, verbose = F
-00089cc0: 616c 7365 293a 0a20 2020 200a 2020 2020  alse):.    .    
-00089cd0: 2327 2727 0a20 2020 2069 6620 7265 6620  #'''.    if ref 
-00089ce0: 3d3d 2030 3a0a 2020 2020 2020 2020 715f  == 0:.        q_
-00089cf0: 6376 6720 3d20 2771 6376 6727 0a20 2020  cvg = 'qcvg'.   
-00089d00: 2020 2020 2071 5f6c 656e 203d 2027 716c       q_len = 'ql
-00089d10: 656e 270a 2020 2020 2020 2020 715f 6964  en'.        q_id
-00089d20: 203d 2027 7169 6427 0a20 2020 2020 2020   = 'qid'.       
-00089d30: 2073 5f73 7461 7274 203d 2027 7373 7461   s_start = 'ssta
-00089d40: 7274 270a 2020 2020 2020 2020 735f 656e  rt'.        s_en
-00089d50: 6420 3d20 2773 656e 6427 0a20 2020 2020  d = 'send'.     
-00089d60: 2020 2073 5f69 6420 3d20 2773 6964 270a     s_id = 'sid'.
-00089d70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00089d80: 2020 715f 6376 6720 3d20 2773 6376 6727    q_cvg = 'scvg'
-00089d90: 0a20 2020 2020 2020 2071 5f6c 656e 203d  .        q_len =
-00089da0: 2027 736c 656e 270a 2020 2020 2020 2020   'slen'.        
-00089db0: 715f 6964 203d 2027 7369 6427 0a20 2020  q_id = 'sid'.   
-00089dc0: 2020 2020 2073 5f73 7461 7274 203d 2027       s_start = '
-00089dd0: 7173 7461 7274 270a 2020 2020 2020 2020  qstart'.        
-00089de0: 735f 656e 6420 3d20 2771 656e 6427 0a20  s_end = 'qend'. 
-00089df0: 2020 2020 2020 2073 5f69 6420 3d20 2771         s_id = 'q
-00089e00: 6964 270a 2020 2020 2327 2727 0a20 2020  id'.    #'''.   
-00089e10: 200a 2020 2020 7169 6473 203d 2070 642e   .    qids = pd.
-00089e20: 756e 6971 7565 2874 7269 6e66 6f5b 715f  unique(trinfo[q_
-00089e30: 6964 5d29 0a20 2020 2073 6964 7320 3d20  id]).    sids = 
-00089e40: 7064 2e75 6e69 7175 6528 7472 696e 666f  pd.unique(trinfo
-00089e50: 5b73 5f69 645d 290a 2020 2020 7767 7420  [s_id]).    wgt 
-00089e60: 3d20 6e70 2e7a 6572 6f73 285b 6c65 6e28  = np.zeros([len(
-00089e70: 7169 6473 292c 6c65 6e28 7369 6473 295d  qids),len(sids)]
-00089e80: 290a 2020 2020 6966 2076 6572 626f 7365  ).    if verbose
-00089e90: 3a20 7072 696e 7428 274d 6174 6368 696e  : print('Matchin
-00089ea0: 6720 2825 692c 2569 2920 2720 2520 2877  g (%i,%i) ' % (w
-00089eb0: 6774 2e73 6861 7065 292c 2065 6e64 3d27  gt.shape), end='
-00089ec0: 2729 0a0a 2020 2020 7169 6478 203d 206e  ')..    qidx = n
-00089ed0: 702e 6675 6c6c 2874 7269 6e66 6f2e 7368  p.full(trinfo.sh
-00089ee0: 6170 655b 305d 2c2d 312c 6474 7970 653d  ape[0],-1,dtype=
-00089ef0: 696e 7429 0a20 2020 2066 6f72 206b 2069  int).    for k i
-00089f00: 6e20 7261 6e67 6528 6c65 6e28 7169 6473  n range(len(qids
-00089f10: 2929 203a 0a20 2020 2020 2020 2071 6964  )) :.        qid
-00089f20: 203d 2071 6964 735b 6b5d 0a20 2020 2020   = qids[k].     
-00089f30: 2020 2077 6820 3d20 7768 6963 6828 2074     wh = which( t
-00089f40: 7269 6e66 6f5b 715f 6964 5d20 3d3d 2071  rinfo[q_id] == q
-00089f50: 6964 2029 0a20 2020 2020 2020 2071 6964  id ).        qid
-00089f60: 785b 7768 5d20 3d20 6b0a 2020 2020 2020  x[wh] = k.      
-00089f70: 2020 0a20 2020 2069 6620 7665 7262 6f73    .    if verbos
-00089f80: 653a 2070 7269 6e74 2827 2e27 2c20 656e  e: print('.', en
-00089f90: 643d 2727 290a 2020 2020 7369 6478 203d  d='').    sidx =
-00089fa0: 206e 702e 6675 6c6c 2874 7269 6e66 6f2e   np.full(trinfo.
-00089fb0: 7368 6170 655b 305d 2c2d 312c 6474 7970  shape[0],-1,dtyp
-00089fc0: 653d 696e 7429 0a20 2020 2066 6f72 206b  e=int).    for k
-00089fd0: 2069 6e20 7261 6e67 6528 6c65 6e28 7369   in range(len(si
-00089fe0: 6473 2929 203a 0a20 2020 2020 2020 2073  ds)) :.        s
-00089ff0: 6964 203d 2073 6964 735b 6b5d 0a20 2020  id = sids[k].   
-0008a000: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
-0008a010: 2074 7269 6e66 6f5b 735f 6964 5d20 3d3d   trinfo[s_id] ==
-0008a020: 2073 6964 2029 0a20 2020 2020 2020 2073   sid ).        s
-0008a030: 6964 785b 7768 5d20 3d20 6b0a 2020 2020  idx[wh] = k.    
-0008a040: 2020 2020 0a20 2020 2069 6620 7665 7262      .    if verb
-0008a050: 6f73 653a 2070 7269 6e74 2827 2e27 2c20  ose: print('.', 
-0008a060: 656e 643d 2727 290a 2020 2020 666f 7220  end='').    for 
-0008a070: 7720 696e 2072 616e 6765 286c 656e 2871  w in range(len(q
-0008a080: 6964 7829 293a 0a20 2020 2020 2020 2077  idx)):.        w
-0008a090: 6774 5b69 6e74 2871 6964 785b 775d 292c  gt[int(qidx[w]),
-0008a0a0: 2069 6e74 2873 6964 785b 775d 295d 203d   int(sidx[w])] =
-0008a0b0: 202d 7472 696e 666f 5b71 5f63 7667 5d5b   -trinfo[q_cvg][
-0008a0c0: 775d 0a0a 2020 2020 6966 2076 6572 626f  w]..    if verbo
-0008a0d0: 7365 3a20 7072 696e 7428 275f 272c 2065  se: print('_', e
-0008a0e0: 6e64 3d27 2729 0a20 2020 2023 2070 7269  nd='').    # pri
-0008a0f0: 6e74 2877 6774 2e73 6861 7065 290a 2020  nt(wgt.shape).  
-0008a100: 2020 726f 775f 6964 782c 2063 6f6c 5f69    row_idx, col_i
-0008a110: 6478 203d 206f 7074 696d 697a 652e 6c69  dx = optimize.li
-0008a120: 6e65 6172 5f73 756d 5f61 7373 6967 6e6d  near_sum_assignm
-0008a130: 656e 7428 7767 7429 0a20 2020 200a 2020  ent(wgt).    .  
-0008a140: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
-0008a150: 696e 7428 272e 272c 2065 6e64 3d27 2729  int('.', end='')
-0008a160: 0a20 2020 2064 665f 6c73 7420 3d20 5b5d  .    df_lst = []
-0008a170: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
-0008a180: 6e67 6528 6c65 6e28 636f 6c5f 6964 7829  nge(len(col_idx)
-0008a190: 2920 3a0a 2020 2020 2020 2020 7369 203d  ) :.        si =
-0008a1a0: 2063 6f6c 5f69 6478 5b6b 5d0a 2020 2020   col_idx[k].    
-0008a1b0: 2020 2020 7768 203d 2077 6869 6368 2873      wh = which(s
-0008a1c0: 6964 7820 3d3d 2073 6929 0a20 2020 2020  idx == si).     
-0008a1d0: 2020 2077 203d 2077 6869 6368 2820 7169     w = which( qi
-0008a1e0: 6478 5b77 685d 203d 3d20 726f 775f 6964  dx[wh] == row_id
-0008a1f0: 785b 6b5d 2029 0a20 2020 2020 2020 2069  x[k] ).        i
-0008a200: 6620 6c65 6e28 7729 203e 2030 3a0a 2020  f len(w) > 0:.  
-0008a210: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0008a220: 2877 2920 3e20 313a 2070 7269 6e74 2827  (w) > 1: print('
-0008a230: 4552 524f 5220 696e 2067 6574 5f70 6572  ERROR in get_per
-0008a240: 666f 726d 616e 6365 2829 3a20 4c65 6e28  formance(): Len(
-0008a250: 7729 203d 2025 6927 2025 206c 656e 2877  w) = %i' % len(w
-0008a260: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-0008a270: 6964 7820 3d20 7768 5b77 5b30 5d5d 0a20  idx = wh[w[0]]. 
-0008a280: 2020 2020 2020 2020 2020 2064 665f 6c73             df_ls
-0008a290: 742e 6170 7065 6e64 2874 7269 6e66 6f2e  t.append(trinfo.
-0008a2a0: 696c 6f63 5b69 6478 5d29 0a20 2020 2020  iloc[idx]).     
-0008a2b0: 2020 200a 2020 2020 6466 5f73 656c 203d     .    df_sel =
-0008a2c0: 2070 642e 4461 7461 4672 616d 6528 6466   pd.DataFrame(df
-0008a2d0: 5f6c 7374 290a 2020 2020 6966 2066 5f74  _lst).    if f_t
-0008a2e0: 6f5f 7361 7665 2069 7320 6e6f 7420 4e6f  o_save is not No
-0008a2f0: 6e65 3a0a 2020 2020 2020 2020 666e 616d  ne:.        fnam
-0008a300: 6520 3d20 2725 735f 626c 6173 745f 7265  e = '%s_blast_re
-0008a310: 7375 6c74 2e74 7376 2720 2520 665f 746f  sult.tsv' % f_to
-0008a320: 5f73 6176 650a 2020 2020 2020 2020 6466  _save.        df
-0008a330: 5f73 656c 2e74 6f5f 6373 7628 666e 616d  _sel.to_csv(fnam
-0008a340: 652c 2068 6561 6465 723d 5472 7565 2c20  e, header=True, 
-0008a350: 696e 6465 783d 4661 6c73 652c 2073 6570  index=False, sep
-0008a360: 3d27 5c74 2729 0a20 2020 2020 2020 2023  ='\t').        #
-0008a370: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
-0008a380: 6e74 2827 2025 732e 2720 2520 666e 616d  nt(' %s.' % fnam
-0008a390: 652c 2065 6e64 3d27 2720 290a 2020 2020  e, end='' ).    
-0008a3a0: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
-0008a3b0: 2070 7269 6e74 2827 2e27 2c20 656e 643d   print('.', end=
-0008a3c0: 2727 290a 2020 2020 636e 7420 3d20 6e70  '').    cnt = np
-0008a3d0: 2e7a 6572 6f73 286c 656e 2863 7667 5f74  .zeros(len(cvg_t
-0008a3e0: 6829 290a 2020 2020 666f 7220 6b20 696e  h)).    for k in
-0008a3f0: 2072 616e 6765 286c 656e 2863 7667 5f74   range(len(cvg_t
-0008a400: 6829 293a 0a20 2020 2020 2020 2074 6820  h)):.        th 
-0008a410: 3d20 6376 675f 7468 5b6b 5d0a 2020 2020  = cvg_th[k].    
-0008a420: 2020 2020 7768 203d 2077 6869 6368 2820      wh = which( 
-0008a430: 6466 5f73 656c 5b71 5f63 7667 5d2a 3130  df_sel[q_cvg]*10
-0008a440: 3020 3e3d 2074 6820 290a 2020 2020 2020  0 >= th ).      
-0008a450: 2020 636e 745b 6b5d 203d 206e 702e 696e    cnt[k] = np.in
-0008a460: 7428 6c65 6e28 7768 2929 0a20 2020 2020  t(len(wh)).     
-0008a470: 2020 200a 2020 2020 6966 2076 6572 626f     .    if verbo
-0008a480: 7365 3a20 7072 696e 7428 2720 646f 6e65  se: print(' done
-0008a490: 2e27 290a 0a20 2020 2064 203d 207b 2763  .')..    d = {'c
-0008a4a0: 7667 5f74 6827 3a20 6376 675f 7468 2c20  vg_th': cvg_th, 
-0008a4b0: 274e 5f72 6563 6f76 6572 6564 273a 2063  'N_recovered': c
-0008a4c0: 6e74 2e61 7374 7970 6528 696e 7429 2c20  nt.astype(int), 
-0008a4d0: 2770 7265 6369 7369 6f6e 273a 206e 702e  'precision': np.
-0008a4e0: 726f 756e 6428 3130 302a 636e 742f 6c65  round(100*cnt/le
-0008a4f0: 6e28 7369 6473 292c 3129 7d0a 2020 2020  n(sids),1)}.    
-0008a500: 6466 5f70 6572 6620 3d20 7064 2e44 6174  df_perf = pd.Dat
-0008a510: 6146 7261 6d65 2864 6174 6120 3d20 6429  aFrame(data = d)
-0008a520: 2023 2c20 636f 6c75 6d6e 7320 3d20 5b27   #, columns = ['
-0008a530: 6376 675f 7468 272c 276e 5f72 6563 6f76  cvg_th','n_recov
-0008a540: 6572 6564 272c 2770 7265 6369 7369 6f6e  ered','precision
-0008a550: 275d 290a 2020 2020 0a20 2020 2072 6574  ']).    .    ret
-0008a560: 7572 6e28 6466 5f70 6572 662c 2064 665f  urn(df_perf, df_
-0008a570: 7365 6c29 0a0a 2020 2020 0a64 6566 2072  sel)..    .def r
-0008a580: 756e 5f62 6c61 7374 2820 696e 7074 5f66  un_blast( inpt_f
-0008a590: 612c 2072 6566 5f66 612c 2070 6174 685f  a, ref_fa, path_
-0008a5a0: 746f 5f62 6c61 7374 203d 204e 6f6e 652c  to_blast = None,
-0008a5b0: 2074 7261 7265 636f 203d 2046 616c 7365   trareco = False
-0008a5c0: 2c20 7265 665f 696e 666f 203d 2046 616c  , ref_info = Fal
-0008a5d0: 7365 2c20 5c0a 2020 2020 2020 2020 2020  se, \.          
-0008a5e0: 2020 2020 2020 2064 6274 7970 6520 3d20         dbtype = 
-0008a5f0: 276e 7563 6c27 2c20 7265 6620 3d20 302c  'nucl', ref = 0,
-0008a600: 2073 6469 7620 3d20 3130 2c20 6d78 5f6e   sdiv = 10, mx_n
-0008a610: 6361 6e64 203d 2036 2c20 7665 7262 6f73  cand = 6, verbos
-0008a620: 6520 3d20 4661 6c73 6529 3a0a 0a20 2020  e = False):..   
-0008a630: 2023 2727 270a 2020 2020 6966 2072 6566   #'''.    if ref
-0008a640: 203d 3d20 303a 0a20 2020 2020 2020 2072   == 0:.        r
-0008a650: 6566 5f74 7220 3d20 7265 665f 6661 0a20  ef_tr = ref_fa. 
-0008a660: 2020 2020 2020 2069 6e70 745f 7472 203d         inpt_tr =
-0008a670: 2069 6e70 745f 6661 0a20 2020 2020 2020   inpt_fa.       
-0008a680: 200a 2020 2020 2020 2020 715f 6376 6720   .        q_cvg 
-0008a690: 3d20 2771 6376 6727 0a20 2020 2020 2020  = 'qcvg'.       
-0008a6a0: 2071 5f6c 656e 203d 2027 716c 656e 270a   q_len = 'qlen'.
-0008a6b0: 2020 2020 2020 2020 715f 6964 203d 2027          q_id = '
-0008a6c0: 7169 6427 0a20 2020 2020 2020 2073 5f73  qid'.        s_s
-0008a6d0: 7461 7274 203d 2027 7373 7461 7274 270a  tart = 'sstart'.
-0008a6e0: 2020 2020 2020 2020 735f 656e 6420 3d20          s_end = 
-0008a6f0: 2773 656e 6427 0a20 2020 2020 2020 2073  'send'.        s
-0008a700: 5f69 6420 3d20 2773 6964 270a 2020 2020  _id = 'sid'.    
-0008a710: 656c 7365 3a0a 2020 2020 2020 2020 7265  else:.        re
-0008a720: 665f 7472 203d 2069 6e70 745f 6661 0a20  f_tr = inpt_fa. 
-0008a730: 2020 2020 2020 2069 6e70 745f 7472 203d         inpt_tr =
-0008a740: 2072 6566 5f66 610a 2020 2020 2020 2020   ref_fa.        
-0008a750: 0a20 2020 2020 2020 2071 5f63 7667 203d  .        q_cvg =
-0008a760: 2027 7363 7667 270a 2020 2020 2020 2020   'scvg'.        
-0008a770: 715f 6c65 6e20 3d20 2773 6c65 6e27 0a20  q_len = 'slen'. 
-0008a780: 2020 2020 2020 2071 5f69 6420 3d20 2773         q_id = 's
-0008a790: 6964 270a 2020 2020 2020 2020 735f 7374  id'.        s_st
-0008a7a0: 6172 7420 3d20 2771 7374 6172 7427 0a20  art = 'qstart'. 
-0008a7b0: 2020 2020 2020 2073 5f65 6e64 203d 2027         s_end = '
-0008a7c0: 7165 6e64 270a 2020 2020 2020 2020 735f  qend'.        s_
-0008a7d0: 6964 203d 2027 7169 6427 0a20 2020 2023  id = 'qid'.    #
-0008a7e0: 2727 270a 2020 2020 0a20 2020 2066 696c  '''.    .    fil
-0008a7f0: 655f 6e61 6d65 7320 3d20 696e 7074 5f74  e_names = inpt_t
-0008a800: 722e 7370 6c69 7428 272e 2729 0a20 2020  r.split('.').   
-0008a810: 2066 6e61 6d65 203d 2027 272e 6a6f 696e   fname = ''.join
-0008a820: 2873 7420 666f 7220 7374 2069 6e20 6669  (st for st in fi
-0008a830: 6c65 5f6e 616d 6573 5b3a 2d31 5d20 290a  le_names[:-1] ).
-0008a840: 0a20 2020 2074 6e5f 696e 203d 205b 5d0a  .    tn_in = [].
-0008a850: 2020 2020 6620 3d20 6f70 656e 2869 6e70      f = open(inp
-0008a860: 745f 7472 2c27 7227 290a 2020 2020 6361  t_tr,'r').    ca
-0008a870: 6e64 5f63 6e74 203d 2030 0a20 2020 2066  nd_cnt = 0.    f
-0008a880: 6f72 206c 696e 6520 696e 2066 3a0a 2020  or line in f:.  
-0008a890: 2020 2020 2020 6966 206c 696e 655b 305d        if line[0]
-0008a8a0: 203d 3d20 273e 273a 0a20 2020 2020 2020   == '>':.       
-0008a8b0: 2020 2020 2074 6e5f 696e 2e61 7070 656e       tn_in.appen
-0008a8c0: 6428 6c69 6e65 5b31 3a2d 315d 290a 2020  d(line[1:-1]).  
-0008a8d0: 2020 2020 2020 2020 2020 6361 6e64 5f63            cand_c
-0008a8e0: 6e74 202b 3d20 310a 2020 2020 662e 636c  nt += 1.    f.cl
-0008a8f0: 6f73 6528 290a 2020 2020 0a20 2020 2074  ose().    .    t
-0008a900: 6e5f 7265 6620 3d20 5b5d 0a20 2020 2066  n_ref = [].    f
-0008a910: 203d 206f 7065 6e28 7265 665f 7472 2c27   = open(ref_tr,'
-0008a920: 7227 290a 2020 2020 7265 665f 636e 7420  r').    ref_cnt 
-0008a930: 3d20 300a 2020 2020 666f 7220 6c69 6e65  = 0.    for line
-0008a940: 2069 6e20 663a 0a20 2020 2020 2020 2069   in f:.        i
-0008a950: 6620 6c69 6e65 5b30 5d20 3d3d 2027 3e27  f line[0] == '>'
-0008a960: 3a0a 2020 2020 2020 2020 2020 2020 746e  :.            tn
-0008a970: 5f72 6566 2e61 7070 656e 6428 6c69 6e65  _ref.append(line
-0008a980: 5b31 3a2d 315d 290a 2020 2020 2020 2020  [1:-1]).        
-0008a990: 2020 2020 7265 665f 636e 7420 2b3d 2031      ref_cnt += 1
-0008a9a0: 0a20 2020 2066 2e63 6c6f 7365 2829 0a20  .    f.close(). 
-0008a9b0: 2020 2023 2070 7269 6e74 2827 4c65 6e3a     # print('Len:
-0008a9c0: 2025 692c 204e 753d 2025 6927 2025 2028   %i, Nu= %i' % (
-0008a9d0: 6c65 6e28 746e 292c 206c 656e 2870 642e  len(tn), len(pd.
-0008a9e0: 756e 6971 7565 2874 6e29 2929 2c20 656e  unique(tn))), en
-0008a9f0: 643d 2727 2029 0a20 2020 200a 2020 2020  d='' ).    .    
-0008aa00: 6966 2072 6566 203d 3d20 303a 0a20 2020  if ref == 0:.   
-0008aa10: 2020 2020 2074 6e20 3d20 746e 5f69 6e0a       tn = tn_in.
-0008aa20: 2020 2020 2020 2020 6e5f 6d61 785f 6361          n_max_ca
-0008aa30: 6e64 7320 3d20 310a 2020 2020 656c 7365  nds = 1.    else
-0008aa40: 3a0a 2020 2020 2020 2020 746e 203d 2074  :.        tn = t
-0008aa50: 6e5f 7265 660a 2020 2020 2020 2020 6e5f  n_ref.        n_
-0008aa60: 6d61 785f 6361 6e64 7320 3d20 206d 785f  max_cands =  mx_
-0008aa70: 6e63 616e 640a 2020 2020 2020 2020 746d  ncand.        tm
-0008aa80: 7020 3d20 6361 6e64 5f63 6e74 0a20 2020  p = cand_cnt.   
-0008aa90: 2020 2020 2063 616e 645f 636e 7420 3d20       cand_cnt = 
-0008aaa0: 7265 665f 636e 740a 2020 2020 2020 2020  ref_cnt.        
-0008aab0: 7265 665f 636e 7420 3d20 746d 700a 2020  ref_cnt = tmp.  
-0008aac0: 2020 0a20 2020 2023 2320 6d61 6b65 2062    .    ## make b
-0008aad0: 6c61 7374 2064 6220 7769 7468 2069 6e70  last db with inp
-0008aae0: 7574 5f74 720a 2020 2020 6966 2070 6174  ut_tr.    if pat
-0008aaf0: 685f 746f 5f62 6c61 7374 2069 7320 4e6f  h_to_blast is No
-0008ab00: 6e65 3a0a 2020 2020 2020 2020 636d 6420  ne:.        cmd 
-0008ab10: 3d20 276d 616b 6562 6c61 7374 6462 202d  = 'makeblastdb -
-0008ab20: 696e 2025 7320 2d64 6274 7970 6520 2573  in %s -dbtype %s
-0008ab30: 2720 2520 2869 6e70 745f 7472 2c20 6462  ' % (inpt_tr, db
-0008ab40: 7479 7065 290a 2020 2020 656c 7365 3a0a  type).    else:.
-0008ab50: 2020 2020 2020 2020 636d 6420 3d20 2725          cmd = '%
-0008ab60: 732f 6d61 6b65 626c 6173 7464 6220 2d69  s/makeblastdb -i
-0008ab70: 6e20 2573 202d 6462 7479 7065 2025 7327  n %s -dbtype %s'
-0008ab80: 2025 2028 7061 7468 5f74 6f5f 626c 6173   % (path_to_blas
-0008ab90: 742c 2069 6e70 745f 7472 2c20 6462 7479  t, inpt_tr, dbty
-0008aba0: 7065 290a 2020 2020 7265 7320 3d20 7375  pe).    res = su
-0008abb0: 6270 726f 6365 7373 2e63 6865 636b 5f6f  bprocess.check_o
-0008abc0: 7574 7075 7428 636d 642c 2073 6865 6c6c  utput(cmd, shell
-0008abd0: 3d54 7275 6529 0a20 2020 2023 2070 7269  =True).    # pri
-0008abe0: 6e74 2872 6573 2e64 6563 6f64 6528 2777  nt(res.decode('w
-0008abf0: 696e 646f 7773 2d31 3235 3227 2929 0a20  indows-1252')). 
-0008ac00: 0a20 2020 2073 7472 5f6f 7074 696f 6e20  .    str_option 
-0008ac10: 3d20 272d 6f75 7466 6d74 2022 3620 7173  = '-outfmt "6 qs
-0008ac20: 6571 6964 2073 7365 7169 6420 716c 656e  eqid sseqid qlen
-0008ac30: 206c 656e 6774 6820 736c 656e 2071 7374   length slen qst
-0008ac40: 6172 7420 7165 6e64 2073 7374 6172 7420  art qend sstart 
-0008ac50: 7365 6e64 206e 6964 656e 7420 6d69 736d  send nident mism
-0008ac60: 6174 6368 2067 6170 6f70 656e 2071 636f  atch gapopen qco
-0008ac70: 7673 2071 636f 7668 7370 2062 6974 7363  vs qcovhsp bitsc
-0008ac80: 6f72 6522 202d 6e75 6d5f 7468 7265 6164  ore" -num_thread
-0008ac90: 7320 3420 2d6d 6178 5f74 6172 6765 745f  s 4 -max_target_
-0008aca0: 7365 7173 2025 6927 2025 206e 5f6d 6178  seqs %i' % n_max
-0008acb0: 5f63 616e 6473 0a0a 2020 2020 6966 2064  _cands..    if d
-0008acc0: 6274 7970 6520 3d3d 2027 6e75 636c 273a  btype == 'nucl':
-0008acd0: 2070 7266 7820 3d20 276e 270a 2020 2020   prfx = 'n'.    
-0008ace0: 656c 7365 3a20 7072 6678 203d 2027 7027  else: prfx = 'p'
-0008acf0: 0a20 2020 2020 2020 200a 2020 2020 6966  .        .    if
-0008ad00: 2070 6174 685f 746f 5f62 6c61 7374 2069   path_to_blast i
-0008ad10: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0008ad20: 636d 6420 3d20 2762 6c61 7374 2573 2025  cmd = 'blast%s %
-0008ad30: 7320 2d64 6220 2573 202d 7175 6572 7920  s -db %s -query 
-0008ad40: 2573 202d 6f75 7420 2573 2e74 626c 7374  %s -out %s.tblst
-0008ad50: 2720 2520 2870 7266 782c 2073 7472 5f6f  ' % (prfx, str_o
-0008ad60: 7074 696f 6e2c 2069 6e70 745f 7472 2c20  ption, inpt_tr, 
-0008ad70: 7265 665f 7472 2c20 666e 616d 6529 0a20  ref_tr, fname). 
-0008ad80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0008ad90: 2063 6d64 203d 2027 2573 2f62 6c61 7374   cmd = '%s/blast
-0008ada0: 2573 2025 7320 2d64 6220 2573 202d 7175  %s %s -db %s -qu
-0008adb0: 6572 7920 2573 202d 6f75 7420 2573 2e74  ery %s -out %s.t
-0008adc0: 626c 7374 2720 2520 2870 6174 685f 746f  blst' % (path_to
-0008add0: 5f62 6c61 7374 2c20 7072 6678 2c20 7374  _blast, prfx, st
-0008ade0: 725f 6f70 7469 6f6e 2c20 696e 7074 5f74  r_option, inpt_t
-0008adf0: 722c 2072 6566 5f74 722c 2066 6e61 6d65  r, ref_tr, fname
-0008ae00: 290a 2020 2020 2020 2020 0a20 2020 2069  ).        .    i
-0008ae10: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
-0008ae20: 2822 5275 6e6e 696e 6720 426c 6173 742d  ("Running Blast-
-0008ae30: 2573 2077 6974 6820 2569 2063 616e 642e  %s with %i cand.
-0008ae40: 2025 6920 7265 662e 202e 2e2e 2022 2025   %i ref. ... " %
-0008ae50: 2028 6462 7479 7065 5b30 5d2e 7570 7065   (dbtype[0].uppe
-0008ae60: 7228 292c 6361 6e64 5f63 6e74 2c20 7265  r(),cand_cnt, re
-0008ae70: 665f 636e 7429 2c20 656e 643d 2727 2c20  f_cnt), end='', 
-0008ae80: 666c 7573 683d 5472 7565 293b 0a20 2020  flush=True);.   
-0008ae90: 2072 6573 203d 2073 7562 7072 6f63 6573   res = subproces
-0008aea0: 732e 6368 6563 6b5f 6f75 7470 7574 2863  s.check_output(c
-0008aeb0: 6d64 2c20 7368 656c 6c3d 5472 7565 290a  md, shell=True).
-0008aec0: 2020 2020 2320 7072 696e 7428 7265 732e      # print(res.
-0008aed0: 6465 636f 6465 2827 7769 6e64 6f77 732d  decode('windows-
-0008aee0: 3132 3532 2729 290a 2020 2020 6966 2076  1252')).    if v
-0008aef0: 6572 626f 7365 3a20 7072 696e 7428 2764  erbose: print('d
-0008af00: 6f6e 652e 2729 0a20 2020 200a 2020 2020  one.').    .    
-0008af10: 6f73 2e72 656d 6f76 6528 2027 2573 2e25  os.remove( '%s.%
-0008af20: 7368 7227 2025 2028 696e 7074 5f74 722c  shr' % (inpt_tr,
-0008af30: 2070 7266 7829 2029 0a20 2020 206f 732e   prfx) ).    os.
-0008af40: 7265 6d6f 7665 2820 2725 732e 2573 696e  remove( '%s.%sin
-0008af50: 2720 2520 2869 6e70 745f 7472 2c20 7072  ' % (inpt_tr, pr
-0008af60: 6678 2920 290a 2020 2020 6f73 2e72 656d  fx) ).    os.rem
-0008af70: 6f76 6528 2027 2573 2e25 7373 7127 2025  ove( '%s.%ssq' %
-0008af80: 2028 696e 7074 5f74 722c 2070 7266 7829   (inpt_tr, prfx)
-0008af90: 2029 0a20 2020 0a20 2020 2063 6f6c 6e61   ).   .    colna
-0008afa0: 6d65 7320 3d20 5b27 7169 6427 2c20 2773  mes = ['qid', 's
-0008afb0: 6964 272c 2027 716c 656e 272c 2027 616c  id', 'qlen', 'al
-0008afc0: 656e 272c 2027 736c 656e 272c 2027 7173  en', 'slen', 'qs
-0008afd0: 7461 7274 272c 2027 7165 6e64 272c 2027  tart', 'qend', '
-0008afe0: 7373 7461 7274 272c 2027 7365 6e64 272c  sstart', 'send',
-0008aff0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0008b000: 2020 2027 6e69 6465 6e74 272c 2027 6d69     'nident', 'mi
-0008b010: 736d 6174 6368 272c 2027 6761 706f 7065  smatch', 'gapope
-0008b020: 6e27 2c20 2771 636f 7673 272c 2027 7163  n', 'qcovs', 'qc
-0008b030: 6f76 6873 7027 2c20 2762 6974 7363 6f72  ovhsp', 'bitscor
-0008b040: 6527 5d0a 2020 2020 7462 6c73 7420 3d20  e'].    tblst = 
-0008b050: 2725 732e 7462 6c73 7427 2025 2066 6e61  '%s.tblst' % fna
-0008b060: 6d65 0a20 2020 2064 6620 3d20 7064 2e72  me.    df = pd.r
-0008b070: 6561 645f 6373 7628 7462 6c73 742c 2068  ead_csv(tblst, h
-0008b080: 6561 6465 7220 3d20 2769 6e66 6572 272c  eader = 'infer',
-0008b090: 206e 616d 6573 203d 2063 6f6c 6e61 6d65   names = colname
-0008b0a0: 732c 2073 6570 3d27 5c74 2729 0a20 2020  s, sep='\t').   
-0008b0b0: 200a 2020 2020 6f73 2e72 656d 6f76 6528   .    os.remove(
-0008b0c0: 2027 2573 2720 2520 2874 626c 7374 2920   '%s' % (tblst) 
-0008b0d0: 290a 2020 2020 0a20 2020 2069 6620 7665  ).    .    if ve
-0008b0e0: 7262 6f73 653a 2070 7269 6e74 2827 4e2e  rbose: print('N.
-0008b0f0: 6361 6e64 3a20 2569 2c20 4e2e 7375 626a  cand: %i, N.subj
-0008b100: 6563 742e 756e 6971 7565 3a20 2569 2720  ect.unique: %i' 
-0008b110: 2520 286c 656e 2874 6e29 2c20 6c65 6e28  % (len(tn), len(
-0008b120: 7064 2e75 6e69 7175 6528 6466 5b27 7369  pd.unique(df['si
-0008b130: 6427 5d29 2929 2029 0a0a 2020 2020 6466  d']))) )..    df
-0008b140: 5b27 7363 7667 275d 203d 2064 665b 2761  ['scvg'] = df['a
-0008b150: 6c65 6e27 5d2f 6466 5b27 736c 656e 275d  len']/df['slen']
-0008b160: 0a20 2020 2064 665b 2771 6376 6727 5d20  .    df['qcvg'] 
-0008b170: 3d20 6466 5b27 616c 656e 275d 2f64 665b  = df['alen']/df[
-0008b180: 2771 6c65 6e27 5d0a 2020 2020 2020 2020  'qlen'].        
-0008b190: 0a20 2020 2069 6620 7472 6172 6563 6f20  .    if trareco 
-0008b1a0: 3d3d 2054 7275 653a 0a20 2020 2020 2020  == True:.       
-0008b1b0: 2061 626e 5f65 203d 205b 5d0a 2020 2020   abn_e = [].    
-0008b1c0: 2020 2020 7470 6d5f 6520 3d20 5b5d 0a20      tpm_e = []. 
-0008b1d0: 2020 2020 2020 2069 6672 6163 203d 205b         ifrac = [
-0008b1e0: 5d0a 2020 2020 2020 2020 7369 6478 203d  ].        sidx =
-0008b1f0: 205b 5d0a 2020 2020 2020 2020 675f 7369   [].        g_si
-0008b200: 7a65 203d 205b 5d0a 2020 2020 2020 2020  ze = [].        
-0008b210: 6e5f 6578 6f6e 7320 3d20 5b5d 0a20 2020  n_exons = [].   
-0008b220: 2020 2020 2067 5f76 6f6c 203d 205b 5d0a       g_vol = [].
-0008b230: 2020 2020 2020 2020 6963 6e74 203d 205b          icnt = [
-0008b240: 5d0a 2020 2020 2020 2020 7374 726e 6420  ].        strnd 
-0008b250: 3d20 5b5d 0a20 2020 2020 2020 2063 646e  = [].        cdn
-0008b260: 6720 3d20 5b5d 0a20 2020 2020 2020 2066  g = [].        f
-0008b270: 6f72 206b 2069 6e20 7261 6e67 6528 6466  or k in range(df
-0008b280: 2e73 6861 7065 5b30 5d29 3a0a 2020 2020  .shape[0]):.    
-0008b290: 2020 2020 2020 2020 2320 7320 3d20 273e          # s = '>
-0008b2a0: 2573 5f43 6872 2573 3a25 692d 2569 5f25  %s_Chr%s:%i-%i_%
-0008b2b0: 695f 2569 5f25 695f 4162 6e3a 2534 2e33  i_%i_%i_Abn:%4.3
-0008b2c0: 665f 5450 4d3a 2534 2e32 665f 4946 7261  f_TPM:%4.2f_IFra
-0008b2d0: 633a 2533 2e32 665c 6e27 200a 2020 2020  c:%3.2f\n' .    
-0008b2e0: 2020 2020 2020 2020 2320 2520 2874 722e          # % (tr.
-0008b2f0: 7072 6566 6978 2c20 7472 2e63 6872 2c20  prefix, tr.chr, 
-0008b300: 7472 2e73 7461 7274 2c20 7472 2e65 6e64  tr.start, tr.end
-0008b310: 2c20 7472 2e67 6964 782c 2074 722e 6772  , tr.gidx, tr.gr
-0008b320: 705f 7369 7a65 2c20 7472 2e69 636e 742c  p_size, tr.icnt,
-0008b330: 2074 722e 6162 6e2c 2074 722e 7470 6d2c   tr.abn, tr.tpm,
-0008b340: 2074 722e 6973 6f5f 6672 6163 290a 2020   tr.iso_frac).  
-0008b350: 2020 2020 2020 2020 2020 6864 7220 3d20            hdr = 
-0008b360: 6466 5b73 5f69 645d 5b6b 5d2e 7370 6c69  df[s_id][k].spli
-0008b370: 7428 2720 2729 0a20 2020 2020 2020 2020  t(' ').         
-0008b380: 2020 2069 7465 6d73 203d 2068 6472 5b30     items = hdr[0
-0008b390: 5d2e 7370 6c69 7428 275f 2729 0a20 2020  ].split('_').   
-0008b3a0: 2020 2020 2020 2020 2073 7472 6e64 2e61           strnd.a
-0008b3b0: 7070 656e 6428 2069 7465 6d73 5b32 5d29  ppend( items[2])
-0008b3c0: 0a20 2020 2020 2020 2020 2020 2063 646e  .            cdn
-0008b3d0: 672e 6170 7065 6e64 2820 6974 656d 735b  g.append( items[
-0008b3e0: 335d 290a 2020 2020 2020 2020 2020 2020  3]).            
-0008b3f0: 7369 6478 2e61 7070 656e 6428 2028 6974  sidx.append( (it
-0008b400: 656d 735b 345d 2920 290a 2020 2020 2020  ems[4]) ).      
-0008b410: 2020 2020 2020 675f 7369 7a65 2e61 7070        g_size.app
-0008b420: 656e 6428 2069 6e74 2869 7465 6d73 5b35  end( int(items[5
-0008b430: 5d29 2029 0a20 2020 2020 2020 2020 2020  ]) ).           
-0008b440: 2069 636e 742e 6170 7065 6e64 2820 696e   icnt.append( in
-0008b450: 7428 6974 656d 735b 365d 2920 290a 2020  t(items[6]) ).  
-0008b460: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-0008b470: 6974 656d 735b 375d 2e73 706c 6974 2827  items[7].split('
-0008b480: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
-0008b490: 6162 6e5f 652e 6170 7065 6e64 2820 666c  abn_e.append( fl
-0008b4a0: 6f61 7428 7661 6c5b 315d 2920 290a 2020  oat(val[1]) ).  
-0008b4b0: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-0008b4c0: 6974 656d 735b 385d 2e73 706c 6974 2827  items[8].split('
-0008b4d0: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
-0008b4e0: 7470 6d5f 652e 6170 7065 6e64 2820 666c  tpm_e.append( fl
-0008b4f0: 6f61 7428 7661 6c5b 315d 2920 290a 2020  oat(val[1]) ).  
-0008b500: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-0008b510: 6974 656d 735b 395d 2e73 706c 6974 2827  items[9].split('
-0008b520: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
-0008b530: 6966 7261 632e 6170 7065 6e64 2820 666c  ifrac.append( fl
-0008b540: 6f61 7428 7661 6c5b 315d 2920 290a 2020  oat(val[1]) ).  
-0008b550: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-0008b560: 6974 656d 735b 3131 5d2e 7370 6c69 7428  items[11].split(
-0008b570: 273a 2729 0a20 2020 2020 2020 2020 2020  ':').           
-0008b580: 206e 5f65 786f 6e73 2e61 7070 656e 6428   n_exons.append(
-0008b590: 2069 6e74 2876 616c 5b31 5d29 2029 0a20   int(val[1]) ). 
-0008b5a0: 2020 2020 2020 2020 2020 2076 616c 203d             val =
-0008b5b0: 2069 7465 6d73 5b31 325d 2e73 706c 6974   items[12].split
-0008b5c0: 2827 3a27 290a 2020 2020 2020 2020 2020  (':').          
-0008b5d0: 2020 675f 766f 6c2e 6170 7065 6e64 2820    g_vol.append( 
-0008b5e0: 696e 7428 7661 6c5b 315d 2920 290a 2020  int(val[1]) ).  
-0008b5f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008b600: 6162 6e5f 6520 3d20 6e70 2e7a 6572 6f73  abn_e = np.zeros
-0008b610: 2864 662e 7368 6170 655b 305d 290a 2020  (df.shape[0]).  
-0008b620: 2020 2020 2020 7470 6d5f 6520 3d20 6e70        tpm_e = np
-0008b630: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
-0008b640: 305d 290a 2020 2020 2020 2020 6966 7261  0]).        ifra
-0008b650: 6320 3d20 6e70 2e7a 6572 6f73 2864 662e  c = np.zeros(df.
-0008b660: 7368 6170 655b 305d 290a 2020 2020 2020  shape[0]).      
-0008b670: 2020 7369 6478 203d 206e 702e 6675 6c6c    sidx = np.full
-0008b680: 2864 662e 7368 6170 655b 305d 2c20 2727  (df.shape[0], ''
-0008b690: 290a 2020 2020 2020 2020 675f 7369 7a65  ).        g_size
-0008b6a0: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
-0008b6b0: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
-0008b6c0: 206e 5f65 786f 6e73 203d 206e 702e 7a65   n_exons = np.ze
-0008b6d0: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
-0008b6e0: 0a20 2020 2020 2020 2067 5f76 6f6c 203d  .        g_vol =
-0008b6f0: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
-0008b700: 7065 5b30 5d29 0a20 2020 2020 2020 2069  pe[0]).        i
-0008b710: 636e 7420 3d20 6e70 2e7a 6572 6f73 2864  cnt = np.zeros(d
-0008b720: 662e 7368 6170 655b 305d 290a 2020 2020  f.shape[0]).    
-0008b730: 2020 2020 7374 726e 6420 3d20 6e70 2e7a      strnd = np.z
-0008b740: 6572 6f73 2864 662e 7368 6170 655b 305d  eros(df.shape[0]
-0008b750: 290a 2020 2020 2020 2020 6364 6e67 203d  ).        cdng =
-0008b760: 206e 702e 7a65 726f 7328 6466 2e73 6861   np.zeros(df.sha
-0008b770: 7065 5b30 5d29 0a20 2020 2020 2020 200a  pe[0]).        .
-0008b780: 2020 2020 2327 2727 0a20 2020 2072 6566      #'''.    ref
-0008b790: 5f69 6e66 6f20 3d20 4661 6c73 650a 2020  _info = False.  
-0008b7a0: 2020 6966 206c 656e 2864 665b 715f 6964    if len(df[q_id
-0008b7b0: 5d5b 305d 2e73 706c 6974 2827 3a27 2929  ][0].split(':'))
-0008b7c0: 203d 3d20 343a 200a 2020 2020 2020 2020   == 4: .        
-0008b7d0: 7265 665f 696e 666f 203d 2054 7275 650a  ref_info = True.
-0008b7e0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-0008b7f0: 2752 6566 5f69 6e66 6f20 6973 2074 7275  'Ref_info is tru
-0008b800: 6527 290a 2020 2020 2020 2020 0a20 2020  e').        .   
-0008b810: 2069 6620 7265 665f 696e 666f 203d 3d20   if ref_info == 
-0008b820: 5472 7565 3a0a 2020 2020 2020 2020 6769  True:.        gi
-0008b830: 6420 3d20 5b5d 0a20 2020 2020 2020 2063  d = [].        c
-0008b840: 7667 203d 205b 5d0a 2020 2020 2020 2020  vg = [].        
-0008b850: 6162 6e5f 7420 3d20 5b5d 0a20 2020 2020  abn_t = [].     
-0008b860: 2020 2074 706d 5f74 203d 205b 5d0a 2020     tpm_t = [].  
-0008b870: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
-0008b880: 616e 6765 2864 662e 7368 6170 655b 305d  ange(df.shape[0]
-0008b890: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0008b8a0: 7465 6d73 203d 2064 665b 715f 6964 5d5b  tems = df[q_id][
-0008b8b0: 6b5d 2e73 706c 6974 2827 3a27 290a 2020  k].split(':').  
-0008b8c0: 2020 2020 2020 2020 2020 6769 642e 6170            gid.ap
-0008b8d0: 7065 6e64 2820 6974 656d 735b 305d 2029  pend( items[0] )
-0008b8e0: 0a20 2020 2020 2020 2020 2020 2063 7667  .            cvg
-0008b8f0: 2e61 7070 656e 6428 2066 6c6f 6174 2869  .append( float(i
-0008b900: 7465 6d73 5b31 5d29 2029 0a20 2020 2020  tems[1]) ).     
-0008b910: 2020 2020 2020 2061 626e 5f74 2e61 7070         abn_t.app
-0008b920: 656e 6428 2066 6c6f 6174 2869 7465 6d73  end( float(items
-0008b930: 5b32 5d29 2029 0a20 2020 2020 2020 2020  [2]) ).         
-0008b940: 2020 2074 706d 5f74 2e61 7070 656e 6428     tpm_t.append(
-0008b950: 2066 6c6f 6174 2869 7465 6d73 5b33 5d29   float(items[3])
-0008b960: 2029 0a20 2020 2065 6c73 653a 0a20 2020   ).    else:.   
-0008b970: 2020 2020 2067 6964 203d 206e 702e 7a65       gid = np.ze
-0008b980: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
-0008b990: 0a20 2020 2020 2020 2063 7667 203d 206e  .        cvg = n
-0008b9a0: 702e 7a65 726f 7328 6466 2e73 6861 7065  p.zeros(df.shape
-0008b9b0: 5b30 5d29 0a20 2020 2020 2020 2061 626e  [0]).        abn
-0008b9c0: 5f74 203d 206e 702e 7a65 726f 7328 6466  _t = np.zeros(df
-0008b9d0: 2e73 6861 7065 5b30 5d29 0a20 2020 2020  .shape[0]).     
-0008b9e0: 2020 2074 706d 5f74 203d 206e 702e 7a65     tpm_t = np.ze
-0008b9f0: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
-0008ba00: 0a0a 2020 2020 2327 2727 0a20 2020 2064  ..    #'''.    d
-0008ba10: 665b 2765 7870 5f63 7667 275d 203d 2063  f['exp_cvg'] = c
-0008ba20: 7667 0a20 2020 2064 665b 2761 626e 5f74  vg.    df['abn_t
-0008ba30: 7275 6527 5d20 3d20 6162 6e5f 740a 2020  rue'] = abn_t.  
-0008ba40: 2020 6466 5b27 6162 6e5f 6573 7427 5d20    df['abn_est'] 
-0008ba50: 3d20 6162 6e5f 650a 2020 2020 6466 5b27  = abn_e.    df['
-0008ba60: 7470 6d5f 7472 7565 275d 203d 2074 706d  tpm_true'] = tpm
-0008ba70: 5f74 0a20 2020 2064 665b 2774 706d 5f65  _t.    df['tpm_e
-0008ba80: 7374 275d 203d 2074 706d 5f65 0a20 2020  st'] = tpm_e.   
-0008ba90: 2064 665b 2767 6964 7827 5d20 3d20 7369   df['gidx'] = si
-0008baa0: 6478 0a20 2020 2064 665b 2769 6964 7827  dx.    df['iidx'
-0008bab0: 5d20 3d20 6963 6e74 0a20 2020 2064 665b  ] = icnt.    df[
-0008bac0: 2767 5f73 697a 6527 5d20 3d20 675f 7369  'g_size'] = g_si
-0008bad0: 7a65 0a20 2020 2064 665b 2769 736f 5f66  ze.    df['iso_f
-0008bae0: 7261 6327 5d20 3d20 6966 7261 630a 2020  rac'] = ifrac.  
-0008baf0: 2020 6466 5b27 6e5f 6578 6f6e 7327 5d20    df['n_exons'] 
-0008bb00: 3d20 6e5f 6578 6f6e 730a 2020 2020 6466  = n_exons.    df
-0008bb10: 5b27 675f 766f 6c27 5d20 3d20 675f 766f  ['g_vol'] = g_vo
-0008bb20: 6c0a 2020 2020 6466 5b27 7374 7261 6e64  l.    df['strand
-0008bb30: 275d 203d 2073 7472 6e64 0a20 2020 2064  '] = strnd.    d
-0008bb40: 665b 2743 5f6f 725f 4e27 5d20 3d20 6364  f['C_or_N'] = cd
-0008bb50: 6e67 0a20 2020 2020 2020 200a 2020 2020  ng.        .    
-0008bb60: 6220 3d20 6466 5b71 5f63 7667 5d20 3e3d  b = df[q_cvg] >=
-0008bb70: 2030 2e38 0a20 2020 2064 665f 6e65 7720   0.8.    df_new 
-0008bb80: 3d20 6466 2e6c 6f63 5b62 2c3a 5d0a 2020  = df.loc[b,:].  
-0008bb90: 2020 6466 203d 2064 665f 6e65 770a 2020    df = df_new.  
-0008bba0: 2020 0a20 2020 2066 756c 6c5f 6e61 6d65    .    full_name
-0008bbb0: 7320 3d20 6466 5b71 5f69 645d 202b 2064  s = df[q_id] + d
-0008bbc0: 665b 735f 6964 5d0a 2020 2020 666e 7320  f[s_id].    fns 
-0008bbd0: 3d20 7064 2e75 6e69 7175 6528 6675 6c6c  = pd.unique(full
-0008bbe0: 5f6e 616d 6573 290a 2020 2020 6b20 3d20  _names).    k = 
-0008bbf0: 300a 2020 2020 6466 5f6c 7374 203d 205b  0.    df_lst = [
-0008bc00: 5d0a 2020 2020 666f 7220 666e 2069 6e20  ].    for fn in 
-0008bc10: 666e 733a 0a20 2020 2020 2020 2077 6820  fns:.        wh 
-0008bc20: 3d20 7768 6963 6828 6675 6c6c 5f6e 616d  = which(full_nam
-0008bc30: 6573 203d 3d20 666e 290a 2020 2020 2020  es == fn).      
-0008bc40: 2020 6466 5f74 6d70 203d 2064 662e 696c    df_tmp = df.il
-0008bc50: 6f63 5b77 685d 0a20 2020 2020 2020 2071  oc[wh].        q
-0008bc60: 6376 6720 3d20 6e70 2e61 7272 6179 2820  cvg = np.array( 
-0008bc70: 6466 5f74 6d70 5b71 5f63 7667 5d20 290a  df_tmp[q_cvg] ).
-0008bc80: 2020 2020 2020 2020 6f64 7220 3d20 7163          odr = qc
-0008bc90: 7667 2e61 7267 736f 7274 2829 0a20 2020  vg.argsort().   
-0008bca0: 2020 2020 2064 665f 6c73 742e 6170 7065       df_lst.appe
-0008bcb0: 6e64 2864 665f 746d 702e 696c 6f63 5b6f  nd(df_tmp.iloc[o
-0008bcc0: 6472 5b2d 315d 5d29 200a 2020 2020 2020  dr[-1]]) .      
-0008bcd0: 2020 6b20 2b3d 2031 0a0a 2020 2020 6966    k += 1..    if
-0008bce0: 206c 656e 2864 665f 6c73 7429 203e 2030   len(df_lst) > 0
-0008bcf0: 3a0a 2020 2020 2020 2020 6466 5f73 656c  :.        df_sel
-0008bd00: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
-0008bd10: 6466 5f6c 7374 290a 2020 2020 2020 2020  df_lst).        
-0008bd20: 2327 2727 0a20 2020 2020 2020 2074 7269  #'''.        tri
-0008bd30: 6e66 6f20 3d20 2725 735f 626c 6173 745f  nfo = '%s_blast_
-0008bd40: 7265 7375 6c74 2e74 7376 2720 2520 666e  result.tsv' % fn
-0008bd50: 616d 650a 2020 2020 2020 2020 6466 5f73  ame.        df_s
-0008bd60: 656c 2e74 6f5f 6373 7628 7472 696e 666f  el.to_csv(trinfo
-0008bd70: 2c20 6865 6164 6572 3d54 7275 652c 2069  , header=True, i
-0008bd80: 6e64 6578 3d46 616c 7365 2c20 7365 703d  ndex=False, sep=
-0008bd90: 275c 7427 290a 2020 2020 2020 2020 2320  '\t').        # 
-0008bda0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
-0008bdb0: 7428 2754 7261 6e73 6372 6970 746f 6d65  t('Transcriptome
-0008bdc0: 2049 6e66 6f2e 2077 7269 7474 656e 2074   Info. written t
-0008bdd0: 6f20 5c6e 2020 2025 732e 2720 2520 7472  o \n   %s.' % tr
-0008bde0: 696e 666f 2029 0a0a 2020 2020 2020 2020  info )..        
-0008bdf0: 6466 5f73 656c 203d 2070 642e 7265 6164  df_sel = pd.read
-0008be00: 5f63 7376 2874 7269 6e66 6f2c 2073 6570  _csv(trinfo, sep
-0008be10: 3d27 5c74 2729 0a20 2020 2020 2020 2023  ='\t').        #
-0008be20: 2727 270a 0a20 2020 2020 2020 2064 665f  '''..        df_
-0008be30: 7065 7266 2c20 6466 5f73 656c 203d 2067  perf, df_sel = g
-0008be40: 6574 5f70 6572 666f 726d 616e 6365 2864  et_performance(d
-0008be50: 665f 7365 6c2c 2066 5f74 6f5f 7361 7665  f_sel, f_to_save
-0008be60: 3d66 6e61 6d65 2c20 7265 6620 3d20 7265  =fname, ref = re
-0008be70: 662c 2076 6572 626f 7365 3d76 6572 626f  f, verbose=verbo
-0008be80: 7365 290a 2020 2020 2020 2020 6466 5f70  se).        df_p
-0008be90: 6572 665b 2770 7265 6369 7369 6f6e 275d  erf['precision']
-0008bea0: 203d 2072 6f75 6e64 2864 665f 7065 7266   = round(df_perf
-0008beb0: 5b27 4e5f 7265 636f 7665 7265 6427 5d2a  ['N_recovered']*
-0008bec0: 3130 302f 6361 6e64 5f63 6e74 2c31 290a  100/cand_cnt,1).
-0008bed0: 2020 2020 2020 2020 6466 5f70 6572 665b          df_perf[
-0008bee0: 2773 656e 7369 7469 7669 7479 275d 203d  'sensitivity'] =
-0008bef0: 2072 6f75 6e64 2864 665f 7065 7266 5b27   round(df_perf['
-0008bf00: 4e5f 7265 636f 7665 7265 6427 5d2a 3130  N_recovered']*10
-0008bf10: 302f 7265 665f 636e 742c 3129 0a20 2020  0/ref_cnt,1).   
-0008bf20: 2020 2020 2023 2069 6620 7665 7262 6f73       # if verbos
-0008bf30: 653a 2070 7269 6e74 2864 665f 7065 7266  e: print(df_perf
-0008bf40: 290a 2020 2020 2020 2020 2020 200a 2020  ).           .  
-0008bf50: 2020 2020 2020 6966 2074 7261 7265 636f        if trareco
-0008bf60: 203d 3d20 5472 7565 3a0a 2020 2020 2020   == True:.      
-0008bf70: 2020 2020 2020 6466 5f74 7220 3d20 6765        df_tr = ge
-0008bf80: 745f 696e 666f 5f66 726f 6d5f 7472 5f6e  t_info_from_tr_n
-0008bf90: 616d 6528 2074 6e20 290a 2020 2020 2020  ame( tn ).      
-0008bfa0: 2020 2020 2020 6466 5f74 725b 2764 6574        df_tr['det
-0008bfb0: 6563 7465 6427 5d20 3d20 4661 6c73 650a  ected'] = False.
-0008bfc0: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
-0008bfd0: 722e 6c6f 635b 6c69 7374 2864 665f 7365  r.loc[list(df_se
-0008bfe0: 6c5b 735f 6964 5d29 2c27 6465 7465 6374  l[s_id]),'detect
-0008bff0: 6564 275d 203d 2054 7275 6520 0a20 2020  ed'] = True .   
-0008c000: 2020 2020 2020 2020 2064 665f 7472 5b71           df_tr[q
-0008c010: 5f6c 656e 5d20 3d20 300a 2020 2020 2020  _len] = 0.      
-0008c020: 2020 2020 2020 666f 7220 6d2c 2073 6964        for m, sid
-0008c030: 2069 6e20 656e 756d 6572 6174 6528 6466   in enumerate(df
-0008c040: 5f73 656c 5b73 5f69 645d 293a 0a20 2020  _sel[s_id]):.   
-0008c050: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0008c060: 7472 2e6c 6f63 5b73 6964 2c71 5f6c 656e  tr.loc[sid,q_len
-0008c070: 5d20 3d20 6e70 2e72 6f75 6e64 2864 665f  ] = np.round(df_
-0008c080: 7365 6c2e 696c 6f63 5b6d 5d2e 716c 656e  sel.iloc[m].qlen
-0008c090: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0008c0a0: 5f74 725b 735f 7374 6172 745d 203d 2030  _tr[s_start] = 0
-0008c0b0: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
-0008c0c0: 665f 7472 2e6c 6f63 5b6c 6973 7428 6466  f_tr.loc[list(df
-0008c0d0: 5f73 656c 5b27 7369 6427 5d29 2c27 7363  _sel['sid']),'sc
-0008c0e0: 7667 275d 203d 2064 665f 7365 6c2e 6c6f  vg'] = df_sel.lo
-0008c0f0: 635b 3a2c 2773 6376 6727 5d20 0a20 2020  c[:,'scvg'] .   
-0008c100: 2020 2020 2020 2020 2066 6f72 206d 2c20           for m, 
-0008c110: 7369 6420 696e 2065 6e75 6d65 7261 7465  sid in enumerate
-0008c120: 2864 665f 7365 6c5b 735f 6964 5d29 3a0a  (df_sel[s_id]):.
-0008c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008c140: 6466 5f74 722e 6c6f 635b 7369 642c 735f  df_tr.loc[sid,s_
-0008c150: 7374 6172 745d 203d 206e 702e 726f 756e  start] = np.roun
-0008c160: 6428 6466 5f73 656c 2e69 6c6f 635b 6d5d  d(df_sel.iloc[m]
-0008c170: 2e73 7374 6172 7429 0a20 2020 2020 2020  .sstart).       
-0008c180: 2020 2020 2064 665f 7472 5b73 5f65 6e64       df_tr[s_end
-0008c190: 5d20 3d20 300a 2020 2020 2020 2020 2020  ] = 0.          
-0008c1a0: 2020 2320 6466 5f74 722e 6c6f 635b 6c69    # df_tr.loc[li
-0008c1b0: 7374 2864 665f 7365 6c5b 2773 6964 275d  st(df_sel['sid']
-0008c1c0: 292c 2773 6376 6727 5d20 3d20 6466 5f73  ),'scvg'] = df_s
-0008c1d0: 656c 2e6c 6f63 5b3a 2c27 7363 7667 275d  el.loc[:,'scvg']
-0008c1e0: 200a 2020 2020 2020 2020 2020 2020 666f   .            fo
-0008c1f0: 7220 6d2c 2073 6964 2069 6e20 656e 756d  r m, sid in enum
-0008c200: 6572 6174 6528 6466 5f73 656c 5b73 5f69  erate(df_sel[s_i
-0008c210: 645d 293a 0a20 2020 2020 2020 2020 2020  d]):.           
-0008c220: 2020 2020 2064 665f 7472 2e6c 6f63 5b73       df_tr.loc[s
-0008c230: 6964 2c73 5f65 6e64 5d20 3d20 6e70 2e72  id,s_end] = np.r
-0008c240: 6f75 6e64 2864 665f 7365 6c2e 696c 6f63  ound(df_sel.iloc
-0008c250: 5b6d 5d2e 7365 6e64 290a 2020 2020 2020  [m].send).      
-0008c260: 2020 2020 2020 6466 5f74 7220 3d20 6466        df_tr = df
-0008c270: 5f74 722e 7265 7365 745f 696e 6465 7828  _tr.reset_index(
-0008c280: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0008c290: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
-0008c2a0: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
-0008c2b0: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
-0008c2c0: 7475 726e 2864 665f 7065 7266 2c20 6466  turn(df_perf, df
-0008c2d0: 5f73 656c 2c20 6466 5f74 7229 0a20 2020  _sel, df_tr).   
-0008c2e0: 200a 2020 2020 656c 7365 3a0a 2020 2020   .    else:.    
-0008c2f0: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
-0008c300: 7072 696e 7428 274e 6f20 7472 2066 6f75  print('No tr fou
-0008c310: 6e64 2e20 2729 0a20 2020 2020 2020 2072  nd. ').        r
-0008c320: 6574 7572 6e28 4e6f 6e65 2c4e 6f6e 652c  eturn(None,None,
-0008c330: 4e6f 6e65 290a 2020 2020 0a0a 2323 2323  None).    ..####
-0008c340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c380: 2323 2323 2323 2323 2323 2323 2323 0a23  ##############.#
-0008c390: 2320 4675 6e63 7469 6f6e 7320 746f 2028  # Functions to (
-0008c3a0: 3129 2073 656c 6563 7420 7370 6563 6966  1) select specif
-0008c3b0: 6963 2063 6872 6d20 616e 6420 2832 2920  ic chrm and (2) 
-0008c3c0: 6f6e 6c79 2063 6f64 696e 6720 6765 6e65  only coding gene
-0008c3d0: 7320 696e 2061 2047 5446 0a23 2323 2323  s in a GTF.#####
-0008c3e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c3f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008c420: 2323 2323 2323 2323 2323 2323 230a 0a64  #############..d
-0008c430: 6566 2073 6f72 745f 6774 665f 6c69 6e65  ef sort_gtf_line
-0008c440: 735f 6c73 7428 6774 665f 6c69 6e65 735f  s_lst(gtf_lines_
-0008c450: 6c73 7429 3a0a 2020 2020 0a20 2020 2063  lst):.    .    c
-0008c460: 6872 7320 3d20 5b5d 0a20 2020 2066 6f72  hrs = [].    for
-0008c470: 206c 696e 6573 2069 6e20 6774 665f 6c69   lines in gtf_li
-0008c480: 6e65 735f 6c73 743a 0a20 2020 2020 2020  nes_lst:.       
-0008c490: 2066 6972 7374 5f6c 696e 6520 3d20 6c69   first_line = li
-0008c4a0: 6e65 735b 305d 0a20 2020 2020 2020 2063  nes[0].        c
-0008c4b0: 6872 732e 6170 7065 6e64 2866 6972 7374  hrs.append(first
-0008c4c0: 5f6c 696e 652e 6368 7229 0a0a 2020 2020  _line.chr)..    
-0008c4d0: 6368 725f 7365 7420 3d20 6c69 7374 2873  chr_set = list(s
-0008c4e0: 6574 2863 6872 7329 290a 2020 2020 6368  et(chrs)).    ch
-0008c4f0: 725f 7365 742e 736f 7274 2829 0a20 2020  r_set.sort().   
-0008c500: 2063 6872 7320 3d20 6e70 2e61 7272 6179   chrs = np.array
-0008c510: 2863 6872 7329 0a0a 2020 2020 6774 665f  (chrs)..    gtf_
-0008c520: 6c73 745f 6e65 7720 3d20 5b5d 0a20 2020  lst_new = [].   
-0008c530: 2066 6f72 2063 2069 6e20 6368 725f 7365   for c in chr_se
-0008c540: 743a 0a20 2020 2020 2020 2077 6820 3d20  t:.        wh = 
-0008c550: 7768 6963 6828 6368 7273 203d 3d20 6329  which(chrs == c)
-0008c560: 0a20 2020 2020 2020 2070 7320 3d20 6e70  .        ps = np
-0008c570: 2e61 7272 6179 2820 5b67 7466 5f6c 696e  .array( [gtf_lin
-0008c580: 6573 5f6c 7374 5b77 5d5b 305d 2e73 7461  es_lst[w][0].sta
-0008c590: 7274 2066 6f72 2077 2069 6e20 7768 5d20  rt for w in wh] 
-0008c5a0: 290a 2020 2020 2020 2020 6f64 7232 203d  ).        odr2 =
-0008c5b0: 2070 732e 6172 6773 6f72 7428 290a 2020   ps.argsort().  
-0008c5c0: 2020 2020 2020 666f 7220 6f20 696e 206f        for o in o
-0008c5d0: 6472 323a 0a20 2020 2020 2020 2020 2020  dr2:.           
-0008c5e0: 2077 203d 2077 685b 6f5d 0a20 2020 2020   w = wh[o].     
-0008c5f0: 2020 2020 2020 2067 7466 5f6c 7374 5f6e         gtf_lst_n
-0008c600: 6577 2e61 7070 656e 6428 6774 665f 6c69  ew.append(gtf_li
-0008c610: 6e65 735f 6c73 745b 775d 290a 2020 2020  nes_lst[w]).    
-0008c620: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
-0008c630: 6774 665f 6c73 745f 6e65 770a 0a0a 6465  gtf_lst_new...de
-0008c640: 6620 7365 6c65 6374 5f63 6f64 696e 675f  f select_coding_
-0008c650: 6765 6e65 735f 6672 6f6d 5f67 7466 5f66  genes_from_gtf_f
-0008c660: 696c 6528 6774 665f 6669 6c65 2c20 6765  ile(gtf_file, ge
-0008c670: 6e6f 6d65 5f66 696c 6529 3a0a 0a20 2020  nome_file):..   
-0008c680: 2066 6e73 203d 2067 7466 5f66 696c 652e   fns = gtf_file.
-0008c690: 7370 6c69 7428 272e 2729 5b3a 2d31 5d0a  split('.')[:-1].
-0008c6a0: 2020 2020 666e 616d 6520 3d20 2727 0a20      fname = ''. 
-0008c6b0: 2020 2066 6f72 206b 2c20 666e 2069 6e20     for k, fn in 
-0008c6c0: 656e 756d 6572 6174 6528 666e 7329 3a0a  enumerate(fns):.
-0008c6d0: 2020 2020 2020 2020 6966 206b 203e 2030          if k > 0
-0008c6e0: 3a0a 2020 2020 2020 2020 2020 2020 666e  :.            fn
-0008c6f0: 616d 6520 3d20 666e 616d 6520 2b20 272e  ame = fname + '.
-0008c700: 270a 2020 2020 2020 2020 666e 616d 6520  '.        fname 
-0008c710: 3d20 666e 616d 6520 2b20 666e 0a20 2020  = fname + fn.   
-0008c720: 200a 2020 2020 6774 665f 6c69 6e65 732c   .    gtf_lines,
-0008c730: 2068 6472 5f6c 696e 6573 203d 206c 6f61   hdr_lines = loa
-0008c740: 645f 6774 6628 6774 665f 6669 6c65 2c20  d_gtf(gtf_file, 
-0008c750: 7665 7262 6f73 6520 3d20 5472 7565 290a  verbose = True).
-0008c760: 2020 2020 0a20 2020 2062 6173 655f 6364      .    base_cd
-0008c770: 7320 3d20 6765 745f 6261 7365 5f63 6473  s = get_base_cds
-0008c780: 5f66 726f 6d5f 6774 665f 6c69 6e65 7328  _from_gtf_lines(
-0008c790: 6774 665f 6c69 6e65 7329 0a20 2020 2069  gtf_lines).    i
-0008c7a0: 6620 6261 7365 5f63 6473 203c 2030 3a0a  f base_cds < 0:.
-0008c7b0: 2020 2020 2020 2020 7072 696e 7428 2749          print('I
-0008c7c0: 4e46 4f3a 204e 6f20 636f 6469 6e67 2069  NFO: No coding i
-0008c7d0: 6e66 6f72 6d61 7469 6f6e 2070 726f 7669  nformation provi
-0008c7e0: 6465 6420 696e 2074 6865 2047 5446 2f47  ded in the GTF/G
-0008c7f0: 4646 2e27 290a 2020 2020 0a20 2020 2067  FF.').    .    g
-0008c800: 7466 5f6c 696e 6573 5f6c 7374 203d 2070  tf_lines_lst = p
-0008c810: 6172 7365 5f67 7466 5f6c 696e 6573 5f61  arse_gtf_lines_a
-0008c820: 6e64 5f73 706c 6974 5f69 6e74 6f5f 6765  nd_split_into_ge
-0008c830: 6e65 7328 2067 7466 5f6c 696e 6573 2029  nes( gtf_lines )
-0008c840: 0a20 2020 2067 656e 6f6d 6520 3d20 6c6f  .    genome = lo
-0008c850: 6164 5f67 656e 6f6d 6528 6765 6e6f 6d65  ad_genome(genome
-0008c860: 5f66 696c 6529 0a20 2020 2063 6872 7320  _file).    chrs 
-0008c870: 3d20 6765 6e6f 6d65 2e6b 6579 7328 290a  = genome.keys().
-0008c880: 0a20 2020 2067 7466 5f6c 696e 6573 5f6c  .    gtf_lines_l
-0008c890: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
-0008c8a0: 6363 6e74 203d 2030 0a20 2020 2067 636e  ccnt = 0.    gcn
-0008c8b0: 7420 3d20 300a 2020 2020 666f 7220 6b2c  t = 0.    for k,
-0008c8c0: 2067 6c69 6e65 7320 696e 2065 6e75 6d65   glines in enume
-0008c8d0: 7261 7465 2867 7466 5f6c 696e 6573 5f6c  rate(gtf_lines_l
-0008c8e0: 7374 293a 0a0a 2020 2020 2020 2020 6966  st):..        if
-0008c8f0: 2020 676c 696e 6573 5b30 5d2e 6368 7220    glines[0].chr 
-0008c900: 696e 2063 6872 733a 0a20 2020 2020 2020  in chrs:.       
-0008c910: 2020 2020 2074 725f 6c69 6e65 735f 6c73       tr_lines_ls
-0008c920: 7420 3d20 7061 7273 655f 6774 665f 6c69  t = parse_gtf_li
-0008c930: 6e65 735f 616e 645f 7370 6c69 745f 696e  nes_and_split_in
-0008c940: 746f 5f67 656e 6573 2820 676c 696e 6573  to_genes( glines
-0008c950: 2c20 2774 7261 6e73 6372 6970 7427 2029  , 'transcript' )
-0008c960: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-0008c970: 6573 5f6e 6577 203d 205b 5d0a 0a20 2020  es_new = []..   
-0008c980: 2020 2020 2020 2020 2066 6f72 206c 696e           for lin
-0008c990: 6573 2069 6e20 7472 5f6c 696e 6573 5f6c  es in tr_lines_l
-0008c9a0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-0008c9b0: 2020 2020 6220 3d20 4661 6c73 650a 2020      b = False.  
-0008c9c0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-0008c9d0: 7420 3d20 5b30 2c30 5d0a 2020 2020 2020  t = [0,0].      
-0008c9e0: 2020 2020 2020 2020 2020 666f 7220 6774            for gt
-0008c9f0: 666c 696e 6520 696e 206c 696e 6573 3a0a  fline in lines:.
-0008ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008ca10: 2020 2020 6966 2067 7466 6c69 6e65 2e66      if gtfline.f
-0008ca20: 6561 7475 7265 203d 3d20 2773 7461 7274  eature == 'start
-0008ca30: 5f63 6f64 6f6e 273a 0a20 2020 2020 2020  _codon':.       
-0008ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008ca50: 2063 6e74 5b30 5d20 2b3d 2031 0a20 2020   cnt[0] += 1.   
-0008ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008ca70: 2069 6620 6774 666c 696e 652e 6665 6174   if gtfline.feat
-0008ca80: 7572 6520 3d3d 2027 7374 6f70 5f63 6f64  ure == 'stop_cod
-0008ca90: 6f6e 273a 0a20 2020 2020 2020 2020 2020  on':.           
-0008caa0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
-0008cab0: 5b31 5d20 2b3d 2031 0a20 2020 2020 2020  [1] += 1.       
-0008cac0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0008cad0: 2863 6e74 5b30 5d20 3e20 3029 2026 2028  (cnt[0] > 0) & (
-0008cae0: 636e 745b 315d 203e 2030 293a 0a20 2020  cnt[1] > 0):.   
+00085640: 2020 2020 2020 2020 2020 2020 2020 6e76                nv
+00085650: 2e63 7667 5f64 6570 7468 2c20 6e76 2e63  .cvg_depth, nv.c
+00085660: 7667 5f66 7261 632c 206e 762e 7265 665f  vg_frac, nv.ref_
+00085670: 7365 712c 206e 762e 616c 745f 7365 712c  seq, nv.alt_seq,
+00085680: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00085690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000856a0: 2020 206e 762e 7374 7261 6e64 2c20 6e76     nv.strand, nv
+000856b0: 2e63 444e 415f 6368 616e 6765 2c20 6e76  .cDNA_change, nv
+000856c0: 2e43 6f64 6f6e 5f63 6861 6e67 652c 205c  .Codon_change, \
+000856d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000856e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000856f0: 206e 762e 5072 6f74 6569 6e5f 6368 616e   nv.Protein_chan
+00085700: 6765 2c20 6e76 2e50 726f 7465 696e 5f63  ge, nv.Protein_c
+00085710: 6861 6e67 6532 2c20 6e76 2e76 5f63 6c61  hange2, nv.v_cla
+00085720: 7373 5f74 7220 290a 2020 2020 7265 7475  ss_tr ).    retu
+00085730: 726e 206e 7669 0a0a 6465 6620 5374 7269  rn nvi..def Stri
+00085740: 6e67 4669 785f 7379 6e74 6865 7369 7328  ngFix_synthesis(
+00085750: 6774 665f 6669 6c65 2c20 6765 6e6f 6d65  gtf_file, genome
+00085760: 5f66 696c 652c 2072 6576 203d 2054 7275  _file, rev = Tru
+00085770: 652c 206e 5f63 6f72 6573 203d 2031 2c20  e, n_cores = 1, 
+00085780: 6f75 745f 6469 7220 3d20 4e6f 6e65 2c20  out_dir = None, 
+00085790: 6764 7320 3d20 4e6f 6e65 293a 0a0a 2020  gds = None):..  
+000857a0: 2020 2320 7072 696e 7428 2753 7472 696e    # print('Strin
+000857b0: 6746 6978 5f73 796e 7468 6573 6973 2073  gFix_synthesis s
+000857c0: 7461 7274 6564 2027 2c20 6461 7465 7469  tarted ', dateti
+000857d0: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
+000857e0: 2929 0a20 2020 200a 2020 2020 6966 2069  )).    .    if i
+000857f0: 7369 6e73 7461 6e63 6528 6765 6e6f 6d65  sinstance(genome
+00085800: 5f66 696c 652c 2073 7472 293a 0a20 2020  _file, str):.   
+00085810: 2020 2020 2067 656e 6f6d 6520 3d20 6c6f       genome = lo
+00085820: 6164 5f67 656e 6f6d 6528 6765 6e6f 6d65  ad_genome(genome
+00085830: 5f66 696c 652c 2076 6572 626f 7365 203d  _file, verbose =
+00085840: 2054 7275 6529 0a20 2020 2065 6c73 653a   True).    else:
+00085850: 0a20 2020 2020 2020 2067 656e 6f6d 6520  .        genome 
+00085860: 3d20 6765 6e6f 6d65 5f66 696c 650a 0a20  = genome_file.. 
+00085870: 2020 2069 6620 6764 7320 6973 204e 6f6e     if gds is Non
+00085880: 653a 0a20 2020 2020 2020 2067 7466 5f6c  e:.        gtf_l
+00085890: 696e 6573 2c20 6864 725f 6c69 6e65 7320  ines, hdr_lines 
+000858a0: 3d20 6c6f 6164 5f67 7466 2867 7466 5f66  = load_gtf(gtf_f
+000858b0: 696c 652c 2076 6572 626f 7365 203d 2054  ile, verbose = T
+000858c0: 7275 6529 0a20 2020 2020 2020 2067 645f  rue).        gd_
+000858d0: 6c73 742c 2063 6872 7320 3d20 6765 745f  lst, chrs = get_
+000858e0: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
+000858f0: 6774 665f 6c69 6e65 732c 2067 656e 6f6d  gtf_lines, genom
+00085900: 6520 3d20 4e6f 6e65 2c20 6669 6c6c 203d  e = None, fill =
+00085910: 2054 7275 652c 205c 0a20 2020 2020 2020   True, \.       
+00085920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085940: 2020 2020 2020 2020 6367 203d 2054 7275          cg = Tru
+00085950: 652c 2076 6572 626f 7365 203d 2054 7275  e, verbose = Tru
+00085960: 652c 206e 5f63 6f72 6573 203d 2031 290a  e, n_cores = 1).
+00085970: 2020 2020 2020 2020 6764 5f6c 7374 732c          gd_lsts,
+00085980: 2063 6872 5f6c 7374 203d 2070 6163 6b5f   chr_lst = pack_
+00085990: 6765 6e65 5f64 6573 6372 6970 746f 7228  gene_descriptor(
+000859a0: 2067 645f 6c73 742c 2063 6872 7320 290a   gd_lst, chrs ).
+000859b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000859c0: 2066 6f72 2067 646c 2069 6e20 6764 5f6c   for gdl in gd_l
+000859d0: 7374 733a 200a 2020 2020 2020 2020 2020  sts: .          
+000859e0: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
+000859f0: 6e75 6d65 7261 7465 2867 646c 293a 0a20  numerate(gdl):. 
+00085a00: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00085a10: 642e 7365 745f 636f 765f 6e5f 6162 6e5f  d.set_cov_n_abn_
+00085a20: 7468 2820 4d49 4e5f 434f 565f 544f 5f53  th( MIN_COV_TO_S
+00085a30: 454c 2c20 4d49 4e5f 4142 4e5f 544f 5f53  EL, MIN_ABN_TO_S
+00085a40: 454c 2029 0a0a 2020 2020 2020 2020 6e74  EL )..        nt
+00085a50: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
+00085a60: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
+00085a70: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
+00085a80: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
+00085a90: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
+00085aa0: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
+00085ab0: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
+00085ac0: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
+00085ad0: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
+00085ae0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00085af0: 725f 6c73 745f 6e65 772e 6170 7065 6e64  r_lst_new.append
+00085b00: 2863 6872 6d29 0a20 2020 2020 2020 2020  (chrm).         
+00085b10: 2020 2020 2020 2067 6763 5f74 7570 6c65         ggc_tuple
+00085b20: 2e61 7070 656e 6428 2028 6764 5f6c 7374  .append( (gd_lst
+00085b30: 735b 6b6b 5d2c 2067 656e 6f6d 655b 6368  s[kk], genome[ch
+00085b40: 726d 5d2e 7365 712c 2063 6872 6d29 2029  rm].seq, chrm) )
+00085b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00085b60: 2066 6f72 2067 6420 696e 2067 645f 6c73   for gd in gd_ls
+00085b70: 7473 5b6b 6b5d 3a0a 2020 2020 2020 2020  ts[kk]:.        
+00085b80: 2020 2020 2020 2020 2020 2020 6e74 725f              ntr_
+00085b90: 7661 6c69 6420 2b3d 2067 642e 6e74 720a  valid += gd.ntr.
+00085ba0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00085bb0: 274e 5f74 7273 2076 616c 6964 203d 2025  'N_trs valid = %
+00085bc0: 6927 2025 206e 7472 5f76 616c 6964 290a  i' % ntr_valid).
+00085bd0: 2020 2020 2020 2020 6465 6c20 6764 5f6c          del gd_l
+00085be0: 7374 730a 0a20 2020 2065 6c73 653a 0a20  sts..    else:. 
+00085bf0: 2020 2020 2020 2067 7466 5f6c 696e 6573         gtf_lines
+00085c00: 2c20 6864 725f 6c69 6e65 7320 3d20 6c6f  , hdr_lines = lo
+00085c10: 6164 5f67 7466 2867 7466 5f66 696c 652c  ad_gtf(gtf_file,
+00085c20: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
+00085c30: 2c20 686f 203d 2054 7275 6529 0a0a 2020  , ho = True)..  
+00085c40: 2020 2020 2020 666d 203d 207b 274d 273a        fm = {'M':
+00085c50: 2027 6578 6f6e 272c 2027 4927 3a20 2769   'exon', 'I': 'i
+00085c60: 6e73 6572 7369 6f6e 272c 2027 4427 3a20  nsersion', 'D': 
+00085c70: 2764 656c 6574 696f 6e27 7d0a 2020 2020  'deletion'}.    
+00085c80: 2020 2020 666f 7220 6d2c 2067 6420 696e      for m, gd in
+00085c90: 2065 6e75 6d65 7261 7465 2867 6473 293a   enumerate(gds):
+00085ca0: 0a20 2020 2020 2020 2020 2020 2067 642e  .            gd.
+00085cb0: 7365 745f 636f 765f 6e5f 6162 6e5f 7468  set_cov_n_abn_th
+00085cc0: 2820 4d49 4e5f 434f 565f 544f 5f53 454c  ( MIN_COV_TO_SEL
+00085cd0: 2c20 4d49 4e5f 4142 4e5f 544f 5f53 454c  , MIN_ABN_TO_SEL
+00085ce0: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+00085cf0: 6620 286c 656e 2867 642e 7267 6e73 2e72  f (len(gd.rgns.r
+00085d00: 676e 7329 203e 2030 293a 0a20 2020 2020  gns) > 0):.     
+00085d10: 2020 2020 2020 2020 2020 2067 642e 6578             gd.ex
+00085d20: 6f6e 732e 7267 6e73 2c20 6764 2e72 676e  ons.rgns, gd.rgn
+00085d30: 732e 7267 6e73 203d 2067 642e 7267 6e73  s.rgns = gd.rgns
+00085d40: 2e72 676e 732c 2067 642e 6578 6f6e 732e  .rgns, gd.exons.
+00085d50: 7267 6e73 0a20 2020 2020 2020 2020 2020  rgns.           
+00085d60: 2020 2020 2067 642e 7465 5f74 6f5f 6765       gd.te_to_ge
+00085d70: 5f6d 6170 732c 2067 642e 7472 5f74 6f5f  _maps, gd.tr_to_
+00085d80: 6772 5f6d 6170 7320 3d20 6764 2e74 725f  gr_maps = gd.tr_
+00085d90: 746f 5f67 725f 6d61 7073 2c20 6764 2e74  to_gr_maps, gd.t
+00085da0: 655f 746f 5f67 655f 6d61 7073 0a20 2020  e_to_ge_maps.   
+00085db0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00085dc0: 2020 2020 2020 2020 2020 666f 7220 7220            for r 
+00085dd0: 696e 2067 642e 6578 6f6e 732e 7267 6e73  in gd.exons.rgns
+00085de0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00085df0: 2020 6966 2072 2e74 7970 6520 696e 2066    if r.type in f
+00085e00: 6d2e 6b65 7973 2829 3a0a 2020 2020 2020  m.keys():.      
+00085e10: 2020 2020 2020 2020 2020 2020 2020 722e                r.
+00085e20: 7479 7065 203d 2066 6d5b 722e 7479 7065  type = fm[r.type
+00085e30: 5d0a 0a20 2020 2020 2020 2063 6872 7320  ]..        chrs 
+00085e40: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00085e50: 2067 6420 696e 2067 6473 3a20 0a20 2020   gd in gds: .   
+00085e60: 2020 2020 2020 2020 2063 6872 732e 6170           chrs.ap
+00085e70: 7065 6e64 2867 642e 6368 7229 0a0a 2020  pend(gd.chr)..  
+00085e80: 2020 2020 2020 6368 725f 6c73 7420 3d20        chr_lst = 
+00085e90: 6c69 7374 2873 6574 2863 6872 7329 290a  list(set(chrs)).
+00085ea0: 2020 2020 2020 2020 6368 725f 6c73 742e          chr_lst.
+00085eb0: 736f 7274 2829 0a20 2020 2020 2020 2063  sort().        c
+00085ec0: 6872 7320 3d20 6e70 2e61 7272 6179 2863  hrs = np.array(c
+00085ed0: 6872 7329 0a0a 2020 2020 2020 2020 6e74  hrs)..        nt
+00085ee0: 725f 7661 6c69 6420 3d20 300a 2020 2020  r_valid = 0.    
+00085ef0: 2020 2020 6767 635f 7475 706c 6520 3d20      ggc_tuple = 
+00085f00: 5b5d 0a20 2020 2020 2020 2063 6872 5f6c  [].        chr_l
+00085f10: 7374 5f6e 6577 203d 205b 5d0a 2020 2020  st_new = [].    
+00085f20: 2020 2020 666f 7220 6b6b 2c20 6368 726d      for kk, chrm
+00085f30: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
+00085f40: 725f 6c73 7429 3a0a 2020 2020 2020 2020  r_lst):.        
+00085f50: 2020 2020 6966 2063 6872 6d20 696e 2067      if chrm in g
+00085f60: 656e 6f6d 652e 6b65 7973 2829 3a0a 2020  enome.keys():.  
+00085f70: 2020 2020 2020 2020 2020 2020 2020 7768                wh
+00085f80: 203d 2077 6869 6368 2863 6872 7320 3d3d   = which(chrs ==
+00085f90: 2063 6872 6d29 0a20 2020 2020 2020 2020   chrm).         
+00085fa0: 2020 2020 2020 2069 6620 6c65 6e28 7768         if len(wh
+00085fb0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+00085fc0: 2020 2020 2020 2020 2020 2073 5f70 6f73             s_pos
+00085fd0: 203d 206e 702e 7a65 726f 7328 6c65 6e28   = np.zeros(len(
+00085fe0: 7768 292c 6474 7970 653d 6e70 2e66 6c6f  wh),dtype=np.flo
+00085ff0: 6174 3332 290a 2020 2020 2020 2020 2020  at32).          
+00086000: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
+00086010: 696e 2072 616e 6765 286c 656e 2877 6829  in range(len(wh)
+00086020: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
+00086030: 2020 2020 2020 2020 2020 2020 735f 706f              s_po
+00086040: 735b 6b5d 203d 2067 6473 5b77 685b 6b5d  s[k] = gds[wh[k]
+00086050: 5d2e 6265 6769 6e0a 2020 2020 2020 2020  ].begin.        
+00086060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086070: 6e74 725f 7661 6c69 6420 2b3d 2067 642e  ntr_valid += gd.
+00086080: 6e74 720a 2020 2020 2020 2020 2020 2020  ntr.            
+00086090: 2020 2020 2020 2020 6f64 7220 3d20 735f          odr = s_
+000860a0: 706f 732e 6172 6773 6f72 7428 290a 0a20  pos.argsort().. 
+000860b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000860c0: 2020 2063 6872 5f6c 7374 5f6e 6577 2e61     chr_lst_new.a
+000860d0: 7070 656e 6428 6368 726d 290a 2020 2020  ppend(chrm).    
+000860e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000860f0: 6767 635f 7475 706c 652e 6170 7065 6e64  ggc_tuple.append
+00086100: 2820 285b 2067 6473 5b77 685b 6f64 725b  ( ([ gds[wh[odr[
+00086110: 6b5d 5d5d 2066 6f72 206b 2069 6e20 7261  k]]] for k in ra
+00086120: 6e67 6528 6c65 6e28 7768 2929 205d 2c20  nge(len(wh)) ], 
+00086130: 6765 6e6f 6d65 5b63 6872 6d5d 2e73 6571  genome[chrm].seq
+00086140: 2c20 6368 726d 2920 290a 0a20 2020 2020  , chrm) )..     
+00086150: 2020 2023 2070 7269 6e74 2827 4e5f 7472     # print('N_tr
+00086160: 7320 7661 6c69 6420 3d20 2569 2720 2520  s valid = %i' % 
+00086170: 6e74 725f 7661 6c69 6429 0a20 2020 2020  ntr_valid).     
+00086180: 2020 2064 656c 2067 6473 0a0a 0a20 2020     del gds...   
+00086190: 2066 696c 655f 6e61 6d65 203d 2067 7466   file_name = gtf
+000861a0: 5f66 696c 652e 7370 6c69 7428 272f 2729  _file.split('/')
+000861b0: 5b2d 315d 0a20 2020 2023 2066 6e61 6d65  [-1].    # fname
+000861c0: 203d 2066 696c 655f 6e61 6d65 2e73 706c   = file_name.spl
+000861d0: 6974 2827 2e27 295b 305d 0a20 2020 2066  it('.')[0].    f
+000861e0: 6e73 203d 2066 696c 655f 6e61 6d65 2e73  ns = file_name.s
+000861f0: 706c 6974 2827 2e27 295b 3a2d 315d 0a20  plit('.')[:-1]. 
+00086200: 2020 2066 6e61 6d65 203d 2027 270a 2020     fname = ''.  
+00086210: 2020 666f 7220 6b2c 2066 6e20 696e 2065    for k, fn in e
+00086220: 6e75 6d65 7261 7465 2866 6e73 293a 0a20  numerate(fns):. 
+00086230: 2020 2020 2020 2069 6620 6b20 3e20 303a         if k > 0:
+00086240: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
+00086250: 6d65 203d 2066 6e61 6d65 202b 2027 2e27  me = fname + '.'
+00086260: 0a20 2020 2020 2020 2066 6e61 6d65 203d  .        fname =
+00086270: 2066 6e61 6d65 202b 2066 6e0a 0a20 2020   fname + fn..   
+00086280: 2069 6620 6f75 745f 6469 7220 6973 206e   if out_dir is n
+00086290: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000862a0: 2069 6620 6f75 745f 6469 725b 2d31 5d20   if out_dir[-1] 
+000862b0: 3d3d 2027 2f27 3a0a 2020 2020 2020 2020  == '/':.        
+000862c0: 2020 2020 666e 616d 6520 3d20 6f75 745f      fname = out_
+000862d0: 6469 7220 2b20 666e 616d 650a 2020 2020  dir + fname.    
+000862e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000862f0: 2020 2020 2020 666e 616d 6520 3d20 6f75        fname = ou
+00086300: 745f 6469 7220 2b20 272f 2720 2b20 666e  t_dir + '/' + fn
+00086310: 616d 650a 0a20 2020 2067 656e 6f6d 655f  ame..    genome_
+00086320: 6669 6c65 5f6e 6577 203d 2066 6e61 6d65  file_new = fname
+00086330: 202b 2027 5f63 7573 746f 6d69 7a65 645f   + '_customized_
+00086340: 6765 6e6f 6d65 2e66 6127 0a20 2020 2067  genome.fa'.    g
+00086350: 7466 5f66 696c 655f 6e65 7720 3d20 666e  tf_file_new = fn
+00086360: 616d 6520 2b20 275f 6375 7374 6f6d 697a  ame + '_customiz
+00086370: 6564 2e67 7466 270a 2020 2020 6661 5f66  ed.gtf'.    fa_f
+00086380: 696c 655f 7472 5f6e 6577 203d 2066 6e61  ile_tr_new = fna
+00086390: 6d65 202b 2027 5f74 7261 6e73 6372 6970  me + '_transcrip
+000863a0: 746f 6d65 2e66 6127 0a20 2020 2066 615f  tome.fa'.    fa_
+000863b0: 6669 6c65 5f70 725f 6e65 7720 3d20 666e  file_pr_new = fn
+000863c0: 616d 6520 2b20 275f 7072 6f74 656f 6d65  ame + '_proteome
+000863d0: 2e66 6127 0a20 2020 2066 6e61 6d65 5f73  .fa'.    fname_s
+000863e0: 6e76 203d 2066 6e61 6d65 202b 2027 5f73  nv = fname + '_s
+000863f0: 6e76 5f73 756d 6d61 7279 2e74 7376 270a  nv_summary.tsv'.
+00086400: 2020 2020 666e 616d 655f 7663 6620 3d20      fname_vcf = 
+00086410: 666e 616d 6520 2b20 275f 736e 765f 7375  fname + '_snv_su
+00086420: 6d6d 6172 792e 7663 6627 0a0a 2020 2020  mmary.vcf'..    
+00086430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086460: 2323 2323 2323 0a20 2020 2063 6872 5f6c  ######.    chr_l
+00086470: 7374 203d 2063 6872 5f6c 7374 5f6e 6577  st = chr_lst_new
+00086480: 0a0a 2020 2020 6f66 5f64 6963 7420 3d20  ..    of_dict = 
+00086490: 7b7d 0a20 2020 2023 2067 6473 5f6c 7374  {}.    # gds_lst
+000864a0: 203d 205b 5d0a 2020 2020 2320 736e 765f   = [].    # snv_
+000864b0: 6c73 7420 3d20 5b5d 0a20 2020 2067 6473  lst = [].    gds
+000864c0: 5f6e 6577 203d 205b 5d0a 2020 2020 736e  _new = [].    sn
+000864d0: 765f 696e 666f 5f6c 7374 203d 205b 5d0a  v_info_lst = [].
+000864e0: 0a20 2020 206e 5f62 6173 6573 5f74 6f74  .    n_bases_tot
+000864f0: 616c 203d 2030 0a20 2020 206e 5f65 725f  al = 0.    n_er_
+00086500: 6261 7365 7320 3d20 300a 2020 2020 6e5f  bases = 0.    n_
+00086510: 626c 6b5f 746f 7461 6c20 3d20 300a 2020  blk_total = 0.  
+00086520: 2020 6e5f 6572 5f62 6c6b 203d 2030 0a20    n_er_blk = 0. 
+00086530: 2020 206e 7074 203d 2030 0a20 2020 206e     npt = 0.    n
+00086540: 7065 203d 2030 0a20 2020 200a 2020 2020  pe = 0.    .    
+00086550: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
+00086560: 652e 7469 6d65 2829 0a20 2020 2069 6620  e.time().    if 
+00086570: 286e 5f63 6f72 6573 203d 3d20 3129 207c  (n_cores == 1) |
+00086580: 2028 6c65 6e28 6368 725f 6c73 7429 203d   (len(chr_lst) =
+00086590: 3d20 3129 3a0a 2020 2020 2020 2020 666f  = 1):.        fo
+000865a0: 7220 6b6b 2069 6e20 7261 6e67 6528 6c65  r kk in range(le
+000865b0: 6e28 6368 725f 6c73 7429 293a 0a20 2020  n(chr_lst)):.   
+000865c0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000865d0: 5c72 2720 2b20 2720 272a 3130 302c 2065  \r' + ' '*100, e
+000865e0: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
+000865f0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00086600: 2070 7269 6e74 2827 5c72 5265 636f 6e73   print('\rRecons
+00086610: 7472 7563 7469 6e67 202e 2e20 2569 2f25  tructing .. %i/%
+00086620: 6920 2825 7329 2027 2025 2028 6b6b 2b31  i (%s) ' % (kk+1
+00086630: 2c20 6c65 6e28 6368 725f 6c73 7429 2c20  , len(chr_lst), 
+00086640: 6368 725f 6c73 745b 6b6b 5d29 2c20 656e  chr_lst[kk]), en
+00086650: 6420 3d20 2727 2c20 666c 7573 6820 3d20  d = '', flush = 
+00086660: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00086670: 2020 6764 5f73 656c 2c20 7365 715f 6e65    gd_sel, seq_ne
+00086680: 772c 2073 6e76 5f69 6e66 6f5f 6368 722c  w, snv_info_chr,
+00086690: 206f 662c 2063 6872 6d2c 2065 7374 6174   of, chrm, estat
+000866a0: 203d 206d 635f 636f 7265 5f72 6563 6f6e   = mc_core_recon
+000866b0: 7374 7275 6374 696f 6e28 6767 635f 7475  struction(ggc_tu
+000866c0: 706c 655b 6b6b 5d29 0a20 2020 2020 2020  ple[kk]).       
+000866d0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+000866e0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+000866f0: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
+00086700: 6d65 5b63 6872 6d5d 2e73 6571 203d 2073  me[chrm].seq = s
+00086710: 6571 5f6e 6577 0a20 2020 2020 2020 2020  eq_new.         
+00086720: 2020 206f 665f 6469 6374 5b63 6872 6d5d     of_dict[chrm]
+00086730: 203d 206f 660a 2020 2020 2020 2020 2020   = of.          
+00086740: 2020 2320 6764 735f 6c73 742e 6170 7065    # gds_lst.appe
+00086750: 6e64 2867 645f 7365 6c29 0a20 2020 2020  nd(gd_sel).     
+00086760: 2020 2020 2020 2023 2073 6e76 5f6c 7374         # snv_lst
+00086770: 2e61 7070 656e 6428 736e 765f 696e 666f  .append(snv_info
+00086780: 5f63 6872 290a 2020 2020 2020 2020 2020  _chr).          
+00086790: 2020 6764 735f 6e65 7720 3d20 6764 735f    gds_new = gds_
+000867a0: 6e65 7720 2b20 6764 5f73 656c 0a20 2020  new + gd_sel.   
+000867b0: 2020 2020 2020 2020 2073 6e76 5f69 6e66           snv_inf
+000867c0: 6f5f 6c73 7420 3d20 736e 765f 696e 666f  o_lst = snv_info
+000867d0: 5f6c 7374 202b 2073 6e76 5f69 6e66 6f5f  _lst + snv_info_
+000867e0: 6368 720a 0a20 2020 2020 2020 2020 2020  chr..           
+000867f0: 206e 6274 2c20 6e62 652c 206e 6c74 2c20   nbt, nbe, nlt, 
+00086800: 6e6c 652c 206e 742c 206e 653d 2065 7374  nle, nt, ne= est
+00086810: 6174 0a20 2020 2020 2020 2020 2020 206e  at.            n
+00086820: 5f62 6173 6573 5f74 6f74 616c 202b 3d20  _bases_total += 
+00086830: 6e62 740a 2020 2020 2020 2020 2020 2020  nbt.            
+00086840: 6e5f 6572 5f62 6173 6573 202b 3d20 6e62  n_er_bases += nb
+00086850: 650a 2020 2020 2020 2020 2020 2020 6e5f  e.            n_
+00086860: 626c 6b5f 746f 7461 6c20 2b3d 206e 6c74  blk_total += nlt
+00086870: 0a20 2020 2020 2020 2020 2020 206e 5f65  .            n_e
+00086880: 725f 626c 6b20 2b3d 206e 6c65 0a20 2020  r_blk += nle.   
+00086890: 2020 2020 2020 2020 206e 7074 202b 3d20           npt += 
+000868a0: 6e74 0a20 2020 2020 2020 2020 2020 206e  nt.            n
+000868b0: 7065 202b 3d20 6e65 0a20 2020 2020 2020  pe += ne.       
+000868c0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+000868d0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+000868e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000868f0: 2020 6e75 6d5f 636f 7265 203d 206d 696e    num_core = min
+00086900: 2820 6e5f 636f 7265 732c 2028 6370 755f  ( n_cores, (cpu_
+00086910: 636f 756e 7428 2920 2d20 3129 2029 0a20  count() - 1) ). 
+00086920: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
+00086930: 6e75 6d20 636f 7265 7320 746f 2075 7365  num cores to use
+00086940: 203d 207b 7d22 2e66 6f72 6d61 7428 6e75   = {}".format(nu
+00086950: 6d5f 636f 7265 2929 0a20 2020 2020 2020  m_core)).       
+00086960: 2070 6f6f 6c20 3d20 506f 6f6c 286e 756d   pool = Pool(num
+00086970: 5f63 6f72 6529 0a20 2020 2020 2020 2063  _core).        c
+00086980: 6e74 203d 2031 0a20 2020 2020 2020 2066  nt = 1.        f
+00086990: 6f72 2067 645f 7365 6c2c 2073 6571 5f6e  or gd_sel, seq_n
+000869a0: 6577 2c20 736e 765f 696e 666f 5f63 6872  ew, snv_info_chr
+000869b0: 2c20 6f66 2c20 6368 726d 2c20 6573 7461  , of, chrm, esta
+000869c0: 7420 696e 205c 0a20 2020 2020 2020 2020  t in \.         
+000869d0: 2020 2070 6f6f 6c2e 696d 6170 5f75 6e6f     pool.imap_uno
+000869e0: 7264 6572 6564 286d 635f 636f 7265 5f72  rdered(mc_core_r
+000869f0: 6563 6f6e 7374 7275 6374 696f 6e2c 2067  econstruction, g
+00086a00: 6763 5f74 7570 6c65 293a 0a20 2020 2020  gc_tuple):.     
+00086a10: 2020 2020 2020 2023 2074 7164 6d2e 7471         # tqdm.tq
+00086a20: 646d 5f6e 6f74 6562 6f6f 6b28 706f 6f6c  dm_notebook(pool
+00086a30: 2e69 6d61 705f 756e 6f72 6465 7265 6428  .imap_unordered(
+00086a40: 6d63 5f63 6f72 655f 7265 636f 6e73 7472  mc_core_reconstr
+00086a50: 7563 7469 6f6e 2c20 6767 635f 7475 706c  uction, ggc_tupl
+00086a60: 6529 2c20 746f 7461 6c3d 6c65 6e28 6767  e), total=len(gg
+00086a70: 635f 7475 706c 6529 293a 0a20 2020 2020  c_tuple)):.     
+00086a80: 2020 2020 2020 2023 2323 2323 2323 2323         #########
+00086a90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00086aa0: 230a 2020 2020 2020 2020 2020 2020 6765  #.            ge
+00086ab0: 6e6f 6d65 5b63 6872 6d5d 2e73 6571 203d  nome[chrm].seq =
+00086ac0: 2073 6571 5f6e 6577 0a20 2020 2020 2020   seq_new.       
+00086ad0: 2020 2020 206f 665f 6469 6374 5b63 6872       of_dict[chr
+00086ae0: 6d5d 203d 206f 660a 2020 2020 2020 2020  m] = of.        
+00086af0: 2020 2020 2320 6764 735f 6c73 742e 6170      # gds_lst.ap
+00086b00: 7065 6e64 2867 645f 7365 6c29 0a20 2020  pend(gd_sel).   
+00086b10: 2020 2020 2020 2020 2023 2073 6e76 5f6c           # snv_l
+00086b20: 7374 2e61 7070 656e 6428 736e 765f 696e  st.append(snv_in
+00086b30: 666f 5f63 6872 290a 2020 2020 2020 2020  fo_chr).        
+00086b40: 2020 2020 6764 735f 6e65 7720 3d20 6764      gds_new = gd
+00086b50: 735f 6e65 7720 2b20 6764 5f73 656c 0a20  s_new + gd_sel. 
+00086b60: 2020 2020 2020 2020 2020 2073 6e76 5f69             snv_i
+00086b70: 6e66 6f5f 6c73 7420 3d20 736e 765f 696e  nfo_lst = snv_in
+00086b80: 666f 5f6c 7374 202b 2073 6e76 5f69 6e66  fo_lst + snv_inf
+00086b90: 6f5f 6368 720a 2020 2020 2020 2020 2020  o_chr.          
+00086ba0: 2020 0a20 2020 2020 2020 2020 2020 206e    .            n
+00086bb0: 6274 2c20 6e62 652c 206e 6c74 2c20 6e6c  bt, nbe, nlt, nl
+00086bc0: 652c 206e 742c 206e 653d 2065 7374 6174  e, nt, ne= estat
+00086bd0: 0a20 2020 2020 2020 2020 2020 206e 5f62  .            n_b
+00086be0: 6173 6573 5f74 6f74 616c 202b 3d20 6e62  ases_total += nb
+00086bf0: 740a 2020 2020 2020 2020 2020 2020 6e5f  t.            n_
+00086c00: 6572 5f62 6173 6573 202b 3d20 6e62 650a  er_bases += nbe.
+00086c10: 2020 2020 2020 2020 2020 2020 6e5f 626c              n_bl
+00086c20: 6b5f 746f 7461 6c20 2b3d 206e 6c74 0a20  k_total += nlt. 
+00086c30: 2020 2020 2020 2020 2020 206e 5f65 725f             n_er_
+00086c40: 626c 6b20 2b3d 206e 6c65 0a20 2020 2020  blk += nle.     
+00086c50: 2020 2020 2020 206e 7074 202b 3d20 6e74         npt += nt
+00086c60: 0a20 2020 2020 2020 2020 2020 206e 7065  .            npe
+00086c70: 202b 3d20 6e65 0a20 2020 2020 2020 2020   += ne.         
+00086c80: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00086c90: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00086ca0: 2020 2020 2020 2020 2020 636e 7420 2b3d            cnt +=
+00086cb0: 2031 0a20 2020 2020 2020 2020 2020 2070   1.            p
+00086cc0: 7269 6e74 2827 5c72 5265 636f 6e73 7472  rint('\rReconstr
+00086cd0: 7563 7469 6e67 2028 2569 2920 2e2e 2025  ucting (%i) .. %
+00086ce0: 692f 2569 2028 2573 2920 2020 2020 2020  i/%i (%s)       
+00086cf0: 2020 2020 2027 2025 2028 6e75 6d5f 636f       ' % (num_co
+00086d00: 7265 2c20 636e 742c 206c 656e 2867 6763  re, cnt, len(ggc
+00086d10: 5f74 7570 6c65 292c 2063 6872 6d29 2c20  _tuple), chrm), 
+00086d20: 656e 6420 3d20 2720 2020 2020 2020 2020  end = '         
+00086d30: 2020 2020 2020 2020 2020 2020 2729 0a20              '). 
+00086d40: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00086d50: 2020 2020 706f 6f6c 2e63 6c6f 7365 2829      pool.close()
+00086d60: 0a20 2020 2020 2020 2070 6f6f 6c2e 6a6f  .        pool.jo
+00086d70: 696e 2829 0a20 2020 2020 2020 200a 2020  in().        .  
+00086d80: 2020 2727 270a 2020 2020 6764 735f 6e65    '''.    gds_ne
+00086d90: 7720 3d20 5b5d 0a20 2020 2073 6e76 5f69  w = [].    snv_i
+00086da0: 6e66 6f5f 6c73 7420 3d20 5b5d 0a20 2020  nfo_lst = [].   
+00086db0: 2066 6f72 206b 6b2c 2063 6872 6d20 696e   for kk, chrm in
+00086dc0: 2065 6e75 6d65 7261 7465 2863 6872 5f6c   enumerate(chr_l
+00086dd0: 7374 293a 0a20 2020 2020 2020 2067 6473  st):.        gds
+00086de0: 5f6e 6577 203d 2067 6473 5f6e 6577 202b  _new = gds_new +
+00086df0: 2067 6473 5f6c 7374 5b6b 6b5d 0a20 2020   gds_lst[kk].   
+00086e00: 2020 2020 2073 6e76 5f69 6e66 6f5f 6c73       snv_info_ls
+00086e10: 7420 3d20 736e 765f 696e 666f 5f6c 7374  t = snv_info_lst
+00086e20: 202b 2073 6e76 5f6c 7374 5b6b 6b5d 0a0a   + snv_lst[kk]..
+00086e30: 2020 2020 6465 6c20 6764 735f 6c73 740a      del gds_lst.
+00086e40: 2020 2020 2327 2727 0a20 2020 2020 0a20      #'''.     . 
+00086e50: 2020 2065 6c61 7073 6564 5f74 696d 6532     elapsed_time2
+00086e60: 203d 2074 696d 652e 7469 6d65 2829 202d   = time.time() -
+00086e70: 2073 7461 7274 5f74 696d 650a 2020 2020   start_time.    
+00086e80: 7072 696e 7428 275c 7252 6563 6f6e 7374  print('\rReconst
+00086e90: 7275 6374 696f 6e20 2e2e 2064 6f6e 652e  ruction .. done.
+00086ea0: 2028 2569 2920 2020 2020 2020 2020 2020   (%i)           
+00086eb0: 2027 2025 2028 656c 6170 7365 645f 7469   ' % (elapsed_ti
+00086ec0: 6d65 3229 2c20 666c 7573 6820 3d20 5472  me2), flush = Tr
+00086ed0: 7565 290a 2020 2020 7072 696e 7428 2749  ue).    print('I
+00086ee0: 6e74 6567 7269 7479 2063 6865 636b 3a20  ntegrity check: 
+00086ef0: 2025 692f 2569 2c20 2569 2f25 692c 2025   %i/%i, %i/%i, %
+00086f00: 692f 2569 2720 2520 5c0a 2020 2020 2020  i/%i' % \.      
+00086f10: 2020 2020 286e 5f65 725f 6261 7365 732c      (n_er_bases,
+00086f20: 206e 5f62 6173 6573 5f74 6f74 616c 2c20   n_bases_total, 
+00086f30: 6e5f 6572 5f62 6c6b 2c20 6e5f 626c 6b5f  n_er_blk, n_blk_
+00086f40: 746f 7461 6c2c 206e 7065 2c20 6e70 7429  total, npe, npt)
+00086f50: 2c20 666c 7573 6820 3d20 5472 7565 2029  , flush = True )
+00086f60: 0a20 2020 2020 200a 2020 2020 2727 2720  .      .    ''' 
+00086f70: 200a 2020 2020 4e74 725f 616c 6c20 3d20   .    Ntr_all = 
+00086f80: 300a 2020 2020 666f 7220 6764 2069 6e20  0.    for gd in 
+00086f90: 6764 735f 6e65 773a 204e 7472 5f61 6c6c  gds_new: Ntr_all
+00086fa0: 202b 3d20 6764 2e6e 7472 0a20 2020 2070   += gd.ntr.    p
+00086fb0: 7269 6e74 2827 4e5f 7472 2028 6166 7465  rint('N_tr (afte
+00086fc0: 7229 203d 2025 6927 2025 204e 7472 5f61  r) = %i' % Ntr_a
+00086fd0: 6c6c 290a 0a20 2020 206e 5f74 7220 3d20  ll)..    n_tr = 
+00086fe0: 300a 2020 2020 6e5f 6e65 675f 636f 7620  0.    n_neg_cov 
+00086ff0: 3d20 300a 2020 2020 6e5f 706f 735f 636f  = 0.    n_pos_co
+00087000: 7620 3d20 300a 2020 2020 666f 7220 6764  v = 0.    for gd
+00087010: 2069 6e20 6764 735f 6e65 773a 0a20 2020   in gds_new:.   
+00087020: 2020 2020 206e 5f74 7220 2b3d 2067 642e       n_tr += gd.
+00087030: 6e74 720a 2020 2020 2020 2020 666f 7220  ntr.        for 
+00087040: 7464 2069 6e20 6764 2e74 645f 6c73 743a  td in gd.td_lst:
+00087050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00087060: 7464 2e63 6f76 203c 3d20 303a 206e 5f6e  td.cov <= 0: n_n
+00087070: 6567 5f63 6f76 202b 3d20 310a 2020 2020  eg_cov += 1.    
+00087080: 2020 2020 2020 2020 656c 6966 2074 642e          elif td.
+00087090: 636f 7620 3e20 303a 206e 5f70 6f73 5f63  cov > 0: n_pos_c
+000870a0: 6f76 202b 3d20 310a 2020 2020 7072 696e  ov += 1.    prin
+000870b0: 7428 274e 5f74 7273 203d 2025 692c 2025  t('N_trs = %i, %
+000870c0: 692c 2025 6927 2025 2028 6e5f 7472 2c20  i, %i' % (n_tr, 
+000870d0: 6e5f 6e65 675f 636f 762c 206e 5f70 6f73  n_neg_cov, n_pos
+000870e0: 5f63 6f76 2929 0a20 2020 2023 2727 270a  _cov)).    #'''.
+000870f0: 2020 2020 2020 2020 0a20 2020 2073 7461          .    sta
+00087100: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
+00087110: 696d 6528 290a 2020 2020 6774 665f 6c69  ime().    gtf_li
+00087120: 6e65 7320 3d20 5b5d 0a20 2020 2066 615f  nes = [].    fa_
+00087130: 6c69 6e65 735f 7472 203d 205b 5d0a 2020  lines_tr = [].  
+00087140: 2020 6661 5f6c 696e 6573 5f70 7220 3d20    fa_lines_pr = 
+00087150: 5b5d 0a0a 2020 2020 2320 7361 7665 5f67  []..    # save_g
+00087160: 7466 3228 2066 6e61 6d65 2c20 6774 665f  tf2( fname, gtf_
+00087170: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
+00087180: 2068 6472 203d 204e 6f6e 652c 2066 6f20   hdr = None, fo 
+00087190: 3d20 4e6f 6e65 2063 6c6f 7365 203d 2046  = None close = F
+000871a0: 616c 7365 2029 0a20 2020 200a 2020 2020  alse ).    .    
+000871b0: 6966 2072 6576 3a20 0a20 2020 2020 2020  if rev: .       
+000871c0: 2068 6472 5f6c 696e 6573 2e61 7070 656e   hdr_lines.appen
+000871d0: 6428 2752 6566 2e20 6765 6e6f 6d65 3a20  d('Ref. genome: 
+000871e0: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
+000871f0: 6529 0a20 2020 2020 2020 2066 5f67 7466  e).        f_gtf
+00087200: 203d 2073 6176 655f 6774 6632 2820 6774   = save_gtf2( gt
+00087210: 665f 6669 6c65 5f6e 6577 2c20 6774 665f  f_file_new, gtf_
+00087220: 6c69 6e65 5f6c 7374 203d 204e 6f6e 652c  line_lst = None,
+00087230: 2068 6472 203d 2068 6472 5f6c 696e 6573   hdr = hdr_lines
+00087240: 2029 0a0a 2020 2020 6674 203d 206f 7065   )..    ft = ope
+00087250: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
+00087260: 2c20 2777 2b27 290a 2020 2020 6670 203d  , 'w+').    fp =
+00087270: 206f 7065 6e28 6661 5f66 696c 655f 7072   open(fa_file_pr
+00087280: 5f6e 6577 2c20 2777 2b27 290a 0a20 2020  _new, 'w+')..   
+00087290: 2067 6473 5f6e 6577 203d 2073 6f72 745f   gds_new = sort_
+000872a0: 6465 7363 7269 7074 6f72 5f6c 7374 2867  descriptor_lst(g
+000872b0: 6473 5f6e 6577 290a 2020 2020 636e 745f  ds_new).    cnt_
+000872c0: 6e6f 6e65 203d 2030 0a20 2020 2070 7269  none = 0.    pri
+000872d0: 6e74 2827 4765 6e65 7261 7469 6e67 2047  nt('Generating G
+000872e0: 5446 2061 6e64 2054 7261 6e73 6372 6970  TF and Transcrip
+000872f0: 746f 6d65 2f50 726f 7465 6f6d 6520 2e2e  tome/Proteome ..
+00087300: 2027 2c20 656e 643d 2720 2020 2027 290a   ', end='    ').
+00087310: 0a20 2020 2069 6620 6e5f 636f 7265 7320  .    if n_cores 
+00087320: 3d3d 2031 3a0a 2020 2020 2020 2020 636e  == 1:.        cn
+00087330: 745f 7420 3d20 300a 2020 2020 2020 2020  t_t = 0.        
+00087340: 636e 745f 7020 3d20 300a 2020 2020 2020  cnt_p = 0.      
+00087350: 2020 666f 7220 6d2c 2067 6420 696e 2065    for m, gd in e
+00087360: 6e75 6d65 7261 7465 2867 6473 5f6e 6577  numerate(gds_new
+00087370: 293a 0a20 2020 2020 2020 2020 2020 200a  ):.            .
+00087380: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00087390: 6d2b 3129 2531 3030 203d 3d20 303a 2070  m+1)%100 == 0: p
+000873a0: 7269 6e74 2827 5c72 4765 6e65 7261 7469  rint('\rGenerati
+000873b0: 6e67 2047 5446 2061 6e64 2054 7261 6e73  ng GTF and Trans
+000873c0: 6372 6970 746f 6d65 2f50 726f 7465 6f6d  criptome/Proteom
+000873d0: 6520 2e2e 2025 692f 2569 2720 2520 286d  e .. %i/%i' % (m
+000873e0: 2c20 6c65 6e28 6764 735f 6e65 7729 292c  , len(gds_new)),
+000873f0: 2065 6e64 203d 2027 2020 2027 2c20 666c   end = '   ', fl
+00087400: 7573 6820 3d20 5472 7565 290a 2020 2020  ush = True).    
+00087410: 2020 2020 2020 2020 6e74 722c 206e 7072          ntr, npr
+00087420: 2c20 6e65 7220 3d20 6764 2e75 7064 6174  , ner = gd.updat
+00087430: 655f 7464 5f69 6e66 6f28 7365 6c20 3d20  e_td_info(sel = 
+00087440: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
+00087450: 6529 2020 2020 2020 2020 2020 2020 0a20  e)            . 
+00087460: 2020 2020 2020 2020 2020 2067 7466 6c2c             gtfl,
+00087470: 2063 6e20 3d20 6764 2e67 6574 5f67 7466   cn = gd.get_gtf
+00087480: 5f6c 696e 6573 5f66 726f 6d5f 6578 6f6e  _lines_from_exon
+00087490: 7328 7365 6c20 3d20 312c 2061 6464 5f73  s(sel = 1, add_s
+000874a0: 6571 203d 2046 616c 7365 2c20 636f 6e6e  eq = False, conn
+000874b0: 6563 7420 3d20 5472 7565 290a 2020 2020  ect = True).    
+000874c0: 2020 2020 2020 2020 636e 745f 6e6f 6e65          cnt_none
+000874d0: 202b 3d20 636e 0a20 2020 2020 2020 2020   += cn.         
+000874e0: 2020 206c 742c 206c 7020 3d20 6764 2e67     lt, lp = gd.g
+000874f0: 6574 5f66 6173 7461 5f6c 696e 6573 5f66  et_fasta_lines_f
+00087500: 726f 6d5f 6578 6f6e 7328 7365 6c20 3d20  rom_exons(sel = 
+00087510: 312c 2070 6570 7469 6465 203d 2054 7275  1, peptide = Tru
+00087520: 6529 0a20 2020 2020 2020 2020 2020 206c  e).            l
+00087530: 7420 3d20 6669 6c74 6572 5f74 7273 5f6c  t = filter_trs_l
+00087540: 656e 286c 742c 206d 696e 5f6c 656e 203d  en(lt, min_len =
+00087550: 204d 494e 5f54 525f 4c45 4e47 5448 290a   MIN_TR_LENGTH).
+00087560: 2020 2020 2020 2020 2020 2020 6c70 203d              lp =
+00087570: 2066 696c 7465 725f 7472 735f 6c65 6e28   filter_trs_len(
+00087580: 6c70 2c20 6d69 6e5f 6c65 6e20 3d20 4d49  lp, min_len = MI
+00087590: 4e5f 5052 5f4c 454e 4754 4829 0a20 2020  N_PR_LENGTH).   
+000875a0: 2020 2020 2020 2020 2069 6620 7265 763a           if rev:
+000875b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000875c0: 2066 5f67 7466 203d 2073 6176 655f 6774   f_gtf = save_gt
+000875d0: 6632 2820 6774 665f 6669 6c65 5f6e 6577  f2( gtf_file_new
+000875e0: 2c20 6774 665f 6c69 6e65 5f6c 7374 203d  , gtf_line_lst =
+000875f0: 2067 7466 6c2c 2066 6f20 3d20 665f 6774   gtfl, fo = f_gt
+00087600: 6620 2920 0a20 2020 2020 2020 2020 2020  f ) .           
+00087610: 2020 2020 2023 2067 7466 5f6c 696e 6573       # gtf_lines
+00087620: 203d 2067 7466 5f6c 696e 6573 202b 2067   = gtf_lines + g
+00087630: 7466 6c0a 2020 2020 2020 2020 0a20 2020  tfl.        .   
+00087640: 2020 2020 2020 2020 2066 742e 7772 6974           ft.writ
+00087650: 656c 696e 6573 286c 7429 0a20 2020 2020  elines(lt).     
+00087660: 2020 2020 2020 2066 702e 7772 6974 656c         fp.writel
+00087670: 696e 6573 286c 7029 0a20 2020 2020 2020  ines(lp).       
+00087680: 2020 2020 2023 2066 615f 6c69 6e65 735f       # fa_lines_
+00087690: 7472 203d 2066 615f 6c69 6e65 735f 7472  tr = fa_lines_tr
+000876a0: 202b 206c 740a 2020 2020 2020 2020 2020   + lt.          
+000876b0: 2020 2320 6661 5f6c 696e 6573 5f70 7220    # fa_lines_pr 
+000876c0: 3d20 6661 5f6c 696e 6573 5f70 7220 2b20  = fa_lines_pr + 
+000876d0: 6c70 0a20 2020 2020 2020 2020 2020 2063  lp.            c
+000876e0: 6e74 5f74 202b 3d20 6c65 6e28 6c74 290a  nt_t += len(lt).
+000876f0: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+00087700: 7020 2b3d 206c 656e 286c 7029 0a20 2020  p += len(lp).   
+00087710: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00087720: 2020 656c 6170 7365 645f 7469 6d65 3220    elapsed_time2 
+00087730: 3d20 7469 6d65 2e74 696d 6528 2920 2d20  = time.time() - 
+00087740: 7374 6172 745f 7469 6d65 0a20 2020 2020  start_time.     
+00087750: 2020 2070 7269 6e74 2827 5c72 4765 6e65     print('\rGene
+00087760: 7261 7469 6e67 2047 5446 2061 6e64 2054  rating GTF and T
+00087770: 7261 6e73 6372 6970 746f 6d65 2f50 726f  ranscriptome/Pro
+00087780: 7465 6f6d 6520 2e2e 2025 692c 2025 6920  teome .. %i, %i 
+00087790: 646f 6e65 2e20 2825 6929 2027 2025 2028  done. (%i) ' % (
+000877a0: 6c65 6e28 6764 735f 6e65 7729 2c20 636e  len(gds_new), cn
+000877b0: 745f 6e6f 6e65 2c20 656c 6170 7365 645f  t_none, elapsed_
+000877c0: 7469 6d65 3229 2c20 666c 7573 6820 3d20  time2), flush = 
+000877d0: 5472 7565 290a 0a20 2020 2065 6c73 653a  True)..    else:
+000877e0: 0a20 2020 2020 2020 206e 756d 5f63 6f72  .        num_cor
+000877f0: 6520 3d20 6d69 6e28 206e 5f63 6f72 6573  e = min( n_cores
+00087800: 2c20 2863 7075 5f63 6f75 6e74 2829 202d  , (cpu_count() -
+00087810: 2031 2920 290a 2020 2020 2020 2020 2320   1) ).        # 
+00087820: 7072 696e 7428 226e 756d 2063 6f72 6573  print("num cores
+00087830: 2074 6f20 7573 6520 3d20 7b7d 222e 666f   to use = {}".fo
+00087840: 726d 6174 286e 756d 5f63 6f72 6529 290a  rmat(num_core)).
+00087850: 2020 2020 2020 2020 706f 6f6c 203d 2050          pool = P
+00087860: 6f6f 6c28 6e75 6d5f 636f 7265 290a 2020  ool(num_core).  
+00087870: 2020 2020 2020 636e 7420 3d20 310a 2020        cnt = 1.  
+00087880: 2020 2020 2020 636e 745f 7420 3d20 300a        cnt_t = 0.
+00087890: 2020 2020 2020 2020 636e 745f 7020 3d20          cnt_p = 
+000878a0: 300a 2020 2020 2020 2020 666f 7220 6774  0.        for gt
+000878b0: 666c 2c20 6c74 2c20 6c70 2c20 6368 726d  fl, lt, lp, chrm
+000878c0: 2c20 6e65 2c20 636e 2069 6e20 706f 6f6c  , ne, cn in pool
+000878d0: 2e6d 6170 286d 635f 636f 7265 5f67 6574  .map(mc_core_get
+000878e0: 5f67 7466 5f61 6e64 5f66 6173 7461 5f70  _gtf_and_fasta_p
+000878f0: 742c 2067 6473 5f6e 6577 293a 0a20 2020  t, gds_new):.   
+00087900: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00087910: 2020 2020 2020 636e 745f 6e6f 6e65 202b        cnt_none +
+00087920: 3d20 636e 0a20 2020 2020 2020 2020 2020  = cn.           
+00087930: 2069 6620 2863 6e74 2b31 2925 3130 3020   if (cnt+1)%100 
+00087940: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00087950: 2020 2020 2020 7072 696e 7428 275c 7247        print('\rG
+00087960: 656e 6572 6174 696e 6720 4754 4620 616e  enerating GTF an
+00087970: 6420 5472 616e 7363 7269 7074 6f6d 652f  d Transcriptome/
+00087980: 5072 6f74 656f 6d65 202e 2e20 2569 2f25  Proteome .. %i/%
+00087990: 6927 2025 2028 636e 742c 206c 656e 2867  i' % (cnt, len(g
+000879a0: 6473 5f6e 6577 2929 2c20 656e 6420 3d20  ds_new)), end = 
+000879b0: 2720 2020 2729 0a20 2020 2020 2020 2020  '   ').         
+000879c0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+000879d0: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
+000879e0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+000879f0: 2020 2020 2020 2020 2020 6c74 203d 2066            lt = f
+00087a00: 696c 7465 725f 7472 735f 6c65 6e28 6c74  ilter_trs_len(lt
+00087a10: 2c20 6d69 6e5f 6c65 6e20 3d20 4d49 4e5f  , min_len = MIN_
+00087a20: 5452 5f4c 454e 4754 4829 0a20 2020 2020  TR_LENGTH).     
+00087a30: 2020 2020 2020 206c 7020 3d20 6669 6c74         lp = filt
+00087a40: 6572 5f74 7273 5f6c 656e 286c 702c 206d  er_trs_len(lp, m
+00087a50: 696e 5f6c 656e 203d 204d 494e 5f50 525f  in_len = MIN_PR_
+00087a60: 4c45 4e47 5448 290a 2020 2020 2020 2020  LENGTH).        
+00087a70: 2020 2020 6966 2072 6576 3a0a 2020 2020      if rev:.    
+00087a80: 2020 2020 2020 2020 2020 2020 665f 6774              f_gt
+00087a90: 6620 3d20 7361 7665 5f67 7466 3228 2067  f = save_gtf2( g
+00087aa0: 7466 5f66 696c 655f 6e65 772c 2067 7466  tf_file_new, gtf
+00087ab0: 5f6c 696e 655f 6c73 7420 3d20 6774 666c  _line_lst = gtfl
+00087ac0: 2c20 666f 203d 2066 5f67 7466 2029 2020  , fo = f_gtf )  
+00087ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00087ae0: 2023 2067 7466 5f6c 696e 6573 203d 2067   # gtf_lines = g
+00087af0: 7466 5f6c 696e 6573 202b 2067 7466 6c0a  tf_lines + gtfl.
+00087b00: 0a20 2020 2020 2020 2020 2020 2066 742e  .            ft.
+00087b10: 7772 6974 656c 696e 6573 286c 7429 0a20  writelines(lt). 
+00087b20: 2020 2020 2020 2020 2020 2066 702e 7772             fp.wr
+00087b30: 6974 656c 696e 6573 286c 7029 0a20 2020  itelines(lp).   
+00087b40: 2020 2020 2020 2020 2023 2066 615f 6c69           # fa_li
+00087b50: 6e65 735f 7472 203d 2066 615f 6c69 6e65  nes_tr = fa_line
+00087b60: 735f 7472 202b 206c 740a 2020 2020 2020  s_tr + lt.      
+00087b70: 2020 2020 2020 2320 6661 5f6c 696e 6573        # fa_lines
+00087b80: 5f70 7220 3d20 6661 5f6c 696e 6573 5f70  _pr = fa_lines_p
+00087b90: 7220 2b20 6c70 0a20 2020 2020 2020 2020  r + lp.         
+00087ba0: 2020 2063 6e74 5f74 202b 3d20 6c65 6e28     cnt_t += len(
+00087bb0: 6c74 290a 2020 2020 2020 2020 2020 2020  lt).            
+00087bc0: 636e 745f 7020 2b3d 206c 656e 286c 7029  cnt_p += len(lp)
+00087bd0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00087be0: 2020 2020 2020 706f 6f6c 2e63 6c6f 7365        pool.close
+00087bf0: 2829 0a20 2020 2020 2020 2070 6f6f 6c2e  ().        pool.
+00087c00: 6a6f 696e 2829 0a0a 2020 2020 2020 2020  join()..        
+00087c10: 656c 6170 7365 645f 7469 6d65 3220 3d20  elapsed_time2 = 
+00087c20: 7469 6d65 2e74 696d 6528 2920 2d20 7374  time.time() - st
+00087c30: 6172 745f 7469 6d65 0a20 2020 2020 2020  art_time.       
+00087c40: 2070 7269 6e74 2827 5c72 4765 6e65 7261   print('\rGenera
+00087c50: 7469 6e67 2047 5446 2061 6e64 2054 7261  ting GTF and Tra
+00087c60: 6e73 6372 6970 746f 6d65 2f50 726f 7465  nscriptome/Prote
+00087c70: 6f6d 6520 2e2e 2064 6f6e 652e 2025 692c  ome .. done. %i,
+00087c80: 2025 692c 2025 6920 2825 6929 2027 2025   %i, %i (%i) ' %
+00087c90: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00087ca0: 2028 636e 745f 6e6f 6e65 2c20 696e 7428   (cnt_none, int(
+00087cb0: 636e 745f 742f 3229 2c20 696e 7428 636e  cnt_t/2), int(cn
+00087cc0: 745f 702f 3229 2c20 656c 6170 7365 645f  t_p/2), elapsed_
+00087cd0: 7469 6d65 3229 290a 2020 2020 2020 2020  time2)).        
+00087ce0: 0a20 2020 2069 6620 7265 763a 2073 6176  .    if rev: sav
+00087cf0: 655f 6774 6632 2820 6774 665f 6669 6c65  e_gtf2( gtf_file
+00087d00: 5f6e 6577 2c20 6774 665f 6c69 6e65 5f6c  _new, gtf_line_l
+00087d10: 7374 203d 204e 6f6e 652c 2066 6f20 3d20  st = None, fo = 
+00087d20: 665f 6774 662c 2063 6c6f 7365 203d 2054  f_gtf, close = T
+00087d30: 7275 6520 290a 2020 2020 6674 2e63 6c6f  rue ).    ft.clo
+00087d40: 7365 2829 0a20 2020 2066 702e 636c 6f73  se().    fp.clos
+00087d50: 6528 290a 0a20 2020 2023 2064 656c 2067  e()..    # del g
+00087d60: 6473 5f6e 6577 0a0a 2020 2020 2727 2720  ds_new..    ''' 
+00087d70: 2020 200a 2020 2020 7374 6172 745f 7469     .    start_ti
+00087d80: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
+00087d90: 0a20 2020 2070 7269 6e74 2827 5361 7669  .    print('Savi
+00087da0: 6e67 2046 4153 5441 2028 2569 2c20 2569  ng FASTA (%i, %i
+00087db0: 202f 2025 6929 202e 2e27 2025 2028 6c65   / %i) ..' % (le
+00087dc0: 6e28 6661 5f6c 696e 6573 5f74 7229 2f32  n(fa_lines_tr)/2
+00087dd0: 2c20 6c65 6e28 6661 5f6c 696e 6573 5f70  , len(fa_lines_p
+00087de0: 7229 2f32 2c20 6e5f 7472 292c 2065 6e64  r)/2, n_tr), end
+00087df0: 203d 2027 272c 2066 6c75 7368 203d 2054   = '', flush = T
+00087e00: 7275 6529 0a20 2020 2066 203d 206f 7065  rue).    f = ope
+00087e10: 6e28 6661 5f66 696c 655f 7472 5f6e 6577  n(fa_file_tr_new
+00087e20: 2c20 2777 2b27 290a 2020 2020 662e 7772  , 'w+').    f.wr
+00087e30: 6974 656c 696e 6573 2866 615f 6c69 6e65  itelines(fa_line
+00087e40: 735f 7472 290a 2020 2020 662e 636c 6f73  s_tr).    f.clos
+00087e50: 6528 290a 0a20 2020 2070 7269 6e74 2827  e()..    print('
+00087e60: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+00087e70: 6620 3d20 6f70 656e 2866 615f 6669 6c65  f = open(fa_file
+00087e80: 5f70 725f 6e65 772c 2027 772b 2729 0a20  _pr_new, 'w+'). 
+00087e90: 2020 2066 2e77 7269 7465 6c69 6e65 7328     f.writelines(
+00087ea0: 6661 5f6c 696e 6573 5f70 7229 0a20 2020  fa_lines_pr).   
+00087eb0: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
+00087ec0: 656c 6170 7365 645f 7469 6d65 203d 2074  elapsed_time = t
+00087ed0: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
+00087ee0: 7274 5f74 696d 650a 2020 2020 7072 696e  rt_time.    prin
+00087ef0: 7428 2720 646f 6e65 2e20 2825 6929 2720  t(' done. (%i)' 
+00087f00: 2520 2865 6c61 7073 6564 5f74 696d 6529  % (elapsed_time)
+00087f10: 290a 2020 2020 2727 270a 0a20 2020 2070  ).    '''..    p
+00087f20: 7269 6e74 2827 2020 2025 7327 2025 2066  rint('   %s' % f
+00087f30: 615f 6669 6c65 5f74 725f 6e65 7720 290a  a_file_tr_new ).
+00087f40: 2020 2020 7072 696e 7428 2720 2020 2573      print('   %s
+00087f50: 2720 2520 6661 5f66 696c 655f 7072 5f6e  ' % fa_file_pr_n
+00087f60: 6577 2029 0a20 2020 2069 6620 7265 763a  ew ).    if rev:
+00087f70: 2070 7269 6e74 2827 2020 2025 7327 2025   print('   %s' %
+00087f80: 2067 7466 5f66 696c 655f 6e65 7729 0a0a   gtf_file_new)..
+00087f90: 2020 2020 736e 765f 6c73 7420 3d20 5b5d      snv_lst = []
+00087fa0: 0a20 2020 2066 6f72 2073 6e76 2069 6e20  .    for snv in 
+00087fb0: 736e 765f 696e 666f 5f6c 7374 3a0a 2020  snv_info_lst:.  
+00087fc0: 2020 2020 2020 6e76 6920 3d20 746f 5f6e        nvi = to_n
+00087fd0: 765f 7369 6d70 6c65 2820 736e 7620 290a  v_simple( snv ).
+00087fe0: 2020 2020 2020 2020 736e 765f 6c73 742e          snv_lst.
+00087ff0: 6170 7065 6e64 286e 7669 290a 2020 2020  append(nvi).    
+00088000: 2020 2020 0a20 2020 2064 665f 736e 7620      .    df_snv 
+00088010: 3d20 7064 2e44 6174 6146 7261 6d65 2873  = pd.DataFrame(s
+00088020: 6e76 5f6c 7374 290a 2020 2020 6466 5f73  nv_lst).    df_s
+00088030: 6e76 2e74 6f5f 6373 7628 666e 616d 655f  nv.to_csv(fname_
+00088040: 736e 762c 2073 6570 203d 2027 5c74 2729  snv, sep = '\t')
+00088050: 0a20 2020 2070 7269 6e74 2827 534e 5620  .    print('SNV 
+00088060: 7375 6d6d 6172 7920 7361 7665 6420 746f  summary saved to
+00088070: 205c 6e20 2020 2573 2720 2520 666e 616d   \n   %s' % fnam
+00088080: 655f 736e 7629 0a20 2020 2023 2077 7269  e_snv).    # wri
+00088090: 7465 5f74 6f5f 7663 6628 2073 6e76 5f69  te_to_vcf( snv_i
+000880a0: 6e66 6f5f 6c73 742c 2066 6e61 6d65 5f76  nfo_lst, fname_v
+000880b0: 6366 2029 0a0a 2020 2020 2327 2727 2020  cf )..    #'''  
+000880c0: 2020 0a20 2020 2069 6620 7265 763a 0a20    .    if rev:. 
+000880d0: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
+000880e0: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
+000880f0: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
+00088100: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
+00088110: 6720 6375 7374 6f6d 697a 6564 2067 656e  g customized gen
+00088120: 6f6d 6520 2e2e 2027 2c20 656e 6420 3d20  ome .. ', end = 
+00088130: 2727 2c20 666c 7573 6820 3d20 5472 7565  '', flush = True
+00088140: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
+00088150: 2020 2023 2068 6472 5f6c 696e 6573 2e61     # hdr_lines.a
+00088160: 7070 656e 6428 2752 6566 2e20 6765 6e6f  ppend('Ref. geno
+00088170: 6d65 3a20 2573 2720 2520 6765 6e6f 6d65  me: %s' % genome
+00088180: 5f66 696c 6529 0a20 2020 2020 2020 2023  _file).        #
+00088190: 2073 6176 655f 6774 6628 6774 665f 6669   save_gtf(gtf_fi
+000881a0: 6c65 5f6e 6577 2c20 6774 665f 6c69 6e65  le_new, gtf_line
+000881b0: 732c 2068 6472 5f6c 696e 6573 290a 2020  s, hdr_lines).  
+000881c0: 2020 2020 2020 0a20 2020 2020 2020 2065        .        e
+000881d0: 6c61 7073 6564 5f74 696d 6520 3d20 7469  lapsed_time = ti
+000881e0: 6d65 2e74 696d 6528 2920 2d20 7374 6172  me.time() - star
+000881f0: 745f 7469 6d65 0a20 2020 2020 2020 2070  t_time.        p
+00088200: 7269 6e74 2827 2064 6f6e 652e 2025 6928  rint(' done. %i(
+00088210: 7329 205c 6e20 2020 2573 2720 2520 2865  s) \n   %s' % (e
+00088220: 6c61 7073 6564 5f74 696d 652c 2067 7466  lapsed_time, gtf
+00088230: 5f66 696c 655f 6e65 7729 290a 2020 2020  _file_new)).    
+00088240: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
+00088250: 2323 2053 6176 6520 6765 6e6f 6d65 2063  ## Save genome c
+00088260: 6f72 7265 6374 6564 0a20 2020 2020 2020  orrected.       
+00088270: 2070 7269 6e74 2827 596f 7520 6172 6520   print('You are 
+00088280: 616c 6d6f 7374 2064 6f6e 652e 205c 6e4c  almost done. \nL
+00088290: 6173 7420 7374 6570 2069 7320 746f 2073  ast step is to s
+000882a0: 6176 6520 7468 6520 6669 7865 6420 6765  ave the fixed ge
+000882b0: 6e6f 6d65 2e20 2729 0a20 2020 2020 2020  nome. ').       
+000882c0: 2073 6176 655f 6765 6e6f 6d65 2820 6765   save_genome( ge
+000882d0: 6e6f 6d65 5f66 696c 655f 6e65 772c 2067  nome_file_new, g
+000882e0: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
+000882f0: 2054 7275 652c 2074 6974 6c65 203d 2027   True, title = '
+00088300: 4765 6e6f 6d65 2d72 6576 2720 290a 2020  Genome-rev' ).  
+00088310: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+00088320: 2573 2720 2520 6765 6e6f 6d65 5f66 696c  %s' % genome_fil
+00088330: 655f 6e65 7720 290a 0a20 2020 2070 7269  e_new )..    pri
+00088340: 6e74 2827 5374 7269 6e67 4669 7820 6669  nt('StringFix fi
+00088350: 6e69 7368 6564 2027 2c20 6461 7465 7469  nished ', dateti
+00088360: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
+00088370: 2929 0a0a 2020 2020 7265 7475 726e 2066  ))..    return f
+00088380: 6e61 6d65 2c20 6765 6e6f 6d65 5f66 696c  name, genome_fil
+00088390: 655f 6e65 7720 232c 2067 6473 5f6e 6577  e_new #, gds_new
+000883a0: 0a20 2020 2023 2727 2720 2020 200a 0a64  .    #'''    ..d
+000883b0: 6566 2053 7472 696e 6746 6978 5f61 7373  ef StringFix_ass
+000883c0: 656d 626c 6528 2049 6e70 7574 203d 204e  emble( Input = N
+000883d0: 6f6e 652c 2067 656e 6f6d 655f 6661 203d  one, genome_fa =
+000883e0: 204e 6f6e 652c 2061 6e6e 6f74 5f67 7466   None, annot_gtf
+000883f0: 203d 204e 6f6e 652c 206f 7574 5f64 6972   = None, out_dir
+00088400: 203d 2027 5346 6978 5f6f 7574 272c 205c   = 'SFix_out', \
+00088410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00088420: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
+00088430: 203d 2034 2c20 6f75 745f 6375 7374 6f6d   = 4, out_custom
+00088440: 5f67 656e 6f6d 6520 3d20 4661 6c73 652c  _genome = False,
+00088450: 2073 7566 6669 7820 3d20 4e6f 6e65 2c20   suffix = None, 
+00088460: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00088470: 2020 2020 2020 2020 2020 6d63 7620 3d20            mcv = 
+00088480: 302e 352c 206d 6364 203d 2031 2c20 6d74  0.5, mcd = 1, mt
+00088490: 6c20 3d20 3230 302c 206d 706c 203d 2035  l = 200, mpl = 5
+000884a0: 302c 206d 6469 203d 2032 2c20 6d64 6420  0, mdi = 2, mdd 
+000884b0: 3d20 322c 206d 6470 203d 2033 2c20 5c0a  = 2, mdp = 3, \.
+000884c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000884d0: 2020 2020 2020 2020 6d64 6620 3d20 302e          mdf = 0.
+000884e0: 322c 206e 5f70 203d 2031 362c 2078 7361  2, n_p = 16, xsa
+000884f0: 203d 2054 7275 652c 206a 756d 705f 746f   = True, jump_to
+00088500: 203d 2030 2029 3a0a 0a20 2020 2070 7269   = 0 ):..    pri
+00088510: 6e74 2827 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('+-----------
+00088520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00088530: 2d2d 2d2b 2729 0a20 2020 2070 7269 6e74  ---+').    print
+00088540: 2827 7c20 2020 2020 2053 7472 696e 6766  ('|      Stringf
+00088550: 6978 2076 2e25 7320 2020 2020 2020 7c27  ix v.%s       |'
+00088560: 2025 2053 7472 696e 6746 6978 5f76 6572   % StringFix_ver
+00088570: 7369 6f6e 290a 2020 2020 7072 696e 7428  sion).    print(
+00088580: 272b 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '+--------------
+00088590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000885a0: 2b27 290a 0a20 2020 2069 6620 496e 7075  +')..    if Inpu
+000885b0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+000885c0: 2020 2070 7269 6e74 2827 5573 6167 653a     print('Usage:
+000885d0: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
+000885e0: 2827 2531 3273 3a20 2720 2520 2761 7267  ('%12s: ' % 'arg
+000885f0: 756d 656e 7427 2c20 2764 6573 6372 6970  ument', 'descrip
+00088600: 7469 6f6e 2720 290a 2020 2020 2020 2020  tion' ).        
+00088610: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
+00088620: 2027 496e 7075 7427 2c20 2749 6e70 7574   'Input', 'Input
+00088630: 2053 414d 206f 7220 4241 4d20 6669 6c65   SAM or BAM file
+00088640: 2e20 7079 6261 6d2e 7079 2069 7320 7265  . pybam.py is re
+00088650: 7175 6972 6564 2066 6f72 2042 414d 2069  quired for BAM i
+00088660: 6e70 7574 2e27 2029 0a20 2020 2020 2020  nput.' ).       
+00088670: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088680: 2520 2767 656e 6f6d 655f 6661 272c 2065  % 'genome_fa', e
+00088690: 6e64 203d 2027 2729 0a20 2020 2020 2020  nd = '').       
+000886a0: 2070 7269 6e74 2827 2047 656e 6f6d 6520   print(' Genome 
+000886b0: 6661 7374 6120 6669 6c65 2075 7365 6420  fasta file used 
+000886c0: 746f 2067 656e 6572 6174 6520 7468 6520  to generate the 
+000886d0: 696e 7075 7420 5341 4d2f 4241 4d2e 2027  input SAM/BAM. '
+000886e0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
+000886f0: 2827 2531 3273 2020 2049 7420 6973 2075  ('%12s   It is u
+00088700: 7365 6420 746f 2063 6f72 7265 6374 2073  sed to correct s
+00088710: 6571 7565 6e63 6573 206e 6f74 2063 6f76  equences not cov
+00088720: 6572 6564 2062 7920 7265 6164 732c 2027  ered by reads, '
+00088730: 2025 2027 2729 0a20 2020 2020 2020 2070   % '').        p
+00088740: 7269 6e74 2827 2531 3273 2020 2074 6f20  rint('%12s   to 
+00088750: 6964 656e 7469 6679 2053 4e50 7320 616e  identify SNPs an
+00088760: 6420 746f 2067 656e 6572 6174 6520 6375  d to generate cu
+00088770: 7374 6f6d 697a 6564 2067 656e 6f6d 652e  stomized genome.
+00088780: 2027 2020 2520 2727 290a 2020 2020 2020   '  % '').      
+00088790: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
+000887a0: 2025 2027 616e 6e6f 745f 6774 6627 2c20   % 'annot_gtf', 
+000887b0: 2747 5446 2f47 4646 2066 696c 6520 746f  'GTF/GFF file to
+000887c0: 2062 6520 7573 6564 2066 6f72 2067 7569   be used for gui
+000887d0: 6465 2061 6e6e 6f74 6174 696f 6e27 2029  de annotation' )
+000887e0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+000887f0: 2531 3273 3a20 2720 2520 276f 7574 5f64  %12s: ' % 'out_d
+00088800: 6972 272c 2027 4f75 7470 7574 2064 6972  ir', 'Output dir
+00088810: 6563 746f 7279 2720 290a 2020 2020 2020  ectory' ).      
+00088820: 2020 7072 696e 7428 2725 3132 733a 2027    print('%12s: '
+00088830: 2025 2027 6e5f 636f 7265 7327 2c20 274e   % 'n_cores', 'N
+00088840: 756d 6265 7220 6f66 2063 6f72 6573 2074  umber of cores t
+00088850: 6f20 7573 6527 2029 0a20 2020 2020 2020  o use' ).       
+00088860: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088870: 2520 2773 7566 6669 7827 2c20 2753 7566  % 'suffix', 'Suf
+00088880: 6669 7820 746f 2062 6520 7573 6564 2066  fix to be used f
+00088890: 6f72 206f 7574 7075 7420 6669 6c65 206e  or output file n
+000888a0: 616d 6573 2720 290a 2020 2020 2020 2020  ames' ).        
+000888b0: 7072 696e 7428 2725 3132 733a 2027 2025  print('%12s: ' %
+000888c0: 2027 6d63 7627 2c20 274d 696e 696d 756d   'mcv', 'Minimum
+000888d0: 2072 6561 6420 636f 7665 7261 6765 2066   read coverage f
+000888e0: 6f72 2069 6e63 6c75 7369 6f6e 2069 6e20  or inclusion in 
+000888f0: 7468 6520 6f75 7470 7574 2047 5446 2f47  the output GTF/G
+00088900: 4646 2720 290a 2020 2020 2020 2020 7072  FF' ).        pr
+00088910: 696e 7428 2725 3132 7320 2020 616e 6420  int('%12s   and 
+00088920: 7472 616e 7363 7269 7074 6f6d 652f 7072  transcriptome/pr
+00088930: 6f74 656f 6d65 205b 307e 315d 2e20 466f  oteome [0~1]. Fo
+00088940: 7220 6120 6c65 6e67 7468 204c 2074 7261  r a length L tra
+00088950: 6e73 6372 6970 742c 2027 2025 2027 2729  nscript, ' % '')
+00088960: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00088970: 2531 3273 2020 2069 7420 7769 6c6c 2062  %12s   it will b
+00088980: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
+00088990: 6520 6f75 7470 7574 2069 6620 6174 206c  e output if at l
+000889a0: 6561 7374 206d 6376 2a4c 2062 6173 6573  east mcv*L bases
+000889b0: 2061 7265 2063 6f76 6572 6564 2062 7920   are covered by 
+000889c0: 7265 6164 7320 2720 2025 2027 2729 0a20  reads '  % ''). 
+000889d0: 2020 2020 2020 2070 7269 6e74 2827 2531         print('%1
+000889e0: 3273 3a20 2720 2520 276d 6364 272c 2027  2s: ' % 'mcd', '
+000889f0: 4d69 6e69 6d75 6d20 6261 7365 2063 6f76  Minimum base cov
+00088a00: 6572 6167 6520 6465 7074 6820 666f 7220  erage depth for 
+00088a10: 696e 636c 7573 696f 6e20 696e 2074 6865  inclusion in the
+00088a20: 206f 7574 7075 7427 2029 0a20 2020 2020   output' ).     
+00088a30: 2020 2070 7269 6e74 2827 2531 3273 3a20     print('%12s: 
+00088a40: 2720 2520 276d 746c 272c 2027 4d69 6e69  ' % 'mtl', 'Mini
+00088a50: 6d75 6d20 7472 616e 7363 7269 7074 206c  mum transcript l
+00088a60: 656e 6774 6820 696e 2062 6173 6573 2720  ength in bases' 
+00088a70: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00088a80: 2725 3132 733a 2027 2025 2027 6d70 6c27  '%12s: ' % 'mpl'
+00088a90: 2c20 274d 696e 696d 756d 2070 726f 7465  , 'Minimum prote
+00088aa0: 696e 2028 616d 696e 6f20 6163 6964 2073  in (amino acid s
+00088ab0: 6571 7565 6e63 6529 206c 656e 6774 6827  equence) length'
+00088ac0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
+00088ad0: 2827 2531 3273 3a20 2720 2520 276d 6469  ('%12s: ' % 'mdi
+00088ae0: 272c 2027 4d69 6e69 6d75 6d20 636f 7665  ', 'Minimum cove
+00088af0: 7261 6765 2064 6570 7468 2066 6f72 2061  rage depth for a
+00088b00: 6e20 696e 7365 7273 696f 6e20 746f 2062  n insersion to b
+00088b10: 6520 636f 6e73 6964 6572 6564 2076 616c  e considered val
+00088b20: 6964 205b 3e3d 312e 305d 2720 290a 2020  id [>=1.0]' ).  
+00088b30: 2020 2020 2020 7072 696e 7428 2725 3132        print('%12
+00088b40: 733a 2027 2025 2027 6d64 6427 2c20 274d  s: ' % 'mdd', 'M
+00088b50: 696e 696d 756d 2063 6f76 6572 6167 6520  inimum coverage 
+00088b60: 6465 7074 6820 666f 7220 6120 6465 6c65  depth for a dele
+00088b70: 7469 6f6e 2074 6f20 6265 2063 6f6e 7369  tion to be consi
+00088b80: 6465 7265 6420 7661 6c69 6420 5b3e 3d31  dered valid [>=1
+00088b90: 2e30 5d27 2029 0a20 2020 2020 2020 2070  .0]' ).        p
+00088ba0: 7269 6e74 2827 2531 3273 3a20 2720 2520  rint('%12s: ' % 
+00088bb0: 276d 6470 272c 2027 4d69 6e69 6d75 6d20  'mdp', 'Minimum 
+00088bc0: 636f 7665 7261 6765 2064 6570 7468 2066  coverage depth f
+00088bd0: 6f72 2053 4e50 2063 6f72 7265 6374 696f  or SNP correctio
+00088be0: 6e20 5b3e 3d31 2e30 5d27 2029 0a20 2020  n [>=1.0]' ).   
+00088bf0: 2020 2020 2070 7269 6e74 2827 2531 3273       print('%12s
+00088c00: 3a20 2720 2520 276d 6466 272c 2027 4d69  : ' % 'mdf', 'Mi
+00088c10: 6e69 6d75 6d20 636f 7665 7261 6765 2064  nimum coverage d
+00088c20: 6570 7468 2066 7261 6374 696f 6e20 666f  epth fraction fo
+00088c30: 7220 696e 7365 7273 696f 6e20 616e 6420  r insersion and 
+00088c40: 6465 6c65 7469 6f6e 2074 6f20 6265 2063  deletion to be c
+00088c50: 6f6e 7369 6465 7265 6420 7661 6c69 6420  onsidered valid 
+00088c60: 2830 7e31 2927 2029 0a20 2020 2020 2020  (0~1)' ).       
+00088c70: 2070 7269 6e74 2827 2531 3273 3a20 2720   print('%12s: ' 
+00088c80: 2520 276a 756d 705f 746f 272c 2027 4a75  % 'jump_to', 'Ju
+00088c90: 6d70 2074 6f20 7374 6570 206a 205b 3020  mp to step j [0 
+00088ca0: 6f72 2031 206f 7220 325d 2720 290a 2020  or 1 or 2]' ).  
+00088cb0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00088cc0: 2020 7361 6d5f 6669 6c65 203d 2049 6e70    sam_file = Inp
+00088cd0: 7574 0a20 2020 2067 7466 5f66 696c 6520  ut.    gtf_file 
+00088ce0: 3d20 616e 6e6f 745f 6774 660a 0a20 2020  = annot_gtf..   
+00088cf0: 2069 6620 5059 4241 4d5f 4552 523a 0a20   if PYBAM_ERR:. 
+00088d00: 2020 2020 2020 2070 7269 6e74 2827 5374         print('St
+00088d10: 7269 6e67 4669 7820 5741 524e 494e 473a  ringFix WARNING:
+00088d20: 2070 7962 616d 206e 6f74 2061 7661 696c   pybam not avail
+00088d30: 6162 6c65 2e20 4163 6365 7074 2053 414d  able. Accept SAM
+00088d40: 2066 696c 6520 6f6e 6c79 2e27 290a 0a20   file only.').. 
+00088d50: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
+00088d60: 2069 7320 6e6f 7420 4e6f 6e65 2920 2620   is not None) & 
+00088d70: 2867 7466 5f66 696c 6520 6973 206e 6f74  (gtf_file is not
+00088d80: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
+00088d90: 7072 696e 7428 2753 7472 696e 6746 6978  print('StringFix
+00088da0: 2069 7320 7275 6e6e 696e 6720 696e 2061   is running in a
+00088db0: 6e6e 6f74 6174 696f 6e20 6775 6964 6564  nnotation guided
+00088dc0: 206d 6f64 6520 7769 7468 2073 6571 7565   mode with seque
+00088dd0: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
+00088de0: 290a 2020 2020 656c 6966 2028 6765 6e6f  ).    elif (geno
+00088df0: 6d65 5f66 6120 6973 206e 6f74 204e 6f6e  me_fa is not Non
+00088e00: 6529 2026 2028 6774 665f 6669 6c65 2069  e) & (gtf_file i
+00088e10: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
+00088e20: 2070 7269 6e74 2827 5374 7269 6e67 4669   print('StringFi
+00088e30: 7820 6973 2072 756e 6e69 6e67 2069 6e20  x is running in 
+00088e40: 6765 6e6f 6d65 2067 7569 6465 6420 6d6f  genome guided mo
+00088e50: 6465 2077 6974 6820 7365 7175 656e 6365  de with sequence
+00088e60: 2063 6f72 7265 6374 696f 6e2e 2729 0a20   correction.'). 
+00088e70: 2020 2065 6c69 6620 2867 656e 6f6d 655f     elif (genome_
+00088e80: 6661 2069 7320 4e6f 6e65 2920 2620 2867  fa is None) & (g
+00088e90: 7466 5f66 696c 6520 6973 204e 6f6e 6529  tf_file is None)
+00088ea0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00088eb0: 2753 7472 696e 6746 6978 2069 7320 7275  'StringFix is ru
+00088ec0: 6e6e 696e 6720 696e 2067 656e 6f6d 6520  nning in genome 
+00088ed0: 6775 6964 6564 206d 6f64 6520 7769 7468  guided mode with
+00088ee0: 6f75 7420 7365 7175 656e 6365 2063 6f72  out sequence cor
+00088ef0: 7265 6374 696f 6e2e 2729 0a20 2020 2065  rection.').    e
+00088f00: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
+00088f10: 6e74 2827 5374 7269 6e67 4669 7820 6973  nt('StringFix is
+00088f20: 2072 756e 6e69 6e67 2069 6e20 616e 6e6f   running in anno
+00088f30: 7461 7469 6f6e 2067 7569 6465 6420 6d6f  tation guided mo
+00088f40: 6465 2077 6974 686f 7574 2073 6571 7565  de without seque
+00088f50: 6e63 6520 636f 7272 6563 7469 6f6e 2e27  nce correction.'
+00088f60: 290a 2020 2020 0a0a 2020 2020 2320 7265  ).    ..    # re
+00088f70: 7620 3d20 4661 6c73 650a 2020 2020 7265  v = False.    re
+00088f80: 7620 3d20 6f75 745f 6375 7374 6f6d 5f67  v = out_custom_g
+00088f90: 656e 6f6d 650a 2020 2020 6362 7963 203d  enome.    cbyc =
+00088fa0: 2054 7275 6520 0a20 2020 2073 6120 3d20   True .    sa = 
+00088fb0: 320a 2020 2020 6966 2078 7361 3a20 7361  2.    if xsa: sa
+00088fc0: 203d 2030 0a0a 2020 2020 4d49 4e5f 4356   = 0..    MIN_CV
+00088fd0: 475f 464f 525f 534e 505f 434f 5252 4543  G_FOR_SNP_CORREC
+00088fe0: 5449 4f4e 203d 2069 6e74 286d 6470 290a  TION = int(mdp).
+00088ff0: 2020 2020 495f 5641 4c49 445f 4356 4720      I_VALID_CVG 
+00089000: 3d20 6d61 7828 312c 206e 702e 666c 6f61  = max(1, np.floa
+00089010: 7428 6d64 6929 290a 2020 2020 445f 5641  t(mdi)).    D_VA
+00089020: 4c49 445f 4356 4720 3d20 6d61 7828 312c  LID_CVG = max(1,
+00089030: 206e 702e 666c 6f61 7428 6d64 6429 290a   np.float(mdd)).
+00089040: 2020 2020 495f 5641 4c49 445f 4346 5241      I_VALID_CFRA
+00089050: 4320 3d20 666c 6f61 7428 6d64 6629 0a20  C = float(mdf). 
+00089060: 2020 2044 5f56 414c 4944 5f43 4652 4143     D_VALID_CFRAC
+00089070: 203d 2066 6c6f 6174 286d 6466 290a 2020   = float(mdf).  
+00089080: 2020 4d49 4e5f 434f 565f 544f 5f53 454c    MIN_COV_TO_SEL
+00089090: 203d 206e 702e 666c 6f61 7428 6d63 7629   = np.float(mcv)
+000890a0: 0a20 2020 204d 494e 5f41 424e 5f54 4f5f  .    MIN_ABN_TO_
+000890b0: 5345 4c20 3d20 6e70 2e66 6c6f 6174 286d  SEL = np.float(m
+000890c0: 6364 290a 2020 2020 4d49 4e5f 5452 5f4c  cd).    MIN_TR_L
+000890d0: 454e 4754 4820 3d20 696e 7428 6d74 6c29  ENGTH = int(mtl)
+000890e0: 0a20 2020 204d 494e 5f50 525f 4c45 4e47  .    MIN_PR_LENG
+000890f0: 5448 203d 2069 6e74 286d 706c 290a 2020  TH = int(mpl).  
+00089100: 2020 4d41 585f 4e55 4d5f 5041 5448 5320    MAX_NUM_PATHS 
+00089110: 3d20 696e 7428 6e5f 7029 0a20 2020 2047  = int(n_p).    G
+00089120: 454e 5f41 4153 5f55 4e53 5045 4320 3d20  EN_AAS_UNSPEC = 
+00089130: 5472 7565 0a0a 2020 2020 6966 2067 7466  True..    if gtf
+00089140: 5f66 696c 6520 6973 204e 6f6e 653a 0a20  _file is None:. 
+00089150: 2020 2020 2020 204d 4158 5f4e 554d 5f50         MAX_NUM_P
+00089160: 4154 4853 203d 2032 300a 2020 2020 2020  ATHS = 20.      
+00089170: 2020 4d49 4e5f 4e5f 5244 535f 5045 525f    MIN_N_RDS_PER_
+00089180: 4745 4e45 203d 2033 300a 2020 2020 2020  GENE = 30.      
+00089190: 2020 5452 5f46 494c 5445 525f 5345 4c20    TR_FILTER_SEL 
+000891a0: 3d20 320a 0a20 2020 2069 6620 6f75 745f  = 2..    if out_
+000891b0: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
+000891c0: 200a 2020 2020 2020 2020 6966 206e 6f74   .        if not
+000891d0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000891e0: 6f75 745f 6469 7229 3a20 6f73 2e6d 6b64  out_dir): os.mkd
+000891f0: 6972 286f 7574 5f64 6972 290a 0a20 2020  ir(out_dir)..   
+00089200: 2066 696c 655f 6f75 742c 2067 6473 2c20   file_out, gds, 
+00089210: 6765 6e6f 6d65 203d 2053 7472 696e 6746  genome = StringF
+00089220: 6978 5f61 6e61 6c79 7369 7328 7361 6d5f  ix_analysis(sam_
+00089230: 6669 6c65 2c20 6774 6620 3d20 6774 665f  file, gtf = gtf_
+00089240: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
+00089250: 6520 3d20 6765 6e6f 6d65 5f66 612c 206a  e = genome_fa, j
+00089260: 756d 7020 3d20 6a75 6d70 5f74 6f2c 205c  ump = jump_to, \
+00089270: 0a20 2020 2020 2020 2020 2020 206e 5f63  .            n_c
+00089280: 6f72 6573 3d6e 5f63 6f72 6573 2c20 6f75  ores=n_cores, ou
+00089290: 745f 7472 203d 2054 7275 652c 2063 6279  t_tr = True, cby
+000892a0: 6320 3d20 6362 7963 2c20 7375 6666 6978  c = cbyc, suffix
+000892b0: 203d 2073 7566 6669 782c 206f 7574 5f64   = suffix, out_d
+000892c0: 6972 203d 206f 7574 5f64 6972 2c20 7361  ir = out_dir, sa
+000892d0: 203d 2073 6120 2920 0a0a 2020 2020 6966   = sa ) ..    if
+000892e0: 2028 6764 7320 6973 206e 6f74 204e 6f6e   (gds is not Non
+000892f0: 6529 2026 2028 6a75 6d70 5f74 6f20 3c20  e) & (jump_to < 
+00089300: 3229 3a0a 2020 2020 2020 2020 7072 696e  2):.        prin
+00089310: 7428 2753 6176 696e 6720 6765 6e65 2064  t('Saving gene d
+00089320: 6573 6372 6970 746f 7220 2e2e 2027 2c20  escriptor .. ', 
+00089330: 656e 6420 3d20 2720 272c 2066 6c75 7368  end = ' ', flush
+00089340: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+00089350: 2077 6974 6820 6f70 656e 2866 696c 655f   with open(file_
+00089360: 6f75 7420 2b20 272e 6764 7327 2c20 2777  out + '.gds', 'w
+00089370: 6227 2920 6173 2066 3a0a 2020 2020 2020  b') as f:.      
+00089380: 2020 2020 2020 7069 636b 6c65 2e64 756d        pickle.dum
+00089390: 7028 2028 6764 7329 2c20 6620 290a 2020  p( (gds), f ).  
+000893a0: 2020 2020 2020 7072 696e 7428 2764 6f6e        print('don
+000893b0: 652e 2027 290a 2020 2020 656c 7365 3a0a  e. ').    else:.
+000893c0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+000893d0: 7472 696e 6746 6978 2073 7461 7274 6564  tringFix started
+000893e0: 2027 2c20 6461 7465 7469 6d65 2e64 6174   ', datetime.dat
+000893f0: 6574 696d 652e 6e6f 7728 2929 0a20 2020  etime.now()).   
+00089400: 2020 2020 2070 7269 6e74 2827 4c6f 6164       print('Load
+00089410: 696e 6720 6765 6e65 2064 6573 6372 6970  ing gene descrip
+00089420: 746f 7220 2e2e 2027 2c20 656e 6420 3d20  tor .. ', end = 
+00089430: 2720 272c 2066 6c75 7368 203d 2054 7275  ' ', flush = Tru
+00089440: 6529 0a20 2020 2020 2020 2077 6974 6820  e).        with 
+00089450: 6f70 656e 2866 696c 655f 6f75 7420 2b20  open(file_out + 
+00089460: 272e 6764 7327 2c20 2772 6227 2920 6173  '.gds', 'rb') as
+00089470: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00089480: 6764 7320 3d20 7069 636b 6c65 2e6c 6f61  gds = pickle.loa
+00089490: 6428 2066 2029 0a20 2020 2020 2020 2067  d( f ).        g
+000894a0: 656e 6f6d 6520 3d20 6765 6e6f 6d65 5f66  enome = genome_f
+000894b0: 610a 2020 2020 2020 2020 7072 696e 7428  a.        print(
+000894c0: 2764 6f6e 652e 2027 290a 2020 2020 0a20  'done. ').    . 
+000894d0: 2020 2069 6620 2867 656e 6f6d 655f 6661     if (genome_fa
+000894e0: 2069 7320 4e6f 6e65 293a 0a20 2020 2020   is None):.     
+000894f0: 2020 2070 7269 6e74 2827 5374 7269 6e67     print('String
+00089500: 4669 7820 6669 6e69 7368 6564 2027 2c20  Fix finished ', 
+00089510: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+00089520: 652e 6e6f 7728 2929 0a20 2020 2065 6c73  e.now()).    els
+00089530: 653a 0a20 2020 2020 2020 2066 696c 655f  e:.        file_
+00089540: 6f75 742c 2066 696c 655f 6f75 745f 6765  out, file_out_ge
+00089550: 6e6f 6d65 203d 2053 7472 696e 6746 6978  nome = StringFix
+00089560: 5f73 796e 7468 6573 6973 2820 6669 6c65  _synthesis( file
+00089570: 5f6f 7574 202b 2027 2e67 6666 272c 2067  _out + '.gff', g
+00089580: 656e 6f6d 652c 205c 0a20 2020 2020 2020  enome, \.       
+00089590: 2020 2020 2020 2020 206e 5f63 6f72 6573           n_cores
+000895a0: 3d6e 5f63 6f72 6573 2c20 7265 7620 3d20  =n_cores, rev = 
+000895b0: 7265 762c 206f 7574 5f64 6972 203d 206f  rev, out_dir = o
+000895c0: 7574 5f64 6972 2c20 6764 7320 3d20 6764  ut_dir, gds = gd
+000895d0: 7320 290a 2020 2020 2020 2020 0a20 2020  s ).        .   
+000895e0: 2072 6574 7572 6e20 6669 6c65 5f6f 7574   return file_out
+000895f0: 0a20 2020 2020 2020 200a 0a23 2323 2323  .        ..#####
+00089600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089610: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089620: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089630: 2323 2323 0a23 2320 5374 7269 6e67 4669  ####.## StringFi
+00089640: 782d 6164 646f 6e20 2020 2020 2020 2020  x-addon         
+00089650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089690: 2020 2020 2023 230a 2323 2064 6576 656c       ##.## devel
+000896a0: 6f70 6564 2062 7920 5365 6f6b 6879 756e  oped by Seokhyun
+000896b0: 2059 6f6f 6e20 2873 796f 6f6e 4064 6b75   Yoon (syoon@dku
+000896c0: 2e65 6475 2920 4f63 742e 2030 342c 2032  .edu) Oct. 04, 2
+000896d0: 3032 3020 2020 2323 0a23 2323 2323 2323  020   ##.#######
+000896e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000896f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00089710: 2323 0a0a 6465 6620 7768 6963 6828 2061  ##..def which( a
+00089720: 692c 2076 616c 7565 203d 2054 7275 6520  i, value = True 
+00089730: 2920 3a0a 2020 2020 7768 203d 205b 5d0a  ) :.    wh = [].
+00089740: 2020 2020 6120 3d20 6c69 7374 2861 6929      a = list(ai)
+00089750: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
+00089760: 6e67 6528 6c65 6e28 6129 293a 200a 2020  nge(len(a)): .  
+00089770: 2020 2020 2020 6966 2061 5b6b 5d20 3d3d        if a[k] ==
+00089780: 2076 616c 7565 3a20 0a20 2020 2020 2020   value: .       
+00089790: 2020 2020 2077 682e 6170 7065 6e64 286b       wh.append(k
+000897a0: 2920 0a20 2020 2072 6574 7572 6e28 7768  ) .    return(wh
+000897b0: 290a 0a64 6566 2067 6574 5f69 6e66 6f5f  )..def get_info_
+000897c0: 6672 6f6d 5f74 725f 6e61 6d65 2820 746e  from_tr_name( tn
+000897d0: 7320 293a 0a20 2020 200a 2020 2020 6162  s ):.    .    ab
+000897e0: 6e5f 6520 3d20 5b5d 0a20 2020 2074 706d  n_e = [].    tpm
+000897f0: 5f65 203d 205b 5d0a 2020 2020 6966 7261  _e = [].    ifra
+00089800: 6320 3d20 5b5d 0a20 2020 2073 6964 7820  c = [].    sidx 
+00089810: 3d20 5b5d 0a20 2020 2067 5f73 697a 6520  = [].    g_size 
+00089820: 3d20 5b5d 0a20 2020 206e 5f65 786f 6e73  = [].    n_exons
+00089830: 203d 205b 5d0a 2020 2020 675f 766f 6c20   = [].    g_vol 
+00089840: 3d20 5b5d 0a20 2020 2069 636e 7420 3d20  = [].    icnt = 
+00089850: 5b5d 0a20 2020 2074 5f6c 656e 203d 205b  [].    t_len = [
+00089860: 5d0a 2020 2020 7374 726e 6420 3d20 5b5d  ].    strnd = []
+00089870: 0a20 2020 2063 646e 6720 3d20 5b5d 0a20  .    cdng = []. 
+00089880: 2020 2066 6f72 206b 2c20 746e 2069 6e20     for k, tn in 
+00089890: 656e 756d 6572 6174 6528 746e 7329 3a0a  enumerate(tns):.
+000898a0: 2020 2020 2020 2020 6864 7220 3d20 746e          hdr = tn
+000898b0: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
+000898c0: 2020 2020 6974 656d 7320 3d20 6864 725b      items = hdr[
+000898d0: 305d 2e73 706c 6974 2827 5f27 290a 2020  0].split('_').  
+000898e0: 2020 2020 2020 7374 726e 642e 6170 7065        strnd.appe
+000898f0: 6e64 2820 6974 656d 735b 325d 290a 2020  nd( items[2]).  
+00089900: 2020 2020 2020 6364 6e67 2e61 7070 656e        cdng.appen
+00089910: 6428 2069 7465 6d73 5b33 5d29 0a20 2020  d( items[3]).   
+00089920: 2020 2020 2073 6964 782e 6170 7065 6e64       sidx.append
+00089930: 2820 2869 7465 6d73 5b34 5d29 2029 0a20  ( (items[4]) ). 
+00089940: 2020 2020 2020 2067 5f73 697a 652e 6170         g_size.ap
+00089950: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
+00089960: 355d 2920 290a 2020 2020 2020 2020 6963  5]) ).        ic
+00089970: 6e74 2e61 7070 656e 6428 2069 6e74 2869  nt.append( int(i
+00089980: 7465 6d73 5b36 5d29 2029 0a20 2020 2020  tems[6]) ).     
+00089990: 2020 2076 616c 203d 2069 7465 6d73 5b37     val = items[7
+000899a0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
+000899b0: 2020 2020 2061 626e 5f65 2e61 7070 656e       abn_e.appen
+000899c0: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
+000899d0: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
+000899e0: 2069 7465 6d73 5b38 5d2e 7370 6c69 7428   items[8].split(
+000899f0: 273a 2729 0a20 2020 2020 2020 2074 706d  ':').        tpm
+00089a00: 5f65 2e61 7070 656e 6428 2066 6c6f 6174  _e.append( float
+00089a10: 2876 616c 5b31 5d29 2029 0a20 2020 2020  (val[1]) ).     
+00089a20: 2020 2076 616c 203d 2069 7465 6d73 5b39     val = items[9
+00089a30: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
+00089a40: 2020 2020 2069 6672 6163 2e61 7070 656e       ifrac.appen
+00089a50: 6428 2066 6c6f 6174 2876 616c 5b31 5d29  d( float(val[1])
+00089a60: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
+00089a70: 2069 7465 6d73 5b31 315d 2e73 706c 6974   items[11].split
+00089a80: 2827 3a27 290a 2020 2020 2020 2020 6e5f  (':').        n_
+00089a90: 6578 6f6e 732e 6170 7065 6e64 2820 696e  exons.append( in
+00089aa0: 7428 7661 6c5b 315d 2920 290a 2020 2020  t(val[1]) ).    
+00089ab0: 2020 2020 7661 6c20 3d20 6974 656d 735b      val = items[
+00089ac0: 3132 5d2e 7370 6c69 7428 273a 2729 0a20  12].split(':'). 
+00089ad0: 2020 2020 2020 2067 5f76 6f6c 2e61 7070         g_vol.app
+00089ae0: 656e 6428 2069 6e74 2876 616c 5b31 5d29  end( int(val[1])
+00089af0: 2029 0a20 2020 2020 2020 2076 616c 203d   ).        val =
+00089b00: 2069 7465 6d73 5b31 335d 2e73 706c 6974   items[13].split
+00089b10: 2827 3a27 290a 2020 2020 2020 2020 745f  (':').        t_
+00089b20: 6c65 6e2e 6170 7065 6e64 2820 696e 7428  len.append( int(
+00089b30: 7661 6c5b 315d 2920 290a 2020 2020 0a20  val[1]) ).    . 
+00089b40: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
+00089b50: 7261 6d65 2829 0a20 2020 200a 2020 2020  rame().    .    
+00089b60: 6466 5b27 7472 5f6e 616d 6527 5d20 3d20  df['tr_name'] = 
+00089b70: 746e 730a 2020 2020 6466 5b27 6162 6e5f  tns.    df['abn_
+00089b80: 6573 7427 5d20 3d20 6162 6e5f 650a 2020  est'] = abn_e.  
+00089b90: 2020 6466 5b27 7470 6d5f 6573 7427 5d20    df['tpm_est'] 
+00089ba0: 3d20 7470 6d5f 650a 2020 2020 6466 5b27  = tpm_e.    df['
+00089bb0: 6769 6478 275d 203d 2073 6964 780a 2020  gidx'] = sidx.  
+00089bc0: 2020 6466 5b27 6969 6478 275d 203d 2069    df['iidx'] = i
+00089bd0: 636e 740a 2020 2020 6466 5b27 675f 7369  cnt.    df['g_si
+00089be0: 7a65 275d 203d 2067 5f73 697a 650a 2020  ze'] = g_size.  
+00089bf0: 2020 6466 5b27 6973 6f5f 6672 6163 275d    df['iso_frac']
+00089c00: 203d 2069 6672 6163 0a20 2020 2064 665b   = ifrac.    df[
+00089c10: 276e 5f65 786f 6e73 275d 203d 206e 5f65  'n_exons'] = n_e
+00089c20: 786f 6e73 0a20 2020 2064 665b 2767 5f76  xons.    df['g_v
+00089c30: 6f6c 275d 203d 2067 5f76 6f6c 0a20 2020  ol'] = g_vol.   
+00089c40: 2064 665b 276c 656e 6774 6827 5d20 3d20   df['length'] = 
+00089c50: 745f 6c65 6e0a 2020 2020 6466 5b27 7374  t_len.    df['st
+00089c60: 7261 6e64 275d 203d 2073 7472 6e64 0a20  rand'] = strnd. 
+00089c70: 2020 2064 665b 2743 5f6f 725f 4e27 5d20     df['C_or_N'] 
+00089c80: 3d20 6364 6e67 0a20 2020 200a 2020 2020  = cdng.    .    
+00089c90: 6466 203d 2064 662e 7365 745f 696e 6465  df = df.set_inde
+00089ca0: 7828 2774 725f 6e61 6d65 2729 0a20 2020  x('tr_name').   
+00089cb0: 200a 2020 2020 7265 7475 726e 2064 660a   .    return df.
+00089cc0: 0a64 6566 2067 6574 5f70 6572 666f 726d  .def get_perform
+00089cd0: 616e 6365 2874 7269 6e66 6f2c 2063 7667  ance(trinfo, cvg
+00089ce0: 5f74 6820 3d20 5b38 302c 3930 2c39 355d  _th = [80,90,95]
+00089cf0: 2c20 665f 746f 5f73 6176 6520 3d20 4e6f  , f_to_save = No
+00089d00: 6e65 2c20 7265 6620 3d20 302c 2076 6572  ne, ref = 0, ver
+00089d10: 626f 7365 203d 2046 616c 7365 293a 0a20  bose = False):. 
+00089d20: 2020 200a 2020 2020 2327 2727 0a20 2020     .    #'''.   
+00089d30: 2069 6620 7265 6620 3d3d 2030 3a0a 2020   if ref == 0:.  
+00089d40: 2020 2020 2020 715f 6376 6720 3d20 2771        q_cvg = 'q
+00089d50: 6376 6727 0a20 2020 2020 2020 2071 5f6c  cvg'.        q_l
+00089d60: 656e 203d 2027 716c 656e 270a 2020 2020  en = 'qlen'.    
+00089d70: 2020 2020 715f 6964 203d 2027 7169 6427      q_id = 'qid'
+00089d80: 0a20 2020 2020 2020 2073 5f73 7461 7274  .        s_start
+00089d90: 203d 2027 7373 7461 7274 270a 2020 2020   = 'sstart'.    
+00089da0: 2020 2020 735f 656e 6420 3d20 2773 656e      s_end = 'sen
+00089db0: 6427 0a20 2020 2020 2020 2073 5f69 6420  d'.        s_id 
+00089dc0: 3d20 2773 6964 270a 2020 2020 656c 7365  = 'sid'.    else
+00089dd0: 3a0a 2020 2020 2020 2020 715f 6376 6720  :.        q_cvg 
+00089de0: 3d20 2773 6376 6727 0a20 2020 2020 2020  = 'scvg'.       
+00089df0: 2071 5f6c 656e 203d 2027 736c 656e 270a   q_len = 'slen'.
+00089e00: 2020 2020 2020 2020 715f 6964 203d 2027          q_id = '
+00089e10: 7369 6427 0a20 2020 2020 2020 2073 5f73  sid'.        s_s
+00089e20: 7461 7274 203d 2027 7173 7461 7274 270a  tart = 'qstart'.
+00089e30: 2020 2020 2020 2020 735f 656e 6420 3d20          s_end = 
+00089e40: 2771 656e 6427 0a20 2020 2020 2020 2073  'qend'.        s
+00089e50: 5f69 6420 3d20 2771 6964 270a 2020 2020  _id = 'qid'.    
+00089e60: 2327 2727 0a20 2020 200a 2020 2020 7169  #'''.    .    qi
+00089e70: 6473 203d 2070 642e 756e 6971 7565 2874  ds = pd.unique(t
+00089e80: 7269 6e66 6f5b 715f 6964 5d29 0a20 2020  rinfo[q_id]).   
+00089e90: 2073 6964 7320 3d20 7064 2e75 6e69 7175   sids = pd.uniqu
+00089ea0: 6528 7472 696e 666f 5b73 5f69 645d 290a  e(trinfo[s_id]).
+00089eb0: 2020 2020 7767 7420 3d20 6e70 2e7a 6572      wgt = np.zer
+00089ec0: 6f73 285b 6c65 6e28 7169 6473 292c 6c65  os([len(qids),le
+00089ed0: 6e28 7369 6473 295d 290a 2020 2020 6966  n(sids)]).    if
+00089ee0: 2076 6572 626f 7365 3a20 7072 696e 7428   verbose: print(
+00089ef0: 274d 6174 6368 696e 6720 2825 692c 2569  'Matching (%i,%i
+00089f00: 2920 2720 2520 2877 6774 2e73 6861 7065  ) ' % (wgt.shape
+00089f10: 292c 2065 6e64 3d27 2729 0a0a 2020 2020  ), end='')..    
+00089f20: 7169 6478 203d 206e 702e 6675 6c6c 2874  qidx = np.full(t
+00089f30: 7269 6e66 6f2e 7368 6170 655b 305d 2c2d  rinfo.shape[0],-
+00089f40: 312c 6474 7970 653d 696e 7429 0a20 2020  1,dtype=int).   
+00089f50: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
+00089f60: 6c65 6e28 7169 6473 2929 203a 0a20 2020  len(qids)) :.   
+00089f70: 2020 2020 2071 6964 203d 2071 6964 735b       qid = qids[
+00089f80: 6b5d 0a20 2020 2020 2020 2077 6820 3d20  k].        wh = 
+00089f90: 7768 6963 6828 2074 7269 6e66 6f5b 715f  which( trinfo[q_
+00089fa0: 6964 5d20 3d3d 2071 6964 2029 0a20 2020  id] == qid ).   
+00089fb0: 2020 2020 2071 6964 785b 7768 5d20 3d20       qidx[wh] = 
+00089fc0: 6b0a 2020 2020 2020 2020 0a20 2020 2069  k.        .    i
+00089fd0: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
+00089fe0: 2827 2e27 2c20 656e 643d 2727 290a 2020  ('.', end='').  
+00089ff0: 2020 7369 6478 203d 206e 702e 6675 6c6c    sidx = np.full
+0008a000: 2874 7269 6e66 6f2e 7368 6170 655b 305d  (trinfo.shape[0]
+0008a010: 2c2d 312c 6474 7970 653d 696e 7429 0a20  ,-1,dtype=int). 
+0008a020: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
+0008a030: 6528 6c65 6e28 7369 6473 2929 203a 0a20  e(len(sids)) :. 
+0008a040: 2020 2020 2020 2073 6964 203d 2073 6964         sid = sid
+0008a050: 735b 6b5d 0a20 2020 2020 2020 2077 6820  s[k].        wh 
+0008a060: 3d20 7768 6963 6828 2074 7269 6e66 6f5b  = which( trinfo[
+0008a070: 735f 6964 5d20 3d3d 2073 6964 2029 0a20  s_id] == sid ). 
+0008a080: 2020 2020 2020 2073 6964 785b 7768 5d20         sidx[wh] 
+0008a090: 3d20 6b0a 2020 2020 2020 2020 0a20 2020  = k.        .   
+0008a0a0: 2069 6620 7665 7262 6f73 653a 2070 7269   if verbose: pri
+0008a0b0: 6e74 2827 2e27 2c20 656e 643d 2727 290a  nt('.', end='').
+0008a0c0: 2020 2020 666f 7220 7720 696e 2072 616e      for w in ran
+0008a0d0: 6765 286c 656e 2871 6964 7829 293a 0a20  ge(len(qidx)):. 
+0008a0e0: 2020 2020 2020 2077 6774 5b69 6e74 2871         wgt[int(q
+0008a0f0: 6964 785b 775d 292c 2069 6e74 2873 6964  idx[w]), int(sid
+0008a100: 785b 775d 295d 203d 202d 7472 696e 666f  x[w])] = -trinfo
+0008a110: 5b71 5f63 7667 5d5b 775d 0a0a 2020 2020  [q_cvg][w]..    
+0008a120: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
+0008a130: 7428 275f 272c 2065 6e64 3d27 2729 0a20  t('_', end=''). 
+0008a140: 2020 2023 2070 7269 6e74 2877 6774 2e73     # print(wgt.s
+0008a150: 6861 7065 290a 2020 2020 726f 775f 6964  hape).    row_id
+0008a160: 782c 2063 6f6c 5f69 6478 203d 206f 7074  x, col_idx = opt
+0008a170: 696d 697a 652e 6c69 6e65 6172 5f73 756d  imize.linear_sum
+0008a180: 5f61 7373 6967 6e6d 656e 7428 7767 7429  _assignment(wgt)
+0008a190: 0a20 2020 200a 2020 2020 6966 2076 6572  .    .    if ver
+0008a1a0: 626f 7365 3a20 7072 696e 7428 272e 272c  bose: print('.',
+0008a1b0: 2065 6e64 3d27 2729 0a20 2020 2064 665f   end='').    df_
+0008a1c0: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
+0008a1d0: 206b 2069 6e20 7261 6e67 6528 6c65 6e28   k in range(len(
+0008a1e0: 636f 6c5f 6964 7829 2920 3a0a 2020 2020  col_idx)) :.    
+0008a1f0: 2020 2020 7369 203d 2063 6f6c 5f69 6478      si = col_idx
+0008a200: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
+0008a210: 2077 6869 6368 2873 6964 7820 3d3d 2073   which(sidx == s
+0008a220: 6929 0a20 2020 2020 2020 2077 203d 2077  i).        w = w
+0008a230: 6869 6368 2820 7169 6478 5b77 685d 203d  hich( qidx[wh] =
+0008a240: 3d20 726f 775f 6964 785b 6b5d 2029 0a20  = row_idx[k] ). 
+0008a250: 2020 2020 2020 2069 6620 6c65 6e28 7729         if len(w)
+0008a260: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0008a270: 2020 6966 206c 656e 2877 2920 3e20 313a    if len(w) > 1:
+0008a280: 2070 7269 6e74 2827 4552 524f 5220 696e   print('ERROR in
+0008a290: 2067 6574 5f70 6572 666f 726d 616e 6365   get_performance
+0008a2a0: 2829 3a20 4c65 6e28 7729 203d 2025 6927  (): Len(w) = %i'
+0008a2b0: 2025 206c 656e 2877 2920 290a 2020 2020   % len(w) ).    
+0008a2c0: 2020 2020 2020 2020 6964 7820 3d20 7768          idx = wh
+0008a2d0: 5b77 5b30 5d5d 0a20 2020 2020 2020 2020  [w[0]].         
+0008a2e0: 2020 2064 665f 6c73 742e 6170 7065 6e64     df_lst.append
+0008a2f0: 2874 7269 6e66 6f2e 696c 6f63 5b69 6478  (trinfo.iloc[idx
+0008a300: 5d29 0a20 2020 2020 2020 200a 2020 2020  ]).        .    
+0008a310: 6466 5f73 656c 203d 2070 642e 4461 7461  df_sel = pd.Data
+0008a320: 4672 616d 6528 6466 5f6c 7374 290a 2020  Frame(df_lst).  
+0008a330: 2020 6966 2066 5f74 6f5f 7361 7665 2069    if f_to_save i
+0008a340: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0008a350: 2020 2020 666e 616d 6520 3d20 2725 735f      fname = '%s_
+0008a360: 626c 6173 745f 7265 7375 6c74 2e74 7376  blast_result.tsv
+0008a370: 2720 2520 665f 746f 5f73 6176 650a 2020  ' % f_to_save.  
+0008a380: 2020 2020 2020 6466 5f73 656c 2e74 6f5f        df_sel.to_
+0008a390: 6373 7628 666e 616d 652c 2068 6561 6465  csv(fname, heade
+0008a3a0: 723d 5472 7565 2c20 696e 6465 783d 4661  r=True, index=Fa
+0008a3b0: 6c73 652c 2073 6570 3d27 5c74 2729 0a20  lse, sep='\t'). 
+0008a3c0: 2020 2020 2020 2023 2069 6620 7665 7262         # if verb
+0008a3d0: 6f73 653a 2070 7269 6e74 2827 2025 732e  ose: print(' %s.
+0008a3e0: 2720 2520 666e 616d 652c 2065 6e64 3d27  ' % fname, end='
+0008a3f0: 2720 290a 2020 2020 0a20 2020 2069 6620  ' ).    .    if 
+0008a400: 7665 7262 6f73 653a 2070 7269 6e74 2827  verbose: print('
+0008a410: 2e27 2c20 656e 643d 2727 290a 2020 2020  .', end='').    
+0008a420: 636e 7420 3d20 6e70 2e7a 6572 6f73 286c  cnt = np.zeros(l
+0008a430: 656e 2863 7667 5f74 6829 290a 2020 2020  en(cvg_th)).    
+0008a440: 666f 7220 6b20 696e 2072 616e 6765 286c  for k in range(l
+0008a450: 656e 2863 7667 5f74 6829 293a 0a20 2020  en(cvg_th)):.   
+0008a460: 2020 2020 2074 6820 3d20 6376 675f 7468       th = cvg_th
+0008a470: 5b6b 5d0a 2020 2020 2020 2020 7768 203d  [k].        wh =
+0008a480: 2077 6869 6368 2820 6466 5f73 656c 5b71   which( df_sel[q
+0008a490: 5f63 7667 5d2a 3130 3020 3e3d 2074 6820  _cvg]*100 >= th 
+0008a4a0: 290a 2020 2020 2020 2020 636e 745b 6b5d  ).        cnt[k]
+0008a4b0: 203d 206e 702e 696e 7428 6c65 6e28 7768   = np.int(len(wh
+0008a4c0: 2929 0a20 2020 2020 2020 200a 2020 2020  )).        .    
+0008a4d0: 6966 2076 6572 626f 7365 3a20 7072 696e  if verbose: prin
+0008a4e0: 7428 2720 646f 6e65 2e27 290a 0a20 2020  t(' done.')..   
+0008a4f0: 2064 203d 207b 2763 7667 5f74 6827 3a20   d = {'cvg_th': 
+0008a500: 6376 675f 7468 2c20 274e 5f72 6563 6f76  cvg_th, 'N_recov
+0008a510: 6572 6564 273a 2063 6e74 2e61 7374 7970  ered': cnt.astyp
+0008a520: 6528 696e 7429 2c20 2770 7265 6369 7369  e(int), 'precisi
+0008a530: 6f6e 273a 206e 702e 726f 756e 6428 3130  on': np.round(10
+0008a540: 302a 636e 742f 6c65 6e28 7369 6473 292c  0*cnt/len(sids),
+0008a550: 3129 7d0a 2020 2020 6466 5f70 6572 6620  1)}.    df_perf 
+0008a560: 3d20 7064 2e44 6174 6146 7261 6d65 2864  = pd.DataFrame(d
+0008a570: 6174 6120 3d20 6429 2023 2c20 636f 6c75  ata = d) #, colu
+0008a580: 6d6e 7320 3d20 5b27 6376 675f 7468 272c  mns = ['cvg_th',
+0008a590: 276e 5f72 6563 6f76 6572 6564 272c 2770  'n_recovered','p
+0008a5a0: 7265 6369 7369 6f6e 275d 290a 2020 2020  recision']).    
+0008a5b0: 0a20 2020 2072 6574 7572 6e28 6466 5f70  .    return(df_p
+0008a5c0: 6572 662c 2064 665f 7365 6c29 0a0a 2020  erf, df_sel)..  
+0008a5d0: 2020 0a64 6566 2072 756e 5f62 6c61 7374    .def run_blast
+0008a5e0: 2820 696e 7074 5f66 612c 2072 6566 5f66  ( inpt_fa, ref_f
+0008a5f0: 612c 2070 6174 685f 746f 5f62 6c61 7374  a, path_to_blast
+0008a600: 203d 204e 6f6e 652c 2074 7261 7265 636f   = None, trareco
+0008a610: 203d 2046 616c 7365 2c20 7265 665f 696e   = False, ref_in
+0008a620: 666f 203d 2046 616c 7365 2c20 5c0a 2020  fo = False, \.  
+0008a630: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0008a640: 6274 7970 6520 3d20 276e 7563 6c27 2c20  btype = 'nucl', 
+0008a650: 7265 6620 3d20 302c 2073 6469 7620 3d20  ref = 0, sdiv = 
+0008a660: 3130 2c20 6d78 5f6e 6361 6e64 203d 2036  10, mx_ncand = 6
+0008a670: 2c20 7665 7262 6f73 6520 3d20 4661 6c73  , verbose = Fals
+0008a680: 6529 3a0a 0a20 2020 2023 2727 270a 2020  e):..    #'''.  
+0008a690: 2020 6966 2072 6566 203d 3d20 303a 0a20    if ref == 0:. 
+0008a6a0: 2020 2020 2020 2072 6566 5f74 7220 3d20         ref_tr = 
+0008a6b0: 7265 665f 6661 0a20 2020 2020 2020 2069  ref_fa.        i
+0008a6c0: 6e70 745f 7472 203d 2069 6e70 745f 6661  npt_tr = inpt_fa
+0008a6d0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0008a6e0: 2020 715f 6376 6720 3d20 2771 6376 6727    q_cvg = 'qcvg'
+0008a6f0: 0a20 2020 2020 2020 2071 5f6c 656e 203d  .        q_len =
+0008a700: 2027 716c 656e 270a 2020 2020 2020 2020   'qlen'.        
+0008a710: 715f 6964 203d 2027 7169 6427 0a20 2020  q_id = 'qid'.   
+0008a720: 2020 2020 2073 5f73 7461 7274 203d 2027       s_start = '
+0008a730: 7373 7461 7274 270a 2020 2020 2020 2020  sstart'.        
+0008a740: 735f 656e 6420 3d20 2773 656e 6427 0a20  s_end = 'send'. 
+0008a750: 2020 2020 2020 2073 5f69 6420 3d20 2773         s_id = 's
+0008a760: 6964 270a 2020 2020 656c 7365 3a0a 2020  id'.    else:.  
+0008a770: 2020 2020 2020 7265 665f 7472 203d 2069        ref_tr = i
+0008a780: 6e70 745f 6661 0a20 2020 2020 2020 2069  npt_fa.        i
+0008a790: 6e70 745f 7472 203d 2072 6566 5f66 610a  npt_tr = ref_fa.
+0008a7a0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0008a7b0: 2071 5f63 7667 203d 2027 7363 7667 270a   q_cvg = 'scvg'.
+0008a7c0: 2020 2020 2020 2020 715f 6c65 6e20 3d20          q_len = 
+0008a7d0: 2773 6c65 6e27 0a20 2020 2020 2020 2071  'slen'.        q
+0008a7e0: 5f69 6420 3d20 2773 6964 270a 2020 2020  _id = 'sid'.    
+0008a7f0: 2020 2020 735f 7374 6172 7420 3d20 2771      s_start = 'q
+0008a800: 7374 6172 7427 0a20 2020 2020 2020 2073  start'.        s
+0008a810: 5f65 6e64 203d 2027 7165 6e64 270a 2020  _end = 'qend'.  
+0008a820: 2020 2020 2020 735f 6964 203d 2027 7169        s_id = 'qi
+0008a830: 6427 0a20 2020 2023 2727 270a 2020 2020  d'.    #'''.    
+0008a840: 0a20 2020 2066 696c 655f 6e61 6d65 7320  .    file_names 
+0008a850: 3d20 696e 7074 5f74 722e 7370 6c69 7428  = inpt_tr.split(
+0008a860: 272e 2729 0a20 2020 2066 6e61 6d65 203d  '.').    fname =
+0008a870: 2027 272e 6a6f 696e 2873 7420 666f 7220   ''.join(st for 
+0008a880: 7374 2069 6e20 6669 6c65 5f6e 616d 6573  st in file_names
+0008a890: 5b3a 2d31 5d20 290a 0a20 2020 2074 6e5f  [:-1] )..    tn_
+0008a8a0: 696e 203d 205b 5d0a 2020 2020 6620 3d20  in = [].    f = 
+0008a8b0: 6f70 656e 2869 6e70 745f 7472 2c27 7227  open(inpt_tr,'r'
+0008a8c0: 290a 2020 2020 6361 6e64 5f63 6e74 203d  ).    cand_cnt =
+0008a8d0: 2030 0a20 2020 2066 6f72 206c 696e 6520   0.    for line 
+0008a8e0: 696e 2066 3a0a 2020 2020 2020 2020 6966  in f:.        if
+0008a8f0: 206c 696e 655b 305d 203d 3d20 273e 273a   line[0] == '>':
+0008a900: 0a20 2020 2020 2020 2020 2020 2074 6e5f  .            tn_
+0008a910: 696e 2e61 7070 656e 6428 6c69 6e65 5b31  in.append(line[1
+0008a920: 3a2d 315d 290a 2020 2020 2020 2020 2020  :-1]).          
+0008a930: 2020 6361 6e64 5f63 6e74 202b 3d20 310a    cand_cnt += 1.
+0008a940: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
+0008a950: 2020 0a20 2020 2074 6e5f 7265 6620 3d20    .    tn_ref = 
+0008a960: 5b5d 0a20 2020 2066 203d 206f 7065 6e28  [].    f = open(
+0008a970: 7265 665f 7472 2c27 7227 290a 2020 2020  ref_tr,'r').    
+0008a980: 7265 665f 636e 7420 3d20 300a 2020 2020  ref_cnt = 0.    
+0008a990: 666f 7220 6c69 6e65 2069 6e20 663a 0a20  for line in f:. 
+0008a9a0: 2020 2020 2020 2069 6620 6c69 6e65 5b30         if line[0
+0008a9b0: 5d20 3d3d 2027 3e27 3a0a 2020 2020 2020  ] == '>':.      
+0008a9c0: 2020 2020 2020 746e 5f72 6566 2e61 7070        tn_ref.app
+0008a9d0: 656e 6428 6c69 6e65 5b31 3a2d 315d 290a  end(line[1:-1]).
+0008a9e0: 2020 2020 2020 2020 2020 2020 7265 665f              ref_
+0008a9f0: 636e 7420 2b3d 2031 0a20 2020 2066 2e63  cnt += 1.    f.c
+0008aa00: 6c6f 7365 2829 0a20 2020 2023 2070 7269  lose().    # pri
+0008aa10: 6e74 2827 4c65 6e3a 2025 692c 204e 753d  nt('Len: %i, Nu=
+0008aa20: 2025 6927 2025 2028 6c65 6e28 746e 292c   %i' % (len(tn),
+0008aa30: 206c 656e 2870 642e 756e 6971 7565 2874   len(pd.unique(t
+0008aa40: 6e29 2929 2c20 656e 643d 2727 2029 0a20  n))), end='' ). 
+0008aa50: 2020 200a 2020 2020 6966 2072 6566 203d     .    if ref =
+0008aa60: 3d20 303a 0a20 2020 2020 2020 2074 6e20  = 0:.        tn 
+0008aa70: 3d20 746e 5f69 6e0a 2020 2020 2020 2020  = tn_in.        
+0008aa80: 6e5f 6d61 785f 6361 6e64 7320 3d20 310a  n_max_cands = 1.
+0008aa90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008aaa0: 2020 746e 203d 2074 6e5f 7265 660a 2020    tn = tn_ref.  
+0008aab0: 2020 2020 2020 6e5f 6d61 785f 6361 6e64        n_max_cand
+0008aac0: 7320 3d20 206d 785f 6e63 616e 640a 2020  s =  mx_ncand.  
+0008aad0: 2020 2020 2020 746d 7020 3d20 6361 6e64        tmp = cand
+0008aae0: 5f63 6e74 0a20 2020 2020 2020 2063 616e  _cnt.        can
+0008aaf0: 645f 636e 7420 3d20 7265 665f 636e 740a  d_cnt = ref_cnt.
+0008ab00: 2020 2020 2020 2020 7265 665f 636e 7420          ref_cnt 
+0008ab10: 3d20 746d 700a 2020 2020 0a20 2020 2023  = tmp.    .    #
+0008ab20: 2320 6d61 6b65 2062 6c61 7374 2064 6220  # make blast db 
+0008ab30: 7769 7468 2069 6e70 7574 5f74 720a 2020  with input_tr.  
+0008ab40: 2020 6966 2070 6174 685f 746f 5f62 6c61    if path_to_bla
+0008ab50: 7374 2069 7320 4e6f 6e65 3a0a 2020 2020  st is None:.    
+0008ab60: 2020 2020 636d 6420 3d20 276d 616b 6562      cmd = 'makeb
+0008ab70: 6c61 7374 6462 202d 696e 2025 7320 2d64  lastdb -in %s -d
+0008ab80: 6274 7970 6520 2573 2720 2520 2869 6e70  btype %s' % (inp
+0008ab90: 745f 7472 2c20 6462 7479 7065 290a 2020  t_tr, dbtype).  
+0008aba0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008abb0: 636d 6420 3d20 2725 732f 6d61 6b65 626c  cmd = '%s/makebl
+0008abc0: 6173 7464 6220 2d69 6e20 2573 202d 6462  astdb -in %s -db
+0008abd0: 7479 7065 2025 7327 2025 2028 7061 7468  type %s' % (path
+0008abe0: 5f74 6f5f 626c 6173 742c 2069 6e70 745f  _to_blast, inpt_
+0008abf0: 7472 2c20 6462 7479 7065 290a 2020 2020  tr, dbtype).    
+0008ac00: 7265 7320 3d20 7375 6270 726f 6365 7373  res = subprocess
+0008ac10: 2e63 6865 636b 5f6f 7574 7075 7428 636d  .check_output(cm
+0008ac20: 642c 2073 6865 6c6c 3d54 7275 6529 0a20  d, shell=True). 
+0008ac30: 2020 2023 2070 7269 6e74 2872 6573 2e64     # print(res.d
+0008ac40: 6563 6f64 6528 2777 696e 646f 7773 2d31  ecode('windows-1
+0008ac50: 3235 3227 2929 0a20 0a20 2020 2073 7472  252')). .    str
+0008ac60: 5f6f 7074 696f 6e20 3d20 272d 6f75 7466  _option = '-outf
+0008ac70: 6d74 2022 3620 7173 6571 6964 2073 7365  mt "6 qseqid sse
+0008ac80: 7169 6420 716c 656e 206c 656e 6774 6820  qid qlen length 
+0008ac90: 736c 656e 2071 7374 6172 7420 7165 6e64  slen qstart qend
+0008aca0: 2073 7374 6172 7420 7365 6e64 206e 6964   sstart send nid
+0008acb0: 656e 7420 6d69 736d 6174 6368 2067 6170  ent mismatch gap
+0008acc0: 6f70 656e 2071 636f 7673 2071 636f 7668  open qcovs qcovh
+0008acd0: 7370 2062 6974 7363 6f72 6522 202d 6e75  sp bitscore" -nu
+0008ace0: 6d5f 7468 7265 6164 7320 3420 2d6d 6178  m_threads 4 -max
+0008acf0: 5f74 6172 6765 745f 7365 7173 2025 6927  _target_seqs %i'
+0008ad00: 2025 206e 5f6d 6178 5f63 616e 6473 0a0a   % n_max_cands..
+0008ad10: 2020 2020 6966 2064 6274 7970 6520 3d3d      if dbtype ==
+0008ad20: 2027 6e75 636c 273a 2070 7266 7820 3d20   'nucl': prfx = 
+0008ad30: 276e 270a 2020 2020 656c 7365 3a20 7072  'n'.    else: pr
+0008ad40: 6678 203d 2027 7027 0a20 2020 2020 2020  fx = 'p'.       
+0008ad50: 200a 2020 2020 6966 2070 6174 685f 746f   .    if path_to
+0008ad60: 5f62 6c61 7374 2069 7320 4e6f 6e65 3a0a  _blast is None:.
+0008ad70: 2020 2020 2020 2020 636d 6420 3d20 2762          cmd = 'b
+0008ad80: 6c61 7374 2573 2025 7320 2d64 6220 2573  last%s %s -db %s
+0008ad90: 202d 7175 6572 7920 2573 202d 6f75 7420   -query %s -out 
+0008ada0: 2573 2e74 626c 7374 2720 2520 2870 7266  %s.tblst' % (prf
+0008adb0: 782c 2073 7472 5f6f 7074 696f 6e2c 2069  x, str_option, i
+0008adc0: 6e70 745f 7472 2c20 7265 665f 7472 2c20  npt_tr, ref_tr, 
+0008add0: 666e 616d 6529 0a20 2020 2065 6c73 653a  fname).    else:
+0008ade0: 0a20 2020 2020 2020 2063 6d64 203d 2027  .        cmd = '
+0008adf0: 2573 2f62 6c61 7374 2573 2025 7320 2d64  %s/blast%s %s -d
+0008ae00: 6220 2573 202d 7175 6572 7920 2573 202d  b %s -query %s -
+0008ae10: 6f75 7420 2573 2e74 626c 7374 2720 2520  out %s.tblst' % 
+0008ae20: 2870 6174 685f 746f 5f62 6c61 7374 2c20  (path_to_blast, 
+0008ae30: 7072 6678 2c20 7374 725f 6f70 7469 6f6e  prfx, str_option
+0008ae40: 2c20 696e 7074 5f74 722c 2072 6566 5f74  , inpt_tr, ref_t
+0008ae50: 722c 2066 6e61 6d65 290a 2020 2020 2020  r, fname).      
+0008ae60: 2020 0a20 2020 2069 6620 7665 7262 6f73    .    if verbos
+0008ae70: 653a 2070 7269 6e74 2822 5275 6e6e 696e  e: print("Runnin
+0008ae80: 6720 426c 6173 742d 2573 2077 6974 6820  g Blast-%s with 
+0008ae90: 2569 2063 616e 642e 2025 6920 7265 662e  %i cand. %i ref.
+0008aea0: 202e 2e2e 2022 2025 2028 6462 7479 7065   ... " % (dbtype
+0008aeb0: 5b30 5d2e 7570 7065 7228 292c 6361 6e64  [0].upper(),cand
+0008aec0: 5f63 6e74 2c20 7265 665f 636e 7429 2c20  _cnt, ref_cnt), 
+0008aed0: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
+0008aee0: 7565 293b 0a20 2020 2072 6573 203d 2073  ue);.    res = s
+0008aef0: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
+0008af00: 6f75 7470 7574 2863 6d64 2c20 7368 656c  output(cmd, shel
+0008af10: 6c3d 5472 7565 290a 2020 2020 2320 7072  l=True).    # pr
+0008af20: 696e 7428 7265 732e 6465 636f 6465 2827  int(res.decode('
+0008af30: 7769 6e64 6f77 732d 3132 3532 2729 290a  windows-1252')).
+0008af40: 2020 2020 6966 2076 6572 626f 7365 3a20      if verbose: 
+0008af50: 7072 696e 7428 2764 6f6e 652e 2729 0a20  print('done.'). 
+0008af60: 2020 200a 2020 2020 6f73 2e72 656d 6f76     .    os.remov
+0008af70: 6528 2027 2573 2e25 7368 7227 2025 2028  e( '%s.%shr' % (
+0008af80: 696e 7074 5f74 722c 2070 7266 7829 2029  inpt_tr, prfx) )
+0008af90: 0a20 2020 206f 732e 7265 6d6f 7665 2820  .    os.remove( 
+0008afa0: 2725 732e 2573 696e 2720 2520 2869 6e70  '%s.%sin' % (inp
+0008afb0: 745f 7472 2c20 7072 6678 2920 290a 2020  t_tr, prfx) ).  
+0008afc0: 2020 6f73 2e72 656d 6f76 6528 2027 2573    os.remove( '%s
+0008afd0: 2e25 7373 7127 2025 2028 696e 7074 5f74  .%ssq' % (inpt_t
+0008afe0: 722c 2070 7266 7829 2029 0a20 2020 0a20  r, prfx) ).   . 
+0008aff0: 2020 2063 6f6c 6e61 6d65 7320 3d20 5b27     colnames = ['
+0008b000: 7169 6427 2c20 2773 6964 272c 2027 716c  qid', 'sid', 'ql
+0008b010: 656e 272c 2027 616c 656e 272c 2027 736c  en', 'alen', 'sl
+0008b020: 656e 272c 2027 7173 7461 7274 272c 2027  en', 'qstart', '
+0008b030: 7165 6e64 272c 2027 7373 7461 7274 272c  qend', 'sstart',
+0008b040: 2027 7365 6e64 272c 205c 0a20 2020 2020   'send', \.     
+0008b050: 2020 2020 2020 2020 2020 2027 6e69 6465             'nide
+0008b060: 6e74 272c 2027 6d69 736d 6174 6368 272c  nt', 'mismatch',
+0008b070: 2027 6761 706f 7065 6e27 2c20 2771 636f   'gapopen', 'qco
+0008b080: 7673 272c 2027 7163 6f76 6873 7027 2c20  vs', 'qcovhsp', 
+0008b090: 2762 6974 7363 6f72 6527 5d0a 2020 2020  'bitscore'].    
+0008b0a0: 7462 6c73 7420 3d20 2725 732e 7462 6c73  tblst = '%s.tbls
+0008b0b0: 7427 2025 2066 6e61 6d65 0a20 2020 2064  t' % fname.    d
+0008b0c0: 6620 3d20 7064 2e72 6561 645f 6373 7628  f = pd.read_csv(
+0008b0d0: 7462 6c73 742c 2068 6561 6465 7220 3d20  tblst, header = 
+0008b0e0: 2769 6e66 6572 272c 206e 616d 6573 203d  'infer', names =
+0008b0f0: 2063 6f6c 6e61 6d65 732c 2073 6570 3d27   colnames, sep='
+0008b100: 5c74 2729 0a20 2020 200a 2020 2020 6f73  \t').    .    os
+0008b110: 2e72 656d 6f76 6528 2027 2573 2720 2520  .remove( '%s' % 
+0008b120: 2874 626c 7374 2920 290a 2020 2020 0a20  (tblst) ).    . 
+0008b130: 2020 2069 6620 7665 7262 6f73 653a 2070     if verbose: p
+0008b140: 7269 6e74 2827 4e2e 6361 6e64 3a20 2569  rint('N.cand: %i
+0008b150: 2c20 4e2e 7375 626a 6563 742e 756e 6971  , N.subject.uniq
+0008b160: 7565 3a20 2569 2720 2520 286c 656e 2874  ue: %i' % (len(t
+0008b170: 6e29 2c20 6c65 6e28 7064 2e75 6e69 7175  n), len(pd.uniqu
+0008b180: 6528 6466 5b27 7369 6427 5d29 2929 2029  e(df['sid']))) )
+0008b190: 0a0a 2020 2020 6466 5b27 7363 7667 275d  ..    df['scvg']
+0008b1a0: 203d 2064 665b 2761 6c65 6e27 5d2f 6466   = df['alen']/df
+0008b1b0: 5b27 736c 656e 275d 0a20 2020 2064 665b  ['slen'].    df[
+0008b1c0: 2771 6376 6727 5d20 3d20 6466 5b27 616c  'qcvg'] = df['al
+0008b1d0: 656e 275d 2f64 665b 2771 6c65 6e27 5d0a  en']/df['qlen'].
+0008b1e0: 2020 2020 2020 2020 0a20 2020 2069 6620          .    if 
+0008b1f0: 7472 6172 6563 6f20 3d3d 2054 7275 653a  trareco == True:
+0008b200: 0a20 2020 2020 2020 2061 626e 5f65 203d  .        abn_e =
+0008b210: 205b 5d0a 2020 2020 2020 2020 7470 6d5f   [].        tpm_
+0008b220: 6520 3d20 5b5d 0a20 2020 2020 2020 2069  e = [].        i
+0008b230: 6672 6163 203d 205b 5d0a 2020 2020 2020  frac = [].      
+0008b240: 2020 7369 6478 203d 205b 5d0a 2020 2020    sidx = [].    
+0008b250: 2020 2020 675f 7369 7a65 203d 205b 5d0a      g_size = [].
+0008b260: 2020 2020 2020 2020 6e5f 6578 6f6e 7320          n_exons 
+0008b270: 3d20 5b5d 0a20 2020 2020 2020 2067 5f76  = [].        g_v
+0008b280: 6f6c 203d 205b 5d0a 2020 2020 2020 2020  ol = [].        
+0008b290: 6963 6e74 203d 205b 5d0a 2020 2020 2020  icnt = [].      
+0008b2a0: 2020 7374 726e 6420 3d20 5b5d 0a20 2020    strnd = [].   
+0008b2b0: 2020 2020 2063 646e 6720 3d20 5b5d 0a20       cdng = []. 
+0008b2c0: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+0008b2d0: 7261 6e67 6528 6466 2e73 6861 7065 5b30  range(df.shape[0
+0008b2e0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0008b2f0: 2320 7320 3d20 273e 2573 5f43 6872 2573  # s = '>%s_Chr%s
+0008b300: 3a25 692d 2569 5f25 695f 2569 5f25 695f  :%i-%i_%i_%i_%i_
+0008b310: 4162 6e3a 2534 2e33 665f 5450 4d3a 2534  Abn:%4.3f_TPM:%4
+0008b320: 2e32 665f 4946 7261 633a 2533 2e32 665c  .2f_IFrac:%3.2f\
+0008b330: 6e27 200a 2020 2020 2020 2020 2020 2020  n' .            
+0008b340: 2320 2520 2874 722e 7072 6566 6978 2c20  # % (tr.prefix, 
+0008b350: 7472 2e63 6872 2c20 7472 2e73 7461 7274  tr.chr, tr.start
+0008b360: 2c20 7472 2e65 6e64 2c20 7472 2e67 6964  , tr.end, tr.gid
+0008b370: 782c 2074 722e 6772 705f 7369 7a65 2c20  x, tr.grp_size, 
+0008b380: 7472 2e69 636e 742c 2074 722e 6162 6e2c  tr.icnt, tr.abn,
+0008b390: 2074 722e 7470 6d2c 2074 722e 6973 6f5f   tr.tpm, tr.iso_
+0008b3a0: 6672 6163 290a 2020 2020 2020 2020 2020  frac).          
+0008b3b0: 2020 6864 7220 3d20 6466 5b73 5f69 645d    hdr = df[s_id]
+0008b3c0: 5b6b 5d2e 7370 6c69 7428 2720 2729 0a20  [k].split(' '). 
+0008b3d0: 2020 2020 2020 2020 2020 2069 7465 6d73             items
+0008b3e0: 203d 2068 6472 5b30 5d2e 7370 6c69 7428   = hdr[0].split(
+0008b3f0: 275f 2729 0a20 2020 2020 2020 2020 2020  '_').           
+0008b400: 2073 7472 6e64 2e61 7070 656e 6428 2069   strnd.append( i
+0008b410: 7465 6d73 5b32 5d29 0a20 2020 2020 2020  tems[2]).       
+0008b420: 2020 2020 2063 646e 672e 6170 7065 6e64       cdng.append
+0008b430: 2820 6974 656d 735b 335d 290a 2020 2020  ( items[3]).    
+0008b440: 2020 2020 2020 2020 7369 6478 2e61 7070          sidx.app
+0008b450: 656e 6428 2028 6974 656d 735b 345d 2920  end( (items[4]) 
+0008b460: 290a 2020 2020 2020 2020 2020 2020 675f  ).            g_
+0008b470: 7369 7a65 2e61 7070 656e 6428 2069 6e74  size.append( int
+0008b480: 2869 7465 6d73 5b35 5d29 2029 0a20 2020  (items[5]) ).   
+0008b490: 2020 2020 2020 2020 2069 636e 742e 6170           icnt.ap
+0008b4a0: 7065 6e64 2820 696e 7428 6974 656d 735b  pend( int(items[
+0008b4b0: 365d 2920 290a 2020 2020 2020 2020 2020  6]) ).          
+0008b4c0: 2020 7661 6c20 3d20 6974 656d 735b 375d    val = items[7]
+0008b4d0: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0008b4e0: 2020 2020 2020 2020 6162 6e5f 652e 6170          abn_e.ap
+0008b4f0: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
+0008b500: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
+0008b510: 2020 7661 6c20 3d20 6974 656d 735b 385d    val = items[8]
+0008b520: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0008b530: 2020 2020 2020 2020 7470 6d5f 652e 6170          tpm_e.ap
+0008b540: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
+0008b550: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
+0008b560: 2020 7661 6c20 3d20 6974 656d 735b 395d    val = items[9]
+0008b570: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0008b580: 2020 2020 2020 2020 6966 7261 632e 6170          ifrac.ap
+0008b590: 7065 6e64 2820 666c 6f61 7428 7661 6c5b  pend( float(val[
+0008b5a0: 315d 2920 290a 2020 2020 2020 2020 2020  1]) ).          
+0008b5b0: 2020 7661 6c20 3d20 6974 656d 735b 3131    val = items[11
+0008b5c0: 5d2e 7370 6c69 7428 273a 2729 0a20 2020  ].split(':').   
+0008b5d0: 2020 2020 2020 2020 206e 5f65 786f 6e73           n_exons
+0008b5e0: 2e61 7070 656e 6428 2069 6e74 2876 616c  .append( int(val
+0008b5f0: 5b31 5d29 2029 0a20 2020 2020 2020 2020  [1]) ).         
+0008b600: 2020 2076 616c 203d 2069 7465 6d73 5b31     val = items[1
+0008b610: 325d 2e73 706c 6974 2827 3a27 290a 2020  2].split(':').  
+0008b620: 2020 2020 2020 2020 2020 675f 766f 6c2e            g_vol.
+0008b630: 6170 7065 6e64 2820 696e 7428 7661 6c5b  append( int(val[
+0008b640: 315d 2920 290a 2020 2020 656c 7365 3a0a  1]) ).    else:.
+0008b650: 2020 2020 2020 2020 6162 6e5f 6520 3d20          abn_e = 
+0008b660: 6e70 2e7a 6572 6f73 2864 662e 7368 6170  np.zeros(df.shap
+0008b670: 655b 305d 290a 2020 2020 2020 2020 7470  e[0]).        tp
+0008b680: 6d5f 6520 3d20 6e70 2e7a 6572 6f73 2864  m_e = np.zeros(d
+0008b690: 662e 7368 6170 655b 305d 290a 2020 2020  f.shape[0]).    
+0008b6a0: 2020 2020 6966 7261 6320 3d20 6e70 2e7a      ifrac = np.z
+0008b6b0: 6572 6f73 2864 662e 7368 6170 655b 305d  eros(df.shape[0]
+0008b6c0: 290a 2020 2020 2020 2020 7369 6478 203d  ).        sidx =
+0008b6d0: 206e 702e 6675 6c6c 2864 662e 7368 6170   np.full(df.shap
+0008b6e0: 655b 305d 2c20 2727 290a 2020 2020 2020  e[0], '').      
+0008b6f0: 2020 675f 7369 7a65 203d 206e 702e 7a65    g_size = np.ze
+0008b700: 726f 7328 6466 2e73 6861 7065 5b30 5d29  ros(df.shape[0])
+0008b710: 0a20 2020 2020 2020 206e 5f65 786f 6e73  .        n_exons
+0008b720: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
+0008b730: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
+0008b740: 2067 5f76 6f6c 203d 206e 702e 7a65 726f   g_vol = np.zero
+0008b750: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
+0008b760: 2020 2020 2020 2069 636e 7420 3d20 6e70         icnt = np
+0008b770: 2e7a 6572 6f73 2864 662e 7368 6170 655b  .zeros(df.shape[
+0008b780: 305d 290a 2020 2020 2020 2020 7374 726e  0]).        strn
+0008b790: 6420 3d20 6e70 2e7a 6572 6f73 2864 662e  d = np.zeros(df.
+0008b7a0: 7368 6170 655b 305d 290a 2020 2020 2020  shape[0]).      
+0008b7b0: 2020 6364 6e67 203d 206e 702e 7a65 726f    cdng = np.zero
+0008b7c0: 7328 6466 2e73 6861 7065 5b30 5d29 0a20  s(df.shape[0]). 
+0008b7d0: 2020 2020 2020 200a 2020 2020 2327 2727         .    #'''
+0008b7e0: 0a20 2020 2072 6566 5f69 6e66 6f20 3d20  .    ref_info = 
+0008b7f0: 4661 6c73 650a 2020 2020 6966 206c 656e  False.    if len
+0008b800: 2864 665b 715f 6964 5d5b 305d 2e73 706c  (df[q_id][0].spl
+0008b810: 6974 2827 3a27 2929 203d 3d20 343a 200a  it(':')) == 4: .
+0008b820: 2020 2020 2020 2020 7265 665f 696e 666f          ref_info
+0008b830: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0008b840: 2320 7072 696e 7428 2752 6566 5f69 6e66  # print('Ref_inf
+0008b850: 6f20 6973 2074 7275 6527 290a 2020 2020  o is true').    
+0008b860: 2020 2020 0a20 2020 2069 6620 7265 665f      .    if ref_
+0008b870: 696e 666f 203d 3d20 5472 7565 3a0a 2020  info == True:.  
+0008b880: 2020 2020 2020 6769 6420 3d20 5b5d 0a20        gid = []. 
+0008b890: 2020 2020 2020 2063 7667 203d 205b 5d0a         cvg = [].
+0008b8a0: 2020 2020 2020 2020 6162 6e5f 7420 3d20          abn_t = 
+0008b8b0: 5b5d 0a20 2020 2020 2020 2074 706d 5f74  [].        tpm_t
+0008b8c0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+0008b8d0: 7220 6b20 696e 2072 616e 6765 2864 662e  r k in range(df.
+0008b8e0: 7368 6170 655b 305d 293a 0a20 2020 2020  shape[0]):.     
+0008b8f0: 2020 2020 2020 2069 7465 6d73 203d 2064         items = d
+0008b900: 665b 715f 6964 5d5b 6b5d 2e73 706c 6974  f[q_id][k].split
+0008b910: 2827 3a27 290a 2020 2020 2020 2020 2020  (':').          
+0008b920: 2020 6769 642e 6170 7065 6e64 2820 6974    gid.append( it
+0008b930: 656d 735b 305d 2029 0a20 2020 2020 2020  ems[0] ).       
+0008b940: 2020 2020 2063 7667 2e61 7070 656e 6428       cvg.append(
+0008b950: 2066 6c6f 6174 2869 7465 6d73 5b31 5d29   float(items[1])
+0008b960: 2029 0a20 2020 2020 2020 2020 2020 2061   ).            a
+0008b970: 626e 5f74 2e61 7070 656e 6428 2066 6c6f  bn_t.append( flo
+0008b980: 6174 2869 7465 6d73 5b32 5d29 2029 0a20  at(items[2]) ). 
+0008b990: 2020 2020 2020 2020 2020 2074 706d 5f74             tpm_t
+0008b9a0: 2e61 7070 656e 6428 2066 6c6f 6174 2869  .append( float(i
+0008b9b0: 7465 6d73 5b33 5d29 2029 0a20 2020 2065  tems[3]) ).    e
+0008b9c0: 6c73 653a 0a20 2020 2020 2020 2067 6964  lse:.        gid
+0008b9d0: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
+0008b9e0: 6861 7065 5b30 5d29 0a20 2020 2020 2020  hape[0]).       
+0008b9f0: 2063 7667 203d 206e 702e 7a65 726f 7328   cvg = np.zeros(
+0008ba00: 6466 2e73 6861 7065 5b30 5d29 0a20 2020  df.shape[0]).   
+0008ba10: 2020 2020 2061 626e 5f74 203d 206e 702e       abn_t = np.
+0008ba20: 7a65 726f 7328 6466 2e73 6861 7065 5b30  zeros(df.shape[0
+0008ba30: 5d29 0a20 2020 2020 2020 2074 706d 5f74  ]).        tpm_t
+0008ba40: 203d 206e 702e 7a65 726f 7328 6466 2e73   = np.zeros(df.s
+0008ba50: 6861 7065 5b30 5d29 0a0a 2020 2020 2327  hape[0])..    #'
+0008ba60: 2727 0a20 2020 2064 665b 2765 7870 5f63  ''.    df['exp_c
+0008ba70: 7667 275d 203d 2063 7667 0a20 2020 2064  vg'] = cvg.    d
+0008ba80: 665b 2761 626e 5f74 7275 6527 5d20 3d20  f['abn_true'] = 
+0008ba90: 6162 6e5f 740a 2020 2020 6466 5b27 6162  abn_t.    df['ab
+0008baa0: 6e5f 6573 7427 5d20 3d20 6162 6e5f 650a  n_est'] = abn_e.
+0008bab0: 2020 2020 6466 5b27 7470 6d5f 7472 7565      df['tpm_true
+0008bac0: 275d 203d 2074 706d 5f74 0a20 2020 2064  '] = tpm_t.    d
+0008bad0: 665b 2774 706d 5f65 7374 275d 203d 2074  f['tpm_est'] = t
+0008bae0: 706d 5f65 0a20 2020 2064 665b 2767 6964  pm_e.    df['gid
+0008baf0: 7827 5d20 3d20 7369 6478 0a20 2020 2064  x'] = sidx.    d
+0008bb00: 665b 2769 6964 7827 5d20 3d20 6963 6e74  f['iidx'] = icnt
+0008bb10: 0a20 2020 2064 665b 2767 5f73 697a 6527  .    df['g_size'
+0008bb20: 5d20 3d20 675f 7369 7a65 0a20 2020 2064  ] = g_size.    d
+0008bb30: 665b 2769 736f 5f66 7261 6327 5d20 3d20  f['iso_frac'] = 
+0008bb40: 6966 7261 630a 2020 2020 6466 5b27 6e5f  ifrac.    df['n_
+0008bb50: 6578 6f6e 7327 5d20 3d20 6e5f 6578 6f6e  exons'] = n_exon
+0008bb60: 730a 2020 2020 6466 5b27 675f 766f 6c27  s.    df['g_vol'
+0008bb70: 5d20 3d20 675f 766f 6c0a 2020 2020 6466  ] = g_vol.    df
+0008bb80: 5b27 7374 7261 6e64 275d 203d 2073 7472  ['strand'] = str
+0008bb90: 6e64 0a20 2020 2064 665b 2743 5f6f 725f  nd.    df['C_or_
+0008bba0: 4e27 5d20 3d20 6364 6e67 0a20 2020 2020  N'] = cdng.     
+0008bbb0: 2020 200a 2020 2020 6220 3d20 6466 5b71     .    b = df[q
+0008bbc0: 5f63 7667 5d20 3e3d 2030 2e38 0a20 2020  _cvg] >= 0.8.   
+0008bbd0: 2064 665f 6e65 7720 3d20 6466 2e6c 6f63   df_new = df.loc
+0008bbe0: 5b62 2c3a 5d0a 2020 2020 6466 203d 2064  [b,:].    df = d
+0008bbf0: 665f 6e65 770a 2020 2020 0a20 2020 2066  f_new.    .    f
+0008bc00: 756c 6c5f 6e61 6d65 7320 3d20 6466 5b71  ull_names = df[q
+0008bc10: 5f69 645d 202b 2064 665b 735f 6964 5d0a  _id] + df[s_id].
+0008bc20: 2020 2020 666e 7320 3d20 7064 2e75 6e69      fns = pd.uni
+0008bc30: 7175 6528 6675 6c6c 5f6e 616d 6573 290a  que(full_names).
+0008bc40: 2020 2020 6b20 3d20 300a 2020 2020 6466      k = 0.    df
+0008bc50: 5f6c 7374 203d 205b 5d0a 2020 2020 666f  _lst = [].    fo
+0008bc60: 7220 666e 2069 6e20 666e 733a 0a20 2020  r fn in fns:.   
+0008bc70: 2020 2020 2077 6820 3d20 7768 6963 6828       wh = which(
+0008bc80: 6675 6c6c 5f6e 616d 6573 203d 3d20 666e  full_names == fn
+0008bc90: 290a 2020 2020 2020 2020 6466 5f74 6d70  ).        df_tmp
+0008bca0: 203d 2064 662e 696c 6f63 5b77 685d 0a20   = df.iloc[wh]. 
+0008bcb0: 2020 2020 2020 2071 6376 6720 3d20 6e70         qcvg = np
+0008bcc0: 2e61 7272 6179 2820 6466 5f74 6d70 5b71  .array( df_tmp[q
+0008bcd0: 5f63 7667 5d20 290a 2020 2020 2020 2020  _cvg] ).        
+0008bce0: 6f64 7220 3d20 7163 7667 2e61 7267 736f  odr = qcvg.argso
+0008bcf0: 7274 2829 0a20 2020 2020 2020 2064 665f  rt().        df_
+0008bd00: 6c73 742e 6170 7065 6e64 2864 665f 746d  lst.append(df_tm
+0008bd10: 702e 696c 6f63 5b6f 6472 5b2d 315d 5d29  p.iloc[odr[-1]])
+0008bd20: 200a 2020 2020 2020 2020 6b20 2b3d 2031   .        k += 1
+0008bd30: 0a0a 2020 2020 6966 206c 656e 2864 665f  ..    if len(df_
+0008bd40: 6c73 7429 203e 2030 3a0a 2020 2020 2020  lst) > 0:.      
+0008bd50: 2020 6466 5f73 656c 203d 2070 642e 4461    df_sel = pd.Da
+0008bd60: 7461 4672 616d 6528 6466 5f6c 7374 290a  taFrame(df_lst).
+0008bd70: 2020 2020 2020 2020 2327 2727 0a20 2020          #'''.   
+0008bd80: 2020 2020 2074 7269 6e66 6f20 3d20 2725       trinfo = '%
+0008bd90: 735f 626c 6173 745f 7265 7375 6c74 2e74  s_blast_result.t
+0008bda0: 7376 2720 2520 666e 616d 650a 2020 2020  sv' % fname.    
+0008bdb0: 2020 2020 6466 5f73 656c 2e74 6f5f 6373      df_sel.to_cs
+0008bdc0: 7628 7472 696e 666f 2c20 6865 6164 6572  v(trinfo, header
+0008bdd0: 3d54 7275 652c 2069 6e64 6578 3d46 616c  =True, index=Fal
+0008bde0: 7365 2c20 7365 703d 275c 7427 290a 2020  se, sep='\t').  
+0008bdf0: 2020 2020 2020 2320 6966 2076 6572 626f        # if verbo
+0008be00: 7365 3a20 7072 696e 7428 2754 7261 6e73  se: print('Trans
+0008be10: 6372 6970 746f 6d65 2049 6e66 6f2e 2077  criptome Info. w
+0008be20: 7269 7474 656e 2074 6f20 5c6e 2020 2025  ritten to \n   %
+0008be30: 732e 2720 2520 7472 696e 666f 2029 0a0a  s.' % trinfo )..
+0008be40: 2020 2020 2020 2020 6466 5f73 656c 203d          df_sel =
+0008be50: 2070 642e 7265 6164 5f63 7376 2874 7269   pd.read_csv(tri
+0008be60: 6e66 6f2c 2073 6570 3d27 5c74 2729 0a20  nfo, sep='\t'). 
+0008be70: 2020 2020 2020 2023 2727 270a 0a20 2020         #'''..   
+0008be80: 2020 2020 2064 665f 7065 7266 2c20 6466       df_perf, df
+0008be90: 5f73 656c 203d 2067 6574 5f70 6572 666f  _sel = get_perfo
+0008bea0: 726d 616e 6365 2864 665f 7365 6c2c 2066  rmance(df_sel, f
+0008beb0: 5f74 6f5f 7361 7665 3d66 6e61 6d65 2c20  _to_save=fname, 
+0008bec0: 7265 6620 3d20 7265 662c 2076 6572 626f  ref = ref, verbo
+0008bed0: 7365 3d76 6572 626f 7365 290a 2020 2020  se=verbose).    
+0008bee0: 2020 2020 6466 5f70 6572 665b 2770 7265      df_perf['pre
+0008bef0: 6369 7369 6f6e 275d 203d 2072 6f75 6e64  cision'] = round
+0008bf00: 2864 665f 7065 7266 5b27 4e5f 7265 636f  (df_perf['N_reco
+0008bf10: 7665 7265 6427 5d2a 3130 302f 6361 6e64  vered']*100/cand
+0008bf20: 5f63 6e74 2c31 290a 2020 2020 2020 2020  _cnt,1).        
+0008bf30: 6466 5f70 6572 665b 2773 656e 7369 7469  df_perf['sensiti
+0008bf40: 7669 7479 275d 203d 2072 6f75 6e64 2864  vity'] = round(d
+0008bf50: 665f 7065 7266 5b27 4e5f 7265 636f 7665  f_perf['N_recove
+0008bf60: 7265 6427 5d2a 3130 302f 7265 665f 636e  red']*100/ref_cn
+0008bf70: 742c 3129 0a20 2020 2020 2020 2023 2069  t,1).        # i
+0008bf80: 6620 7665 7262 6f73 653a 2070 7269 6e74  f verbose: print
+0008bf90: 2864 665f 7065 7266 290a 2020 2020 2020  (df_perf).      
+0008bfa0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
+0008bfb0: 2074 7261 7265 636f 203d 3d20 5472 7565   trareco == True
+0008bfc0: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
+0008bfd0: 5f74 7220 3d20 6765 745f 696e 666f 5f66  _tr = get_info_f
+0008bfe0: 726f 6d5f 7472 5f6e 616d 6528 2074 6e20  rom_tr_name( tn 
+0008bff0: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+0008c000: 5f74 725b 2764 6574 6563 7465 6427 5d20  _tr['detected'] 
+0008c010: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0008c020: 2020 2020 6466 5f74 722e 6c6f 635b 6c69      df_tr.loc[li
+0008c030: 7374 2864 665f 7365 6c5b 735f 6964 5d29  st(df_sel[s_id])
+0008c040: 2c27 6465 7465 6374 6564 275d 203d 2054  ,'detected'] = T
+0008c050: 7275 6520 0a20 2020 2020 2020 2020 2020  rue .           
+0008c060: 2064 665f 7472 5b71 5f6c 656e 5d20 3d20   df_tr[q_len] = 
+0008c070: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
+0008c080: 7220 6d2c 2073 6964 2069 6e20 656e 756d  r m, sid in enum
+0008c090: 6572 6174 6528 6466 5f73 656c 5b73 5f69  erate(df_sel[s_i
+0008c0a0: 645d 293a 0a20 2020 2020 2020 2020 2020  d]):.           
+0008c0b0: 2020 2020 2064 665f 7472 2e6c 6f63 5b73       df_tr.loc[s
+0008c0c0: 6964 2c71 5f6c 656e 5d20 3d20 6e70 2e72  id,q_len] = np.r
+0008c0d0: 6f75 6e64 2864 665f 7365 6c2e 696c 6f63  ound(df_sel.iloc
+0008c0e0: 5b6d 5d2e 716c 656e 290a 2020 2020 2020  [m].qlen).      
+0008c0f0: 2020 2020 2020 6466 5f74 725b 735f 7374        df_tr[s_st
+0008c100: 6172 745d 203d 2030 0a20 2020 2020 2020  art] = 0.       
+0008c110: 2020 2020 2023 2064 665f 7472 2e6c 6f63       # df_tr.loc
+0008c120: 5b6c 6973 7428 6466 5f73 656c 5b27 7369  [list(df_sel['si
+0008c130: 6427 5d29 2c27 7363 7667 275d 203d 2064  d']),'scvg'] = d
+0008c140: 665f 7365 6c2e 6c6f 635b 3a2c 2773 6376  f_sel.loc[:,'scv
+0008c150: 6727 5d20 0a20 2020 2020 2020 2020 2020  g'] .           
+0008c160: 2066 6f72 206d 2c20 7369 6420 696e 2065   for m, sid in e
+0008c170: 6e75 6d65 7261 7465 2864 665f 7365 6c5b  numerate(df_sel[
+0008c180: 735f 6964 5d29 3a0a 2020 2020 2020 2020  s_id]):.        
+0008c190: 2020 2020 2020 2020 6466 5f74 722e 6c6f          df_tr.lo
+0008c1a0: 635b 7369 642c 735f 7374 6172 745d 203d  c[sid,s_start] =
+0008c1b0: 206e 702e 726f 756e 6428 6466 5f73 656c   np.round(df_sel
+0008c1c0: 2e69 6c6f 635b 6d5d 2e73 7374 6172 7429  .iloc[m].sstart)
+0008c1d0: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+0008c1e0: 7472 5b73 5f65 6e64 5d20 3d20 300a 2020  tr[s_end] = 0.  
+0008c1f0: 2020 2020 2020 2020 2020 2320 6466 5f74            # df_t
+0008c200: 722e 6c6f 635b 6c69 7374 2864 665f 7365  r.loc[list(df_se
+0008c210: 6c5b 2773 6964 275d 292c 2773 6376 6727  l['sid']),'scvg'
+0008c220: 5d20 3d20 6466 5f73 656c 2e6c 6f63 5b3a  ] = df_sel.loc[:
+0008c230: 2c27 7363 7667 275d 200a 2020 2020 2020  ,'scvg'] .      
+0008c240: 2020 2020 2020 666f 7220 6d2c 2073 6964        for m, sid
+0008c250: 2069 6e20 656e 756d 6572 6174 6528 6466   in enumerate(df
+0008c260: 5f73 656c 5b73 5f69 645d 293a 0a20 2020  _sel[s_id]):.   
+0008c270: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+0008c280: 7472 2e6c 6f63 5b73 6964 2c73 5f65 6e64  tr.loc[sid,s_end
+0008c290: 5d20 3d20 6e70 2e72 6f75 6e64 2864 665f  ] = np.round(df_
+0008c2a0: 7365 6c2e 696c 6f63 5b6d 5d2e 7365 6e64  sel.iloc[m].send
+0008c2b0: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+0008c2c0: 5f74 7220 3d20 6466 5f74 722e 7265 7365  _tr = df_tr.rese
+0008c2d0: 745f 696e 6465 7828 290a 2020 2020 2020  t_index().      
+0008c2e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008c2f0: 2020 2020 6466 5f74 7220 3d20 4e6f 6e65      df_tr = None
+0008c300: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0008c310: 2020 2020 2020 7265 7475 726e 2864 665f        return(df_
+0008c320: 7065 7266 2c20 6466 5f73 656c 2c20 6466  perf, df_sel, df
+0008c330: 5f74 7229 0a20 2020 200a 2020 2020 656c  _tr).    .    el
+0008c340: 7365 3a0a 2020 2020 2020 2020 6966 2076  se:.        if v
+0008c350: 6572 626f 7365 3a20 7072 696e 7428 274e  erbose: print('N
+0008c360: 6f20 7472 2066 6f75 6e64 2e20 2729 0a20  o tr found. '). 
+0008c370: 2020 2020 2020 2072 6574 7572 6e28 4e6f         return(No
+0008c380: 6e65 2c4e 6f6e 652c 4e6f 6e65 290a 2020  ne,None,None).  
+0008c390: 2020 0a0a 2323 2323 2323 2323 2323 2323    ..############
+0008c3a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c3b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c3c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c3d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c3e0: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
+0008c3f0: 6f6e 7320 746f 2028 3129 2073 656c 6563  ons to (1) selec
+0008c400: 7420 7370 6563 6966 6963 2063 6872 6d20  t specific chrm 
+0008c410: 616e 6420 2832 2920 6f6e 6c79 2063 6f64  and (2) only cod
+0008c420: 696e 6720 6765 6e65 7320 696e 2061 2047  ing genes in a G
+0008c430: 5446 0a23 2323 2323 2323 2323 2323 2323  TF.#############
+0008c440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008c480: 2323 2323 230a 0a64 6566 2073 6f72 745f  #####..def sort_
+0008c490: 6774 665f 6c69 6e65 735f 6c73 7428 6774  gtf_lines_lst(gt
+0008c4a0: 665f 6c69 6e65 735f 6c73 7429 3a0a 2020  f_lines_lst):.  
+0008c4b0: 2020 0a20 2020 2063 6872 7320 3d20 5b5d    .    chrs = []
+0008c4c0: 0a20 2020 2066 6f72 206c 696e 6573 2069  .    for lines i
+0008c4d0: 6e20 6774 665f 6c69 6e65 735f 6c73 743a  n gtf_lines_lst:
+0008c4e0: 0a20 2020 2020 2020 2066 6972 7374 5f6c  .        first_l
+0008c4f0: 696e 6520 3d20 6c69 6e65 735b 305d 0a20  ine = lines[0]. 
+0008c500: 2020 2020 2020 2063 6872 732e 6170 7065         chrs.appe
+0008c510: 6e64 2866 6972 7374 5f6c 696e 652e 6368  nd(first_line.ch
+0008c520: 7229 0a0a 2020 2020 6368 725f 7365 7420  r)..    chr_set 
+0008c530: 3d20 6c69 7374 2873 6574 2863 6872 7329  = list(set(chrs)
+0008c540: 290a 2020 2020 6368 725f 7365 742e 736f  ).    chr_set.so
+0008c550: 7274 2829 0a20 2020 2063 6872 7320 3d20  rt().    chrs = 
+0008c560: 6e70 2e61 7272 6179 2863 6872 7329 0a0a  np.array(chrs)..
+0008c570: 2020 2020 6774 665f 6c73 745f 6e65 7720      gtf_lst_new 
+0008c580: 3d20 5b5d 0a20 2020 2066 6f72 2063 2069  = [].    for c i
+0008c590: 6e20 6368 725f 7365 743a 0a20 2020 2020  n chr_set:.     
+0008c5a0: 2020 2077 6820 3d20 7768 6963 6828 6368     wh = which(ch
+0008c5b0: 7273 203d 3d20 6329 0a20 2020 2020 2020  rs == c).       
+0008c5c0: 2070 7320 3d20 6e70 2e61 7272 6179 2820   ps = np.array( 
+0008c5d0: 5b67 7466 5f6c 696e 6573 5f6c 7374 5b77  [gtf_lines_lst[w
+0008c5e0: 5d5b 305d 2e73 7461 7274 2066 6f72 2077  ][0].start for w
+0008c5f0: 2069 6e20 7768 5d20 290a 2020 2020 2020   in wh] ).      
+0008c600: 2020 6f64 7232 203d 2070 732e 6172 6773    odr2 = ps.args
+0008c610: 6f72 7428 290a 2020 2020 2020 2020 666f  ort().        fo
+0008c620: 7220 6f20 696e 206f 6472 323a 0a20 2020  r o in odr2:.   
+0008c630: 2020 2020 2020 2020 2077 203d 2077 685b           w = wh[
+0008c640: 6f5d 0a20 2020 2020 2020 2020 2020 2067  o].            g
+0008c650: 7466 5f6c 7374 5f6e 6577 2e61 7070 656e  tf_lst_new.appen
+0008c660: 6428 6774 665f 6c69 6e65 735f 6c73 745b  d(gtf_lines_lst[
+0008c670: 775d 290a 2020 2020 2020 2020 0a20 2020  w]).        .   
+0008c680: 2072 6574 7572 6e20 6774 665f 6c73 745f   return gtf_lst_
+0008c690: 6e65 770a 0a0a 6465 6620 7365 6c65 6374  new...def select
+0008c6a0: 5f63 6f64 696e 675f 6765 6e65 735f 6672  _coding_genes_fr
+0008c6b0: 6f6d 5f67 7466 5f66 696c 6528 6774 665f  om_gtf_file(gtf_
+0008c6c0: 6669 6c65 2c20 6765 6e6f 6d65 5f66 696c  file, genome_fil
+0008c6d0: 6529 3a0a 0a20 2020 2066 6e73 203d 2067  e):..    fns = g
+0008c6e0: 7466 5f66 696c 652e 7370 6c69 7428 272e  tf_file.split('.
+0008c6f0: 2729 5b3a 2d31 5d0a 2020 2020 666e 616d  ')[:-1].    fnam
+0008c700: 6520 3d20 2727 0a20 2020 2066 6f72 206b  e = ''.    for k
+0008c710: 2c20 666e 2069 6e20 656e 756d 6572 6174  , fn in enumerat
+0008c720: 6528 666e 7329 3a0a 2020 2020 2020 2020  e(fns):.        
+0008c730: 6966 206b 203e 2030 3a0a 2020 2020 2020  if k > 0:.      
+0008c740: 2020 2020 2020 666e 616d 6520 3d20 666e        fname = fn
+0008c750: 616d 6520 2b20 272e 270a 2020 2020 2020  ame + '.'.      
+0008c760: 2020 666e 616d 6520 3d20 666e 616d 6520    fname = fname 
+0008c770: 2b20 666e 0a20 2020 200a 2020 2020 6774  + fn.    .    gt
+0008c780: 665f 6c69 6e65 732c 2068 6472 5f6c 696e  f_lines, hdr_lin
+0008c790: 6573 203d 206c 6f61 645f 6774 6628 6774  es = load_gtf(gt
+0008c7a0: 665f 6669 6c65 2c20 7665 7262 6f73 6520  f_file, verbose 
+0008c7b0: 3d20 5472 7565 290a 2020 2020 0a20 2020  = True).    .   
+0008c7c0: 2062 6173 655f 6364 7320 3d20 6765 745f   base_cds = get_
+0008c7d0: 6261 7365 5f63 6473 5f66 726f 6d5f 6774  base_cds_from_gt
+0008c7e0: 665f 6c69 6e65 7328 6774 665f 6c69 6e65  f_lines(gtf_line
+0008c7f0: 7329 0a20 2020 2069 6620 6261 7365 5f63  s).    if base_c
+0008c800: 6473 203c 2030 3a0a 2020 2020 2020 2020  ds < 0:.        
+0008c810: 7072 696e 7428 2749 4e46 4f3a 204e 6f20  print('INFO: No 
+0008c820: 636f 6469 6e67 2069 6e66 6f72 6d61 7469  coding informati
+0008c830: 6f6e 2070 726f 7669 6465 6420 696e 2074  on provided in t
+0008c840: 6865 2047 5446 2f47 4646 2e27 290a 2020  he GTF/GFF.').  
+0008c850: 2020 0a20 2020 2067 7466 5f6c 696e 6573    .    gtf_lines
+0008c860: 5f6c 7374 203d 2070 6172 7365 5f67 7466  _lst = parse_gtf
+0008c870: 5f6c 696e 6573 5f61 6e64 5f73 706c 6974  _lines_and_split
+0008c880: 5f69 6e74 6f5f 6765 6e65 7328 2067 7466  _into_genes( gtf
+0008c890: 5f6c 696e 6573 2029 0a20 2020 2067 656e  _lines ).    gen
+0008c8a0: 6f6d 6520 3d20 6c6f 6164 5f67 656e 6f6d  ome = load_genom
+0008c8b0: 6528 6765 6e6f 6d65 5f66 696c 6529 0a20  e(genome_file). 
+0008c8c0: 2020 2063 6872 7320 3d20 6765 6e6f 6d65     chrs = genome
+0008c8d0: 2e6b 6579 7328 290a 0a20 2020 2067 7466  .keys()..    gtf
+0008c8e0: 5f6c 696e 6573 5f6c 7374 5f6e 6577 203d  _lines_lst_new =
+0008c8f0: 205b 5d0a 2020 2020 6363 6e74 203d 2030   [].    ccnt = 0
+0008c900: 0a20 2020 2067 636e 7420 3d20 300a 2020  .    gcnt = 0.  
+0008c910: 2020 666f 7220 6b2c 2067 6c69 6e65 7320    for k, glines 
+0008c920: 696e 2065 6e75 6d65 7261 7465 2867 7466  in enumerate(gtf
+0008c930: 5f6c 696e 6573 5f6c 7374 293a 0a0a 2020  _lines_lst):..  
+0008c940: 2020 2020 2020 6966 2020 676c 696e 6573        if  glines
+0008c950: 5b30 5d2e 6368 7220 696e 2063 6872 733a  [0].chr in chrs:
+0008c960: 0a20 2020 2020 2020 2020 2020 2074 725f  .            tr_
+0008c970: 6c69 6e65 735f 6c73 7420 3d20 7061 7273  lines_lst = pars
+0008c980: 655f 6774 665f 6c69 6e65 735f 616e 645f  e_gtf_lines_and_
+0008c990: 7370 6c69 745f 696e 746f 5f67 656e 6573  split_into_genes
+0008c9a0: 2820 676c 696e 6573 2c20 2774 7261 6e73  ( glines, 'trans
+0008c9b0: 6372 6970 7427 2029 0a20 2020 2020 2020  cript' ).       
+0008c9c0: 2020 2020 206c 696e 6573 5f6e 6577 203d       lines_new =
+0008c9d0: 205b 5d0a 0a20 2020 2020 2020 2020 2020   []..           
+0008c9e0: 2066 6f72 206c 696e 6573 2069 6e20 7472   for lines in tr
+0008c9f0: 5f6c 696e 6573 5f6c 7374 3a0a 2020 2020  _lines_lst:.    
+0008ca00: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+0008ca10: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0008ca20: 2020 2020 2020 636e 7420 3d20 5b30 2c30        cnt = [0,0
+0008ca30: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0008ca40: 2020 666f 7220 6774 666c 696e 6520 696e    for gtfline in
+0008ca50: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
+0008ca60: 2020 2020 2020 2020 2020 2020 6966 2067              if g
+0008ca70: 7466 6c69 6e65 2e66 6561 7475 7265 203d  tfline.feature =
+0008ca80: 3d20 2773 7461 7274 5f63 6f64 6f6e 273a  = 'start_codon':
+0008ca90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008caa0: 2020 2020 2020 2020 2063 6e74 5b30 5d20           cnt[0] 
+0008cab0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0008cac0: 2020 2020 2020 2020 2069 6620 6774 666c           if gtfl
+0008cad0: 696e 652e 6665 6174 7572 6520 3d3d 2027  ine.feature == '
+0008cae0: 7374 6f70 5f63 6f64 6f6e 273a 0a20 2020  stop_codon':.   
 0008caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cb00: 2020 2020 2062 203d 2054 7275 650a 2020       b = True.  
-0008cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cb20: 2020 2020 2020 6363 6e74 202b 3d20 310a        ccnt += 1.
-0008cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cb40: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0008cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008cb60: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0008cb70: 2020 2020 2020 2069 6620 623a 206c 696e         if b: lin
-0008cb80: 6573 5f6e 6577 203d 206c 696e 6573 5f6e  es_new = lines_n
-0008cb90: 6577 202b 206c 696e 6573 0a20 2020 2020  ew + lines.     
-0008cba0: 2020 2020 2020 2020 2020 2067 636e 7420             gcnt 
-0008cbb0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-0008cbc0: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-0008cbd0: 206c 656e 286c 696e 6573 5f6e 6577 2920   len(lines_new) 
-0008cbe0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0008cbf0: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
-0008cc00: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
-0008cc10: 6e65 735f 6e65 7729 0a20 2020 2020 2020  nes_new).       
-0008cc20: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-0008cc30: 206b 2531 3030 203d 3d20 303a 2070 7269   k%100 == 0: pri
-0008cc40: 6e74 2827 5c72 7061 7273 696e 6720 2e2e  nt('\rparsing ..
-0008cc50: 2025 692f 2569 2028 2569 2f25 6929 2720   %i/%i (%i/%i)' 
-0008cc60: 2520 286b 2c20 6c65 6e28 6774 665f 6c69  % (k, len(gtf_li
-0008cc70: 6e65 735f 6c73 7429 2c20 6363 6e74 2c20  nes_lst), ccnt, 
-0008cc80: 6763 6e74 292c 2065 6e64 3d27 272c 2066  gcnt), end='', f
-0008cc90: 6c75 7368 203d 2054 7275 6520 290a 0a20  lush = True ).. 
-0008cca0: 2020 2070 7269 6e74 2827 5c72 7061 7273     print('\rpars
-0008ccb0: 696e 6720 2e2e 2025 692f 2569 2028 2569  ing .. %i/%i (%i
-0008ccc0: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
-0008ccd0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
-0008cce0: 6363 6e74 2c20 6763 6e74 292c 2066 6c75  ccnt, gcnt), flu
-0008ccf0: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
-0008cd00: 7072 696e 7428 2753 6f72 7469 6e67 202e  print('Sorting .
-0008cd10: 2e20 272c 2065 6e64 3d27 2729 0a20 2020  . ', end='').   
-0008cd20: 2067 7466 5f6c 696e 6573 5f6c 7374 5f6e   gtf_lines_lst_n
-0008cd30: 6577 203d 2073 6f72 745f 6774 665f 6c69  ew = sort_gtf_li
-0008cd40: 6e65 735f 6c73 7428 6774 665f 6c69 6e65  nes_lst(gtf_line
-0008cd50: 735f 6c73 745f 6e65 7729 0a20 2020 2070  s_lst_new).    p
-0008cd60: 7269 6e74 2827 5c72 536f 7274 696e 6720  rint('\rSorting 
-0008cd70: 2e2e 2064 6f6e 6527 290a 2020 2020 2020  .. done').      
-0008cd80: 2020 2020 2020 0a20 2020 2067 7466 5f6c        .    gtf_l
-0008cd90: 696e 6573 5f6e 6577 203d 205b 5d0a 2020  ines_new = [].  
-0008cda0: 2020 666f 7220 6c69 6e65 7320 696e 2067    for lines in g
-0008cdb0: 7466 5f6c 696e 6573 5f6c 7374 5f6e 6577  tf_lines_lst_new
-0008cdc0: 3a0a 2020 2020 2020 2020 6774 665f 6c69  :.        gtf_li
-0008cdd0: 6e65 735f 6e65 7720 3d20 6774 665f 6c69  nes_new = gtf_li
-0008cde0: 6e65 735f 6e65 7720 2b20 6c69 6e65 730a  nes_new + lines.
-0008cdf0: 2020 2020 2020 2020 0a20 2020 2066 6e61          .    fna
-0008ce00: 6d65 203d 2066 6e61 6d65 202b 2027 5f63  me = fname + '_c
-0008ce10: 6473 2e67 7466 270a 2020 2020 7072 696e  ds.gtf'.    prin
-0008ce20: 7428 2753 6176 696e 6720 2e2e 2027 2c20  t('Saving .. ', 
-0008ce30: 656e 643d 2727 290a 2020 2020 7361 7665  end='').    save
-0008ce40: 5f67 7466 2820 666e 616d 652c 2067 7466  _gtf( fname, gtf
-0008ce50: 5f6c 696e 6573 5f6e 6577 2c20 6864 725f  _lines_new, hdr_
-0008ce60: 6c69 6e65 7320 290a 2020 2020 7072 696e  lines ).    prin
-0008ce70: 7428 275c 7253 6176 696e 6720 2e2e 2064  t('\rSaving .. d
-0008ce80: 6f6e 6527 290a 2020 2020 0a20 2020 2072  one').    .    r
-0008ce90: 6574 7572 6e20 666e 616d 650a 2020 2020  eturn fname.    
-0008cea0: 0a0a 6465 6620 7365 6c65 6374 5f63 6872  ..def select_chr
-0008ceb0: 5f66 726f 6d5f 6774 665f 6669 6c65 2867  _from_gtf_file(g
-0008cec0: 7466 5f66 696c 652c 2063 6872 6d73 203d  tf_file, chrms =
-0008ced0: 205b 5d29 3a0a 0a20 2020 2066 6e73 203d   []):..    fns =
-0008cee0: 2067 7466 5f66 696c 652e 7370 6c69 7428   gtf_file.split(
-0008cef0: 272e 2729 5b3a 2d31 5d0a 2020 2020 666e  '.')[:-1].    fn
-0008cf00: 616d 6520 3d20 2727 0a20 2020 2066 6f72  ame = ''.    for
-0008cf10: 206b 2c20 666e 2069 6e20 656e 756d 6572   k, fn in enumer
-0008cf20: 6174 6528 666e 7329 3a0a 2020 2020 2020  ate(fns):.      
-0008cf30: 2020 6966 206b 203e 2030 3a0a 2020 2020    if k > 0:.    
-0008cf40: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
-0008cf50: 666e 616d 6520 2b20 272e 270a 2020 2020  fname + '.'.    
-0008cf60: 2020 2020 666e 616d 6520 3d20 666e 616d      fname = fnam
-0008cf70: 6520 2b20 666e 0a20 2020 200a 2020 2020  e + fn.    .    
-0008cf80: 6774 665f 6c69 6e65 732c 2068 6472 5f6c  gtf_lines, hdr_l
-0008cf90: 696e 6573 203d 206c 6f61 645f 6774 6628  ines = load_gtf(
-0008cfa0: 6774 665f 6669 6c65 2c20 7665 7262 6f73  gtf_file, verbos
-0008cfb0: 6520 3d20 5472 7565 290a 2020 2020 0a20  e = True).    . 
-0008cfc0: 2020 2067 7466 5f6c 696e 6573 5f6c 7374     gtf_lines_lst
-0008cfd0: 203d 2070 6172 7365 5f67 7466 5f6c 696e   = parse_gtf_lin
-0008cfe0: 6573 5f61 6e64 5f73 706c 6974 5f69 6e74  es_and_split_int
-0008cff0: 6f5f 6765 6e65 7328 2067 7466 5f6c 696e  o_genes( gtf_lin
-0008d000: 6573 2029 0a0a 2020 2020 6774 665f 6c69  es )..    gtf_li
-0008d010: 6e65 735f 6c73 745f 6e65 7720 3d20 5b5d  nes_lst_new = []
-0008d020: 0a20 2020 2063 636e 7420 3d20 300a 2020  .    ccnt = 0.  
-0008d030: 2020 6763 6e74 203d 2030 0a20 2020 2069    gcnt = 0.    i
-0008d040: 6620 6973 696e 7374 616e 6365 2863 6872  f isinstance(chr
-0008d050: 6d73 2c20 7374 7229 3a0a 2020 2020 2020  ms, str):.      
-0008d060: 2020 666f 7220 6b2c 206c 696e 6573 2069    for k, lines i
-0008d070: 6e20 656e 756d 6572 6174 6528 6774 665f  n enumerate(gtf_
-0008d080: 6c69 6e65 735f 6c73 7429 3a0a 2020 2020  lines_lst):.    
-0008d090: 2020 2020 2020 2020 6220 3d20 4661 6c73          b = Fals
-0008d0a0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0008d0b0: 206c 696e 6573 5b30 5d2e 6368 7220 3d3d   lines[0].chr ==
-0008d0c0: 2063 6872 6d3a 200a 2020 2020 2020 2020   chrm: .        
-0008d0d0: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
-0008d0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d0f0: 2063 636e 7420 2b3d 2031 0a20 2020 2020   ccnt += 1.     
-0008d100: 2020 2020 2020 2067 636e 7420 2b3d 2031         gcnt += 1
-0008d110: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0008d120: 2020 2020 2020 2020 2020 6966 206b 2531            if k%1
-0008d130: 3030 203d 3d20 303a 2070 7269 6e74 2827  00 == 0: print('
-0008d140: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
-0008d150: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
-0008d160: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
-0008d170: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
-0008d180: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
-0008d190: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
-0008d1a0: 2020 2020 2020 6966 2062 3a20 0a20 2020        if b: .   
-0008d1b0: 2020 2020 2020 2020 2020 2020 2067 7466               gtf
-0008d1c0: 5f6c 696e 6573 5f6c 7374 5f6e 6577 2e61  _lines_lst_new.a
-0008d1d0: 7070 656e 6428 6c69 6e65 7329 0a20 2020  ppend(lines).   
-0008d1e0: 2065 6c73 653a 0a20 2020 2020 2020 2066   else:.        f
-0008d1f0: 6f72 2063 6872 6d20 696e 2063 6872 6d73  or chrm in chrms
-0008d200: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0008d210: 7220 6b2c 206c 696e 6573 2069 6e20 656e  r k, lines in en
-0008d220: 756d 6572 6174 6528 6774 665f 6c69 6e65  umerate(gtf_line
-0008d230: 735f 6c73 7429 3a0a 2020 2020 2020 2020  s_lst):.        
-0008d240: 2020 2020 2020 2020 6220 3d20 4661 6c73          b = Fals
-0008d250: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0008d260: 2020 6966 206c 696e 6573 5b30 5d2e 6368    if lines[0].ch
-0008d270: 7220 3d3d 2063 6872 6d3a 200a 2020 2020  r == chrm: .    
-0008d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d290: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
-0008d2a0: 2020 2020 2020 2020 2020 2020 2063 636e               ccn
-0008d2b0: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-0008d2c0: 2020 2020 2020 2067 636e 7420 2b3d 2031         gcnt += 1
-0008d2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d2e0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0008d2f0: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
-0008d300: 2070 7269 6e74 2827 5c72 7061 7273 696e   print('\rparsin
-0008d310: 6720 2e2e 2025 692f 2569 2028 2569 2f25  g .. %i/%i (%i/%
-0008d320: 6929 2720 2520 286b 2c20 6c65 6e28 6774  i)' % (k, len(gt
-0008d330: 665f 6c69 6e65 735f 6c73 7429 2c20 6363  f_lines_lst), cc
-0008d340: 6e74 2c20 6763 6e74 292c 2065 6e64 3d27  nt, gcnt), end='
-0008d350: 272c 2066 6c75 7368 203d 2054 7275 6520  ', flush = True 
-0008d360: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0008d370: 2020 6966 2062 3a20 0a20 2020 2020 2020    if b: .       
-0008d380: 2020 2020 2020 2020 2020 2020 2067 7466               gtf
-0008d390: 5f6c 696e 6573 5f6c 7374 5f6e 6577 2e61  _lines_lst_new.a
-0008d3a0: 7070 656e 6428 6c69 6e65 7329 0a20 2020  ppend(lines).   
-0008d3b0: 2020 2020 2063 6872 6d20 3d20 6368 726d       chrm = chrm
-0008d3c0: 735b 305d 0a20 2020 2020 2020 2066 6f72  s[0].        for
-0008d3d0: 2063 2069 6e20 6368 726d 735b 313a 5d3a   c in chrms[1:]:
-0008d3e0: 0a20 2020 2020 2020 2020 2020 2063 6872  .            chr
-0008d3f0: 6d20 3d20 6368 726d 202b 2027 2c25 7327  m = chrm + ',%s'
-0008d400: 2025 2063 0a20 2020 2020 2020 2020 2020   % c.           
-0008d410: 200a 2020 2020 7072 696e 7428 275c 7270   .    print('\rp
-0008d420: 6172 7369 6e67 202e 2e20 646f 6e65 2025  arsing .. done %
-0008d430: 692f 2569 2028 2569 2f25 6929 2720 2520  i/%i (%i/%i)' % 
-0008d440: 286b 2c20 6c65 6e28 6774 665f 6c69 6e65  (k, len(gtf_line
-0008d450: 735f 6c73 7429 2c20 6363 6e74 2c20 6763  s_lst), ccnt, gc
-0008d460: 6e74 292c 2066 6c75 7368 203d 2054 7275  nt), flush = Tru
-0008d470: 6520 290a 2020 2020 0a20 2020 2070 7269  e ).    .    pri
-0008d480: 6e74 2827 536f 7274 696e 6720 2e2e 2027  nt('Sorting .. '
-0008d490: 2c20 656e 643d 2727 290a 2020 2020 6774  , end='').    gt
-0008d4a0: 665f 6c69 6e65 735f 6c73 745f 6e65 7720  f_lines_lst_new 
-0008d4b0: 3d20 736f 7274 5f67 7466 5f6c 696e 6573  = sort_gtf_lines
-0008d4c0: 5f6c 7374 2867 7466 5f6c 696e 6573 5f6c  _lst(gtf_lines_l
-0008d4d0: 7374 5f6e 6577 290a 2020 2020 7072 696e  st_new).    prin
-0008d4e0: 7428 275c 7253 6f72 7469 6e67 202e 2e20  t('\rSorting .. 
-0008d4f0: 646f 6e65 2729 0a20 2020 2020 2020 2020  done').         
-0008d500: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
-0008d510: 735f 6e65 7720 3d20 5b5d 0a20 2020 2066  s_new = [].    f
-0008d520: 6f72 206c 696e 6573 2069 6e20 6774 665f  or lines in gtf_
-0008d530: 6c69 6e65 735f 6c73 745f 6e65 773a 0a20  lines_lst_new:. 
-0008d540: 2020 2020 2020 2067 7466 5f6c 696e 6573         gtf_lines
-0008d550: 5f6e 6577 203d 2067 7466 5f6c 696e 6573  _new = gtf_lines
-0008d560: 5f6e 6577 202b 206c 696e 6573 0a20 2020  _new + lines.   
-0008d570: 200a 2020 2020 7072 696e 7428 2753 6176   .    print('Sav
-0008d580: 696e 6720 2e2e 2027 2c20 656e 643d 2727  ing .. ', end=''
-0008d590: 290a 2020 2020 666e 616d 6520 3d20 666e  ).    fname = fn
-0008d5a0: 616d 6520 2b20 275f 7365 6c5f 2573 2e67  ame + '_sel_%s.g
-0008d5b0: 7466 2720 2520 6368 726d 0a20 2020 2073  tf' % chrm.    s
-0008d5c0: 6176 655f 6774 6628 2066 6e61 6d65 2c20  ave_gtf( fname, 
-0008d5d0: 6774 665f 6c69 6e65 735f 6e65 772c 2068  gtf_lines_new, h
-0008d5e0: 6472 5f6c 696e 6573 2029 0a20 2020 2070  dr_lines ).    p
-0008d5f0: 7269 6e74 2827 5c72 5361 7669 6e67 202e  rint('\rSaving .
-0008d600: 2e20 646f 6e65 2729 0a20 2020 200a 2020  . done').    .  
-0008d610: 2020 7265 7475 726e 2066 6e61 6d65 0a20    return fname. 
-0008d620: 2020 200a 0a23 2323 2323 2323 2323 2323     ..###########
-0008d630: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d640: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d660: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d670: 2323 2323 2323 230a 2323 2046 756e 6374  #######.## Funct
-0008d680: 696f 6e73 2074 6f20 6861 6e64 6c65 2073  ions to handle s
-0008d690: 696d 756c 6174 6564 2072 6561 6473 2028  imulated reads (
-0008d6a0: 6164 6420 7472 6172 6563 6f20 6865 6164  add trareco head
-0008d6b0: 6572 2c20 7370 6c69 7420 6661 7374 5129  er, split fastQ)
-0008d6c0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
-0008d6d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d6e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d6f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008d710: 2323 230a 0a64 6566 2066 6173 7461 5f61  ###..def fasta_a
-0008d720: 6464 5f74 7261 7265 636f 5f68 6561 6465  dd_trareco_heade
-0008d730: 7228 2072 6566 5f74 722c 2073 696d 5f70  r( ref_tr, sim_p
-0008d740: 726f 6669 6c65 2c20 7265 6164 5f6c 656e  rofile, read_len
-0008d750: 2c20 7375 6666 6978 203d 204e 6f6e 652c  , suffix = None,
-0008d760: 2063 6f76 5f74 6820 3d20 302e 3820 293a   cov_th = 0.8 ):
-0008d770: 0a20 2020 200a 2020 2020 636f 6c6e 616d  .    .    colnam
-0008d780: 6573 203d 205b 276c 6f63 272c 2027 7469  es = ['loc', 'ti
-0008d790: 6427 2c20 2763 6f64 696e 6727 2c20 276c  d', 'coding', 'l
-0008d7a0: 656e 6774 6827 2c20 2765 7870 5f66 7261  ength', 'exp_fra
-0008d7b0: 6327 2c20 2765 7870 5f6e 756d 272c 2027  c', 'exp_num', '
-0008d7c0: 6c69 625f 6672 6163 272c 2027 6c69 625f  lib_frac', 'lib_
-0008d7d0: 6e75 6d27 2c20 5c0a 2020 2020 2020 2020  num', \.        
-0008d7e0: 2020 2020 2020 2020 2773 6571 5f66 7261          'seq_fra
-0008d7f0: 6327 2c20 2773 6571 5f6e 756d 272c 2027  c', 'seq_num', '
-0008d800: 636f 765f 6672 6163 272c 2027 6368 6932  cov_frac', 'chi2
-0008d810: 272c 2027 5663 6f65 6627 5d0a 2020 2020  ', 'Vcoef'].    
-0008d820: 6466 5f70 726f 203d 2070 642e 7265 6164  df_pro = pd.read
-0008d830: 5f63 7376 2873 696d 5f70 726f 6669 6c65  _csv(sim_profile
-0008d840: 2c20 7365 703d 275c 7427 2c20 6865 6164  , sep='\t', head
-0008d850: 6572 203d 204e 6f6e 652c 2069 6e64 6578  er = None, index
-0008d860: 5f63 6f6c 203d 2031 2c20 6e61 6d65 7320  _col = 1, names 
-0008d870: 3d20 636f 6c6e 616d 6573 290a 0a20 2020  = colnames)..   
-0008d880: 2072 6566 203d 206c 6f61 645f 6661 7374   ref = load_fast
-0008d890: 6128 7265 665f 7472 290a 0a20 2020 2064  a(ref_tr)..    d
-0008d8a0: 665f 7072 6f5b 2761 626e 275d 203d 2064  f_pro['abn'] = d
-0008d8b0: 665f 7072 6f5b 2773 6571 5f6e 756d 275d  f_pro['seq_num']
-0008d8c0: 2a72 6561 645f 6c65 6e2f 6466 5f70 726f  *read_len/df_pro
-0008d8d0: 5b27 6c65 6e67 7468 275d 0a20 2020 2064  ['length'].    d
-0008d8e0: 665f 7072 6f5b 2774 706d 275d 203d 2064  f_pro['tpm'] = d
-0008d8f0: 665f 7072 6f5b 2761 626e 275d 2a31 3030  f_pro['abn']*100
-0008d900: 3030 3030 2f28 6466 5f70 726f 5b27 6162  0000/(df_pro['ab
-0008d910: 6e27 5d2e 7375 6d28 2929 0a0a 2020 2020  n'].sum())..    
-0008d920: 6466 5f69 6478 203d 206e 702e 6172 7261  df_idx = np.arra
-0008d930: 7928 6466 5f70 726f 2e69 6e64 6578 2e76  y(df_pro.index.v
-0008d940: 616c 7565 732e 746f 6c69 7374 2829 290a  alues.tolist()).
-0008d950: 2020 2020 636e 745f 6475 7020 3d20 300a      cnt_dup = 0.
-0008d960: 2020 2020 666f 7220 6b65 7920 696e 206c      for key in l
-0008d970: 6973 7428 7265 662e 6b65 7973 2829 293a  ist(ref.keys()):
-0008d980: 0a20 2020 2020 2020 2069 6620 286b 6579  .        if (key
-0008d990: 2069 6e20 6466 5f69 6478 2920 2620 286e   in df_idx) & (n
-0008d9a0: 702e 7375 6d28 6466 5f69 6478 203d 3d20  p.sum(df_idx == 
-0008d9b0: 6b65 7929 203d 3d20 3129 3a0a 2020 2020  key) == 1):.    
-0008d9c0: 2020 2020 2020 2020 6966 2064 665f 7072          if df_pr
-0008d9d0: 6f2e 6c6f 635b 6b65 795d 2e63 6f76 5f66  o.loc[key].cov_f
-0008d9e0: 7261 6320 3e3d 2063 6f76 5f74 683a 0a20  rac >= cov_th:. 
-0008d9f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0008da00: 6566 5b6b 6579 5d2e 6865 6164 6572 203d  ef[key].header =
-0008da10: 2027 2573 2063 6f76 5f66 7261 633a 2566   '%s cov_frac:%f
-0008da20: 2061 626e 3a25 6620 7470 6d3a 2566 2720   abn:%f tpm:%f' 
-0008da30: 2520 2872 6566 5b6b 6579 5d2e 6865 6164  % (ref[key].head
-0008da40: 6572 2c20 6466 5f70 726f 2e6c 6f63 5b6b  er, df_pro.loc[k
-0008da50: 6579 5d2e 636f 765f 6672 6163 2c20 6466  ey].cov_frac, df
-0008da60: 5f70 726f 2e6c 6f63 5b6b 6579 5d2e 6162  _pro.loc[key].ab
-0008da70: 6e2c 2064 665f 7072 6f2e 6c6f 635b 6b65  n, df_pro.loc[ke
-0008da80: 795d 2e74 706d 290a 2020 2020 2020 2020  y].tpm).        
-0008da90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0008daa0: 2020 2020 2020 2020 2020 7265 662e 706f            ref.po
-0008dab0: 7028 6b65 7929 0a20 2020 2020 2020 2065  p(key).        e
-0008dac0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0008dad0: 2069 6620 6466 5f70 726f 2e6c 6f63 5b6b   if df_pro.loc[k
-0008dae0: 6579 5d2e 7368 6170 655b 305d 203e 2031  ey].shape[0] > 1
-0008daf0: 3a20 636e 745f 6475 7020 2b3d 2031 0a20  : cnt_dup += 1. 
-0008db00: 2020 2020 2020 2020 2020 2072 6566 2e70             ref.p
-0008db10: 6f70 286b 6579 290a 0a20 2020 2066 6e61  op(key)..    fna
-0008db20: 6d65 2c20 6578 7420 3d20 6765 745f 6669  me, ext = get_fi
-0008db30: 6c65 5f6e 616d 6528 7265 665f 7472 290a  le_name(ref_tr).
-0008db40: 2020 2020 6966 2073 7566 6669 7820 6973      if suffix is
-0008db50: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
-0008db60: 6e61 6d65 203d 2066 6e61 6d65 202b 2027  name = fname + '
-0008db70: 5f63 6f76 2569 2e27 2025 2069 6e74 2863  _cov%i.' % int(c
-0008db80: 6f76 5f74 682a 3130 3029 202b 2065 7874  ov_th*100) + ext
-0008db90: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-0008dba0: 2020 2066 6e61 6d65 203d 2066 6e61 6d65     fname = fname
-0008dbb0: 202b 2027 5f25 735f 636f 7625 692e 2720   + '_%s_cov%i.' 
-0008dbc0: 2520 2873 7566 6669 782c 2069 6e74 2863  % (suffix, int(c
-0008dbd0: 6f76 5f74 682a 3130 3029 2920 2b20 6578  ov_th*100)) + ex
-0008dbe0: 740a 0a20 2020 2073 6176 655f 6661 7374  t..    save_fast
-0008dbf0: 6128 666e 616d 652c 2072 6566 2c20 7469  a(fname, ref, ti
-0008dc00: 746c 6520 3d20 666e 616d 6529 0a20 2020  tle = fname).   
-0008dc10: 200a 0a64 6566 206c 6f61 645f 6661 7374   ..def load_fast
-0008dc20: 7128 6669 6c65 5f67 656e 6f6d 652c 2076  q(file_genome, v
-0008dc30: 6572 626f 7365 203d 2046 616c 7365 2029  erbose = False )
-0008dc40: 3a0a 0a20 2020 2067 656e 6f6d 6520 3d20  :..    genome = 
-0008dc50: 6469 6374 2829 0a20 2020 2066 203d 206f  dict().    f = o
-0008dc60: 7065 6e28 6669 6c65 5f67 656e 6f6d 652c  pen(file_genome,
-0008dc70: 2027 7227 290a 2020 2020 7363 6e74 203d   'r').    scnt =
-0008dc80: 2030 0a20 2020 2070 7269 6e74 2827 5c72   0.    print('\r
-0008dc90: 4c6f 6164 696e 6720 6661 7374 5120 2e2e  Loading fastQ ..
-0008dca0: 2027 2c20 656e 643d 2727 2c20 666c 7573   ', end='', flus
-0008dcb0: 683d 5472 7565 290a 2020 2020 636e 7420  h=True).    cnt 
-0008dcc0: 3d20 300a 2020 2020 666f 7220 6c69 6e65  = 0.    for line
-0008dcd0: 2069 6e20 6620 3a0a 2020 2020 2020 2020   in f :.        
-0008dce0: 6966 206c 696e 655b 305d 203d 3d20 2740  if line[0] == '@
-0008dcf0: 273a 0a20 2020 2020 2020 2020 2020 2069  ':.            i
-0008dd00: 6620 636e 7420 3d3d 2034 3a0a 2020 2020  f cnt == 4:.    
-0008dd10: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
-0008dd20: 6d65 5b73 636e 745d 203d 2047 656e 6f6d  me[scnt] = Genom
-0008dd30: 6528 6864 722c 2073 6571 2c20 7175 616c  e(hdr, seq, qual
-0008dd40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0008dd50: 2020 7363 6e74 202b 3d20 310a 2020 2020    scnt += 1.    
-0008dd60: 2020 2020 2020 2020 636e 7420 3d20 300a          cnt = 0.
-0008dd70: 2020 2020 2020 2020 2020 2020 6864 7220              hdr 
-0008dd80: 3d20 6c69 6e65 5b31 3a2d 315d 0a20 2020  = line[1:-1].   
-0008dd90: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
-0008dda0: 310a 2020 2020 2020 2020 656c 7365 3a0a  1.        else:.
-0008ddb0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0008ddc0: 6e74 203d 3d20 313a 0a20 2020 2020 2020  nt == 1:.       
-0008ddd0: 2020 2020 2020 2020 2073 6571 203d 206c           seq = l
-0008dde0: 696e 655b 3a2d 315d 0a20 2020 2020 2020  ine[:-1].       
-0008ddf0: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
-0008de00: 310a 2020 2020 2020 2020 2020 2020 656c  1.            el
-0008de10: 6966 2063 6e74 203d 3d20 323a 0a20 2020  if cnt == 2:.   
-0008de20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0008de30: 6c69 6e65 5b30 5d20 3d3d 2027 2b27 3a0a  line[0] == '+':.
-0008de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008de50: 2020 2020 6964 7220 3d20 6c69 6e65 5b31      idr = line[1
-0008de60: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
-0008de70: 2020 2020 2020 2020 2063 6e74 202b 3d20           cnt += 
-0008de80: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-0008de90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0008dea0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0008deb0: 7428 2745 5252 4f52 2069 6e20 6661 7374  t('ERROR in fast
-0008dec0: 5120 6669 6c65 2729 0a20 2020 2020 2020  Q file').       
-0008ded0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0008dee0: 616b 0a20 2020 2020 2020 2020 2020 2065  ak.            e
-0008def0: 6c69 6620 636e 7420 3d3d 2033 3a0a 2020  lif cnt == 3:.  
-0008df00: 2020 2020 2020 2020 2020 2020 2020 7175                qu
-0008df10: 616c 203d 206c 696e 655b 3a2d 315d 0a20  al = line[:-1]. 
-0008df20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0008df30: 6e74 202b 3d20 310a 2020 2020 6966 2063  nt += 1.    if c
-0008df40: 6e74 203e 2030 3a0a 2020 2020 2020 2020  nt > 0:.        
-0008df50: 6765 6e6f 6d65 5b73 636e 745d 203d 2047  genome[scnt] = G
-0008df60: 656e 6f6d 6528 6864 722c 2073 6571 2c20  enome(hdr, seq, 
-0008df70: 7175 616c 290a 2020 2020 2020 2020 7363  qual).        sc
-0008df80: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-0008df90: 2020 2020 2020 2020 0a20 2020 2070 7269          .    pri
-0008dfa0: 6e74 2827 5c72 4c6f 6164 696e 6720 6661  nt('\rLoading fa
-0008dfb0: 7374 5120 2e2e 2064 6f6e 652e 2020 4e75  stQ .. done.  Nu
-0008dfc0: 6d2e 5365 7120 3d20 272c 2073 636e 742c  m.Seq = ', scnt,
-0008dfd0: 2027 2020 2027 2c20 666c 7573 683d 5472   '   ', flush=Tr
-0008dfe0: 7565 290a 2020 2020 662e 636c 6f73 6528  ue).    f.close(
-0008dff0: 290a 2020 2020 7265 7475 726e 2867 656e  ).    return(gen
-0008e000: 6f6d 6529 0a0a 0a64 6566 2073 6176 655f  ome)...def save_
-0008e010: 6661 7374 7128 2066 696c 655f 6765 6e6f  fastq( file_geno
-0008e020: 6d65 2c20 6765 6e6f 6d65 5f64 6963 742c  me, genome_dict,
-0008e030: 2076 6572 626f 7365 203d 2046 616c 7365   verbose = False
-0008e040: 2c20 7469 746c 6520 3d20 2766 6173 7451  , title = 'fastQ
-0008e050: 2720 293a 0a0a 2020 2020 7072 696e 7428  ' ):..    print(
-0008e060: 2753 6176 696e 6720 2573 202e 2e27 2025  'Saving %s ..' %
-0008e070: 2074 6974 6c65 2c20 656e 643d 2727 2c20   title, end='', 
-0008e080: 666c 7573 683d 5472 7565 290a 2020 2020  flush=True).    
-0008e090: 2320 666f 7220 6720 696e 2067 656e 6f6d  # for g in genom
-0008e0a0: 655f 6c73 7420 3a0a 2020 2020 4b65 7973  e_lst :.    Keys
-0008e0b0: 203d 2067 656e 6f6d 655f 6469 6374 2e6b   = genome_dict.k
-0008e0c0: 6579 7328 290a 2020 2020 6620 3d20 6f70  eys().    f = op
-0008e0d0: 656e 2866 696c 655f 6765 6e6f 6d65 2c20  en(file_genome, 
-0008e0e0: 2777 742b 2729 0a20 2020 206c 696e 655f  'wt+').    line_
-0008e0f0: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
-0008e100: 206b 6579 2069 6e20 4b65 7973 3a0a 2020   key in Keys:.  
-0008e110: 2020 2020 2020 2320 7072 696e 7428 275c        # print('\
-0008e120: 7253 6176 696e 6720 2573 202e 2e20 2573  rSaving %s .. %s
-0008e130: 2720 2520 2874 6974 6c65 2c20 6b65 7929  ' % (title, key)
-0008e140: 2c20 656e 643d 2720 2020 2020 2020 2020  , end='         
-0008e150: 2020 2020 2020 2020 2020 2027 290a 2020             ').  
-0008e160: 2020 2020 2020 6720 3d20 6765 6e6f 6d65        g = genome
-0008e170: 5f64 6963 745b 6b65 795d 0a20 2020 2020  _dict[key].     
-0008e180: 2020 2073 203d 2027 4025 735c 6e27 2025     s = '@%s\n' %
-0008e190: 2067 2e68 6561 6465 720a 2020 2020 2020   g.header.      
-0008e1a0: 2020 6c69 6e65 5f6c 7374 2e61 7070 656e    line_lst.appen
-0008e1b0: 6428 7329 0a20 2020 2020 2020 206c 696e  d(s).        lin
-0008e1c0: 655f 6c73 742e 6170 7065 6e64 2867 2e73  e_lst.append(g.s
-0008e1d0: 6571 2e75 7070 6572 2829 202b 2027 5c6e  eq.upper() + '\n
-0008e1e0: 2729 0a20 2020 2020 2020 206c 696e 655f  ').        line_
-0008e1f0: 6c73 742e 6170 7065 6e64 2827 2b5c 6e27  lst.append('+\n'
-0008e200: 290a 2020 2020 2020 2020 6c69 6e65 5f6c  ).        line_l
-0008e210: 7374 2e61 7070 656e 6428 672e 7175 616c  st.append(g.qual
-0008e220: 202b 2027 5c6e 2729 0a20 2020 2020 2020   + '\n').       
-0008e230: 200a 2020 2020 2020 2020 6966 2076 6572   .        if ver
-0008e240: 626f 7365 3a20 7072 696e 7428 272e 272c  bose: print('.',
-0008e250: 2065 6e64 3d27 272c 2066 6c75 7368 3d54   end='', flush=T
-0008e260: 7275 6529 0a0a 2020 2020 662e 7772 6974  rue)..    f.writ
-0008e270: 656c 696e 6573 2827 272e 6a6f 696e 286c  elines(''.join(l
-0008e280: 696e 655f 6c73 7429 290a 2020 2020 2020  ine_lst)).      
-0008e290: 2020 0a20 2020 2070 7269 6e74 2827 5c72    .    print('\r
-0008e2a0: 5361 7669 6e67 2025 7320 2e2e 2064 6f6e  Saving %s .. don
-0008e2b0: 652e 2028 2569 2920 2020 2020 2020 2020  e. (%i)         
-0008e2c0: 2020 2020 2020 2027 2025 2028 7469 746c         ' % (titl
-0008e2d0: 652c 206c 656e 284b 6579 7329 292c 2066  e, len(Keys)), f
-0008e2e0: 6c75 7368 3d54 7275 6529 0a20 2020 2066  lush=True).    f
-0008e2f0: 2e63 6c6f 7365 2829 0a20 2020 200a 0a20  .close().    .. 
-0008e300: 2020 200a 6465 6620 6661 7374 615f 7369     .def fasta_si
-0008e310: 6d5f 7265 6164 5f73 706c 6974 2820 7369  m_read_split( si
-0008e320: 6d5f 7265 6164 2c20 6473 7220 3d20 3120  m_read, dsr = 1 
-0008e330: 293a 0a20 2020 200a 2020 2020 666e 616d  ):.    .    fnam
-0008e340: 652c 2065 7874 203d 2067 6574 5f70 6174  e, ext = get_pat
-0008e350: 685f 6e61 6d65 2873 696d 5f72 6561 6429  h_name(sim_read)
-0008e360: 0a0a 2020 2020 6661 5f61 6c6c 203d 206c  ..    fa_all = l
-0008e370: 6f61 645f 6661 7374 7128 7369 6d5f 7265  oad_fastq(sim_re
-0008e380: 6164 290a 2020 2020 0a20 2020 2066 6131  ad).    .    fa1
-0008e390: 203d 207b 7d0a 2020 2020 6661 3220 3d20   = {}.    fa2 = 
-0008e3a0: 7b7d 0a20 2020 2063 6e74 203d 2030 0a20  {}.    cnt = 0. 
-0008e3b0: 2020 2063 6e74 5f31 203d 2030 0a20 2020     cnt_1 = 0.   
-0008e3c0: 2063 6e74 5f32 203d 2030 0a20 2020 2066   cnt_2 = 0.    f
-0008e3d0: 6f72 206b 6579 2069 6e20 6661 5f61 6c6c  or key in fa_all
-0008e3e0: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-0008e3f0: 2066 615f 616c 6c5b 6b65 795d 2e68 6561   fa_all[key].hea
-0008e400: 6465 7220 3d20 6661 5f61 6c6c 5b6b 6579  der = fa_all[key
-0008e410: 5d2e 6865 6164 6572 5b3a 2d34 5d0a 2020  ].header[:-4].  
-0008e420: 2020 2020 2020 6966 2063 6e74 2532 203d        if cnt%2 =
-0008e430: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0008e440: 2069 6620 636e 745f 3125 6473 7220 3d3d   if cnt_1%dsr ==
-0008e450: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0008e460: 2020 2020 6661 5f61 6c6c 5b6b 6579 5d2e      fa_all[key].
-0008e470: 6865 6164 6572 203d 2066 615f 616c 6c5b  header = fa_all[
-0008e480: 6b65 795d 2e68 6561 6465 722e 7370 6c69  key].header.spli
-0008e490: 7428 2720 2729 5b30 5d20 2b20 272f 3127  t(' ')[0] + '/1'
-0008e4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008e4b0: 2066 6131 5b6b 6579 5d20 3d20 6661 5f61   fa1[key] = fa_a
-0008e4c0: 6c6c 5b6b 6579 5d0a 2020 2020 2020 2020  ll[key].        
-0008e4d0: 2020 2020 636e 745f 3120 2b3d 2031 0a20      cnt_1 += 1. 
-0008e4e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0008e4f0: 2020 2020 2020 2020 2069 6620 636e 745f           if cnt_
-0008e500: 3225 6473 7220 3d3d 2030 3a0a 2020 2020  2%dsr == 0:.    
-0008e510: 2020 2020 2020 2020 2020 2020 6661 5f61              fa_a
-0008e520: 6c6c 5b6b 6579 5d2e 6865 6164 6572 203d  ll[key].header =
-0008e530: 2066 615f 616c 6c5b 6b65 795d 2e68 6561   fa_all[key].hea
-0008e540: 6465 722e 7370 6c69 7428 2720 2729 5b30  der.split(' ')[0
-0008e550: 5d20 2b20 272f 3227 0a20 2020 2020 2020  ] + '/2'.       
-0008e560: 2020 2020 2020 2020 2066 6132 5b6b 6579           fa2[key
-0008e570: 5d20 3d20 6661 5f61 6c6c 5b6b 6579 5d0a  ] = fa_all[key].
-0008e580: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
-0008e590: 3220 2b3d 2031 0a0a 2020 2020 2020 2020  2 += 1..        
-0008e5a0: 636e 7420 2b3d 2031 0a0a 2020 2020 6966  cnt += 1..    if
-0008e5b0: 2064 7372 203d 3d20 313a 0a20 2020 2020   dsr == 1:.     
-0008e5c0: 2020 2066 6e31 203d 2066 6e61 6d65 202b     fn1 = fname +
-0008e5d0: 2027 5f31 2e27 202b 2065 7874 0a20 2020   '_1.' + ext.   
-0008e5e0: 2020 2020 2066 6e32 203d 2066 6e61 6d65       fn2 = fname
-0008e5f0: 202b 2027 5f32 2e27 202b 2065 7874 0a20   + '_2.' + ext. 
-0008e600: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0008e610: 2066 6e31 203d 2066 6e61 6d65 202b 2028   fn1 = fname + (
-0008e620: 275f 6473 2569 2720 2520 6473 7229 202b  '_ds%i' % dsr) +
-0008e630: 2027 5f31 2e27 202b 2065 7874 0a20 2020   '_1.' + ext.   
-0008e640: 2020 2020 2066 6e32 203d 2066 6e61 6d65       fn2 = fname
-0008e650: 202b 2028 275f 6473 2569 2720 2520 6473   + ('_ds%i' % ds
-0008e660: 7229 202b 2027 5f32 2e27 202b 2065 7874  r) + '_2.' + ext
-0008e670: 0a20 2020 2073 6176 655f 6661 7374 7128  .    save_fastq(
-0008e680: 666e 312c 2066 6131 290a 2020 2020 7361  fn1, fa1).    sa
-0008e690: 7665 5f66 6173 7471 2866 6e32 2c20 6661  ve_fastq(fn2, fa
-0008e6a0: 3229 0a20 2020 200a 0a64 6566 2066 6173  2).    ..def fas
-0008e6b0: 7461 5f73 696d 5f72 6561 645f 646f 776e  ta_sim_read_down
-0008e6c0: 7361 6d70 6c65 2820 7369 6d5f 7265 6164  sample( sim_read
-0008e6d0: 2c20 6473 7220 3d20 3120 293a 0a20 2020  , dsr = 1 ):.   
-0008e6e0: 200a 2020 2020 666e 616d 652c 2065 7874   .    fname, ext
-0008e6f0: 203d 2067 6574 5f70 6174 685f 6e61 6d65   = get_path_name
-0008e700: 2873 696d 5f72 6561 6429 0a0a 2020 2020  (sim_read)..    
-0008e710: 6661 5f61 6c6c 203d 206c 6f61 645f 6661  fa_all = load_fa
-0008e720: 7374 7128 7369 6d5f 7265 6164 290a 2020  stq(sim_read).  
-0008e730: 2020 0a20 2020 2066 6120 3d20 7b7d 0a20    .    fa = {}. 
-0008e740: 2020 2063 6e74 203d 2030 0a20 2020 2066     cnt = 0.    f
-0008e750: 6f72 206b 6579 2069 6e20 6661 5f61 6c6c  or key in fa_all
-0008e760: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-0008e770: 2023 2066 615f 616c 6c5b 6b65 795d 2e68   # fa_all[key].h
-0008e780: 6561 6465 7220 3d20 6661 5f61 6c6c 5b6b  eader = fa_all[k
-0008e790: 6579 5d2e 6865 6164 6572 5b3a 2d34 5d0a  ey].header[:-4].
-0008e7a0: 2020 2020 2020 2020 6966 2063 6e74 2564          if cnt%d
-0008e7b0: 7372 203d 3d20 303a 0a20 2020 2020 2020  sr == 0:.       
-0008e7c0: 2020 2020 2023 2066 615f 616c 6c5b 6b65       # fa_all[ke
-0008e7d0: 795d 2e68 6561 6465 7220 3d20 6661 5f61  y].header = fa_a
-0008e7e0: 6c6c 5b6b 6579 5d2e 6865 6164 6572 0a20  ll[key].header. 
-0008e7f0: 2020 2020 2020 2020 2020 2066 615b 6b65             fa[ke
-0008e800: 795d 203d 2066 615f 616c 6c5b 6b65 795d  y] = fa_all[key]
-0008e810: 0a20 2020 2020 2020 2063 6e74 202b 3d20  .        cnt += 
-0008e820: 310a 0a20 2020 2066 6e20 3d20 666e 616d  1..    fn = fnam
-0008e830: 6520 2b20 2827 5f64 7325 692e 2720 2520  e + ('_ds%i.' % 
-0008e840: 6473 7229 202b 2065 7874 0a20 2020 2073  dsr) + ext.    s
-0008e850: 6176 655f 6661 7374 7128 666e 2c20 6661  ave_fastq(fn, fa
-0008e860: 290a 2020 2020 0a20 2020 200a 2323 2323  ).    .    .####
-0008e870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008e880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008e890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008e8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008e8b0: 2323 2323 2323 2323 2323 2323 2323 0a23  ##############.#
-0008e8c0: 2320 4675 6e63 7469 6f6e 7320 746f 2061  # Functions to a
-0008e8d0: 6464 2053 4e56 2069 6e74 6f20 6120 6765  dd SNV into a ge
-0008e8e0: 6e6f 6d65 0a23 2323 2323 2323 2323 2323  nome.###########
+0008cb00: 2020 2020 2063 6e74 5b31 5d20 2b3d 2031       cnt[1] += 1
+0008cb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008cb20: 2020 2020 2069 6620 2863 6e74 5b30 5d20       if (cnt[0] 
+0008cb30: 3e20 3029 2026 2028 636e 745b 315d 203e  > 0) & (cnt[1] >
+0008cb40: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+0008cb50: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+0008cb60: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0008cb70: 2020 2020 2020 2020 2020 2020 2020 6363                cc
+0008cb80: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0008cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cba0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0008cbb0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0008cbc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0008cbd0: 6620 623a 206c 696e 6573 5f6e 6577 203d  f b: lines_new =
+0008cbe0: 206c 696e 6573 5f6e 6577 202b 206c 696e   lines_new + lin
+0008cbf0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0008cc00: 2020 2067 636e 7420 2b3d 2031 0a20 2020     gcnt += 1.   
+0008cc10: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0008cc20: 2020 2020 2020 6966 206c 656e 286c 696e        if len(lin
+0008cc30: 6573 5f6e 6577 2920 3e20 303a 0a20 2020  es_new) > 0:.   
+0008cc40: 2020 2020 2020 2020 2020 2020 2067 7466               gtf
+0008cc50: 5f6c 696e 6573 5f6c 7374 5f6e 6577 2e61  _lines_lst_new.a
+0008cc60: 7070 656e 6428 6c69 6e65 735f 6e65 7729  ppend(lines_new)
+0008cc70: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0008cc80: 2020 2020 2020 6966 206b 2531 3030 203d        if k%100 =
+0008cc90: 3d20 303a 2070 7269 6e74 2827 5c72 7061  = 0: print('\rpa
+0008cca0: 7273 696e 6720 2e2e 2025 692f 2569 2028  rsing .. %i/%i (
+0008ccb0: 2569 2f25 6929 2720 2520 286b 2c20 6c65  %i/%i)' % (k, le
+0008ccc0: 6e28 6774 665f 6c69 6e65 735f 6c73 7429  n(gtf_lines_lst)
+0008ccd0: 2c20 6363 6e74 2c20 6763 6e74 292c 2065  , ccnt, gcnt), e
+0008cce0: 6e64 3d27 272c 2066 6c75 7368 203d 2054  nd='', flush = T
+0008ccf0: 7275 6520 290a 0a20 2020 2070 7269 6e74  rue )..    print
+0008cd00: 2827 5c72 7061 7273 696e 6720 2e2e 2025  ('\rparsing .. %
+0008cd10: 692f 2569 2028 2569 2f25 6929 2720 2520  i/%i (%i/%i)' % 
+0008cd20: 286b 2c20 6c65 6e28 6774 665f 6c69 6e65  (k, len(gtf_line
+0008cd30: 735f 6c73 7429 2c20 6363 6e74 2c20 6763  s_lst), ccnt, gc
+0008cd40: 6e74 292c 2066 6c75 7368 203d 2054 7275  nt), flush = Tru
+0008cd50: 6520 290a 2020 2020 7072 696e 7428 2753  e ).    print('S
+0008cd60: 6f72 7469 6e67 202e 2e20 272c 2065 6e64  orting .. ', end
+0008cd70: 3d27 2729 0a20 2020 2067 7466 5f6c 696e  ='').    gtf_lin
+0008cd80: 6573 5f6c 7374 5f6e 6577 203d 2073 6f72  es_lst_new = sor
+0008cd90: 745f 6774 665f 6c69 6e65 735f 6c73 7428  t_gtf_lines_lst(
+0008cda0: 6774 665f 6c69 6e65 735f 6c73 745f 6e65  gtf_lines_lst_ne
+0008cdb0: 7729 0a20 2020 2070 7269 6e74 2827 5c72  w).    print('\r
+0008cdc0: 536f 7274 696e 6720 2e2e 2064 6f6e 6527  Sorting .. done'
+0008cdd0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+0008cde0: 2020 2067 7466 5f6c 696e 6573 5f6e 6577     gtf_lines_new
+0008cdf0: 203d 205b 5d0a 2020 2020 666f 7220 6c69   = [].    for li
+0008ce00: 6e65 7320 696e 2067 7466 5f6c 696e 6573  nes in gtf_lines
+0008ce10: 5f6c 7374 5f6e 6577 3a0a 2020 2020 2020  _lst_new:.      
+0008ce20: 2020 6774 665f 6c69 6e65 735f 6e65 7720    gtf_lines_new 
+0008ce30: 3d20 6774 665f 6c69 6e65 735f 6e65 7720  = gtf_lines_new 
+0008ce40: 2b20 6c69 6e65 730a 2020 2020 2020 2020  + lines.        
+0008ce50: 0a20 2020 2066 6e61 6d65 203d 2066 6e61  .    fname = fna
+0008ce60: 6d65 202b 2027 5f63 6473 2e67 7466 270a  me + '_cds.gtf'.
+0008ce70: 2020 2020 7072 696e 7428 2753 6176 696e      print('Savin
+0008ce80: 6720 2e2e 2027 2c20 656e 643d 2727 290a  g .. ', end='').
+0008ce90: 2020 2020 7361 7665 5f67 7466 2820 666e      save_gtf( fn
+0008cea0: 616d 652c 2067 7466 5f6c 696e 6573 5f6e  ame, gtf_lines_n
+0008ceb0: 6577 2c20 6864 725f 6c69 6e65 7320 290a  ew, hdr_lines ).
+0008cec0: 2020 2020 7072 696e 7428 275c 7253 6176      print('\rSav
+0008ced0: 696e 6720 2e2e 2064 6f6e 6527 290a 2020  ing .. done').  
+0008cee0: 2020 0a20 2020 2072 6574 7572 6e20 666e    .    return fn
+0008cef0: 616d 650a 2020 2020 0a0a 6465 6620 7365  ame.    ..def se
+0008cf00: 6c65 6374 5f63 6872 5f66 726f 6d5f 6774  lect_chr_from_gt
+0008cf10: 665f 6669 6c65 2867 7466 5f66 696c 652c  f_file(gtf_file,
+0008cf20: 2063 6872 6d73 203d 205b 5d29 3a0a 0a20   chrms = []):.. 
+0008cf30: 2020 2066 6e73 203d 2067 7466 5f66 696c     fns = gtf_fil
+0008cf40: 652e 7370 6c69 7428 272e 2729 5b3a 2d31  e.split('.')[:-1
+0008cf50: 5d0a 2020 2020 666e 616d 6520 3d20 2727  ].    fname = ''
+0008cf60: 0a20 2020 2066 6f72 206b 2c20 666e 2069  .    for k, fn i
+0008cf70: 6e20 656e 756d 6572 6174 6528 666e 7329  n enumerate(fns)
+0008cf80: 3a0a 2020 2020 2020 2020 6966 206b 203e  :.        if k >
+0008cf90: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0008cfa0: 666e 616d 6520 3d20 666e 616d 6520 2b20  fname = fname + 
+0008cfb0: 272e 270a 2020 2020 2020 2020 666e 616d  '.'.        fnam
+0008cfc0: 6520 3d20 666e 616d 6520 2b20 666e 0a20  e = fname + fn. 
+0008cfd0: 2020 200a 2020 2020 6774 665f 6c69 6e65     .    gtf_line
+0008cfe0: 732c 2068 6472 5f6c 696e 6573 203d 206c  s, hdr_lines = l
+0008cff0: 6f61 645f 6774 6628 6774 665f 6669 6c65  oad_gtf(gtf_file
+0008d000: 2c20 7665 7262 6f73 6520 3d20 5472 7565  , verbose = True
+0008d010: 290a 2020 2020 0a20 2020 2067 7466 5f6c  ).    .    gtf_l
+0008d020: 696e 6573 5f6c 7374 203d 2070 6172 7365  ines_lst = parse
+0008d030: 5f67 7466 5f6c 696e 6573 5f61 6e64 5f73  _gtf_lines_and_s
+0008d040: 706c 6974 5f69 6e74 6f5f 6765 6e65 7328  plit_into_genes(
+0008d050: 2067 7466 5f6c 696e 6573 2029 0a0a 2020   gtf_lines )..  
+0008d060: 2020 6774 665f 6c69 6e65 735f 6c73 745f    gtf_lines_lst_
+0008d070: 6e65 7720 3d20 5b5d 0a20 2020 2063 636e  new = [].    ccn
+0008d080: 7420 3d20 300a 2020 2020 6763 6e74 203d  t = 0.    gcnt =
+0008d090: 2030 0a20 2020 2069 6620 6973 696e 7374   0.    if isinst
+0008d0a0: 616e 6365 2863 6872 6d73 2c20 7374 7229  ance(chrms, str)
+0008d0b0: 3a0a 2020 2020 2020 2020 666f 7220 6b2c  :.        for k,
+0008d0c0: 206c 696e 6573 2069 6e20 656e 756d 6572   lines in enumer
+0008d0d0: 6174 6528 6774 665f 6c69 6e65 735f 6c73  ate(gtf_lines_ls
+0008d0e0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0008d0f0: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
+0008d100: 2020 2020 2020 6966 206c 696e 6573 5b30        if lines[0
+0008d110: 5d2e 6368 7220 3d3d 2063 6872 6d3a 200a  ].chr == chrm: .
+0008d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d130: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
+0008d140: 2020 2020 2020 2020 2063 636e 7420 2b3d           ccnt +=
+0008d150: 2031 0a20 2020 2020 2020 2020 2020 2067   1.            g
+0008d160: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
+0008d170: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0008d180: 2020 6966 206b 2531 3030 203d 3d20 303a    if k%100 == 0:
+0008d190: 2070 7269 6e74 2827 5c72 7061 7273 696e   print('\rparsin
+0008d1a0: 6720 2e2e 2025 692f 2569 2028 2569 2f25  g .. %i/%i (%i/%
+0008d1b0: 6929 2720 2520 286b 2c20 6c65 6e28 6774  i)' % (k, len(gt
+0008d1c0: 665f 6c69 6e65 735f 6c73 7429 2c20 6363  f_lines_lst), cc
+0008d1d0: 6e74 2c20 6763 6e74 292c 2065 6e64 3d27  nt, gcnt), end='
+0008d1e0: 272c 2066 6c75 7368 203d 2054 7275 6520  ', flush = True 
+0008d1f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0008d200: 2062 3a20 0a20 2020 2020 2020 2020 2020   b: .           
+0008d210: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
+0008d220: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
+0008d230: 6e65 7329 0a20 2020 2065 6c73 653a 0a20  nes).    else:. 
+0008d240: 2020 2020 2020 2066 6f72 2063 6872 6d20         for chrm 
+0008d250: 696e 2063 6872 6d73 3a0a 2020 2020 2020  in chrms:.      
+0008d260: 2020 2020 2020 666f 7220 6b2c 206c 696e        for k, lin
+0008d270: 6573 2069 6e20 656e 756d 6572 6174 6528  es in enumerate(
+0008d280: 6774 665f 6c69 6e65 735f 6c73 7429 3a0a  gtf_lines_lst):.
+0008d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d2a0: 6220 3d20 4661 6c73 650a 2020 2020 2020  b = False.      
+0008d2b0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
+0008d2c0: 6573 5b30 5d2e 6368 7220 3d3d 2063 6872  es[0].chr == chr
+0008d2d0: 6d3a 200a 2020 2020 2020 2020 2020 2020  m: .            
+0008d2e0: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
+0008d2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d300: 2020 2020 2063 636e 7420 2b3d 2031 0a20       ccnt += 1. 
+0008d310: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0008d320: 636e 7420 2b3d 2031 0a20 2020 2020 2020  cnt += 1.       
+0008d330: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0008d340: 2020 2020 2020 2020 2020 6966 206b 2531            if k%1
+0008d350: 3030 203d 3d20 303a 2070 7269 6e74 2827  00 == 0: print('
+0008d360: 5c72 7061 7273 696e 6720 2e2e 2025 692f  \rparsing .. %i/
+0008d370: 2569 2028 2569 2f25 6929 2720 2520 286b  %i (%i/%i)' % (k
+0008d380: 2c20 6c65 6e28 6774 665f 6c69 6e65 735f  , len(gtf_lines_
+0008d390: 6c73 7429 2c20 6363 6e74 2c20 6763 6e74  lst), ccnt, gcnt
+0008d3a0: 292c 2065 6e64 3d27 272c 2066 6c75 7368  ), end='', flush
+0008d3b0: 203d 2054 7275 6520 290a 2020 2020 2020   = True ).      
+0008d3c0: 2020 2020 2020 2020 2020 6966 2062 3a20            if b: 
+0008d3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d3e0: 2020 2020 2067 7466 5f6c 696e 6573 5f6c       gtf_lines_l
+0008d3f0: 7374 5f6e 6577 2e61 7070 656e 6428 6c69  st_new.append(li
+0008d400: 6e65 7329 0a20 2020 2020 2020 2063 6872  nes).        chr
+0008d410: 6d20 3d20 6368 726d 735b 305d 0a20 2020  m = chrms[0].   
+0008d420: 2020 2020 2066 6f72 2063 2069 6e20 6368       for c in ch
+0008d430: 726d 735b 313a 5d3a 0a20 2020 2020 2020  rms[1:]:.       
+0008d440: 2020 2020 2063 6872 6d20 3d20 6368 726d       chrm = chrm
+0008d450: 202b 2027 2c25 7327 2025 2063 0a20 2020   + ',%s' % c.   
+0008d460: 2020 2020 2020 2020 200a 2020 2020 7072           .    pr
+0008d470: 696e 7428 275c 7270 6172 7369 6e67 202e  int('\rparsing .
+0008d480: 2e20 646f 6e65 2025 692f 2569 2028 2569  . done %i/%i (%i
+0008d490: 2f25 6929 2720 2520 286b 2c20 6c65 6e28  /%i)' % (k, len(
+0008d4a0: 6774 665f 6c69 6e65 735f 6c73 7429 2c20  gtf_lines_lst), 
+0008d4b0: 6363 6e74 2c20 6763 6e74 292c 2066 6c75  ccnt, gcnt), flu
+0008d4c0: 7368 203d 2054 7275 6520 290a 2020 2020  sh = True ).    
+0008d4d0: 0a20 2020 2070 7269 6e74 2827 536f 7274  .    print('Sort
+0008d4e0: 696e 6720 2e2e 2027 2c20 656e 643d 2727  ing .. ', end=''
+0008d4f0: 290a 2020 2020 6774 665f 6c69 6e65 735f  ).    gtf_lines_
+0008d500: 6c73 745f 6e65 7720 3d20 736f 7274 5f67  lst_new = sort_g
+0008d510: 7466 5f6c 696e 6573 5f6c 7374 2867 7466  tf_lines_lst(gtf
+0008d520: 5f6c 696e 6573 5f6c 7374 5f6e 6577 290a  _lines_lst_new).
+0008d530: 2020 2020 7072 696e 7428 275c 7253 6f72      print('\rSor
+0008d540: 7469 6e67 202e 2e20 646f 6e65 2729 0a20  ting .. done'). 
+0008d550: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0008d560: 6774 665f 6c69 6e65 735f 6e65 7720 3d20  gtf_lines_new = 
+0008d570: 5b5d 0a20 2020 2066 6f72 206c 696e 6573  [].    for lines
+0008d580: 2069 6e20 6774 665f 6c69 6e65 735f 6c73   in gtf_lines_ls
+0008d590: 745f 6e65 773a 0a20 2020 2020 2020 2067  t_new:.        g
+0008d5a0: 7466 5f6c 696e 6573 5f6e 6577 203d 2067  tf_lines_new = g
+0008d5b0: 7466 5f6c 696e 6573 5f6e 6577 202b 206c  tf_lines_new + l
+0008d5c0: 696e 6573 0a20 2020 200a 2020 2020 7072  ines.    .    pr
+0008d5d0: 696e 7428 2753 6176 696e 6720 2e2e 2027  int('Saving .. '
+0008d5e0: 2c20 656e 643d 2727 290a 2020 2020 666e  , end='').    fn
+0008d5f0: 616d 6520 3d20 666e 616d 6520 2b20 275f  ame = fname + '_
+0008d600: 7365 6c5f 2573 2e67 7466 2720 2520 6368  sel_%s.gtf' % ch
+0008d610: 726d 0a20 2020 2073 6176 655f 6774 6628  rm.    save_gtf(
+0008d620: 2066 6e61 6d65 2c20 6774 665f 6c69 6e65   fname, gtf_line
+0008d630: 735f 6e65 772c 2068 6472 5f6c 696e 6573  s_new, hdr_lines
+0008d640: 2029 0a20 2020 2070 7269 6e74 2827 5c72   ).    print('\r
+0008d650: 5361 7669 6e67 202e 2e20 646f 6e65 2729  Saving .. done')
+0008d660: 0a20 2020 200a 2020 2020 7265 7475 726e  .    .    return
+0008d670: 2066 6e61 6d65 0a20 2020 200a 0a23 2323   fname.    ..###
+0008d680: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d6a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d6b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d6c0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0008d6d0: 2323 2046 756e 6374 696f 6e73 2074 6f20  ## Functions to 
+0008d6e0: 6861 6e64 6c65 2073 696d 756c 6174 6564  handle simulated
+0008d6f0: 2072 6561 6473 2028 6164 6420 7472 6172   reads (add trar
+0008d700: 6563 6f20 6865 6164 6572 2c20 7370 6c69  eco header, spli
+0008d710: 7420 6661 7374 5129 0a23 2323 2323 2323  t fastQ).#######
+0008d720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d730: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008d760: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
+0008d770: 2066 6173 7461 5f61 6464 5f74 7261 7265   fasta_add_trare
+0008d780: 636f 5f68 6561 6465 7228 2072 6566 5f74  co_header( ref_t
+0008d790: 722c 2073 696d 5f70 726f 6669 6c65 2c20  r, sim_profile, 
+0008d7a0: 7265 6164 5f6c 656e 2c20 7375 6666 6978  read_len, suffix
+0008d7b0: 203d 204e 6f6e 652c 2063 6f76 5f74 6820   = None, cov_th 
+0008d7c0: 3d20 302e 3820 293a 0a20 2020 200a 2020  = 0.8 ):.    .  
+0008d7d0: 2020 636f 6c6e 616d 6573 203d 205b 276c    colnames = ['l
+0008d7e0: 6f63 272c 2027 7469 6427 2c20 2763 6f64  oc', 'tid', 'cod
+0008d7f0: 696e 6727 2c20 276c 656e 6774 6827 2c20  ing', 'length', 
+0008d800: 2765 7870 5f66 7261 6327 2c20 2765 7870  'exp_frac', 'exp
+0008d810: 5f6e 756d 272c 2027 6c69 625f 6672 6163  _num', 'lib_frac
+0008d820: 272c 2027 6c69 625f 6e75 6d27 2c20 5c0a  ', 'lib_num', \.
+0008d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d840: 2773 6571 5f66 7261 6327 2c20 2773 6571  'seq_frac', 'seq
+0008d850: 5f6e 756d 272c 2027 636f 765f 6672 6163  _num', 'cov_frac
+0008d860: 272c 2027 6368 6932 272c 2027 5663 6f65  ', 'chi2', 'Vcoe
+0008d870: 6627 5d0a 2020 2020 6466 5f70 726f 203d  f'].    df_pro =
+0008d880: 2070 642e 7265 6164 5f63 7376 2873 696d   pd.read_csv(sim
+0008d890: 5f70 726f 6669 6c65 2c20 7365 703d 275c  _profile, sep='\
+0008d8a0: 7427 2c20 6865 6164 6572 203d 204e 6f6e  t', header = Non
+0008d8b0: 652c 2069 6e64 6578 5f63 6f6c 203d 2031  e, index_col = 1
+0008d8c0: 2c20 6e61 6d65 7320 3d20 636f 6c6e 616d  , names = colnam
+0008d8d0: 6573 290a 0a20 2020 2072 6566 203d 206c  es)..    ref = l
+0008d8e0: 6f61 645f 6661 7374 6128 7265 665f 7472  oad_fasta(ref_tr
+0008d8f0: 290a 0a20 2020 2064 665f 7072 6f5b 2761  )..    df_pro['a
+0008d900: 626e 275d 203d 2064 665f 7072 6f5b 2773  bn'] = df_pro['s
+0008d910: 6571 5f6e 756d 275d 2a72 6561 645f 6c65  eq_num']*read_le
+0008d920: 6e2f 6466 5f70 726f 5b27 6c65 6e67 7468  n/df_pro['length
+0008d930: 275d 0a20 2020 2064 665f 7072 6f5b 2774  '].    df_pro['t
+0008d940: 706d 275d 203d 2064 665f 7072 6f5b 2761  pm'] = df_pro['a
+0008d950: 626e 275d 2a31 3030 3030 3030 2f28 6466  bn']*1000000/(df
+0008d960: 5f70 726f 5b27 6162 6e27 5d2e 7375 6d28  _pro['abn'].sum(
+0008d970: 2929 0a0a 2020 2020 6466 5f69 6478 203d  ))..    df_idx =
+0008d980: 206e 702e 6172 7261 7928 6466 5f70 726f   np.array(df_pro
+0008d990: 2e69 6e64 6578 2e76 616c 7565 732e 746f  .index.values.to
+0008d9a0: 6c69 7374 2829 290a 2020 2020 636e 745f  list()).    cnt_
+0008d9b0: 6475 7020 3d20 300a 2020 2020 666f 7220  dup = 0.    for 
+0008d9c0: 6b65 7920 696e 206c 6973 7428 7265 662e  key in list(ref.
+0008d9d0: 6b65 7973 2829 293a 0a20 2020 2020 2020  keys()):.       
+0008d9e0: 2069 6620 286b 6579 2069 6e20 6466 5f69   if (key in df_i
+0008d9f0: 6478 2920 2620 286e 702e 7375 6d28 6466  dx) & (np.sum(df
+0008da00: 5f69 6478 203d 3d20 6b65 7929 203d 3d20  _idx == key) == 
+0008da10: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
+0008da20: 6966 2064 665f 7072 6f2e 6c6f 635b 6b65  if df_pro.loc[ke
+0008da30: 795d 2e63 6f76 5f66 7261 6320 3e3d 2063  y].cov_frac >= c
+0008da40: 6f76 5f74 683a 0a20 2020 2020 2020 2020  ov_th:.         
+0008da50: 2020 2020 2020 2072 6566 5b6b 6579 5d2e         ref[key].
+0008da60: 6865 6164 6572 203d 2027 2573 2063 6f76  header = '%s cov
+0008da70: 5f66 7261 633a 2566 2061 626e 3a25 6620  _frac:%f abn:%f 
+0008da80: 7470 6d3a 2566 2720 2520 2872 6566 5b6b  tpm:%f' % (ref[k
+0008da90: 6579 5d2e 6865 6164 6572 2c20 6466 5f70  ey].header, df_p
+0008daa0: 726f 2e6c 6f63 5b6b 6579 5d2e 636f 765f  ro.loc[key].cov_
+0008dab0: 6672 6163 2c20 6466 5f70 726f 2e6c 6f63  frac, df_pro.loc
+0008dac0: 5b6b 6579 5d2e 6162 6e2c 2064 665f 7072  [key].abn, df_pr
+0008dad0: 6f2e 6c6f 635b 6b65 795d 2e74 706d 290a  o.loc[key].tpm).
+0008dae0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0008daf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0008db00: 2020 7265 662e 706f 7028 6b65 7929 0a20    ref.pop(key). 
+0008db10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0008db20: 2020 2020 2020 2020 2069 6620 6466 5f70           if df_p
+0008db30: 726f 2e6c 6f63 5b6b 6579 5d2e 7368 6170  ro.loc[key].shap
+0008db40: 655b 305d 203e 2031 3a20 636e 745f 6475  e[0] > 1: cnt_du
+0008db50: 7020 2b3d 2031 0a20 2020 2020 2020 2020  p += 1.         
+0008db60: 2020 2072 6566 2e70 6f70 286b 6579 290a     ref.pop(key).
+0008db70: 0a20 2020 2066 6e61 6d65 2c20 6578 7420  .    fname, ext 
+0008db80: 3d20 6765 745f 6669 6c65 5f6e 616d 6528  = get_file_name(
+0008db90: 7265 665f 7472 290a 2020 2020 6966 2073  ref_tr).    if s
+0008dba0: 7566 6669 7820 6973 204e 6f6e 653a 0a20  uffix is None:. 
+0008dbb0: 2020 2020 2020 2066 6e61 6d65 203d 2066         fname = f
+0008dbc0: 6e61 6d65 202b 2027 5f63 6f76 2569 2e27  name + '_cov%i.'
+0008dbd0: 2025 2069 6e74 2863 6f76 5f74 682a 3130   % int(cov_th*10
+0008dbe0: 3029 202b 2065 7874 0a20 2020 2065 6c73  0) + ext.    els
+0008dbf0: 653a 0a20 2020 2020 2020 2066 6e61 6d65  e:.        fname
+0008dc00: 203d 2066 6e61 6d65 202b 2027 5f25 735f   = fname + '_%s_
+0008dc10: 636f 7625 692e 2720 2520 2873 7566 6669  cov%i.' % (suffi
+0008dc20: 782c 2069 6e74 2863 6f76 5f74 682a 3130  x, int(cov_th*10
+0008dc30: 3029 2920 2b20 6578 740a 0a20 2020 2073  0)) + ext..    s
+0008dc40: 6176 655f 6661 7374 6128 666e 616d 652c  ave_fasta(fname,
+0008dc50: 2072 6566 2c20 7469 746c 6520 3d20 666e   ref, title = fn
+0008dc60: 616d 6529 0a20 2020 200a 0a64 6566 206c  ame).    ..def l
+0008dc70: 6f61 645f 6661 7374 7128 6669 6c65 5f67  oad_fastq(file_g
+0008dc80: 656e 6f6d 652c 2076 6572 626f 7365 203d  enome, verbose =
+0008dc90: 2046 616c 7365 2029 3a0a 0a20 2020 2067   False ):..    g
+0008dca0: 656e 6f6d 6520 3d20 6469 6374 2829 0a20  enome = dict(). 
+0008dcb0: 2020 2066 203d 206f 7065 6e28 6669 6c65     f = open(file
+0008dcc0: 5f67 656e 6f6d 652c 2027 7227 290a 2020  _genome, 'r').  
+0008dcd0: 2020 7363 6e74 203d 2030 0a20 2020 2070    scnt = 0.    p
+0008dce0: 7269 6e74 2827 5c72 4c6f 6164 696e 6720  rint('\rLoading 
+0008dcf0: 6661 7374 5120 2e2e 2027 2c20 656e 643d  fastQ .. ', end=
+0008dd00: 2727 2c20 666c 7573 683d 5472 7565 290a  '', flush=True).
+0008dd10: 2020 2020 636e 7420 3d20 300a 2020 2020      cnt = 0.    
+0008dd20: 666f 7220 6c69 6e65 2069 6e20 6620 3a0a  for line in f :.
+0008dd30: 2020 2020 2020 2020 6966 206c 696e 655b          if line[
+0008dd40: 305d 203d 3d20 2740 273a 0a20 2020 2020  0] == '@':.     
+0008dd50: 2020 2020 2020 2069 6620 636e 7420 3d3d         if cnt ==
+0008dd60: 2034 3a0a 2020 2020 2020 2020 2020 2020   4:.            
+0008dd70: 2020 2020 6765 6e6f 6d65 5b73 636e 745d      genome[scnt]
+0008dd80: 203d 2047 656e 6f6d 6528 6864 722c 2073   = Genome(hdr, s
+0008dd90: 6571 2c20 7175 616c 290a 2020 2020 2020  eq, qual).      
+0008dda0: 2020 2020 2020 2020 2020 7363 6e74 202b            scnt +
+0008ddb0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0008ddc0: 636e 7420 3d20 300a 2020 2020 2020 2020  cnt = 0.        
+0008ddd0: 2020 2020 6864 7220 3d20 6c69 6e65 5b31      hdr = line[1
+0008dde0: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
+0008ddf0: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
+0008de00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0008de10: 2020 2020 6966 2063 6e74 203d 3d20 313a      if cnt == 1:
+0008de20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008de30: 2073 6571 203d 206c 696e 655b 3a2d 315d   seq = line[:-1]
+0008de40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008de50: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
+0008de60: 2020 2020 2020 656c 6966 2063 6e74 203d        elif cnt =
+0008de70: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+0008de80: 2020 2020 2069 6620 6c69 6e65 5b30 5d20       if line[0] 
+0008de90: 3d3d 2027 2b27 3a0a 2020 2020 2020 2020  == '+':.        
+0008dea0: 2020 2020 2020 2020 2020 2020 6964 7220              idr 
+0008deb0: 3d20 6c69 6e65 5b31 3a2d 315d 0a20 2020  = line[1:-1].   
+0008dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008ded0: 2063 6e74 202b 3d20 310a 2020 2020 2020   cnt += 1.      
+0008dee0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0008def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008df00: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
+0008df10: 2069 6e20 6661 7374 5120 6669 6c65 2729   in fastQ file')
+0008df20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008df30: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+0008df40: 2020 2020 2020 2065 6c69 6620 636e 7420         elif cnt 
+0008df50: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
+0008df60: 2020 2020 2020 7175 616c 203d 206c 696e        qual = lin
+0008df70: 655b 3a2d 315d 0a20 2020 2020 2020 2020  e[:-1].         
+0008df80: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
+0008df90: 2020 2020 6966 2063 6e74 203e 2030 3a0a      if cnt > 0:.
+0008dfa0: 2020 2020 2020 2020 6765 6e6f 6d65 5b73          genome[s
+0008dfb0: 636e 745d 203d 2047 656e 6f6d 6528 6864  cnt] = Genome(hd
+0008dfc0: 722c 2073 6571 2c20 7175 616c 290a 2020  r, seq, qual).  
+0008dfd0: 2020 2020 2020 7363 6e74 202b 3d20 310a        scnt += 1.
+0008dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008dff0: 0a20 2020 2070 7269 6e74 2827 5c72 4c6f  .    print('\rLo
+0008e000: 6164 696e 6720 6661 7374 5120 2e2e 2064  ading fastQ .. d
+0008e010: 6f6e 652e 2020 4e75 6d2e 5365 7120 3d20  one.  Num.Seq = 
+0008e020: 272c 2073 636e 742c 2027 2020 2027 2c20  ', scnt, '   ', 
+0008e030: 666c 7573 683d 5472 7565 290a 2020 2020  flush=True).    
+0008e040: 662e 636c 6f73 6528 290a 2020 2020 7265  f.close().    re
+0008e050: 7475 726e 2867 656e 6f6d 6529 0a0a 0a64  turn(genome)...d
+0008e060: 6566 2073 6176 655f 6661 7374 7128 2066  ef save_fastq( f
+0008e070: 696c 655f 6765 6e6f 6d65 2c20 6765 6e6f  ile_genome, geno
+0008e080: 6d65 5f64 6963 742c 2076 6572 626f 7365  me_dict, verbose
+0008e090: 203d 2046 616c 7365 2c20 7469 746c 6520   = False, title 
+0008e0a0: 3d20 2766 6173 7451 2720 293a 0a0a 2020  = 'fastQ' ):..  
+0008e0b0: 2020 7072 696e 7428 2753 6176 696e 6720    print('Saving 
+0008e0c0: 2573 202e 2e27 2025 2074 6974 6c65 2c20  %s ..' % title, 
+0008e0d0: 656e 643d 2727 2c20 666c 7573 683d 5472  end='', flush=Tr
+0008e0e0: 7565 290a 2020 2020 2320 666f 7220 6720  ue).    # for g 
+0008e0f0: 696e 2067 656e 6f6d 655f 6c73 7420 3a0a  in genome_lst :.
+0008e100: 2020 2020 4b65 7973 203d 2067 656e 6f6d      Keys = genom
+0008e110: 655f 6469 6374 2e6b 6579 7328 290a 2020  e_dict.keys().  
+0008e120: 2020 6620 3d20 6f70 656e 2866 696c 655f    f = open(file_
+0008e130: 6765 6e6f 6d65 2c20 2777 742b 2729 0a20  genome, 'wt+'). 
+0008e140: 2020 206c 696e 655f 6c73 7420 3d20 5b5d     line_lst = []
+0008e150: 0a20 2020 2066 6f72 206b 6579 2069 6e20  .    for key in 
+0008e160: 4b65 7973 3a0a 2020 2020 2020 2020 2320  Keys:.        # 
+0008e170: 7072 696e 7428 275c 7253 6176 696e 6720  print('\rSaving 
+0008e180: 2573 202e 2e20 2573 2720 2520 2874 6974  %s .. %s' % (tit
+0008e190: 6c65 2c20 6b65 7929 2c20 656e 643d 2720  le, key), end=' 
+0008e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008e1b0: 2020 2027 290a 2020 2020 2020 2020 6720     ').        g 
+0008e1c0: 3d20 6765 6e6f 6d65 5f64 6963 745b 6b65  = genome_dict[ke
+0008e1d0: 795d 0a20 2020 2020 2020 2073 203d 2027  y].        s = '
+0008e1e0: 4025 735c 6e27 2025 2067 2e68 6561 6465  @%s\n' % g.heade
+0008e1f0: 720a 2020 2020 2020 2020 6c69 6e65 5f6c  r.        line_l
+0008e200: 7374 2e61 7070 656e 6428 7329 0a20 2020  st.append(s).   
+0008e210: 2020 2020 206c 696e 655f 6c73 742e 6170       line_lst.ap
+0008e220: 7065 6e64 2867 2e73 6571 2e75 7070 6572  pend(g.seq.upper
+0008e230: 2829 202b 2027 5c6e 2729 0a20 2020 2020  () + '\n').     
+0008e240: 2020 206c 696e 655f 6c73 742e 6170 7065     line_lst.appe
+0008e250: 6e64 2827 2b5c 6e27 290a 2020 2020 2020  nd('+\n').      
+0008e260: 2020 6c69 6e65 5f6c 7374 2e61 7070 656e    line_lst.appen
+0008e270: 6428 672e 7175 616c 202b 2027 5c6e 2729  d(g.qual + '\n')
+0008e280: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0008e290: 2020 6966 2076 6572 626f 7365 3a20 7072    if verbose: pr
+0008e2a0: 696e 7428 272e 272c 2065 6e64 3d27 272c  int('.', end='',
+0008e2b0: 2066 6c75 7368 3d54 7275 6529 0a0a 2020   flush=True)..  
+0008e2c0: 2020 662e 7772 6974 656c 696e 6573 2827    f.writelines('
+0008e2d0: 272e 6a6f 696e 286c 696e 655f 6c73 7429  '.join(line_lst)
+0008e2e0: 290a 2020 2020 2020 2020 0a20 2020 2070  ).        .    p
+0008e2f0: 7269 6e74 2827 5c72 5361 7669 6e67 2025  rint('\rSaving %
+0008e300: 7320 2e2e 2064 6f6e 652e 2028 2569 2920  s .. done. (%i) 
+0008e310: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0008e320: 2025 2028 7469 746c 652c 206c 656e 284b   % (title, len(K
+0008e330: 6579 7329 292c 2066 6c75 7368 3d54 7275  eys)), flush=Tru
+0008e340: 6529 0a20 2020 2066 2e63 6c6f 7365 2829  e).    f.close()
+0008e350: 0a20 2020 200a 0a20 2020 200a 6465 6620  .    ..    .def 
+0008e360: 6661 7374 615f 7369 6d5f 7265 6164 5f73  fasta_sim_read_s
+0008e370: 706c 6974 2820 7369 6d5f 7265 6164 2c20  plit( sim_read, 
+0008e380: 6473 7220 3d20 3120 293a 0a20 2020 200a  dsr = 1 ):.    .
+0008e390: 2020 2020 666e 616d 652c 2065 7874 203d      fname, ext =
+0008e3a0: 2067 6574 5f70 6174 685f 6e61 6d65 2873   get_path_name(s
+0008e3b0: 696d 5f72 6561 6429 0a0a 2020 2020 6661  im_read)..    fa
+0008e3c0: 5f61 6c6c 203d 206c 6f61 645f 6661 7374  _all = load_fast
+0008e3d0: 7128 7369 6d5f 7265 6164 290a 2020 2020  q(sim_read).    
+0008e3e0: 0a20 2020 2066 6131 203d 207b 7d0a 2020  .    fa1 = {}.  
+0008e3f0: 2020 6661 3220 3d20 7b7d 0a20 2020 2063    fa2 = {}.    c
+0008e400: 6e74 203d 2030 0a20 2020 2063 6e74 5f31  nt = 0.    cnt_1
+0008e410: 203d 2030 0a20 2020 2063 6e74 5f32 203d   = 0.    cnt_2 =
+0008e420: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
+0008e430: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
+0008e440: 0a20 2020 2020 2020 2066 615f 616c 6c5b  .        fa_all[
+0008e450: 6b65 795d 2e68 6561 6465 7220 3d20 6661  key].header = fa
+0008e460: 5f61 6c6c 5b6b 6579 5d2e 6865 6164 6572  _all[key].header
+0008e470: 5b3a 2d34 5d0a 2020 2020 2020 2020 6966  [:-4].        if
+0008e480: 2063 6e74 2532 203d 3d20 303a 0a20 2020   cnt%2 == 0:.   
+0008e490: 2020 2020 2020 2020 2069 6620 636e 745f           if cnt_
+0008e4a0: 3125 6473 7220 3d3d 2030 3a0a 2020 2020  1%dsr == 0:.    
+0008e4b0: 2020 2020 2020 2020 2020 2020 6661 5f61              fa_a
+0008e4c0: 6c6c 5b6b 6579 5d2e 6865 6164 6572 203d  ll[key].header =
+0008e4d0: 2066 615f 616c 6c5b 6b65 795d 2e68 6561   fa_all[key].hea
+0008e4e0: 6465 722e 7370 6c69 7428 2720 2729 5b30  der.split(' ')[0
+0008e4f0: 5d20 2b20 272f 3127 0a20 2020 2020 2020  ] + '/1'.       
+0008e500: 2020 2020 2020 2020 2066 6131 5b6b 6579           fa1[key
+0008e510: 5d20 3d20 6661 5f61 6c6c 5b6b 6579 5d0a  ] = fa_all[key].
+0008e520: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+0008e530: 3120 2b3d 2031 0a20 2020 2020 2020 2065  1 += 1.        e
+0008e540: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0008e550: 2069 6620 636e 745f 3225 6473 7220 3d3d   if cnt_2%dsr ==
+0008e560: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0008e570: 2020 2020 6661 5f61 6c6c 5b6b 6579 5d2e      fa_all[key].
+0008e580: 6865 6164 6572 203d 2066 615f 616c 6c5b  header = fa_all[
+0008e590: 6b65 795d 2e68 6561 6465 722e 7370 6c69  key].header.spli
+0008e5a0: 7428 2720 2729 5b30 5d20 2b20 272f 3227  t(' ')[0] + '/2'
+0008e5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008e5c0: 2066 6132 5b6b 6579 5d20 3d20 6661 5f61   fa2[key] = fa_a
+0008e5d0: 6c6c 5b6b 6579 5d0a 2020 2020 2020 2020  ll[key].        
+0008e5e0: 2020 2020 636e 745f 3220 2b3d 2031 0a0a      cnt_2 += 1..
+0008e5f0: 2020 2020 2020 2020 636e 7420 2b3d 2031          cnt += 1
+0008e600: 0a0a 2020 2020 6966 2064 7372 203d 3d20  ..    if dsr == 
+0008e610: 313a 0a20 2020 2020 2020 2066 6e31 203d  1:.        fn1 =
+0008e620: 2066 6e61 6d65 202b 2027 5f31 2e27 202b   fname + '_1.' +
+0008e630: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
+0008e640: 203d 2066 6e61 6d65 202b 2027 5f32 2e27   = fname + '_2.'
+0008e650: 202b 2065 7874 0a20 2020 2065 6c73 653a   + ext.    else:
+0008e660: 0a20 2020 2020 2020 2066 6e31 203d 2066  .        fn1 = f
+0008e670: 6e61 6d65 202b 2028 275f 6473 2569 2720  name + ('_ds%i' 
+0008e680: 2520 6473 7229 202b 2027 5f31 2e27 202b  % dsr) + '_1.' +
+0008e690: 2065 7874 0a20 2020 2020 2020 2066 6e32   ext.        fn2
+0008e6a0: 203d 2066 6e61 6d65 202b 2028 275f 6473   = fname + ('_ds
+0008e6b0: 2569 2720 2520 6473 7229 202b 2027 5f32  %i' % dsr) + '_2
+0008e6c0: 2e27 202b 2065 7874 0a20 2020 2073 6176  .' + ext.    sav
+0008e6d0: 655f 6661 7374 7128 666e 312c 2066 6131  e_fastq(fn1, fa1
+0008e6e0: 290a 2020 2020 7361 7665 5f66 6173 7471  ).    save_fastq
+0008e6f0: 2866 6e32 2c20 6661 3229 0a20 2020 200a  (fn2, fa2).    .
+0008e700: 0a64 6566 2066 6173 7461 5f73 696d 5f72  .def fasta_sim_r
+0008e710: 6561 645f 646f 776e 7361 6d70 6c65 2820  ead_downsample( 
+0008e720: 7369 6d5f 7265 6164 2c20 6473 7220 3d20  sim_read, dsr = 
+0008e730: 3120 293a 0a20 2020 200a 2020 2020 666e  1 ):.    .    fn
+0008e740: 616d 652c 2065 7874 203d 2067 6574 5f70  ame, ext = get_p
+0008e750: 6174 685f 6e61 6d65 2873 696d 5f72 6561  ath_name(sim_rea
+0008e760: 6429 0a0a 2020 2020 6661 5f61 6c6c 203d  d)..    fa_all =
+0008e770: 206c 6f61 645f 6661 7374 7128 7369 6d5f   load_fastq(sim_
+0008e780: 7265 6164 290a 2020 2020 0a20 2020 2066  read).    .    f
+0008e790: 6120 3d20 7b7d 0a20 2020 2063 6e74 203d  a = {}.    cnt =
+0008e7a0: 2030 0a20 2020 2066 6f72 206b 6579 2069   0.    for key i
+0008e7b0: 6e20 6661 5f61 6c6c 2e6b 6579 7328 293a  n fa_all.keys():
+0008e7c0: 0a20 2020 2020 2020 2023 2066 615f 616c  .        # fa_al
+0008e7d0: 6c5b 6b65 795d 2e68 6561 6465 7220 3d20  l[key].header = 
+0008e7e0: 6661 5f61 6c6c 5b6b 6579 5d2e 6865 6164  fa_all[key].head
+0008e7f0: 6572 5b3a 2d34 5d0a 2020 2020 2020 2020  er[:-4].        
+0008e800: 6966 2063 6e74 2564 7372 203d 3d20 303a  if cnt%dsr == 0:
+0008e810: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
+0008e820: 615f 616c 6c5b 6b65 795d 2e68 6561 6465  a_all[key].heade
+0008e830: 7220 3d20 6661 5f61 6c6c 5b6b 6579 5d2e  r = fa_all[key].
+0008e840: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+0008e850: 2020 2066 615b 6b65 795d 203d 2066 615f     fa[key] = fa_
+0008e860: 616c 6c5b 6b65 795d 0a20 2020 2020 2020  all[key].       
+0008e870: 2063 6e74 202b 3d20 310a 0a20 2020 2066   cnt += 1..    f
+0008e880: 6e20 3d20 666e 616d 6520 2b20 2827 5f64  n = fname + ('_d
+0008e890: 7325 692e 2720 2520 6473 7229 202b 2065  s%i.' % dsr) + e
+0008e8a0: 7874 0a20 2020 2073 6176 655f 6661 7374  xt.    save_fast
+0008e8b0: 7128 666e 2c20 6661 290a 2020 2020 0a20  q(fn, fa).    . 
+0008e8c0: 2020 200a 2323 2323 2323 2323 2323 2323     .############
+0008e8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008e8e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008e8f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0008e900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008e910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008e920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008e930: 2323 2323 2323 230a 0a53 4e56 203d 2063  #######..SNV = c
-0008e940: 6f6c 6c65 6374 696f 6e73 2e6e 616d 6564  ollections.named
-0008e950: 7475 706c 6528 2753 4e56 272c 2027 6368  tuple('SNV', 'ch
-0008e960: 722c 2070 6f73 5f6e 6577 2c20 706f 735f  r, pos_new, pos_
-0008e970: 6f72 672c 2074 7970 652c 206c 656e 2c20  org, type, len, 
-0008e980: 7365 715f 6e65 772c 2073 6571 5f6f 7267  seq_new, seq_org
-0008e990: 2c20 6578 5f73 7461 7274 2c20 6578 5f65  , ex_start, ex_e
-0008e9a0: 6e64 2729 0a0a 6465 6620 6765 745f 736e  nd')..def get_sn
-0008e9b0: 765f 7479 7065 2870 692c 2070 6429 3a0a  v_type(pi, pd):.
-0008e9c0: 2020 2020 0a20 2020 2072 6e20 3d20 6e70      .    rn = np
-0008e9d0: 2e72 616e 646f 6d2e 756e 6966 6f72 6d28  .random.uniform(
-0008e9e0: 3130 3029 0a20 2020 2069 6620 726e 203c  100).    if rn <
-0008e9f0: 2028 7069 2a31 3030 293a 0a20 2020 2020   (pi*100):.     
-0008ea00: 2020 2072 6574 7572 6e28 3129 0a20 2020     return(1).   
-0008ea10: 2065 6c69 6620 726e 203c 2028 7069 2b70   elif rn < (pi+p
-0008ea20: 6929 2a31 3030 3a0a 2020 2020 2020 2020  i)*100:.        
-0008ea30: 7265 7475 726e 2832 290a 2020 2020 656c  return(2).    el
-0008ea40: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
-0008ea50: 726e 2830 290a 2020 2020 0a64 6566 2072  rn(0).    .def r
-0008ea60: 616e 645f 6e75 636c 656f 7469 6465 5f65  and_nucleotide_e
-0008ea70: 7863 6570 7428 6e74 7329 3a0a 2020 2020  xcept(nts):.    
-0008ea80: 0a20 2020 206e 7473 5f6f 7574 203d 2027  .    nts_out = '
-0008ea90: 270a 2020 2020 666f 7220 6e74 2069 6e20  '.    for nt in 
-0008eaa0: 6e74 733a 0a20 2020 2020 2020 2077 6869  nts:.        whi
-0008eab0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-0008eac0: 2020 2020 2072 6e20 3d20 6e70 2e72 616e       rn = np.ran
-0008ead0: 646f 6d2e 7261 6e64 696e 7428 302c 342c  dom.randint(0,4,
-0008eae0: 3129 5b30 5d0a 2020 2020 2020 2020 2020  1)[0].          
-0008eaf0: 2020 6e74 5f6e 6577 203d 204e 545f 6c73    nt_new = NT_ls
-0008eb00: 745b 696e 7428 726e 295d 0a20 2020 2020  t[int(rn)].     
-0008eb10: 2020 2020 2020 2069 6620 6e74 5f6e 6577         if nt_new
-0008eb20: 2021 3d20 6e74 3a20 0a20 2020 2020 2020   != nt: .       
-0008eb30: 2020 2020 2020 2020 206e 7473 5f6f 7574           nts_out
-0008eb40: 203d 206e 7473 5f6f 7574 202b 206e 745f   = nts_out + nt_
-0008eb50: 6e65 770a 2020 2020 2020 2020 2020 2020  new.            
-0008eb60: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0008eb70: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-0008eb80: 2020 2072 6574 7572 6e28 6e74 735f 6f75     return(nts_ou
-0008eb90: 7429 0a20 2020 2020 2020 200a 6465 6620  t).        .def 
-0008eba0: 7261 6e64 5f6e 7563 6c65 6f74 6964 6573  rand_nucleotides
-0008ebb0: 286e 756d 293a 0a20 2020 200a 2020 2020  (num):.    .    
-0008ebc0: 6e75 6d5f 7365 7120 3d20 6e70 2e72 616e  num_seq = np.ran
-0008ebd0: 646f 6d2e 7261 6e64 696e 7428 302c 342c  dom.randint(0,4,
-0008ebe0: 6e75 6d29 0a20 2020 206e 745f 7374 7220  num).    nt_str 
-0008ebf0: 3d20 2727 2e6a 6f69 6e28 5b4e 545f 6c73  = ''.join([NT_ls
-0008ec00: 745b 6e5d 2066 6f72 206e 2069 6e20 6e75  t[n] for n in nu
-0008ec10: 6d5f 7365 715d 290a 2020 2020 7265 7475  m_seq]).    retu
-0008ec20: 726e 286e 745f 7374 7229 0a0a 0a64 6566  rn(nt_str)...def
-0008ec30: 2073 6176 655f 736e 765f 696e 666f 5f6f   save_snv_info_o
-0008ec40: 6c64 2820 6669 6c65 5f6e 616d 652c 2073  ld( file_name, s
-0008ec50: 6e76 5f6c 7374 2c20 7665 7262 6f73 6520  nv_lst, verbose 
-0008ec60: 3d20 4661 6c73 6520 293a 0a20 2020 200a  = False ):.    .
-0008ec70: 2020 2020 6620 3d20 6f70 656e 2866 696c      f = open(fil
-0008ec80: 655f 6e61 6d65 2c20 2777 742b 2729 0a20  e_name, 'wt+'). 
-0008ec90: 2020 2070 7269 6e74 2827 5361 7669 6e67     print('Saving
-0008eca0: 2053 4e56 2069 6e66 6f2e 2027 2c20 656e   SNV info. ', en
-0008ecb0: 643d 2727 290a 2020 2020 7374 6570 203d  d='').    step =
-0008ecc0: 206e 702e 6365 696c 286c 656e 2873 6e76   np.ceil(len(snv
-0008ecd0: 5f6c 7374 292f 3230 290a 2020 2020 666f  _lst)/20).    fo
-0008ece0: 7220 6b20 696e 2072 616e 6765 286c 656e  r k in range(len
-0008ecf0: 2873 6e76 5f6c 7374 2929 203a 0a20 2020  (snv_lst)) :.   
-0008ed00: 2020 2020 2073 6e76 203d 2073 6e76 5f6c       snv = snv_l
-0008ed10: 7374 5b6b 5d0a 2020 2020 2020 2020 7320  st[k].        s 
-0008ed20: 3d20 2725 732c 2569 2c25 692c 2573 2c25  = '%s,%i,%i,%s,%
-0008ed30: 692c 2573 2c25 735c 6e27 2025 205c 0a20  i,%s,%s\n' % \. 
-0008ed40: 2020 2020 2020 2028 736e 762e 6368 722c         (snv.chr,
-0008ed50: 2073 6e76 2e70 6f73 5f6e 6577 2c20 736e   snv.pos_new, sn
-0008ed60: 762e 706f 735f 6f72 672c 2073 6e76 2e74  v.pos_org, snv.t
-0008ed70: 7970 652c 2073 6e76 2e6c 656e 2c20 736e  ype, snv.len, sn
-0008ed80: 762e 7365 715f 6e65 772c 2073 6e76 2e73  v.seq_new, snv.s
-0008ed90: 6571 5f6f 7267 2029 0a20 2020 2020 2020  eq_org ).       
-0008eda0: 2066 2e77 7269 7465 6c69 6e65 7328 7329   f.writelines(s)
-0008edb0: 0a20 2020 2020 2020 2069 6620 6b25 7374  .        if k%st
-0008edc0: 6570 203d 3d20 303a 2070 7269 6e74 2827  ep == 0: print('
-0008edd0: 2e27 2c65 6e64 3d27 2729 0a20 2020 2020  .',end='').     
-0008ede0: 2020 200a 2020 2020 7072 696e 7428 2720     .    print(' 
-0008edf0: 646f 6e65 2e20 2569 2073 6e76 732e 2720  done. %i snvs.' 
-0008ee00: 2520 6c65 6e28 736e 765f 6c73 7429 2029  % len(snv_lst) )
-0008ee10: 0a20 2020 2066 2e63 6c6f 7365 2829 0a0a  .    f.close()..
-0008ee20: 2020 2020 0a64 6566 2073 6176 655f 736e      .def save_sn
-0008ee30: 765f 696e 666f 2820 6669 6c65 5f6e 616d  v_info( file_nam
-0008ee40: 652c 2073 6e76 5f6c 7374 2c20 7665 7262  e, snv_lst, verb
-0008ee50: 6f73 6520 3d20 4661 6c73 6520 293a 0a0a  ose = False ):..
-0008ee60: 2020 2020 6466 203d 2070 642e 4461 7461      df = pd.Data
-0008ee70: 4672 616d 6528 736e 765f 6c73 7429 0a20  Frame(snv_lst). 
-0008ee80: 2020 2064 662e 746f 5f63 7376 2866 696c     df.to_csv(fil
-0008ee90: 655f 6e61 6d65 2c20 696e 6465 783d 4661  e_name, index=Fa
-0008eea0: 6c73 652c 2073 6570 3d27 5c74 2729 0a0a  lse, sep='\t')..
-0008eeb0: 2020 2020 0a64 6566 2067 656e 6572 6174      .def generat
-0008eec0: 655f 736e 765f 7769 7468 5f67 7466 2820  e_snv_with_gtf( 
-0008eed0: 6765 6e6f 6d65 2c20 6774 665f 6c69 6e65  genome, gtf_line
-0008eee0: 735f 736f 7274 6564 2c20 6d75 203d 2032  s_sorted, mu = 2
-0008eef0: 3030 2c20 6c69 203d 2033 2c20 6c64 203d  00, li = 3, ld =
-0008ef00: 2033 2c20 6c76 203d 2032 2c20 7069 203d   3, lv = 2, pi =
-0008ef10: 2030 2e31 2c20 7064 203d 2030 2e31 2029   0.1, pd = 0.1 )
-0008ef20: 3a0a 2020 2020 0a20 2020 2070 7620 3d20  :.    .    pv = 
-0008ef30: 3120 2d20 7069 202d 2070 640a 2020 2020  1 - pi - pd.    
-0008ef40: 7072 696e 7428 6765 6e6f 6d65 2e6e 616d  print(genome.nam
-0008ef50: 652c 2065 6e64 3d27 2027 290a 2020 2020  e, end=' ').    
-0008ef60: 736e 765f 6c73 7420 3d20 5b5d 0a20 2020  snv_lst = [].   
-0008ef70: 2063 7572 5f70 6f73 5f6f 7267 203d 2030   cur_pos_org = 0
-0008ef80: 0a20 2020 2063 7572 5f70 6f73 5f6e 6577  .    cur_pos_new
-0008ef90: 203d 2063 7572 5f70 6f73 5f6f 7267 0a20   = cur_pos_org. 
-0008efa0: 2020 2073 6571 5f6e 6577 203d 2027 270a     seq_new = ''.
-0008efb0: 2020 2020 7365 715f 6c73 7420 3d20 5b5d      seq_lst = []
-0008efc0: 0a20 2020 204d 6172 6769 6e20 3d20 6d61  .    Margin = ma
-0008efd0: 7828 6c69 2c6d 6178 286c 642c 6c76 2929  x(li,max(ld,lv))
-0008efe0: 0a20 2020 200a 2020 2020 7374 6570 203d  .    .    step =
-0008eff0: 206e 702e 6365 696c 2867 656e 6f6d 652e   np.ceil(genome.
-0008f000: 6c65 6e2f 6d75 2f32 3030 290a 2020 2020  len/mu/200).    
-0008f010: 0a20 2020 2063 6e74 203d 2030 0a20 2020  .    cnt = 0.   
-0008f020: 2066 6f72 206c 696e 6520 696e 2067 7466   for line in gtf
-0008f030: 5f6c 696e 6573 5f73 6f72 7465 643a 0a20  _lines_sorted:. 
-0008f040: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0008f050: 2320 6469 6666 203d 2063 7572 5f70 6f73  # diff = cur_pos
-0008f060: 5f6e 6577 202d 2063 7572 5f70 6f73 5f6f  _new - cur_pos_o
-0008f070: 7267 0a20 2020 2020 2020 2053 7461 7274  rg.        Start
-0008f080: 203d 206c 696e 652e 7374 6172 740a 2020   = line.start.  
-0008f090: 2020 2020 2020 456e 6420 3d20 6c69 6e65        End = line
-0008f0a0: 2e65 6e64 0a20 2020 2020 2020 204c 203d  .end.        L =
-0008f0b0: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
-0008f0c0: 6e74 2830 2c6d 752f 322c 3129 5b30 5d0a  nt(0,mu/2,1)[0].
-0008f0d0: 2020 2020 2020 2020 6966 2063 7572 5f70          if cur_p
-0008f0e0: 6f73 5f6f 7267 203c 2028 6c69 6e65 2e73  os_org < (line.s
-0008f0f0: 7461 7274 2d31 2b4c 293a 0a20 2020 2020  tart-1+L):.     
-0008f100: 2020 2020 2020 206e 6578 745f 706f 735f         next_pos_
-0008f110: 6f72 6720 3d20 6c69 6e65 2e73 7461 7274  org = line.start
-0008f120: 2d31 2b4c 0a20 2020 2020 2020 2020 2020  -1+L.           
-0008f130: 2073 6571 5f6c 7374 2e61 7070 656e 6428   seq_lst.append(
-0008f140: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
-0008f150: 7572 5f70 6f73 5f6f 7267 293a 696e 7428  ur_pos_org):int(
-0008f160: 6e65 7874 5f70 6f73 5f6f 7267 295d 290a  next_pos_org)]).
-0008f170: 2020 2020 2020 2020 2020 2020 6375 725f              cur_
-0008f180: 706f 735f 6e65 7720 2b3d 2028 6e65 7874  pos_new += (next
-0008f190: 5f70 6f73 5f6f 7267 2d63 7572 5f70 6f73  _pos_org-cur_pos
-0008f1a0: 5f6f 7267 290a 2020 2020 2020 2020 2020  _org).          
-0008f1b0: 2020 6375 725f 706f 735f 6f72 6720 3d20    cur_pos_org = 
-0008f1c0: 6e65 7874 5f70 6f73 5f6f 7267 0a20 2020  next_pos_org.   
-0008f1d0: 2020 2020 200a 2020 2020 2020 2020 7768       .        wh
-0008f1e0: 696c 6520 2863 7572 5f70 6f73 5f6f 7267  ile (cur_pos_org
-0008f1f0: 203c 2028 6c69 6e65 2e65 6e64 2d4d 6172   < (line.end-Mar
-0008f200: 6769 6e29 2920 2620 2863 7572 5f70 6f73  gin)) & (cur_pos
-0008f210: 5f6f 7267 203e 2028 6c69 6e65 2e73 7461  _org > (line.sta
-0008f220: 7274 2b4d 6172 6769 6e29 293a 0a0a 2020  rt+Margin)):..  
-0008f230: 2020 2020 2020 2020 2020 736e 765f 7479            snv_ty
-0008f240: 7065 203d 2067 6574 5f73 6e76 5f74 7970  pe = get_snv_typ
-0008f250: 6528 7069 2c20 7076 290a 0a20 2020 2020  e(pi, pv)..     
-0008f260: 2020 2020 2020 2069 6620 736e 765f 7479         if snv_ty
-0008f270: 7065 203d 3d20 313a 2023 2049 6e73 6572  pe == 1: # Inser
-0008f280: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0008f290: 2020 2020 206e 203d 206e 702e 7261 6e64       n = np.rand
-0008f2a0: 6f6d 2e72 616e 6469 6e74 2830 2c6c 692c  om.randint(0,li,
-0008f2b0: 2031 295b 305d 2b31 0a20 2020 2020 2020   1)[0]+1.       
-0008f2c0: 2020 2020 2020 2020 2073 6571 5f66 7261           seq_fra
-0008f2d0: 6720 3d20 7261 6e64 5f6e 7563 6c65 6f74  g = rand_nucleot
-0008f2e0: 6964 6573 286e 290a 2020 2020 2020 2020  ides(n).        
-0008f2f0: 2020 2020 2020 2020 2320 7365 715f 6e65          # seq_ne
-0008f300: 7720 3d20 7365 715f 6e65 7720 2b20 7365  w = seq_new + se
-0008f310: 715f 6672 6167 0a20 2020 2020 2020 2020  q_frag.         
-0008f320: 2020 2020 2020 2073 6571 5f6c 7374 2e61         seq_lst.a
-0008f330: 7070 656e 6428 7365 715f 6672 6167 290a  ppend(seq_frag).
+0008e910: 2323 2323 2323 0a23 2320 4675 6e63 7469  ######.## Functi
+0008e920: 6f6e 7320 746f 2061 6464 2053 4e56 2069  ons to add SNV i
+0008e930: 6e74 6f20 6120 6765 6e6f 6d65 0a23 2323  nto a genome.###
+0008e940: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008e950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008e960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008e970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008e980: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0008e990: 0a53 4e56 203d 2063 6f6c 6c65 6374 696f  .SNV = collectio
+0008e9a0: 6e73 2e6e 616d 6564 7475 706c 6528 2753  ns.namedtuple('S
+0008e9b0: 4e56 272c 2027 6368 722c 2070 6f73 5f6e  NV', 'chr, pos_n
+0008e9c0: 6577 2c20 706f 735f 6f72 672c 2074 7970  ew, pos_org, typ
+0008e9d0: 652c 206c 656e 2c20 7365 715f 6e65 772c  e, len, seq_new,
+0008e9e0: 2073 6571 5f6f 7267 2c20 6578 5f73 7461   seq_org, ex_sta
+0008e9f0: 7274 2c20 6578 5f65 6e64 2729 0a0a 6465  rt, ex_end')..de
+0008ea00: 6620 6765 745f 736e 765f 7479 7065 2870  f get_snv_type(p
+0008ea10: 692c 2070 6429 3a0a 2020 2020 0a20 2020  i, pd):.    .   
+0008ea20: 2072 6e20 3d20 6e70 2e72 616e 646f 6d2e   rn = np.random.
+0008ea30: 756e 6966 6f72 6d28 3130 3029 0a20 2020  uniform(100).   
+0008ea40: 2069 6620 726e 203c 2028 7069 2a31 3030   if rn < (pi*100
+0008ea50: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0008ea60: 6e28 3129 0a20 2020 2065 6c69 6620 726e  n(1).    elif rn
+0008ea70: 203c 2028 7069 2b70 6929 2a31 3030 3a0a   < (pi+pi)*100:.
+0008ea80: 2020 2020 2020 2020 7265 7475 726e 2832          return(2
+0008ea90: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+0008eaa0: 2020 2020 7265 7475 726e 2830 290a 2020      return(0).  
+0008eab0: 2020 0a64 6566 2072 616e 645f 6e75 636c    .def rand_nucl
+0008eac0: 656f 7469 6465 5f65 7863 6570 7428 6e74  eotide_except(nt
+0008ead0: 7329 3a0a 2020 2020 0a20 2020 206e 7473  s):.    .    nts
+0008eae0: 5f6f 7574 203d 2027 270a 2020 2020 666f  _out = ''.    fo
+0008eaf0: 7220 6e74 2069 6e20 6e74 733a 0a20 2020  r nt in nts:.   
+0008eb00: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+0008eb10: 0a20 2020 2020 2020 2020 2020 2072 6e20  .            rn 
+0008eb20: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+0008eb30: 696e 7428 302c 342c 3129 5b30 5d0a 2020  int(0,4,1)[0].  
+0008eb40: 2020 2020 2020 2020 2020 6e74 5f6e 6577            nt_new
+0008eb50: 203d 204e 545f 6c73 745b 696e 7428 726e   = NT_lst[int(rn
+0008eb60: 295d 0a20 2020 2020 2020 2020 2020 2069  )].            i
+0008eb70: 6620 6e74 5f6e 6577 2021 3d20 6e74 3a20  f nt_new != nt: 
+0008eb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008eb90: 206e 7473 5f6f 7574 203d 206e 7473 5f6f   nts_out = nts_o
+0008eba0: 7574 202b 206e 745f 6e65 770a 2020 2020  ut + nt_new.    
+0008ebb0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0008ebc0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0008ebd0: 2020 2020 2020 0a20 2020 2072 6574 7572        .    retur
+0008ebe0: 6e28 6e74 735f 6f75 7429 0a20 2020 2020  n(nts_out).     
+0008ebf0: 2020 200a 6465 6620 7261 6e64 5f6e 7563     .def rand_nuc
+0008ec00: 6c65 6f74 6964 6573 286e 756d 293a 0a20  leotides(num):. 
+0008ec10: 2020 200a 2020 2020 6e75 6d5f 7365 7120     .    num_seq 
+0008ec20: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+0008ec30: 696e 7428 302c 342c 6e75 6d29 0a20 2020  int(0,4,num).   
+0008ec40: 206e 745f 7374 7220 3d20 2727 2e6a 6f69   nt_str = ''.joi
+0008ec50: 6e28 5b4e 545f 6c73 745b 6e5d 2066 6f72  n([NT_lst[n] for
+0008ec60: 206e 2069 6e20 6e75 6d5f 7365 715d 290a   n in num_seq]).
+0008ec70: 2020 2020 7265 7475 726e 286e 745f 7374      return(nt_st
+0008ec80: 7229 0a0a 0a64 6566 2073 6176 655f 736e  r)...def save_sn
+0008ec90: 765f 696e 666f 5f6f 6c64 2820 6669 6c65  v_info_old( file
+0008eca0: 5f6e 616d 652c 2073 6e76 5f6c 7374 2c20  _name, snv_lst, 
+0008ecb0: 7665 7262 6f73 6520 3d20 4661 6c73 6520  verbose = False 
+0008ecc0: 293a 0a20 2020 200a 2020 2020 6620 3d20  ):.    .    f = 
+0008ecd0: 6f70 656e 2866 696c 655f 6e61 6d65 2c20  open(file_name, 
+0008ece0: 2777 742b 2729 0a20 2020 2070 7269 6e74  'wt+').    print
+0008ecf0: 2827 5361 7669 6e67 2053 4e56 2069 6e66  ('Saving SNV inf
+0008ed00: 6f2e 2027 2c20 656e 643d 2727 290a 2020  o. ', end='').  
+0008ed10: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
+0008ed20: 286c 656e 2873 6e76 5f6c 7374 292f 3230  (len(snv_lst)/20
+0008ed30: 290a 2020 2020 666f 7220 6b20 696e 2072  ).    for k in r
+0008ed40: 616e 6765 286c 656e 2873 6e76 5f6c 7374  ange(len(snv_lst
+0008ed50: 2929 203a 0a20 2020 2020 2020 2073 6e76  )) :.        snv
+0008ed60: 203d 2073 6e76 5f6c 7374 5b6b 5d0a 2020   = snv_lst[k].  
+0008ed70: 2020 2020 2020 7320 3d20 2725 732c 2569        s = '%s,%i
+0008ed80: 2c25 692c 2573 2c25 692c 2573 2c25 735c  ,%i,%s,%i,%s,%s\
+0008ed90: 6e27 2025 205c 0a20 2020 2020 2020 2028  n' % \.        (
+0008eda0: 736e 762e 6368 722c 2073 6e76 2e70 6f73  snv.chr, snv.pos
+0008edb0: 5f6e 6577 2c20 736e 762e 706f 735f 6f72  _new, snv.pos_or
+0008edc0: 672c 2073 6e76 2e74 7970 652c 2073 6e76  g, snv.type, snv
+0008edd0: 2e6c 656e 2c20 736e 762e 7365 715f 6e65  .len, snv.seq_ne
+0008ede0: 772c 2073 6e76 2e73 6571 5f6f 7267 2029  w, snv.seq_org )
+0008edf0: 0a20 2020 2020 2020 2066 2e77 7269 7465  .        f.write
+0008ee00: 6c69 6e65 7328 7329 0a20 2020 2020 2020  lines(s).       
+0008ee10: 2069 6620 6b25 7374 6570 203d 3d20 303a   if k%step == 0:
+0008ee20: 2070 7269 6e74 2827 2e27 2c65 6e64 3d27   print('.',end='
+0008ee30: 2729 0a20 2020 2020 2020 200a 2020 2020  ').        .    
+0008ee40: 7072 696e 7428 2720 646f 6e65 2e20 2569  print(' done. %i
+0008ee50: 2073 6e76 732e 2720 2520 6c65 6e28 736e   snvs.' % len(sn
+0008ee60: 765f 6c73 7429 2029 0a20 2020 2066 2e63  v_lst) ).    f.c
+0008ee70: 6c6f 7365 2829 0a0a 2020 2020 0a64 6566  lose()..    .def
+0008ee80: 2073 6176 655f 736e 765f 696e 666f 2820   save_snv_info( 
+0008ee90: 6669 6c65 5f6e 616d 652c 2073 6e76 5f6c  file_name, snv_l
+0008eea0: 7374 2c20 7665 7262 6f73 6520 3d20 4661  st, verbose = Fa
+0008eeb0: 6c73 6520 293a 0a0a 2020 2020 6466 203d  lse ):..    df =
+0008eec0: 2070 642e 4461 7461 4672 616d 6528 736e   pd.DataFrame(sn
+0008eed0: 765f 6c73 7429 0a20 2020 2064 662e 746f  v_lst).    df.to
+0008eee0: 5f63 7376 2866 696c 655f 6e61 6d65 2c20  _csv(file_name, 
+0008eef0: 696e 6465 783d 4661 6c73 652c 2073 6570  index=False, sep
+0008ef00: 3d27 5c74 2729 0a0a 2020 2020 0a64 6566  ='\t')..    .def
+0008ef10: 2067 656e 6572 6174 655f 736e 765f 7769   generate_snv_wi
+0008ef20: 7468 5f67 7466 2820 6765 6e6f 6d65 2c20  th_gtf( genome, 
+0008ef30: 6774 665f 6c69 6e65 735f 736f 7274 6564  gtf_lines_sorted
+0008ef40: 2c20 6d75 203d 2032 3030 2c20 6c69 203d  , mu = 200, li =
+0008ef50: 2033 2c20 6c64 203d 2033 2c20 6c76 203d   3, ld = 3, lv =
+0008ef60: 2032 2c20 7069 203d 2030 2e31 2c20 7064   2, pi = 0.1, pd
+0008ef70: 203d 2030 2e31 2029 3a0a 2020 2020 0a20   = 0.1 ):.    . 
+0008ef80: 2020 2070 7620 3d20 3120 2d20 7069 202d     pv = 1 - pi -
+0008ef90: 2070 640a 2020 2020 7072 696e 7428 6765   pd.    print(ge
+0008efa0: 6e6f 6d65 2e6e 616d 652c 2065 6e64 3d27  nome.name, end='
+0008efb0: 2027 290a 2020 2020 736e 765f 6c73 7420   ').    snv_lst 
+0008efc0: 3d20 5b5d 0a20 2020 2063 7572 5f70 6f73  = [].    cur_pos
+0008efd0: 5f6f 7267 203d 2030 0a20 2020 2063 7572  _org = 0.    cur
+0008efe0: 5f70 6f73 5f6e 6577 203d 2063 7572 5f70  _pos_new = cur_p
+0008eff0: 6f73 5f6f 7267 0a20 2020 2073 6571 5f6e  os_org.    seq_n
+0008f000: 6577 203d 2027 270a 2020 2020 7365 715f  ew = ''.    seq_
+0008f010: 6c73 7420 3d20 5b5d 0a20 2020 204d 6172  lst = [].    Mar
+0008f020: 6769 6e20 3d20 6d61 7828 6c69 2c6d 6178  gin = max(li,max
+0008f030: 286c 642c 6c76 2929 0a20 2020 200a 2020  (ld,lv)).    .  
+0008f040: 2020 7374 6570 203d 206e 702e 6365 696c    step = np.ceil
+0008f050: 2867 656e 6f6d 652e 6c65 6e2f 6d75 2f32  (genome.len/mu/2
+0008f060: 3030 290a 2020 2020 0a20 2020 2063 6e74  00).    .    cnt
+0008f070: 203d 2030 0a20 2020 2066 6f72 206c 696e   = 0.    for lin
+0008f080: 6520 696e 2067 7466 5f6c 696e 6573 5f73  e in gtf_lines_s
+0008f090: 6f72 7465 643a 0a20 2020 2020 2020 200a  orted:.        .
+0008f0a0: 2020 2020 2020 2020 2320 6469 6666 203d          # diff =
+0008f0b0: 2063 7572 5f70 6f73 5f6e 6577 202d 2063   cur_pos_new - c
+0008f0c0: 7572 5f70 6f73 5f6f 7267 0a20 2020 2020  ur_pos_org.     
+0008f0d0: 2020 2053 7461 7274 203d 206c 696e 652e     Start = line.
+0008f0e0: 7374 6172 740a 2020 2020 2020 2020 456e  start.        En
+0008f0f0: 6420 3d20 6c69 6e65 2e65 6e64 0a20 2020  d = line.end.   
+0008f100: 2020 2020 204c 203d 206e 702e 7261 6e64       L = np.rand
+0008f110: 6f6d 2e72 616e 6469 6e74 2830 2c6d 752f  om.randint(0,mu/
+0008f120: 322c 3129 5b30 5d0a 2020 2020 2020 2020  2,1)[0].        
+0008f130: 6966 2063 7572 5f70 6f73 5f6f 7267 203c  if cur_pos_org <
+0008f140: 2028 6c69 6e65 2e73 7461 7274 2d31 2b4c   (line.start-1+L
+0008f150: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
+0008f160: 6578 745f 706f 735f 6f72 6720 3d20 6c69  ext_pos_org = li
+0008f170: 6e65 2e73 7461 7274 2d31 2b4c 0a20 2020  ne.start-1+L.   
+0008f180: 2020 2020 2020 2020 2073 6571 5f6c 7374           seq_lst
+0008f190: 2e61 7070 656e 6428 6765 6e6f 6d65 2e73  .append(genome.s
+0008f1a0: 6571 5b69 6e74 2863 7572 5f70 6f73 5f6f  eq[int(cur_pos_o
+0008f1b0: 7267 293a 696e 7428 6e65 7874 5f70 6f73  rg):int(next_pos
+0008f1c0: 5f6f 7267 295d 290a 2020 2020 2020 2020  _org)]).        
+0008f1d0: 2020 2020 6375 725f 706f 735f 6e65 7720      cur_pos_new 
+0008f1e0: 2b3d 2028 6e65 7874 5f70 6f73 5f6f 7267  += (next_pos_org
+0008f1f0: 2d63 7572 5f70 6f73 5f6f 7267 290a 2020  -cur_pos_org).  
+0008f200: 2020 2020 2020 2020 2020 6375 725f 706f            cur_po
+0008f210: 735f 6f72 6720 3d20 6e65 7874 5f70 6f73  s_org = next_pos
+0008f220: 5f6f 7267 0a20 2020 2020 2020 200a 2020  _org.        .  
+0008f230: 2020 2020 2020 7768 696c 6520 2863 7572        while (cur
+0008f240: 5f70 6f73 5f6f 7267 203c 2028 6c69 6e65  _pos_org < (line
+0008f250: 2e65 6e64 2d4d 6172 6769 6e29 2920 2620  .end-Margin)) & 
+0008f260: 2863 7572 5f70 6f73 5f6f 7267 203e 2028  (cur_pos_org > (
+0008f270: 6c69 6e65 2e73 7461 7274 2b4d 6172 6769  line.start+Margi
+0008f280: 6e29 293a 0a0a 2020 2020 2020 2020 2020  n)):..          
+0008f290: 2020 736e 765f 7479 7065 203d 2067 6574    snv_type = get
+0008f2a0: 5f73 6e76 5f74 7970 6528 7069 2c20 7076  _snv_type(pi, pv
+0008f2b0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0008f2c0: 6620 736e 765f 7479 7065 203d 3d20 313a  f snv_type == 1:
+0008f2d0: 2023 2049 6e73 6572 7469 6f6e 0a20 2020   # Insertion.   
+0008f2e0: 2020 2020 2020 2020 2020 2020 206e 203d               n =
+0008f2f0: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
+0008f300: 6e74 2830 2c6c 692c 2031 295b 305d 2b31  nt(0,li, 1)[0]+1
+0008f310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008f320: 2073 6571 5f66 7261 6720 3d20 7261 6e64   seq_frag = rand
+0008f330: 5f6e 7563 6c65 6f74 6964 6573 286e 290a  _nucleotides(n).
 0008f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f350: 736e 7620 3d20 534e 5628 2067 656e 6f6d  snv = SNV( genom
-0008f360: 652e 6e61 6d65 2c20 6375 725f 706f 735f  e.name, cur_pos_
-0008f370: 6e65 772b 312c 2063 7572 5f70 6f73 5f6f  new+1, cur_pos_o
-0008f380: 7267 2b31 2c20 2749 272c 206e 2c20 7365  rg+1, 'I', n, se
-0008f390: 715f 6672 6167 2c20 272d 272c 2053 7461  q_frag, '-', Sta
-0008f3a0: 7274 2c20 456e 6420 2920 2320 6d61 6b65  rt, End ) # make
-0008f3b0: 2069 7420 6f6e 652d 6261 7365 2070 6f73   it one-base pos
-0008f3c0: 6974 696f 6e0a 2020 2020 2020 2020 2020  ition.          
-0008f3d0: 2020 2020 2020 736e 765f 6c73 742e 6170        snv_lst.ap
-0008f3e0: 7065 6e64 2873 6e76 290a 2020 2020 2020  pend(snv).      
-0008f3f0: 2020 2020 2020 2020 2020 6375 725f 706f            cur_po
-0008f400: 735f 6e65 7720 2b3d 206c 656e 2873 6571  s_new += len(seq
-0008f410: 5f66 7261 6729 0a0a 2020 2020 2020 2020  _frag)..        
-0008f420: 2020 2020 656c 6966 2073 6e76 5f74 7970      elif snv_typ
-0008f430: 6520 3d3d 2032 3a20 2320 4465 6c65 7469  e == 2: # Deleti
-0008f440: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-0008f450: 2020 206e 203d 206e 702e 7261 6e64 6f6d     n = np.random
-0008f460: 2e72 616e 6469 6e74 2830 2c6c 642c 2031  .randint(0,ld, 1
-0008f470: 295b 305d 2b31 0a20 2020 2020 2020 2020  )[0]+1.         
-0008f480: 2020 2020 2020 2073 6571 5f66 7261 6720         seq_frag 
-0008f490: 3d20 6765 6e6f 6d65 2e73 6571 5b69 6e74  = genome.seq[int
-0008f4a0: 2863 7572 5f70 6f73 5f6f 7267 293a 696e  (cur_pos_org):in
-0008f4b0: 7428 6375 725f 706f 735f 6f72 672b 6e29  t(cur_pos_org+n)
-0008f4c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0008f4d0: 2020 736e 7620 3d20 534e 5628 2067 656e    snv = SNV( gen
-0008f4e0: 6f6d 652e 6e61 6d65 2c20 6375 725f 706f  ome.name, cur_po
-0008f4f0: 735f 6e65 772b 312c 2063 7572 5f70 6f73  s_new+1, cur_pos
-0008f500: 5f6f 7267 2b31 2c20 2744 272c 206e 2c20  _org+1, 'D', n, 
-0008f510: 272d 272c 2073 6571 5f66 7261 672c 2053  '-', seq_frag, S
-0008f520: 7461 7274 2c20 456e 6420 2920 2320 6d61  tart, End ) # ma
-0008f530: 6b65 2069 7420 6f6e 652d 6261 7365 2070  ke it one-base p
-0008f540: 6f73 6974 696f 6e0a 2020 2020 2020 2020  osition.        
-0008f550: 2020 2020 2020 2020 736e 765f 6c73 742e          snv_lst.
-0008f560: 6170 7065 6e64 2873 6e76 290a 2020 2020  append(snv).    
-0008f570: 2020 2020 2020 2020 2020 2020 6375 725f              cur_
-0008f580: 706f 735f 6f72 6720 2b3d 206e 0a0a 2020  pos_org += n..  
-0008f590: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-0008f5a0: 2320 534e 500a 2020 2020 2020 2020 2020  # SNP.          
-0008f5b0: 2020 2020 2020 6e20 3d20 6e70 2e72 616e        n = np.ran
-0008f5c0: 646f 6d2e 7261 6e64 696e 7428 302c 6c76  dom.randint(0,lv
-0008f5d0: 2c20 3129 5b30 5d2b 3120 2020 2020 2020  , 1)[0]+1       
-0008f5e0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0008f5f0: 2020 7365 715f 746d 7020 3d20 6765 6e6f    seq_tmp = geno
-0008f600: 6d65 2e73 6571 5b69 6e74 2863 7572 5f70  me.seq[int(cur_p
-0008f610: 6f73 5f6f 7267 293a 696e 7428 6375 725f  os_org):int(cur_
-0008f620: 706f 735f 6f72 672b 6e29 5d0a 2020 2020  pos_org+n)].    
-0008f630: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
-0008f640: 6672 6167 203d 2072 616e 645f 6e75 636c  frag = rand_nucl
-0008f650: 656f 7469 6465 5f65 7863 6570 7428 7365  eotide_except(se
-0008f660: 715f 746d 7029 0a20 2020 2020 2020 2020  q_tmp).         
-0008f670: 2020 2020 2020 2023 2073 6571 5f6e 6577         # seq_new
-0008f680: 203d 2073 6571 5f6e 6577 202b 2073 6571   = seq_new + seq
-0008f690: 5f66 7261 670a 2020 2020 2020 2020 2020  _frag.          
-0008f6a0: 2020 2020 2020 7365 715f 6c73 742e 6170        seq_lst.ap
-0008f6b0: 7065 6e64 2873 6571 5f66 7261 6729 0a20  pend(seq_frag). 
-0008f6c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f6d0: 6e76 203d 2053 4e56 2820 6765 6e6f 6d65  nv = SNV( genome
-0008f6e0: 2e6e 616d 652c 2063 7572 5f70 6f73 5f6e  .name, cur_pos_n
-0008f6f0: 6577 2b31 2c20 6375 725f 706f 735f 6f72  ew+1, cur_pos_or
-0008f700: 672b 312c 2027 5627 2c20 6e2c 2073 6571  g+1, 'V', n, seq
-0008f710: 5f66 7261 672c 2073 6571 5f74 6d70 2c20  _frag, seq_tmp, 
-0008f720: 5374 6172 742c 2045 6e64 2029 2023 206d  Start, End ) # m
-0008f730: 616b 6520 6974 206f 6e65 2d62 6173 6520  ake it one-base 
-0008f740: 706f 7369 7469 6f6e 0a20 2020 2020 2020  position.       
-0008f750: 2020 2020 2020 2020 2073 6e76 5f6c 7374           snv_lst
-0008f760: 2e61 7070 656e 6428 736e 7629 0a20 2020  .append(snv).   
-0008f770: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0008f780: 5f70 6f73 5f6e 6577 202b 3d20 6e0a 2020  _pos_new += n.  
-0008f790: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0008f7a0: 725f 706f 735f 6f72 6720 2b3d 206e 0a0a  r_pos_org += n..
-0008f7b0: 2020 2020 2020 2020 2020 2020 4c20 3d20              L = 
-0008f7c0: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
-0008f7d0: 7428 3230 2c6d 752c 3129 5b30 5d20 2320  t(20,mu,1)[0] # 
-0008f7e0: 7365 7061 7261 7465 2053 4e56 2061 7420  separate SNV at 
-0008f7f0: 6c65 6173 7420 3230 2062 6173 6573 0a20  least 20 bases. 
-0008f800: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-0008f810: 706f 735f 6f72 6720 3d20 6375 725f 706f  pos_org = cur_po
-0008f820: 735f 6f72 6720 2b20 4c0a 2020 2020 2020  s_org + L.      
-0008f830: 2020 2020 2020 6966 206e 6578 745f 706f        if next_po
-0008f840: 735f 6f72 6720 3e3d 206c 696e 652e 656e  s_org >= line.en
-0008f850: 643a 2023 2028 6765 6e6f 6d65 2e6c 656e  d: # (genome.len
-0008f860: 2d31 3030 293a 0a20 2020 2020 2020 2020  -100):.         
-0008f870: 2020 2020 2020 2023 2073 6571 5f6e 6577         # seq_new
-0008f880: 203d 2073 6571 5f6e 6577 202b 2067 656e   = seq_new + gen
-0008f890: 6f6d 652e 7365 715b 696e 7428 6375 725f  ome.seq[int(cur_
-0008f8a0: 706f 735f 6f72 6729 3a5d 0a20 2020 2020  pos_org):].     
-0008f8b0: 2020 2020 2020 2020 2020 2073 6571 5f6c             seq_l
-0008f8c0: 7374 2e61 7070 656e 6428 6765 6e6f 6d65  st.append(genome
-0008f8d0: 2e73 6571 5b69 6e74 2863 7572 5f70 6f73  .seq[int(cur_pos
-0008f8e0: 5f6f 7267 293a 286c 696e 652e 656e 642b  _org):(line.end+
-0008f8f0: 3129 5d29 0a20 2020 2020 2020 2020 2020  1)]).           
-0008f900: 2020 2020 2063 7572 5f70 6f73 5f6e 6577       cur_pos_new
-0008f910: 202b 3d20 2828 6c69 6e65 2e65 6e64 2b31   += ((line.end+1
-0008f920: 292d 6375 725f 706f 735f 6f72 6729 0a20  )-cur_pos_org). 
-0008f930: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0008f940: 7572 5f70 6f73 5f6f 7267 203d 2028 6c69  ur_pos_org = (li
-0008f950: 6e65 2e65 6e64 2b31 290a 2020 2020 2020  ne.end+1).      
-0008f960: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0008f970: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0008f980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0008f990: 2020 2320 7365 715f 6e65 7720 3d20 7365    # seq_new = se
-0008f9a0: 715f 6e65 7720 2b20 6765 6e6f 6d65 2e73  q_new + genome.s
-0008f9b0: 6571 5b69 6e74 2863 7572 5f70 6f73 5f6f  eq[int(cur_pos_o
-0008f9c0: 7267 293a 696e 7428 6e65 7874 5f70 6f73  rg):int(next_pos
-0008f9d0: 5f6f 7267 295d 0a20 2020 2020 2020 2020  _org)].         
-0008f9e0: 2020 2020 2020 2073 6571 5f6c 7374 2e61         seq_lst.a
-0008f9f0: 7070 656e 6428 6765 6e6f 6d65 2e73 6571  ppend(genome.seq
-0008fa00: 5b69 6e74 2863 7572 5f70 6f73 5f6f 7267  [int(cur_pos_org
-0008fa10: 293a 696e 7428 6e65 7874 5f70 6f73 5f6f  ):int(next_pos_o
-0008fa20: 7267 295d 290a 2020 2020 2020 2020 2020  rg)]).          
-0008fa30: 2020 2020 2020 6375 725f 706f 735f 6e65        cur_pos_ne
-0008fa40: 7720 2b3d 2028 6e65 7874 5f70 6f73 5f6f  w += (next_pos_o
-0008fa50: 7267 2d63 7572 5f70 6f73 5f6f 7267 290a  rg-cur_pos_org).
-0008fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008fa70: 6375 725f 706f 735f 6f72 6720 3d20 6e65  cur_pos_org = ne
-0008fa80: 7874 5f70 6f73 5f6f 7267 0a20 2020 2020  xt_pos_org.     
-0008fa90: 2020 2020 2020 2063 6e74 202b 3d20 310a         cnt += 1.
-0008faa0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0008fab0: 6e74 2573 7465 7020 3d3d 2030 3a20 0a20  nt%step == 0: . 
-0008fac0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0008fad0: 7269 6e74 2827 5c72 2573 202d 2025 692c  rint('\r%s - %i,
-0008fae0: 2025 692c 2025 6920 2720 2520 2867 656e   %i, %i ' % (gen
-0008faf0: 6f6d 652e 6e61 6d65 2c20 6375 725f 706f  ome.name, cur_po
-0008fb00: 735f 6f72 672c 2067 656e 6f6d 652e 6c65  s_org, genome.le
-0008fb10: 6e2c 2063 7572 5f70 6f73 5f6e 6577 292c  n, cur_pos_new),
-0008fb20: 2065 6e64 3d27 2729 0a20 2020 2020 2020   end='').       
-0008fb30: 0a20 2020 2069 6620 6375 725f 706f 735f  .    if cur_pos_
-0008fb40: 6f72 6720 3c20 6765 6e6f 6d65 2e6c 656e  org < genome.len
-0008fb50: 3a0a 2020 2020 2020 2020 7365 715f 6c73  :.        seq_ls
-0008fb60: 742e 6170 7065 6e64 2867 656e 6f6d 652e  t.append(genome.
-0008fb70: 7365 715b 696e 7428 6375 725f 706f 735f  seq[int(cur_pos_
-0008fb80: 6f72 6729 3a5d 290a 2020 2020 0a20 2020  org):]).    .   
-0008fb90: 2073 6571 5f6e 6577 203d 2027 272e 6a6f   seq_new = ''.jo
-0008fba0: 696e 2873 6571 5f6c 7374 290a 2020 2020  in(seq_lst).    
-0008fbb0: 2320 7375 6666 6978 203d 2027 2d4c 2569  # suffix = '-L%i
-0008fbc0: 2d49 2569 2d44 2569 2d56 2569 2720 2520  -I%i-D%i-V%i' % 
-0008fbd0: 286d 752c 6c69 2c6c 642c 6c76 290a 2020  (mu,li,ld,lv).  
-0008fbe0: 2020 2320 6765 6e6f 6d65 5f6e 6577 203d    # genome_new =
-0008fbf0: 2047 656e 6f6d 6528 2067 656e 6f6d 652e   Genome( genome.
-0008fc00: 6865 6164 6572 202b 2073 7566 6669 782c  header + suffix,
-0008fc10: 2073 6571 5f6e 6577 2029 0a20 2020 2067   seq_new ).    g
-0008fc20: 656e 6f6d 655f 6e65 7720 3d20 4765 6e6f  enome_new = Geno
-0008fc30: 6d65 2820 6765 6e6f 6d65 2e68 6561 6465  me( genome.heade
-0008fc40: 722c 2073 6571 5f6e 6577 2029 0a20 2020  r, seq_new ).   
-0008fc50: 2070 7269 6e74 2827 2064 6f6e 652e 2729   print(' done.')
-0008fc60: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0008fc70: 2020 7265 7475 726e 2867 656e 6f6d 655f    return(genome_
-0008fc80: 6e65 772c 2073 6e76 5f6c 7374 290a 2020  new, snv_lst).  
-0008fc90: 2020 0a23 2323 2323 2323 2323 2323 2323    .#############
-0008fca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008fcb0: 2323 230a 2323 2050 6172 616d 6574 6572  ###.## Parameter
-0008fcc0: 7320 666f 7220 534e 5620 6765 6e65 7261  s for SNV genera
-0008fcd0: 7469 6f6e 0a0a 505f 494e 5320 3d20 302e  tion..P_INS = 0.
-0008fce0: 3135 0a50 5f44 454c 203d 2030 2e31 350a  15.P_DEL = 0.15.
-0008fcf0: 505f 534e 5020 3d20 3120 2d20 505f 494e  P_SNP = 1 - P_IN
-0008fd00: 5320 2d20 505f 4445 4c0a 0a4c 4920 3d20  S - P_DEL..LI = 
-0008fd10: 330a 4c44 203d 2033 0a4c 5620 3d20 320a  3.LD = 3.LV = 2.
-0008fd20: 4c5f 494e 5445 525f 534e 5620 3d20 3230  L_INTER_SNV = 20
-0008fd30: 300a 0a23 2323 2323 2323 2323 2323 2323  0..#############
-0008fd40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0008fd50: 2323 230a 0a64 6566 2067 656e 6572 6174  ###..def generat
-0008fd60: 655f 736e 7628 6765 6e6f 6d65 2c20 6774  e_snv(genome, gt
-0008fd70: 665f 6c69 6e65 732c 206c 5f69 6e74 6572  f_lines, l_inter
-0008fd80: 5f73 6e76 203d 204c 5f49 4e54 4552 5f53  _snv = L_INTER_S
-0008fd90: 4e56 2c20 5c0a 2020 2020 2020 2020 2020  NV, \.          
-0008fda0: 2020 2020 2020 206c 6920 3d20 4c49 2c20         li = LI, 
-0008fdb0: 6c64 203d 204c 442c 206c 7620 3d20 4c56  ld = LD, lv = LV
-0008fdc0: 2c20 7069 203d 2050 5f49 4e53 2c20 7064  , pi = P_INS, pd
-0008fdd0: 203d 2050 5f44 454c 293a 0a20 2020 200a   = P_DEL):.    .
-0008fde0: 2020 2020 7076 203d 2031 202d 2070 6920      pv = 1 - pi 
-0008fdf0: 2d20 7064 0a20 2020 206e 702e 7261 6e64  - pd.    np.rand
-0008fe00: 6f6d 2e73 6565 6428 3029 0a20 2020 2070  om.seed(0).    p
-0008fe10: 7269 6e74 2827 4765 6e65 7261 7469 6e67  rint('Generating
-0008fe20: 2053 4e56 2027 2c65 6e64 3d27 2729 0a20   SNV ',end=''). 
-0008fe30: 2020 2046 6561 7475 7265 7320 3d20 6765     Features = ge
-0008fe40: 745f 636f 6c28 6774 665f 6c69 6e65 732c  t_col(gtf_lines,
-0008fe50: 2032 290a 2020 2020 7768 203d 2077 6869   2).    wh = whi
-0008fe60: 6368 2820 4665 6174 7572 6573 2c20 2765  ch( Features, 'e
-0008fe70: 786f 6e27 2029 0a20 2020 2067 7466 5f65  xon' ).    gtf_e
-0008fe80: 786f 6e73 203d 205b 6774 665f 6c69 6e65  xons = [gtf_line
-0008fe90: 735b 775d 2066 6f72 2077 2069 6e20 7768  s[w] for w in wh
-0008fea0: 5d20 0a0a 2020 2020 2320 7072 696e 7428  ] ..    # print(
-0008feb0: 6c65 6e28 4665 6174 7572 6573 2929 0a20  len(Features)). 
-0008fec0: 2020 2043 6872 7320 3d20 6765 745f 636f     Chrs = get_co
-0008fed0: 6c28 6774 665f 6578 6f6e 732c 2030 290a  l(gtf_exons, 0).
-0008fee0: 2020 2020 4368 725f 6e61 6d65 7320 3d20      Chr_names = 
-0008fef0: 736f 7274 6564 2873 6574 2843 6872 7329  sorted(set(Chrs)
-0008ff00: 290a 0a20 2020 2073 6e76 5f6c 7374 5f61  )..    snv_lst_a
-0008ff10: 6c6c 203d 205b 5d0a 2020 2020 6765 6e6f  ll = [].    geno
-0008ff20: 6d65 5f6e 6577 203d 207b 7d0a 2020 2020  me_new = {}.    
-0008ff30: 666f 7220 4368 7220 696e 2043 6872 5f6e  for Chr in Chr_n
-0008ff40: 616d 6573 3a0a 2020 2020 2020 2020 0a20  ames:.        . 
-0008ff50: 2020 2020 2020 2069 6620 4368 7220 696e         if Chr in
-0008ff60: 2067 656e 6f6d 652e 6b65 7973 2829 3a0a   genome.keys():.
-0008ff70: 2020 2020 2020 2020 2020 2020 7768 203d              wh =
-0008ff80: 2077 6869 6368 2820 4368 7273 2c20 4368   which( Chrs, Ch
-0008ff90: 7220 290a 2020 2020 2020 2020 2020 2020  r ).            
-0008ffa0: 6774 665f 6368 7220 3d20 5b67 7466 5f65  gtf_chr = [gtf_e
-0008ffb0: 786f 6e73 5b77 5d20 666f 7220 7720 696e  xons[w] for w in
-0008ffc0: 2077 685d 0a20 2020 2020 2020 2020 2020   wh].           
-0008ffd0: 2050 6f73 5f73 7461 7274 203d 206e 702e   Pos_start = np.
-0008ffe0: 6172 7261 7928 2067 6574 5f63 6f6c 2867  array( get_col(g
-0008fff0: 7466 5f63 6872 2c20 3329 2029 0a20 2020  tf_chr, 3) ).   
-00090000: 2020 2020 2020 2020 206f 6472 203d 2050           odr = P
-00090010: 6f73 5f73 7461 7274 2e61 7267 736f 7274  os_start.argsort
-00090020: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00090030: 6774 665f 6368 725f 736f 7274 6564 203d  gtf_chr_sorted =
-00090040: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00090050: 7070 203d 2030 0a20 2020 2020 2020 2020  pp = 0.         
-00090060: 2020 2066 6f72 206b 2069 6e20 7261 6e67     for k in rang
-00090070: 6528 6c65 6e28 6774 665f 6368 7229 293a  e(len(gtf_chr)):
-00090080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00090090: 206c 696e 6520 3d20 6774 665f 6368 725b   line = gtf_chr[
-000900a0: 6f64 725b 6b5d 5d0a 2020 2020 2020 2020  odr[k]].        
-000900b0: 2020 2020 2020 2020 6774 665f 6368 725f          gtf_chr_
-000900c0: 736f 7274 6564 2e61 7070 656e 6428 6c69  sorted.append(li
-000900d0: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-000900e0: 2020 2020 6966 206c 696e 652e 7374 6172      if line.star
-000900f0: 7420 3c20 7070 3a20 7072 696e 7428 6c69  t < pp: print(li
-00090100: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-00090110: 2020 2020 7070 203d 206c 696e 652e 7374      pp = line.st
-00090120: 6172 740a 0a20 2020 2020 2020 2020 2020  art..           
-00090130: 2067 6e6d 2c20 736e 765f 6c73 7420 3d20   gnm, snv_lst = 
-00090140: 6765 6e65 7261 7465 5f73 6e76 5f77 6974  generate_snv_wit
-00090150: 685f 6774 6628 2067 656e 6f6d 655b 4368  h_gtf( genome[Ch
-00090160: 725d 2c20 6774 665f 6368 725f 736f 7274  r], gtf_chr_sort
-00090170: 6564 2c20 6d75 203d 206c 5f69 6e74 6572  ed, mu = l_inter
-00090180: 5f73 6e76 2c20 5c0a 2020 2020 2020 2020  _snv, \.        
-00090190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000901a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000901b0: 2020 2020 2020 2020 2020 6c69 203d 206c            li = l
-000901c0: 692c 206c 6420 3d20 6c64 2c20 6c76 203d  i, ld = ld, lv =
-000901d0: 206c 762c 2070 6920 3d20 7069 2c20 7064   lv, pi = pi, pd
-000901e0: 203d 2070 6420 290a 2020 2020 2020 2020   = pd ).        
-000901f0: 2020 2020 736e 765f 6c73 745f 616c 6c20      snv_lst_all 
-00090200: 3d20 736e 765f 6c73 745f 616c 6c20 2b20  = snv_lst_all + 
-00090210: 736e 765f 6c73 740a 2020 2020 2020 2020  snv_lst.        
-00090220: 2020 2020 6765 6e6f 6d65 5f6e 6577 5b43      genome_new[C
-00090230: 6872 5d20 3d20 676e 6d0a 2020 2020 200a  hr] = gnm.     .
-00090240: 2020 2020 7265 7475 726e 2867 656e 6f6d      return(genom
-00090250: 655f 6e65 772c 2073 6e76 5f6c 7374 5f61  e_new, snv_lst_a
-00090260: 6c6c 2c20 4665 6174 7572 6573 290a 2020  ll, Features).  
-00090270: 2020 0a23 2323 2323 2323 2323 2323 2323    .#############
-00090280: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000902a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000902b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000902c0: 2323 2323 230a 2323 2046 756e 6374 696f  #####.## Functio
-000902d0: 6e73 2066 6f72 2065 7661 6c75 6174 696f  ns for evaluatio
-000902e0: 6e20 6f66 2053 4e56 2064 6574 6563 7469  n of SNV detecti
-000902f0: 6f6e 0a23 2323 2323 2323 2323 2323 2323  on.#############
+0008f350: 2320 7365 715f 6e65 7720 3d20 7365 715f  # seq_new = seq_
+0008f360: 6e65 7720 2b20 7365 715f 6672 6167 0a20  new + seq_frag. 
+0008f370: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008f380: 6571 5f6c 7374 2e61 7070 656e 6428 7365  eq_lst.append(se
+0008f390: 715f 6672 6167 290a 2020 2020 2020 2020  q_frag).        
+0008f3a0: 2020 2020 2020 2020 736e 7620 3d20 534e          snv = SN
+0008f3b0: 5628 2067 656e 6f6d 652e 6e61 6d65 2c20  V( genome.name, 
+0008f3c0: 6375 725f 706f 735f 6e65 772b 312c 2063  cur_pos_new+1, c
+0008f3d0: 7572 5f70 6f73 5f6f 7267 2b31 2c20 2749  ur_pos_org+1, 'I
+0008f3e0: 272c 206e 2c20 7365 715f 6672 6167 2c20  ', n, seq_frag, 
+0008f3f0: 272d 272c 2053 7461 7274 2c20 456e 6420  '-', Start, End 
+0008f400: 2920 2320 6d61 6b65 2069 7420 6f6e 652d  ) # make it one-
+0008f410: 6261 7365 2070 6f73 6974 696f 6e0a 2020  base position.  
+0008f420: 2020 2020 2020 2020 2020 2020 2020 736e                sn
+0008f430: 765f 6c73 742e 6170 7065 6e64 2873 6e76  v_lst.append(snv
+0008f440: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0008f450: 2020 6375 725f 706f 735f 6e65 7720 2b3d    cur_pos_new +=
+0008f460: 206c 656e 2873 6571 5f66 7261 6729 0a0a   len(seq_frag)..
+0008f470: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0008f480: 2073 6e76 5f74 7970 6520 3d3d 2032 3a20   snv_type == 2: 
+0008f490: 2320 4465 6c65 7469 6f6e 0a20 2020 2020  # Deletion.     
+0008f4a0: 2020 2020 2020 2020 2020 206e 203d 206e             n = n
+0008f4b0: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
+0008f4c0: 2830 2c6c 642c 2031 295b 305d 2b31 0a20  (0,ld, 1)[0]+1. 
+0008f4d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008f4e0: 6571 5f66 7261 6720 3d20 6765 6e6f 6d65  eq_frag = genome
+0008f4f0: 2e73 6571 5b69 6e74 2863 7572 5f70 6f73  .seq[int(cur_pos
+0008f500: 5f6f 7267 293a 696e 7428 6375 725f 706f  _org):int(cur_po
+0008f510: 735f 6f72 672b 6e29 5d0a 2020 2020 2020  s_org+n)].      
+0008f520: 2020 2020 2020 2020 2020 736e 7620 3d20            snv = 
+0008f530: 534e 5628 2067 656e 6f6d 652e 6e61 6d65  SNV( genome.name
+0008f540: 2c20 6375 725f 706f 735f 6e65 772b 312c  , cur_pos_new+1,
+0008f550: 2063 7572 5f70 6f73 5f6f 7267 2b31 2c20   cur_pos_org+1, 
+0008f560: 2744 272c 206e 2c20 272d 272c 2073 6571  'D', n, '-', seq
+0008f570: 5f66 7261 672c 2053 7461 7274 2c20 456e  _frag, Start, En
+0008f580: 6420 2920 2320 6d61 6b65 2069 7420 6f6e  d ) # make it on
+0008f590: 652d 6261 7365 2070 6f73 6974 696f 6e0a  e-base position.
+0008f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f5b0: 736e 765f 6c73 742e 6170 7065 6e64 2873  snv_lst.append(s
+0008f5c0: 6e76 290a 2020 2020 2020 2020 2020 2020  nv).            
+0008f5d0: 2020 2020 6375 725f 706f 735f 6f72 6720      cur_pos_org 
+0008f5e0: 2b3d 206e 0a0a 2020 2020 2020 2020 2020  += n..          
+0008f5f0: 2020 656c 7365 3a20 2320 534e 500a 2020    else: # SNP.  
+0008f600: 2020 2020 2020 2020 2020 2020 2020 6e20                n 
+0008f610: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+0008f620: 696e 7428 302c 6c76 2c20 3129 5b30 5d2b  int(0,lv, 1)[0]+
+0008f630: 3120 2020 2020 2020 200a 2020 2020 2020  1        .      
+0008f640: 2020 2020 2020 2020 2020 7365 715f 746d            seq_tm
+0008f650: 7020 3d20 6765 6e6f 6d65 2e73 6571 5b69  p = genome.seq[i
+0008f660: 6e74 2863 7572 5f70 6f73 5f6f 7267 293a  nt(cur_pos_org):
+0008f670: 696e 7428 6375 725f 706f 735f 6f72 672b  int(cur_pos_org+
+0008f680: 6e29 5d0a 2020 2020 2020 2020 2020 2020  n)].            
+0008f690: 2020 2020 7365 715f 6672 6167 203d 2072      seq_frag = r
+0008f6a0: 616e 645f 6e75 636c 656f 7469 6465 5f65  and_nucleotide_e
+0008f6b0: 7863 6570 7428 7365 715f 746d 7029 0a20  xcept(seq_tmp). 
+0008f6c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0008f6d0: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
+0008f6e0: 6577 202b 2073 6571 5f66 7261 670a 2020  ew + seq_frag.  
+0008f6f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0008f700: 715f 6c73 742e 6170 7065 6e64 2873 6571  q_lst.append(seq
+0008f710: 5f66 7261 6729 0a20 2020 2020 2020 2020  _frag).         
+0008f720: 2020 2020 2020 2073 6e76 203d 2053 4e56         snv = SNV
+0008f730: 2820 6765 6e6f 6d65 2e6e 616d 652c 2063  ( genome.name, c
+0008f740: 7572 5f70 6f73 5f6e 6577 2b31 2c20 6375  ur_pos_new+1, cu
+0008f750: 725f 706f 735f 6f72 672b 312c 2027 5627  r_pos_org+1, 'V'
+0008f760: 2c20 6e2c 2073 6571 5f66 7261 672c 2073  , n, seq_frag, s
+0008f770: 6571 5f74 6d70 2c20 5374 6172 742c 2045  eq_tmp, Start, E
+0008f780: 6e64 2029 2023 206d 616b 6520 6974 206f  nd ) # make it o
+0008f790: 6e65 2d62 6173 6520 706f 7369 7469 6f6e  ne-base position
+0008f7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008f7b0: 2073 6e76 5f6c 7374 2e61 7070 656e 6428   snv_lst.append(
+0008f7c0: 736e 7629 0a20 2020 2020 2020 2020 2020  snv).           
+0008f7d0: 2020 2020 2063 7572 5f70 6f73 5f6e 6577       cur_pos_new
+0008f7e0: 202b 3d20 6e0a 2020 2020 2020 2020 2020   += n.          
+0008f7f0: 2020 2020 2020 6375 725f 706f 735f 6f72        cur_pos_or
+0008f800: 6720 2b3d 206e 0a0a 2020 2020 2020 2020  g += n..        
+0008f810: 2020 2020 4c20 3d20 6e70 2e72 616e 646f      L = np.rando
+0008f820: 6d2e 7261 6e64 696e 7428 3230 2c6d 752c  m.randint(20,mu,
+0008f830: 3129 5b30 5d20 2320 7365 7061 7261 7465  1)[0] # separate
+0008f840: 2053 4e56 2061 7420 6c65 6173 7420 3230   SNV at least 20
+0008f850: 2062 6173 6573 0a20 2020 2020 2020 2020   bases.         
+0008f860: 2020 206e 6578 745f 706f 735f 6f72 6720     next_pos_org 
+0008f870: 3d20 6375 725f 706f 735f 6f72 6720 2b20  = cur_pos_org + 
+0008f880: 4c0a 2020 2020 2020 2020 2020 2020 6966  L.            if
+0008f890: 206e 6578 745f 706f 735f 6f72 6720 3e3d   next_pos_org >=
+0008f8a0: 206c 696e 652e 656e 643a 2023 2028 6765   line.end: # (ge
+0008f8b0: 6e6f 6d65 2e6c 656e 2d31 3030 293a 0a20  nome.len-100):. 
+0008f8c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0008f8d0: 2073 6571 5f6e 6577 203d 2073 6571 5f6e   seq_new = seq_n
+0008f8e0: 6577 202b 2067 656e 6f6d 652e 7365 715b  ew + genome.seq[
+0008f8f0: 696e 7428 6375 725f 706f 735f 6f72 6729  int(cur_pos_org)
+0008f900: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+0008f910: 2020 2073 6571 5f6c 7374 2e61 7070 656e     seq_lst.appen
+0008f920: 6428 6765 6e6f 6d65 2e73 6571 5b69 6e74  d(genome.seq[int
+0008f930: 2863 7572 5f70 6f73 5f6f 7267 293a 286c  (cur_pos_org):(l
+0008f940: 696e 652e 656e 642b 3129 5d29 0a20 2020  ine.end+1)]).   
+0008f950: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0008f960: 5f70 6f73 5f6e 6577 202b 3d20 2828 6c69  _pos_new += ((li
+0008f970: 6e65 2e65 6e64 2b31 292d 6375 725f 706f  ne.end+1)-cur_po
+0008f980: 735f 6f72 6729 0a20 2020 2020 2020 2020  s_org).         
+0008f990: 2020 2020 2020 2063 7572 5f70 6f73 5f6f         cur_pos_o
+0008f9a0: 7267 203d 2028 6c69 6e65 2e65 6e64 2b31  rg = (line.end+1
+0008f9b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0008f9c0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0008f9d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0008f9e0: 2020 2020 2020 2020 2020 2320 7365 715f            # seq_
+0008f9f0: 6e65 7720 3d20 7365 715f 6e65 7720 2b20  new = seq_new + 
+0008fa00: 6765 6e6f 6d65 2e73 6571 5b69 6e74 2863  genome.seq[int(c
+0008fa10: 7572 5f70 6f73 5f6f 7267 293a 696e 7428  ur_pos_org):int(
+0008fa20: 6e65 7874 5f70 6f73 5f6f 7267 295d 0a20  next_pos_org)]. 
+0008fa30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008fa40: 6571 5f6c 7374 2e61 7070 656e 6428 6765  eq_lst.append(ge
+0008fa50: 6e6f 6d65 2e73 6571 5b69 6e74 2863 7572  nome.seq[int(cur
+0008fa60: 5f70 6f73 5f6f 7267 293a 696e 7428 6e65  _pos_org):int(ne
+0008fa70: 7874 5f70 6f73 5f6f 7267 295d 290a 2020  xt_pos_org)]).  
+0008fa80: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0008fa90: 725f 706f 735f 6e65 7720 2b3d 2028 6e65  r_pos_new += (ne
+0008faa0: 7874 5f70 6f73 5f6f 7267 2d63 7572 5f70  xt_pos_org-cur_p
+0008fab0: 6f73 5f6f 7267 290a 2020 2020 2020 2020  os_org).        
+0008fac0: 2020 2020 2020 2020 6375 725f 706f 735f          cur_pos_
+0008fad0: 6f72 6720 3d20 6e65 7874 5f70 6f73 5f6f  org = next_pos_o
+0008fae0: 7267 0a20 2020 2020 2020 2020 2020 2063  rg.            c
+0008faf0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+0008fb00: 2020 2020 6966 2063 6e74 2573 7465 7020      if cnt%step 
+0008fb10: 3d3d 2030 3a20 0a20 2020 2020 2020 2020  == 0: .         
+0008fb20: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+0008fb30: 2573 202d 2025 692c 2025 692c 2025 6920  %s - %i, %i, %i 
+0008fb40: 2720 2520 2867 656e 6f6d 652e 6e61 6d65  ' % (genome.name
+0008fb50: 2c20 6375 725f 706f 735f 6f72 672c 2067  , cur_pos_org, g
+0008fb60: 656e 6f6d 652e 6c65 6e2c 2063 7572 5f70  enome.len, cur_p
+0008fb70: 6f73 5f6e 6577 292c 2065 6e64 3d27 2729  os_new), end='')
+0008fb80: 0a20 2020 2020 2020 0a20 2020 2069 6620  .       .    if 
+0008fb90: 6375 725f 706f 735f 6f72 6720 3c20 6765  cur_pos_org < ge
+0008fba0: 6e6f 6d65 2e6c 656e 3a0a 2020 2020 2020  nome.len:.      
+0008fbb0: 2020 7365 715f 6c73 742e 6170 7065 6e64    seq_lst.append
+0008fbc0: 2867 656e 6f6d 652e 7365 715b 696e 7428  (genome.seq[int(
+0008fbd0: 6375 725f 706f 735f 6f72 6729 3a5d 290a  cur_pos_org):]).
+0008fbe0: 2020 2020 0a20 2020 2073 6571 5f6e 6577      .    seq_new
+0008fbf0: 203d 2027 272e 6a6f 696e 2873 6571 5f6c   = ''.join(seq_l
+0008fc00: 7374 290a 2020 2020 2320 7375 6666 6978  st).    # suffix
+0008fc10: 203d 2027 2d4c 2569 2d49 2569 2d44 2569   = '-L%i-I%i-D%i
+0008fc20: 2d56 2569 2720 2520 286d 752c 6c69 2c6c  -V%i' % (mu,li,l
+0008fc30: 642c 6c76 290a 2020 2020 2320 6765 6e6f  d,lv).    # geno
+0008fc40: 6d65 5f6e 6577 203d 2047 656e 6f6d 6528  me_new = Genome(
+0008fc50: 2067 656e 6f6d 652e 6865 6164 6572 202b   genome.header +
+0008fc60: 2073 7566 6669 782c 2073 6571 5f6e 6577   suffix, seq_new
+0008fc70: 2029 0a20 2020 2067 656e 6f6d 655f 6e65   ).    genome_ne
+0008fc80: 7720 3d20 4765 6e6f 6d65 2820 6765 6e6f  w = Genome( geno
+0008fc90: 6d65 2e68 6561 6465 722c 2073 6571 5f6e  me.header, seq_n
+0008fca0: 6577 2029 0a20 2020 2070 7269 6e74 2827  ew ).    print('
+0008fcb0: 2064 6f6e 652e 2729 0a20 2020 2020 2020   done.').       
+0008fcc0: 2020 2020 200a 2020 2020 7265 7475 726e       .    return
+0008fcd0: 2867 656e 6f6d 655f 6e65 772c 2073 6e76  (genome_new, snv
+0008fce0: 5f6c 7374 290a 2020 2020 0a23 2323 2323  _lst).    .#####
+0008fcf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008fd00: 2323 2323 2323 2323 2323 230a 2323 2050  ###########.## P
+0008fd10: 6172 616d 6574 6572 7320 666f 7220 534e  arameters for SN
+0008fd20: 5620 6765 6e65 7261 7469 6f6e 0a0a 505f  V generation..P_
+0008fd30: 494e 5320 3d20 302e 3135 0a50 5f44 454c  INS = 0.15.P_DEL
+0008fd40: 203d 2030 2e31 350a 505f 534e 5020 3d20   = 0.15.P_SNP = 
+0008fd50: 3120 2d20 505f 494e 5320 2d20 505f 4445  1 - P_INS - P_DE
+0008fd60: 4c0a 0a4c 4920 3d20 330a 4c44 203d 2033  L..LI = 3.LD = 3
+0008fd70: 0a4c 5620 3d20 320a 4c5f 494e 5445 525f  .LV = 2.L_INTER_
+0008fd80: 534e 5620 3d20 3230 300a 0a23 2323 2323  SNV = 200..#####
+0008fd90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0008fda0: 2323 2323 2323 2323 2323 230a 0a64 6566  ###########..def
+0008fdb0: 2067 656e 6572 6174 655f 736e 7628 6765   generate_snv(ge
+0008fdc0: 6e6f 6d65 2c20 6774 665f 6c69 6e65 732c  nome, gtf_lines,
+0008fdd0: 206c 5f69 6e74 6572 5f73 6e76 203d 204c   l_inter_snv = L
+0008fde0: 5f49 4e54 4552 5f53 4e56 2c20 5c0a 2020  _INTER_SNV, \.  
+0008fdf0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0008fe00: 6920 3d20 4c49 2c20 6c64 203d 204c 442c  i = LI, ld = LD,
+0008fe10: 206c 7620 3d20 4c56 2c20 7069 203d 2050   lv = LV, pi = P
+0008fe20: 5f49 4e53 2c20 7064 203d 2050 5f44 454c  _INS, pd = P_DEL
+0008fe30: 293a 0a20 2020 200a 2020 2020 7076 203d  ):.    .    pv =
+0008fe40: 2031 202d 2070 6920 2d20 7064 0a20 2020   1 - pi - pd.   
+0008fe50: 206e 702e 7261 6e64 6f6d 2e73 6565 6428   np.random.seed(
+0008fe60: 3029 0a20 2020 2070 7269 6e74 2827 4765  0).    print('Ge
+0008fe70: 6e65 7261 7469 6e67 2053 4e56 2027 2c65  nerating SNV ',e
+0008fe80: 6e64 3d27 2729 0a20 2020 2046 6561 7475  nd='').    Featu
+0008fe90: 7265 7320 3d20 6765 745f 636f 6c28 6774  res = get_col(gt
+0008fea0: 665f 6c69 6e65 732c 2032 290a 2020 2020  f_lines, 2).    
+0008feb0: 7768 203d 2077 6869 6368 2820 4665 6174  wh = which( Feat
+0008fec0: 7572 6573 2c20 2765 786f 6e27 2029 0a20  ures, 'exon' ). 
+0008fed0: 2020 2067 7466 5f65 786f 6e73 203d 205b     gtf_exons = [
+0008fee0: 6774 665f 6c69 6e65 735b 775d 2066 6f72  gtf_lines[w] for
+0008fef0: 2077 2069 6e20 7768 5d20 0a0a 2020 2020   w in wh] ..    
+0008ff00: 2320 7072 696e 7428 6c65 6e28 4665 6174  # print(len(Feat
+0008ff10: 7572 6573 2929 0a20 2020 2043 6872 7320  ures)).    Chrs 
+0008ff20: 3d20 6765 745f 636f 6c28 6774 665f 6578  = get_col(gtf_ex
+0008ff30: 6f6e 732c 2030 290a 2020 2020 4368 725f  ons, 0).    Chr_
+0008ff40: 6e61 6d65 7320 3d20 736f 7274 6564 2873  names = sorted(s
+0008ff50: 6574 2843 6872 7329 290a 0a20 2020 2073  et(Chrs))..    s
+0008ff60: 6e76 5f6c 7374 5f61 6c6c 203d 205b 5d0a  nv_lst_all = [].
+0008ff70: 2020 2020 6765 6e6f 6d65 5f6e 6577 203d      genome_new =
+0008ff80: 207b 7d0a 2020 2020 666f 7220 4368 7220   {}.    for Chr 
+0008ff90: 696e 2043 6872 5f6e 616d 6573 3a0a 2020  in Chr_names:.  
+0008ffa0: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
+0008ffb0: 6620 4368 7220 696e 2067 656e 6f6d 652e  f Chr in genome.
+0008ffc0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+0008ffd0: 2020 2020 7768 203d 2077 6869 6368 2820      wh = which( 
+0008ffe0: 4368 7273 2c20 4368 7220 290a 2020 2020  Chrs, Chr ).    
+0008fff0: 2020 2020 2020 2020 6774 665f 6368 7220          gtf_chr 
+00090000: 3d20 5b67 7466 5f65 786f 6e73 5b77 5d20  = [gtf_exons[w] 
+00090010: 666f 7220 7720 696e 2077 685d 0a20 2020  for w in wh].   
+00090020: 2020 2020 2020 2020 2050 6f73 5f73 7461           Pos_sta
+00090030: 7274 203d 206e 702e 6172 7261 7928 2067  rt = np.array( g
+00090040: 6574 5f63 6f6c 2867 7466 5f63 6872 2c20  et_col(gtf_chr, 
+00090050: 3329 2029 0a20 2020 2020 2020 2020 2020  3) ).           
+00090060: 206f 6472 203d 2050 6f73 5f73 7461 7274   odr = Pos_start
+00090070: 2e61 7267 736f 7274 2829 0a0a 2020 2020  .argsort()..    
+00090080: 2020 2020 2020 2020 6774 665f 6368 725f          gtf_chr_
+00090090: 736f 7274 6564 203d 205b 5d0a 2020 2020  sorted = [].    
+000900a0: 2020 2020 2020 2020 7070 203d 2030 0a20          pp = 0. 
+000900b0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+000900c0: 2069 6e20 7261 6e67 6528 6c65 6e28 6774   in range(len(gt
+000900d0: 665f 6368 7229 293a 0a20 2020 2020 2020  f_chr)):.       
+000900e0: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
+000900f0: 6774 665f 6368 725b 6f64 725b 6b5d 5d0a  gtf_chr[odr[k]].
+00090100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090110: 6774 665f 6368 725f 736f 7274 6564 2e61  gtf_chr_sorted.a
+00090120: 7070 656e 6428 6c69 6e65 290a 2020 2020  ppend(line).    
+00090130: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00090140: 696e 652e 7374 6172 7420 3c20 7070 3a20  ine.start < pp: 
+00090150: 7072 696e 7428 6c69 6e65 290a 2020 2020  print(line).    
+00090160: 2020 2020 2020 2020 2020 2020 7070 203d              pp =
+00090170: 206c 696e 652e 7374 6172 740a 0a20 2020   line.start..   
+00090180: 2020 2020 2020 2020 2067 6e6d 2c20 736e           gnm, sn
+00090190: 765f 6c73 7420 3d20 6765 6e65 7261 7465  v_lst = generate
+000901a0: 5f73 6e76 5f77 6974 685f 6774 6628 2067  _snv_with_gtf( g
+000901b0: 656e 6f6d 655b 4368 725d 2c20 6774 665f  enome[Chr], gtf_
+000901c0: 6368 725f 736f 7274 6564 2c20 6d75 203d  chr_sorted, mu =
+000901d0: 206c 5f69 6e74 6572 5f73 6e76 2c20 5c0a   l_inter_snv, \.
+000901e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000901f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090210: 2020 6c69 203d 206c 692c 206c 6420 3d20    li = li, ld = 
+00090220: 6c64 2c20 6c76 203d 206c 762c 2070 6920  ld, lv = lv, pi 
+00090230: 3d20 7069 2c20 7064 203d 2070 6420 290a  = pi, pd = pd ).
+00090240: 2020 2020 2020 2020 2020 2020 736e 765f              snv_
+00090250: 6c73 745f 616c 6c20 3d20 736e 765f 6c73  lst_all = snv_ls
+00090260: 745f 616c 6c20 2b20 736e 765f 6c73 740a  t_all + snv_lst.
+00090270: 2020 2020 2020 2020 2020 2020 6765 6e6f              geno
+00090280: 6d65 5f6e 6577 5b43 6872 5d20 3d20 676e  me_new[Chr] = gn
+00090290: 6d0a 2020 2020 200a 2020 2020 7265 7475  m.     .    retu
+000902a0: 726e 2867 656e 6f6d 655f 6e65 772c 2073  rn(genome_new, s
+000902b0: 6e76 5f6c 7374 5f61 6c6c 2c20 4665 6174  nv_lst_all, Feat
+000902c0: 7572 6573 290a 2020 2020 0a23 2323 2323  ures).    .#####
+000902d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000902e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000902f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00090300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00090340: 2323 2323 230a 0a64 6566 2067 6574 5f73  #####..def get_s
-00090350: 7061 6e5f 6c73 7428 7267 6e73 5f6c 7374  pan_lst(rgns_lst
-00090360: 5f6d 692c 2054 7970 6520 3d20 274d 2729  _mi, Type = 'M')
-00090370: 3a0a 2020 2020 0a20 2020 2073 7061 6e5f  :.    .    span_
-00090380: 6c73 7420 3d20 5b5d 0a20 2020 2066 6f72  lst = [].    for
-00090390: 2072 5f6d 2069 6e20 7267 6e73 5f6c 7374   r_m in rgns_lst
-000903a0: 5f6d 693a 0a20 2020 2020 2020 2073 706e  _mi:.        spn
-000903b0: 203d 2072 5f6d 2e67 6574 5f73 7061 6e28   = r_m.get_span(
-000903c0: 290a 2020 2020 2020 2020 7370 6e2e 7479  ).        spn.ty
-000903d0: 7065 203d 2054 7970 650a 2020 2020 2020  pe = Type.      
-000903e0: 2020 7370 616e 5f6c 7374 2e61 7070 656e    span_lst.appen
-000903f0: 6428 2073 706e 2029 0a20 2020 2072 6574  d( spn ).    ret
-00090400: 7572 6e28 7370 616e 5f6c 7374 290a 0a23  urn(span_lst)..#
-00090410: 2320 5365 6c65 6374 2053 4e56 2773 2074  # Select SNV's t
-00090420: 6861 7420 6661 6c6c 7320 7769 7468 696e  hat falls within
-00090430: 2074 6865 2063 6f76 6572 6564 2072 6567   the covered reg
-00090440: 696f 6e0a 6465 6620 7365 6c65 6374 5f73  ion.def select_s
-00090450: 6e76 7328 2064 665f 736e 762c 2073 7061  nvs( df_snv, spa
-00090460: 6e5f 6c73 742c 2072 676e 735f 6c73 745f  n_lst, rgns_lst_
-00090470: 6d69 2c20 5479 7065 203d 2027 4d27 2c20  mi, Type = 'M', 
-00090480: 6d64 6576 203d 2031 3220 293a 0a20 2020  mdev = 12 ):.   
-00090490: 200a 2020 2020 7072 696e 7428 2743 6865   .    print('Che
-000904a0: 636b 696e 6720 696e 7465 7273 6563 7469  cking intersecti
-000904b0: 6f6e 202e 2e20 272c 2065 6e64 3d27 2729  on .. ', end='')
-000904c0: 0a20 2020 2073 7465 7020 3d20 6e70 2e63  .    step = np.c
-000904d0: 6569 6c28 6466 5f73 6e76 2e73 6861 7065  eil(df_snv.shape
-000904e0: 5b30 5d2f 3230 290a 2020 2020 0a20 2020  [0]/20).    .   
-000904f0: 2064 665f 736e 765b 2773 7461 7274 275d   df_snv['start']
-00090500: 203d 2064 665f 736e 765b 2770 6f73 5f6f   = df_snv['pos_o
-00090510: 7267 275d 202d 206d 6465 760a 2020 2020  rg'] - mdev.    
-00090520: 6466 5f73 6e76 5b27 656e 6427 5d20 3d20  df_snv['end'] = 
-00090530: 6466 5f73 6e76 5b27 706f 735f 6f72 6727  df_snv['pos_org'
-00090540: 5d20 2b20 6466 5f73 6e76 5b27 6c65 6e27  ] + df_snv['len'
-00090550: 5d20 2b20 6d64 6576 0a20 2020 2064 665f  ] + mdev.    df_
-00090560: 736e 765b 2763 7667 275d 203d 2030 0a0a  snv['cvg'] = 0..
-00090570: 2020 2020 625f 7072 6f63 203d 206e 702e      b_proc = np.
-00090580: 6675 6c6c 2864 665f 736e 762e 7368 6170  full(df_snv.shap
-00090590: 655b 305d 2c20 4661 6c73 6529 0a20 2020  e[0], False).   
-000905a0: 2066 6f72 206b 2c20 7370 616e 2069 6e20   for k, span in 
-000905b0: 656e 756d 6572 6174 6528 7370 616e 5f6c  enumerate(span_l
-000905c0: 7374 293a 0a20 2020 2020 2020 2062 3020  st):.        b0 
-000905d0: 3d20 6466 5f73 6e76 5b27 6368 7227 5d20  = df_snv['chr'] 
-000905e0: 3d3d 2073 7061 6e2e 6368 720a 2020 2020  == span.chr.    
-000905f0: 2020 2020 6231 203d 2028 6466 5f73 6e76      b1 = (df_snv
-00090600: 5b27 7374 6172 7427 5d20 3e3d 2073 7061  ['start'] >= spa
-00090610: 6e2e 7374 6172 7429 2026 2028 2864 665f  n.start) & ((df_
-00090620: 736e 765b 2773 7461 7274 275d 203c 3d20  snv['start'] <= 
-00090630: 7370 616e 2e65 6e64 2929 0a20 2020 2020  span.end)).     
-00090640: 2020 2062 3220 3d20 2864 665f 736e 765b     b2 = (df_snv[
-00090650: 2765 6e64 275d 203e 3d20 7370 616e 2e73  'end'] >= span.s
-00090660: 7461 7274 2920 2620 2828 6466 5f73 6e76  tart) & ((df_snv
-00090670: 5b27 656e 6427 5d20 3c3d 2073 7061 6e2e  ['end'] <= span.
-00090680: 656e 6429 290a 2020 2020 2020 2020 6220  end)).        b 
-00090690: 3d20 6230 2026 2028 6231 207c 2062 3229  = b0 & (b1 | b2)
-000906a0: 2026 2028 625f 7072 6f63 203d 3d20 4661   & (b_proc == Fa
-000906b0: 6c73 6529 0a20 2020 2020 2020 2064 665f  lse).        df_
-000906c0: 736e 765f 746d 7020 3d20 6466 5f73 6e76  snv_tmp = df_snv
-000906d0: 5b62 5d0a 2020 2020 2020 2020 666f 7220  [b].        for 
-000906e0: 6d2c 2072 6f77 2069 6e20 6466 5f73 6e76  m, row in df_snv
-000906f0: 5f74 6d70 2e69 7465 7272 6f77 7328 293a  _tmp.iterrows():
-00090700: 0a20 2020 2020 2020 2020 2020 2072 676e  .            rgn
-00090710: 203d 2072 6567 696f 6e28 2072 6f77 2e63   = region( row.c
-00090720: 6872 2c20 726f 772e 7374 6172 742c 2072  hr, row.start, r
-00090730: 6f77 2e65 6e64 2c20 5479 7065 2029 0a20  ow.end, Type ). 
-00090740: 2020 2020 2020 2020 2020 2062 622c 2063             bb, c
-00090750: 6320 3d20 7267 6e73 5f6c 7374 5f6d 695b  c = rgns_lst_mi[
-00090760: 6b5d 2e67 6574 5f69 6e74 6572 7365 6374  k].get_intersect
-00090770: 696f 6e5f 6376 6728 7267 6e29 200a 2020  ion_cvg(rgn) .  
-00090780: 2020 2020 2020 2020 2020 6966 2062 623a            if bb:
-00090790: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000907a0: 2020 625f 7072 6f63 5b6d 5d20 3d20 5472    b_proc[m] = Tr
-000907b0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000907c0: 2020 2064 665f 736e 762e 6c6f 635b 6d2c     df_snv.loc[m,
-000907d0: 2763 7667 275d 203d 2063 630a 2020 2020  'cvg'] = cc.    
-000907e0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-000907f0: 2020 2020 2023 2069 6620 6b25 7374 6570       # if k%step
-00090800: 203d 3d20 303a 2070 7269 6e74 2827 2e27   == 0: print('.'
-00090810: 2c65 6e64 3d27 2729 0a20 2020 2020 2020  ,end='').       
-00090820: 2069 6620 6b25 3130 203d 3d20 303a 2020   if k%10 == 0:  
-00090830: 2020 0a20 2020 2020 2020 2020 2020 2070    .            p
-00090840: 7269 6e74 2827 5c72 4368 6563 6b69 6e67  rint('\rChecking
-00090850: 2069 6e74 6572 7365 6374 696f 6e20 2e2e   intersection ..
-00090860: 2025 692f 2569 2028 2569 2927 2025 2028   %i/%i (%i)' % (
-00090870: 6b2c 206c 656e 2873 7061 6e5f 6c73 7429  k, len(span_lst)
-00090880: 2c20 6e70 2e73 756d 2862 5f70 726f 6329  , np.sum(b_proc)
-00090890: 292c 2065 6e64 3d27 2720 290a 0a20 2020  ), end='' )..   
-000908a0: 2070 7269 6e74 2827 5c72 4368 6563 6b69   print('\rChecki
-000908b0: 6e67 2069 6e74 6572 7365 6374 696f 6e20  ng intersection 
-000908c0: 2e2e 2064 6f6e 652e 2025 6920 2d3e 2025  .. done. %i -> %
-000908d0: 6927 2025 2028 6466 5f73 6e76 2e73 6861  i' % (df_snv.sha
-000908e0: 7065 5b30 5d2c 206e 702e 7375 6d28 625f  pe[0], np.sum(b_
-000908f0: 7072 6f63 2929 2029 0a20 2020 200a 2020  proc)) ).    .  
-00090900: 2020 6466 5f73 6e76 5f73 656c 203d 2028    df_snv_sel = (
-00090910: 6466 5f73 6e76 2e69 6c6f 635b 625f 7072  df_snv.iloc[b_pr
-00090920: 6f63 5d29 2e63 6f70 7928 6465 6570 203d  oc]).copy(deep =
-00090930: 2054 7275 6529 0a20 2020 200a 2020 2020   True).    .    
-00090940: 7265 7475 726e 2864 665f 736e 765f 7365  return(df_snv_se
-00090950: 6c29 0a0a 0a64 6566 206d 6174 6368 696e  l)...def matchin
-00090960: 675f 736e 7673 2820 6466 5f73 6e76 5f73  g_snvs( df_snv_s
-00090970: 656c 2c20 6466 5f64 6574 6563 7465 642c  el, df_detected,
-00090980: 2064 6576 5f74 6f6c 203d 2033 2029 3a0a   dev_tol = 3 ):.
-00090990: 2020 2020 0a20 2020 2023 2320 7468 6520      .    ## the 
-000909a0: 6461 7461 6672 616d 6573 206d 7573 6820  dataframes mush 
-000909b0: 6265 2073 6f72 7465 6420 6163 636f 7264  be sorted accord
-000909c0: 696e 6720 746f 2074 6865 2070 6f73 6974  ing to the posit
-000909d0: 696f 6e20 2870 6f73 5f6e 6577 2c20 7374  ion (pos_new, st
-000909e0: 6172 7429 0a20 2020 2064 665f 745f 616c  art).    df_t_al
-000909f0: 6c20 3d20 6466 5f73 6e76 5f73 656c 0a20  l = df_snv_sel. 
-00090a00: 2020 2064 665f 645f 616c 6c20 3d20 6466     df_d_all = df
-00090a10: 5f64 6574 6563 7465 640a 0a20 2020 2063  _detected..    c
-00090a20: 6e74 203d 2030 0a20 2020 2063 6872 6d73  nt = 0.    chrms
-00090a30: 203d 2064 665f 745f 616c 6c5b 2763 6872   = df_t_all['chr
-00090a40: 275d 0a20 2020 2063 6872 5f6c 7374 203d  '].    chr_lst =
-00090a50: 206c 6973 7428 7365 7428 6368 726d 7329   list(set(chrms)
-00090a60: 290a 2020 2020 6368 725f 6c73 742e 736f  ).    chr_lst.so
-00090a70: 7274 2829 0a0a 2020 2020 636e 7420 3d20  rt()..    cnt = 
-00090a80: 300a 2020 2020 4e5f 7420 3d20 300a 2020  0.    N_t = 0.  
-00090a90: 2020 4e5f 6420 3d20 300a 2020 2020 666f    N_d = 0.    fo
-00090aa0: 7220 6e2c 2063 6872 6d20 696e 2065 6e75  r n, chrm in enu
-00090ab0: 6d65 7261 7465 2863 6872 5f6c 7374 293a  merate(chr_lst):
-00090ac0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00090ad0: 2020 6231 203d 2028 6466 5f74 5f61 6c6c    b1 = (df_t_all
-00090ae0: 5b27 6368 7227 5d20 3d3d 2063 6872 6d29  ['chr'] == chrm)
-00090af0: 0a20 2020 2020 2020 2062 3220 3d20 2864  .        b2 = (d
-00090b00: 665f 645f 616c 6c5b 2763 6872 275d 203d  f_d_all['chr'] =
-00090b10: 3d20 6368 726d 290a 2020 2020 0a20 2020  = chrm).    .   
-00090b20: 2020 2020 2069 6620 286e 702e 7375 6d28       if (np.sum(
-00090b30: 6231 2920 3d3d 2030 2920 7c20 286e 702e  b1) == 0) | (np.
-00090b40: 7375 6d28 6232 2920 3d3d 2030 293a 2020  sum(b2) == 0):  
-00090b50: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00090b60: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00090b70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00090b80: 2020 0a20 2020 2020 2020 2020 2020 2064    .            d
-00090b90: 665f 7420 3d20 6466 5f74 5f61 6c6c 2e6c  f_t = df_t_all.l
-00090ba0: 6f63 5b62 312c 3a5d 2e63 6f70 7928 6465  oc[b1,:].copy(de
-00090bb0: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
-00090bc0: 2020 2020 2020 2064 665f 6420 3d20 6466         df_d = df
-00090bd0: 5f64 5f61 6c6c 2e6c 6f63 5b62 322c 3a5d  _d_all.loc[b2,:]
-00090be0: 2e63 6f70 7928 6465 6570 203d 2054 7275  .copy(deep = Tru
-00090bf0: 6529 0a20 2020 2020 2020 2020 2020 200a  e).            .
-00090c00: 2020 2020 2020 2020 2020 2020 6e5f 7461              n_ta
-00090c10: 7267 6574 203d 2064 665f 742e 7368 6170  rget = df_t.shap
-00090c20: 655b 305d 0a20 2020 2020 2020 2020 2020  e[0].           
-00090c30: 206e 5f64 6574 6563 7465 6420 3d20 6466   n_detected = df
-00090c40: 5f64 2e73 6861 7065 5b30 5d0a 2020 2020  _d.shape[0].    
-00090c50: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00090c60: 2020 2020 204e 5f74 202b 3d20 6e5f 7461       N_t += n_ta
-00090c70: 7267 6574 0a20 2020 2020 2020 2020 2020  rget.           
-00090c80: 204e 5f64 202b 3d20 6e5f 6465 7465 6374   N_d += n_detect
-00090c90: 6564 0a20 2020 2020 2020 2020 2020 200a  ed.            .
-00090ca0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00090cb0: 696e 7428 275c 724d 6174 6368 696e 6720  int('\rMatching 
-00090cc0: 2573 2027 2025 2028 6368 726d 2920 2c20  %s ' % (chrm) , 
-00090cd0: 656e 643d 2727 290a 2020 2020 2020 2020  end='').        
-00090ce0: 2020 2020 636e 745f 7420 3d20 300a 2020      cnt_t = 0.  
-00090cf0: 2020 2020 2020 2020 2020 636e 745f 6420            cnt_d 
-00090d00: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00090d10: 6d61 7463 6820 3d20 6e70 2e66 756c 6c28  match = np.full(
-00090d20: 6e5f 7461 7267 6574 2c20 2d31 290a 2020  n_target, -1).  
-00090d30: 2020 2020 2020 2020 2020 6469 7374 203d            dist =
-00090d40: 206e 702e 6675 6c6c 286e 5f74 6172 6765   np.full(n_targe
-00090d50: 742c 2030 290a 2020 2020 2020 2020 2020  t, 0).          
-00090d60: 2020 0a20 2020 2020 2020 2020 2020 2077    .            w
-00090d70: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
-00090d80: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00090d90: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00090da0: 636e 745f 6420 3e3d 206e 5f64 6574 6563  cnt_d >= n_detec
-00090db0: 7465 6429 207c 2028 636e 745f 7420 3e3d  ted) | (cnt_t >=
-00090dc0: 206e 5f74 6172 6765 7429 3a20 6272 6561   n_target): brea
-00090dd0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00090de0: 2020 7072 696e 7428 275c 724d 6174 6368    print('\rMatch
-00090df0: 696e 6720 2573 2c20 2569 2f25 6920 2e2e  ing %s, %i/%i ..
-00090e00: 2025 692f 2569 2c20 2569 2f25 6920 2720   %i/%i, %i/%i ' 
-00090e10: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
-00090e20: 2020 2020 2020 2020 2020 2863 6872 6d2c            (chrm,
-00090e30: 206e 2c20 6c65 6e28 6368 725f 6c73 7429   n, len(chr_lst)
-00090e40: 2c20 636e 745f 742c 206e 5f74 6172 6765  , cnt_t, n_targe
-00090e50: 742c 2063 6e74 5f64 2c20 6e5f 6465 7465  t, cnt_d, n_dete
-00090e60: 6374 6564 2920 2c20 656e 643d 2727 290a  cted) , end='').
-00090e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00090e80: 2070 5f74 203d 2064 665f 742e 696c 6f63   p_t = df_t.iloc
-00090e90: 5b63 6e74 5f74 5d2e 706f 735f 6f72 670a  [cnt_t].pos_org.
-00090ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090eb0: 705f 6420 3d20 6466 5f64 2e69 6c6f 635b  p_d = df_d.iloc[
-00090ec0: 636e 745f 645d 2e70 6f73 5f6f 7267 0a20  cnt_d].pos_org. 
-00090ed0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00090ee0: 5f74 203d 2064 665f 742e 696c 6f63 5b63  _t = df_t.iloc[c
-00090ef0: 6e74 5f74 5d2e 7479 7065 0a20 2020 2020  nt_t].type.     
-00090f00: 2020 2020 2020 2020 2020 2074 5f64 203d             t_d =
-00090f10: 2064 665f 642e 696c 6f63 5b63 6e74 5f64   df_d.iloc[cnt_d
-00090f20: 5d2e 7479 7065 0a20 2020 2020 2020 2020  ].type.         
-00090f30: 2020 2020 2020 204c 5f74 203d 206d 6178         L_t = max
-00090f40: 286c 656e 2864 665f 742e 696c 6f63 5b63  (len(df_t.iloc[c
-00090f50: 6e74 5f74 5d2e 7365 715f 6f72 6729 2c20  nt_t].seq_org), 
-00090f60: 6c65 6e28 6466 5f74 2e69 6c6f 635b 636e  len(df_t.iloc[cn
-00090f70: 745f 745d 2e73 6571 5f6e 6577 2929 0a20  t_t].seq_new)). 
+00090310: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
+00090320: 2046 756e 6374 696f 6e73 2066 6f72 2065   Functions for e
+00090330: 7661 6c75 6174 696f 6e20 6f66 2053 4e56  valuation of SNV
+00090340: 2064 6574 6563 7469 6f6e 0a23 2323 2323   detection.#####
+00090350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090380: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00090390: 2323 2323 2323 2323 2323 2323 230a 0a64  #############..d
+000903a0: 6566 2067 6574 5f73 7061 6e5f 6c73 7428  ef get_span_lst(
+000903b0: 7267 6e73 5f6c 7374 5f6d 692c 2054 7970  rgns_lst_mi, Typ
+000903c0: 6520 3d20 274d 2729 3a0a 2020 2020 0a20  e = 'M'):.    . 
+000903d0: 2020 2073 7061 6e5f 6c73 7420 3d20 5b5d     span_lst = []
+000903e0: 0a20 2020 2066 6f72 2072 5f6d 2069 6e20  .    for r_m in 
+000903f0: 7267 6e73 5f6c 7374 5f6d 693a 0a20 2020  rgns_lst_mi:.   
+00090400: 2020 2020 2073 706e 203d 2072 5f6d 2e67       spn = r_m.g
+00090410: 6574 5f73 7061 6e28 290a 2020 2020 2020  et_span().      
+00090420: 2020 7370 6e2e 7479 7065 203d 2054 7970    spn.type = Typ
+00090430: 650a 2020 2020 2020 2020 7370 616e 5f6c  e.        span_l
+00090440: 7374 2e61 7070 656e 6428 2073 706e 2029  st.append( spn )
+00090450: 0a20 2020 2072 6574 7572 6e28 7370 616e  .    return(span
+00090460: 5f6c 7374 290a 0a23 2320 5365 6c65 6374  _lst)..## Select
+00090470: 2053 4e56 2773 2074 6861 7420 6661 6c6c   SNV's that fall
+00090480: 7320 7769 7468 696e 2074 6865 2063 6f76  s within the cov
+00090490: 6572 6564 2072 6567 696f 6e0a 6465 6620  ered region.def 
+000904a0: 7365 6c65 6374 5f73 6e76 7328 2064 665f  select_snvs( df_
+000904b0: 736e 762c 2073 7061 6e5f 6c73 742c 2072  snv, span_lst, r
+000904c0: 676e 735f 6c73 745f 6d69 2c20 5479 7065  gns_lst_mi, Type
+000904d0: 203d 2027 4d27 2c20 6d64 6576 203d 2031   = 'M', mdev = 1
+000904e0: 3220 293a 0a20 2020 200a 2020 2020 7072  2 ):.    .    pr
+000904f0: 696e 7428 2743 6865 636b 696e 6720 696e  int('Checking in
+00090500: 7465 7273 6563 7469 6f6e 202e 2e20 272c  tersection .. ',
+00090510: 2065 6e64 3d27 2729 0a20 2020 2073 7465   end='').    ste
+00090520: 7020 3d20 6e70 2e63 6569 6c28 6466 5f73  p = np.ceil(df_s
+00090530: 6e76 2e73 6861 7065 5b30 5d2f 3230 290a  nv.shape[0]/20).
+00090540: 2020 2020 0a20 2020 2064 665f 736e 765b      .    df_snv[
+00090550: 2773 7461 7274 275d 203d 2064 665f 736e  'start'] = df_sn
+00090560: 765b 2770 6f73 5f6f 7267 275d 202d 206d  v['pos_org'] - m
+00090570: 6465 760a 2020 2020 6466 5f73 6e76 5b27  dev.    df_snv['
+00090580: 656e 6427 5d20 3d20 6466 5f73 6e76 5b27  end'] = df_snv['
+00090590: 706f 735f 6f72 6727 5d20 2b20 6466 5f73  pos_org'] + df_s
+000905a0: 6e76 5b27 6c65 6e27 5d20 2b20 6d64 6576  nv['len'] + mdev
+000905b0: 0a20 2020 2064 665f 736e 765b 2763 7667  .    df_snv['cvg
+000905c0: 275d 203d 2030 0a0a 2020 2020 625f 7072  '] = 0..    b_pr
+000905d0: 6f63 203d 206e 702e 6675 6c6c 2864 665f  oc = np.full(df_
+000905e0: 736e 762e 7368 6170 655b 305d 2c20 4661  snv.shape[0], Fa
+000905f0: 6c73 6529 0a20 2020 2066 6f72 206b 2c20  lse).    for k, 
+00090600: 7370 616e 2069 6e20 656e 756d 6572 6174  span in enumerat
+00090610: 6528 7370 616e 5f6c 7374 293a 0a20 2020  e(span_lst):.   
+00090620: 2020 2020 2062 3020 3d20 6466 5f73 6e76       b0 = df_snv
+00090630: 5b27 6368 7227 5d20 3d3d 2073 7061 6e2e  ['chr'] == span.
+00090640: 6368 720a 2020 2020 2020 2020 6231 203d  chr.        b1 =
+00090650: 2028 6466 5f73 6e76 5b27 7374 6172 7427   (df_snv['start'
+00090660: 5d20 3e3d 2073 7061 6e2e 7374 6172 7429  ] >= span.start)
+00090670: 2026 2028 2864 665f 736e 765b 2773 7461   & ((df_snv['sta
+00090680: 7274 275d 203c 3d20 7370 616e 2e65 6e64  rt'] <= span.end
+00090690: 2929 0a20 2020 2020 2020 2062 3220 3d20  )).        b2 = 
+000906a0: 2864 665f 736e 765b 2765 6e64 275d 203e  (df_snv['end'] >
+000906b0: 3d20 7370 616e 2e73 7461 7274 2920 2620  = span.start) & 
+000906c0: 2828 6466 5f73 6e76 5b27 656e 6427 5d20  ((df_snv['end'] 
+000906d0: 3c3d 2073 7061 6e2e 656e 6429 290a 2020  <= span.end)).  
+000906e0: 2020 2020 2020 6220 3d20 6230 2026 2028        b = b0 & (
+000906f0: 6231 207c 2062 3229 2026 2028 625f 7072  b1 | b2) & (b_pr
+00090700: 6f63 203d 3d20 4661 6c73 6529 0a20 2020  oc == False).   
+00090710: 2020 2020 2064 665f 736e 765f 746d 7020       df_snv_tmp 
+00090720: 3d20 6466 5f73 6e76 5b62 5d0a 2020 2020  = df_snv[b].    
+00090730: 2020 2020 666f 7220 6d2c 2072 6f77 2069      for m, row i
+00090740: 6e20 6466 5f73 6e76 5f74 6d70 2e69 7465  n df_snv_tmp.ite
+00090750: 7272 6f77 7328 293a 0a20 2020 2020 2020  rrows():.       
+00090760: 2020 2020 2072 676e 203d 2072 6567 696f       rgn = regio
+00090770: 6e28 2072 6f77 2e63 6872 2c20 726f 772e  n( row.chr, row.
+00090780: 7374 6172 742c 2072 6f77 2e65 6e64 2c20  start, row.end, 
+00090790: 5479 7065 2029 0a20 2020 2020 2020 2020  Type ).         
+000907a0: 2020 2062 622c 2063 6320 3d20 7267 6e73     bb, cc = rgns
+000907b0: 5f6c 7374 5f6d 695b 6b5d 2e67 6574 5f69  _lst_mi[k].get_i
+000907c0: 6e74 6572 7365 6374 696f 6e5f 6376 6728  ntersection_cvg(
+000907d0: 7267 6e29 200a 2020 2020 2020 2020 2020  rgn) .          
+000907e0: 2020 6966 2062 623a 200a 2020 2020 2020    if bb: .      
+000907f0: 2020 2020 2020 2020 2020 625f 7072 6f63            b_proc
+00090800: 5b6d 5d20 3d20 5472 7565 0a20 2020 2020  [m] = True.     
+00090810: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
+00090820: 762e 6c6f 635b 6d2c 2763 7667 275d 203d  v.loc[m,'cvg'] =
+00090830: 2063 630a 2020 2020 2020 2020 2020 2020   cc.            
+00090840: 2020 2020 0a20 2020 2020 2020 2023 2069      .        # i
+00090850: 6620 6b25 7374 6570 203d 3d20 303a 2070  f k%step == 0: p
+00090860: 7269 6e74 2827 2e27 2c65 6e64 3d27 2729  rint('.',end='')
+00090870: 0a20 2020 2020 2020 2069 6620 6b25 3130  .        if k%10
+00090880: 203d 3d20 303a 2020 2020 0a20 2020 2020   == 0:    .     
+00090890: 2020 2020 2020 2070 7269 6e74 2827 5c72         print('\r
+000908a0: 4368 6563 6b69 6e67 2069 6e74 6572 7365  Checking interse
+000908b0: 6374 696f 6e20 2e2e 2025 692f 2569 2028  ction .. %i/%i (
+000908c0: 2569 2927 2025 2028 6b2c 206c 656e 2873  %i)' % (k, len(s
+000908d0: 7061 6e5f 6c73 7429 2c20 6e70 2e73 756d  pan_lst), np.sum
+000908e0: 2862 5f70 726f 6329 292c 2065 6e64 3d27  (b_proc)), end='
+000908f0: 2720 290a 0a20 2020 2070 7269 6e74 2827  ' )..    print('
+00090900: 5c72 4368 6563 6b69 6e67 2069 6e74 6572  \rChecking inter
+00090910: 7365 6374 696f 6e20 2e2e 2064 6f6e 652e  section .. done.
+00090920: 2025 6920 2d3e 2025 6927 2025 2028 6466   %i -> %i' % (df
+00090930: 5f73 6e76 2e73 6861 7065 5b30 5d2c 206e  _snv.shape[0], n
+00090940: 702e 7375 6d28 625f 7072 6f63 2929 2029  p.sum(b_proc)) )
+00090950: 0a20 2020 200a 2020 2020 6466 5f73 6e76  .    .    df_snv
+00090960: 5f73 656c 203d 2028 6466 5f73 6e76 2e69  _sel = (df_snv.i
+00090970: 6c6f 635b 625f 7072 6f63 5d29 2e63 6f70  loc[b_proc]).cop
+00090980: 7928 6465 6570 203d 2054 7275 6529 0a20  y(deep = True). 
+00090990: 2020 200a 2020 2020 7265 7475 726e 2864     .    return(d
+000909a0: 665f 736e 765f 7365 6c29 0a0a 0a64 6566  f_snv_sel)...def
+000909b0: 206d 6174 6368 696e 675f 736e 7673 2820   matching_snvs( 
+000909c0: 6466 5f73 6e76 5f73 656c 2c20 6466 5f64  df_snv_sel, df_d
+000909d0: 6574 6563 7465 642c 2064 6576 5f74 6f6c  etected, dev_tol
+000909e0: 203d 2033 2029 3a0a 2020 2020 0a20 2020   = 3 ):.    .   
+000909f0: 2023 2320 7468 6520 6461 7461 6672 616d   ## the datafram
+00090a00: 6573 206d 7573 6820 6265 2073 6f72 7465  es mush be sorte
+00090a10: 6420 6163 636f 7264 696e 6720 746f 2074  d according to t
+00090a20: 6865 2070 6f73 6974 696f 6e20 2870 6f73  he position (pos
+00090a30: 5f6e 6577 2c20 7374 6172 7429 0a20 2020  _new, start).   
+00090a40: 2064 665f 745f 616c 6c20 3d20 6466 5f73   df_t_all = df_s
+00090a50: 6e76 5f73 656c 0a20 2020 2064 665f 645f  nv_sel.    df_d_
+00090a60: 616c 6c20 3d20 6466 5f64 6574 6563 7465  all = df_detecte
+00090a70: 640a 0a20 2020 2063 6e74 203d 2030 0a20  d..    cnt = 0. 
+00090a80: 2020 2063 6872 6d73 203d 2064 665f 745f     chrms = df_t_
+00090a90: 616c 6c5b 2763 6872 275d 0a20 2020 2063  all['chr'].    c
+00090aa0: 6872 5f6c 7374 203d 206c 6973 7428 7365  hr_lst = list(se
+00090ab0: 7428 6368 726d 7329 290a 2020 2020 6368  t(chrms)).    ch
+00090ac0: 725f 6c73 742e 736f 7274 2829 0a0a 2020  r_lst.sort()..  
+00090ad0: 2020 636e 7420 3d20 300a 2020 2020 4e5f    cnt = 0.    N_
+00090ae0: 7420 3d20 300a 2020 2020 4e5f 6420 3d20  t = 0.    N_d = 
+00090af0: 300a 2020 2020 666f 7220 6e2c 2063 6872  0.    for n, chr
+00090b00: 6d20 696e 2065 6e75 6d65 7261 7465 2863  m in enumerate(c
+00090b10: 6872 5f6c 7374 293a 0a20 2020 2020 2020  hr_lst):.       
+00090b20: 200a 2020 2020 2020 2020 6231 203d 2028   .        b1 = (
+00090b30: 6466 5f74 5f61 6c6c 5b27 6368 7227 5d20  df_t_all['chr'] 
+00090b40: 3d3d 2063 6872 6d29 0a20 2020 2020 2020  == chrm).       
+00090b50: 2062 3220 3d20 2864 665f 645f 616c 6c5b   b2 = (df_d_all[
+00090b60: 2763 6872 275d 203d 3d20 6368 726d 290a  'chr'] == chrm).
+00090b70: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+00090b80: 286e 702e 7375 6d28 6231 2920 3d3d 2030  (np.sum(b1) == 0
+00090b90: 2920 7c20 286e 702e 7375 6d28 6232 2920  ) | (np.sum(b2) 
+00090ba0: 3d3d 2030 293a 2020 2020 2020 2020 0a20  == 0):        . 
+00090bb0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00090bc0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00090bd0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00090be0: 2020 2020 2020 2064 665f 7420 3d20 6466         df_t = df
+00090bf0: 5f74 5f61 6c6c 2e6c 6f63 5b62 312c 3a5d  _t_all.loc[b1,:]
+00090c00: 2e63 6f70 7928 6465 6570 203d 2054 7275  .copy(deep = Tru
+00090c10: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
+00090c20: 665f 6420 3d20 6466 5f64 5f61 6c6c 2e6c  f_d = df_d_all.l
+00090c30: 6f63 5b62 322c 3a5d 2e63 6f70 7928 6465  oc[b2,:].copy(de
+00090c40: 6570 203d 2054 7275 6529 0a20 2020 2020  ep = True).     
+00090c50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00090c60: 2020 2020 6e5f 7461 7267 6574 203d 2064      n_target = d
+00090c70: 665f 742e 7368 6170 655b 305d 0a20 2020  f_t.shape[0].   
+00090c80: 2020 2020 2020 2020 206e 5f64 6574 6563           n_detec
+00090c90: 7465 6420 3d20 6466 5f64 2e73 6861 7065  ted = df_d.shape
+00090ca0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00090cb0: 0a20 2020 2020 2020 2020 2020 204e 5f74  .            N_t
+00090cc0: 202b 3d20 6e5f 7461 7267 6574 0a20 2020   += n_target.   
+00090cd0: 2020 2020 2020 2020 204e 5f64 202b 3d20           N_d += 
+00090ce0: 6e5f 6465 7465 6374 6564 0a20 2020 2020  n_detected.     
+00090cf0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00090d00: 2020 2020 2320 7072 696e 7428 275c 724d      # print('\rM
+00090d10: 6174 6368 696e 6720 2573 2027 2025 2028  atching %s ' % (
+00090d20: 6368 726d 2920 2c20 656e 643d 2727 290a  chrm) , end='').
+00090d30: 2020 2020 2020 2020 2020 2020 636e 745f              cnt_
+00090d40: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
+00090d50: 2020 636e 745f 6420 3d20 300a 2020 2020    cnt_d = 0.    
+00090d60: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
+00090d70: 6e70 2e66 756c 6c28 6e5f 7461 7267 6574  np.full(n_target
+00090d80: 2c20 2d31 290a 2020 2020 2020 2020 2020  , -1).          
+00090d90: 2020 6469 7374 203d 206e 702e 6675 6c6c    dist = np.full
+00090da0: 286e 5f74 6172 6765 742c 2030 290a 2020  (n_target, 0).  
+00090db0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00090dc0: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
+00090dd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00090de0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00090df0: 2020 2020 6966 2028 636e 745f 6420 3e3d      if (cnt_d >=
+00090e00: 206e 5f64 6574 6563 7465 6429 207c 2028   n_detected) | (
+00090e10: 636e 745f 7420 3e3d 206e 5f74 6172 6765  cnt_t >= n_targe
+00090e20: 7429 3a20 6272 6561 6b0a 2020 2020 2020  t): break.      
+00090e30: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00090e40: 275c 724d 6174 6368 696e 6720 2573 2c20  '\rMatching %s, 
+00090e50: 2569 2f25 6920 2e2e 2025 692f 2569 2c20  %i/%i .. %i/%i, 
+00090e60: 2569 2f25 6920 2720 2520 5c0a 2020 2020  %i/%i ' % \.    
+00090e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090e80: 2020 2863 6872 6d2c 206e 2c20 6c65 6e28    (chrm, n, len(
+00090e90: 6368 725f 6c73 7429 2c20 636e 745f 742c  chr_lst), cnt_t,
+00090ea0: 206e 5f74 6172 6765 742c 2063 6e74 5f64   n_target, cnt_d
+00090eb0: 2c20 6e5f 6465 7465 6374 6564 2920 2c20  , n_detected) , 
+00090ec0: 656e 643d 2727 290a 0a20 2020 2020 2020  end='')..       
+00090ed0: 2020 2020 2020 2020 2070 5f74 203d 2064           p_t = d
+00090ee0: 665f 742e 696c 6f63 5b63 6e74 5f74 5d2e  f_t.iloc[cnt_t].
+00090ef0: 706f 735f 6f72 670a 2020 2020 2020 2020  pos_org.        
+00090f00: 2020 2020 2020 2020 705f 6420 3d20 6466          p_d = df
+00090f10: 5f64 2e69 6c6f 635b 636e 745f 645d 2e70  _d.iloc[cnt_d].p
+00090f20: 6f73 5f6f 7267 0a20 2020 2020 2020 2020  os_org.         
+00090f30: 2020 2020 2020 2074 5f74 203d 2064 665f         t_t = df_
+00090f40: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7479  t.iloc[cnt_t].ty
+00090f50: 7065 0a20 2020 2020 2020 2020 2020 2020  pe.             
+00090f60: 2020 2074 5f64 203d 2064 665f 642e 696c     t_d = df_d.il
+00090f70: 6f63 5b63 6e74 5f64 5d2e 7479 7065 0a20  oc[cnt_d].type. 
 00090f80: 2020 2020 2020 2020 2020 2020 2020 204c                 L
-00090f90: 5f64 203d 206d 6178 286c 656e 2864 665f  _d = max(len(df_
-00090fa0: 642e 696c 6f63 5b63 6e74 5f64 5d2e 7365  d.iloc[cnt_d].se
-00090fb0: 715f 6f72 6729 2c20 6c65 6e28 6466 5f64  q_org), len(df_d
-00090fc0: 2e69 6c6f 635b 636e 745f 645d 2e73 6571  .iloc[cnt_d].seq
-00090fd0: 5f6e 6577 2929 0a0a 2020 2020 2020 2020  _new))..        
-00090fe0: 2020 2020 2020 2020 6966 2028 705f 7429          if (p_t)
-00090ff0: 203e 2028 705f 6420 2b20 4c5f 6420 2b20   > (p_d + L_d + 
-00091000: 6465 765f 746f 6c29 3a0a 2020 2020 2020  dev_tol):.      
-00091010: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-00091020: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
-00091030: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00091040: 636e 745f 6420 3e3d 206e 5f64 6574 6563  cnt_d >= n_detec
-00091050: 7465 643a 2062 7265 616b 0a20 2020 2020  ted: break.     
-00091060: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00091070: 2870 5f74 202b 204c 5f74 202b 2064 6576  (p_t + L_t + dev
-00091080: 5f74 6f6c 2920 3c20 2870 5f64 293a 0a20  _tol) < (p_d):. 
-00091090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000910a0: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
-000910b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000910c0: 2020 6966 2063 6e74 5f74 203e 3d20 6e5f    if cnt_t >= n_
-000910d0: 7461 7267 6574 3a20 6272 6561 6b0a 2020  target: break.  
-000910e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000910f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00091100: 2020 2020 2020 2020 6220 3d20 5472 7565          b = True
-00091110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091120: 2020 2020 2069 6620 2874 5f74 203d 3d20       if (t_t == 
-00091130: 2756 2729 2026 2028 745f 6420 3d3d 2027  'V') & (t_d == '
-00091140: 5627 293a 0a20 2020 2020 2020 2020 2020  V'):.           
-00091150: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00091160: 6c65 6e28 6466 5f74 2e69 6c6f 635b 636e  len(df_t.iloc[cn
-00091170: 745f 745d 2e73 6571 5f6e 6577 2920 3d3d  t_t].seq_new) ==
-00091180: 206c 656e 2864 665f 642e 696c 6f63 5b63   len(df_d.iloc[c
-00091190: 6e74 5f64 5d2e 7365 715f 6e65 7729 3a0a  nt_d].seq_new):.
+00090f90: 5f74 203d 206d 6178 286c 656e 2864 665f  _t = max(len(df_
+00090fa0: 742e 696c 6f63 5b63 6e74 5f74 5d2e 7365  t.iloc[cnt_t].se
+00090fb0: 715f 6f72 6729 2c20 6c65 6e28 6466 5f74  q_org), len(df_t
+00090fc0: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
+00090fd0: 5f6e 6577 2929 0a20 2020 2020 2020 2020  _new)).         
+00090fe0: 2020 2020 2020 204c 5f64 203d 206d 6178         L_d = max
+00090ff0: 286c 656e 2864 665f 642e 696c 6f63 5b63  (len(df_d.iloc[c
+00091000: 6e74 5f64 5d2e 7365 715f 6f72 6729 2c20  nt_d].seq_org), 
+00091010: 6c65 6e28 6466 5f64 2e69 6c6f 635b 636e  len(df_d.iloc[cn
+00091020: 745f 645d 2e73 6571 5f6e 6577 2929 0a0a  t_d].seq_new))..
+00091030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091040: 6966 2028 705f 7429 203e 2028 705f 6420  if (p_t) > (p_d 
+00091050: 2b20 4c5f 6420 2b20 6465 765f 746f 6c29  + L_d + dev_tol)
+00091060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00091070: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
+00091080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091090: 2020 2020 2069 6620 636e 745f 6420 3e3d       if cnt_d >=
+000910a0: 206e 5f64 6574 6563 7465 643a 2062 7265   n_detected: bre
+000910b0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+000910c0: 2020 2065 6c69 6620 2870 5f74 202b 204c     elif (p_t + L
+000910d0: 5f74 202b 2064 6576 5f74 6f6c 2920 3c20  _t + dev_tol) < 
+000910e0: 2870 5f64 293a 0a20 2020 2020 2020 2020  (p_d):.         
+000910f0: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
+00091100: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00091110: 2020 2020 2020 2020 2020 6966 2063 6e74            if cnt
+00091120: 5f74 203e 3d20 6e5f 7461 7267 6574 3a20  _t >= n_target: 
+00091130: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00091140: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00091150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091160: 6220 3d20 5472 7565 0a20 2020 2020 2020  b = True.       
+00091170: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00091180: 2874 5f74 203d 3d20 2756 2729 2026 2028  (t_t == 'V') & (
+00091190: 745f 6420 3d3d 2027 5627 293a 0a20 2020  t_d == 'V'):.   
 000911a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000911b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000911c0: 705f 7420 3d3d 2070 5f64 2920 2620 2864  p_t == p_d) & (d
-000911d0: 665f 742e 696c 6f63 5b63 6e74 5f74 5d2e  f_t.iloc[cnt_t].
-000911e0: 7365 715f 6e65 7720 3d3d 2064 665f 642e  seq_new == df_d.
-000911f0: 696c 6f63 5b63 6e74 5f64 5d2e 7365 715f  iloc[cnt_d].seq_
-00091200: 6e65 7729 3a0a 2020 2020 2020 2020 2020  new):.          
-00091210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091220: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
-00091230: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
-00091240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091250: 2020 2020 2020 2020 2020 2064 6973 745b             dist[
-00091260: 636e 745f 745d 203d 2070 5f74 202d 2070  cnt_t] = p_t - p
-00091270: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
-00091280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091290: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
+000911b0: 2020 2020 2069 6620 6c65 6e28 6466 5f74       if len(df_t
+000911c0: 2e69 6c6f 635b 636e 745f 745d 2e73 6571  .iloc[cnt_t].seq
+000911d0: 5f6e 6577 2920 3d3d 206c 656e 2864 665f  _new) == len(df_
+000911e0: 642e 696c 6f63 5b63 6e74 5f64 5d2e 7365  d.iloc[cnt_d].se
+000911f0: 715f 6e65 7729 3a0a 2020 2020 2020 2020  q_new):.        
+00091200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091210: 2020 2020 6966 2028 705f 7420 3d3d 2070      if (p_t == p
+00091220: 5f64 2920 2620 2864 665f 742e 696c 6f63  _d) & (df_t.iloc
+00091230: 5b63 6e74 5f74 5d2e 7365 715f 6e65 7720  [cnt_t].seq_new 
+00091240: 3d3d 2064 665f 642e 696c 6f63 5b63 6e74  == df_d.iloc[cnt
+00091250: 5f64 5d2e 7365 715f 6e65 7729 3a0a 2020  _d].seq_new):.  
+00091260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091270: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00091280: 7463 685b 636e 745f 745d 203d 2063 6e74  tch[cnt_t] = cnt
+00091290: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
 000912a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000912b0: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-000912c0: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
+000912b0: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
+000912c0: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
 000912d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000912e0: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
-000912f0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00091300: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00091310: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00091320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091330: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00091340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091350: 2020 2020 2020 2020 2020 2727 270a 2020            '''.  
-00091360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091370: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00091380: 7463 685b 636e 745f 745d 203d 2063 6e74  tch[cnt_t] = cnt
-00091390: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
+000912e0: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
+000912f0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00091300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091310: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
+00091320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091340: 2062 203d 2046 616c 7365 0a20 2020 2020   b = False.     
+00091350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091360: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00091370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091380: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00091390: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
 000913a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000913b0: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
-000913c0: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
-000913d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000913e0: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
-000913f0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091410: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
-00091420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000913b0: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
+000913c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000913d0: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
+000913e0: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
+000913f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091400: 2020 2020 2020 2020 2020 2064 6973 745b             dist[
+00091410: 636e 745f 745d 203d 2070 5f74 202d 2070  cnt_t] = p_t - p
+00091420: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
 00091430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091440: 2062 203d 2046 616c 7365 0a20 2020 2020   b = False.     
+00091440: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
 00091450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091460: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
-00091470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091480: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00091490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914a0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00091460: 2020 2020 2020 2020 2020 2020 2020 636e                cn
+00091470: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
+00091480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091490: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
+000914a0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
 000914b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000914c0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-000914d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000914e0: 6620 623a 0a20 2020 2020 2020 2020 2020  f b:.           
+000914c0: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+000914d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000914e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
 000914f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091500: 2063 6e74 5f74 202b 3d20 310a 2020 2020   cnt_t += 1.    
-00091510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091520: 2020 2020 2020 2020 636e 745f 6420 2b3d          cnt_d +=
-00091530: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00091540: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00091550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091560: 2020 2020 656c 6966 2028 745f 7420 3d3d      elif (t_t ==
-00091570: 2027 4927 2920 2620 2874 5f64 203d 3d20   'I') & (t_d == 
-00091580: 2744 2729 3a0a 2020 2020 2020 2020 2020  'D'):.          
-00091590: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-000915a0: 7463 685b 636e 745f 745d 203d 2063 6e74  tch[cnt_t] = cnt
-000915b0: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
-000915c0: 2020 2020 2020 2020 2020 2064 6973 745b             dist[
-000915d0: 636e 745f 745d 203d 2070 5f74 202d 2070  cnt_t] = p_t - p
-000915e0: 5f64 0a20 2020 2020 2020 2020 2020 2020  _d.             
-000915f0: 2020 2020 2020 2020 2020 2063 6e74 5f74             cnt_t
-00091600: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091610: 2020 2020 2020 2020 2020 2020 2020 636e                cn
-00091620: 745f 6420 2b3d 2031 0a20 2020 2020 2020  t_d += 1.       
-00091630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091640: 2062 203d 2046 616c 7365 0a0a 2020 2020   b = False..    
-00091650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091660: 656c 6966 2028 745f 7420 3d3d 2027 4427  elif (t_t == 'D'
-00091670: 2920 2620 2874 5f64 203d 3d20 2749 2729  ) & (t_d == 'I')
-00091680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00091690: 2020 2020 2020 2020 2020 6d61 7463 685b            match[
-000916a0: 636e 745f 745d 203d 2063 6e74 5f64 0a20  cnt_t] = cnt_d. 
-000916b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000916c0: 2020 2020 2020 2064 6973 745b 636e 745f         dist[cnt_
-000916d0: 745d 203d 2070 5f74 202d 2070 5f64 0a20  t] = p_t - p_d. 
+00091500: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00091510: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00091520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091530: 2020 2020 2020 2069 6620 623a 0a20 2020         if b:.   
+00091540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091550: 2020 2020 2020 2020 2063 6e74 5f74 202b           cnt_t +
+00091560: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00091570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091580: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
+00091590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000915b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000915c0: 2028 745f 7420 3d3d 2027 4927 2920 2620   (t_t == 'I') & 
+000915d0: 2874 5f64 203d 3d20 2744 2729 3a0a 2020  (t_d == 'D'):.  
+000915e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915f0: 2020 2020 2020 6d61 7463 685b 636e 745f        match[cnt_
+00091600: 745d 203d 2063 6e74 5f64 0a20 2020 2020  t] = cnt_d.     
+00091610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091620: 2020 2064 6973 745b 636e 745f 745d 203d     dist[cnt_t] =
+00091630: 2070 5f74 202d 2070 5f64 0a20 2020 2020   p_t - p_d.     
+00091640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091650: 2020 2063 6e74 5f74 202b 3d20 310a 2020     cnt_t += 1.  
+00091660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091670: 2020 2020 2020 636e 745f 6420 2b3d 2031        cnt_d += 1
+00091680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091690: 2020 2020 2020 2020 2062 203d 2046 616c           b = Fal
+000916a0: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
+000916b0: 2020 2020 2020 2020 656c 6966 2028 745f          elif (t_
+000916c0: 7420 3d3d 2027 4427 2920 2620 2874 5f64  t == 'D') & (t_d
+000916d0: 203d 3d20 2749 2729 3a0a 2020 2020 2020   == 'I'):.      
 000916e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000916f0: 2020 2020 2020 2063 6e74 5f74 202b 3d20         cnt_t += 
-00091700: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00091710: 2020 2020 2020 2020 2020 636e 745f 6420            cnt_d 
-00091720: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00091730: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-00091740: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00091750: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00091760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091770: 2020 2020 2020 2020 2023 2063 6e74 5f74           # cnt_t
-00091780: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00091790: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000917a0: 636e 745f 6420 2b3d 2031 0a20 2020 2020  cnt_d += 1.     
-000917b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000917c0: 2020 2069 6620 2863 6e74 5f64 203e 3d20     if (cnt_d >= 
-000917d0: 6e5f 6465 7465 6374 6564 2920 7c20 2863  n_detected) | (c
-000917e0: 6e74 5f74 203e 3d20 6e5f 7461 7267 6574  nt_t >= n_target
-000917f0: 293a 2062 7265 616b 0a20 2020 2020 2020  ): break.       
-00091800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091810: 200a 0a20 2020 2020 2020 2020 2020 2062   ..            b
-00091820: 203d 206d 6174 6368 203e 3d20 300a 2020   = match >= 0.  
-00091830: 2020 2020 2020 2020 2020 7768 5f74 203d            wh_t =
-00091840: 2077 6869 6368 2862 290a 2020 2020 2020   which(b).      
-00091850: 2020 2020 2020 7768 5f64 203d 206d 6174        wh_d = mat
-00091860: 6368 5b77 685f 745d 0a20 2020 2020 2020  ch[wh_t].       
-00091870: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00091880: 2020 6966 206c 656e 2877 685f 7429 203e    if len(wh_t) >
-00091890: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-000918a0: 2020 2020 6966 2063 6e74 203d 3d20 303a      if cnt == 0:
-000918b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000918c0: 2020 2020 2064 665f 745b 2764 6973 7427       df_t['dist'
-000918d0: 5d20 3d20 6469 7374 0a20 2020 2020 2020  ] = dist.       
-000918e0: 2020 2020 2020 2020 2020 2020 2064 6631               df1
-000918f0: 203d 2064 665f 742e 696c 6f63 5b77 685f   = df_t.iloc[wh_
-00091900: 745d 2e63 6f70 7928 6465 6570 203d 2054  t].copy(deep = T
-00091910: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00091920: 2020 2020 2020 2020 2064 6632 203d 2064           df2 = d
-00091930: 665f 642e 696c 6f63 5b77 685f 645d 2e63  f_d.iloc[wh_d].c
-00091940: 6f70 7928 6465 6570 203d 2054 7275 6529  opy(deep = True)
-00091950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091960: 2020 2020 2063 6e74 202b 3d20 310a 2020       cnt += 1.  
-00091970: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00091980: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00091990: 2020 2020 2020 2020 6466 5f74 5b27 6469          df_t['di
-000919a0: 7374 275d 203d 2064 6973 740a 2020 2020  st'] = dist.    
-000919b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000919c0: 6466 3120 3d20 7064 2e63 6f6e 6361 7428  df1 = pd.concat(
-000919d0: 5b64 6631 2c20 6466 5f74 2e69 6c6f 635b  [df1, df_t.iloc[
-000919e0: 7768 5f74 5d2e 636f 7079 2864 6565 7020  wh_t].copy(deep 
-000919f0: 3d20 5472 7565 295d 290a 2020 2020 2020  = True)]).      
-00091a00: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00091a10: 3220 3d20 7064 2e63 6f6e 6361 7428 5b64  2 = pd.concat([d
-00091a20: 6632 2c20 6466 5f64 2e69 6c6f 635b 7768  f2, df_d.iloc[wh
-00091a30: 5f64 5d2e 636f 7079 2864 6565 7020 3d20  _d].copy(deep = 
-00091a40: 5472 7565 295d 290a 2020 2020 2020 2020  True)]).        
-00091a50: 2020 2020 2020 2020 2020 2020 636e 7420              cnt 
-00091a60: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00091a70: 0a20 2020 2070 7269 6e74 2827 5c72 4d61  .    print('\rMa
-00091a80: 7463 6869 6e67 202e 2e20 646f 6e65 2e20  tching .. done. 
-00091a90: 272c 2065 6e64 203d 2027 2729 0a20 2020  ', end = '').   
-00091aa0: 2069 6620 636e 7420 3e20 303a 0a20 2020   if cnt > 0:.   
-00091ab0: 2020 2020 2064 6632 203d 2064 6632 2e72       df2 = df2.r
-00091ac0: 656e 616d 6528 2063 6f6c 756d 6e73 203d  ename( columns =
-00091ad0: 207b 2763 6872 273a 2027 6368 725f 6427   {'chr': 'chr_d'
-00091ae0: 2c20 2774 7970 6527 3a20 2774 7970 655f  , 'type': 'type_
-00091af0: 6427 2c20 2770 6f73 5f6f 7267 273a 2027  d', 'pos_org': '
-00091b00: 706f 735f 6f72 675f 6427 2c20 5c0a 2020  pos_org_d', \.  
-00091b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091b20: 2020 2020 2020 2020 2020 2020 2020 2773                's
-00091b30: 6571 5f6f 7267 273a 2027 7365 715f 6f72  eq_org': 'seq_or
-00091b40: 675f 6427 2c20 2773 6571 5f6e 6577 273a  g_d', 'seq_new':
-00091b50: 2027 7365 715f 6e65 775f 6427 7d20 290a   'seq_new_d'} ).
-00091b60: 2020 2020 2020 2020 7365 6c5f 636f 6c5f          sel_col_
-00091b70: 7420 3d20 5b27 6368 7227 2c20 2774 7970  t = ['chr', 'typ
-00091b80: 6527 2c20 2770 6f73 5f6f 7267 272c 2027  e', 'pos_org', '
-00091b90: 7365 715f 6f72 6727 2c20 2773 6571 5f6e  seq_org', 'seq_n
-00091ba0: 6577 272c 2027 6469 7374 275d 0a20 2020  ew', 'dist'].   
-00091bb0: 2020 2020 2073 656c 5f63 6f6c 5f64 203d       sel_col_d =
-00091bc0: 205b 2769 6427 2c20 2763 6872 5f64 272c   ['id', 'chr_d',
-00091bd0: 2027 7479 7065 5f64 272c 2027 706f 735f   'type_d', 'pos_
-00091be0: 6f72 675f 6427 2c20 2773 6571 5f6f 7267  org_d', 'seq_org
-00091bf0: 5f64 272c 2027 7365 715f 6e65 775f 6427  _d', 'seq_new_d'
-00091c00: 5d0a 2020 2020 2020 2020 6466 312e 696e  ].        df1.in
-00091c10: 6465 7820 3d20 7064 2e49 6e64 6578 285b  dex = pd.Index([
-00091c20: 6b20 666f 7220 6b20 696e 2072 616e 6765  k for k in range
-00091c30: 2864 6631 2e73 6861 7065 5b30 5d29 5d29  (df1.shape[0])])
-00091c40: 0a20 2020 2020 2020 2064 6632 2e69 6e64  .        df2.ind
-00091c50: 6578 203d 2070 642e 496e 6465 7828 5b6b  ex = pd.Index([k
-00091c60: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
-00091c70: 6466 322e 7368 6170 655b 305d 295d 290a  df2.shape[0])]).
-00091c80: 2020 2020 2020 2020 6466 203d 2070 642e          df = pd.
-00091c90: 636f 6e63 6174 2820 5b64 6631 5b73 656c  concat( [df1[sel
-00091ca0: 5f63 6f6c 5f74 5d2c 2064 6632 5b73 656c  _col_t], df2[sel
-00091cb0: 5f63 6f6c 5f64 5d5d 2c20 6178 6973 203d  _col_d]], axis =
-00091cc0: 2031 2c20 736f 7274 3d46 616c 7365 2029   1, sort=False )
-00091cd0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00091ce0: 2020 2020 200a 2020 2020 2020 2020 7365       .        se
-00091cf0: 6e73 203d 2031 3030 2a64 662e 7368 6170  ns = 100*df.shap
-00091d00: 655b 305d 2f4e 5f74 0a20 2020 2020 2020  e[0]/N_t.       
-00091d10: 2070 7265 6320 3d20 3130 302a 6466 2e73   prec = 100*df.s
-00091d20: 6861 7065 5b30 5d2f 4e5f 640a 2020 2020  hape[0]/N_d.    
-00091d30: 2020 2020 7072 696e 7428 2720 4e5f 743a      print(' N_t:
-00091d40: 2025 692c 204e 5f64 3a20 2569 202d 3e20   %i, N_d: %i -> 
-00091d50: 2569 2028 7365 6e73 3a20 2534 2e31 662c  %i (sens: %4.1f,
-00091d60: 2070 7265 633a 2025 342e 3166 2920 2720   prec: %4.1f) ' 
-00091d70: 2520 5c0a 2020 2020 2020 2020 2020 2020  % \.            
-00091d80: 2020 284e 5f74 2c20 4e5f 642c 2064 662e    (N_t, N_d, df.
-00091d90: 7368 6170 655b 305d 2c20 7365 6e73 2c20  shape[0], sens, 
-00091da0: 7072 6563 2929 0a20 2020 2020 2020 2072  prec)).        r
-00091db0: 6574 7572 6e20 6466 2c20 7072 6563 2c20  eturn df, prec, 
-00091dc0: 7365 6e73 2c20 6466 2e73 6861 7065 5b30  sens, df.shape[0
-00091dd0: 5d2c 204e 5f64 2c20 4e5f 740a 2020 2020  ], N_d, N_t.    
-00091de0: 656c 7365 3a0a 2020 2020 2020 2020 7072  else:.        pr
-00091df0: 696e 7428 2720 2729 0a20 2020 2020 2020  int(' ').       
-00091e00: 2072 6574 7572 6e20 4e6f 6e65 2c20 302c   return None, 0,
-00091e10: 2030 2c20 302c 2030 2c20 300a 2020 2020   0, 0, 0, 0.    
-00091e20: 2020 2020 2020 2020 0a23 2323 2323 2323          .#######
-00091e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091e50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091e60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091e70: 2323 230a 2323 2053 656f 6b68 7975 6e20  ###.## Seokhyun 
-00091e80: 596f 6f6e 2028 7379 6f6f 6e40 646b 752e  Yoon (syoon@dku.
-00091e90: 6564 7529 204f 6374 2e20 3034 2c20 3230  edu) Oct. 04, 20
-00091ea0: 3230 0a23 2323 2323 2323 2323 2323 2323  20.#############
+000916f0: 2020 6d61 7463 685b 636e 745f 745d 203d    match[cnt_t] =
+00091700: 2063 6e74 5f64 0a20 2020 2020 2020 2020   cnt_d.         
+00091710: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00091720: 6973 745b 636e 745f 745d 203d 2070 5f74  ist[cnt_t] = p_t
+00091730: 202d 2070 5f64 0a20 2020 2020 2020 2020   - p_d.         
+00091740: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00091750: 6e74 5f74 202b 3d20 310a 2020 2020 2020  nt_t += 1.      
+00091760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091770: 2020 636e 745f 6420 2b3d 2031 0a20 2020    cnt_d += 1.   
+00091780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091790: 2020 2020 2062 203d 2046 616c 7365 0a20       b = False. 
+000917a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000917b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000917c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000917d0: 2023 2063 6e74 5f74 202b 3d20 310a 2020   # cnt_t += 1.  
+000917e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000917f0: 2020 2020 2020 2320 636e 745f 6420 2b3d        # cnt_d +=
+00091800: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00091810: 2020 2020 2020 2020 2020 2069 6620 2863             if (c
+00091820: 6e74 5f64 203e 3d20 6e5f 6465 7465 6374  nt_d >= n_detect
+00091830: 6564 2920 7c20 2863 6e74 5f74 203e 3d20  ed) | (cnt_t >= 
+00091840: 6e5f 7461 7267 6574 293a 2062 7265 616b  n_target): break
+00091850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091860: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
+00091870: 2020 2020 2020 2062 203d 206d 6174 6368         b = match
+00091880: 203e 3d20 300a 2020 2020 2020 2020 2020   >= 0.          
+00091890: 2020 7768 5f74 203d 2077 6869 6368 2862    wh_t = which(b
+000918a0: 290a 2020 2020 2020 2020 2020 2020 7768  ).            wh
+000918b0: 5f64 203d 206d 6174 6368 5b77 685f 745d  _d = match[wh_t]
+000918c0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+000918d0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000918e0: 2877 685f 7429 203e 2030 3a0a 2020 2020  (wh_t) > 0:.    
+000918f0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00091900: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
+00091910: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00091920: 745b 2764 6973 7427 5d20 3d20 6469 7374  t['dist'] = dist
+00091930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091940: 2020 2020 2064 6631 203d 2064 665f 742e       df1 = df_t.
+00091950: 696c 6f63 5b77 685f 745d 2e63 6f70 7928  iloc[wh_t].copy(
+00091960: 6465 6570 203d 2054 7275 6529 0a20 2020  deep = True).   
+00091970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091980: 2064 6632 203d 2064 665f 642e 696c 6f63   df2 = df_d.iloc
+00091990: 5b77 685f 645d 2e63 6f70 7928 6465 6570  [wh_d].copy(deep
+000919a0: 203d 2054 7275 6529 0a20 2020 2020 2020   = True).       
+000919b0: 2020 2020 2020 2020 2020 2020 2063 6e74               cnt
+000919c0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+000919d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000919e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000919f0: 6466 5f74 5b27 6469 7374 275d 203d 2064  df_t['dist'] = d
+00091a00: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+00091a10: 2020 2020 2020 2020 6466 3120 3d20 7064          df1 = pd
+00091a20: 2e63 6f6e 6361 7428 5b64 6631 2c20 6466  .concat([df1, df
+00091a30: 5f74 2e69 6c6f 635b 7768 5f74 5d2e 636f  _t.iloc[wh_t].co
+00091a40: 7079 2864 6565 7020 3d20 5472 7565 295d  py(deep = True)]
+00091a50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00091a60: 2020 2020 2020 6466 3220 3d20 7064 2e63        df2 = pd.c
+00091a70: 6f6e 6361 7428 5b64 6632 2c20 6466 5f64  oncat([df2, df_d
+00091a80: 2e69 6c6f 635b 7768 5f64 5d2e 636f 7079  .iloc[wh_d].copy
+00091a90: 2864 6565 7020 3d20 5472 7565 295d 290a  (deep = True)]).
+00091aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091ab0: 2020 2020 636e 7420 2b3d 2031 0a20 2020      cnt += 1.   
+00091ac0: 2020 2020 2020 2020 0a20 2020 2070 7269          .    pri
+00091ad0: 6e74 2827 5c72 4d61 7463 6869 6e67 202e  nt('\rMatching .
+00091ae0: 2e20 646f 6e65 2e20 272c 2065 6e64 203d  . done. ', end =
+00091af0: 2027 2729 0a20 2020 2069 6620 636e 7420   '').    if cnt 
+00091b00: 3e20 303a 0a20 2020 2020 2020 2064 6632  > 0:.        df2
+00091b10: 203d 2064 6632 2e72 656e 616d 6528 2063   = df2.rename( c
+00091b20: 6f6c 756d 6e73 203d 207b 2763 6872 273a  olumns = {'chr':
+00091b30: 2027 6368 725f 6427 2c20 2774 7970 6527   'chr_d', 'type'
+00091b40: 3a20 2774 7970 655f 6427 2c20 2770 6f73  : 'type_d', 'pos
+00091b50: 5f6f 7267 273a 2027 706f 735f 6f72 675f  _org': 'pos_org_
+00091b60: 6427 2c20 5c0a 2020 2020 2020 2020 2020  d', \.          
+00091b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091b80: 2020 2020 2020 2773 6571 5f6f 7267 273a        'seq_org':
+00091b90: 2027 7365 715f 6f72 675f 6427 2c20 2773   'seq_org_d', 's
+00091ba0: 6571 5f6e 6577 273a 2027 7365 715f 6e65  eq_new': 'seq_ne
+00091bb0: 775f 6427 7d20 290a 2020 2020 2020 2020  w_d'} ).        
+00091bc0: 7365 6c5f 636f 6c5f 7420 3d20 5b27 6368  sel_col_t = ['ch
+00091bd0: 7227 2c20 2774 7970 6527 2c20 2770 6f73  r', 'type', 'pos
+00091be0: 5f6f 7267 272c 2027 7365 715f 6f72 6727  _org', 'seq_org'
+00091bf0: 2c20 2773 6571 5f6e 6577 272c 2027 6469  , 'seq_new', 'di
+00091c00: 7374 275d 0a20 2020 2020 2020 2073 656c  st'].        sel
+00091c10: 5f63 6f6c 5f64 203d 205b 2769 6427 2c20  _col_d = ['id', 
+00091c20: 2763 6872 5f64 272c 2027 7479 7065 5f64  'chr_d', 'type_d
+00091c30: 272c 2027 706f 735f 6f72 675f 6427 2c20  ', 'pos_org_d', 
+00091c40: 2773 6571 5f6f 7267 5f64 272c 2027 7365  'seq_org_d', 'se
+00091c50: 715f 6e65 775f 6427 5d0a 2020 2020 2020  q_new_d'].      
+00091c60: 2020 6466 312e 696e 6465 7820 3d20 7064    df1.index = pd
+00091c70: 2e49 6e64 6578 285b 6b20 666f 7220 6b20  .Index([k for k 
+00091c80: 696e 2072 616e 6765 2864 6631 2e73 6861  in range(df1.sha
+00091c90: 7065 5b30 5d29 5d29 0a20 2020 2020 2020  pe[0])]).       
+00091ca0: 2064 6632 2e69 6e64 6578 203d 2070 642e   df2.index = pd.
+00091cb0: 496e 6465 7828 5b6b 2066 6f72 206b 2069  Index([k for k i
+00091cc0: 6e20 7261 6e67 6528 6466 322e 7368 6170  n range(df2.shap
+00091cd0: 655b 305d 295d 290a 2020 2020 2020 2020  e[0])]).        
+00091ce0: 6466 203d 2070 642e 636f 6e63 6174 2820  df = pd.concat( 
+00091cf0: 5b64 6631 5b73 656c 5f63 6f6c 5f74 5d2c  [df1[sel_col_t],
+00091d00: 2064 6632 5b73 656c 5f63 6f6c 5f64 5d5d   df2[sel_col_d]]
+00091d10: 2c20 6178 6973 203d 2031 2c20 736f 7274  , axis = 1, sort
+00091d20: 3d46 616c 7365 2029 2020 2020 2020 2020  =False )        
+00091d30: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00091d40: 2020 2020 2020 7365 6e73 203d 2031 3030        sens = 100
+00091d50: 2a64 662e 7368 6170 655b 305d 2f4e 5f74  *df.shape[0]/N_t
+00091d60: 0a20 2020 2020 2020 2070 7265 6320 3d20  .        prec = 
+00091d70: 3130 302a 6466 2e73 6861 7065 5b30 5d2f  100*df.shape[0]/
+00091d80: 4e5f 640a 2020 2020 2020 2020 7072 696e  N_d.        prin
+00091d90: 7428 2720 4e5f 743a 2025 692c 204e 5f64  t(' N_t: %i, N_d
+00091da0: 3a20 2569 202d 3e20 2569 2028 7365 6e73  : %i -> %i (sens
+00091db0: 3a20 2534 2e31 662c 2070 7265 633a 2025  : %4.1f, prec: %
+00091dc0: 342e 3166 2920 2720 2520 5c0a 2020 2020  4.1f) ' % \.    
+00091dd0: 2020 2020 2020 2020 2020 284e 5f74 2c20            (N_t, 
+00091de0: 4e5f 642c 2064 662e 7368 6170 655b 305d  N_d, df.shape[0]
+00091df0: 2c20 7365 6e73 2c20 7072 6563 2929 0a20  , sens, prec)). 
+00091e00: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
+00091e10: 2c20 7072 6563 2c20 7365 6e73 2c20 6466  , prec, sens, df
+00091e20: 2e73 6861 7065 5b30 5d2c 204e 5f64 2c20  .shape[0], N_d, 
+00091e30: 4e5f 740a 2020 2020 656c 7365 3a0a 2020  N_t.    else:.  
+00091e40: 2020 2020 2020 7072 696e 7428 2720 2729        print(' ')
+00091e50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00091e60: 4e6f 6e65 2c20 302c 2030 2c20 302c 2030  None, 0, 0, 0, 0
+00091e70: 2c20 300a 2020 2020 2020 2020 2020 2020  , 0.            
+00091e80: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00091e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091ea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00091eb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091ec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091ed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00091ee0: 2323 2323 2323 2323 2323 2323 230a 0a0a  #############...
-00091ef0: 0a0a 2020 2020 2020 2020 0a              ..        .
+00091ec0: 2323 2323 2323 2323 2323 230a 2323 2053  ###########.## S
+00091ed0: 656f 6b68 7975 6e20 596f 6f6e 2028 7379  eokhyun Yoon (sy
+00091ee0: 6f6f 6e40 646b 752e 6564 7529 204f 6374  oon@dku.edu) Oct
+00091ef0: 2e20 3034 2c20 3230 3230 0a23 2323 2323  . 04, 2020.#####
+00091f00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091f10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091f20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091f30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00091f40: 2323 2323 230a 0a0a 0a0a 2020 2020 2020  #####.....      
+00091f50: 2020 0a                                    .
```

### Comparing `StringFix-0.1.3/StringFix/stringfix.py` & `StringFix-0.6.4/StringFix/run_sfix.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,13 @@
-#!/usr/bin/python3
+#!python3
 
 import numpy as np
 import argparse, time, os, pickle, datetime
-import StringFix.core as sf
-from StringFix.core  import StringFix_analysis, StringFix_synthesis, Generate_Reference, StringFix_GFFRead
+import core as sf
+from core  import StringFix_analysis, StringFix_synthesis, Generate_Reference, StringFix_GFFRead
 
 ## file_name_wo_ext = StringFix_analysis(sam_file, gtf = None, suffix = 'stringfix', jump = 0, sa = 2, cbyc = False, \
 ##                    n_cores = 1, min_frags_per_gene = 2, len_th = 200, out_tr = False )
 ## file_name_wo_ext, file_name_genome = StringFix_synthesis(gtf_file, genome_file, rev = True, n_cores = 1)
 ## file_name_ref_tr, file_name_ref_pr = Generate_Reference(gtf_file, genome_file)
 ## file_name_wo_ext = StringFix_GFFRead(gtf_file, genome_file = None, n_cores = 1)
 ## df, dft, df_sel = run_blast( inpt_fa, ref_fa, path_to_blast = None, trareco = True, ref_info = False, \
@@ -27,15 +27,15 @@
     optional.add_argument('-gtf', type=str, metavar='',
                           help='GTF/GFF file to be used for guide annotation ')
     optional.add_argument('-dir', type=str,  metavar='',
                         help='Output directory', default='SFix_out')
     optional.add_argument('-p', type=str,  metavar='',
                         help='Number of cores to use', default="4")
     optional.add_argument('-g', action = 'store_true',
-                        help='Set this option to generate customized genome and gtf.')
+                        help='Use this option to generate customized genome.')
     # optional.add_argument('-c', action = 'store_true',
     #                     help='Set this option to process chromosomes 1-by-1 to save memory usage.')
     optional.add_argument('-sfx', type=str,  metavar='',
                         help='Suffix to be used for output file names.', default = None)
     optional.add_argument('-mcv', type=str,  metavar='',
                         help='Minimum read coverage for inclusion in the output GTF/GFF and transcriptome/proteome [0~1]. For a length L transcript, \
                               it will be included in the output if at least mcv*L bases are covered by reads', default="0.5")
@@ -53,14 +53,16 @@
                         help='Minimum coverage depth for SNP correction [>=1.0].', default="3")
     optional.add_argument('-mdf', type=str,  metavar='',
                         help='Minimum coverage depth fraction for insersion and deletion to be considered valid (0~1).', default="0.25")
     optional.add_argument('-np', type=str,  metavar='',
                         help='Maximum number of isoforms per gene(read chunk). Applies when guide GTF is not provided. (>8).', default="16")
     optional.add_argument('-xsa', action = 'store_true',
                         help='Use this option to exclude secondary alignment.')
+    optional.add_argument('-s', action = 'store_false',
+                        help='Use this option to save gene descriptor and loci.', default=False)
     optional.add_argument('-j', type=str,  metavar='',
                         help='Jump to step j [0 or 1 or 2]', default="0")
     args = parser.parse_args()
     return args, parser
 
 
 def main():
@@ -93,44 +95,48 @@
 
         # rev = False
         rev = args.g
         cbyc = True # args.c
         sa = 2
         if args.xsa: sa = 0
 
+        save_gds_and_loci = False
+        if args.s: save_gds_and_loci = True
+
         sf.MIN_CVG_FOR_SNP_CORRECTION = int(args.mdp)
-        sf.I_VALID_CVG = max(1, np.float(args.mdi))
-        sf.D_VALID_CVG = max(1, np.float(args.mdd))
+        sf.I_VALID_CVG = max(1, float(args.mdi))
+        sf.D_VALID_CVG = max(1, float(args.mdd))
         sf.I_VALID_CFRAC = float(args.mdf)
         sf.D_VALID_CFRAC = float(args.mdf)
-        sf.MIN_COV_TO_SEL = np.float(args.mcv)
-        sf.MIN_ABN_TO_SEL = np.float(args.mcd)
+        sf.MIN_COV_TO_SEL = float(args.mcv)
+        sf.MIN_ABN_TO_SEL = float(args.mcd)
         sf.MIN_TR_LENGTH = int(args.mtl)
         sf.MIN_PR_LENGTH = int(args.mpl)
         sf.MAX_NUM_PATHS = int(args.np)
         sf.GEN_AAS_UNSPEC = True
         jump_to = int(args.j)
 
         if gtf_file is None:
             sf.MAX_NUM_PATHS = 20
             sf.MIN_N_RDS_PER_GENE = 30
             sf.TR_FILTER_SEL = 2
 
         if args.dir is not None: 
             if not os.path.exists(args.dir): os.mkdir(args.dir)
 
-        file_out, gds = StringFix_analysis(sam_file, gtf = gtf_file, genome = genome_fa, jump = jump_to, \
-                n_cores=n_cores, out_tr = True, cbyc = cbyc, suffix = args.sfx, out_dir = args.dir, sa = sa ) 
+        file_out, gds = StringFix_analysis(sam_file, gtf = gtf_file, genome_file = genome_fa, jump = jump_to, \
+                n_cores=n_cores, out_tr = True, cbyc = cbyc, suffix = args.sfx, out_dir = args.dir, sa = sa, \
+	  sav_rgn =  save_gds_and_loci) 
 
-        if (gds is not None) & (jump_to < 2):
+        if (save_gds_and_loci):  
             print('Saving gene descriptor .. ', end = ' ', flush = True)
             with open(file_out + '.gds', 'wb') as f:
                 pickle.dump( (gds), f )
             print('done. ')
-        else:
+        elif (gds is None) | (jump_to >= 2):
             print('StringFix started ', datetime.datetime.now())
             print('Loading gene descriptor .. ', end = ' ', flush = True)
             with open(file_out + '.gds', 'rb') as f:
                 gds = pickle.load( f )
             print('done. ')
         
         if (genome_fa is None):
```

### Comparing `StringFix-0.1.3/StringFix.egg-info/PKG-INFO` & `StringFix-0.6.4/StringFix.egg-info/PKG-INFO`

 * *Files 15% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: StringFix
-Version: 0.1.3
+Version: 0.6.4
 Summary: Annotation guided transcriptome assembly program.
 Home-page: https://github.com/combio-dku
 Download-URL: https://github.com/combio-dku
 Author: Joongho Lee, Seokhyun Yoon
 Author-email: syoon@dku.edu
 Keywords: pypi StringFix
 Classifier: Programming Language :: Python :: 3
```

### Comparing `StringFix-0.1.3/setup.py` & `StringFix-0.6.4/setup.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from setuptools import setup, find_packages
 
 setup(
     # 배포할 패키지의 이름을 적어줍니다. setup.py파일을 가지는 폴더 이름과 동일하게 합니다.
     name                = 'StringFix',
     # 배포할 패키지의 버전을 적어줍니다. 첫 등록이므로 0.1 또는 0.0.1을 사용합니다.
-    version             = '0.1.3',
+    version             = '0.6.4',
     # 배포할 패키지에 대한 설명을 작성합니다.
     description         = 'Annotation guided transcriptome assembly program.',
     # 배포하는 사람의 이름을 작성합니다.
     author              = 'Joongho Lee, Seokhyun Yoon',
     # 배포하는 사람의 메일주소를 작성합니다.
     author_email        = 'syoon@dku.edu',
     # 배포하는 패키지의 url을 적어줍니다. 보통 github 링크를 적습니다.
```

